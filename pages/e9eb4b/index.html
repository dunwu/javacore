<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java å­—èŠ‚ç  | JAVACORE</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/javacore/img/favicon.ico">
    <script src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <meta name="description" content="â˜• JavaCore æ˜¯ä¸€ä¸ª Java æ ¸å¿ƒæŠ€æœ¯æ•™ç¨‹ã€‚">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="wwads-cn-verify" content="mxqWx62nfQQ9ocT4e5DzISHzOWyF4s">
    
    <link rel="preload" href="/javacore/assets/css/0.styles.be3ea3bc.css" as="style"><link rel="preload" href="/javacore/assets/js/app.44fc03ae.js" as="script"><link rel="preload" href="/javacore/assets/js/2.aded268b.js" as="script"><link rel="preload" href="/javacore/assets/js/56.e604e971.js" as="script"><link rel="prefetch" href="/javacore/assets/js/10.b7bca9b5.js"><link rel="prefetch" href="/javacore/assets/js/11.033d3a41.js"><link rel="prefetch" href="/javacore/assets/js/12.b093ffe4.js"><link rel="prefetch" href="/javacore/assets/js/13.d561ca11.js"><link rel="prefetch" href="/javacore/assets/js/14.90010e0b.js"><link rel="prefetch" href="/javacore/assets/js/15.37509588.js"><link rel="prefetch" href="/javacore/assets/js/16.cd24ed18.js"><link rel="prefetch" href="/javacore/assets/js/17.5e555f8c.js"><link rel="prefetch" href="/javacore/assets/js/18.df926f74.js"><link rel="prefetch" href="/javacore/assets/js/19.8da3be6e.js"><link rel="prefetch" href="/javacore/assets/js/20.fb42e052.js"><link rel="prefetch" href="/javacore/assets/js/21.9d7decc0.js"><link rel="prefetch" href="/javacore/assets/js/22.f31ecff9.js"><link rel="prefetch" href="/javacore/assets/js/23.6f5cde97.js"><link rel="prefetch" href="/javacore/assets/js/24.e47f9024.js"><link rel="prefetch" href="/javacore/assets/js/25.da7e1173.js"><link rel="prefetch" href="/javacore/assets/js/26.e041331b.js"><link rel="prefetch" href="/javacore/assets/js/27.8f2ef716.js"><link rel="prefetch" href="/javacore/assets/js/28.a919e270.js"><link rel="prefetch" href="/javacore/assets/js/29.4846001f.js"><link rel="prefetch" href="/javacore/assets/js/3.d34c63b0.js"><link rel="prefetch" href="/javacore/assets/js/30.b3879734.js"><link rel="prefetch" href="/javacore/assets/js/31.e74cfb72.js"><link rel="prefetch" href="/javacore/assets/js/32.55bb9631.js"><link rel="prefetch" href="/javacore/assets/js/33.c695a6d1.js"><link rel="prefetch" href="/javacore/assets/js/34.146194b0.js"><link rel="prefetch" href="/javacore/assets/js/35.47c615d2.js"><link rel="prefetch" href="/javacore/assets/js/36.36c11b19.js"><link rel="prefetch" href="/javacore/assets/js/37.e4c911e1.js"><link rel="prefetch" href="/javacore/assets/js/38.612b0f0f.js"><link rel="prefetch" href="/javacore/assets/js/39.a8479ee6.js"><link rel="prefetch" href="/javacore/assets/js/4.884deeca.js"><link rel="prefetch" href="/javacore/assets/js/40.301701cc.js"><link rel="prefetch" href="/javacore/assets/js/41.7c62f68f.js"><link rel="prefetch" href="/javacore/assets/js/42.e9e5707c.js"><link rel="prefetch" href="/javacore/assets/js/43.2254ee61.js"><link rel="prefetch" href="/javacore/assets/js/44.24a7c914.js"><link rel="prefetch" href="/javacore/assets/js/45.4ed583ae.js"><link rel="prefetch" href="/javacore/assets/js/46.68ab70d3.js"><link rel="prefetch" href="/javacore/assets/js/47.1716d6b6.js"><link rel="prefetch" href="/javacore/assets/js/48.8069bdf8.js"><link rel="prefetch" href="/javacore/assets/js/49.d272babd.js"><link rel="prefetch" href="/javacore/assets/js/5.0d7069e0.js"><link rel="prefetch" href="/javacore/assets/js/50.7fd74f29.js"><link rel="prefetch" href="/javacore/assets/js/51.f88d9d36.js"><link rel="prefetch" href="/javacore/assets/js/52.2adc8dae.js"><link rel="prefetch" href="/javacore/assets/js/53.e90f1fda.js"><link rel="prefetch" href="/javacore/assets/js/54.8616b845.js"><link rel="prefetch" href="/javacore/assets/js/55.1fabc8f2.js"><link rel="prefetch" href="/javacore/assets/js/57.c4ac5a73.js"><link rel="prefetch" href="/javacore/assets/js/58.8e47e699.js"><link rel="prefetch" href="/javacore/assets/js/59.1c10231b.js"><link rel="prefetch" href="/javacore/assets/js/6.12339b00.js"><link rel="prefetch" href="/javacore/assets/js/60.bbcc0b2c.js"><link rel="prefetch" href="/javacore/assets/js/61.9d5ce6ce.js"><link rel="prefetch" href="/javacore/assets/js/62.db323fc4.js"><link rel="prefetch" href="/javacore/assets/js/63.ba26811b.js"><link rel="prefetch" href="/javacore/assets/js/64.b2257255.js"><link rel="prefetch" href="/javacore/assets/js/65.b3e77388.js"><link rel="prefetch" href="/javacore/assets/js/66.fbb8f12c.js"><link rel="prefetch" href="/javacore/assets/js/67.def25516.js"><link rel="prefetch" href="/javacore/assets/js/68.52669526.js"><link rel="prefetch" href="/javacore/assets/js/69.294be448.js"><link rel="prefetch" href="/javacore/assets/js/7.e7d8e450.js"><link rel="prefetch" href="/javacore/assets/js/70.8f9c4fe6.js"><link rel="prefetch" href="/javacore/assets/js/71.a20157d2.js"><link rel="prefetch" href="/javacore/assets/js/8.0ccc6dba.js"><link rel="prefetch" href="/javacore/assets/js/9.6cfc63c0.js">
    <link rel="stylesheet" href="/javacore/assets/css/0.styles.be3ea3bc.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javacore/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/master/common/dunwu-logo.png" alt="JAVACORE" class="logo"> <span class="site-name can-hide">JAVACORE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/01.åŸºç¡€ç‰¹æ€§/" class="nav-link">åŸºç¡€ç‰¹æ€§</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/02.é«˜çº§ç‰¹æ€§/" class="nav-link">é«˜çº§ç‰¹æ€§</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/03.å®¹å™¨/" class="nav-link">å®¹å™¨</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/04.IO/" class="nav-link">IO</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/05.å¹¶å‘/" class="nav-link">å¹¶å‘</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/06.JVM/" class="nav-link">JVM</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/01.åŸºç¡€ç‰¹æ€§/" class="nav-link">åŸºç¡€ç‰¹æ€§</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/02.é«˜çº§ç‰¹æ€§/" class="nav-link">é«˜çº§ç‰¹æ€§</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/03.å®¹å™¨/" class="nav-link">å®¹å™¨</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/04.IO/" class="nav-link">IO</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/05.å¹¶å‘/" class="nav-link">å¹¶å‘</a></div><div class="nav-item"><a href="/javacore/01.Java/01.JavaSE/06.JVM/" class="nav-link">JVM</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/javacore" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaSE</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>åŸºç¡€ç‰¹æ€§</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>é«˜çº§ç‰¹æ€§</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>å®¹å™¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>å¹¶å‘</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javacore/pages/08f153/" class="sidebar-link">JVM ä½“ç³»ç»“æ„</a></li><li><a href="/javacore/pages/db5b69/" class="sidebar-link">Java å†…å­˜ç®¡ç†</a></li><li><a href="/javacore/pages/c5a5b6/" class="sidebar-link">JVM åƒåœ¾æ”¶é›†</a></li><li><a href="/javacore/pages/17aad9/" class="sidebar-link">JVM ç±»åŠ è½½</a></li><li><a href="/javacore/pages/e9eb4b/" aria-current="page" class="active sidebar-link">Java å­—èŠ‚ç </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#å­—èŠ‚ç ç®€ä»‹" class="sidebar-link">å­—èŠ‚ç ç®€ä»‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#ä»€ä¹ˆæ˜¯å­—èŠ‚ç " class="sidebar-link">ä»€ä¹ˆæ˜¯å­—èŠ‚ç </a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#åç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶" class="sidebar-link">åç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#å­—èŠ‚ç æ–‡ä»¶ç»“æ„" class="sidebar-link">å­—èŠ‚ç æ–‡ä»¶ç»“æ„</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#é­”æ•°" class="sidebar-link">é­”æ•°</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#ç‰ˆæœ¬å·" class="sidebar-link">ç‰ˆæœ¬å·</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#å¸¸é‡æ± " class="sidebar-link">å¸¸é‡æ± </a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#è®¿é—®æ ‡å¿—" class="sidebar-link">è®¿é—®æ ‡å¿—</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•" class="sidebar-link">ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#å­—æ®µè¡¨" class="sidebar-link">å­—æ®µè¡¨</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#æ–¹æ³•è¡¨" class="sidebar-link">æ–¹æ³•è¡¨</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#å±æ€§è¡¨é›†åˆ" class="sidebar-link">å±æ€§è¡¨é›†åˆ</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#å­—èŠ‚ç æŒ‡ä»¤" class="sidebar-link">å­—èŠ‚ç æŒ‡ä»¤</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#å­—èŠ‚ç å¢å¼º" class="sidebar-link">å­—èŠ‚ç å¢å¼º</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#asm" class="sidebar-link">Asm</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#javassist" class="sidebar-link">Javassist</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#è¿è¡Œæ—¶ç±»çš„é‡è½½" class="sidebar-link">è¿è¡Œæ—¶ç±»çš„é‡è½½</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#instrument" class="sidebar-link">Instrument</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#javaagent" class="sidebar-link">JavaAgent</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-æŠ€æœ¯ç®€ä»‹" class="sidebar-link">Java Agent æŠ€æœ¯ç®€ä»‹</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-åŠŸèƒ½ä»‹ç»" class="sidebar-link">Java Agent åŠŸèƒ½ä»‹ç»</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-å®ç°åŸç†" class="sidebar-link">Java Agent å®ç°åŸç†</a></li><li class="sidebar-sub-header level3"><a href="/javacore/pages/e9eb4b/#java-agent-æ¡ˆä¾‹" class="sidebar-link">Java Agent æ¡ˆä¾‹</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#åŠ è½½-java-å­—èŠ‚ç ä¹‹å‰æ‹¦æˆª" class="sidebar-link">åŠ è½½ Java å­—èŠ‚ç ä¹‹å‰æ‹¦æˆª</a></li><li class="sidebar-sub-header level5"><a href="/javacore/pages/e9eb4b/#app-é¡¹ç›®" class="sidebar-link">App é¡¹ç›®</a></li><li class="sidebar-sub-header level5"><a href="/javacore/pages/e9eb4b/#agent-é¡¹ç›®" class="sidebar-link">Agent é¡¹ç›®</a></li><li class="sidebar-sub-header level4"><a href="/javacore/pages/e9eb4b/#è¿è¡Œæ—¶æ‹¦æˆª-jdk-1-6-åŠä»¥ä¸Š" class="sidebar-link">è¿è¡Œæ—¶æ‹¦æˆªï¼ˆJDK 1.6 åŠä»¥ä¸Šï¼‰</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#å­—èŠ‚ç å·¥å…·" class="sidebar-link">å­—èŠ‚ç å·¥å…·</a></li><li class="sidebar-sub-header level2"><a href="/javacore/pages/e9eb4b/#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a></li></ul></li><li><a href="/javacore/pages/c590ae/" class="sidebar-link">JVM å‘½ä»¤è¡Œå·¥å…·</a></li><li><a href="/javacore/pages/43a8e5/" class="sidebar-link">JVM GUI å·¥å…·</a></li><li><a href="/javacore/pages/9cb60a/" class="sidebar-link">JVM å®æˆ˜</a></li><li><a href="/javacore/pages/84f329/" class="sidebar-link">Java æ•…éšœè¯Šæ–­</a></li></ul></section></li><li><a href="/javacore/pages/5f886e/" class="sidebar-link">Java é¢è¯•æ€»ç»“</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/javacore/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/javacore/categories/?category=Java" title="åˆ†ç±»" data-v-06225672>Java</a></li><li data-v-06225672><a href="/javacore/categories/?category=JavaSE" title="åˆ†ç±»" data-v-06225672>JavaSE</a></li><li data-v-06225672><a href="/javacore/categories/?category=JVM" title="åˆ†ç±»" data-v-06225672>JVM</a></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/dunwu" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>dunwu</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2019-10-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Java å­—èŠ‚ç <!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="java-å­—èŠ‚ç "><a href="#java-å­—èŠ‚ç " class="header-anchor">#</a> Java å­—èŠ‚ç </h1> <h2 id="å­—èŠ‚ç ç®€ä»‹"><a href="#å­—èŠ‚ç ç®€ä»‹" class="header-anchor">#</a> å­—èŠ‚ç ç®€ä»‹</h2> <h3 id="ä»€ä¹ˆæ˜¯å­—èŠ‚ç "><a href="#ä»€ä¹ˆæ˜¯å­—èŠ‚ç " class="header-anchor">#</a> ä»€ä¹ˆæ˜¯å­—èŠ‚ç </h3> <p>Java å­—èŠ‚ç æ˜¯ Java è™šæ‹Ÿæœºæ‰§è¡Œçš„ä¸€ç§æŒ‡ä»¤æ ¼å¼ã€‚ä¹‹æ‰€ä»¥è¢«ç§°ä¹‹ä¸ºå­—èŠ‚ç ï¼Œæ˜¯å› ä¸ºï¼š<strong>Java å­—èŠ‚ç æ–‡ä»¶ï¼ˆ<code>.class</code>ï¼‰æ˜¯ä¸€ç§ä»¥ 8 ä½å­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµæ–‡ä»¶</strong>ï¼Œå„ä¸ªæ•°æ®é¡¹ä¸¥æ ¼æŒ‰ç…§é¡ºåºç´§å‡‘åœ°æ’åˆ—åœ¨ .class æ–‡ä»¶ä¸­ï¼Œä¸­é—´æ²¡æœ‰æ·»åŠ ä»»ä½•åˆ†éš”ç¬¦ã€‚<strong>æ•´ä¸ª .class æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ è¡¨</strong>ã€‚</p> <p>Java èƒ½åšåˆ° â€œ<strong>ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œ</strong>â€ï¼Œä¸€æ˜¯å› ä¸º JVM é’ˆå¯¹å„ç§æ“ä½œç³»ç»Ÿã€å¹³å°éƒ½è¿›è¡Œäº†å®šåˆ¶ï¼›äºŒæ˜¯å› ä¸ºæ— è®ºåœ¨ä»€ä¹ˆå¹³å°ï¼Œéƒ½å¯ä»¥ç¼–è¯‘ç”Ÿæˆå›ºå®šæ ¼å¼çš„ Java å­—èŠ‚ç æ–‡ä»¶ï¼ˆ<code>.class</code>ï¼‰ã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20230419203137.png" alt=""></p> <h3 id="åç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶"><a href="#åç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶" class="header-anchor">#</a> åç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶</h3> <p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥è®²è§£å¦‚ä½•åç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶ã€‚</p> <p>ï¼ˆ1ï¼‰é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª <code>Demo.java</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ï¼ˆ2ï¼‰æ‰§è¡Œ <code>javac Demo.java</code>ï¼Œç¼–è¯‘ <code>Demo.java</code> æ–‡ä»¶ï¼Œåœ¨å½“å‰è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ª <code>Demo.class</code> æ–‡ä»¶ã€‚</p> <p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œæ˜¯ä¸€å † 16 è¿›åˆ¶æ•°ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ca fe ba be 20 20 20 34 20 1d 0a 20 06 20 0f 09 20 10 20 11 08 20 12 0a 20 13 20 14 07 20 15 07 20 16 01 20 06 3c 69 6e 69 74 3e 01 20 03 28 29 56 01 20 04 43 6f 64 65 01 20 0f 4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 01 20 04 6d 61 69 6e 01 20 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 01 20 0a 53 6f 75 72 63 65 46 69 6c 65 01 20 09 44 65 6d 6f 2e 6a 61 76 61 0c 20 07 20 08 07 20 17 0c 20 18 20 19 01 20 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 07 20 1a 0c 20 1b 20 1c 01 20 26 69 6f 2f 67 69 74 68 75 62 2f 64 75 6e 77 75 2f 6a 61 76 61 63 6f 72 65 2f 62 79 74 65 63 6f 64 65 2f 44 65 6d 6f 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 20 03 6f 75 74 01 20 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b 01 20 13 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 01 20 07 70 72 69 6e 74 6c 6e 01 20 15 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 20 21 20 05 20 06 20 20 20 20 20 02 20 01 20 07 20 08 20 01 20 09 20 20 20 1d 20 01 20 01 20 20 20 05 2a b7 20 01 b1 20 20 20 01 20 0a 20 20 20 06 20 01 20 20 20 03 20 09 20 0b 20 0c 20 01 20 09 20 20 20 25 20 02 20 01 20 20 20 09 b2 20 02 12 03 b6 20 04 b1 20 20 20 01 20 0a 20 20 20 0a 20 02 20 20 20 06 20 08 20 07 20 01 20 0d 20 20 20 02 20 0e
</code></pre></div><p>å‰é¢å·²ç»æè¿‡ï¼šJava å­—èŠ‚ç æ–‡ä»¶ï¼ˆ<code>.class</code>ï¼‰æ˜¯ä¸€ç§ä»¥ 8 ä½å­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµæ–‡ä»¶ï¼Œå„ä¸ªæ•°æ®é¡¹ä¸¥æ ¼æŒ‰ç…§é¡ºåºç´§å‡‘åœ°æ’åˆ—åœ¨ .class æ–‡ä»¶ä¸­ï¼Œä¸­é—´æ²¡æœ‰æ·»åŠ ä»»ä½•åˆ†éš”ç¬¦ã€‚</p> <p>ï¼ˆ3ï¼‰ä½¿ç”¨åˆ° Java å†…ç½®çš„åç¼–è¯‘å·¥å…· <code>javap</code> å¯ä»¥<strong>åç¼–è¯‘</strong>å­—èŠ‚ç æ–‡ä»¶ã€‚</p> <p>æ‰§è¡Œ <code>javap -verbose -p Demo.class</code>ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºç›¸å¯¹è€Œè¨€ï¼Œå¯ä»¥ç†è§£çš„æŒ‡ä»¤ã€‚è¾“å‡ºå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Classfile</span> <span class="token operator">/</span><span class="token class-name">D</span><span class="token operator">:</span><span class="token operator">/</span><span class="token class-name">Workspace</span><span class="token operator">/</span><span class="token class-name">Demo</span><span class="token punctuation">.</span><span class="token keyword">class</span>
  <span class="token class-name">Last</span> modified <span class="token number">2023</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">;</span> size <span class="token number">447</span> bytes
  <span class="token constant">MD5</span> checksum <span class="token number">0</span>baafe4215fe2bd2e51b48d51fe563a3
  <span class="token class-name">Compiled</span> from <span class="token string">&quot;Demo.java&quot;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>Demo</span>
  minor version<span class="token operator">:</span> <span class="token number">0</span>
  major version<span class="token operator">:</span> <span class="token number">52</span>
  flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_SUPER</span>
<span class="token class-name">Constant</span> pool<span class="token operator">:</span>
   #<span class="token number">1</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">6.</span>#<span class="token number">15</span>         <span class="token comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
   #<span class="token number">2</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">16.</span>#<span class="token number">17</span>        <span class="token comment">// java/lang/System.out:Ljava/io/PrintStream;</span>
   #<span class="token number">3</span> <span class="token operator">=</span> <span class="token class-name">String</span>             #<span class="token number">18</span>            <span class="token comment">// hello world</span>
   #<span class="token number">4</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">19.</span>#<span class="token number">20</span>        <span class="token comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span>
   #<span class="token number">5</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">21</span>            <span class="token comment">// io/github/dunwu/javacore/bytecode/Demo</span>
   #<span class="token number">6</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">22</span>            <span class="token comment">// java/lang/Object</span>
   #<span class="token number">7</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span>
   #<span class="token number">8</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
   #<span class="token number">9</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Code</span>
  #<span class="token number">10</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">LineNumberTable</span>
  #<span class="token number">11</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               main
  #<span class="token number">12</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
  #<span class="token number">13</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">SourceFile</span>
  #<span class="token number">14</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Demo</span><span class="token punctuation">.</span>java
  #<span class="token number">15</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">7</span><span class="token operator">:</span>#<span class="token number">8</span>          <span class="token comment">// &quot;&lt;init&gt;&quot;:()V</span>
  #<span class="token number">16</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">23</span>            <span class="token comment">// java/lang/System</span>
  #<span class="token number">17</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">24</span><span class="token operator">:</span>#<span class="token number">25</span>        <span class="token comment">// out:Ljava/io/PrintStream;</span>
  #<span class="token number">18</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               hello world
  #<span class="token number">19</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">26</span>            <span class="token comment">// java/io/PrintStream</span>
  #<span class="token number">20</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">27</span><span class="token operator">:</span>#<span class="token number">28</span>        <span class="token comment">// println:(Ljava/lang/String;)V</span>
  #<span class="token number">21</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               io<span class="token operator">/</span>github<span class="token operator">/</span>dunwu<span class="token operator">/</span>javacore<span class="token operator">/</span>bytecode<span class="token operator">/</span><span class="token class-name">Demo</span>
  #<span class="token number">22</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span>
  #<span class="token number">23</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span>
  #<span class="token number">24</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               out
  #<span class="token number">25</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span>
  #<span class="token number">26</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span>
  #<span class="token number">27</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               println
  #<span class="token number">28</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>bytecode<span class="token punctuation">.</span></span>Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> aload_0
         <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
         <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">3</span><span class="token operator">:</span> <span class="token number">0</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
         <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">3</span>                  <span class="token comment">// String hello world</span>
         <span class="token number">5</span><span class="token operator">:</span> invokevirtual #<span class="token number">4</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
         <span class="token number">8</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">6</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">7</span><span class="token operator">:</span> <span class="token number">8</span>
<span class="token punctuation">}</span>
<span class="token class-name">SourceFile</span><span class="token operator">:</span> <span class="token string">&quot;Demo.java&quot;</span>
</code></pre></div><blockquote><p>æç¤ºï¼šé€šè¿‡ <code>javap -help</code> å¯äº†è§£ <code>javap</code> çš„åŸºæœ¬ç”¨æ³•ã€‚</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ç”¨æ³•: javap <span class="token operator">&lt;</span>options<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>classes<span class="token operator">&gt;</span>
å…¶ä¸­, å¯èƒ½çš„é€‰é¡¹åŒ…æ‹¬:
  <span class="token parameter variable">-help</span>  <span class="token parameter variable">--help</span>  -?        è¾“å‡ºæ­¤ç”¨æ³•æ¶ˆæ¯
  <span class="token parameter variable">-version</span>                 ç‰ˆæœ¬ä¿¡æ¯
    <span class="token parameter variable">-v</span>  <span class="token parameter variable">-verbose</span>             è¾“å‡ºé™„åŠ ä¿¡æ¯
    <span class="token parameter variable">-l</span>                       è¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨
    <span class="token parameter variable">-public</span>                  ä»…æ˜¾ç¤ºå…¬å…±ç±»å’Œæˆå‘˜
    <span class="token parameter variable">-protected</span>               æ˜¾ç¤ºå—ä¿æŠ¤çš„/å…¬å…±ç±»å’Œæˆå‘˜
    <span class="token parameter variable">-package</span>                 æ˜¾ç¤ºç¨‹åºåŒ…/å—ä¿æŠ¤çš„/å…¬å…±ç±»
                             å’Œæˆå‘˜ <span class="token punctuation">(</span>é»˜è®¤<span class="token punctuation">)</span>
    <span class="token parameter variable">-p</span>  <span class="token parameter variable">-private</span>             æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜
     <span class="token parameter variable">-c</span>                       å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼–
    <span class="token parameter variable">-s</span>                       è¾“å‡ºå†…éƒ¨ç±»å‹ç­¾å
    <span class="token parameter variable">-sysinfo</span>                 æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„ç±»çš„
                             ç³»ç»Ÿä¿¡æ¯ <span class="token punctuation">(</span>è·¯å¾„, å¤§å°, æ—¥æœŸ, MD5 æ•£åˆ—<span class="token punctuation">)</span>
    <span class="token parameter variable">-constants</span>               æ˜¾ç¤ºæœ€ç»ˆå¸¸é‡
     <span class="token parameter variable">-classpath</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>        æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½®
    <span class="token parameter variable">-cp</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>               æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½®
    <span class="token parameter variable">-bootclasspath</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span>    è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½®
</code></pre></div></blockquote> <h3 id="å­—èŠ‚ç æ–‡ä»¶ç»“æ„"><a href="#å­—èŠ‚ç æ–‡ä»¶ç»“æ„" class="header-anchor">#</a> å­—èŠ‚ç æ–‡ä»¶ç»“æ„</h3> <p>å­—èŠ‚ç çœ‹ä¼¼æ‚ä¹±æ— åºï¼Œå®é™…ä¸Šæ˜¯ç”±ä¸¥æ ¼çš„æ ¼å¼è¦æ±‚ç»„æˆçš„ã€‚</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20230419154033.png" alt=""></p> <h4 id="é­”æ•°"><a href="#é­”æ•°" class="header-anchor">#</a> é­”æ•°</h4> <p>æ¯ä¸ª <code>.class</code> æ–‡ä»¶çš„å¤´ 4 ä¸ªå­—èŠ‚ç§°ä¸º <strong><code>é­”æ•°ï¼ˆmagic_numberï¼‰</code></strong>ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥æ”¶çš„ <code>.class</code> æ–‡ä»¶ã€‚é­”æ•°çš„å›ºå®šå€¼ä¸ºï¼š<code>0xCAFEBABE</code>ã€‚</p> <h4 id="ç‰ˆæœ¬å·"><a href="#ç‰ˆæœ¬å·" class="header-anchor">#</a> ç‰ˆæœ¬å·</h4> <p>ç‰ˆæœ¬å·ï¼ˆversionï¼‰æœ‰ 4 ä¸ªå­—èŠ‚ï¼Œ<strong>å‰ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºæ¬¡ç‰ˆæœ¬å·ï¼ˆMinor Versionï¼‰ï¼Œåä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰</strong>ã€‚</p> <p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ºï¼šâ€œ00 00 00 34â€ã€‚é‚£ä¹ˆï¼Œæ¬¡ç‰ˆæœ¬å·è½¬åŒ–ä¸ºåè¿›åˆ¶ä¸º 0ï¼Œä¸»ç‰ˆæœ¬å·è½¬åŒ–ä¸ºåè¿›åˆ¶ä¸º 52ï¼Œåœ¨ Oracle å®˜ç½‘ä¸­æŸ¥è¯¢åºå· 52 å¯¹åº”çš„ä¸»ç‰ˆæœ¬å·ä¸º 1.8ï¼Œæ‰€ä»¥ç¼–è¯‘è¯¥æ–‡ä»¶çš„ Java ç‰ˆæœ¬å·ä¸º 1.8.0ã€‚</p> <h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="header-anchor">#</a> å¸¸é‡æ± </h4> <p>ç´§æ¥ç€ä¸»ç‰ˆæœ¬å·ä¹‹åçš„å­—èŠ‚ä¸ºå¸¸é‡æ± ï¼ˆconstant_poolï¼‰ï¼Œå¸¸é‡æ± å¯ä»¥ç†è§£ä¸º <code>.class</code> æ–‡ä»¶ä¸­çš„èµ„æºä»“åº“ã€‚</p> <p>å¸¸é‡æ± æ•´ä½“ä¸Šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå¸¸é‡æ± è®¡æ•°å™¨ä»¥åŠå¸¸é‡æ± æ•°æ®åŒº</p> <ul><li><p><strong>å¸¸é‡æ± è®¡æ•°å™¨ï¼ˆconstant_pool_countï¼‰</strong> - ç”±äºå¸¸é‡çš„æ•°é‡ä¸å›ºå®šï¼Œæ‰€ä»¥éœ€è¦å…ˆæ”¾ç½®ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ã€‚</p></li> <li><p><strong>å¸¸é‡æ± æ•°æ®åŒº</strong> - æ•°æ®åŒºçš„æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œä¸”ç»“æ„å„ä¸ç›¸åŒã€‚</p></li></ul> <p>å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤ç±»å¸¸é‡ï¼š</p> <ul><li><strong>å­—é¢é‡</strong> - å¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€å£°æ˜ä¸º <code>final</code> çš„å¸¸é‡å€¼ã€‚</li> <li><strong>ç¬¦å·å¼•ç”¨</strong> <ul><li>ç±»å’Œæ¥å£çš„å…¨é™å®šå</li> <li>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</li> <li>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</li></ul></li></ul> <h4 id="è®¿é—®æ ‡å¿—"><a href="#è®¿é—®æ ‡å¿—" class="header-anchor">#</a> è®¿é—®æ ‡å¿—</h4> <p>ç´§æ¥ç€å¸¸é‡æ± çš„ 2 ä¸ªå­—èŠ‚ä»£è¡¨è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ï¼Œè¿™ä¸ªæ ‡å¿—<strong>ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£çš„è®¿é—®ä¿¡æ¯</strong>ï¼Œæè¿°è¯¥ Class æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œä»¥åŠæ˜¯å¦è¢« <code>public</code>ã€<code>abstract</code>ã€<code>final</code> ç­‰ä¿®é¥°ç¬¦ä¿®é¥°ã€‚</p> <p>è®¿é—®æ ‡å¿—æœ‰ä»¥ä¸‹ç±»å‹ï¼š</p> <table><thead><tr><th>æ ‡å¿—åç§°</th> <th>æ ‡å¿—å€¼</th> <th>å«ä¹‰</th></tr></thead> <tbody><tr><td><strong>ACC_PUBLIC</strong></td> <td>0x0001</td> <td>æ˜¯å¦ä¸º Public ç±»å‹</td></tr> <tr><td><strong>ACC_FINAL</strong></td> <td>0x0010</td> <td>æ˜¯å¦è¢«å£°æ˜ä¸º finalï¼Œåªæœ‰ç±»å¯ä»¥è®¾ç½®</td></tr> <tr><td><strong>ACC_SUPER</strong></td> <td>0x0020</td> <td>æ˜¯å¦å…è®¸ä½¿ç”¨ invokespecial å­—èŠ‚ç æŒ‡ä»¤çš„æ–°è¯­ä¹‰ï¼</td></tr> <tr><td><strong>ACC_INTERFACE</strong></td> <td>0x0200</td> <td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ¥å£</td></tr> <tr><td><strong>ACC_ABSTRACT</strong></td> <td>0x0400</td> <td>æ˜¯å¦ä¸º abstract ç±»å‹ï¼Œå¯¹äºæ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥è¯´ï¼Œ æ¬¡æ ‡å¿—å€¼ä¸ºçœŸï¼Œå…¶ä»–ç±»å‹ä¸ºå‡</td></tr> <tr><td><strong>ACC_SYNTHETIC</strong></td> <td>0x1000</td> <td>æ ‡å¿—è¿™ä¸ªç±»å¹¶éç”±ç”¨æˆ·ä»£ç äº§ç”Ÿ</td></tr> <tr><td><strong>ACC_ANNOTATION</strong></td> <td>0x2000</td> <td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ³¨è§£</td></tr> <tr><td><strong>ACC_ENUM</strong></td> <td>0x4000</td> <td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæšä¸¾</td></tr></tbody></table> <h4 id="ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•"><a href="#ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•" class="header-anchor">#</a> ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•</h4> <p>ç±»ç´¢å¼•ï¼ˆthis_classï¼‰å’Œçˆ¶ç±»ç´¢å¼•éƒ½æ˜¯ä¸€ä¸ª u2 ç±»å‹çš„æ•°æ®ï¼Œè€Œæ¥å£ç´¢å¼•é›†åˆæ˜¯ä¸€ç»„ u2 ç±»å‹çš„æ•°æ®çš„é›†åˆã€‚<strong>.class æ–‡ä»¶ä¸­ç”±è¿™ 3 é¡¹æ•°æ®æ¥ç¡®å®šè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»</strong>ã€‚</p> <h4 id="å­—æ®µè¡¨"><a href="#å­—æ®µè¡¨" class="header-anchor">#</a> å­—æ®µè¡¨</h4> <p><strong>å­—æ®µè¡¨ç”¨äºæè¿°ç±»å’Œæ¥å£ä¸­å£°æ˜çš„å˜é‡</strong>ã€‚åŒ…å«ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ï¼Œä½†æ˜¯ä¸åŒ…å«æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚</p> <p>å­—æ®µè¡¨ä¹Ÿåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºä¸¤ä¸ªå­—èŠ‚ï¼Œæè¿°å­—æ®µä¸ªæ•°ï¼›ç¬¬äºŒéƒ¨åˆ†æ˜¯æ¯ä¸ªå­—æ®µçš„è¯¦ç»†ä¿¡æ¯ fields_infoã€‚</p> <h4 id="æ–¹æ³•è¡¨"><a href="#æ–¹æ³•è¡¨" class="header-anchor">#</a> æ–¹æ³•è¡¨</h4> <p>å­—æ®µè¡¨ç»“æŸåä¸ºæ–¹æ³•è¡¨ï¼Œæ–¹æ³•è¡¨çš„ç»“æ„å¦‚åŒå­—æ®µè¡¨ä¸€æ ·ï¼Œä¾æ¬¡åŒ…æ‹¬äº†è®¿é—®æ ‡å¿—ã€åç§°ç´¢å¼•ã€æè¿°ç¬¦ç´¢å¼•ã€å±æ€§è¡¨é›†åˆå‡ é¡¹ã€‚</p> <h4 id="å±æ€§è¡¨é›†åˆ"><a href="#å±æ€§è¡¨é›†åˆ" class="header-anchor">#</a> å±æ€§è¡¨é›†åˆ</h4> <p>å±æ€§è¡¨é›†åˆå­˜æ”¾äº†åœ¨è¯¥æ–‡ä»¶ä¸­ç±»æˆ–æ¥å£æ‰€å®šä¹‰å±æ€§çš„åŸºæœ¬ä¿¡æ¯ã€‚</p> <h3 id="å­—èŠ‚ç æŒ‡ä»¤"><a href="#å­—èŠ‚ç æŒ‡ä»¤" class="header-anchor">#</a> å­—èŠ‚ç æŒ‡ä»¤</h3> <p>å­—èŠ‚ç æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ•°å­—ï¼ˆç§°ä¸ºæ“ä½œç ï¼ŒOpcodeï¼‰ä»¥åŠè·Ÿéšå…¶åçš„é›¶åˆ°å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•°ï¼ˆOperandsï¼‰è€Œæ„æˆã€‚ç”±äº JVM é‡‡ç”¨é¢å‘æ“ä½œæ•°æ ˆæ¶æ„è€Œä¸æ˜¯å¯„å­˜å™¨æ¶æ„ï¼Œæ‰€ä»¥å¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½ä¸åŒ…æ‹¬æ“ä½œæ•°ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œç ã€‚</p> <p>JVM æ“ä½œç çš„é•¿åº¦ä¸º 1 ä¸ªå­—èŠ‚ï¼Œå› æ­¤æŒ‡ä»¤é›†çš„æ“ä½œç æœ€å¤šåªæœ‰ 256 ä¸ªã€‚</p> <p>å­—èŠ‚ç æ“ä½œå¤§è‡´åˆ†ä¸º 9 ç±»ï¼š</p> <ul><li>åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤</li> <li>è¿ç®—æŒ‡ä»¤</li> <li>ç±»å‹è½¬æ¢æŒ‡ä»¤</li> <li>å¯¹è±¡åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</li> <li>æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</li> <li>æ§åˆ¶è½¬ç§»æŒ‡ä»¤</li> <li>æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤</li> <li>å¼‚å¸¸å¤„ç†æŒ‡ä»¤</li> <li>åŒæ­¥æŒ‡ä»¤</li></ul> <h2 id="å­—èŠ‚ç å¢å¼º"><a href="#å­—èŠ‚ç å¢å¼º" class="header-anchor">#</a> å­—èŠ‚ç å¢å¼º</h2> <p>å­—èŠ‚ç å¢å¼ºæŠ€æœ¯å°±æ˜¯ä¸€ç±»å¯¹ç°æœ‰å­—èŠ‚ç è¿›è¡Œä¿®æ”¹æˆ–è€…åŠ¨æ€ç”Ÿæˆå…¨æ–°å­—èŠ‚ç æ–‡ä»¶çš„æŠ€æœ¯ã€‚</p> <p>å¸¸è§çš„å­—èŠ‚ç å¢å¼ºæ¡†æ¶æœ‰ï¼š</p> <ul><li><a href="https://asm.ow2.io/" target="_blank" rel="noopener noreferrer">asm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> -</li> <li><a href="https://github.com/jboss-javassist/javassist" target="_blank" rel="noopener noreferrer">javassist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - Javassist çš„æ˜¯é€šè¿‡æ§åˆ¶åº•å±‚å­—èŠ‚ç æ¥å®ç°åŠ¨æ€ä»£ç†ï¼Œä¸éœ€è¦åå°„å®Œæˆè°ƒç”¨ï¼Œæ‰€ä»¥æ€§èƒ½è‚¯å®šæ¯” JDK çš„åŠ¨æ€ä»£ç†æ–¹å¼æ€§èƒ½è¦å¥½ã€‚</li> <li><a href="https://github.com/raphw/byte-buddy" target="_blank" rel="noopener noreferrer">Byte Buddy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - Byte Buddy åˆ™å±äºåèµ·ä¹‹ç§€ï¼Œåœ¨å¾ˆå¤šä¼˜ç§€çš„é¡¹ç›®ä¸­ï¼Œåƒ Springã€Jackson éƒ½ç”¨åˆ°äº† Byte Buddy æ¥å®Œæˆåº•å±‚ä»£ç†ã€‚ç›¸æ¯” Javassistï¼ŒByte Buddy æä¾›äº†æ›´å®¹æ˜“æ“ä½œçš„ APIï¼Œç¼–å†™çš„ä»£ç å¯è¯»æ€§æ›´é«˜ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç”Ÿæˆçš„ä»£ç†ç±»æ‰§è¡Œé€Ÿåº¦æ¯” Javassist æ›´å¿«ã€‚</li></ul> <h3 id="asm"><a href="#asm" class="header-anchor">#</a> Asm</h3> <p>å¯¹äºéœ€è¦æ‰‹åŠ¨æ“çºµå­—èŠ‚ç çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ Asmï¼Œå®ƒå¯ä»¥ç›´æ¥ç”Ÿäº§ <code>.class</code>å­—èŠ‚ç æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ JVM ä¹‹å‰åŠ¨æ€ä¿®æ”¹ç±»è¡Œä¸ºã€‚</p> <p>Asm çš„åº”ç”¨åœºæ™¯æœ‰ AOPï¼ˆCglib å°±æ˜¯åŸºäº Asmï¼‰ã€çƒ­éƒ¨ç½²ã€ä¿®æ”¹å…¶ä»– jar åŒ…ä¸­çš„ç±»ç­‰ã€‚å½“ç„¶ï¼Œæ¶‰åŠåˆ°å¦‚æ­¤åº•å±‚çš„æ­¥éª¤ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚</p> <p>Asm æœ‰ä¸¤ç±» APIï¼šæ ¸å¿ƒ API å’Œæ ‘å½¢ API</p> <ul><li><strong>æ ¸å¿ƒ API</strong> - Asm Core API å¯ä»¥ç±»æ¯”è§£æ XML æ–‡ä»¶ä¸­çš„ SAX æ–¹å¼ï¼Œä¸éœ€è¦æŠŠè¿™ä¸ªç±»çš„æ•´ä¸ªç»“æ„è¯»å–è¿›æ¥ï¼Œå°±å¯ä»¥ç”¨æµå¼çš„æ–¹æ³•æ¥å¤„ç†å­—èŠ‚ç æ–‡ä»¶ã€‚å¥½å¤„æ˜¯éå¸¸èŠ‚çº¦å†…å­˜ï¼Œä½†æ˜¯ç¼–ç¨‹éš¾åº¦è¾ƒå¤§ã€‚ç„¶è€Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç¼–ç¨‹éƒ½ä½¿ç”¨ Core APIã€‚åœ¨ Core API ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®ç±»ï¼š
<ul><li><strong><code>ClassReader</code></strong> - ç”¨äºè¯»å–å·²ç»ç¼–è¯‘å¥½çš„ .class æ–‡ä»¶ã€‚</li> <li><strong><code>ClassWriter</code></strong> - ç”¨äºé‡æ–°æ„å»ºç¼–è¯‘åçš„ç±»ï¼Œå¦‚ä¿®æ”¹ç±»åã€å±æ€§ä»¥åŠæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆæ–°çš„ç±»çš„å­—èŠ‚ç æ–‡ä»¶ã€‚</li> <li>å„ç§ <strong><code>Visitor</code></strong> ç±» - CoreAPI æ ¹æ®å­—èŠ‚ç ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡å¤„ç†ï¼Œå¯¹äºå­—èŠ‚ç æ–‡ä»¶ä¸­ä¸åŒçš„åŒºåŸŸæœ‰ä¸åŒçš„ Visitorï¼Œæ¯”å¦‚ç”¨äºè®¿é—®æ–¹æ³•çš„ MethodVisitorã€ç”¨äºè®¿é—®ç±»å˜é‡çš„ FieldVisitorã€ç”¨äºè®¿é—®æ³¨è§£çš„ AnnotationVisitor ç­‰ã€‚ä¸ºäº†å®ç° AOPï¼Œé‡ç‚¹è¦ä½¿ç”¨çš„æ˜¯ MethodVisitorã€‚</li></ul></li> <li><strong>æ ‘å½¢ API</strong> - Asm Tree API å¯ä»¥ç±»æ¯”è§£æ XML æ–‡ä»¶ä¸­çš„ DOM æ–¹å¼ï¼ŒæŠŠæ•´ä¸ªç±»çš„ç»“æ„è¯»å–åˆ°å†…å­˜ä¸­ï¼Œç¼ºç‚¹æ˜¯æ¶ˆè€—å†…å­˜å¤šï¼Œä½†æ˜¯ç¼–ç¨‹æ¯”è¾ƒç®€å•ã€‚TreeApi ä¸åŒäº CoreAPIï¼ŒTreeAPI é€šè¿‡å„ç§ Node ç±»æ¥æ˜ å°„å­—èŠ‚ç çš„å„ä¸ªåŒºåŸŸï¼Œç±»æ¯” DOM èŠ‚ç‚¹ï¼Œå°±å¯ä»¥å¾ˆå¥½åœ°ç†è§£è¿™ç§ç¼–ç¨‹æ–¹å¼ã€‚</li></ul> <h3 id="javassist"><a href="#javassist" class="header-anchor">#</a> Javassist</h3> <p>åˆ©ç”¨ Javassist å®ç°å­—èŠ‚ç å¢å¼ºæ—¶ï¼Œå¯ä»¥æ— é¡»å…³æ³¨å­—èŠ‚ç åˆ»æ¿çš„ç»“æ„ï¼Œå…¶ä¼˜ç‚¹å°±åœ¨äºç¼–ç¨‹ç®€å•ã€‚ç›´æ¥ä½¿ç”¨ java ç¼–ç çš„å½¢å¼ï¼Œè€Œä¸éœ€è¦äº†è§£è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œå°±èƒ½åŠ¨æ€æ”¹å˜ç±»çš„ç»“æ„æˆ–è€…åŠ¨æ€ç”Ÿæˆç±»ã€‚</p> <p>å…¶æ ¸å¿ƒç±»å¦‚ä¸‹ï¼š</p> <ul><li><code>CtClassï¼ˆcompile-time classï¼‰</code> - ç¼–è¯‘æ—¶ç±»ä¿¡æ¯ã€‚å®ƒæ˜¯ä¸€ä¸ª <code>class</code> æ–‡ä»¶åœ¨ä»£ç ä¸­çš„æŠ½è±¡ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–ä¸€ä¸ª <code>CtClass</code> å¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºè¿™ä¸ªç±»æ–‡ä»¶ã€‚</li> <li><code>ClassPool</code> - <code>ClassPool</code> å¯ä»¥çœ‹æˆä¸€å¼ ä¿å­˜ <code>CtClass</code> ä¿¡æ¯çš„ HashTableï¼Œkey ä¸ºç±»åï¼Œvalue ä¸ºç±»åå¯¹åº”çš„ <code>CtClass</code> å¯¹è±¡ã€‚å½“æˆ‘ä»¬éœ€è¦å¯¹æŸä¸ªç±»è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå°±æ˜¯é€šè¿‡ <code>pool.getCtClass(&quot;className&quot;)</code> æ–¹æ³•ä» pool ä¸­è·å–åˆ°ç›¸åº”çš„ <code>CtClass</code>ã€‚</li> <li><code>CtMethod</code>ã€<code>CtField</code> - å¯¹åº”çš„æ˜¯ç±»ä¸­çš„æ–¹æ³•å’Œå±æ€§ã€‚</li></ul> <h2 id="è¿è¡Œæ—¶ç±»çš„é‡è½½"><a href="#è¿è¡Œæ—¶ç±»çš„é‡è½½" class="header-anchor">#</a> è¿è¡Œæ—¶ç±»çš„é‡è½½</h2> <h3 id="instrument"><a href="#instrument" class="header-anchor">#</a> Instrument</h3> <p>instrument æ˜¯ JVM æä¾›çš„ä¸€ä¸ªå¯ä»¥ä¿®æ”¹å·²åŠ è½½ç±»çš„ç±»åº“ï¼Œä¸“é—¨ä¸º Java è¯­è¨€ç¼–å†™çš„æ’æ¡©æœåŠ¡æä¾›æ”¯æŒã€‚å®ƒéœ€è¦ä¾èµ– JVMTI çš„ Attach API æœºåˆ¶å®ç°ã€‚åœ¨ JDK 1.6 ä»¥å‰ï¼Œinstrument åªèƒ½åœ¨ JVM åˆšå¯åŠ¨å¼€å§‹åŠ è½½ç±»æ—¶ç”Ÿæ•ˆï¼Œè€Œåœ¨ JDK 1.6 ä¹‹åï¼Œinstrument æ”¯æŒäº†åœ¨è¿è¡Œæ—¶å¯¹ç±»å®šä¹‰çš„ä¿®æ”¹ã€‚è¦ä½¿ç”¨ instrument çš„ç±»ä¿®æ”¹åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å®ƒæä¾›çš„ ClassFileTransformer æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ªç±»æ–‡ä»¶è½¬æ¢å™¨ã€‚æ¥å£ä¸­çš„ transform()æ–¹æ³•ä¼šåœ¨ç±»æ–‡ä»¶è¢«åŠ è½½æ—¶è°ƒç”¨ï¼Œè€Œåœ¨ transform æ–¹æ³•é‡Œï¼Œå¯ä»¥åˆ©ç”¨ ASM æˆ– Javassist å¯¹ä¼ å…¥çš„å­—èŠ‚ç è¿›è¡Œæ”¹å†™æˆ–æ›¿æ¢ï¼Œç”Ÿæˆæ–°çš„å­—èŠ‚ç æ•°ç»„åè¿”å›ã€‚</p> <h2 id="javaagent"><a href="#javaagent" class="header-anchor">#</a> JavaAgent</h2> <p>Javaagent æ˜¯ä»€ä¹ˆï¼Ÿ</p> <p>Javaagent æ˜¯ java å‘½ä»¤çš„ä¸€ä¸ªå‚æ•°ã€‚å‚æ•° javaagent å¯ä»¥ç”¨äºæŒ‡å®šä¸€ä¸ª jar åŒ…ï¼Œå®ƒåˆ©ç”¨ JVM æä¾›çš„ Instrumentation API æ¥æ›´æ”¹åŠ è½½ JVM ä¸­çš„ç°æœ‰å­—èŠ‚ç ã€‚</p> <ol><li>è¿™ä¸ª jar åŒ…çš„ MANIFEST.MF æ–‡ä»¶å¿…é¡»æŒ‡å®š Premain-Class é¡¹ã€‚</li> <li>Premain-Class æŒ‡å®šçš„é‚£ä¸ªç±»å¿…é¡»å®ç° premain() æ–¹æ³•ã€‚</li></ol> <p>premain æ–¹æ³•ï¼Œä»å­—é¢ä¸Šç†è§£ï¼Œå°±æ˜¯è¿è¡Œåœ¨ main å‡½æ•°ä¹‹å‰çš„çš„ç±»ã€‚å½“ Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œåœ¨æ‰§è¡Œ main å‡½æ•°ä¹‹å‰ï¼ŒJVM ä¼šå…ˆè¿è¡Œ<code>-javaagent</code>æ‰€æŒ‡å®š jar åŒ…å†… Premain-Class è¿™ä¸ªç±»çš„ premain æ–¹æ³• ã€‚</p> <p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ <code>java</code>å¯ä»¥çœ‹åˆ°ç›¸åº”çš„å‚æ•°ï¼Œå…¶ä¸­æœ‰ å’Œ java agent ç›¸å…³çš„ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-agentlib:<span class="token operator">&lt;</span>libname<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>é€‰é¡¹<span class="token operator">&gt;</span><span class="token punctuation">]</span>
			  åŠ è½½æœ¬æœºä»£ç†åº“ <span class="token operator">&lt;</span>libname<span class="token operator">&gt;</span>, ä¾‹å¦‚ <span class="token parameter variable">-agentlib:hprof</span>
			  å¦è¯·å‚é˜… <span class="token parameter variable">-agentlib:jdwp</span><span class="token operator">=</span>help å’Œ <span class="token parameter variable">-agentlib:hprof</span><span class="token operator">=</span>help
-agentpath:<span class="token operator">&lt;</span>pathname<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>é€‰é¡¹<span class="token operator">&gt;</span><span class="token punctuation">]</span>
			  æŒ‰å®Œæ•´è·¯å¾„ååŠ è½½æœ¬æœºä»£ç†åº“
-javaagent:<span class="token operator">&lt;</span>jarpath<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>é€‰é¡¹<span class="token operator">&gt;</span><span class="token punctuation">]</span>
			  åŠ è½½ Java ç¼–ç¨‹è¯­è¨€ä»£ç†, è¯·å‚é˜… java.lang.instrument
</code></pre></div><h3 id="java-agent-æŠ€æœ¯ç®€ä»‹"><a href="#java-agent-æŠ€æœ¯ç®€ä»‹" class="header-anchor">#</a> Java Agent æŠ€æœ¯ç®€ä»‹</h3> <p>Java Agent ç›´è¯‘ä¸º Java ä»£ç†ï¼Œä¹Ÿå¸¸å¸¸è¢«ç§°ä¸º Java æ¢é’ˆæŠ€æœ¯ã€‚</p> <p>Java Agent æ˜¯åœ¨ JDK1.5 å¼•å…¥çš„ï¼Œæ˜¯ä¸€ç§å¯ä»¥åŠ¨æ€ä¿®æ”¹ Java å­—èŠ‚ç çš„æŠ€æœ¯ã€‚Java ä¸­çš„ç±»ç¼–è¯‘åå½¢æˆå­—èŠ‚ç è¢« JVM æ‰§è¡Œï¼Œåœ¨ JVM åœ¨æ‰§è¡Œè¿™äº›å­—èŠ‚ç ä¹‹å‰è·å–è¿™äº›å­—èŠ‚ç çš„ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡å­—èŠ‚ç è½¬æ¢å™¨å¯¹è¿™äº›å­—èŠ‚ç è¿›è¡Œä¿®æ”¹ï¼Œä»¥æ­¤æ¥å®Œæˆä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚</p> <p>Java Agent æ˜¯ä¸€ä¸ªä¸èƒ½ç‹¬ç«‹è¿è¡Œ jar åŒ…ï¼Œå®ƒé€šè¿‡ä¾é™„äºç›®æ ‡ç¨‹åºçš„ JVM è¿›ç¨‹ï¼Œè¿›è¡Œå·¥ä½œã€‚å¯åŠ¨æ—¶åªéœ€è¦åœ¨ç›®æ ‡ç¨‹åºçš„å¯åŠ¨å‚æ•°ä¸­æ·»åŠ -javaagent å‚æ•°æ·»åŠ  ClassFileTransformer å­—èŠ‚ç è½¬æ¢å™¨ï¼Œç›¸å½“äºåœ¨ main æ–¹æ³•å‰åŠ äº†ä¸€ä¸ªæ‹¦æˆªå™¨ã€‚</p> <h3 id="java-agent-åŠŸèƒ½ä»‹ç»"><a href="#java-agent-åŠŸèƒ½ä»‹ç»" class="header-anchor">#</a> Java Agent åŠŸèƒ½ä»‹ç»</h3> <p>Java Agent ä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½</p> <ul><li>Java Agent èƒ½å¤Ÿåœ¨åŠ è½½ Java å­—èŠ‚ç ä¹‹å‰æ‹¦æˆªå¹¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹;</li> <li>Java Agent èƒ½å¤Ÿåœ¨ Jvm è¿è¡ŒæœŸé—´ä¿®æ”¹å·²ç»åŠ è½½çš„å­—èŠ‚ç ;</li></ul> <p>Java Agent çš„åº”ç”¨åœºæ™¯</p> <ul><li>IDE çš„è°ƒè¯•åŠŸèƒ½ï¼Œä¾‹å¦‚ Eclipseã€IntelliJ IDEA ï¼›</li> <li>çƒ­éƒ¨ç½²åŠŸèƒ½ï¼Œä¾‹å¦‚ JRebelã€XRebelã€spring-loadedï¼›</li> <li>å„ç§çº¿ä¸Šè¯Šæ–­å·¥å…·ï¼Œä¾‹å¦‚ Btraceã€Greysï¼Œè¿˜æœ‰é˜¿é‡Œçš„ Arthasï¼›</li> <li>å„ç§æ€§èƒ½åˆ†æå·¥å…·ï¼Œä¾‹å¦‚ Visual VMã€JConsole ç­‰ï¼›</li> <li>å…¨é“¾è·¯æ€§èƒ½æ£€æµ‹å·¥å…·ï¼Œä¾‹å¦‚ Skywalkingã€Pinpoint ç­‰ï¼›</li></ul> <h3 id="java-agent-å®ç°åŸç†"><a href="#java-agent-å®ç°åŸç†" class="header-anchor">#</a> Java Agent å®ç°åŸç†</h3> <p>åœ¨äº†è§£ Java Agent çš„å®ç°åŸç†ä¹‹å‰ï¼Œéœ€è¦å¯¹ Java ç±»åŠ è½½æœºåˆ¶æœ‰ä¸€ä¸ªè¾ƒä¸ºæ¸…æ™°çš„è®¤çŸ¥ã€‚ä¸€ç§æ˜¯åœ¨ man æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œé€šè¿‡ premain æ¥æ‰§è¡Œï¼Œå¦ä¸€ç§æ˜¯ç¨‹åºè¿è¡Œä¸­ä¿®æ”¹ï¼Œéœ€é€šè¿‡ JVM ä¸­çš„ Attach å®ç°ï¼ŒAttach çš„å®ç°åŸç†æ˜¯åŸºäº JVMTIã€‚</p> <p>ä¸»è¦æ˜¯åœ¨ç±»åŠ è½½ä¹‹å‰ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œå¯¹å­—èŠ‚ç ä¿®æ”¹</p> <p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™äº›å…³é”®æœ¯è¯­ï¼š</p> <ul><li><p><strong>JVMTI</strong> å°±æ˜¯ JVM Tool Interfaceï¼Œæ˜¯ JVM æš´éœ²å‡ºæ¥ç»™ç”¨æˆ·æ‰©å±•ä½¿ç”¨çš„æ¥å£é›†åˆï¼ŒJVMTI æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼ŒJVM æ¯æ‰§è¡Œä¸€å®šçš„é€»è¾‘å°±ä¼šè§¦å‘ä¸€äº›äº‹ä»¶çš„å›è°ƒæ¥å£ï¼Œé€šè¿‡è¿™äº›å›è°ƒæ¥å£ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œæ‰©å±•</p> <p>JVMTI æ˜¯å®ç° Debuggerã€Profilerã€Monitorã€Thread Analyser ç­‰å·¥å…·çš„ç»Ÿä¸€åŸºç¡€ï¼Œåœ¨ä¸»æµ Java è™šæ‹Ÿæœºä¸­éƒ½æœ‰å®ç°</p></li> <li><p><strong>JVMTIAgent</strong>æ˜¯ä¸€ä¸ªåŠ¨æ€åº“ï¼Œåˆ©ç”¨ JVMTI æš´éœ²å‡ºæ¥çš„ä¸€äº›æ¥å£æ¥å¹²ä¸€äº›æˆ‘ä»¬æƒ³åšã€ä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹åˆåšä¸åˆ°çš„äº‹æƒ…ï¼Œä¸è¿‡ä¸ºäº†å’Œæ™®é€šçš„åŠ¨æ€åº“è¿›è¡ŒåŒºåˆ†ï¼Œå®ƒä¸€èˆ¬ä¼šå®ç°å¦‚ä¸‹çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‡½æ•°ï¼š</p> <ul><li>Agent_OnLoad å‡½æ•°ï¼Œå¦‚æœ agent æ˜¯åœ¨å¯åŠ¨æ—¶åŠ è½½çš„ï¼Œé€šè¿‡ JVM å‚æ•°è®¾ç½®</li> <li>Agent_OnAttach å‡½æ•°ï¼Œå¦‚æœ agent ä¸æ˜¯åœ¨å¯åŠ¨æ—¶åŠ è½½çš„ï¼Œè€Œæ˜¯æˆ‘ä»¬å…ˆ attach åˆ°ç›®æ ‡è¿›ç¨‹ä¸Šï¼Œç„¶åç»™å¯¹åº”çš„ç›®æ ‡è¿›ç¨‹å‘é€ load å‘½ä»¤æ¥åŠ è½½ï¼Œåˆ™åœ¨åŠ è½½è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ Agent_OnAttach å‡½æ•°</li> <li>Agent_OnUnload å‡½æ•°ï¼Œåœ¨ agent å¸è½½æ—¶è°ƒç”¨</li></ul></li> <li><p><strong>javaagent</strong> ä¾èµ–äº instrument çš„ JVMTIAgentï¼ˆLinux ä¸‹å¯¹åº”çš„åŠ¨æ€åº“æ˜¯ libinstrument.soï¼‰ï¼Œè¿˜æœ‰ä¸ªåˆ«åå« JPLISAgent(Java Programming Language Instrumentation Services Agent)ï¼Œä¸“é—¨ä¸º Java è¯­è¨€ç¼–å†™çš„æ’æ¡©æœåŠ¡æä¾›æ”¯æŒçš„</p></li> <li><p><strong>instrument</strong> å®ç°äº† Agent_OnLoad å’Œ Agent_OnAttach ä¸¤æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä½¿ç”¨æ—¶ï¼Œagent æ—¢å¯ä»¥åœ¨å¯åŠ¨æ—¶åŠ è½½ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ã€‚å…¶ä¸­å¯åŠ¨æ—¶åŠ è½½è¿˜å¯ä»¥é€šè¿‡ç±»ä¼¼-javaagent:jar åŒ…è·¯å¾„çš„æ–¹å¼æ¥é—´æ¥åŠ è½½ instrument agentï¼Œè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ä¾èµ–çš„æ˜¯ JVM çš„ attach æœºåˆ¶ï¼Œé€šè¿‡å‘é€ load å‘½ä»¤æ¥åŠ è½½ agent</p></li> <li><p><strong>JVM Attach</strong> æ˜¯æŒ‡ JVM æä¾›çš„ä¸€ç§è¿›ç¨‹é—´é€šä¿¡çš„åŠŸèƒ½ï¼Œèƒ½è®©ä¸€ä¸ªè¿›ç¨‹ä¼ å‘½ä»¤ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶è¿›è¡Œä¸€äº›å†…éƒ¨çš„æ“ä½œï¼Œæ¯”å¦‚è¿›è¡Œçº¿ç¨‹ dumpï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰§è¡Œ jstack è¿›è¡Œï¼Œç„¶åæŠŠ pid ç­‰å‚æ•°ä¼ é€’ç»™éœ€è¦ dump çš„çº¿ç¨‹æ¥æ‰§è¡Œ</p></li></ul> <h3 id="java-agent-æ¡ˆä¾‹"><a href="#java-agent-æ¡ˆä¾‹" class="header-anchor">#</a> Java Agent æ¡ˆä¾‹</h3> <h4 id="åŠ è½½-java-å­—èŠ‚ç ä¹‹å‰æ‹¦æˆª"><a href="#åŠ è½½-java-å­—èŠ‚ç ä¹‹å‰æ‹¦æˆª" class="header-anchor">#</a> åŠ è½½ Java å­—èŠ‚ç ä¹‹å‰æ‹¦æˆª</h4> <h5 id="app-é¡¹ç›®"><a href="#app-é¡¹ç›®" class="header-anchor">#</a> App é¡¹ç›®</h5> <p>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªåä¸º <code>javacore-javaagent-app</code> çš„ maven å·¥ç¨‹</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.dunwu.javacore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javacore-javaagent-app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>JavaCore :: JavaAgent :: App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªåº”ç”¨å¯åŠ¨ç±»</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppMain</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;APP å¯åŠ¨ï¼ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AppInit</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ï¼ˆ3ï¼‰åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿåº”ç”¨åˆå§‹åŒ–çš„ç±»</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppInit</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;APPåˆå§‹åŒ–ä¸­...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ï¼ˆ4ï¼‰è¾“å‡º</p> <div class="language- extra-class"><pre class="language-text"><code>APP å¯åŠ¨ï¼ï¼ï¼
APPåˆå§‹åŒ–ä¸­...
</code></pre></div><h5 id="agent-é¡¹ç›®"><a href="#agent-é¡¹ç›®" class="header-anchor">#</a> Agent é¡¹ç›®</h5> <p>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªåä¸º <code>javacore-javaagent-agent</code> çš„ maven å·¥ç¨‹</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>javacore<span class="token operator">-</span>javaagent<span class="token operator">-</span>agent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span><span class="token class-name">JavaCore</span> <span class="token operator">::</span> <span class="token class-name">JavaAgent</span> <span class="token operator">::</span> <span class="token class-name">Agent</span><span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>properties<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>project<span class="token punctuation">.</span>build<span class="token punctuation">.</span>sourceEncoding<span class="token punctuation">&gt;</span></span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token punctuation">.</span>build<span class="token punctuation">.</span>sourceEncoding<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>java<span class="token punctuation">.</span>version<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token punctuation">&gt;</span></span>$<span class="token punctuation">{</span>java<span class="token punctuation">.</span>version<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token punctuation">&gt;</span></span>$<span class="token punctuation">{</span>java<span class="token punctuation">.</span>version<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>javaagent å·¥å…·åŒ…<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>javassist<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>javassist<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.26</span><span class="token number">.0</span><span class="token operator">-</span><span class="token constant">GA</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>

  <span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.5</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>æŒ‡å®š maven ç¼–è¯‘çš„ jdk ç‰ˆæœ¬ã€‚è‹¥ä¸æŒ‡å®šï¼Œmaven3 é»˜è®¤ç”¨ jdk <span class="token number">1.5</span>ï¼›maven2 é»˜è®¤ç”¨ jdk1<span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
          <span class="token generics"><span class="token punctuation">&lt;</span>source<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
          <span class="token generics"><span class="token punctuation">&lt;</span>target<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>target<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>

      <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>jar<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">3.2</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
          <span class="token generics"><span class="token punctuation">&lt;</span>archive<span class="token punctuation">&gt;</span></span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>è‡ªåŠ¨æ·»åŠ <span class="token constant">META</span><span class="token operator">-</span><span class="token constant">INF</span><span class="token operator">/</span><span class="token constant">MANIFEST</span><span class="token punctuation">.</span><span class="token constant">MF</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>manifest<span class="token punctuation">&gt;</span></span>
              <span class="token generics"><span class="token punctuation">&lt;</span>addClasspath<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>addClasspath<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>manifest<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>manifestEntries<span class="token punctuation">&gt;</span></span>
              <span class="token operator">&lt;</span><span class="token class-name">Menifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Menifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token class-name">Premain</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">&gt;</span><span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>javaagent<span class="token punctuation">.</span></span>RunTimeAgent</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Premain</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Redefine</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Redefine</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Retransform</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Can</span><span class="token operator">-</span><span class="token class-name">Retransform</span><span class="token operator">-</span><span class="token class-name">Classes</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>manifestEntries<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>archive<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre></div><p>ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ª Agent å¯åŠ¨ç±»</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunTimeAgent</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">premain</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> instrumentation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¢é’ˆå¯åŠ¨ï¼ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¢é’ˆä¼ å…¥å‚æ•°ï¼š&quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrumentation<span class="token punctuation">.</span><span class="token function">addTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunTimeTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œæ¯ä¸ªç±»åŠ è½½çš„æ—¶å€™éƒ½ä¼šèµ°è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ className è¿›è¡ŒæŒ‡å®šç±»çš„æ‹¦æˆªï¼Œç„¶åå€ŸåŠ© javassist è¿™ä¸ªå·¥å…·ï¼Œè¿›è¡Œå¯¹ Class çš„å¤„ç†ï¼Œè¿™é‡Œçš„æ€æƒ³å’Œåå°„ç±»ä¼¼ï¼Œä½†æ˜¯è¦æ¯”åå°„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç ã€‚</p> <p>ï¼ˆ3ï¼‰ä½¿ç”¨ javassist æ‹¦æˆªæŒ‡å®šç±»ï¼Œå¹¶è¿›è¡Œä»£ç å¢å¼º</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>javaagent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">ClassPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtMethod</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">ClassFileTransformer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">IllegalClassFormatException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">ProtectionDomain</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunTimeTransformer</span> <span class="token keyword">implements</span> <span class="token class-name">ClassFileTransformer</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">INJECTED_CLASS</span> <span class="token operator">=</span> <span class="token string">&quot;io.github.dunwu.javacore.javaagent.AppInit&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span> <span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> classBeingRedefined<span class="token punctuation">,</span>
        <span class="token class-name">ProtectionDomain</span> protectionDomain<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classfileBuffer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalClassFormatException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> realClassName <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>realClassName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token constant">INJECTED_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‹¦æˆªåˆ°çš„ç±»åï¼š&quot;</span> <span class="token operator">+</span> realClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CtClass</span> ctClass<span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// ä½¿ç”¨javassist,è·å–å­—èŠ‚ç ç±»</span>
                <span class="token class-name">ClassPool</span> classPool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>realClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// å¾—åˆ°è¯¥ç±»æ‰€æœ‰çš„æ–¹æ³•å®ä¾‹ï¼Œä¹Ÿå¯é€‰æ‹©æ–¹æ³•ï¼Œè¿›è¡Œå¢å¼º</span>
                <span class="token class-name">CtMethod</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredMethods <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CtMethod</span> method <span class="token operator">:</span> declaredMethods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ–¹æ³•è¢«æ‹¦æˆª&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">addLocalVariable</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CtClass</span><span class="token punctuation">.</span>longType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token string">&quot;System.out.println(\&quot;---å¼€å§‹æ‰§è¡Œ---\&quot;);&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token string">&quot;time = System.currentTimeMillis();&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span><span class="token string">&quot;System.out.println(\&quot;---ç»“æŸæ‰§è¡Œ---\&quot;);&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    method<span class="token punctuation">.</span><span class="token function">insertAfter</span><span class="token punctuation">(</span><span class="token string">&quot;System.out.println(\&quot;è¿è¡Œè€—æ—¶: \&quot; + (System.currentTimeMillis() - time));&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//è¿™é‡Œè¦ç”¨Throwableï¼Œä¸è¦ç”¨Exception</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> classfileBuffer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ï¼ˆ4ï¼‰è¾“å‡º</p> <p>æŒ‡å®š VM å‚æ•° -javaagent:F:\code\myCode\agent-test\runtime-agent\target\runtime-agent-1.0-SNAPSHOT.jar=helloï¼Œè¿è¡Œ AppMain</p> <div class="language- extra-class"><pre class="language-text"><code>æ¢é’ˆå¯åŠ¨ï¼ï¼ï¼
æ¢é’ˆä¼ å…¥å‚æ•°ï¼šhello
APP å¯åŠ¨ï¼ï¼ï¼
æ‹¦æˆªåˆ°çš„ç±»åï¼šio.github.dunwu.javacore.javaagent.AppInit
initæ–¹æ³•è¢«æ‹¦æˆª
---å¼€å§‹æ‰§è¡Œ---
APPåˆå§‹åŒ–ä¸­...
---ç»“æŸæ‰§è¡Œ---
è¿è¡Œè€—æ—¶: 1014
</code></pre></div><h4 id="è¿è¡Œæ—¶æ‹¦æˆª-jdk-1-6-åŠä»¥ä¸Š"><a href="#è¿è¡Œæ—¶æ‹¦æˆª-jdk-1-6-åŠä»¥ä¸Š" class="header-anchor">#</a> è¿è¡Œæ—¶æ‹¦æˆªï¼ˆJDK 1.6 åŠä»¥ä¸Šï¼‰</h4> <p>å¦‚ä½•å®ç°åœ¨ç¨‹åºè¿è¡Œæ—¶å»å®ŒæˆåŠ¨æ€ä¿®æ”¹å­—èŠ‚ç å‘¢ï¼Ÿ</p> <p>åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç éœ€è¦ä¾èµ–äº JDK ä¸ºæˆ‘ä»¬æä¾›çš„ JVM å·¥å…·ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¾¹æˆ‘ä»¬æåˆ°çš„ Attachï¼Œé€šè¿‡å®ƒå»åŠ è½½æˆ‘ä»¬çš„ä»£ç†ç¨‹åºã€‚</p> <p>é¦–å…ˆæˆ‘ä»¬åœ¨ä»£ç†ç¨‹åºä¸­éœ€è¦å®šä¹‰ä¸€ä¸ªåå­—ä¸º agentmain çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å’Œä¸Šè¾¹æˆ‘ä»¬æåˆ°çš„ premain æ˜¯ä¸€æ ·çš„å†…å®¹ï¼Œä¹Ÿå¯æ ¹æ® agentmain çš„ç‰¹æ€§è¿›è¡Œè‡ªå·±é€»è¾‘çš„å¼€å‘ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * agentmain åœ¨ main å‡½æ•°å¼€å§‹è¿è¡Œåæ‰å¯åŠ¨ï¼ˆä¾èµ–äºAttachæœºåˆ¶ï¼‰
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunTimeAgent</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">agentmain</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> instrumentation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;agentmainæ¢é’ˆå¯åŠ¨ï¼ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;agentmainæ¢é’ˆä¼ å…¥å‚æ•°ï¼š&quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        instrumentation<span class="token punctuation">.</span><span class="token function">addTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunTimeTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç„¶åå°±æ˜¯æˆ‘ä»¬éœ€è¦å°†é…ç½®ä¸­è®¾ç½®ï¼Œè®©å…¶çŸ¥é“æˆ‘ä»¬çš„æ¢é’ˆéœ€è¦åŠ è½½è¿™ä¸ªç±»ï¼Œåœ¨ maven ä¸­è®¾ç½®å¦‚ä¸‹ï¼Œå¦‚æœæ˜¯ META-INF/MANIFEST.MF æ–‡ä»¶åŒç†ã€‚</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--&lt;Premain-Class&gt;com.zhj.agent.agentmain.RunTimeAgent&lt;/Premain-Class&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Agent-Class</span><span class="token punctuation">&gt;</span></span>com.zhj.agent.agentmain.RunTimeAgent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Agent-Class</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>è¿™æ ·å…¶å®æˆ‘ä»¬çš„æ¢é’ˆå°±å·²ç»æ”¹é€ å¥½äº†ï¼Œç„¶åæˆ‘ä»¬éœ€è¦åœ¨ç›®æ ‡ç¨‹åºçš„ main æ–¹æ³•ä¸­æ¤å…¥ä¸€äº›ä»£ç ï¼Œä½¿å…¶å¯ä»¥è¯»å–åˆ°æˆ‘ä»¬çš„ä»£ç†ç¨‹åºï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿæ— éœ€å»é…ç½® JVM çš„å‚æ•°ï¼Œå°±å¯ä»¥åŠ è½½æ¢é’ˆç¨‹åºã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">APPMain</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;APP å¯åŠ¨ï¼ï¼ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">VirtualMachineDescriptor</span> vmd <span class="token operator">:</span> <span class="token class-name">VirtualMachine</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŒ‡å®šçš„VMæ‰å¯ä»¥è¢«ä»£ç†</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯¥VMä¸ºæŒ‡å®šä»£ç†çš„VM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>vmd<span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">VirtualMachine</span> vm <span class="token operator">=</span> <span class="token class-name">VirtualMachine</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>vmd<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    vm<span class="token punctuation">.</span><span class="token function">loadAgent</span><span class="token punctuation">(</span><span class="token string">&quot;D:/Code/java/idea_project/agent-test/runtime-agent/target/runtime-agent-1.0-SNAPSHOT.jar=hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    vm<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">AppInit</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å…¶ä¸­ VirtualMachine æ˜¯ JDK å·¥å…·åŒ…ä¸‹çš„ç±»ï¼Œå¦‚æœç³»ç»Ÿç¯å¢ƒå˜é‡æ²¡æœ‰é…ç½®ï¼Œéœ€è¦è‡ªå·±åœ¨ Maven ä¸­å¼•å…¥æœ¬åœ°æ–‡ä»¶ã€‚</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.sun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>system<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>systemPath</span><span class="token punctuation">&gt;</span></span>D:/Software/java_dev/java_jdk/lib/tools.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>systemPath</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>è¿™æ ·æˆ‘ä»¬åœ¨ç¨‹åºå¯åŠ¨åå†å»åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç æ–‡ä»¶çš„ç®€å•æ¡ˆä¾‹å°±å®Œæˆäº†ã€‚</p> <h2 id="å­—èŠ‚ç å·¥å…·"><a href="#å­—èŠ‚ç å·¥å…·" class="header-anchor">#</a> å­—èŠ‚ç å·¥å…·</h2> <ul><li><a href="https://plugins.jetbrains.com/plugin/9248-jclasslib-bytecode-viewer" target="_blank" rel="noopener noreferrer">jclasslib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - IDEA æ’ä»¶ï¼Œå¯ä»¥ç›´è§‚æŸ¥çœ‹å½“å‰å­—èŠ‚ç æ–‡ä»¶çš„ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€æ–¹æ³•åŒºç­‰ä¿¡æ¯ã€‚</li> <li><a href="https://github.com/zxh0/classpy" target="_blank" rel="noopener noreferrer">classpy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - Classpy æ˜¯ä¸€ä¸ªç”¨äºç ”ç©¶ Java ç±»æ–‡ä»¶ã€Lua äºŒè¿›åˆ¶å—ã€Wasm äºŒè¿›åˆ¶ä»£ç å’Œå…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼çš„ GUI å·¥å…·ã€‚</li> <li><a href="https://plugins.jetbrains.com/plugin/5918-asm-bytecode-outline" target="_blank" rel="noopener noreferrer">ASM ByteCode Outline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - åˆ©ç”¨ ASM æ‰‹å†™å­—èŠ‚ç æ—¶ï¼Œéœ€è¦åˆ©ç”¨ä¸€ç³»åˆ— visitXXXXInsn() æ–¹æ³•æ¥å†™å¯¹åº”çš„åŠ©è®°ç¬¦ï¼Œæ‰€ä»¥éœ€è¦å…ˆå°†æ¯ä¸€è¡Œæºä»£ç è½¬åŒ–ä¸ºä¸€ä¸ªä¸ªçš„åŠ©è®°ç¬¦ï¼Œç„¶åé€šè¿‡ ASM çš„è¯­æ³•è½¬æ¢ä¸º visitXXXXInsn() è¿™ç§å†™æ³•ã€‚ç¬¬ä¸€æ­¥å°†æºç è½¬åŒ–ä¸ºåŠ©è®°ç¬¦å°±å·²ç»å¤Ÿéº»çƒ¦äº†ï¼Œä¸ç†Ÿæ‚‰å­—èŠ‚ç æ“ä½œé›†åˆçš„è¯ï¼Œéœ€è¦æˆ‘ä»¬å°†ä»£ç ç¼–è¯‘åå†åç¼–è¯‘ï¼Œæ‰èƒ½å¾—åˆ°æºä»£ç å¯¹åº”çš„åŠ©è®°ç¬¦ã€‚ç¬¬äºŒæ­¥åˆ©ç”¨ ASM å†™å­—èŠ‚ç æ—¶ï¼Œå¦‚ä½•ä¼ å‚ä¹Ÿå¾ˆä»¤äººå¤´ç–¼ã€‚ASM ç¤¾åŒºä¹ŸçŸ¥é“è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æä¾›äº†æ­¤å·¥å…·ã€‚</li></ul> <h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <ul><li><strong>ä¹¦ç±</strong> <ul><li><a href="https://book.douban.com/subject/34907497/" target="_blank" rel="noopener noreferrer">ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>æ–‡ç« </strong> <ul><li><a href="https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html" target="_blank" rel="noopener noreferrer">å­—èŠ‚ç å¢å¼ºæŠ€æœ¯æ¢ç´¢<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844903588716609543" target="_blank" rel="noopener noreferrer">è½»æ¾çœ‹æ‡‚Javaå­—èŠ‚ç <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7086026013498408973" target="_blank" rel="noopener noreferrer">Java Agent æ¢é’ˆæŠ€æœ¯<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>å­—èŠ‚ç æ¡†æ¶
<ul><li><a href="https://asm.ow2.io/" target="_blank" rel="noopener noreferrer">asm å®˜æ–¹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/jboss-javassist/javassist" target="_blank" rel="noopener noreferrer">Javassist Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/raphw/byte-buddy" target="_blank" rel="noopener noreferrer">Byte Buddy Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/javacore/edit/master/docs/01.Java/01.JavaSE/06.JVM/05.JVMå­—èŠ‚ç .md" target="_blank" rel="noopener noreferrer">ğŸ“ å¸®åŠ©æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/javacore/tags/?tag=Java" title="æ ‡ç­¾">#Java</a><a href="/javacore/tags/?tag=JavaSE" title="æ ‡ç­¾">#JavaSE</a><a href="/javacore/tags/?tag=JVM" title="æ ‡ç­¾">#JVM</a><a href="/javacore/tags/?tag=%E5%AD%97%E8%8A%82%E7%A0%81" title="æ ‡ç­¾">#å­—èŠ‚ç </a><a href="/javacore/tags/?tag=javaagent" title="æ ‡ç­¾">#javaagent</a><a href="/javacore/tags/?tag=asm" title="æ ‡ç­¾">#asm</a><a href="/javacore/tags/?tag=javassist" title="æ ‡ç­¾">#javassist</a></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2024/09/13, 06:43:21</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/javacore/pages/17aad9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JVM ç±»åŠ è½½</div></a> <a href="/javacore/pages/c590ae/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JVM å‘½ä»¤è¡Œå·¥å…·</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/javacore/pages/17aad9/" class="prev">JVM ç±»åŠ è½½</a></span> <span class="next"><a href="/javacore/pages/c590ae/">JVM å‘½ä»¤è¡Œå·¥å…·</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/javacore/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/javacore/pages/69d2f8/"><div>
            JavaSE
            <!----></div></a> <span class="date">05-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/javacore/pages/496a7e/"><div>
            æºç çº§æ·±åº¦ç†è§£ Java SPI
            <!----></div></a> <span class="date">04-26</span></dt></dl><dl><dd>03</dd> <dt><a href="/javacore/pages/2950ba/"><div>
            Java åŸºç¡€è¯­æ³•ç‰¹æ€§
            <!----></div></a> <span class="date">01-25</span></dt></dl> <dl><dd></dd> <dt><a href="/javacore/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:forbreak@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/dunwu" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2019-2024
    <span>é’æ‚Ÿï¼ˆdunwuï¼‰ | CC-BY-SA-4.0</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">Ã—</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="261" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 40px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/javacore/assets/js/app.44fc03ae.js" defer></script><script src="/javacore/assets/js/2.aded268b.js" defer></script><script src="/javacore/assets/js/56.e604e971.js" defer></script>
  </body>
</html>
