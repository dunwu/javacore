(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{383:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"æ·±å…¥ç†è§£-java-å¹¶å‘é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ·±å…¥ç†è§£-java-å¹¶å‘é”"}},[t._v("#")]),t._v(" æ·±å…¥ç†è§£ Java å¹¶å‘é”")]),t._v(" "),s("blockquote",[s("p",[t._v("æœ¬æ–‡å…ˆé˜è¿° Java ä¸­å„ç§é”çš„æ¦‚å¿µã€‚")]),t._v(" "),s("p",[t._v("ç„¶åï¼Œä»‹ç»é”çš„æ ¸å¿ƒå®ç° AQSã€‚")]),t._v(" "),s("p",[t._v("ç„¶åï¼Œé‡ç‚¹ä»‹ç» Lock å’Œ Condition ä¸¤ä¸ªæ¥å£åŠå…¶å®ç°ã€‚å¹¶å‘ç¼–ç¨‹æœ‰ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåŒæ­¥å’Œäº’æ–¥ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("äº’æ–¥")]),t._v("ï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼›")]),t._v(" "),s("p",[s("strong",[t._v("åŒæ­¥")]),t._v("ï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œã€‚")]),t._v(" "),s("p",[t._v("è¿™ä¸¤å¤§é—®é¢˜ï¼Œç®¡ç¨‹ï¼ˆ"),s("code",[t._v("sychronized")]),t._v("ï¼‰éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„ã€‚"),s("strong",[t._v("J.U.C åŒ…è¿˜æä¾›äº† Lock å’Œ Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹ï¼Œå…¶ä¸­ Lock ç”¨äºè§£å†³äº’æ–¥é—®é¢˜ï¼ŒCondition ç”¨äºè§£å†³åŒæ­¥é—®é¢˜")]),t._v("ã€‚")])]),t._v(" "),s("h2",{attrs:{id:"å¹¶å‘é”ç®€ä»‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¹¶å‘é”ç®€ä»‹"}},[t._v("#")]),t._v(" å¹¶å‘é”ç®€ä»‹")]),t._v(" "),s("p",[t._v("ç¡®ä¿çº¿ç¨‹å®‰å…¨æœ€å¸¸è§çš„åšæ³•æ˜¯åˆ©ç”¨é”æœºåˆ¶ï¼ˆ"),s("code",[t._v("Lock")]),t._v("ã€"),s("code",[t._v("sychronized")]),t._v("ï¼‰æ¥å¯¹å…±äº«æ•°æ®åšäº’æ–¥åŒæ­¥ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—ï¼Œé‚£ä¹ˆæ“ä½œå¿…ç„¶æ˜¯åŸå­æ€§çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚")]),t._v(" "),s("p",[t._v("åœ¨å·¥ä½œã€é¢è¯•ä¸­ï¼Œç»å¸¸ä¼šå¬åˆ°å„ç§äº”èŠ±å…«é—¨çš„é”ï¼Œå¬çš„äººäº‘é‡Œé›¾é‡Œã€‚é”çš„æ¦‚å¿µæœ¯è¯­å¾ˆå¤šï¼Œå®ƒä»¬æ˜¯é’ˆå¯¹ä¸åŒçš„é—®é¢˜æ‰€æå‡ºçš„ï¼Œé€šè¿‡ç®€å•çš„æ¢³ç†ï¼Œä¹Ÿä¸éš¾ç†è§£ã€‚")]),t._v(" "),s("h3",{attrs:{id:"å¯é‡å…¥é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¯é‡å…¥é”"}},[t._v("#")]),t._v(" å¯é‡å…¥é”")]),t._v(" "),s("p",[s("strong",[t._v("å¯é‡å…¥é”ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”")]),t._v("ã€‚å³åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–äº†é”ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("å¯é‡å…¥é”å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…æ­»é”")]),t._v("ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("ReentrantLock")]),t._v(" ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" æ˜¯å¯é‡å…¥é”")]),t._v("ã€‚è¿™ç‚¹ï¼Œä»å…¶å‘½åä¹Ÿä¸éš¾çœ‹å‡ºã€‚")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("synchronized")]),t._v(" ä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”")]),t._v("ã€‚")])]),t._v(" "),s("p",[t._v("ã€ç¤ºä¾‹ã€‘"),s("code",[t._v("synchronized")]),t._v(" çš„å¯é‡å…¥ç¤ºä¾‹")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªå…¸å‹åœºæ™¯ï¼šå¦‚æœä½¿ç”¨çš„é”ä¸æ˜¯å¯é‡å…¥é”çš„è¯ï¼Œ"),s("code",[t._v("setB")]),t._v(" å¯èƒ½ä¸ä¼šè¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œä»è€Œé€ æˆæ­»é”ã€‚")]),t._v(" "),s("p",[t._v("ã€ç¤ºä¾‹ã€‘"),s("code",[t._v("ReentrantLock")]),t._v(" çš„å¯é‡å…¥ç¤ºä¾‹")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–é”")]),t._v("\n        lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¿è¯é”èƒ½é‡Šæ”¾")]),t._v("\n            lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addOne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–é”")]),t._v("\n        lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ³¨æ„ï¼šæ­¤å¤„å·²ç»æˆåŠŸè·å–é”ï¼Œè¿›å…¥ get æ–¹æ³•åï¼Œåˆå°è¯•è·å–é”ï¼Œ")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœé”ä¸æ˜¯å¯é‡å…¥çš„ï¼Œä¼šå¯¼è‡´æ­»é”")]),t._v("\n            value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¿è¯é”èƒ½é‡Šæ”¾")]),t._v("\n            lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"å…¬å¹³é”ä¸éå…¬å¹³é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…¬å¹³é”ä¸éå…¬å¹³é”"}},[t._v("#")]),t._v(" å…¬å¹³é”ä¸éå…¬å¹³é”")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("å…¬å¹³é”")]),t._v(" - å…¬å¹³é”æ˜¯æŒ‡ "),s("strong",[t._v("å¤šçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”")]),t._v("ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("éå…¬å¹³é”")]),t._v(" - éå…¬å¹³é”æ˜¯æŒ‡ "),s("strong",[t._v("å¤šçº¿ç¨‹ä¸æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”")]),t._v(" ã€‚è¿™å°±å¯èƒ½ä¼šå‡ºç°ä¼˜å…ˆçº§åè½¬ï¼ˆåæ¥è€…å±…ä¸Šï¼‰æˆ–è€…é¥¥é¥¿ç°è±¡ï¼ˆæŸçº¿ç¨‹æ€»æ˜¯æŠ¢ä¸è¿‡åˆ«çš„çº¿ç¨‹ï¼Œå¯¼è‡´å§‹ç»ˆæ— æ³•æ‰§è¡Œï¼‰ã€‚")])]),t._v(" "),s("p",[t._v("å…¬å¹³é”ä¸ºäº†ä¿è¯çº¿ç¨‹ç”³è¯·é¡ºåºï¼ŒåŠ¿å¿…è¦ä»˜å‡ºä¸€å®šçš„æ€§èƒ½ä»£ä»·ï¼Œå› æ­¤å…¶ååé‡ä¸€èˆ¬ä½äºéå…¬å¹³é”ã€‚")]),t._v(" "),s("p",[t._v("å…¬å¹³é”ä¸éå…¬å¹³é” åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("synchronized")]),t._v(" åªæ”¯æŒéå…¬å¹³é”")]),t._v("ã€‚")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("ReentrantLock")]),t._v(" ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v("ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œä½†æ”¯æŒå…¬å¹³é”")]),t._v("ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ç‹¬äº«é”ä¸å…±äº«é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç‹¬äº«é”ä¸å…±äº«é”"}},[t._v("#")]),t._v(" ç‹¬äº«é”ä¸å…±äº«é”")]),t._v(" "),s("p",[t._v("ç‹¬äº«é”ä¸å…±äº«é”æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„è¯´æ³•ï¼Œä»å®é™…ç”¨é€”ä¸Šæ¥çœ‹ï¼Œä¹Ÿå¸¸è¢«ç§°ä¸ºäº’æ–¥é”ä¸è¯»å†™é”ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("ç‹¬äº«é”")]),t._v(" - ç‹¬äº«é”æ˜¯æŒ‡ "),s("strong",[t._v("é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰")]),t._v("ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å…±äº«é”")]),t._v(" - å…±äº«é”æ˜¯æŒ‡ "),s("strong",[t._v("é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰")]),t._v("ã€‚")])]),t._v(" "),s("p",[t._v("ç‹¬äº«é”ä¸å…±äº«é”åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("synchronized")]),t._v(" ã€"),s("code",[t._v("ReentrantLock")]),t._v(" åªæ”¯æŒç‹¬äº«é”")]),t._v("ã€‚")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" å…¶å†™é”æ˜¯ç‹¬äº«é”ï¼Œå…¶è¯»é”æ˜¯å…±äº«é”")]),t._v("ã€‚è¯»é”æ˜¯å…±äº«é”ä½¿å¾—å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œè¯»å†™ï¼Œå†™è¯» ï¼Œå†™å†™çš„è¿‡ç¨‹æ˜¯äº’æ–¥çš„ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"æ‚²è§‚é”ä¸ä¹è§‚é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ‚²è§‚é”ä¸ä¹è§‚é”"}},[t._v("#")]),t._v(" æ‚²è§‚é”ä¸ä¹è§‚é”")]),t._v(" "),s("p",[t._v("ä¹è§‚é”ä¸æ‚²è§‚é”ä¸æ˜¯æŒ‡å…·ä½“çš„ä»€ä¹ˆç±»å‹çš„é”ï¼Œè€Œæ˜¯"),s("strong",[t._v("å¤„ç†å¹¶å‘åŒæ­¥çš„ç­–ç•¥")]),t._v("ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("æ‚²è§‚é”")]),t._v(" - æ‚²è§‚é”å¯¹äºå¹¶å‘é‡‡å–æ‚²è§‚çš„æ€åº¦ï¼Œè®¤ä¸ºï¼š"),s("strong",[t._v("ä¸åŠ é”çš„å¹¶å‘æ“ä½œä¸€å®šä¼šå‡ºé—®é¢˜")]),t._v("ã€‚"),s("strong",[t._v("æ‚²è§‚é”é€‚åˆå†™æ“ä½œé¢‘ç¹çš„åœºæ™¯")]),t._v("ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("ä¹è§‚é”")]),t._v(" - ä¹è§‚é”å¯¹äºå¹¶å‘é‡‡å–ä¹è§‚çš„æ€åº¦ï¼Œè®¤ä¸ºï¼š"),s("strong",[t._v("ä¸åŠ é”çš„å¹¶å‘æ“ä½œä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿä¿®æ”¹çš„")]),t._v("ã€‚åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¼šé‡‡ç”¨ä¸æ–­å°è¯•æ›´æ–°çš„æ–¹å¼æ›´æ–°æ•°æ®ã€‚"),s("strong",[t._v("ä¹è§‚é”é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯")]),t._v("ã€‚")])]),t._v(" "),s("p",[t._v("æ‚²è§‚é”ä¸ä¹è§‚é”åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ‚²è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é€šè¿‡ä½¿ç”¨ "),s("code",[t._v("synchronized")]),t._v(" å’Œ "),s("code",[t._v("Lock")]),t._v(" æ˜¾ç¤ºåŠ é”æ¥è¿›è¡Œäº’æ–¥åŒæ­¥ï¼Œè¿™æ˜¯ä¸€ç§é˜»å¡åŒæ­¥ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä¹è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é‡‡ç”¨ "),s("code",[t._v("CAS")]),t._v(" æœºåˆ¶ï¼ˆ"),s("code",[t._v("CAS")]),t._v(" æ“ä½œé€šè¿‡ "),s("code",[t._v("Unsafe")]),t._v(" ç±»æä¾›ï¼Œä½†è¿™ä¸ªç±»ä¸ç›´æ¥æš´éœ²ä¸º APIï¼Œæ‰€ä»¥éƒ½æ˜¯é—´æ¥ä½¿ç”¨ï¼Œå¦‚å„ç§åŸå­ç±»ï¼‰ã€‚")])])]),t._v(" "),s("h3",{attrs:{id:"åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”"}},[t._v("#")]),t._v(" åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”")]),t._v(" "),s("p",[t._v("æ‰€è°“è½»é‡çº§é”ä¸é‡é‡çº§é”ï¼ŒæŒ‡çš„æ˜¯é”æ§åˆ¶ç²’åº¦çš„ç²—ç»†ã€‚æ˜¾ç„¶ï¼Œæ§åˆ¶ç²’åº¦è¶Šç»†ï¼Œé˜»å¡å¼€é”€è¶Šå°ï¼Œå¹¶å‘æ€§ä¹Ÿå°±è¶Šé«˜ã€‚")]),t._v(" "),s("p",[t._v("Java 1.6 ä»¥å‰ï¼Œé‡é‡çº§é”ä¸€èˆ¬æŒ‡çš„æ˜¯ "),s("code",[t._v("synchronized")]),t._v(" ï¼Œè€Œè½»é‡çº§é”æŒ‡çš„æ˜¯ "),s("code",[t._v("volatile")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("Java 1.6 ä»¥åï¼Œé’ˆå¯¹ "),s("code",[t._v("synchronized")]),t._v(" åšäº†å¤§é‡ä¼˜åŒ–ï¼Œå¼•å…¥ 4 ç§é”çŠ¶æ€ï¼š æ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”å¯ä»¥å•å‘çš„ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†ä»è½»é‡çº§é”å‡çº§åˆ°é‡é‡çº§é” ã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("åå‘é”")]),t._v(" - åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ã€‚é™ä½è·å–é”çš„ä»£ä»·ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("è½»é‡çº§é”")]),t._v(" - æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("é‡é‡çº§é”")]),t._v(" - æ˜¯æŒ‡å½“é”ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚")])])]),t._v(" "),s("h3",{attrs:{id:"åˆ†æ®µé”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†æ®µé”"}},[t._v("#")]),t._v(" åˆ†æ®µé”")]),t._v(" "),s("p",[t._v("åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ã€‚æ‰€è°“åˆ†æ®µé”ï¼Œå°±æ˜¯æŠŠé”çš„å¯¹è±¡åˆ†æˆå¤šæ®µï¼Œæ¯æ®µç‹¬ç«‹æ§åˆ¶ï¼Œä½¿å¾—é”ç²’åº¦æ›´ç»†ï¼Œå‡å°‘é˜»å¡å¼€é”€ï¼Œä»è€Œæé«˜å¹¶å‘æ€§ã€‚è¿™å…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±åƒé«˜é€Ÿå…¬è·¯ä¸Šçš„æ”¶è´¹ç«™ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ”¶è´¹å£ï¼Œé‚£æ‰€æœ‰çš„è½¦åªèƒ½æ’æˆä¸€æ¡é˜Ÿç¼´è´¹ï¼›å¦‚æœæœ‰å¤šä¸ªæ”¶è´¹å£ï¼Œå°±å¯ä»¥åˆ†æµäº†ã€‚")]),t._v(" "),s("p",[s("code",[t._v("Hashtable")]),t._v(" ä½¿ç”¨ "),s("code",[t._v("synchronized")]),t._v(" ä¿®é¥°æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œé‚£ä¹ˆé¢å¯¹çº¿ç¨‹çš„è®¿é—®ï¼ŒHashtable å°±ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰çš„å…¶å®ƒçº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œè¿™ç§é˜»å¡æ–¹å¼çš„ååé‡æ˜¾ç„¶å¾ˆä½ã€‚")]),t._v(" "),s("p",[t._v("Java 1.7 ä»¥å‰çš„ "),s("code",[t._v("ConcurrentHashMap")]),t._v(" å°±æ˜¯åˆ†æ®µé”çš„å…¸å‹æ¡ˆä¾‹ã€‚"),s("code",[t._v("ConcurrentHashMap")]),t._v(" ç»´æŠ¤äº†ä¸€ä¸ª "),s("code",[t._v("Segment")]),t._v(" æ•°ç»„ï¼Œä¸€èˆ¬ç§°ä¸ºåˆ†æ®µæ¡¶ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Segment")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" segments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("å½“æœ‰çº¿ç¨‹è®¿é—® "),s("code",[t._v("ConcurrentHashMap")]),t._v(" çš„æ•°æ®æ—¶ï¼Œ"),s("code",[t._v("ConcurrentHashMap")]),t._v(" ä¼šå…ˆæ ¹æ® hashCode è®¡ç®—å‡ºæ•°æ®åœ¨å“ªä¸ªæ¡¶ï¼ˆå³å“ªä¸ª Segmentï¼‰ï¼Œç„¶åé”ä½è¿™ä¸ª "),s("code",[t._v("Segment")]),t._v("ã€‚")]),t._v(" "),s("h3",{attrs:{id:"æ˜¾ç¤ºé”å’Œå†…ç½®é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ˜¾ç¤ºé”å’Œå†…ç½®é”"}},[t._v("#")]),t._v(" æ˜¾ç¤ºé”å’Œå†…ç½®é”")]),t._v(" "),s("p",[t._v("Java 1.5 ä¹‹å‰ï¼Œåè°ƒå¯¹å…±äº«å¯¹è±¡çš„è®¿é—®æ—¶å¯ä»¥ä½¿ç”¨çš„æœºåˆ¶åªæœ‰ "),s("code",[t._v("synchronized")]),t._v(" å’Œ "),s("code",[t._v("volatile")]),t._v("ã€‚è¿™ä¸¤ä¸ªéƒ½å±äºå†…ç½®é”ï¼Œå³é”çš„ç”³è¯·å’Œé‡Šæ”¾éƒ½æ˜¯ç”± JVM æ‰€æ§åˆ¶ã€‚")]),t._v(" "),s("p",[t._v("Java 1.5 ä¹‹åï¼Œå¢åŠ äº†æ–°çš„æœºåˆ¶ï¼š"),s("code",[t._v("ReentrantLock")]),t._v("ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ï¼Œè¿™ç±»é”çš„ç”³è¯·å’Œé‡Šæ”¾éƒ½å¯ä»¥ç”±ç¨‹åºæ‰€æ§åˆ¶ï¼Œæ‰€ä»¥å¸¸è¢«ç§°ä¸ºæ˜¾ç¤ºé”ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("ğŸ’¡ "),s("code",[t._v("synchronized")]),t._v(" çš„ç”¨æ³•å’ŒåŸç†å¯ä»¥å‚è€ƒï¼š"),s("a",{attrs:{href:"https://dunwu.github.io/blog/pages/2c6488/#%E4%BA%8Csynchronized",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java å¹¶å‘åŸºç¡€æœºåˆ¶ - synchronized"),s("OutboundLink")],1),t._v(" ã€‚")]),t._v(" "),s("p",[t._v("ğŸ”” æ³¨æ„ï¼šå¦‚æœä¸éœ€è¦ "),s("code",[t._v("ReentrantLock")]),t._v("ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" æ‰€æä¾›çš„é«˜çº§åŒæ­¥ç‰¹æ€§ï¼Œ"),s("strong",[t._v("åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ "),s("code",[t._v("synchronized")])]),t._v(" ã€‚ç†ç”±å¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Java 1.6 ä»¥åï¼Œ"),s("code",[t._v("synchronized")]),t._v(" åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå…¶æ€§èƒ½å·²ç»ä¸ "),s("code",[t._v("ReentrantLock")]),t._v("ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" åŸºæœ¬ä¸ŠæŒå¹³ã€‚")]),t._v(" "),s("li",[t._v("ä»è¶‹åŠ¿æ¥çœ‹ï¼ŒJava æœªæ¥æ›´å¯èƒ½ä¼šä¼˜åŒ– "),s("code",[t._v("synchronized")]),t._v(" ï¼Œè€Œä¸æ˜¯ "),s("code",[t._v("ReentrantLock")]),t._v("ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ï¼Œå› ä¸º "),s("code",[t._v("synchronized")]),t._v(" æ˜¯ JVM å†…ç½®å±æ€§ï¼Œå®ƒèƒ½æ‰§è¡Œä¸€äº›ä¼˜åŒ–ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v("ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ç”³è¯·å’Œé‡Šæ”¾é”éƒ½æ˜¯ç”±ç¨‹åºæ§åˆ¶ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½é€ æˆæ­»é”ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚")])])]),t._v(" "),s("p",[t._v("ä»¥ä¸‹å¯¹æ¯”ä¸€ä¸‹æ˜¾ç¤ºé”å’Œå†…ç½®é”çš„å·®å¼‚ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("synchronized")]),t._v(" ä¸èƒ½ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”ã€‚è·å–é”å’Œé‡Šæ”¾é”éƒ½æ˜¯ JVM æ§åˆ¶çš„ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v(" å¯ä»¥ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”ã€‚ï¼ˆå¦‚æœå¿˜è®°é‡Šæ”¾é”ï¼Œå°±å¯èƒ½äº§ç”Ÿæ­»é”ï¼‰ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("å“åº”ä¸­æ–­")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("synchronized")]),t._v(" ä¸èƒ½å“åº”ä¸­æ–­ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v(" å¯ä»¥å“åº”ä¸­æ–­ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("è¶…æ—¶æœºåˆ¶")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("synchronized")]),t._v(" æ²¡æœ‰è¶…æ—¶æœºåˆ¶ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v(" æœ‰è¶…æ—¶æœºåˆ¶ã€‚"),s("code",[t._v("ReentrantLock")]),t._v(" å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶åè‡ªåŠ¨é‡Šæ”¾é”ï¼Œé¿å…ä¸€ç›´ç­‰å¾…ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("æ”¯æŒå…¬å¹³é”")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("synchronized")]),t._v(" åªæ”¯æŒéå…¬å¹³é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v(" æ”¯æŒéå…¬å¹³é”å’Œå…¬å¹³é”ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("æ˜¯å¦æ”¯æŒå…±äº«")]),t._v(" "),s("ul",[s("li",[t._v("è¢« "),s("code",[t._v("synchronized")]),t._v(" ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—ï¼Œåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼ˆç‹¬äº«ï¼‰ã€‚å¦‚æœè¿™ä¸ªçº¿ç¨‹è¢«é˜»å¡ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿåªèƒ½ç­‰å¾…")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v(" å¯ä»¥åŸºäº "),s("code",[t._v("Condition")]),t._v(" çµæ´»çš„æ§åˆ¶åŒæ­¥æ¡ä»¶ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("æ˜¯å¦æ”¯æŒè¯»å†™åˆ†ç¦»")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("synchronized")]),t._v(" ä¸æ”¯æŒè¯»å†™é”åˆ†ç¦»ï¼›")]),t._v(" "),s("li",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" æ”¯æŒè¯»å†™é”ï¼Œä»è€Œä½¿é˜»å¡è¯»å†™çš„æ“ä½œåˆ†å¼€ï¼Œæœ‰æ•ˆæé«˜å¹¶å‘æ€§ã€‚")])])])]),t._v(" "),s("h2",{attrs:{id:"lock-å’Œ-condition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lock-å’Œ-condition"}},[t._v("#")]),t._v(" Lock å’Œ Condition")]),t._v(" "),s("h3",{attrs:{id:"ä¸ºä½•å¼•å…¥-lock-å’Œ-condition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä½•å¼•å…¥-lock-å’Œ-condition"}},[t._v("#")]),t._v(" ä¸ºä½•å¼•å…¥ Lock å’Œ Condition")]),t._v(" "),s("p",[t._v("å¹¶å‘ç¼–ç¨‹é¢†åŸŸï¼Œæœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼šä¸€ä¸ªæ˜¯"),s("strong",[t._v("äº’æ–¥")]),t._v("ï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼›å¦ä¸€ä¸ªæ˜¯"),s("strong",[t._v("åŒæ­¥")]),t._v("ï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œã€‚è¿™ä¸¤å¤§é—®é¢˜ï¼Œç®¡ç¨‹éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„ã€‚"),s("strong",[t._v("Java SDK å¹¶å‘åŒ…é€šè¿‡ Lock å’Œ Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹ï¼Œå…¶ä¸­ Lock ç”¨äºè§£å†³äº’æ–¥é—®é¢˜ï¼ŒCondition ç”¨äºè§£å†³åŒæ­¥é—®é¢˜")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("synchronized æ˜¯ç®¡ç¨‹çš„ä¸€ç§å®ç°ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œä½•å¿…å†æä¾› Lock å’Œ Conditionã€‚")]),t._v(" "),s("p",[t._v("JDK 1.6 ä»¥å‰ï¼Œsynchronized è¿˜æ²¡æœ‰åšä¼˜åŒ–ï¼Œæ€§èƒ½è¿œä½äº Lockã€‚ä½†æ˜¯ï¼Œæ€§èƒ½ä¸æ˜¯å¼•å…¥ Lock çš„æœ€é‡è¦å› ç´ ã€‚çœŸæ­£å…³é”®åœ¨äºï¼šsynchronized ä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”ã€‚")]),t._v(" "),s("p",[t._v("synchronized æ— æ³•é€šè¿‡"),s("strong",[t._v("ç ´åä¸å¯æŠ¢å æ¡ä»¶")]),t._v("æ¥é¿å…æ­»é”ã€‚åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå•¥éƒ½å¹²ä¸äº†ï¼Œä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æºã€‚")]),t._v(" "),s("p",[t._v("ä¸å†…ç½®é” "),s("code",[t._v("synchronized")]),t._v(" ä¸åŒçš„æ˜¯ï¼Œ"),s("strong",[s("code",[t._v("Lock")]),t._v(" æä¾›äº†ä¸€ç»„æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ã€å®šæ—¶çš„ä»¥åŠå¯ä¸­æ–­çš„é”æ“ä½œ")]),t._v("ï¼Œæ‰€æœ‰è·å–é”ã€é‡Šæ”¾é”çš„æ“ä½œéƒ½æ˜¯æ˜¾å¼çš„æ“ä½œã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("èƒ½å¤Ÿå“åº”ä¸­æ–­")]),t._v("ã€‚synchronized çš„é—®é¢˜æ˜¯ï¼ŒæŒæœ‰é” A åï¼Œå¦‚æœå°è¯•è·å–é” B å¤±è´¥ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚ä½†å¦‚æœé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå”¤é†’å®ƒï¼Œé‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” Aã€‚è¿™æ ·å°±ç ´åäº†ä¸å¯æŠ¢å æ¡ä»¶äº†ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("æ”¯æŒè¶…æ—¶")]),t._v("ã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("éé˜»å¡åœ°è·å–é”")]),t._v("ã€‚å¦‚æœå°è¯•è·å–é”å¤±è´¥ï¼Œå¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"lock-æ¥å£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lock-æ¥å£"}},[t._v("#")]),t._v(" Lock æ¥å£")]),t._v(" "),s("p",[s("code",[t._v("Lock")]),t._v(" çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lockInterruptibly")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),t._v(" unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Condition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newCondition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("lock()")]),t._v(" - è·å–é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("unlock()")]),t._v(" - é‡Šæ”¾é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("tryLock()")]),t._v(" - å°è¯•è·å–é”ï¼Œä»…åœ¨è°ƒç”¨æ—¶é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„æƒ…å†µä¸‹ï¼Œæ‰è·å–è¯¥é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("tryLock(long time, TimeUnit unit)")]),t._v(" - å’Œ "),s("code",[t._v("tryLock()")]),t._v(" ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºé™å®šæ—¶é—´ï¼Œå¦‚æœé™å®šæ—¶é—´å†…æœªè·å–åˆ°é”ï¼Œè§†ä¸ºå¤±è´¥ã€‚")]),t._v(" "),s("li",[s("code",[t._v("lockInterruptibly()")]),t._v(" - é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œä¸”çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½è·å–é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("newCondition()")]),t._v(" - è¿”å›ä¸€ä¸ªç»‘å®šåˆ° "),s("code",[t._v("Lock")]),t._v(" å¯¹è±¡ä¸Šçš„ "),s("code",[t._v("Condition")]),t._v(" å®ä¾‹ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"condition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#condition"}},[t._v("#")]),t._v(" Condition")]),t._v(" "),s("p",[s("strong",[t._v("Condition å®ç°äº†ç®¡ç¨‹æ¨¡å‹é‡Œé¢çš„æ¡ä»¶å˜é‡")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("å‰æ–‡ä¸­æè¿‡ "),s("code",[t._v("Lock")]),t._v(" æ¥å£ä¸­ æœ‰ä¸€ä¸ª "),s("code",[t._v("newCondition()")]),t._v(" æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªç»‘å®šåˆ° "),s("code",[t._v("Lock")]),t._v(" å¯¹è±¡ä¸Šçš„ "),s("code",[t._v("Condition")]),t._v(" å®ä¾‹ã€‚"),s("code",[t._v("Condition")]),t._v(" æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿæœ¬èŠ‚å°†ä¸€ä¸€è®²è§£ã€‚")]),t._v(" "),s("p",[t._v("åœ¨å•çº¿ç¨‹ä¸­ï¼Œä¸€æ®µä»£ç çš„æ‰§è¡Œå¯èƒ½ä¾èµ–äºæŸä¸ªçŠ¶æ€ï¼Œå¦‚æœä¸æ»¡è¶³çŠ¶æ€æ¡ä»¶ï¼Œä»£ç å°±ä¸ä¼šè¢«æ‰§è¡Œï¼ˆå…¸å‹çš„åœºæ™¯ï¼Œå¦‚ï¼š"),s("code",[t._v("if ... else ...")]),t._v("ï¼‰ã€‚åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­æŸä¸ªçŠ¶æ€æ¡ä»¶æ—¶ï¼Œå…¶çŠ¶æ€å¯èƒ½æ˜¯ç”±äºå…¶ä»–çº¿ç¨‹çš„æ“ä½œè€Œæ”¹å˜ï¼Œè¿™æ—¶å°±éœ€è¦æœ‰ä¸€å®šçš„åè°ƒæœºåˆ¶æ¥ç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œæ•°æ®åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”ä¿®æ”¹ï¼Œä¸”ä¿®æ”¹çš„æ•°æ®çŠ¶æ€è¢«æ‰€æœ‰çº¿ç¨‹æ‰€æ„ŸçŸ¥ã€‚")]),t._v(" "),s("p",[t._v("Java 1.5 ä¹‹å‰ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ "),s("code",[t._v("Object")]),t._v(" ç±»ä¸­çš„ "),s("code",[t._v("wait")]),t._v("ã€"),s("code",[t._v("notify")]),t._v("ã€"),s("code",[t._v("notifyAll")]),t._v(" é…åˆ "),s("code",[t._v("synchronized")]),t._v(" æ¥è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡ï¼ˆå¦‚æœä¸äº†è§£å…¶ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒï¼š"),s("a",{attrs:{href:"https://dunwu.github.io/javacore/#/concurrent/java-thread?id=waitnotifynotifyall",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java çº¿ç¨‹åŸºç¡€ - wait/notify/notifyAll"),s("OutboundLink")],1),t._v("ï¼‰ã€‚")]),t._v(" "),s("p",[s("code",[t._v("wait")]),t._v("ã€"),s("code",[t._v("notify")]),t._v("ã€"),s("code",[t._v("notifyAll")]),t._v(" éœ€è¦é…åˆ "),s("code",[t._v("synchronized")]),t._v(" ä½¿ç”¨ï¼Œä¸é€‚ç”¨äº "),s("code",[t._v("Lock")]),t._v("ã€‚è€Œä½¿ç”¨ "),s("code",[t._v("Lock")]),t._v(" çš„çº¿ç¨‹ï¼Œå½¼æ­¤é—´é€šä¿¡åº”è¯¥ä½¿ç”¨ "),s("code",[t._v("Condition")]),t._v(" ã€‚è¿™å¯ä»¥ç†è§£ä¸ºï¼Œä»€ä¹ˆæ ·çš„é”é…ä»€ä¹ˆæ ·çš„é’¥åŒ™ã€‚"),s("strong",[t._v("å†…ç½®é”ï¼ˆ"),s("code",[t._v("synchronized")]),t._v("ï¼‰é…åˆå†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ"),s("code",[t._v("wait")]),t._v("ã€"),s("code",[t._v("notify")]),t._v("ã€"),s("code",[t._v("notifyAll")]),t._v(" ï¼‰ï¼Œæ˜¾å¼é”ï¼ˆ"),s("code",[t._v("Lock")]),t._v("ï¼‰é…åˆæ˜¾å¼æ¡ä»¶é˜Ÿåˆ—ï¼ˆ"),s("code",[t._v("Condition")]),t._v(" ï¼‰")]),t._v("ã€‚")]),t._v(" "),s("h4",{attrs:{id:"condition-çš„ç‰¹æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#condition-çš„ç‰¹æ€§"}},[t._v("#")]),t._v(" Condition çš„ç‰¹æ€§")]),t._v(" "),s("p",[s("code",[t._v("Condition")]),t._v(" æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Condition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awaitUninterruptibly")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awaitNanos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" nanosTimeout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),t._v(" unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awaitUntil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),t._v(" deadline"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("signal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("signalAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("å…¶ä¸­ï¼Œ"),s("code",[t._v("await")]),t._v("ã€"),s("code",[t._v("signal")]),t._v("ã€"),s("code",[t._v("signalAll")]),t._v(" ä¸ "),s("code",[t._v("wait")]),t._v("ã€"),s("code",[t._v("notify")]),t._v("ã€"),s("code",[t._v("notifyAll")]),t._v(" ç›¸å¯¹åº”ï¼ŒåŠŸèƒ½ä¹Ÿç›¸ä¼¼ã€‚é™¤æ­¤ä»¥å¤–ï¼Œ"),s("code",[t._v("Condition")]),t._v(" ç›¸æ¯”å†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ "),s("code",[t._v("wait")]),t._v("ã€"),s("code",[t._v("notify")]),t._v("ã€"),s("code",[t._v("notifyAll")]),t._v(" ï¼‰ï¼Œæä¾›äº†æ›´ä¸ºä¸°å¯Œçš„åŠŸèƒ½ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¯ä¸ªé”ï¼ˆ"),s("code",[t._v("Lock")]),t._v("ï¼‰ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ª "),s("code",[t._v("Condition")]),t._v("ï¼Œè¿™æ„å‘³ç€é”çš„çŠ¶æ€æ¡ä»¶å¯ä»¥æœ‰å¤šä¸ªã€‚")]),t._v(" "),s("li",[t._v("æ”¯æŒå…¬å¹³çš„æˆ–éå…¬å¹³çš„é˜Ÿåˆ—æ“ä½œã€‚")]),t._v(" "),s("li",[t._v("æ”¯æŒå¯ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š"),s("code",[t._v("awaitUninterruptibly()")]),t._v(" ã€‚")]),t._v(" "),s("li",[t._v("æ”¯æŒå¯å®šæ—¶çš„ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š"),s("code",[t._v("awaitNanos(long)")]),t._v(" ã€"),s("code",[t._v("await(long, TimeUnit)")]),t._v("ã€"),s("code",[t._v("awaitUntil(Date)")]),t._v("ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"condition-çš„ç”¨æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#condition-çš„ç”¨æ³•"}},[t._v("#")]),t._v(" Condition çš„ç”¨æ³•")]),t._v(" "),s("p",[t._v("è¿™é‡Œä»¥ "),s("code",[t._v("Condition")]),t._v(" æ¥å®ç°ä¸€ä¸ªæ¶ˆè´¹è€…ã€ç”Ÿäº§è€…æ¨¡å¼ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("ğŸ”” æ³¨æ„ï¼šäº‹å®ä¸Šï¼Œè§£å†³æ­¤ç±»é—®é¢˜ä½¿ç”¨ "),s("code",[t._v("CountDownLatch")]),t._v("ã€"),s("code",[t._v("Semaphore")]),t._v(" ç­‰å·¥å…·æ›´ä¸ºä¾¿æ·ã€å®‰å…¨ã€‚æƒ³äº†è§£è¯¦æƒ…ï¼Œå¯ä»¥å‚è€ƒ "),s("a",{attrs:{href:"https://dunwu.github.io/javacore/#/concurrent/java-concurrent-tools",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java å¹¶å‘å·¥å…·ç±»"),s("OutboundLink")],1),t._v(" ã€‚")])]),t._v(" "),s("p",[t._v("äº§å“ç±»")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Condition")]),t._v(" producedMsg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newCondition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Condition")]),t._v(" consumedMsg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newCondition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("consume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//lock")]),t._v("\n        lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// no new message wait for new message")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" producedMsg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"consume message : "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// message consumed, notify waiting thread")]),t._v("\n            consumedMsg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("signal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" ie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Thread interrupted - viewMessage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// last message not consumed, wait for it be consumed")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" consumedMsg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"produce msg: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// new message added, notify waiting thread")]),t._v("\n            producedMsg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("signal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" ie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Thread interrupted - publishMessage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("end "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("æ¶ˆè´¹è€…")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageConsumer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageConsumer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        message "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("consume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("ç”Ÿäº§è€…")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageProducer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageProducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        message "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" msgs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        msgs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Begin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        msgs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Msg1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        msgs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Msg2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" msg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" msgs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"End"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("æµ‹è¯•")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockConditionDemo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" msg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" producer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageProducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" consumer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageConsumer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"reentrantlock"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock"}},[t._v("#")]),t._v(" ReentrantLock")]),t._v(" "),s("p",[s("code",[t._v("ReentrantLock")]),t._v(" ç±»æ˜¯ "),s("code",[t._v("Lock")]),t._v(" æ¥å£çš„å…·ä½“å®ç°ï¼Œä¸å†…ç½®é” "),s("code",[t._v("synchronized")]),t._v(" ç›¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ª"),s("strong",[t._v("å¯é‡å…¥é”")]),t._v("ã€‚")]),t._v(" "),s("h3",{attrs:{id:"reentrantlock-çš„ç‰¹æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock-çš„ç‰¹æ€§"}},[t._v("#")]),t._v(" ReentrantLock çš„ç‰¹æ€§")]),t._v(" "),s("p",[s("code",[t._v("ReentrantLock")]),t._v(" çš„ç‰¹æ€§å¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("ReentrantLock")]),t._v(" æä¾›äº†ä¸ "),s("code",[t._v("synchronized")]),t._v(" ç›¸åŒçš„äº’æ–¥æ€§ã€å†…å­˜å¯è§æ€§å’Œå¯é‡å…¥æ€§")]),t._v("ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v(" "),s("strong",[t._v("æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”")]),t._v("ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock")]),t._v(" å®ç°äº† "),s("code",[t._v("Lock")]),t._v(" æ¥å£ï¼Œæ”¯æŒäº† "),s("code",[t._v("synchronized")]),t._v(" æ‰€ä¸å…·å¤‡çš„"),s("strong",[t._v("çµæ´»æ€§")]),t._v("ã€‚\n"),s("ul",[s("li",[s("code",[t._v("synchronized")]),t._v(" æ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹")]),t._v(" "),s("li",[s("code",[t._v("synchronized")]),t._v(" æ— æ³•åœ¨è¯·æ±‚è·å–ä¸€ä¸ªé”æ—¶æ— ä¼‘æ­¢åœ°ç­‰å¾…")])])])]),t._v(" "),s("h3",{attrs:{id:"reentrantlock-çš„ç”¨æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock-çš„ç”¨æ³•"}},[t._v("#")]),t._v(" ReentrantLock çš„ç”¨æ³•")]),t._v(" "),s("p",[t._v("å‰æ–‡äº†è§£äº† "),s("code",[t._v("ReentrantLock")]),t._v(" çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è®²è¿°å…¶å…·ä½“ç”¨æ³•ã€‚")]),t._v(" "),s("h4",{attrs:{id:"reentrantlock-çš„æ„é€ æ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock-çš„æ„é€ æ–¹æ³•"}},[t._v("#")]),t._v(" ReentrantLock çš„æ„é€ æ–¹æ³•")]),t._v(" "),s("p",[s("code",[t._v("ReentrantLock")]),t._v(" æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" fair"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("ReentrantLock()")]),t._v(" - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª"),s("strong",[t._v("éå…¬å¹³é”ï¼ˆNonfairSyncï¼‰")]),t._v("ï¼›")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock(boolean)")]),t._v(" - "),s("code",[t._v("new ReentrantLock(true)")]),t._v(" ä¼šåˆå§‹åŒ–ä¸€ä¸ª"),s("strong",[t._v("å…¬å¹³é”ï¼ˆFairSyncï¼‰")]),t._v("ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"lock-å’Œ-unlock-æ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lock-å’Œ-unlock-æ–¹æ³•"}},[t._v("#")]),t._v(" lock å’Œ unlock æ–¹æ³•")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("lock()")]),t._v(" - "),s("strong",[t._v("æ— æ¡ä»¶è·å–é”")]),t._v("ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ— æ³•è·å–é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ä¸å¯ç”¨ï¼Œç›´è‡³å½“å‰çº¿ç¨‹è·å–åˆ°é”ã€‚å¦‚æœè¯¥é”æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œåˆ™è·å–è¯¥é”å¹¶ç«‹å³è¿”å›ï¼Œå°†é”çš„æŒæœ‰è®¡æ•°è®¾ç½®ä¸º 1ã€‚")]),t._v(" "),s("li",[s("code",[t._v("unlock()")]),t._v(" - ç”¨äº"),s("strong",[t._v("é‡Šæ”¾é”")]),t._v("ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("ğŸ”” æ³¨æ„ï¼šè¯·åŠ¡å¿…ç‰¢è®°ï¼Œè·å–é”æ“ä½œ "),s("strong",[s("code",[t._v("lock()")]),t._v(" å¿…é¡»åœ¨ "),s("code",[t._v("try catch")]),t._v(" å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”æ“ä½œ "),s("code",[t._v("unlock()")]),t._v(" æ”¾åœ¨ "),s("code",[t._v("finally")]),t._v(" å—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿ")]),t._v("ã€‚")])]),t._v(" "),s("p",[t._v("ç¤ºä¾‹ï¼š"),s("code",[t._v("ReentrantLock")]),t._v(" çš„åŸºæœ¬æ“ä½œ")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLockDemo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),t._v(" task "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),t._v(" tA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Thread-A"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),t._v(" tB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Thread-B"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),t._v(" tC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Thread-C"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        tA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        tB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        tC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("task "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŸ¥è¯¢å½“å‰çº¿ç¨‹ hold ä½æ­¤é”çš„æ¬¡æ•°")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\t holdCount: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHoldCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŸ¥è¯¢æ­£ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹æ•°")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\t queuedLength: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getQueueLength")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ˜¯å¦ä¸ºå…¬å¹³é”")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\t isFair: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFair")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ˜¯å¦è¢«é”ä½")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\t isLocked: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isLocked")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰é”")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\t isHeldByCurrentThread: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isHeldByCurrentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("è¾“å‡ºç»“æœï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("concurrent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("locks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@64fcd88a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Locked")]),t._v(" by thread "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t holdCount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t queuedLength"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\t isFair"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\t isLocked"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t isHeldByCurrentThread"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("concurrent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("locks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("ReentrantLock")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@64fcd88a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Locked")]),t._v(" by thread "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("C")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t holdCount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t queuedLength"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t isFair"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\t isLocked"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t isHeldByCurrentThread"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n")])])]),s("h4",{attrs:{id:"trylock-æ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#trylock-æ–¹æ³•"}},[t._v("#")]),t._v(" tryLock æ–¹æ³•")]),t._v(" "),s("p",[t._v("ä¸æ— æ¡ä»¶è·å–é”ç›¸æ¯”ï¼ŒtryLock æœ‰æ›´å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("tryLock()")]),t._v(" - "),s("strong",[t._v("å¯è½®è¯¢è·å–é”")]),t._v("ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•"),s("strong",[t._v("æ— è®ºæˆè´¥éƒ½ä¼šç«‹å³è¿”å›")]),t._v("ï¼Œè·å–ä¸åˆ°é”ï¼ˆé”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰æ—¶ä¸ä¼šä¸€ç›´ç­‰å¾…ã€‚")]),t._v(" "),s("li",[s("code",[t._v("tryLock(long, TimeUnit)")]),t._v(" - "),s("strong",[t._v("å¯å®šæ—¶è·å–é”")]),t._v("ã€‚å’Œ "),s("code",[t._v("tryLock()")]),t._v(" ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨"),s("strong",[t._v("è·å–ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´")]),t._v("ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜è·å–ä¸åˆ°é”ï¼Œå°±è¿”å› falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› trueã€‚")])]),t._v(" "),s("p",[t._v("ç¤ºä¾‹ï¼š"),s("code",[t._v("ReentrantLock")]),t._v(" çš„ "),s("code",[t._v("tryLock()")]),t._v(" æ“ä½œ")]),t._v(" "),s("p",[t._v("ä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ "),s("code",[t._v("execute()")]),t._v(" æ–¹æ³•")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç•¥...")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" è·å–é”å¤±è´¥"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("ç¤ºä¾‹ï¼š"),s("code",[t._v("ReentrantLock")]),t._v(" çš„ "),s("code",[t._v("tryLock(long, TimeUnit)")]),t._v(" æ“ä½œ")]),t._v(" "),s("p",[t._v("ä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ "),s("code",[t._v("execute()")]),t._v(" æ–¹æ³•")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç•¥...")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" è·å–é”å¤±è´¥"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" è·å–é”è¶…æ—¶"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"lockinterruptibly-æ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lockinterruptibly-æ–¹æ³•"}},[t._v("#")]),t._v(" lockInterruptibly æ–¹æ³•")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("lockInterruptibly()")]),t._v(" - "),s("strong",[t._v("å¯ä¸­æ–­è·å–é”")]),t._v("ã€‚å¯ä¸­æ–­è·å–é”å¯ä»¥åœ¨è·å¾—é”çš„åŒæ—¶ä¿æŒå¯¹ä¸­æ–­çš„å“åº”ã€‚å¯ä¸­æ–­è·å–é”æ¯”å…¶å®ƒè·å–é”çš„æ–¹å¼ç¨å¾®å¤æ‚ä¸€äº›ï¼Œéœ€è¦ä¸¤ä¸ª "),s("code",[t._v("try-catch")]),t._v(" å—ï¼ˆå¦‚æœåœ¨è·å–é”çš„æ“ä½œä¸­æŠ›å‡ºäº† "),s("code",[t._v("InterruptedException")]),t._v(" ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ "),s("code",[t._v("try-finally")]),t._v(" åŠ é”æ¨¡å¼ï¼‰ã€‚\n"),s("ul",[s("li",[t._v("ä¸¾ä¾‹æ¥è¯´ï¼šå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ "),s("code",[t._v("lock.lockInterruptibly()")]),t._v(" è·å–æŸä¸ªé”æ—¶ï¼Œè‹¥çº¿ç¨‹ A è·å–åˆ°äº†é”ï¼Œåˆ™çº¿ç¨‹ B åªèƒ½ç­‰å¾…ã€‚è‹¥æ­¤æ—¶å¯¹çº¿ç¨‹ B è°ƒç”¨ "),s("code",[t._v("threadB.interrupt()")]),t._v(" æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ B çš„ç­‰å¾…è¿‡ç¨‹ã€‚ç”±äº "),s("code",[t._v("lockInterruptibly()")]),t._v(" çš„å£°æ˜ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥ "),s("code",[t._v("lock.lockInterruptibly()")]),t._v(" å¿…é¡»æ”¾åœ¨ "),s("code",[t._v("try")]),t._v(" å—ä¸­æˆ–è€…åœ¨è°ƒç”¨ "),s("code",[t._v("lockInterruptibly()")]),t._v(" çš„æ–¹æ³•å¤–å£°æ˜æŠ›å‡º "),s("code",[t._v("InterruptedException")]),t._v("ã€‚")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("ğŸ”” æ³¨æ„ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢« "),s("code",[t._v("interrupt()")]),t._v(" æ–¹æ³•ä¸­æ–­çš„ã€‚å•ç‹¬è°ƒç”¨ "),s("code",[t._v("interrupt()")]),t._v(" æ–¹æ³•ä¸èƒ½ä¸­æ–­æ­£åœ¨è¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹ï¼Œåªèƒ½ä¸­æ–­é˜»å¡çŠ¶æ€ä¸­çš„çº¿ç¨‹ã€‚å› æ­¤å½“é€šè¿‡ "),s("code",[t._v("lockInterruptibly()")]),t._v(" æ–¹æ³•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœæœªè·å–åˆ°é”ï¼Œåªæœ‰åœ¨ç­‰å¾…çš„çŠ¶æ€ä¸‹ï¼Œæ‰å¯ä»¥å“åº”ä¸­æ–­ã€‚")])]),t._v(" "),s("p",[t._v("ç¤ºä¾‹ï¼š"),s("code",[t._v("ReentrantLock")]),t._v(" çš„ "),s("code",[t._v("lockInterruptibly()")]),t._v(" æ“ä½œ")]),t._v(" "),s("p",[t._v("ä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ "),s("code",[t._v("execute()")]),t._v(" æ–¹æ³•")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lockInterruptibly")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç•¥...")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"è¢«ä¸­æ–­"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"newcondition-æ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#newcondition-æ–¹æ³•"}},[t._v("#")]),t._v(" newCondition æ–¹æ³•")]),t._v(" "),s("p",[s("code",[t._v("newCondition()")]),t._v(" - è¿”å›ä¸€ä¸ªç»‘å®šåˆ° "),s("code",[t._v("Lock")]),t._v(" å¯¹è±¡ä¸Šçš„ "),s("code",[t._v("Condition")]),t._v(" å®ä¾‹ã€‚"),s("code",[t._v("Condition")]),t._v(" çš„ç‰¹æ€§å’Œå…·ä½“æ–¹æ³•è¯·é˜…è¯»ä¸‹æ–‡ "),s("a",{attrs:{href:"#%E4%BA%94condition"}},[s("code",[t._v("Condition")])]),t._v("ã€‚")]),t._v(" "),s("h3",{attrs:{id:"reentrantlock-çš„åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock-çš„åŸç†"}},[t._v("#")]),t._v(" ReentrantLock çš„åŸç†")]),t._v(" "),s("h4",{attrs:{id:"reentrantlock-çš„å¯è§æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock-çš„å¯è§æ€§"}},[t._v("#")]),t._v(" ReentrantLock çš„å¯è§æ€§")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("class X {\n  private final Lock rtl =\n  new ReentrantLock();\n  int value;\n  public void addOne() {\n    // è·å–é”\n    rtl.lock();\n    try {\n      value+=1;\n    } finally {\n      // ä¿è¯é”èƒ½é‡Šæ”¾\n      rtl.unlock();\n    }\n  }\n}\n")])])]),s("p",[t._v("ReentrantLockï¼Œå†…éƒ¨æŒæœ‰ä¸€ä¸ª volatile çš„æˆå‘˜å˜é‡ stateï¼Œè·å–é”çš„æ—¶å€™ï¼Œä¼šè¯»å†™ state çš„å€¼ï¼›è§£é”çš„æ—¶å€™ï¼Œä¹Ÿä¼šè¯»å†™ state çš„å€¼ï¼ˆç®€åŒ–åçš„ä»£ç å¦‚ä¸‹é¢æ‰€ç¤ºï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œ value+=1 ä¹‹å‰ï¼Œç¨‹åºå…ˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ stateï¼Œåœ¨æ‰§è¡Œ value+=1 ä¹‹åï¼Œåˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ stateã€‚æ ¹æ®ç›¸å…³çš„ Happens-Before è§„åˆ™ï¼š")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("é¡ºåºæ€§è§„åˆ™")]),t._v("ï¼šå¯¹äºçº¿ç¨‹ T1ï¼Œvalue+=1 Happens-Before é‡Šæ”¾é”çš„æ“ä½œ unlock()ï¼›")]),t._v(" "),s("li",[s("strong",[t._v("volatile å˜é‡è§„åˆ™")]),t._v("ï¼šç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œï¼›")]),t._v(" "),s("li",[s("strong",[t._v("ä¼ é€’æ€§è§„åˆ™")]),t._v("ï¼šçº¿ç¨‹ T1 çš„ value+=1 Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œã€‚")])]),t._v(" "),s("h4",{attrs:{id:"reentrantlock-çš„æ•°æ®ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock-çš„æ•°æ®ç»“æ„"}},[t._v("#")]),t._v(" ReentrantLock çš„æ•°æ®ç»“æ„")]),t._v(" "),s("p",[t._v("é˜…è¯» "),s("code",[t._v("ReentrantLock")]),t._v(" çš„æºç ï¼Œå¯ä»¥å‘ç°å®ƒæœ‰ä¸€ä¸ªæ ¸å¿ƒå­—æ®µï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),t._v(" sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("sync")]),t._v(" - å†…éƒ¨æŠ½è±¡ç±» "),s("code",[t._v("ReentrantLock.Sync")]),t._v(" å¯¹è±¡ï¼Œ"),s("code",[t._v("Sync")]),t._v(" ç»§æ‰¿è‡ª AQSã€‚å®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock.FairSync")]),t._v(" - å…¬å¹³é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantLock.NonfairSync")]),t._v(" - éå…¬å¹³é”ã€‚")])]),t._v(" "),s("p",[t._v("æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œ"),s("code",[t._v("ReentrantLock")]),t._v(" å®ç° "),s("code",[t._v("Lock")]),t._v(" æ¥å£å…¶å®æ˜¯è°ƒç”¨ "),s("code",[t._v("ReentrantLock.FairSync")]),t._v(" æˆ– "),s("code",[t._v("ReentrantLock.NonfairSync")]),t._v(" ä¸­å„è‡ªçš„å®ç°ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ã€‚")]),t._v(" "),s("h4",{attrs:{id:"reentrantlock-çš„è·å–é”å’Œé‡Šæ”¾é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantlock-çš„è·å–é”å’Œé‡Šæ”¾é”"}},[t._v("#")]),t._v(" ReentrantLock çš„è·å–é”å’Œé‡Šæ”¾é”")]),t._v(" "),s("p",[t._v("ReentrantLock è·å–é”å’Œé‡Šæ”¾é”çš„æ¥å£ï¼Œä»è¡¨è±¡çœ‹ï¼Œæ˜¯è°ƒç”¨ "),s("code",[t._v("ReentrantLock.FairSync")]),t._v(" æˆ– "),s("code",[t._v("ReentrantLock.NonfairSync")]),t._v(" ä¸­å„è‡ªçš„å®ç°ï¼›ä»æœ¬è´¨ä¸Šçœ‹ï¼Œæ˜¯åŸºäº AQS çš„å®ç°ã€‚")]),t._v(" "),s("p",[t._v("ä»”ç»†é˜…è¯»æºç å¾ˆå®¹æ˜“å‘ç°ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("void lock()")]),t._v(" è°ƒç”¨ Sync çš„ lock() æ–¹æ³•ã€‚")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("void lockInterruptibly()")]),t._v(" ç›´æ¥è°ƒç”¨ AQS çš„ "),s("a",{attrs:{href:"#%E8%8E%B7%E5%8F%96%E5%8F%AF%E4%B8%AD%E6%96%AD%E7%9A%84%E7%8B%AC%E5%8D%A0%E9%94%81"}},[t._v("è·å–å¯ä¸­æ–­çš„ç‹¬å é”")]),t._v(" æ–¹æ³• "),s("code",[t._v("lockInterruptibly()")]),t._v("ã€‚")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("boolean tryLock()")]),t._v(" è°ƒç”¨ Sync çš„ "),s("code",[t._v("nonfairTryAcquire()")]),t._v(" ã€‚")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("boolean tryLock(long time, TimeUnit unit)")]),t._v(" ç›´æ¥è°ƒç”¨ AQS çš„ "),s("a",{attrs:{href:"#%E8%8E%B7%E5%8F%96%E8%B6%85%E6%97%B6%E7%AD%89%E5%BE%85%E5%BC%8F%E7%9A%84%E7%8B%AC%E5%8D%A0%E9%94%81"}},[t._v("è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”")]),t._v(" æ–¹æ³• "),s("code",[t._v("tryAcquireNanos(int arg, long nanosTimeout)")]),t._v("ã€‚")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("void unlock()")]),t._v(" ç›´æ¥è°ƒç”¨ AQS çš„ "),s("a",{attrs:{href:"#%E9%87%8A%E6%94%BE%E7%8B%AC%E5%8D%A0%E9%94%81"}},[t._v("é‡Šæ”¾ç‹¬å é”")]),t._v(" æ–¹æ³• "),s("code",[t._v("release(int arg)")]),t._v(" ã€‚")])])]),t._v(" "),s("p",[t._v("ç›´æ¥è°ƒç”¨ AQS æ¥å£çš„æ–¹æ³•å°±ä¸å†èµ˜è¿°äº†ï¼Œå…¶åŸç†åœ¨ [AQS çš„åŸç†](#AQS çš„åŸç†) ä¸­å·²ç»ç”¨å¾ˆå¤§ç¯‡å¹…è¿›è¡Œè¿‡è®²è§£ã€‚")]),t._v(" "),s("p",[s("code",[t._v("nonfairTryAcquire")]),t._v(" æ–¹æ³•æºç å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å…¬å¹³é”å’Œéå…¬å¹³é”éƒ½ä¼šç”¨è¿™ä¸ªæ–¹æ³•åŒºå°è¯•è·å–é”")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nonfairTryAcquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" acquires"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" current "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" acquires"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0ï¼Œå°†å…¶è®¾ä¸º acquiresï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setExclusiveOwnerThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExclusiveOwnerThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" nextc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" acquires"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// overflow")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Maximum lock count exceeded"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("å¤„ç†æµç¨‹å¾ˆç®€å•ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¦‚æœåŒæ­¥çŠ¶æ€ä¸º 0ï¼Œè®¾ç½®åŒæ­¥çŠ¶æ€è®¾ä¸º acquiresï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹ï¼Œç„¶åè¿”å› trueï¼Œè·å–é”æˆåŠŸã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœåŒæ­¥çŠ¶æ€ä¸ä¸º 0 ä¸”å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹ï¼Œè®¾ç½®åŒæ­¥çŠ¶æ€ä¸ºå½“å‰çŠ¶æ€å€¼+acquires å€¼ï¼Œç„¶åè¿”å› trueï¼Œè·å–é”æˆåŠŸã€‚")]),t._v(" "),s("li",[t._v("å¦åˆ™ï¼Œè¿”å› falseï¼Œè·å–é”å¤±è´¥ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"å…¬å¹³é”å’Œéå…¬å¹³é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…¬å¹³é”å’Œéå…¬å¹³é”"}},[t._v("#")]),t._v(" å…¬å¹³é”å’Œéå…¬å¹³é”")]),t._v(" "),s("p",[t._v("ReentrantLock è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ä¼ å…¥ fair å‚æ•°çš„æ„é€ å‡½æ•°ã€‚fair å‚æ•°ä»£è¡¨çš„æ˜¯é”çš„å…¬å¹³ç­–ç•¥ï¼Œå¦‚æœä¼ å…¥ true å°±è¡¨ç¤ºéœ€è¦æ„é€ ä¸€ä¸ªå…¬å¹³é”ï¼Œåä¹‹åˆ™è¡¨ç¤ºè¦æ„é€ ä¸€ä¸ªéå…¬å¹³é”ã€‚")]),t._v(" "),s("p",[t._v("é”éƒ½å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰è·å¾—é”ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“æœ‰çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå°±éœ€è¦ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚å¦‚æœæ˜¯å…¬å¹³é”ï¼Œå”¤é†’çš„ç­–ç•¥å°±æ˜¯è°ç­‰å¾…çš„æ—¶é—´é•¿ï¼Œå°±å”¤é†’è°ï¼Œå¾ˆå…¬å¹³ï¼›å¦‚æœæ˜¯éå…¬å¹³é”ï¼Œåˆ™ä¸æä¾›è¿™ä¸ªå…¬å¹³ä¿è¯ï¼Œæœ‰å¯èƒ½ç­‰å¾…æ—¶é—´çŸ­çš„çº¿ç¨‹åè€Œå…ˆè¢«å”¤é†’ã€‚")]),t._v(" "),s("p",[t._v("lock æ–¹æ³•åœ¨å…¬å¹³é”å’Œéå…¬å¹³é”ä¸­çš„å®ç°ï¼š")]),t._v(" "),s("p",[t._v("äºŒè€…çš„åŒºåˆ«ä»…åœ¨äºç”³è¯·éå…¬å¹³é”æ—¶ï¼Œå¦‚æœåŒæ­¥çŠ¶æ€ä¸º 0ï¼Œå°è¯•å°†å…¶è®¾ä¸º 1ï¼Œå¦‚æœæˆåŠŸï¼Œç›´æ¥å°†å½“å‰çº¿ç¨‹ç½®ä¸ºæ’å®ƒçº¿ç¨‹ï¼›å¦åˆ™å’Œå…¬å¹³é”ä¸€æ ·ï¼Œè°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• "),s("code",[t._v("acquire")]),t._v("ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éå…¬å¹³é”å®ç°")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareAndSetState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0ï¼Œå°†å…¶è®¾ä¸º1ï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setExclusiveOwnerThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• acquire")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å…¬å¹³é”å®ç°")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• acquire")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"reentrantreadwritelock"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock"}},[t._v("#")]),t._v(" ReentrantReadWriteLock")]),t._v(" "),s("p",[s("code",[t._v("ReadWriteLock")]),t._v(" é€‚ç”¨äº"),s("strong",[t._v("è¯»å¤šå†™å°‘çš„åœºæ™¯")]),t._v("ã€‚")]),t._v(" "),s("p",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ç±»æ˜¯ "),s("code",[t._v("ReadWriteLock")]),t._v(" æ¥å£çš„å…·ä½“å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯é‡å…¥çš„è¯»å†™é”ã€‚"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼Œå°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚")]),t._v(" "),s("p",[t._v("è¯»å†™é”ï¼Œå¹¶ä¸æ˜¯ Java è¯­è¨€ç‰¹æœ‰çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå¹¿ä¸ºä½¿ç”¨çš„é€šç”¨æŠ€æœ¯ï¼Œæ‰€æœ‰çš„è¯»å†™é”éƒ½éµå®ˆä»¥ä¸‹ä¸‰æ¡åŸºæœ¬åŸåˆ™ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡ï¼›")]),t._v(" "),s("li",[t._v("åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…±äº«å˜é‡ï¼›")]),t._v(" "),s("li",[t._v("å¦‚æœä¸€ä¸ªå†™çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå†™æ“ä½œï¼Œæ­¤æ—¶ç¦æ­¢è¯»çº¿ç¨‹è¯»å…±äº«å˜é‡ã€‚")])]),t._v(" "),s("p",[t._v("è¯»å†™é”ä¸äº’æ–¥é”çš„ä¸€ä¸ªé‡è¦åŒºåˆ«å°±æ˜¯"),s("strong",[t._v("è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡")]),t._v("ï¼Œè€Œäº’æ–¥é”æ˜¯ä¸å…è®¸çš„ï¼Œè¿™æ˜¯è¯»å†™é”åœ¨è¯»å¤šå†™å°‘åœºæ™¯ä¸‹æ€§èƒ½ä¼˜äºäº’æ–¥é”çš„å…³é”®ã€‚ä½†"),s("strong",[t._v("è¯»å†™é”çš„å†™æ“ä½œæ˜¯äº’æ–¥çš„")]),t._v("ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨å†™å…±äº«å˜é‡çš„æ—¶å€™ï¼Œæ˜¯ä¸å…è®¸å…¶ä»–çº¿ç¨‹æ‰§è¡Œå†™æ“ä½œå’Œè¯»æ“ä½œã€‚")]),t._v(" "),s("h3",{attrs:{id:"reentrantreadwritelock-çš„ç‰¹æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock-çš„ç‰¹æ€§"}},[t._v("#")]),t._v(" ReentrantReadWriteLock çš„ç‰¹æ€§")]),t._v(" "),s("p",[t._v("ReentrantReadWriteLock çš„ç‰¹æ€§å¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯")]),t._v("ã€‚å¦‚æœæ˜¯å†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œç”±äº "),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" å…¶å†…éƒ¨å®ç°æ¯” "),s("code",[t._v("ReentrantLock")]),t._v(" å¤æ‚ï¼Œæ€§èƒ½å¯èƒ½åè€Œè¦å·®ä¸€äº›ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚ç”±äº "),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" çš„è¯»å†™é”ï¼ˆ"),s("code",[t._v("ReadLock")]),t._v("ã€"),s("code",[t._v("WriteLock")]),t._v("ï¼‰éƒ½å®ç°äº† "),s("code",[t._v("Lock")]),t._v(" æ¥å£ï¼Œæ‰€ä»¥è¦æ›¿æ¢ä¸º "),s("code",[t._v("ReentrantLock")]),t._v(" ä¹Ÿè¾ƒä¸ºå®¹æ˜“ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" å®ç°äº† "),s("code",[t._v("ReadWriteLock")]),t._v(" æ¥å£ï¼Œæ”¯æŒäº† "),s("code",[t._v("ReentrantLock")]),t._v(" æ‰€ä¸å…·å¤‡çš„è¯»å†™é”åˆ†ç¦»ã€‚"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼ˆ"),s("code",[t._v("ReadLock")]),t._v("ã€"),s("code",[t._v("WriteLock")]),t._v("ï¼‰ã€‚å°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" çš„åŠ é”ç­–ç•¥æ˜¯ï¼š"),s("strong",[t._v("å…è®¸å¤šä¸ªè¯»æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä½†æ¯æ¬¡åªå…è®¸ä¸€ä¸ªå†™æ“ä½œ")]),t._v("ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ä¸ºè¯»å†™é”éƒ½æä¾›äº†å¯é‡å…¥çš„åŠ é”è¯­ä¹‰ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚")])]),t._v(" "),s("p",[s("code",[t._v("ReadWriteLock")]),t._v(" æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReadWriteLock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("readLock")]),t._v(" - è¿”å›ç”¨äºè¯»æ“ä½œçš„é”ï¼ˆ"),s("code",[t._v("ReadLock")]),t._v("ï¼‰ã€‚")]),t._v(" "),s("li",[s("code",[t._v("writeLock")]),t._v(" - è¿”å›ç”¨äºå†™æ“ä½œçš„é”ï¼ˆ"),s("code",[t._v("WriteLock")]),t._v("ï¼‰ã€‚")])]),t._v(" "),s("p",[t._v("åœ¨è¯»å†™é”å’Œå†™å…¥é”ä¹‹é—´çš„äº¤äº’å¯ä»¥é‡‡ç”¨å¤šç§å®ç°æ–¹å¼ï¼Œ"),s("code",[t._v("ReadWriteLock")]),t._v(" çš„ä¸€äº›å¯é€‰å®ç°åŒ…æ‹¬ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("é‡Šæ”¾ä¼˜å…ˆ")]),t._v(" - å½“ä¸€ä¸ªå†™å…¥æ“ä½œé‡Šæ”¾å†™é”ï¼Œå¹¶ä¸”é˜Ÿåˆ—ä¸­åŒæ—¶å­˜åœ¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹ï¼Œé‚£ä¹ˆåº”è¯¥ä¼˜å…ˆé€‰æ‹©è¯»çº¿ç¨‹ã€å†™çº¿ç¨‹ï¼Œè¿˜æ˜¯æœ€å…ˆå‘å‡ºè¯·æ±‚çš„çº¿ç¨‹ï¼Ÿ")]),t._v(" "),s("li",[s("strong",[t._v("è¯»çº¿ç¨‹æ’é˜Ÿ")]),t._v(" - å¦‚æœé”æ˜¯ç”±è¯»çº¿ç¨‹æŒæœ‰ï¼Œä½†æœ‰å†™çº¿ç¨‹æ­£åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆæ–°åˆ°è¾¾çš„è¯»çº¿ç¨‹èƒ½å¦ç«‹å³è·å¾—è®¿é—®æƒï¼Œè¿˜æ˜¯åº”è¯¥åœ¨å†™çº¿ç¨‹åé¢ç­‰å¾…ï¼Ÿå¦‚æœå…è®¸è¯»çº¿ç¨‹æ’é˜Ÿåˆ°å†™çº¿ç¨‹ä¹‹å‰ï¼Œé‚£ä¹ˆå°†æé«˜å¹¶å‘æ€§ï¼Œä½†å¯èƒ½é€ æˆçº¿ç¨‹é¥¥é¥¿é—®é¢˜ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("é‡å…¥æ€§")]),t._v(" - è¯»é”å’Œå†™é”æ˜¯å¦æ˜¯å¯é‡å…¥çš„ï¼Ÿ")]),t._v(" "),s("li",[s("strong",[t._v("é™çº§")]),t._v(" - å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™å…¥é”ï¼Œé‚£ä¹ˆå®ƒèƒ½å¦åœ¨ä¸é‡Šæ”¾è¯¥é”çš„æƒ…å†µä¸‹è·å¾—è¯»é”ï¼Ÿè¿™å¯èƒ½ä¼šä½¿å¾—å†™é”è¢«é™çº§ä¸ºè¯»é”ï¼ŒåŒæ—¶ä¸å…è®¸å…¶ä»–å†™çº¿ç¨‹ä¿®æ”¹è¢«ä¿æŠ¤çš„èµ„æºã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å‡çº§")]),t._v(" - è¯»é”èƒ½å¦ä¼˜å…ˆäºå…¶ä»–æ­£åœ¨ç­‰å¾…çš„è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹è€Œå‡çº§ä¸ºä¸€ä¸ªå†™é”ï¼Ÿåœ¨å¤§å¤šæ•°çš„è¯»å†™é”å®ç°ä¸­å¹¶ä¸æ”¯æŒå‡çº§ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æ˜¾å¼çš„å‡çº§æ“ä½œï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“é€ æˆæ­»é”ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"reentrantreadwritelock-çš„ç”¨æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock-çš„ç”¨æ³•"}},[t._v("#")]),t._v(" ReentrantReadWriteLock çš„ç”¨æ³•")]),t._v(" "),s("p",[t._v("å‰æ–‡äº†è§£äº† "),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è®²è¿°å…¶å…·ä½“ç”¨æ³•ã€‚")]),t._v(" "),s("h4",{attrs:{id:"reentrantreadwritelock-çš„æ„é€ æ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock-çš„æ„é€ æ–¹æ³•"}},[t._v("#")]),t._v(" ReentrantReadWriteLock çš„æ„é€ æ–¹æ³•")]),t._v(" "),s("p",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" å’Œ "),s("code",[t._v("ReentrantLock")]),t._v(" ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸”ç”¨æ³•ç›¸ä¼¼ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" fair"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("ReentrantReadWriteLock()")]),t._v(" - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª"),s("strong",[t._v("éå…¬å¹³é”ï¼ˆNonfairSyncï¼‰")]),t._v("ã€‚åœ¨éå…¬å¹³çš„é”ä¸­ï¼Œçº¿ç¨‹è·å¾—é”çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚å†™çº¿ç¨‹é™çº§ä¸ºè¯»çº¿ç¨‹æ˜¯å¯ä»¥çš„ï¼Œä½†è¯»çº¿ç¨‹å‡çº§ä¸ºå†™çº¿ç¨‹æ˜¯ä¸å¯ä»¥çš„ï¼ˆè¿™æ ·ä¼šå¯¼è‡´æ­»é”ï¼‰ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ReentrantReadWriteLock(boolean)")]),t._v(" - "),s("code",[t._v("new ReentrantLock(true)")]),t._v(" ä¼šåˆå§‹åŒ–ä¸€ä¸ª"),s("strong",[t._v("å…¬å¹³é”ï¼ˆFairSyncï¼‰")]),t._v("ã€‚å¯¹äºå…¬å¹³é”ï¼Œç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹å°†ä¼˜å…ˆè·å¾—é”ã€‚å¦‚æœè¿™ä¸ªé”æ˜¯è¯»çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å¦ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™é”ï¼Œé‚£ä¹ˆå…¶ä»–è¯»çº¿ç¨‹éƒ½ä¸èƒ½è·å¾—è¯»é”ï¼Œç›´åˆ°å†™çº¿ç¨‹é‡Šæ”¾å†™é”ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"reentrantreadwritelock-çš„ä½¿ç”¨å®ä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock-çš„ä½¿ç”¨å®ä¾‹"}},[t._v("#")]),t._v(" ReentrantReadWriteLock çš„ä½¿ç”¨å®ä¾‹")]),t._v(" "),s("p",[t._v("åœ¨ "),s("a",{attrs:{href:"#reentrantreadwritelock-%E7%9A%84%E7%89%B9%E6%80%A7"}},[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" çš„ç‰¹æ€§")]),t._v(" ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œ"),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" çš„è¯»å†™é”ï¼ˆ"),s("code",[t._v("ReadLock")]),t._v("ã€"),s("code",[t._v("WriteLock")]),t._v("ï¼‰éƒ½å®ç°äº† "),s("code",[t._v("Lock")]),t._v(" æ¥å£ï¼Œæ‰€ä»¥å…¶å„è‡ªç‹¬ç«‹çš„ä½¿ç”¨æ–¹å¼ä¸ "),s("code",[t._v("ReentrantLock")]),t._v(" ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚")]),t._v(" "),s("p",[s("code",[t._v("ReentrantReadWriteLock")]),t._v(" ä¸ "),s("code",[t._v("ReentrantLock")]),t._v(" ç”¨æ³•ä¸Šçš„å·®å¼‚ï¼Œä¸»è¦åœ¨äºè¯»å†™é”çš„é…åˆä½¿ç”¨ã€‚æœ¬æ–‡ä»¥ä¸€ä¸ªå…¸å‹ä½¿ç”¨åœºæ™¯æ¥è¿›è¡Œè®²è§£ã€‚")]),t._v(" "),s("p",[t._v("ã€ç¤ºä¾‹ã€‘åŸºäº "),s("code",[t._v("ReadWriteLock")]),t._v(" å®ç°ä¸€ä¸ªç®€å•çš„æ³›å‹æ— ç•Œç¼“å­˜")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * ç®€å•çš„æ— ç•Œç¼“å­˜å®ç°\n * <p>\n * ä½¿ç”¨ WeakHashMap å­˜å‚¨é”®å€¼å¯¹ã€‚WeakHashMap ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼ŒJVM GC æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnboundedCache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" cacheMap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WeakHashMap")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReadWriteLock")]),t._v(" cacheLock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cacheMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s è¯»æ•°æ® %s:%s"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            cacheMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" log "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s å†™å…¥æ•°æ® %s:%s"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("K")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cacheMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cacheMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            cacheLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("è¯´æ˜ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨ "),s("code",[t._v("WeakHashMap")]),t._v(" è€Œä¸æ˜¯ "),s("code",[t._v("HashMap")]),t._v(" æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚"),s("code",[t._v("WeakHashMap")]),t._v(" ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼ŒJVM GC æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚")]),t._v(" "),s("li",[t._v("å‘ "),s("code",[t._v("Map")]),t._v(" å†™æ•°æ®å‰åŠ å†™é”ï¼Œå†™å®Œåï¼Œé‡Šæ”¾å†™é”ã€‚")]),t._v(" "),s("li",[t._v("å‘ "),s("code",[t._v("Map")]),t._v(" è¯»æ•°æ®å‰åŠ è¯»é”ï¼Œè¯»å®Œåï¼Œé‡Šæ”¾è¯»é”ã€‚")])]),t._v(" "),s("p",[t._v("æµ‹è¯•å…¶çº¿ç¨‹å®‰å…¨æ€§ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n * @author <a href="mailto:forbreak@163.com">Zhang Peng</a>\n * @since 2020-01-01\n */')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLockDemo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnboundedCache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnboundedCache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" executorService "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newCachedThreadPool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            executorService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        executorService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** çº¿ç¨‹ä»»åŠ¡æ¯æ¬¡å‘ç¼“å­˜ä¸­å†™å…¥ 3 ä¸ªéšæœºå€¼ï¼Œkey å›ºå®š */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyThread")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Random")]),t._v(" random "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Random")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" random"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextInt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("è¯´æ˜ï¼šç¤ºä¾‹ä¸­ï¼Œé€šè¿‡çº¿ç¨‹æ± å¯åŠ¨ 20 ä¸ªå¹¶å‘ä»»åŠ¡ã€‚ä»»åŠ¡æ¯æ¬¡å‘ç¼“å­˜ä¸­å†™å…¥ 3 ä¸ªéšæœºå€¼ï¼Œkey å›ºå®šï¼›ç„¶åä¸»çº¿ç¨‹æ¯æ¬¡å›ºå®šè¯»å–ç¼“å­˜ä¸­ç¬¬ä¸€ä¸ª key çš„å€¼ã€‚")]),t._v(" "),s("p",[t._v("è¾“å‡ºç»“æœï¼š")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("main è¯»æ•°æ® 0:null\npool-1-thread-1 å†™å…¥æ•°æ® 0:16\npool-1-thread-1 å†™å…¥æ•°æ® 1:58\npool-1-thread-1 å†™å…¥æ•°æ® 2:50\nmain è¯»æ•°æ® 0:16\npool-1-thread-1 å†™å…¥æ•°æ® 0:85\npool-1-thread-1 å†™å…¥æ•°æ® 1:76\npool-1-thread-1 å†™å…¥æ•°æ® 2:46\npool-1-thread-2 å†™å…¥æ•°æ® 0:21\npool-1-thread-2 å†™å…¥æ•°æ® 1:41\npool-1-thread-2 å†™å…¥æ•°æ® 2:63\nmain è¯»æ•°æ® 0:21\nmain è¯»æ•°æ® 0:21\n// ...\n")])])]),s("h3",{attrs:{id:"reentrantreadwritelock-çš„åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock-çš„åŸç†"}},[t._v("#")]),t._v(" ReentrantReadWriteLock çš„åŸç†")]),t._v(" "),s("p",[t._v("å‰é¢äº†è§£äº† "),s("code",[t._v("ReentrantLock")]),t._v(" çš„åŸç†ï¼Œç†è§£ "),s("code",[t._v("ReentrantReadWriteLock")]),t._v(" å°±å®¹æ˜“å¤šäº†ã€‚")]),t._v(" "),s("h4",{attrs:{id:"reentrantreadwritelock-çš„æ•°æ®ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock-çš„æ•°æ®ç»“æ„"}},[t._v("#")]),t._v(" ReentrantReadWriteLock çš„æ•°æ®ç»“æ„")]),t._v(" "),s("p",[t._v("é˜…è¯» ReentrantReadWriteLock çš„æºç ï¼Œå¯ä»¥å‘ç°å®ƒæœ‰ä¸‰ä¸ªæ ¸å¿ƒå­—æ®µï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** Inner class providing readlock */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ReadLock")]),t._v(" readerLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** Inner class providing writelock */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WriteLock")]),t._v(" writerLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** Performs all synchronization mechanics */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sync")]),t._v(" sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WriteLock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" writerLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReentrantReadWriteLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ReadLock")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" readerLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("sync")]),t._v(" - å†…éƒ¨ç±» "),s("code",[t._v("ReentrantReadWriteLock.Sync")]),t._v(" å¯¹è±¡ã€‚ä¸ "),s("code",[t._v("ReentrantLock")]),t._v(" ç±»ä¼¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š"),s("code",[t._v("ReentrantReadWriteLock.FairSync")]),t._v(" å’Œ "),s("code",[t._v("ReentrantReadWriteLock.NonfairSync")]),t._v(" ï¼Œåˆ†åˆ«è¡¨ç¤ºå…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚")]),t._v(" "),s("li",[s("code",[t._v("readerLock")]),t._v(" - å†…éƒ¨ç±» "),s("code",[t._v("ReentrantReadWriteLock.ReadLock")]),t._v(" å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠè¯»é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("writerLock")]),t._v(" - å†…éƒ¨ç±» "),s("code",[t._v("ReentrantReadWriteLock.WriteLock")]),t._v(" å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠå†™é”ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"reentrantreadwritelock-çš„è·å–é”å’Œé‡Šæ”¾é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reentrantreadwritelock-çš„è·å–é”å’Œé‡Šæ”¾é”"}},[t._v("#")]),t._v(" ReentrantReadWriteLock çš„è·å–é”å’Œé‡Šæ”¾é”")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReadLock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("Serializable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨ AQS è·å–å…±äº«é”æ–¹æ³•")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨ AQS é‡Šæ”¾å…±äº«é”æ–¹æ³•")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("releaseShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WriteLock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("Serializable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³•")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒç”¨ AQS é‡Šæ”¾ç‹¬å é”æ–¹æ³•")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("release")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"stampedlock"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stampedlock"}},[t._v("#")]),t._v(" StampedLock")]),t._v(" "),s("p",[t._v("ReadWriteLock æ”¯æŒä¸¤ç§æ¨¡å¼ï¼šä¸€ç§æ˜¯è¯»é”ï¼Œä¸€ç§æ˜¯å†™é”ã€‚è€Œ StampedLock æ”¯æŒä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š"),s("strong",[t._v("å†™é”")]),t._v("ã€"),s("strong",[t._v("æ‚²è§‚è¯»é”")]),t._v("å’Œ"),s("strong",[t._v("ä¹è§‚è¯»")]),t._v("ã€‚å…¶ä¸­ï¼Œå†™é”ã€æ‚²è§‚è¯»é”çš„è¯­ä¹‰å’Œ ReadWriteLock çš„å†™é”ã€è¯»é”çš„è¯­ä¹‰éå¸¸ç±»ä¼¼ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–æ‚²è§‚è¯»é”ï¼Œä½†æ˜¯åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”ï¼Œå†™é”å’Œæ‚²è§‚è¯»é”æ˜¯äº’æ–¥çš„ã€‚ä¸åŒçš„æ˜¯ï¼šStampedLock é‡Œçš„å†™é”å’Œæ‚²è§‚è¯»é”åŠ é”æˆåŠŸä¹‹åï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª stampï¼›ç„¶åè§£é”çš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥è¿™ä¸ª stampã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("æ³¨æ„è¿™é‡Œï¼Œç”¨çš„æ˜¯â€œä¹è§‚è¯»â€è¿™ä¸ªè¯ï¼Œè€Œä¸æ˜¯â€œä¹è§‚è¯»é”â€ï¼Œæ˜¯è¦æé†’ä½ ï¼Œ"),s("strong",[t._v("ä¹è§‚è¯»è¿™ä¸ªæ“ä½œæ˜¯æ— é”çš„")]),t._v("ï¼Œæ‰€ä»¥ç›¸æ¯”è¾ƒ ReadWriteLock çš„è¯»é”ï¼Œä¹è§‚è¯»çš„æ€§èƒ½æ›´å¥½ä¸€äº›ã€‚")])]),t._v(" "),s("p",[t._v("StampedLock çš„æ€§èƒ½ä¹‹æ‰€ä»¥æ¯” ReadWriteLock è¿˜è¦å¥½ï¼Œå…¶å…³é”®æ˜¯ "),s("strong",[t._v("StampedLock æ”¯æŒä¹è§‚è¯»")]),t._v("çš„æ–¹å¼ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("ReadWriteLock æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†æ˜¯å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å†™æ“ä½œä¼šè¢«é˜»å¡ï¼›")]),t._v(" "),s("li",[t._v("è€Œ StampedLock æä¾›çš„ä¹è§‚è¯»ï¼Œæ˜¯å…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯æ‰€æœ‰çš„å†™æ“ä½œéƒ½è¢«é˜»å¡ã€‚")])]),t._v(" "),s("p",[t._v("å¯¹äºè¯»å¤šå†™å°‘çš„åœºæ™¯ StampedLock æ€§èƒ½å¾ˆå¥½ï¼Œç®€å•çš„åº”ç”¨åœºæ™¯åŸºæœ¬ä¸Šå¯ä»¥æ›¿ä»£ ReadWriteLockï¼Œä½†æ˜¯"),s("strong",[t._v("StampedLock çš„åŠŸèƒ½ä»…ä»…æ˜¯ ReadWriteLock çš„å­é›†")]),t._v("ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜æ˜¯æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("StampedLock ä¸æ”¯æŒé‡å…¥")])]),t._v(" "),s("li",[t._v("StampedLock çš„æ‚²è§‚è¯»é”ã€å†™é”éƒ½ä¸æ”¯æŒæ¡ä»¶å˜é‡ã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœçº¿ç¨‹é˜»å¡åœ¨ StampedLock çš„ readLock() æˆ–è€… writeLock() ä¸Šæ—¶ï¼Œæ­¤æ—¶è°ƒç”¨è¯¥é˜»å¡çº¿ç¨‹çš„ interrupt() æ–¹æ³•ï¼Œä¼šå¯¼è‡´ CPU é£™å‡ã€‚"),s("strong",[t._v("ä½¿ç”¨ StampedLock ä¸€å®šä¸è¦è°ƒç”¨ä¸­æ–­æ“ä½œï¼Œå¦‚æœéœ€è¦æ”¯æŒä¸­æ–­åŠŸèƒ½ï¼Œä¸€å®šä½¿ç”¨å¯ä¸­æ–­çš„æ‚²è§‚è¯»é” readLockInterruptibly() å’Œå†™é” writeLockInterruptibly()")]),t._v("ã€‚")])]),t._v(" "),s("p",[t._v("ã€ç¤ºä¾‹ã€‘StampedLock é˜»å¡æ—¶ï¼Œè°ƒç”¨ interrupt() å¯¼è‡´ CPU é£™å‡")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StampedLock")]),t._v(" lock\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StampedLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–å†™é”")]),t._v("\n  lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ°¸è¿œé˜»å¡åœ¨æ­¤å¤„ï¼Œä¸é‡Šæ”¾å†™é”")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockSupport")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("park")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¿è¯ T1 è·å–å†™é”")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é˜»å¡åœ¨æ‚²è§‚è¯»é”")]),t._v("\n  lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¿è¯ T2 é˜»å¡åœ¨è¯»é”")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸­æ–­çº¿ç¨‹ T2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¼šå¯¼è‡´çº¿ç¨‹ T2 æ‰€åœ¨ CPU é£™å‡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("interrupt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("ã€ç¤ºä¾‹ã€‘StampedLock è¯»æ¨¡æ¿ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StampedLock")]),t._v(" sl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StampedLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¹è§‚è¯»")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" stamp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  sl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryOptimisticRead")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ ¡éªŒ stamp")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("sl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("validate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stamp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‡çº§ä¸ºæ‚²è§‚è¯»é”")]),t._v("\n  stamp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é‡Šæ”¾æ‚²è§‚è¯»é”")]),t._v("\n    sl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlockRead")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stamp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä½¿ç”¨æ–¹æ³•å±€éƒ¨å˜é‡æ‰§è¡Œä¸šåŠ¡æ“ä½œ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[t._v("ã€ç¤ºä¾‹ã€‘StampedLock å†™æ¨¡æ¿ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" stamp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å†™å…±äº«å˜é‡")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  sl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlockWrite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stamp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"aqs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aqs"}},[t._v("#")]),t._v(" AQS")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("AbstractQueuedSynchronizer")]),t._v("ï¼ˆç®€ç§° "),s("strong",[t._v("AQS")]),t._v("ï¼‰æ˜¯"),s("strong",[t._v("é˜Ÿåˆ—åŒæ­¥å™¨")]),t._v("ï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¤„ç†åŒæ­¥ã€‚å®ƒæ˜¯å¹¶å‘é”å’Œå¾ˆå¤šåŒæ­¥å·¥å…·ç±»çš„å®ç°åŸºçŸ³ï¼ˆå¦‚ "),s("code",[t._v("ReentrantLock")]),t._v("ã€"),s("code",[t._v("ReentrantReadWriteLock")]),t._v("ã€"),s("code",[t._v("CountDownLatch")]),t._v("ã€"),s("code",[t._v("Semaphore")]),t._v("ã€"),s("code",[t._v("FutureTask")]),t._v(" ç­‰ï¼‰ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"aqs-çš„è¦ç‚¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aqs-çš„è¦ç‚¹"}},[t._v("#")]),t._v(" AQS çš„è¦ç‚¹")]),t._v(" "),s("p",[s("strong",[t._v("AQS æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒ")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("åœ¨ "),s("code",[t._v("java.util.concurrent.locks")]),t._v(" åŒ…ä¸­çš„ç›¸å…³é”ï¼ˆå¸¸ç”¨çš„æœ‰ "),s("code",[t._v("ReentrantLock")]),t._v("ã€ "),s("code",[t._v("ReadWriteLock")]),t._v("ï¼‰éƒ½æ˜¯åŸºäº AQS æ¥å®ç°ã€‚è¿™äº›é”éƒ½æ²¡æœ‰ç›´æ¥ç»§æ‰¿ AQSï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ª "),s("code",[t._v("Sync")]),t._v(" ç±»å»ç»§æ‰¿ AQSã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿå› ä¸ºé”é¢å‘çš„æ˜¯ä½¿ç”¨ç”¨æˆ·ï¼Œè€ŒåŒæ­¥å™¨é¢å‘çš„åˆ™æ˜¯çº¿ç¨‹æ§åˆ¶ï¼Œé‚£ä¹ˆåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨è€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿ AQS å°±å¯ä»¥å¾ˆå¥½çš„éš”ç¦»äºŒè€…æ‰€å…³æ³¨çš„äº‹æƒ…ã€‚")]),t._v(" "),s("h3",{attrs:{id:"aqs-çš„åº”ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aqs-çš„åº”ç”¨"}},[t._v("#")]),t._v(" AQS çš„åº”ç”¨")]),t._v(" "),s("p",[s("strong",[t._v("AQS æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒ")]),t._v("ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç‹¬äº«é”-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç‹¬äº«é”-api"}},[t._v("#")]),t._v(" ç‹¬äº«é” API")]),t._v(" "),s("p",[t._v("è·å–ã€é‡Šæ”¾ç‹¬äº«é”çš„ä¸»è¦ API å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireInterruptibly")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquireNanos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" nanosTimeout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("release")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("acquire")]),t._v(" - è·å–ç‹¬å é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("acquireInterruptibly")]),t._v(" - è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("tryAcquireNanos")]),t._v(" - å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚åœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹å›è¿”å›ï¼š\n"),s("ul",[s("li",[t._v("åœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè·å–äº†é”ï¼›")]),t._v(" "),s("li",[t._v("å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­ï¼›")]),t._v(" "),s("li",[t._v("è¶…æ—¶æ—¶é—´ç»“æŸï¼Œä»æœªè·å¾—é”è¿”å› falseã€‚")])])]),t._v(" "),s("li",[s("code",[t._v("release")]),t._v(" - é‡Šæ”¾ç‹¬å é”ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"å…±äº«é”-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…±äº«é”-api"}},[t._v("#")]),t._v(" å…±äº«é” API")]),t._v(" "),s("p",[t._v("è·å–ã€é‡Šæ”¾å…±äº«é”çš„ä¸»è¦ API å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireSharedInterruptibly")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquireSharedNanos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" nanosTimeout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("releaseShared")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("acquireShared")]),t._v(" - è·å–å…±äº«é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("acquireSharedInterruptibly")]),t._v(" - è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("tryAcquireSharedNanos")]),t._v(" - å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚")]),t._v(" "),s("li",[s("code",[t._v("release")]),t._v(" - é‡Šæ”¾å…±äº«é”ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"aqs-çš„åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aqs-çš„åŸç†"}},[t._v("#")]),t._v(" AQS çš„åŸç†")]),t._v(" "),s("blockquote",[s("p",[t._v("ASQ åŸç†è¦ç‚¹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ "),s("code",[t._v("volatile")]),t._v(" å˜é‡æ¥ "),s("strong",[t._v("ç»´æŠ¤åŒæ­¥çŠ¶æ€")]),t._v("ã€‚çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»èµ‹äºˆã€‚")]),t._v(" "),s("li",[t._v("AQS ç»´æŠ¤äº†ä¸€ä¸ª FIFO çš„åŒé“¾è¡¨ï¼Œç”¨æ¥å­˜å‚¨è·å–é”å¤±è´¥çš„çº¿ç¨‹ã€‚")])]),t._v(" "),s("p",[t._v("AQS å›´ç»•åŒæ­¥çŠ¶æ€æä¾›ä¸¤ç§åŸºæœ¬æ“ä½œâ€œè·å–â€å’Œâ€œé‡Šæ”¾â€ï¼Œå¹¶æä¾›ä¸€ç³»åˆ—åˆ¤æ–­å’Œå¤„ç†æ–¹æ³•ï¼Œç®€å•è¯´å‡ ç‚¹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("state æ˜¯ç‹¬å çš„ï¼Œè¿˜æ˜¯å…±äº«çš„ï¼›")]),t._v(" "),s("li",[t._v("state è¢«è·å–åï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼›")]),t._v(" "),s("li",[t._v("state è¢«é‡Šæ”¾åï¼Œå”¤é†’ç­‰å¾…çº¿ç¨‹ï¼›")]),t._v(" "),s("li",[t._v("çº¿ç¨‹ç­‰ä¸åŠæ—¶ï¼Œå¦‚ä½•é€€å‡ºç­‰å¾…ã€‚")])]),t._v(" "),s("p",[t._v("è‡³äºçº¿ç¨‹æ˜¯å¦å¯ä»¥è·å¾— stateï¼Œå¦‚ä½•é‡Šæ”¾ stateï¼Œå°±ä¸æ˜¯ AQS å…³å¿ƒçš„äº†ï¼Œè¦ç”±å­ç±»å…·ä½“å®ç°ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"aqs-çš„æ•°æ®ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aqs-çš„æ•°æ®ç»“æ„"}},[t._v("#")]),t._v(" AQS çš„æ•°æ®ç»“æ„")]),t._v(" "),s("p",[t._v("é˜…è¯» AQS çš„æºç ï¼Œå¯ä»¥å‘ç°ï¼šAQS ç»§æ‰¿è‡ª "),s("code",[t._v("AbstractOwnableSynchronize")]),t._v("ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractQueuedSynchronizer")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractOwnableSynchronizer")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("Serializable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå¤´ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ setHead æ–¹æ³•ä¿®æ”¹ã€‚ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("transient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ enq æ–¹æ³•æ·»åŠ æ–°çš„ç­‰å¾…èŠ‚ç‚¹ã€‚*/")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("transient")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" tail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** åŒæ­¥çŠ¶æ€ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("state")]),t._v(" - AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ "),s("code",[t._v("volatile")]),t._v(" å˜é‡æ¥ "),s("strong",[t._v("ç»´æŠ¤åŒæ­¥çŠ¶æ€")]),t._v("ã€‚\n"),s("ul",[s("li",[t._v("è¿™ä¸ªæ•´æ•°çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»æ¥èµ‹äºˆï¼Œå¦‚"),s("code",[t._v("ReentrantLock")]),t._v(" ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºæ‰€æœ‰è€…çº¿ç¨‹å·²ç»é‡å¤è·å–è¯¥é”çš„æ¬¡æ•°ï¼Œ"),s("code",[t._v("Semaphore")]),t._v(" ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºå‰©ä½™çš„è®¸å¯æ•°é‡ã€‚")])])]),t._v(" "),s("li",[s("code",[t._v("head")]),t._v(" å’Œ "),s("code",[t._v("tail")]),t._v(" - AQS "),s("strong",[t._v("ç»´æŠ¤äº†ä¸€ä¸ª "),s("code",[t._v("Node")]),t._v(" ç±»å‹ï¼ˆAQS çš„å†…éƒ¨ç±»ï¼‰çš„åŒé“¾è¡¨æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†")]),t._v("ã€‚è¿™ä¸ªåŒé“¾è¡¨æ˜¯ä¸€ä¸ªåŒå‘çš„ FIFO é˜Ÿåˆ—ï¼Œé€šè¿‡ "),s("code",[t._v("head")]),t._v(" å’Œ "),s("code",[t._v("tail")]),t._v(" æŒ‡é’ˆè¿›è¡Œè®¿é—®ã€‚å½“ "),s("strong",[t._v("æœ‰çº¿ç¨‹è·å–é”å¤±è´¥åï¼Œå°±è¢«æ·»åŠ åˆ°é˜Ÿåˆ—æœ«å°¾")]),t._v("ã€‚")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_1.png",alt:"img"}})]),t._v(" "),s("p",[t._v("å†æ¥çœ‹ä¸€ä¸‹ "),s("code",[t._v("Node")]),t._v(" çš„æºç ")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºå…±äº«æ¨¡å¼ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SHARED")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºç‹¬å æ¨¡å¼ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXCLUSIVE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** çº¿ç¨‹ç­‰å¾…çŠ¶æ€ï¼ŒçŠ¶æ€å€¼æœ‰: 0ã€1ã€-1ã€-2ã€-3 */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" waitStatus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CANCELLED")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SIGNAL")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONDITION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PROPAGATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** å‰é©±èŠ‚ç‚¹ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" prev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** åç»§èŠ‚ç‚¹ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** ç­‰å¾…é”çš„çº¿ç¨‹ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" thread"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** å’ŒèŠ‚ç‚¹æ˜¯å¦å…±äº«æœ‰å…³ */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Node")]),t._v(" nextWaiter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("å¾ˆæ˜¾ç„¶ï¼ŒNode æ˜¯ä¸€ä¸ªåŒé“¾è¡¨ç»“æ„ã€‚")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("waitStatus")]),t._v(" - "),s("code",[t._v("Node")]),t._v(" ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ "),s("code",[t._v("volatile")]),t._v(" å˜é‡æ¥ ç»´æŠ¤ AQS åŒæ­¥é˜Ÿåˆ—ä¸­çº¿ç¨‹èŠ‚ç‚¹çš„çŠ¶æ€ã€‚"),s("code",[t._v("waitStatus")]),t._v(" æœ‰äº”ä¸ªçŠ¶æ€å€¼ï¼š\n"),s("ul",[s("li",[s("code",[t._v("CANCELLED(1)")]),t._v(" - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹å¯èƒ½ç”±äºè¶…æ—¶æˆ–è¢«ä¸­æ–­è€Œ "),s("strong",[t._v("å¤„äºè¢«å–æ¶ˆ(ä½œåºŸ)çŠ¶æ€")]),t._v("ï¼Œä¸€æ—¦å¤„äºè¿™ä¸ªçŠ¶æ€ï¼Œè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹åº”è¯¥ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚")]),t._v(" "),s("li",[s("code",[t._v("SIGNAL(-1)")]),t._v(" - æ­¤çŠ¶æ€è¡¨ç¤ºï¼š"),s("strong",[t._v("åç»§èŠ‚ç‚¹ä¼šè¢«æŒ‚èµ·")]),t._v("ï¼Œå› æ­¤åœ¨å½“å‰èŠ‚ç‚¹é‡Šæ”¾é”æˆ–è¢«å–æ¶ˆä¹‹åï¼Œå¿…é¡»å”¤é†’("),s("code",[t._v("unparking")]),t._v(")å…¶åç»§ç»“ç‚¹ã€‚")]),t._v(" "),s("li",[s("code",[t._v("CONDITION(-2)")]),t._v(" - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ "),s("strong",[t._v("å¤„äºç­‰å¾…æ¡ä»¶çŠ¶æ€")]),t._v("ï¼Œä¸ä¼šè¢«å½“ä½œæ˜¯åŒæ­¥é˜Ÿåˆ—ä¸Šçš„èŠ‚ç‚¹ï¼Œç›´åˆ°è¢«å”¤é†’("),s("code",[t._v("signal")]),t._v(")ï¼Œè®¾ç½®å…¶å€¼ä¸º 0ï¼Œå†é‡æ–°è¿›å…¥é˜»å¡çŠ¶æ€ã€‚")]),t._v(" "),s("li",[s("code",[t._v("PROPAGATE(-3)")]),t._v(" - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šä¸‹ä¸€ä¸ª "),s("code",[t._v("acquireShared")]),t._v(" åº”æ— æ¡ä»¶ä¼ æ’­ã€‚")]),t._v(" "),s("li",[t._v("0 - éä»¥ä¸ŠçŠ¶æ€ã€‚")])])])]),t._v(" "),s("h4",{attrs:{id:"ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾"}},[t._v("#")]),t._v(" ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾")]),t._v(" "),s("h5",{attrs:{id:"è·å–ç‹¬å é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–ç‹¬å é”"}},[t._v("#")]),t._v(" è·å–ç‹¬å é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("acquire(int arg)")]),t._v(" æ–¹æ³•è·å–ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("å…ˆå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼ŒAQS ä¼šä¸æ–­å°è¯•åˆ©ç”¨ CAS æ“ä½œå°†å½“å‰çº¿ç¨‹æ’å…¥ç­‰å¾…åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚")]),t._v(" "),s("li",[t._v("æ¥ç€ï¼Œä¸æ–­å°è¯•ä¸ºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹èŠ‚ç‚¹è·å–ç‹¬å é”ã€‚")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_2.png",alt:"img"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_3.png",alt:"img"}})]),t._v(" "),s("p",[t._v("è¯¦ç»†æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼Œè¯·ç»“åˆæºç æ¥ç†è§£ï¼ˆä¸€å›¾èƒœåƒè¨€ï¼‰ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/master/cs/java/javacore/concurrent/aqs_4.png",alt:"img"}})]),t._v(" "),s("h5",{attrs:{id:"é‡Šæ”¾ç‹¬å é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é‡Šæ”¾ç‹¬å é”"}},[t._v("#")]),t._v(" é‡Šæ”¾ç‹¬å é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("release(int arg)")]),t._v(" æ–¹æ³•é‡Šæ”¾ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("å…ˆå°è¯•è·å–è§£é”çº¿ç¨‹çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼ŒAQS ä¼šå°è¯•å”¤é†’å½“å‰çº¿ç¨‹èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚")])]),t._v(" "),s("h5",{attrs:{id:"è·å–å¯ä¸­æ–­çš„ç‹¬å é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–å¯ä¸­æ–­çš„ç‹¬å é”"}},[t._v("#")]),t._v(" è·å–å¯ä¸­æ–­çš„ç‹¬å é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("acquireInterruptibly(int arg)")]),t._v(" æ–¹æ³•è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚")]),t._v(" "),s("p",[s("code",[t._v("acquireInterruptibly(int arg)")]),t._v(" å®ç°æ–¹å¼"),s("strong",[t._v("ç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ "),s("code",[t._v("acquire")]),t._v("ï¼‰éå¸¸ç›¸ä¼¼")]),t._v("ï¼ŒåŒºåˆ«ä»…åœ¨äºå®ƒä¼š"),s("strong",[t._v("é€šè¿‡ "),s("code",[t._v("Thread.interrupted")]),t._v(" æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­")]),t._v("ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç«‹å³æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼ˆ"),s("code",[t._v("InterruptedException")]),t._v("ï¼‰ã€‚")]),t._v(" "),s("h5",{attrs:{id:"è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”"}},[t._v("#")]),t._v(" è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("tryAcquireNanos(int arg)")]),t._v(" æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…çš„ç‹¬å é”ã€‚")]),t._v(" "),s("p",[t._v("doAcquireNanos çš„å®ç°æ–¹å¼ "),s("strong",[t._v("ç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ "),s("code",[t._v("acquire")]),t._v("ï¼‰éå¸¸ç›¸ä¼¼")]),t._v("ï¼ŒåŒºåˆ«åœ¨äºå®ƒä¼šæ ¹æ®è¶…æ—¶æ—¶é—´å’Œå½“å‰æ—¶é—´è®¡ç®—å‡ºæˆªæ­¢æ—¶é—´ã€‚åœ¨è·å–é”çš„æµç¨‹ä¸­ï¼Œä¼šä¸æ–­åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œç›´æ¥è¿”å› falseï¼›å¦‚æœæ²¡è¶…æ—¶ï¼Œåˆ™ç”¨ "),s("code",[t._v("LockSupport.parkNanos")]),t._v(" æ¥é˜»å¡å½“å‰çº¿ç¨‹ã€‚")]),t._v(" "),s("h4",{attrs:{id:"å…±äº«é”çš„è·å–å’Œé‡Šæ”¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…±äº«é”çš„è·å–å’Œé‡Šæ”¾"}},[t._v("#")]),t._v(" å…±äº«é”çš„è·å–å’Œé‡Šæ”¾")]),t._v(" "),s("h5",{attrs:{id:"è·å–å…±äº«é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–å…±äº«é”"}},[t._v("#")]),t._v(" è·å–å…±äº«é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("acquireShared(int arg)")]),t._v(" æ–¹æ³•è·å–å…±äº«é”ã€‚")]),t._v(" "),s("p",[s("code",[t._v("acquireShared")]),t._v(" æ–¹æ³•å’Œ "),s("code",[t._v("acquire")]),t._v(" æ–¹æ³•çš„é€»è¾‘å¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè‡ªæ—‹çš„æ¡ä»¶ä»¥åŠèŠ‚ç‚¹å‡ºé˜Ÿçš„æ“ä½œæœ‰æ‰€ä¸åŒã€‚")]),t._v(" "),s("p",[t._v("æˆåŠŸè·å¾—å…±äº«é”çš„æ¡ä»¶å¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("tryAcquireShared(arg)")]),t._v(" è¿”å›å€¼å¤§äºç­‰äº 0 ï¼ˆè¿™æ„å‘³ç€å…±äº«é”çš„ permit è¿˜æ²¡æœ‰ç”¨å®Œï¼‰ã€‚")]),t._v(" "),s("li",[t._v("å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ã€‚")])]),t._v(" "),s("h5",{attrs:{id:"é‡Šæ”¾å…±äº«é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é‡Šæ”¾å…±äº«é”"}},[t._v("#")]),t._v(" é‡Šæ”¾å…±äº«é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("releaseShared(int arg)")]),t._v(" æ–¹æ³•é‡Šæ”¾å…±äº«é”ã€‚")]),t._v(" "),s("p",[s("code",[t._v("releaseShared")]),t._v(" é¦–å…ˆä¼šå°è¯•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è§£é”ä¸€ä¸ªæˆ–å¤šä¸ªåç»§çº¿ç¨‹èŠ‚ç‚¹ã€‚é‡Šæ”¾å…±äº«é”å’Œé‡Šæ”¾ç‹¬äº«é”æµç¨‹å¤§ä½“ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š")]),t._v(" "),s("p",[t._v("å¯¹äºç‹¬äº«æ¨¡å¼ï¼Œå¦‚æœéœ€è¦ SIGNALï¼Œé‡Šæ”¾ä»…ç›¸å½“äºè°ƒç”¨å¤´èŠ‚ç‚¹çš„ "),s("code",[t._v("unparkSuccessor")]),t._v("ã€‚")]),t._v(" "),s("h5",{attrs:{id:"è·å–å¯ä¸­æ–­çš„å…±äº«é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–å¯ä¸­æ–­çš„å…±äº«é”"}},[t._v("#")]),t._v(" è·å–å¯ä¸­æ–­çš„å…±äº«é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("acquireSharedInterruptibly(int arg)")]),t._v(" æ–¹æ³•è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚")]),t._v(" "),s("p",[s("code",[t._v("acquireSharedInterruptibly")]),t._v(" æ–¹æ³•ä¸ "),s("code",[t._v("acquireInterruptibly")]),t._v(" å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚")]),t._v(" "),s("h5",{attrs:{id:"è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”"}},[t._v("#")]),t._v(" è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”")]),t._v(" "),s("p",[t._v("AQS ä¸­ä½¿ç”¨ "),s("code",[t._v("tryAcquireSharedNanos(int arg)")]),t._v(" æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”ã€‚")]),t._v(" "),s("p",[s("code",[t._v("tryAcquireSharedNanos")]),t._v(" æ–¹æ³•ä¸ "),s("code",[t._v("tryAcquireNanos")]),t._v(" å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚")]),t._v(" "),s("h2",{attrs:{id:"æ­»é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ­»é”"}},[t._v("#")]),t._v(" æ­»é”")]),t._v(" "),s("h3",{attrs:{id:"ä»€ä¹ˆæ˜¯æ­»é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯æ­»é”"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯æ­»é”")]),t._v(" "),s("p",[t._v("æ­»é”æ˜¯ä¸€ç§ç‰¹å®šçš„ç¨‹åºçŠ¶æ€ï¼Œåœ¨å®ä½“ä¹‹é—´ï¼Œç”±äºå¾ªç¯ä¾èµ–å¯¼è‡´å½¼æ­¤ä¸€ç›´å¤„äºç­‰å¾…ä¹‹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•ä¸ªä½“å¯ä»¥ç»§ç»­å‰è¿›ã€‚æ­»é”ä¸ä»…ä»…æ˜¯åœ¨çº¿ç¨‹ä¹‹é—´ä¼šå‘ç”Ÿï¼Œå­˜åœ¨èµ„æºç‹¬å çš„è¿›ç¨‹ä¹‹é—´åŒæ ·ä¹Ÿ\nå¯èƒ½å‡ºç°æ­»é”ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¤§å¤šæ˜¯èšç„¦åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­çš„æ­»é”ï¼ŒæŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œè€Œæ°¸ä¹…å¤„äºé˜»å¡çš„çŠ¶æ€ã€‚")]),t._v(" "),s("h3",{attrs:{id:"å¦‚ä½•å®šä½æ­»é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•å®šä½æ­»é”"}},[t._v("#")]),t._v(" å¦‚ä½•å®šä½æ­»é”")]),t._v(" "),s("p",[t._v("å®šä½æ­»é”æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨ jstack ç­‰å·¥å…·è·å–çº¿ç¨‹æ ˆï¼Œç„¶åå®šä½äº’ç›¸ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¿›è€Œæ‰¾åˆ°æ­»é”ã€‚å¦‚æœæ˜¯æ¯”è¾ƒæ˜æ˜¾çš„æ­»é”ï¼Œå¾€å¾€ jstack ç­‰å°±èƒ½ç›´æ¥å®šä½ï¼Œç±»ä¼¼ JConsole ç”šè‡³å¯ä»¥åœ¨å›¾å½¢ç•Œé¢è¿›è¡Œæœ‰é™çš„æ­»é”æ£€æµ‹ã€‚")]),t._v(" "),s("p",[t._v("å¦‚æœæˆ‘ä»¬æ˜¯å¼€å‘è‡ªå·±çš„ç®¡ç†å·¥å…·ï¼Œéœ€è¦ç”¨æ›´åŠ ç¨‹åºåŒ–çš„æ–¹å¼æ‰«ææœåŠ¡è¿›ç¨‹ã€å®šä½æ­»é”ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Java æä¾›çš„æ ‡å‡†ç®¡ç† APIï¼Œ"),s("code",[t._v("ThreadMXBean")]),t._v("ï¼Œå…¶ç›´æ¥å°±æä¾›äº† "),s("code",[t._v("findDeadlockedThreads()")]),t._v(" æ–¹æ³•ç”¨äºå®šä½ã€‚")]),t._v(" "),s("h3",{attrs:{id:"å¦‚ä½•é¿å…æ­»é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•é¿å…æ­»é”"}},[t._v("#")]),t._v(" å¦‚ä½•é¿å…æ­»é”")]),t._v(" "),s("p",[t._v("åŸºæœ¬ä¸Šæ­»é”çš„å‘ç”Ÿæ˜¯å› ä¸ºï¼š")]),t._v(" "),s("ul",[s("li",[t._v("äº’æ–¥ï¼Œç±»ä¼¼ Java ä¸­ Monitor éƒ½æ˜¯ç‹¬å çš„ã€‚")]),t._v(" "),s("li",[t._v("é•¿æœŸä¿æŒäº’æ–¥ï¼Œåœ¨ä½¿ç”¨ç»“æŸä¹‹å‰ï¼Œä¸ä¼šé‡Šæ”¾ï¼Œä¹Ÿä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æŠ¢å ã€‚")]),t._v(" "),s("li",[t._v("å¾ªç¯ä¾èµ–ï¼Œå¤šä¸ªä¸ªä½“ä¹‹é—´å‡ºç°äº†é”çš„å¾ªç¯ä¾èµ–ï¼Œå½¼æ­¤ä¾èµ–ä¸Šä¸€ç¯é‡Šæ”¾é”ã€‚")])]),t._v(" "),s("p",[t._v("ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºé¿å…æ­»é”çš„æ€è·¯å’Œæ–¹æ³•ã€‚")]),t._v(" "),s("p",[t._v("ï¼ˆ1ï¼‰é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”ã€‚")]),t._v(" "),s("p",[t._v("é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æºã€‚")]),t._v(" "),s("p",[t._v("å°è¯•ä½¿ç”¨å®šæ—¶é” "),s("code",[t._v("lock.tryLock(timeout)")]),t._v("ï¼Œé¿å…é”ä¸€ç›´ä¸èƒ½é‡Šæ”¾ã€‚")]),t._v(" "),s("p",[t._v("å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸­é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µã€‚")]),t._v(" "),s("h2",{attrs:{id:"å‚è€ƒèµ„æ–™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒèµ„æ–™"}},[t._v("#")]),t._v(" å‚è€ƒèµ„æ–™")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://book.douban.com/subject/10484692/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://book.douban.com/subject/26591326/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/dolphin0520/p/3923167.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java å¹¶å‘ç¼–ç¨‹ï¼šLock"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/27134110",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ·±å…¥å­¦ä¹  java åŒæ­¥å™¨ AQS"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.hao0.me/java/2016/04/01/aqs.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("AbstractQueuedSynchronizer æ¡†æ¶"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/qifengshi/p/6831055.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java ä¸­çš„é”åˆ†ç±»"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);