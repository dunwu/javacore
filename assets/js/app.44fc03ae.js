(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[]]);!function(n){function e(e){for(var a,o,l=e[0],s=e[1],c=e[2],d=0,p=[];d<l.length;d++)o=l[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a]);for(u&&u(e);p.length;)p.shift()();return i.push.apply(i,c||[]),t()}function t(){for(var n,e=0;e<i.length;e++){for(var t=i[e],a=!0,l=1;l<t.length;l++){var s=t[l];0!==r[s]&&(a=!1)}a&&(i.splice(e--,1),n=o(o.s=t[0]))}return n}var a={},r={1:0},i=[];function o(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.e=function(n){var e=[],t=r[n];if(0!==t)if(t)e.push(t[2]);else{var a=new Promise((function(e,a){t=r[n]=[e,a]}));e.push(t[2]=a);var i,l=document.createElement("script");l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.src=function(n){return o.p+"assets/js/"+({}[n]||n)+"."+{2:"aded268b",3:"d34c63b0",4:"884deeca",5:"0d7069e0",6:"12339b00",7:"e7d8e450",8:"0ccc6dba",9:"6cfc63c0",10:"b7bca9b5",11:"033d3a41",12:"b093ffe4",13:"d561ca11",14:"90010e0b",15:"37509588",16:"cd24ed18",17:"5e555f8c",18:"df926f74",19:"8da3be6e",20:"fb42e052",21:"9d7decc0",22:"f31ecff9",23:"6f5cde97",24:"e47f9024",25:"da7e1173",26:"e041331b",27:"8f2ef716",28:"a919e270",29:"4846001f",30:"b3879734",31:"e74cfb72",32:"55bb9631",33:"c695a6d1",34:"146194b0",35:"47c615d2",36:"36c11b19",37:"e4c911e1",38:"612b0f0f",39:"a8479ee6",40:"301701cc",41:"7c62f68f",42:"e9e5707c",43:"2254ee61",44:"24a7c914",45:"4ed583ae",46:"68ab70d3",47:"1716d6b6",48:"8069bdf8",49:"d272babd",50:"7fd74f29",51:"f88d9d36",52:"2adc8dae",53:"e90f1fda",54:"8616b845",55:"1fabc8f2",56:"e604e971",57:"c4ac5a73",58:"8e47e699",59:"1c10231b",60:"bbcc0b2c",61:"9d5ce6ce",62:"db323fc4",63:"ba26811b",64:"b2257255",65:"b3e77388",66:"fbb8f12c",67:"def25516",68:"52669526",69:"294be448",70:"8f9c4fe6",71:"a20157d2"}[n]+".js"}(n);var s=new Error;i=function(e){l.onerror=l.onload=null,clearTimeout(c);var t=r[n];if(0!==t){if(t){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;s.message="Loading chunk "+n+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,t[1](s)}r[n]=void 0}};var c=setTimeout((function(){i({type:"timeout",target:l})}),12e4);l.onerror=l.onload=i,document.head.appendChild(l)}return Promise.all(e)},o.m=n,o.c=a,o.d=function(n,e,t){o.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},o.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},o.t=function(n,e){if(1&e&&(n=o(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var a in n)o.d(t,a,function(e){return n[e]}.bind(null,a));return t},o.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return o.d(e,"a",e),e},o.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},o.p="/javacore/",o.oe=function(n){throw console.error(n),n};var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=s;i.push([107,0]),t()}([function(n,e,t){"use strict";var a=function(n){return n&&n.Math===Math&&n};n.exports=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof global&&global)||a("object"==typeof this&&this)||function(){return this}()||Function("return this")()},function(n,e,t){"use strict";var a="object"==typeof document&&document.all;n.exports=void 0===a&&void 0!==a?function(n){return"function"==typeof n||n===a}:function(n){return"function"==typeof n}},function(n,e,t){"use strict";var a=t(27),r=Function.prototype,i=r.call,o=a&&r.bind.bind(i,i);n.exports=a?o:function(n){return function(){return i.apply(n,arguments)}}},function(n,e,t){"use strict";n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){"use strict";function a(n,e,t,a,r,i,o,l){var s,c="function"==typeof n?n.options:n;if(e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),a&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),o?(s=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),r&&r.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(o)},c._ssrRegister=s):r&&(s=l?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),s)if(c.functional){c._injectStyles=s;var u=c.render;c.render=function(n,e){return s.call(e),u(n,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,s):[s]}return{exports:n,options:c}}t.d(e,"a",(function(){return a}))},function(n,e,t){"use strict";var a=t(3);n.exports=!a((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){"use strict";var a=t(1);n.exports=function(n){return"object"==typeof n?null!==n:a(n)}},function(n,e,t){var a=t(70),r="object"==typeof self&&self&&self.Object===Object&&self,i=a||r||Function("return this")();n.exports=i},function(n,e,t){"use strict";var a=t(2),r=t(32),i=a({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return i(r(n),e)}},function(n,e,t){var a=t(166),r=t(169);n.exports=function(n,e){var t=r(n,e);return a(t)?t:void 0}},function(n,e,t){"use strict";t.d(e,"e",(function(){return a})),t.d(e,"b",(function(){return i})),t.d(e,"j",(function(){return o})),t.d(e,"g",(function(){return s})),t.d(e,"h",(function(){return c})),t.d(e,"i",(function(){return u})),t.d(e,"c",(function(){return d})),t.d(e,"f",(function(){return p})),t.d(e,"l",(function(){return m})),t.d(e,"m",(function(){return h})),t.d(e,"d",(function(){return g})),t.d(e,"k",(function(){return f})),t.d(e,"n",(function(){return b})),t.d(e,"a",(function(){return x}));t(16);const a=/#.*$/,r=/\.(md|html)$/,i=/\/$/,o=/^[a-z]+:/i;function l(n){return decodeURI(n).replace(a,"").replace(r,"")}function s(n){return o.test(n)}function c(n){return/^mailto:/.test(n)}function u(n){return/^tel:/.test(n)}function d(n){if(s(n))return n;if(!n)return"404";const e=n.match(a),t=e?e[0]:"",r=l(n);return i.test(r)?n:r+".html"+t}function p(n,e){const t=n.hash,r=function(n){const e=n&&n.match(a);if(e)return e[0]}(e);if(r&&t!==r)return!1;return l(n.path)===l(e)}function m(n,e,t){if(s(e))return{type:"external",path:e};t&&(e=function(n,e,t){const a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;const r=e.split("/");t&&r[r.length-1]||r.pop();const i=n.replace(/^\//,"").split("/");for(let n=0;n<i.length;n++){const e=i[n];".."===e?r.pop():"."!==e&&r.push(e)}""!==r[0]&&r.unshift("");return r.join("/")}(e,t));const a=l(e);for(let e=0;e<n.length;e++)if(l(n[e].regularPath)===a)return Object.assign({},n[e],{type:"page",path:d(n[e].path)});return console.error(`[vuepress] No matching page found for sidebar item "${e}"`),{}}function h(n,e,t,a){const{pages:r,themeConfig:i}=t,o=a&&i.locales&&i.locales[a]||i;if("auto"===(n.frontmatter.sidebar||o.sidebar||i.sidebar))return v(n);const l=o.sidebar||i.sidebar;if(l){const{base:t,config:a}=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(const a in e)if(0===(t=n,/(\.html|\/)$/.test(t)?t:t+"/").indexOf(encodeURI(a)))return{base:a,config:e[a]};var t;return{}}(e,l);return"auto"===a?v(n):a?a.map(n=>function n(e,t,a,r=1){if("string"==typeof e)return m(t,e,a);if(Array.isArray(e))return Object.assign(m(t,e[0],a),{title:e[1]});{r>3&&console.error("[vuepress] detected a too deep nested sidebar group.");const i=e.children||[];return 0===i.length&&e.path?Object.assign(m(t,e.path,a),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:i.map(e=>n(e,t,a,r+1)),collapsable:!1!==e.collapsable}}}(n,r,t)):[]}return[]}function v(n){const e=g(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map(e=>({type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}))}]}function g(n){let e;return(n=n.map(n=>Object.assign({},n))).forEach(n=>{2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)}),n.filter(n=>2===n.level)}function f(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function b(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function y(n){let e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function x(n,e){return y(e)-y(n)}},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var a=t(15),r=t(151),i=t(152),o=a?a.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":o&&o in Object(n)?r(n):i(n)}},function(n,e,t){"use strict";var a=t(5),r=t(17),i=t(35);n.exports=a?function(n,e,t){return r.f(n,e,i(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var a=t(8).Symbol;n.exports=a},function(n,e,t){"use strict";var a=t(26),r=t(32),i=t(33),o=t(145),l=t(147);a({target:"Array",proto:!0,arity:1,forced:t(3)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(n){return n instanceof TypeError}}()},{push:function(n){var e=r(this),t=i(e),a=arguments.length;l(t+a);for(var s=0;s<a;s++)e[t]=arguments[s],t++;return o(e,t),t}})},function(n,e,t){"use strict";var a=t(5),r=t(65),i=t(102),o=t(48),l=t(55),s=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor;e.f=a?i?function(n,e,t){if(o(n),e=l(e),o(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var a=u(n,e);a&&a.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:a.configurable,enumerable:"enumerable"in t?t.enumerable:a.enumerable,writable:!1})}return c(n,e,t)}:c:function(n,e,t){if(o(n),e=l(e),o(t),r)try{return c(n,e,t)}catch(n){}if("get"in t||"set"in t)throw new s("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){"use strict";var a=t(2),r=a({}.toString),i=a("".slice);n.exports=function(n){return i(r(n),8,-1)}},function(n,e,t){var a=t(156),r=t(157),i=t(158),o=t(159),l=t(160);function s(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}s.prototype.clear=a,s.prototype.delete=r,s.prototype.get=i,s.prototype.has=o,s.prototype.set=l,n.exports=s},function(n,e,t){var a=t(72);n.exports=function(n,e){for(var t=n.length;t--;)if(a(n[t][0],e))return t;return-1}},function(n,e,t){var a=t(10)(Object,"create");n.exports=a},function(n,e,t){var a=t(178);n.exports=function(n,e){var t=n.__data__;return a(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var a=t(46);n.exports=function(n){if("string"==typeof n||a(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var a,r;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(r="function"==typeof(a=function(){var n,e,t={version:"0.2.0"},a=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function r(n,e,t){return n<e?e:n>t?t:n}function i(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(a[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=r(n,a.minimum,1),t.status=1===n?null:n;var s=t.render(!e),c=s.querySelector(a.barSelector),u=a.speed,d=a.easing;return s.offsetWidth,o((function(e){""===a.positionUsing&&(a.positionUsing=t.getPositioningCSS()),l(c,function(n,e,t){var r;return(r="translate3d"===a.positionUsing?{transform:"translate3d("+i(n)+"%,0,0)"}:"translate"===a.positionUsing?{transform:"translate("+i(n)+"%,0)"}:{"margin-left":i(n)+"%"}).transition="all "+e+"ms "+t,r}(n,u,d)),1===n?(l(s,{transition:"none",opacity:1}),s.offsetWidth,setTimeout((function(){l(s,{transition:"all "+u+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),u)}),u)):setTimeout(e,u)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),a.trickleSpeed)};return a.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*r(Math.random()*e,.1,.95)),e=r(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*a.trickleRate)},n=0,e=0,t.promise=function(a){return a&&"resolved"!==a.state()?(0===e&&t.start(),n++,e++,a.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=a.template;var r,o=e.querySelector(a.barSelector),s=n?"-100":i(t.status||0),u=document.querySelector(a.parent);return l(o,{transition:"all 0 linear",transform:"translate3d("+s+"%,0,0)"}),a.showSpinner||(r=e.querySelector(a.spinnerSelector))&&p(r),u!=document.body&&c(u,"nprogress-custom-parent"),u.appendChild(e),e},t.remove=function(){u(document.documentElement,"nprogress-busy"),u(document.querySelector(a.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&p(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var o=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),l=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var a,r=n.length,i=e.charAt(0).toUpperCase()+e.slice(1);r--;)if((a=n[r]+i)in t)return a;return e}(t))}function a(n,e,a){e=t(e),n.style[e]=a}return function(n,e){var t,r,i=arguments;if(2==i.length)for(t in e)void 0!==(r=e[t])&&e.hasOwnProperty(t)&&a(n,t,r);else a(n,i[1],i[2])}}();function s(n,e){return("string"==typeof n?n:d(n)).indexOf(" "+e+" ")>=0}function c(n,e){var t=d(n),a=t+e;s(t,e)||(n.className=a.substring(1))}function u(n,e){var t,a=d(n);s(n,e)&&(t=a.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function d(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function p(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?a.call(e,t,e,n):a)||(n.exports=r)},function(n){n.exports=JSON.parse('{"name":"vuepress-plugin-comment","version":"0.7.3","description":"Comment plugin in vuepress, such as Gitalk, Valine...","main":"index.js","scripts":{"test":"echo \\"Error: no test specified\\" && exit 1"},"repository":{"type":"git","url":"git+ssh://git@github.com/dongyuanxin/vuepress-plugin-comment.git"},"keywords":["vuepress","comment","plugin","vue","gitalk","valine"],"author":"dongyuanxin","license":"MIT","bugs":{"url":"https://github.com/dongyuanxin/vuepress-plugin-comment/issues"},"homepage":"https://github.com/dongyuanxin/vuepress-plugin-comment#readme","dependencies":{"ejs":"^2.6.1","gitalk":"^1.5.0","gitalk-fix":"^1.5.2","i":"^0.3.6","npm":"^6.9.0","valine":"^1.3.9"}}')},function(n,e,t){"use strict";var a=t(0),r=t(53).f,i=t(14),o=t(98),l=t(38),s=t(66),c=t(125);n.exports=function(n,e){var t,u,d,p,m,h=n.target,v=n.global,g=n.stat;if(t=v?a:g?a[h]||l(h,{}):a[h]&&a[h].prototype)for(u in e){if(p=e[u],d=n.dontCallGetSet?(m=r(t,u))&&m.value:t[u],!c(v?u:h+(g?".":"#")+u,n.forced)&&void 0!==d){if(typeof p==typeof d)continue;s(p,d)}(n.sham||d&&d.sham)&&i(p,"sham",!0),o(t,u,p,n)}}},function(n,e,t){"use strict";var a=t(3);n.exports=!a((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e,t){"use strict";var a=t(49),r=t(36);n.exports=function(n){return a(r(n))}},function(n,e,t){"use strict";var a=t(0),r=t(1),i=function(n){return r(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?i(a[n]):a[n]&&a[n][e]}},function(n,e,t){"use strict";var a=t(1),r=t(112),i=TypeError;n.exports=function(n){if(a(n))return n;throw new i(r(n)+" is not a function")}},function(n,e,t){"use strict";var a=t(0),r=t(62),i=t(9),o=t(64),l=t(59),s=t(58),c=a.Symbol,u=r("wks"),d=s?c.for||c:c&&c.withoutSetter||o;n.exports=function(n){return i(u,n)||(u[n]=l&&i(c,n)?c[n]:d("Symbol."+n)),u[n]}},function(n,e,t){"use strict";var a=t(36),r=Object;n.exports=function(n){return r(a(n))}},function(n,e,t){"use strict";var a=t(123);n.exports=function(n){return a(n.length)}},function(n,e,t){"use strict";var a=t(27),r=Function.prototype.call;n.exports=a?r.bind(r):function(){return r.apply(r,arguments)}},function(n,e,t){"use strict";n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){"use strict";var a=t(54),r=TypeError;n.exports=function(n){if(a(n))throw new r("Can't call method on "+n);return n}},function(n,e,t){"use strict";var a=t(63),r=t(0),i=t(38),o=n.exports=r["__core-js_shared__"]||i("__core-js_shared__",{});(o.versions||(o.versions=[])).push({version:"3.38.1",mode:a?"pure":"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e,t){"use strict";var a=t(0),r=Object.defineProperty;n.exports=function(n,e){try{r(a,n,{value:e,configurable:!0,writable:!0})}catch(t){a[n]=e}return e}},function(n,e,t){var a=t(150),r=t(12),i=Object.prototype,o=i.hasOwnProperty,l=i.propertyIsEnumerable,s=a(function(){return arguments}())?a:function(n){return r(n)&&o.call(n,"callee")&&!l.call(n,"callee")};n.exports=s},function(n,e,t){var a=t(10)(t(8),"Map");n.exports=a},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var a=t(170),r=t(177),i=t(179),o=t(180),l=t(181);function s(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}s.prototype.clear=a,s.prototype.delete=r,s.prototype.get=i,s.prototype.has=o,s.prototype.set=l,n.exports=s},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var a=t(6),r=t(46),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;n.exports=function(n,e){if(a(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!r(n))||(o.test(n)||!i.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var a=t(13),r=t(12);n.exports=function(n){return"symbol"==typeof n||r(n)&&"[object Symbol]"==a(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){"use strict";var a=t(7),r=String,i=TypeError;n.exports=function(n){if(a(n))return n;throw new i(r(n)+" is not an object")}},function(n,e,t){"use strict";var a=t(2),r=t(3),i=t(18),o=Object,l=a("".split);n.exports=r((function(){return!o("z").propertyIsEnumerable(0)}))?function(n){return"String"===i(n)?l(n,""):o(n)}:o},function(n,e,t){"use strict";n.exports={}},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e){var t=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,i=/^0o[0-7]+$/i,o=parseInt,l="object"==typeof global&&global&&global.Object===Object&&global,s="object"==typeof self&&self&&self.Object===Object&&self,c=l||s||Function("return this")(),u=Object.prototype.toString,d=Math.max,p=Math.min,m=function(){return c.Date.now()};function h(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function v(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==u.call(n)}(n))return NaN;if(h(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=h(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var l=r.test(n);return l||i.test(n)?o(n.slice(2),l?2:8):a.test(n)?NaN:+n}n.exports=function(n,e,t){var a,r,i,o,l,s,c=0,u=!1,g=!1,f=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function b(e){var t=a,i=r;return a=r=void 0,c=e,o=n.apply(i,t)}function y(n){return c=n,l=setTimeout(k,e),u?b(n):o}function x(n){var t=n-s;return void 0===s||t>=e||t<0||g&&n-c>=i}function k(){var n=m();if(x(n))return j(n);l=setTimeout(k,function(n){var t=e-(n-s);return g?p(t,i-(n-c)):t}(n))}function j(n){return l=void 0,f&&a?b(n):(a=r=void 0,o)}function w(){var n=m(),t=x(n);if(a=arguments,r=this,s=n,t){if(void 0===l)return y(s);if(g)return l=setTimeout(k,e),b(s)}return void 0===l&&(l=setTimeout(k,e)),o}return e=v(e)||0,h(t)&&(u=!!t.leading,i=(g="maxWait"in t)?d(v(t.maxWait)||0,e):i,f="trailing"in t?!!t.trailing:f),w.cancel=function(){void 0!==l&&clearTimeout(l),c=0,a=s=r=l=void 0},w.flush=function(){return void 0===l?o:j(m())},w}},function(n,e,t){"use strict";var a=t(5),r=t(34),i=t(109),o=t(35),l=t(28),s=t(55),c=t(9),u=t(65),d=Object.getOwnPropertyDescriptor;e.f=a?d:function(n,e){if(n=l(n),e=s(e),u)try{return d(n,e)}catch(n){}if(c(n,e))return o(!r(i.f,n,e),n[e])}},function(n,e,t){"use strict";n.exports=function(n){return null==n}},function(n,e,t){"use strict";var a=t(110),r=t(56);n.exports=function(n){var e=a(n,"string");return r(e)?e:e+""}},function(n,e,t){"use strict";var a=t(29),r=t(1),i=t(57),o=t(58),l=Object;n.exports=o?function(n){return"symbol"==typeof n}:function(n){var e=a("Symbol");return r(e)&&i(e.prototype,l(n))}},function(n,e,t){"use strict";var a=t(2);n.exports=a({}.isPrototypeOf)},function(n,e,t){"use strict";var a=t(59);n.exports=a&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){"use strict";var a=t(60),r=t(3),i=t(0).String;n.exports=!!Object.getOwnPropertySymbols&&!r((function(){var n=Symbol("symbol detection");return!i(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&a&&a<41}))},function(n,e,t){"use strict";var a,r,i=t(0),o=t(61),l=i.process,s=i.Deno,c=l&&l.versions||s&&s.version,u=c&&c.v8;u&&(r=(a=u.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!r&&o&&(!(a=o.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=o.match(/Chrome\/(\d+)/))&&(r=+a[1]),n.exports=r},function(n,e,t){"use strict";var a=t(0).navigator,r=a&&a.userAgent;n.exports=r?String(r):""},function(n,e,t){"use strict";var a=t(37);n.exports=function(n,e){return a[n]||(a[n]=e||{})}},function(n,e,t){"use strict";n.exports=!1},function(n,e,t){"use strict";var a=t(2),r=0,i=Math.random(),o=a(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+o(++r+i,36)}},function(n,e,t){"use strict";var a=t(5),r=t(3),i=t(101);n.exports=!a&&!r((function(){return 7!==Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){"use strict";var a=t(9),r=t(118),i=t(53),o=t(17);n.exports=function(n,e,t){for(var l=r(e),s=o.f,c=i.f,u=0;u<l.length;u++){var d=l[u];a(n,d)||t&&a(t,d)||s(n,d,c(e,d))}}},function(n,e,t){"use strict";var a=t(122);n.exports=function(n){var e=+n;return e!=e||0===e?0:a(e)}},function(n,e,t){"use strict";var a=t(133),r=t(7),i=t(36),o=t(134);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=a(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch(n){}return function(t,a){return i(t),o(a),r(t)?(e?n(t,a):t.__proto__=a,t):t}}():void 0)},function(n,e){n.exports=function(n,e){for(var t=-1,a=e.length,r=n.length;++t<a;)n[r+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var a=t(19),r=t(161),i=t(162),o=t(163),l=t(164),s=t(165);function c(n){var e=this.__data__=new a(n);this.size=e.size}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=l,c.prototype.set=s,n.exports=c},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var a=t(13),r=t(41);n.exports=function(n){if(!r(n))return!1;var e=a(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var a=t(182),r=t(12);n.exports=function n(e,t,i,o,l){return e===t||(null==e||null==t||!r(e)&&!r(t)?e!=e&&t!=t:a(e,t,i,o,n,l))}},function(n,e,t){var a=t(77),r=t(185),i=t(78);n.exports=function(n,e,t,o,l,s){var c=1&t,u=n.length,d=e.length;if(u!=d&&!(c&&d>u))return!1;var p=s.get(n),m=s.get(e);if(p&&m)return p==e&&m==n;var h=-1,v=!0,g=2&t?new a:void 0;for(s.set(n,e),s.set(e,n);++h<u;){var f=n[h],b=e[h];if(o)var y=c?o(b,f,h,e,n,s):o(f,b,h,n,e,s);if(void 0!==y){if(y)continue;v=!1;break}if(g){if(!r(e,(function(n,e){if(!i(g,e)&&(f===n||l(f,n,t,o,s)))return g.push(e)}))){v=!1;break}}else if(f!==b&&!l(f,b,t,o,s)){v=!1;break}}return s.delete(n),s.delete(e),v}},function(n,e,t){var a=t(42),r=t(183),i=t(184);function o(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new a;++e<t;)this.add(n[e])}o.prototype.add=o.prototype.push=r,o.prototype.has=i,n.exports=o},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var a=t(195),r=t(201),i=t(83);n.exports=function(n){return i(n)?a(n):r(n)}},function(n,e,t){(function(n){var a=t(8),r=t(197),i=e&&!e.nodeType&&e,o=i&&"object"==typeof n&&n&&!n.nodeType&&n,l=o&&o.exports===i?a.Buffer:void 0,s=(l?l.isBuffer:void 0)||r;n.exports=s}).call(this,t(51)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var a=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==a||"symbol"!=a&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var a=t(198),r=t(199),i=t(200),o=i&&i.isTypedArray,l=o?r(o):a;n.exports=l},function(n,e,t){var a=t(73),r=t(44);n.exports=function(n){return null!=n&&r(n.length)&&!a(n)}},function(n,e,t){var a=t(10)(t(8),"Set");n.exports=a},function(n,e,t){var a=t(41);n.exports=function(n){return n==n&&!a(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var a=t(88),r=t(23);n.exports=function(n,e){for(var t=0,i=(e=a(e,n)).length;null!=n&&t<i;)n=n[r(e[t++])];return t&&t==i?n:void 0}},function(n,e,t){var a=t(6),r=t(45),i=t(212),o=t(215);n.exports=function(n,e){return a(n)?n:r(n,e)?[n]:i(o(n))}},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){var a=t(148),r=t(153),i=t(224),o=t(232),l=t(241),s=t(106),c=i((function(n){var e=s(n);return l(e)&&(e=void 0),o(a(n,1,l,!0),r(e,2))}));n.exports=c},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var a=/["'&<>]/;n.exports=function(n){var e,t=""+n,r=a.exec(t);if(!r)return t;var i="",o=0,l=0;for(o=r.index;o<t.length;o++){switch(t.charCodeAt(o)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}l!==o&&(i+=t.substring(l,o)),l=o+1,i+=e}return l!==o?i+t.substring(l,o):i}},function(n,e,t){"use strict";
/**
 * @file Embedded JavaScript templating engine. {@link http://ejs.co}
 * @author Matthew Eernisse <mde@fleegix.org>
 * @author Tiancheng "Timothy" Gu <timothygu99@gmail.com>
 * @project EJS
 * @license {@link http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0}
 */var a=t(248),r=t(249),i=t(250),o=!1,l=t(251).version,s=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],c=s.concat("cache"),u=/^\uFEFF/;function d(n,t){var r,i,o=t.views,l=/^[A-Za-z]+:\\|^\//.exec(n);if(l&&l.length)r=e.resolveInclude(n.replace(/^\/*/,""),t.root||"/",!0);else if(t.filename&&(i=e.resolveInclude(n,t.filename),a.existsSync(i)&&(r=i)),r||Array.isArray(o)&&o.some((function(t){return i=e.resolveInclude(n,t,!0),a.existsSync(i)}))&&(r=i),!r)throw new Error('Could not find the include file "'+t.escapeFunction(n)+'"');return r}function p(n,t){var a,r=n.filename,i=arguments.length>1;if(n.cache){if(!r)throw new Error("cache option requires a filename");if(a=e.cache.get(r))return a;i||(t=h(r).toString().replace(u,""))}else if(!i){if(!r)throw new Error("Internal EJS error: no file name or template provided");t=h(r).toString().replace(u,"")}return a=e.compile(t,n),n.cache&&e.cache.set(r,a),a}function m(n,t,a){var r;if(!a){if("function"==typeof e.promiseImpl)return new e.promiseImpl((function(e,a){try{e(r=p(n)(t))}catch(n){a(n)}}));throw new Error("Please provide a callback function")}try{r=p(n)(t)}catch(n){return a(n)}a(null,r)}function h(n){return e.fileLoader(n)}function v(n,e,t,a,r){var i=e.split("\n"),o=Math.max(a-3,0),l=Math.min(i.length,a+3),s=r(t),c=i.slice(o,l).map((function(n,e){var t=e+o+1;return(t==a?" >> ":"    ")+t+"| "+n})).join("\n");throw n.path=s,n.message=(s||"ejs")+":"+a+"\n"+c+"\n\n"+n.message,n}function g(n){return n.replace(/;(\s*$)/,"$1")}function f(n,t){t=t||{};var a={};this.templateText=n,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",this.dependencies=[],a.client=t.client||!1,a.escapeFunction=t.escape||t.escapeFunction||i.escapeXML,a.compileDebug=!1!==t.compileDebug,a.debug=!!t.debug,a.filename=t.filename,a.openDelimiter=t.openDelimiter||e.openDelimiter||"<",a.closeDelimiter=t.closeDelimiter||e.closeDelimiter||">",a.delimiter=t.delimiter||e.delimiter||"%",a.strict=t.strict||!1,a.context=t.context,a.cache=t.cache||!1,a.rmWhitespace=t.rmWhitespace,a.root=t.root,a.outputFunctionName=t.outputFunctionName,a.localsName=t.localsName||e.localsName||"locals",a.views=t.views,a.async=t.async,a.destructuredLocals=t.destructuredLocals,a.legacyInclude=void 0===t.legacyInclude||!!t.legacyInclude,a.strict?a._with=!1:a._with=void 0===t._with||t._with,this.opts=a,this.regex=this.createRegex()}e.cache=i.cache,e.fileLoader=a.readFileSync,e.localsName="locals",e.promiseImpl=new Function("return this;")().Promise,e.resolveInclude=function(n,e,t){var a=r.dirname,i=r.extname,o=(0,r.resolve)(t?e:a(e),n);return i(n)||(o+=".ejs"),o},e.compile=function(n,e){return e&&e.scope&&(o||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),o=!0),e.context||(e.context=e.scope),delete e.scope),new f(n,e).compile()},e.render=function(n,e,t){var a=e||{},r=t||{};return 2==arguments.length&&i.shallowCopyFromList(r,a,s),p(r,n)(a)},e.renderFile=function(){var n,e,t,a=Array.prototype.slice.call(arguments),r=a.shift(),o={filename:r};return"function"==typeof arguments[arguments.length-1]&&(n=a.pop()),a.length?(e=a.shift(),a.length?i.shallowCopy(o,a.pop()):(e.settings&&(e.settings.views&&(o.views=e.settings.views),e.settings["view cache"]&&(o.cache=!0),(t=e.settings["view options"])&&i.shallowCopy(o,t)),i.shallowCopyFromList(o,e,c)),o.filename=r):e={},m(o,e,n)},e.Template=f,e.clearCache=function(){e.cache.reset()},f.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},f.prototype={createRegex:function(){var n="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",e=i.escapeRegExpChars(this.opts.delimiter),t=i.escapeRegExpChars(this.opts.openDelimiter),a=i.escapeRegExpChars(this.opts.closeDelimiter);return n=n.replace(/%/g,e).replace(/</g,t).replace(/>/g,a),new RegExp(n)},compile:function(){var n,e,t,a=this.opts,o="",l="",s=a.escapeFunction;if(!this.source){if(this.generateSource(),o+='  var __output = "";\n  function __append(s) { if (s !== undefined && s !== null) __output += s }\n',a.outputFunctionName&&(o+="  var "+a.outputFunctionName+" = __append;\n"),a.destructuredLocals&&a.destructuredLocals.length){for(var c="  var __locals = ("+a.localsName+" || {}),\n",u=0;u<a.destructuredLocals.length;u++){var m=a.destructuredLocals[u];u>0&&(c+=",\n  "),c+=m+" = __locals."+m}o+=c+";\n"}!1!==a._with&&(o+="  with ("+a.localsName+" || {}) {\n",l+="  }\n"),l+="  return __output;\n",this.source=o+this.source+l}n=a.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+(a.filename?JSON.stringify(a.filename):"undefined")+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,a.client&&(n="escapeFn = escapeFn || "+s.toString()+";\n"+n,a.compileDebug&&(n="rethrow = rethrow || "+v.toString()+";\n"+n)),a.strict&&(n='"use strict";\n'+n),a.debug&&console.log(n),a.compileDebug&&a.filename&&(n=n+"\n//# sourceURL="+a.filename+"\n");try{if(a.async)try{t=new Function("return (async function(){}).constructor;")()}catch(n){throw n instanceof SyntaxError?new Error("This environment does not support async/await"):n}else t=Function;e=new t(a.localsName+", escapeFn, include, rethrow",n)}catch(n){throw n instanceof SyntaxError&&(a.filename&&(n.message+=" in "+a.filename),n.message+=" while compiling ejs\n\n",n.message+="If the above error is not helpful, you may want to try EJS-Lint:\n",n.message+="https://github.com/RyanZim/EJS-Lint",a.async||(n.message+="\n",n.message+="Or, if you meant to create an async function, pass `async: true` as an option.")),n}var h=a.client?e:function(n){return e.apply(a.context,[n||{},s,function(e,t){var r=i.shallowCopy({},n);return t&&(r=i.shallowCopy(r,t)),function(n,e){var t=i.shallowCopy({},e);return t.filename=d(n,t),p(t)}(e,a)(r)},v])};if(h.dependencies=this.dependencies,a.filename&&"function"==typeof Object.defineProperty){var g=a.filename,f=r.basename(g,r.extname(g));try{Object.defineProperty(h,"name",{value:f,writable:!1,enumerable:!1,configurable:!0})}catch(n){}}return h},generateSource:function(){var n=this.opts;n.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var t=this,a=this.parseTemplateText(),r=this.opts.delimiter,o=this.opts.openDelimiter,l=this.opts.closeDelimiter;a&&a.length&&a.forEach((function(s,c){var p,m,v,g,b,y;if(0===s.indexOf(o+r)&&0!==s.indexOf(o+r+r)&&(m=a[c+2])!=r+l&&m!="-"+r+l&&m!="_"+r+l)throw new Error('Could not find matching close tag for "'+s+'".');if(n.legacyInclude&&(v=s.match(/^\s*include\s+(\S+)/))&&(p=a[c-1])&&(p==o+r||p==o+r+"-"||p==o+r+"_"))return g=i.shallowCopy({},t.opts),b=function(n,e){var t,a,r=i.shallowCopy({},e);a=h(t=d(n,r)).toString().replace(u,""),r.filename=t;var o=new f(a,r);return o.generateSource(),{source:o.source,filename:t,template:a}}(v[1],g),y=t.opts.compileDebug?"    ; (function(){\n      var __line = 1\n      , __lines = "+JSON.stringify(b.template)+"\n      , __filename = "+JSON.stringify(b.filename)+";\n      try {\n"+b.source+"      } catch (e) {\n        rethrow(e, __lines, __filename, __line, escapeFn);\n      }\n    ; }).call(this)\n":"    ; (function(){\n"+b.source+"    ; }).call(this)\n",t.source+=y,void t.dependencies.push(e.resolveInclude(v[1],g.filename));t.scanLine(s)}))},parseTemplateText:function(){for(var n,e=this.templateText,t=this.regex,a=t.exec(e),r=[];a;)0!==(n=a.index)&&(r.push(e.substring(0,n)),e=e.slice(n)),r.push(a[0]),e=e.slice(a[0].length),a=t.exec(e);return e&&r.push(e),r},_addOutput:function(n){if(this.truncate&&(n=n.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!n)return n;n=(n=(n=(n=n.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/"/g,'\\"'),this.source+='    ; __append("'+n+'")\n'},scanLine:function(n){var e,t=this.opts.delimiter,a=this.opts.openDelimiter,r=this.opts.closeDelimiter;switch(e=n.split("\n").length-1,n){case a+t:case a+t+"_":this.mode=f.modes.EVAL;break;case a+t+"=":this.mode=f.modes.ESCAPED;break;case a+t+"-":this.mode=f.modes.RAW;break;case a+t+"#":this.mode=f.modes.COMMENT;break;case a+t+t:this.mode=f.modes.LITERAL,this.source+='    ; __append("'+n.replace(a+t+t,a+t)+'")\n';break;case t+t+r:this.mode=f.modes.LITERAL,this.source+='    ; __append("'+n.replace(t+t+r,t+r)+'")\n';break;case t+r:case"-"+t+r:case"_"+t+r:this.mode==f.modes.LITERAL&&this._addOutput(n),this.mode=null,this.truncate=0===n.indexOf("-")||0===n.indexOf("_");break;default:if(this.mode){switch(this.mode){case f.modes.EVAL:case f.modes.ESCAPED:case f.modes.RAW:n.lastIndexOf("//")>n.lastIndexOf("\n")&&(n+="\n")}switch(this.mode){case f.modes.EVAL:this.source+="    ; "+n+"\n";break;case f.modes.ESCAPED:this.source+="    ; __append(escapeFn("+g(n)+"))\n";break;case f.modes.RAW:this.source+="    ; __append("+g(n)+")\n";break;case f.modes.COMMENT:break;case f.modes.LITERAL:this._addOutput(n)}}else this._addOutput(n)}this.opts.compileDebug&&e&&(this.currentLine+=e,this.source+="    ; __line = "+this.currentLine+"\n")}},e.escapeXML=i.escapeXML,e.__express=e.renderFile,e.VERSION=l,e.name="ejs","undefined"!=typeof window&&(window.ejs=e)},function(n,e,t){"use strict";t.r(e);var a={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},r=(t(244),t(4)),i=Object(r.a)(a,(function(){return(0,this._self._c)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"4f1e9d0c",null);e.default=i.exports},function(n,e,t){"use strict";t.r(e);var a={name:"CodeGroup",data:()=>({codeTabs:[],activeCodeTabIndex:-1}),watch:{activeCodeTabIndex(n){this.codeTabs.forEach(n=>{n.elm.classList.remove("theme-code-block__active")}),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted(){this.codeTabs=(this.$slots.default||[]).filter(n=>Boolean(n.componentOptions)).map((n,e)=>(""===n.componentOptions.propsData.active&&(this.activeCodeTabIndex=e),{title:n.componentOptions.propsData.title,elm:n.elm})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab(n){this.activeCodeTabIndex=n}}},r=(t(245),t(4)),i=Object(r.a)(a,(function(){var n=this,e=n._self._c;return e("div",{staticClass:"theme-code-group"},[e("div",{staticClass:"theme-code-group__nav"},[e("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(t,a){return e("li",{key:t.title,staticClass:"theme-code-group__li"},[e("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":a===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(a)}}},[n._v("\n            "+n._s(t.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?e("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"2f5f1757",null);e.default=i.exports},function(n,e,t){"use strict";var a=t(1),r=t(17),i=t(103),o=t(38);n.exports=function(n,e,t,l){l||(l={});var s=l.enumerable,c=void 0!==l.name?l.name:e;if(a(t)&&i(t,c,l),l.global)s?n[e]=t:o(e,t);else{try{l.unsafe?n[e]&&(s=!0):delete n[e]}catch(n){}s?n[e]=t:r.f(n,e,{value:t,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return n}},function(n,e,t){"use strict";n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){"use strict";var a=t(139),r=String;n.exports=function(n){if("Symbol"===a(n))throw new TypeError("Cannot convert a Symbol value to a string");return r(n)}},function(n,e,t){"use strict";var a=t(0),r=t(7),i=a.document,o=r(i)&&r(i.createElement);n.exports=function(n){return o?i.createElement(n):{}}},function(n,e,t){"use strict";var a=t(5),r=t(3);n.exports=a&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){"use strict";var a=t(2),r=t(3),i=t(1),o=t(9),l=t(5),s=t(114).CONFIGURABLE,c=t(115),u=t(116),d=u.enforce,p=u.get,m=String,h=Object.defineProperty,v=a("".slice),g=a("".replace),f=a([].join),b=l&&!r((function(){return 8!==h((function(){}),"length",{value:8}).length})),y=String(String).split("String"),x=n.exports=function(n,e,t){"Symbol("===v(m(e),0,7)&&(e="["+g(m(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!o(n,"name")||s&&n.name!==e)&&(l?h(n,"name",{value:e,configurable:!0}):n.name=e),b&&t&&o(t,"arity")&&n.length!==t.arity&&h(n,"length",{value:t.arity});try{t&&o(t,"constructor")&&t.constructor?l&&h(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch(n){}var a=d(n);return o(a,"source")||(a.source=f(y,"string"==typeof e?e:"")),n};Function.prototype.toString=x((function(){return i(this)&&p(this).source||c(this)}),"toString")},function(n,e,t){"use strict";var a=t(62),r=t(64),i=a("keys");n.exports=function(n){return i[n]||(i[n]=r(n))}},function(n,e,t){"use strict";var a=t(2),r=t(9),i=t(28),o=t(120).indexOf,l=t(50),s=a([].push);n.exports=function(n,e){var t,a=i(n),c=0,u=[];for(t in a)!r(l,t)&&r(a,t)&&s(u,t);for(;e.length>c;)r(a,t=e[c++])&&(~o(u,t)||s(u,t));return u}},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){n.exports=t(254)},function(n,e,t){"use strict";var a=t(26),r=t(126).left,i=t(127),o=t(60);a({target:"Array",proto:!0,forced:!t(128)&&o>79&&o<83||!i("reduce")},{reduce:function(n){var e=arguments.length;return r(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){"use strict";var a={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!a.call({1:2},1);e.f=i?function(n){var e=r(this,n);return!!e&&e.enumerable}:a},function(n,e,t){"use strict";var a=t(34),r=t(7),i=t(56),o=t(111),l=t(113),s=t(31),c=TypeError,u=s("toPrimitive");n.exports=function(n,e){if(!r(n)||i(n))return n;var t,s=o(n,u);if(s){if(void 0===e&&(e="default"),t=a(s,n,e),!r(t)||i(t))return t;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),l(n,e)}},function(n,e,t){"use strict";var a=t(30),r=t(54);n.exports=function(n,e){var t=n[e];return r(t)?void 0:a(t)}},function(n,e,t){"use strict";var a=String;n.exports=function(n){try{return a(n)}catch(n){return"Object"}}},function(n,e,t){"use strict";var a=t(34),r=t(1),i=t(7),o=TypeError;n.exports=function(n,e){var t,l;if("string"===e&&r(t=n.toString)&&!i(l=a(t,n)))return l;if(r(t=n.valueOf)&&!i(l=a(t,n)))return l;if("string"!==e&&r(t=n.toString)&&!i(l=a(t,n)))return l;throw new o("Can't convert object to primitive value")}},function(n,e,t){"use strict";var a=t(5),r=t(9),i=Function.prototype,o=a&&Object.getOwnPropertyDescriptor,l=r(i,"name"),s=l&&"something"===function(){}.name,c=l&&(!a||a&&o(i,"name").configurable);n.exports={EXISTS:l,PROPER:s,CONFIGURABLE:c}},function(n,e,t){"use strict";var a=t(2),r=t(1),i=t(37),o=a(Function.toString);r(i.inspectSource)||(i.inspectSource=function(n){return o(n)}),n.exports=i.inspectSource},function(n,e,t){"use strict";var a,r,i,o=t(117),l=t(0),s=t(7),c=t(14),u=t(9),d=t(37),p=t(104),m=t(50),h=l.TypeError,v=l.WeakMap;if(o||d.state){var g=d.state||(d.state=new v);g.get=g.get,g.has=g.has,g.set=g.set,a=function(n,e){if(g.has(n))throw new h("Object already initialized");return e.facade=n,g.set(n,e),e},r=function(n){return g.get(n)||{}},i=function(n){return g.has(n)}}else{var f=p("state");m[f]=!0,a=function(n,e){if(u(n,f))throw new h("Object already initialized");return e.facade=n,c(n,f,e),e},r=function(n){return u(n,f)?n[f]:{}},i=function(n){return u(n,f)}}n.exports={set:a,get:r,has:i,enforce:function(n){return i(n)?r(n):a(n,{})},getterFor:function(n){return function(e){var t;if(!s(e)||(t=r(e)).type!==n)throw new h("Incompatible receiver, "+n+" required");return t}}}},function(n,e,t){"use strict";var a=t(0),r=t(1),i=a.WeakMap;n.exports=r(i)&&/native code/.test(String(i))},function(n,e,t){"use strict";var a=t(29),r=t(2),i=t(119),o=t(124),l=t(48),s=r([].concat);n.exports=a("Reflect","ownKeys")||function(n){var e=i.f(l(n)),t=o.f;return t?s(e,t(n)):e}},function(n,e,t){"use strict";var a=t(105),r=t(99).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return a(n,r)}},function(n,e,t){"use strict";var a=t(28),r=t(121),i=t(33),o=function(n){return function(e,t,o){var l=a(e),s=i(l);if(0===s)return!n&&-1;var c,u=r(o,s);if(n&&t!=t){for(;s>u;)if((c=l[u++])!=c)return!0}else for(;s>u;u++)if((n||u in l)&&l[u]===t)return n||u||0;return!n&&-1}};n.exports={includes:o(!0),indexOf:o(!1)}},function(n,e,t){"use strict";var a=t(67),r=Math.max,i=Math.min;n.exports=function(n,e){var t=a(n);return t<0?r(t+e,0):i(t,e)}},function(n,e,t){"use strict";var a=Math.ceil,r=Math.floor;n.exports=Math.trunc||function(n){var e=+n;return(e>0?r:a)(e)}},function(n,e,t){"use strict";var a=t(67),r=Math.min;n.exports=function(n){var e=a(n);return e>0?r(e,9007199254740991):0}},function(n,e,t){"use strict";e.f=Object.getOwnPropertySymbols},function(n,e,t){"use strict";var a=t(3),r=t(1),i=/#|\.prototype\./,o=function(n,e){var t=s[l(n)];return t===u||t!==c&&(r(e)?a(e):!!e)},l=o.normalize=function(n){return String(n).replace(i,".").toLowerCase()},s=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";n.exports=o},function(n,e,t){"use strict";var a=t(30),r=t(32),i=t(49),o=t(33),l=TypeError,s="Reduce of empty array with no initial value",c=function(n){return function(e,t,c,u){var d=r(e),p=i(d),m=o(d);if(a(t),0===m&&c<2)throw new l(s);var h=n?m-1:0,v=n?-1:1;if(c<2)for(;;){if(h in p){u=p[h],h+=v;break}if(h+=v,n?h<0:m<=h)throw new l(s)}for(;n?h>=0:m>h;h+=v)h in p&&(u=t(u,p[h],h,d));return u}};n.exports={left:c(!1),right:c(!0)}},function(n,e,t){"use strict";var a=t(3);n.exports=function(n,e){var t=[][n];return!!t&&a((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){"use strict";var a=t(129);n.exports="NODE"===a},function(n,e,t){"use strict";var a=t(0),r=t(61),i=t(18),o=function(n){return r.slice(0,n.length)===n};n.exports=o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":a.Bun&&"string"==typeof Bun.version?"BUN":a.Deno&&"object"==typeof Deno.version?"DENO":"process"===i(a.process)?"NODE":a.window&&a.document?"BROWSER":"REST"},function(n,e,t){"use strict";var a=t(26),r=t(0),i=t(131),o=t(132),l=r.WebAssembly,s=7!==new Error("e",{cause:7}).cause,c=function(n,e){var t={};t[n]=o(n,e,s),a({global:!0,constructor:!0,arity:1,forced:s},t)},u=function(n,e){if(l&&l[n]){var t={};t[n]=o("WebAssembly."+n,e,s),a({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:s},t)}};c("Error",(function(n){return function(e){return i(n,this,arguments)}})),c("EvalError",(function(n){return function(e){return i(n,this,arguments)}})),c("RangeError",(function(n){return function(e){return i(n,this,arguments)}})),c("ReferenceError",(function(n){return function(e){return i(n,this,arguments)}})),c("SyntaxError",(function(n){return function(e){return i(n,this,arguments)}})),c("TypeError",(function(n){return function(e){return i(n,this,arguments)}})),c("URIError",(function(n){return function(e){return i(n,this,arguments)}})),u("CompileError",(function(n){return function(e){return i(n,this,arguments)}})),u("LinkError",(function(n){return function(e){return i(n,this,arguments)}})),u("RuntimeError",(function(n){return function(e){return i(n,this,arguments)}}))},function(n,e,t){"use strict";var a=t(27),r=Function.prototype,i=r.apply,o=r.call;n.exports="object"==typeof Reflect&&Reflect.apply||(a?o.bind(i):function(){return o.apply(i,arguments)})},function(n,e,t){"use strict";var a=t(29),r=t(9),i=t(14),o=t(57),l=t(68),s=t(66),c=t(136),u=t(137),d=t(138),p=t(141),m=t(142),h=t(5),v=t(63);n.exports=function(n,e,t,g){var f=g?2:1,b=n.split("."),y=b[b.length-1],x=a.apply(null,b);if(x){var k=x.prototype;if(!v&&r(k,"cause")&&delete k.cause,!t)return x;var j=a("Error"),w=e((function(n,e){var t=d(g?e:n,void 0),a=g?new x(n):new x;return void 0!==t&&i(a,"message",t),m(a,w,a.stack,2),this&&o(k,this)&&u(a,this,w),arguments.length>f&&p(a,arguments[f]),a}));if(w.prototype=k,"Error"!==y?l?l(w,j):s(w,j,{name:!0}):h&&"stackTraceLimit"in x&&(c(w,x,"stackTraceLimit"),c(w,x,"prepareStackTrace")),s(w,x),!v)try{k.name!==y&&i(k,"name",y),k.constructor=w}catch(n){}return w}}},function(n,e,t){"use strict";var a=t(2),r=t(30);n.exports=function(n,e,t){try{return a(r(Object.getOwnPropertyDescriptor(n,e)[t]))}catch(n){}}},function(n,e,t){"use strict";var a=t(135),r=String,i=TypeError;n.exports=function(n){if(a(n))return n;throw new i("Can't set "+r(n)+" as a prototype")}},function(n,e,t){"use strict";var a=t(7);n.exports=function(n){return a(n)||null===n}},function(n,e,t){"use strict";var a=t(17).f;n.exports=function(n,e,t){t in n||a(n,t,{configurable:!0,get:function(){return e[t]},set:function(n){e[t]=n}})}},function(n,e,t){"use strict";var a=t(1),r=t(7),i=t(68);n.exports=function(n,e,t){var o,l;return i&&a(o=e.constructor)&&o!==t&&r(l=o.prototype)&&l!==t.prototype&&i(n,l),n}},function(n,e,t){"use strict";var a=t(100);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:a(n)}},function(n,e,t){"use strict";var a=t(140),r=t(1),i=t(18),o=t(31)("toStringTag"),l=Object,s="Arguments"===i(function(){return arguments}());n.exports=a?i:function(n){var e,t,a;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=l(n),o))?t:s?i(e):"Object"===(a=i(e))&&r(e.callee)?"Arguments":a}},function(n,e,t){"use strict";var a={};a[t(31)("toStringTag")]="z",n.exports="[object z]"===String(a)},function(n,e,t){"use strict";var a=t(7),r=t(14);n.exports=function(n,e){a(e)&&"cause"in e&&r(n,"cause",e.cause)}},function(n,e,t){"use strict";var a=t(14),r=t(143),i=t(144),o=Error.captureStackTrace;n.exports=function(n,e,t,l){i&&(o?o(n,e):a(n,"stack",r(t,l)))}},function(n,e,t){"use strict";var a=t(2),r=Error,i=a("".replace),o=String(new r("zxcasd").stack),l=/\n\s*at [^:]*:[^\n]*/,s=l.test(o);n.exports=function(n,e){if(s&&"string"==typeof n&&!r.prepareStackTrace)for(;e--;)n=i(n,l,"");return n}},function(n,e,t){"use strict";var a=t(3),r=t(35);n.exports=!a((function(){var n=new Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",r(1,7)),7!==n.stack)}))},function(n,e,t){"use strict";var a=t(5),r=t(146),i=TypeError,o=Object.getOwnPropertyDescriptor,l=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(n){return n instanceof TypeError}}();n.exports=l?function(n,e){if(r(n)&&!o(n,"length").writable)throw new i("Cannot set read only .length");return n.length=e}:function(n,e){return n.length=e}},function(n,e,t){"use strict";var a=t(18);n.exports=Array.isArray||function(n){return"Array"===a(n)}},function(n,e,t){"use strict";var a=TypeError;n.exports=function(n){if(n>9007199254740991)throw a("Maximum allowed index exceeded");return n}},function(n,e,t){var a=t(69),r=t(149);n.exports=function n(e,t,i,o,l){var s=-1,c=e.length;for(i||(i=r),l||(l=[]);++s<c;){var u=e[s];t>0&&i(u)?t>1?n(u,t-1,i,o,l):a(l,u):o||(l[l.length]=u)}return l}},function(n,e,t){var a=t(15),r=t(39),i=t(6),o=a?a.isConcatSpreadable:void 0;n.exports=function(n){return i(n)||r(n)||!!(o&&n&&n[o])}},function(n,e,t){var a=t(13),r=t(12);n.exports=function(n){return r(n)&&"[object Arguments]"==a(n)}},function(n,e,t){var a=t(15),r=Object.prototype,i=r.hasOwnProperty,o=r.toString,l=a?a.toStringTag:void 0;n.exports=function(n){var e=i.call(n,l),t=n[l];try{n[l]=void 0;var a=!0}catch(n){}var r=o.call(n);return a&&(e?n[l]=t:delete n[l]),r}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var a=t(154),r=t(210),i=t(47),o=t(6),l=t(221);n.exports=function(n){return"function"==typeof n?n:null==n?i:"object"==typeof n?o(n)?r(n[0],n[1]):a(n):l(n)}},function(n,e,t){var a=t(155),r=t(209),i=t(86);n.exports=function(n){var e=r(n);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(t){return t===n||a(t,n,e)}}},function(n,e,t){var a=t(71),r=t(75);n.exports=function(n,e,t,i){var o=t.length,l=o,s=!i;if(null==n)return!l;for(n=Object(n);o--;){var c=t[o];if(s&&c[2]?c[1]!==n[c[0]]:!(c[0]in n))return!1}for(;++o<l;){var u=(c=t[o])[0],d=n[u],p=c[1];if(s&&c[2]){if(void 0===d&&!(u in n))return!1}else{var m=new a;if(i)var h=i(d,p,u,n,e,m);if(!(void 0===h?r(p,d,3,i,m):h))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var a=t(20),r=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=a(e,n);return!(t<0)&&(t==e.length-1?e.pop():r.call(e,t,1),--this.size,!0)}},function(n,e,t){var a=t(20);n.exports=function(n){var e=this.__data__,t=a(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var a=t(20);n.exports=function(n){return a(this.__data__,n)>-1}},function(n,e,t){var a=t(20);n.exports=function(n,e){var t=this.__data__,r=a(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}},function(n,e,t){var a=t(19);n.exports=function(){this.__data__=new a,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var a=t(19),r=t(40),i=t(42);n.exports=function(n,e){var t=this.__data__;if(t instanceof a){var o=t.__data__;if(!r||o.length<199)return o.push([n,e]),this.size=++t.size,this;t=this.__data__=new i(o)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var a=t(73),r=t(167),i=t(41),o=t(74),l=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,u=s.toString,d=c.hasOwnProperty,p=RegExp("^"+u.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!i(n)||r(n))&&(a(n)?p:l).test(o(n))}},function(n,e,t){var a,r=t(168),i=(a=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+a:"";n.exports=function(n){return!!i&&i in n}},function(n,e,t){var a=t(8)["__core-js_shared__"];n.exports=a},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var a=t(171),r=t(19),i=t(40);n.exports=function(){this.size=0,this.__data__={hash:new a,map:new(i||r),string:new a}}},function(n,e,t){var a=t(172),r=t(173),i=t(174),o=t(175),l=t(176);function s(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}s.prototype.clear=a,s.prototype.delete=r,s.prototype.get=i,s.prototype.has=o,s.prototype.set=l,n.exports=s},function(n,e,t){var a=t(21);n.exports=function(){this.__data__=a?a(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var a=t(21),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(a){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return r.call(e,n)?e[n]:void 0}},function(n,e,t){var a=t(21),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return a?void 0!==e[n]:r.call(e,n)}},function(n,e,t){var a=t(21);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=a&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var a=t(22);n.exports=function(n){var e=a(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var a=t(22);n.exports=function(n){return a(this,n).get(n)}},function(n,e,t){var a=t(22);n.exports=function(n){return a(this,n).has(n)}},function(n,e,t){var a=t(22);n.exports=function(n,e){var t=a(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}},function(n,e,t){var a=t(71),r=t(76),i=t(186),o=t(189),l=t(205),s=t(6),c=t(80),u=t(82),d="[object Object]",p=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,m,h,v){var g=s(n),f=s(e),b=g?"[object Array]":l(n),y=f?"[object Array]":l(e),x=(b="[object Arguments]"==b?d:b)==d,k=(y="[object Arguments]"==y?d:y)==d,j=b==y;if(j&&c(n)){if(!c(e))return!1;g=!0,x=!1}if(j&&!x)return v||(v=new a),g||u(n)?r(n,e,t,m,h,v):i(n,e,b,t,m,h,v);if(!(1&t)){var w=x&&p.call(n,"__wrapped__"),S=k&&p.call(e,"__wrapped__");if(w||S){var T=w?n.value():n,I=S?e.value():e;return v||(v=new a),h(T,I,t,m,v)}}return!!j&&(v||(v=new a),o(n,e,t,m,h,v))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length;++t<a;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var a=t(15),r=t(187),i=t(72),o=t(76),l=t(188),s=t(43),c=a?a.prototype:void 0,u=c?c.valueOf:void 0;n.exports=function(n,e,t,a,c,d,p){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!d(new r(n),new r(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var m=l;case"[object Set]":var h=1&a;if(m||(m=s),n.size!=e.size&&!h)return!1;var v=p.get(n);if(v)return v==e;a|=2,p.set(n,e);var g=o(m(n),m(e),a,c,d,p);return p.delete(n),g;case"[object Symbol]":if(u)return u.call(n)==u.call(e)}return!1}},function(n,e,t){var a=t(8).Uint8Array;n.exports=a},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,a){t[++e]=[a,n]})),t}},function(n,e,t){var a=t(190),r=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,i,o,l){var s=1&t,c=a(n),u=c.length;if(u!=a(e).length&&!s)return!1;for(var d=u;d--;){var p=c[d];if(!(s?p in e:r.call(e,p)))return!1}var m=l.get(n),h=l.get(e);if(m&&h)return m==e&&h==n;var v=!0;l.set(n,e),l.set(e,n);for(var g=s;++d<u;){var f=n[p=c[d]],b=e[p];if(i)var y=s?i(b,f,p,e,n,l):i(f,b,p,n,e,l);if(!(void 0===y?f===b||o(f,b,t,i,l):y)){v=!1;break}g||(g="constructor"==p)}if(v&&!g){var x=n.constructor,k=e.constructor;x==k||!("constructor"in n)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof k&&k instanceof k||(v=!1)}return l.delete(n),l.delete(e),v}},function(n,e,t){var a=t(191),r=t(192),i=t(79);n.exports=function(n){return a(n,i,r)}},function(n,e,t){var a=t(69),r=t(6);n.exports=function(n,e,t){var i=e(n);return r(n)?i:a(i,t(n))}},function(n,e,t){var a=t(193),r=t(194),i=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,l=o?function(n){return null==n?[]:(n=Object(n),a(o(n),(function(e){return i.call(n,e)})))}:r;n.exports=l},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,r=0,i=[];++t<a;){var o=n[t];e(o,t,n)&&(i[r++]=o)}return i}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var a=t(196),r=t(39),i=t(6),o=t(80),l=t(81),s=t(82),c=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=i(n),u=!t&&r(n),d=!t&&!u&&o(n),p=!t&&!u&&!d&&s(n),m=t||u||d||p,h=m?a(n.length,String):[],v=h.length;for(var g in n)!e&&!c.call(n,g)||m&&("length"==g||d&&("offset"==g||"parent"==g)||p&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||l(g,v))||h.push(g);return h}},function(n,e){n.exports=function(n,e){for(var t=-1,a=Array(n);++t<n;)a[t]=e(t);return a}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var a=t(13),r=t(44),i=t(12),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,n.exports=function(n){return i(n)&&r(n.length)&&!!o[a(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var a=t(70),r=e&&!e.nodeType&&e,i=r&&"object"==typeof n&&n&&!n.nodeType&&n,o=i&&i.exports===r&&a.process,l=function(){try{var n=i&&i.require&&i.require("util").types;return n||o&&o.binding&&o.binding("util")}catch(n){}}();n.exports=l}).call(this,t(51)(n))},function(n,e,t){var a=t(202),r=t(203),i=Object.prototype.hasOwnProperty;n.exports=function(n){if(!a(n))return r(n);var e=[];for(var t in Object(n))i.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var a=t(204)(Object.keys,Object);n.exports=a},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var a=t(206),r=t(40),i=t(207),o=t(84),l=t(208),s=t(13),c=t(74),u=c(a),d=c(r),p=c(i),m=c(o),h=c(l),v=s;(a&&"[object DataView]"!=v(new a(new ArrayBuffer(1)))||r&&"[object Map]"!=v(new r)||i&&"[object Promise]"!=v(i.resolve())||o&&"[object Set]"!=v(new o)||l&&"[object WeakMap]"!=v(new l))&&(v=function(n){var e=s(n),t="[object Object]"==e?n.constructor:void 0,a=t?c(t):"";if(a)switch(a){case u:return"[object DataView]";case d:return"[object Map]";case p:return"[object Promise]";case m:return"[object Set]";case h:return"[object WeakMap]"}return e}),n.exports=v},function(n,e,t){var a=t(10)(t(8),"DataView");n.exports=a},function(n,e,t){var a=t(10)(t(8),"Promise");n.exports=a},function(n,e,t){var a=t(10)(t(8),"WeakMap");n.exports=a},function(n,e,t){var a=t(85),r=t(79);n.exports=function(n){for(var e=r(n),t=e.length;t--;){var i=e[t],o=n[i];e[t]=[i,o,a(o)]}return e}},function(n,e,t){var a=t(75),r=t(211),i=t(218),o=t(45),l=t(85),s=t(86),c=t(23);n.exports=function(n,e){return o(n)&&l(e)?s(c(n),e):function(t){var o=r(t,n);return void 0===o&&o===e?i(t,n):a(e,o,3)}}},function(n,e,t){var a=t(87);n.exports=function(n,e,t){var r=null==n?void 0:a(n,e);return void 0===r?t:r}},function(n,e,t){var a=t(213),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=a((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(r,(function(n,t,a,r){e.push(a?r.replace(i,"$1"):t||n)})),e}));n.exports=o},function(n,e,t){var a=t(214);n.exports=function(n){var e=a(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var a=t(42);function r(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var a=arguments,r=e?e.apply(this,a):a[0],i=t.cache;if(i.has(r))return i.get(r);var o=n.apply(this,a);return t.cache=i.set(r,o)||i,o};return t.cache=new(r.Cache||a),t}r.Cache=a,n.exports=r},function(n,e,t){var a=t(216);n.exports=function(n){return null==n?"":a(n)}},function(n,e,t){var a=t(15),r=t(217),i=t(6),o=t(46),l=a?a.prototype:void 0,s=l?l.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(i(e))return r(e,n)+"";if(o(e))return s?s.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,r=Array(a);++t<a;)r[t]=e(n[t],t,n);return r}},function(n,e,t){var a=t(219),r=t(220);n.exports=function(n,e){return null!=n&&r(n,e,a)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var a=t(88),r=t(39),i=t(6),o=t(81),l=t(44),s=t(23);n.exports=function(n,e,t){for(var c=-1,u=(e=a(e,n)).length,d=!1;++c<u;){var p=s(e[c]);if(!(d=null!=n&&t(n,p)))break;n=n[p]}return d||++c!=u?d:!!(u=null==n?0:n.length)&&l(u)&&o(p,u)&&(i(n)||r(n))}},function(n,e,t){var a=t(222),r=t(223),i=t(45),o=t(23);n.exports=function(n){return i(n)?a(o(n)):r(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var a=t(87);n.exports=function(n){return function(e){return a(e,n)}}},function(n,e,t){var a=t(47),r=t(225),i=t(227);n.exports=function(n,e){return i(r(n,e,a),n+"")}},function(n,e,t){var a=t(226),r=Math.max;n.exports=function(n,e,t){return e=r(void 0===e?n.length-1:e,0),function(){for(var i=arguments,o=-1,l=r(i.length-e,0),s=Array(l);++o<l;)s[o]=i[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=i[o];return c[e]=t(s),a(n,this,c)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var a=t(228),r=t(231)(a);n.exports=r},function(n,e,t){var a=t(229),r=t(230),i=t(47),o=r?function(n,e){return r(n,"toString",{configurable:!0,enumerable:!1,value:a(e),writable:!0})}:i;n.exports=o},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var a=t(10),r=function(){try{var n=a(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=r},function(n,e){var t=Date.now;n.exports=function(n){var e=0,a=0;return function(){var r=t(),i=16-(r-a);if(a=r,i>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var a=t(77),r=t(233),i=t(238),o=t(78),l=t(239),s=t(43);n.exports=function(n,e,t){var c=-1,u=r,d=n.length,p=!0,m=[],h=m;if(t)p=!1,u=i;else if(d>=200){var v=e?null:l(n);if(v)return s(v);p=!1,u=o,h=new a}else h=e?[]:m;n:for(;++c<d;){var g=n[c],f=e?e(g):g;if(g=t||0!==g?g:0,p&&f==f){for(var b=h.length;b--;)if(h[b]===f)continue n;e&&h.push(f),m.push(g)}else u(h,f,t)||(h!==m&&h.push(f),m.push(g))}return m}},function(n,e,t){var a=t(234);n.exports=function(n,e){return!!(null==n?0:n.length)&&a(n,e,0)>-1}},function(n,e,t){var a=t(235),r=t(236),i=t(237);n.exports=function(n,e,t){return e==e?i(n,e,t):a(n,r,t)}},function(n,e){n.exports=function(n,e,t,a){for(var r=n.length,i=t+(a?1:-1);a?i--:++i<r;)if(e(n[i],i,n))return i;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var a=t-1,r=n.length;++a<r;)if(n[a]===e)return a;return-1}},function(n,e){n.exports=function(n,e,t){for(var a=-1,r=null==n?0:n.length;++a<r;)if(t(e,n[a]))return!0;return!1}},function(n,e,t){var a=t(84),r=t(240),i=t(43),o=a&&1/i(new a([,-0]))[1]==1/0?function(n){return new a(n)}:r;n.exports=o},function(n,e){n.exports=function(){}},function(n,e,t){var a=t(83),r=t(12);n.exports=function(n){return r(n)&&a(n)}},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";t(89)},function(n,e,t){"use strict";t(90)},function(n,e,t){},function(n,e,t){},function(n,e){},function(n,e){function t(n,e){for(var t=0,a=n.length-1;a>=0;a--){var r=n[a];"."===r?n.splice(a,1):".."===r?(n.splice(a,1),t++):t&&(n.splice(a,1),t--)}if(e)for(;t--;t)n.unshift("..");return n}function a(n,e){if(n.filter)return n.filter(e);for(var t=[],a=0;a<n.length;a++)e(n[a],a,n)&&t.push(n[a]);return t}e.resolve=function(){for(var n="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var i=r>=0?arguments[r]:process.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(n=i+"/"+n,e="/"===i.charAt(0))}return(e?"/":"")+(n=t(a(n.split("/"),(function(n){return!!n})),!e).join("/"))||"."},e.normalize=function(n){var i=e.isAbsolute(n),o="/"===r(n,-1);return(n=t(a(n.split("/"),(function(n){return!!n})),!i).join("/"))||i||(n="."),n&&o&&(n+="/"),(i?"/":"")+n},e.isAbsolute=function(n){return"/"===n.charAt(0)},e.join=function(){var n=Array.prototype.slice.call(arguments,0);return e.normalize(a(n,(function(n,e){if("string"!=typeof n)throw new TypeError("Arguments to path.join must be strings");return n})).join("/"))},e.relative=function(n,t){function a(n){for(var e=0;e<n.length&&""===n[e];e++);for(var t=n.length-1;t>=0&&""===n[t];t--);return e>t?[]:n.slice(e,t-e+1)}n=e.resolve(n).substr(1),t=e.resolve(t).substr(1);for(var r=a(n.split("/")),i=a(t.split("/")),o=Math.min(r.length,i.length),l=o,s=0;s<o;s++)if(r[s]!==i[s]){l=s;break}var c=[];for(s=l;s<r.length;s++)c.push("..");return(c=c.concat(i.slice(l))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(n){if("string"!=typeof n&&(n+=""),0===n.length)return".";for(var e=n.charCodeAt(0),t=47===e,a=-1,r=!0,i=n.length-1;i>=1;--i)if(47===(e=n.charCodeAt(i))){if(!r){a=i;break}}else r=!1;return-1===a?t?"/":".":t&&1===a?"/":n.slice(0,a)},e.basename=function(n,e){var t=function(n){"string"!=typeof n&&(n+="");var e,t=0,a=-1,r=!0;for(e=n.length-1;e>=0;--e)if(47===n.charCodeAt(e)){if(!r){t=e+1;break}}else-1===a&&(r=!1,a=e+1);return-1===a?"":n.slice(t,a)}(n);return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},e.extname=function(n){"string"!=typeof n&&(n+="");for(var e=-1,t=0,a=-1,r=!0,i=0,o=n.length-1;o>=0;--o){var l=n.charCodeAt(o);if(47!==l)-1===a&&(r=!1,a=o+1),46===l?-1===e?e=o:1!==i&&(i=1):-1!==e&&(i=-1);else if(!r){t=o+1;break}}return-1===e||-1===a||0===i||1===i&&e===a-1&&e===t+1?"":n.slice(e,a)};var r="b"==="ab".substr(-1)?function(n,e,t){return n.substr(e,t)}:function(n,e,t){return e<0&&(e=n.length+e),n.substr(e,t)}},function(n,e,t){"use strict";var a=/[|\\{}()[\]^$+*?.]/g;e.escapeRegExpChars=function(n){return n?String(n).replace(a,"\\$&"):""};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},i=/[&<>'"]/g;function o(n){return r[n]||n}e.escapeXML=function(n){return null==n?"":String(n).replace(i,o)},e.escapeXML.toString=function(){return Function.prototype.toString.call(this)+';\nvar _ENCODE_HTML_RULES = {\n      "&": "&amp;"\n    , "<": "&lt;"\n    , ">": "&gt;"\n    , \'"\': "&#34;"\n    , "\'": "&#39;"\n    }\n  , _MATCH_HTML = /[&<>\'"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n'},e.shallowCopy=function(n,e){for(var t in e=e||{})n[t]=e[t];return n},e.shallowCopyFromList=function(n,e,t){for(var a=0;a<t.length;a++){var r=t[a];void 0!==e[r]&&(n[r]=e[r])}return n},e.cache={_data:{},set:function(n,e){this._data[n]=e},get:function(n){return this._data[n]},remove:function(n){delete this._data[n]},reset:function(){this._data={}}}},function(n){n.exports=JSON.parse('{"name":"ejs","description":"Embedded JavaScript templates","keywords":["template","engine","ejs"],"version":"2.7.4","author":"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)","license":"Apache-2.0","main":"./lib/ejs.js","repository":{"type":"git","url":"git://github.com/mde/ejs.git"},"bugs":"https://github.com/mde/ejs/issues","homepage":"https://github.com/mde/ejs","dependencies":{},"devDependencies":{"browserify":"^13.1.1","eslint":"^4.14.0","git-directory-deploy":"^1.5.1","jake":"^10.3.1","jsdoc":"^3.4.0","lru-cache":"^4.0.1","mocha":"^5.0.5","uglify-js":"^3.3.16"},"engines":{"node":">=0.10.0"},"scripts":{"test":"mocha","postinstall":"node ./postinstall.js"}}')},function(n,e,t){"use strict";t(91)},function(n,e,t){"use strict";t(92)},function(n,e,t){"use strict";t.r(e);
/*!
 * Vue.js v2.7.16
 * (c) 2014-2023 Evan You
 * Released under the MIT License.
 */
var a=Object.freeze({}),r=Array.isArray;function i(n){return null==n}function o(n){return null!=n}function l(n){return!0===n}function s(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function c(n){return"function"==typeof n}function u(n){return null!==n&&"object"==typeof n}var d=Object.prototype.toString;function p(n){return"[object Object]"===d.call(n)}function m(n){return"[object RegExp]"===d.call(n)}function h(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function v(n){return o(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function g(n){return null==n?"":Array.isArray(n)||p(n)&&n.toString===d?JSON.stringify(n,f,2):String(n)}function f(n,e){return e&&e.__v_isRef?e.value:e}function b(n){var e=parseFloat(n);return isNaN(e)?n:e}function y(n,e){for(var t=Object.create(null),a=n.split(","),r=0;r<a.length;r++)t[a[r]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}y("slot,component",!0);var x=y("key,ref,slot,slot-scope,is");function k(n,e){var t=n.length;if(t){if(e===n[t-1])return void(n.length=t-1);var a=n.indexOf(e);if(a>-1)return n.splice(a,1)}}var j=Object.prototype.hasOwnProperty;function w(n,e){return j.call(n,e)}function S(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var T=/-(\w)/g,I=S((function(n){return n.replace(T,(function(n,e){return e?e.toUpperCase():""}))})),C=S((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),z=/\B([A-Z])/g,E=S((function(n){return n.replace(z,"-$1").toLowerCase()}));var J=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var a=arguments.length;return a?a>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function A(n,e){e=e||0;for(var t=n.length-e,a=new Array(t);t--;)a[t]=n[t+e];return a}function M(n,e){for(var t in e)n[t]=e[t];return n}function L(n){for(var e={},t=0;t<n.length;t++)n[t]&&M(e,n[t]);return e}function O(n,e,t){}var P=function(n,e,t){return!1},_=function(n){return n};function D(n,e){if(n===e)return!0;var t=u(n),a=u(e);if(!t||!a)return!t&&!a&&String(n)===String(e);try{var r=Array.isArray(n),i=Array.isArray(e);if(r&&i)return n.length===e.length&&n.every((function(n,t){return D(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(r||i)return!1;var o=Object.keys(n),l=Object.keys(e);return o.length===l.length&&o.every((function(t){return D(n[t],e[t])}))}catch(n){return!1}}function R(n,e){for(var t=0;t<n.length;t++)if(D(n[t],e))return t;return-1}function B(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}function F(n,e){return n===e?0===n&&1/n!=1/e:n==n||e==e}var N=["component","directive","filter"],q=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],U={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:P,isReservedAttr:P,isUnknownElement:P,getTagNamespace:O,parsePlatformTagName:_,mustUseProp:P,async:!0,_lifecycleHooks:q},V=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function H(n){var e=(n+"").charCodeAt(0);return 36===e||95===e}function G(n,e,t,a){Object.defineProperty(n,e,{value:t,enumerable:!!a,writable:!0,configurable:!0})}var $=new RegExp("[^".concat(V.source,".$_\\d]"));var W="__proto__"in{},K="undefined"!=typeof window,X=K&&window.navigator.userAgent.toLowerCase(),Q=X&&/msie|trident/.test(X),Y=X&&X.indexOf("msie 9.0")>0,Z=X&&X.indexOf("edge/")>0;X&&X.indexOf("android");var nn=X&&/iphone|ipad|ipod|ios/.test(X);X&&/chrome\/\d+/.test(X),X&&/phantomjs/.test(X);var en,tn=X&&X.match(/firefox\/(\d+)/),an={}.watch,rn=!1;if(K)try{var on={};Object.defineProperty(on,"passive",{get:function(){rn=!0}}),window.addEventListener("test-passive",null,on)}catch(n){}var ln=function(){return void 0===en&&(en=!K&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),en},sn=K&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function cn(n){return"function"==typeof n&&/native code/.test(n.toString())}var un,dn="undefined"!=typeof Symbol&&cn(Symbol)&&"undefined"!=typeof Reflect&&cn(Reflect.ownKeys);un="undefined"!=typeof Set&&cn(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var pn=null;function mn(n){void 0===n&&(n=null),n||pn&&pn._scope.off(),pn=n,n&&n._scope.on()}var hn=function(){function n(n,e,t,a,r,i,o,l){this.tag=n,this.data=e,this.children=t,this.text=a,this.elm=r,this.ns=void 0,this.context=i,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=o,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=l,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(n.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),n}(),vn=function(n){void 0===n&&(n="");var e=new hn;return e.text=n,e.isComment=!0,e};function gn(n){return new hn(void 0,void 0,void 0,String(n))}function fn(n){var e=new hn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}"function"==typeof SuppressedError&&SuppressedError;var bn=0,yn=[],xn=function(){function n(){this._pending=!1,this.id=bn++,this.subs=[]}return n.prototype.addSub=function(n){this.subs.push(n)},n.prototype.removeSub=function(n){this.subs[this.subs.indexOf(n)]=null,this._pending||(this._pending=!0,yn.push(this))},n.prototype.depend=function(e){n.target&&n.target.addDep(this)},n.prototype.notify=function(n){var e=this.subs.filter((function(n){return n}));for(var t=0,a=e.length;t<a;t++){0,e[t].update()}},n}();xn.target=null;var kn=[];function jn(n){kn.push(n),xn.target=n}function wn(){kn.pop(),xn.target=kn[kn.length-1]}var Sn=Array.prototype,Tn=Object.create(Sn);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=Sn[n];G(Tn,n,(function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var r,i=e.apply(this,t),o=this.__ob__;switch(n){case"push":case"unshift":r=t;break;case"splice":r=t.slice(2)}return r&&o.observeArray(r),o.dep.notify(),i}))}));var In=Object.getOwnPropertyNames(Tn),Cn={},zn=!0;function En(n){zn=n}var Jn={notify:O,depend:O,addSub:O,removeSub:O},An=function(){function n(n,e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.value=n,this.shallow=e,this.mock=t,this.dep=t?Jn:new xn,this.vmCount=0,G(n,"__ob__",this),r(n)){if(!t)if(W)n.__proto__=Tn;else for(var a=0,i=In.length;a<i;a++){G(n,l=In[a],Tn[l])}e||this.observeArray(n)}else{var o=Object.keys(n);for(a=0;a<o.length;a++){var l;Ln(n,l=o[a],Cn,void 0,e,t)}}}return n.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)Mn(n[e],!1,this.mock)},n}();function Mn(n,e,t){return n&&w(n,"__ob__")&&n.__ob__ instanceof An?n.__ob__:!zn||!t&&ln()||!r(n)&&!p(n)||!Object.isExtensible(n)||n.__v_skip||Fn(n)||n instanceof hn?void 0:new An(n,e,t)}function Ln(n,e,t,a,i,o,l){void 0===l&&(l=!1);var s=new xn,c=Object.getOwnPropertyDescriptor(n,e);if(!c||!1!==c.configurable){var u=c&&c.get,d=c&&c.set;u&&!d||t!==Cn&&2!==arguments.length||(t=n[e]);var p=i?t&&t.__ob__:Mn(t,!1,o);return Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=u?u.call(n):t;return xn.target&&(s.depend(),p&&(p.dep.depend(),r(e)&&_n(e))),Fn(e)&&!i?e.value:e},set:function(e){var a=u?u.call(n):t;if(F(a,e)){if(d)d.call(n,e);else{if(u)return;if(!i&&Fn(a)&&!Fn(e))return void(a.value=e);t=e}p=i?e&&e.__ob__:Mn(e,!1,o),s.notify()}}}),s}}function On(n,e,t){if(!Bn(n)){var a=n.__ob__;return r(n)&&h(e)?(n.length=Math.max(n.length,e),n.splice(e,1,t),a&&!a.shallow&&a.mock&&Mn(t,!1,!0),t):e in n&&!(e in Object.prototype)?(n[e]=t,t):n._isVue||a&&a.vmCount?t:a?(Ln(a.value,e,t,void 0,a.shallow,a.mock),a.dep.notify(),t):(n[e]=t,t)}}function Pn(n,e){if(r(n)&&h(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||Bn(n)||w(n,e)&&(delete n[e],t&&t.dep.notify())}}function _n(n){for(var e=void 0,t=0,a=n.length;t<a;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),r(e)&&_n(e)}function Dn(n){return Rn(n,!0),G(n,"__v_isShallow",!0),n}function Rn(n,e){if(!Bn(n)){Mn(n,e,ln());0}}function Bn(n){return!(!n||!n.__v_isReadonly)}function Fn(n){return!(!n||!0!==n.__v_isRef)}function Nn(n,e,t){Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){var n=e[t];if(Fn(n))return n.value;var a=n&&n.__ob__;return a&&a.dep.depend(),n},set:function(n){var a=e[t];Fn(a)&&!Fn(n)?a.value=n:e[t]=n}})}"".concat("watcher"," callback"),"".concat("watcher"," getter"),"".concat("watcher"," cleanup");var qn;var Un=function(){function n(n){void 0===n&&(n=!1),this.detached=n,this.active=!0,this.effects=[],this.cleanups=[],this.parent=qn,!n&&qn&&(this.index=(qn.scopes||(qn.scopes=[])).push(this)-1)}return n.prototype.run=function(n){if(this.active){var e=qn;try{return qn=this,n()}finally{qn=e}}else 0},n.prototype.on=function(){qn=this},n.prototype.off=function(){qn=this.parent},n.prototype.stop=function(n){if(this.active){var e=void 0,t=void 0;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].teardown();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!n){var a=this.parent.scopes.pop();a&&a!==this&&(this.parent.scopes[this.index]=a,a.index=this.index)}this.parent=void 0,this.active=!1}},n}();function Vn(n){var e=n._provided,t=n.$parent&&n.$parent._provided;return t===e?n._provided=Object.create(t):e}var Hn=S((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),a="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=a?n.slice(1):n,once:t,capture:a,passive:e}}));function Gn(n,e){function t(){var n=t.fns;if(!r(n))return ze(n,null,arguments,e,"v-on handler");for(var a=n.slice(),i=0;i<a.length;i++)ze(a[i],null,arguments,e,"v-on handler")}return t.fns=n,t}function $n(n,e,t,a,r,o){var s,c,u,d;for(s in n)c=n[s],u=e[s],d=Hn(s),i(c)||(i(u)?(i(c.fns)&&(c=n[s]=Gn(c,o)),l(d.once)&&(c=n[s]=r(d.name,c,d.capture)),t(d.name,c,d.capture,d.passive,d.params)):c!==u&&(u.fns=c,n[s]=u));for(s in e)i(n[s])&&a((d=Hn(s)).name,e[s],d.capture)}function Wn(n,e,t){var a;n instanceof hn&&(n=n.data.hook||(n.data.hook={}));var r=n[e];function s(){t.apply(this,arguments),k(a.fns,s)}i(r)?a=Gn([s]):o(r.fns)&&l(r.merged)?(a=r).fns.push(s):a=Gn([r,s]),a.merged=!0,n[e]=a}function Kn(n,e,t,a,r){if(o(e)){if(w(e,t))return n[t]=e[t],r||delete e[t],!0;if(w(e,a))return n[t]=e[a],r||delete e[a],!0}return!1}function Xn(n){return s(n)?[gn(n)]:r(n)?function n(e,t){var a,c,u,d,p=[];for(a=0;a<e.length;a++)i(c=e[a])||"boolean"==typeof c||(u=p.length-1,d=p[u],r(c)?c.length>0&&(Qn((c=n(c,"".concat(t||"","_").concat(a)))[0])&&Qn(d)&&(p[u]=gn(d.text+c[0].text),c.shift()),p.push.apply(p,c)):s(c)?Qn(d)?p[u]=gn(d.text+c):""!==c&&p.push(gn(c)):Qn(c)&&Qn(d)?p[u]=gn(d.text+c.text):(l(e._isVList)&&o(c.tag)&&i(c.key)&&o(t)&&(c.key="__vlist".concat(t,"_").concat(a,"__")),p.push(c)));return p}(n):void 0}function Qn(n){return o(n)&&o(n.text)&&!1===n.isComment}function Yn(n,e){var t,a,i,l,s=null;if(r(n)||"string"==typeof n)for(s=new Array(n.length),t=0,a=n.length;t<a;t++)s[t]=e(n[t],t);else if("number"==typeof n)for(s=new Array(n),t=0;t<n;t++)s[t]=e(t+1,t);else if(u(n))if(dn&&n[Symbol.iterator]){s=[];for(var c=n[Symbol.iterator](),d=c.next();!d.done;)s.push(e(d.value,s.length)),d=c.next()}else for(i=Object.keys(n),s=new Array(i.length),t=0,a=i.length;t<a;t++)l=i[t],s[t]=e(n[l],l,t);return o(s)||(s=[]),s._isVList=!0,s}function Zn(n,e,t,a){var r,i=this.$scopedSlots[n];i?(t=t||{},a&&(t=M(M({},a),t)),r=i(t)||(c(e)?e():e)):r=this.$slots[n]||(c(e)?e():e);var o=t&&t.slot;return o?this.$createElement("template",{slot:o},r):r}function ne(n){return At(this.$options,"filters",n,!0)||_}function ee(n,e){return r(n)?-1===n.indexOf(e):n!==e}function te(n,e,t,a,r){var i=U.keyCodes[e]||t;return r&&a&&!U.keyCodes[e]?ee(r,a):i?ee(i,n):a?E(a)!==e:void 0===n}function ae(n,e,t,a,i){if(t)if(u(t)){r(t)&&(t=L(t));var o=void 0,l=function(r){if("class"===r||"style"===r||x(r))o=n;else{var l=n.attrs&&n.attrs.type;o=a||U.mustUseProp(e,l,r)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var s=I(r),c=E(r);s in o||c in o||(o[r]=t[r],i&&((n.on||(n.on={}))["update:".concat(r)]=function(n){t[r]=n}))};for(var s in t)l(s)}else;return n}function re(n,e){var t=this._staticTrees||(this._staticTrees=[]),a=t[n];return a&&!e||oe(a=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,this._c,this),"__static__".concat(n),!1),a}function ie(n,e,t){return oe(n,"__once__".concat(e).concat(t?"_".concat(t):""),!0),n}function oe(n,e,t){if(r(n))for(var a=0;a<n.length;a++)n[a]&&"string"!=typeof n[a]&&le(n[a],"".concat(e,"_").concat(a),t);else le(n,e,t)}function le(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function se(n,e){if(e)if(p(e)){var t=n.on=n.on?M({},n.on):{};for(var a in e){var r=t[a],i=e[a];t[a]=r?[].concat(r,i):i}}else;return n}function ce(n,e,t,a){e=e||{$stable:!t};for(var i=0;i<n.length;i++){var o=n[i];r(o)?ce(o,e,t):o&&(o.proxy&&(o.fn.proxy=!0),e[o.key]=o.fn)}return a&&(e.$key=a),e}function ue(n,e){for(var t=0;t<e.length;t+=2){var a=e[t];"string"==typeof a&&a&&(n[e[t]]=e[t+1])}return n}function de(n,e){return"string"==typeof n?e+n:n}function pe(n){n._o=ie,n._n=b,n._s=g,n._l=Yn,n._t=Zn,n._q=D,n._i=R,n._m=re,n._f=ne,n._k=te,n._b=ae,n._v=gn,n._e=vn,n._u=ce,n._g=se,n._d=ue,n._p=de}function me(n,e){if(!n||!n.length)return{};for(var t={},a=0,r=n.length;a<r;a++){var i=n[a],o=i.data;if(o&&o.attrs&&o.attrs.slot&&delete o.attrs.slot,i.context!==e&&i.fnContext!==e||!o||null==o.slot)(t.default||(t.default=[])).push(i);else{var l=o.slot,s=t[l]||(t[l]=[]);"template"===i.tag?s.push.apply(s,i.children||[]):s.push(i)}}for(var c in t)t[c].every(he)&&delete t[c];return t}function he(n){return n.isComment&&!n.asyncFactory||" "===n.text}function ve(n){return n.isComment&&n.asyncFactory}function ge(n,e,t,r){var i,o=Object.keys(t).length>0,l=e?!!e.$stable:!o,s=e&&e.$key;if(e){if(e._normalized)return e._normalized;if(l&&r&&r!==a&&s===r.$key&&!o&&!r.$hasNormal)return r;for(var c in i={},e)e[c]&&"$"!==c[0]&&(i[c]=fe(n,t,c,e[c]))}else i={};for(var u in t)u in i||(i[u]=be(t,u));return e&&Object.isExtensible(e)&&(e._normalized=i),G(i,"$stable",l),G(i,"$key",s),G(i,"$hasNormal",o),i}function fe(n,e,t,a){var i=function(){var e=pn;mn(n);var t=arguments.length?a.apply(null,arguments):a({}),i=(t=t&&"object"==typeof t&&!r(t)?[t]:Xn(t))&&t[0];return mn(e),t&&(!i||1===t.length&&i.isComment&&!ve(i))?void 0:t};return a.proxy&&Object.defineProperty(e,t,{get:i,enumerable:!0,configurable:!0}),i}function be(n,e){return function(){return n[e]}}function ye(n){return{get attrs(){if(!n._attrsProxy){var e=n._attrsProxy={};G(e,"_v_attr_proxy",!0),xe(e,n.$attrs,a,n,"$attrs")}return n._attrsProxy},get listeners(){n._listenersProxy||xe(n._listenersProxy={},n.$listeners,a,n,"$listeners");return n._listenersProxy},get slots(){return function(n){n._slotsProxy||je(n._slotsProxy={},n.$scopedSlots);return n._slotsProxy}(n)},emit:J(n.$emit,n),expose:function(e){e&&Object.keys(e).forEach((function(t){return Nn(n,e,t)}))}}}function xe(n,e,t,a,r){var i=!1;for(var o in e)o in n?e[o]!==t[o]&&(i=!0):(i=!0,ke(n,o,a,r));for(var o in n)o in e||(i=!0,delete n[o]);return i}function ke(n,e,t,a){Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){return t[a][e]}})}function je(n,e){for(var t in e)n[t]=e[t];for(var t in n)t in e||delete n[t]}var we=null;function Se(n,e){return(n.__esModule||dn&&"Module"===n[Symbol.toStringTag])&&(n=n.default),u(n)?e.extend(n):n}function Te(n){if(r(n))for(var e=0;e<n.length;e++){var t=n[e];if(o(t)&&(o(t.componentOptions)||ve(t)))return t}}function Ie(n,e,t,a,d,p){return(r(t)||s(t))&&(d=a,a=t,t=void 0),l(p)&&(d=2),function(n,e,t,a,s){if(o(t)&&o(t.__ob__))return vn();o(t)&&o(t.is)&&(e=t.is);if(!e)return vn();0;r(a)&&c(a[0])&&((t=t||{}).scopedSlots={default:a[0]},a.length=0);2===s?a=Xn(a):1===s&&(a=function(n){for(var e=0;e<n.length;e++)if(r(n[e]))return Array.prototype.concat.apply([],n);return n}(a));var d,p;if("string"==typeof e){var m=void 0;p=n.$vnode&&n.$vnode.ns||U.getTagNamespace(e),d=U.isReservedTag(e)?new hn(U.parsePlatformTagName(e),t,a,void 0,void 0,n):t&&t.pre||!o(m=At(n.$options,"components",e))?new hn(e,t,a,void 0,void 0,n):kt(m,t,n,a,e)}else d=kt(e,t,n,a);return r(d)?d:o(d)?(o(p)&&function n(e,t,a){e.ns=t,"foreignObject"===e.tag&&(t=void 0,a=!0);if(o(e.children))for(var r=0,s=e.children.length;r<s;r++){var c=e.children[r];o(c.tag)&&(i(c.ns)||l(a)&&"svg"!==c.tag)&&n(c,t,a)}}(d,p),o(t)&&function(n){u(n.style)&&Ue(n.style);u(n.class)&&Ue(n.class)}(t),d):vn()}(n,e,t,a,d)}function Ce(n,e,t){jn();try{if(e)for(var a=e;a=a.$parent;){var r=a.$options.errorCaptured;if(r)for(var i=0;i<r.length;i++)try{if(!1===r[i].call(a,n,e,t))return}catch(n){Ee(n,a,"errorCaptured hook")}}Ee(n,e,t)}finally{wn()}}function ze(n,e,t,a,r){var i;try{(i=t?n.apply(e,t):n.call(e))&&!i._isVue&&v(i)&&!i._handled&&(i.catch((function(n){return Ce(n,a,r+" (Promise/async)")})),i._handled=!0)}catch(n){Ce(n,a,r)}return i}function Ee(n,e,t){if(U.errorHandler)try{return U.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Je(e,null,"config.errorHandler")}Je(n,e,t)}function Je(n,e,t){if(!K||"undefined"==typeof console)throw n;console.error(n)}var Ae,Me=!1,Le=[],Oe=!1;function Pe(){Oe=!1;var n=Le.slice(0);Le.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&cn(Promise)){var _e=Promise.resolve();Ae=function(){_e.then(Pe),nn&&setTimeout(O)},Me=!0}else if(Q||"undefined"==typeof MutationObserver||!cn(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Ae="undefined"!=typeof setImmediate&&cn(setImmediate)?function(){setImmediate(Pe)}:function(){setTimeout(Pe,0)};else{var De=1,Re=new MutationObserver(Pe),Be=document.createTextNode(String(De));Re.observe(Be,{characterData:!0}),Ae=function(){De=(De+1)%2,Be.data=String(De)},Me=!0}function Fe(n,e){var t;if(Le.push((function(){if(n)try{n.call(e)}catch(n){Ce(n,e,"nextTick")}else t&&t(e)})),Oe||(Oe=!0,Ae()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}function Ne(n){return function(e,t){if(void 0===t&&(t=pn),t)return function(n,e,t){var a=n.$options;a[e]=Ct(a[e],t)}(t,n,e)}}Ne("beforeMount"),Ne("mounted"),Ne("beforeUpdate"),Ne("updated"),Ne("beforeDestroy"),Ne("destroyed"),Ne("activated"),Ne("deactivated"),Ne("serverPrefetch"),Ne("renderTracked"),Ne("renderTriggered"),Ne("errorCaptured");var qe=new un;function Ue(n){return function n(e,t){var a,i,o=r(e);if(!o&&!u(e)||e.__v_skip||Object.isFrozen(e)||e instanceof hn)return;if(e.__ob__){var l=e.__ob__.dep.id;if(t.has(l))return;t.add(l)}if(o)for(a=e.length;a--;)n(e[a],t);else if(Fn(e))n(e.value,t);else for(i=Object.keys(e),a=i.length;a--;)n(e[i[a]],t)}(n,qe),qe.clear(),n}var Ve,He=0,Ge=function(){function n(n,e,t,a,r){var i,o;i=this,void 0===(o=qn&&!qn._vm?qn:n?n._scope:void 0)&&(o=qn),o&&o.active&&o.effects.push(i),(this.vm=n)&&r&&(n._watcher=this),a?(this.deep=!!a.deep,this.user=!!a.user,this.lazy=!!a.lazy,this.sync=!!a.sync,this.before=a.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++He,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new un,this.newDepIds=new un,this.expression="",c(e)?this.getter=e:(this.getter=function(n){if(!$.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=O)),this.value=this.lazy?void 0:this.get()}return n.prototype.get=function(){var n;jn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;Ce(n,e,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&Ue(n),wn(),this.cleanupDeps()}return n},n.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},n.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},n.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():mt(this)},n.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||u(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'.concat(this.expression,'"');ze(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},n.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},n.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},n.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&k(this.vm._scope.effects,this),this.active){for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},n}();function $e(n,e){Ve.$on(n,e)}function We(n,e){Ve.$off(n,e)}function Ke(n,e){var t=Ve;return function a(){var r=e.apply(null,arguments);null!==r&&t.$off(n,a)}}function Xe(n,e,t){Ve=n,$n(e,t||{},$e,We,Ke,n),Ve=void 0}var Qe=null;function Ye(n){var e=Qe;return Qe=n,function(){Qe=e}}function Ze(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function nt(n,e){if(e){if(n._directInactive=!1,Ze(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)nt(n.$children[t]);et(n,"activated")}}function et(n,e,t,a){void 0===a&&(a=!0),jn();var r=pn,i=qn;a&&mn(n);var o=n.$options[e],l="".concat(e," hook");if(o)for(var s=0,c=o.length;s<c;s++)ze(o[s],n,t||null,n,l);n._hasHookEvent&&n.$emit("hook:"+e),a&&(mn(r),i&&i.on()),wn()}var tt=[],at=[],rt={},it=!1,ot=!1,lt=0;var st=0,ct=Date.now;if(K&&!Q){var ut=window.performance;ut&&"function"==typeof ut.now&&ct()>document.createEvent("Event").timeStamp&&(ct=function(){return ut.now()})}var dt=function(n,e){if(n.post){if(!e.post)return 1}else if(e.post)return-1;return n.id-e.id};function pt(){var n,e;for(st=ct(),ot=!0,tt.sort(dt),lt=0;lt<tt.length;lt++)(n=tt[lt]).before&&n.before(),e=n.id,rt[e]=null,n.run();var t=at.slice(),a=tt.slice();lt=tt.length=at.length=0,rt={},it=ot=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,nt(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],a=t.vm;a&&a._watcher===t&&a._isMounted&&!a._isDestroyed&&et(a,"updated")}}(a),function(){for(var n=0;n<yn.length;n++){var e=yn[n];e.subs=e.subs.filter((function(n){return n})),e._pending=!1}yn.length=0}(),sn&&U.devtools&&sn.emit("flush")}function mt(n){var e=n.id;if(null==rt[e]&&(n!==xn.target||!n.noRecurse)){if(rt[e]=!0,ot){for(var t=tt.length-1;t>lt&&tt[t].id>n.id;)t--;tt.splice(t+1,0,n)}else tt.push(n);it||(it=!0,Fe(pt))}}function ht(n,e){if(n){for(var t=Object.create(null),a=dn?Reflect.ownKeys(n):Object.keys(n),r=0;r<a.length;r++){var i=a[r];if("__ob__"!==i){var o=n[i].from;if(o in e._provided)t[i]=e._provided[o];else if("default"in n[i]){var l=n[i].default;t[i]=c(l)?l.call(e):l}else 0}}return t}}function vt(n,e,t,i,o){var s,c=this,u=o.options;w(i,"_uid")?(s=Object.create(i))._original=i:(s=i,i=i._original);var d=l(u._compiled),p=!d;this.data=n,this.props=e,this.children=t,this.parent=i,this.listeners=n.on||a,this.injections=ht(u.inject,i),this.slots=function(){return c.$slots||ge(i,n.scopedSlots,c.$slots=me(t,i)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ge(i,n.scopedSlots,this.slots())}}),d&&(this.$options=u,this.$slots=this.slots(),this.$scopedSlots=ge(i,n.scopedSlots,this.$slots)),u._scopeId?this._c=function(n,e,t,a){var o=Ie(s,n,e,t,a,p);return o&&!r(o)&&(o.fnScopeId=u._scopeId,o.fnContext=i),o}:this._c=function(n,e,t,a){return Ie(s,n,e,t,a,p)}}function gt(n,e,t,a,r){var i=fn(n);return i.fnContext=t,i.fnOptions=a,e.slot&&((i.data||(i.data={})).slot=e.slot),i}function ft(n,e){for(var t in e)n[I(t)]=e[t]}function bt(n){return n.name||n.__name||n._componentTag}pe(vt.prototype);var yt={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;yt.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},a=n.data.inlineTemplate;o(a)&&(t.render=a.render,t.staticRenderFns=a.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Qe)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,r,i){var o=r.data.scopedSlots,l=n.$scopedSlots,s=!!(o&&!o.$stable||l!==a&&!l.$stable||o&&n.$scopedSlots.$key!==o.$key||!o&&n.$scopedSlots.$key),c=!!(i||n.$options._renderChildren||s),u=n.$vnode;n.$options._parentVnode=r,n.$vnode=r,n._vnode&&(n._vnode.parent=r),n.$options._renderChildren=i;var d=r.data.attrs||a;n._attrsProxy&&xe(n._attrsProxy,d,u.data&&u.data.attrs||a,n,"$attrs")&&(c=!0),n.$attrs=d,t=t||a;var p=n.$options._parentListeners;if(n._listenersProxy&&xe(n._listenersProxy,t,p||a,n,"$listeners"),n.$listeners=n.$options._parentListeners=t,Xe(n,t,p),e&&n.$options.props){En(!1);for(var m=n._props,h=n.$options._propKeys||[],v=0;v<h.length;v++){var g=h[v],f=n.$options.props;m[g]=Mt(g,f,e,n)}En(!0),n.$options.propsData=e}c&&(n.$slots=me(i,r.context),n.$forceUpdate())}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,a=n.componentInstance;a._isMounted||(a._isMounted=!0,et(a,"mounted")),n.data.keepAlive&&(t._isMounted?((e=a)._inactive=!1,at.push(e)):nt(a,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(!(t&&(e._directInactive=!0,Ze(e))||e._inactive)){e._inactive=!0;for(var a=0;a<e.$children.length;a++)n(e.$children[a]);et(e,"deactivated")}}(e,!0):e.$destroy())}},xt=Object.keys(yt);function kt(n,e,t,s,c){if(!i(n)){var d=t.$options._base;if(u(n)&&(n=d.extend(n)),"function"==typeof n){var p;if(i(n.cid)&&void 0===(n=function(n,e){if(l(n.error)&&o(n.errorComp))return n.errorComp;if(o(n.resolved))return n.resolved;var t=we;if(t&&o(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t),l(n.loading)&&o(n.loadingComp))return n.loadingComp;if(t&&!o(n.owners)){var a=n.owners=[t],r=!0,s=null,c=null;t.$on("hook:destroyed",(function(){return k(a,t)}));var d=function(n){for(var e=0,t=a.length;e<t;e++)a[e].$forceUpdate();n&&(a.length=0,null!==s&&(clearTimeout(s),s=null),null!==c&&(clearTimeout(c),c=null))},p=B((function(t){n.resolved=Se(t,e),r?a.length=0:d(!0)})),m=B((function(e){o(n.errorComp)&&(n.error=!0,d(!0))})),h=n(p,m);return u(h)&&(v(h)?i(n.resolved)&&h.then(p,m):v(h.component)&&(h.component.then(p,m),o(h.error)&&(n.errorComp=Se(h.error,e)),o(h.loading)&&(n.loadingComp=Se(h.loading,e),0===h.delay?n.loading=!0:s=setTimeout((function(){s=null,i(n.resolved)&&i(n.error)&&(n.loading=!0,d(!1))}),h.delay||200)),o(h.timeout)&&(c=setTimeout((function(){c=null,i(n.resolved)&&m(null)}),h.timeout)))),r=!1,n.loading?n.loadingComp:n.resolved}}(p=n,d)))return function(n,e,t,a,r){var i=vn();return i.asyncFactory=n,i.asyncMeta={data:e,context:t,children:a,tag:r},i}(p,e,t,s,c);e=e||{},Gt(n),o(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",a=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var i=e.on||(e.on={}),l=i[a],s=e.model.callback;o(l)?(r(l)?-1===l.indexOf(s):l!==s)&&(i[a]=[s].concat(l)):i[a]=s}(n.options,e);var m=function(n,e,t){var a=e.options.props;if(!i(a)){var r={},l=n.attrs,s=n.props;if(o(l)||o(s))for(var c in a){var u=E(c);Kn(r,s,c,u,!0)||Kn(r,l,c,u,!1)}return r}}(e,n);if(l(n.options.functional))return function(n,e,t,i,l){var s=n.options,c={},u=s.props;if(o(u))for(var d in u)c[d]=Mt(d,u,e||a);else o(t.attrs)&&ft(c,t.attrs),o(t.props)&&ft(c,t.props);var p=new vt(t,c,l,i,n),m=s.render.call(null,p._c,p);if(m instanceof hn)return gt(m,t,p.parent,s,p);if(r(m)){for(var h=Xn(m)||[],v=new Array(h.length),g=0;g<h.length;g++)v[g]=gt(h[g],t,p.parent,s,p);return v}}(n,m,e,t,s);var h=e.on;if(e.on=e.nativeOn,l(n.options.abstract)){var g=e.slot;e={},g&&(e.slot=g)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<xt.length;t++){var a=xt[t],r=e[a],i=yt[a];r===i||r&&r._merged||(e[a]=r?jt(i,r):i)}}(e);var f=bt(n.options)||c;return new hn("vue-component-".concat(n.cid).concat(f?"-".concat(f):""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:m,listeners:h,tag:c,children:s},p)}}}function jt(n,e){var t=function(t,a){n(t,a),e(t,a)};return t._merged=!0,t}var wt=O,St=U.optionMergeStrategies;function Tt(n,e,t){if(void 0===t&&(t=!0),!e)return n;for(var a,r,i,o=dn?Reflect.ownKeys(e):Object.keys(e),l=0;l<o.length;l++)"__ob__"!==(a=o[l])&&(r=n[a],i=e[a],t&&w(n,a)?r!==i&&p(r)&&p(i)&&Tt(r,i):On(n,a,i));return n}function It(n,e,t){return t?function(){var a=c(e)?e.call(t,t):e,r=c(n)?n.call(t,t):n;return a?Tt(a,r):r}:e?n?function(){return Tt(c(e)?e.call(this,this):e,c(n)?n.call(this,this):n)}:e:n}function Ct(n,e){var t=e?n?n.concat(e):r(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function zt(n,e,t,a){var r=Object.create(n||null);return e?M(r,e):r}St.data=function(n,e,t){return t?It(n,e,t):e&&"function"!=typeof e?n:It(n,e)},q.forEach((function(n){St[n]=Ct})),N.forEach((function(n){St[n+"s"]=zt})),St.watch=function(n,e,t,a){if(n===an&&(n=void 0),e===an&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var i={};for(var o in M(i,n),e){var l=i[o],s=e[o];l&&!r(l)&&(l=[l]),i[o]=l?l.concat(s):r(s)?s:[s]}return i},St.props=St.methods=St.inject=St.computed=function(n,e,t,a){if(!n)return e;var r=Object.create(null);return M(r,n),e&&M(r,e),r},St.provide=function(n,e){return n?function(){var t=Object.create(null);return Tt(t,c(n)?n.call(this):n),e&&Tt(t,c(e)?e.call(this):e,!1),t}:e};var Et=function(n,e){return void 0===e?n:e};function Jt(n,e,t){if(c(e)&&(e=e.options),function(n,e){var t=n.props;if(t){var a,i,o={};if(r(t))for(a=t.length;a--;)"string"==typeof(i=t[a])&&(o[I(i)]={type:null});else if(p(t))for(var l in t)i=t[l],o[I(l)]=p(i)?i:{type:i};else 0;n.props=o}}(e),function(n,e){var t=n.inject;if(t){var a=n.inject={};if(r(t))for(var i=0;i<t.length;i++)a[t[i]]={from:t[i]};else if(p(t))for(var o in t){var l=t[o];a[o]=p(l)?M({from:o},l):{from:l}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var a=e[t];c(a)&&(e[t]={bind:a,update:a})}}(e),!e._base&&(e.extends&&(n=Jt(n,e.extends,t)),e.mixins))for(var a=0,i=e.mixins.length;a<i;a++)n=Jt(n,e.mixins[a],t);var o,l={};for(o in n)s(o);for(o in e)w(n,o)||s(o);function s(a){var r=St[a]||Et;l[a]=r(n[a],e[a],t,a)}return l}function At(n,e,t,a){if("string"==typeof t){var r=n[e];if(w(r,t))return r[t];var i=I(t);if(w(r,i))return r[i];var o=C(i);return w(r,o)?r[o]:r[t]||r[i]||r[o]}}function Mt(n,e,t,a){var r=e[n],i=!w(t,n),o=t[n],l=_t(Boolean,r.type);if(l>-1)if(i&&!w(r,"default"))o=!1;else if(""===o||o===E(n)){var s=_t(String,r.type);(s<0||l<s)&&(o=!0)}if(void 0===o){o=function(n,e,t){if(!w(e,"default"))return;var a=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return c(a)&&"Function"!==Ot(e.type)?a.call(n):a}(a,r,n);var u=zn;En(!0),Mn(o),En(u)}return o}var Lt=/^\s*function (\w+)/;function Ot(n){var e=n&&n.toString().match(Lt);return e?e[1]:""}function Pt(n,e){return Ot(n)===Ot(e)}function _t(n,e){if(!r(e))return Pt(e,n)?0:-1;for(var t=0,a=e.length;t<a;t++)if(Pt(e[t],n))return t;return-1}var Dt={enumerable:!0,configurable:!0,get:O,set:O};function Rt(n,e,t){Dt.get=function(){return this[e][t]},Dt.set=function(n){this[e][t]=n},Object.defineProperty(n,t,Dt)}function Bt(n){var e=n.$options;if(e.props&&function(n,e){var t=n.$options.propsData||{},a=n._props=Dn({}),r=n.$options._propKeys=[];n.$parent&&En(!1);var i=function(i){r.push(i);var o=Mt(i,e,t,n);Ln(a,i,o,void 0,!0),i in n||Rt(n,"_props",i)};for(var o in e)i(o);En(!0)}(n,e.props),function(n){var e=n.$options,t=e.setup;if(t){var a=n._setupContext=ye(n);mn(n),jn();var r=ze(t,null,[n._props||Dn({}),a],n,"setup");if(wn(),mn(),c(r))e.render=r;else if(u(r))if(n._setupState=r,r.__sfc){var i=n._setupProxy={};for(var o in r)"__sfc"!==o&&Nn(i,r,o)}else for(var o in r)H(o)||Nn(n,r,o);else 0}}(n),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?O:J(e[t],n)}(n,e.methods),e.data)!function(n){var e=n.$options.data;p(e=n._data=c(e)?function(n,e){jn();try{return n.call(e,e)}catch(n){return Ce(n,e,"data()"),{}}finally{wn()}}(e,n):e||{})||(e={});var t=Object.keys(e),a=n.$options.props,r=(n.$options.methods,t.length);for(;r--;){var i=t[r];0,a&&w(a,i)||H(i)||Rt(n,"_data",i)}var o=Mn(e);o&&o.vmCount++}(n);else{var t=Mn(n._data={});t&&t.vmCount++}e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),a=ln();for(var r in e){var i=e[r],o=c(i)?i:i.get;0,a||(t[r]=new Ge(n,o||O,O,Ft)),r in n||Nt(n,r,i)}}(n,e.computed),e.watch&&e.watch!==an&&function(n,e){for(var t in e){var a=e[t];if(r(a))for(var i=0;i<a.length;i++)Vt(n,t,a[i]);else Vt(n,t,a)}}(n,e.watch)}var Ft={lazy:!0};function Nt(n,e,t){var a=!ln();c(t)?(Dt.get=a?qt(e):Ut(t),Dt.set=O):(Dt.get=t.get?a&&!1!==t.cache?qt(e):Ut(t.get):O,Dt.set=t.set||O),Object.defineProperty(n,e,Dt)}function qt(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),xn.target&&e.depend(),e.value}}function Ut(n){return function(){return n.call(this,this)}}function Vt(n,e,t,a){return p(t)&&(a=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,a)}var Ht=0;function Gt(n){var e=n.options;if(n.super){var t=Gt(n.super);if(t!==n.superOptions){n.superOptions=t;var a=function(n){var e,t=n.options,a=n.sealedOptions;for(var r in t)t[r]!==a[r]&&(e||(e={}),e[r]=t[r]);return e}(n);a&&M(n.extendOptions,a),(e=n.options=Jt(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function $t(n){this._init(n)}function Wt(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,a=t.cid,r=n._Ctor||(n._Ctor={});if(r[a])return r[a];var i=bt(n)||bt(t.options);var o=function(n){this._init(n)};return(o.prototype=Object.create(t.prototype)).constructor=o,o.cid=e++,o.options=Jt(t.options,n),o.super=t,o.options.props&&function(n){var e=n.options.props;for(var t in e)Rt(n.prototype,"_props",t)}(o),o.options.computed&&function(n){var e=n.options.computed;for(var t in e)Nt(n.prototype,t,e[t])}(o),o.extend=t.extend,o.mixin=t.mixin,o.use=t.use,N.forEach((function(n){o[n]=t[n]})),i&&(o.options.components[i]=o),o.superOptions=t.options,o.extendOptions=n,o.sealedOptions=M({},o.options),r[a]=o,o}}function Kt(n){return n&&(bt(n.Ctor.options)||n.tag)}function Xt(n,e){return r(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!m(n)&&n.test(e)}function Qt(n,e){var t=n.cache,a=n.keys,r=n._vnode,i=n.$vnode;for(var o in t){var l=t[o];if(l){var s=l.name;s&&!e(s)&&Yt(t,o,a,r)}}i.componentOptions.children=void 0}function Yt(n,e,t,a){var r=n[e];!r||a&&r.tag===a.tag||r.componentInstance.$destroy(),n[e]=null,k(t,e)}!function(n){n.prototype._init=function(n){var e=this;e._uid=Ht++,e._isVue=!0,e.__v_skip=!0,e._scope=new Un(!0),e._scope.parent=void 0,e._scope._vm=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),a=e._parentVnode;t.parent=e.parent,t._parentVnode=a;var r=a.componentOptions;t.propsData=r.propsData,t._parentListeners=r.listeners,t._renderChildren=r.children,t._componentTag=r.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=Jt(Gt(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._provided=t?t._provided:Object.create(null),n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&Xe(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,r=t&&t.context;n.$slots=me(e._renderChildren,r),n.$scopedSlots=t?ge(n.$parent,t.data.scopedSlots,n.$slots):a,n._c=function(e,t,a,r){return Ie(n,e,t,a,r,!1)},n.$createElement=function(e,t,a,r){return Ie(n,e,t,a,r,!0)};var i=t&&t.data;Ln(n,"$attrs",i&&i.attrs||a,null,!0),Ln(n,"$listeners",e._parentListeners||a,null,!0)}(e),et(e,"beforeCreate",void 0,!1),function(n){var e=ht(n.$options.inject,n);e&&(En(!1),Object.keys(e).forEach((function(t){Ln(n,t,e[t])})),En(!0))}(e),Bt(e),function(n){var e=n.$options.provide;if(e){var t=c(e)?e.call(n):e;if(!u(t))return;for(var a=Vn(n),r=dn?Reflect.ownKeys(t):Object.keys(t),i=0;i<r.length;i++){var o=r[i];Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(t,o))}}}(e),et(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}($t),function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=On,n.prototype.$delete=Pn,n.prototype.$watch=function(n,e,t){if(p(e))return Vt(this,n,e,t);(t=t||{}).user=!0;var a=new Ge(this,n,e,t);if(t.immediate){var r='callback for immediate watcher "'.concat(a.expression,'"');jn(),ze(e,this,[a.value],this,r),wn()}return function(){a.teardown()}}}($t),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var a=this;if(r(n))for(var i=0,o=n.length;i<o;i++)a.$on(n[i],t);else(a._events[n]||(a._events[n]=[])).push(t),e.test(n)&&(a._hasHookEvent=!0);return a},n.prototype.$once=function(n,e){var t=this;function a(){t.$off(n,a),e.apply(t,arguments)}return a.fn=e,t.$on(n,a),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(r(n)){for(var a=0,i=n.length;a<i;a++)t.$off(n[a],e);return t}var o,l=t._events[n];if(!l)return t;if(!e)return t._events[n]=null,t;for(var s=l.length;s--;)if((o=l[s])===e||o.fn===e){l.splice(s,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?A(t):t;for(var a=A(arguments,1),r='event handler for "'.concat(n,'"'),i=0,o=t.length;i<o;i++)ze(t[i],e,a,e,r)}return e}}($t),function(n){n.prototype._update=function(n,e){var t=this,a=t.$el,r=t._vnode,i=Ye(t);t._vnode=n,t.$el=r?t.__patch__(r,n):t.__patch__(t.$el,n,e,!1),i(),a&&(a.__vue__=null),t.$el&&(t.$el.__vue__=t);for(var o=t;o&&o.$vnode&&o.$parent&&o.$vnode===o.$parent._vnode;)o.$parent.$el=o.$el,o=o.$parent},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){et(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||k(e.$children,n),n._scope.stop(),n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),et(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}($t),function(n){pe(n.prototype),n.prototype.$nextTick=function(n){return Fe(n,this)},n.prototype._render=function(){var n=this,e=n.$options,t=e.render,a=e._parentVnode;a&&n._isMounted&&(n.$scopedSlots=ge(n.$parent,a.data.scopedSlots,n.$slots,n.$scopedSlots),n._slotsProxy&&je(n._slotsProxy,n.$scopedSlots)),n.$vnode=a;var i,o=pn,l=we;try{mn(n),we=n,i=t.call(n._renderProxy,n.$createElement)}catch(e){Ce(e,n,"render"),i=n._vnode}finally{we=l,mn(o)}return r(i)&&1===i.length&&(i=i[0]),i instanceof hn||(i=vn()),i.parent=a,i}}($t);var Zt=[String,RegExp,Array],na={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Zt,exclude:Zt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,a=this.keyToCache;if(t){var r=t.tag,i=t.componentInstance,o=t.componentOptions;n[a]={name:Kt(o),tag:r,componentInstance:i},e.push(a),this.max&&e.length>parseInt(this.max)&&Yt(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)Yt(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){Qt(n,(function(n){return Xt(e,n)}))})),this.$watch("exclude",(function(e){Qt(n,(function(n){return!Xt(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=Te(n),t=e&&e.componentOptions;if(t){var a=Kt(t),r=this.include,i=this.exclude;if(r&&(!a||!Xt(r,a))||i&&a&&Xt(i,a))return e;var o=this.cache,l=this.keys,s=null==e.key?t.Ctor.cid+(t.tag?"::".concat(t.tag):""):e.key;o[s]?(e.componentInstance=o[s].componentInstance,k(l,s),l.push(s)):(this.vnodeToCache=e,this.keyToCache=s),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return U}};Object.defineProperty(n,"config",e),n.util={warn:wt,extend:M,mergeOptions:Jt,defineReactive:Ln},n.set=On,n.delete=Pn,n.nextTick=Fe,n.observable=function(n){return Mn(n),n},n.options=Object.create(null),N.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,M(n.options.components,na),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=A(arguments,1);return t.unshift(this),c(n.install)?n.install.apply(n,t):c(n)&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=Jt(this.options,n),this}}(n),Wt(n),function(n){N.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&p(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&c(t)&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}($t),Object.defineProperty($t.prototype,"$isServer",{get:ln}),Object.defineProperty($t.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty($t,"FunctionalRenderContext",{value:vt}),$t.version="2.7.16";var ea=y("style,class"),ta=y("input,textarea,option,select,progress"),aa=y("contenteditable,draggable,spellcheck"),ra=y("events,caret,typing,plaintext-only"),ia=y("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),oa="http://www.w3.org/1999/xlink",la=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},sa=function(n){return la(n)?n.slice(6,n.length):""},ca=function(n){return null==n||!1===n};function ua(n){for(var e=n.data,t=n,a=n;o(a.componentInstance);)(a=a.componentInstance._vnode)&&a.data&&(e=da(a.data,e));for(;o(t=t.parent);)t&&t.data&&(e=da(e,t.data));return function(n,e){if(o(n)||o(e))return pa(n,ma(e));return""}(e.staticClass,e.class)}function da(n,e){return{staticClass:pa(n.staticClass,e.staticClass),class:o(n.class)?[n.class,e.class]:e.class}}function pa(n,e){return n?e?n+" "+e:n:e||""}function ma(n){return Array.isArray(n)?function(n){for(var e,t="",a=0,r=n.length;a<r;a++)o(e=ma(n[a]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):u(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var ha={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},va=y("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),ga=y("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),fa=function(n){return va(n)||ga(n)};var ba=Object.create(null);var ya=y("text,number,password,search,email,tel,url");var xa=Object.freeze({__proto__:null,createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(ha[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),ka={create:function(n,e){ja(e)},update:function(n,e){n.data.ref!==e.data.ref&&(ja(n,!0),ja(e))},destroy:function(n){ja(n,!0)}};function ja(n,e){var t=n.data.ref;if(o(t)){var a=n.context,i=n.componentInstance||n.elm,l=e?null:i,s=e?void 0:i;if(c(t))ze(t,a,[l],a,"template ref function");else{var u=n.data.refInFor,d="string"==typeof t||"number"==typeof t,p=Fn(t),m=a.$refs;if(d||p)if(u){var h=d?m[t]:t.value;e?r(h)&&k(h,i):r(h)?h.includes(i)||h.push(i):d?(m[t]=[i],wa(a,t,m[t])):t.value=[i]}else if(d){if(e&&m[t]!==i)return;m[t]=s,wa(a,t,l)}else if(p){if(e&&t.value!==i)return;t.value=l}else 0}}}function wa(n,e,t){var a=n._setupState;a&&w(a,e)&&(Fn(a[e])?a[e].value=t:a[e]=t)}var Sa=new hn("",{},[]),Ta=["create","activate","update","remove","destroy"];function Ia(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&o(n.data)===o(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,a=o(t=n.data)&&o(t=t.attrs)&&t.type,r=o(t=e.data)&&o(t=t.attrs)&&t.type;return a===r||ya(a)&&ya(r)}(n,e)||l(n.isAsyncPlaceholder)&&i(e.asyncFactory.error))}function Ca(n,e,t){var a,r,i={};for(a=e;a<=t;++a)o(r=n[a].key)&&(i[r]=a);return i}var za={create:Ea,update:Ea,destroy:function(n){Ea(n,Sa)}};function Ea(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,a,r,i=n===Sa,o=e===Sa,l=Aa(n.data.directives,n.context),s=Aa(e.data.directives,e.context),c=[],u=[];for(t in s)a=l[t],r=s[t],a?(r.oldValue=a.value,r.oldArg=a.arg,La(r,"update",e,n),r.def&&r.def.componentUpdated&&u.push(r)):(La(r,"bind",e,n),r.def&&r.def.inserted&&c.push(r));if(c.length){var d=function(){for(var t=0;t<c.length;t++)La(c[t],"inserted",e,n)};i?Wn(e,"insert",d):d()}u.length&&Wn(e,"postpatch",(function(){for(var t=0;t<u.length;t++)La(u[t],"componentUpdated",e,n)}));if(!i)for(t in l)s[t]||La(l[t],"unbind",n,n,o)}(n,e)}var Ja=Object.create(null);function Aa(n,e){var t,a,r=Object.create(null);if(!n)return r;for(t=0;t<n.length;t++){if((a=n[t]).modifiers||(a.modifiers=Ja),r[Ma(a)]=a,e._setupState&&e._setupState.__sfc){var i=a.def||At(e,"_setupState","v-"+a.name);a.def="function"==typeof i?{bind:i,update:i}:i}a.def=a.def||At(e.$options,"directives",a.name)}return r}function Ma(n){return n.rawName||"".concat(n.name,".").concat(Object.keys(n.modifiers||{}).join("."))}function La(n,e,t,a,r){var i=n.def&&n.def[e];if(i)try{i(t.elm,n,t,a,r)}catch(a){Ce(a,t.context,"directive ".concat(n.name," ").concat(e," hook"))}}var Oa=[ka,za];function Pa(n,e){var t=e.componentOptions;if(!(o(t)&&!1===t.Ctor.options.inheritAttrs||i(n.data.attrs)&&i(e.data.attrs))){var a,r,s=e.elm,c=n.data.attrs||{},u=e.data.attrs||{};for(a in(o(u.__ob__)||l(u._v_attr_proxy))&&(u=e.data.attrs=M({},u)),u)r=u[a],c[a]!==r&&_a(s,a,r,e.data.pre);for(a in(Q||Z)&&u.value!==c.value&&_a(s,"value",u.value),c)i(u[a])&&(la(a)?s.removeAttributeNS(oa,sa(a)):aa(a)||s.removeAttribute(a))}}function _a(n,e,t,a){a||n.tagName.indexOf("-")>-1?Da(n,e,t):ia(e)?ca(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):aa(e)?n.setAttribute(e,function(n,e){return ca(e)||"false"===e?"false":"contenteditable"===n&&ra(e)?e:"true"}(e,t)):la(e)?ca(t)?n.removeAttributeNS(oa,sa(e)):n.setAttributeNS(oa,e,t):Da(n,e,t)}function Da(n,e,t){if(ca(t))n.removeAttribute(e);else{if(Q&&!Y&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var a=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",a)};n.addEventListener("input",a),n.__ieph=!0}n.setAttribute(e,t)}}var Ra={create:Pa,update:Pa};function Ba(n,e){var t=e.elm,a=e.data,r=n.data;if(!(i(a.staticClass)&&i(a.class)&&(i(r)||i(r.staticClass)&&i(r.class)))){var l=ua(e),s=t._transitionClasses;o(s)&&(l=pa(l,ma(s))),l!==t._prevClass&&(t.setAttribute("class",l),t._prevClass=l)}}var Fa,Na={create:Ba,update:Ba};function qa(n,e,t){var a=Fa;return function r(){var i=e.apply(null,arguments);null!==i&&Ha(n,r,t,a)}}var Ua=Me&&!(tn&&Number(tn[1])<=53);function Va(n,e,t,a){if(Ua){var r=st,i=e;e=i._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=r||n.timeStamp<=0||n.target.ownerDocument!==document)return i.apply(this,arguments)}}Fa.addEventListener(n,e,rn?{capture:t,passive:a}:t)}function Ha(n,e,t,a){(a||Fa).removeEventListener(n,e._wrapper||e,t)}function Ga(n,e){if(!i(n.data.on)||!i(e.data.on)){var t=e.data.on||{},a=n.data.on||{};Fa=e.elm||n.elm,function(n){if(o(n.__r)){var e=Q?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}o(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),$n(t,a,Va,Ha,qa,e.context),Fa=void 0}}var $a,Wa={create:Ga,update:Ga,destroy:function(n){return Ga(n,Sa)}};function Ka(n,e){if(!i(n.data.domProps)||!i(e.data.domProps)){var t,a,r=e.elm,s=n.data.domProps||{},c=e.data.domProps||{};for(t in(o(c.__ob__)||l(c._v_attr_proxy))&&(c=e.data.domProps=M({},c)),s)t in c||(r[t]="");for(t in c){if(a=c[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),a===s[t])continue;1===r.childNodes.length&&r.removeChild(r.childNodes[0])}if("value"===t&&"PROGRESS"!==r.tagName){r._value=a;var u=i(a)?"":String(a);Xa(r,u)&&(r.value=u)}else if("innerHTML"===t&&ga(r.tagName)&&i(r.innerHTML)){($a=$a||document.createElement("div")).innerHTML="<svg>".concat(a,"</svg>");for(var d=$a.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;d.firstChild;)r.appendChild(d.firstChild)}else if(a!==s[t])try{r[t]=a}catch(n){}}}}function Xa(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,a=n._vModifiers;if(o(a)){if(a.number)return b(t)!==b(e);if(a.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var Qa={create:Ka,update:Ka},Ya=S((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var a=n.split(t);a.length>1&&(e[a[0].trim()]=a[1].trim())}})),e}));function Za(n){var e=nr(n.style);return n.staticStyle?M(n.staticStyle,e):e}function nr(n){return Array.isArray(n)?L(n):"string"==typeof n?Ya(n):n}var er,tr=/^--/,ar=/\s*!important$/,rr=function(n,e,t){if(tr.test(e))n.style.setProperty(e,t);else if(ar.test(t))n.style.setProperty(E(e),t.replace(ar,""),"important");else{var a=or(e);if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n.style[a]=t[r];else n.style[a]=t}},ir=["Webkit","Moz","ms"],or=S((function(n){if(er=er||document.createElement("div").style,"filter"!==(n=I(n))&&n in er)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<ir.length;t++){var a=ir[t]+e;if(a in er)return a}}));function lr(n,e){var t=e.data,a=n.data;if(!(i(t.staticStyle)&&i(t.style)&&i(a.staticStyle)&&i(a.style))){var r,l,s=e.elm,c=a.staticStyle,u=a.normalizedStyle||a.style||{},d=c||u,p=nr(e.data.style)||{};e.data.normalizedStyle=o(p.__ob__)?M({},p):p;var m=function(n,e){var t,a={};if(e)for(var r=n;r.componentInstance;)(r=r.componentInstance._vnode)&&r.data&&(t=Za(r.data))&&M(a,t);(t=Za(n.data))&&M(a,t);for(var i=n;i=i.parent;)i.data&&(t=Za(i.data))&&M(a,t);return a}(e,!0);for(l in d)i(m[l])&&rr(s,l,"");for(l in m)r=m[l],rr(s,l,null==r?"":r)}}var sr={create:lr,update:lr},cr=/\s+/;function ur(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(cr).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" ".concat(n.getAttribute("class")||""," ");t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function dr(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(cr).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" ".concat(n.getAttribute("class")||""," "),a=" "+e+" ";t.indexOf(a)>=0;)t=t.replace(a," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function pr(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&M(e,mr(n.name||"v")),M(e,n),e}return"string"==typeof n?mr(n):void 0}}var mr=S((function(n){return{enterClass:"".concat(n,"-enter"),enterToClass:"".concat(n,"-enter-to"),enterActiveClass:"".concat(n,"-enter-active"),leaveClass:"".concat(n,"-leave"),leaveToClass:"".concat(n,"-leave-to"),leaveActiveClass:"".concat(n,"-leave-active")}})),hr=K&&!Y,vr="transition",gr="transitionend",fr="animation",br="animationend";hr&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(vr="WebkitTransition",gr="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(fr="WebkitAnimation",br="webkitAnimationEnd"));var yr=K?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function xr(n){yr((function(){yr(n)}))}function kr(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),ur(n,e))}function jr(n,e){n._transitionClasses&&k(n._transitionClasses,e),dr(n,e)}function wr(n,e,t){var a=Tr(n,e),r=a.type,i=a.timeout,o=a.propCount;if(!r)return t();var l="transition"===r?gr:br,s=0,c=function(){n.removeEventListener(l,u),t()},u=function(e){e.target===n&&++s>=o&&c()};setTimeout((function(){s<o&&c()}),i+1),n.addEventListener(l,u)}var Sr=/\b(transform|all)(,|$)/;function Tr(n,e){var t,a=window.getComputedStyle(n),r=(a[vr+"Delay"]||"").split(", "),i=(a[vr+"Duration"]||"").split(", "),o=Ir(r,i),l=(a[fr+"Delay"]||"").split(", "),s=(a[fr+"Duration"]||"").split(", "),c=Ir(l,s),u=0,d=0;return"transition"===e?o>0&&(t="transition",u=o,d=i.length):"animation"===e?c>0&&(t="animation",u=c,d=s.length):d=(t=(u=Math.max(o,c))>0?o>c?"transition":"animation":null)?"transition"===t?i.length:s.length:0,{type:t,timeout:u,propCount:d,hasTransform:"transition"===t&&Sr.test(a[vr+"Property"])}}function Ir(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return Cr(e)+Cr(n[t])})))}function Cr(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function zr(n,e){var t=n.elm;o(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var a=pr(n.data.transition);if(!i(a)&&!o(t._enterCb)&&1===t.nodeType){for(var r=a.css,l=a.type,s=a.enterClass,d=a.enterToClass,p=a.enterActiveClass,m=a.appearClass,h=a.appearToClass,v=a.appearActiveClass,g=a.beforeEnter,f=a.enter,y=a.afterEnter,x=a.enterCancelled,k=a.beforeAppear,j=a.appear,w=a.afterAppear,S=a.appearCancelled,T=a.duration,I=Qe,C=Qe.$vnode;C&&C.parent;)I=C.context,C=C.parent;var z=!I._isMounted||!n.isRootInsert;if(!z||j||""===j){var E=z&&m?m:s,J=z&&v?v:p,A=z&&h?h:d,M=z&&k||g,L=z&&c(j)?j:f,O=z&&w||y,P=z&&S||x,_=b(u(T)?T.enter:T);0;var D=!1!==r&&!Y,R=Ar(L),F=t._enterCb=B((function(){D&&(jr(t,A),jr(t,J)),F.cancelled?(D&&jr(t,E),P&&P(t)):O&&O(t),t._enterCb=null}));n.data.show||Wn(n,"insert",(function(){var e=t.parentNode,a=e&&e._pending&&e._pending[n.key];a&&a.tag===n.tag&&a.elm._leaveCb&&a.elm._leaveCb(),L&&L(t,F)})),M&&M(t),D&&(kr(t,E),kr(t,J),xr((function(){jr(t,E),F.cancelled||(kr(t,A),R||(Jr(_)?setTimeout(F,_):wr(t,l,F)))}))),n.data.show&&(e&&e(),L&&L(t,F)),D||R||F()}}}function Er(n,e){var t=n.elm;o(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var a=pr(n.data.transition);if(i(a)||1!==t.nodeType)return e();if(!o(t._leaveCb)){var r=a.css,l=a.type,s=a.leaveClass,c=a.leaveToClass,d=a.leaveActiveClass,p=a.beforeLeave,m=a.leave,h=a.afterLeave,v=a.leaveCancelled,g=a.delayLeave,f=a.duration,y=!1!==r&&!Y,x=Ar(m),k=b(u(f)?f.leave:f);0;var j=t._leaveCb=B((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),y&&(jr(t,c),jr(t,d)),j.cancelled?(y&&jr(t,s),v&&v(t)):(e(),h&&h(t)),t._leaveCb=null}));g?g(w):w()}function w(){j.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),p&&p(t),y&&(kr(t,s),kr(t,d),xr((function(){jr(t,s),j.cancelled||(kr(t,c),x||(Jr(k)?setTimeout(j,k):wr(t,l,j)))}))),m&&m(t,j),y||x||j())}}function Jr(n){return"number"==typeof n&&!isNaN(n)}function Ar(n){if(i(n))return!1;var e=n.fns;return o(e)?Ar(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function Mr(n,e){!0!==e.data.show&&zr(e)}var Lr=function(n){var e,t,a={},c=n.modules,u=n.nodeOps;for(e=0;e<Ta.length;++e)for(a[Ta[e]]=[],t=0;t<c.length;++t)o(c[t][Ta[e]])&&a[Ta[e]].push(c[t][Ta[e]]);function d(n){var e=u.parentNode(n);o(e)&&u.removeChild(e,n)}function p(n,e,t,r,i,s,c){if(o(n.elm)&&o(s)&&(n=s[c]=fn(n)),n.isRootInsert=!i,!function(n,e,t,r){var i=n.data;if(o(i)){var s=o(n.componentInstance)&&i.keepAlive;if(o(i=i.hook)&&o(i=i.init)&&i(n,!1),o(n.componentInstance))return m(n,e),h(t,n.elm,r),l(s)&&function(n,e,t,r){var i,l=n;for(;l.componentInstance;)if(l=l.componentInstance._vnode,o(i=l.data)&&o(i=i.transition)){for(i=0;i<a.activate.length;++i)a.activate[i](Sa,l);e.push(l);break}h(t,n.elm,r)}(n,e,t,r),!0}}(n,e,t,r)){var d=n.data,p=n.children,g=n.tag;o(g)?(n.elm=n.ns?u.createElementNS(n.ns,g):u.createElement(g,n),b(n),v(n,p,e),o(d)&&f(n,e),h(t,n.elm,r)):l(n.isComment)?(n.elm=u.createComment(n.text),h(t,n.elm,r)):(n.elm=u.createTextNode(n.text),h(t,n.elm,r))}}function m(n,e){o(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,g(n)?(f(n,e),b(n)):(ja(n),e.push(n))}function h(n,e,t){o(n)&&(o(t)?u.parentNode(t)===n&&u.insertBefore(n,e,t):u.appendChild(n,e))}function v(n,e,t){if(r(e)){0;for(var a=0;a<e.length;++a)p(e[a],t,n.elm,null,!0,e,a)}else s(n.text)&&u.appendChild(n.elm,u.createTextNode(String(n.text)))}function g(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return o(n.tag)}function f(n,t){for(var r=0;r<a.create.length;++r)a.create[r](Sa,n);o(e=n.data.hook)&&(o(e.create)&&e.create(Sa,n),o(e.insert)&&t.push(n))}function b(n){var e;if(o(e=n.fnScopeId))u.setStyleScope(n.elm,e);else for(var t=n;t;)o(e=t.context)&&o(e=e.$options._scopeId)&&u.setStyleScope(n.elm,e),t=t.parent;o(e=Qe)&&e!==n.context&&e!==n.fnContext&&o(e=e.$options._scopeId)&&u.setStyleScope(n.elm,e)}function x(n,e,t,a,r,i){for(;a<=r;++a)p(t[a],i,n,e,!1,t,a)}function k(n){var e,t,r=n.data;if(o(r))for(o(e=r.hook)&&o(e=e.destroy)&&e(n),e=0;e<a.destroy.length;++e)a.destroy[e](n);if(o(e=n.children))for(t=0;t<n.children.length;++t)k(n.children[t])}function j(n,e,t){for(;e<=t;++e){var a=n[e];o(a)&&(o(a.tag)?(w(a),k(a)):d(a.elm))}}function w(n,e){if(o(e)||o(n.data)){var t,r=a.remove.length+1;for(o(e)?e.listeners+=r:e=function(n,e){function t(){0==--t.listeners&&d(n)}return t.listeners=e,t}(n.elm,r),o(t=n.componentInstance)&&o(t=t._vnode)&&o(t.data)&&w(t,e),t=0;t<a.remove.length;++t)a.remove[t](n,e);o(t=n.data.hook)&&o(t=t.remove)?t(n,e):e()}else d(n.elm)}function S(n,e,t,a){for(var r=t;r<a;r++){var i=e[r];if(o(i)&&Ia(n,i))return r}}function T(n,e,t,r,s,c){if(n!==e){o(e.elm)&&o(r)&&(e=r[s]=fn(e));var d=e.elm=n.elm;if(l(n.isAsyncPlaceholder))o(e.asyncFactory.resolved)?z(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(l(e.isStatic)&&l(n.isStatic)&&e.key===n.key&&(l(e.isCloned)||l(e.isOnce)))e.componentInstance=n.componentInstance;else{var m,h=e.data;o(h)&&o(m=h.hook)&&o(m=m.prepatch)&&m(n,e);var v=n.children,f=e.children;if(o(h)&&g(e)){for(m=0;m<a.update.length;++m)a.update[m](n,e);o(m=h.hook)&&o(m=m.update)&&m(n,e)}i(e.text)?o(v)&&o(f)?v!==f&&function(n,e,t,a,r){var l,s,c,d=0,m=0,h=e.length-1,v=e[0],g=e[h],f=t.length-1,b=t[0],y=t[f],k=!r;for(0;d<=h&&m<=f;)i(v)?v=e[++d]:i(g)?g=e[--h]:Ia(v,b)?(T(v,b,a,t,m),v=e[++d],b=t[++m]):Ia(g,y)?(T(g,y,a,t,f),g=e[--h],y=t[--f]):Ia(v,y)?(T(v,y,a,t,f),k&&u.insertBefore(n,v.elm,u.nextSibling(g.elm)),v=e[++d],y=t[--f]):Ia(g,b)?(T(g,b,a,t,m),k&&u.insertBefore(n,g.elm,v.elm),g=e[--h],b=t[++m]):(i(l)&&(l=Ca(e,d,h)),i(s=o(b.key)?l[b.key]:S(b,e,d,h))?p(b,a,n,v.elm,!1,t,m):Ia(c=e[s],b)?(T(c,b,a,t,m),e[s]=void 0,k&&u.insertBefore(n,c.elm,v.elm)):p(b,a,n,v.elm,!1,t,m),b=t[++m]);d>h?x(n,i(t[f+1])?null:t[f+1].elm,t,m,f,a):m>f&&j(e,d,h)}(d,v,f,t,c):o(f)?(o(n.text)&&u.setTextContent(d,""),x(d,null,f,0,f.length-1,t)):o(v)?j(v,0,v.length-1):o(n.text)&&u.setTextContent(d,""):n.text!==e.text&&u.setTextContent(d,e.text),o(h)&&o(m=h.hook)&&o(m=m.postpatch)&&m(n,e)}}}function I(n,e,t){if(l(t)&&o(n.parent))n.parent.data.pendingInsert=e;else for(var a=0;a<e.length;++a)e[a].data.hook.insert(e[a])}var C=y("attrs,class,staticClass,staticStyle,key");function z(n,e,t,a){var r,i=e.tag,s=e.data,c=e.children;if(a=a||s&&s.pre,e.elm=n,l(e.isComment)&&o(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(o(s)&&(o(r=s.hook)&&o(r=r.init)&&r(e,!0),o(r=e.componentInstance)))return m(e,t),!0;if(o(i)){if(o(c))if(n.hasChildNodes())if(o(r=s)&&o(r=r.domProps)&&o(r=r.innerHTML)){if(r!==n.innerHTML)return!1}else{for(var u=!0,d=n.firstChild,p=0;p<c.length;p++){if(!d||!z(d,c[p],t,a)){u=!1;break}d=d.nextSibling}if(!u||d)return!1}else v(e,c,t);if(o(s)){var h=!1;for(var g in s)if(!C(g)){h=!0,f(e,t);break}!h&&s.class&&Ue(s.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,r){if(!i(e)){var s,c=!1,d=[];if(i(n))c=!0,p(e,d);else{var m=o(n.nodeType);if(!m&&Ia(n,e))T(n,e,d,null,null,r);else{if(m){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),l(t)&&z(n,e,d))return I(e,d,!0),n;s=n,n=new hn(u.tagName(s).toLowerCase(),{},[],void 0,s)}var h=n.elm,v=u.parentNode(h);if(p(e,d,h._leaveCb?null:v,u.nextSibling(h)),o(e.parent))for(var f=e.parent,b=g(e);f;){for(var y=0;y<a.destroy.length;++y)a.destroy[y](f);if(f.elm=e.elm,b){for(var x=0;x<a.create.length;++x)a.create[x](Sa,f);var w=f.data.hook.insert;if(w.merged)for(var S=w.fns.slice(1),C=0;C<S.length;C++)S[C]()}else ja(f);f=f.parent}o(v)?j([n],0,0):o(n.tag)&&k(n)}}return I(e,d,c),e.elm}o(n)&&k(n)}}({nodeOps:xa,modules:[Ra,Na,Wa,Qa,sr,K?{create:Mr,activate:Mr,remove:function(n,e){!0!==n.data.show?Er(n,e):e()}}:{}].concat(Oa)});Y&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&Nr(n,"input")}));var Or={inserted:function(n,e,t,a){"select"===t.tag?(a.elm&&!a.elm._vOptions?Wn(t,"postpatch",(function(){Or.componentUpdated(n,e,t)})):Pr(n,e,t.context),n._vOptions=[].map.call(n.options,Rr)):("textarea"===t.tag||ya(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",Br),n.addEventListener("compositionend",Fr),n.addEventListener("change",Fr),Y&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){Pr(n,e,t.context);var a=n._vOptions,r=n._vOptions=[].map.call(n.options,Rr);if(r.some((function(n,e){return!D(n,a[e])})))(n.multiple?e.value.some((function(n){return Dr(n,r)})):e.value!==e.oldValue&&Dr(e.value,r))&&Nr(n,"change")}}};function Pr(n,e,t){_r(n,e,t),(Q||Z)&&setTimeout((function(){_r(n,e,t)}),0)}function _r(n,e,t){var a=e.value,r=n.multiple;if(!r||Array.isArray(a)){for(var i,o,l=0,s=n.options.length;l<s;l++)if(o=n.options[l],r)i=R(a,Rr(o))>-1,o.selected!==i&&(o.selected=i);else if(D(Rr(o),a))return void(n.selectedIndex!==l&&(n.selectedIndex=l));r||(n.selectedIndex=-1)}}function Dr(n,e){return e.every((function(e){return!D(e,n)}))}function Rr(n){return"_value"in n?n._value:n.value}function Br(n){n.target.composing=!0}function Fr(n){n.target.composing&&(n.target.composing=!1,Nr(n.target,"input"))}function Nr(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function qr(n){return!n.componentInstance||n.data&&n.data.transition?n:qr(n.componentInstance._vnode)}var Ur={model:Or,show:{bind:function(n,e,t){var a=e.value,r=(t=qr(t)).data&&t.data.transition,i=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;a&&r?(t.data.show=!0,zr(t,(function(){n.style.display=i}))):n.style.display=a?i:"none"},update:function(n,e,t){var a=e.value;!a!=!e.oldValue&&((t=qr(t)).data&&t.data.transition?(t.data.show=!0,a?zr(t,(function(){n.style.display=n.__vOriginalDisplay})):Er(t,(function(){n.style.display="none"}))):n.style.display=a?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,a,r){r||(n.style.display=n.__vOriginalDisplay)}}},Vr={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Hr(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?Hr(Te(e.children)):n}function Gr(n){var e={},t=n.$options;for(var a in t.propsData)e[a]=n[a];var r=t._parentListeners;for(var a in r)e[I(a)]=r[a];return e}function $r(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Wr=function(n){return n.tag||ve(n)},Kr=function(n){return"show"===n.name},Xr={name:"transition",props:Vr,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Wr)).length){0;var a=this.mode;0;var r=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return r;var i=Hr(r);if(!i)return r;if(this._leaving)return $r(n,r);var o="__transition-".concat(this._uid,"-");i.key=null==i.key?i.isComment?o+"comment":o+i.tag:s(i.key)?0===String(i.key).indexOf(o)?i.key:o+i.key:i.key;var l=(i.data||(i.data={})).transition=Gr(this),c=this._vnode,u=Hr(c);if(i.data.directives&&i.data.directives.some(Kr)&&(i.data.show=!0),u&&u.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(i,u)&&!ve(u)&&(!u.componentInstance||!u.componentInstance._vnode.isComment)){var d=u.data.transition=M({},l);if("out-in"===a)return this._leaving=!0,Wn(d,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),$r(n,r);if("in-out"===a){if(ve(i))return c;var p,m=function(){p()};Wn(l,"afterEnter",m),Wn(l,"enterCancelled",m),Wn(d,"delayLeave",(function(n){p=n}))}}return r}}},Qr=M({tag:String,moveClass:String},Vr);function Yr(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function Zr(n){n.data.newPos=n.elm.getBoundingClientRect()}function ni(n){var e=n.data.pos,t=n.data.newPos,a=e.left-t.left,r=e.top-t.top;if(a||r){n.data.moved=!0;var i=n.elm.style;i.transform=i.WebkitTransform="translate(".concat(a,"px,").concat(r,"px)"),i.transitionDuration="0s"}}delete Qr.mode;var ei={Transition:Xr,TransitionGroup:{props:Qr,beforeMount:function(){var n=this,e=this._update;this._update=function(t,a){var r=Ye(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,r(),e.call(n,t,a)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),a=this.prevChildren=this.children,r=this.$slots.default||[],i=this.children=[],o=Gr(this),l=0;l<r.length;l++){if((u=r[l]).tag)if(null!=u.key&&0!==String(u.key).indexOf("__vlist"))i.push(u),t[u.key]=u,(u.data||(u.data={})).transition=o;else;}if(a){var s=[],c=[];for(l=0;l<a.length;l++){var u;(u=a[l]).data.transition=o,u.data.pos=u.elm.getBoundingClientRect(),t[u.key]?s.push(u):c.push(u)}this.kept=n(e,null,s),this.removed=c}return n(e,null,i)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Yr),n.forEach(Zr),n.forEach(ni),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,a=t.style;kr(t,e),a.transform=a.WebkitTransform=a.transitionDuration="",t.addEventListener(gr,t._moveCb=function n(a){a&&a.target!==t||a&&!/transform$/.test(a.propertyName)||(t.removeEventListener(gr,n),t._moveCb=null,jr(t,e))})}})))},methods:{hasMove:function(n,e){if(!hr)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){dr(t,n)})),ur(t,e),t.style.display="none",this.$el.appendChild(t);var a=Tr(t);return this.$el.removeChild(t),this._hasMove=a.hasTransform}}}};function ti(n,e){for(var t in e)n[t]=e[t];return n}$t.config.mustUseProp=function(n,e,t){return"value"===t&&ta(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},$t.config.isReservedTag=fa,$t.config.isReservedAttr=ea,$t.config.getTagNamespace=function(n){return ga(n)?"svg":"math"===n?"math":void 0},$t.config.isUnknownElement=function(n){if(!K)return!0;if(fa(n))return!1;if(n=n.toLowerCase(),null!=ba[n])return ba[n];var e=document.createElement(n);return n.indexOf("-")>-1?ba[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:ba[n]=/HTMLUnknownElement/.test(e.toString())},M($t.options.directives,Ur),M($t.options.components,ei),$t.prototype.__patch__=K?Lr:O,$t.prototype.$mount=function(n,e){return function(n,e,t){var a;n.$el=e,n.$options.render||(n.$options.render=vn),et(n,"beforeMount"),a=function(){n._update(n._render(),t)},new Ge(n,a,O,{before:function(){n._isMounted&&!n._isDestroyed&&et(n,"beforeUpdate")}},!0),t=!1;var r=n._preWatchers;if(r)for(var i=0;i<r.length;i++)r[i].run();return null==n.$vnode&&(n._isMounted=!0,et(n,"mounted")),n}(this,n=n&&K?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},K&&setTimeout((function(){U.devtools&&sn&&sn.emit("init",$t)}),0);var ai=/[!'()*]/g,ri=function(n){return"%"+n.charCodeAt(0).toString(16)},ii=/%2C/g,oi=function(n){return encodeURIComponent(n).replace(ai,ri).replace(ii,",")};function li(n){try{return decodeURIComponent(n)}catch(n){0}return n}var si=function(n){return null==n||"object"==typeof n?n:String(n)};function ci(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),a=li(t.shift()),r=t.length>0?li(t.join("=")):null;void 0===e[a]?e[a]=r:Array.isArray(e[a])?e[a].push(r):e[a]=[e[a],r]})),e):e}function ui(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return oi(e);if(Array.isArray(t)){var a=[];return t.forEach((function(n){void 0!==n&&(null===n?a.push(oi(e)):a.push(oi(e)+"="+oi(n)))})),a.join("&")}return oi(e)+"="+oi(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var di=/\/?$/;function pi(n,e,t,a){var r=a&&a.options.stringifyQuery,i=e.query||{};try{i=mi(i)}catch(n){}var o={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:i,params:e.params||{},fullPath:gi(e,r),matched:n?vi(n):[]};return t&&(o.redirectedFrom=gi(t,r)),Object.freeze(o)}function mi(n){if(Array.isArray(n))return n.map(mi);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=mi(n[t]);return e}return n}var hi=pi(null,{path:"/"});function vi(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function gi(n,e){var t=n.path,a=n.query;void 0===a&&(a={});var r=n.hash;return void 0===r&&(r=""),(t||"/")+(e||ui)(a)+r}function fi(n,e,t){return e===hi?n===e:!!e&&(n.path&&e.path?n.path.replace(di,"")===e.path.replace(di,"")&&(t||n.hash===e.hash&&bi(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&bi(n.query,e.query)&&bi(n.params,e.params))))}function bi(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),a=Object.keys(e).sort();return t.length===a.length&&t.every((function(t,r){var i=n[t];if(a[r]!==t)return!1;var o=e[t];return null==i||null==o?i===o:"object"==typeof i&&"object"==typeof o?bi(i,o):String(i)===String(o)}))}function yi(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var a in t.instances){var r=t.instances[a],i=t.enteredCbs[a];if(r&&i){delete t.enteredCbs[a];for(var o=0;o<i.length;o++)r._isBeingDestroyed||i[o](r)}}}}var xi={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,a=e.children,r=e.parent,i=e.data;i.routerView=!0;for(var o=r.$createElement,l=t.name,s=r.$route,c=r._routerViewCache||(r._routerViewCache={}),u=0,d=!1;r&&r._routerRoot!==r;){var p=r.$vnode?r.$vnode.data:{};p.routerView&&u++,p.keepAlive&&r._directInactive&&r._inactive&&(d=!0),r=r.$parent}if(i.routerViewDepth=u,d){var m=c[l],h=m&&m.component;return h?(m.configProps&&ki(h,i,m.route,m.configProps),o(h,i,a)):o()}var v=s.matched[u],g=v&&v.components[l];if(!v||!g)return c[l]=null,o();c[l]={component:g},i.registerRouteInstance=function(n,e){var t=v.instances[l];(e&&t!==n||!e&&t===n)&&(v.instances[l]=e)},(i.hook||(i.hook={})).prepatch=function(n,e){v.instances[l]=e.componentInstance},i.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==v.instances[l]&&(v.instances[l]=n.componentInstance),yi(s)};var f=v.props&&v.props[l];return f&&(ti(c[l],{route:s,configProps:f}),ki(g,i,s,f)),o(g,i,a)}};function ki(n,e,t,a){var r=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,a);if(r){r=e.props=ti({},r);var i=e.attrs=e.attrs||{};for(var o in r)n.props&&o in n.props||(i[o]=r[o],delete r[o])}}function ji(n,e,t){var a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;var r=e.split("/");t&&r[r.length-1]||r.pop();for(var i=n.replace(/^\//,"").split("/"),o=0;o<i.length;o++){var l=i[o];".."===l?r.pop():"."!==l&&r.push(l)}return""!==r[0]&&r.unshift(""),r.join("/")}function wi(n){return n.replace(/\/(?:\s*\/)+/g,"/")}var Si=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},Ti=Bi,Ii=Ai,Ci=function(n,e){return Li(Ai(n,e),e)},zi=Li,Ei=Ri,Ji=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function Ai(n,e){for(var t,a=[],r=0,i=0,o="",l=e&&e.delimiter||"/";null!=(t=Ji.exec(n));){var s=t[0],c=t[1],u=t.index;if(o+=n.slice(i,u),i=u+s.length,c)o+=c[1];else{var d=n[i],p=t[2],m=t[3],h=t[4],v=t[5],g=t[6],f=t[7];o&&(a.push(o),o="");var b=null!=p&&null!=d&&d!==p,y="+"===g||"*"===g,x="?"===g||"*"===g,k=t[2]||l,j=h||v;a.push({name:m||r++,prefix:p||"",delimiter:k,optional:x,repeat:y,partial:b,asterisk:!!f,pattern:j?Pi(j):f?".*":"[^"+Oi(k)+"]+?"})}}return i<n.length&&(o+=n.substr(i)),o&&a.push(o),a}function Mi(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function Li(n,e){for(var t=new Array(n.length),a=0;a<n.length;a++)"object"==typeof n[a]&&(t[a]=new RegExp("^(?:"+n[a].pattern+")$",Di(e)));return function(e,a){for(var r="",i=e||{},o=(a||{}).pretty?Mi:encodeURIComponent,l=0;l<n.length;l++){var s=n[l];if("string"!=typeof s){var c,u=i[s.name];if(null==u){if(s.optional){s.partial&&(r+=s.prefix);continue}throw new TypeError('Expected "'+s.name+'" to be defined')}if(Si(u)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but received `'+JSON.stringify(u)+"`");if(0===u.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var d=0;d<u.length;d++){if(c=o(u[d]),!t[l].test(c))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'", but received `'+JSON.stringify(c)+"`");r+=(0===d?s.prefix:s.delimiter)+c}}else{if(c=s.asterisk?encodeURI(u).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):o(u),!t[l].test(c))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but received "'+c+'"');r+=s.prefix+c}}else r+=s}return r}}function Oi(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function Pi(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function _i(n,e){return n.keys=e,n}function Di(n){return n&&n.sensitive?"":"i"}function Ri(n,e,t){Si(e)||(t=e||t,e=[]);for(var a=(t=t||{}).strict,r=!1!==t.end,i="",o=0;o<n.length;o++){var l=n[o];if("string"==typeof l)i+=Oi(l);else{var s=Oi(l.prefix),c="(?:"+l.pattern+")";e.push(l),l.repeat&&(c+="(?:"+s+c+")*"),i+=c=l.optional?l.partial?s+"("+c+")?":"(?:"+s+"("+c+"))?":s+"("+c+")"}}var u=Oi(t.delimiter||"/"),d=i.slice(-u.length)===u;return a||(i=(d?i.slice(0,-u.length):i)+"(?:"+u+"(?=$))?"),i+=r?"$":a&&d?"":"(?="+u+"|$)",_i(new RegExp("^"+i,Di(t)),e)}function Bi(n,e,t){return Si(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var a=0;a<t.length;a++)e.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return _i(n,e)}(n,e):Si(n)?function(n,e,t){for(var a=[],r=0;r<n.length;r++)a.push(Bi(n[r],e,t).source);return _i(new RegExp("(?:"+a.join("|")+")",Di(t)),e)}(n,e,t):function(n,e,t){return Ri(Ai(n,t),e,t)}(n,e,t)}Ti.parse=Ii,Ti.compile=Ci,Ti.tokensToFunction=zi,Ti.tokensToRegExp=Ei;var Fi=Object.create(null);function Ni(n,e,t){e=e||{};try{var a=Fi[n]||(Fi[n]=Ti.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),a(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function qi(n,e,t,a){var r="string"==typeof n?{path:n}:n;if(r._normalized)return r;if(r.name){var i=(r=ti({},n)).params;return i&&"object"==typeof i&&(r.params=ti({},i)),r}if(!r.path&&r.params&&e){(r=ti({},r))._normalized=!0;var o=ti(ti({},e.params),r.params);if(e.name)r.name=e.name,r.params=o;else if(e.matched.length){var l=e.matched[e.matched.length-1].path;r.path=Ni(l,o,e.path)}else 0;return r}var s=function(n){var e="",t="",a=n.indexOf("#");a>=0&&(e=n.slice(a),n=n.slice(0,a));var r=n.indexOf("?");return r>=0&&(t=n.slice(r+1),n=n.slice(0,r)),{path:n,query:t,hash:e}}(r.path||""),c=e&&e.path||"/",u=s.path?ji(s.path,c,t||r.append):c,d=function(n,e,t){void 0===e&&(e={});var a,r=t||ci;try{a=r(n||"")}catch(n){a={}}for(var i in e){var o=e[i];a[i]=Array.isArray(o)?o.map(si):si(o)}return a}(s.query,r.query,a&&a.options.parseQuery),p=r.hash||s.hash;return p&&"#"!==p.charAt(0)&&(p="#"+p),{_normalized:!0,path:u,query:d,hash:p}}var Ui,Vi=function(){},Hi={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,a=this.$route,r=t.resolve(this.to,a,this.append),i=r.location,o=r.route,l=r.href,s={},c=t.options.linkActiveClass,u=t.options.linkExactActiveClass,d=null==c?"router-link-active":c,p=null==u?"router-link-exact-active":u,m=null==this.activeClass?d:this.activeClass,h=null==this.exactActiveClass?p:this.exactActiveClass,v=o.redirectedFrom?pi(null,qi(o.redirectedFrom),null,t):o;s[h]=fi(a,v,this.exactPath),s[m]=this.exact||this.exactPath?s[h]:function(n,e){return 0===n.path.replace(di,"/").indexOf(e.path.replace(di,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(a,v);var g=s[h]?this.ariaCurrentValue:null,f=function(n){Gi(n)&&(e.replace?t.replace(i,Vi):t.push(i,Vi))},b={click:Gi};Array.isArray(this.event)?this.event.forEach((function(n){b[n]=f})):b[this.event]=f;var y={class:s},x=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:l,route:o,navigate:f,isActive:s[m],isExactActive:s[h]});if(x){if(1===x.length)return x[0];if(x.length>1||!x.length)return 0===x.length?n():n("span",{},x)}if("a"===this.tag)y.on=b,y.attrs={href:l,"aria-current":g};else{var k=function n(e){var t;if(e)for(var a=0;a<e.length;a++){if("a"===(t=e[a]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(k){k.isStatic=!1;var j=k.data=ti({},k.data);for(var w in j.on=j.on||{},j.on){var S=j.on[w];w in b&&(j.on[w]=Array.isArray(S)?S:[S])}for(var T in b)T in j.on?j.on[T].push(b[T]):j.on[T]=f;var I=k.data.attrs=ti({},k.data.attrs);I.href=l,I["aria-current"]=g}else y.on=b}return n(this.tag,y,this.$slots.default)}};function Gi(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var $i="undefined"!=typeof window;function Wi(n,e,t,a,r){var i=e||[],o=t||Object.create(null),l=a||Object.create(null);n.forEach((function(n){!function n(e,t,a,r,i,o){var l=r.path,s=r.name;0;var c=r.pathToRegexpOptions||{},u=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return wi(e.path+"/"+n)}(l,i,c.strict);"boolean"==typeof r.caseSensitive&&(c.sensitive=r.caseSensitive);var d={path:u,regex:Ki(u,c),components:r.components||{default:r.component},alias:r.alias?"string"==typeof r.alias?[r.alias]:r.alias:[],instances:{},enteredCbs:{},name:s,parent:i,matchAs:o,redirect:r.redirect,beforeEnter:r.beforeEnter,meta:r.meta||{},props:null==r.props?{}:r.components?r.props:{default:r.props}};r.children&&r.children.forEach((function(r){var i=o?wi(o+"/"+r.path):void 0;n(e,t,a,r,d,i)}));t[d.path]||(e.push(d.path),t[d.path]=d);if(void 0!==r.alias)for(var p=Array.isArray(r.alias)?r.alias:[r.alias],m=0;m<p.length;++m){0;var h={path:p[m],children:r.children};n(e,t,a,h,i,d.path||"/")}s&&(a[s]||(a[s]=d))}(i,o,l,n,r)}));for(var s=0,c=i.length;s<c;s++)"*"===i[s]&&(i.push(i.splice(s,1)[0]),c--,s--);return{pathList:i,pathMap:o,nameMap:l}}function Ki(n,e){return Ti(n,[],e)}function Xi(n,e){var t=Wi(n),a=t.pathList,r=t.pathMap,i=t.nameMap;function o(n,t,o){var l=qi(n,t,!1,e),c=l.name;if(c){var u=i[c];if(!u)return s(null,l);var d=u.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof l.params&&(l.params={}),t&&"object"==typeof t.params)for(var p in t.params)!(p in l.params)&&d.indexOf(p)>-1&&(l.params[p]=t.params[p]);return l.path=Ni(u.path,l.params),s(u,l,o)}if(l.path){l.params={};for(var m=0;m<a.length;m++){var h=a[m],v=r[h];if(Qi(v.regex,l.path,l.params))return s(v,l,o)}}return s(null,l)}function l(n,t){var a=n.redirect,r="function"==typeof a?a(pi(n,t,null,e)):a;if("string"==typeof r&&(r={path:r}),!r||"object"!=typeof r)return s(null,t);var l=r,c=l.name,u=l.path,d=t.query,p=t.hash,m=t.params;if(d=l.hasOwnProperty("query")?l.query:d,p=l.hasOwnProperty("hash")?l.hash:p,m=l.hasOwnProperty("params")?l.params:m,c){i[c];return o({_normalized:!0,name:c,query:d,hash:p,params:m},void 0,t)}if(u){var h=function(n,e){return ji(n,e.parent?e.parent.path:"/",!0)}(u,n);return o({_normalized:!0,path:Ni(h,m),query:d,hash:p},void 0,t)}return s(null,t)}function s(n,t,a){return n&&n.redirect?l(n,a||t):n&&n.matchAs?function(n,e,t){var a=o({_normalized:!0,path:Ni(t,e.params)});if(a){var r=a.matched,i=r[r.length-1];return e.params=a.params,s(i,e)}return s(null,e)}(0,t,n.matchAs):pi(n,t,a,e)}return{match:o,addRoute:function(n,e){var t="object"!=typeof n?i[n]:void 0;Wi([e||n],a,r,i,t),t&&t.alias.length&&Wi(t.alias.map((function(n){return{path:n,children:[e]}})),a,r,i,t)},getRoutes:function(){return a.map((function(n){return r[n]}))},addRoutes:function(n){Wi(n,a,r,i)}}}function Qi(n,e,t){var a=e.match(n);if(!a)return!1;if(!t)return!0;for(var r=1,i=a.length;r<i;++r){var o=n.keys[r-1];o&&(t[o.name||"pathMatch"]="string"==typeof a[r]?li(a[r]):a[r])}return!0}var Yi=$i&&window.performance&&window.performance.now?window.performance:Date;function Zi(){return Yi.now().toFixed(3)}var no=Zi();function eo(){return no}function to(n){return no=n}var ao=Object.create(null);function ro(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=ti({},window.history.state);return t.key=eo(),window.history.replaceState(t,"",e),window.addEventListener("popstate",lo),function(){window.removeEventListener("popstate",lo)}}function io(n,e,t,a){if(n.app){var r=n.options.scrollBehavior;r&&n.app.$nextTick((function(){var i=function(){var n=eo();if(n)return ao[n]}(),o=r.call(n,e,t,a?i:null);o&&("function"==typeof o.then?o.then((function(n){mo(n,i)})).catch((function(n){0})):mo(o,i))}))}}function oo(){var n=eo();n&&(ao[n]={x:window.pageXOffset,y:window.pageYOffset})}function lo(n){oo(),n.state&&n.state.key&&to(n.state.key)}function so(n){return uo(n.x)||uo(n.y)}function co(n){return{x:uo(n.x)?n.x:window.pageXOffset,y:uo(n.y)?n.y:window.pageYOffset}}function uo(n){return"number"==typeof n}var po=/^#\d/;function mo(n,e){var t,a="object"==typeof n;if(a&&"string"==typeof n.selector){var r=po.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(r){var i=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return{x:a.left-t.left-e.x,y:a.top-t.top-e.y}}(r,i={x:uo((t=i).x)?t.x:0,y:uo(t.y)?t.y:0})}else so(n)&&(e=co(n))}else a&&so(n)&&(e=co(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var ho,vo=$i&&((-1===(ho=window.navigator.userAgent).indexOf("Android 2.")&&-1===ho.indexOf("Android 4.0")||-1===ho.indexOf("Mobile Safari")||-1!==ho.indexOf("Chrome")||-1!==ho.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function go(n,e){oo();var t=window.history;try{if(e){var a=ti({},t.state);a.key=eo(),t.replaceState(a,"",n)}else t.pushState({key:to(Zi())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function fo(n){go(n,!0)}var bo={redirected:2,aborted:4,cancelled:8,duplicated:16};function yo(n,e){return ko(n,e,bo.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return jo.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function xo(n,e){return ko(n,e,bo.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function ko(n,e,t,a){var r=new Error(a);return r._isRouter=!0,r.from=n,r.to=e,r.type=t,r}var jo=["params","query","hash"];function wo(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function So(n,e){return wo(n)&&n._isRouter&&(null==e||n.type===e)}function To(n,e,t){var a=function(r){r>=n.length?t():n[r]?e(n[r],(function(){a(r+1)})):a(r+1)};a(0)}function Io(n){return function(e,t,a){var r=!1,i=0,o=null;Co(n,(function(n,e,t,l){if("function"==typeof n&&void 0===n.cid){r=!0,i++;var s,c=Jo((function(e){var r;((r=e).__esModule||Eo&&"Module"===r[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:Ui.extend(e),t.components[l]=e,--i<=0&&a()})),u=Jo((function(n){var e="Failed to resolve async component "+l+": "+n;o||(o=wo(n)?n:new Error(e),a(o))}));try{s=n(c,u)}catch(n){u(n)}if(s)if("function"==typeof s.then)s.then(c,u);else{var d=s.component;d&&"function"==typeof d.then&&d.then(c,u)}}})),r||a()}}function Co(n,e){return zo(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function zo(n){return Array.prototype.concat.apply([],n)}var Eo="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Jo(n){var e=!1;return function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];if(!e)return e=!0,n.apply(this,t)}}var Ao=function(n,e){this.router=n,this.base=function(n){if(!n)if($i){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=hi,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function Mo(n,e,t,a){var r=Co(n,(function(n,a,r,i){var o=function(n,e){"function"!=typeof n&&(n=Ui.extend(n));return n.options[e]}(n,e);if(o)return Array.isArray(o)?o.map((function(n){return t(n,a,r,i)})):t(o,a,r,i)}));return zo(a?r.reverse():r)}function Lo(n,e){if(e)return function(){return n.apply(e,arguments)}}Ao.prototype.listen=function(n){this.cb=n},Ao.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},Ao.prototype.onError=function(n){this.errorCbs.push(n)},Ao.prototype.transitionTo=function(n,e,t){var a,r=this;try{a=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var i=this.current;this.confirmTransition(a,(function(){r.updateRoute(a),e&&e(a),r.ensureURL(),r.router.afterHooks.forEach((function(n){n&&n(a,i)})),r.ready||(r.ready=!0,r.readyCbs.forEach((function(n){n(a)})))}),(function(n){t&&t(n),n&&!r.ready&&(So(n,bo.redirected)&&i===hi||(r.ready=!0,r.readyErrorCbs.forEach((function(e){e(n)}))))}))},Ao.prototype.confirmTransition=function(n,e,t){var a=this,r=this.current;this.pending=n;var i,o,l=function(n){!So(n)&&wo(n)&&(a.errorCbs.length?a.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},s=n.matched.length-1,c=r.matched.length-1;if(fi(n,r)&&s===c&&n.matched[s]===r.matched[c])return this.ensureURL(),n.hash&&io(this.router,r,n,!1),l(((o=ko(i=r,n,bo.duplicated,'Avoided redundant navigation to current location: "'+i.fullPath+'".')).name="NavigationDuplicated",o));var u=function(n,e){var t,a=Math.max(n.length,e.length);for(t=0;t<a&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),d=u.updated,p=u.deactivated,m=u.activated,h=[].concat(function(n){return Mo(n,"beforeRouteLeave",Lo,!0)}(p),this.router.beforeHooks,function(n){return Mo(n,"beforeRouteUpdate",Lo)}(d),m.map((function(n){return n.beforeEnter})),Io(m)),v=function(e,t){if(a.pending!==n)return l(xo(r,n));try{e(n,r,(function(e){!1===e?(a.ensureURL(!0),l(function(n,e){return ko(n,e,bo.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(r,n))):wo(e)?(a.ensureURL(!0),l(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(l(yo(r,n)),"object"==typeof e&&e.replace?a.replace(e):a.push(e)):t(e)}))}catch(n){l(n)}};To(h,v,(function(){To(function(n){return Mo(n,"beforeRouteEnter",(function(n,e,t,a){return function(n,e,t){return function(a,r,i){return n(a,r,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),i(n)}))}}(n,t,a)}))}(m).concat(a.router.resolveHooks),v,(function(){if(a.pending!==n)return l(xo(r,n));a.pending=null,e(n),a.router.app&&a.router.app.$nextTick((function(){yi(n)}))}))}))},Ao.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},Ao.prototype.setupListeners=function(){},Ao.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=hi,this.pending=null};var Oo=function(n){function e(e,t){n.call(this,e,t),this._startLocation=Po(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,a=vo&&t;a&&this.listeners.push(ro());var r=function(){var t=n.current,r=Po(n.base);n.current===hi&&r===n._startLocation||n.transitionTo(r,(function(n){a&&io(e,n,t,!0)}))};window.addEventListener("popstate",r),this.listeners.push((function(){window.removeEventListener("popstate",r)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){go(wi(a.base+n.fullPath)),io(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){fo(wi(a.base+n.fullPath)),io(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(Po(this.base)!==this.current.fullPath){var e=wi(this.base+this.current.fullPath);n?go(e):fo(e)}},e.prototype.getCurrentLocation=function(){return Po(this.base)},e}(Ao);function Po(n){var e=window.location.pathname,t=e.toLowerCase(),a=n.toLowerCase();return!n||t!==a&&0!==t.indexOf(wi(a+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var _o=function(n){function e(e,t,a){n.call(this,e,t),a&&function(n){var e=Po(n);if(!/^\/#/.test(e))return window.location.replace(wi(n+"/#"+e)),!0}(this.base)||Do()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=vo&&e;t&&this.listeners.push(ro());var a=function(){var e=n.current;Do()&&n.transitionTo(Ro(),(function(a){t&&io(n.router,a,e,!0),vo||No(a.fullPath)}))},r=vo?"popstate":"hashchange";window.addEventListener(r,a),this.listeners.push((function(){window.removeEventListener(r,a)}))}},e.prototype.push=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){Fo(n.fullPath),io(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){No(n.fullPath),io(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;Ro()!==e&&(n?Fo(e):No(e))},e.prototype.getCurrentLocation=function(){return Ro()},e}(Ao);function Do(){var n=Ro();return"/"===n.charAt(0)||(No("/"+n),!1)}function Ro(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function Bo(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function Fo(n){vo?go(Bo(n)):window.location.hash=n}function No(n){vo?fo(Bo(n)):window.location.replace(Bo(n))}var qo=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index+1).concat(n),a.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var a=this.stack[t];this.confirmTransition(a,(function(){var n=e.current;e.index=t,e.updateRoute(a),e.router.afterHooks.forEach((function(e){e&&e(a,n)}))}),(function(n){So(n,bo.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}(Ao),Uo=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Xi(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!vo&&!1!==n.fallback,this.fallback&&(e="hash"),$i||(e="abstract"),this.mode=e,e){case"history":this.history=new Oo(this,n.base);break;case"hash":this.history=new _o(this,n.base,this.fallback);break;case"abstract":this.history=new qo(this,n.base);break;default:0}},Vo={currentRoute:{configurable:!0}};Uo.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},Vo.currentRoute.get=function(){return this.history&&this.history.current},Uo.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof Oo||t instanceof _o){var a=function(n){t.setupListeners(),function(n){var a=t.current,r=e.options.scrollBehavior;vo&&r&&"fullPath"in n&&io(e,n,a,!1)}(n)};t.transitionTo(t.getCurrentLocation(),a,a)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},Uo.prototype.beforeEach=function(n){return Go(this.beforeHooks,n)},Uo.prototype.beforeResolve=function(n){return Go(this.resolveHooks,n)},Uo.prototype.afterEach=function(n){return Go(this.afterHooks,n)},Uo.prototype.onReady=function(n,e){this.history.onReady(n,e)},Uo.prototype.onError=function(n){this.history.onError(n)},Uo.prototype.push=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.push(n,e,t)}));this.history.push(n,e,t)},Uo.prototype.replace=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.replace(n,e,t)}));this.history.replace(n,e,t)},Uo.prototype.go=function(n){this.history.go(n)},Uo.prototype.back=function(){this.go(-1)},Uo.prototype.forward=function(){this.go(1)},Uo.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},Uo.prototype.resolve=function(n,e,t){var a=qi(n,e=e||this.history.current,t,this),r=this.match(a,e),i=r.redirectedFrom||r.fullPath;return{location:a,route:r,href:function(n,e,t){var a="hash"===t?"#"+e:e;return n?wi(n+"/"+a):a}(this.history.base,i,this.mode),normalizedTo:a,resolved:r}},Uo.prototype.getRoutes=function(){return this.matcher.getRoutes()},Uo.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==hi&&this.history.transitionTo(this.history.getCurrentLocation())},Uo.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==hi&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Uo.prototype,Vo);var Ho=Uo;function Go(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}Uo.install=function n(e){if(!n.installed||Ui!==e){n.installed=!0,Ui=e;var t=function(n){return void 0!==n},a=function(n,e){var a=n.$options._parentVnode;t(a)&&t(a=a.data)&&t(a=a.registerRouteInstance)&&a(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,a(this,this)},destroyed:function(){a(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",xi),e.component("RouterLink",Hi);var r=e.config.optionMergeStrategies;r.beforeRouteEnter=r.beforeRouteLeave=r.beforeRouteUpdate=r.created}},Uo.version="3.6.5",Uo.isNavigationFailure=So,Uo.NavigationFailureType=bo,Uo.START_LOCATION=hi,$i&&window.Vue&&window.Vue.use(Uo);t(108);t(130),t(16);var $o={NotFound:()=>Promise.all([t.e(0),t.e(4)]).then(t.bind(null,343)),Layout:()=>Promise.all([t.e(0),t.e(2)]).then(t.bind(null,342))},Wo={"v-2fc2d87c":()=>t.e(5).then(t.bind(null,344)),"v-1843e802":()=>t.e(7).then(t.bind(null,345)),"v-dfab5e76":()=>t.e(6).then(t.bind(null,346)),"v-772ffd48":()=>t.e(8).then(t.bind(null,347)),"v-e64b7cf6":()=>t.e(9).then(t.bind(null,348)),"v-de4ee0ba":()=>t.e(10).then(t.bind(null,349)),"v-4e691f6f":()=>t.e(11).then(t.bind(null,350)),"v-52489532":()=>t.e(12).then(t.bind(null,351)),"v-7b80f369":()=>t.e(13).then(t.bind(null,352)),"v-34aa0805":()=>t.e(14).then(t.bind(null,353)),"v-604f94c1":()=>t.e(15).then(t.bind(null,354)),"v-615708fd":()=>t.e(16).then(t.bind(null,355)),"v-aed39f40":()=>t.e(17).then(t.bind(null,356)),"v-e38dd302":()=>t.e(18).then(t.bind(null,357)),"v-2ab9bc43":()=>t.e(19).then(t.bind(null,358)),"v-aedbe21a":()=>t.e(21).then(t.bind(null,359)),"v-19cb262c":()=>t.e(20).then(t.bind(null,360)),"v-061c6092":()=>t.e(22).then(t.bind(null,361)),"v-2bdfddf8":()=>t.e(23).then(t.bind(null,362)),"v-7ac23752":()=>t.e(25).then(t.bind(null,363)),"v-61ba4cc8":()=>t.e(24).then(t.bind(null,364)),"v-3f95b793":()=>t.e(27).then(t.bind(null,365)),"v-56fce25d":()=>t.e(26).then(t.bind(null,366)),"v-107bd1fe":()=>t.e(28).then(t.bind(null,367)),"v-9a8a8b92":()=>t.e(30).then(t.bind(null,368)),"v-5b80a7d7":()=>t.e(29).then(t.bind(null,369)),"v-826b0392":()=>t.e(31).then(t.bind(null,370)),"v-32719e6b":()=>t.e(34).then(t.bind(null,371)),"v-3295fff5":()=>t.e(32).then(t.bind(null,372)),"v-777420e7":()=>t.e(33).then(t.bind(null,373)),"v-3240456a":()=>t.e(35).then(t.bind(null,374)),"v-18d0a24b":()=>t.e(36).then(t.bind(null,375)),"v-b99a190c":()=>t.e(37).then(t.bind(null,376)),"v-2bdc15e1":()=>t.e(38).then(t.bind(null,377)),"v-0657f720":()=>t.e(39).then(t.bind(null,378)),"v-201723ff":()=>t.e(41).then(t.bind(null,379)),"v-3a567e4e":()=>t.e(40).then(t.bind(null,380)),"v-d3fa156e":()=>t.e(44).then(t.bind(null,381)),"v-06ff1f1b":()=>t.e(42).then(t.bind(null,382)),"v-5fcbebd1":()=>t.e(43).then(t.bind(null,383)),"v-b1d46672":()=>t.e(45).then(t.bind(null,384)),"v-7a471e72":()=>t.e(46).then(t.bind(null,385)),"v-c2716862":()=>t.e(48).then(t.bind(null,386)),"v-69f9625e":()=>t.e(47).then(t.bind(null,387)),"v-cd87896e":()=>t.e(49).then(t.bind(null,388)),"v-fea6165a":()=>t.e(50).then(t.bind(null,389)),"v-364ddd94":()=>t.e(51).then(t.bind(null,390)),"v-95392858":()=>t.e(53).then(t.bind(null,391)),"v-7fd1094f":()=>t.e(52).then(t.bind(null,392)),"v-7aafddb2":()=>t.e(54).then(t.bind(null,393)),"v-f116965a":()=>t.e(56).then(t.bind(null,394)),"v-5bfd289c":()=>t.e(55).then(t.bind(null,395)),"v-cc303ce8":()=>t.e(57).then(t.bind(null,396)),"v-27908e84":()=>t.e(58).then(t.bind(null,397)),"v-2ecce247":()=>t.e(59).then(t.bind(null,398)),"v-0bede0ba":()=>t.e(60).then(t.bind(null,399)),"v-740bd8b4":()=>t.e(61).then(t.bind(null,400)),"v-bdc85676":()=>t.e(62).then(t.bind(null,401)),"v-6c8957c8":()=>t.e(63).then(t.bind(null,402)),"v-f5cbbe1c":()=>t.e(64).then(t.bind(null,403)),"v-73f01fa5":()=>t.e(67).then(t.bind(null,404)),"v-3f7bcbb6":()=>t.e(65).then(t.bind(null,405)),"v-67a474f6":()=>t.e(66).then(t.bind(null,406)),"v-ceebf0d4":()=>t.e(68).then(t.bind(null,407))};function Ko(n){const e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}const Xo=/-(\w)/g,Qo=Ko(n=>n.replace(Xo,(n,e)=>e?e.toUpperCase():"")),Yo=/\B([A-Z])/g,Zo=Ko(n=>n.replace(Yo,"-$1").toLowerCase()),nl=Ko(n=>n.charAt(0).toUpperCase()+n.slice(1));function el(n,e){if(!e)return;if(n(e))return n(e);return e.includes("-")?n(nl(Qo(e))):n(nl(e))||n(Zo(e))}const tl=Object.assign({},$o,Wo),al=n=>tl[n],rl=n=>Wo[n],il=n=>$o[n],ol=n=>$t.component(n);function ll(n){return el(rl,n)}function sl(n){return el(il,n)}function cl(n){return el(al,n)}function ul(n){return el(ol,n)}function dl(...n){return Promise.all(n.filter(n=>n).map(async n=>{if(!ul(n)&&cl(n)){const e=await cl(n)();$t.component(n,e.default)}}))}function pl(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var ml=t(93),hl=t.n(ml),vl=t(94),gl=t.n(vl),fl={created(){if(this.siteMeta=this.$site.headTags.filter(([n])=>"meta"===n).map(([n,e])=>e),this.$ssrContext){const e=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(n=e)?n.map(n=>{let e="<meta";return Object.keys(n).forEach(t=>{e+=` ${t}="${gl()(n[t])}"`}),e+">"}).join("\n    "):"",this.$ssrContext.canonicalLink=yl(this.$canonicalUrl)}var n},mounted(){this.currentMetaTags=[...document.querySelectorAll("meta")],this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta(){document.title=this.$title,document.documentElement.lang=this.$lang;const n=this.getMergedMetaTags();this.currentMetaTags=xl(n,this.currentMetaTags)},getMergedMetaTags(){const n=this.$page.frontmatter.meta||[];return hl()([{name:"description",content:this.$description}],n,this.siteMeta,kl)},updateCanonicalLink(){bl(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",yl(this.$canonicalUrl))}},watch:{$page(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy(){xl(null,this.currentMetaTags),bl()}};function bl(){const n=document.querySelector("link[rel='canonical']");n&&n.remove()}function yl(n=""){return n?`<link href="${n}" rel="canonical" />`:""}function xl(n,e){if(e&&[...e].filter(n=>n.parentNode===document.head).forEach(n=>document.head.removeChild(n)),n)return n.map(n=>{const e=document.createElement("meta");return Object.keys(n).forEach(t=>{e.setAttribute(t,n[t])}),document.head.appendChild(e),e})}function kl(n){for(const e of["name","property","itemprop"])if(n.hasOwnProperty(e))return n[e]+e;return JSON.stringify(n)}var jl=t(52),wl={mounted(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(jl)()((function(){this.setActiveHash()}),300),setActiveHash(){const n=[].slice.call(document.querySelectorAll(".sidebar-link")),e=[].slice.call(document.querySelectorAll(".header-anchor")).filter(e=>n.some(n=>n.hash===e.hash)),t=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),r=window.innerHeight+t;for(let n=0;n<e.length;n++){const i=e[n],o=e[n+1],l=0===n&&0===t||t>=i.parentElement.offsetTop+10&&(!o||t<o.parentElement.offsetTop-10),s=decodeURIComponent(this.$route.hash);if(l&&s!==decodeURIComponent(i.hash)){const t=i;if(r===a)for(let t=n+1;t<e.length;t++)if(s===decodeURIComponent(e[t].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(t.hash),()=>{this.$nextTick(()=>{this.$vuepress.$set("disableScrollBehavior",!1)})})}}}},beforeDestroy(){window.removeEventListener("scroll",this.onScroll)}},Sl=t(24),Tl=t.n(Sl),Il={mounted(){Tl.a.configure({showSpinner:!1}),this.$router.beforeEach((n,e,t)=>{n.path===e.path||$t.component(n.name)||Tl.a.start(),t()}),this.$router.afterEach(()=>{Tl.a.done(),this.isSidebarOpen=!1})}};t(242),t(243);class Cl{constructor(){this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}show({text:n="",duration:e=3e3}){let t=document.createElement("div");t.className="message move-in",t.innerHTML=`\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">${n}</div>\n    `,this.containerEl.appendChild(t),e>0&&setTimeout(()=>{this.close(t)},e)}close(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",()=>{n.remove()})}}var zl={mounted(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy(){setTimeout(()=>{(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach(n=>{document.querySelectorAll(n).forEach(this.generateCopyButton)})},1e3)},generateCopyButton(n){if(n.classList.contains("codecopy-enabled"))return;const e=document.createElement("i");e.className="code-copy",e.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',e.title="Copy to clipboard",e.addEventListener("click",()=>{this.copyToClipboard(n.innerText)}),n.appendChild(e),n.classList.add("codecopy-enabled")},copyToClipboard(n){const e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);const t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy");(new Cl).show({text:"å¤å¶æå",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}};!function(n,e){void 0===e&&(e={});var t=e.insertAt;if(n&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&a.firstChild?a.insertBefore(r,a.firstChild):a.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}("@media (max-width: 1000px) {\n  .vuepress-plugin-demo-block__h_code {\n    display: none;\n  }\n  .vuepress-plugin-demo-block__app {\n    margin-left: auto !important;\n    margin-right: auto !important;\n  }\n}\n.vuepress-plugin-demo-block__wrapper {\n  margin-top: 10px;\n  border: 1px solid #ebebeb;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display {\n  height: 400px;\n  display: flex;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__app {\n  width: 300px;\n  border: 1px solid #ebebeb;\n  box-shadow: 1px 1px 3px #ebebeb;\n  margin-right: 5px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code {\n  flex: 1;\n  overflow: auto;\n  height: 100%;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code > pre {\n  overflow: visible;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  max-height: 400px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper div {\n  box-sizing: border-box;\n}\n.vuepress-plugin-demo-block__wrapper:hover {\n  box-shadow: 0 0 11px rgba(33, 33, 33, 0.2);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code {\n  overflow: hidden;\n  height: 0;\n  padding: 0 !important;\n  background-color: #282c34;\n  border-radius: 0 !important;\n  transition: height 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code pre {\n  margin: 0 !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  padding: 20px;\n  border-bottom: 1px solid #ebebeb;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer {\n  position: relative;\n  text-align: center;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__codepen {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__expand::before {\n  border-top: none;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #ccc;\n  border-left: 6px solid transparent;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__codepen,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand span,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand::before {\n  border-top-color: #3eaf7c !important;\n  border-bottom-color: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover svg {\n  fill: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand-text {\n  transition: all 0.5s;\n  opacity: 0;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:nth-last-child(2) {\n  right: 50px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:last-child {\n  right: 10px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button {\n  border-color: transparent;\n  background-color: transparent;\n  font-size: 14px;\n  color: #3eaf7c;\n  cursor: pointer;\n  outline: none;\n  margin: 0;\n  width: 46px;\n  position: relative;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::before {\n  content: attr(data-tip);\n  white-space: nowrap;\n  position: absolute;\n  top: -30px;\n  left: 50%;\n  color: #eee;\n  line-height: 1;\n  z-index: 1000;\n  border-radius: 4px;\n  padding: 6px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::after {\n  content: '' !important;\n  display: block;\n  position: absolute;\n  left: 50%;\n  top: -5px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  border: 5px solid transparent;\n  border-top-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button svg {\n  width: 34px;\n  height: 20px;\n  fill: #ccc;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__codepen {\n  position: absolute;\n  top: 10px;\n  transition: all 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand {\n  position: relative;\n  width: 100px;\n  height: 40px;\n  margin: 0;\n  color: #3eaf7c;\n  font-size: 14px;\n  background-color: transparent;\n  border-color: transparent;\n  outline: none;\n  transition: all 0.5s;\n  cursor: pointer;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand::before {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-top: 6px solid #ccc;\n  border-right: 6px solid transparent;\n  border-left: 6px solid transparent;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n");var El={jsLib:[],cssLib:[],jsfiddle:!0,codepen:!0,codepenLayout:"left",codepenJsProcessor:"babel",codepenEditors:"101",horizontal:!1,vue:"https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js",react:"https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js",reactDOM:"https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"},Jl={},Al=function(n){return'<div id="app">\n'.concat(n,"\n</div>")},Ml=function(n){return window.$VUEPRESS_DEMO_BLOCK&&void 0!==window.$VUEPRESS_DEMO_BLOCK[n]?window.$VUEPRESS_DEMO_BLOCK[n]:El[n]},Ll=function n(e,t,a){var r=document.createElement(e);return t&&Object.keys(t).forEach((function(n){if(n.indexOf("data"))r[n]=t[n];else{var e=n.replace("data","");r.dataset[e]=t[n]}})),a&&a.forEach((function(e){var t=e.tag,a=e.attrs,i=e.children;r.appendChild(n(t,a,i))})),r},Ol=function(n,e,t){var a,r=(a=n.querySelectorAll(".".concat(e)),Array.prototype.slice.call(a));return 1!==r.length||t?r:r[0]},Pl=function(n,e){var t,a,r=n.match(/<style>([\s\S]+)<\/style>/),i=n.match(/<template>([\s\S]+)<\/template>/),o=n.match(/<script>([\s\S]+)<\/script>/),l={css:r&&r[1].replace(/^\n|\n$/g,""),html:i&&i[1].replace(/^\n|\n$/g,""),js:o&&o[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};l.htmlTpl=Al(l.html),l.jsTpl=(t=l.js,a=t.replace(/export\s+default\s*?\{\n*/,"").replace(/\n*\}\s*$/,"").trim(),"new Vue({\n  el: '#app',\n  ".concat(a,"\n})")),l.script=function(n,e){var t=n.split(/export\s+default/),a="(function() {".concat(t[0]," ; return ").concat(t[1],"})()"),r=window.Babel?window.Babel.transform(a,{presets:["es2015"]}).code:a,i=[eval][0](r);return i.template=e,i}(l.js,l.html);var s=Ml("vue");return l.jsLib.unshift(s),l},_l=function(n,e){var t,a=n.match(/<style>([\s\S]+)<\/style>/),r=n.match(/<html>([\s\S]+)<\/html>/),i=n.match(/<script>([\s\S]+)<\/script>/),o={css:a&&a[1].replace(/^\n|\n$/g,""),html:r&&r[1].replace(/^\n|\n$/g,""),js:i&&i[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};return o.htmlTpl=o.html,o.jsTpl=o.js,o.script=(t=o.js,window.Babel?window.Babel.transform(t,{presets:["es2015"]}).code:t),o},Dl=function(n){return n=n.replace("export default ","").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,""),n+='ReactDOM.render(React.createElement(App), document.getElementById("app"))'};function Rl(){var n=Ol(document,"vuepress-plugin-demo-block__wrapper",!0);n.length?n.forEach((function(n){if("true"!==n.dataset.created){n.style.display="block";var e=Ol(n,"vuepress-plugin-demo-block__code"),t=Ol(n,"vuepress-plugin-demo-block__display"),a=Ol(n,"vuepress-plugin-demo-block__footer"),r=Ol(t,"vuepress-plugin-demo-block__app"),i=decodeURIComponent(n.dataset.code),o=decodeURIComponent(n.dataset.config),l=decodeURIComponent(n.dataset.type);o=o?JSON.parse(o):{};var s=e.querySelector("div").clientHeight,c="react"===l?function(n,e){var t=(0,window.Babel.transform)(n,{presets:["es2015","react"]}).code,a="(function(exports){var module={};module.exports=exports;".concat(t,";return module.exports.__esModule?module.exports.default:module.exports;})({})"),r=new Function("return ".concat(a))(),i={js:r,css:r.__style__||"",jsLib:e.jsLib||[],cssLib:e.cssLib||[],jsTpl:Dl(n),htmlTpl:Al("")},o=Ml("react"),l=Ml("reactDOM");return i.jsLib.unshift(o,l),i}(i,o):"vanilla"===l?_l(i,o):Pl(i,o),u=Ll("button",{className:"".concat("vuepress-plugin-demo-block__expand")});if(a.appendChild(u),u.addEventListener("click",Bl.bind(null,u,s,e,a)),Ml("jsfiddle")&&a.appendChild(function(n){var e=n.css,t=n.htmlTpl,a=n.jsTpl,r=n.jsLib,i=n.cssLib,o=r.concat(i).concat(Ml("cssLib")).concat(Ml("jsLib")).join(",");return Ll("form",{className:"vuepress-plugin-demo-block__jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"css",value:e}},{tag:"input",attrs:{type:"hidden",name:"html",value:t}},{tag:"input",attrs:{type:"hidden",name:"js",value:a}},{tag:"input",attrs:{type:"hidden",name:"panel_js",value:3}},{tag:"input",attrs:{type:"hidden",name:"wrap",value:1}},{tag:"input",attrs:{type:"hidden",name:"resources",value:o}},{tag:"button",attrs:{type:"submit",className:"vuepress-plugin-demo-block__button",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088289967" class="icon" style="" viewBox="0 0 1170 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1952" xmlns:xlink="http://www.w3.org/1999/xlink" width="228.515625" height="200"><defs><style type="text/css"></style></defs><path d="M1028.571429 441.142857q63.428571 26.285714 102.571428 83.142857T1170.285714 650.857143q0 93.714286-67.428571 160.285714T940 877.714286q-2.285714 0-6.571429-0.285715t-6-0.285714H232q-97.142857-5.714286-164.571429-71.714286T0 645.142857q0-62.857143 31.428571-116t84-84q-6.857143-22.285714-6.857142-46.857143 0-65.714286 46.857142-112t113.714286-46.285714q54.285714 0 98.285714 33.142857 42.857143-88 127.142858-141.714286t186.571428-53.714285q94.857143 0 174.857143 46T982.571429 248.571429t46.571428 172q0 3.428571-0.285714 10.285714t-0.285714 10.285714zM267.428571 593.142857q0 69.714286 48 110.285714t118.857143 40.571429q78.285714 0 137.142857-56.571429-9.142857-11.428571-27.142857-32.285714T519.428571 626.285714q-38.285714 37.142857-82.285714 37.142857-31.428571 0-53.428571-19.142857T361.714286 594.285714q0-30.285714 22-49.714285t52.285714-19.428572q25.142857 0 48.285714 12t41.714286 31.428572 37.142857 42.857142 39.428572 46.857143 44 42.857143 55.428571 31.428572 69.428571 12q69.142857 0 116.857143-40.857143T936 594.857143q0-69.142857-48-109.714286t-118.285714-40.571428q-81.714286 0-137.714286 55.428571l53.142857 61.714286q37.714286-36.571429 81.142857-36.571429 29.714286 0 52.571429 18.857143t22.857143 48q0 32.571429-21.142857 52.285714t-53.714286 19.714286q-24.571429 0-47.142857-12t-41.142857-31.428571-37.428572-42.857143-39.714286-46.857143-44.285714-42.857143-55.142857-31.428571T434.285714 444.571429q-69.714286 0-118.285714 40.285714T267.428571 593.142857z" p-id="1953"></path></svg>',datatip:"JSFiddle"}}])}(c)),Ml("codepen")&&a.appendChild(function(n){var e=n.css,t=n.htmlTpl,a=n.jsTpl,r=n.jsLib,i=n.cssLib,o=JSON.stringify({css:e,html:t,js:a,js_external:r.concat(Ml("jsLib")).join(";"),css_external:i.concat(Ml("cssLib")).join(";"),layout:Ml("codepenLayout"),js_pre_processor:Ml("codepenJsProcessor"),editors:Ml("codepenEditors")});return Ll("form",{className:"vuepress-plugin-demo-block__codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"data",value:o}},{tag:"button",attrs:{type:"submit",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088271207" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1737" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M123.428571 668l344.571429 229.714286v-205.142857L277.142857 565.142857z m-35.428571-82.285714l110.285714-73.714286-110.285714-73.714286v147.428572z m468 312l344.571429-229.714286-153.714286-102.857143-190.857143 127.428572v205.142857z m-44-281.714286l155.428571-104-155.428571-104-155.428571 104zM277.142857 458.857143l190.857143-127.428572V126.285714L123.428571 356z m548.571429 53.142857l110.285714 73.714286V438.285714z m-78.857143-53.142857l153.714286-102.857143-344.571429-229.714286v205.142857z m277.142857-102.857143v312q0 23.428571-19.428571 36.571429l-468 312q-12 7.428571-24.571429 7.428571t-24.571429-7.428571L19.428571 704.571429q-19.428571-13.142857-19.428571-36.571429V356q0-23.428571 19.428571-36.571429L487.428571 7.428571q12-7.428571 24.571429-7.428571t24.571429 7.428571l468 312q19.428571 13.142857 19.428571 36.571429z" p-id="1738"></path></svg>',className:"vuepress-plugin-demo-block__button",datatip:"Codepen"}}])}(c)),void 0!==o.horizontal?o.horizontal:Ml("horizontal")){n.classList.add("vuepress-plugin-demo-block__horizontal");var d=e.firstChild.cloneNode(!0);d.classList.add("vuepress-plugin-demo-block__h_code"),t.appendChild(d)}if(c.css&&function(n){if(!Jl[n]){var e=Ll("style",{innerHTML:n});document.body.appendChild(e),Jl[n]=!0}}(c.css),"react"===l)ReactDOM.render(React.createElement(c.js),r);else if("vue"===l){var p=(new(Vue.extend(c.script))).$mount();r.appendChild(p.$el)}else"vanilla"===l&&(r.innerHTML=c.html,new Function("return (function(){".concat(c.script,"})()"))());n.dataset.created="true"}})):setTimeout((function(n){Rl()}),300)}function Bl(n,e,t,a){var r="1"!==n.dataset.isExpand;t.style.height=r?"".concat(e,"px"):0,r?a.classList.add("vuepress-plugin-demo-block__show-link"):a.classList.remove("vuepress-plugin-demo-block__show-link"),n.dataset.isExpand=r?"1":"0"}var Fl={mounted:function(){window.$VUEPRESS_DEMO_BLOCK={jsfiddle:!1,codepen:!0,horizontal:!1},Rl()},updated:function(){Rl()}},Nl="auto",ql="zoom-in",Ul="zoom-out",Vl="grab",Hl="move";function Gl(n,e,t){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r={passive:!1};a?n.addEventListener(e,t,r):n.removeEventListener(e,t,r)}function $l(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function Wl(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function Kl(n,e,t){!function(n){var e=Xl,t=Ql;if(n.transition){var a=n.transition;delete n.transition,n[e]=a}if(n.transform){var r=n.transform;delete n.transform,n[t]=r}}(e);var a=n.style,r={};for(var i in e)t&&(r[i]=a[i]||""),a[i]=e[i];return r}var Xl="transition",Ql="transform",Yl="transform",Zl="transitionend";var ns=function(){},es={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:ns,onClose:ns,onGrab:ns,onMove:ns,onRelease:ns,onBeforeOpen:ns,onBeforeClose:ns,onBeforeGrab:ns,onBeforeRelease:ns,onImageLoading:ns,onImageLoaded:ns},ts={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),rs(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var a=this.lastScrollPosition.x-e,r=this.lastScrollPosition.y-t,i=this.options.scrollThreshold;(Math.abs(r)>=i||Math.abs(a)>=i)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if(as(n)&&!rs(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){as(n)&&!rs(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,a=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,a)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,a=e.clientY;this.move(t,a)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function as(n){return 0===n.button}function rs(n){return n.metaKey||n.ctrlKey}var is={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,Kl(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),Gl(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){Kl(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},os="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ls=function(){function n(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),ss=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},cs={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=Wl(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,a=n.transitionDuration,r=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?Vl:Ul,transition:Yl+"\n        "+a+"s\n        "+r,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=Kl(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,Kl(this.el,{transform:"none"})},grab:function(n,e,t){var a=us(),r=a.x-n,i=a.y-e;Kl(this.el,{cursor:Hl,transform:"translate3d(\n        "+(this.translate.x+r)+"px, "+(this.translate.y+i)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var a=us(),r=a.x-n,i=a.y-e;Kl(this.el,{transition:Yl,transform:"translate3d(\n        "+(this.translate.x+r)+"px, "+(this.translate.y+i)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){Kl(this.el,this.styleClose)},restoreOpenStyle:function(){Kl(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=us(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,a=this.instance.options,r=a.customSize,i=a.scaleBase;if(!r&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(r&&"object"===(void 0===r?"undefined":os(r)))return{x:r.width/this.rect.width,y:r.height/this.rect.height};var o=this.rect.width/2,l=this.rect.height/2,s=us(),c={x:s.x-o,y:s.y-l},u=c.x/o,d=c.y/l,p=i+Math.min(u,d);if(r&&"string"==typeof r){var m=t||this.el.naturalWidth,h=e||this.el.naturalHeight,v=parseFloat(r)*m/(100*this.rect.width),g=parseFloat(r)*h/(100*this.rect.height);if(p>v||p>g)return{x:v,y:g}}return{x:p,y:p}}};function us(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function ds(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(a){Gl(n,a,e[a],t)}))}var ps=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(cs),this.overlay=Object.create(is),this.handler=Object.create(ts),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=ss({},es,e),this.overlay.init(this),this.handler.init(this)}return ls(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=ql,Gl(n,"click",this.handler.click),this.options.preloadImage&&$l(Wl(n)));return this}},{key:"config",value:function(n){return n?(ss(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var a="string"==typeof n?document.querySelector(n):n;if("IMG"===a.tagName){if(this.options.onBeforeOpen(a),this.target.init(a,this),!this.options.preloadImage){var r=this.target.srcOriginal;null!=r&&(this.options.onImageLoading(a),$l(r,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),Gl(document,"scroll",this.handler.scroll),Gl(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&Gl(window,"resize",this.handler.resizeWindow);var i=function n(){Gl(a,Zl,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&ds(document,e.handler,!0),t(a)};return Gl(a,Zl,i),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=Nl,this.overlay.fadeOut(),this.target.zoomOut(),Gl(document,"scroll",this.handler.scroll,!1),Gl(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&Gl(window,"resize",this.handler.resizeWindow,!1);var a=function a(){Gl(t,Zl,a,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&ds(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return Gl(t,Zl,a),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var r=this.target.el;this.options.onBeforeGrab(r),this.released=!1,this.target.grab(n,e,t);var i=function n(){Gl(r,Zl,n,!1),a(r)};return Gl(r,Zl,i),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=Hl,this.target.move(n,e,t);var r=this.target.el,i=function n(){Gl(r,Zl,n,!1),a(r)};return Gl(r,Zl,i),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=Nl,this.target.restoreOpenStyle();var a=function a(){Gl(t,Zl,a,!1),n.lock=!1,n.released=!0,e(t)};return Gl(t,Zl,a),this}}}]),n}();const ms=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),hs=Number("500");class vs{constructor(){this.instance=new ps(ms)}update(n=".theme-vdoing-content img:not(.no-zoom)"){"undefined"!=typeof window&&this.instance.listen(n)}updateDelay(n=".theme-vdoing-content img:not(.no-zoom)",e=hs){setTimeout(()=>this.update(n),e)}}var gs=[fl,wl,Il,zl,Fl,{watch:{"$page.path"(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted(){this.$vuepress.zooming=new vs,this.$vuepress.zooming.updateDelay()}}],fs={name:"GlobalLayout",computed:{layout(){const n=this.getLayout();return pl("layout",n),$t.component(n)}},methods:{getLayout(){if(this.$page.path){const n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},bs=t(4),ys=Object(bs.a)(fs,(function(){return(0,this._self._c)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),n[e].push(...t);break;default:throw new Error("Unknown option name.")}}(ys,"mixins",gs);const xs=[{name:"v-2fc2d87c",path:"/pages/7daf0d/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-2fc2d87c").then(t)}},{path:"/pages/7daf0d/index.html",redirect:"/pages/7daf0d/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/00.Javaå¼åç¯å¢.html",redirect:"/pages/7daf0d/"},{name:"v-1843e802",path:"/pages/55d693/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-1843e802").then(t)}},{path:"/pages/55d693/index.html",redirect:"/pages/55d693/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/02.Javaåºæ¬æ°æ®ç±»å.html",redirect:"/pages/55d693/"},{name:"v-dfab5e76",path:"/pages/2950ba/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-dfab5e76").then(t)}},{path:"/pages/2950ba/index.html",redirect:"/pages/2950ba/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/01.Javaåºç¡è¯­æ³.html",redirect:"/pages/2950ba/"},{name:"v-772ffd48",path:"/pages/3e1661/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-772ffd48").then(t)}},{path:"/pages/3e1661/index.html",redirect:"/pages/3e1661/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/03.Javaé¢åå¯¹è±¡.html",redirect:"/pages/3e1661/"},{name:"v-e64b7cf6",path:"/pages/7a3ffc/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-e64b7cf6").then(t)}},{path:"/pages/7a3ffc/index.html",redirect:"/pages/7a3ffc/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/04.Javaæ¹æ³.html",redirect:"/pages/7a3ffc/"},{name:"v-de4ee0ba",path:"/pages/155518/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-de4ee0ba").then(t)}},{path:"/pages/155518/index.html",redirect:"/pages/155518/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/05.Javaæ°ç».html",redirect:"/pages/155518/"},{name:"v-4e691f6f",path:"/pages/979887/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-4e691f6f").then(t)}},{path:"/pages/979887/index.html",redirect:"/pages/979887/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/06.Javaæä¸¾.html",redirect:"/pages/979887/"},{name:"v-52489532",path:"/pages/fb4f8c/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-52489532").then(t)}},{path:"/pages/fb4f8c/index.html",redirect:"/pages/fb4f8c/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/07.Javaæ§å¶è¯­å¥.html",redirect:"/pages/fb4f8c/"},{name:"v-7b80f369",path:"/pages/37415c/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-7b80f369").then(t)}},{path:"/pages/37415c/index.html",redirect:"/pages/37415c/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/08.Javaå¼å¸¸.html",redirect:"/pages/37415c/"},{name:"v-34aa0805",path:"/pages/33a820/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-34aa0805").then(t)}},{path:"/pages/33a820/index.html",redirect:"/pages/33a820/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/09.Javaæ³å.html",redirect:"/pages/33a820/"},{name:"v-604f94c1",path:"/pages/0d066a/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-604f94c1").then(t)}},{path:"/pages/0d066a/index.html",redirect:"/pages/0d066a/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/10.Javaåå°.html",redirect:"/pages/0d066a/"},{name:"v-615708fd",path:"/pages/ecc011/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-615708fd").then(t)}},{path:"/pages/ecc011/index.html",redirect:"/pages/ecc011/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/11.Javaæ³¨è§£.html",redirect:"/pages/ecc011/"},{name:"v-aed39f40",path:"/pages/71bfcd/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-aed39f40").then(t)}},{path:"/pages/71bfcd/index.html",redirect:"/pages/71bfcd/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/41.Javaå¸¸ç¨å·¥å·ç±».html",redirect:"/pages/71bfcd/"},{name:"v-e38dd302",path:"/pages/bc583c/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-e38dd302").then(t)}},{path:"/pages/bc583c/index.html",redirect:"/pages/bc583c/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/42.JavaStringç±»å.html",redirect:"/pages/bc583c/"},{name:"v-2ab9bc43",path:"/pages/8ea213/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-2ab9bc43").then(t)}},{path:"/pages/8ea213/index.html",redirect:"/pages/8ea213/"},{path:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/",redirect:"/pages/8ea213/"},{name:"v-aedbe21a",path:"/pages/a249ff/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-aedbe21a").then(t)}},{path:"/pages/a249ff/index.html",redirect:"/pages/a249ff/"},{path:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/02.Javaç¼ç åå å¯.html",redirect:"/pages/a249ff/"},{name:"v-19cb262c",path:"/pages/4c1dd4/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-19cb262c").then(t)}},{path:"/pages/4c1dd4/index.html",redirect:"/pages/4c1dd4/"},{path:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/01.Javaæ­£å.html",redirect:"/pages/4c1dd4/"},{name:"v-061c6092",path:"/pages/57003e/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-061c6092").then(t)}},{path:"/pages/57003e/index.html",redirect:"/pages/57003e/"},{path:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/03.Javaå½éå.html",redirect:"/pages/57003e/"},{name:"v-2bdfddf8",path:"/pages/ad1cce/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-2bdfddf8").then(t)}},{path:"/pages/ad1cce/index.html",redirect:"/pages/ad1cce/"},{path:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/04.JDK8.html",redirect:"/pages/ad1cce/"},{name:"v-7ac23752",path:"/pages/d71f2c/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-7ac23752").then(t)}},{path:"/pages/d71f2c/index.html",redirect:"/pages/d71f2c/"},{path:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/99.Javaç¼ç¨è§è.html",redirect:"/pages/d71f2c/"},{name:"v-61ba4cc8",path:"/pages/496a7e/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-61ba4cc8").then(t)}},{path:"/pages/496a7e/index.html",redirect:"/pages/496a7e/"},{path:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/05.JavaSPI.html",redirect:"/pages/496a7e/"},{name:"v-3f95b793",path:"/pages/1cadba/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-3f95b793").then(t)}},{path:"/pages/1cadba/index.html",redirect:"/pages/1cadba/"},{path:"/01.Java/01.JavaSE/03.å®¹å¨/01.Javaå®¹å¨ç®ä».html",redirect:"/pages/1cadba/"},{name:"v-56fce25d",path:"/pages/016137/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-56fce25d").then(t)}},{path:"/pages/016137/index.html",redirect:"/pages/016137/"},{path:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/",redirect:"/pages/016137/"},{name:"v-107bd1fe",path:"/pages/69deb2/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-107bd1fe").then(t)}},{path:"/pages/69deb2/index.html",redirect:"/pages/69deb2/"},{path:"/01.Java/01.JavaSE/03.å®¹å¨/02.Javaå®¹å¨ä¹List.html",redirect:"/pages/69deb2/"},{name:"v-9a8a8b92",path:"/pages/794c6b/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-9a8a8b92").then(t)}},{path:"/pages/794c6b/index.html",redirect:"/pages/794c6b/"},{path:"/01.Java/01.JavaSE/03.å®¹å¨/04.Javaå®¹å¨ä¹Set.html",redirect:"/pages/794c6b/"},{name:"v-5b80a7d7",path:"/pages/385755/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-5b80a7d7").then(t)}},{path:"/pages/385755/index.html",redirect:"/pages/385755/"},{path:"/01.Java/01.JavaSE/03.å®¹å¨/03.Javaå®¹å¨ä¹Map.html",redirect:"/pages/385755/"},{name:"v-826b0392",path:"/pages/ffa963/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-826b0392").then(t)}},{path:"/pages/ffa963/index.html",redirect:"/pages/ffa963/"},{path:"/01.Java/01.JavaSE/03.å®¹å¨/05.Javaå®¹å¨ä¹Queue.html",redirect:"/pages/ffa963/"},{name:"v-32719e6b",path:"/pages/b165ad/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-32719e6b").then(t)}},{path:"/pages/b165ad/index.html",redirect:"/pages/b165ad/"},{path:"/01.Java/01.JavaSE/04.IO/01.JavaIOæ¨¡å.html",redirect:"/pages/b165ad/"},{name:"v-3295fff5",path:"/pages/529fad/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-3295fff5").then(t)}},{path:"/pages/529fad/index.html",redirect:"/pages/529fad/"},{path:"/01.Java/01.JavaSE/03.å®¹å¨/06.Javaå®¹å¨ä¹Stream.html",redirect:"/pages/529fad/"},{name:"v-777420e7",path:"/pages/9eb49b/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-777420e7").then(t)}},{path:"/pages/9eb49b/index.html",redirect:"/pages/9eb49b/"},{path:"/01.Java/01.JavaSE/03.å®¹å¨/",redirect:"/pages/9eb49b/"},{name:"v-3240456a",path:"/pages/6912a8/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-3240456a").then(t)}},{path:"/pages/6912a8/index.html",redirect:"/pages/6912a8/"},{path:"/01.Java/01.JavaSE/04.IO/02.JavaNIO.html",redirect:"/pages/6912a8/"},{name:"v-18d0a24b",path:"/pages/2b2f0f/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-18d0a24b").then(t)}},{path:"/pages/2b2f0f/index.html",redirect:"/pages/2b2f0f/"},{path:"/01.Java/01.JavaSE/04.IO/03.Javaåºåå.html",redirect:"/pages/2b2f0f/"},{name:"v-b99a190c",path:"/pages/e4c818/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-b99a190c").then(t)}},{path:"/pages/e4c818/index.html",redirect:"/pages/e4c818/"},{path:"/01.Java/01.JavaSE/04.IO/04.Javaç½ç»ç¼ç¨.html",redirect:"/pages/e4c818/"},{name:"v-2bdc15e1",path:"/pages/e25d81/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-2bdc15e1").then(t)}},{path:"/pages/e25d81/index.html",redirect:"/pages/e25d81/"},{path:"/01.Java/01.JavaSE/04.IO/05.JavaIOå·¥å·ç±».html",redirect:"/pages/e25d81/"},{name:"v-0657f720",path:"/pages/e285c8/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-0657f720").then(t)}},{path:"/pages/e285c8/index.html",redirect:"/pages/e285c8/"},{path:"/01.Java/01.JavaSE/04.IO/",redirect:"/pages/e285c8/"},{name:"v-201723ff",path:"/pages/fee2cc/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-201723ff").then(t)}},{path:"/pages/fee2cc/index.html",redirect:"/pages/fee2cc/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/02.Javaçº¿ç¨åºç¡.html",redirect:"/pages/fee2cc/"},{name:"v-3a567e4e",path:"/pages/f6b642/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-3a567e4e").then(t)}},{path:"/pages/f6b642/index.html",redirect:"/pages/f6b642/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/01.Javaå¹¶åç®ä».html",redirect:"/pages/f6b642/"},{name:"v-d3fa156e",path:"/pages/25f78a/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-d3fa156e").then(t)}},{path:"/pages/25f78a/index.html",redirect:"/pages/25f78a/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/05.Javaåå­ç±».html",redirect:"/pages/25f78a/"},{name:"v-06ff1f1b",path:"/pages/2c6488/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-06ff1f1b").then(t)}},{path:"/pages/2c6488/index.html",redirect:"/pages/2c6488/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/03.Javaå¹¶åæ ¸å¿æºå¶.html",redirect:"/pages/2c6488/"},{name:"v-5fcbebd1",path:"/pages/e2e047/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-5fcbebd1").then(t)}},{path:"/pages/e2e047/index.html",redirect:"/pages/e2e047/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/04.Javaé.html",redirect:"/pages/e2e047/"},{name:"v-b1d46672",path:"/pages/b067d6/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-b1d46672").then(t)}},{path:"/pages/b067d6/index.html",redirect:"/pages/b067d6/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/06.Javaå¹¶ååå®¹å¨.html",redirect:"/pages/b067d6/"},{name:"v-7a471e72",path:"/pages/ad9680/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-7a471e72").then(t)}},{path:"/pages/ad9680/index.html",redirect:"/pages/ad9680/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/07.Javaçº¿ç¨æ± .html",redirect:"/pages/ad9680/"},{name:"v-c2716862",path:"/pages/d4e06f/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-c2716862").then(t)}},{path:"/pages/d4e06f/index.html",redirect:"/pages/d4e06f/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/09.Javaåå­æ¨¡å.html",redirect:"/pages/d4e06f/"},{name:"v-69f9625e",path:"/pages/02d274/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-69f9625e").then(t)}},{path:"/pages/02d274/index.html",redirect:"/pages/02d274/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/08.Javaå¹¶åå·¥å·ç±».html",redirect:"/pages/02d274/"},{name:"v-cd87896e",path:"/pages/edd121/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-cd87896e").then(t)}},{path:"/pages/edd121/index.html",redirect:"/pages/edd121/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/10.ForkJoinæ¡æ¶.html",redirect:"/pages/edd121/"},{name:"v-fea6165a",path:"/pages/8655a7/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-fea6165a").then(t)}},{path:"/pages/8655a7/index.html",redirect:"/pages/8655a7/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/11.Synchronized.html",redirect:"/pages/8655a7/"},{name:"v-364ddd94",path:"/pages/6e5393/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-364ddd94").then(t)}},{path:"/pages/6e5393/index.html",redirect:"/pages/6e5393/"},{path:"/01.Java/01.JavaSE/05.å¹¶å/",redirect:"/pages/6e5393/"},{name:"v-95392858",path:"/pages/db5b69/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-95392858").then(t)}},{path:"/pages/db5b69/index.html",redirect:"/pages/db5b69/"},{path:"/01.Java/01.JavaSE/06.JVM/02.JVMåå­åºå.html",redirect:"/pages/db5b69/"},{name:"v-7fd1094f",path:"/pages/08f153/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-7fd1094f").then(t)}},{path:"/pages/08f153/index.html",redirect:"/pages/08f153/"},{path:"/01.Java/01.JavaSE/06.JVM/01.JVMä½ç³»ç»æ.html",redirect:"/pages/08f153/"},{name:"v-7aafddb2",path:"/pages/c5a5b6/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-7aafddb2").then(t)}},{path:"/pages/c5a5b6/index.html",redirect:"/pages/c5a5b6/"},{path:"/01.Java/01.JavaSE/06.JVM/03.JVMåå¾æ¶é.html",redirect:"/pages/c5a5b6/"},{name:"v-f116965a",path:"/pages/e9eb4b/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-f116965a").then(t)}},{path:"/pages/e9eb4b/index.html",redirect:"/pages/e9eb4b/"},{path:"/01.Java/01.JavaSE/06.JVM/05.JVMå­èç .html",redirect:"/pages/e9eb4b/"},{name:"v-5bfd289c",path:"/pages/17aad9/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-5bfd289c").then(t)}},{path:"/pages/17aad9/index.html",redirect:"/pages/17aad9/"},{path:"/01.Java/01.JavaSE/06.JVM/04.JVMç±»å è½½.html",redirect:"/pages/17aad9/"},{name:"v-cc303ce8",path:"/pages/c590ae/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-cc303ce8").then(t)}},{path:"/pages/c590ae/index.html",redirect:"/pages/c590ae/"},{path:"/01.Java/01.JavaSE/06.JVM/11.JVMå½ä»¤è¡å·¥å·.html",redirect:"/pages/c590ae/"},{name:"v-27908e84",path:"/pages/43a8e5/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-27908e84").then(t)}},{path:"/pages/43a8e5/index.html",redirect:"/pages/43a8e5/"},{path:"/01.Java/01.JavaSE/06.JVM/12.JVM_GUIå·¥å·.html",redirect:"/pages/43a8e5/"},{name:"v-2ecce247",path:"/pages/9cb60a/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-2ecce247").then(t)}},{path:"/pages/9cb60a/index.html",redirect:"/pages/9cb60a/"},{path:"/01.Java/01.JavaSE/06.JVM/21.JVMå®æ.html",redirect:"/pages/9cb60a/"},{name:"v-0bede0ba",path:"/pages/84f329/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-0bede0ba").then(t)}},{path:"/pages/84f329/index.html",redirect:"/pages/84f329/"},{path:"/01.Java/01.JavaSE/06.JVM/22.Javaæéè¯æ­.html",redirect:"/pages/84f329/"},{name:"v-740bd8b4",path:"/pages/51172b/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-740bd8b4").then(t)}},{path:"/pages/51172b/index.html",redirect:"/pages/51172b/"},{path:"/01.Java/01.JavaSE/06.JVM/",redirect:"/pages/51172b/"},{name:"v-bdc85676",path:"/pages/ebf8d4/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-bdc85676").then(t)}},{path:"/pages/ebf8d4/index.html",redirect:"/pages/ebf8d4/"},{path:"/01.Java/01.JavaSE/06.JVM/jvm-and-java.html",redirect:"/pages/ebf8d4/"},{name:"v-6c8957c8",path:"/pages/5f886e/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-6c8957c8").then(t)}},{path:"/pages/5f886e/index.html",redirect:"/pages/5f886e/"},{path:"/01.Java/01.JavaSE/99.Javaé¢è¯.html",redirect:"/pages/5f886e/"},{name:"v-f5cbbe1c",path:"/pages/69d2f8/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-f5cbbe1c").then(t)}},{path:"/pages/69d2f8/index.html",redirect:"/pages/69d2f8/"},{path:"/01.Java/01.JavaSE/",redirect:"/pages/69d2f8/"},{name:"v-73f01fa5",path:"/tags/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-73f01fa5").then(t)}},{path:"/tags/index.html",redirect:"/tags/"},{path:"/@pages/tagsPage.html",redirect:"/tags/"},{name:"v-3f7bcbb6",path:"/archives/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-3f7bcbb6").then(t)}},{path:"/archives/index.html",redirect:"/archives/"},{path:"/@pages/archivesPage.html",redirect:"/archives/"},{name:"v-67a474f6",path:"/categories/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-67a474f6").then(t)}},{path:"/categories/index.html",redirect:"/categories/"},{path:"/@pages/categoriesPage.html",redirect:"/categories/"},{name:"v-ceebf0d4",path:"/",component:ys,beforeEnter:(n,e,t)=>{dl("Layout","v-ceebf0d4").then(t)}},{path:"/index.html",redirect:"/"},{path:"*",component:ys}],ks={title:"JAVACORE",description:"â JavaCore æ¯ä¸ä¸ª Java æ ¸å¿ææ¯æç¨ã",base:"/javacore/",headTags:[["link",{rel:"icon",href:"/javacore/img/favicon.ico"}],["meta",{name:"keywords",content:"vuepress,theme,blog,vdoing"}],["meta",{name:"theme-color",content:"#11a8cd"}],["meta",{name:"wwads-cn-verify",content:"mxqWx62nfQQ9ocT4e5DzISHzOWyF4s"}],["script",{src:"https://cdn.wwads.cn/js/makemoney.js",type:"text/javascript"}]],pages:[{title:"Java å¼åç¯å¢",frontmatter:{title:"Java å¼åç¯å¢",date:"2018-08-29T17:28:34.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE"],permalink:"/pages/7daf0d/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/00.Java%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/00.Javaå¼åç¯å¢.md",key:"v-2fc2d87c",path:"/pages/7daf0d/",headers:[{level:2,title:"ä¸è½½",slug:"ä¸è½½",normalizedTitle:"ä¸è½½",charIndex:61},{level:2,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:101},{level:2,title:"ç¯å¢åé",slug:"ç¯å¢åé",normalizedTitle:"ç¯å¢åé",charIndex:48},{level:3,title:"Windows",slug:"windows",normalizedTitle:"windows",charIndex:187},{level:3,title:"Linux",slug:"linux",normalizedTitle:"linux",charIndex:149},{level:2,title:"æµè¯å®è£æå",slug:"æµè¯å®è£æå",normalizedTitle:"æµè¯å®è£æå",charIndex:574},{level:2,title:"å¼åå·¥å·",slug:"å¼åå·¥å·",normalizedTitle:"å¼åå·¥å·",charIndex:631},{level:2,title:"ç¬¬ä¸ä¸ªç¨åºï¼Hello World",slug:"ç¬¬ä¸ä¸ªç¨åº-hello-world",normalizedTitle:"ç¬¬ä¸ä¸ªç¨åºï¼hello world",charIndex:1073}],headersStr:"ä¸è½½ å®è£ ç¯å¢åé Windows Linux æµè¯å®è£æå å¼åå·¥å· ç¬¬ä¸ä¸ªç¨åºï¼Hello World",content:'# Java å¼åç¯å¢\n\n> ð å³é®è¯ï¼ JAVA_HOMEãCLASSPATHãPathãç¯å¢åéãIDE\n\n\n# ä¸è½½\n\nè¿å¥ JDK å®æ¹ä¸è½½å°å ï¼æ ¹æ®èªå·±çç¯å¢éæ©ä¸è½½æéçæ¬ã\n\n\n# å®è£\n\nwindows ç¯å¢ç jdk åæ¯ exe å®è£æä»¶ï¼å¯å¨åæ ¹æ®å®è£åå¯¼å®è£å³å¯ã\n\nLinux ç¯å¢ç jdk åï¼è§£åå°æ¬å°å³å¯ã\n\n\n# ç¯å¢åé\n\n\n# Windows\n\nè®¡ç®æº > å±æ§ > é«çº§ç³»ç»è®¾ç½® > ç¯å¢åé\n\næ·»å ä»¥ä¸ç¯å¢åéï¼\n\nJAVA_HOMEï¼C:\\Program Files (x86)\\Java\\jdk1.8.0_91 ï¼æ ¹æ®èªå·±çå®éè·¯å¾éç½®ï¼\n\nCLASSPATHï¼.;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar; ï¼æ³¨æåé¢æä¸ª"."ï¼\n\nPathï¼%JAVA_HOME%\\bin;%JAVA_HOME%\\jre\\bin;\n\n\n# Linux\n\næ§è¡ vi /etc/profile ï¼ç¼è¾ç¯å¢åéæä»¶\n\næ·»å ä¸¤è¡ï¼\n\nexport JAVA_HOME=path/to/java\nexport PATH=JAVA_HOME/bin:JAVA_HOME/jre/bin:\n\n\næ§è¡ source /etc/profile ï¼ç«å³çæã\n\n\n# æµè¯å®è£æå\n\næ§è¡å½ä»¤ java -version ï¼å¦æå®è£æåï¼ä¼æå°å½å java ççæ¬ä¿¡æ¯ã\n\n\n# å¼åå·¥å·\n\nå·¥æ¬²åå¶äºï¼å¿åå©å¶å¨ãç¼å Java ç¨åºï¼å½ç¶æå¿è¦éæ©ä¸ä¸ªåéç IDEã\n\nIDEï¼Integrated Development Environmentï¼å³éæå¼åç¯å¢ï¼æ¯ç¨äºæä¾ç¨åºå¼åç¯å¢çåºç¨ç¨åºï¼ä¸è¬åæ¬ä»£ç ç¼è¾å¨ãç¼è¯å¨ãè°è¯å¨åå¾å½¢ç¨æ·çé¢ç­å·¥å·ã\n\nå¸¸è§ç Java IDE å¦ä¸ï¼\n\n * Eclipse - ä¸ä¸ªå¼æ¾æºä»£ç çãåºäº Java çå¯æ©å±å¼åå¹³å°ã\n * NetBeans - å¼æ¾æºç ç Java éæå¼åç¯å¢ï¼éç¨äºåç§å®¢æ·æºå Web åºç¨ã\n * IntelliJ IDEA - å¨ä»£ç èªå¨æç¤ºãä»£ç åæç­æ¹é¢çå·æå¾å¥½çåè½ã\n * MyEclipse - ç± Genuitec å¬å¸å¼åçä¸æ¬¾åä¸åè½¯ä»¶ï¼æ¯åºç¨æ¯è¾å¹¿æ³ç Java åºç¨ç¨åºéæå¼åç¯å¢ã\n * EditPlus - å¦ææ­£ç¡®éç½® Java çç¼è¯å¨âJavacâä»¥åè§£éå¨âJavaâåï¼å¯ç´æ¥ä½¿ç¨ EditPlus ç¼è¯æ§è¡ Java ç¨åºã\n\n\n# ç¬¬ä¸ä¸ªç¨åºï¼Hello World\n\næ·»å  HelloWorld.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\npublic class HelloWorld {\n    public static void main(String[] args) {\n        System.out.println("Hello World");\n    }\n}\n\n\næ§è¡åï¼æ§å¶å°è¾åºï¼\n\nHello World\n',normalizedContent:'# java å¼åç¯å¢\n\n> ð å³é®è¯ï¼ java_homeãclasspathãpathãç¯å¢åéãide\n\n\n# ä¸è½½\n\nè¿å¥ jdk å®æ¹ä¸è½½å°å ï¼æ ¹æ®èªå·±çç¯å¢éæ©ä¸è½½æéçæ¬ã\n\n\n# å®è£\n\nwindows ç¯å¢ç jdk åæ¯ exe å®è£æä»¶ï¼å¯å¨åæ ¹æ®å®è£åå¯¼å®è£å³å¯ã\n\nlinux ç¯å¢ç jdk åï¼è§£åå°æ¬å°å³å¯ã\n\n\n# ç¯å¢åé\n\n\n# windows\n\nè®¡ç®æº > å±æ§ > é«çº§ç³»ç»è®¾ç½® > ç¯å¢åé\n\næ·»å ä»¥ä¸ç¯å¢åéï¼\n\njava_homeï¼c:\\program files (x86)\\java\\jdk1.8.0_91 ï¼æ ¹æ®èªå·±çå®éè·¯å¾éç½®ï¼\n\nclasspathï¼.;%java_home%\\lib\\dt.jar;%java_home%\\lib\\tools.jar; ï¼æ³¨æåé¢æä¸ª"."ï¼\n\npathï¼%java_home%\\bin;%java_home%\\jre\\bin;\n\n\n# linux\n\næ§è¡ vi /etc/profile ï¼ç¼è¾ç¯å¢åéæä»¶\n\næ·»å ä¸¤è¡ï¼\n\nexport java_home=path/to/java\nexport path=java_home/bin:java_home/jre/bin:\n\n\næ§è¡ source /etc/profile ï¼ç«å³çæã\n\n\n# æµè¯å®è£æå\n\næ§è¡å½ä»¤ java -version ï¼å¦æå®è£æåï¼ä¼æå°å½å java ççæ¬ä¿¡æ¯ã\n\n\n# å¼åå·¥å·\n\nå·¥æ¬²åå¶äºï¼å¿åå©å¶å¨ãç¼å java ç¨åºï¼å½ç¶æå¿è¦éæ©ä¸ä¸ªåéç ideã\n\nideï¼integrated development environmentï¼å³éæå¼åç¯å¢ï¼æ¯ç¨äºæä¾ç¨åºå¼åç¯å¢çåºç¨ç¨åºï¼ä¸è¬åæ¬ä»£ç ç¼è¾å¨ãç¼è¯å¨ãè°è¯å¨åå¾å½¢ç¨æ·çé¢ç­å·¥å·ã\n\nå¸¸è§ç java ide å¦ä¸ï¼\n\n * eclipse - ä¸ä¸ªå¼æ¾æºä»£ç çãåºäº java çå¯æ©å±å¼åå¹³å°ã\n * netbeans - å¼æ¾æºç ç java éæå¼åç¯å¢ï¼éç¨äºåç§å®¢æ·æºå web åºç¨ã\n * intellij idea - å¨ä»£ç èªå¨æç¤ºãä»£ç åæç­æ¹é¢çå·æå¾å¥½çåè½ã\n * myeclipse - ç± genuitec å¬å¸å¼åçä¸æ¬¾åä¸åè½¯ä»¶ï¼æ¯åºç¨æ¯è¾å¹¿æ³ç java åºç¨ç¨åºéæå¼åç¯å¢ã\n * editplus - å¦ææ­£ç¡®éç½® java çç¼è¯å¨âjavacâä»¥åè§£éå¨âjavaâåï¼å¯ç´æ¥ä½¿ç¨ editplus ç¼è¯æ§è¡ java ç¨åºã\n\n\n# ç¬¬ä¸ä¸ªç¨åºï¼hello world\n\næ·»å  helloworld.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\npublic class helloworld {\n    public static void main(string[] args) {\n        system.out.println("hello world");\n    }\n}\n\n\næ§è¡åï¼æ§å¶å°è¾åºï¼\n\nhello world\n',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java åºæ¬æ°æ®ç±»å",frontmatter:{title:"æ·±å¥çè§£ Java åºæ¬æ°æ®ç±»å",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","æ°æ®ç±»å"],permalink:"/pages/55d693/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/02.Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/02.Javaåºæ¬æ°æ®ç±»å.md",key:"v-1843e802",path:"/pages/55d693/",headers:[{level:2,title:"æ°æ®ç±»ååç±»",slug:"æ°æ®ç±»ååç±»",normalizedTitle:"æ°æ®ç±»ååç±»",charIndex:25},{level:3,title:"å¼ç±»å",slug:"å¼ç±»å",normalizedTitle:"å¼ç±»å",charIndex:53},{level:3,title:"å¼ç±»ååå¼ç¨ç±»åçåºå«",slug:"å¼ç±»ååå¼ç¨ç±»åçåºå«",normalizedTitle:"å¼ç±»ååå¼ç¨ç±»åçåºå«",charIndex:893},{level:2,title:"æ°æ®è½¬æ¢",slug:"æ°æ®è½¬æ¢",normalizedTitle:"æ°æ®è½¬æ¢",charIndex:1228},{level:3,title:"èªå¨è½¬æ¢",slug:"èªå¨è½¬æ¢",normalizedTitle:"èªå¨è½¬æ¢",charIndex:1258},{level:3,title:"å¼ºå¶è½¬æ¢",slug:"å¼ºå¶è½¬æ¢",normalizedTitle:"å¼ºå¶è½¬æ¢",charIndex:1266},{level:2,title:"è£ç®±åæç®±",slug:"è£ç®±åæç®±",normalizedTitle:"è£ç®±åæç®±",charIndex:2090},{level:3,title:"åè£ç±»ãè£ç®±ãæç®±",slug:"åè£ç±»ãè£ç®±ãæç®±",normalizedTitle:"åè£ç±»ãè£ç®±ãæç®±",charIndex:2100},{level:3,title:"èªå¨è£ç®±ãèªå¨æç®±",slug:"èªå¨è£ç®±ãèªå¨æç®±",normalizedTitle:"èªå¨è£ç®±ãèªå¨æç®±",charIndex:2520},{level:3,title:"è£ç®±ãæç®±çåºç¨åæ³¨æç¹",slug:"è£ç®±ãæç®±çåºç¨åæ³¨æç¹",normalizedTitle:"è£ç®±ãæç®±çåºç¨åæ³¨æç¹",charIndex:2952},{level:4,title:"è£ç®±ãæç®±åºç¨åºæ¯",slug:"è£ç®±ãæç®±åºç¨åºæ¯",normalizedTitle:"è£ç®±ãæç®±åºç¨åºæ¯",charIndex:2968},{level:4,title:"è£ç®±ãæç®±åºç¨æ³¨æç¹",slug:"è£ç®±ãæç®±åºç¨æ³¨æç¹",normalizedTitle:"è£ç®±ãæç®±åºç¨æ³¨æç¹",charIndex:5123},{level:2,title:"å¤ç­é®é¢",slug:"å¤ç­é®é¢",normalizedTitle:"å¤ç­é®é¢",charIndex:4202},{level:3,title:"åè£ç±»çå¤ç­",slug:"åè£ç±»çå¤ç­",normalizedTitle:"åè£ç±»çå¤ç­",charIndex:5495},{level:3,title:"String çå¤ç­",slug:"string-çå¤ç­",normalizedTitle:"string çå¤ç­",charIndex:8128},{level:3,title:"å®ç° equals",slug:"å®ç°-equals",normalizedTitle:"å®ç° equals",charIndex:10005},{level:3,title:"hashCode å equals è¦éå¯¹å®ç°",slug:"hashcode-å-equals-è¦éå¯¹å®ç°",normalizedTitle:"hashcode å equals è¦éå¯¹å®ç°",charIndex:10759},{level:3,title:"compareTo å equals çé»è¾ä¸è´æ§",slug:"compareto-å-equals-çé»è¾ä¸è´æ§",normalizedTitle:"compareto å equals çé»è¾ä¸è´æ§",charIndex:11281},{level:3,title:"å°å¿ Lombok çæä»£ç çâåâ",slug:"å°å¿-lombok-çæä»£ç ç-å",normalizedTitle:"å°å¿ lombok çæä»£ç çâåâ",charIndex:12633},{level:2,title:"æ°å¼è®¡ç®",slug:"æ°å¼è®¡ç®",normalizedTitle:"æ°å¼è®¡ç®",charIndex:12819},{level:3,title:"æµ®ç¹æ°è®¡ç®é®é¢",slug:"æµ®ç¹æ°è®¡ç®é®é¢",normalizedTitle:"æµ®ç¹æ°è®¡ç®é®é¢",charIndex:12828},{level:3,title:"æµ®ç¹æ°ç²¾åº¦åæ ¼å¼å",slug:"æµ®ç¹æ°ç²¾åº¦åæ ¼å¼å",normalizedTitle:"æµ®ç¹æ°ç²¾åº¦åæ ¼å¼å",charIndex:14202},{level:3,title:"BigDecimal å¤ç­é®é¢",slug:"bigdecimal-å¤ç­é®é¢",normalizedTitle:"bigdecimal å¤ç­é®é¢",charIndex:15068},{level:3,title:"æ°å¼æº¢åº",slug:"æ°å¼æº¢åº",normalizedTitle:"æ°å¼æº¢åº",charIndex:16380},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:17151}],headersStr:"æ°æ®ç±»ååç±» å¼ç±»å å¼ç±»ååå¼ç¨ç±»åçåºå« æ°æ®è½¬æ¢ èªå¨è½¬æ¢ å¼ºå¶è½¬æ¢ è£ç®±åæç®± åè£ç±»ãè£ç®±ãæç®± èªå¨è£ç®±ãèªå¨æç®± è£ç®±ãæç®±çåºç¨åæ³¨æç¹ è£ç®±ãæç®±åºç¨åºæ¯ è£ç®±ãæç®±åºç¨æ³¨æç¹ å¤ç­é®é¢ åè£ç±»çå¤ç­ String çå¤ç­ å®ç° equals hashCode å equals è¦éå¯¹å®ç° compareTo å equals çé»è¾ä¸è´æ§ å°å¿ Lombok çæä»£ç çâåâ æ°å¼è®¡ç® æµ®ç¹æ°è®¡ç®é®é¢ æµ®ç¹æ°ç²¾åº¦åæ ¼å¼å BigDecimal å¤ç­é®é¢ æ°å¼æº¢åº åèèµæ",content:'# æ·±å¥çè§£ Java åºæ¬æ°æ®ç±»å\n\n\n\n\n# æ°æ®ç±»ååç±»\n\nJava ä¸­çæ°æ®ç±»åæä¸¤ç±»ï¼\n\n * å¼ç±»åï¼åå«åç½®æ°æ®ç±»åï¼åºæ¬æ°æ®ç±»åï¼\n * å¼ç¨ç±»åï¼é¤å¼ç±»åä»¥å¤ï¼é½æ¯å¼ç¨ç±»åï¼åæ¬ Stringãæ°ç»ï¼\n\n\n# å¼ç±»å\n\nJava è¯­è¨æä¾äº 8 ç§åºæ¬ç±»åï¼å¤§è´åä¸º 4 ç±»\n\nåºæ¬æ°æ®ç±»å    åç±»    æ¯ç¹æ°    é»è®¤å¼        åå¼èå´                            è¯´æ\nboolean   å¸å°å   8 ä½    false      {false, true}                   \nchar      å­ç¬¦å   16 ä½   \'\\u0000\'   [0, $2^{16} - 1$]               å­å¨ Unicode ç ï¼ç¨åå¼å·èµå¼\nbyte      æ´æ°å   8 ä½    0          [-$2^7$, $2^7 - 1$]             \nshort     æ´æ°å   16 ä½   0          [-$2^{15}$, $2^{15} - 1$]       \nint       æ´æ°å   32 ä½   0          [-$2^{31}$, $2^{31} - 1$]       \nlong      æ´æ°å   64 ä½   0L         [-$2^{63}$, $2^{63} - 1$]       èµå¼æ¶ä¸è¬å¨æ°å­åå ä¸ l æ L\nfloat     æµ®ç¹å   32 ä½   +0.0F      [$2^{-149}$, $2^{128} - 1$]     èµå¼æ¶å¿é¡»å¨æ°å­åå ä¸ f æ F\ndouble    æµ®ç¹å   64 ä½   +0.0D      [$2^{-1074}$, $2^{1024} - 1$]   èµå¼æ¶ä¸è¬å¨æ°å­åå  d æ D\n\nå°½ç®¡åç§æ°æ®ç±»åçé»è®¤å¼çèµ·æ¥ä¸ä¸æ ·ï¼ä½å¨åå­ä¸­é½æ¯ 0ã\n\nå¨è¿äºåºæ¬ç±»åä¸­ï¼boolean å char æ¯å¯äºçæ ç¬¦å·ç±»åã\n\n\n# å¼ç±»ååå¼ç¨ç±»åçåºå«\n\n * ä»æ¦å¿µæ¹é¢æ¥è¯´\n   * åºæ¬ç±»åï¼åéåæåå·ä½çæ°å¼ã\n   * å¼ç¨ç±»åï¼åéåæåå­æ°æ®å¯¹è±¡çåå­å°åã\n * ä»åå­æ¹é¢æ¥è¯´\n   * åºæ¬ç±»åï¼åéå¨å£°æä¹åï¼Java å°±ä¼ç«å»åéç»ä»åå­ç©ºé´ã\n   * å¼ç¨ç±»åï¼å®ä»¥ç¹æ®çæ¹å¼ï¼ç±»ä¼¼ C æéï¼åå¯¹è±¡å®ä½ï¼å·ä½çå¼ï¼ï¼è¿ç±»åéå£°ææ¶ä¸ä¼åéåå­ï¼åªæ¯å­å¨äºä¸ä¸ªåå­å°åã\n * ä»ä½¿ç¨æ¹é¢æ¥è¯´\n   * åºæ¬ç±»åï¼ä½¿ç¨æ¶éè¦èµå·ä½å¼,å¤æ­æ¶ä½¿ç¨ == å·ã\n   * å¼ç¨ç±»åï¼ä½¿ç¨æ¶å¯ä»¥èµ nullï¼å¤æ­æ¶ä½¿ç¨ equals æ¹æ³ã\n\n> ð æ©å±éè¯»ï¼Java åºæ¬æ°æ®ç±»ååå¼ç¨ç±»å\n> \n> è¿ç¯æç« å¯¹äºåºæ¬æ°æ®ç±»ååå¼ç¨ç±»åçåå­å­å¨è®²è¿°æ¯è¾çå¨ã\n\n\n# æ°æ®è½¬æ¢\n\nJava ä¸­ï¼æ°æ®ç±»åè½¬æ¢æä¸¤ç§æ¹å¼ï¼\n\n * èªå¨è½¬æ¢\n * å¼ºå¶è½¬æ¢\n\n\n# èªå¨è½¬æ¢\n\nä¸è¬æåµä¸ï¼å®ä¹äºææ°æ®ç±»åçåéï¼å°±ä¸è½åéæè½¬æ¢ãä½æ¯ JAVA åè®¸ç¨æ·å¯¹åºæ¬ç±»ååæéåº¦çç±»åè½¬æ¢ã\n\nå¦æç¬¦åä»¥ä¸æ¡ä»¶ï¼å JAVA å°ä¼èªå¨åç±»åè½¬æ¢ï¼\n\n * ç±å°æ°æ®è½¬æ¢ä¸ºå¤§æ°æ®\n   \n   æ¾èæè§çæ¯ï¼âå°âæ°æ®ç±»åçæ°å¼è¡¨ç¤ºèå´å°äºâå¤§âæ°æ®ç±»åçæ°å¼è¡¨ç¤ºèå´ï¼å³ç²¾åº¦å°äºâå¤§âæ°æ®ç±»åã\n   \n   æä»¥ï¼å¦æâå¤§âæ°æ®åâå°âæ°æ®è½¬æ¢ï¼ä¼ä¸¢å¤±æ°æ®ç²¾åº¦ãæ¯å¦ï¼long è½¬ä¸º intï¼åè¶åº int è¡¨ç¤ºèå´çæ°æ®å°ä¼ä¸¢å¤±ï¼å¯¼è´ç»æçä¸ç¡®å®æ§ã\n   \n   åä¹ï¼âå°âæ°æ®åâå¤§âæ°æ®è½¬æ¢ï¼åä¸ä¼å­å¨æ°æ®ä¸¢å¤±æåµãç±äºè¿ä¸ªåå ï¼è¿ç§ç±»åè½¬æ¢ä¹ç§°ä¸ºæ©å¤§è½¬æ¢ã\n   \n   è¿äºç±»åç±âå°âå°âå¤§âåå«ä¸ºï¼(byteï¼shortï¼char) < int < long < float < doubleã\n   \n   è¿éæä»¬æè¯´çâå¤§âä¸âå°âï¼å¹¶ä¸æ¯æå ç¨å­èçå¤å°ï¼èæ¯æè¡¨ç¤ºå¼çèå´çå¤§å°ã\n\n * è½¬æ¢ååçæ°æ®ç±»åè¦å¼å®¹\n   \n   ç±äº boolean ç±»ååªè½å­æ¾ true æ falseï¼è¿ä¸æ´æ°æå­ç¬¦æ¯ä¸å¼å®¹çï¼å æ­¤ä¸å¯ä»¥åç±»åè½¬æ¢ã\n\n * æ´åç±»ååæµ®ç¹åè¿è¡è®¡ç®åï¼ç»æä¼è½¬ä¸ºæµ®ç¹ç±»å\n\nç¤ºä¾ï¼\n\nlong x = 30;\nfloat y = 14.3f;\nSystem.out.println("x/y = " + x/y);\n\n\nè¾åºï¼\n\nx/y = 1.9607843\n\n\nå¯è§ long è½ç¶ç²¾åº¦å¤§äº float ç±»åï¼ä½æ¯ç»æä¸ºæµ®ç¹æ°ç±»åã\n\n\n# å¼ºå¶è½¬æ¢\n\nå¨ä¸ç¬¦åèªå¨è½¬æ¢æ¡ä»¶æ¶æèæ ¹æ®ç¨æ·çéè¦ï¼å¯ä»¥å¯¹æ°æ®ç±»ååå¼ºå¶çè½¬æ¢ã\n\nå¼ºå¶è½¬æ¢ä½¿ç¨æ¬å· () ã\n\nå¼ç¨ç±»åä¹å¯ä»¥ä½¿ç¨å¼ºå¶è½¬æ¢ã\n\nç¤ºä¾ï¼\n\nfloat f = 25.5f;\nint x = (int)f;\nSystem.out.println("x = " + x);\n\n\n\n# è£ç®±åæç®±\n\n\n# åè£ç±»ãè£ç®±ãæç®±\n\nJava ä¸­ä¸ºæ¯ä¸ç§åºæ¬æ°æ®ç±»åæä¾äºç¸åºçåè£ç±»ï¼å¦ä¸ï¼\n\nByte <-> byte\nShort <-> short\nInteger <-> int\nLong <-> long\nFloat <-> float\nDouble <-> double\nCharacter <-> char\nBoolean <-> boolean\n\n\nå¼å¥åè£ç±»çç®çå°±æ¯ï¼æä¾ä¸ç§æºå¶ï¼ä½¿å¾åºæ¬æ°æ®ç±»åå¯ä»¥ä¸å¼ç¨ç±»åäºç¸è½¬æ¢ã\n\nåºæ¬æ°æ®ç±»åä¸åè£ç±»çè½¬æ¢è¢«ç§°ä¸ºè£ç®±åæç®±ã\n\n * è£ç®±ï¼boxingï¼æ¯å°å¼ç±»åè½¬æ¢ä¸ºå¼ç¨ç±»åãä¾å¦ï¼int è½¬ Integer\n   * è£ç®±è¿ç¨æ¯éè¿è°ç¨åè£ç±»ç valueOf æ¹æ³å®ç°çã\n * æç®±ï¼unboxingï¼æ¯å°å¼ç¨ç±»åè½¬æ¢ä¸ºå¼ç±»åãä¾å¦ï¼Integer è½¬ int\n   * æç®±è¿ç¨æ¯éè¿è°ç¨åè£ç±»ç xxxValue æ¹æ³å®ç°çãï¼xxx ä»£è¡¨å¯¹åºçåºæ¬æ°æ®ç±»åï¼ã\n\n\n# èªå¨è£ç®±ãèªå¨æç®±\n\nåºæ¬æ°æ®ï¼Primitiveï¼åçèªå¨è£ç®±ï¼boxingï¼æç®±ï¼unboxingï¼èª JDK 5 å¼å§æä¾çåè½ã\n\nèªå¨è£ç®±ä¸æç®±çæºå¶å¯ä»¥è®©æä»¬å¨ Java çåéèµå¼æèæ¯æ¹æ³è°ç¨ç­æåµä¸ä½¿ç¨åå§ç±»åæèå¯¹è±¡ç±»åæ´å ç®åç´æ¥ã å ä¸ºèªå¨è£ç®±ä¼éå¼å°åå»ºå¯¹è±¡ï¼å¦æå¨ä¸ä¸ªå¾ªç¯ä½ä¸­ï¼ä¼åå»ºæ ç¨çä¸­é´å¯¹è±¡ï¼è¿æ ·ä¼å¢å  GC ååï¼æä½ç¨åºçæ§è½ãæä»¥å¨åå¾ªç¯æ¶ä¸å®è¦æ³¨æä»£ç ï¼é¿åå¼å¥ä¸å¿è¦çèªå¨è£ç®±æä½ã\n\nJDK 5 ä¹åçå½¢å¼ï¼\n\nInteger i1 = new Integer(10); // éèªå¨è£ç®±\n\n\nJDK 5 ä¹åï¼\n\nInteger i2 = 10; // èªå¨è£ç®±\n\n\nJava å¯¹äºèªå¨è£ç®±åæç®±çè®¾è®¡ï¼ä¾èµäºä¸ç§å«åäº«åæ¨¡å¼çè®¾è®¡æ¨¡å¼ï¼æå´è¶£çæåå¯ä»¥å»äºè§£ä¸ä¸æºç ï¼è¿éä¸å¯¹è®¾è®¡æ¨¡å¼å±å¼è¯¦è¿°ï¼ã\n\n> ð æ©å±éè¯»ï¼æ·±å¥åæ Java ä¸­çè£ç®±åæç®±\n> \n> ç»åç¤ºä¾ï¼ä¸æ­¥æ­¥éè¿°è£ç®±åæç®±åçã\n\n\n# è£ç®±ãæç®±çåºç¨åæ³¨æç¹\n\n# è£ç®±ãæç®±åºç¨åºæ¯\n\n * ä¸ç§ææ®éçåºæ¯æ¯ï¼è°ç¨ä¸ä¸ªå«ç±»åä¸º Object åæ°çæ¹æ³ï¼è¯¥ Object å¯æ¯æä»»æç±»åï¼å ä¸º Object æ¯ææç±»çç¶ç±»ï¼ï¼ä»¥ä¾¿éç¨ãå½ä½ éè¦å°ä¸ä¸ªå¼ç±»åï¼å¦ intï¼ä¼ å¥æ¶ï¼éè¦ä½¿ç¨ Integer è£ç®±ã\n * å¦ä¸ç§ç¨æ³æ¯ï¼ä¸ä¸ªéæ³åçå®¹å¨ï¼åæ ·æ¯ä¸ºäºä¿è¯éç¨ï¼èå°åç´ ç±»åå®ä¹ä¸º Objectãäºæ¯ï¼è¦å°å¼ç±»åæ°æ®å å¥å®¹å¨æ¶ï¼éè¦è£ç®±ã\n * å½ == è¿ç®ç¬¦çä¸¤ä¸ªæä½ï¼ä¸ä¸ªæä½æ°æ¯åè£ç±»ï¼å¦ä¸ä¸ªæä½æ°æ¯è¡¨è¾¾å¼ï¼å³åå«ç®æ¯è¿ç®ï¼åæ¯è¾çæ¯æ°å¼ï¼å³ä¼è§¦åèªå¨æç®±çè¿ç¨ï¼ã\n\nãç¤ºä¾ãè£ç®±ãæç®±ç¤ºä¾\n\nInteger i1 = 10; // èªå¨è£ç®±\nInteger i2 = new Integer(10); // éèªå¨è£ç®±\nInteger i3 = Integer.valueOf(10); // éèªå¨è£ç®±\nint i4 = new Integer(10); // èªå¨æç®±\nint i5 = i2.intValue(); // éèªå¨æç®±\nSystem.out.println("i1 = [" + i1 + "]");\nSystem.out.println("i2 = [" + i2 + "]");\nSystem.out.println("i3 = [" + i3 + "]");\nSystem.out.println("i4 = [" + i4 + "]");\nSystem.out.println("i5 = [" + i5 + "]");\nSystem.out.println("i1 == i2 is [" + (i1 == i2) + "]");\nSystem.out.println("i1 == i4 is [" + (i1 == i4) + "]"); // èªå¨æç®±\n// Output:\n// i1 = [10]\n// i2 = [10]\n// i3 = [10]\n// i4 = [10]\n// i5 = [10]\n// i1 == i2 is [false]\n// i1 == i4 is [true]\n\n\nãè¯´æã\n\nä¸é¢çä¾å­ï¼è½ç¶ç®åï¼ä½å´éèäºèªå¨è£ç®±ãæç®±åéèªå¨è£ç®±ãæç®±çåºç¨ãä»ä¾å­ä¸­å¯ä»¥çå°ï¼ææææåéé½åå§åä¸ºæ°å¼ 10 äºï¼ä½ä¸ºä½ä¼åºç° i1 == i2 is [false è i1 == i4 is [true] ï¼\n\nåå å¨äºï¼\n\n * i1ãi2 é½æ¯åè£ç±»ï¼ä½¿ç¨ == æ¶ï¼Java å°å®ä»¬å½åä¸¤ä¸ªå¯¹è±¡ï¼èéä¸¤ä¸ª int å¼æ¥æ¯è¾ï¼æä»¥ä¸¤ä¸ªå¯¹è±¡èªç¶æ¯ä¸ç¸ç­çãæ­£ç¡®çæ¯è¾æä½åºè¯¥ä½¿ç¨ equals æ¹æ³ã\n * i1 æ¯åè£ç±»ï¼i4 æ¯åºç¡æ°æ®ç±»åï¼ä½¿ç¨ == æ¶ï¼Java ä¼å°ä¸¤ä¸ª i1 è¿ä¸ªåè£ç±»å¯¹è±¡èªå¨æç®±ä¸ºä¸ä¸ª int å¼ï¼åä»£å¥å° == è¿ç®è¡¨è¾¾å¼ä¸­è®¡ç®ï¼æç»ï¼ç¸å½äºä¸¤ä¸ª int è¿è¡æ¯è¾ï¼ç±äºå¼ç¸åï¼æä»¥ç»æç¸ç­ã\n\nãç¤ºä¾ãåè£ç±»å¤ç­é®é¢\n\nInteger a = 127; //Integer.valueOf(127)\nInteger b = 127; //Integer.valueOf(127)\nlog.info("\\nInteger a = 127;\\nInteger b = 127;\\na == b ? {}", a == b);    // true\n\nInteger c = 128; //Integer.valueOf(128)\nInteger d = 128; //Integer.valueOf(128)\nlog.info("\\nInteger c = 128;\\nInteger d = 128;\\nc == d ? {}", c == d);   //false\n//è®¾ç½®-XX:AutoBoxCacheMax=1000åè¯è¯\n\nInteger e = 127; //Integer.valueOf(127)\nInteger f = new Integer(127); //new instance\nlog.info("\\nInteger e = 127;\\nInteger f = new Integer(127);\\ne == f ? {}", e == f);   //false\n\nInteger g = new Integer(127); //new instance\nInteger h = new Integer(127); //new instance\nlog.info("\\nInteger g = new Integer(127);\\nInteger h = new Integer(127);\\ng == h ? {}", g == h);  //false\n\nInteger i = 128; //unbox\nint j = 128;\nlog.info("\\nInteger i = 128;\\nint j = 128;\\ni == j ? {}", i == j); //true\n\n\néè¿è¿è¡ç»æå¯ä»¥çå°ï¼è½ç¶çèµ·æ¥æ°¸è¿æ¯å¨å¯¹ 127 å 127ã128 å 128 å¤ç­ï¼ä½ == å´å¹¶éæ»æ¯è¿å trueã\n\n# è£ç®±ãæç®±åºç¨æ³¨æç¹\n\n 1. è£ç®±æä½ä¼åå»ºå¯¹è±¡ï¼é¢ç¹çè£ç®±æä½ä¼é æä¸å¿è¦çåå­æ¶èï¼å½±åæ§è½ãæä»¥åºè¯¥å°½éé¿åè£ç®±ã\n 2. åºç¡æ°æ®ç±»åçæ¯è¾æä½ä½¿ç¨ ==ï¼åè£ç±»çæ¯è¾æä½ä½¿ç¨ equals æ¹æ³ã\n\n\n# å¤ç­é®é¢\n\nJava ä¸­ï¼éå¸¸ä½¿ç¨ equals æ == è¿è¡å¤ç­æä½ãequals æ¯æ¹æ³è == æ¯æä½ç¬¦ãæ­¤å¤ï¼äºèä½¿ç¨ä¹æ¯æåºå«çï¼\n\n * å¯¹åºæ¬ç±»åï¼æ¯å¦ intãlongï¼è¿è¡å¤ç­ï¼åªè½ä½¿ç¨ ==ï¼æ¯è¾çæ¯å­é¢å¼ãå ä¸ºåºæ¬ç±»åçå¼å°±æ¯å¶æ°å¼ã\n * å¯¹å¼ç¨ç±»åï¼æ¯å¦ IntegerãLong å Stringï¼è¿è¡å¤ç­ï¼éè¦ä½¿ç¨ equals è¿è¡åå®¹å¤ç­ãå ä¸ºå¼ç¨ç±»åçç´æ¥å¼æ¯æéï¼ä½¿ç¨ == çè¯ï¼æ¯è¾çæ¯æéï¼ä¹å°±æ¯ä¸¤ä¸ªå¯¹è±¡å¨åå­ä¸­çå°åï¼å³æ¯è¾å®ä»¬æ¯ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼èä¸æ¯æ¯è¾å¯¹è±¡çåå®¹ã\n\n\n# åè£ç±»çå¤ç­\n\næä»¬éè¿ä¸ä¸ªç¤ºä¾æ¥æ·±å¥ç ç©¶ä¸ä¸å¤ç­é®é¢ã\n\nãç¤ºä¾ãåè£ç±»çå¤ç­\n\nInteger a = 127; //Integer.valueOf(127)\nInteger b = 127; //Integer.valueOf(127)\nlog.info("\\nInteger a = 127;\\nInteger b = 127;\\na == b ? {}", a == b);    // true\n\nInteger c = 128; //Integer.valueOf(128)\nInteger d = 128; //Integer.valueOf(128)\nlog.info("\\nInteger c = 128;\\nInteger d = 128;\\nc == d ? {}", c == d);   //false\n//è®¾ç½®-XX:AutoBoxCacheMax=1000åè¯è¯\n\nInteger e = 127; //Integer.valueOf(127)\nInteger f = new Integer(127); //new instance\nlog.info("\\nInteger e = 127;\\nInteger f = new Integer(127);\\ne == f ? {}", e == f);   //false\n\nInteger g = new Integer(127); //new instance\nInteger h = new Integer(127); //new instance\nlog.info("\\nInteger g = new Integer(127);\\nInteger h = new Integer(127);\\ng == h ? {}", g == h);  //false\n\nInteger i = 128; //unbox\nint j = 128;\nlog.info("\\nInteger i = 128;\\nint j = 128;\\ni == j ? {}", i == j); //true\n\n\nç¬¬ä¸ä¸ªæ¡ä¾ä¸­ï¼ç¼è¯å¨ä¼æ Integer a = 127 è½¬æ¢ä¸º Integer.valueOf(127)ãæ¥çæºç å¯ä»¥åç°ï¼è¿ä¸ªè½¬æ¢å¨åé¨å¶å®åäºç¼å­ï¼ä½¿å¾ä¸¤ä¸ª Integer æååä¸ä¸ªå¯¹è±¡ï¼æä»¥ == è¿å trueã\n\npublic static Integer valueOf(int i) {\n    if (i >= IntegerCache.low && i <= IntegerCache.high)\n        return IntegerCache.cache[i + (-IntegerCache.low)];\n    return new Integer(i);\n}\n\n\nç¬¬äºä¸ªæ¡ä¾ä¸­ï¼ä¹æä»¥åæ ·çä»£ç  128 å°±è¿å false çåå æ¯ï¼é»è®¤æåµä¸ä¼ç¼å­[-128,127]çæ°å¼ï¼è 128 å¤äºè¿ä¸ªåºé´ä¹å¤ãè®¾ç½® JVM åæ°å ä¸ -XX:AutoBoxCacheMax=1000 åè¯è¯ï¼æ¯ä¸æ¯å°±è¿å true äºå¢ï¼\n\nprivate static class IntegerCache {\n    static final int low = -128;\n    static final int high;\n    static final Integer cache[];\n\n    static {\n        // high value may be configured by property\n        int h = 127;\n        String integerCacheHighPropValue =\n            sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");\n        if (integerCacheHighPropValue != null) {\n            try {\n                int i = parseInt(integerCacheHighPropValue);\n                i = Math.max(i, 127);\n                // Maximum array size is Integer.MAX_VALUE\n                h = Math.min(i, Integer.MAX_VALUE - (-low) -1);\n            } catch( NumberFormatException nfe) {\n                // If the property cannot be parsed into an int, ignore it.\n            }\n        }\n        high = h;\n\n        cache = new Integer[(high - low) + 1];\n        int j = low;\n        for(int k = 0; k < cache.length; k++)\n            cache[k] = new Integer(j++);\n\n        // range [-128, 127] must be interned (JLS7 5.1.7)\n        assert IntegerCache.high >= 127;\n    }\n\n    private IntegerCache() {}\n}\n\n\nç¬¬ä¸åç¬¬åä¸ªæ¡ä¾ä¸­ï¼New åºæ¥ç Integer å§ç»æ¯ä¸èµ°ç¼å­çæ°å¯¹è±¡ãæ¯è¾ä¸¤ä¸ªæ°å¯¹è±¡ï¼æèæ¯è¾ä¸ä¸ªæ°å¯¹è±¡åä¸ä¸ªæ¥èªç¼å­çå¯¹è±¡ï¼ç»æè¯å®ä¸æ¯ç¸åçå¯¹è±¡ï¼å æ­¤è¿å falseã\n\nç¬¬äºä¸ªæ¡ä¾ä¸­ï¼æä»¬æè£ç®±ç Integer ååºæ¬ç±»å int æ¯è¾ï¼åèä¼åæç®±åæ¯è¾ï¼æ¯è¾çè¯å®æ¯æ°å¼èä¸æ¯å¼ç¨ï¼å æ­¤è¿å trueã\n\n> ãæ»ç»ãç»¼ä¸ï¼æä»¬å¯ä»¥å¾åºç»è®ºï¼åè£ç±»éè¦ä½¿ç¨ equals è¿è¡åå®¹å¤ç­ï¼èä¸è½ä½¿ç¨ ==ã\n\n\n# String çå¤ç­\n\nString a = "1";\nString b = "1";\nlog.info("\\nString a = \\"1\\";\\nString b = \\"1\\";\\na == b ? {}", a == b); //true\n\nString c = new String("2");\nString d = new String("2");\nlog.info("\\nString c = new String(\\"2\\");\\nString d = new String(\\"2\\");\\nc == d ? {}", c == d); //false\n\nString e = new String("3").intern();\nString f = new String("3").intern();\nlog.info("\\nString e = new String(\\"3\\").intern();\\nString f = new String(\\"3\\").intern();\\ne == f ? {}", e == f); //true\n\nString g = new String("4");\nString h = new String("4");\nlog.info("\\nString g = new String(\\"4\\");\\nString h = new String(\\"4\\");\\ng == h ? {}", g.equals(h)); //true\n\n\nå¨ JVM ä¸­ï¼å½ä»£ç ä¸­åºç°åå¼å·å½¢å¼åå»ºå­ç¬¦ä¸²å¯¹è±¡æ¶ï¼JVM ä¼åå¯¹è¿ä¸ªå­ç¬¦ä¸²è¿è¡æ£æ¥ï¼å¦æå­ç¬¦ä¸²å¸¸éæ± ä¸­å­å¨ç¸ååå®¹çå­ç¬¦ä¸²å¯¹è±¡çå¼ç¨ï¼åå°è¿ä¸ªå¼ç¨è¿åï¼å¦åï¼åå»ºæ°çå­ç¬¦ä¸²å¯¹è±¡ï¼ç¶åå°è¿ä¸ªå¼ç¨æ¾å¥å­ç¬¦ä¸²å¸¸éæ± ï¼å¹¶è¿åè¯¥å¼ç¨ãè¿ç§æºå¶ï¼å°±æ¯å­ç¬¦ä¸²é©»çææ± åã\n\nç¬¬ä¸ä¸ªæ¡ä¾è¿å trueï¼å ä¸º Java çå­ç¬¦ä¸²é©»çæºå¶ï¼ç´æ¥ä½¿ç¨åå¼å·å£°æåºæ¥çä¸¤ä¸ª String å¯¹è±¡æåå¸¸éæ± ä¸­çç¸åå­ç¬¦ä¸²ã\n\nç¬¬äºä¸ªæ¡ä¾ï¼new åºæ¥çä¸¤ä¸ª String æ¯ä¸åå¯¹è±¡ï¼å¼ç¨å½ç¶ä¸åï¼æä»¥å¾å° false çç»æã\n\nç¬¬ä¸ä¸ªæ¡ä¾ï¼ä½¿ç¨ String æä¾ç intern æ¹æ³ä¹ä¼èµ°å¸¸éæ± æºå¶ï¼æä»¥åæ ·è½å¾å° trueã\n\nç¬¬åä¸ªæ¡ä¾ï¼éè¿ equals å¯¹å¼åå®¹å¤ç­ï¼æ¯æ­£ç¡®çå¤çæ¹å¼ï¼å½ç¶ä¼å¾å° trueã\n\nè½ç¶ä½¿ç¨ new å£°æçå­ç¬¦ä¸²è°ç¨ intern æ¹æ³ï¼ä¹å¯ä»¥è®©å­ç¬¦ä¸²è¿è¡é©»çï¼ä½å¨ä¸å¡ä»£ç ä¸­æ»¥ç¨ internï¼å¯è½ä¼äº§çæ§è½é®é¢ã\n\nãç¤ºä¾ãString#intern æ§è½æµè¯\n\n//-XX:+PrintStringTableStatistics\n//-XX:StringTableSize=10000000\nList<String> list = new ArrayList<>();\nlong begin = System.currentTimeMillis();\nlist = IntStream.rangeClosed(1, 10000000)\n    .mapToObj(i -> String.valueOf(i).intern())\n    .collect(Collectors.toList());\nSystem.out.println("size:" + list.size());\nSystem.out.println("time:" + (System.currentTimeMillis() - begin));\n\n\nä¸é¢çç¤ºä¾æ§è¡æ¶é´ä¼æ¯è¾é¿ãåå å¨äºï¼å­ç¬¦ä¸²å¸¸éæ± æ¯ä¸ä¸ªåºå®å®¹éç Mapãå¦æå®¹éå¤ªå°ï¼Number of buckets=60013ï¼ãå­ç¬¦ä¸²å¤ªå¤ï¼1000 ä¸ä¸ªå­ç¬¦ä¸²ï¼ï¼é£ä¹æ¯ä¸ä¸ªæ¡¶ä¸­çå­ç¬¦ä¸²æ°éä¼éå¸¸å¤ï¼æä»¥æç´¢èµ·æ¥å°±å¾æ¢ãè¾åºç»æä¸­ç Average bucket size=167ï¼ä»£è¡¨äº Map ä¸­æ¡¶çå¹³åé¿åº¦æ¯ 167ã\n\nè§£å³æ¹æ³æ¯ï¼è®¾ç½® JVM åæ° -XX:StringTableSize=10000000ï¼æå®æ´å¤çæ¡¶ã\n\nä¸ºäºæ¹ä¾¿è§å¯ï¼å¯ä»¥å¨å¯å¨ç¨åºæ¶è®¾ç½® JVM åæ° -XX:+PrintStringTableStatisticï¼ç¨åºéåºæ¶å¯ä»¥æå°åºå­ç¬¦ä¸²å¸¸éè¡¨çç»è®¡ä¿¡æ¯ã\n\næ§è¡ç»ææ¯ä¸è®¾ç½® -XX:StringTableSize è¦å¿«å¾å¤ã\n\n> ãæ»ç»ãæ²¡äºå«è½»æç¨ internï¼å¦æè¦ç¨ä¸å®è¦æ³¨ææ§å¶é©»ççå­ç¬¦ä¸²çæ°éï¼å¹¶çæå¸¸éè¡¨çåé¡¹ææ ã\n\n\n# å®ç° equals\n\nå¦æçè¿ Object ç±»æºç ï¼ä½ å¯è½å°±ç¥éï¼equals çå®ç°å¶å®æ¯æ¯è¾å¯¹è±¡å¼ç¨\n\npublic boolean equals(Object obj) {\n    return (this == obj);\n}\n\n\nä¹æä»¥ Integer æ String è½éè¿ equals å®ç°åå®¹å¤ç­ï¼æ¯å ä¸ºå®ä»¬é½è¦åäºè¿ä¸ªæ¹æ³ã\n\nå¯¹äºèªå®ä¹ç±»åï¼å¦æä¸è¦å equals çè¯ï¼é»è®¤å°±æ¯ä½¿ç¨ Object åºç±»çæå¼ç¨çæ¯è¾æ¹å¼ã\n\nå®ç°ä¸ä¸ªæ´å¥½ç equals åºè¯¥æ³¨æçç¹ï¼\n\n * èèå°æ§è½ï¼å¯ä»¥åè¿è¡æéå¤ç­ï¼å¦æå¯¹è±¡æ¯åä¸ä¸ªé£ä¹ç´æ¥è¿å trueï¼\n * éè¦å¯¹å¦ä¸æ¹è¿è¡å¤ç©ºï¼ç©ºå¯¹è±¡åèªèº«è¿è¡æ¯è¾ï¼ç»æä¸å®æ¯ fasleï¼\n * éè¦å¤æ­ä¸¤ä¸ªå¯¹è±¡çç±»åï¼å¦æç±»åé½ä¸åï¼é£ä¹ç´æ¥è¿å falseï¼\n * ç¡®ä¿ç±»åç¸åçæåµä¸åè¿è¡ç±»åå¼ºå¶è½¬æ¢ï¼ç¶åéä¸å¤æ­ææå­æ®µã\n\nãç¤ºä¾ãèªå®ä¹ equals ç¤ºä¾\n\nèªå®ä¹ç±»ï¼\n\nclass Point {\n    private final int x;\n    private final int y;\n    private final String desc;\n}\n\n\nèªå®ä¹ equalsï¼\n\n@Override\npublic boolean equals(Object o) {\n    if (this == o) return true;\n    if (o == null || getClass() != o.getClass()) return false;\n    Point that = (Point) o;\n    return x == that.x && y == that.y;\n}\n\n\n\n# hashCode å equals è¦éå¯¹å®ç°\n\nPoint p1 = new Point(1, 2, "a");\nPoint p2 = new Point(1, 2, "b");\n\nHashSet<PointWrong> points = new HashSet<>();\npoints.add(p1);\nlog.info("points.contains(p2) ? {}", points.contains(p2));\n\n\næç§æ¹è¿åç equals æ¹æ³ï¼è¿ 2 ä¸ªå¯¹è±¡å¯ä»¥è®¤ä¸ºæ¯åä¸ä¸ªï¼Set ä¸­å·²ç»å­å¨äº p1 å°±åºè¯¥åå« p2ï¼ä½ç»æå´æ¯ falseã\n\nåºç°è¿ä¸ª Bug çåå æ¯ï¼æ£åè¡¨éè¦ä½¿ç¨ hashCode æ¥å®ä½åç´ æ¾å°åªä¸ªæ¡¶ãå¦æèªå®ä¹å¯¹è±¡æ²¡æå®ç°èªå®ä¹ç hashCode æ¹æ³ï¼å°±ä¼ä½¿ç¨ Object è¶ç±»çé»è®¤å®ç°ï¼å¾å°çä¸¤ä¸ª hashCode æ¯ä¸åçï¼å¯¼è´æ æ³æ»¡è¶³éæ±ã\n\nè¦èªå®ä¹ hashCodeï¼æä»¬å¯ä»¥ç´æ¥ä½¿ç¨ Objects.hash æ¹æ³æ¥å®ç°ã\n\n@Override\npublic int hashCode() {\n    return Objects.hash(x, y);\n}\n\n\n\n# compareTo å equals çé»è¾ä¸è´æ§\n\nãç¤ºä¾ãèªå®ä¹ compareTo åºéç¤ºä¾\n\n@Data\n@AllArgsConstructor\nstatic class Student implements Comparable<Student> {\n\n    private int id;\n    private String name;\n\n    @Override\n    public int compareTo(Student other) {\n        int result = Integer.compare(other.id, id);\n        if (result == 0) { log.info("this {} == other {}", this, other); }\n        return result;\n    }\n\n}\n\n\nè°ç¨ï¼\n\nList<Student> list = new ArrayList<>();\nlist.add(new Student(1, "zhang"));\nlist.add(new Student(2, "wang"));\nStudent student = new Student(2, "li");\n\nlog.info("ArrayList.indexOf");\nint index1 = list.indexOf(student);\nCollections.sort(list);\nlog.info("Collections.binarySearch");\nint index2 = Collections.binarySearch(list, student);\n\nlog.info("index1 = " + index1);\nlog.info("index2 = " + index2);\n\n\nbinarySearch æ¹æ³åé¨è°ç¨äºåç´ ç compareTo æ¹æ³è¿è¡æ¯è¾ï¼\n\n * indexOf çç»ææ²¡é®é¢ï¼åè¡¨ä¸­æç´¢ä¸å° id ä¸º 2ãname æ¯ li çå­¦çï¼\n * binarySearch è¿åäºç´¢å¼ 1ï¼ä»£è¡¨æç´¢å°çç»ææ¯ id ä¸º 2ï¼name æ¯ wang çå­¦çã\n\nä¿®å¤æ¹å¼å¾ç®åï¼ç¡®ä¿ compareTo çæ¯è¾é»è¾å equals çå®ç°ä¸è´å³å¯ã\n\n@Data\n@AllArgsConstructor\nstatic class StudentRight implements Comparable<StudentRight> {\n\n    private int id;\n    private String name;\n\n    @Override\n    public int compareTo(StudentRight other) {\n        return Comparator.comparing(StudentRight::getName)\n            .thenComparingInt(StudentRight::getId)\n            .compare(this, other);\n    }\n\n}\n\n\n\n# å°å¿ Lombok çæä»£ç çâåâ\n\nLombok ç @Data æ³¨è§£ä¼å¸®æä»¬å®ç° equals å hashcode æ¹æ³ï¼ä½æ¯æç»§æ¿å³ç³»æ¶ï¼ Lombok èªå¨çæçæ¹æ³å¯è½å°±ä¸æ¯æä»¬ææçäºã\n\n@EqualsAndHashCode é»è®¤å®ç°æ²¡æä½¿ç¨ç¶ç±»å±æ§ãä¸ºè§£å³è¿ä¸ªé®é¢ï¼æä»¬å¯ä»¥æå¨è®¾ç½® callSuper å¼å³ä¸º trueï¼æ¥è¦çè¿ç§é»è®¤è¡ä¸ºã\n\n\n# æ°å¼è®¡ç®\n\n\n# æµ®ç¹æ°è®¡ç®é®é¢\n\nè®¡ç®æºæ¯ææ°å¼ä¿å­å¨äºåéä¸­ï¼ä¸åç±»åçæ°å¼åéè½ä¿å­çæ°å¼èå´ä¸åï¼å½æ°å¼è¶è¿ç±»åè½è¡¨è¾¾çæ°å¼ä¸éåä¼åçæº¢åºé®é¢ã\n\nSystem.out.println(0.1 + 0.2); // 0.30000000000000004\nSystem.out.println(1.0 - 0.8); // 0.19999999999999996\nSystem.out.println(4.015 * 100); // 401.49999999999994\nSystem.out.println(123.3 / 100); // 1.2329999999999999\ndouble amount1 = 2.15;\ndouble amount2 = 1.10;\nSystem.out.println(amount1 - amount2); // 1.0499999999999998\n\n\nä¸é¢çå ä¸ªç¤ºä¾ï¼è¾åºç»æåæä»¬é¢æçå¾ä¸ä¸æ ·ãä¸ºä»ä¹ä¼æ¯è¿æ ·å¢ï¼\n\nåºç°è¿ç§é®é¢çä¸»è¦åå æ¯ï¼è®¡ç®æºæ¯ä»¥äºè¿å¶å­å¨æ°å¼çï¼æµ®ç¹æ°ä¹ä¸ä¾å¤ãJava éç¨äº IEEE 754 æ åå®ç°æµ®ç¹æ°çè¡¨è¾¾åè¿ç®ï¼ä½ å¯ä»¥éè¿è¿éæ¥çæ°å¼è½¬åä¸ºäºè¿å¶çç»æã\n\næ¯å¦ï¼0.1 çäºè¿å¶è¡¨ç¤ºä¸º 0.0 0011 0011 0011â¦ ï¼0011 æ éå¾ªç¯)ï¼åè½¬æ¢ä¸ºåè¿å¶å°±æ¯ 0.1000000000000000055511151231257827021181583404541015625ãå¯¹äºè®¡ç®æºèè¨ï¼0.1 æ æ³ç²¾ç¡®è¡¨è¾¾ï¼è¿æ¯æµ®ç¹æ°è®¡ç®é æç²¾åº¦æå¤±çæ ¹æºã\n\næµ®ç¹æ°æ æ³ç²¾ç¡®è¡¨è¾¾åè¿ç®çåºæ¯ï¼ä¸å®è¦ä½¿ç¨ BigDecimal ç±»åã\n\nä½¿ç¨ BigDecimal æ¶ï¼æä¸ªç»èè¦æ ¼å¤æ³¨æãè®©æä»¬æ¥çä¸æ®µä»£ç ï¼\n\nSystem.out.println(new BigDecimal(0.1).add(new BigDecimal(0.2)));\n// Output: 0.3000000000000000166533453693773481063544750213623046875\n\nSystem.out.println(new BigDecimal(1.0).subtract(new BigDecimal(0.8)));\n// Output: 0.1999999999999999555910790149937383830547332763671875\n\nSystem.out.println(new BigDecimal(4.015).multiply(new BigDecimal(100)));\n// Output: 401.49999999999996802557689079549163579940795898437500\n\nSystem.out.println(new BigDecimal(123.3).divide(new BigDecimal(100)));\n// Output: 1.232999999999999971578290569595992565155029296875\n\n\nä¸ºä»ä¹è¾åºç»æä»ç¶ä¸ç¬¦åé¢æå¢ï¼\n\nä½¿ç¨ BigDecimal è¡¨ç¤ºåè®¡ç®æµ®ç¹æ°ï¼ä¸å¡å¿ä½¿ç¨å­ç¬¦ä¸²çæé æ¹æ³æ¥åå§å BigDecimalã\n\n\n# æµ®ç¹æ°ç²¾åº¦åæ ¼å¼å\n\næµ®ç¹æ°çå­ç¬¦ä¸²æ ¼å¼åä¹è¦éè¿ BigDecimal è¿è¡ã\n\nprivate static void wrong1() {\n    double num1 = 3.35;\n    float num2 = 3.35f;\n    System.out.println(String.format("%.1f", num1)); // 3.4\n    System.out.println(String.format("%.1f", num2)); // 3.3\n}\n\nprivate static void wrong2() {\n    double num1 = 3.35;\n    float num2 = 3.35f;\n    DecimalFormat format = new DecimalFormat("#.##");\n    format.setRoundingMode(RoundingMode.DOWN);\n    System.out.println(format.format(num1)); // 3.35\n    format.setRoundingMode(RoundingMode.DOWN);\n    System.out.println(format.format(num2)); // 3.34\n}\n\nprivate static void right() {\n    BigDecimal num1 = new BigDecimal("3.35");\n    BigDecimal num2 = num1.setScale(1, BigDecimal.ROUND_DOWN);\n    System.out.println(num2); // 3.3\n    BigDecimal num3 = num1.setScale(1, BigDecimal.ROUND_HALF_UP);\n    System.out.println(num3); // 3.4\n}\n\n\n\n# BigDecimal å¤ç­é®é¢\n\nprivate static void wrong() {\n    System.out.println(new BigDecimal("1.0").equals(new BigDecimal("1")));\n}\n\nprivate static void right() {\n    System.out.println(new BigDecimal("1.0").compareTo(new BigDecimal("1")) == 0);\n}\n\n\nBigDecimal ç equals æ¹æ³çæ³¨éä¸­è¯´æäºåå ï¼equals æ¯è¾çæ¯ BigDecimal ç value å scaleï¼1.0 ç scale æ¯ 1ï¼1 ç scale æ¯ 0ï¼æä»¥ç»æä¸å®æ¯ falseã\n\nå¦ææä»¬å¸æåªæ¯è¾ BigDecimal ç valueï¼å¯ä»¥ä½¿ç¨ compareTo æ¹æ³ã\n\nBigDecimal ç equals å hashCode æ¹æ³ä¼åæ¶èè value å scaleï¼å¦æç»å HashSet æ HashMap ä½¿ç¨çè¯å°±å¯è½ä¼åºç°éº»ç¦ãæ¯å¦ï¼æä»¬æå¼ä¸º 1.0 ç BigDecimal å å¥ HashSetï¼ç¶åå¤æ­å¶æ¯å¦å­å¨å¼ä¸º 1 ç BigDecimalï¼å¾å°çç»ææ¯ falseã\n\nSet<BigDecimal> hashSet1 = new HashSet<>();\nhashSet1.add(new BigDecimal("1.0"));\nSystem.out.println(hashSet1.contains(new BigDecimal("1")));//è¿åfalse\n\n\n\n\nè§£å³åæ³æä¸¤ä¸ªï¼\n\nç¬¬ä¸ä¸ªæ¹æ³æ¯ï¼ä½¿ç¨ TreeSet æ¿æ¢ HashSetãTreeSet ä¸ä½¿ç¨ hashCode æ¹æ³ï¼ä¹ä¸ä½¿ç¨ equals æ¯è¾åç´ ï¼èæ¯ä½¿ç¨ compareTo æ¹æ³ï¼æä»¥ä¸ä¼æé®é¢ã\n\nç¬¬äºä¸ªæ¹æ³æ¯ï¼æ BigDecimal å­å¥ HashSet æ HashMap åï¼åä½¿ç¨ stripTrailingZeros æ¹æ³å»æå°¾é¨çé¶ï¼æ¯è¾çæ¶åä¹å»æå°¾é¨ç 0ï¼ç¡®ä¿ value ç¸åç BigDecimalï¼scale ä¹æ¯ä¸è´çã\n\nSet<BigDecimal> hashSet2 = new HashSet<>();\nhashSet2.add(new BigDecimal("1.0").stripTrailingZeros());\nSystem.out.println(hashSet2.contains(new BigDecimal("1.000").stripTrailingZeros()));//è¿åtrue\n\nSet<BigDecimal> treeSet = new TreeSet<>();\ntreeSet.add(new BigDecimal("1.0"));\nSystem.out.println(treeSet.contains(new BigDecimal("1")));//è¿åtrue\n\n\n\n# æ°å¼æº¢åº\n\næ°å¼è®¡ç®è¿æä¸ä¸ªè¦å°å¿çç¹æ¯æº¢åºï¼ä¸ç®¡æ¯ int è¿æ¯ longï¼ææçåºæ¬æ°å¼ç±»åé½æè¶åºè¡¨è¾¾èå´çå¯è½æ§ã\n\nlong l = Long.MAX_VALUE;\nSystem.out.println(l + 1); // -9223372036854775808\nSystem.out.println(l + 1 == Long.MIN_VALUE); // true\n\n\næ¾ç¶è¿æ¯åçäºæº¢åºï¼èä¸æ¯é»é»çæº¢åºï¼å¹¶æ²¡æä»»ä½å¼å¸¸ãè¿ç±»é®é¢éå¸¸å®¹æè¢«å¿½ç¥ï¼æ¹è¿æ¹å¼æä¸é¢ 2 ç§ã\n\næ¹æ³ä¸æ¯ï¼èèä½¿ç¨ Math ç±»ç addExactãsubtractExact ç­ xxExact æ¹æ³è¿è¡æ°å¼è¿ç®ï¼è¿äºæ¹æ³å¯ä»¥å¨æ°å¼æº¢åºæ¶ä¸»å¨æåºå¼å¸¸ã\n\ntry {\n    long l = Long.MAX_VALUE;\n    System.out.println(Math.addExact(l, 1));\n} catch (Exception ex) {\n    ex.printStackTrace();\n}\n\n\næ¹æ³äºæ¯ï¼ä½¿ç¨å¤§æ°ç±» BigIntegerãBigDecimal æ¯å¤çæµ®ç¹æ°çä¸å®¶ï¼è BigInteger åæ¯å¯¹å¤§æ°è¿è¡ç§å­¦è®¡ç®çä¸å®¶ã\n\nBigInteger i = new BigInteger(String.valueOf(Long.MAX_VALUE));\nSystem.out.println(i.add(BigInteger.ONE).toString());\n\ntry {\n    long l = i.add(BigInteger.ONE).longValueExact();\n} catch (Exception ex) {\n    ex.printStackTrace();\n}\n\n\n\n# åèèµæ\n\n * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * Java åºæ¬æ°æ®ç±»ååå¼ç¨ç±»å\n * æ·±å¥åæ Java ä¸­çè£ç®±åæç®±',normalizedContent:'# æ·±å¥çè§£ java åºæ¬æ°æ®ç±»å\n\n\n\n\n# æ°æ®ç±»ååç±»\n\njava ä¸­çæ°æ®ç±»åæä¸¤ç±»ï¼\n\n * å¼ç±»åï¼åå«åç½®æ°æ®ç±»åï¼åºæ¬æ°æ®ç±»åï¼\n * å¼ç¨ç±»åï¼é¤å¼ç±»åä»¥å¤ï¼é½æ¯å¼ç¨ç±»åï¼åæ¬ stringãæ°ç»ï¼\n\n\n# å¼ç±»å\n\njava è¯­è¨æä¾äº 8 ç§åºæ¬ç±»åï¼å¤§è´åä¸º 4 ç±»\n\nåºæ¬æ°æ®ç±»å    åç±»    æ¯ç¹æ°    é»è®¤å¼        åå¼èå´                            è¯´æ\nboolean   å¸å°å   8 ä½    false      {false, true}                   \nchar      å­ç¬¦å   16 ä½   \'\\u0000\'   [0, $2^{16} - 1$]               å­å¨ unicode ç ï¼ç¨åå¼å·èµå¼\nbyte      æ´æ°å   8 ä½    0          [-$2^7$, $2^7 - 1$]             \nshort     æ´æ°å   16 ä½   0          [-$2^{15}$, $2^{15} - 1$]       \nint       æ´æ°å   32 ä½   0          [-$2^{31}$, $2^{31} - 1$]       \nlong      æ´æ°å   64 ä½   0l         [-$2^{63}$, $2^{63} - 1$]       èµå¼æ¶ä¸è¬å¨æ°å­åå ä¸ l æ l\nfloat     æµ®ç¹å   32 ä½   +0.0f      [$2^{-149}$, $2^{128} - 1$]     èµå¼æ¶å¿é¡»å¨æ°å­åå ä¸ f æ f\ndouble    æµ®ç¹å   64 ä½   +0.0d      [$2^{-1074}$, $2^{1024} - 1$]   èµå¼æ¶ä¸è¬å¨æ°å­åå  d æ d\n\nå°½ç®¡åç§æ°æ®ç±»åçé»è®¤å¼çèµ·æ¥ä¸ä¸æ ·ï¼ä½å¨åå­ä¸­é½æ¯ 0ã\n\nå¨è¿äºåºæ¬ç±»åä¸­ï¼boolean å char æ¯å¯äºçæ ç¬¦å·ç±»åã\n\n\n# å¼ç±»ååå¼ç¨ç±»åçåºå«\n\n * ä»æ¦å¿µæ¹é¢æ¥è¯´\n   * åºæ¬ç±»åï¼åéåæåå·ä½çæ°å¼ã\n   * å¼ç¨ç±»åï¼åéåæåå­æ°æ®å¯¹è±¡çåå­å°åã\n * ä»åå­æ¹é¢æ¥è¯´\n   * åºæ¬ç±»åï¼åéå¨å£°æä¹åï¼java å°±ä¼ç«å»åéç»ä»åå­ç©ºé´ã\n   * å¼ç¨ç±»åï¼å®ä»¥ç¹æ®çæ¹å¼ï¼ç±»ä¼¼ c æéï¼åå¯¹è±¡å®ä½ï¼å·ä½çå¼ï¼ï¼è¿ç±»åéå£°ææ¶ä¸ä¼åéåå­ï¼åªæ¯å­å¨äºä¸ä¸ªåå­å°åã\n * ä»ä½¿ç¨æ¹é¢æ¥è¯´\n   * åºæ¬ç±»åï¼ä½¿ç¨æ¶éè¦èµå·ä½å¼,å¤æ­æ¶ä½¿ç¨ == å·ã\n   * å¼ç¨ç±»åï¼ä½¿ç¨æ¶å¯ä»¥èµ nullï¼å¤æ­æ¶ä½¿ç¨ equals æ¹æ³ã\n\n> ð æ©å±éè¯»ï¼java åºæ¬æ°æ®ç±»ååå¼ç¨ç±»å\n> \n> è¿ç¯æç« å¯¹äºåºæ¬æ°æ®ç±»ååå¼ç¨ç±»åçåå­å­å¨è®²è¿°æ¯è¾çå¨ã\n\n\n# æ°æ®è½¬æ¢\n\njava ä¸­ï¼æ°æ®ç±»åè½¬æ¢æä¸¤ç§æ¹å¼ï¼\n\n * èªå¨è½¬æ¢\n * å¼ºå¶è½¬æ¢\n\n\n# èªå¨è½¬æ¢\n\nä¸è¬æåµä¸ï¼å®ä¹äºææ°æ®ç±»åçåéï¼å°±ä¸è½åéæè½¬æ¢ãä½æ¯ java åè®¸ç¨æ·å¯¹åºæ¬ç±»ååæéåº¦çç±»åè½¬æ¢ã\n\nå¦æç¬¦åä»¥ä¸æ¡ä»¶ï¼å java å°ä¼èªå¨åç±»åè½¬æ¢ï¼\n\n * ç±å°æ°æ®è½¬æ¢ä¸ºå¤§æ°æ®\n   \n   æ¾èæè§çæ¯ï¼âå°âæ°æ®ç±»åçæ°å¼è¡¨ç¤ºèå´å°äºâå¤§âæ°æ®ç±»åçæ°å¼è¡¨ç¤ºèå´ï¼å³ç²¾åº¦å°äºâå¤§âæ°æ®ç±»åã\n   \n   æä»¥ï¼å¦æâå¤§âæ°æ®åâå°âæ°æ®è½¬æ¢ï¼ä¼ä¸¢å¤±æ°æ®ç²¾åº¦ãæ¯å¦ï¼long è½¬ä¸º intï¼åè¶åº int è¡¨ç¤ºèå´çæ°æ®å°ä¼ä¸¢å¤±ï¼å¯¼è´ç»æçä¸ç¡®å®æ§ã\n   \n   åä¹ï¼âå°âæ°æ®åâå¤§âæ°æ®è½¬æ¢ï¼åä¸ä¼å­å¨æ°æ®ä¸¢å¤±æåµãç±äºè¿ä¸ªåå ï¼è¿ç§ç±»åè½¬æ¢ä¹ç§°ä¸ºæ©å¤§è½¬æ¢ã\n   \n   è¿äºç±»åç±âå°âå°âå¤§âåå«ä¸ºï¼(byteï¼shortï¼char) < int < long < float < doubleã\n   \n   è¿éæä»¬æè¯´çâå¤§âä¸âå°âï¼å¹¶ä¸æ¯æå ç¨å­èçå¤å°ï¼èæ¯æè¡¨ç¤ºå¼çèå´çå¤§å°ã\n\n * è½¬æ¢ååçæ°æ®ç±»åè¦å¼å®¹\n   \n   ç±äº boolean ç±»ååªè½å­æ¾ true æ falseï¼è¿ä¸æ´æ°æå­ç¬¦æ¯ä¸å¼å®¹çï¼å æ­¤ä¸å¯ä»¥åç±»åè½¬æ¢ã\n\n * æ´åç±»ååæµ®ç¹åè¿è¡è®¡ç®åï¼ç»æä¼è½¬ä¸ºæµ®ç¹ç±»å\n\nç¤ºä¾ï¼\n\nlong x = 30;\nfloat y = 14.3f;\nsystem.out.println("x/y = " + x/y);\n\n\nè¾åºï¼\n\nx/y = 1.9607843\n\n\nå¯è§ long è½ç¶ç²¾åº¦å¤§äº float ç±»åï¼ä½æ¯ç»æä¸ºæµ®ç¹æ°ç±»åã\n\n\n# å¼ºå¶è½¬æ¢\n\nå¨ä¸ç¬¦åèªå¨è½¬æ¢æ¡ä»¶æ¶æèæ ¹æ®ç¨æ·çéè¦ï¼å¯ä»¥å¯¹æ°æ®ç±»ååå¼ºå¶çè½¬æ¢ã\n\nå¼ºå¶è½¬æ¢ä½¿ç¨æ¬å· () ã\n\nå¼ç¨ç±»åä¹å¯ä»¥ä½¿ç¨å¼ºå¶è½¬æ¢ã\n\nç¤ºä¾ï¼\n\nfloat f = 25.5f;\nint x = (int)f;\nsystem.out.println("x = " + x);\n\n\n\n# è£ç®±åæç®±\n\n\n# åè£ç±»ãè£ç®±ãæç®±\n\njava ä¸­ä¸ºæ¯ä¸ç§åºæ¬æ°æ®ç±»åæä¾äºç¸åºçåè£ç±»ï¼å¦ä¸ï¼\n\nbyte <-> byte\nshort <-> short\ninteger <-> int\nlong <-> long\nfloat <-> float\ndouble <-> double\ncharacter <-> char\nboolean <-> boolean\n\n\nå¼å¥åè£ç±»çç®çå°±æ¯ï¼æä¾ä¸ç§æºå¶ï¼ä½¿å¾åºæ¬æ°æ®ç±»åå¯ä»¥ä¸å¼ç¨ç±»åäºç¸è½¬æ¢ã\n\nåºæ¬æ°æ®ç±»åä¸åè£ç±»çè½¬æ¢è¢«ç§°ä¸ºè£ç®±åæç®±ã\n\n * è£ç®±ï¼boxingï¼æ¯å°å¼ç±»åè½¬æ¢ä¸ºå¼ç¨ç±»åãä¾å¦ï¼int è½¬ integer\n   * è£ç®±è¿ç¨æ¯éè¿è°ç¨åè£ç±»ç valueof æ¹æ³å®ç°çã\n * æç®±ï¼unboxingï¼æ¯å°å¼ç¨ç±»åè½¬æ¢ä¸ºå¼ç±»åãä¾å¦ï¼integer è½¬ int\n   * æç®±è¿ç¨æ¯éè¿è°ç¨åè£ç±»ç xxxvalue æ¹æ³å®ç°çãï¼xxx ä»£è¡¨å¯¹åºçåºæ¬æ°æ®ç±»åï¼ã\n\n\n# èªå¨è£ç®±ãèªå¨æç®±\n\nåºæ¬æ°æ®ï¼primitiveï¼åçèªå¨è£ç®±ï¼boxingï¼æç®±ï¼unboxingï¼èª jdk 5 å¼å§æä¾çåè½ã\n\nèªå¨è£ç®±ä¸æç®±çæºå¶å¯ä»¥è®©æä»¬å¨ java çåéèµå¼æèæ¯æ¹æ³è°ç¨ç­æåµä¸ä½¿ç¨åå§ç±»åæèå¯¹è±¡ç±»åæ´å ç®åç´æ¥ã å ä¸ºèªå¨è£ç®±ä¼éå¼å°åå»ºå¯¹è±¡ï¼å¦æå¨ä¸ä¸ªå¾ªç¯ä½ä¸­ï¼ä¼åå»ºæ ç¨çä¸­é´å¯¹è±¡ï¼è¿æ ·ä¼å¢å  gc ååï¼æä½ç¨åºçæ§è½ãæä»¥å¨åå¾ªç¯æ¶ä¸å®è¦æ³¨æä»£ç ï¼é¿åå¼å¥ä¸å¿è¦çèªå¨è£ç®±æä½ã\n\njdk 5 ä¹åçå½¢å¼ï¼\n\ninteger i1 = new integer(10); // éèªå¨è£ç®±\n\n\njdk 5 ä¹åï¼\n\ninteger i2 = 10; // èªå¨è£ç®±\n\n\njava å¯¹äºèªå¨è£ç®±åæç®±çè®¾è®¡ï¼ä¾èµäºä¸ç§å«åäº«åæ¨¡å¼çè®¾è®¡æ¨¡å¼ï¼æå´è¶£çæåå¯ä»¥å»äºè§£ä¸ä¸æºç ï¼è¿éä¸å¯¹è®¾è®¡æ¨¡å¼å±å¼è¯¦è¿°ï¼ã\n\n> ð æ©å±éè¯»ï¼æ·±å¥åæ java ä¸­çè£ç®±åæç®±\n> \n> ç»åç¤ºä¾ï¼ä¸æ­¥æ­¥éè¿°è£ç®±åæç®±åçã\n\n\n# è£ç®±ãæç®±çåºç¨åæ³¨æç¹\n\n# è£ç®±ãæç®±åºç¨åºæ¯\n\n * ä¸ç§ææ®éçåºæ¯æ¯ï¼è°ç¨ä¸ä¸ªå«ç±»åä¸º object åæ°çæ¹æ³ï¼è¯¥ object å¯æ¯æä»»æç±»åï¼å ä¸º object æ¯ææç±»çç¶ç±»ï¼ï¼ä»¥ä¾¿éç¨ãå½ä½ éè¦å°ä¸ä¸ªå¼ç±»åï¼å¦ intï¼ä¼ å¥æ¶ï¼éè¦ä½¿ç¨ integer è£ç®±ã\n * å¦ä¸ç§ç¨æ³æ¯ï¼ä¸ä¸ªéæ³åçå®¹å¨ï¼åæ ·æ¯ä¸ºäºä¿è¯éç¨ï¼èå°åç´ ç±»åå®ä¹ä¸º objectãäºæ¯ï¼è¦å°å¼ç±»åæ°æ®å å¥å®¹å¨æ¶ï¼éè¦è£ç®±ã\n * å½ == è¿ç®ç¬¦çä¸¤ä¸ªæä½ï¼ä¸ä¸ªæä½æ°æ¯åè£ç±»ï¼å¦ä¸ä¸ªæä½æ°æ¯è¡¨è¾¾å¼ï¼å³åå«ç®æ¯è¿ç®ï¼åæ¯è¾çæ¯æ°å¼ï¼å³ä¼è§¦åèªå¨æç®±çè¿ç¨ï¼ã\n\nãç¤ºä¾ãè£ç®±ãæç®±ç¤ºä¾\n\ninteger i1 = 10; // èªå¨è£ç®±\ninteger i2 = new integer(10); // éèªå¨è£ç®±\ninteger i3 = integer.valueof(10); // éèªå¨è£ç®±\nint i4 = new integer(10); // èªå¨æç®±\nint i5 = i2.intvalue(); // éèªå¨æç®±\nsystem.out.println("i1 = [" + i1 + "]");\nsystem.out.println("i2 = [" + i2 + "]");\nsystem.out.println("i3 = [" + i3 + "]");\nsystem.out.println("i4 = [" + i4 + "]");\nsystem.out.println("i5 = [" + i5 + "]");\nsystem.out.println("i1 == i2 is [" + (i1 == i2) + "]");\nsystem.out.println("i1 == i4 is [" + (i1 == i4) + "]"); // èªå¨æç®±\n// output:\n// i1 = [10]\n// i2 = [10]\n// i3 = [10]\n// i4 = [10]\n// i5 = [10]\n// i1 == i2 is [false]\n// i1 == i4 is [true]\n\n\nãè¯´æã\n\nä¸é¢çä¾å­ï¼è½ç¶ç®åï¼ä½å´éèäºèªå¨è£ç®±ãæç®±åéèªå¨è£ç®±ãæç®±çåºç¨ãä»ä¾å­ä¸­å¯ä»¥çå°ï¼ææææåéé½åå§åä¸ºæ°å¼ 10 äºï¼ä½ä¸ºä½ä¼åºç° i1 == i2 is [false è i1 == i4 is [true] ï¼\n\nåå å¨äºï¼\n\n * i1ãi2 é½æ¯åè£ç±»ï¼ä½¿ç¨ == æ¶ï¼java å°å®ä»¬å½åä¸¤ä¸ªå¯¹è±¡ï¼èéä¸¤ä¸ª int å¼æ¥æ¯è¾ï¼æä»¥ä¸¤ä¸ªå¯¹è±¡èªç¶æ¯ä¸ç¸ç­çãæ­£ç¡®çæ¯è¾æä½åºè¯¥ä½¿ç¨ equals æ¹æ³ã\n * i1 æ¯åè£ç±»ï¼i4 æ¯åºç¡æ°æ®ç±»åï¼ä½¿ç¨ == æ¶ï¼java ä¼å°ä¸¤ä¸ª i1 è¿ä¸ªåè£ç±»å¯¹è±¡èªå¨æç®±ä¸ºä¸ä¸ª int å¼ï¼åä»£å¥å° == è¿ç®è¡¨è¾¾å¼ä¸­è®¡ç®ï¼æç»ï¼ç¸å½äºä¸¤ä¸ª int è¿è¡æ¯è¾ï¼ç±äºå¼ç¸åï¼æä»¥ç»æç¸ç­ã\n\nãç¤ºä¾ãåè£ç±»å¤ç­é®é¢\n\ninteger a = 127; //integer.valueof(127)\ninteger b = 127; //integer.valueof(127)\nlog.info("\\ninteger a = 127;\\ninteger b = 127;\\na == b ? {}", a == b);    // true\n\ninteger c = 128; //integer.valueof(128)\ninteger d = 128; //integer.valueof(128)\nlog.info("\\ninteger c = 128;\\ninteger d = 128;\\nc == d ? {}", c == d);   //false\n//è®¾ç½®-xx:autoboxcachemax=1000åè¯è¯\n\ninteger e = 127; //integer.valueof(127)\ninteger f = new integer(127); //new instance\nlog.info("\\ninteger e = 127;\\ninteger f = new integer(127);\\ne == f ? {}", e == f);   //false\n\ninteger g = new integer(127); //new instance\ninteger h = new integer(127); //new instance\nlog.info("\\ninteger g = new integer(127);\\ninteger h = new integer(127);\\ng == h ? {}", g == h);  //false\n\ninteger i = 128; //unbox\nint j = 128;\nlog.info("\\ninteger i = 128;\\nint j = 128;\\ni == j ? {}", i == j); //true\n\n\néè¿è¿è¡ç»æå¯ä»¥çå°ï¼è½ç¶çèµ·æ¥æ°¸è¿æ¯å¨å¯¹ 127 å 127ã128 å 128 å¤ç­ï¼ä½ == å´å¹¶éæ»æ¯è¿å trueã\n\n# è£ç®±ãæç®±åºç¨æ³¨æç¹\n\n 1. è£ç®±æä½ä¼åå»ºå¯¹è±¡ï¼é¢ç¹çè£ç®±æä½ä¼é æä¸å¿è¦çåå­æ¶èï¼å½±åæ§è½ãæä»¥åºè¯¥å°½éé¿åè£ç®±ã\n 2. åºç¡æ°æ®ç±»åçæ¯è¾æä½ä½¿ç¨ ==ï¼åè£ç±»çæ¯è¾æä½ä½¿ç¨ equals æ¹æ³ã\n\n\n# å¤ç­é®é¢\n\njava ä¸­ï¼éå¸¸ä½¿ç¨ equals æ == è¿è¡å¤ç­æä½ãequals æ¯æ¹æ³è == æ¯æä½ç¬¦ãæ­¤å¤ï¼äºèä½¿ç¨ä¹æ¯æåºå«çï¼\n\n * å¯¹åºæ¬ç±»åï¼æ¯å¦ intãlongï¼è¿è¡å¤ç­ï¼åªè½ä½¿ç¨ ==ï¼æ¯è¾çæ¯å­é¢å¼ãå ä¸ºåºæ¬ç±»åçå¼å°±æ¯å¶æ°å¼ã\n * å¯¹å¼ç¨ç±»åï¼æ¯å¦ integerãlong å stringï¼è¿è¡å¤ç­ï¼éè¦ä½¿ç¨ equals è¿è¡åå®¹å¤ç­ãå ä¸ºå¼ç¨ç±»åçç´æ¥å¼æ¯æéï¼ä½¿ç¨ == çè¯ï¼æ¯è¾çæ¯æéï¼ä¹å°±æ¯ä¸¤ä¸ªå¯¹è±¡å¨åå­ä¸­çå°åï¼å³æ¯è¾å®ä»¬æ¯ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼èä¸æ¯æ¯è¾å¯¹è±¡çåå®¹ã\n\n\n# åè£ç±»çå¤ç­\n\næä»¬éè¿ä¸ä¸ªç¤ºä¾æ¥æ·±å¥ç ç©¶ä¸ä¸å¤ç­é®é¢ã\n\nãç¤ºä¾ãåè£ç±»çå¤ç­\n\ninteger a = 127; //integer.valueof(127)\ninteger b = 127; //integer.valueof(127)\nlog.info("\\ninteger a = 127;\\ninteger b = 127;\\na == b ? {}", a == b);    // true\n\ninteger c = 128; //integer.valueof(128)\ninteger d = 128; //integer.valueof(128)\nlog.info("\\ninteger c = 128;\\ninteger d = 128;\\nc == d ? {}", c == d);   //false\n//è®¾ç½®-xx:autoboxcachemax=1000åè¯è¯\n\ninteger e = 127; //integer.valueof(127)\ninteger f = new integer(127); //new instance\nlog.info("\\ninteger e = 127;\\ninteger f = new integer(127);\\ne == f ? {}", e == f);   //false\n\ninteger g = new integer(127); //new instance\ninteger h = new integer(127); //new instance\nlog.info("\\ninteger g = new integer(127);\\ninteger h = new integer(127);\\ng == h ? {}", g == h);  //false\n\ninteger i = 128; //unbox\nint j = 128;\nlog.info("\\ninteger i = 128;\\nint j = 128;\\ni == j ? {}", i == j); //true\n\n\nç¬¬ä¸ä¸ªæ¡ä¾ä¸­ï¼ç¼è¯å¨ä¼æ integer a = 127 è½¬æ¢ä¸º integer.valueof(127)ãæ¥çæºç å¯ä»¥åç°ï¼è¿ä¸ªè½¬æ¢å¨åé¨å¶å®åäºç¼å­ï¼ä½¿å¾ä¸¤ä¸ª integer æååä¸ä¸ªå¯¹è±¡ï¼æä»¥ == è¿å trueã\n\npublic static integer valueof(int i) {\n    if (i >= integercache.low && i <= integercache.high)\n        return integercache.cache[i + (-integercache.low)];\n    return new integer(i);\n}\n\n\nç¬¬äºä¸ªæ¡ä¾ä¸­ï¼ä¹æä»¥åæ ·çä»£ç  128 å°±è¿å false çåå æ¯ï¼é»è®¤æåµä¸ä¼ç¼å­[-128,127]çæ°å¼ï¼è 128 å¤äºè¿ä¸ªåºé´ä¹å¤ãè®¾ç½® jvm åæ°å ä¸ -xx:autoboxcachemax=1000 åè¯è¯ï¼æ¯ä¸æ¯å°±è¿å true äºå¢ï¼\n\nprivate static class integercache {\n    static final int low = -128;\n    static final int high;\n    static final integer cache[];\n\n    static {\n        // high value may be configured by property\n        int h = 127;\n        string integercachehighpropvalue =\n            sun.misc.vm.getsavedproperty("java.lang.integer.integercache.high");\n        if (integercachehighpropvalue != null) {\n            try {\n                int i = parseint(integercachehighpropvalue);\n                i = math.max(i, 127);\n                // maximum array size is integer.max_value\n                h = math.min(i, integer.max_value - (-low) -1);\n            } catch( numberformatexception nfe) {\n                // if the property cannot be parsed into an int, ignore it.\n            }\n        }\n        high = h;\n\n        cache = new integer[(high - low) + 1];\n        int j = low;\n        for(int k = 0; k < cache.length; k++)\n            cache[k] = new integer(j++);\n\n        // range [-128, 127] must be interned (jls7 5.1.7)\n        assert integercache.high >= 127;\n    }\n\n    private integercache() {}\n}\n\n\nç¬¬ä¸åç¬¬åä¸ªæ¡ä¾ä¸­ï¼new åºæ¥ç integer å§ç»æ¯ä¸èµ°ç¼å­çæ°å¯¹è±¡ãæ¯è¾ä¸¤ä¸ªæ°å¯¹è±¡ï¼æèæ¯è¾ä¸ä¸ªæ°å¯¹è±¡åä¸ä¸ªæ¥èªç¼å­çå¯¹è±¡ï¼ç»æè¯å®ä¸æ¯ç¸åçå¯¹è±¡ï¼å æ­¤è¿å falseã\n\nç¬¬äºä¸ªæ¡ä¾ä¸­ï¼æä»¬æè£ç®±ç integer ååºæ¬ç±»å int æ¯è¾ï¼åèä¼åæç®±åæ¯è¾ï¼æ¯è¾çè¯å®æ¯æ°å¼èä¸æ¯å¼ç¨ï¼å æ­¤è¿å trueã\n\n> ãæ»ç»ãç»¼ä¸ï¼æä»¬å¯ä»¥å¾åºç»è®ºï¼åè£ç±»éè¦ä½¿ç¨ equals è¿è¡åå®¹å¤ç­ï¼èä¸è½ä½¿ç¨ ==ã\n\n\n# string çå¤ç­\n\nstring a = "1";\nstring b = "1";\nlog.info("\\nstring a = \\"1\\";\\nstring b = \\"1\\";\\na == b ? {}", a == b); //true\n\nstring c = new string("2");\nstring d = new string("2");\nlog.info("\\nstring c = new string(\\"2\\");\\nstring d = new string(\\"2\\");\\nc == d ? {}", c == d); //false\n\nstring e = new string("3").intern();\nstring f = new string("3").intern();\nlog.info("\\nstring e = new string(\\"3\\").intern();\\nstring f = new string(\\"3\\").intern();\\ne == f ? {}", e == f); //true\n\nstring g = new string("4");\nstring h = new string("4");\nlog.info("\\nstring g = new string(\\"4\\");\\nstring h = new string(\\"4\\");\\ng == h ? {}", g.equals(h)); //true\n\n\nå¨ jvm ä¸­ï¼å½ä»£ç ä¸­åºç°åå¼å·å½¢å¼åå»ºå­ç¬¦ä¸²å¯¹è±¡æ¶ï¼jvm ä¼åå¯¹è¿ä¸ªå­ç¬¦ä¸²è¿è¡æ£æ¥ï¼å¦æå­ç¬¦ä¸²å¸¸éæ± ä¸­å­å¨ç¸ååå®¹çå­ç¬¦ä¸²å¯¹è±¡çå¼ç¨ï¼åå°è¿ä¸ªå¼ç¨è¿åï¼å¦åï¼åå»ºæ°çå­ç¬¦ä¸²å¯¹è±¡ï¼ç¶åå°è¿ä¸ªå¼ç¨æ¾å¥å­ç¬¦ä¸²å¸¸éæ± ï¼å¹¶è¿åè¯¥å¼ç¨ãè¿ç§æºå¶ï¼å°±æ¯å­ç¬¦ä¸²é©»çææ± åã\n\nç¬¬ä¸ä¸ªæ¡ä¾è¿å trueï¼å ä¸º java çå­ç¬¦ä¸²é©»çæºå¶ï¼ç´æ¥ä½¿ç¨åå¼å·å£°æåºæ¥çä¸¤ä¸ª string å¯¹è±¡æåå¸¸éæ± ä¸­çç¸åå­ç¬¦ä¸²ã\n\nç¬¬äºä¸ªæ¡ä¾ï¼new åºæ¥çä¸¤ä¸ª string æ¯ä¸åå¯¹è±¡ï¼å¼ç¨å½ç¶ä¸åï¼æä»¥å¾å° false çç»æã\n\nç¬¬ä¸ä¸ªæ¡ä¾ï¼ä½¿ç¨ string æä¾ç intern æ¹æ³ä¹ä¼èµ°å¸¸éæ± æºå¶ï¼æä»¥åæ ·è½å¾å° trueã\n\nç¬¬åä¸ªæ¡ä¾ï¼éè¿ equals å¯¹å¼åå®¹å¤ç­ï¼æ¯æ­£ç¡®çå¤çæ¹å¼ï¼å½ç¶ä¼å¾å° trueã\n\nè½ç¶ä½¿ç¨ new å£°æçå­ç¬¦ä¸²è°ç¨ intern æ¹æ³ï¼ä¹å¯ä»¥è®©å­ç¬¦ä¸²è¿è¡é©»çï¼ä½å¨ä¸å¡ä»£ç ä¸­æ»¥ç¨ internï¼å¯è½ä¼äº§çæ§è½é®é¢ã\n\nãç¤ºä¾ãstring#intern æ§è½æµè¯\n\n//-xx:+printstringtablestatistics\n//-xx:stringtablesize=10000000\nlist<string> list = new arraylist<>();\nlong begin = system.currenttimemillis();\nlist = intstream.rangeclosed(1, 10000000)\n    .maptoobj(i -> string.valueof(i).intern())\n    .collect(collectors.tolist());\nsystem.out.println("size:" + list.size());\nsystem.out.println("time:" + (system.currenttimemillis() - begin));\n\n\nä¸é¢çç¤ºä¾æ§è¡æ¶é´ä¼æ¯è¾é¿ãåå å¨äºï¼å­ç¬¦ä¸²å¸¸éæ± æ¯ä¸ä¸ªåºå®å®¹éç mapãå¦æå®¹éå¤ªå°ï¼number of buckets=60013ï¼ãå­ç¬¦ä¸²å¤ªå¤ï¼1000 ä¸ä¸ªå­ç¬¦ä¸²ï¼ï¼é£ä¹æ¯ä¸ä¸ªæ¡¶ä¸­çå­ç¬¦ä¸²æ°éä¼éå¸¸å¤ï¼æä»¥æç´¢èµ·æ¥å°±å¾æ¢ãè¾åºç»æä¸­ç average bucket size=167ï¼ä»£è¡¨äº map ä¸­æ¡¶çå¹³åé¿åº¦æ¯ 167ã\n\nè§£å³æ¹æ³æ¯ï¼è®¾ç½® jvm åæ° -xx:stringtablesize=10000000ï¼æå®æ´å¤çæ¡¶ã\n\nä¸ºäºæ¹ä¾¿è§å¯ï¼å¯ä»¥å¨å¯å¨ç¨åºæ¶è®¾ç½® jvm åæ° -xx:+printstringtablestatisticï¼ç¨åºéåºæ¶å¯ä»¥æå°åºå­ç¬¦ä¸²å¸¸éè¡¨çç»è®¡ä¿¡æ¯ã\n\næ§è¡ç»ææ¯ä¸è®¾ç½® -xx:stringtablesize è¦å¿«å¾å¤ã\n\n> ãæ»ç»ãæ²¡äºå«è½»æç¨ internï¼å¦æè¦ç¨ä¸å®è¦æ³¨ææ§å¶é©»ççå­ç¬¦ä¸²çæ°éï¼å¹¶çæå¸¸éè¡¨çåé¡¹ææ ã\n\n\n# å®ç° equals\n\nå¦æçè¿ object ç±»æºç ï¼ä½ å¯è½å°±ç¥éï¼equals çå®ç°å¶å®æ¯æ¯è¾å¯¹è±¡å¼ç¨\n\npublic boolean equals(object obj) {\n    return (this == obj);\n}\n\n\nä¹æä»¥ integer æ string è½éè¿ equals å®ç°åå®¹å¤ç­ï¼æ¯å ä¸ºå®ä»¬é½è¦åäºè¿ä¸ªæ¹æ³ã\n\nå¯¹äºèªå®ä¹ç±»åï¼å¦æä¸è¦å equals çè¯ï¼é»è®¤å°±æ¯ä½¿ç¨ object åºç±»çæå¼ç¨çæ¯è¾æ¹å¼ã\n\nå®ç°ä¸ä¸ªæ´å¥½ç equals åºè¯¥æ³¨æçç¹ï¼\n\n * èèå°æ§è½ï¼å¯ä»¥åè¿è¡æéå¤ç­ï¼å¦æå¯¹è±¡æ¯åä¸ä¸ªé£ä¹ç´æ¥è¿å trueï¼\n * éè¦å¯¹å¦ä¸æ¹è¿è¡å¤ç©ºï¼ç©ºå¯¹è±¡åèªèº«è¿è¡æ¯è¾ï¼ç»æä¸å®æ¯ fasleï¼\n * éè¦å¤æ­ä¸¤ä¸ªå¯¹è±¡çç±»åï¼å¦æç±»åé½ä¸åï¼é£ä¹ç´æ¥è¿å falseï¼\n * ç¡®ä¿ç±»åç¸åçæåµä¸åè¿è¡ç±»åå¼ºå¶è½¬æ¢ï¼ç¶åéä¸å¤æ­ææå­æ®µã\n\nãç¤ºä¾ãèªå®ä¹ equals ç¤ºä¾\n\nèªå®ä¹ç±»ï¼\n\nclass point {\n    private final int x;\n    private final int y;\n    private final string desc;\n}\n\n\nèªå®ä¹ equalsï¼\n\n@override\npublic boolean equals(object o) {\n    if (this == o) return true;\n    if (o == null || getclass() != o.getclass()) return false;\n    point that = (point) o;\n    return x == that.x && y == that.y;\n}\n\n\n\n# hashcode å equals è¦éå¯¹å®ç°\n\npoint p1 = new point(1, 2, "a");\npoint p2 = new point(1, 2, "b");\n\nhashset<pointwrong> points = new hashset<>();\npoints.add(p1);\nlog.info("points.contains(p2) ? {}", points.contains(p2));\n\n\næç§æ¹è¿åç equals æ¹æ³ï¼è¿ 2 ä¸ªå¯¹è±¡å¯ä»¥è®¤ä¸ºæ¯åä¸ä¸ªï¼set ä¸­å·²ç»å­å¨äº p1 å°±åºè¯¥åå« p2ï¼ä½ç»æå´æ¯ falseã\n\nåºç°è¿ä¸ª bug çåå æ¯ï¼æ£åè¡¨éè¦ä½¿ç¨ hashcode æ¥å®ä½åç´ æ¾å°åªä¸ªæ¡¶ãå¦æèªå®ä¹å¯¹è±¡æ²¡æå®ç°èªå®ä¹ç hashcode æ¹æ³ï¼å°±ä¼ä½¿ç¨ object è¶ç±»çé»è®¤å®ç°ï¼å¾å°çä¸¤ä¸ª hashcode æ¯ä¸åçï¼å¯¼è´æ æ³æ»¡è¶³éæ±ã\n\nè¦èªå®ä¹ hashcodeï¼æä»¬å¯ä»¥ç´æ¥ä½¿ç¨ objects.hash æ¹æ³æ¥å®ç°ã\n\n@override\npublic int hashcode() {\n    return objects.hash(x, y);\n}\n\n\n\n# compareto å equals çé»è¾ä¸è´æ§\n\nãç¤ºä¾ãèªå®ä¹ compareto åºéç¤ºä¾\n\n@data\n@allargsconstructor\nstatic class student implements comparable<student> {\n\n    private int id;\n    private string name;\n\n    @override\n    public int compareto(student other) {\n        int result = integer.compare(other.id, id);\n        if (result == 0) { log.info("this {} == other {}", this, other); }\n        return result;\n    }\n\n}\n\n\nè°ç¨ï¼\n\nlist<student> list = new arraylist<>();\nlist.add(new student(1, "zhang"));\nlist.add(new student(2, "wang"));\nstudent student = new student(2, "li");\n\nlog.info("arraylist.indexof");\nint index1 = list.indexof(student);\ncollections.sort(list);\nlog.info("collections.binarysearch");\nint index2 = collections.binarysearch(list, student);\n\nlog.info("index1 = " + index1);\nlog.info("index2 = " + index2);\n\n\nbinarysearch æ¹æ³åé¨è°ç¨äºåç´ ç compareto æ¹æ³è¿è¡æ¯è¾ï¼\n\n * indexof çç»ææ²¡é®é¢ï¼åè¡¨ä¸­æç´¢ä¸å° id ä¸º 2ãname æ¯ li çå­¦çï¼\n * binarysearch è¿åäºç´¢å¼ 1ï¼ä»£è¡¨æç´¢å°çç»ææ¯ id ä¸º 2ï¼name æ¯ wang çå­¦çã\n\nä¿®å¤æ¹å¼å¾ç®åï¼ç¡®ä¿ compareto çæ¯è¾é»è¾å equals çå®ç°ä¸è´å³å¯ã\n\n@data\n@allargsconstructor\nstatic class studentright implements comparable<studentright> {\n\n    private int id;\n    private string name;\n\n    @override\n    public int compareto(studentright other) {\n        return comparator.comparing(studentright::getname)\n            .thencomparingint(studentright::getid)\n            .compare(this, other);\n    }\n\n}\n\n\n\n# å°å¿ lombok çæä»£ç çâåâ\n\nlombok ç @data æ³¨è§£ä¼å¸®æä»¬å®ç° equals å hashcode æ¹æ³ï¼ä½æ¯æç»§æ¿å³ç³»æ¶ï¼ lombok èªå¨çæçæ¹æ³å¯è½å°±ä¸æ¯æä»¬ææçäºã\n\n@equalsandhashcode é»è®¤å®ç°æ²¡æä½¿ç¨ç¶ç±»å±æ§ãä¸ºè§£å³è¿ä¸ªé®é¢ï¼æä»¬å¯ä»¥æå¨è®¾ç½® callsuper å¼å³ä¸º trueï¼æ¥è¦çè¿ç§é»è®¤è¡ä¸ºã\n\n\n# æ°å¼è®¡ç®\n\n\n# æµ®ç¹æ°è®¡ç®é®é¢\n\nè®¡ç®æºæ¯ææ°å¼ä¿å­å¨äºåéä¸­ï¼ä¸åç±»åçæ°å¼åéè½ä¿å­çæ°å¼èå´ä¸åï¼å½æ°å¼è¶è¿ç±»åè½è¡¨è¾¾çæ°å¼ä¸éåä¼åçæº¢åºé®é¢ã\n\nsystem.out.println(0.1 + 0.2); // 0.30000000000000004\nsystem.out.println(1.0 - 0.8); // 0.19999999999999996\nsystem.out.println(4.015 * 100); // 401.49999999999994\nsystem.out.println(123.3 / 100); // 1.2329999999999999\ndouble amount1 = 2.15;\ndouble amount2 = 1.10;\nsystem.out.println(amount1 - amount2); // 1.0499999999999998\n\n\nä¸é¢çå ä¸ªç¤ºä¾ï¼è¾åºç»æåæä»¬é¢æçå¾ä¸ä¸æ ·ãä¸ºä»ä¹ä¼æ¯è¿æ ·å¢ï¼\n\nåºç°è¿ç§é®é¢çä¸»è¦åå æ¯ï¼è®¡ç®æºæ¯ä»¥äºè¿å¶å­å¨æ°å¼çï¼æµ®ç¹æ°ä¹ä¸ä¾å¤ãjava éç¨äº ieee 754 æ åå®ç°æµ®ç¹æ°çè¡¨è¾¾åè¿ç®ï¼ä½ å¯ä»¥éè¿è¿éæ¥çæ°å¼è½¬åä¸ºäºè¿å¶çç»æã\n\næ¯å¦ï¼0.1 çäºè¿å¶è¡¨ç¤ºä¸º 0.0 0011 0011 0011â¦ ï¼0011 æ éå¾ªç¯)ï¼åè½¬æ¢ä¸ºåè¿å¶å°±æ¯ 0.1000000000000000055511151231257827021181583404541015625ãå¯¹äºè®¡ç®æºèè¨ï¼0.1 æ æ³ç²¾ç¡®è¡¨è¾¾ï¼è¿æ¯æµ®ç¹æ°è®¡ç®é æç²¾åº¦æå¤±çæ ¹æºã\n\næµ®ç¹æ°æ æ³ç²¾ç¡®è¡¨è¾¾åè¿ç®çåºæ¯ï¼ä¸å®è¦ä½¿ç¨ bigdecimal ç±»åã\n\nä½¿ç¨ bigdecimal æ¶ï¼æä¸ªç»èè¦æ ¼å¤æ³¨æãè®©æä»¬æ¥çä¸æ®µä»£ç ï¼\n\nsystem.out.println(new bigdecimal(0.1).add(new bigdecimal(0.2)));\n// output: 0.3000000000000000166533453693773481063544750213623046875\n\nsystem.out.println(new bigdecimal(1.0).subtract(new bigdecimal(0.8)));\n// output: 0.1999999999999999555910790149937383830547332763671875\n\nsystem.out.println(new bigdecimal(4.015).multiply(new bigdecimal(100)));\n// output: 401.49999999999996802557689079549163579940795898437500\n\nsystem.out.println(new bigdecimal(123.3).divide(new bigdecimal(100)));\n// output: 1.232999999999999971578290569595992565155029296875\n\n\nä¸ºä»ä¹è¾åºç»æä»ç¶ä¸ç¬¦åé¢æå¢ï¼\n\nä½¿ç¨ bigdecimal è¡¨ç¤ºåè®¡ç®æµ®ç¹æ°ï¼ä¸å¡å¿ä½¿ç¨å­ç¬¦ä¸²çæé æ¹æ³æ¥åå§å bigdecimalã\n\n\n# æµ®ç¹æ°ç²¾åº¦åæ ¼å¼å\n\næµ®ç¹æ°çå­ç¬¦ä¸²æ ¼å¼åä¹è¦éè¿ bigdecimal è¿è¡ã\n\nprivate static void wrong1() {\n    double num1 = 3.35;\n    float num2 = 3.35f;\n    system.out.println(string.format("%.1f", num1)); // 3.4\n    system.out.println(string.format("%.1f", num2)); // 3.3\n}\n\nprivate static void wrong2() {\n    double num1 = 3.35;\n    float num2 = 3.35f;\n    decimalformat format = new decimalformat("#.##");\n    format.setroundingmode(roundingmode.down);\n    system.out.println(format.format(num1)); // 3.35\n    format.setroundingmode(roundingmode.down);\n    system.out.println(format.format(num2)); // 3.34\n}\n\nprivate static void right() {\n    bigdecimal num1 = new bigdecimal("3.35");\n    bigdecimal num2 = num1.setscale(1, bigdecimal.round_down);\n    system.out.println(num2); // 3.3\n    bigdecimal num3 = num1.setscale(1, bigdecimal.round_half_up);\n    system.out.println(num3); // 3.4\n}\n\n\n\n# bigdecimal å¤ç­é®é¢\n\nprivate static void wrong() {\n    system.out.println(new bigdecimal("1.0").equals(new bigdecimal("1")));\n}\n\nprivate static void right() {\n    system.out.println(new bigdecimal("1.0").compareto(new bigdecimal("1")) == 0);\n}\n\n\nbigdecimal ç equals æ¹æ³çæ³¨éä¸­è¯´æäºåå ï¼equals æ¯è¾çæ¯ bigdecimal ç value å scaleï¼1.0 ç scale æ¯ 1ï¼1 ç scale æ¯ 0ï¼æä»¥ç»æä¸å®æ¯ falseã\n\nå¦ææä»¬å¸æåªæ¯è¾ bigdecimal ç valueï¼å¯ä»¥ä½¿ç¨ compareto æ¹æ³ã\n\nbigdecimal ç equals å hashcode æ¹æ³ä¼åæ¶èè value å scaleï¼å¦æç»å hashset æ hashmap ä½¿ç¨çè¯å°±å¯è½ä¼åºç°éº»ç¦ãæ¯å¦ï¼æä»¬æå¼ä¸º 1.0 ç bigdecimal å å¥ hashsetï¼ç¶åå¤æ­å¶æ¯å¦å­å¨å¼ä¸º 1 ç bigdecimalï¼å¾å°çç»ææ¯ falseã\n\nset<bigdecimal> hashset1 = new hashset<>();\nhashset1.add(new bigdecimal("1.0"));\nsystem.out.println(hashset1.contains(new bigdecimal("1")));//è¿åfalse\n\n\n\n\nè§£å³åæ³æä¸¤ä¸ªï¼\n\nç¬¬ä¸ä¸ªæ¹æ³æ¯ï¼ä½¿ç¨ treeset æ¿æ¢ hashsetãtreeset ä¸ä½¿ç¨ hashcode æ¹æ³ï¼ä¹ä¸ä½¿ç¨ equals æ¯è¾åç´ ï¼èæ¯ä½¿ç¨ compareto æ¹æ³ï¼æä»¥ä¸ä¼æé®é¢ã\n\nç¬¬äºä¸ªæ¹æ³æ¯ï¼æ bigdecimal å­å¥ hashset æ hashmap åï¼åä½¿ç¨ striptrailingzeros æ¹æ³å»æå°¾é¨çé¶ï¼æ¯è¾çæ¶åä¹å»æå°¾é¨ç 0ï¼ç¡®ä¿ value ç¸åç bigdecimalï¼scale ä¹æ¯ä¸è´çã\n\nset<bigdecimal> hashset2 = new hashset<>();\nhashset2.add(new bigdecimal("1.0").striptrailingzeros());\nsystem.out.println(hashset2.contains(new bigdecimal("1.000").striptrailingzeros()));//è¿åtrue\n\nset<bigdecimal> treeset = new treeset<>();\ntreeset.add(new bigdecimal("1.0"));\nsystem.out.println(treeset.contains(new bigdecimal("1")));//è¿åtrue\n\n\n\n# æ°å¼æº¢åº\n\næ°å¼è®¡ç®è¿æä¸ä¸ªè¦å°å¿çç¹æ¯æº¢åºï¼ä¸ç®¡æ¯ int è¿æ¯ longï¼ææçåºæ¬æ°å¼ç±»åé½æè¶åºè¡¨è¾¾èå´çå¯è½æ§ã\n\nlong l = long.max_value;\nsystem.out.println(l + 1); // -9223372036854775808\nsystem.out.println(l + 1 == long.min_value); // true\n\n\næ¾ç¶è¿æ¯åçäºæº¢åºï¼èä¸æ¯é»é»çæº¢åºï¼å¹¶æ²¡æä»»ä½å¼å¸¸ãè¿ç±»é®é¢éå¸¸å®¹æè¢«å¿½ç¥ï¼æ¹è¿æ¹å¼æä¸é¢ 2 ç§ã\n\næ¹æ³ä¸æ¯ï¼èèä½¿ç¨ math ç±»ç addexactãsubtractexact ç­ xxexact æ¹æ³è¿è¡æ°å¼è¿ç®ï¼è¿äºæ¹æ³å¯ä»¥å¨æ°å¼æº¢åºæ¶ä¸»å¨æåºå¼å¸¸ã\n\ntry {\n    long l = long.max_value;\n    system.out.println(math.addexact(l, 1));\n} catch (exception ex) {\n    ex.printstacktrace();\n}\n\n\næ¹æ³äºæ¯ï¼ä½¿ç¨å¤§æ°ç±» bigintegerãbigdecimal æ¯å¤çæµ®ç¹æ°çä¸å®¶ï¼è biginteger åæ¯å¯¹å¤§æ°è¿è¡ç§å­¦è®¡ç®çä¸å®¶ã\n\nbiginteger i = new biginteger(string.valueof(long.max_value));\nsystem.out.println(i.add(biginteger.one).tostring());\n\ntry {\n    long l = i.add(biginteger.one).longvalueexact();\n} catch (exception ex) {\n    ex.printstacktrace();\n}\n\n\n\n# åèèµæ\n\n * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * java åºæ¬æ°æ®ç±»ååå¼ç¨ç±»å\n * æ·±å¥åæ java ä¸­çè£ç®±åæç®±',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java åºç¡è¯­æ³ç¹æ§",frontmatter:{title:"Java åºç¡è¯­æ³ç¹æ§",date:"2022-01-25T07:31:16.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE"],permalink:"/pages/2950ba/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/01.Java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/01.Javaåºç¡è¯­æ³.md",key:"v-dfab5e76",path:"/pages/2950ba/",headers:[{level:2,title:"æ³¨é",slug:"æ³¨é",normalizedTitle:"æ³¨é",charIndex:18},{level:2,title:"åºæ¬æ°æ®ç±»å",slug:"åºæ¬æ°æ®ç±»å",normalizedTitle:"åºæ¬æ°æ®ç±»å",charIndex:329},{level:2,title:"åé",slug:"åé",normalizedTitle:"åé",charIndex:370},{level:2,title:"æ°ç»",slug:"æ°ç»",normalizedTitle:"æ°ç»",charIndex:2504},{level:2,title:"æä¸¾",slug:"æä¸¾",normalizedTitle:"æä¸¾",charIndex:2537},{level:2,title:"æä½ç¬¦",slug:"æä½ç¬¦",normalizedTitle:"æä½ç¬¦",charIndex:2570},{level:2,title:"æ¹æ³",slug:"æ¹æ³",normalizedTitle:"æ¹æ³",charIndex:401},{level:2,title:"æ§å¶è¯­å¥",slug:"æ§å¶è¯­å¥",normalizedTitle:"æ§å¶è¯­å¥",charIndex:2652},{level:2,title:"å¼å¸¸",slug:"å¼å¸¸",normalizedTitle:"å¼å¸¸",charIndex:2684},{level:2,title:"æ³å",slug:"æ³å",normalizedTitle:"æ³å",charIndex:2719},{level:2,title:"åå°",slug:"åå°",normalizedTitle:"åå°",charIndex:2752},{level:2,title:"æ³¨è§£",slug:"æ³¨è§£",normalizedTitle:"æ³¨è§£",charIndex:2792},{level:2,title:"åºåå",slug:"åºåå",normalizedTitle:"åºåå",charIndex:2831}],headersStr:"æ³¨é åºæ¬æ°æ®ç±»å åé æ°ç» æä¸¾ æä½ç¬¦ æ¹æ³ æ§å¶è¯­å¥ å¼å¸¸ æ³å åå° æ³¨è§£ åºåå",content:'# Java åºç¡è¯­æ³ç¹æ§\n\n\n# æ³¨é\n\nç©ºç½è¡ï¼æèæ³¨éçåå®¹ï¼é½ä¼è¢« Java ç¼è¯å¨å¿½ç¥æã\n\nJava æ¯æå¤ç§æ³¨éæ¹å¼ï¼ä¸é¢çç¤ºä¾å±ç¤ºäºåç§æ³¨éçä½¿ç¨æ¹å¼ï¼\n\npublic class HelloWorld {\n    /*\n     * JavaDoc æ³¨é\n     */\n    public static void main(String[] args) {\n        // åè¡æ³¨é\n        /* å¤è¡æ³¨éï¼\n           1. æ³¨æç¹a\n           2. æ³¨æç¹b\n         */\n        System.out.println("Hello World");\n    }\n}\n\n\n\n# åºæ¬æ°æ®ç±»å\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java åºæ¬æ°æ®ç±»å\n\n\n# åé\n\nJava æ¯æçåéç±»åæï¼\n\n * å±é¨åé - ç±»æ¹æ³ä¸­çåéã\n * å®ä¾åéï¼ä¹å«æååéï¼ - ç±»æ¹æ³å¤çåéï¼ä¸è¿æ²¡æ static ä¿®é¥°ã\n * ç±»åéï¼ä¹å«éæåéï¼ - ç±»æ¹æ³å¤çåéï¼ç¨ static ä¿®é¥°ã\n\nç¹æ§å¯¹æ¯ï¼\n\nå±é¨åé                                                            å®ä¾åéï¼ä¹å«æååéï¼                                                             ç±»åéï¼ä¹å«éæåéï¼\nå±é¨åéå£°æå¨æ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­ã                                           å®ä¾åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ã                                                    ç±»åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ãå¹¶ä¸ä»¥ static ä¿®é¥°ã\nå±é¨åéå¨æ¹æ³ãæé æ¹æ³ãæèè¯­å¥åè¢«æ§è¡çæ¶ååå»ºï¼å½å®ä»¬æ§è¡å®æåï¼åéå°ä¼è¢«éæ¯ã                    å®ä¾åéå¨å¯¹è±¡åå»ºçæ¶ååå»ºï¼å¨å¯¹è±¡è¢«éæ¯çæ¶åéæ¯ã                                              ç±»åéå¨ç¬¬ä¸æ¬¡è¢«è®¿é®æ¶åå»ºï¼å¨ç¨åºç»ææ¶éæ¯ã\nå±é¨åéæ²¡æé»è®¤å¼ï¼æä»¥å¿é¡»ç»è¿åå§åï¼æå¯ä»¥ä½¿ç¨ã                                      å®ä¾åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯                      ç±»åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯\n                                                                nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ã                                           nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ãæ­¤å¤ï¼éæåéè¿å¯ä»¥å¨éæè¯­å¥åä¸­åå§åã\nå¯¹äºå±é¨åéï¼å¦ææ¯åºæ¬ç±»åï¼ä¼æå¼ç´æ¥å­å¨å¨æ ï¼å¦ææ¯å¼ç¨ç±»åï¼ä¼æå¶å¯¹è±¡å­å¨å¨å ï¼èæè¿ä¸ªå¯¹è±¡çå¼ç¨ï¼æéï¼å­å¨å¨æ ã   å®ä¾åéå­å¨å¨å ã                                                                ç±»åéå­å¨å¨éæå­å¨åºã\nè®¿é®ä¿®é¥°ç¬¦ä¸è½ç¨äºå±é¨åéã                                                  è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºå®ä¾åéã                                                           è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºç±»åéã\nå±é¨åéåªå¨å£°æå®çæ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­å¯è§ã                                      å®ä¾åéå¯¹äºç±»ä¸­çæ¹æ³ãæé æ¹æ³æèè¯­å¥åæ¯å¯è§çãä¸è¬æåµä¸åºè¯¥æå®ä¾åéè®¾ä¸ºç§æãéè¿ä½¿ç¨è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾åéå¯¹å­ç±»å¯è§ã        ä¸å®ä¾åéå·æç¸ä¼¼çå¯è§æ§ãä½ä¸ºäºå¯¹ç±»çä½¿ç¨èå¯è§ï¼å¤§å¤æ°éæåéå£°æä¸º public ç±»åã\n                                                                å®ä¾åéå¯ä»¥ç´æ¥éè¿åéåè®¿é®ãä½å¨éææ¹æ³ä»¥åå¶ä»ç±»ä¸­ï¼å°±åºè¯¥ä½¿ç¨å®å¨éå®åï¼ObejectReference.VariableNameã   éæåéå¯ä»¥éè¿ï¼ClassName.VariableName çæ¹å¼è®¿é®ã\n                                                                                                                                         æ è®ºä¸ä¸ªç±»åå»ºäºå¤å°ä¸ªå¯¹è±¡ï¼ç±»åªæ¥æç±»åéçä¸ä»½æ·è´ã\n                                                                                                                                         ç±»åéé¤äºè¢«å£°æä¸ºå¸¸éå¤å¾å°ä½¿ç¨ã\n\nåéä¿®é¥°ç¬¦\n\n * è®¿é®çº§å«ä¿®é¥°ç¬¦\n   * å¦æåéæ¯å®ä¾åéæç±»åéï¼å¯ä»¥æ·»å è®¿é®çº§å«ä¿®é¥°ç¬¦ï¼public/protected/privateï¼\n * éæä¿®é¥°ç¬¦\n   * å¦æåéæ¯ç±»åéï¼éè¦æ·»å  static ä¿®é¥°\n * final\n   * å¦æåéä½¿ç¨ final ä¿®é¥°ç¬¦ï¼å°±è¡¨ç¤ºè¿æ¯ä¸ä¸ªå¸¸éï¼ä¸è½è¢«ä¿®æ¹ã\n\n\n# æ°ç»\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java æ°ç»\n\n\n# æä¸¾\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java æä¸¾\n\n\n# æä½ç¬¦\n\nJava ä¸­æ¯æçæä½ç¬¦ç±»åå¦ä¸ï¼\n\n\n\n> ð æ©å±éè¯»ï¼Java æä½ç¬¦\n\n\n# æ¹æ³\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java æ¹æ³\n\n\n# æ§å¶è¯­å¥\n\n\n\n> ð æ©å±éè¯»ï¼Java æ§å¶è¯­å¥\n\n\n# å¼å¸¸\n\n\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java å¼å¸¸\n\n\n# æ³å\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java æ³å\n\n\n# åå°\n\n\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java åå°åå¨æä»£ç\n\n\n# æ³¨è§£\n\n\n\n\n\n\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ Java æ³¨è§£\n\n\n# åºåå\n\n\n\n> ð æ©å±éè¯»ï¼Java åºåå',normalizedContent:'# java åºç¡è¯­æ³ç¹æ§\n\n\n# æ³¨é\n\nç©ºç½è¡ï¼æèæ³¨éçåå®¹ï¼é½ä¼è¢« java ç¼è¯å¨å¿½ç¥æã\n\njava æ¯æå¤ç§æ³¨éæ¹å¼ï¼ä¸é¢çç¤ºä¾å±ç¤ºäºåç§æ³¨éçä½¿ç¨æ¹å¼ï¼\n\npublic class helloworld {\n    /*\n     * javadoc æ³¨é\n     */\n    public static void main(string[] args) {\n        // åè¡æ³¨é\n        /* å¤è¡æ³¨éï¼\n           1. æ³¨æç¹a\n           2. æ³¨æç¹b\n         */\n        system.out.println("hello world");\n    }\n}\n\n\n\n# åºæ¬æ°æ®ç±»å\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java åºæ¬æ°æ®ç±»å\n\n\n# åé\n\njava æ¯æçåéç±»åæï¼\n\n * å±é¨åé - ç±»æ¹æ³ä¸­çåéã\n * å®ä¾åéï¼ä¹å«æååéï¼ - ç±»æ¹æ³å¤çåéï¼ä¸è¿æ²¡æ static ä¿®é¥°ã\n * ç±»åéï¼ä¹å«éæåéï¼ - ç±»æ¹æ³å¤çåéï¼ç¨ static ä¿®é¥°ã\n\nç¹æ§å¯¹æ¯ï¼\n\nå±é¨åé                                                            å®ä¾åéï¼ä¹å«æååéï¼                                                             ç±»åéï¼ä¹å«éæåéï¼\nå±é¨åéå£°æå¨æ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­ã                                           å®ä¾åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ã                                                    ç±»åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ãå¹¶ä¸ä»¥ static ä¿®é¥°ã\nå±é¨åéå¨æ¹æ³ãæé æ¹æ³ãæèè¯­å¥åè¢«æ§è¡çæ¶ååå»ºï¼å½å®ä»¬æ§è¡å®æåï¼åéå°ä¼è¢«éæ¯ã                    å®ä¾åéå¨å¯¹è±¡åå»ºçæ¶ååå»ºï¼å¨å¯¹è±¡è¢«éæ¯çæ¶åéæ¯ã                                              ç±»åéå¨ç¬¬ä¸æ¬¡è¢«è®¿é®æ¶åå»ºï¼å¨ç¨åºç»ææ¶éæ¯ã\nå±é¨åéæ²¡æé»è®¤å¼ï¼æä»¥å¿é¡»ç»è¿åå§åï¼æå¯ä»¥ä½¿ç¨ã                                      å®ä¾åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯                      ç±»åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯\n                                                                nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ã                                           nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ãæ­¤å¤ï¼éæåéè¿å¯ä»¥å¨éæè¯­å¥åä¸­åå§åã\nå¯¹äºå±é¨åéï¼å¦ææ¯åºæ¬ç±»åï¼ä¼æå¼ç´æ¥å­å¨å¨æ ï¼å¦ææ¯å¼ç¨ç±»åï¼ä¼æå¶å¯¹è±¡å­å¨å¨å ï¼èæè¿ä¸ªå¯¹è±¡çå¼ç¨ï¼æéï¼å­å¨å¨æ ã   å®ä¾åéå­å¨å¨å ã                                                                ç±»åéå­å¨å¨éæå­å¨åºã\nè®¿é®ä¿®é¥°ç¬¦ä¸è½ç¨äºå±é¨åéã                                                  è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºå®ä¾åéã                                                           è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºç±»åéã\nå±é¨åéåªå¨å£°æå®çæ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­å¯è§ã                                      å®ä¾åéå¯¹äºç±»ä¸­çæ¹æ³ãæé æ¹æ³æèè¯­å¥åæ¯å¯è§çãä¸è¬æåµä¸åºè¯¥æå®ä¾åéè®¾ä¸ºç§æãéè¿ä½¿ç¨è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾åéå¯¹å­ç±»å¯è§ã        ä¸å®ä¾åéå·æç¸ä¼¼çå¯è§æ§ãä½ä¸ºäºå¯¹ç±»çä½¿ç¨èå¯è§ï¼å¤§å¤æ°éæåéå£°æä¸º public ç±»åã\n                                                                å®ä¾åéå¯ä»¥ç´æ¥éè¿åéåè®¿é®ãä½å¨éææ¹æ³ä»¥åå¶ä»ç±»ä¸­ï¼å°±åºè¯¥ä½¿ç¨å®å¨éå®åï¼obejectreference.variablenameã   éæåéå¯ä»¥éè¿ï¼classname.variablename çæ¹å¼è®¿é®ã\n                                                                                                                                         æ è®ºä¸ä¸ªç±»åå»ºäºå¤å°ä¸ªå¯¹è±¡ï¼ç±»åªæ¥æç±»åéçä¸ä»½æ·è´ã\n                                                                                                                                         ç±»åéé¤äºè¢«å£°æä¸ºå¸¸éå¤å¾å°ä½¿ç¨ã\n\nåéä¿®é¥°ç¬¦\n\n * è®¿é®çº§å«ä¿®é¥°ç¬¦\n   * å¦æåéæ¯å®ä¾åéæç±»åéï¼å¯ä»¥æ·»å è®¿é®çº§å«ä¿®é¥°ç¬¦ï¼public/protected/privateï¼\n * éæä¿®é¥°ç¬¦\n   * å¦æåéæ¯ç±»åéï¼éè¦æ·»å  static ä¿®é¥°\n * final\n   * å¦æåéä½¿ç¨ final ä¿®é¥°ç¬¦ï¼å°±è¡¨ç¤ºè¿æ¯ä¸ä¸ªå¸¸éï¼ä¸è½è¢«ä¿®æ¹ã\n\n\n# æ°ç»\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java æ°ç»\n\n\n# æä¸¾\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java æä¸¾\n\n\n# æä½ç¬¦\n\njava ä¸­æ¯æçæä½ç¬¦ç±»åå¦ä¸ï¼\n\n\n\n> ð æ©å±éè¯»ï¼java æä½ç¬¦\n\n\n# æ¹æ³\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java æ¹æ³\n\n\n# æ§å¶è¯­å¥\n\n\n\n> ð æ©å±éè¯»ï¼java æ§å¶è¯­å¥\n\n\n# å¼å¸¸\n\n\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java å¼å¸¸\n\n\n# æ³å\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java æ³å\n\n\n# åå°\n\n\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java åå°åå¨æä»£ç\n\n\n# æ³¨è§£\n\n\n\n\n\n\n\n\n\n> ð æ©å±éè¯»ï¼æ·±å¥çè§£ java æ³¨è§£\n\n\n# åºåå\n\n\n\n> ð æ©å±éè¯»ï¼java åºåå',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java é¢åå¯¹è±¡",frontmatter:{title:"Java é¢åå¯¹è±¡",date:"2020-08-06T18:20:39.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","é¢åå¯¹è±¡"],permalink:"/pages/3e1661/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/03.Java%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/03.Javaé¢åå¯¹è±¡.md",key:"v-772ffd48",path:"/pages/3e1661/",headers:[{level:2,title:"é¢åå¯¹è±¡",slug:"é¢åå¯¹è±¡",normalizedTitle:"é¢åå¯¹è±¡",charIndex:7},{level:3,title:"å°è£",slug:"å°è£",normalizedTitle:"å°è£",charIndex:708},{level:3,title:"ç»§æ¿",slug:"ç»§æ¿",normalizedTitle:"ç»§æ¿",charIndex:343},{level:4,title:"ç»§æ¿ç±»å",slug:"ç»§æ¿ç±»å",normalizedTitle:"ç»§æ¿ç±»å",charIndex:1214},{level:4,title:"ç»§æ¿çç¹æ§",slug:"ç»§æ¿çç¹æ§",normalizedTitle:"ç»§æ¿çç¹æ§",charIndex:1224},{level:4,title:"ç»§æ¿å³é®å­",slug:"ç»§æ¿å³é®å­",normalizedTitle:"ç»§æ¿å³é®å­",charIndex:1520},{level:3,title:"å¤æ",slug:"å¤æ",normalizedTitle:"å¤æ",charIndex:1664},{level:2,title:"ç±»",slug:"ç±»",normalizedTitle:"ç±»",charIndex:25},{level:2,title:"æ¹æ³",slug:"æ¹æ³",normalizedTitle:"æ¹æ³",charIndex:756},{level:3,title:"æ¹æ³å®ä¹",slug:"æ¹æ³å®ä¹",normalizedTitle:"æ¹æ³å®ä¹",charIndex:2327},{level:3,title:"æ¹æ³è°ç¨",slug:"æ¹æ³è°ç¨",normalizedTitle:"æ¹æ³è°ç¨",charIndex:2761},{level:3,title:"æé æ¹æ³",slug:"æé æ¹æ³",normalizedTitle:"æé æ¹æ³",charIndex:1256},{level:2,title:"åé",slug:"åé",normalizedTitle:"åé",charIndex:888},{level:3,title:"åéä¿®é¥°ç¬¦",slug:"åéä¿®é¥°ç¬¦",normalizedTitle:"åéä¿®é¥°ç¬¦",charIndex:5223},{level:3,title:"åå»ºå¯¹è±¡",slug:"åå»ºå¯¹è±¡",normalizedTitle:"åå»ºå¯¹è±¡",charIndex:399},{level:3,title:"è®¿é®å®ä¾åéåæ¹æ³",slug:"è®¿é®å®ä¾åéåæ¹æ³",normalizedTitle:"è®¿é®å®ä¾åéåæ¹æ³",charIndex:5777},{level:2,title:"è®¿é®æéæ§å¶",slug:"è®¿é®æéæ§å¶",normalizedTitle:"è®¿é®æéæ§å¶",charIndex:5930},{level:3,title:"ä»£ç ç»ç»",slug:"ä»£ç ç»ç»",normalizedTitle:"ä»£ç ç»ç»",charIndex:5941},{level:4,title:"package",slug:"package",normalizedTitle:"package",charIndex:6523},{level:4,title:"import",slug:"import",normalizedTitle:"import",charIndex:1648},{level:3,title:"è®¿é®æéä¿®é¥°å³é®å­",slug:"è®¿é®æéä¿®é¥°å³é®å­",normalizedTitle:"è®¿é®æéä¿®é¥°å³é®å­",charIndex:7501},{level:2,title:"æ¥å£",slug:"æ¥å£",normalizedTitle:"æ¥å£",charIndex:739},{level:2,title:"æ½è±¡ç±»",slug:"æ½è±¡ç±»",normalizedTitle:"æ½è±¡ç±»",charIndex:8007},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8470}],headersStr:"é¢åå¯¹è±¡ å°è£ ç»§æ¿ ç»§æ¿ç±»å ç»§æ¿çç¹æ§ ç»§æ¿å³é®å­ å¤æ ç±» æ¹æ³ æ¹æ³å®ä¹ æ¹æ³è°ç¨ æé æ¹æ³ åé åéä¿®é¥°ç¬¦ åå»ºå¯¹è±¡ è®¿é®å®ä¾åéåæ¹æ³ è®¿é®æéæ§å¶ ä»£ç ç»ç» package import è®¿é®æéä¿®é¥°å³é®å­ æ¥å£ æ½è±¡ç±» åèèµæ",content:'# Java é¢åå¯¹è±¡\n\n> å¨Java åºæ¬æ°æ®ç±»å ä¸­æä»¬äºè§£ Java ä¸­æ¯æçåºæ¬æ°æ®ç±»åï¼å¼ç±»åï¼ãæ¬æå¼å§è®²è§£ Java ä¸­éè¦çå¼ç¨ç±»åââç±»ã\n\n\n# é¢åå¯¹è±¡\n\næ¯ç§ç¼ç¨è¯­è¨ï¼é½æèªå·±çæçºµåå­ä¸­åç´ çæ¹å¼ã\n\nJava ä¸­æä¾äºåºæ¬æ°æ®ç±»åï¼ä½è¿è¿ä¸è½æ»¡è¶³ç¼åç¨åºæ¶ï¼éè¦æ½è±¡æ´å å¤ææ°æ®ç±»åçéè¦ãå æ­¤ï¼Java ä¸­ï¼åè®¸å¼åèéè¿ç±»ï¼ç±»çæºå¶ä¸é¢ä¼è®²å°ï¼åå»ºèªå®ä¹ç±»åã\n\næäºèªå®ä¹ç±»åï¼é£ä¹æ°æ®ç±»åèªç¶ä¼ååä¸åï¼æä»¥ï¼å¿é¡»è¦æä¸å®çæºå¶ï¼ä½¿å¾å®ä»¬ä»ç¶ä¿æä¸äºå¿è¦çãéç¨çç¹æ§ã\n\nJava ä¸çæä¸å¥åè¨ï¼ä¸åçä¸ºå¯¹è±¡ãè¿å¥è¯ï¼ä½ å¯è½ç¬¬ä¸å¤©å­¦ Java æ¶ï¼å°±å¬è¿äºãè¿ä¸ä»ä»æ¯ä¸å¥å£å·ï¼ä¹ä½ç°å¨ Java çè®¾è®¡ä¸ã\n\n * é¦åï¼ææ Java ç±»é½ç»§æ¿èª Object ç±»ï¼ä»è¿ä¸ªåå­ï¼å°±å¯è§ä¸æï¼ã\n * å ä¹ææ Java å¯¹è±¡åå§åæ¶ï¼é½è¦ä½¿ç¨ new åå»ºå¯¹è±¡ï¼åºæ¬æ°æ®ç±»åãStringãæä¸¾ç¹æ®å¤çï¼ï¼å¯¹è±¡å­å¨å¨å ä¸­ã\n\n// ä¸é¢ä¸¤\nString s = "abc";\nString s = new String("abc");\n\n\nå¶ä¸­ï¼String s å®ä¹äºä¸ä¸ªåä¸º s çå¼ç¨ï¼å®æåä¸ä¸ª String ç±»åçå¯¹è±¡ï¼èå®éçå¯¹è±¡æ¯ âabcâ å­ç¬¦ä¸²ãè¿å°±åæ¯ï¼ä½¿ç¨é¥æ§å¨ï¼å¼ç¨ï¼æ¥æçºµçµè§æºï¼å¯¹è±¡ï¼ã\n\nä¸ C/C++ è¿ç±»è¯­è¨ä¸åï¼ç¨åºååªéè¦éè¿ new åå»ºä¸ä¸ªå¯¹è±¡ï¼ä½ä¸å¿è´è´£éæ¯æç»æä¸ä¸ªå¯¹è±¡ãè´è´£è¿è¡ Java ç¨åºç Java èææºæä¸ä¸ªåå¾åæ¶å¨ï¼å®ä¼çè§ new åå»ºçå¯¹è±¡ï¼ä¸æ¦åç°å¯¹è±¡ä¸åè¢«å¼ç¨ï¼åä¼éæ¾å¯¹è±¡çåå­ç©ºé´ã\n\n\n# å°è£\n\nå°è£ï¼Encapsulationï¼æ¯æä¸ç§å°æ½è±¡æ§å½å¼æ¥å£çå®ç°ç»èé¨ä»½åè£ãéèèµ·æ¥çæ¹æ³ã\n\nå°è£æä¸»è¦çä½ç¨å¨äºæä»¬è½ä¿®æ¹èªå·±çå®ç°ä»£ç ï¼èä¸ç¨ä¿®æ¹é£äºè°ç¨æä»¬ä»£ç çç¨åºçæ®µã\n\néå½çå°è£å¯ä»¥è®©ç¨å¼ç æ´å®¹æçè§£ä¸ç»´æ¤ï¼ä¹å å¼ºäºç¨å¼ç çå®å¨æ§ã\n\nå°è£çä¼ç¹ï¼\n\n * è¯å¥½çå°è£è½å¤åå°è¦åã\n * ç±»åé¨çç»æå¯ä»¥èªç±ä¿®æ¹ã\n * å¯ä»¥å¯¹æååéè¿è¡æ´ç²¾ç¡®çæ§å¶ã\n * éèä¿¡æ¯ï¼å®ç°ç»èã\n\nå®ç°å°è£çæ­¥éª¤ï¼\n\n 1. ä¿®æ¹å±æ§çå¯è§æ§æ¥éå¶å¯¹å±æ§çè®¿é®ï¼ä¸è¬éå¶ä¸º privateï¼ã\n 2. å¯¹æ¯ä¸ªå¼å±æ§æä¾å¯¹å¤çå¬å±æ¹æ³è®¿é®ï¼ä¹å°±æ¯åå»ºä¸å¯¹èµåå¼æ¹æ³ï¼ç¨äºå¯¹ç§æå±æ§çè®¿é®ã\n\n\n# ç»§æ¿\n\nç»§æ¿æ¯ java é¢åå¯¹è±¡ç¼ç¨ææ¯çä¸ååºç³ï¼å ä¸ºå®åè®¸åå»ºåç­çº§å±æ¬¡çç±»ã\n\nç»§æ¿å°±æ¯å­ç±»ç»§æ¿ç¶ç±»çç¹å¾åè¡ä¸ºï¼ä½¿å¾å­ç±»å¯¹è±¡ï¼å®ä¾ï¼å·æç¶ç±»çå®ä¾ååæ¹æ³ï¼æå­ç±»ä»ç¶ç±»ç»§æ¿æ¹æ³ï¼ä½¿å¾å­ç±»å·æç¶ç±»ç¸åçè¡ä¸ºã\n\nç°å®ä¸­çä¾å­ï¼\n\nçåé¸é½æ¯å¨ç©ãå¦æå°çãé¸ä½ä¸ºç±»ï¼å®ä»¬å¯ä»¥ç»§æ¿å¨ç©ç±»ã\n\n\n\nç±»çç»§æ¿å½¢å¼ï¼\n\nclass ç¶ç±» {}\n\nclass å­ç±» extends ç¶ç±» {}\n\n\n# ç»§æ¿ç±»å\n\n\n\n# ç»§æ¿çç¹æ§\n\n * å­ç±»å¯ä»¥ç»§æ¿ç¶ç±»çå±æ§åæ¹æ³ãéè¦æ³¨æçæ¯ï¼æé æ¹æ³é¤å¤ï¼æé æ¹æ³åªè½è¢«è°ç¨ï¼èä¸è½è¢«ç»§æ¿ã\n * å­ç±»å¯ä»¥æ¥æèªå·±çå±æ§åæ¹æ³ï¼å³å­ç±»å¯ä»¥å¯¹ç¶ç±»è¿è¡æ©å±ã\n * å­ç±»å¯ä»¥ç¨èªå·±çæ¹å¼å®ç°ç¶ç±»çæ¹æ³ã\n * Java çç»§æ¿æ¯åç»§æ¿ï¼ä½æ¯å¯ä»¥å¤éç»§æ¿ï¼åç»§æ¿å°±æ¯ä¸ä¸ªå­ç±»åªè½ç»§æ¿ä¸ä¸ªç¶ç±»ï¼å¤éç»§æ¿å°±æ¯ï¼ä¾å¦ A ç±»ç»§æ¿ B ç±»ï¼B ç±»ç»§æ¿ C ç±»ï¼æä»¥æç§å³ç³»å°±æ¯ C ç±»æ¯ B ç±»çç¶ç±»ï¼B ç±»æ¯ A ç±»çç¶ç±»ï¼è¿æ¯ Java ç»§æ¿åºå«äº C++ ç»§æ¿çä¸ä¸ªç¹æ§ã\n * æé«äºç±»ä¹é´çè¦åæ§ï¼ç»§æ¿çç¼ºç¹ï¼è¦ååº¦é«å°±ä¼é æä»£ç ä¹é´çèç³»è¶ç´§å¯ï¼ä»£ç ç¬ç«æ§è¶å·®ï¼ã\n\n# ç»§æ¿å³é®å­\n\nç»§æ¿å¯ä»¥ä½¿ç¨ extends å implements è¿ä¸¤ä¸ªå³é®å­æ¥å®ç°ç»§æ¿ï¼èä¸ææçç±»é½æ¯ç»§æ¿äº java.lang.Objectï¼å½ä¸ä¸ªç±»æ²¡æç»§æ¿çä¸¤ä¸ªå³é®å­ï¼åé»è®¤ç»§æ¿ Objectï¼è¿ä¸ªç±»å¨ java.lang åä¸­ï¼æä»¥ä¸éè¦ importï¼ç¥åç±»ã\n\n\n# å¤æ\n\nåå¼å§å­¦ä¹ é¢åå¯¹è±¡ç¼ç¨æ¶ï¼å®¹æè¢«åç§æ¯è¯­å¼å¾äºéé¾éãæä»¥ï¼å¾å¤äººä¼æ­»è®°ç¡¬èä¹¦ä¸­å¯¹äºæ¯è¯­çå®ä¹ã\n\nä½æ¯ï¼éçåºç¨åçè§£çæ·±å¥ï¼åºè¯¥ä¼æ¸æ¸ææ´è¿ä¸æ­¥çè®¤è¯ï¼å°å¶èæ±è´¯éççè§£ã\n\nå­¦ä¹ ç±»ä¹åï¼åè®©æä»¬æèä¸ä¸ªé®é¢ï¼Java ä¸­ä¸ºä»ä¹è¦å¼å¥ç±»æºå¶ï¼è®¾è®¡çåè¡·æ¯ä»ä¹ï¼\n\nJava ä¸­æä¾çåºæ¬æ°æ®ç±»åï¼åªè½è¡¨ç¤ºåä¸çæ°å¼ï¼è¿ç¨äºæ°å¼è®¡ç®ï¼è¿ OKãä½æ¯ï¼å¦æè¦æ½è±¡æ¨¡æç°å®ä¸­æ´å¤æçäºç©ï¼åæ æ³åå°ã\n\nè¯æ³ï¼å¦æè¦è®©ä½ æ½è±¡ççæ°æ®æ¨¡åï¼æä¹åï¼çæç¼è³å£é¼»ç­å¨å®ï¼æè¿ï¼çæå¤§å°ï¼æ¯è²ï¼è¿äºé½æ¯å®çç¶æï¼çä¼è·ãä¼å«ãä¼åä¸è¥¿ï¼è¿äºæ¯å®çè¡ä¸ºã\n\nç±»çå¼å¥ï¼å°±æ¯ä¸ºäºæ½è±¡è¿ç§ç¸å¯¹å¤æçäºç©ã\n\nå¯¹è±¡æ¯ç¨äºè®¡ç®æºè¯­è¨å¯¹é®é¢åä¸­äºç©çæè¿°ãå¯¹è±¡éè¿æ¹æ³åå±æ§æ¥åå«æè¿°äºç©æå·æçè¡ä¸ºåç¶æã\n\nç±»æ¯ç¨äºæè¿°åä¸ç±»çå¯¹è±¡çä¸ä¸ªæ½è±¡çæ¦å¿µï¼ç±»ä¸­å®ä¹äºè¿ä¸ç±»å¯¹è±¡æå·æçè¡ä¸ºåç¶æã\n\nç±»å¯ä»¥çææ¯åå»º Java å¯¹è±¡çæ¨¡æ¿ã\n\nä»ä¹æ¯æ¹æ³ï¼æ©å±éè¯»ï¼é¢åå¯¹è±¡ç¼ç¨çå¼ç«¯æ¯ä»ä¹ï¼ - invalid s çåç­\n\n\n# ç±»\n\nä¸å¤§å¤æ°é¢åå¯¹è±¡ç¼ç¨è¯­è¨ä¸æ ·ï¼Java ä½¿ç¨ class ï¼ç±»ï¼å³é®å­æ¥è¡¨ç¤ºèªå®ä¹ç±»åãèªå®ä¹ç±»åæ¯ä¸ºäºæ´å®¹ææ½è±¡ç°å®äºç©ã\n\nå¨ä¸ä¸ªç±»ä¸­ï¼å¯ä»¥è®¾ç½®ä¸éä¸å¨ä¸¤ç§åç´ ï¼å±æ§ï¼éï¼åæ¹æ³ï¼å¨ï¼ã\n\n * å±æ§ï¼æçäººåæ¬¢ç§°ä¸ºæåãå­æ®µï¼ - å±æ§æ½è±¡çæ¯äºç©çç¶æãç±»å±æ§å¯ä»¥æ¯ä»»ä½ç±»åçå¯¹è±¡ã\n * æ¹æ³ï¼æçäººåæ¬¢ç§°ä¸ºå½æ°ï¼ - æ¹æ³æ½è±¡çæ¯äºç©çè¡ä¸ºã\n\nç±»çå½¢å¼å¦ä¸ï¼\n\n\n\n\n# æ¹æ³\n\n\n# æ¹æ³å®ä¹\n\nä¿®é¥°ç¬¦ è¿åå¼ç±»å æ¹æ³å(åæ°ç±»å åæ°å){\n    ...\n    æ¹æ³ä½\n    ...\n    return è¿åå¼;\n}\n\n\næ¹æ³åå«ä¸ä¸ªæ¹æ³å¤´åä¸ä¸ªæ¹æ³ä½ãä¸é¢æ¯ä¸ä¸ªæ¹æ³çææé¨åï¼\n\n * **ä¿®é¥°ç¬¦ï¼**ä¿®é¥°ç¬¦ï¼è¿æ¯å¯éçï¼åè¯ç¼è¯å¨å¦ä½è°ç¨è¯¥æ¹æ³ãå®ä¹äºè¯¥æ¹æ³çè®¿é®ç±»åã\n * **è¿åå¼ç±»å ï¼**æ¹æ³å¯è½æè¿åå¼ãå¦ææ²¡æè¿åå¼ï¼è¿ç§æåµä¸ï¼è¿åå¼ç±»ååºè®¾ä¸º voidã\n * **æ¹æ³åï¼**æ¯æ¹æ³çå®éåç§°ãæ¹æ³åååæ°è¡¨å±åæææ¹æ³ç­¾åã\n * **åæ°ç±»åï¼**åæ°åæ¯ä¸ä¸ªå ä½ç¬¦ãå½æ¹æ³è¢«è°ç¨æ¶ï¼ä¼ éå¼ç»åæ°ãè¿ä¸ªå¼è¢«ç§°ä¸ºå®åæåéãåæ°åè¡¨æ¯ææ¹æ³çåæ°ç±»åãé¡ºåºååæ°çä¸ªæ°ãåæ°æ¯å¯éçï¼æ¹æ³å¯ä»¥ä¸åå«ä»»ä½åæ°ã\n * **æ¹æ³ä½ï¼**æ¹æ³ä½åå«å·ä½çè¯­å¥ï¼å®ä¹è¯¥æ¹æ³çåè½ã\n\nç¤ºä¾ï¼\n\npublic static int add(int x, int y) {\n   return x + y;\n}\n\n\n\n# æ¹æ³è°ç¨\n\nJava æ¯æä¸¤ç§è°ç¨æ¹æ³çæ¹å¼ï¼æ ¹æ®æ¹æ³æ¯å¦è¿åå¼æ¥éæ©ã\n\nå½ç¨åºè°ç¨ä¸ä¸ªæ¹æ³æ¶ï¼ç¨åºçæ§å¶æäº¤ç»äºè¢«è°ç¨çæ¹æ³ãå½è¢«è°ç¨æ¹æ³çè¿åè¯­å¥æ§è¡æèå°è¾¾æ¹æ³ä½é­æ¬å·æ¶åäº¤è¿æ§å¶æç»ç¨åºã\n\nå½æ¹æ³è¿åä¸ä¸ªå¼çæ¶åï¼æ¹æ³è°ç¨éå¸¸è¢«å½åä¸ä¸ªå¼ãä¾å¦ï¼\n\nint larger = max(30, 40);\n\n\nå¦ææ¹æ³è¿åå¼æ¯ voidï¼æ¹æ³è°ç¨ä¸å®æ¯ä¸æ¡è¯­å¥ãä¾å¦ï¼æ¹æ³ println è¿å voidãä¸é¢çè°ç¨æ¯ä¸ªè¯­å¥ï¼\n\nSystem.out.println("Hello World");\n\n\n\n# æé æ¹æ³\n\næ¯ä¸ªç±»é½ææé æ¹æ³ãå¦ææ²¡ææ¾å¼å°ä¸ºç±»å®ä¹ä»»ä½æé æ¹æ³ï¼Java ç¼è¯å¨å°ä¼ä¸ºè¯¥ç±»æä¾ä¸ä¸ªé»è®¤æé æ¹æ³ã\n\nå¨åå»ºä¸ä¸ªå¯¹è±¡çæ¶åï¼è³å°è¦è°ç¨ä¸ä¸ªæé æ¹æ³ãæé æ¹æ³çåç§°å¿é¡»ä¸ç±»ååï¼ä¸ä¸ªç±»å¯ä»¥æå¤ä¸ªæé æ¹æ³ã\n\npublic class Puppy{\n    public Puppy(){\n    }\n\n    public Puppy(String name){\n        // è¿ä¸ªæé å¨ä»æä¸ä¸ªåæ°ï¼name\n    }\n}\n\n\n\n# åé\n\nJava æ¯æçåéç±»åæï¼\n\n * å±é¨åé - ç±»æ¹æ³ä¸­çåéã\n * å®ä¾åéï¼ä¹å«æååéï¼ - ç±»æ¹æ³å¤çåéï¼ä¸è¿æ²¡æ static ä¿®é¥°ã\n * ç±»åéï¼ä¹å«éæåéï¼ - ç±»æ¹æ³å¤çåéï¼ç¨ static ä¿®é¥°ã\n\nç¹æ§å¯¹æ¯ï¼\n\nå±é¨åé                                                            å®ä¾åéï¼ä¹å«æååéï¼                                                             ç±»åéï¼ä¹å«éæåéï¼\nå±é¨åéå£°æå¨æ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­ã                                           å®ä¾åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ã                                                    ç±»åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ãå¹¶ä¸ä»¥ static ä¿®é¥°ã\nå±é¨åéå¨æ¹æ³ãæé æ¹æ³ãæèè¯­å¥åè¢«æ§è¡çæ¶ååå»ºï¼å½å®ä»¬æ§è¡å®æåï¼åéå°ä¼è¢«éæ¯ã                    å®ä¾åéå¨å¯¹è±¡åå»ºçæ¶ååå»ºï¼å¨å¯¹è±¡è¢«éæ¯çæ¶åéæ¯ã                                              ç±»åéå¨ç¬¬ä¸æ¬¡è¢«è®¿é®æ¶åå»ºï¼å¨ç¨åºç»ææ¶éæ¯ã\nå±é¨åéæ²¡æé»è®¤å¼ï¼æä»¥å¿é¡»ç»è¿åå§åï¼æå¯ä»¥ä½¿ç¨ã                                      å®ä¾åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯                      ç±»åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯\n                                                                nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ã                                           nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ãæ­¤å¤ï¼éæåéè¿å¯ä»¥å¨éæè¯­å¥åä¸­åå§åã\nå¯¹äºå±é¨åéï¼å¦ææ¯åºæ¬ç±»åï¼ä¼æå¼ç´æ¥å­å¨å¨æ ï¼å¦ææ¯å¼ç¨ç±»åï¼ä¼æå¶å¯¹è±¡å­å¨å¨å ï¼èæè¿ä¸ªå¯¹è±¡çå¼ç¨ï¼æéï¼å­å¨å¨æ ã   å®ä¾åéå­å¨å¨å ã                                                                ç±»åéå­å¨å¨éæå­å¨åºã\nè®¿é®ä¿®é¥°ç¬¦ä¸è½ç¨äºå±é¨åéã                                                  è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºå®ä¾åéã                                                           è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºç±»åéã\nå±é¨åéåªå¨å£°æå®çæ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­å¯è§ã                                      å®ä¾åéå¯¹äºç±»ä¸­çæ¹æ³ãæé æ¹æ³æèè¯­å¥åæ¯å¯è§çãä¸è¬æåµä¸åºè¯¥æå®ä¾åéè®¾ä¸ºç§æãéè¿ä½¿ç¨è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾åéå¯¹å­ç±»å¯è§ã        ä¸å®ä¾åéå·æç¸ä¼¼çå¯è§æ§ãä½ä¸ºäºå¯¹ç±»çä½¿ç¨èå¯è§ï¼å¤§å¤æ°éæåéå£°æä¸º public ç±»åã\n                                                                å®ä¾åéå¯ä»¥ç´æ¥éè¿åéåè®¿é®ãä½å¨éææ¹æ³ä»¥åå¶ä»ç±»ä¸­ï¼å°±åºè¯¥ä½¿ç¨å®å¨éå®åï¼ObejectReference.VariableNameã   éæåéå¯ä»¥éè¿ï¼ClassName.VariableName çæ¹å¼è®¿é®ã\n                                                                                                                                         æ è®ºä¸ä¸ªç±»åå»ºäºå¤å°ä¸ªå¯¹è±¡ï¼ç±»åªæ¥æç±»åéçä¸ä»½æ·è´ã\n                                                                                                                                         ç±»åéé¤äºè¢«å£°æä¸ºå¸¸éå¤å¾å°ä½¿ç¨ã\n\n\n# åéä¿®é¥°ç¬¦\n\n * è®¿é®çº§å«ä¿®é¥°ç¬¦ - å¦æåéæ¯å®ä¾åéæç±»åéï¼å¯ä»¥æ·»å è®¿é®çº§å«ä¿®é¥°ç¬¦ï¼public/protected/privateï¼\n * éæä¿®é¥°ç¬¦ - å¦æåéæ¯ç±»åéï¼éè¦æ·»å  static ä¿®é¥°\n * final - å¦æåéä½¿ç¨ final ä¿®é¥°ç¬¦ï¼å°±è¡¨ç¤ºè¿æ¯ä¸ä¸ªå¸¸éï¼ä¸è½è¢«ä¿®æ¹ã\n\n\n# åå»ºå¯¹è±¡\n\nå¯¹è±¡æ¯æ ¹æ®ç±»åå»ºçãå¨ Java ä¸­ï¼ä½¿ç¨å³é®å­ new æ¥åå»ºä¸ä¸ªæ°çå¯¹è±¡ãåå»ºå¯¹è±¡éè¦ä»¥ä¸ä¸æ­¥ï¼\n\n * å£°æï¼å£°æä¸ä¸ªå¯¹è±¡ï¼åæ¬å¯¹è±¡åç§°åå¯¹è±¡ç±»åã\n * å®ä¾åï¼ä½¿ç¨å³é®å­ new æ¥åå»ºä¸ä¸ªå¯¹è±¡ã\n * åå§åï¼ä½¿ç¨ new åå»ºå¯¹è±¡æ¶ï¼ä¼è°ç¨æé æ¹æ³åå§åå¯¹è±¡ã\n\npublic class Puppy{\n   public Puppy(String name){\n      //è¿ä¸ªæé å¨ä»æä¸ä¸ªåæ°ï¼name\n      System.out.println("å°ççåå­æ¯ : " + name );\n   }\n   public static void main(String[] args){\n      // ä¸é¢çè¯­å¥å°åå»ºä¸ä¸ªPuppyå¯¹è±¡\n      Puppy myPuppy = new Puppy( "tommy" );\n   }\n}\n\n\n\n# è®¿é®å®ä¾åéåæ¹æ³\n\n/* å®ä¾åå¯¹è±¡ */\nObjectReference = new Constructor();\n/* è®¿é®ç±»ä¸­çåé */\nObjectReference.variableName;\n/* è®¿é®ç±»ä¸­çæ¹æ³ */\nObjectReference.methodName();\n\n\n\n# è®¿é®æéæ§å¶\n\n\n# ä»£ç ç»ç»\n\nå½ç¼è¯ä¸ä¸ª .java æä»¶æ¶ï¼å¨ .java æä»¶ä¸­çæ¯ä¸ªç±»é½ä¼è¾åºä¸ä¸ªä¸ç±»ååç .class æä»¶ã\n\nMultiClassDemo.java ç¤ºä¾ï¼\n\nclass MultiClass1 {}\n\nclass MultiClass2 {}\n\nclass MultiClass3 {}\n\npublic class MultiClassDemo {}\n\n\næ§è¡ javac MultiClassDemo.java å½ä»¤ï¼æ¬å°ä¼çæ MultiClass1.classãMultiClass2.classãMultiClass3.classãMultiClassDemo.class åä¸ªæä»¶ã\n\nJava å¯è¿è¡ç¨åºæ¯ç±ä¸ç» .class æä»¶æåå¹¶åç¼©æçä¸ä¸ª .jar æä»¶ãJava è§£éå¨è´è´£è¿äºæä»¶çæ¥æ¾ãè£è½½åè§£éãJava ç±»åºå®éä¸æ¯ä¸ç»ç±»æä»¶ï¼.java æä»¶ï¼ã\n\n * å¶ä¸­æ¯ä¸ªæä»¶åè®¸æä¸ä¸ª public ç±»ï¼ä»¥åä»»ææ°éçé public ç±»ã\n * public ç±»åå¿é¡»å .java æä»¶åå®å¨ç¸åï¼åæ¬å¤§å°åã\n\nç¨åºä¸è¬ä¸æ­¢ä¸ä¸ªäººç¼åï¼ä¼è°ç¨ç³»ç»æä¾çä»£ç ãç¬¬ä¸æ¹åºä¸­çä»£ç ãé¡¹ç®ä¸­å¶ä»äººåçä»£ç ç­ï¼ä¸åçäººå ä¸ºä¸åçç®çå¯è½å®ä¹åæ ·çç±»å/æ¥å£åï¼è¿å°±æ¯å½åå²çªã\n\nJava ä¸­ä¸ºäºè§£å³å½åå²çªé®é¢ï¼æä¾äºåï¼packageï¼åå¯¼å¥ï¼importï¼æºå¶ã\n\n# package\n\nåï¼packageï¼çååï¼\n\n * åç±»ä¼¼äºæä»¶å¤¹ï¼æä»¶æ¾å¨æä»¶å¤¹ä¸­ï¼ç±»åæ¥å£åæ¾å¨åä¸­ãä¸ºäºä¾¿äºç»ç»ï¼æä»¶å¤¹ä¸è¬æ¯ä¸ä¸ªæå±æ¬¡çæ å½¢ç»æï¼åä¹ç±»ä¼¼ã\n * ååä»¥éå· . åéï¼è¡¨ç¤ºå±æ¬¡ç»æã\n * Java ä¸­å½åååçä¸ä¸ªæ¯ä¾æ¯ä½¿ç¨ååä½ä¸ºåç¼ï¼å ä¸ºååæ¯å¯ä¸çï¼ä¸è¬æç§ååçååºæ¥å®ä¹ååï¼æ¯å¦ï¼ååæ¯ï¼apache.orgï¼ååå°±ä»¥ org.apache å¼å¤´ã\n * **åååæä»¶ç®å½ç»æå¿é¡»å®å¨å¹éã**Java è§£éå¨è¿è¡è¿ç¨å¦ä¸ï¼\n   * æ¾åºç¯å¢åé CLASSPATHï¼ä½ä¸º .class æä»¶çæ ¹ç®å½ã\n   * ä»æ ¹ç®å½å¼å§ï¼è·åååç§°ï¼å¹¶å°éå· . æ¿æ¢ä¸ºæä»¶åéç¬¦ï¼åææ  /ï¼ï¼éè¿è¿ä¸ªè·¯å¾åç§°å»æ¥æ¾ Java ç±»ã\n\n# import\n\nåä¸ä¸ªåä¸çç±»ä¹é´äºç¸å¼ç¨æ¯ä¸éè¦ååçï¼å¯ä»¥ç´æ¥ä½¿ç¨ãä½å¦æç±»ä¸å¨åä¸ä¸ªååï¼åå¿é¡»è¦ç¥éå¶æå¨çåï¼ä½¿ç¨æä¸¤ç§æ¹å¼ï¼\n\n * éè¿ç±»çå®å¨éå®å\n * éè¿ import å°ç¨å°çç±»å¼å¥å°å½åç±»\n\néè¿ç±»çå®å¨éå®åç¤ºä¾ï¼\n\npublic class PackageDemo {\n    public static void main (String[]args){\n        System.out.println(new java.util.Date());\n        System.out.println(new java.util.Date());\n    }\n}\n\n\néè¿ import å¯¼å¥å¶å®åçç±»å°å½åç±»ï¼\n\nimport java.util.Date;\n\npublic class PackageDemo2 {\n    public static void main(String[] args) {\n        System.out.println(new Date());\n        System.out.println(new Date());\n    }\n}\n\n\n> è¯´æï¼ä»¥ä¸ä¸¤ä¸ªç¤ºä¾æ¯è¾èµ·æ¥ï¼æ¾ç¶æ¯ import æ¹å¼ï¼ä»£ç æ´å æ´æ´ã\n\n> æ©å±éè¯»ï¼https://www.cnblogs.com/swiftma/p/5628762.html\n\n\n# è®¿é®æéä¿®é¥°å³é®å­\n\nè®¿é®æéæ§å¶çç­çº§ï¼ä»æå¤§æéå°æå°æéä¾æ¬¡ä¸ºï¼\n\npublic > protected > åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ï¼> private\n\n\n * public - è¡¨ç¤ºä»»ä½ç±»é½å¯ä»¥è®¿é®ï¼\n * åè®¿é®æé - åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ãå®è¡¨ç¤ºå½ååä¸­çææå¶ä»ç±»é½å¯ä»¥è®¿é®ï¼ä½æ¯å¶å®åçç±»æ æ³è®¿é®ã\n * protected - è¡¨ç¤ºå­ç±»å¯ä»¥è®¿é®ï¼æ­¤å¤ï¼åä¸ä¸ªååçå¶ä»ç±»ä¹å¯ä»¥è®¿é®ï¼å³ä½¿è¿äºç±»ä¸æ¯å­ç±»ã\n * private - è¡¨ç¤ºå¶å®ä»»ä½ç±»é½æ æ³è®¿é®ã\n\n\n# æ¥å£\n\næ¥å£æ¯å¯¹è¡ä¸ºçæ½è±¡ï¼å®æ¯æ½è±¡æ¹æ³çéåï¼å©ç¨æ¥å£å¯ä»¥è¾¾å° API å®ä¹åå®ç°åç¦»çç®çã\n\næ¥å£ï¼ä¸è½å®ä¾åï¼ä¸è½åå«ä»»ä½éå¸¸éæåï¼ä»»ä½ field é½æ¯éå«ç public static final çæä¹ï¼åæ¶ï¼æ²¡æééææ¹æ³å®ç°ï¼ä¹å°±æ¯è¯´è¦ä¹æ¯æ½è±¡æ¹æ³ï¼è¦ä¹æ¯éææ¹æ³ã\n\nJava æ åç±»åºä¸­ï¼å®ä¹äºéå¸¸å¤çæ¥å£ï¼æ¯å¦ java.util.Listã\n\npublic interface Comparable<T> {\n    public int compareTo(T o);\n}\n\n\n\n# æ½è±¡ç±»\n\næ½è±¡ç±»æ¯ä¸è½å®ä¾åçç±»ï¼ç¨ abstract å³é®å­ä¿®é¥° classï¼å¶ç®çä¸»è¦æ¯ä»£ç éç¨ãé¤äºä¸è½å®ä¾åï¼å½¢å¼ä¸åä¸è¬ç Java ç±»å¹¶æ²¡æå¤ªå¤§åºå«ï¼å¯ä»¥æä¸ä¸ªæèå¤ä¸ªæ½è±¡æ¹æ³ï¼ä¹å¯ä»¥æ²¡ææ½è±¡æ¹æ³ãæ½è±¡ç±»å¤§å¤ç¨äºæ½åç¸å³ Java ç±»çå±ç¨æ¹æ³å®ç°æèæ¯å±åæååéï¼ç¶åéè¿ç»§æ¿çæ¹å¼è¾¾å°ä»£ç å¤ç¨çç®çã\n\nJava æ ååºä¸­ï¼æ¯å¦ collection æ¡æ¶ï¼å¾å¤éç¨é¨åå°±è¢«æ½åæä¸ºæ½è±¡ç±»ï¼ä¾å¦ java.util.AbstractListã\n\n 1. æ½è±¡ç±»ä¸è½è¢«å®ä¾å(åå­¦èå¾å®¹æç¯çé)ï¼å¦æè¢«å®ä¾åï¼å°±ä¼æ¥éï¼ç¼è¯æ æ³éè¿ãåªææ½è±¡ç±»çéæ½è±¡å­ç±»å¯ä»¥åå»ºå¯¹è±¡ã\n 2. æ½è±¡ç±»ä¸­ä¸ä¸å®åå«æ½è±¡æ¹æ³ï¼ä½æ¯ææ½è±¡æ¹æ³çç±»å¿å®æ¯æ½è±¡ç±»ã\n 3. æ½è±¡ç±»ä¸­çæ½è±¡æ¹æ³åªæ¯å£°æï¼ä¸åå«æ¹æ³ä½ï¼å°±æ¯ä¸ç»åºæ¹æ³çå·ä½å®ç°ä¹å°±æ¯æ¹æ³çå·ä½åè½ã\n 4. æé æ¹æ³ï¼ç±»æ¹æ³ï¼ç¨ static ä¿®é¥°çæ¹æ³ï¼ä¸è½å£°æä¸ºæ½è±¡æ¹æ³ã\n 5. æ½è±¡ç±»çå­ç±»å¿é¡»ç»åºæ½è±¡ç±»ä¸­çæ½è±¡æ¹æ³çå·ä½å®ç°ï¼é¤éè¯¥å­ç±»ä¹æ¯æ½è±¡ç±»ã\n\n\n# åèèµæ\n\n * ä¹¦ç±\n   * Java ç¼ç¨ææ³\n   * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n   * Head First Java\n * æç« \n   * é¢åå¯¹è±¡ç¼ç¨çå¼ç«¯æ¯ä»ä¹ï¼ - invalid s çåç­\n   * https://www.cnblogs.com/swiftma/p/5628762.html',normalizedContent:'# java é¢åå¯¹è±¡\n\n> å¨java åºæ¬æ°æ®ç±»å ä¸­æä»¬äºè§£ java ä¸­æ¯æçåºæ¬æ°æ®ç±»åï¼å¼ç±»åï¼ãæ¬æå¼å§è®²è§£ java ä¸­éè¦çå¼ç¨ç±»åââç±»ã\n\n\n# é¢åå¯¹è±¡\n\næ¯ç§ç¼ç¨è¯­è¨ï¼é½æèªå·±çæçºµåå­ä¸­åç´ çæ¹å¼ã\n\njava ä¸­æä¾äºåºæ¬æ°æ®ç±»åï¼ä½è¿è¿ä¸è½æ»¡è¶³ç¼åç¨åºæ¶ï¼éè¦æ½è±¡æ´å å¤ææ°æ®ç±»åçéè¦ãå æ­¤ï¼java ä¸­ï¼åè®¸å¼åèéè¿ç±»ï¼ç±»çæºå¶ä¸é¢ä¼è®²å°ï¼åå»ºèªå®ä¹ç±»åã\n\næäºèªå®ä¹ç±»åï¼é£ä¹æ°æ®ç±»åèªç¶ä¼ååä¸åï¼æä»¥ï¼å¿é¡»è¦æä¸å®çæºå¶ï¼ä½¿å¾å®ä»¬ä»ç¶ä¿æä¸äºå¿è¦çãéç¨çç¹æ§ã\n\njava ä¸çæä¸å¥åè¨ï¼ä¸åçä¸ºå¯¹è±¡ãè¿å¥è¯ï¼ä½ å¯è½ç¬¬ä¸å¤©å­¦ java æ¶ï¼å°±å¬è¿äºãè¿ä¸ä»ä»æ¯ä¸å¥å£å·ï¼ä¹ä½ç°å¨ java çè®¾è®¡ä¸ã\n\n * é¦åï¼ææ java ç±»é½ç»§æ¿èª object ç±»ï¼ä»è¿ä¸ªåå­ï¼å°±å¯è§ä¸æï¼ã\n * å ä¹ææ java å¯¹è±¡åå§åæ¶ï¼é½è¦ä½¿ç¨ new åå»ºå¯¹è±¡ï¼åºæ¬æ°æ®ç±»åãstringãæä¸¾ç¹æ®å¤çï¼ï¼å¯¹è±¡å­å¨å¨å ä¸­ã\n\n// ä¸é¢ä¸¤\nstring s = "abc";\nstring s = new string("abc");\n\n\nå¶ä¸­ï¼string s å®ä¹äºä¸ä¸ªåä¸º s çå¼ç¨ï¼å®æåä¸ä¸ª string ç±»åçå¯¹è±¡ï¼èå®éçå¯¹è±¡æ¯ âabcâ å­ç¬¦ä¸²ãè¿å°±åæ¯ï¼ä½¿ç¨é¥æ§å¨ï¼å¼ç¨ï¼æ¥æçºµçµè§æºï¼å¯¹è±¡ï¼ã\n\nä¸ c/c++ è¿ç±»è¯­è¨ä¸åï¼ç¨åºååªéè¦éè¿ new åå»ºä¸ä¸ªå¯¹è±¡ï¼ä½ä¸å¿è´è´£éæ¯æç»æä¸ä¸ªå¯¹è±¡ãè´è´£è¿è¡ java ç¨åºç java èææºæä¸ä¸ªåå¾åæ¶å¨ï¼å®ä¼çè§ new åå»ºçå¯¹è±¡ï¼ä¸æ¦åç°å¯¹è±¡ä¸åè¢«å¼ç¨ï¼åä¼éæ¾å¯¹è±¡çåå­ç©ºé´ã\n\n\n# å°è£\n\nå°è£ï¼encapsulationï¼æ¯æä¸ç§å°æ½è±¡æ§å½å¼æ¥å£çå®ç°ç»èé¨ä»½åè£ãéèèµ·æ¥çæ¹æ³ã\n\nå°è£æä¸»è¦çä½ç¨å¨äºæä»¬è½ä¿®æ¹èªå·±çå®ç°ä»£ç ï¼èä¸ç¨ä¿®æ¹é£äºè°ç¨æä»¬ä»£ç çç¨åºçæ®µã\n\néå½çå°è£å¯ä»¥è®©ç¨å¼ç æ´å®¹æçè§£ä¸ç»´æ¤ï¼ä¹å å¼ºäºç¨å¼ç çå®å¨æ§ã\n\nå°è£çä¼ç¹ï¼\n\n * è¯å¥½çå°è£è½å¤åå°è¦åã\n * ç±»åé¨çç»æå¯ä»¥èªç±ä¿®æ¹ã\n * å¯ä»¥å¯¹æååéè¿è¡æ´ç²¾ç¡®çæ§å¶ã\n * éèä¿¡æ¯ï¼å®ç°ç»èã\n\nå®ç°å°è£çæ­¥éª¤ï¼\n\n 1. ä¿®æ¹å±æ§çå¯è§æ§æ¥éå¶å¯¹å±æ§çè®¿é®ï¼ä¸è¬éå¶ä¸º privateï¼ã\n 2. å¯¹æ¯ä¸ªå¼å±æ§æä¾å¯¹å¤çå¬å±æ¹æ³è®¿é®ï¼ä¹å°±æ¯åå»ºä¸å¯¹èµåå¼æ¹æ³ï¼ç¨äºå¯¹ç§æå±æ§çè®¿é®ã\n\n\n# ç»§æ¿\n\nç»§æ¿æ¯ java é¢åå¯¹è±¡ç¼ç¨ææ¯çä¸ååºç³ï¼å ä¸ºå®åè®¸åå»ºåç­çº§å±æ¬¡çç±»ã\n\nç»§æ¿å°±æ¯å­ç±»ç»§æ¿ç¶ç±»çç¹å¾åè¡ä¸ºï¼ä½¿å¾å­ç±»å¯¹è±¡ï¼å®ä¾ï¼å·æç¶ç±»çå®ä¾ååæ¹æ³ï¼æå­ç±»ä»ç¶ç±»ç»§æ¿æ¹æ³ï¼ä½¿å¾å­ç±»å·æç¶ç±»ç¸åçè¡ä¸ºã\n\nç°å®ä¸­çä¾å­ï¼\n\nçåé¸é½æ¯å¨ç©ãå¦æå°çãé¸ä½ä¸ºç±»ï¼å®ä»¬å¯ä»¥ç»§æ¿å¨ç©ç±»ã\n\n\n\nç±»çç»§æ¿å½¢å¼ï¼\n\nclass ç¶ç±» {}\n\nclass å­ç±» extends ç¶ç±» {}\n\n\n# ç»§æ¿ç±»å\n\n\n\n# ç»§æ¿çç¹æ§\n\n * å­ç±»å¯ä»¥ç»§æ¿ç¶ç±»çå±æ§åæ¹æ³ãéè¦æ³¨æçæ¯ï¼æé æ¹æ³é¤å¤ï¼æé æ¹æ³åªè½è¢«è°ç¨ï¼èä¸è½è¢«ç»§æ¿ã\n * å­ç±»å¯ä»¥æ¥æèªå·±çå±æ§åæ¹æ³ï¼å³å­ç±»å¯ä»¥å¯¹ç¶ç±»è¿è¡æ©å±ã\n * å­ç±»å¯ä»¥ç¨èªå·±çæ¹å¼å®ç°ç¶ç±»çæ¹æ³ã\n * java çç»§æ¿æ¯åç»§æ¿ï¼ä½æ¯å¯ä»¥å¤éç»§æ¿ï¼åç»§æ¿å°±æ¯ä¸ä¸ªå­ç±»åªè½ç»§æ¿ä¸ä¸ªç¶ç±»ï¼å¤éç»§æ¿å°±æ¯ï¼ä¾å¦ a ç±»ç»§æ¿ b ç±»ï¼b ç±»ç»§æ¿ c ç±»ï¼æä»¥æç§å³ç³»å°±æ¯ c ç±»æ¯ b ç±»çç¶ç±»ï¼b ç±»æ¯ a ç±»çç¶ç±»ï¼è¿æ¯ java ç»§æ¿åºå«äº c++ ç»§æ¿çä¸ä¸ªç¹æ§ã\n * æé«äºç±»ä¹é´çè¦åæ§ï¼ç»§æ¿çç¼ºç¹ï¼è¦ååº¦é«å°±ä¼é æä»£ç ä¹é´çèç³»è¶ç´§å¯ï¼ä»£ç ç¬ç«æ§è¶å·®ï¼ã\n\n# ç»§æ¿å³é®å­\n\nç»§æ¿å¯ä»¥ä½¿ç¨ extends å implements è¿ä¸¤ä¸ªå³é®å­æ¥å®ç°ç»§æ¿ï¼èä¸ææçç±»é½æ¯ç»§æ¿äº java.lang.objectï¼å½ä¸ä¸ªç±»æ²¡æç»§æ¿çä¸¤ä¸ªå³é®å­ï¼åé»è®¤ç»§æ¿ objectï¼è¿ä¸ªç±»å¨ java.lang åä¸­ï¼æä»¥ä¸éè¦ importï¼ç¥åç±»ã\n\n\n# å¤æ\n\nåå¼å§å­¦ä¹ é¢åå¯¹è±¡ç¼ç¨æ¶ï¼å®¹æè¢«åç§æ¯è¯­å¼å¾äºéé¾éãæä»¥ï¼å¾å¤äººä¼æ­»è®°ç¡¬èä¹¦ä¸­å¯¹äºæ¯è¯­çå®ä¹ã\n\nä½æ¯ï¼éçåºç¨åçè§£çæ·±å¥ï¼åºè¯¥ä¼æ¸æ¸ææ´è¿ä¸æ­¥çè®¤è¯ï¼å°å¶èæ±è´¯éççè§£ã\n\nå­¦ä¹ ç±»ä¹åï¼åè®©æä»¬æèä¸ä¸ªé®é¢ï¼java ä¸­ä¸ºä»ä¹è¦å¼å¥ç±»æºå¶ï¼è®¾è®¡çåè¡·æ¯ä»ä¹ï¼\n\njava ä¸­æä¾çåºæ¬æ°æ®ç±»åï¼åªè½è¡¨ç¤ºåä¸çæ°å¼ï¼è¿ç¨äºæ°å¼è®¡ç®ï¼è¿ okãä½æ¯ï¼å¦æè¦æ½è±¡æ¨¡æç°å®ä¸­æ´å¤æçäºç©ï¼åæ æ³åå°ã\n\nè¯æ³ï¼å¦æè¦è®©ä½ æ½è±¡ççæ°æ®æ¨¡åï¼æä¹åï¼çæç¼è³å£é¼»ç­å¨å®ï¼æè¿ï¼çæå¤§å°ï¼æ¯è²ï¼è¿äºé½æ¯å®çç¶æï¼çä¼è·ãä¼å«ãä¼åä¸è¥¿ï¼è¿äºæ¯å®çè¡ä¸ºã\n\nç±»çå¼å¥ï¼å°±æ¯ä¸ºäºæ½è±¡è¿ç§ç¸å¯¹å¤æçäºç©ã\n\nå¯¹è±¡æ¯ç¨äºè®¡ç®æºè¯­è¨å¯¹é®é¢åä¸­äºç©çæè¿°ãå¯¹è±¡éè¿æ¹æ³åå±æ§æ¥åå«æè¿°äºç©æå·æçè¡ä¸ºåç¶æã\n\nç±»æ¯ç¨äºæè¿°åä¸ç±»çå¯¹è±¡çä¸ä¸ªæ½è±¡çæ¦å¿µï¼ç±»ä¸­å®ä¹äºè¿ä¸ç±»å¯¹è±¡æå·æçè¡ä¸ºåç¶æã\n\nç±»å¯ä»¥çææ¯åå»º java å¯¹è±¡çæ¨¡æ¿ã\n\nä»ä¹æ¯æ¹æ³ï¼æ©å±éè¯»ï¼é¢åå¯¹è±¡ç¼ç¨çå¼ç«¯æ¯ä»ä¹ï¼ - invalid s çåç­\n\n\n# ç±»\n\nä¸å¤§å¤æ°é¢åå¯¹è±¡ç¼ç¨è¯­è¨ä¸æ ·ï¼java ä½¿ç¨ class ï¼ç±»ï¼å³é®å­æ¥è¡¨ç¤ºèªå®ä¹ç±»åãèªå®ä¹ç±»åæ¯ä¸ºäºæ´å®¹ææ½è±¡ç°å®äºç©ã\n\nå¨ä¸ä¸ªç±»ä¸­ï¼å¯ä»¥è®¾ç½®ä¸éä¸å¨ä¸¤ç§åç´ ï¼å±æ§ï¼éï¼åæ¹æ³ï¼å¨ï¼ã\n\n * å±æ§ï¼æçäººåæ¬¢ç§°ä¸ºæåãå­æ®µï¼ - å±æ§æ½è±¡çæ¯äºç©çç¶æãç±»å±æ§å¯ä»¥æ¯ä»»ä½ç±»åçå¯¹è±¡ã\n * æ¹æ³ï¼æçäººåæ¬¢ç§°ä¸ºå½æ°ï¼ - æ¹æ³æ½è±¡çæ¯äºç©çè¡ä¸ºã\n\nç±»çå½¢å¼å¦ä¸ï¼\n\n\n\n\n# æ¹æ³\n\n\n# æ¹æ³å®ä¹\n\nä¿®é¥°ç¬¦ è¿åå¼ç±»å æ¹æ³å(åæ°ç±»å åæ°å){\n    ...\n    æ¹æ³ä½\n    ...\n    return è¿åå¼;\n}\n\n\næ¹æ³åå«ä¸ä¸ªæ¹æ³å¤´åä¸ä¸ªæ¹æ³ä½ãä¸é¢æ¯ä¸ä¸ªæ¹æ³çææé¨åï¼\n\n * **ä¿®é¥°ç¬¦ï¼**ä¿®é¥°ç¬¦ï¼è¿æ¯å¯éçï¼åè¯ç¼è¯å¨å¦ä½è°ç¨è¯¥æ¹æ³ãå®ä¹äºè¯¥æ¹æ³çè®¿é®ç±»åã\n * **è¿åå¼ç±»å ï¼**æ¹æ³å¯è½æè¿åå¼ãå¦ææ²¡æè¿åå¼ï¼è¿ç§æåµä¸ï¼è¿åå¼ç±»ååºè®¾ä¸º voidã\n * **æ¹æ³åï¼**æ¯æ¹æ³çå®éåç§°ãæ¹æ³åååæ°è¡¨å±åæææ¹æ³ç­¾åã\n * **åæ°ç±»åï¼**åæ°åæ¯ä¸ä¸ªå ä½ç¬¦ãå½æ¹æ³è¢«è°ç¨æ¶ï¼ä¼ éå¼ç»åæ°ãè¿ä¸ªå¼è¢«ç§°ä¸ºå®åæåéãåæ°åè¡¨æ¯ææ¹æ³çåæ°ç±»åãé¡ºåºååæ°çä¸ªæ°ãåæ°æ¯å¯éçï¼æ¹æ³å¯ä»¥ä¸åå«ä»»ä½åæ°ã\n * **æ¹æ³ä½ï¼**æ¹æ³ä½åå«å·ä½çè¯­å¥ï¼å®ä¹è¯¥æ¹æ³çåè½ã\n\nç¤ºä¾ï¼\n\npublic static int add(int x, int y) {\n   return x + y;\n}\n\n\n\n# æ¹æ³è°ç¨\n\njava æ¯æä¸¤ç§è°ç¨æ¹æ³çæ¹å¼ï¼æ ¹æ®æ¹æ³æ¯å¦è¿åå¼æ¥éæ©ã\n\nå½ç¨åºè°ç¨ä¸ä¸ªæ¹æ³æ¶ï¼ç¨åºçæ§å¶æäº¤ç»äºè¢«è°ç¨çæ¹æ³ãå½è¢«è°ç¨æ¹æ³çè¿åè¯­å¥æ§è¡æèå°è¾¾æ¹æ³ä½é­æ¬å·æ¶åäº¤è¿æ§å¶æç»ç¨åºã\n\nå½æ¹æ³è¿åä¸ä¸ªå¼çæ¶åï¼æ¹æ³è°ç¨éå¸¸è¢«å½åä¸ä¸ªå¼ãä¾å¦ï¼\n\nint larger = max(30, 40);\n\n\nå¦ææ¹æ³è¿åå¼æ¯ voidï¼æ¹æ³è°ç¨ä¸å®æ¯ä¸æ¡è¯­å¥ãä¾å¦ï¼æ¹æ³ println è¿å voidãä¸é¢çè°ç¨æ¯ä¸ªè¯­å¥ï¼\n\nsystem.out.println("hello world");\n\n\n\n# æé æ¹æ³\n\næ¯ä¸ªç±»é½ææé æ¹æ³ãå¦ææ²¡ææ¾å¼å°ä¸ºç±»å®ä¹ä»»ä½æé æ¹æ³ï¼java ç¼è¯å¨å°ä¼ä¸ºè¯¥ç±»æä¾ä¸ä¸ªé»è®¤æé æ¹æ³ã\n\nå¨åå»ºä¸ä¸ªå¯¹è±¡çæ¶åï¼è³å°è¦è°ç¨ä¸ä¸ªæé æ¹æ³ãæé æ¹æ³çåç§°å¿é¡»ä¸ç±»ååï¼ä¸ä¸ªç±»å¯ä»¥æå¤ä¸ªæé æ¹æ³ã\n\npublic class puppy{\n    public puppy(){\n    }\n\n    public puppy(string name){\n        // è¿ä¸ªæé å¨ä»æä¸ä¸ªåæ°ï¼name\n    }\n}\n\n\n\n# åé\n\njava æ¯æçåéç±»åæï¼\n\n * å±é¨åé - ç±»æ¹æ³ä¸­çåéã\n * å®ä¾åéï¼ä¹å«æååéï¼ - ç±»æ¹æ³å¤çåéï¼ä¸è¿æ²¡æ static ä¿®é¥°ã\n * ç±»åéï¼ä¹å«éæåéï¼ - ç±»æ¹æ³å¤çåéï¼ç¨ static ä¿®é¥°ã\n\nç¹æ§å¯¹æ¯ï¼\n\nå±é¨åé                                                            å®ä¾åéï¼ä¹å«æååéï¼                                                             ç±»åéï¼ä¹å«éæåéï¼\nå±é¨åéå£°æå¨æ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­ã                                           å®ä¾åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ã                                                    ç±»åéå£°æå¨æ¹æ³ãæé æ¹æ³åè¯­å¥åä¹å¤ãå¹¶ä¸ä»¥ static ä¿®é¥°ã\nå±é¨åéå¨æ¹æ³ãæé æ¹æ³ãæèè¯­å¥åè¢«æ§è¡çæ¶ååå»ºï¼å½å®ä»¬æ§è¡å®æåï¼åéå°ä¼è¢«éæ¯ã                    å®ä¾åéå¨å¯¹è±¡åå»ºçæ¶ååå»ºï¼å¨å¯¹è±¡è¢«éæ¯çæ¶åéæ¯ã                                              ç±»åéå¨ç¬¬ä¸æ¬¡è¢«è®¿é®æ¶åå»ºï¼å¨ç¨åºç»ææ¶éæ¯ã\nå±é¨åéæ²¡æé»è®¤å¼ï¼æä»¥å¿é¡»ç»è¿åå§åï¼æå¯ä»¥ä½¿ç¨ã                                      å®ä¾åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯                      ç±»åéå·æé»è®¤å¼ãæ°å¼ååéçé»è®¤å¼æ¯ 0ï¼å¸å°ååéçé»è®¤å¼æ¯ falseï¼å¼ç¨ç±»ååéçé»è®¤å¼æ¯\n                                                                nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ã                                           nullãåéçå¼å¯ä»¥å¨å£°ææ¶æå®ï¼ä¹å¯ä»¥å¨æé æ¹æ³ä¸­æå®ãæ­¤å¤ï¼éæåéè¿å¯ä»¥å¨éæè¯­å¥åä¸­åå§åã\nå¯¹äºå±é¨åéï¼å¦ææ¯åºæ¬ç±»åï¼ä¼æå¼ç´æ¥å­å¨å¨æ ï¼å¦ææ¯å¼ç¨ç±»åï¼ä¼æå¶å¯¹è±¡å­å¨å¨å ï¼èæè¿ä¸ªå¯¹è±¡çå¼ç¨ï¼æéï¼å­å¨å¨æ ã   å®ä¾åéå­å¨å¨å ã                                                                ç±»åéå­å¨å¨éæå­å¨åºã\nè®¿é®ä¿®é¥°ç¬¦ä¸è½ç¨äºå±é¨åéã                                                  è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºå®ä¾åéã                                                           è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ç¨äºç±»åéã\nå±é¨åéåªå¨å£°æå®çæ¹æ³ãæé æ¹æ³æèè¯­å¥åä¸­å¯è§ã                                      å®ä¾åéå¯¹äºç±»ä¸­çæ¹æ³ãæé æ¹æ³æèè¯­å¥åæ¯å¯è§çãä¸è¬æåµä¸åºè¯¥æå®ä¾åéè®¾ä¸ºç§æãéè¿ä½¿ç¨è®¿é®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾åéå¯¹å­ç±»å¯è§ã        ä¸å®ä¾åéå·æç¸ä¼¼çå¯è§æ§ãä½ä¸ºäºå¯¹ç±»çä½¿ç¨èå¯è§ï¼å¤§å¤æ°éæåéå£°æä¸º public ç±»åã\n                                                                å®ä¾åéå¯ä»¥ç´æ¥éè¿åéåè®¿é®ãä½å¨éææ¹æ³ä»¥åå¶ä»ç±»ä¸­ï¼å°±åºè¯¥ä½¿ç¨å®å¨éå®åï¼obejectreference.variablenameã   éæåéå¯ä»¥éè¿ï¼classname.variablename çæ¹å¼è®¿é®ã\n                                                                                                                                         æ è®ºä¸ä¸ªç±»åå»ºäºå¤å°ä¸ªå¯¹è±¡ï¼ç±»åªæ¥æç±»åéçä¸ä»½æ·è´ã\n                                                                                                                                         ç±»åéé¤äºè¢«å£°æä¸ºå¸¸éå¤å¾å°ä½¿ç¨ã\n\n\n# åéä¿®é¥°ç¬¦\n\n * è®¿é®çº§å«ä¿®é¥°ç¬¦ - å¦æåéæ¯å®ä¾åéæç±»åéï¼å¯ä»¥æ·»å è®¿é®çº§å«ä¿®é¥°ç¬¦ï¼public/protected/privateï¼\n * éæä¿®é¥°ç¬¦ - å¦æåéæ¯ç±»åéï¼éè¦æ·»å  static ä¿®é¥°\n * final - å¦æåéä½¿ç¨ final ä¿®é¥°ç¬¦ï¼å°±è¡¨ç¤ºè¿æ¯ä¸ä¸ªå¸¸éï¼ä¸è½è¢«ä¿®æ¹ã\n\n\n# åå»ºå¯¹è±¡\n\nå¯¹è±¡æ¯æ ¹æ®ç±»åå»ºçãå¨ java ä¸­ï¼ä½¿ç¨å³é®å­ new æ¥åå»ºä¸ä¸ªæ°çå¯¹è±¡ãåå»ºå¯¹è±¡éè¦ä»¥ä¸ä¸æ­¥ï¼\n\n * å£°æï¼å£°æä¸ä¸ªå¯¹è±¡ï¼åæ¬å¯¹è±¡åç§°åå¯¹è±¡ç±»åã\n * å®ä¾åï¼ä½¿ç¨å³é®å­ new æ¥åå»ºä¸ä¸ªå¯¹è±¡ã\n * åå§åï¼ä½¿ç¨ new åå»ºå¯¹è±¡æ¶ï¼ä¼è°ç¨æé æ¹æ³åå§åå¯¹è±¡ã\n\npublic class puppy{\n   public puppy(string name){\n      //è¿ä¸ªæé å¨ä»æä¸ä¸ªåæ°ï¼name\n      system.out.println("å°ççåå­æ¯ : " + name );\n   }\n   public static void main(string[] args){\n      // ä¸é¢çè¯­å¥å°åå»ºä¸ä¸ªpuppyå¯¹è±¡\n      puppy mypuppy = new puppy( "tommy" );\n   }\n}\n\n\n\n# è®¿é®å®ä¾åéåæ¹æ³\n\n/* å®ä¾åå¯¹è±¡ */\nobjectreference = new constructor();\n/* è®¿é®ç±»ä¸­çåé */\nobjectreference.variablename;\n/* è®¿é®ç±»ä¸­çæ¹æ³ */\nobjectreference.methodname();\n\n\n\n# è®¿é®æéæ§å¶\n\n\n# ä»£ç ç»ç»\n\nå½ç¼è¯ä¸ä¸ª .java æä»¶æ¶ï¼å¨ .java æä»¶ä¸­çæ¯ä¸ªç±»é½ä¼è¾åºä¸ä¸ªä¸ç±»ååç .class æä»¶ã\n\nmulticlassdemo.java ç¤ºä¾ï¼\n\nclass multiclass1 {}\n\nclass multiclass2 {}\n\nclass multiclass3 {}\n\npublic class multiclassdemo {}\n\n\næ§è¡ javac multiclassdemo.java å½ä»¤ï¼æ¬å°ä¼çæ multiclass1.classãmulticlass2.classãmulticlass3.classãmulticlassdemo.class åä¸ªæä»¶ã\n\njava å¯è¿è¡ç¨åºæ¯ç±ä¸ç» .class æä»¶æåå¹¶åç¼©æçä¸ä¸ª .jar æä»¶ãjava è§£éå¨è´è´£è¿äºæä»¶çæ¥æ¾ãè£è½½åè§£éãjava ç±»åºå®éä¸æ¯ä¸ç»ç±»æä»¶ï¼.java æä»¶ï¼ã\n\n * å¶ä¸­æ¯ä¸ªæä»¶åè®¸æä¸ä¸ª public ç±»ï¼ä»¥åä»»ææ°éçé public ç±»ã\n * public ç±»åå¿é¡»å .java æä»¶åå®å¨ç¸åï¼åæ¬å¤§å°åã\n\nç¨åºä¸è¬ä¸æ­¢ä¸ä¸ªäººç¼åï¼ä¼è°ç¨ç³»ç»æä¾çä»£ç ãç¬¬ä¸æ¹åºä¸­çä»£ç ãé¡¹ç®ä¸­å¶ä»äººåçä»£ç ç­ï¼ä¸åçäººå ä¸ºä¸åçç®çå¯è½å®ä¹åæ ·çç±»å/æ¥å£åï¼è¿å°±æ¯å½åå²çªã\n\njava ä¸­ä¸ºäºè§£å³å½åå²çªé®é¢ï¼æä¾äºåï¼packageï¼åå¯¼å¥ï¼importï¼æºå¶ã\n\n# package\n\nåï¼packageï¼çååï¼\n\n * åç±»ä¼¼äºæä»¶å¤¹ï¼æä»¶æ¾å¨æä»¶å¤¹ä¸­ï¼ç±»åæ¥å£åæ¾å¨åä¸­ãä¸ºäºä¾¿äºç»ç»ï¼æä»¶å¤¹ä¸è¬æ¯ä¸ä¸ªæå±æ¬¡çæ å½¢ç»æï¼åä¹ç±»ä¼¼ã\n * ååä»¥éå· . åéï¼è¡¨ç¤ºå±æ¬¡ç»æã\n * java ä¸­å½åååçä¸ä¸ªæ¯ä¾æ¯ä½¿ç¨ååä½ä¸ºåç¼ï¼å ä¸ºååæ¯å¯ä¸çï¼ä¸è¬æç§ååçååºæ¥å®ä¹ååï¼æ¯å¦ï¼ååæ¯ï¼apache.orgï¼ååå°±ä»¥ org.apache å¼å¤´ã\n * **åååæä»¶ç®å½ç»æå¿é¡»å®å¨å¹éã**java è§£éå¨è¿è¡è¿ç¨å¦ä¸ï¼\n   * æ¾åºç¯å¢åé classpathï¼ä½ä¸º .class æä»¶çæ ¹ç®å½ã\n   * ä»æ ¹ç®å½å¼å§ï¼è·åååç§°ï¼å¹¶å°éå· . æ¿æ¢ä¸ºæä»¶åéç¬¦ï¼åææ  /ï¼ï¼éè¿è¿ä¸ªè·¯å¾åç§°å»æ¥æ¾ java ç±»ã\n\n# import\n\nåä¸ä¸ªåä¸çç±»ä¹é´äºç¸å¼ç¨æ¯ä¸éè¦ååçï¼å¯ä»¥ç´æ¥ä½¿ç¨ãä½å¦æç±»ä¸å¨åä¸ä¸ªååï¼åå¿é¡»è¦ç¥éå¶æå¨çåï¼ä½¿ç¨æä¸¤ç§æ¹å¼ï¼\n\n * éè¿ç±»çå®å¨éå®å\n * éè¿ import å°ç¨å°çç±»å¼å¥å°å½åç±»\n\néè¿ç±»çå®å¨éå®åç¤ºä¾ï¼\n\npublic class packagedemo {\n    public static void main (string[]args){\n        system.out.println(new java.util.date());\n        system.out.println(new java.util.date());\n    }\n}\n\n\néè¿ import å¯¼å¥å¶å®åçç±»å°å½åç±»ï¼\n\nimport java.util.date;\n\npublic class packagedemo2 {\n    public static void main(string[] args) {\n        system.out.println(new date());\n        system.out.println(new date());\n    }\n}\n\n\n> è¯´æï¼ä»¥ä¸ä¸¤ä¸ªç¤ºä¾æ¯è¾èµ·æ¥ï¼æ¾ç¶æ¯ import æ¹å¼ï¼ä»£ç æ´å æ´æ´ã\n\n> æ©å±éè¯»ï¼https://www.cnblogs.com/swiftma/p/5628762.html\n\n\n# è®¿é®æéä¿®é¥°å³é®å­\n\nè®¿é®æéæ§å¶çç­çº§ï¼ä»æå¤§æéå°æå°æéä¾æ¬¡ä¸ºï¼\n\npublic > protected > åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ï¼> private\n\n\n * public - è¡¨ç¤ºä»»ä½ç±»é½å¯ä»¥è®¿é®ï¼\n * åè®¿é®æé - åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ãå®è¡¨ç¤ºå½ååä¸­çææå¶ä»ç±»é½å¯ä»¥è®¿é®ï¼ä½æ¯å¶å®åçç±»æ æ³è®¿é®ã\n * protected - è¡¨ç¤ºå­ç±»å¯ä»¥è®¿é®ï¼æ­¤å¤ï¼åä¸ä¸ªååçå¶ä»ç±»ä¹å¯ä»¥è®¿é®ï¼å³ä½¿è¿äºç±»ä¸æ¯å­ç±»ã\n * private - è¡¨ç¤ºå¶å®ä»»ä½ç±»é½æ æ³è®¿é®ã\n\n\n# æ¥å£\n\næ¥å£æ¯å¯¹è¡ä¸ºçæ½è±¡ï¼å®æ¯æ½è±¡æ¹æ³çéåï¼å©ç¨æ¥å£å¯ä»¥è¾¾å° api å®ä¹åå®ç°åç¦»çç®çã\n\næ¥å£ï¼ä¸è½å®ä¾åï¼ä¸è½åå«ä»»ä½éå¸¸éæåï¼ä»»ä½ field é½æ¯éå«ç public static final çæä¹ï¼åæ¶ï¼æ²¡æééææ¹æ³å®ç°ï¼ä¹å°±æ¯è¯´è¦ä¹æ¯æ½è±¡æ¹æ³ï¼è¦ä¹æ¯éææ¹æ³ã\n\njava æ åç±»åºä¸­ï¼å®ä¹äºéå¸¸å¤çæ¥å£ï¼æ¯å¦ java.util.listã\n\npublic interface comparable<t> {\n    public int compareto(t o);\n}\n\n\n\n# æ½è±¡ç±»\n\næ½è±¡ç±»æ¯ä¸è½å®ä¾åçç±»ï¼ç¨ abstract å³é®å­ä¿®é¥° classï¼å¶ç®çä¸»è¦æ¯ä»£ç éç¨ãé¤äºä¸è½å®ä¾åï¼å½¢å¼ä¸åä¸è¬ç java ç±»å¹¶æ²¡æå¤ªå¤§åºå«ï¼å¯ä»¥æä¸ä¸ªæèå¤ä¸ªæ½è±¡æ¹æ³ï¼ä¹å¯ä»¥æ²¡ææ½è±¡æ¹æ³ãæ½è±¡ç±»å¤§å¤ç¨äºæ½åç¸å³ java ç±»çå±ç¨æ¹æ³å®ç°æèæ¯å±åæååéï¼ç¶åéè¿ç»§æ¿çæ¹å¼è¾¾å°ä»£ç å¤ç¨çç®çã\n\njava æ ååºä¸­ï¼æ¯å¦ collection æ¡æ¶ï¼å¾å¤éç¨é¨åå°±è¢«æ½åæä¸ºæ½è±¡ç±»ï¼ä¾å¦ java.util.abstractlistã\n\n 1. æ½è±¡ç±»ä¸è½è¢«å®ä¾å(åå­¦èå¾å®¹æç¯çé)ï¼å¦æè¢«å®ä¾åï¼å°±ä¼æ¥éï¼ç¼è¯æ æ³éè¿ãåªææ½è±¡ç±»çéæ½è±¡å­ç±»å¯ä»¥åå»ºå¯¹è±¡ã\n 2. æ½è±¡ç±»ä¸­ä¸ä¸å®åå«æ½è±¡æ¹æ³ï¼ä½æ¯ææ½è±¡æ¹æ³çç±»å¿å®æ¯æ½è±¡ç±»ã\n 3. æ½è±¡ç±»ä¸­çæ½è±¡æ¹æ³åªæ¯å£°æï¼ä¸åå«æ¹æ³ä½ï¼å°±æ¯ä¸ç»åºæ¹æ³çå·ä½å®ç°ä¹å°±æ¯æ¹æ³çå·ä½åè½ã\n 4. æé æ¹æ³ï¼ç±»æ¹æ³ï¼ç¨ static ä¿®é¥°çæ¹æ³ï¼ä¸è½å£°æä¸ºæ½è±¡æ¹æ³ã\n 5. æ½è±¡ç±»çå­ç±»å¿é¡»ç»åºæ½è±¡ç±»ä¸­çæ½è±¡æ¹æ³çå·ä½å®ç°ï¼é¤éè¯¥å­ç±»ä¹æ¯æ½è±¡ç±»ã\n\n\n# åèèµæ\n\n * ä¹¦ç±\n   * java ç¼ç¨ææ³\n   * java æ ¸å¿ææ¯ï¼å· 1ï¼\n   * head first java\n * æç« \n   * é¢åå¯¹è±¡ç¼ç¨çå¼ç«¯æ¯ä»ä¹ï¼ - invalid s çåç­\n   * https://www.cnblogs.com/swiftma/p/5628762.html',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java æ¹æ³",frontmatter:{title:"æ·±å¥çè§£ Java æ¹æ³",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","æ¹æ³"],permalink:"/pages/7a3ffc/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/04.Java%E6%96%B9%E6%B3%95.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/04.Javaæ¹æ³.md",key:"v-e64b7cf6",path:"/pages/7a3ffc/",headers:[{level:2,title:"æ¹æ³çä½¿ç¨",slug:"æ¹æ³çä½¿ç¨",normalizedTitle:"æ¹æ³çä½¿ç¨",charIndex:46},{level:3,title:"æ¹æ³å®ä¹",slug:"æ¹æ³å®ä¹",normalizedTitle:"æ¹æ³å®ä¹",charIndex:56},{level:3,title:"æ¹æ³çè°ç¨",slug:"æ¹æ³çè°ç¨",normalizedTitle:"æ¹æ³çè°ç¨",charIndex:601},{level:4,title:"éå½è°ç¨",slug:"éå½è°ç¨",normalizedTitle:"éå½è°ç¨",charIndex:846},{level:2,title:"æ¹æ³åæ°",slug:"æ¹æ³åæ°",normalizedTitle:"æ¹æ³åæ°",charIndex:1336},{level:2,title:"æ¹æ³ä¿®é¥°ç¬¦",slug:"æ¹æ³ä¿®é¥°ç¬¦",normalizedTitle:"æ¹æ³ä¿®é¥°ç¬¦",charIndex:2559},{level:3,title:"è®¿é®æ§å¶ä¿®é¥°ç¬¦",slug:"è®¿é®æ§å¶ä¿®é¥°ç¬¦",normalizedTitle:"è®¿é®æ§å¶ä¿®é¥°ç¬¦",charIndex:2647},{level:3,title:"static",slug:"static",normalizedTitle:"static",charIndex:158},{level:3,title:"final",slug:"final",normalizedTitle:"final",charIndex:3131},{level:3,title:"default",slug:"default",normalizedTitle:"default",charIndex:3719},{level:3,title:"abstract",slug:"abstract",normalizedTitle:"abstract",charIndex:4424},{level:3,title:"synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:4922},{level:2,title:"ç¹æ®æ¹æ³",slug:"ç¹æ®æ¹æ³",normalizedTitle:"ç¹æ®æ¹æ³",charIndex:5127},{level:3,title:"main æ¹æ³",slug:"main-æ¹æ³",normalizedTitle:"main æ¹æ³",charIndex:5167},{level:3,title:"æé æ¹æ³",slug:"æé æ¹æ³",normalizedTitle:"æé æ¹æ³",charIndex:5631},{level:3,title:"ååæ¹æ³",slug:"ååæ¹æ³",normalizedTitle:"ååæ¹æ³",charIndex:6358},{level:3,title:"finalize() æ¹æ³",slug:"finalize-æ¹æ³",normalizedTitle:"finalize() æ¹æ³",charIndex:7078},{level:2,title:"è¦ååéè½½",slug:"è¦ååéè½½",normalizedTitle:"è¦ååéè½½",charIndex:7549},{level:2,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:8637},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8646}],headersStr:"æ¹æ³çä½¿ç¨ æ¹æ³å®ä¹ æ¹æ³çè°ç¨ éå½è°ç¨ æ¹æ³åæ° æ¹æ³ä¿®é¥°ç¬¦ è®¿é®æ§å¶ä¿®é¥°ç¬¦ static final default abstract synchronized ç¹æ®æ¹æ³ main æ¹æ³ æé æ¹æ³ ååæ¹æ³ finalize() æ¹æ³ è¦ååéè½½ å°ç» åèèµæ",content:'# æ·±å¥çè§£ Java æ¹æ³\n\n> æ¹æ³ï¼æçäººåæ¬¢å«å½æ°ï¼æ¯ä¸æ®µå¯éç¨çä»£ç æ®µã\n\n\n# æ¹æ³çä½¿ç¨\n\n\n# æ¹æ³å®ä¹\n\næ¹æ³å®ä¹è¯­æ³æ ¼å¼ï¼\n\n[ä¿®é¥°ç¬¦] è¿åå¼ç±»å æ¹æ³å([åæ°ç±»å åæ°å]){\n    ...\n    æ¹æ³ä½\n    ...\n    return è¿åå¼;\n}\n\n\nç¤ºä¾ï¼\n\npublic static void main(String[] args) {\n    System.out.println("Hello World");\n}\n\n\næ¹æ³åå«ä¸ä¸ªæ¹æ³å¤´åä¸ä¸ªæ¹æ³ä½ãä¸é¢æ¯ä¸ä¸ªæ¹æ³çææé¨åï¼\n\n * ä¿®é¥°ç¬¦ - ä¿®é¥°ç¬¦æ¯å¯éçï¼å®åè¯ç¼è¯å¨å¦ä½è°ç¨è¯¥æ¹æ³ãå®ä¹äºè¯¥æ¹æ³çè®¿é®ç±»åã\n * è¿åå¼ç±»å - è¿åå¼ç±»åè¡¨ç¤ºæ¹æ³æ§è¡ç»æåï¼è¿åç»æçæ°æ®ç±»åãå¦ææ²¡æè¿åå¼ï¼åºè®¾ä¸º voidã\n * æ¹æ³å - æ¯æ¹æ³çå®éåç§°ãæ¹æ³åååæ°è¡¨å±åæææ¹æ³ç­¾åã\n * åæ°ç±»å - åæ°åæ¯ä¸ä¸ªå ä½ç¬¦ãå½æ¹æ³è¢«è°ç¨æ¶ï¼ä¼ éå¼ç»åæ°ãåæ°åè¡¨æ¯ææ¹æ³çåæ°ç±»åãé¡ºåºååæ°çä¸ªæ°ãåæ°æ¯å¯éçï¼æ¹æ³å¯ä»¥ä¸åå«ä»»ä½åæ°ã\n * æ¹æ³ä½ - æ¹æ³ä½åå«å·ä½çè¯­å¥ï¼å®ä¹è¯¥æ¹æ³çåè½ã\n * return - å¿é¡»è¿åå£°ææ¹æ³æ¶è¿åå¼ç±»åç¸åçæ°æ®ç±»åãå¨ void æ¹æ³ä¸­ï¼return è¯­å¥å¯æå¯æ ï¼å¦æè¦å returnï¼ååªè½æ¯ return; è¿ç§å½¢å¼ã\n\n\n# æ¹æ³çè°ç¨\n\nå½ç¨åºè°ç¨ä¸ä¸ªæ¹æ³æ¶ï¼ç¨åºçæ§å¶æäº¤ç»äºè¢«è°ç¨çæ¹æ³ãå½è¢«è°ç¨æ¹æ³çè¿åè¯­å¥æ§è¡æèå°è¾¾æ¹æ³ä½é­æ¬å·æ¶åäº¤è¿æ§å¶æç»ç¨åºã\n\nJava æ¯æä¸¤ç§è°ç¨æ¹æ³çæ¹å¼ï¼æ ¹æ®æ¹æ³æ¯å¦æè¿åå¼æ¥éæ©ã\n\n * æè¿åå¼æ¹æ³ - æè¿åå¼æ¹æ³éå¸¸è¢«ç¨æ¥ç»ä¸ä¸ªåéèµå¼æä»£å¥å°è¿ç®è¡¨è¾¾å¼ä¸­è¿è¡è®¡ç®ã\n\nint larger = max(30, 40);\n\n\n * æ è¿åå¼æ¹æ³ - æ è¿åå¼æ¹æ³åªè½æ¯ä¸æ¡è¯­å¥ã\n\nSystem.out.println("Hello World");\n\n\n# éå½è°ç¨\n\nJava æ¯ææ¹æ³çéå½è°ç¨ï¼å³æ¹æ³è°ç¨èªèº«ï¼ã\n\n> ð æ³¨æï¼\n> \n>  * éå½æ¹æ³å¿é¡»ææç¡®çç»ææ¡ä»¶ã\n>  * å°½éé¿åä½¿ç¨éå½è°ç¨ãå ä¸ºéå½è°ç¨å¦æå¤çä¸å½ï¼å¯è½å¯¼è´æ æº¢åºã\n\nææ³¢é£å¥æ°åï¼ä¸ä¸ªå¸åçéå½ç®æ³ï¼ç¤ºä¾ï¼\n\npublic class RecursionMethodDemo {\n    public static int fib(int num) {\n        if (num == 1 || num == 2) {\n            return 1;\n        } else {\n            return fib(num - 2) + fib(num - 1);\n        }\n    }\n\n    public static void main(String[] args) {\n        for (int i = 1; i < 10; i++) {\n            System.out.print(fib(i) + "\\t");\n        }\n    }\n}\n\n\n\n# æ¹æ³åæ°\n\nå¨ C/C++ ç­ç¼ç¨è¯­è¨ä¸­ï¼æ¹æ³çåæ°ä¼ éä¸è¬æä¸¤ç§å½¢å¼ï¼\n\n * å¼ä¼ é - å¼ä¼ éçåæ°è¢«ç§°ä¸ºå½¢åãå¼ä¼ éæ¶ï¼ä¼ å¥çåæ°ï¼å¨æ¹æ³ä¸­çä¿®æ¹ï¼ä¸ä¼å¨æ¹æ³å¤é¨çæã\n * å¼ç¨ä¼ é - å¼ç¨ä¼ éçåæ°è¢«ç§°ä¸ºå®åãå¼ç¨ä¼ éæ¶ï¼ä¼ å¥çåæ°ï¼å¨æ¹æ³ä¸­çä¿®æ¹ï¼ä¼å¨æ¹æ³å¤é¨çæã\n\né£ä¹ï¼Java ä¸­æ¯ææ ·çå¢ï¼\n\nJava ä¸­åªæå¼ä¼ éã\n\nç¤ºä¾ä¸ï¼\n\npublic class MethodParamDemo {\n    public static void method(int value) {\n        value =  value + 1;\n    }\n    public static void main(String[] args) {\n        int num = 0;\n        method(num);\n        System.out.println("num = [" + num + "]");\n        method(num);\n        System.out.println("num = [" + num + "]");\n    }\n}\n// Output:\n// num = [0]\n// num = [0]\n\n\nç¤ºä¾äºï¼\n\npublic class MethodParamDemo2 {\n    public static void method(StringBuilder sb) {\n        sb = new StringBuilder("B");\n    }\n\n    public static void main(String[] args) {\n        StringBuilder sb = new StringBuilder("A");\n        System.out.println("sb = [" + sb.toString() + "]");\n        method(sb);\n        System.out.println("sb = [" + sb.toString() + "]");\n        sb = new StringBuilder("C");\n        System.out.println("sb = [" + sb.toString() + "]");\n    }\n}\n// Output:\n// sb = [A]\n// sb = [A]\n// sb = [C]\n\n\nè¯´æï¼\n\nä»¥ä¸ä¸¤ä¸ªç¤ºä¾ï¼æ è®ºåæ¹æ³ä¸­ä¼ å¥çæ¯åºç¡æ°æ®ç±»åï¼è¿æ¯å¼ç¨ç±»åï¼å¨æ¹æ³ä¸­ä¿®æ¹çå¼ï¼å¨å¤é¨é½æªçæã\n\nJava å¯¹äºåºæ¬æ°æ®ç±»åï¼ä¼ç´æ¥æ·è´å¼ä¼ éå°æ¹æ³ä¸­ï¼å¯¹äºå¼ç¨æ°æ®ç±»åï¼æ·è´å½åå¯¹è±¡çå¼ç¨å°åï¼ç¶åæè¯¥å°åä¼ éè¿å»ï¼æä»¥ä¹æ¯å¼ä¼ éã\n\n> æ©å±éè¯»ï¼\n> \n> å¾è§£ Java ä¸­çåæ°ä¼ é\n\n\n# æ¹æ³ä¿®é¥°ç¬¦\n\nåé¢æå°äºï¼Java æ¹æ³çä¿®é¥°ç¬¦æ¯å¯éçï¼å®åè¯ç¼è¯å¨å¦ä½è°ç¨è¯¥æ¹æ³ãå®ä¹äºè¯¥æ¹æ³çè®¿é®ç±»åã\n\nJava æ¹æ³æå¥½å ä¸ªä¿®é¥°ç¬¦ï¼è®©æä»¬ä¸ä¸æ¥è®¤è¯ä¸ä¸ï¼\n\n\n# è®¿é®æ§å¶ä¿®é¥°ç¬¦\n\nè®¿é®æéæ§å¶çç­çº§ï¼ä»æå¤§æéå°æå°æéä¾æ¬¡ä¸ºï¼\n\npublic > protected > åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ï¼> private\n\n\n * public - è¡¨ç¤ºä»»ä½ç±»é½å¯ä»¥è®¿é®ï¼\n * åè®¿é®æé - åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ãå®è¡¨ç¤ºå½ååä¸­çææå¶ä»ç±»é½å¯ä»¥è®¿é®ï¼ä½æ¯å¶å®åçç±»æ æ³è®¿é®ã\n * protected - è¡¨ç¤ºå­ç±»å¯ä»¥è®¿é®ï¼æ­¤å¤ï¼åä¸ä¸ªååçå¶ä»ç±»ä¹å¯ä»¥è®¿é®ï¼å³ä½¿è¿äºç±»ä¸æ¯å­ç±»ã\n * private - è¡¨ç¤ºå¶å®ä»»ä½ç±»é½æ æ³è®¿é®ã\n\n\n# static\n\nè¢« static ä¿®é¥°çæ¹æ³è¢«ç§°ä¸ºéææ¹æ³ã\n\néææ¹æ³ç¸æ¯äºæ®éçå®ä¾æ¹æ³ï¼ä¸»è¦æä»¥ä¸åºå«ï¼\n\n * å¨å¤é¨è°ç¨éææ¹æ³æ¶ï¼å¯ä»¥ä½¿ç¨ ç±»å.æ¹æ³å çæ¹å¼ï¼ä¹å¯ä»¥ä½¿ç¨ å¯¹è±¡å.æ¹æ³å çæ¹å¼ãèå®ä¾æ¹æ³åªæåé¢è¿ç§æ¹å¼ãä¹å°±æ¯è¯´ï¼è°ç¨éææ¹æ³å¯ä»¥æ éåå»ºå¯¹è±¡ã\n\n * éææ¹æ³å¨è®¿é®æ¬ç±»çæåæ¶ï¼åªåè®¸è®¿é®éææåï¼å³éææååéåéææ¹æ³ï¼ï¼èä¸åè®¸è®¿é®å®ä¾æååéåå®ä¾æ¹æ³ï¼å®ä¾æ¹æ³åæ æ­¤éå¶ã\n\néææ¹æ³å¸¸è¢«ç¨äºåç§å·¥å·ç±»ãå·¥åæ¹æ³ç±»ã\n\n\n# final\n\nè¢« final ä¿®é¥°çæ¹æ³ä¸è½è¢«å­ç±»è¦åï¼Overrideï¼ã\n\nfinal æ¹æ³ç¤ºä¾ï¼\n\npublic class FinalMethodDemo {\n    static class Father {\n        protected final void print() {\n            System.out.println("call Father print()");\n        };\n    }\n\n    static class Son extends Father {\n        @Override\n        protected void print() {\n            System.out.println("call print()");\n        }\n    }\n\n    public static void main(String[] args) {\n        Father demo = new Son();\n        demo.print();\n    }\n}\n// ç¼è¯æ¶ä¼æ¥é\n\n\n> è¯´æï¼\n> \n> ä¸é¢ç¤ºä¾ä¸­ï¼ç¶ç±» Father ä¸­å®ä¹äºä¸ä¸ª final æ¹æ³ print()ï¼åå¶å­ç±»ä¸è½ Override è¿ä¸ª final æ¹æ³ï¼å¦åä¼ç¼è¯æ¥éã\n\n\n# default\n\nJDK8 å¼å§ï¼æ¯æå¨æ¥å£ Interface ä¸­å®ä¹ default æ¹æ³ãdefault æ¹æ³åªè½åºç°å¨æ¥å£ Interface ä¸­ã\n\næ¥å£ä¸­è¢« default ä¿®é¥°çæ¹æ³è¢«ç§°ä¸ºé»è®¤æ¹æ³ï¼å®ç°æ­¤æ¥å£çç±»å¦ææ²¡ Override æ­¤æ¹æ³ï¼åç´æ¥ç»§æ¿è¿ä¸ªæ¹æ³ï¼ä¸åå¼ºå¶å¿é¡»å®ç°æ­¤æ¹æ³ã\n\ndefault æ¹æ³è¯­æ³çåºç°ï¼æ¯ä¸ºäºæ¢æçæåä¸ä¸ç Java ç±»åºçç±»å¢å æ°çåè½ï¼ ä¸ä¸å¿å¯¹è¿äºç±»éæ°è¿è¡è®¾è®¡ã ä¸¾ä¾æ¥è¯´ï¼JDK8 ä¸­ Collection ç±»ä¸­æä¸ä¸ªéå¸¸æ¹ä¾¿ç stream() æ¹æ³ï¼å°±æ¯è¢«ä¿®é¥°ä¸º defaultï¼Collection çä¸å¤§å  ListãSet å­ç±»å°±ç´æ¥ç»§æ¿äºè¿ä¸ªæ¹æ³ Iï¼ä¸å¿åä¸ºæ¯ä¸ªå­ç±»é½æ³¨ææ·»å è¿ä¸ªæ¹æ³ã\n\ndefault æ¹æ³ç¤ºä¾ï¼\n\npublic class DefaultMethodDemo {\n    interface MyInterface {\n        default void print() {\n            System.out.println("Hello World");\n        }\n    }\n\n\n    static class MyClass implements MyInterface {}\n\n    public static void main(String[] args) {\n        MyInterface obj = new MyClass();\n        obj.print();\n    }\n}\n// Output:\n// Hello World\n\n\n\n# abstract\n\nè¢« abstract ä¿®é¥°çæ¹æ³è¢«ç§°ä¸ºæ½è±¡æ¹æ³ï¼æ¹æ³ä¸è½æå®ä½ãæ½è±¡æ¹æ³åªè½åºç°æ½è±¡ç±»ä¸­ã\n\næ½è±¡æ¹æ³ç¤ºä¾ï¼\n\npublic class AbstractMethodDemo {\n    static abstract class AbstractClass {\n        abstract void print();\n    }\n\n    static class ConcreteClass extends AbstractClass {\n        @Override\n        void print() {\n            System.out.println("call print()");\n        }\n    }\n\n    public static void main(String[] args) {\n        AbstractClass demo = new ConcreteClass();\n        demo.print();\n    }\n\n}\n// Outpu:\n// call print()\n\n\n\n# synchronized\n\nsynchronized ç¨äºå¹¶åç¼ç¨ãè¢« synchronized ä¿®é¥°çæ¹æ³å¨ä¸ä¸ªæ¶å»ï¼åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡ã\n\nå¨ Java çåæ­¥å®¹å¨ï¼VectorãStackãHashTableï¼ä¸­ï¼ä½ ä¼è§å°å¤§éç synchronized æ¹æ³ãä¸è¿ï¼è¯·è®°ä½ï¼å¨ Java å¹¶åç¼ç¨ä¸­ï¼synchronized æ¹æ³å¹¶ä¸æ¯ä¸ä¸ªå¥½çéæ©ï¼å¤§å¤æ°æåµä¸ï¼æä»¬ä¼éæ©æ´å è½»éçº§çé ã\n\n\n# ç¹æ®æ¹æ³\n\nJava ä¸­ï¼æä¸äºè¾ä¸ºç¹æ®çæ¹æ³ï¼åå«ä½¿ç¨äºç¹æ®çåºæ¯ã\n\n\n# main æ¹æ³\n\nJava ä¸­ç main æ¹æ³æ¯ä¸ç§ç¹æ®çéææ¹æ³ï¼å ä¸ºææç Java ç¨åºé½æ¯ç± public static void main(String[] args) æ¹æ³å¼å§æ§è¡ã\n\næå¾å¤æ°æè½ç¶ä¸ç´ç¨ main æ¹æ³ï¼å´ä¸ç¥é main æ¹æ³ä¸­ç args æä»ä¹ç¨ãå®éä¸ï¼è¿æ¯ç¨æ¥æ¥æ¶æ¥æ¶å½ä»¤è¡è¾å¥åæ°çã\n\nç¤ºä¾ï¼\n\npublic class MainMethodDemo {\n    public static void main(String[] args) {\n        for (String arg : args) {\n            System.out.println("arg = [" + arg + "]");\n        }\n    }\n}\n\n\nä¾æ¬¡æ§è¡\n\njavac MainMethodDemo.java\njava MainMethodDemo A B C\n\n\næ§å¶å°ä¼æå°è¾åºåæ°ï¼\n\narg = [A]\narg = [B]\narg = [C]\n\n\n\n# æé æ¹æ³\n\nä»»ä½ç±»é½ææé æ¹æ³ï¼æé æ¹æ³çä½ç¨å°±æ¯å¨åå§åç±»å®ä¾æ¶ï¼è®¾ç½®å®ä¾çç¶æã\n\næ¯ä¸ªç±»é½ææé æ¹æ³ãå¦ææ²¡ææ¾å¼å°ä¸ºç±»å®ä¹ä»»ä½æé æ¹æ³ï¼Java ç¼è¯å¨å°ä¼ä¸ºè¯¥ç±»æä¾ä¸ä¸ªé»è®¤æé æ¹æ³ã\n\nå¨åå»ºä¸ä¸ªå¯¹è±¡çæ¶åï¼è³å°è¦è°ç¨ä¸ä¸ªæé æ¹æ³ãæé æ¹æ³çåç§°å¿é¡»ä¸ç±»ååï¼ä¸ä¸ªç±»å¯ä»¥æå¤ä¸ªæé æ¹æ³ã\n\npublic class ConstructorMethodDemo {\n\n    static class Person {\n        private String name;\n\n        public Person(String name) {\n            this.name = name;\n        }\n\n        public String getName() {\n            return name;\n        }\n\n        public void setName(String name) {\n            this.name = name;\n        }\n    }\n\n    public static void main(String[] args) {\n        Person person = new Person("jack");\n        System.out.println("person name is " + person.getName());\n    }\n}\n\n\næ³¨æï¼æé æ¹æ³é¤äºä½¿ç¨ publicï¼ä¹å¯ä»¥ä½¿ç¨ private ä¿®é¥°ï¼è¿ç§æåµä¸ï¼ç±»æ æ³è°ç¨æ­¤æé æ¹æ³å»å®ä¾åå¯¹è±¡ï¼è¿å¸¸å¸¸ç¨äºè®¾è®¡æ¨¡å¼ä¸­çåä¾æ¨¡å¼ã\n\n\n# ååæ¹æ³\n\nJDK5 å¼å§ï¼Java æ¯æä¼ éåç±»åçå¯ååæ°ç»ä¸ä¸ªæ¹æ³ãå¨æ¹æ³å£°æä¸­ï¼å¨æå®åæ°ç±»ååå ä¸ä¸ªçç¥å· ...ãä¸ä¸ªæ¹æ³ä¸­åªè½æå®ä¸ä¸ªå¯ååæ°ï¼å®å¿é¡»æ¯æ¹æ³çæåä¸ä¸ªåæ°ãä»»ä½æ®éçåæ°å¿é¡»å¨å®ä¹åå£°æã\n\nååæ¹æ³ç¤ºä¾ï¼\n\npublic class VarargsDemo {\n    public static void method(String... params) {\n        System.out.println("params.length = " + params.length);\n        for (String param : params) {\n            System.out.println("params = [" + param + "]");\n        }\n    }\n\n    public static void main(String[] args) {\n        method("red");\n        method("red", "yellow");\n        method("red", "yellow", "blue");\n    }\n}\n// Output:\n// params.length = 1\n// params = [red]\n// params.length = 2\n// params = [red]\n// params = [yellow]\n// params.length = 3\n// params = [red]\n// params = [yellow]\n// params = [blue]\n\n\n\n# finalize() æ¹æ³\n\nfinalize å¨å¯¹è±¡è¢«åå¾æ¶éå¨ææ(åæ¶)ä¹åè°ç¨ï¼ç¨æ¥æ¸é¤åæ¶å¯¹è±¡ã\n\nfinalize æ¯å¨ java.lang.Object éå®ä¹çï¼ä¹å°±æ¯è¯´æ¯ä¸ä¸ªå¯¹è±¡é½æè¿ä¹ä¸ªæ¹æ³ãè¿ä¸ªæ¹æ³å¨ GC å¯å¨ï¼è¯¥å¯¹è±¡è¢«åæ¶çæ¶åè¢«è°ç¨ã\n\nfinalizer() éå¸¸æ¯ä¸å¯é¢æµçï¼ä¹æ¯å¾å±é©çï¼ä¸è¬æåµä¸æ¯ä¸å¿è¦çãä½¿ç¨ç»ç»æ¹æ³ä¼å¯¼è´è¡ä¸ºä¸ç¨³å®ãéä½æ§è½ï¼ä»¥åå¯ç§»æ¤æ§é®é¢ã\n\nè¯·è®°ä½ï¼åºè¯¥å°½éé¿åä½¿ç¨ finalizer()ãåä¸ä¸è¦æå®å½ææ¯ C/C++ ä¸­çææå½æ°æ¥ç¨ãåå æ¯ï¼Finalizer çº¿ç¨ä¼åæä»¬çä¸»çº¿ç¨è¿è¡ç«äºï¼ä¸è¿ç±äºå®çä¼åçº§è¾ä½ï¼è·åå°ç CPU æ¶é´è¾å°ï¼å æ­¤å®æ°¸è¿ä¹èµ¶ä¸ä¸ä¸»çº¿ç¨çæ­¥ä¼ãæä»¥æåå¯è½ä¼åç OutOfMemoryError å¼å¸¸ã\n\n> æ©å±éè¯»ï¼\n> \n> ä¸é¢ä¸¤ç¯æç« æ¯è¾è¯¦ç»çè®²è¿°äº finalizer() å¯è½ä¼é æçé®é¢ååå ã\n> \n>  * Java ç Finalizer å¼åçåå­æº¢åº\n>  * éè½½ Finalize å¼åçåå­æ³é²\n\n\n# è¦ååéè½½\n\nè¦åï¼Overrideï¼æ¯æå­ç±»å®ä¹äºä¸ç¶ç±»ä¸­ååçæ¹æ³ï¼ä½æ¯å¨æ¹æ³è¦åæ¶å¿é¡»èèå°è®¿é®æéï¼å­ç±»è¦åçæ¹æ³ä¸è½æ¥ææ¯ç¶ç±»æ´å ä¸¥æ ¼çè®¿é®æéã\n\nå­ç±»è¦è¦åçæ¹æ³å¦æè¦è®¿é®ç¶ç±»çæ¹æ³ï¼å¯ä»¥ä½¿ç¨ super å³é®å­ã\n\nè¦åç¤ºä¾ï¼\n\npublic class MethodOverrideDemo {\n    static class Animal {\n        public void move() {\n            System.out.println("ä¼å¨");\n        }\n    }\n    static class Dog extends Animal {\n        @Override\n        public void move() {\n            super.move();\n            System.out.println("ä¼è·");\n        }\n    }\n\n    public static void main(String[] args) {\n        Animal dog = new Dog();\n        dog.move();\n    }\n}\n// Output:\n// ä¼å¨\n// ä¼è·\n\n\næ¹æ³çéè½½ï¼Overloadï¼æ¯ææ¹æ³åç§°ç¸åï¼ä½åæ°çç±»åæåæ°çä¸ªæ°ä¸åãéè¿ä¼ éåæ°çä¸ªæ°åç±»åçä¸åå¯ä»¥å®æä¸ååè½çæ¹æ³è°ç¨ã\n\n> ð æ³¨æï¼\n> \n> éè½½ä¸å®æ¯æ¹æ³çåæ°ä¸å®å¨ç¸åãå¦ææ¹æ³çåæ°å®å¨ç¸åï¼ä»ä»æ¯è¿åå¼ä¸åï¼Java æ¯æ æ³ç¼è¯éè¿çã\n\néè½½ç¤ºä¾ï¼\n\npublic class MethodOverloadDemo {\n    public static void add(int x, int y) {\n        System.out.println("x + y = " + (x + y));\n    }\n\n    public static void add(double x, double y) {\n        System.out.println("x + y = " + (x + y));\n    }\n\n    public static void main(String[] args) {\n        add(10, 20);\n        add(1.0, 2.0);\n    }\n}\n// Output:\n// x + y = 30\n// x + y = 3.0\n\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * Head First Java\n * å¾è§£ Java ä¸­çåæ°ä¼ é\n * Java ç Finalizer å¼åçåå­æº¢åº\n * éè½½ Finalize å¼åçåå­æ³é²',normalizedContent:'# æ·±å¥çè§£ java æ¹æ³\n\n> æ¹æ³ï¼æçäººåæ¬¢å«å½æ°ï¼æ¯ä¸æ®µå¯éç¨çä»£ç æ®µã\n\n\n# æ¹æ³çä½¿ç¨\n\n\n# æ¹æ³å®ä¹\n\næ¹æ³å®ä¹è¯­æ³æ ¼å¼ï¼\n\n[ä¿®é¥°ç¬¦] è¿åå¼ç±»å æ¹æ³å([åæ°ç±»å åæ°å]){\n    ...\n    æ¹æ³ä½\n    ...\n    return è¿åå¼;\n}\n\n\nç¤ºä¾ï¼\n\npublic static void main(string[] args) {\n    system.out.println("hello world");\n}\n\n\næ¹æ³åå«ä¸ä¸ªæ¹æ³å¤´åä¸ä¸ªæ¹æ³ä½ãä¸é¢æ¯ä¸ä¸ªæ¹æ³çææé¨åï¼\n\n * ä¿®é¥°ç¬¦ - ä¿®é¥°ç¬¦æ¯å¯éçï¼å®åè¯ç¼è¯å¨å¦ä½è°ç¨è¯¥æ¹æ³ãå®ä¹äºè¯¥æ¹æ³çè®¿é®ç±»åã\n * è¿åå¼ç±»å - è¿åå¼ç±»åè¡¨ç¤ºæ¹æ³æ§è¡ç»æåï¼è¿åç»æçæ°æ®ç±»åãå¦ææ²¡æè¿åå¼ï¼åºè®¾ä¸º voidã\n * æ¹æ³å - æ¯æ¹æ³çå®éåç§°ãæ¹æ³åååæ°è¡¨å±åæææ¹æ³ç­¾åã\n * åæ°ç±»å - åæ°åæ¯ä¸ä¸ªå ä½ç¬¦ãå½æ¹æ³è¢«è°ç¨æ¶ï¼ä¼ éå¼ç»åæ°ãåæ°åè¡¨æ¯ææ¹æ³çåæ°ç±»åãé¡ºåºååæ°çä¸ªæ°ãåæ°æ¯å¯éçï¼æ¹æ³å¯ä»¥ä¸åå«ä»»ä½åæ°ã\n * æ¹æ³ä½ - æ¹æ³ä½åå«å·ä½çè¯­å¥ï¼å®ä¹è¯¥æ¹æ³çåè½ã\n * return - å¿é¡»è¿åå£°ææ¹æ³æ¶è¿åå¼ç±»åç¸åçæ°æ®ç±»åãå¨ void æ¹æ³ä¸­ï¼return è¯­å¥å¯æå¯æ ï¼å¦æè¦å returnï¼ååªè½æ¯ return; è¿ç§å½¢å¼ã\n\n\n# æ¹æ³çè°ç¨\n\nå½ç¨åºè°ç¨ä¸ä¸ªæ¹æ³æ¶ï¼ç¨åºçæ§å¶æäº¤ç»äºè¢«è°ç¨çæ¹æ³ãå½è¢«è°ç¨æ¹æ³çè¿åè¯­å¥æ§è¡æèå°è¾¾æ¹æ³ä½é­æ¬å·æ¶åäº¤è¿æ§å¶æç»ç¨åºã\n\njava æ¯æä¸¤ç§è°ç¨æ¹æ³çæ¹å¼ï¼æ ¹æ®æ¹æ³æ¯å¦æè¿åå¼æ¥éæ©ã\n\n * æè¿åå¼æ¹æ³ - æè¿åå¼æ¹æ³éå¸¸è¢«ç¨æ¥ç»ä¸ä¸ªåéèµå¼æä»£å¥å°è¿ç®è¡¨è¾¾å¼ä¸­è¿è¡è®¡ç®ã\n\nint larger = max(30, 40);\n\n\n * æ è¿åå¼æ¹æ³ - æ è¿åå¼æ¹æ³åªè½æ¯ä¸æ¡è¯­å¥ã\n\nsystem.out.println("hello world");\n\n\n# éå½è°ç¨\n\njava æ¯ææ¹æ³çéå½è°ç¨ï¼å³æ¹æ³è°ç¨èªèº«ï¼ã\n\n> ð æ³¨æï¼\n> \n>  * éå½æ¹æ³å¿é¡»ææç¡®çç»ææ¡ä»¶ã\n>  * å°½éé¿åä½¿ç¨éå½è°ç¨ãå ä¸ºéå½è°ç¨å¦æå¤çä¸å½ï¼å¯è½å¯¼è´æ æº¢åºã\n\nææ³¢é£å¥æ°åï¼ä¸ä¸ªå¸åçéå½ç®æ³ï¼ç¤ºä¾ï¼\n\npublic class recursionmethoddemo {\n    public static int fib(int num) {\n        if (num == 1 || num == 2) {\n            return 1;\n        } else {\n            return fib(num - 2) + fib(num - 1);\n        }\n    }\n\n    public static void main(string[] args) {\n        for (int i = 1; i < 10; i++) {\n            system.out.print(fib(i) + "\\t");\n        }\n    }\n}\n\n\n\n# æ¹æ³åæ°\n\nå¨ c/c++ ç­ç¼ç¨è¯­è¨ä¸­ï¼æ¹æ³çåæ°ä¼ éä¸è¬æä¸¤ç§å½¢å¼ï¼\n\n * å¼ä¼ é - å¼ä¼ éçåæ°è¢«ç§°ä¸ºå½¢åãå¼ä¼ éæ¶ï¼ä¼ å¥çåæ°ï¼å¨æ¹æ³ä¸­çä¿®æ¹ï¼ä¸ä¼å¨æ¹æ³å¤é¨çæã\n * å¼ç¨ä¼ é - å¼ç¨ä¼ éçåæ°è¢«ç§°ä¸ºå®åãå¼ç¨ä¼ éæ¶ï¼ä¼ å¥çåæ°ï¼å¨æ¹æ³ä¸­çä¿®æ¹ï¼ä¼å¨æ¹æ³å¤é¨çæã\n\né£ä¹ï¼java ä¸­æ¯ææ ·çå¢ï¼\n\njava ä¸­åªæå¼ä¼ éã\n\nç¤ºä¾ä¸ï¼\n\npublic class methodparamdemo {\n    public static void method(int value) {\n        value =  value + 1;\n    }\n    public static void main(string[] args) {\n        int num = 0;\n        method(num);\n        system.out.println("num = [" + num + "]");\n        method(num);\n        system.out.println("num = [" + num + "]");\n    }\n}\n// output:\n// num = [0]\n// num = [0]\n\n\nç¤ºä¾äºï¼\n\npublic class methodparamdemo2 {\n    public static void method(stringbuilder sb) {\n        sb = new stringbuilder("b");\n    }\n\n    public static void main(string[] args) {\n        stringbuilder sb = new stringbuilder("a");\n        system.out.println("sb = [" + sb.tostring() + "]");\n        method(sb);\n        system.out.println("sb = [" + sb.tostring() + "]");\n        sb = new stringbuilder("c");\n        system.out.println("sb = [" + sb.tostring() + "]");\n    }\n}\n// output:\n// sb = [a]\n// sb = [a]\n// sb = [c]\n\n\nè¯´æï¼\n\nä»¥ä¸ä¸¤ä¸ªç¤ºä¾ï¼æ è®ºåæ¹æ³ä¸­ä¼ å¥çæ¯åºç¡æ°æ®ç±»åï¼è¿æ¯å¼ç¨ç±»åï¼å¨æ¹æ³ä¸­ä¿®æ¹çå¼ï¼å¨å¤é¨é½æªçæã\n\njava å¯¹äºåºæ¬æ°æ®ç±»åï¼ä¼ç´æ¥æ·è´å¼ä¼ éå°æ¹æ³ä¸­ï¼å¯¹äºå¼ç¨æ°æ®ç±»åï¼æ·è´å½åå¯¹è±¡çå¼ç¨å°åï¼ç¶åæè¯¥å°åä¼ éè¿å»ï¼æä»¥ä¹æ¯å¼ä¼ éã\n\n> æ©å±éè¯»ï¼\n> \n> å¾è§£ java ä¸­çåæ°ä¼ é\n\n\n# æ¹æ³ä¿®é¥°ç¬¦\n\nåé¢æå°äºï¼java æ¹æ³çä¿®é¥°ç¬¦æ¯å¯éçï¼å®åè¯ç¼è¯å¨å¦ä½è°ç¨è¯¥æ¹æ³ãå®ä¹äºè¯¥æ¹æ³çè®¿é®ç±»åã\n\njava æ¹æ³æå¥½å ä¸ªä¿®é¥°ç¬¦ï¼è®©æä»¬ä¸ä¸æ¥è®¤è¯ä¸ä¸ï¼\n\n\n# è®¿é®æ§å¶ä¿®é¥°ç¬¦\n\nè®¿é®æéæ§å¶çç­çº§ï¼ä»æå¤§æéå°æå°æéä¾æ¬¡ä¸ºï¼\n\npublic > protected > åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ï¼> private\n\n\n * public - è¡¨ç¤ºä»»ä½ç±»é½å¯ä»¥è®¿é®ï¼\n * åè®¿é®æé - åè®¿é®æéï¼æ²¡æä»»ä½å³é®å­ãå®è¡¨ç¤ºå½ååä¸­çææå¶ä»ç±»é½å¯ä»¥è®¿é®ï¼ä½æ¯å¶å®åçç±»æ æ³è®¿é®ã\n * protected - è¡¨ç¤ºå­ç±»å¯ä»¥è®¿é®ï¼æ­¤å¤ï¼åä¸ä¸ªååçå¶ä»ç±»ä¹å¯ä»¥è®¿é®ï¼å³ä½¿è¿äºç±»ä¸æ¯å­ç±»ã\n * private - è¡¨ç¤ºå¶å®ä»»ä½ç±»é½æ æ³è®¿é®ã\n\n\n# static\n\nè¢« static ä¿®é¥°çæ¹æ³è¢«ç§°ä¸ºéææ¹æ³ã\n\néææ¹æ³ç¸æ¯äºæ®éçå®ä¾æ¹æ³ï¼ä¸»è¦æä»¥ä¸åºå«ï¼\n\n * å¨å¤é¨è°ç¨éææ¹æ³æ¶ï¼å¯ä»¥ä½¿ç¨ ç±»å.æ¹æ³å çæ¹å¼ï¼ä¹å¯ä»¥ä½¿ç¨ å¯¹è±¡å.æ¹æ³å çæ¹å¼ãèå®ä¾æ¹æ³åªæåé¢è¿ç§æ¹å¼ãä¹å°±æ¯è¯´ï¼è°ç¨éææ¹æ³å¯ä»¥æ éåå»ºå¯¹è±¡ã\n\n * éææ¹æ³å¨è®¿é®æ¬ç±»çæåæ¶ï¼åªåè®¸è®¿é®éææåï¼å³éææååéåéææ¹æ³ï¼ï¼èä¸åè®¸è®¿é®å®ä¾æååéåå®ä¾æ¹æ³ï¼å®ä¾æ¹æ³åæ æ­¤éå¶ã\n\néææ¹æ³å¸¸è¢«ç¨äºåç§å·¥å·ç±»ãå·¥åæ¹æ³ç±»ã\n\n\n# final\n\nè¢« final ä¿®é¥°çæ¹æ³ä¸è½è¢«å­ç±»è¦åï¼overrideï¼ã\n\nfinal æ¹æ³ç¤ºä¾ï¼\n\npublic class finalmethoddemo {\n    static class father {\n        protected final void print() {\n            system.out.println("call father print()");\n        };\n    }\n\n    static class son extends father {\n        @override\n        protected void print() {\n            system.out.println("call print()");\n        }\n    }\n\n    public static void main(string[] args) {\n        father demo = new son();\n        demo.print();\n    }\n}\n// ç¼è¯æ¶ä¼æ¥é\n\n\n> è¯´æï¼\n> \n> ä¸é¢ç¤ºä¾ä¸­ï¼ç¶ç±» father ä¸­å®ä¹äºä¸ä¸ª final æ¹æ³ print()ï¼åå¶å­ç±»ä¸è½ override è¿ä¸ª final æ¹æ³ï¼å¦åä¼ç¼è¯æ¥éã\n\n\n# default\n\njdk8 å¼å§ï¼æ¯æå¨æ¥å£ interface ä¸­å®ä¹ default æ¹æ³ãdefault æ¹æ³åªè½åºç°å¨æ¥å£ interface ä¸­ã\n\næ¥å£ä¸­è¢« default ä¿®é¥°çæ¹æ³è¢«ç§°ä¸ºé»è®¤æ¹æ³ï¼å®ç°æ­¤æ¥å£çç±»å¦ææ²¡ override æ­¤æ¹æ³ï¼åç´æ¥ç»§æ¿è¿ä¸ªæ¹æ³ï¼ä¸åå¼ºå¶å¿é¡»å®ç°æ­¤æ¹æ³ã\n\ndefault æ¹æ³è¯­æ³çåºç°ï¼æ¯ä¸ºäºæ¢æçæåä¸ä¸ç java ç±»åºçç±»å¢å æ°çåè½ï¼ ä¸ä¸å¿å¯¹è¿äºç±»éæ°è¿è¡è®¾è®¡ã ä¸¾ä¾æ¥è¯´ï¼jdk8 ä¸­ collection ç±»ä¸­æä¸ä¸ªéå¸¸æ¹ä¾¿ç stream() æ¹æ³ï¼å°±æ¯è¢«ä¿®é¥°ä¸º defaultï¼collection çä¸å¤§å  listãset å­ç±»å°±ç´æ¥ç»§æ¿äºè¿ä¸ªæ¹æ³ iï¼ä¸å¿åä¸ºæ¯ä¸ªå­ç±»é½æ³¨ææ·»å è¿ä¸ªæ¹æ³ã\n\ndefault æ¹æ³ç¤ºä¾ï¼\n\npublic class defaultmethoddemo {\n    interface myinterface {\n        default void print() {\n            system.out.println("hello world");\n        }\n    }\n\n\n    static class myclass implements myinterface {}\n\n    public static void main(string[] args) {\n        myinterface obj = new myclass();\n        obj.print();\n    }\n}\n// output:\n// hello world\n\n\n\n# abstract\n\nè¢« abstract ä¿®é¥°çæ¹æ³è¢«ç§°ä¸ºæ½è±¡æ¹æ³ï¼æ¹æ³ä¸è½æå®ä½ãæ½è±¡æ¹æ³åªè½åºç°æ½è±¡ç±»ä¸­ã\n\næ½è±¡æ¹æ³ç¤ºä¾ï¼\n\npublic class abstractmethoddemo {\n    static abstract class abstractclass {\n        abstract void print();\n    }\n\n    static class concreteclass extends abstractclass {\n        @override\n        void print() {\n            system.out.println("call print()");\n        }\n    }\n\n    public static void main(string[] args) {\n        abstractclass demo = new concreteclass();\n        demo.print();\n    }\n\n}\n// outpu:\n// call print()\n\n\n\n# synchronized\n\nsynchronized ç¨äºå¹¶åç¼ç¨ãè¢« synchronized ä¿®é¥°çæ¹æ³å¨ä¸ä¸ªæ¶å»ï¼åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡ã\n\nå¨ java çåæ­¥å®¹å¨ï¼vectorãstackãhashtableï¼ä¸­ï¼ä½ ä¼è§å°å¤§éç synchronized æ¹æ³ãä¸è¿ï¼è¯·è®°ä½ï¼å¨ java å¹¶åç¼ç¨ä¸­ï¼synchronized æ¹æ³å¹¶ä¸æ¯ä¸ä¸ªå¥½çéæ©ï¼å¤§å¤æ°æåµä¸ï¼æä»¬ä¼éæ©æ´å è½»éçº§çé ã\n\n\n# ç¹æ®æ¹æ³\n\njava ä¸­ï¼æä¸äºè¾ä¸ºç¹æ®çæ¹æ³ï¼åå«ä½¿ç¨äºç¹æ®çåºæ¯ã\n\n\n# main æ¹æ³\n\njava ä¸­ç main æ¹æ³æ¯ä¸ç§ç¹æ®çéææ¹æ³ï¼å ä¸ºææç java ç¨åºé½æ¯ç± public static void main(string[] args) æ¹æ³å¼å§æ§è¡ã\n\næå¾å¤æ°æè½ç¶ä¸ç´ç¨ main æ¹æ³ï¼å´ä¸ç¥é main æ¹æ³ä¸­ç args æä»ä¹ç¨ãå®éä¸ï¼è¿æ¯ç¨æ¥æ¥æ¶æ¥æ¶å½ä»¤è¡è¾å¥åæ°çã\n\nç¤ºä¾ï¼\n\npublic class mainmethoddemo {\n    public static void main(string[] args) {\n        for (string arg : args) {\n            system.out.println("arg = [" + arg + "]");\n        }\n    }\n}\n\n\nä¾æ¬¡æ§è¡\n\njavac mainmethoddemo.java\njava mainmethoddemo a b c\n\n\næ§å¶å°ä¼æå°è¾åºåæ°ï¼\n\narg = [a]\narg = [b]\narg = [c]\n\n\n\n# æé æ¹æ³\n\nä»»ä½ç±»é½ææé æ¹æ³ï¼æé æ¹æ³çä½ç¨å°±æ¯å¨åå§åç±»å®ä¾æ¶ï¼è®¾ç½®å®ä¾çç¶æã\n\næ¯ä¸ªç±»é½ææé æ¹æ³ãå¦ææ²¡ææ¾å¼å°ä¸ºç±»å®ä¹ä»»ä½æé æ¹æ³ï¼java ç¼è¯å¨å°ä¼ä¸ºè¯¥ç±»æä¾ä¸ä¸ªé»è®¤æé æ¹æ³ã\n\nå¨åå»ºä¸ä¸ªå¯¹è±¡çæ¶åï¼è³å°è¦è°ç¨ä¸ä¸ªæé æ¹æ³ãæé æ¹æ³çåç§°å¿é¡»ä¸ç±»ååï¼ä¸ä¸ªç±»å¯ä»¥æå¤ä¸ªæé æ¹æ³ã\n\npublic class constructormethoddemo {\n\n    static class person {\n        private string name;\n\n        public person(string name) {\n            this.name = name;\n        }\n\n        public string getname() {\n            return name;\n        }\n\n        public void setname(string name) {\n            this.name = name;\n        }\n    }\n\n    public static void main(string[] args) {\n        person person = new person("jack");\n        system.out.println("person name is " + person.getname());\n    }\n}\n\n\næ³¨æï¼æé æ¹æ³é¤äºä½¿ç¨ publicï¼ä¹å¯ä»¥ä½¿ç¨ private ä¿®é¥°ï¼è¿ç§æåµä¸ï¼ç±»æ æ³è°ç¨æ­¤æé æ¹æ³å»å®ä¾åå¯¹è±¡ï¼è¿å¸¸å¸¸ç¨äºè®¾è®¡æ¨¡å¼ä¸­çåä¾æ¨¡å¼ã\n\n\n# ååæ¹æ³\n\njdk5 å¼å§ï¼java æ¯æä¼ éåç±»åçå¯ååæ°ç»ä¸ä¸ªæ¹æ³ãå¨æ¹æ³å£°æä¸­ï¼å¨æå®åæ°ç±»ååå ä¸ä¸ªçç¥å· ...ãä¸ä¸ªæ¹æ³ä¸­åªè½æå®ä¸ä¸ªå¯ååæ°ï¼å®å¿é¡»æ¯æ¹æ³çæåä¸ä¸ªåæ°ãä»»ä½æ®éçåæ°å¿é¡»å¨å®ä¹åå£°æã\n\nååæ¹æ³ç¤ºä¾ï¼\n\npublic class varargsdemo {\n    public static void method(string... params) {\n        system.out.println("params.length = " + params.length);\n        for (string param : params) {\n            system.out.println("params = [" + param + "]");\n        }\n    }\n\n    public static void main(string[] args) {\n        method("red");\n        method("red", "yellow");\n        method("red", "yellow", "blue");\n    }\n}\n// output:\n// params.length = 1\n// params = [red]\n// params.length = 2\n// params = [red]\n// params = [yellow]\n// params.length = 3\n// params = [red]\n// params = [yellow]\n// params = [blue]\n\n\n\n# finalize() æ¹æ³\n\nfinalize å¨å¯¹è±¡è¢«åå¾æ¶éå¨ææ(åæ¶)ä¹åè°ç¨ï¼ç¨æ¥æ¸é¤åæ¶å¯¹è±¡ã\n\nfinalize æ¯å¨ java.lang.object éå®ä¹çï¼ä¹å°±æ¯è¯´æ¯ä¸ä¸ªå¯¹è±¡é½æè¿ä¹ä¸ªæ¹æ³ãè¿ä¸ªæ¹æ³å¨ gc å¯å¨ï¼è¯¥å¯¹è±¡è¢«åæ¶çæ¶åè¢«è°ç¨ã\n\nfinalizer() éå¸¸æ¯ä¸å¯é¢æµçï¼ä¹æ¯å¾å±é©çï¼ä¸è¬æåµä¸æ¯ä¸å¿è¦çãä½¿ç¨ç»ç»æ¹æ³ä¼å¯¼è´è¡ä¸ºä¸ç¨³å®ãéä½æ§è½ï¼ä»¥åå¯ç§»æ¤æ§é®é¢ã\n\nè¯·è®°ä½ï¼åºè¯¥å°½éé¿åä½¿ç¨ finalizer()ãåä¸ä¸è¦æå®å½ææ¯ c/c++ ä¸­çææå½æ°æ¥ç¨ãåå æ¯ï¼finalizer çº¿ç¨ä¼åæä»¬çä¸»çº¿ç¨è¿è¡ç«äºï¼ä¸è¿ç±äºå®çä¼åçº§è¾ä½ï¼è·åå°ç cpu æ¶é´è¾å°ï¼å æ­¤å®æ°¸è¿ä¹èµ¶ä¸ä¸ä¸»çº¿ç¨çæ­¥ä¼ãæä»¥æåå¯è½ä¼åç outofmemoryerror å¼å¸¸ã\n\n> æ©å±éè¯»ï¼\n> \n> ä¸é¢ä¸¤ç¯æç« æ¯è¾è¯¦ç»çè®²è¿°äº finalizer() å¯è½ä¼é æçé®é¢ååå ã\n> \n>  * java ç finalizer å¼åçåå­æº¢åº\n>  * éè½½ finalize å¼åçåå­æ³é²\n\n\n# è¦ååéè½½\n\nè¦åï¼overrideï¼æ¯æå­ç±»å®ä¹äºä¸ç¶ç±»ä¸­ååçæ¹æ³ï¼ä½æ¯å¨æ¹æ³è¦åæ¶å¿é¡»èèå°è®¿é®æéï¼å­ç±»è¦åçæ¹æ³ä¸è½æ¥ææ¯ç¶ç±»æ´å ä¸¥æ ¼çè®¿é®æéã\n\nå­ç±»è¦è¦åçæ¹æ³å¦æè¦è®¿é®ç¶ç±»çæ¹æ³ï¼å¯ä»¥ä½¿ç¨ super å³é®å­ã\n\nè¦åç¤ºä¾ï¼\n\npublic class methodoverridedemo {\n    static class animal {\n        public void move() {\n            system.out.println("ä¼å¨");\n        }\n    }\n    static class dog extends animal {\n        @override\n        public void move() {\n            super.move();\n            system.out.println("ä¼è·");\n        }\n    }\n\n    public static void main(string[] args) {\n        animal dog = new dog();\n        dog.move();\n    }\n}\n// output:\n// ä¼å¨\n// ä¼è·\n\n\næ¹æ³çéè½½ï¼overloadï¼æ¯ææ¹æ³åç§°ç¸åï¼ä½åæ°çç±»åæåæ°çä¸ªæ°ä¸åãéè¿ä¼ éåæ°çä¸ªæ°åç±»åçä¸åå¯ä»¥å®æä¸ååè½çæ¹æ³è°ç¨ã\n\n> ð æ³¨æï¼\n> \n> éè½½ä¸å®æ¯æ¹æ³çåæ°ä¸å®å¨ç¸åãå¦ææ¹æ³çåæ°å®å¨ç¸åï¼ä»ä»æ¯è¿åå¼ä¸åï¼java æ¯æ æ³ç¼è¯éè¿çã\n\néè½½ç¤ºä¾ï¼\n\npublic class methodoverloaddemo {\n    public static void add(int x, int y) {\n        system.out.println("x + y = " + (x + y));\n    }\n\n    public static void add(double x, double y) {\n        system.out.println("x + y = " + (x + y));\n    }\n\n    public static void main(string[] args) {\n        add(10, 20);\n        add(1.0, 2.0);\n    }\n}\n// output:\n// x + y = 30\n// x + y = 3.0\n\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * head first java\n * å¾è§£ java ä¸­çåæ°ä¼ é\n * java ç finalizer å¼åçåå­æº¢åº\n * éè½½ finalize å¼åçåå­æ³é²',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java æ°ç»",frontmatter:{title:"æ·±å¥çè§£ Java æ°ç»",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","æ°ç»"],permalink:"/pages/155518/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/05.Java%E6%95%B0%E7%BB%84.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/05.Javaæ°ç».md",key:"v-de4ee0ba",path:"/pages/155518/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:19},{level:3,title:"æ°ç»çç¹æ§",slug:"æ°ç»çç¹æ§",normalizedTitle:"æ°ç»çç¹æ§",charIndex:26},{level:3,title:"æ°ç»åå®¹å¨",slug:"æ°ç»åå®¹å¨",normalizedTitle:"æ°ç»åå®¹å¨",charIndex:220},{level:3,title:"Java æ°ç»çæ¬è´¨æ¯å¯¹è±¡",slug:"java-æ°ç»çæ¬è´¨æ¯å¯¹è±¡",normalizedTitle:"java æ°ç»çæ¬è´¨æ¯å¯¹è±¡",charIndex:402},{level:3,title:"Java æ°ç»ååå­",slug:"java-æ°ç»ååå­",normalizedTitle:"java æ°ç»ååå­",charIndex:608},{level:2,title:"å£°ææ°ç»",slug:"å£°ææ°ç»",normalizedTitle:"å£°ææ°ç»",charIndex:763},{level:2,title:"åå»ºæ°ç»",slug:"åå»ºæ°ç»",normalizedTitle:"åå»ºæ°ç»",charIndex:828},{level:3,title:"æ°ç»ç»´åº¦çå½¢å¼",slug:"æ°ç»ç»´åº¦çå½¢å¼",normalizedTitle:"æ°ç»ç»´åº¦çå½¢å¼",charIndex:2400},{level:3,title:"æ°ç»ç»´åº¦çå¤§å°",slug:"æ°ç»ç»´åº¦çå¤§å°",normalizedTitle:"æ°ç»ç»´åº¦çå¤§å°",charIndex:3469},{level:2,title:"è®¿é®æ°ç»",slug:"è®¿é®æ°ç»",normalizedTitle:"è®¿é®æ°ç»",charIndex:3580},{level:2,title:"æ°ç»çå¼ç¨",slug:"æ°ç»çå¼ç¨",normalizedTitle:"æ°ç»çå¼ç¨",charIndex:4026},{level:2,title:"æ³ååæ°ç»",slug:"æ³ååæ°ç»",normalizedTitle:"æ³ååæ°ç»",charIndex:4710},{level:2,title:"å¤ç»´æ°ç»",slug:"å¤ç»´æ°ç»",normalizedTitle:"å¤ç»´æ°ç»",charIndex:5699},{level:2,title:"Arrays ç±»",slug:"arrays-ç±»",normalizedTitle:"arrays ç±»",charIndex:6775},{level:2,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:6998},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7007}],headersStr:"ç®ä» æ°ç»çç¹æ§ æ°ç»åå®¹å¨ Java æ°ç»çæ¬è´¨æ¯å¯¹è±¡ Java æ°ç»ååå­ å£°ææ°ç» åå»ºæ°ç» æ°ç»ç»´åº¦çå½¢å¼ æ°ç»ç»´åº¦çå¤§å° è®¿é®æ°ç» æ°ç»çå¼ç¨ æ³ååæ°ç» å¤ç»´æ°ç» Arrays ç±» å°ç» åèèµæ",content:'# æ·±å¥çè§£ Java æ°ç»\n\n\n# ç®ä»\n\n\n# æ°ç»çç¹æ§\n\næ°ç»å¯¹äºæ¯ä¸é¨ç¼ç¨è¯­è¨æ¥è¯´é½æ¯éè¦çæ°æ®ç»æä¹ä¸ï¼å½ç¶ä¸åè¯­è¨å¯¹æ°ç»çå®ç°åå¤çä¹ä¸å°½ç¸åãå ä¹ææç¨åºè®¾è®¡è¯­è¨é½æ¯ææ°ç»ã\n\næ°ç»ä»£è¡¨ä¸ç³»åå¯¹è±¡æèåºæ¬æ°æ®ç±»åï¼ææç¸åçç±»åé½å°è£å°ä¸èµ·ï¼éç¨ä¸ä¸ªç»ä¸çæ è¯ç¬¦åç§°ã\n\næ°ç»çå®ä¹åä½¿ç¨éè¦éè¿æ¹æ¬å· []ã\n\n> Java ä¸­ï¼æ°ç»æ¯ä¸ç§å¼ç¨ç±»åã\n> \n> Java ä¸­ï¼æ°ç»æ¯ç¨æ¥å­å¨åºå®å¤§å°çåç±»ååç´ ã\n\n\n# æ°ç»åå®¹å¨\n\nJava ä¸­ï¼æ¢ç¶æäºå¼ºå¤§çå®¹å¨ï¼æ¯ä¸æ¯å°±ä¸éè¦æ°ç»äºï¼\n\nç­æ¡æ¯ä¸ã\n\nè¯ç¶ï¼å¤§å¤æ°æåµä¸ï¼åºè¯¥éæ©å®¹å¨å­å¨æ°æ®ã\n\nä½æ¯ï¼æ°ç»ä¹ä¸æ¯æ¯«æ æ¯å¤ï¼\n\n * Java ä¸­ï¼æ°ç»æ¯ä¸ç§æçæé«çå­å¨åéæºè®¿é®å¯¹è±¡å¼ç¨åºåçæ¹å¼ãæ°ç»çæçè¦é«äºå®¹å¨ï¼å¦ ArrayListï¼ã\n * æ°ç»å¯ä»¥ææå¼ç±»åï¼èå®¹å¨åä¸è½ï¼è¿æ¶ï¼å°±å¿é¡»ç¨å°åè£ç±»ï¼ã\n\n\n# Java æ°ç»çæ¬è´¨æ¯å¯¹è±¡\n\nJava æ°ç»çæ¬è´¨æ¯å¯¹è±¡ãå®å·æ Java ä¸­å¶ä»å¯¹è±¡çä¸äºåºæ¬ç¹ç¹ï¼å°è£äºä¸äºæ°æ®ï¼å¯ä»¥è®¿é®å±æ§ï¼ä¹å¯ä»¥è°ç¨æ¹æ³ãæä»¥ï¼æ°ç»æ¯å¯¹è±¡ã\n\nå¦ææä¸¤ä¸ªç±» A å Bï¼å¦æ B ç»§æ¿ï¼extendsï¼äº Aï¼é£ä¹ A[] ç±»åçå¼ç¨å°±å¯ä»¥æå B[] ç±»åçå¯¹è±¡ã\n\n> æ©å±éè¯»ï¼Java ä¸­æ°ç»çç¹æ§\n> \n> å¦ææ³è¦è®ºè¯ Java æ°ç»æ¬è´¨æ¯å¯¹è±¡ï¼ä¸å¦¨ä¸è¯»è¿ç¯æç« ã\n\n\n# Java æ°ç»ååå­\n\nJava æ°ç»å¨åå­ä¸­çå­å¨æ¯è¿æ ·çï¼\n\næ°ç»å¯¹è±¡ï¼è¿éå¯ä»¥çæä¸ä¸ªæéï¼å­å¨å¨æ ä¸­ã\n\næ°ç»åç´ å­å¨å¨å ä¸­ã\n\nå¦ä¸å¾æç¤ºï¼åªæå½ JVM æ§è¡ new String[] æ¶ï¼æä¼å¨å ä¸­å¼è¾ç¸åºçåå­åºåãæ°ç»å¯¹è±¡ array å¯ä»¥è§ä¸ºä¸ä¸ªæéï¼æåè¿ååå­çå­å¨å°åã\n\n\n\n\n# å£°ææ°ç»\n\nå£°ææ°ç»åéçè¯­æ³å¦ä¸ï¼\n\nint[] arr1; // æ¨èé£æ ¼\nint arr2[]; // ææç¸å\n\n\n\n# åå»ºæ°ç»\n\nJava è¯­è¨ä½¿ç¨ new æä½ç¬¦æ¥åå»ºæ°ç»ãæä¸¤ç§åå»ºæ°ç»æ¹å¼ï¼\n\n * æå®æ°ç»ç»´åº¦\n   * ä¸ºæ°ç»å¼è¾æå®å¤§å°çæ°ç»ç»´åº¦ã\n   * å¦ææ°ç»åç´ æ¯åºç¡æ°æ®ç±»åï¼ä¼å°æ¯ä¸ªåç´ è®¾ä¸ºé»è®¤å¼ï¼å¦ææ¯å¼ç¨ç±»åï¼åç´ å¼ä¸º nullã\n * ä¸æå®æ°ç»ç»´åº¦\n   * ç¨è±æ¬å·ä¸­çå®éåç´ åå§åæ°ç»ï¼æ°ç»å¤§å°ä¸åç´ æ°ç¸åã\n\nç¤ºä¾ 1ï¼\n\npublic class ArrayDemo {\n    public static void main(String[] args) {\n        int[] array1 = new int[2]; // æå®æ°ç»ç»´åº¦\n        int[] array2 = new int[] { 1, 2 }; // ä¸æå®æ°ç»ç»´åº¦\n\n        System.out.println("array1 size is " + array1.length);\n        for (int item : array1) {\n            System.out.println(item);\n        }\n\n        System.out.println("array2 size is " + array1.length);\n        for (int item : array2) {\n            System.out.println(item);\n        }\n    }\n}\n// Output:\n// array1 size is 2\n// 0\n// 0\n// array2 size is 2\n// 1\n// 2\n\n\n> ð¡ è¯´æ è¯·æ³¨ææ°ç» array1 ä¸­çåç´ è½ç¶æ²¡æåå§åï¼ä½æ¯ length åæå®çæ°ç»ç»´åº¦æ¯ä¸æ ·çãè¿è¡¨ææå®æ°ç»ç»´åº¦åï¼æ è®ºåé¢æ¯å¦åå§åæ°ç»ä¸­çåç´ ï¼æ°ç»é½å·²ç»å¼è¾äºç¸åºçåå­ã\n> \n> æ°ç» array1 ä¸­çåç´ é½è¢«è®¾ä¸ºé»è®¤å¼ã\n\nç¤ºä¾ 2ï¼\n\npublic class ArrayDemo2 {\n    static class User {}\n\n    public static void main(String[] args) {\n        User[] array1 = new User[2]; // æå®æ°ç»ç»´åº¦\n        User[] array2 = new User[] {new User(), new User()}; // ä¸æå®æ°ç»ç»´åº¦\n\n        System.out.println("array1: ");\n        for (User item : array1) {\n            System.out.println(item);\n        }\n\n        System.out.println("array2: ");\n        for (User item : array2) {\n            System.out.println(item);\n        }\n    }\n}\n// Output:\n// array1:\n// null\n// null\n// array2:\n// io.github.dunwu.javacore.array.ArrayDemo2$User@4141d797\n// io.github.dunwu.javacore.array.ArrayDemo2$User@68f7aae2\n\n\n> ð¡ è¯´æ\n> \n> è¯·å°æ¬ä¾ä¸ç¤ºä¾ 1 æ¯è¾ï¼å¯ä»¥åç°ï¼å¦æä½¿ç¨æå®æ°ç»ç»´åº¦æ¹å¼åå»ºæ°ç»ï¼ä¸æ°ç»åç´ ä¸ºå¼ç¨ç±»åï¼åæ°ç»ä¸­çåç´ åç´ å¼ä¸º nullã\n\n\n# æ°ç»ç»´åº¦çå½¢å¼\n\nåå»ºæ°ç»æ¶ï¼æå®çæ°ç»ç»´åº¦å¯ä»¥æå¤ç§å½¢å¼ï¼\n\n * æ°ç»ç»´åº¦å¯ä»¥æ¯æ´æ°ãå­ç¬¦ã\n * æ°ç»ç»´åº¦å¯ä»¥æ¯æ´æ°åãå­ç¬¦ååéã\n * æ°ç»ç»´åº¦å¯ä»¥æ¯è®¡ç®ç»æä¸ºæ´æ°æå­ç¬¦çè¡¨è¾¾å¼ã\n\nç¤ºä¾ï¼\n\npublic class ArrayDemo3 {\n    public static void main(String[] args) {\n        int length = 3;\n        // æ¾å¼è¢«æ³¨æçä»£ç ï¼ç¼è¯å¨ä¼æ¥é\n        // int[] array = new int[4.0];\n        // int[] array2 = new int["test"];\n        int[] array3 = new int[\'a\'];\n        int[] array4 = new int[length];\n        int[] array5 = new int[length + 2];\n        int[] array6 = new int[\'a\' + 2];\n        // int[] array7 = new int[length + 2.1];\n        System.out.println("array3.length = [" + array3.length + "]");\n        System.out.println("array4.length = [" + array4.length + "]");\n        System.out.println("array5.length = [" + array5.length + "]");\n        System.out.println("array6.length = [" + array6.length + "]");\n    }\n}\n// Output:\n// array3.length = [97]\n// array4.length = [3]\n// array5.length = [5]\n// array6.length = [99]\n\n\n> ð¡ è¯´æ\n> \n> å½æå®çæ°ç»ç»´åº¦æ¯å­ç¬¦æ¶ï¼Java ä¼å°å¶è½¬ä¸ºæ´æ°ãå¦å­ç¬¦ a ç ASCII ç æ¯ 97ã\n> \n> ç»¼ä¸ï¼Java æ°ç»çæ°ç»ç»´åº¦å¯ä»¥æ¯å¸¸éãåéãè¡¨è¾¾å¼ï¼åªè¦è½¬æ¢ä¸ºæ´æ°å³å¯ã\n> \n> è¯·çæï¼æäºç¼ç¨è¯­è¨åä¸æ¯æè¿ç¹ï¼å¦ C/C++ è¯­è¨ï¼åªåè®¸æ°ç»ç»´åº¦æ¯å¸¸éã\n\n\n# æ°ç»ç»´åº¦çå¤§å°\n\næ°ç»ç»´åº¦å¹¶éæ²¡æä¸éçï¼å¦ææ°å¼è¿å¤§ï¼ç¼è¯æ¶ä¼æ¥éã\n\nint[] array = new int[6553612431]; // æ°ç»ç»´åº¦è¿å¤§ï¼ç¼è¯æ¥é\n\n\næ­¤å¤ï¼æ°ç»è¿å¤§ï¼å¯è½ä¼å¯¼è´æ æº¢åºã\n\n\n# è®¿é®æ°ç»\n\nJava ä¸­ï¼å¯ä»¥éè¿å¨ [] ä¸­æå®ä¸æ ï¼è®¿é®æ°ç»åç´ ï¼ä¸æ ä½ç½®ä» 0 å¼å§ã\n\npublic class ArrayDemo4 {\n    public static void main(String[] args) {\n        int[] array = {1, 2, 3};\n        for (int i = 0; i < array.length; i++) {\n            array[i]++;\n            System.out.println(String.format("array[%d] = %d", i, array[i]));\n        }\n    }\n}\n// Output:\n// array[0] = 2\n// array[1] = 3\n// array[2] = 4\n\n\n> ð¡ è¯´æ\n> \n> ä¸é¢çç¤ºä¾ä¸­ï¼ä» 0 å¼å§ï¼ä½¿ç¨ä¸æ éåæ°ç» array çææåç´ ï¼ä¸ºæ¯ä¸ªåç´ å¼å  1 ã\n\n\n# æ°ç»çå¼ç¨\n\nJava ä¸­ï¼æ°ç»ç±»åæ¯ä¸ç§å¼ç¨ç±»åã\n\nå æ­¤ï¼å®å¯ä»¥ä½ä¸ºå¼ç¨ï¼è¢« Java å½æ°ä½ä¸ºå½æ°å¥åæè¿åå¼ã\n\næ°ç»ä½ä¸ºå½æ°å¥åçç¤ºä¾ï¼\n\npublic class ArrayRefDemo {\n    private static void fun(int[] array) {\n        for (int i : array) {\n            System.out.print(i + "\\t");\n        }\n    }\n\n    public static void main(String[] args) {\n        int[] array = new int[] {1, 3, 5};\n        fun(array);\n    }\n}\n// Output:\n// 1\t3\t5\n\n\næ°ç»ä½ä¸ºå½æ°è¿åå¼çç¤ºä¾ï¼\n\npublic class ArrayRefDemo2 {\n    /**\n     * è¿åä¸ä¸ªæ°ç»\n     */\n    private static int[] fun() {\n        return new int[] {1, 3, 5};\n    }\n\n    public static void main(String[] args) {\n        int[] array = fun();\n        System.out.println(Arrays.toString(array));\n    }\n}\n// Output:\n// [1, 3, 5]\n\n\n\n# æ³ååæ°ç»\n\néå¸¸ï¼æ°ç»åæ³åä¸è½å¾å¥½å°ç»åãä½ ä¸è½å®ä¾åå·æåæ°åç±»åçæ°ç»ã\n\nPeel<Banana>[] peels = new Pell<Banana>[10]; // è¿è¡ä»£ç éæ³\n\n\nJava ä¸­ä¸åè®¸ç´æ¥åå»ºæ³åæ°ç»ãä½æ¯ï¼å¯ä»¥éè¿åå»ºä¸ä¸ªç±»åæ¦é¤çæ°ç»ï¼ç¶åè½¬åçæ¹å¼æ¥åå»ºæ³åæ°ç»ã\n\npublic class GenericArrayDemo<T> {\n\n    static class GenericArray<T> {\n        private T[] array;\n\n        public GenericArray(int num) {\n            array = (T[]) new Object[num];\n        }\n\n        public void put(int index, T item) {\n            array[index] = item;\n        }\n\n        public T get(int index) { return array[index]; }\n\n        public T[] array() { return array; }\n    }\n\n\n\n    public static void main(String[] args) {\n        GenericArray<Integer> genericArray = new GenericArray<Integer>(4);\n        genericArray.put(0, 0);\n        genericArray.put(1, 1);\n        Object[] array = genericArray.array();\n        System.out.println(Arrays.deepToString(array));\n    }\n}\n// Output:\n// [0, 1, null, null]\n\n\n> æ©å±éè¯»ï¼https://www.cnblogs.com/jiangzhaowei/p/7399522.html\n> \n> æè®¤ä¸ºï¼å¯¹äºæ³åæ°ç»ççè§£ï¼ç¹å°ä¸ºæ­¢å³å¯ãå®éä¸ï¼ççéè¦å­å¨æ³åï¼è¿æ¯ä½¿ç¨å®¹å¨æ´åéã\n\n\n# å¤ç»´æ°ç»\n\nå¤ç»´æ°ç»å¯ä»¥çææ¯æ°ç»çæ°ç»ï¼æ¯å¦äºç»´æ°ç»å°±æ¯ä¸ä¸ªç¹æ®çä¸ç»´æ°ç»ï¼å¶æ¯ä¸ä¸ªåç´ é½æ¯ä¸ä¸ªä¸ç»´æ°ç»ã\n\nJava å¯ä»¥æ¯æäºç»´æ°ç»ãä¸ç»´æ°ç»ãåç»´æ°ç»ãäºç»´æ°ç»ããã\n\nä½æ¯ï¼ä»¥æ­£å¸¸äººççè§£è½åï¼ä¸è¬ä¹å°±æå¤è½çè§£ä¸ç»´æ°ç»ãæä»¥ï¼è¯·ä¸è¦ååäººç±»çäºï¼å»å®ä¹è¿å¤ç»´åº¦çæ°ç»ã\n\nå¤ç»´æ°ç»ä½¿ç¨ç¤ºä¾ï¼\n\npublic class MultiArrayDemo {\n    public static void main(String[] args) {\n        Integer[][] a1 = { // èªå¨è£ç®±\n            {1, 2, 3,},\n            {4, 5, 6,},\n        };\n        Double[][][] a2 = { // èªå¨è£ç®±\n            { {1.1, 2.2}, {3.3, 4.4} },\n            { {5.5, 6.6}, {7.7, 8.8} },\n            { {9.9, 1.2}, {2.3, 3.4} },\n        };\n        String[][] a3 = {\n            {"The", "Quick", "Sly", "Fox"},\n            {"Jumped", "Over"},\n            {"The", "Lazy", "Brown", "Dog", "and", "friend"},\n        };\n        System.out.println("a1: " + Arrays.deepToString(a1));\n        System.out.println("a2: " + Arrays.deepToString(a2));\n        System.out.println("a3: " + Arrays.deepToString(a3));\n    }\n}\n// Output:\n// a1: [[1, 2, 3], [4, 5, 6]]\n// a2: [[[1.1, 2.2], [3.3, 4.4]], [[5.5, 6.6], [7.7, 8.8]], [[9.9, 1.2], [2.3, 3.4]]]\n// a3: [[The, Quick, Sly, Fox], [Jumped, Over], [The, Lazy, Brown, Dog, and, friend]]\n\n\n\n# Arrays ç±»\n\nJava ä¸­ï¼æä¾äºä¸ä¸ªå¾æç¨çæ°ç»å·¥å·ç±»ï¼Arraysã\n\nå®æä¾çä¸»è¦æä½æï¼\n\n * sort - æåº\n * binarySearch - æ¥æ¾\n * equals - æ¯è¾\n * fill - å¡«å\n * asList - è½¬åè¡¨\n * hash - åå¸\n * toString - è½¬å­ç¬¦ä¸²\n\n> æ©å±éè¯»ï¼https://juejin.im/post/5a6ade5c518825733e60acb8\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * Java ä¸­æ°ç»çç¹æ§\n * https://juejin.im/post/59cae3de6fb9a00a4551915b\n * https://www.cnblogs.com/jiangzhaowei/p/7399522.html\n * https://juejin.im/post/5a6ade5c518825733e60acb8',normalizedContent:'# æ·±å¥çè§£ java æ°ç»\n\n\n# ç®ä»\n\n\n# æ°ç»çç¹æ§\n\næ°ç»å¯¹äºæ¯ä¸é¨ç¼ç¨è¯­è¨æ¥è¯´é½æ¯éè¦çæ°æ®ç»æä¹ä¸ï¼å½ç¶ä¸åè¯­è¨å¯¹æ°ç»çå®ç°åå¤çä¹ä¸å°½ç¸åãå ä¹ææç¨åºè®¾è®¡è¯­è¨é½æ¯ææ°ç»ã\n\næ°ç»ä»£è¡¨ä¸ç³»åå¯¹è±¡æèåºæ¬æ°æ®ç±»åï¼ææç¸åçç±»åé½å°è£å°ä¸èµ·ï¼éç¨ä¸ä¸ªç»ä¸çæ è¯ç¬¦åç§°ã\n\næ°ç»çå®ä¹åä½¿ç¨éè¦éè¿æ¹æ¬å· []ã\n\n> java ä¸­ï¼æ°ç»æ¯ä¸ç§å¼ç¨ç±»åã\n> \n> java ä¸­ï¼æ°ç»æ¯ç¨æ¥å­å¨åºå®å¤§å°çåç±»ååç´ ã\n\n\n# æ°ç»åå®¹å¨\n\njava ä¸­ï¼æ¢ç¶æäºå¼ºå¤§çå®¹å¨ï¼æ¯ä¸æ¯å°±ä¸éè¦æ°ç»äºï¼\n\nç­æ¡æ¯ä¸ã\n\nè¯ç¶ï¼å¤§å¤æ°æåµä¸ï¼åºè¯¥éæ©å®¹å¨å­å¨æ°æ®ã\n\nä½æ¯ï¼æ°ç»ä¹ä¸æ¯æ¯«æ æ¯å¤ï¼\n\n * java ä¸­ï¼æ°ç»æ¯ä¸ç§æçæé«çå­å¨åéæºè®¿é®å¯¹è±¡å¼ç¨åºåçæ¹å¼ãæ°ç»çæçè¦é«äºå®¹å¨ï¼å¦ arraylistï¼ã\n * æ°ç»å¯ä»¥ææå¼ç±»åï¼èå®¹å¨åä¸è½ï¼è¿æ¶ï¼å°±å¿é¡»ç¨å°åè£ç±»ï¼ã\n\n\n# java æ°ç»çæ¬è´¨æ¯å¯¹è±¡\n\njava æ°ç»çæ¬è´¨æ¯å¯¹è±¡ãå®å·æ java ä¸­å¶ä»å¯¹è±¡çä¸äºåºæ¬ç¹ç¹ï¼å°è£äºä¸äºæ°æ®ï¼å¯ä»¥è®¿é®å±æ§ï¼ä¹å¯ä»¥è°ç¨æ¹æ³ãæä»¥ï¼æ°ç»æ¯å¯¹è±¡ã\n\nå¦ææä¸¤ä¸ªç±» a å bï¼å¦æ b ç»§æ¿ï¼extendsï¼äº aï¼é£ä¹ a[] ç±»åçå¼ç¨å°±å¯ä»¥æå b[] ç±»åçå¯¹è±¡ã\n\n> æ©å±éè¯»ï¼java ä¸­æ°ç»çç¹æ§\n> \n> å¦ææ³è¦è®ºè¯ java æ°ç»æ¬è´¨æ¯å¯¹è±¡ï¼ä¸å¦¨ä¸è¯»è¿ç¯æç« ã\n\n\n# java æ°ç»ååå­\n\njava æ°ç»å¨åå­ä¸­çå­å¨æ¯è¿æ ·çï¼\n\næ°ç»å¯¹è±¡ï¼è¿éå¯ä»¥çæä¸ä¸ªæéï¼å­å¨å¨æ ä¸­ã\n\næ°ç»åç´ å­å¨å¨å ä¸­ã\n\nå¦ä¸å¾æç¤ºï¼åªæå½ jvm æ§è¡ new string[] æ¶ï¼æä¼å¨å ä¸­å¼è¾ç¸åºçåå­åºåãæ°ç»å¯¹è±¡ array å¯ä»¥è§ä¸ºä¸ä¸ªæéï¼æåè¿ååå­çå­å¨å°åã\n\n\n\n\n# å£°ææ°ç»\n\nå£°ææ°ç»åéçè¯­æ³å¦ä¸ï¼\n\nint[] arr1; // æ¨èé£æ ¼\nint arr2[]; // ææç¸å\n\n\n\n# åå»ºæ°ç»\n\njava è¯­è¨ä½¿ç¨ new æä½ç¬¦æ¥åå»ºæ°ç»ãæä¸¤ç§åå»ºæ°ç»æ¹å¼ï¼\n\n * æå®æ°ç»ç»´åº¦\n   * ä¸ºæ°ç»å¼è¾æå®å¤§å°çæ°ç»ç»´åº¦ã\n   * å¦ææ°ç»åç´ æ¯åºç¡æ°æ®ç±»åï¼ä¼å°æ¯ä¸ªåç´ è®¾ä¸ºé»è®¤å¼ï¼å¦ææ¯å¼ç¨ç±»åï¼åç´ å¼ä¸º nullã\n * ä¸æå®æ°ç»ç»´åº¦\n   * ç¨è±æ¬å·ä¸­çå®éåç´ åå§åæ°ç»ï¼æ°ç»å¤§å°ä¸åç´ æ°ç¸åã\n\nç¤ºä¾ 1ï¼\n\npublic class arraydemo {\n    public static void main(string[] args) {\n        int[] array1 = new int[2]; // æå®æ°ç»ç»´åº¦\n        int[] array2 = new int[] { 1, 2 }; // ä¸æå®æ°ç»ç»´åº¦\n\n        system.out.println("array1 size is " + array1.length);\n        for (int item : array1) {\n            system.out.println(item);\n        }\n\n        system.out.println("array2 size is " + array1.length);\n        for (int item : array2) {\n            system.out.println(item);\n        }\n    }\n}\n// output:\n// array1 size is 2\n// 0\n// 0\n// array2 size is 2\n// 1\n// 2\n\n\n> ð¡ è¯´æ è¯·æ³¨ææ°ç» array1 ä¸­çåç´ è½ç¶æ²¡æåå§åï¼ä½æ¯ length åæå®çæ°ç»ç»´åº¦æ¯ä¸æ ·çãè¿è¡¨ææå®æ°ç»ç»´åº¦åï¼æ è®ºåé¢æ¯å¦åå§åæ°ç»ä¸­çåç´ ï¼æ°ç»é½å·²ç»å¼è¾äºç¸åºçåå­ã\n> \n> æ°ç» array1 ä¸­çåç´ é½è¢«è®¾ä¸ºé»è®¤å¼ã\n\nç¤ºä¾ 2ï¼\n\npublic class arraydemo2 {\n    static class user {}\n\n    public static void main(string[] args) {\n        user[] array1 = new user[2]; // æå®æ°ç»ç»´åº¦\n        user[] array2 = new user[] {new user(), new user()}; // ä¸æå®æ°ç»ç»´åº¦\n\n        system.out.println("array1: ");\n        for (user item : array1) {\n            system.out.println(item);\n        }\n\n        system.out.println("array2: ");\n        for (user item : array2) {\n            system.out.println(item);\n        }\n    }\n}\n// output:\n// array1:\n// null\n// null\n// array2:\n// io.github.dunwu.javacore.array.arraydemo2$user@4141d797\n// io.github.dunwu.javacore.array.arraydemo2$user@68f7aae2\n\n\n> ð¡ è¯´æ\n> \n> è¯·å°æ¬ä¾ä¸ç¤ºä¾ 1 æ¯è¾ï¼å¯ä»¥åç°ï¼å¦æä½¿ç¨æå®æ°ç»ç»´åº¦æ¹å¼åå»ºæ°ç»ï¼ä¸æ°ç»åç´ ä¸ºå¼ç¨ç±»åï¼åæ°ç»ä¸­çåç´ åç´ å¼ä¸º nullã\n\n\n# æ°ç»ç»´åº¦çå½¢å¼\n\nåå»ºæ°ç»æ¶ï¼æå®çæ°ç»ç»´åº¦å¯ä»¥æå¤ç§å½¢å¼ï¼\n\n * æ°ç»ç»´åº¦å¯ä»¥æ¯æ´æ°ãå­ç¬¦ã\n * æ°ç»ç»´åº¦å¯ä»¥æ¯æ´æ°åãå­ç¬¦ååéã\n * æ°ç»ç»´åº¦å¯ä»¥æ¯è®¡ç®ç»æä¸ºæ´æ°æå­ç¬¦çè¡¨è¾¾å¼ã\n\nç¤ºä¾ï¼\n\npublic class arraydemo3 {\n    public static void main(string[] args) {\n        int length = 3;\n        // æ¾å¼è¢«æ³¨æçä»£ç ï¼ç¼è¯å¨ä¼æ¥é\n        // int[] array = new int[4.0];\n        // int[] array2 = new int["test"];\n        int[] array3 = new int[\'a\'];\n        int[] array4 = new int[length];\n        int[] array5 = new int[length + 2];\n        int[] array6 = new int[\'a\' + 2];\n        // int[] array7 = new int[length + 2.1];\n        system.out.println("array3.length = [" + array3.length + "]");\n        system.out.println("array4.length = [" + array4.length + "]");\n        system.out.println("array5.length = [" + array5.length + "]");\n        system.out.println("array6.length = [" + array6.length + "]");\n    }\n}\n// output:\n// array3.length = [97]\n// array4.length = [3]\n// array5.length = [5]\n// array6.length = [99]\n\n\n> ð¡ è¯´æ\n> \n> å½æå®çæ°ç»ç»´åº¦æ¯å­ç¬¦æ¶ï¼java ä¼å°å¶è½¬ä¸ºæ´æ°ãå¦å­ç¬¦ a ç ascii ç æ¯ 97ã\n> \n> ç»¼ä¸ï¼java æ°ç»çæ°ç»ç»´åº¦å¯ä»¥æ¯å¸¸éãåéãè¡¨è¾¾å¼ï¼åªè¦è½¬æ¢ä¸ºæ´æ°å³å¯ã\n> \n> è¯·çæï¼æäºç¼ç¨è¯­è¨åä¸æ¯æè¿ç¹ï¼å¦ c/c++ è¯­è¨ï¼åªåè®¸æ°ç»ç»´åº¦æ¯å¸¸éã\n\n\n# æ°ç»ç»´åº¦çå¤§å°\n\næ°ç»ç»´åº¦å¹¶éæ²¡æä¸éçï¼å¦ææ°å¼è¿å¤§ï¼ç¼è¯æ¶ä¼æ¥éã\n\nint[] array = new int[6553612431]; // æ°ç»ç»´åº¦è¿å¤§ï¼ç¼è¯æ¥é\n\n\næ­¤å¤ï¼æ°ç»è¿å¤§ï¼å¯è½ä¼å¯¼è´æ æº¢åºã\n\n\n# è®¿é®æ°ç»\n\njava ä¸­ï¼å¯ä»¥éè¿å¨ [] ä¸­æå®ä¸æ ï¼è®¿é®æ°ç»åç´ ï¼ä¸æ ä½ç½®ä» 0 å¼å§ã\n\npublic class arraydemo4 {\n    public static void main(string[] args) {\n        int[] array = {1, 2, 3};\n        for (int i = 0; i < array.length; i++) {\n            array[i]++;\n            system.out.println(string.format("array[%d] = %d", i, array[i]));\n        }\n    }\n}\n// output:\n// array[0] = 2\n// array[1] = 3\n// array[2] = 4\n\n\n> ð¡ è¯´æ\n> \n> ä¸é¢çç¤ºä¾ä¸­ï¼ä» 0 å¼å§ï¼ä½¿ç¨ä¸æ éåæ°ç» array çææåç´ ï¼ä¸ºæ¯ä¸ªåç´ å¼å  1 ã\n\n\n# æ°ç»çå¼ç¨\n\njava ä¸­ï¼æ°ç»ç±»åæ¯ä¸ç§å¼ç¨ç±»åã\n\nå æ­¤ï¼å®å¯ä»¥ä½ä¸ºå¼ç¨ï¼è¢« java å½æ°ä½ä¸ºå½æ°å¥åæè¿åå¼ã\n\næ°ç»ä½ä¸ºå½æ°å¥åçç¤ºä¾ï¼\n\npublic class arrayrefdemo {\n    private static void fun(int[] array) {\n        for (int i : array) {\n            system.out.print(i + "\\t");\n        }\n    }\n\n    public static void main(string[] args) {\n        int[] array = new int[] {1, 3, 5};\n        fun(array);\n    }\n}\n// output:\n// 1\t3\t5\n\n\næ°ç»ä½ä¸ºå½æ°è¿åå¼çç¤ºä¾ï¼\n\npublic class arrayrefdemo2 {\n    /**\n     * è¿åä¸ä¸ªæ°ç»\n     */\n    private static int[] fun() {\n        return new int[] {1, 3, 5};\n    }\n\n    public static void main(string[] args) {\n        int[] array = fun();\n        system.out.println(arrays.tostring(array));\n    }\n}\n// output:\n// [1, 3, 5]\n\n\n\n# æ³ååæ°ç»\n\néå¸¸ï¼æ°ç»åæ³åä¸è½å¾å¥½å°ç»åãä½ ä¸è½å®ä¾åå·æåæ°åç±»åçæ°ç»ã\n\npeel<banana>[] peels = new pell<banana>[10]; // è¿è¡ä»£ç éæ³\n\n\njava ä¸­ä¸åè®¸ç´æ¥åå»ºæ³åæ°ç»ãä½æ¯ï¼å¯ä»¥éè¿åå»ºä¸ä¸ªç±»åæ¦é¤çæ°ç»ï¼ç¶åè½¬åçæ¹å¼æ¥åå»ºæ³åæ°ç»ã\n\npublic class genericarraydemo<t> {\n\n    static class genericarray<t> {\n        private t[] array;\n\n        public genericarray(int num) {\n            array = (t[]) new object[num];\n        }\n\n        public void put(int index, t item) {\n            array[index] = item;\n        }\n\n        public t get(int index) { return array[index]; }\n\n        public t[] array() { return array; }\n    }\n\n\n\n    public static void main(string[] args) {\n        genericarray<integer> genericarray = new genericarray<integer>(4);\n        genericarray.put(0, 0);\n        genericarray.put(1, 1);\n        object[] array = genericarray.array();\n        system.out.println(arrays.deeptostring(array));\n    }\n}\n// output:\n// [0, 1, null, null]\n\n\n> æ©å±éè¯»ï¼https://www.cnblogs.com/jiangzhaowei/p/7399522.html\n> \n> æè®¤ä¸ºï¼å¯¹äºæ³åæ°ç»ççè§£ï¼ç¹å°ä¸ºæ­¢å³å¯ãå®éä¸ï¼ççéè¦å­å¨æ³åï¼è¿æ¯ä½¿ç¨å®¹å¨æ´åéã\n\n\n# å¤ç»´æ°ç»\n\nå¤ç»´æ°ç»å¯ä»¥çææ¯æ°ç»çæ°ç»ï¼æ¯å¦äºç»´æ°ç»å°±æ¯ä¸ä¸ªç¹æ®çä¸ç»´æ°ç»ï¼å¶æ¯ä¸ä¸ªåç´ é½æ¯ä¸ä¸ªä¸ç»´æ°ç»ã\n\njava å¯ä»¥æ¯æäºç»´æ°ç»ãä¸ç»´æ°ç»ãåç»´æ°ç»ãäºç»´æ°ç»ããã\n\nä½æ¯ï¼ä»¥æ­£å¸¸äººççè§£è½åï¼ä¸è¬ä¹å°±æå¤è½çè§£ä¸ç»´æ°ç»ãæä»¥ï¼è¯·ä¸è¦ååäººç±»çäºï¼å»å®ä¹è¿å¤ç»´åº¦çæ°ç»ã\n\nå¤ç»´æ°ç»ä½¿ç¨ç¤ºä¾ï¼\n\npublic class multiarraydemo {\n    public static void main(string[] args) {\n        integer[][] a1 = { // èªå¨è£ç®±\n            {1, 2, 3,},\n            {4, 5, 6,},\n        };\n        double[][][] a2 = { // èªå¨è£ç®±\n            { {1.1, 2.2}, {3.3, 4.4} },\n            { {5.5, 6.6}, {7.7, 8.8} },\n            { {9.9, 1.2}, {2.3, 3.4} },\n        };\n        string[][] a3 = {\n            {"the", "quick", "sly", "fox"},\n            {"jumped", "over"},\n            {"the", "lazy", "brown", "dog", "and", "friend"},\n        };\n        system.out.println("a1: " + arrays.deeptostring(a1));\n        system.out.println("a2: " + arrays.deeptostring(a2));\n        system.out.println("a3: " + arrays.deeptostring(a3));\n    }\n}\n// output:\n// a1: [[1, 2, 3], [4, 5, 6]]\n// a2: [[[1.1, 2.2], [3.3, 4.4]], [[5.5, 6.6], [7.7, 8.8]], [[9.9, 1.2], [2.3, 3.4]]]\n// a3: [[the, quick, sly, fox], [jumped, over], [the, lazy, brown, dog, and, friend]]\n\n\n\n# arrays ç±»\n\njava ä¸­ï¼æä¾äºä¸ä¸ªå¾æç¨çæ°ç»å·¥å·ç±»ï¼arraysã\n\nå®æä¾çä¸»è¦æä½æï¼\n\n * sort - æåº\n * binarysearch - æ¥æ¾\n * equals - æ¯è¾\n * fill - å¡«å\n * aslist - è½¬åè¡¨\n * hash - åå¸\n * tostring - è½¬å­ç¬¦ä¸²\n\n> æ©å±éè¯»ï¼https://juejin.im/post/5a6ade5c518825733e60acb8\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * java ä¸­æ°ç»çç¹æ§\n * https://juejin.im/post/59cae3de6fb9a00a4551915b\n * https://www.cnblogs.com/jiangzhaowei/p/7399522.html\n * https://juejin.im/post/5a6ade5c518825733e60acb8',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java æä¸¾",frontmatter:{title:"æ·±å¥çè§£ Java æä¸¾",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","æä¸¾"],permalink:"/pages/979887/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/06.Java%E6%9E%9A%E4%B8%BE.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/06.Javaæä¸¾.md",key:"v-4e691f6f",path:"/pages/979887/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:19},{level:2,title:"æä¸¾çæ¬è´¨",slug:"æä¸¾çæ¬è´¨",normalizedTitle:"æä¸¾çæ¬è´¨",charIndex:185},{level:2,title:"æä¸¾çæ¹æ³",slug:"æä¸¾çæ¹æ³",normalizedTitle:"æä¸¾çæ¹æ³",charIndex:1295},{level:2,title:"æä¸¾çç¹æ§",slug:"æä¸¾çç¹æ§",normalizedTitle:"æä¸¾çç¹æ§",charIndex:3237},{level:3,title:"åºæ¬ç¹æ§",slug:"åºæ¬ç¹æ§",normalizedTitle:"åºæ¬ç¹æ§",charIndex:3320},{level:3,title:"æä¸¾å¯ä»¥æ·»å æ¹æ³",slug:"æä¸¾å¯ä»¥æ·»å æ¹æ³",normalizedTitle:"æä¸¾å¯ä»¥æ·»å æ¹æ³",charIndex:3446},{level:3,title:"æä¸¾å¯ä»¥å®ç°æ¥å£",slug:"æä¸¾å¯ä»¥å®ç°æ¥å£",normalizedTitle:"æä¸¾å¯ä»¥å®ç°æ¥å£",charIndex:5006},{level:3,title:"æä¸¾ä¸å¯ä»¥ç»§æ¿",slug:"æä¸¾ä¸å¯ä»¥ç»§æ¿",normalizedTitle:"æä¸¾ä¸å¯ä»¥ç»§æ¿",charIndex:5613},{level:2,title:"æä¸¾çåºç¨",slug:"æä¸¾çåºç¨",normalizedTitle:"æä¸¾çåºç¨",charIndex:5744},{level:3,title:"ç»ç»å¸¸é",slug:"ç»ç»å¸¸é",normalizedTitle:"ç»ç»å¸¸é",charIndex:5754},{level:3,title:"switch ç¶ææº",slug:"switch-ç¶ææº",normalizedTitle:"switch ç¶ææº",charIndex:5986},{level:3,title:"éè¯¯ç ",slug:"éè¯¯ç ",normalizedTitle:"éè¯¯ç ",charIndex:171},{level:3,title:"ç»ç»æä¸¾",slug:"ç»ç»æä¸¾",normalizedTitle:"ç»ç»æä¸¾",charIndex:8136},{level:3,title:"ç­ç¥æä¸¾",slug:"ç­ç¥æä¸¾",normalizedTitle:"ç­ç¥æä¸¾",charIndex:10264},{level:3,title:"æä¸¾å®ç°åä¾æ¨¡å¼",slug:"æä¸¾å®ç°åä¾æ¨¡å¼",normalizedTitle:"æä¸¾å®ç°åä¾æ¨¡å¼",charIndex:11727},{level:2,title:"æä¸¾å·¥å·ç±»",slug:"æä¸¾å·¥å·ç±»",normalizedTitle:"æä¸¾å·¥å·ç±»",charIndex:12386},{level:3,title:"EnumSet",slug:"enumset",normalizedTitle:"enumset",charIndex:12420},{level:3,title:"EnumMap",slug:"enummap",normalizedTitle:"enummap",charIndex:12430},{level:2,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:14158},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:14167}],headersStr:"ç®ä» æä¸¾çæ¬è´¨ æä¸¾çæ¹æ³ æä¸¾çç¹æ§ åºæ¬ç¹æ§ æä¸¾å¯ä»¥æ·»å æ¹æ³ æä¸¾å¯ä»¥å®ç°æ¥å£ æä¸¾ä¸å¯ä»¥ç»§æ¿ æä¸¾çåºç¨ ç»ç»å¸¸é switch ç¶ææº éè¯¯ç  ç»ç»æä¸¾ ç­ç¥æä¸¾ æä¸¾å®ç°åä¾æ¨¡å¼ æä¸¾å·¥å·ç±» EnumSet EnumMap å°ç» åèèµæ",content:'# æ·±å¥çè§£ Java æä¸¾\n\n\n# ç®ä»\n\nenum çå¨ç§°ä¸º enumerationï¼ æ¯ JDK5 ä¸­å¼å¥çç¹æ§ã\n\nå¨ Java ä¸­ï¼è¢« enum å³é®å­ä¿®é¥°çç±»åå°±æ¯æä¸¾ç±»åãå½¢å¼å¦ä¸ï¼\n\nenum ColorEn { RED, GREEN, BLUE }\n\n\næä¸¾çå¥½å¤ï¼å¯ä»¥å°å¸¸éç»ç»èµ·æ¥ï¼ç»ä¸è¿è¡ç®¡çã\n\næä¸¾çå¸ååºç¨åºæ¯ï¼éè¯¯ç ãç¶ææºç­ã\n\n\n# æä¸¾çæ¬è´¨\n\njava.lang.Enumç±»å£°æ\n\npublic abstract class Enum<E extends Enum<E>>\n        implements Comparable<E>, Serializable { ... }\n\n\næ°å»ºä¸ä¸ª ColorEn.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\npackage io.github.dunwu.javacore.enumeration;\n\npublic enum ColorEn {\n    RED,YELLOW,BLUE\n}\n\n\næ§è¡ javac ColorEn.java å½ä»¤ï¼çæ ColorEn.class æä»¶ã\n\nç¶åæ§è¡ javap ColorEn.class å½ä»¤ï¼è¾åºå¦ä¸åå®¹ï¼\n\nCompiled from "ColorEn.java"\npublic final class io.github.dunwu.javacore.enumeration.ColorEn extends java.lang.Enum<io.github.dunwu.javacore.enumeration.ColorEn> {\n  public static final io.github.dunwu.javacore.enumeration.ColorEn RED;\n  public static final io.github.dunwu.javacore.enumeration.ColorEn YELLOW;\n  public static final io.github.dunwu.javacore.enumeration.ColorEn BLUE;\n  public static io.github.dunwu.javacore.enumeration.ColorEn[] values();\n  public static io.github.dunwu.javacore.enumeration.ColorEn valueOf(java.lang.String);\n  static {};\n}\n\n\n> ð¡ è¯´æï¼\n> \n> ä»ä¸é¢çä¾å­å¯ä»¥çåºï¼\n> \n> æä¸¾çæ¬è´¨æ¯ java.lang.Enum çå­ç±»ã\n> \n> å°½ç®¡ enum çèµ·æ¥åæ¯ä¸ç§æ°çæ°æ®ç±»åï¼äºå®ä¸ï¼enum æ¯ä¸ç§åéå¶çç±»ï¼å¹¶ä¸å·æèªå·±çæ¹æ³ãæä¸¾è¿ç§ç¹æ®çç±»å ä¸ºè¢«ä¿®é¥°ä¸º finalï¼æä»¥ä¸è½ç»§æ¿å¶ä»ç±»ã\n> \n> å®ä¹çæä¸¾å¼ï¼ä¼è¢«é»è®¤ä¿®é¥°ä¸º public static final ï¼ä»ä¿®é¥°å³é®å­ï¼å³å¯çåºæä¸¾å¼æ¬è´¨ä¸æ¯éæå¸¸éã\n\n\n# æä¸¾çæ¹æ³\n\nå¨ enum ä¸­ï¼æä¾äºä¸äºåºæ¬æ¹æ³ï¼\n\n * values()ï¼è¿å enum å®ä¾çæ°ç»ï¼èä¸è¯¥æ°ç»ä¸­çåç´ ä¸¥æ ¼ä¿æå¨ enum ä¸­å£°ææ¶çé¡ºåºã\n * name()ï¼è¿åå®ä¾åã\n * ordinal()ï¼è¿åå®ä¾å£°ææ¶çæ¬¡åºï¼ä» 0 å¼å§ã\n * getDeclaringClass()ï¼è¿åå®ä¾æå±ç enum ç±»åã\n * equals() ï¼å¤æ­æ¯å¦ä¸ºåä¸ä¸ªå¯¹è±¡ã\n\nå¯ä»¥ä½¿ç¨ == æ¥æ¯è¾enumå®ä¾ã\n\næ­¤å¤ï¼java.lang.Enumå®ç°äºComparableå Serializable æ¥å£ï¼æä»¥ä¹æä¾ compareTo() æ¹æ³ã\n\nä¾ï¼å±ç¤º enum çåºæ¬æ¹æ³\n\npublic class EnumMethodDemo {\n    enum Color {RED, GREEN, BLUE;}\n    enum Size {BIG, MIDDLE, SMALL;}\n    public static void main(String args[]) {\n        System.out.println("=========== Print all Color ===========");\n        for (Color c : Color.values()) {\n            System.out.println(c + " ordinal: " + c.ordinal());\n        }\n        System.out.println("=========== Print all Size ===========");\n        for (Size s : Size.values()) {\n            System.out.println(s + " ordinal: " + s.ordinal());\n        }\n\n        Color green = Color.GREEN;\n        System.out.println("green name(): " + green.name());\n        System.out.println("green getDeclaringClass(): " + green.getDeclaringClass());\n        System.out.println("green hashCode(): " + green.hashCode());\n        System.out.println("green compareTo Color.GREEN: " + green.compareTo(Color.GREEN));\n        System.out.println("green equals Color.GREEN: " + green.equals(Color.GREEN));\n        System.out.println("green equals Size.MIDDLE: " + green.equals(Size.MIDDLE));\n        System.out.println("green equals 1: " + green.equals(1));\n        System.out.format("green == Color.BLUE: %b\\n", green == Color.BLUE);\n    }\n}\n\n\nè¾åº\n\n=========== Print all Color ===========\nRED ordinal: 0\nGREEN ordinal: 1\nBLUE ordinal: 2\n=========== Print all Size ===========\nBIG ordinal: 0\nMIDDLE ordinal: 1\nSMALL ordinal: 2\ngreen name(): GREEN\ngreen getDeclaringClass(): class org.zp.javase.enumeration.EnumDemo$Color\ngreen hashCode(): 460141958\ngreen compareTo Color.GREEN: 0\ngreen equals Color.GREEN: true\ngreen equals Size.MIDDLE: false\ngreen equals 1: false\ngreen == Color.BLUE: false\n\n\n\n# æä¸¾çç¹æ§\n\næä¸¾çç¹æ§ï¼å½ç»èµ·æ¥å°±æ¯ä¸å¥è¯ï¼\n\n> é¤äºä¸è½ç»§æ¿ï¼åºæ¬ä¸å¯ä»¥å° enum çåä¸ä¸ªå¸¸è§çç±»ã\n\nä½æ¯è¿å¥è¯éè¦æåå»çè§£ï¼è®©æä»¬ç»ç»éæ¥ã\n\n\n# åºæ¬ç¹æ§\n\nå¦ææä¸¾ä¸­æ²¡æå®ä¹æ¹æ³ï¼ä¹å¯ä»¥å¨æåä¸ä¸ªå®ä¾åé¢å éå·ãåå·æä»ä¹é½ä¸å ã\n\nå¦ææä¸¾ä¸­æ²¡æå®ä¹æ¹æ³ï¼æä¸¾å¼é»è®¤ä¸ºä» 0 å¼å§çæåºæ°å¼ãä»¥ Color æä¸¾ç±»åä¸¾ä¾ï¼å®çæä¸¾å¸¸éä¾æ¬¡ä¸º REDï¼0ï¼GREENï¼1ï¼BLUEï¼2ã\n\n\n# æä¸¾å¯ä»¥æ·»å æ¹æ³\n\nå¨æ¦å¿µç« èæå°äºï¼æä¸¾å¼é»è®¤ä¸ºä» 0 å¼å§çæåºæ°å¼ ãé£ä¹é®é¢æ¥äºï¼å¦ä½ä¸ºæä¸¾æ¾å¼çèµå¼ã\n\nï¼1ï¼Java ä¸åè®¸ä½¿ç¨ = ä¸ºæä¸¾å¸¸éèµå¼\n\nå¦æä½ æ¥è§¦è¿ C/C++ï¼ä½ è¯å®ä¼å¾èªç¶çæ³å°èµå¼ç¬¦å· = ãå¨ C/C++è¯­è¨ä¸­ç enumï¼å¯ä»¥ç¨èµå¼ç¬¦å·=æ¾å¼çä¸ºæä¸¾å¸¸éèµå¼ï¼ä½æ¯ ï¼å¾éæ¾ï¼Java è¯­æ³ä¸­å´ä¸åè®¸ä½¿ç¨èµå¼ç¬¦å· = ä¸ºæä¸¾å¸¸éèµå¼ã\n\nä¾ï¼C/C++ è¯­è¨ä¸­çæä¸¾å£°æ\n\ntypedef enum {\n    ONE = 1,\n    TWO,\n    THREE = 3,\n    TEN = 10\n} Number;\n\n\nï¼2ï¼æä¸¾å¯ä»¥æ·»å æ®éæ¹æ³ãéææ¹æ³ãæ½è±¡æ¹æ³ãæé æ¹æ³\n\nJava è½ç¶ä¸è½ç´æ¥ä¸ºå®ä¾èµå¼ï¼ä½æ¯å®ææ´ä¼ç§çè§£å³æ¹æ¡ï¼ä¸º enum æ·»å æ¹æ³æ¥é´æ¥å®ç°æ¾å¼èµå¼ã\n\nåå»º enum æ¶ï¼å¯ä»¥ä¸ºå¶æ·»å å¤ç§æ¹æ³ï¼çè³å¯ä»¥ä¸ºå¶æ·»å æé æ¹æ³ã\n\næ³¨æä¸ä¸ªç»èï¼å¦æè¦ä¸º enum å®ä¹æ¹æ³ï¼é£ä¹å¿é¡»å¨ enum çæåä¸ä¸ªå®ä¾å°¾é¨æ·»å ä¸ä¸ªåå·ãæ­¤å¤ï¼å¨ enum ä¸­ï¼å¿é¡»åå®ä¹å®ä¾ï¼ä¸è½å°å­æ®µææ¹æ³å®ä¹å¨å®ä¾åé¢ãå¦åï¼ç¼è¯å¨ä¼æ¥éã\n\nä¾ï¼å¨é¢å±ç¤ºå¦ä½å¨æä¸¾ä¸­å®ä¹æ®éæ¹æ³ãéææ¹æ³ãæ½è±¡æ¹æ³ãæé æ¹æ³\n\npublic enum ErrorCodeEn {\n    OK(0) {\n        @Override\n        public String getDescription() {\n            return "æå";\n        }\n    },\n    ERROR_A(100) {\n        @Override\n        public String getDescription() {\n            return "éè¯¯A";\n        }\n    },\n    ERROR_B(200) {\n        @Override\n        public String getDescription() {\n            return "éè¯¯B";\n        }\n    };\n\n    private int code;\n\n    // æé æ¹æ³ï¼enumçæé æ¹æ³åªè½è¢«å£°æä¸ºprivateæéæä¸å£°ææé\n    private ErrorCodeEn(int number) { // æé æ¹æ³\n        this.code = number;\n    }\n\n    public int getCode() { // æ®éæ¹æ³\n        return code;\n    } // æ®éæ¹æ³\n\n    public abstract String getDescription(); // æ½è±¡æ¹æ³\n\n    public static void main(String args[]) { // éææ¹æ³\n        for (ErrorCodeEn s : ErrorCodeEn.values()) {\n            System.out.println("code: " + s.getCode() + ", description: " + s.getDescription());\n        }\n    }\n}\n// Output:\n// code: 0, description: æå\n// code: 100, description: éè¯¯A\n// code: 200, description: éè¯¯B\n\n\næ³¨ï¼ä¸é¢çä¾å­å¹¶ä¸å¯åï¼ä»ä»æ¯ä¸ºäºå±ç¤ºæä¸¾æ¯æå®ä¹åç§æ¹æ³ãæ­£ç¡®çä¾å­æåµéè¯¯ç ç¤ºä¾\n\n\n# æä¸¾å¯ä»¥å®ç°æ¥å£\n\nenum å¯ä»¥åä¸è¬ç±»ä¸æ ·å®ç°æ¥å£ã\n\nåæ ·æ¯å®ç°ä¸ä¸èä¸­çéè¯¯ç æä¸¾ç±»ï¼éè¿å®ç°æ¥å£ï¼å¯ä»¥çº¦æå®çæ¹æ³ã\n\npublic interface INumberEnum {\n    int getCode();\n    String getDescription();\n}\n\npublic enum ErrorCodeEn2 implements INumberEnum {\n    OK(0, "æå"),\n    ERROR_A(100, "éè¯¯A"),\n    ERROR_B(200, "éè¯¯B");\n\n    ErrorCodeEn2(int number, String description) {\n        this.code = number;\n        this.description = description;\n    }\n\n    private int code;\n    private String description;\n\n    @Override\n    public int getCode() {\n        return code;\n    }\n\n    @Override\n    public String getDescription() {\n        return description;\n    }\n}\n\n\n\n# æä¸¾ä¸å¯ä»¥ç»§æ¿\n\nenum ä¸å¯ä»¥ç»§æ¿å¦å¤ä¸ä¸ªç±»ï¼å½ç¶ï¼ä¹ä¸è½ç»§æ¿å¦ä¸ä¸ª enum ã\n\nå ä¸º enum å®éä¸é½ç»§æ¿èª java.lang.Enum ç±»ï¼è Java ä¸æ¯æå¤éç»§æ¿ï¼æä»¥ enum ä¸è½åç»§æ¿å¶ä»ç±»ï¼å½ç¶ä¹ä¸è½ç»§æ¿å¦ä¸ä¸ª enumã\n\n\n# æä¸¾çåºç¨\n\n\n# ç»ç»å¸¸é\n\nå¨ JDK5 ä¹åï¼å¨ Java ä¸­å®ä¹å¸¸éé½æ¯public static final TYPE a; è¿æ ·çå½¢å¼ãæäºæä¸¾ï¼ä½ å¯ä»¥å°æå³èå³ç³»çå¸¸éç»ç»èµ·æ¥ï¼ä½¿ä»£ç æ´å æè¯»ãå®å¨ï¼å¹¶ä¸è¿å¯ä»¥ä½¿ç¨æä¸¾æä¾çæ¹æ³ã\n\nä¸é¢ä¸ç§å£°ææ¹å¼æ¯ç­ä»·çï¼\n\nenum Color { RED, GREEN, BLUE }\nenum Color { RED, GREEN, BLUE, }\nenum Color { RED, GREEN, BLUE; }\n\n\n\n# switch ç¶ææº\n\næä»¬ç»å¸¸ä½¿ç¨ switch è¯­å¥æ¥åç¶ææºãJDK7 ä»¥åï¼switch å·²ç»æ¯æ intãcharãStringãenum ç±»åçåæ°ãè¿å ç§ç±»åçåæ°æ¯è¾èµ·æ¥ï¼ä½¿ç¨æä¸¾ç switch ä»£ç æ´å·æå¯è¯»æ§ã\n\npublic class StateMachineDemo {\n    public enum Signal {\n        GREEN, YELLOW, RED\n    }\n\n    public static String getTrafficInstruct(Signal signal) {\n        String instruct = "ä¿¡å·ç¯æé";\n        switch (signal) {\n            case RED:\n                instruct = "çº¢ç¯å";\n                break;\n            case YELLOW:\n                instruct = "é»ç¯è¯·æ³¨æ";\n                break;\n            case GREEN:\n                instruct = "ç»¿ç¯è¡";\n                break;\n            default:\n                break;\n        }\n        return instruct;\n    }\n\n    public static void main(String[] args) {\n        System.out.println(getTrafficInstruct(Signal.RED));\n    }\n}\n// Output:\n// çº¢ç¯å\n\n\n\n# éè¯¯ç \n\næä¸¾å¸¸è¢«ç¨äºå®ä¹ç¨åºéè¯¯ç ãä¸é¢æ¯ä¸ä¸ªç®åç¤ºä¾ï¼\n\npublic class ErrorCodeEnumDemo {\n    enum ErrorCodeEn {\n        OK(0, "æå"),\n        ERROR_A(100, "éè¯¯A"),\n        ERROR_B(200, "éè¯¯B");\n\n        ErrorCodeEn(int number, String msg) {\n            this.code = number;\n            this.msg = msg;\n        }\n\n        private int code;\n        private String msg;\n\n        public int getCode() {\n            return code;\n        }\n\n        public String getMsg() {\n            return msg;\n        }\n\n        @Override\n        public String toString() {\n            return "ErrorCodeEn{" + "code=" + code + ", msg=\'" + msg + \'\\\'\' + \'}\';\n        }\n\n        public static String toStringAll() {\n            StringBuilder sb = new StringBuilder();\n            sb.append("ErrorCodeEn All Elements: [");\n            for (ErrorCodeEn code : ErrorCodeEn.values()) {\n                sb.append(code.getCode()).append(", ");\n            }\n            sb.append("]");\n            return sb.toString();\n        }\n    }\n\n    public static void main(String[] args) {\n        System.out.println(ErrorCodeEn.toStringAll());\n        for (ErrorCodeEn s : ErrorCodeEn.values()) {\n            System.out.println(s);\n        }\n    }\n}\n// Output:\n// ErrorCodeEn All Elements: [0, 100, 200, ]\n// ErrorCodeEn{code=0, msg=\'æå\'}\n// ErrorCodeEn{code=100, msg=\'éè¯¯A\'}\n// ErrorCodeEn{code=200, msg=\'éè¯¯B\'}\n\n\n\n# ç»ç»æä¸¾\n\nå¯ä»¥å°ç±»åç¸è¿çæä¸¾éè¿æ¥å£æç±»ç»ç»èµ·æ¥ï¼ä½æ¯ä¸è¬ç¨æ¥å£æ¹å¼è¿è¡ç»ç»ã\n\nåå æ¯ï¼Java æ¥å£å¨ç¼è¯æ¶ä¼èªå¨ä¸º enum ç±»åå ä¸public staticä¿®é¥°ç¬¦ï¼Java ç±»å¨ç¼è¯æ¶ä¼èªå¨ä¸º enum ç±»åå ä¸ static ä¿®é¥°ç¬¦ãçåºå·®å¼äºåï¼æ²¡éï¼å°±æ¯è¯´ï¼å¨ç±»ä¸­ç»ç» enumï¼å¦æä½ ä¸ç»å®ä¿®é¥°ä¸º publicï¼é£ä¹åªè½å¨æ¬åä¸­è¿è¡è®¿é®ã\n\nä¾ï¼å¨æ¥å£ä¸­ç»ç» enum\n\npublic class EnumInInterfaceDemo {\n    public interface INumberEnum {\n        int getCode();\n        String getDescription();\n    }\n\n\n    public interface Plant {\n        enum Vegetable implements INumberEnum {\n            POTATO(0, "åè±"),\n            TOMATO(0, "è¥¿çº¢æ¿");\n\n            Vegetable(int number, String description) {\n                this.code = number;\n                this.description = description;\n            }\n\n            private int code;\n            private String description;\n\n            @Override\n            public int getCode() {\n                return this.code;\n            }\n\n            @Override\n            public String getDescription() {\n                return this.description;\n            }\n        }\n\n\n        enum Fruit implements INumberEnum {\n            APPLE(0, "è¹æ"),\n            ORANGE(0, "æ¡å­"),\n            BANANA(0, "é¦è");\n\n            Fruit(int number, String description) {\n                this.code = number;\n                this.description = description;\n            }\n\n            private int code;\n            private String description;\n\n            @Override\n            public int getCode() {\n                return this.code;\n            }\n\n            @Override\n            public String getDescription() {\n                return this.description;\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        for (Plant.Fruit f : Plant.Fruit.values()) {\n            System.out.println(f.getDescription());\n        }\n    }\n}\n// Output:\n// è¹æ\n// æ¡å­\n// é¦è\n\n\nä¾ï¼å¨ç±»ä¸­ç»ç» enum\n\næ¬ä¾åä¸ä¾ææç¸åã\n\npublic class EnumInClassDemo {\n    public interface INumberEnum {\n        int getCode();\n        String getDescription();\n    }\n\n    public static class Plant2 {\n        enum Vegetable implements INumberEnum {\n            // ç¥ï¼ä¸ä¸é¢å®å¨ç¸å\n        }\n        enum Fruit implements INumberEnum {\n            // ç¥ï¼ä¸ä¸é¢å®å¨ç¸å\n        }\n    }\n\n    // ç¥\n}\n// Output:\n// åè±\n// è¥¿çº¢æ¿\n\n\n\n# ç­ç¥æä¸¾\n\nEffective Java ä¸­å±ç¤ºäºä¸ç§ç­ç¥æä¸¾ãè¿ç§æä¸¾éè¿æä¸¾åµå¥æä¸¾çæ¹å¼ï¼å°æä¸¾å¸¸éåç±»å¤çã\n\nè¿ç§åæ³è½ç¶æ²¡æ switch è¯­å¥ç®æ´ï¼ä½æ¯æ´å å®å¨ãçµæ´»ã\n\nä¾ï¼EffectvieJava ä¸­çç­ç¥æä¸¾èä¾\n\nenum PayrollDay {\n    MONDAY(PayType.WEEKDAY), TUESDAY(PayType.WEEKDAY), WEDNESDAY(\n            PayType.WEEKDAY), THURSDAY(PayType.WEEKDAY), FRIDAY(PayType.WEEKDAY), SATURDAY(\n            PayType.WEEKEND), SUNDAY(PayType.WEEKEND);\n\n    private final PayType payType;\n\n    PayrollDay(PayType payType) {\n        this.payType = payType;\n    }\n\n    double pay(double hoursWorked, double payRate) {\n        return payType.pay(hoursWorked, payRate);\n    }\n\n    // ç­ç¥æä¸¾\n    private enum PayType {\n        WEEKDAY {\n            double overtimePay(double hours, double payRate) {\n                return hours <= HOURS_PER_SHIFT ? 0 : (hours - HOURS_PER_SHIFT)\n                        * payRate / 2;\n            }\n        },\n        WEEKEND {\n            double overtimePay(double hours, double payRate) {\n                return hours * payRate / 2;\n            }\n        };\n        private static final int HOURS_PER_SHIFT = 8;\n\n        abstract double overtimePay(double hrs, double payRate);\n\n        double pay(double hoursWorked, double payRate) {\n            double basePay = hoursWorked * payRate;\n            return basePay + overtimePay(hoursWorked, payRate);\n        }\n    }\n}\n\n\næµè¯\n\nSystem.out.println("æ¶èª100çäººå¨å¨äºå·¥ä½8å°æ¶çæ¶å¥ï¼" + PayrollDay.FRIDAY.pay(8.0, 100));\nSystem.out.println("æ¶èª100çäººå¨å¨å­å·¥ä½8å°æ¶çæ¶å¥ï¼" + PayrollDay.SATURDAY.pay(8.0, 100));\n\n\n\n# æä¸¾å®ç°åä¾æ¨¡å¼\n\nåä¾æ¨¡å¼æ¯æå¸¸ç¨çè®¾è®¡æ¨¡å¼ã\n\nåä¾æ¨¡å¼å¨å¹¶åç¯å¢ä¸å­å¨çº¿ç¨å®å¨é®é¢ã\n\nä¸ºäºçº¿ç¨å®å¨é®é¢ï¼ä¼ ç»åæ³æä»¥ä¸å ç§ï¼\n\n * é¥¿æ±å¼å è½½\n * ææ±å¼ synchronize ååéæ£æ¥\n * å©ç¨ java çéæå è½½æºå¶\n\nç¸æ¯ä¸è¿°çæ¹æ³ï¼ä½¿ç¨æä¸¾ä¹å¯ä»¥å®ç°åä¾ï¼èä¸è¿æ´å ç®åï¼\n\npublic class SingleEnumDemo {\n    public enum SingleEn {\n\n        INSTANCE;\n\n        private String name;\n\n        public String getName() {\n            return name;\n        }\n\n        public void setName(String name) {\n            this.name = name;\n        }\n    }\n\n    public static void main(String[] args) {\n        SingleEn.INSTANCE.setName("zp");\n        System.out.println(SingleEn.INSTANCE.getName());\n    }\n}\n\n\n> æ©å±éè¯»ï¼æ·±å¥çè§£ Java æä¸¾ç±»å(enum)\n> \n> è¿ç¯æç« å¯¹äº Java æä¸¾çç¹æ§è®²è§£å¾ä»ç»ï¼å¶ä¸­å¯¹äºæä¸¾å®ç°åä¾åä¼ ç»åä¾å®ç°æ¹å¼è¯´çå°¤ä¸ºç»è´ã\n\n\n# æä¸¾å·¥å·ç±»\n\nJava ä¸­æä¾äºä¸¤ä¸ªæ¹ä¾¿æä½ enum çå·¥å·ç±»ââEnumSet å EnumMapã\n\n\n# EnumSet\n\nEnumSet æ¯æä¸¾ç±»åçé«æ§è½ Set å®ç°ãå®è¦æ±æ¾å¥å®çæä¸¾å¸¸éå¿é¡»å±äºåä¸æä¸¾ç±»åã\n\nä¸»è¦æ¥å£ï¼\n\n * noneOf - åå»ºä¸ä¸ªå·ææå®åç´ ç±»åçç©º EnumSet\n * allOf - åå»ºä¸ä¸ªæå®åç´ ç±»åå¹¶åå«æææä¸¾å¼ç EnumSet\n * range - åå»ºä¸ä¸ªåæ¬æä¸¾å¼ä¸­æå®èå´åç´ ç EnumSet\n * complementOf - åå§éååæ¬æå®éåçè¡¥é\n * of - åå»ºä¸ä¸ªåæ¬åæ°ä¸­ææåç´ ç EnumSet\n * copyOf - åå»ºä¸ä¸ªåå«åæ°å®¹å¨ä¸­çææåç´ ç EnumSet\n\nç¤ºä¾ï¼\n\npublic class EnumSetDemo {\n    public static void main(String[] args) {\n        System.out.println("EnumSetå±ç¤º");\n        EnumSet<ErrorCodeEn> errSet = EnumSet.allOf(ErrorCodeEn.class);\n        for (ErrorCodeEn e : errSet) {\n            System.out.println(e.name() + " : " + e.ordinal());\n        }\n    }\n}\n\n\n\n# EnumMap\n\nEnumMap æ¯ä¸é¨ä¸ºæä¸¾ç±»åéèº«å®åç Map å®ç°ãè½ç¶ä½¿ç¨å¶å®ç Map å®ç°ï¼å¦ HashMapï¼ä¹è½å®ææä¸¾ç±»åå®ä¾å°å¼å¾æ å°ï¼ä½æ¯ä½¿ç¨ EnumMap ä¼æ´å é«æï¼å®åªè½æ¥æ¶åä¸æä¸¾ç±»åçå®ä¾ä½ä¸ºé®å¼ï¼å¹¶ä¸ç±äºæä¸¾ç±»åå®ä¾çæ°éç¸å¯¹åºå®å¹¶ä¸æéï¼æä»¥ EnumMap ä½¿ç¨æ°ç»æ¥å­æ¾ä¸æä¸¾ç±»åå¯¹åºçå¼ãè¿ä½¿å¾ EnumMap çæçéå¸¸é«ã\n\nä¸»è¦æ¥å£ï¼\n\n * size - è¿åé®å¼å¯¹æ°\n * containsValue - æ¯å¦å­å¨æå®ç value\n * containsKey - æ¯å¦å­å¨æå®ç key\n * get - æ ¹æ®æå® key è·å value\n * put - ååºæå®çé®å¼å¯¹\n * remove - å é¤æå® key\n * putAll - æ¹éååºé®å¼å¯¹\n * clear - æ¸é¤æ°æ®\n * keySet - è·å key éå\n * values - è¿åææ\n\nç¤ºä¾ï¼\n\npublic class EnumMapDemo {\n    public enum Signal {\n        GREEN, YELLOW, RED\n    }\n\n    public static void main(String[] args) {\n        System.out.println("EnumMapå±ç¤º");\n        EnumMap<Signal, String> errMap = new EnumMap(Signal.class);\n        errMap.put(Signal.RED, "çº¢ç¯");\n        errMap.put(Signal.YELLOW, "é»ç¯");\n        errMap.put(Signal.GREEN, "ç»¿ç¯");\n        for (Iterator<Map.Entry<Signal, String>> iter = errMap.entrySet().iterator(); iter.hasNext();) {\n            Map.Entry<Signal, String> entry = iter.next();\n            System.out.println(entry.getKey().name() + " : " + entry.getValue());\n        }\n    }\n}\n\n\n> æ©å±éè¯»ï¼æ·±å¥çè§£ Java æä¸¾ç±»å(enum)\n> \n> è¿ç¯æç« ä¸­å¯¹ EnumSet å EnumMap åçåäºè¾ä¸ºè¯¦ç»çä»ç»ã\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * Effective java\n * æ·±å¥çè§£ Java æä¸¾ç±»å(enum)\n * https://droidyue.com/blog/2016/11/29/dive-into-enum/',normalizedContent:'# æ·±å¥çè§£ java æä¸¾\n\n\n# ç®ä»\n\nenum çå¨ç§°ä¸º enumerationï¼ æ¯ jdk5 ä¸­å¼å¥çç¹æ§ã\n\nå¨ java ä¸­ï¼è¢« enum å³é®å­ä¿®é¥°çç±»åå°±æ¯æä¸¾ç±»åãå½¢å¼å¦ä¸ï¼\n\nenum coloren { red, green, blue }\n\n\næä¸¾çå¥½å¤ï¼å¯ä»¥å°å¸¸éç»ç»èµ·æ¥ï¼ç»ä¸è¿è¡ç®¡çã\n\næä¸¾çå¸ååºç¨åºæ¯ï¼éè¯¯ç ãç¶ææºç­ã\n\n\n# æä¸¾çæ¬è´¨\n\njava.lang.enumç±»å£°æ\n\npublic abstract class enum<e extends enum<e>>\n        implements comparable<e>, serializable { ... }\n\n\næ°å»ºä¸ä¸ª coloren.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\npackage io.github.dunwu.javacore.enumeration;\n\npublic enum coloren {\n    red,yellow,blue\n}\n\n\næ§è¡ javac coloren.java å½ä»¤ï¼çæ coloren.class æä»¶ã\n\nç¶åæ§è¡ javap coloren.class å½ä»¤ï¼è¾åºå¦ä¸åå®¹ï¼\n\ncompiled from "coloren.java"\npublic final class io.github.dunwu.javacore.enumeration.coloren extends java.lang.enum<io.github.dunwu.javacore.enumeration.coloren> {\n  public static final io.github.dunwu.javacore.enumeration.coloren red;\n  public static final io.github.dunwu.javacore.enumeration.coloren yellow;\n  public static final io.github.dunwu.javacore.enumeration.coloren blue;\n  public static io.github.dunwu.javacore.enumeration.coloren[] values();\n  public static io.github.dunwu.javacore.enumeration.coloren valueof(java.lang.string);\n  static {};\n}\n\n\n> ð¡ è¯´æï¼\n> \n> ä»ä¸é¢çä¾å­å¯ä»¥çåºï¼\n> \n> æä¸¾çæ¬è´¨æ¯ java.lang.enum çå­ç±»ã\n> \n> å°½ç®¡ enum çèµ·æ¥åæ¯ä¸ç§æ°çæ°æ®ç±»åï¼äºå®ä¸ï¼enum æ¯ä¸ç§åéå¶çç±»ï¼å¹¶ä¸å·æèªå·±çæ¹æ³ãæä¸¾è¿ç§ç¹æ®çç±»å ä¸ºè¢«ä¿®é¥°ä¸º finalï¼æä»¥ä¸è½ç»§æ¿å¶ä»ç±»ã\n> \n> å®ä¹çæä¸¾å¼ï¼ä¼è¢«é»è®¤ä¿®é¥°ä¸º public static final ï¼ä»ä¿®é¥°å³é®å­ï¼å³å¯çåºæä¸¾å¼æ¬è´¨ä¸æ¯éæå¸¸éã\n\n\n# æä¸¾çæ¹æ³\n\nå¨ enum ä¸­ï¼æä¾äºä¸äºåºæ¬æ¹æ³ï¼\n\n * values()ï¼è¿å enum å®ä¾çæ°ç»ï¼èä¸è¯¥æ°ç»ä¸­çåç´ ä¸¥æ ¼ä¿æå¨ enum ä¸­å£°ææ¶çé¡ºåºã\n * name()ï¼è¿åå®ä¾åã\n * ordinal()ï¼è¿åå®ä¾å£°ææ¶çæ¬¡åºï¼ä» 0 å¼å§ã\n * getdeclaringclass()ï¼è¿åå®ä¾æå±ç enum ç±»åã\n * equals() ï¼å¤æ­æ¯å¦ä¸ºåä¸ä¸ªå¯¹è±¡ã\n\nå¯ä»¥ä½¿ç¨ == æ¥æ¯è¾enumå®ä¾ã\n\næ­¤å¤ï¼java.lang.enumå®ç°äºcomparableå serializable æ¥å£ï¼æä»¥ä¹æä¾ compareto() æ¹æ³ã\n\nä¾ï¼å±ç¤º enum çåºæ¬æ¹æ³\n\npublic class enummethoddemo {\n    enum color {red, green, blue;}\n    enum size {big, middle, small;}\n    public static void main(string args[]) {\n        system.out.println("=========== print all color ===========");\n        for (color c : color.values()) {\n            system.out.println(c + " ordinal: " + c.ordinal());\n        }\n        system.out.println("=========== print all size ===========");\n        for (size s : size.values()) {\n            system.out.println(s + " ordinal: " + s.ordinal());\n        }\n\n        color green = color.green;\n        system.out.println("green name(): " + green.name());\n        system.out.println("green getdeclaringclass(): " + green.getdeclaringclass());\n        system.out.println("green hashcode(): " + green.hashcode());\n        system.out.println("green compareto color.green: " + green.compareto(color.green));\n        system.out.println("green equals color.green: " + green.equals(color.green));\n        system.out.println("green equals size.middle: " + green.equals(size.middle));\n        system.out.println("green equals 1: " + green.equals(1));\n        system.out.format("green == color.blue: %b\\n", green == color.blue);\n    }\n}\n\n\nè¾åº\n\n=========== print all color ===========\nred ordinal: 0\ngreen ordinal: 1\nblue ordinal: 2\n=========== print all size ===========\nbig ordinal: 0\nmiddle ordinal: 1\nsmall ordinal: 2\ngreen name(): green\ngreen getdeclaringclass(): class org.zp.javase.enumeration.enumdemo$color\ngreen hashcode(): 460141958\ngreen compareto color.green: 0\ngreen equals color.green: true\ngreen equals size.middle: false\ngreen equals 1: false\ngreen == color.blue: false\n\n\n\n# æä¸¾çç¹æ§\n\næä¸¾çç¹æ§ï¼å½ç»èµ·æ¥å°±æ¯ä¸å¥è¯ï¼\n\n> é¤äºä¸è½ç»§æ¿ï¼åºæ¬ä¸å¯ä»¥å° enum çåä¸ä¸ªå¸¸è§çç±»ã\n\nä½æ¯è¿å¥è¯éè¦æåå»çè§£ï¼è®©æä»¬ç»ç»éæ¥ã\n\n\n# åºæ¬ç¹æ§\n\nå¦ææä¸¾ä¸­æ²¡æå®ä¹æ¹æ³ï¼ä¹å¯ä»¥å¨æåä¸ä¸ªå®ä¾åé¢å éå·ãåå·æä»ä¹é½ä¸å ã\n\nå¦ææä¸¾ä¸­æ²¡æå®ä¹æ¹æ³ï¼æä¸¾å¼é»è®¤ä¸ºä» 0 å¼å§çæåºæ°å¼ãä»¥ color æä¸¾ç±»åä¸¾ä¾ï¼å®çæä¸¾å¸¸éä¾æ¬¡ä¸º redï¼0ï¼greenï¼1ï¼blueï¼2ã\n\n\n# æä¸¾å¯ä»¥æ·»å æ¹æ³\n\nå¨æ¦å¿µç« èæå°äºï¼æä¸¾å¼é»è®¤ä¸ºä» 0 å¼å§çæåºæ°å¼ ãé£ä¹é®é¢æ¥äºï¼å¦ä½ä¸ºæä¸¾æ¾å¼çèµå¼ã\n\nï¼1ï¼java ä¸åè®¸ä½¿ç¨ = ä¸ºæä¸¾å¸¸éèµå¼\n\nå¦æä½ æ¥è§¦è¿ c/c++ï¼ä½ è¯å®ä¼å¾èªç¶çæ³å°èµå¼ç¬¦å· = ãå¨ c/c++è¯­è¨ä¸­ç enumï¼å¯ä»¥ç¨èµå¼ç¬¦å·=æ¾å¼çä¸ºæä¸¾å¸¸éèµå¼ï¼ä½æ¯ ï¼å¾éæ¾ï¼java è¯­æ³ä¸­å´ä¸åè®¸ä½¿ç¨èµå¼ç¬¦å· = ä¸ºæä¸¾å¸¸éèµå¼ã\n\nä¾ï¼c/c++ è¯­è¨ä¸­çæä¸¾å£°æ\n\ntypedef enum {\n    one = 1,\n    two,\n    three = 3,\n    ten = 10\n} number;\n\n\nï¼2ï¼æä¸¾å¯ä»¥æ·»å æ®éæ¹æ³ãéææ¹æ³ãæ½è±¡æ¹æ³ãæé æ¹æ³\n\njava è½ç¶ä¸è½ç´æ¥ä¸ºå®ä¾èµå¼ï¼ä½æ¯å®ææ´ä¼ç§çè§£å³æ¹æ¡ï¼ä¸º enum æ·»å æ¹æ³æ¥é´æ¥å®ç°æ¾å¼èµå¼ã\n\nåå»º enum æ¶ï¼å¯ä»¥ä¸ºå¶æ·»å å¤ç§æ¹æ³ï¼çè³å¯ä»¥ä¸ºå¶æ·»å æé æ¹æ³ã\n\næ³¨æä¸ä¸ªç»èï¼å¦æè¦ä¸º enum å®ä¹æ¹æ³ï¼é£ä¹å¿é¡»å¨ enum çæåä¸ä¸ªå®ä¾å°¾é¨æ·»å ä¸ä¸ªåå·ãæ­¤å¤ï¼å¨ enum ä¸­ï¼å¿é¡»åå®ä¹å®ä¾ï¼ä¸è½å°å­æ®µææ¹æ³å®ä¹å¨å®ä¾åé¢ãå¦åï¼ç¼è¯å¨ä¼æ¥éã\n\nä¾ï¼å¨é¢å±ç¤ºå¦ä½å¨æä¸¾ä¸­å®ä¹æ®éæ¹æ³ãéææ¹æ³ãæ½è±¡æ¹æ³ãæé æ¹æ³\n\npublic enum errorcodeen {\n    ok(0) {\n        @override\n        public string getdescription() {\n            return "æå";\n        }\n    },\n    error_a(100) {\n        @override\n        public string getdescription() {\n            return "éè¯¯a";\n        }\n    },\n    error_b(200) {\n        @override\n        public string getdescription() {\n            return "éè¯¯b";\n        }\n    };\n\n    private int code;\n\n    // æé æ¹æ³ï¼enumçæé æ¹æ³åªè½è¢«å£°æä¸ºprivateæéæä¸å£°ææé\n    private errorcodeen(int number) { // æé æ¹æ³\n        this.code = number;\n    }\n\n    public int getcode() { // æ®éæ¹æ³\n        return code;\n    } // æ®éæ¹æ³\n\n    public abstract string getdescription(); // æ½è±¡æ¹æ³\n\n    public static void main(string args[]) { // éææ¹æ³\n        for (errorcodeen s : errorcodeen.values()) {\n            system.out.println("code: " + s.getcode() + ", description: " + s.getdescription());\n        }\n    }\n}\n// output:\n// code: 0, description: æå\n// code: 100, description: éè¯¯a\n// code: 200, description: éè¯¯b\n\n\næ³¨ï¼ä¸é¢çä¾å­å¹¶ä¸å¯åï¼ä»ä»æ¯ä¸ºäºå±ç¤ºæä¸¾æ¯æå®ä¹åç§æ¹æ³ãæ­£ç¡®çä¾å­æåµéè¯¯ç ç¤ºä¾\n\n\n# æä¸¾å¯ä»¥å®ç°æ¥å£\n\nenum å¯ä»¥åä¸è¬ç±»ä¸æ ·å®ç°æ¥å£ã\n\nåæ ·æ¯å®ç°ä¸ä¸èä¸­çéè¯¯ç æä¸¾ç±»ï¼éè¿å®ç°æ¥å£ï¼å¯ä»¥çº¦æå®çæ¹æ³ã\n\npublic interface inumberenum {\n    int getcode();\n    string getdescription();\n}\n\npublic enum errorcodeen2 implements inumberenum {\n    ok(0, "æå"),\n    error_a(100, "éè¯¯a"),\n    error_b(200, "éè¯¯b");\n\n    errorcodeen2(int number, string description) {\n        this.code = number;\n        this.description = description;\n    }\n\n    private int code;\n    private string description;\n\n    @override\n    public int getcode() {\n        return code;\n    }\n\n    @override\n    public string getdescription() {\n        return description;\n    }\n}\n\n\n\n# æä¸¾ä¸å¯ä»¥ç»§æ¿\n\nenum ä¸å¯ä»¥ç»§æ¿å¦å¤ä¸ä¸ªç±»ï¼å½ç¶ï¼ä¹ä¸è½ç»§æ¿å¦ä¸ä¸ª enum ã\n\nå ä¸º enum å®éä¸é½ç»§æ¿èª java.lang.enum ç±»ï¼è java ä¸æ¯æå¤éç»§æ¿ï¼æä»¥ enum ä¸è½åç»§æ¿å¶ä»ç±»ï¼å½ç¶ä¹ä¸è½ç»§æ¿å¦ä¸ä¸ª enumã\n\n\n# æä¸¾çåºç¨\n\n\n# ç»ç»å¸¸é\n\nå¨ jdk5 ä¹åï¼å¨ java ä¸­å®ä¹å¸¸éé½æ¯public static final type a; è¿æ ·çå½¢å¼ãæäºæä¸¾ï¼ä½ å¯ä»¥å°æå³èå³ç³»çå¸¸éç»ç»èµ·æ¥ï¼ä½¿ä»£ç æ´å æè¯»ãå®å¨ï¼å¹¶ä¸è¿å¯ä»¥ä½¿ç¨æä¸¾æä¾çæ¹æ³ã\n\nä¸é¢ä¸ç§å£°ææ¹å¼æ¯ç­ä»·çï¼\n\nenum color { red, green, blue }\nenum color { red, green, blue, }\nenum color { red, green, blue; }\n\n\n\n# switch ç¶ææº\n\næä»¬ç»å¸¸ä½¿ç¨ switch è¯­å¥æ¥åç¶ææºãjdk7 ä»¥åï¼switch å·²ç»æ¯æ intãcharãstringãenum ç±»åçåæ°ãè¿å ç§ç±»åçåæ°æ¯è¾èµ·æ¥ï¼ä½¿ç¨æä¸¾ç switch ä»£ç æ´å·æå¯è¯»æ§ã\n\npublic class statemachinedemo {\n    public enum signal {\n        green, yellow, red\n    }\n\n    public static string gettrafficinstruct(signal signal) {\n        string instruct = "ä¿¡å·ç¯æé";\n        switch (signal) {\n            case red:\n                instruct = "çº¢ç¯å";\n                break;\n            case yellow:\n                instruct = "é»ç¯è¯·æ³¨æ";\n                break;\n            case green:\n                instruct = "ç»¿ç¯è¡";\n                break;\n            default:\n                break;\n        }\n        return instruct;\n    }\n\n    public static void main(string[] args) {\n        system.out.println(gettrafficinstruct(signal.red));\n    }\n}\n// output:\n// çº¢ç¯å\n\n\n\n# éè¯¯ç \n\næä¸¾å¸¸è¢«ç¨äºå®ä¹ç¨åºéè¯¯ç ãä¸é¢æ¯ä¸ä¸ªç®åç¤ºä¾ï¼\n\npublic class errorcodeenumdemo {\n    enum errorcodeen {\n        ok(0, "æå"),\n        error_a(100, "éè¯¯a"),\n        error_b(200, "éè¯¯b");\n\n        errorcodeen(int number, string msg) {\n            this.code = number;\n            this.msg = msg;\n        }\n\n        private int code;\n        private string msg;\n\n        public int getcode() {\n            return code;\n        }\n\n        public string getmsg() {\n            return msg;\n        }\n\n        @override\n        public string tostring() {\n            return "errorcodeen{" + "code=" + code + ", msg=\'" + msg + \'\\\'\' + \'}\';\n        }\n\n        public static string tostringall() {\n            stringbuilder sb = new stringbuilder();\n            sb.append("errorcodeen all elements: [");\n            for (errorcodeen code : errorcodeen.values()) {\n                sb.append(code.getcode()).append(", ");\n            }\n            sb.append("]");\n            return sb.tostring();\n        }\n    }\n\n    public static void main(string[] args) {\n        system.out.println(errorcodeen.tostringall());\n        for (errorcodeen s : errorcodeen.values()) {\n            system.out.println(s);\n        }\n    }\n}\n// output:\n// errorcodeen all elements: [0, 100, 200, ]\n// errorcodeen{code=0, msg=\'æå\'}\n// errorcodeen{code=100, msg=\'éè¯¯a\'}\n// errorcodeen{code=200, msg=\'éè¯¯b\'}\n\n\n\n# ç»ç»æä¸¾\n\nå¯ä»¥å°ç±»åç¸è¿çæä¸¾éè¿æ¥å£æç±»ç»ç»èµ·æ¥ï¼ä½æ¯ä¸è¬ç¨æ¥å£æ¹å¼è¿è¡ç»ç»ã\n\nåå æ¯ï¼java æ¥å£å¨ç¼è¯æ¶ä¼èªå¨ä¸º enum ç±»åå ä¸public staticä¿®é¥°ç¬¦ï¼java ç±»å¨ç¼è¯æ¶ä¼èªå¨ä¸º enum ç±»åå ä¸ static ä¿®é¥°ç¬¦ãçåºå·®å¼äºåï¼æ²¡éï¼å°±æ¯è¯´ï¼å¨ç±»ä¸­ç»ç» enumï¼å¦æä½ ä¸ç»å®ä¿®é¥°ä¸º publicï¼é£ä¹åªè½å¨æ¬åä¸­è¿è¡è®¿é®ã\n\nä¾ï¼å¨æ¥å£ä¸­ç»ç» enum\n\npublic class enumininterfacedemo {\n    public interface inumberenum {\n        int getcode();\n        string getdescription();\n    }\n\n\n    public interface plant {\n        enum vegetable implements inumberenum {\n            potato(0, "åè±"),\n            tomato(0, "è¥¿çº¢æ¿");\n\n            vegetable(int number, string description) {\n                this.code = number;\n                this.description = description;\n            }\n\n            private int code;\n            private string description;\n\n            @override\n            public int getcode() {\n                return this.code;\n            }\n\n            @override\n            public string getdescription() {\n                return this.description;\n            }\n        }\n\n\n        enum fruit implements inumberenum {\n            apple(0, "è¹æ"),\n            orange(0, "æ¡å­"),\n            banana(0, "é¦è");\n\n            fruit(int number, string description) {\n                this.code = number;\n                this.description = description;\n            }\n\n            private int code;\n            private string description;\n\n            @override\n            public int getcode() {\n                return this.code;\n            }\n\n            @override\n            public string getdescription() {\n                return this.description;\n            }\n        }\n    }\n\n    public static void main(string[] args) {\n        for (plant.fruit f : plant.fruit.values()) {\n            system.out.println(f.getdescription());\n        }\n    }\n}\n// output:\n// è¹æ\n// æ¡å­\n// é¦è\n\n\nä¾ï¼å¨ç±»ä¸­ç»ç» enum\n\næ¬ä¾åä¸ä¾ææç¸åã\n\npublic class enuminclassdemo {\n    public interface inumberenum {\n        int getcode();\n        string getdescription();\n    }\n\n    public static class plant2 {\n        enum vegetable implements inumberenum {\n            // ç¥ï¼ä¸ä¸é¢å®å¨ç¸å\n        }\n        enum fruit implements inumberenum {\n            // ç¥ï¼ä¸ä¸é¢å®å¨ç¸å\n        }\n    }\n\n    // ç¥\n}\n// output:\n// åè±\n// è¥¿çº¢æ¿\n\n\n\n# ç­ç¥æä¸¾\n\neffective java ä¸­å±ç¤ºäºä¸ç§ç­ç¥æä¸¾ãè¿ç§æä¸¾éè¿æä¸¾åµå¥æä¸¾çæ¹å¼ï¼å°æä¸¾å¸¸éåç±»å¤çã\n\nè¿ç§åæ³è½ç¶æ²¡æ switch è¯­å¥ç®æ´ï¼ä½æ¯æ´å å®å¨ãçµæ´»ã\n\nä¾ï¼effectviejava ä¸­çç­ç¥æä¸¾èä¾\n\nenum payrollday {\n    monday(paytype.weekday), tuesday(paytype.weekday), wednesday(\n            paytype.weekday), thursday(paytype.weekday), friday(paytype.weekday), saturday(\n            paytype.weekend), sunday(paytype.weekend);\n\n    private final paytype paytype;\n\n    payrollday(paytype paytype) {\n        this.paytype = paytype;\n    }\n\n    double pay(double hoursworked, double payrate) {\n        return paytype.pay(hoursworked, payrate);\n    }\n\n    // ç­ç¥æä¸¾\n    private enum paytype {\n        weekday {\n            double overtimepay(double hours, double payrate) {\n                return hours <= hours_per_shift ? 0 : (hours - hours_per_shift)\n                        * payrate / 2;\n            }\n        },\n        weekend {\n            double overtimepay(double hours, double payrate) {\n                return hours * payrate / 2;\n            }\n        };\n        private static final int hours_per_shift = 8;\n\n        abstract double overtimepay(double hrs, double payrate);\n\n        double pay(double hoursworked, double payrate) {\n            double basepay = hoursworked * payrate;\n            return basepay + overtimepay(hoursworked, payrate);\n        }\n    }\n}\n\n\næµè¯\n\nsystem.out.println("æ¶èª100çäººå¨å¨äºå·¥ä½8å°æ¶çæ¶å¥ï¼" + payrollday.friday.pay(8.0, 100));\nsystem.out.println("æ¶èª100çäººå¨å¨å­å·¥ä½8å°æ¶çæ¶å¥ï¼" + payrollday.saturday.pay(8.0, 100));\n\n\n\n# æä¸¾å®ç°åä¾æ¨¡å¼\n\nåä¾æ¨¡å¼æ¯æå¸¸ç¨çè®¾è®¡æ¨¡å¼ã\n\nåä¾æ¨¡å¼å¨å¹¶åç¯å¢ä¸å­å¨çº¿ç¨å®å¨é®é¢ã\n\nä¸ºäºçº¿ç¨å®å¨é®é¢ï¼ä¼ ç»åæ³æä»¥ä¸å ç§ï¼\n\n * é¥¿æ±å¼å è½½\n * ææ±å¼ synchronize ååéæ£æ¥\n * å©ç¨ java çéæå è½½æºå¶\n\nç¸æ¯ä¸è¿°çæ¹æ³ï¼ä½¿ç¨æä¸¾ä¹å¯ä»¥å®ç°åä¾ï¼èä¸è¿æ´å ç®åï¼\n\npublic class singleenumdemo {\n    public enum singleen {\n\n        instance;\n\n        private string name;\n\n        public string getname() {\n            return name;\n        }\n\n        public void setname(string name) {\n            this.name = name;\n        }\n    }\n\n    public static void main(string[] args) {\n        singleen.instance.setname("zp");\n        system.out.println(singleen.instance.getname());\n    }\n}\n\n\n> æ©å±éè¯»ï¼æ·±å¥çè§£ java æä¸¾ç±»å(enum)\n> \n> è¿ç¯æç« å¯¹äº java æä¸¾çç¹æ§è®²è§£å¾ä»ç»ï¼å¶ä¸­å¯¹äºæä¸¾å®ç°åä¾åä¼ ç»åä¾å®ç°æ¹å¼è¯´çå°¤ä¸ºç»è´ã\n\n\n# æä¸¾å·¥å·ç±»\n\njava ä¸­æä¾äºä¸¤ä¸ªæ¹ä¾¿æä½ enum çå·¥å·ç±»ââenumset å enummapã\n\n\n# enumset\n\nenumset æ¯æä¸¾ç±»åçé«æ§è½ set å®ç°ãå®è¦æ±æ¾å¥å®çæä¸¾å¸¸éå¿é¡»å±äºåä¸æä¸¾ç±»åã\n\nä¸»è¦æ¥å£ï¼\n\n * noneof - åå»ºä¸ä¸ªå·ææå®åç´ ç±»åçç©º enumset\n * allof - åå»ºä¸ä¸ªæå®åç´ ç±»åå¹¶åå«æææä¸¾å¼ç enumset\n * range - åå»ºä¸ä¸ªåæ¬æä¸¾å¼ä¸­æå®èå´åç´ ç enumset\n * complementof - åå§éååæ¬æå®éåçè¡¥é\n * of - åå»ºä¸ä¸ªåæ¬åæ°ä¸­ææåç´ ç enumset\n * copyof - åå»ºä¸ä¸ªåå«åæ°å®¹å¨ä¸­çææåç´ ç enumset\n\nç¤ºä¾ï¼\n\npublic class enumsetdemo {\n    public static void main(string[] args) {\n        system.out.println("enumsetå±ç¤º");\n        enumset<errorcodeen> errset = enumset.allof(errorcodeen.class);\n        for (errorcodeen e : errset) {\n            system.out.println(e.name() + " : " + e.ordinal());\n        }\n    }\n}\n\n\n\n# enummap\n\nenummap æ¯ä¸é¨ä¸ºæä¸¾ç±»åéèº«å®åç map å®ç°ãè½ç¶ä½¿ç¨å¶å®ç map å®ç°ï¼å¦ hashmapï¼ä¹è½å®ææä¸¾ç±»åå®ä¾å°å¼å¾æ å°ï¼ä½æ¯ä½¿ç¨ enummap ä¼æ´å é«æï¼å®åªè½æ¥æ¶åä¸æä¸¾ç±»åçå®ä¾ä½ä¸ºé®å¼ï¼å¹¶ä¸ç±äºæä¸¾ç±»åå®ä¾çæ°éç¸å¯¹åºå®å¹¶ä¸æéï¼æä»¥ enummap ä½¿ç¨æ°ç»æ¥å­æ¾ä¸æä¸¾ç±»åå¯¹åºçå¼ãè¿ä½¿å¾ enummap çæçéå¸¸é«ã\n\nä¸»è¦æ¥å£ï¼\n\n * size - è¿åé®å¼å¯¹æ°\n * containsvalue - æ¯å¦å­å¨æå®ç value\n * containskey - æ¯å¦å­å¨æå®ç key\n * get - æ ¹æ®æå® key è·å value\n * put - ååºæå®çé®å¼å¯¹\n * remove - å é¤æå® key\n * putall - æ¹éååºé®å¼å¯¹\n * clear - æ¸é¤æ°æ®\n * keyset - è·å key éå\n * values - è¿åææ\n\nç¤ºä¾ï¼\n\npublic class enummapdemo {\n    public enum signal {\n        green, yellow, red\n    }\n\n    public static void main(string[] args) {\n        system.out.println("enummapå±ç¤º");\n        enummap<signal, string> errmap = new enummap(signal.class);\n        errmap.put(signal.red, "çº¢ç¯");\n        errmap.put(signal.yellow, "é»ç¯");\n        errmap.put(signal.green, "ç»¿ç¯");\n        for (iterator<map.entry<signal, string>> iter = errmap.entryset().iterator(); iter.hasnext();) {\n            map.entry<signal, string> entry = iter.next();\n            system.out.println(entry.getkey().name() + " : " + entry.getvalue());\n        }\n    }\n}\n\n\n> æ©å±éè¯»ï¼æ·±å¥çè§£ java æä¸¾ç±»å(enum)\n> \n> è¿ç¯æç« ä¸­å¯¹ enumset å enummap åçåäºè¾ä¸ºè¯¦ç»çä»ç»ã\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * effective java\n * æ·±å¥çè§£ java æä¸¾ç±»å(enum)\n * https://droidyue.com/blog/2016/11/29/dive-into-enum/',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java æ§å¶è¯­å¥",frontmatter:{title:"Java æ§å¶è¯­å¥",date:"2020-10-17T19:13:25.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","æ§å¶è¯­å¥"],permalink:"/pages/fb4f8c/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/07.Java%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/07.Javaæ§å¶è¯­å¥.md",key:"v-52489532",path:"/pages/fb4f8c/",headers:[{level:2,title:"éæ©è¯­å¥",slug:"éæ©è¯­å¥",normalizedTitle:"éæ©è¯­å¥",charIndex:42},{level:3,title:"if è¯­å¥",slug:"if-è¯­å¥",normalizedTitle:"if è¯­å¥",charIndex:219},{level:3,title:"if...else è¯­å¥",slug:"if-else-è¯­å¥",normalizedTitle:"if...else è¯­å¥",charIndex:523},{level:3,title:"if...else if...else è¯­å¥",slug:"if-else-if-else-è¯­å¥",normalizedTitle:"if...else if...else è¯­å¥",charIndex:933},{level:3,title:"åµå¥ç ifâ¦else è¯­å¥",slug:"åµå¥ç-if-else-è¯­å¥",normalizedTitle:"åµå¥ç ifâ¦else è¯­å¥",charIndex:1744},{level:3,title:"switch è¯­å¥",slug:"switch-è¯­å¥",normalizedTitle:"switch è¯­å¥",charIndex:2227},{level:2,title:"å¾ªç¯è¯­å¥",slug:"å¾ªç¯è¯­å¥",normalizedTitle:"å¾ªç¯è¯­å¥",charIndex:91},{level:3,title:"while å¾ªç¯",slug:"while-å¾ªç¯",normalizedTitle:"while å¾ªç¯",charIndex:3635},{level:3,title:"do while å¾ªç¯",slug:"do-while-å¾ªç¯",normalizedTitle:"do while å¾ªç¯",charIndex:4161},{level:3,title:"for å¾ªç¯",slug:"for-å¾ªç¯",normalizedTitle:"for å¾ªç¯",charIndex:4832},{level:3,title:"foreach å¾ªç¯",slug:"foreach-å¾ªç¯",normalizedTitle:"foreach å¾ªç¯",charIndex:5564},{level:2,title:"ä¸­æ­è¯­å¥",slug:"ä¸­æ­è¯­å¥",normalizedTitle:"ä¸­æ­è¯­å¥",charIndex:158},{level:3,title:"break å³é®å­",slug:"break-å³é®å­",normalizedTitle:"break å³é®å­",charIndex:6263},{level:3,title:"continue å³é®å­",slug:"continue-å³é®å­",normalizedTitle:"continue å³é®å­",charIndex:6737},{level:3,title:"return å³é®å­",slug:"return-å³é®å­",normalizedTitle:"return å³é®å­",charIndex:7223},{level:2,title:"æä½³å®è·µ",slug:"æä½³å®è·µ",normalizedTitle:"æä½³å®è·µ",charIndex:7675},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7876}],headersStr:"éæ©è¯­å¥ if è¯­å¥ if...else è¯­å¥ if...else if...else è¯­å¥ åµå¥ç ifâ¦else è¯­å¥ switch è¯­å¥ å¾ªç¯è¯­å¥ while å¾ªç¯ do while å¾ªç¯ for å¾ªç¯ foreach å¾ªç¯ ä¸­æ­è¯­å¥ break å³é®å­ continue å³é®å­ return å³é®å­ æä½³å®è·µ åèèµæ",content:'# Java æ§å¶è¯­å¥\n\n> Java æ§å¶è¯­å¥å¤§è´å¯åä¸ºä¸å¤§ç±»ï¼\n> \n>  * éæ©è¯­å¥\n>    * if, else-if, else\n>    * switch\n>  * å¾ªç¯è¯­å¥\n>    * while\n>    * do...while\n>    * for\n>    * foreach\n>  * ä¸­æ­è¯­å¥\n>    * break\n>    * continue\n>    * return\n\n\n# éæ©è¯­å¥\n\n\n# if è¯­å¥\n\nif è¯­å¥ä¼å¤æ­æ¬å·ä¸­çæ¡ä»¶æ¯å¦æç«ï¼å¦ææç«åæ§è¡ if è¯­å¥ä¸­çä»£ç åï¼å¦åè·³è¿ä»£ç åç»§ç»­æ§è¡ã\n\nè¯­æ³\n\nif(å¸å°è¡¨è¾¾å¼) {\n   //å¦æå¸å°è¡¨è¾¾å¼ä¸ºtrueå°æ§è¡çè¯­å¥\n}\n\n\nç¤ºä¾\n\npublic class IfDemo {\n    public static void main(String args[]) {\n        int x = 10;\n        if (x < 20) {\n            System.out.print("è¿æ¯ if è¯­å¥");\n        }\n    }\n}\n// output:\n// è¿æ¯ if è¯­å¥\n\n\n\n# if...else è¯­å¥\n\nif è¯­å¥åé¢å¯ä»¥è· else è¯­å¥ï¼å½ if è¯­å¥çå¸å°è¡¨è¾¾å¼å¼ä¸º false æ¶ï¼else è¯­å¥åä¼è¢«æ§è¡ã\n\nè¯­æ³\n\nif(å¸å°è¡¨è¾¾å¼) {\n   //å¦æå¸å°è¡¨è¾¾å¼çå¼ä¸ºtrue\n} else {\n   //å¦æå¸å°è¡¨è¾¾å¼çå¼ä¸ºfalse\n}\n\n\nç¤ºä¾\n\npublic class IfElseDemo {\n    public static void main(String args[]) {\n        int x = 30;\n        if (x < 20) {\n            System.out.print("è¿æ¯ if è¯­å¥");\n        } else {\n            System.out.print("è¿æ¯ else è¯­å¥");\n        }\n    }\n}\n// output:\n// è¿æ¯ else è¯­å¥\n\n\n\n# if...else if...else è¯­å¥\n\n * if è¯­å¥è³å¤æ 1 ä¸ª else è¯­å¥ï¼else è¯­å¥å¨ææç else if è¯­å¥ä¹åã\n * If è¯­å¥å¯ä»¥æè¥å¹²ä¸ª else if è¯­å¥ï¼å®ä»¬å¿é¡»å¨ else è¯­å¥ä¹åã\n * ä¸æ¦å¶ä¸­ä¸ä¸ª else if è¯­å¥æ£æµä¸º trueï¼å¶ä»ç else if ä»¥å else è¯­å¥é½å°è·³è¿æ§è¡ã\n\nè¯­æ³\n\nif (å¸å°è¡¨è¾¾å¼ 1) {\n   //å¦æå¸å°è¡¨è¾¾å¼ 1çå¼ä¸ºtrueæ§è¡ä»£ç \n} else if (å¸å°è¡¨è¾¾å¼ 2) {\n   //å¦æå¸å°è¡¨è¾¾å¼ 2çå¼ä¸ºtrueæ§è¡ä»£ç \n} else if (å¸å°è¡¨è¾¾å¼ 3) {\n   //å¦æå¸å°è¡¨è¾¾å¼ 3çå¼ä¸ºtrueæ§è¡ä»£ç \n} else {\n   //å¦æä»¥ä¸å¸å°è¡¨è¾¾å¼é½ä¸ä¸ºtrueæ§è¡ä»£ç \n}\n\n\nç¤ºä¾\n\npublic class IfElseifElseDemo {\n    public static void main(String args[]) {\n        int x = 3;\n\n        if (x == 1) {\n            System.out.print("Value of X is 1");\n        } else if (x == 2) {\n            System.out.print("Value of X is 2");\n        } else if (x == 3) {\n            System.out.print("Value of X is 3");\n        } else {\n            System.out.print("This is else statement");\n        }\n    }\n}\n// output:\n// Value of X is 3\n\n\n\n# åµå¥ç ifâ¦else è¯­å¥\n\nä½¿ç¨åµå¥ç if else è¯­å¥æ¯åæ³çãä¹å°±æ¯è¯´ä½ å¯ä»¥å¨å¦ä¸ä¸ª if æè else if è¯­å¥ä¸­ä½¿ç¨ if æè else if è¯­å¥ã\n\nè¯­æ³\n\nif (å¸å°è¡¨è¾¾å¼ 1) {\n   ////å¦æå¸å°è¡¨è¾¾å¼ 1çå¼ä¸ºtrueæ§è¡ä»£ç \n   if (å¸å°è¡¨è¾¾å¼ 2) {\n      ////å¦æå¸å°è¡¨è¾¾å¼ 2çå¼ä¸ºtrueæ§è¡ä»£ç \n   }\n}\n\n\nç¤ºä¾\n\npublic class IfNestDemo {\n    public static void main(String args[]) {\n        int x = 30;\n        int y = 10;\n\n        if (x == 30) {\n            if (y == 10) {\n                System.out.print("X = 30 and Y = 10");\n            }\n        }\n    }\n}\n// output:\n// X = 30 and Y = 10\n\n\n\n# switch è¯­å¥\n\nswitch è¯­å¥å¤æ­ä¸ä¸ªåéä¸ä¸ç³»åå¼ä¸­æä¸ªå¼æ¯å¦ç¸ç­ï¼æ¯ä¸ªå¼ç§°ä¸ºä¸ä¸ªåæ¯ã\n\nswitch è¯­å¥æå¦ä¸è§åï¼\n\n * switch è¯­å¥ä¸­çåéç±»ååªè½ä¸º byteãshortãintãchar æè Stringã\n * switch è¯­å¥å¯ä»¥æ¥æå¤ä¸ª case è¯­å¥ãæ¯ä¸ª case åé¢è·ä¸ä¸ªè¦æ¯è¾çå¼ååå·ã\n * case è¯­å¥ä¸­çå¼çæ°æ®ç±»åå¿é¡»ä¸åéçæ°æ®ç±»åç¸åï¼èä¸åªè½æ¯å¸¸éæèå­é¢å¸¸éã\n * å½åéçå¼ä¸ case è¯­å¥çå¼ç¸ç­æ¶ï¼é£ä¹ case è¯­å¥ä¹åçè¯­å¥å¼å§æ§è¡ï¼ç´å° break è¯­å¥åºç°æä¼è·³åº switch è¯­å¥ã\n * å½éå° break è¯­å¥æ¶ï¼switch è¯­å¥ç»æ­¢ãç¨åºè·³è½¬å° switch è¯­å¥åé¢çè¯­å¥æ§è¡ãcase è¯­å¥ä¸å¿é¡»è¦åå« break è¯­å¥ãå¦ææ²¡æ break è¯­å¥åºç°ï¼ç¨åºä¼ç»§ç»­æ§è¡ä¸ä¸æ¡ case è¯­å¥ï¼ç´å°åºç° break è¯­å¥ã\n * switch è¯­å¥å¯ä»¥åå«ä¸ä¸ª default åæ¯ï¼è¯¥åæ¯å¿é¡»æ¯ switch è¯­å¥çæåä¸ä¸ªåæ¯ãdefault å¨æ²¡æ case è¯­å¥çå¼ååéå¼ç¸ç­çæ¶åæ§è¡ãdefault åæ¯ä¸éè¦ break è¯­å¥ã\n\nè¯­æ³\n\nswitch(expression){\n    case value :\n       //è¯­å¥\n       break; //å¯é\n    case value :\n       //è¯­å¥\n       break; //å¯é\n    //ä½ å¯ä»¥æä»»ææ°éçcaseè¯­å¥\n    default : //å¯é\n       //è¯­å¥\n       break; //å¯éï¼ä½ä¸è¬å»ºè®®å ä¸\n}\n\n\nç¤ºä¾\n\npublic class SwitchDemo {\n    public static void main(String args[]) {\n        char grade = \'C\';\n\n        switch (grade) {\n        case \'A\':\n            System.out.println("Excellent!");\n            break;\n        case \'B\':\n        case \'C\':\n            System.out.println("Well done");\n            break;\n        case \'D\':\n            System.out.println("You passed");\n        case \'F\':\n            System.out.println("Better try again");\n            break;\n        default:\n            System.out.println("Invalid grade");\n            break;\n        }\n        System.out.println("Your grade is " + grade);\n    }\n}\n// output:\n// Well done\n// Your grade is C\n\n\n\n# å¾ªç¯è¯­å¥\n\n\n# while å¾ªç¯\n\nåªè¦å¸å°è¡¨è¾¾å¼ä¸º trueï¼while å¾ªç¯ä½ä¼ä¸ç´æ§è¡ä¸å»ã\n\nè¯­æ³\n\nwhile( å¸å°è¡¨è¾¾å¼ ) {\n    //å¾ªç¯åå®¹\n}\n\n\nç¤ºä¾\n\npublic class WhileDemo {\n    public static void main(String args[]) {\n        int x = 10;\n        while (x < 20) {\n            System.out.print("value of x : " + x);\n            x++;\n            System.out.print("\\n");\n        }\n    }\n}\n// output:\n// value of x : 10\n// value of x : 11\n// value of x : 12\n// value of x : 13\n// value of x : 14\n// value of x : 15\n// value of x : 16\n// value of x : 17\n// value of x : 18\n// value of x : 19\n\n\n\n# do while å¾ªç¯\n\nå¯¹äº while è¯­å¥èè¨ï¼å¦æä¸æ»¡è¶³æ¡ä»¶ï¼åä¸è½è¿å¥å¾ªç¯ãä½ææ¶åæä»¬éè¦å³ä½¿ä¸æ»¡è¶³æ¡ä»¶ï¼ä¹è³å°æ§è¡ä¸æ¬¡ã\n\ndo while å¾ªç¯å while å¾ªç¯ç¸ä¼¼ï¼ä¸åçæ¯ï¼do while å¾ªç¯è³å°ä¼æ§è¡ä¸æ¬¡ã\n\nè¯­æ³\n\ndo {\n    //ä»£ç è¯­å¥\n} while (å¸å°è¡¨è¾¾å¼);\n\n\nå¸å°è¡¨è¾¾å¼å¨å¾ªç¯ä½çåé¢ï¼æä»¥è¯­å¥åå¨æ£æµå¸å°è¡¨è¾¾å¼ä¹åå·²ç»æ§è¡äºã å¦æå¸å°è¡¨è¾¾å¼çå¼ä¸º trueï¼åè¯­å¥åä¸ç´æ§è¡ï¼ç´å°å¸å°è¡¨è¾¾å¼çå¼ä¸º falseã\n\nç¤ºä¾\n\npublic class DoWhileDemo {\n    public static void main(String args[]) {\n        int x = 10;\n\n        do {\n            System.out.print("value of x : " + x);\n            x++;\n            System.out.print("\\n");\n        } while (x < 20);\n    }\n}\n// output:\n// value of x:10\n// value of x:11\n// value of x:12\n// value of x:13\n// value of x:14\n// value of x:15\n// value of x:16\n// value of x:17\n// value of x:18\n// value of x:19\n\n\n\n# for å¾ªç¯\n\nè½ç¶ææå¾ªç¯ç»æé½å¯ä»¥ç¨ while æè do while è¡¨ç¤ºï¼ä½ Java æä¾äºå¦ä¸ç§è¯­å¥ ââ for å¾ªç¯ï¼ä½¿ä¸äºå¾ªç¯ç»æåå¾æ´å ç®åã for å¾ªç¯æ§è¡çæ¬¡æ°æ¯å¨æ§è¡åå°±ç¡®å®çã\n\nè¯­æ³\n\nfor (åå§å; å¸å°è¡¨è¾¾å¼; æ´æ°) {\n    //ä»£ç è¯­å¥\n}\n\n\n * æåæ§è¡åå§åæ­¥éª¤ãå¯ä»¥å£°æä¸ç§ç±»åï¼ä½å¯åå§åä¸ä¸ªæå¤ä¸ªå¾ªç¯æ§å¶åéï¼ä¹å¯ä»¥æ¯ç©ºè¯­å¥ã\n * ç¶åï¼æ£æµå¸å°è¡¨è¾¾å¼çå¼ãå¦æä¸º trueï¼å¾ªç¯ä½è¢«æ§è¡ãå¦æä¸º falseï¼å¾ªç¯ç»æ­¢ï¼å¼å§æ§è¡å¾ªç¯ä½åé¢çè¯­å¥ã\n * æ§è¡ä¸æ¬¡å¾ªç¯åï¼æ´æ°å¾ªç¯æ§å¶åéã\n * åæ¬¡æ£æµå¸å°è¡¨è¾¾å¼ãå¾ªç¯æ§è¡ä¸é¢çè¿ç¨ã\n\nç¤ºä¾\n\npublic class ForDemo {\n    public static void main(String args[]) {\n        for (int x = 10; x < 20; x = x + 1) {\n            System.out.print("value of x : " + x);\n            System.out.print("\\n");\n        }\n    }\n}\n// output:\n// value of x : 10\n// value of x : 11\n// value of x : 12\n// value of x : 13\n// value of x : 14\n// value of x : 15\n// value of x : 16\n// value of x : 17\n// value of x : 18\n// value of x : 19\n\n\n\n# foreach å¾ªç¯\n\nJava5 å¼å¥äºä¸ç§ä¸»è¦ç¨äºæ°ç»çå¢å¼ºå for å¾ªç¯ã\n\nè¯­æ³\n\nfor (å£°æè¯­å¥ : è¡¨è¾¾å¼) {\n    //ä»£ç å¥å­\n}\n\n\nå£°æè¯­å¥ï¼å£°ææ°çå±é¨åéï¼è¯¥åéçç±»åå¿é¡»åæ°ç»åç´ çç±»åå¹éãå¶ä½ç¨åéå®å¨å¾ªç¯è¯­å¥åï¼å¶å¼ä¸æ­¤æ¶æ°ç»åç´ çå¼ç¸ç­ã\n\nè¡¨è¾¾å¼ï¼è¡¨è¾¾å¼æ¯è¦è®¿é®çæ°ç»åï¼æèæ¯è¿åå¼ä¸ºæ°ç»çæ¹æ³ã\n\nç¤ºä¾\n\npublic class ForeachDemo {\n    public static void main(String args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            System.out.print(x);\n            System.out.print(",");\n        }\n\n        System.out.print("\\n");\n        String[] names = { "James", "Larry", "Tom", "Lacy" };\n\n        for (String name : names) {\n            System.out.print(name);\n            System.out.print(",");\n        }\n    }\n}\n// output:\n// 10,20,30,40,50,\n// James,Larry,Tom,Lacy,\n\n\n\n# ä¸­æ­è¯­å¥\n\n\n# break å³é®å­\n\nbreak ä¸»è¦ç¨å¨å¾ªç¯è¯­å¥æè switch è¯­å¥ä¸­ï¼ç¨æ¥è·³åºæ´ä¸ªè¯­å¥åã\n\nbreak è·³åºæéå±çå¾ªç¯ï¼å¹¶ä¸ç»§ç»­æ§è¡è¯¥å¾ªç¯ä¸é¢çè¯­å¥ã\n\nç¤ºä¾\n\npublic class BreakDemo {\n    public static void main(String args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            if (x == 30) {\n                break;\n            }\n            System.out.print(x);\n            System.out.print("\\n");\n        }\n\n        System.out.println("break ç¤ºä¾ç»æ");\n    }\n}\n// output:\n// 10\n// 20\n// break ç¤ºä¾ç»æ\n\n\n\n# continue å³é®å­\n\ncontinue éç¨äºä»»ä½å¾ªç¯æ§å¶ç»æä¸­ãä½ç¨æ¯è®©ç¨åºç«å»è·³è½¬å°ä¸ä¸æ¬¡å¾ªç¯çè¿­ä»£ãå¨ for å¾ªç¯ä¸­ï¼continue è¯­å¥ä½¿ç¨åºç«å³è·³è½¬å°æ´æ°è¯­å¥ãå¨ while æè do while å¾ªç¯ä¸­ï¼ç¨åºç«å³è·³è½¬å°å¸å°è¡¨è¾¾å¼çå¤æ­è¯­å¥ã\n\nç¤ºä¾\n\npublic class ContinueDemo {\n    public static void main(String args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            if (x == 30) {\n                continue;\n            }\n            System.out.print(x);\n            System.out.print("\\n");\n        }\n    }\n}\n// output:\n// 10\n// 20\n// 40\n// 50\n\n\n\n# return å³é®å­\n\nè·³åºæ´ä¸ªå½æ°ä½ï¼å½æ°ä½åé¢çé¨åä¸åæ§è¡ã\n\nç¤ºä¾\n\npublic class ReturnDemo {\n    public static void main(String args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            if (x == 30) {\n                return;\n            }\n            System.out.print(x);\n            System.out.print("\\n");\n        }\n\n        System.out.println("return ç¤ºä¾ç»æ");\n    }\n}\n// output:\n// 10\n// 20\n\n\n> ð æ³¨æï¼è¯·ä»ç»ä½ä¼ä¸ä¸ return å break çåºå«ã\n\n\n# æä½³å®è·µ\n\n * éæ©åæ¯ç¹å«å¤çæåµä¸ï¼switch è¯­å¥ä¼äº if...else if...else è¯­å¥ã\n * switch è¯­å¥ä¸è¦åå¬ä½¿ç¨ defaultã\n * switch è¯­å¥ä¸­ç default è¦æ¾å¨æåã\n * foreach å¾ªç¯ä¼åäºä¼ ç»ç for å¾ªç¯\n * ä¸è¦å¾ªç¯éåå®¹å¨åç´ ï¼ç¶åå é¤ç¹å®åç´ ãæ­£ç¡®å§¿å¿åºè¯¥æ¯éåå®¹å¨çè¿­ä»£å¨ï¼Iteratorï¼ï¼å é¤åç´ ã\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼',normalizedContent:'# java æ§å¶è¯­å¥\n\n> java æ§å¶è¯­å¥å¤§è´å¯åä¸ºä¸å¤§ç±»ï¼\n> \n>  * éæ©è¯­å¥\n>    * if, else-if, else\n>    * switch\n>  * å¾ªç¯è¯­å¥\n>    * while\n>    * do...while\n>    * for\n>    * foreach\n>  * ä¸­æ­è¯­å¥\n>    * break\n>    * continue\n>    * return\n\n\n# éæ©è¯­å¥\n\n\n# if è¯­å¥\n\nif è¯­å¥ä¼å¤æ­æ¬å·ä¸­çæ¡ä»¶æ¯å¦æç«ï¼å¦ææç«åæ§è¡ if è¯­å¥ä¸­çä»£ç åï¼å¦åè·³è¿ä»£ç åç»§ç»­æ§è¡ã\n\nè¯­æ³\n\nif(å¸å°è¡¨è¾¾å¼) {\n   //å¦æå¸å°è¡¨è¾¾å¼ä¸ºtrueå°æ§è¡çè¯­å¥\n}\n\n\nç¤ºä¾\n\npublic class ifdemo {\n    public static void main(string args[]) {\n        int x = 10;\n        if (x < 20) {\n            system.out.print("è¿æ¯ if è¯­å¥");\n        }\n    }\n}\n// output:\n// è¿æ¯ if è¯­å¥\n\n\n\n# if...else è¯­å¥\n\nif è¯­å¥åé¢å¯ä»¥è· else è¯­å¥ï¼å½ if è¯­å¥çå¸å°è¡¨è¾¾å¼å¼ä¸º false æ¶ï¼else è¯­å¥åä¼è¢«æ§è¡ã\n\nè¯­æ³\n\nif(å¸å°è¡¨è¾¾å¼) {\n   //å¦æå¸å°è¡¨è¾¾å¼çå¼ä¸ºtrue\n} else {\n   //å¦æå¸å°è¡¨è¾¾å¼çå¼ä¸ºfalse\n}\n\n\nç¤ºä¾\n\npublic class ifelsedemo {\n    public static void main(string args[]) {\n        int x = 30;\n        if (x < 20) {\n            system.out.print("è¿æ¯ if è¯­å¥");\n        } else {\n            system.out.print("è¿æ¯ else è¯­å¥");\n        }\n    }\n}\n// output:\n// è¿æ¯ else è¯­å¥\n\n\n\n# if...else if...else è¯­å¥\n\n * if è¯­å¥è³å¤æ 1 ä¸ª else è¯­å¥ï¼else è¯­å¥å¨ææç else if è¯­å¥ä¹åã\n * if è¯­å¥å¯ä»¥æè¥å¹²ä¸ª else if è¯­å¥ï¼å®ä»¬å¿é¡»å¨ else è¯­å¥ä¹åã\n * ä¸æ¦å¶ä¸­ä¸ä¸ª else if è¯­å¥æ£æµä¸º trueï¼å¶ä»ç else if ä»¥å else è¯­å¥é½å°è·³è¿æ§è¡ã\n\nè¯­æ³\n\nif (å¸å°è¡¨è¾¾å¼ 1) {\n   //å¦æå¸å°è¡¨è¾¾å¼ 1çå¼ä¸ºtrueæ§è¡ä»£ç \n} else if (å¸å°è¡¨è¾¾å¼ 2) {\n   //å¦æå¸å°è¡¨è¾¾å¼ 2çå¼ä¸ºtrueæ§è¡ä»£ç \n} else if (å¸å°è¡¨è¾¾å¼ 3) {\n   //å¦æå¸å°è¡¨è¾¾å¼ 3çå¼ä¸ºtrueæ§è¡ä»£ç \n} else {\n   //å¦æä»¥ä¸å¸å°è¡¨è¾¾å¼é½ä¸ä¸ºtrueæ§è¡ä»£ç \n}\n\n\nç¤ºä¾\n\npublic class ifelseifelsedemo {\n    public static void main(string args[]) {\n        int x = 3;\n\n        if (x == 1) {\n            system.out.print("value of x is 1");\n        } else if (x == 2) {\n            system.out.print("value of x is 2");\n        } else if (x == 3) {\n            system.out.print("value of x is 3");\n        } else {\n            system.out.print("this is else statement");\n        }\n    }\n}\n// output:\n// value of x is 3\n\n\n\n# åµå¥ç ifâ¦else è¯­å¥\n\nä½¿ç¨åµå¥ç if else è¯­å¥æ¯åæ³çãä¹å°±æ¯è¯´ä½ å¯ä»¥å¨å¦ä¸ä¸ª if æè else if è¯­å¥ä¸­ä½¿ç¨ if æè else if è¯­å¥ã\n\nè¯­æ³\n\nif (å¸å°è¡¨è¾¾å¼ 1) {\n   ////å¦æå¸å°è¡¨è¾¾å¼ 1çå¼ä¸ºtrueæ§è¡ä»£ç \n   if (å¸å°è¡¨è¾¾å¼ 2) {\n      ////å¦æå¸å°è¡¨è¾¾å¼ 2çå¼ä¸ºtrueæ§è¡ä»£ç \n   }\n}\n\n\nç¤ºä¾\n\npublic class ifnestdemo {\n    public static void main(string args[]) {\n        int x = 30;\n        int y = 10;\n\n        if (x == 30) {\n            if (y == 10) {\n                system.out.print("x = 30 and y = 10");\n            }\n        }\n    }\n}\n// output:\n// x = 30 and y = 10\n\n\n\n# switch è¯­å¥\n\nswitch è¯­å¥å¤æ­ä¸ä¸ªåéä¸ä¸ç³»åå¼ä¸­æä¸ªå¼æ¯å¦ç¸ç­ï¼æ¯ä¸ªå¼ç§°ä¸ºä¸ä¸ªåæ¯ã\n\nswitch è¯­å¥æå¦ä¸è§åï¼\n\n * switch è¯­å¥ä¸­çåéç±»ååªè½ä¸º byteãshortãintãchar æè stringã\n * switch è¯­å¥å¯ä»¥æ¥æå¤ä¸ª case è¯­å¥ãæ¯ä¸ª case åé¢è·ä¸ä¸ªè¦æ¯è¾çå¼ååå·ã\n * case è¯­å¥ä¸­çå¼çæ°æ®ç±»åå¿é¡»ä¸åéçæ°æ®ç±»åç¸åï¼èä¸åªè½æ¯å¸¸éæèå­é¢å¸¸éã\n * å½åéçå¼ä¸ case è¯­å¥çå¼ç¸ç­æ¶ï¼é£ä¹ case è¯­å¥ä¹åçè¯­å¥å¼å§æ§è¡ï¼ç´å° break è¯­å¥åºç°æä¼è·³åº switch è¯­å¥ã\n * å½éå° break è¯­å¥æ¶ï¼switch è¯­å¥ç»æ­¢ãç¨åºè·³è½¬å° switch è¯­å¥åé¢çè¯­å¥æ§è¡ãcase è¯­å¥ä¸å¿é¡»è¦åå« break è¯­å¥ãå¦ææ²¡æ break è¯­å¥åºç°ï¼ç¨åºä¼ç»§ç»­æ§è¡ä¸ä¸æ¡ case è¯­å¥ï¼ç´å°åºç° break è¯­å¥ã\n * switch è¯­å¥å¯ä»¥åå«ä¸ä¸ª default åæ¯ï¼è¯¥åæ¯å¿é¡»æ¯ switch è¯­å¥çæåä¸ä¸ªåæ¯ãdefault å¨æ²¡æ case è¯­å¥çå¼ååéå¼ç¸ç­çæ¶åæ§è¡ãdefault åæ¯ä¸éè¦ break è¯­å¥ã\n\nè¯­æ³\n\nswitch(expression){\n    case value :\n       //è¯­å¥\n       break; //å¯é\n    case value :\n       //è¯­å¥\n       break; //å¯é\n    //ä½ å¯ä»¥æä»»ææ°éçcaseè¯­å¥\n    default : //å¯é\n       //è¯­å¥\n       break; //å¯éï¼ä½ä¸è¬å»ºè®®å ä¸\n}\n\n\nç¤ºä¾\n\npublic class switchdemo {\n    public static void main(string args[]) {\n        char grade = \'c\';\n\n        switch (grade) {\n        case \'a\':\n            system.out.println("excellent!");\n            break;\n        case \'b\':\n        case \'c\':\n            system.out.println("well done");\n            break;\n        case \'d\':\n            system.out.println("you passed");\n        case \'f\':\n            system.out.println("better try again");\n            break;\n        default:\n            system.out.println("invalid grade");\n            break;\n        }\n        system.out.println("your grade is " + grade);\n    }\n}\n// output:\n// well done\n// your grade is c\n\n\n\n# å¾ªç¯è¯­å¥\n\n\n# while å¾ªç¯\n\nåªè¦å¸å°è¡¨è¾¾å¼ä¸º trueï¼while å¾ªç¯ä½ä¼ä¸ç´æ§è¡ä¸å»ã\n\nè¯­æ³\n\nwhile( å¸å°è¡¨è¾¾å¼ ) {\n    //å¾ªç¯åå®¹\n}\n\n\nç¤ºä¾\n\npublic class whiledemo {\n    public static void main(string args[]) {\n        int x = 10;\n        while (x < 20) {\n            system.out.print("value of x : " + x);\n            x++;\n            system.out.print("\\n");\n        }\n    }\n}\n// output:\n// value of x : 10\n// value of x : 11\n// value of x : 12\n// value of x : 13\n// value of x : 14\n// value of x : 15\n// value of x : 16\n// value of x : 17\n// value of x : 18\n// value of x : 19\n\n\n\n# do while å¾ªç¯\n\nå¯¹äº while è¯­å¥èè¨ï¼å¦æä¸æ»¡è¶³æ¡ä»¶ï¼åä¸è½è¿å¥å¾ªç¯ãä½ææ¶åæä»¬éè¦å³ä½¿ä¸æ»¡è¶³æ¡ä»¶ï¼ä¹è³å°æ§è¡ä¸æ¬¡ã\n\ndo while å¾ªç¯å while å¾ªç¯ç¸ä¼¼ï¼ä¸åçæ¯ï¼do while å¾ªç¯è³å°ä¼æ§è¡ä¸æ¬¡ã\n\nè¯­æ³\n\ndo {\n    //ä»£ç è¯­å¥\n} while (å¸å°è¡¨è¾¾å¼);\n\n\nå¸å°è¡¨è¾¾å¼å¨å¾ªç¯ä½çåé¢ï¼æä»¥è¯­å¥åå¨æ£æµå¸å°è¡¨è¾¾å¼ä¹åå·²ç»æ§è¡äºã å¦æå¸å°è¡¨è¾¾å¼çå¼ä¸º trueï¼åè¯­å¥åä¸ç´æ§è¡ï¼ç´å°å¸å°è¡¨è¾¾å¼çå¼ä¸º falseã\n\nç¤ºä¾\n\npublic class dowhiledemo {\n    public static void main(string args[]) {\n        int x = 10;\n\n        do {\n            system.out.print("value of x : " + x);\n            x++;\n            system.out.print("\\n");\n        } while (x < 20);\n    }\n}\n// output:\n// value of x:10\n// value of x:11\n// value of x:12\n// value of x:13\n// value of x:14\n// value of x:15\n// value of x:16\n// value of x:17\n// value of x:18\n// value of x:19\n\n\n\n# for å¾ªç¯\n\nè½ç¶ææå¾ªç¯ç»æé½å¯ä»¥ç¨ while æè do while è¡¨ç¤ºï¼ä½ java æä¾äºå¦ä¸ç§è¯­å¥ ââ for å¾ªç¯ï¼ä½¿ä¸äºå¾ªç¯ç»æåå¾æ´å ç®åã for å¾ªç¯æ§è¡çæ¬¡æ°æ¯å¨æ§è¡åå°±ç¡®å®çã\n\nè¯­æ³\n\nfor (åå§å; å¸å°è¡¨è¾¾å¼; æ´æ°) {\n    //ä»£ç è¯­å¥\n}\n\n\n * æåæ§è¡åå§åæ­¥éª¤ãå¯ä»¥å£°æä¸ç§ç±»åï¼ä½å¯åå§åä¸ä¸ªæå¤ä¸ªå¾ªç¯æ§å¶åéï¼ä¹å¯ä»¥æ¯ç©ºè¯­å¥ã\n * ç¶åï¼æ£æµå¸å°è¡¨è¾¾å¼çå¼ãå¦æä¸º trueï¼å¾ªç¯ä½è¢«æ§è¡ãå¦æä¸º falseï¼å¾ªç¯ç»æ­¢ï¼å¼å§æ§è¡å¾ªç¯ä½åé¢çè¯­å¥ã\n * æ§è¡ä¸æ¬¡å¾ªç¯åï¼æ´æ°å¾ªç¯æ§å¶åéã\n * åæ¬¡æ£æµå¸å°è¡¨è¾¾å¼ãå¾ªç¯æ§è¡ä¸é¢çè¿ç¨ã\n\nç¤ºä¾\n\npublic class fordemo {\n    public static void main(string args[]) {\n        for (int x = 10; x < 20; x = x + 1) {\n            system.out.print("value of x : " + x);\n            system.out.print("\\n");\n        }\n    }\n}\n// output:\n// value of x : 10\n// value of x : 11\n// value of x : 12\n// value of x : 13\n// value of x : 14\n// value of x : 15\n// value of x : 16\n// value of x : 17\n// value of x : 18\n// value of x : 19\n\n\n\n# foreach å¾ªç¯\n\njava5 å¼å¥äºä¸ç§ä¸»è¦ç¨äºæ°ç»çå¢å¼ºå for å¾ªç¯ã\n\nè¯­æ³\n\nfor (å£°æè¯­å¥ : è¡¨è¾¾å¼) {\n    //ä»£ç å¥å­\n}\n\n\nå£°æè¯­å¥ï¼å£°ææ°çå±é¨åéï¼è¯¥åéçç±»åå¿é¡»åæ°ç»åç´ çç±»åå¹éãå¶ä½ç¨åéå®å¨å¾ªç¯è¯­å¥åï¼å¶å¼ä¸æ­¤æ¶æ°ç»åç´ çå¼ç¸ç­ã\n\nè¡¨è¾¾å¼ï¼è¡¨è¾¾å¼æ¯è¦è®¿é®çæ°ç»åï¼æèæ¯è¿åå¼ä¸ºæ°ç»çæ¹æ³ã\n\nç¤ºä¾\n\npublic class foreachdemo {\n    public static void main(string args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            system.out.print(x);\n            system.out.print(",");\n        }\n\n        system.out.print("\\n");\n        string[] names = { "james", "larry", "tom", "lacy" };\n\n        for (string name : names) {\n            system.out.print(name);\n            system.out.print(",");\n        }\n    }\n}\n// output:\n// 10,20,30,40,50,\n// james,larry,tom,lacy,\n\n\n\n# ä¸­æ­è¯­å¥\n\n\n# break å³é®å­\n\nbreak ä¸»è¦ç¨å¨å¾ªç¯è¯­å¥æè switch è¯­å¥ä¸­ï¼ç¨æ¥è·³åºæ´ä¸ªè¯­å¥åã\n\nbreak è·³åºæéå±çå¾ªç¯ï¼å¹¶ä¸ç»§ç»­æ§è¡è¯¥å¾ªç¯ä¸é¢çè¯­å¥ã\n\nç¤ºä¾\n\npublic class breakdemo {\n    public static void main(string args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            if (x == 30) {\n                break;\n            }\n            system.out.print(x);\n            system.out.print("\\n");\n        }\n\n        system.out.println("break ç¤ºä¾ç»æ");\n    }\n}\n// output:\n// 10\n// 20\n// break ç¤ºä¾ç»æ\n\n\n\n# continue å³é®å­\n\ncontinue éç¨äºä»»ä½å¾ªç¯æ§å¶ç»æä¸­ãä½ç¨æ¯è®©ç¨åºç«å»è·³è½¬å°ä¸ä¸æ¬¡å¾ªç¯çè¿­ä»£ãå¨ for å¾ªç¯ä¸­ï¼continue è¯­å¥ä½¿ç¨åºç«å³è·³è½¬å°æ´æ°è¯­å¥ãå¨ while æè do while å¾ªç¯ä¸­ï¼ç¨åºç«å³è·³è½¬å°å¸å°è¡¨è¾¾å¼çå¤æ­è¯­å¥ã\n\nç¤ºä¾\n\npublic class continuedemo {\n    public static void main(string args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            if (x == 30) {\n                continue;\n            }\n            system.out.print(x);\n            system.out.print("\\n");\n        }\n    }\n}\n// output:\n// 10\n// 20\n// 40\n// 50\n\n\n\n# return å³é®å­\n\nè·³åºæ´ä¸ªå½æ°ä½ï¼å½æ°ä½åé¢çé¨åä¸åæ§è¡ã\n\nç¤ºä¾\n\npublic class returndemo {\n    public static void main(string args[]) {\n        int[] numbers = { 10, 20, 30, 40, 50 };\n\n        for (int x : numbers) {\n            if (x == 30) {\n                return;\n            }\n            system.out.print(x);\n            system.out.print("\\n");\n        }\n\n        system.out.println("return ç¤ºä¾ç»æ");\n    }\n}\n// output:\n// 10\n// 20\n\n\n> ð æ³¨æï¼è¯·ä»ç»ä½ä¼ä¸ä¸ return å break çåºå«ã\n\n\n# æä½³å®è·µ\n\n * éæ©åæ¯ç¹å«å¤çæåµä¸ï¼switch è¯­å¥ä¼äº if...else if...else è¯­å¥ã\n * switch è¯­å¥ä¸è¦åå¬ä½¿ç¨ defaultã\n * switch è¯­å¥ä¸­ç default è¦æ¾å¨æåã\n * foreach å¾ªç¯ä¼åäºä¼ ç»ç for å¾ªç¯\n * ä¸è¦å¾ªç¯éåå®¹å¨åç´ ï¼ç¶åå é¤ç¹å®åç´ ãæ­£ç¡®å§¿å¿åºè¯¥æ¯éåå®¹å¨çè¿­ä»£å¨ï¼iteratorï¼ï¼å é¤åç´ ã\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java å¼å¸¸",frontmatter:{title:"æ·±å¥çè§£ Java å¼å¸¸",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","å¼å¸¸"],permalink:"/pages/37415c/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/08.Java%E5%BC%82%E5%B8%B8.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/08.Javaå¼å¸¸.md",key:"v-7b80f369",path:"/pages/37415c/",headers:[{level:2,title:"å¼å¸¸æ¡æ¶",slug:"å¼å¸¸æ¡æ¶",normalizedTitle:"å¼å¸¸æ¡æ¶",charIndex:21},{level:3,title:"Throwable",slug:"throwable",normalizedTitle:"throwable",charIndex:30},{level:3,title:"Error",slug:"error",normalizedTitle:"error",charIndex:68},{level:3,title:"Exception",slug:"exception",normalizedTitle:"exception",charIndex:78},{level:3,title:"RuntimeException",slug:"runtimeexception",normalizedTitle:"runtimeexception",charIndex:1915},{level:2,title:"èªå®ä¹å¼å¸¸",slug:"èªå®ä¹å¼å¸¸",normalizedTitle:"èªå®ä¹å¼å¸¸",charIndex:3479},{level:2,title:"æåºå¼å¸¸",slug:"æåºå¼å¸¸",normalizedTitle:"æåºå¼å¸¸",charIndex:4005},{level:2,title:"æè·å¼å¸¸",slug:"æè·å¼å¸¸",normalizedTitle:"æè·å¼å¸¸",charIndex:5730},{level:2,title:"å¼å¸¸é¾",slug:"å¼å¸¸é¾",normalizedTitle:"å¼å¸¸é¾",charIndex:7145},{level:2,title:"å¼å¸¸æ³¨æäºé¡¹",slug:"å¼å¸¸æ³¨æäºé¡¹",normalizedTitle:"å¼å¸¸æ³¨æäºé¡¹",charIndex:8814},{level:3,title:"finally è¦çå¼å¸¸",slug:"finally-è¦çå¼å¸¸",normalizedTitle:"finally è¦çå¼å¸¸",charIndex:8825},{level:3,title:"è¦çæåºå¼å¸¸çæ¹æ³",slug:"è¦çæåºå¼å¸¸çæ¹æ³",normalizedTitle:"è¦çæåºå¼å¸¸çæ¹æ³",charIndex:9472},{level:3,title:"å¼å¸¸åçº¿ç¨",slug:"å¼å¸¸åçº¿ç¨",normalizedTitle:"å¼å¸¸åçº¿ç¨",charIndex:10315},{level:2,title:"æä½³å®è·µ",slug:"æä½³å®è·µ",normalizedTitle:"æä½³å®è·µ",charIndex:10411},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:11058}],headersStr:"å¼å¸¸æ¡æ¶ Throwable Error Exception RuntimeException èªå®ä¹å¼å¸¸ æåºå¼å¸¸ æè·å¼å¸¸ å¼å¸¸é¾ å¼å¸¸æ³¨æäºé¡¹ finally è¦çå¼å¸¸ è¦çæåºå¼å¸¸çæ¹æ³ å¼å¸¸åçº¿ç¨ æä½³å®è·µ åèèµæ",content:'# æ·±å¥çè§£ Java å¼å¸¸\n\n\n\n\n# å¼å¸¸æ¡æ¶\n\n\n# Throwable\n\n**Throwable æ¯ Java è¯­è¨ä¸­ææéè¯¯ï¼Errorï¼åå¼å¸¸ï¼Exceptionï¼çè¶ç±»ã**å¨ Java ä¸­åªæ Throwable ç±»åçå®ä¾æå¯ä»¥è¢«æåºï¼throwï¼æèæè·ï¼catchï¼ï¼å®æ¯å¼å¸¸å¤çæºå¶çåºæ¬ç»æç±»åã\n\nThrowable åå«äºå¶çº¿ç¨åå»ºæ¶çº¿ç¨æ§è¡å æ çå¿«ç§ï¼å®æä¾äº printStackTrace() ç­æ¥å£ç¨äºè·åå æ è·è¸ªæ°æ®ç­ä¿¡æ¯ã\n\nä¸»è¦æ¹æ³ï¼\n\n * fillInStackTrace - ç¨å½åçè°ç¨æ å±æ¬¡å¡«å Throwable å¯¹è±¡æ å±æ¬¡ï¼æ·»å å°æ å±æ¬¡ä»»ä½ååä¿¡æ¯ä¸­ã\n * getMessage - è¿åå³äºåççå¼å¸¸çè¯¦ç»ä¿¡æ¯ãè¿ä¸ªæ¶æ¯å¨ Throwable ç±»çæé å½æ°ä¸­åå§åäºã\n * getCause - è¿åä¸ä¸ª Throwable å¯¹è±¡ä»£è¡¨å¼å¸¸åå ã\n * getStackTrace - è¿åä¸ä¸ªåå«å æ å±æ¬¡çæ°ç»ãä¸æ ä¸º 0 çåç´ ä»£è¡¨æ é¡¶ï¼æåä¸ä¸ªåç´ ä»£è¡¨æ¹æ³è°ç¨å æ çæ åºã\n * printStackTrace - æå° toString() ç»æåæ å±æ¬¡å° System.errï¼å³éè¯¯è¾åºæµã\n * toString - ä½¿ç¨ getMessage çç»æè¿åä»£è¡¨ Throwable å¯¹è±¡çå­ç¬¦ä¸²ã\n\n\n# Error\n\nError æ¯ Throwable çä¸ä¸ªå­ç±»ãError è¡¨ç¤ºæ­£å¸¸æåµä¸ï¼ä¸å¤§å¯è½åºç°çä¸¥éé®é¢ãç¼è¯å¨ä¸ä¼æ£æ¥ Errorãç»å¤§é¨åç Error é½ä¼å¯¼è´ç¨åºï¼æ¯å¦ JVM èªèº«ï¼å¤äºéæ­£å¸¸çãä¸å¯æ¢å¤ç¶æãæ¢ç¶æ¯éæ­£å¸¸æåµï¼æä»¥ä¸ä¾¿äºä¹ä¸éè¦æè·ï¼å¸¸è§çæ¯å¦ OutOfMemoryError ä¹ç±»ï¼é½æ¯ Error çå­ç±»ã\n\nå¸¸è§ Errorï¼\n\n * AssertionError - æ­è¨éè¯¯ã\n * VirtualMachineError - èææºéè¯¯ã\n * UnsupportedClassVersionError - Java ç±»çæ¬éè¯¯ã\n * StackOverflowError - æ æº¢åºéè¯¯ã\n * OutOfMemoryError - åå­æº¢åºéè¯¯ã\n\n\n# Exception\n\nException æ¯ Throwable çä¸ä¸ªå­ç±»ã**Exception è¡¨ç¤ºåççåºç¨ç¨åºå¯è½æ³è¦æè·çæ¡ä»¶ã**Exception æ¯ç¨åºæ­£å¸¸è¿è¡ä¸­ï¼å¯ä»¥é¢æçæå¤æåµï¼å¯è½å¹¶ä¸åºè¯¥è¢«æè·ï¼è¿è¡ç¸åºå¤çã\n\nException ååä¸ºå¯æ£æ¥ï¼checkedï¼å¼å¸¸åä¸æ£æ¥ï¼uncheckedï¼å¼å¸¸ï¼å¯æ£æ¥å¼å¸¸å¨æºä»£ç éå¿é¡»æ¾å¼å°è¿è¡æè·å¤çï¼è¿æ¯ç¼è¯ææ£æ¥çä¸é¨åã\n\n**ç¼è¯å¨ä¼æ£æ¥ Exception å¼å¸¸ã**æ­¤ç±»å¼å¸¸ï¼è¦ä¹éè¿ throws è¿è¡å£°ææåºï¼è¦ä¹éè¿ try catch è¿è¡æè·å¤çï¼å¦åä¸è½éè¿ç¼è¯ã\n\nå¸¸è§ Exceptionï¼\n\n * ClassNotFoundException - åºç¨ç¨åºè¯å¾å è½½ç±»æ¶ï¼æ¾ä¸å°ç¸åºçç±»ï¼æåºè¯¥å¼å¸¸ã\n * CloneNotSupportedException - å½è°ç¨ Object ç±»ä¸­ç clone æ¹æ³åéå¯¹è±¡ï¼ä½è¯¥å¯¹è±¡çç±»æ æ³å®ç° Cloneable æ¥å£æ¶ï¼æåºè¯¥å¼å¸¸ã\n * IllegalAccessException - æç»è®¿é®ä¸ä¸ªç±»çæ¶åï¼æåºè¯¥å¼å¸¸ã\n * InstantiationException - å½è¯å¾ä½¿ç¨ Class ç±»ä¸­ç newInstance æ¹æ³åå»ºä¸ä¸ªç±»çå®ä¾ï¼èæå®çç±»å¯¹è±¡å ä¸ºæ¯ä¸ä¸ªæ¥å£ææ¯ä¸ä¸ªæ½è±¡ç±»èæ æ³å®ä¾åæ¶ï¼æåºè¯¥å¼å¸¸ã\n * InterruptedException - ä¸ä¸ªçº¿ç¨è¢«å¦ä¸ä¸ªçº¿ç¨ä¸­æ­ï¼æåºè¯¥å¼å¸¸ã\n * NoSuchFieldException - è¯·æ±çåéä¸å­å¨ã\n * NoSuchMethodException - è¯·æ±çæ¹æ³ä¸å­å¨ã\n\nç¤ºä¾ï¼\n\npublic class ExceptionDemo {\n    public static void main(String[] args) {\n        Method method = String.class.getMethod("toString", int.class);\n    }\n};\n\n\nè¯å¾ç¼è¯è¿è¡æ¶ä¼æ¥éï¼\n\nError:(7, 47) java: æªæ¥åçå¼å¸¸éè¯¯java.lang.NoSuchMethodException; å¿é¡»å¯¹å¶è¿è¡æè·æå£°æä»¥ä¾¿æåº\n\n\n\n# RuntimeException\n\nRuntimeException æ¯ Exception çä¸ä¸ªå­ç±»ãRuntimeException æ¯é£äºå¯è½å¨ Java èææºæ­£å¸¸è¿è¡æé´æåºçå¼å¸¸çè¶ç±»ã\n\n**ç¼è¯å¨ä¸ä¼æ£æ¥ RuntimeException å¼å¸¸ã**å½ç¨åºä¸­å¯è½åºç°è¿ç±»å¼å¸¸æ¶ï¼åè¥æ¢æ²¡æéè¿ throws å£°ææåºå®ï¼ä¹æ²¡æç¨ try catch è¯­å¥æè·å®ï¼ç¨åºè¿æ¯ä¼ç¼è¯éè¿ã\n\nç¤ºä¾ï¼\n\npublic class RuntimeExceptionDemo {\n    public static void main(String[] args) {\n        // æ­¤å¤äº§çäºå¼å¸¸\n        int result = 10 / 0;\n        System.out.println("ä¸¤ä¸ªæ°å­ç¸é¤çç»æï¼" + result);\n        System.out.println("----------------------------");\n    }\n};\n\n\nè¿è¡æ¶è¾åºï¼\n\nException in thread "main" java.lang.ArithmeticException: / by zero\n\tat io.github.dunwu.javacore.exception.RumtimeExceptionDemo01.main(RumtimeExceptionDemo01.java:6)\n\n\nå¸¸è§ RuntimeExceptionï¼\n\n * ArrayIndexOutOfBoundsException - ç¨éæ³ç´¢å¼è®¿é®æ°ç»æ¶æåºçå¼å¸¸ãå¦æç´¢å¼ä¸ºè´æå¤§äºç­äºæ°ç»å¤§å°ï¼åè¯¥ç´¢å¼ä¸ºéæ³ç´¢å¼ã\n * ArrayStoreException - è¯å¾å°éè¯¯ç±»åçå¯¹è±¡å­å¨å°ä¸ä¸ªå¯¹è±¡æ°ç»æ¶æåºçå¼å¸¸ã\n * ClassCastException - å½è¯å¾å°å¯¹è±¡å¼ºå¶è½¬æ¢ä¸ºä¸æ¯å®ä¾çå­ç±»æ¶ï¼æåºè¯¥å¼å¸¸ã\n * IllegalArgumentException - æåºçå¼å¸¸è¡¨æåæ¹æ³ä¼ éäºä¸ä¸ªä¸åæ³æä¸æ­£ç¡®çåæ°ã\n * IllegalMonitorStateException - æåºçå¼å¸¸è¡¨ææä¸çº¿ç¨å·²ç»è¯å¾ç­å¾å¯¹è±¡ççè§å¨ï¼æèè¯å¾éç¥å¶ä»æ­£å¨ç­å¾å¯¹è±¡ççè§å¨èæ¬èº«æ²¡ææå®çè§å¨ççº¿ç¨ã\n * IllegalStateException - å¨éæ³æä¸éå½çæ¶é´è°ç¨æ¹æ³æ¶äº§ççä¿¡å·ãæ¢å¥è¯è¯´ï¼å³ Java ç¯å¢æ Java åºç¨ç¨åºæ²¡æå¤äºè¯·æ±æä½æè¦æ±çéå½ç¶æä¸ã\n * IllegalThreadStateException - çº¿ç¨æ²¡æå¤äºè¯·æ±æä½æè¦æ±çéå½ç¶ææ¶æåºçå¼å¸¸ã\n * IndexOutOfBoundsException - æç¤ºææåºç´¢å¼ï¼ä¾å¦å¯¹æ°ç»ãå­ç¬¦ä¸²æåéçæåºï¼è¶åºèå´æ¶æåºã\n * NegativeArraySizeException - å¦æåºç¨ç¨åºè¯å¾åå»ºå¤§å°ä¸ºè´çæ°ç»ï¼åæåºè¯¥å¼å¸¸ã\n * NullPointerException - å½åºç¨ç¨åºè¯å¾å¨éè¦å¯¹è±¡çå°æ¹ä½¿ç¨ null æ¶ï¼æåºè¯¥å¼å¸¸\n * NumberFormatException - å½åºç¨ç¨åºè¯å¾å°å­ç¬¦ä¸²è½¬æ¢æä¸ç§æ°å¼ç±»åï¼ä½è¯¥å­ç¬¦ä¸²ä¸è½è½¬æ¢ä¸ºéå½æ ¼å¼æ¶ï¼æåºè¯¥å¼å¸¸ã\n * SecurityException - ç±å®å¨ç®¡çå¨æåºçå¼å¸¸ï¼æç¤ºå­å¨å®å¨ä¾µç¯ã\n * StringIndexOutOfBoundsException - æ­¤å¼å¸¸ç± String æ¹æ³æåºï¼æç¤ºç´¢å¼æèä¸ºè´ï¼æèè¶åºå­ç¬¦ä¸²çå¤§å°ã\n * UnsupportedOperationException - å½ä¸æ¯æè¯·æ±çæä½æ¶ï¼æåºè¯¥å¼å¸¸ã\n\n\n# èªå®ä¹å¼å¸¸\n\n\n\nèªå®ä¹ä¸ä¸ªå¼å¸¸ç±»ï¼åªéè¦ç»§æ¿ Exception æ RuntimeException å³å¯ã\n\nç¤ºä¾ï¼\n\npublic class MyExceptionDemo {\n    public static void main(String[] args) {\n        throw new MyException("èªå®ä¹å¼å¸¸");\n    }\n\n    static class MyException extends RuntimeException {\n        public MyException(String message) {\n            super(message);\n        }\n    }\n}\n\n\nè¾åºï¼\n\nException in thread "main" io.github.dunwu.javacore.exception.MyExceptionDemo$MyException: èªå®ä¹å¼å¸¸\n\tat io.github.dunwu.javacore.exception.MyExceptionDemo.main(MyExceptionDemo.java:9)\n\n\n\n# æåºå¼å¸¸\n\nå¦ææ³å¨ç¨åºä¸­æç¡®å°æåºå¼å¸¸ï¼éè¦ç¨å° throw å throws ã\n\nå¦æä¸ä¸ªæ¹æ³æ²¡ææè·ä¸ä¸ªæ£æ¥æ§å¼å¸¸ï¼é£ä¹è¯¥æ¹æ³å¿é¡»ä½¿ç¨ throws å³é®å­æ¥å£°æãthrows å³é®å­æ¾å¨æ¹æ³ç­¾åçå°¾é¨ã\n\nthrow ç¤ºä¾ï¼\n\npublic class ThrowDemo {\n    public static void f() {\n        try {\n            throw new RuntimeException("æåºä¸ä¸ªå¼å¸¸");\n        } catch (Exception e) {\n            System.out.println(e);\n        }\n    }\n\n    public static void main(String[] args) {\n        f();\n    }\n};\n\n\nè¾åºï¼\n\njava.lang.RuntimeException: æåºä¸ä¸ªå¼å¸¸\n\n\nä¹å¯ä»¥ä½¿ç¨ throw å³é®å­æåºä¸ä¸ªå¼å¸¸ï¼æ è®ºå®æ¯æ°å®ä¾åçè¿æ¯åæè·å°çã\n\nthrows ç¤ºä¾ï¼\n\npublic class ThrowsDemo {\n    public static void f1() throws NoSuchMethodException, NoSuchFieldException {\n        Field field = Integer.class.getDeclaredField("digits");\n        if (field != null) {\n            System.out.println("åå°è·å digits æ¹æ³æå");\n        }\n        Method method = String.class.getMethod("toString", int.class);\n        if (method != null) {\n            System.out.println("åå°è·å toString æ¹æ³æå");\n        }\n    }\n\n    public static void f2() {\n        try {\n            // è°ç¨ f1 å¤ï¼å¦æä¸ç¨ try catch ï¼ç¼è¯æ¶ä¼æ¥é\n            f1();\n        } catch (NoSuchMethodException e) {\n            e.printStackTrace();\n        } catch (NoSuchFieldException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void main(String[] args) {\n        f2();\n    }\n};\n\n\nè¾åºï¼\n\nåå°è·å digits æ¹æ³æå\njava.lang.NoSuchMethodException: java.lang.String.toString(int)\n\tat java.lang.Class.getMethod(Class.java:1786)\n\tat io.github.dunwu.javacore.exception.ThrowsDemo.f1(ThrowsDemo.java:12)\n\tat io.github.dunwu.javacore.exception.ThrowsDemo.f2(ThrowsDemo.java:21)\n\tat io.github.dunwu.javacore.exception.ThrowsDemo.main(ThrowsDemo.java:30)\n\n\nthrow å throws çåºå«ï¼\n\n * throws ä½¿ç¨å¨å½æ°ä¸ï¼throw ä½¿ç¨å¨å½æ°åã\n * throws åé¢è·å¼å¸¸ç±»ï¼å¯ä»¥è·å¤ä¸ªï¼ç¨éå·åºå«ï¼throw åé¢è·çæ¯å¼å¸¸å¯¹è±¡ã\n\n\n# æè·å¼å¸¸\n\nä½¿ç¨ try å catch å³é®å­å¯ä»¥æè·å¼å¸¸ãtry catch ä»£ç åæ¾å¨å¼å¸¸å¯è½åççå°æ¹ã\n\nå®çè¯­æ³å½¢å¼å¦ä¸ï¼\n\ntry {\n    // å¯è½ä¼åçå¼å¸¸çä»£ç å\n} catch (Exception e1) {\n    // æè·å¹¶å¤çtryæåºçå¼å¸¸ç±»åException\n} catch (Exception2 e2) {\n    // æè·å¹¶å¤çtryæåºçå¼å¸¸ç±»åException2\n} finally {\n    // æ è®ºæ¯å¦åçå¼å¸¸ï¼é½å°æ§è¡çä»£ç å\n}\n\n\næ­¤å¤ï¼JDK7 ä»¥åï¼catch å¤ç§å¼å¸¸æ¶ï¼ä¹å¯ä»¥åä¸é¢è¿æ ·ç®åä»£ç ï¼\n\ntry {\n    // å¯è½ä¼åçå¼å¸¸çä»£ç å\n} catch (Exception | Exception2 e) {\n    // æè·å¹¶å¤çtryæåºçå¼å¸¸ç±»å\n} finally {\n    // æ è®ºæ¯å¦åçå¼å¸¸ï¼é½å°æ§è¡çä»£ç å\n}\n\n\n * try - try è¯­å¥ç¨äºçå¬ãå°è¦è¢«çå¬çä»£ç (å¯è½æåºå¼å¸¸çä»£ç )æ¾å¨ try è¯­å¥åä¹åï¼å½ try è¯­å¥åååçå¼å¸¸æ¶ï¼å¼å¸¸å°±è¢«æåºã\n * catch - catch è¯­å¥åå«è¦æè·å¼å¸¸ç±»åçå£°æãå½ä¿æ¤ä»£ç åä¸­åçä¸ä¸ªå¼å¸¸æ¶ï¼try åé¢ç catch åå°±ä¼è¢«æ£æ¥ã\n * finally - finally è¯­å¥åæ»æ¯ä¼è¢«æ§è¡ï¼æ è®ºæ¯å¦åºç°å¼å¸¸ãtry catch è¯­å¥åä¸ä¸å®éè¦finally è¯­å¥ãfinally å¸¸ç¨äºè¿æ ·çåºæ¯ï¼ç±äºfinally è¯­å¥åæ»æ¯ä¼è¢«æ§è¡ï¼æä»¥é£äºå¨ try ä»£ç åä¸­æå¼çï¼å¹¶ä¸å¿é¡»åæ¶çç©çèµæº(å¦æ°æ®åºè¿æ¥ãç½ç»è¿æ¥åæä»¶)ï¼ä¸è¬ä¼æ¾å¨finally è¯­å¥åä¸­éæ¾èµæºã\n * tryãcatchãfinally ä¸ä¸ªä»£ç åä¸­çå±é¨åéä¸å¯å±äº«ä½¿ç¨ã\n * catch åå°è¯æè·å¼å¸¸æ¶ï¼æ¯æç§ catch åçå£°æé¡ºåºä»ä¸å¾ä¸å¯»æ¾çï¼ä¸æ¦å¹éï¼å°±ä¸ä¼ååä¸æ§è¡ãå æ­¤ï¼å¦æåä¸ä¸ª try åä¸çå¤ä¸ª catch å¼å¸¸ç±»åæç¶å­å³ç³»ï¼åºè¯¥å°å­ç±»å¼å¸¸æ¾å¨åé¢ï¼ç¶ç±»å¼å¸¸æ¾å¨åé¢ã\n\nç¤ºä¾ï¼\n\npublic class TryCatchFinallyDemo {\n    public static void main(String[] args) {\n        try {\n            // æ­¤å¤äº§çäºå¼å¸¸\n            int temp = 10 / 0;\n            System.out.println("ä¸¤ä¸ªæ°å­ç¸é¤çç»æï¼" + temp);\n            System.out.println("----------------------------");\n        } catch (ArithmeticException e) {\n            System.out.println("åºç°å¼å¸¸äºï¼" + e);\n        } finally {\n            System.out.println("ä¸ç®¡æ¯å¦åºç°å¼å¸¸ï¼é½æ§è¡æ­¤ä»£ç ");\n        }\n    }\n};\n\n\nè¿è¡æ¶è¾åºï¼\n\nåºç°å¼å¸¸äºï¼java.lang.ArithmeticException: / by zero\nä¸ç®¡æ¯å¦åºç°å¼å¸¸ï¼é½æ§è¡æ­¤ä»£ç \n\n\n\n# å¼å¸¸é¾\n\nå¼å¸¸é¾æ¯ä»¥ä¸ä¸ªå¼å¸¸å¯¹è±¡ä¸ºåæ°æé æ°çå¼å¸¸å¯¹è±¡ï¼æ°çå¼å¸¸å¯¹è±¡å°åå«ååå¼å¸¸çä¿¡æ¯ã\n\néè¿ä½¿ç¨å¼å¸¸é¾ï¼æä»¬å¯ä»¥æé«ä»£ç çå¯çè§£æ§ãç³»ç»çå¯ç»´æ¤æ§ååå¥½æ§ã\n\næä»¬æä¸¤ç§æ¹å¼å¤çå¼å¸¸ï¼ä¸æ¯ throws æåºäº¤ç»ä¸çº§å¤çï¼äºæ¯ tryâ¦catch åå·ä½å¤çãtryâ¦catch ç catch åæä»¬å¯ä»¥ä¸éè¦åä»»ä½å¤çï¼ä»ä»åªç¨ throw è¿ä¸ªå³é®å­å°æä»¬å°è£å¼å¸¸ä¿¡æ¯ä¸»å¨æåºæ¥ãç¶åå¨éè¿å³é®å­ throws ç»§ç»­æåºè¯¥æ¹æ³å¼å¸¸ãå®çä¸å±ä¹å¯ä»¥åè¿æ ·çå¤çï¼ä»¥æ­¤ç±»æ¨å°±ä¼äº§çä¸æ¡ç±å¼å¸¸ææçå¼å¸¸é¾ã\n\nãç¤ºä¾ã\n\npublic class ExceptionChainDemo {\n    static class MyException1 extends Exception {\n        public MyException1(String message) {\n            super(message);\n        }\n    }\n\n    static class MyException2 extends Exception {\n        public MyException2(String message, Throwable cause) {\n            super(message, cause);\n        }\n    }\n\n    public static void f1() throws MyException1 {\n        throw new MyException1("åºç° MyException1");\n    }\n\n    public static void f2() throws MyException2 {\n        try {\n            f1();\n        } catch (MyException1 e) {\n            throw new MyException2("åºç° MyException2", e);\n        }\n    }\n\n    public static void main(String[] args) throws MyException2 {\n        f2();\n    }\n}\n\n\nè¾åºï¼\n\nException in thread "main" io.github.dunwu.javacore.exception.ExceptionChainDemo$MyException2: åºç° MyException2\n\tat io.github.dunwu.javacore.exception.ExceptionChainDemo.f2(ExceptionChainDemo.java:29)\n\tat io.github.dunwu.javacore.exception.ExceptionChainDemo.main(ExceptionChainDemo.java:34)\nCaused by: io.github.dunwu.javacore.exception.ExceptionChainDemo$MyException1: åºç° MyException1\n\tat io.github.dunwu.javacore.exception.ExceptionChainDemo.f1(ExceptionChainDemo.java:22)\n\tat io.github.dunwu.javacore.exception.ExceptionChainDemo.f2(ExceptionChainDemo.java:27)\n\t... 1 more\n\n\n> æ©å±éè¯»ï¼https://juejin.im/post/5b6d61e55188251b38129f9a#heading-10\n> \n> è¿ç¯æç« ä¸­å¯¹äºå¼å¸¸é¾è®²è§£æ¯è¾è¯¦ç»ã\n\n\n# å¼å¸¸æ³¨æäºé¡¹\n\n\n# finally è¦çå¼å¸¸\n\nJava å¼å¸¸å¤çä¸­ finally ä¸­ç return ä¼è¦ç catch ä»£ç åä¸­ç return è¯­å¥å throw è¯­å¥ï¼æä»¥ Java ä¸å»ºè®®å¨ finally ä¸­ä½¿ç¨ return è¯­å¥ã\n\næ­¤å¤ finally ä¸­ç throw è¯­å¥ä¹ä¼è¦ç catch ä»£ç åä¸­ç return è¯­å¥å throw è¯­å¥ã\n\nç¤ºä¾ï¼\n\npublic class FinallyOverrideExceptionDemo {\n    static void f() throws Exception {\n        try {\n            throw new Exception("A");\n        } catch (Exception e) {\n            throw new Exception("B");\n        } finally {\n            throw new Exception("C");\n        }\n    }\n\n    public static void main(String[] args) {\n        try {\n            f();\n        } catch (Exception e) {\n            System.out.println(e.getMessage());\n        }\n    }\n}\n\n\nè¾åºï¼C\n\n\n# è¦çæåºå¼å¸¸çæ¹æ³\n\nå½å­ç±»éåç¶ç±»å¸¦æ throws å£°æçå½æ°æ¶ï¼å¶ throws å£°æçå¼å¸¸å¿é¡»å¨ç¶ç±»å¼å¸¸çå¯æ§èå´åââç¨äºå¤çç¶ç±»ç throws æ¹æ³çå¼å¸¸å¤çå¨ï¼å¿é¡»ä¹éç¨äºå­ç±»çè¿ä¸ªå¸¦ throws æ¹æ³ ãè¿æ¯ä¸ºäºæ¯æå¤æã\n\nç¤ºä¾ï¼\n\npublic class ExceptionOverrideDemo {\n    static class Father {\n        public void start() throws IOException {\n            throw new IOException();\n        }\n    }\n\n    static class Son extends Father {\n        @Override\n        public void start() throws SQLException {\n            throw new SQLException();\n        }\n    }\n\n    public static void main(String[] args) {\n        Father obj1 = new Father();\n        Father obj2 = new Son();\n        try {\n            obj1.start();\n            obj2.start();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\n> ä¸é¢çç¤ºä¾ç¼è¯æ¶ä¼æ¥éï¼åå å¨äºï¼\n> \n> å ä¸º Son ç±»æåºå¼å¸¸çå®è´¨æ¯ SQLExceptionï¼è IOException æ æ³å¤çå®ãé£ä¹è¿éç try catch å°±ä¸è½å¤ç Son ä¸­çå¼å¸¸äºãå¤æå°±ä¸è½å®ç°äºã\n\n\n# å¼å¸¸åçº¿ç¨\n\nå¦æ Java ç¨åºåªæä¸ä¸ªçº¿ç¨ï¼é£ä¹æ²¡æè¢«ä»»ä½ä»£ç å¤ççå¼å¸¸ä¼å¯¼è´ç¨åºç»æ­¢ãå¦æ Java ç¨åºæ¯å¤çº¿ç¨çï¼é£ä¹æ²¡æè¢«ä»»ä½ä»£ç å¤ççå¼å¸¸ä»ä»ä¼å¯¼è´å¼å¸¸æå¨ççº¿ç¨ç»æã\n\n\n# æä½³å®è·µ\n\n * å¯¹å¯æ¢å¤çæåµä½¿ç¨æ£æ¥æ§å¼å¸¸ï¼Exceptionï¼ï¼å¯¹ç¼ç¨éè¯¯ä½¿ç¨è¿è¡æ¶å¼å¸¸ï¼RuntimeExceptionï¼ã\n * ä¼åä½¿ç¨ Java æ åçå¼å¸¸ã\n * æåºä¸æ½è±¡ç¸å¯¹åºçå¼å¸¸ã\n * å¨ç»èæ¶æ¯ä¸­åå«è½æè·å¤±è´¥çä¿¡æ¯ã\n * å°½å¯è½åå° try ä»£ç åçå¤§å°ã\n * å°½éç¼©å°å¼å¸¸èå´ãä¾å¦ï¼å¦ææç¥å°è¯æè·çæ¯ä¸ä¸ª ArithmeticExceptionï¼å°±åºè¯¥ catch ArithmeticExceptionï¼èä¸æ¯ catch èå´è¾å¤§ç RuntimeExceptionï¼çè³æ¯ Exceptionã\n * å°½éä¸è¦å¨ finally åæåºå¼å¸¸æèè¿åå¼ã\n * ä¸è¦å¿½ç¥å¼å¸¸ï¼ä¸æ¦æè·å¼å¸¸ï¼å°±åºè¯¥å¤çï¼èéä¸¢å¼ã\n * å¼å¸¸å¤çæçå¾ä½ï¼æä»¥ä¸è¦ç¨å¼å¸¸è¿è¡ä¸å¡é»è¾å¤çã\n * åç±»å¼å¸¸å¿é¡»è¦æåç¬çæ¥å¿è®°å½ï¼å°å¼å¸¸åçº§ï¼åç±»ç®¡çï¼å ä¸ºæçæ¶åä»ä»æ³ç»ç¬¬ä¸æ¹è¿ç»´çå°é»è¾å¼å¸¸ï¼èä¸æ¯æ´ç»èçä¿¡æ¯ã\n * å¦ä½å¯¹å¼å¸¸è¿è¡åç±»ï¼\n   * é»è¾å¼å¸¸ï¼è¿ç±»å¼å¸¸ç¨äºæè¿°ä¸å¡æ æ³æç§é¢æçæåµå¤çä¸å»ï¼å±äºç¨æ·å¶é çæå¤ã\n   * ä»£ç éè¯¯ï¼è¿ç±»å¼å¸¸ç¨äºæè¿°å¼åçä»£ç éè¯¯ï¼ä¾å¦ NPEï¼ILLARGï¼é½å±äºç¨åºåå¶é ç BUGã\n   * ä¸æå¼å¸¸ï¼å¤ç¨äºç¹å®ä¸å¡åºæ¯ï¼ç¨äºæè¿°æå®ä½ä¸åºç°æå¤æåµæ æ³é¢åå¤çã\n\n> æ©å±éè¯»ï¼\n> \n>  * Effective java ä¸­æç ä¹ ç¬¬ä¹ç«  å¼å¸¸\n>  * ä¼éçå¤çä½ ç Java å¼å¸¸\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * Effective java ä¸­æç ä¹ ç¬¬ä¹ç«  å¼å¸¸\n * ä¼éçå¤çä½ ç Java å¼å¸¸\n * https://juejin.im/post/5b6d61e55188251b38129f9a#heading-17\n * https://www.cnblogs.com/skywang12345/p/3544168.html\n * http://www.importnew.com/26613.html',normalizedContent:'# æ·±å¥çè§£ java å¼å¸¸\n\n\n\n\n# å¼å¸¸æ¡æ¶\n\n\n# throwable\n\n**throwable æ¯ java è¯­è¨ä¸­ææéè¯¯ï¼errorï¼åå¼å¸¸ï¼exceptionï¼çè¶ç±»ã**å¨ java ä¸­åªæ throwable ç±»åçå®ä¾æå¯ä»¥è¢«æåºï¼throwï¼æèæè·ï¼catchï¼ï¼å®æ¯å¼å¸¸å¤çæºå¶çåºæ¬ç»æç±»åã\n\nthrowable åå«äºå¶çº¿ç¨åå»ºæ¶çº¿ç¨æ§è¡å æ çå¿«ç§ï¼å®æä¾äº printstacktrace() ç­æ¥å£ç¨äºè·åå æ è·è¸ªæ°æ®ç­ä¿¡æ¯ã\n\nä¸»è¦æ¹æ³ï¼\n\n * fillinstacktrace - ç¨å½åçè°ç¨æ å±æ¬¡å¡«å throwable å¯¹è±¡æ å±æ¬¡ï¼æ·»å å°æ å±æ¬¡ä»»ä½ååä¿¡æ¯ä¸­ã\n * getmessage - è¿åå³äºåççå¼å¸¸çè¯¦ç»ä¿¡æ¯ãè¿ä¸ªæ¶æ¯å¨ throwable ç±»çæé å½æ°ä¸­åå§åäºã\n * getcause - è¿åä¸ä¸ª throwable å¯¹è±¡ä»£è¡¨å¼å¸¸åå ã\n * getstacktrace - è¿åä¸ä¸ªåå«å æ å±æ¬¡çæ°ç»ãä¸æ ä¸º 0 çåç´ ä»£è¡¨æ é¡¶ï¼æåä¸ä¸ªåç´ ä»£è¡¨æ¹æ³è°ç¨å æ çæ åºã\n * printstacktrace - æå° tostring() ç»æåæ å±æ¬¡å° system.errï¼å³éè¯¯è¾åºæµã\n * tostring - ä½¿ç¨ getmessage çç»æè¿åä»£è¡¨ throwable å¯¹è±¡çå­ç¬¦ä¸²ã\n\n\n# error\n\nerror æ¯ throwable çä¸ä¸ªå­ç±»ãerror è¡¨ç¤ºæ­£å¸¸æåµä¸ï¼ä¸å¤§å¯è½åºç°çä¸¥éé®é¢ãç¼è¯å¨ä¸ä¼æ£æ¥ errorãç»å¤§é¨åç error é½ä¼å¯¼è´ç¨åºï¼æ¯å¦ jvm èªèº«ï¼å¤äºéæ­£å¸¸çãä¸å¯æ¢å¤ç¶æãæ¢ç¶æ¯éæ­£å¸¸æåµï¼æä»¥ä¸ä¾¿äºä¹ä¸éè¦æè·ï¼å¸¸è§çæ¯å¦ outofmemoryerror ä¹ç±»ï¼é½æ¯ error çå­ç±»ã\n\nå¸¸è§ errorï¼\n\n * assertionerror - æ­è¨éè¯¯ã\n * virtualmachineerror - èææºéè¯¯ã\n * unsupportedclassversionerror - java ç±»çæ¬éè¯¯ã\n * stackoverflowerror - æ æº¢åºéè¯¯ã\n * outofmemoryerror - åå­æº¢åºéè¯¯ã\n\n\n# exception\n\nexception æ¯ throwable çä¸ä¸ªå­ç±»ã**exception è¡¨ç¤ºåççåºç¨ç¨åºå¯è½æ³è¦æè·çæ¡ä»¶ã**exception æ¯ç¨åºæ­£å¸¸è¿è¡ä¸­ï¼å¯ä»¥é¢æçæå¤æåµï¼å¯è½å¹¶ä¸åºè¯¥è¢«æè·ï¼è¿è¡ç¸åºå¤çã\n\nexception ååä¸ºå¯æ£æ¥ï¼checkedï¼å¼å¸¸åä¸æ£æ¥ï¼uncheckedï¼å¼å¸¸ï¼å¯æ£æ¥å¼å¸¸å¨æºä»£ç éå¿é¡»æ¾å¼å°è¿è¡æè·å¤çï¼è¿æ¯ç¼è¯ææ£æ¥çä¸é¨åã\n\n**ç¼è¯å¨ä¼æ£æ¥ exception å¼å¸¸ã**æ­¤ç±»å¼å¸¸ï¼è¦ä¹éè¿ throws è¿è¡å£°ææåºï¼è¦ä¹éè¿ try catch è¿è¡æè·å¤çï¼å¦åä¸è½éè¿ç¼è¯ã\n\nå¸¸è§ exceptionï¼\n\n * classnotfoundexception - åºç¨ç¨åºè¯å¾å è½½ç±»æ¶ï¼æ¾ä¸å°ç¸åºçç±»ï¼æåºè¯¥å¼å¸¸ã\n * clonenotsupportedexception - å½è°ç¨ object ç±»ä¸­ç clone æ¹æ³åéå¯¹è±¡ï¼ä½è¯¥å¯¹è±¡çç±»æ æ³å®ç° cloneable æ¥å£æ¶ï¼æåºè¯¥å¼å¸¸ã\n * illegalaccessexception - æç»è®¿é®ä¸ä¸ªç±»çæ¶åï¼æåºè¯¥å¼å¸¸ã\n * instantiationexception - å½è¯å¾ä½¿ç¨ class ç±»ä¸­ç newinstance æ¹æ³åå»ºä¸ä¸ªç±»çå®ä¾ï¼èæå®çç±»å¯¹è±¡å ä¸ºæ¯ä¸ä¸ªæ¥å£ææ¯ä¸ä¸ªæ½è±¡ç±»èæ æ³å®ä¾åæ¶ï¼æåºè¯¥å¼å¸¸ã\n * interruptedexception - ä¸ä¸ªçº¿ç¨è¢«å¦ä¸ä¸ªçº¿ç¨ä¸­æ­ï¼æåºè¯¥å¼å¸¸ã\n * nosuchfieldexception - è¯·æ±çåéä¸å­å¨ã\n * nosuchmethodexception - è¯·æ±çæ¹æ³ä¸å­å¨ã\n\nç¤ºä¾ï¼\n\npublic class exceptiondemo {\n    public static void main(string[] args) {\n        method method = string.class.getmethod("tostring", int.class);\n    }\n};\n\n\nè¯å¾ç¼è¯è¿è¡æ¶ä¼æ¥éï¼\n\nerror:(7, 47) java: æªæ¥åçå¼å¸¸éè¯¯java.lang.nosuchmethodexception; å¿é¡»å¯¹å¶è¿è¡æè·æå£°æä»¥ä¾¿æåº\n\n\n\n# runtimeexception\n\nruntimeexception æ¯ exception çä¸ä¸ªå­ç±»ãruntimeexception æ¯é£äºå¯è½å¨ java èææºæ­£å¸¸è¿è¡æé´æåºçå¼å¸¸çè¶ç±»ã\n\n**ç¼è¯å¨ä¸ä¼æ£æ¥ runtimeexception å¼å¸¸ã**å½ç¨åºä¸­å¯è½åºç°è¿ç±»å¼å¸¸æ¶ï¼åè¥æ¢æ²¡æéè¿ throws å£°ææåºå®ï¼ä¹æ²¡æç¨ try catch è¯­å¥æè·å®ï¼ç¨åºè¿æ¯ä¼ç¼è¯éè¿ã\n\nç¤ºä¾ï¼\n\npublic class runtimeexceptiondemo {\n    public static void main(string[] args) {\n        // æ­¤å¤äº§çäºå¼å¸¸\n        int result = 10 / 0;\n        system.out.println("ä¸¤ä¸ªæ°å­ç¸é¤çç»æï¼" + result);\n        system.out.println("----------------------------");\n    }\n};\n\n\nè¿è¡æ¶è¾åºï¼\n\nexception in thread "main" java.lang.arithmeticexception: / by zero\n\tat io.github.dunwu.javacore.exception.rumtimeexceptiondemo01.main(rumtimeexceptiondemo01.java:6)\n\n\nå¸¸è§ runtimeexceptionï¼\n\n * arrayindexoutofboundsexception - ç¨éæ³ç´¢å¼è®¿é®æ°ç»æ¶æåºçå¼å¸¸ãå¦æç´¢å¼ä¸ºè´æå¤§äºç­äºæ°ç»å¤§å°ï¼åè¯¥ç´¢å¼ä¸ºéæ³ç´¢å¼ã\n * arraystoreexception - è¯å¾å°éè¯¯ç±»åçå¯¹è±¡å­å¨å°ä¸ä¸ªå¯¹è±¡æ°ç»æ¶æåºçå¼å¸¸ã\n * classcastexception - å½è¯å¾å°å¯¹è±¡å¼ºå¶è½¬æ¢ä¸ºä¸æ¯å®ä¾çå­ç±»æ¶ï¼æåºè¯¥å¼å¸¸ã\n * illegalargumentexception - æåºçå¼å¸¸è¡¨æåæ¹æ³ä¼ éäºä¸ä¸ªä¸åæ³æä¸æ­£ç¡®çåæ°ã\n * illegalmonitorstateexception - æåºçå¼å¸¸è¡¨ææä¸çº¿ç¨å·²ç»è¯å¾ç­å¾å¯¹è±¡ççè§å¨ï¼æèè¯å¾éç¥å¶ä»æ­£å¨ç­å¾å¯¹è±¡ççè§å¨èæ¬èº«æ²¡ææå®çè§å¨ççº¿ç¨ã\n * illegalstateexception - å¨éæ³æä¸éå½çæ¶é´è°ç¨æ¹æ³æ¶äº§ççä¿¡å·ãæ¢å¥è¯è¯´ï¼å³ java ç¯å¢æ java åºç¨ç¨åºæ²¡æå¤äºè¯·æ±æä½æè¦æ±çéå½ç¶æä¸ã\n * illegalthreadstateexception - çº¿ç¨æ²¡æå¤äºè¯·æ±æä½æè¦æ±çéå½ç¶ææ¶æåºçå¼å¸¸ã\n * indexoutofboundsexception - æç¤ºææåºç´¢å¼ï¼ä¾å¦å¯¹æ°ç»ãå­ç¬¦ä¸²æåéçæåºï¼è¶åºèå´æ¶æåºã\n * negativearraysizeexception - å¦æåºç¨ç¨åºè¯å¾åå»ºå¤§å°ä¸ºè´çæ°ç»ï¼åæåºè¯¥å¼å¸¸ã\n * nullpointerexception - å½åºç¨ç¨åºè¯å¾å¨éè¦å¯¹è±¡çå°æ¹ä½¿ç¨ null æ¶ï¼æåºè¯¥å¼å¸¸\n * numberformatexception - å½åºç¨ç¨åºè¯å¾å°å­ç¬¦ä¸²è½¬æ¢æä¸ç§æ°å¼ç±»åï¼ä½è¯¥å­ç¬¦ä¸²ä¸è½è½¬æ¢ä¸ºéå½æ ¼å¼æ¶ï¼æåºè¯¥å¼å¸¸ã\n * securityexception - ç±å®å¨ç®¡çå¨æåºçå¼å¸¸ï¼æç¤ºå­å¨å®å¨ä¾µç¯ã\n * stringindexoutofboundsexception - æ­¤å¼å¸¸ç± string æ¹æ³æåºï¼æç¤ºç´¢å¼æèä¸ºè´ï¼æèè¶åºå­ç¬¦ä¸²çå¤§å°ã\n * unsupportedoperationexception - å½ä¸æ¯æè¯·æ±çæä½æ¶ï¼æåºè¯¥å¼å¸¸ã\n\n\n# èªå®ä¹å¼å¸¸\n\n\n\nèªå®ä¹ä¸ä¸ªå¼å¸¸ç±»ï¼åªéè¦ç»§æ¿ exception æ runtimeexception å³å¯ã\n\nç¤ºä¾ï¼\n\npublic class myexceptiondemo {\n    public static void main(string[] args) {\n        throw new myexception("èªå®ä¹å¼å¸¸");\n    }\n\n    static class myexception extends runtimeexception {\n        public myexception(string message) {\n            super(message);\n        }\n    }\n}\n\n\nè¾åºï¼\n\nexception in thread "main" io.github.dunwu.javacore.exception.myexceptiondemo$myexception: èªå®ä¹å¼å¸¸\n\tat io.github.dunwu.javacore.exception.myexceptiondemo.main(myexceptiondemo.java:9)\n\n\n\n# æåºå¼å¸¸\n\nå¦ææ³å¨ç¨åºä¸­æç¡®å°æåºå¼å¸¸ï¼éè¦ç¨å° throw å throws ã\n\nå¦æä¸ä¸ªæ¹æ³æ²¡ææè·ä¸ä¸ªæ£æ¥æ§å¼å¸¸ï¼é£ä¹è¯¥æ¹æ³å¿é¡»ä½¿ç¨ throws å³é®å­æ¥å£°æãthrows å³é®å­æ¾å¨æ¹æ³ç­¾åçå°¾é¨ã\n\nthrow ç¤ºä¾ï¼\n\npublic class throwdemo {\n    public static void f() {\n        try {\n            throw new runtimeexception("æåºä¸ä¸ªå¼å¸¸");\n        } catch (exception e) {\n            system.out.println(e);\n        }\n    }\n\n    public static void main(string[] args) {\n        f();\n    }\n};\n\n\nè¾åºï¼\n\njava.lang.runtimeexception: æåºä¸ä¸ªå¼å¸¸\n\n\nä¹å¯ä»¥ä½¿ç¨ throw å³é®å­æåºä¸ä¸ªå¼å¸¸ï¼æ è®ºå®æ¯æ°å®ä¾åçè¿æ¯åæè·å°çã\n\nthrows ç¤ºä¾ï¼\n\npublic class throwsdemo {\n    public static void f1() throws nosuchmethodexception, nosuchfieldexception {\n        field field = integer.class.getdeclaredfield("digits");\n        if (field != null) {\n            system.out.println("åå°è·å digits æ¹æ³æå");\n        }\n        method method = string.class.getmethod("tostring", int.class);\n        if (method != null) {\n            system.out.println("åå°è·å tostring æ¹æ³æå");\n        }\n    }\n\n    public static void f2() {\n        try {\n            // è°ç¨ f1 å¤ï¼å¦æä¸ç¨ try catch ï¼ç¼è¯æ¶ä¼æ¥é\n            f1();\n        } catch (nosuchmethodexception e) {\n            e.printstacktrace();\n        } catch (nosuchfieldexception e) {\n            e.printstacktrace();\n        }\n    }\n\n    public static void main(string[] args) {\n        f2();\n    }\n};\n\n\nè¾åºï¼\n\nåå°è·å digits æ¹æ³æå\njava.lang.nosuchmethodexception: java.lang.string.tostring(int)\n\tat java.lang.class.getmethod(class.java:1786)\n\tat io.github.dunwu.javacore.exception.throwsdemo.f1(throwsdemo.java:12)\n\tat io.github.dunwu.javacore.exception.throwsdemo.f2(throwsdemo.java:21)\n\tat io.github.dunwu.javacore.exception.throwsdemo.main(throwsdemo.java:30)\n\n\nthrow å throws çåºå«ï¼\n\n * throws ä½¿ç¨å¨å½æ°ä¸ï¼throw ä½¿ç¨å¨å½æ°åã\n * throws åé¢è·å¼å¸¸ç±»ï¼å¯ä»¥è·å¤ä¸ªï¼ç¨éå·åºå«ï¼throw åé¢è·çæ¯å¼å¸¸å¯¹è±¡ã\n\n\n# æè·å¼å¸¸\n\nä½¿ç¨ try å catch å³é®å­å¯ä»¥æè·å¼å¸¸ãtry catch ä»£ç åæ¾å¨å¼å¸¸å¯è½åççå°æ¹ã\n\nå®çè¯­æ³å½¢å¼å¦ä¸ï¼\n\ntry {\n    // å¯è½ä¼åçå¼å¸¸çä»£ç å\n} catch (exception e1) {\n    // æè·å¹¶å¤çtryæåºçå¼å¸¸ç±»åexception\n} catch (exception2 e2) {\n    // æè·å¹¶å¤çtryæåºçå¼å¸¸ç±»åexception2\n} finally {\n    // æ è®ºæ¯å¦åçå¼å¸¸ï¼é½å°æ§è¡çä»£ç å\n}\n\n\næ­¤å¤ï¼jdk7 ä»¥åï¼catch å¤ç§å¼å¸¸æ¶ï¼ä¹å¯ä»¥åä¸é¢è¿æ ·ç®åä»£ç ï¼\n\ntry {\n    // å¯è½ä¼åçå¼å¸¸çä»£ç å\n} catch (exception | exception2 e) {\n    // æè·å¹¶å¤çtryæåºçå¼å¸¸ç±»å\n} finally {\n    // æ è®ºæ¯å¦åçå¼å¸¸ï¼é½å°æ§è¡çä»£ç å\n}\n\n\n * try - try è¯­å¥ç¨äºçå¬ãå°è¦è¢«çå¬çä»£ç (å¯è½æåºå¼å¸¸çä»£ç )æ¾å¨ try è¯­å¥åä¹åï¼å½ try è¯­å¥åååçå¼å¸¸æ¶ï¼å¼å¸¸å°±è¢«æåºã\n * catch - catch è¯­å¥åå«è¦æè·å¼å¸¸ç±»åçå£°æãå½ä¿æ¤ä»£ç åä¸­åçä¸ä¸ªå¼å¸¸æ¶ï¼try åé¢ç catch åå°±ä¼è¢«æ£æ¥ã\n * finally - finally è¯­å¥åæ»æ¯ä¼è¢«æ§è¡ï¼æ è®ºæ¯å¦åºç°å¼å¸¸ãtry catch è¯­å¥åä¸ä¸å®éè¦finally è¯­å¥ãfinally å¸¸ç¨äºè¿æ ·çåºæ¯ï¼ç±äºfinally è¯­å¥åæ»æ¯ä¼è¢«æ§è¡ï¼æä»¥é£äºå¨ try ä»£ç åä¸­æå¼çï¼å¹¶ä¸å¿é¡»åæ¶çç©çèµæº(å¦æ°æ®åºè¿æ¥ãç½ç»è¿æ¥åæä»¶)ï¼ä¸è¬ä¼æ¾å¨finally è¯­å¥åä¸­éæ¾èµæºã\n * tryãcatchãfinally ä¸ä¸ªä»£ç åä¸­çå±é¨åéä¸å¯å±äº«ä½¿ç¨ã\n * catch åå°è¯æè·å¼å¸¸æ¶ï¼æ¯æç§ catch åçå£°æé¡ºåºä»ä¸å¾ä¸å¯»æ¾çï¼ä¸æ¦å¹éï¼å°±ä¸ä¼ååä¸æ§è¡ãå æ­¤ï¼å¦æåä¸ä¸ª try åä¸çå¤ä¸ª catch å¼å¸¸ç±»åæç¶å­å³ç³»ï¼åºè¯¥å°å­ç±»å¼å¸¸æ¾å¨åé¢ï¼ç¶ç±»å¼å¸¸æ¾å¨åé¢ã\n\nç¤ºä¾ï¼\n\npublic class trycatchfinallydemo {\n    public static void main(string[] args) {\n        try {\n            // æ­¤å¤äº§çäºå¼å¸¸\n            int temp = 10 / 0;\n            system.out.println("ä¸¤ä¸ªæ°å­ç¸é¤çç»æï¼" + temp);\n            system.out.println("----------------------------");\n        } catch (arithmeticexception e) {\n            system.out.println("åºç°å¼å¸¸äºï¼" + e);\n        } finally {\n            system.out.println("ä¸ç®¡æ¯å¦åºç°å¼å¸¸ï¼é½æ§è¡æ­¤ä»£ç ");\n        }\n    }\n};\n\n\nè¿è¡æ¶è¾åºï¼\n\nåºç°å¼å¸¸äºï¼java.lang.arithmeticexception: / by zero\nä¸ç®¡æ¯å¦åºç°å¼å¸¸ï¼é½æ§è¡æ­¤ä»£ç \n\n\n\n# å¼å¸¸é¾\n\nå¼å¸¸é¾æ¯ä»¥ä¸ä¸ªå¼å¸¸å¯¹è±¡ä¸ºåæ°æé æ°çå¼å¸¸å¯¹è±¡ï¼æ°çå¼å¸¸å¯¹è±¡å°åå«ååå¼å¸¸çä¿¡æ¯ã\n\néè¿ä½¿ç¨å¼å¸¸é¾ï¼æä»¬å¯ä»¥æé«ä»£ç çå¯çè§£æ§ãç³»ç»çå¯ç»´æ¤æ§ååå¥½æ§ã\n\næä»¬æä¸¤ç§æ¹å¼å¤çå¼å¸¸ï¼ä¸æ¯ throws æåºäº¤ç»ä¸çº§å¤çï¼äºæ¯ tryâ¦catch åå·ä½å¤çãtryâ¦catch ç catch åæä»¬å¯ä»¥ä¸éè¦åä»»ä½å¤çï¼ä»ä»åªç¨ throw è¿ä¸ªå³é®å­å°æä»¬å°è£å¼å¸¸ä¿¡æ¯ä¸»å¨æåºæ¥ãç¶åå¨éè¿å³é®å­ throws ç»§ç»­æåºè¯¥æ¹æ³å¼å¸¸ãå®çä¸å±ä¹å¯ä»¥åè¿æ ·çå¤çï¼ä»¥æ­¤ç±»æ¨å°±ä¼äº§çä¸æ¡ç±å¼å¸¸ææçå¼å¸¸é¾ã\n\nãç¤ºä¾ã\n\npublic class exceptionchaindemo {\n    static class myexception1 extends exception {\n        public myexception1(string message) {\n            super(message);\n        }\n    }\n\n    static class myexception2 extends exception {\n        public myexception2(string message, throwable cause) {\n            super(message, cause);\n        }\n    }\n\n    public static void f1() throws myexception1 {\n        throw new myexception1("åºç° myexception1");\n    }\n\n    public static void f2() throws myexception2 {\n        try {\n            f1();\n        } catch (myexception1 e) {\n            throw new myexception2("åºç° myexception2", e);\n        }\n    }\n\n    public static void main(string[] args) throws myexception2 {\n        f2();\n    }\n}\n\n\nè¾åºï¼\n\nexception in thread "main" io.github.dunwu.javacore.exception.exceptionchaindemo$myexception2: åºç° myexception2\n\tat io.github.dunwu.javacore.exception.exceptionchaindemo.f2(exceptionchaindemo.java:29)\n\tat io.github.dunwu.javacore.exception.exceptionchaindemo.main(exceptionchaindemo.java:34)\ncaused by: io.github.dunwu.javacore.exception.exceptionchaindemo$myexception1: åºç° myexception1\n\tat io.github.dunwu.javacore.exception.exceptionchaindemo.f1(exceptionchaindemo.java:22)\n\tat io.github.dunwu.javacore.exception.exceptionchaindemo.f2(exceptionchaindemo.java:27)\n\t... 1 more\n\n\n> æ©å±éè¯»ï¼https://juejin.im/post/5b6d61e55188251b38129f9a#heading-10\n> \n> è¿ç¯æç« ä¸­å¯¹äºå¼å¸¸é¾è®²è§£æ¯è¾è¯¦ç»ã\n\n\n# å¼å¸¸æ³¨æäºé¡¹\n\n\n# finally è¦çå¼å¸¸\n\njava å¼å¸¸å¤çä¸­ finally ä¸­ç return ä¼è¦ç catch ä»£ç åä¸­ç return è¯­å¥å throw è¯­å¥ï¼æä»¥ java ä¸å»ºè®®å¨ finally ä¸­ä½¿ç¨ return è¯­å¥ã\n\næ­¤å¤ finally ä¸­ç throw è¯­å¥ä¹ä¼è¦ç catch ä»£ç åä¸­ç return è¯­å¥å throw è¯­å¥ã\n\nç¤ºä¾ï¼\n\npublic class finallyoverrideexceptiondemo {\n    static void f() throws exception {\n        try {\n            throw new exception("a");\n        } catch (exception e) {\n            throw new exception("b");\n        } finally {\n            throw new exception("c");\n        }\n    }\n\n    public static void main(string[] args) {\n        try {\n            f();\n        } catch (exception e) {\n            system.out.println(e.getmessage());\n        }\n    }\n}\n\n\nè¾åºï¼c\n\n\n# è¦çæåºå¼å¸¸çæ¹æ³\n\nå½å­ç±»éåç¶ç±»å¸¦æ throws å£°æçå½æ°æ¶ï¼å¶ throws å£°æçå¼å¸¸å¿é¡»å¨ç¶ç±»å¼å¸¸çå¯æ§èå´åââç¨äºå¤çç¶ç±»ç throws æ¹æ³çå¼å¸¸å¤çå¨ï¼å¿é¡»ä¹éç¨äºå­ç±»çè¿ä¸ªå¸¦ throws æ¹æ³ ãè¿æ¯ä¸ºäºæ¯æå¤æã\n\nç¤ºä¾ï¼\n\npublic class exceptionoverridedemo {\n    static class father {\n        public void start() throws ioexception {\n            throw new ioexception();\n        }\n    }\n\n    static class son extends father {\n        @override\n        public void start() throws sqlexception {\n            throw new sqlexception();\n        }\n    }\n\n    public static void main(string[] args) {\n        father obj1 = new father();\n        father obj2 = new son();\n        try {\n            obj1.start();\n            obj2.start();\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\n\n> ä¸é¢çç¤ºä¾ç¼è¯æ¶ä¼æ¥éï¼åå å¨äºï¼\n> \n> å ä¸º son ç±»æåºå¼å¸¸çå®è´¨æ¯ sqlexceptionï¼è ioexception æ æ³å¤çå®ãé£ä¹è¿éç try catch å°±ä¸è½å¤ç son ä¸­çå¼å¸¸äºãå¤æå°±ä¸è½å®ç°äºã\n\n\n# å¼å¸¸åçº¿ç¨\n\nå¦æ java ç¨åºåªæä¸ä¸ªçº¿ç¨ï¼é£ä¹æ²¡æè¢«ä»»ä½ä»£ç å¤ççå¼å¸¸ä¼å¯¼è´ç¨åºç»æ­¢ãå¦æ java ç¨åºæ¯å¤çº¿ç¨çï¼é£ä¹æ²¡æè¢«ä»»ä½ä»£ç å¤ççå¼å¸¸ä»ä»ä¼å¯¼è´å¼å¸¸æå¨ççº¿ç¨ç»æã\n\n\n# æä½³å®è·µ\n\n * å¯¹å¯æ¢å¤çæåµä½¿ç¨æ£æ¥æ§å¼å¸¸ï¼exceptionï¼ï¼å¯¹ç¼ç¨éè¯¯ä½¿ç¨è¿è¡æ¶å¼å¸¸ï¼runtimeexceptionï¼ã\n * ä¼åä½¿ç¨ java æ åçå¼å¸¸ã\n * æåºä¸æ½è±¡ç¸å¯¹åºçå¼å¸¸ã\n * å¨ç»èæ¶æ¯ä¸­åå«è½æè·å¤±è´¥çä¿¡æ¯ã\n * å°½å¯è½åå° try ä»£ç åçå¤§å°ã\n * å°½éç¼©å°å¼å¸¸èå´ãä¾å¦ï¼å¦ææç¥å°è¯æè·çæ¯ä¸ä¸ª arithmeticexceptionï¼å°±åºè¯¥ catch arithmeticexceptionï¼èä¸æ¯ catch èå´è¾å¤§ç runtimeexceptionï¼çè³æ¯ exceptionã\n * å°½éä¸è¦å¨ finally åæåºå¼å¸¸æèè¿åå¼ã\n * ä¸è¦å¿½ç¥å¼å¸¸ï¼ä¸æ¦æè·å¼å¸¸ï¼å°±åºè¯¥å¤çï¼èéä¸¢å¼ã\n * å¼å¸¸å¤çæçå¾ä½ï¼æä»¥ä¸è¦ç¨å¼å¸¸è¿è¡ä¸å¡é»è¾å¤çã\n * åç±»å¼å¸¸å¿é¡»è¦æåç¬çæ¥å¿è®°å½ï¼å°å¼å¸¸åçº§ï¼åç±»ç®¡çï¼å ä¸ºæçæ¶åä»ä»æ³ç»ç¬¬ä¸æ¹è¿ç»´çå°é»è¾å¼å¸¸ï¼èä¸æ¯æ´ç»èçä¿¡æ¯ã\n * å¦ä½å¯¹å¼å¸¸è¿è¡åç±»ï¼\n   * é»è¾å¼å¸¸ï¼è¿ç±»å¼å¸¸ç¨äºæè¿°ä¸å¡æ æ³æç§é¢æçæåµå¤çä¸å»ï¼å±äºç¨æ·å¶é çæå¤ã\n   * ä»£ç éè¯¯ï¼è¿ç±»å¼å¸¸ç¨äºæè¿°å¼åçä»£ç éè¯¯ï¼ä¾å¦ npeï¼illargï¼é½å±äºç¨åºåå¶é ç bugã\n   * ä¸æå¼å¸¸ï¼å¤ç¨äºç¹å®ä¸å¡åºæ¯ï¼ç¨äºæè¿°æå®ä½ä¸åºç°æå¤æåµæ æ³é¢åå¤çã\n\n> æ©å±éè¯»ï¼\n> \n>  * effective java ä¸­æç ä¹ ç¬¬ä¹ç«  å¼å¸¸\n>  * ä¼éçå¤çä½ ç java å¼å¸¸\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * effective java ä¸­æç ä¹ ç¬¬ä¹ç«  å¼å¸¸\n * ä¼éçå¤çä½ ç java å¼å¸¸\n * https://juejin.im/post/5b6d61e55188251b38129f9a#heading-17\n * https://www.cnblogs.com/skywang12345/p/3544168.html\n * http://www.importnew.com/26613.html',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java æ³å",frontmatter:{title:"æ·±å¥çè§£ Java æ³å",date:"2020-10-17T19:13:25.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","æ³å"],permalink:"/pages/33a820/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/09.Java%E6%B3%9B%E5%9E%8B.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/09.Javaæ³å.md",key:"v-34aa0805",path:"/pages/33a820/",headers:[{level:2,title:"ä¸ºä»ä¹éè¦æ³å",slug:"ä¸ºä»ä¹éè¦æ³å",normalizedTitle:"ä¸ºä»ä¹éè¦æ³å",charIndex:19},{level:2,title:"æ³åç±»å",slug:"æ³åç±»å",normalizedTitle:"æ³åç±»å",charIndex:1772},{level:3,title:"æ³åç±»",slug:"æ³åç±»",normalizedTitle:"æ³åç±»",charIndex:1772},{level:3,title:"æ³åæ¥å£",slug:"æ³åæ¥å£",normalizedTitle:"æ³åæ¥å£",charIndex:4111},{level:2,title:"æ³åæ¹æ³",slug:"æ³åæ¹æ³",normalizedTitle:"æ³åæ¹æ³",charIndex:5069},{level:2,title:"ç±»åæ¦é¤",slug:"ç±»åæ¦é¤",normalizedTitle:"ç±»åæ¦é¤",charIndex:6258},{level:2,title:"æ³ååç»§æ¿",slug:"æ³ååç»§æ¿",normalizedTitle:"æ³ååç»§æ¿",charIndex:7203},{level:2,title:"ç±»åè¾¹ç",slug:"ç±»åè¾¹ç",normalizedTitle:"ç±»åè¾¹ç",charIndex:6409},{level:2,title:"ç±»åééç¬¦",slug:"ç±»åééç¬¦",normalizedTitle:"ç±»åééç¬¦",charIndex:9090},{level:3,title:"ä¸çééç¬¦",slug:"ä¸çééç¬¦",normalizedTitle:"ä¸çééç¬¦",charIndex:9191},{level:3,title:"ä¸çééç¬¦",slug:"ä¸çééç¬¦",normalizedTitle:"ä¸çééç¬¦",charIndex:9680},{level:3,title:"æ çééç¬¦",slug:"æ çééç¬¦",normalizedTitle:"æ çééç¬¦",charIndex:10194},{level:3,title:"ééç¬¦ååä¸è½¬å",slug:"ééç¬¦ååä¸è½¬å",normalizedTitle:"ééç¬¦ååä¸è½¬å",charIndex:10754},{level:2,title:"æ³åççº¦æ",slug:"æ³åççº¦æ",normalizedTitle:"æ³åççº¦æ",charIndex:11140},{level:2,title:"æ³åæä½³å®è·µ",slug:"æ³åæä½³å®è·µ",normalizedTitle:"æ³åæä½³å®è·µ",charIndex:12337},{level:3,title:"æ³åå½å",slug:"æ³åå½å",normalizedTitle:"æ³åå½å",charIndex:12348},{level:3,title:"ä½¿ç¨æ³åçå»ºè®®",slug:"ä½¿ç¨æ³åçå»ºè®®",normalizedTitle:"ä½¿ç¨æ³åçå»ºè®®",charIndex:12473},{level:2,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:12593},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:12602}],headersStr:"ä¸ºä»ä¹éè¦æ³å æ³åç±»å æ³åç±» æ³åæ¥å£ æ³åæ¹æ³ ç±»åæ¦é¤ æ³ååç»§æ¿ ç±»åè¾¹ç ç±»åééç¬¦ ä¸çééç¬¦ ä¸çééç¬¦ æ çééç¬¦ ééç¬¦ååä¸è½¬å æ³åççº¦æ æ³åæä½³å®è·µ æ³åå½å ä½¿ç¨æ³åçå»ºè®® å°ç» åèèµæ",content:'# æ·±å¥çè§£ Java æ³å\n\n\n# ä¸ºä»ä¹éè¦æ³å\n\nJDK5 å¼å¥äºæ³åæºå¶ã\n\nä¸ºä»ä¹éè¦æ³åå¢ï¼åç­è¿ä¸ªé®é¢åï¼åè®©æä»¬æ¥çä¸ä¸ªç¤ºä¾ã\n\npublic class NoGenericsDemo {\n    public static void main(String[] args) {\n        List list = new ArrayList<>();\n        list.add("abc");\n        list.add(18);\n        list.add(new double[] {1.0, 2.0});\n        Object obj1 = list.get(0);\n        Object obj2 = list.get(1);\n        Object obj3 = list.get(2);\n        System.out.println("obj1 = [" + obj1 + "]");\n        System.out.println("obj2 = [" + obj2 + "]");\n        System.out.println("obj3 = [" + obj3 + "]");\n\n        int num1 = (int)list.get(0);\n        int num2 = (int)list.get(1);\n        int num3 = (int)list.get(2);\n        System.out.println("num1 = [" + num1 + "]");\n        System.out.println("num2 = [" + num2 + "]");\n        System.out.println("num3 = [" + num3 + "]");\n    }\n}\n// Output:\n// obj1 = [abc]\n// obj2 = [18]\n// obj3 = [[D@47089e5f]\n// Exception in thread "main" java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Integer\n// at io.github.dunwu.javacore.generics.NoGenericsDemo.main(NoGenericsDemo.java:23)\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> å¨ä¸é¢çç¤ºä¾ä¸­ï¼List å®¹å¨æ²¡ææå®å­å¨æ°æ®ç±»åï¼è¿ç§æåµä¸ï¼å¯ä»¥å List æ·»å ä»»æç±»åæ°æ®ï¼ç¼è¯å¨ä¸ä¼åç±»åæ£æ¥ï¼èæ¯é»é»çå°æææ°æ®é½è½¬ä¸º Objectã\n> \n> åè®¾ï¼æåæä»¬å¸æå List å­å¨çæ¯æ´å½¢æ°æ®ï¼åè®¾ï¼æä¸ªå®¶ä¼ä¸å°å¿å­å¥äºå¶ä»æ°æ®ç±»åãå½ä½ è¯å¾ä»å®¹å¨ä¸­åæ´å½¢æ°æ®æ¶ï¼ç±äº List å½æ Object ç±»åæ¥å­å¨ï¼ä½ ä¸å¾ä¸ä½¿ç¨ç±»åå¼ºå¶è½¬æ¢ãå¨è¿è¡æ¶ï¼æä¼åç° List ä¸­æ°æ®ä¸å­å¨ä¸è´çé®é¢ï¼è¿å°±ä¸ºç¨åºè¿è¡å¸¦æ¥äºå¾å¤§çé£é©ï¼æ å½¢ä¼¤å®³æä¸ºè´å½ï¼ã\n\nèæ³åçåºç°ï¼è§£å³äºç±»åå®å¨é®é¢ã\n\næ³åå·æä»¥ä¸ä¼ç¹ï¼\n\n * ç¼è¯æ¶çå¼ºç±»åæ£æ¥\n\næ³åè¦æ±å¨å£°ææ¶æå®å®éæ°æ®ç±»åï¼Java ç¼è¯å¨å¨ç¼è¯æ¶ä¼å¯¹æ³åä»£ç åå¼ºç±»åæ£æ¥ï¼å¹¶å¨ä»£ç è¿åç±»åå®å¨æ¶ååºåè­¦ãæ©åç°ï¼æ©æ²»çï¼æéæ£æ¼æäºæç¯®ï¼å¨ç¼è¯æ¶åç°å¹¶ä¿®å¤éè¯¯æä»åºçä»£ä»·è¿æ¯å¨è¿è¡æ¶å°ã\n\n * é¿åäºç±»åè½¬æ¢\n\næªä½¿ç¨æ³åï¼\n\nList list = new ArrayList();\nlist.add("hello");\nString s = (String) list.get(0);\n\n\nä½¿ç¨æ³åï¼\n\nList<String> list = new ArrayList<String>();\nlist.add("hello");\nString s = list.get(0);   // no cast\n\n\n * æ³åç¼ç¨å¯ä»¥å®ç°éç¨ç®æ³\n\néè¿ä½¿ç¨æ³åï¼ç¨åºåå¯ä»¥å®ç°éç¨ç®æ³ï¼è¿äºç®æ³å¯ä»¥å¤çä¸åç±»åçéåï¼å¯ä»¥èªå®ä¹ï¼å¹¶ä¸ç±»åå®å¨ä¸æäºéè¯»ã\n\n\n# æ³åç±»å\n\næ³åç±»åæ¯è¢«åæ°åçç±»ææ¥å£ã\n\n\n# æ³åç±»\n\næ³åç±»çè¯­æ³å½¢å¼ï¼\n\nclass name<T1, T2, ..., Tn> { /* ... */ }\n\n\næ³åç±»çå£°æåéæ³åç±»çå£°æç±»ä¼¼ï¼é¤äºå¨ç±»ååé¢æ·»å äºç±»ååæ°å£°æé¨åãç±å°æ¬å·ï¼<>ï¼åéçç±»ååæ°é¨åè·å¨ç±»ååé¢ãå®æå®ç±»ååæ°ï¼ä¹ç§°ä¸ºç±»ååéï¼T1ï¼T2ï¼...å Tnã\n\nä¸è¬å°æ³åä¸­çç±»åç§°ä¸ºååï¼èå° <> æå®çåæ°ç§°ä¸ºç±»ååæ°ã\n\n * æªåºç¨æ³åçç±»\n\nå¨æ³ååºç°ä¹åï¼å¦æä¸ä¸ªç±»æ³ææä¸ä¸ªå¯ä»¥ä¸ºä»»æç±»åçæ°æ®ï¼åªè½ä½¿ç¨ Object åç±»åè½¬æ¢ãç¤ºä¾å¦ä¸ï¼\n\npublic class Info {\n\tprivate Object value;\n\n\tpublic Object getValue() {\n\t\treturn value;\n\t}\n\n\tpublic void setValue(Object value) {\n\t\tthis.value = value;\n\t}\n}\n\n\n * åç±»ååæ°çæ³åç±»\n\npublic class Info<T> {\n    private T value;\n\n    public Info() { }\n\n    public Info(T value) {\n        this.value = value;\n    }\n\n    public T getValue() {\n        return value;\n    }\n\n    public void setValue(T value) {\n        this.value = value;\n    }\n\n    @Override\n    public String toString() {\n        return "Info{" + "value=" + value + \'}\';\n    }\n}\n\npublic class GenericsClassDemo01 {\n    public static void main(String[] args) {\n        Info<Integer> info = new Info<>();\n        info.setValue(10);\n        System.out.println(info.getValue());\n\n        Info<String> info2 = new Info<>();\n        info2.setValue("xyz");\n        System.out.println(info2.getValue());\n    }\n}\n// Output:\n// 10\n// xyz\n\n\nå¨ä¸é¢çä¾å­ä¸­ï¼å¨åå§åä¸ä¸ªæ³åç±»æ¶ï¼ä½¿ç¨ <> æå®äºåé¨å·ä½ç±»åï¼å¨ç¼è¯æ¶å°±ä¼æ ¹æ®è¿ä¸ªç±»ååå¼ºç±»åæ£æ¥ã\n\nå®éä¸ï¼ä¸ä½¿ç¨ <> æå®åé¨å·ä½ç±»åï¼è¯­æ³ä¸ä¹æ¯æ¯æçï¼ä¸æ¨èè¿ä¹åï¼ï¼å¦ä¸æç¤ºï¼\n\npublic static void main(String[] args) {\n    Info info = new Info();\n    info.setValue(10);\n    System.out.println(info.getValue());\n    info.setValue("abc");\n    System.out.println(info.getValue());\n}\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> ä¸é¢çä¾å­ï¼ä¸ä¼äº§çç¼è¯éè¯¯ï¼ä¹è½æ­£å¸¸è¿è¡ãä½è¿æ ·çè°ç¨å°±å¤±å»æ³åç±»åçä¼å¿ã\n\n * å¤ä¸ªç±»ååæ°çæ³åç±»\n\npublic class MyMap<K,V> {\n    private K key;\n    private V value;\n\n    public MyMap(K key, V value) {\n        this.key = key;\n        this.value = value;\n    }\n\n    @Override\n    public String toString() {\n        return "MyMap{" + "key=" + key + ", value=" + value + \'}\';\n    }\n}\n\npublic class GenericsClassDemo02 {\n    public static void main(String[] args) {\n        MyMap<Integer, String> map = new MyMap<>(1, "one");\n        System.out.println(map);\n    }\n}\n// Output:\n// MyMap{key=1, value=one}\n\n\n * æ³åç±»çç±»ååµå¥\n\npublic class GenericsClassDemo03 {\n    public static void main(String[] args) {\n        Info<String> info = new Info("Hello");\n        MyMap<Integer, Info<String>> map = new MyMap<>(1, info);\n        System.out.println(map);\n    }\n}\n// Output:\n// MyMap{key=1, value=Info{value=Hello}}\n\n\n\n# æ³åæ¥å£\n\næ¥å£ä¹å¯ä»¥å£°ææ³åã\n\næ³åæ¥å£è¯­æ³å½¢å¼ï¼\n\npublic interface Content<T> {\n    T text();\n}\n\n\næ³åæ¥å£æä¸¤ç§å®ç°æ¹å¼ï¼\n\n * å®ç°æ¥å£çå­ç±»æç¡®å£°ææ³åç±»å\n\n\n\npublic class GenericsInterfaceDemo01 implements Content<Integer> {\n    private int text;\n\n    public GenericsInterfaceDemo01(int text) {\n        this.text = text;\n    }\n\n    @Override\n    public Integer text() { return text; }\n\n    public static void main(String[] args) {\n        GenericsInterfaceDemo01 demo = new GenericsInterfaceDemo01(10);\n        System.out.print(demo.text());\n    }\n}\n// Output:\n// 10\n\n\n * å®ç°æ¥å£çå­ç±»ä¸æç¡®å£°ææ³åç±»å\n\npublic class GenericsInterfaceDemo02<T> implements Content<T> {\n    private T text;\n\n    public GenericsInterfaceDemo02(T text) {\n        this.text = text;\n    }\n\n    @Override\n    public T text() { return text; }\n\n    public static void main(String[] args) {\n        GenericsInterfaceDemo02<String> gen = new GenericsInterfaceDemo02<>("ABC");\n        System.out.print(gen.text());\n    }\n}\n// Output:\n// ABC\n\n\n\n# æ³åæ¹æ³\n\næ³åæ¹æ³æ¯å¼å¥å¶èªå·±çç±»ååæ°çæ¹æ³ãæ³åæ¹æ³å¯ä»¥æ¯æ®éæ¹æ³ãéææ¹æ³ä»¥åæé æ¹æ³ã\n\næ³åæ¹æ³è¯­æ³å½¢å¼å¦ä¸ï¼\n\npublic <T> T func(T obj) {}\n\n\næ¯å¦æ¥ææ³åæ¹æ³ï¼ä¸å¶æå¨çç±»æ¯å¦æ¯æ³åæ²¡æå³ç³»ã\n\næ³åæ¹æ³çè¯­æ³åæ¬ä¸ä¸ªç±»ååæ°åè¡¨ï¼å¨å°æ¬å·åï¼å®åºç°å¨æ¹æ³çè¿åç±»åä¹åãå¯¹äºéææ³åæ¹æ³ï¼ç±»ååæ°é¨åå¿é¡»åºç°å¨æ¹æ³çè¿åç±»åä¹åãç±»ååæ°è½è¢«ç¨æ¥å£°æè¿åå¼ç±»åï¼å¹¶ä¸è½ä½ä¸ºæ³åæ¹æ³å¾å°çå®éç±»ååæ°çå ä½ç¬¦ã\n\nä½¿ç¨æ³åæ¹æ³çæ¶åï¼éå¸¸ä¸å¿ææç±»ååæ°ï¼å ä¸ºç¼è¯å¨ä¼ä¸ºæä»¬æ¾åºå·ä½çç±»åãè¿ç§°ä¸ºç±»ååæ°æ¨æ­ï¼type argument inferenceï¼ãç±»åæ¨æ­åªå¯¹èµå¼æä½ææï¼å¶ä»æ¶åå¹¶ä¸èµ·ä½ç¨ãå¦æå°ä¸ä¸ªè¿åç±»åä¸º T çæ³åæ¹æ³è°ç¨çç»æä½ä¸ºåæ°ï¼ä¼ éç»å¦ä¸ä¸ªæ¹æ³ï¼è¿æ¶ç¼è¯å¨å¹¶ä¸ä¼æ§è¡æ¨æ­ãç¼è¯å¨ä¼è®¤ä¸ºï¼è°ç¨æ³åæ¹æ³åï¼å¶è¿åå¼è¢«èµç»ä¸ä¸ª Object ç±»åçåéã\n\npublic class GenericsMethodDemo01 {\n    public static <T> void printClass(T obj) {\n        System.out.println(obj.getClass().toString());\n    }\n\n    public static void main(String[] args) {\n        printClass("abc");\n        printClass(10);\n    }\n}\n// Output:\n// class java.lang.String\n// class java.lang.Integer\n\n\næ³åæ¹æ³ä¸­ä¹å¯ä»¥ä½¿ç¨å¯ååæ°åè¡¨\n\npublic class GenericVarargsMethodDemo {\n    public static <T> List<T> makeList(T... args) {\n        List<T> result = new ArrayList<T>();\n        Collections.addAll(result, args);\n        return result;\n    }\n\n    public static void main(String[] args) {\n        List<String> ls = makeList("A");\n        System.out.println(ls);\n        ls = makeList("A", "B", "C");\n        System.out.println(ls);\n    }\n}\n// Output:\n// [A]\n// [A, B, C]\n\n\n\n# ç±»åæ¦é¤\n\nJava è¯­è¨å¼å¥æ³åæ¯ä¸ºäºå¨ç¼è¯æ¶æä¾æ´ä¸¥æ ¼çç±»åæ£æ¥ï¼å¹¶æ¯ææ³åç¼ç¨ãä¸åäº C++ çæ¨¡æ¿æºå¶ï¼Java æ³åæ¯ä½¿ç¨ç±»åæ¦é¤æ¥å®ç°çï¼ä½¿ç¨æ³åæ¶ï¼ä»»ä½å·ä½çç±»åä¿¡æ¯é½è¢«æ¦é¤äºã\n\né£ä¹ï¼ç±»åæ¦é¤åäºä»ä¹å¢ï¼å®åäºä»¥ä¸å·¥ä½ï¼\n\n * ææ³åä¸­çææç±»ååæ°æ¿æ¢ä¸º Objectï¼å¦ææå®ç±»åè¾¹çï¼åä½¿ç¨ç±»åè¾¹çæ¥æ¿æ¢ãå æ­¤ï¼çæçå­èç ä»åå«æ®éçç±»ï¼æ¥å£åæ¹æ³ã\n * æ¦é¤åºç°çç±»åå£°æï¼å³å»æ <> çåå®¹ãæ¯å¦ T get() æ¹æ³å£°æå°±åæäº Object get() ï¼List<String> å°±åæäº Listãå¦æå¿è¦ï¼æå¥ç±»åè½¬æ¢ä»¥ä¿æç±»åå®å¨ã\n * çææ¡¥æ¥æ¹æ³ä»¥ä¿çæ©å±æ³åç±»åä¸­çå¤ææ§ãç±»åæ¦é¤ç¡®ä¿ä¸ä¸ºåæ°åç±»ååå»ºæ°ç±»ï¼å æ­¤ï¼æ³åä¸ä¼äº§çè¿è¡æ¶å¼éã\n\nè®©æä»¬æ¥çä¸ä¸ªç¤ºä¾ï¼\n\npublic class GenericsErasureTypeDemo {\n    public static void main(String[] args) {\n        List<Object> list1 = new ArrayList<Object>();\n        List<String> list2 = new ArrayList<String>();\n        System.out.println(list1.getClass());\n        System.out.println(list2.getClass());\n    }\n}\n// Output:\n// class java.util.ArrayList\n// class java.util.ArrayList\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> ä¸é¢çä¾å­ä¸­ï¼è½ç¶æå®äºä¸åçç±»ååæ°ï¼ä½æ¯ list1 å list2 çç±»ä¿¡æ¯å´æ¯ä¸æ ·çã\n> \n> è¿æ¯å ä¸ºï¼ä½¿ç¨æ³åæ¶ï¼ä»»ä½å·ä½çç±»åä¿¡æ¯é½è¢«æ¦é¤äºãè¿æå³çï¼ArrayList<Object> å ArrayList<String> å¨è¿è¡æ¶ï¼JVM å°å®ä»¬è§ä¸ºåä¸ç±»åã\n\nJava æ³åçå®ç°æ¹å¼ä¸å¤ªä¼éï¼ä½è¿æ¯å ä¸ºæ³åæ¯å¨ JDK5 æ¶å¼å¥çï¼ä¸ºäºå¼å®¹èä»£ç ï¼å¿é¡»å¨è®¾è®¡ä¸åä¸å®çæä¸­ã\n\n\n# æ³ååç»§æ¿\n\næ³åä¸è½ç¨äºæ¾å¼å°å¼ç¨è¿è¡æ¶ç±»åçæä½ä¹ä¸­ï¼ä¾å¦ï¼è½¬åãinstanceof æä½å new è¡¨è¾¾å¼ãå ä¸ºææå³äºåæ°çç±»åä¿¡æ¯é½ä¸¢å¤±äºãå½ä½ å¨ç¼åæ³åä»£ç æ¶ï¼å¿é¡»æ¶å»æéèªå·±ï¼ä½ åªæ¯çèµ·æ¥å¥½åæ¥ææå³åæ°çç±»åä¿¡æ¯èå·²ã\n\næ­£æ¯ç±äºæ³åæ¶åºäºç±»åæ¦é¤å®ç°çï¼æä»¥ï¼æ³åç±»åæ æ³åä¸è½¬åã\n\n> åä¸è½¬åæ¯æç¨å­ç±»å®ä¾å»åå§åç¶ç±»ï¼è¿æ¯é¢åå¯¹è±¡ä¸­å¤æçéè¦è¡¨ç°ã\n\n\n\nInteger ç»§æ¿äº Objectï¼ArrayList ç»§æ¿äº Listï¼ä½æ¯ List<Interger> å´å¹¶éç»§æ¿äº List<Object>ã\n\nè¿æ¯å ä¸ºï¼æ³åç±»å¹¶æ²¡æèªå·±ç¬æç Class ç±»å¯¹è±¡ãæ¯å¦ï¼å¹¶ä¸å­å¨ List<Object>.class ææ¯ List<Interger>.classï¼Java ç¼è¯å¨ä¼å°äºèé½è§ä¸º List.classã\n\nList<Integer> list = new ArrayList<>();\nList<Object> list2 = list; // Erorr\n\n\n\n# ç±»åè¾¹ç\n\nææ¶æ¨å¯è½å¸æéå¶å¯å¨åæ°åç±»åä¸­ç¨ä½ç±»ååæ°çç±»åãç±»åè¾¹çå¯ä»¥å¯¹æ³åçç±»ååæ°è®¾ç½®éå¶æ¡ä»¶ãä¾å¦ï¼å¯¹æ°å­è¿è¡æä½çæ¹æ³å¯è½åªæ³æ¥å Number æå¶å­ç±»çå®ä¾ã\n\nè¦å£°ææçç±»ååæ°ï¼è¯·ååºç±»ååæ°çåç§°ï¼ç¶åæ¯ extends å³é®å­ï¼åè·å¶éå¶ç±»ææ¥å£ã\n\nç±»åè¾¹ççè¯­æ³å½¢å¼å¦ä¸ï¼\n\n<T extends XXX>\n\n\nç¤ºä¾ï¼\n\npublic class GenericsExtendsDemo01 {\n    static <T extends Comparable<T>> T max(T x, T y, T z) {\n        T max = x; // åè®¾xæ¯åå§æå¤§å¼\n        if (y.compareTo(max) > 0) {\n            max = y; //y æ´å¤§\n        }\n        if (z.compareTo(max) > 0) {\n            max = z; // ç°å¨ z æ´å¤§\n        }\n        return max; // è¿åæå¤§å¯¹è±¡\n    }\n\n    public static void main(String[] args) {\n        System.out.println(max(3, 4, 5));\n        System.out.println(max(6.6, 8.8, 7.7));\n        System.out.println(max("pear", "apple", "orange"));\n    }\n}\n// Output:\n// 5\n// 8.8\n// pear\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> ä¸é¢çç¤ºä¾å£°æäºä¸ä¸ªæ³åæ¹æ³ï¼ç±»ååæ° T extends Comparable<T> è¡¨æä¼ å¥æ¹æ³ä¸­çç±»åå¿é¡»å®ç°äº Comparable æ¥å£ã\n\nç±»åè¾¹çå¯ä»¥è®¾ç½®å¤ä¸ªï¼è¯­æ³å½¢å¼å¦ä¸ï¼\n\n<T extends B1 & B2 & B3>\n\n\n> ð æ³¨æï¼extends å³é®å­åé¢çç¬¬ä¸ä¸ªç±»ååæ°å¯ä»¥æ¯ç±»ææ¥å£ï¼å¶ä»ç±»ååæ°åªè½æ¯æ¥å£ã\n\nç¤ºä¾ï¼\n\npublic class GenericsExtendsDemo02 {\n    static class A { /* ... */ }\n    interface B { /* ... */ }\n    interface C { /* ... */ }\n    static class D1 <T extends A & B & C> { /* ... */ }\n    static class D2 <T extends B & A & C> { /* ... */ } // ç¼è¯æ¥é\n    static class E extends A implements B, C { /* ... */ }\n\n    public static void main(String[] args) {\n        D1<E> demo1 = new D1<>();\n        System.out.println(demo1.getClass().toString());\n        D1<String> demo2 = new D1<>(); // ç¼è¯æ¥é\n    }\n}\n\n\n\n# ç±»åééç¬¦\n\nç±»åééç¬¦ä¸è¬æ¯ä½¿ç¨ ? ä»£æ¿å·ä½çç±»ååæ°ãä¾å¦ List<?> å¨é»è¾ä¸æ¯ List<String> ï¼List<Integer> ç­ææ List<å·ä½ç±»åå®å> çç¶ç±»ã\n\n\n# ä¸çééç¬¦\n\nå¯ä»¥ä½¿ç¨**ä¸çééç¬¦**æ¥ç¼©å°ç±»ååæ°çç±»åèå´ã\n\nå®çè¯­æ³å½¢å¼ä¸ºï¼<? extends Number>\n\npublic class GenericsUpperBoundedWildcardDemo {\n    public static double sumOfList(List<? extends Number> list) {\n        double s = 0.0;\n        for (Number n : list) {\n            s += n.doubleValue();\n        }\n        return s;\n    }\n\n    public static void main(String[] args) {\n        List<Integer> li = Arrays.asList(1, 2, 3);\n        System.out.println("sum = " + sumOfList(li));\n    }\n}\n// Output:\n// sum = 6.0\n\n\n\n# ä¸çééç¬¦\n\n**ä¸çééç¬¦**å°æªç¥ç±»åéå¶ä¸ºè¯¥ç±»åçç¹å®ç±»åæè¶ç±»ç±»åã\n\n> ð æ³¨æï¼ä¸çééç¬¦åä¸çééç¬¦ä¸è½åæ¶ä½¿ç¨ã\n\nå®çè¯­æ³å½¢å¼ä¸ºï¼<? super Number>\n\npublic class GenericsLowerBoundedWildcardDemo {\n    public static void addNumbers(List<? super Integer> list) {\n        for (int i = 1; i <= 5; i++) {\n            list.add(i);\n        }\n    }\n\n    public static void main(String[] args) {\n        List<Integer> list = new ArrayList<>();\n        addNumbers(list);\n        System.out.println(Arrays.deepToString(list.toArray()));\n    }\n}\n// Output:\n// [1, 2, 3, 4, 5]\n\n\n\n# æ çééç¬¦\n\næ çééç¬¦æä¸¤ç§åºç¨åºæ¯ï¼\n\n * å¯ä»¥ä½¿ç¨ Object ç±»ä¸­æä¾çåè½æ¥å®ç°çæ¹æ³ã\n * ä½¿ç¨ä¸ä¾èµäºç±»ååæ°çæ³åç±»ä¸­çæ¹æ³ã\n\nè¯­æ³å½¢å¼ï¼<?>\n\npublic class GenericsUnboundedWildcardDemo {\n    public static void printList(List<?> list) {\n        for (Object elem : list) {\n            System.out.print(elem + " ");\n        }\n        System.out.println();\n    }\n\n    public static void main(String[] args) {\n        List<Integer> li = Arrays.asList(1, 2, 3);\n        List<String> ls = Arrays.asList("one", "two", "three");\n        printList(li);\n        printList(ls);\n    }\n}\n// Output:\n// 1 2 3\n// one two three\n\n\n\n# ééç¬¦ååä¸è½¬å\n\nåé¢ï¼æä»¬æå°ï¼æ³åä¸è½åä¸è½¬åãä½æ¯ï¼æä»¬å¯ä»¥éè¿ä½¿ç¨ééç¬¦æ¥åä¸è½¬åã\n\npublic class GenericsWildcardDemo {\n    public static void main(String[] args) {\n        List<Integer> intList = new ArrayList<>();\n        List<Number> numList = intList;  // Error\n\n        List<? extends Integer> intList2 = new ArrayList<>();\n        List<? extends Number> numList2 = intList2;  // OK\n    }\n}\n\n\n> æ©å±éè¯»ï¼Oracle æ³åææ¡£\n\n\n# æ³åççº¦æ\n\n * æ³åç±»åçç±»ååæ°ä¸è½æ¯å¼ç±»å\n\nPair<int, char> p = new Pair<>(8, \'a\');  // ç¼è¯éè¯¯\n\n\n * ä¸è½åå»ºç±»ååæ°çå®ä¾\n\npublic static <E> void append(List<E> list) {\n    E elem = new E();  // ç¼è¯éè¯¯\n    list.add(elem);\n}\n\n\n * ä¸è½å£°æç±»åä¸ºç±»ååæ°çéææå\n\npublic class MobileDevice<T> {\n    private static T os; // error\n\n    // ...\n}\n\n\n * ç±»ååæ°ä¸è½ä½¿ç¨ç±»åè½¬æ¢æ instanceof\n\npublic static <E> void rtti(List<E> list) {\n    if (list instanceof ArrayList<Integer>) {  // ç¼è¯éè¯¯\n        // ...\n    }\n}\n\n\nList<Integer> li = new ArrayList<>();\nList<Number>  ln = (List<Number>) li;  // ç¼è¯éè¯¯\n\n\n * ä¸è½åå»ºç±»ååæ°çæ°ç»\n\nList<Integer>[] arrayOfLists = new List<Integer>[2];  // ç¼è¯éè¯¯\n\n\n * ä¸è½åå»ºãcatch æ throw åæ°åç±»åå¯¹è±¡\n\n// Extends Throwable indirectly\nclass MathException<T> extends Exception { /* ... */ }    // ç¼è¯éè¯¯\n\n// Extends Throwable directly\nclass QueueFullException<T> extends Throwable { /* ... */ // ç¼è¯éè¯¯\n\n\npublic static <T extends Exception, J> void execute(List<J> jobs) {\n    try {\n        for (J job : jobs)\n            // ...\n    } catch (T e) {   // compile-time error\n        // ...\n    }\n}\n\n\n * ä»ä»æ¯æ³åç±»ç¸åï¼èç±»ååæ°ä¸åçæ¹æ³ä¸è½éè½½\n\npublic class Example {\n    public void print(Set<String> strSet) { }\n    public void print(Set<Integer> intSet) { } // ç¼è¯éè¯¯\n}\n\n\n\n# æ³åæä½³å®è·µ\n\n\n# æ³åå½å\n\næ³åä¸äºçº¦å®ä¿æçå½åï¼\n\n * E - Element\n * K - Key\n * N - Number\n * T - Type\n * V - Value\n * S,U,V etc. - 2nd, 3rd, 4th types\n\n\n# ä½¿ç¨æ³åçå»ºè®®\n\n * æ¶é¤ç±»åæ£æ¥åè­¦\n * List ä¼åäºæ°ç»\n * ä¼åèèä½¿ç¨æ³åæ¥æé«ä»£ç éç¨æ§\n * ä¼åèèæ³åæ¹æ³æ¥éå®æ³åçèå´\n * å©ç¨æéå¶ééç¬¦æ¥æå API ççµæ´»æ§\n * ä¼åèèç±»åå®å¨çå¼æå®¹å¨\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * Effective java\n * Oracle æ³åææ¡£\n * Java æ³åè¯¦è§£',normalizedContent:'# æ·±å¥çè§£ java æ³å\n\n\n# ä¸ºä»ä¹éè¦æ³å\n\njdk5 å¼å¥äºæ³åæºå¶ã\n\nä¸ºä»ä¹éè¦æ³åå¢ï¼åç­è¿ä¸ªé®é¢åï¼åè®©æä»¬æ¥çä¸ä¸ªç¤ºä¾ã\n\npublic class nogenericsdemo {\n    public static void main(string[] args) {\n        list list = new arraylist<>();\n        list.add("abc");\n        list.add(18);\n        list.add(new double[] {1.0, 2.0});\n        object obj1 = list.get(0);\n        object obj2 = list.get(1);\n        object obj3 = list.get(2);\n        system.out.println("obj1 = [" + obj1 + "]");\n        system.out.println("obj2 = [" + obj2 + "]");\n        system.out.println("obj3 = [" + obj3 + "]");\n\n        int num1 = (int)list.get(0);\n        int num2 = (int)list.get(1);\n        int num3 = (int)list.get(2);\n        system.out.println("num1 = [" + num1 + "]");\n        system.out.println("num2 = [" + num2 + "]");\n        system.out.println("num3 = [" + num3 + "]");\n    }\n}\n// output:\n// obj1 = [abc]\n// obj2 = [18]\n// obj3 = [[d@47089e5f]\n// exception in thread "main" java.lang.classcastexception: java.lang.string cannot be cast to java.lang.integer\n// at io.github.dunwu.javacore.generics.nogenericsdemo.main(nogenericsdemo.java:23)\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> å¨ä¸é¢çç¤ºä¾ä¸­ï¼list å®¹å¨æ²¡ææå®å­å¨æ°æ®ç±»åï¼è¿ç§æåµä¸ï¼å¯ä»¥å list æ·»å ä»»æç±»åæ°æ®ï¼ç¼è¯å¨ä¸ä¼åç±»åæ£æ¥ï¼èæ¯é»é»çå°æææ°æ®é½è½¬ä¸º objectã\n> \n> åè®¾ï¼æåæä»¬å¸æå list å­å¨çæ¯æ´å½¢æ°æ®ï¼åè®¾ï¼æä¸ªå®¶ä¼ä¸å°å¿å­å¥äºå¶ä»æ°æ®ç±»åãå½ä½ è¯å¾ä»å®¹å¨ä¸­åæ´å½¢æ°æ®æ¶ï¼ç±äº list å½æ object ç±»åæ¥å­å¨ï¼ä½ ä¸å¾ä¸ä½¿ç¨ç±»åå¼ºå¶è½¬æ¢ãå¨è¿è¡æ¶ï¼æä¼åç° list ä¸­æ°æ®ä¸å­å¨ä¸è´çé®é¢ï¼è¿å°±ä¸ºç¨åºè¿è¡å¸¦æ¥äºå¾å¤§çé£é©ï¼æ å½¢ä¼¤å®³æä¸ºè´å½ï¼ã\n\nèæ³åçåºç°ï¼è§£å³äºç±»åå®å¨é®é¢ã\n\næ³åå·æä»¥ä¸ä¼ç¹ï¼\n\n * ç¼è¯æ¶çå¼ºç±»åæ£æ¥\n\næ³åè¦æ±å¨å£°ææ¶æå®å®éæ°æ®ç±»åï¼java ç¼è¯å¨å¨ç¼è¯æ¶ä¼å¯¹æ³åä»£ç åå¼ºç±»åæ£æ¥ï¼å¹¶å¨ä»£ç è¿åç±»åå®å¨æ¶ååºåè­¦ãæ©åç°ï¼æ©æ²»çï¼æéæ£æ¼æäºæç¯®ï¼å¨ç¼è¯æ¶åç°å¹¶ä¿®å¤éè¯¯æä»åºçä»£ä»·è¿æ¯å¨è¿è¡æ¶å°ã\n\n * é¿åäºç±»åè½¬æ¢\n\næªä½¿ç¨æ³åï¼\n\nlist list = new arraylist();\nlist.add("hello");\nstring s = (string) list.get(0);\n\n\nä½¿ç¨æ³åï¼\n\nlist<string> list = new arraylist<string>();\nlist.add("hello");\nstring s = list.get(0);   // no cast\n\n\n * æ³åç¼ç¨å¯ä»¥å®ç°éç¨ç®æ³\n\néè¿ä½¿ç¨æ³åï¼ç¨åºåå¯ä»¥å®ç°éç¨ç®æ³ï¼è¿äºç®æ³å¯ä»¥å¤çä¸åç±»åçéåï¼å¯ä»¥èªå®ä¹ï¼å¹¶ä¸ç±»åå®å¨ä¸æäºéè¯»ã\n\n\n# æ³åç±»å\n\næ³åç±»åæ¯è¢«åæ°åçç±»ææ¥å£ã\n\n\n# æ³åç±»\n\næ³åç±»çè¯­æ³å½¢å¼ï¼\n\nclass name<t1, t2, ..., tn> { /* ... */ }\n\n\næ³åç±»çå£°æåéæ³åç±»çå£°æç±»ä¼¼ï¼é¤äºå¨ç±»ååé¢æ·»å äºç±»ååæ°å£°æé¨åãç±å°æ¬å·ï¼<>ï¼åéçç±»ååæ°é¨åè·å¨ç±»ååé¢ãå®æå®ç±»ååæ°ï¼ä¹ç§°ä¸ºç±»ååéï¼t1ï¼t2ï¼...å tnã\n\nä¸è¬å°æ³åä¸­çç±»åç§°ä¸ºååï¼èå° <> æå®çåæ°ç§°ä¸ºç±»ååæ°ã\n\n * æªåºç¨æ³åçç±»\n\nå¨æ³ååºç°ä¹åï¼å¦æä¸ä¸ªç±»æ³ææä¸ä¸ªå¯ä»¥ä¸ºä»»æç±»åçæ°æ®ï¼åªè½ä½¿ç¨ object åç±»åè½¬æ¢ãç¤ºä¾å¦ä¸ï¼\n\npublic class info {\n\tprivate object value;\n\n\tpublic object getvalue() {\n\t\treturn value;\n\t}\n\n\tpublic void setvalue(object value) {\n\t\tthis.value = value;\n\t}\n}\n\n\n * åç±»ååæ°çæ³åç±»\n\npublic class info<t> {\n    private t value;\n\n    public info() { }\n\n    public info(t value) {\n        this.value = value;\n    }\n\n    public t getvalue() {\n        return value;\n    }\n\n    public void setvalue(t value) {\n        this.value = value;\n    }\n\n    @override\n    public string tostring() {\n        return "info{" + "value=" + value + \'}\';\n    }\n}\n\npublic class genericsclassdemo01 {\n    public static void main(string[] args) {\n        info<integer> info = new info<>();\n        info.setvalue(10);\n        system.out.println(info.getvalue());\n\n        info<string> info2 = new info<>();\n        info2.setvalue("xyz");\n        system.out.println(info2.getvalue());\n    }\n}\n// output:\n// 10\n// xyz\n\n\nå¨ä¸é¢çä¾å­ä¸­ï¼å¨åå§åä¸ä¸ªæ³åç±»æ¶ï¼ä½¿ç¨ <> æå®äºåé¨å·ä½ç±»åï¼å¨ç¼è¯æ¶å°±ä¼æ ¹æ®è¿ä¸ªç±»ååå¼ºç±»åæ£æ¥ã\n\nå®éä¸ï¼ä¸ä½¿ç¨ <> æå®åé¨å·ä½ç±»åï¼è¯­æ³ä¸ä¹æ¯æ¯æçï¼ä¸æ¨èè¿ä¹åï¼ï¼å¦ä¸æç¤ºï¼\n\npublic static void main(string[] args) {\n    info info = new info();\n    info.setvalue(10);\n    system.out.println(info.getvalue());\n    info.setvalue("abc");\n    system.out.println(info.getvalue());\n}\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> ä¸é¢çä¾å­ï¼ä¸ä¼äº§çç¼è¯éè¯¯ï¼ä¹è½æ­£å¸¸è¿è¡ãä½è¿æ ·çè°ç¨å°±å¤±å»æ³åç±»åçä¼å¿ã\n\n * å¤ä¸ªç±»ååæ°çæ³åç±»\n\npublic class mymap<k,v> {\n    private k key;\n    private v value;\n\n    public mymap(k key, v value) {\n        this.key = key;\n        this.value = value;\n    }\n\n    @override\n    public string tostring() {\n        return "mymap{" + "key=" + key + ", value=" + value + \'}\';\n    }\n}\n\npublic class genericsclassdemo02 {\n    public static void main(string[] args) {\n        mymap<integer, string> map = new mymap<>(1, "one");\n        system.out.println(map);\n    }\n}\n// output:\n// mymap{key=1, value=one}\n\n\n * æ³åç±»çç±»ååµå¥\n\npublic class genericsclassdemo03 {\n    public static void main(string[] args) {\n        info<string> info = new info("hello");\n        mymap<integer, info<string>> map = new mymap<>(1, info);\n        system.out.println(map);\n    }\n}\n// output:\n// mymap{key=1, value=info{value=hello}}\n\n\n\n# æ³åæ¥å£\n\næ¥å£ä¹å¯ä»¥å£°ææ³åã\n\næ³åæ¥å£è¯­æ³å½¢å¼ï¼\n\npublic interface content<t> {\n    t text();\n}\n\n\næ³åæ¥å£æä¸¤ç§å®ç°æ¹å¼ï¼\n\n * å®ç°æ¥å£çå­ç±»æç¡®å£°ææ³åç±»å\n\n\n\npublic class genericsinterfacedemo01 implements content<integer> {\n    private int text;\n\n    public genericsinterfacedemo01(int text) {\n        this.text = text;\n    }\n\n    @override\n    public integer text() { return text; }\n\n    public static void main(string[] args) {\n        genericsinterfacedemo01 demo = new genericsinterfacedemo01(10);\n        system.out.print(demo.text());\n    }\n}\n// output:\n// 10\n\n\n * å®ç°æ¥å£çå­ç±»ä¸æç¡®å£°ææ³åç±»å\n\npublic class genericsinterfacedemo02<t> implements content<t> {\n    private t text;\n\n    public genericsinterfacedemo02(t text) {\n        this.text = text;\n    }\n\n    @override\n    public t text() { return text; }\n\n    public static void main(string[] args) {\n        genericsinterfacedemo02<string> gen = new genericsinterfacedemo02<>("abc");\n        system.out.print(gen.text());\n    }\n}\n// output:\n// abc\n\n\n\n# æ³åæ¹æ³\n\næ³åæ¹æ³æ¯å¼å¥å¶èªå·±çç±»ååæ°çæ¹æ³ãæ³åæ¹æ³å¯ä»¥æ¯æ®éæ¹æ³ãéææ¹æ³ä»¥åæé æ¹æ³ã\n\næ³åæ¹æ³è¯­æ³å½¢å¼å¦ä¸ï¼\n\npublic <t> t func(t obj) {}\n\n\næ¯å¦æ¥ææ³åæ¹æ³ï¼ä¸å¶æå¨çç±»æ¯å¦æ¯æ³åæ²¡æå³ç³»ã\n\næ³åæ¹æ³çè¯­æ³åæ¬ä¸ä¸ªç±»ååæ°åè¡¨ï¼å¨å°æ¬å·åï¼å®åºç°å¨æ¹æ³çè¿åç±»åä¹åãå¯¹äºéææ³åæ¹æ³ï¼ç±»ååæ°é¨åå¿é¡»åºç°å¨æ¹æ³çè¿åç±»åä¹åãç±»ååæ°è½è¢«ç¨æ¥å£°æè¿åå¼ç±»åï¼å¹¶ä¸è½ä½ä¸ºæ³åæ¹æ³å¾å°çå®éç±»ååæ°çå ä½ç¬¦ã\n\nä½¿ç¨æ³åæ¹æ³çæ¶åï¼éå¸¸ä¸å¿ææç±»ååæ°ï¼å ä¸ºç¼è¯å¨ä¼ä¸ºæä»¬æ¾åºå·ä½çç±»åãè¿ç§°ä¸ºç±»ååæ°æ¨æ­ï¼type argument inferenceï¼ãç±»åæ¨æ­åªå¯¹èµå¼æä½ææï¼å¶ä»æ¶åå¹¶ä¸èµ·ä½ç¨ãå¦æå°ä¸ä¸ªè¿åç±»åä¸º t çæ³åæ¹æ³è°ç¨çç»æä½ä¸ºåæ°ï¼ä¼ éç»å¦ä¸ä¸ªæ¹æ³ï¼è¿æ¶ç¼è¯å¨å¹¶ä¸ä¼æ§è¡æ¨æ­ãç¼è¯å¨ä¼è®¤ä¸ºï¼è°ç¨æ³åæ¹æ³åï¼å¶è¿åå¼è¢«èµç»ä¸ä¸ª object ç±»åçåéã\n\npublic class genericsmethoddemo01 {\n    public static <t> void printclass(t obj) {\n        system.out.println(obj.getclass().tostring());\n    }\n\n    public static void main(string[] args) {\n        printclass("abc");\n        printclass(10);\n    }\n}\n// output:\n// class java.lang.string\n// class java.lang.integer\n\n\næ³åæ¹æ³ä¸­ä¹å¯ä»¥ä½¿ç¨å¯ååæ°åè¡¨\n\npublic class genericvarargsmethoddemo {\n    public static <t> list<t> makelist(t... args) {\n        list<t> result = new arraylist<t>();\n        collections.addall(result, args);\n        return result;\n    }\n\n    public static void main(string[] args) {\n        list<string> ls = makelist("a");\n        system.out.println(ls);\n        ls = makelist("a", "b", "c");\n        system.out.println(ls);\n    }\n}\n// output:\n// [a]\n// [a, b, c]\n\n\n\n# ç±»åæ¦é¤\n\njava è¯­è¨å¼å¥æ³åæ¯ä¸ºäºå¨ç¼è¯æ¶æä¾æ´ä¸¥æ ¼çç±»åæ£æ¥ï¼å¹¶æ¯ææ³åç¼ç¨ãä¸åäº c++ çæ¨¡æ¿æºå¶ï¼java æ³åæ¯ä½¿ç¨ç±»åæ¦é¤æ¥å®ç°çï¼ä½¿ç¨æ³åæ¶ï¼ä»»ä½å·ä½çç±»åä¿¡æ¯é½è¢«æ¦é¤äºã\n\né£ä¹ï¼ç±»åæ¦é¤åäºä»ä¹å¢ï¼å®åäºä»¥ä¸å·¥ä½ï¼\n\n * ææ³åä¸­çææç±»ååæ°æ¿æ¢ä¸º objectï¼å¦ææå®ç±»åè¾¹çï¼åä½¿ç¨ç±»åè¾¹çæ¥æ¿æ¢ãå æ­¤ï¼çæçå­èç ä»åå«æ®éçç±»ï¼æ¥å£åæ¹æ³ã\n * æ¦é¤åºç°çç±»åå£°æï¼å³å»æ <> çåå®¹ãæ¯å¦ t get() æ¹æ³å£°æå°±åæäº object get() ï¼list<string> å°±åæäº listãå¦æå¿è¦ï¼æå¥ç±»åè½¬æ¢ä»¥ä¿æç±»åå®å¨ã\n * çææ¡¥æ¥æ¹æ³ä»¥ä¿çæ©å±æ³åç±»åä¸­çå¤ææ§ãç±»åæ¦é¤ç¡®ä¿ä¸ä¸ºåæ°åç±»ååå»ºæ°ç±»ï¼å æ­¤ï¼æ³åä¸ä¼äº§çè¿è¡æ¶å¼éã\n\nè®©æä»¬æ¥çä¸ä¸ªç¤ºä¾ï¼\n\npublic class genericserasuretypedemo {\n    public static void main(string[] args) {\n        list<object> list1 = new arraylist<object>();\n        list<string> list2 = new arraylist<string>();\n        system.out.println(list1.getclass());\n        system.out.println(list2.getclass());\n    }\n}\n// output:\n// class java.util.arraylist\n// class java.util.arraylist\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> ä¸é¢çä¾å­ä¸­ï¼è½ç¶æå®äºä¸åçç±»ååæ°ï¼ä½æ¯ list1 å list2 çç±»ä¿¡æ¯å´æ¯ä¸æ ·çã\n> \n> è¿æ¯å ä¸ºï¼ä½¿ç¨æ³åæ¶ï¼ä»»ä½å·ä½çç±»åä¿¡æ¯é½è¢«æ¦é¤äºãè¿æå³çï¼arraylist<object> å arraylist<string> å¨è¿è¡æ¶ï¼jvm å°å®ä»¬è§ä¸ºåä¸ç±»åã\n\njava æ³åçå®ç°æ¹å¼ä¸å¤ªä¼éï¼ä½è¿æ¯å ä¸ºæ³åæ¯å¨ jdk5 æ¶å¼å¥çï¼ä¸ºäºå¼å®¹èä»£ç ï¼å¿é¡»å¨è®¾è®¡ä¸åä¸å®çæä¸­ã\n\n\n# æ³ååç»§æ¿\n\næ³åä¸è½ç¨äºæ¾å¼å°å¼ç¨è¿è¡æ¶ç±»åçæä½ä¹ä¸­ï¼ä¾å¦ï¼è½¬åãinstanceof æä½å new è¡¨è¾¾å¼ãå ä¸ºææå³äºåæ°çç±»åä¿¡æ¯é½ä¸¢å¤±äºãå½ä½ å¨ç¼åæ³åä»£ç æ¶ï¼å¿é¡»æ¶å»æéèªå·±ï¼ä½ åªæ¯çèµ·æ¥å¥½åæ¥ææå³åæ°çç±»åä¿¡æ¯èå·²ã\n\næ­£æ¯ç±äºæ³åæ¶åºäºç±»åæ¦é¤å®ç°çï¼æä»¥ï¼æ³åç±»åæ æ³åä¸è½¬åã\n\n> åä¸è½¬åæ¯æç¨å­ç±»å®ä¾å»åå§åç¶ç±»ï¼è¿æ¯é¢åå¯¹è±¡ä¸­å¤æçéè¦è¡¨ç°ã\n\n\n\ninteger ç»§æ¿äº objectï¼arraylist ç»§æ¿äº listï¼ä½æ¯ list<interger> å´å¹¶éç»§æ¿äº list<object>ã\n\nè¿æ¯å ä¸ºï¼æ³åç±»å¹¶æ²¡æèªå·±ç¬æç class ç±»å¯¹è±¡ãæ¯å¦ï¼å¹¶ä¸å­å¨ list<object>.class ææ¯ list<interger>.classï¼java ç¼è¯å¨ä¼å°äºèé½è§ä¸º list.classã\n\nlist<integer> list = new arraylist<>();\nlist<object> list2 = list; // erorr\n\n\n\n# ç±»åè¾¹ç\n\nææ¶æ¨å¯è½å¸æéå¶å¯å¨åæ°åç±»åä¸­ç¨ä½ç±»ååæ°çç±»åãç±»åè¾¹çå¯ä»¥å¯¹æ³åçç±»ååæ°è®¾ç½®éå¶æ¡ä»¶ãä¾å¦ï¼å¯¹æ°å­è¿è¡æä½çæ¹æ³å¯è½åªæ³æ¥å number æå¶å­ç±»çå®ä¾ã\n\nè¦å£°ææçç±»ååæ°ï¼è¯·ååºç±»ååæ°çåç§°ï¼ç¶åæ¯ extends å³é®å­ï¼åè·å¶éå¶ç±»ææ¥å£ã\n\nç±»åè¾¹ççè¯­æ³å½¢å¼å¦ä¸ï¼\n\n<t extends xxx>\n\n\nç¤ºä¾ï¼\n\npublic class genericsextendsdemo01 {\n    static <t extends comparable<t>> t max(t x, t y, t z) {\n        t max = x; // åè®¾xæ¯åå§æå¤§å¼\n        if (y.compareto(max) > 0) {\n            max = y; //y æ´å¤§\n        }\n        if (z.compareto(max) > 0) {\n            max = z; // ç°å¨ z æ´å¤§\n        }\n        return max; // è¿åæå¤§å¯¹è±¡\n    }\n\n    public static void main(string[] args) {\n        system.out.println(max(3, 4, 5));\n        system.out.println(max(6.6, 8.8, 7.7));\n        system.out.println(max("pear", "apple", "orange"));\n    }\n}\n// output:\n// 5\n// 8.8\n// pear\n\n\n> ç¤ºä¾è¯´æï¼\n> \n> ä¸é¢çç¤ºä¾å£°æäºä¸ä¸ªæ³åæ¹æ³ï¼ç±»ååæ° t extends comparable<t> è¡¨æä¼ å¥æ¹æ³ä¸­çç±»åå¿é¡»å®ç°äº comparable æ¥å£ã\n\nç±»åè¾¹çå¯ä»¥è®¾ç½®å¤ä¸ªï¼è¯­æ³å½¢å¼å¦ä¸ï¼\n\n<t extends b1 & b2 & b3>\n\n\n> ð æ³¨æï¼extends å³é®å­åé¢çç¬¬ä¸ä¸ªç±»ååæ°å¯ä»¥æ¯ç±»ææ¥å£ï¼å¶ä»ç±»ååæ°åªè½æ¯æ¥å£ã\n\nç¤ºä¾ï¼\n\npublic class genericsextendsdemo02 {\n    static class a { /* ... */ }\n    interface b { /* ... */ }\n    interface c { /* ... */ }\n    static class d1 <t extends a & b & c> { /* ... */ }\n    static class d2 <t extends b & a & c> { /* ... */ } // ç¼è¯æ¥é\n    static class e extends a implements b, c { /* ... */ }\n\n    public static void main(string[] args) {\n        d1<e> demo1 = new d1<>();\n        system.out.println(demo1.getclass().tostring());\n        d1<string> demo2 = new d1<>(); // ç¼è¯æ¥é\n    }\n}\n\n\n\n# ç±»åééç¬¦\n\nç±»åééç¬¦ä¸è¬æ¯ä½¿ç¨ ? ä»£æ¿å·ä½çç±»ååæ°ãä¾å¦ list<?> å¨é»è¾ä¸æ¯ list<string> ï¼list<integer> ç­ææ list<å·ä½ç±»åå®å> çç¶ç±»ã\n\n\n# ä¸çééç¬¦\n\nå¯ä»¥ä½¿ç¨**ä¸çééç¬¦**æ¥ç¼©å°ç±»ååæ°çç±»åèå´ã\n\nå®çè¯­æ³å½¢å¼ä¸ºï¼<? extends number>\n\npublic class genericsupperboundedwildcarddemo {\n    public static double sumoflist(list<? extends number> list) {\n        double s = 0.0;\n        for (number n : list) {\n            s += n.doublevalue();\n        }\n        return s;\n    }\n\n    public static void main(string[] args) {\n        list<integer> li = arrays.aslist(1, 2, 3);\n        system.out.println("sum = " + sumoflist(li));\n    }\n}\n// output:\n// sum = 6.0\n\n\n\n# ä¸çééç¬¦\n\n**ä¸çééç¬¦**å°æªç¥ç±»åéå¶ä¸ºè¯¥ç±»åçç¹å®ç±»åæè¶ç±»ç±»åã\n\n> ð æ³¨æï¼ä¸çééç¬¦åä¸çééç¬¦ä¸è½åæ¶ä½¿ç¨ã\n\nå®çè¯­æ³å½¢å¼ä¸ºï¼<? super number>\n\npublic class genericslowerboundedwildcarddemo {\n    public static void addnumbers(list<? super integer> list) {\n        for (int i = 1; i <= 5; i++) {\n            list.add(i);\n        }\n    }\n\n    public static void main(string[] args) {\n        list<integer> list = new arraylist<>();\n        addnumbers(list);\n        system.out.println(arrays.deeptostring(list.toarray()));\n    }\n}\n// output:\n// [1, 2, 3, 4, 5]\n\n\n\n# æ çééç¬¦\n\næ çééç¬¦æä¸¤ç§åºç¨åºæ¯ï¼\n\n * å¯ä»¥ä½¿ç¨ object ç±»ä¸­æä¾çåè½æ¥å®ç°çæ¹æ³ã\n * ä½¿ç¨ä¸ä¾èµäºç±»ååæ°çæ³åç±»ä¸­çæ¹æ³ã\n\nè¯­æ³å½¢å¼ï¼<?>\n\npublic class genericsunboundedwildcarddemo {\n    public static void printlist(list<?> list) {\n        for (object elem : list) {\n            system.out.print(elem + " ");\n        }\n        system.out.println();\n    }\n\n    public static void main(string[] args) {\n        list<integer> li = arrays.aslist(1, 2, 3);\n        list<string> ls = arrays.aslist("one", "two", "three");\n        printlist(li);\n        printlist(ls);\n    }\n}\n// output:\n// 1 2 3\n// one two three\n\n\n\n# ééç¬¦ååä¸è½¬å\n\nåé¢ï¼æä»¬æå°ï¼æ³åä¸è½åä¸è½¬åãä½æ¯ï¼æä»¬å¯ä»¥éè¿ä½¿ç¨ééç¬¦æ¥åä¸è½¬åã\n\npublic class genericswildcarddemo {\n    public static void main(string[] args) {\n        list<integer> intlist = new arraylist<>();\n        list<number> numlist = intlist;  // error\n\n        list<? extends integer> intlist2 = new arraylist<>();\n        list<? extends number> numlist2 = intlist2;  // ok\n    }\n}\n\n\n> æ©å±éè¯»ï¼oracle æ³åææ¡£\n\n\n# æ³åççº¦æ\n\n * æ³åç±»åçç±»ååæ°ä¸è½æ¯å¼ç±»å\n\npair<int, char> p = new pair<>(8, \'a\');  // ç¼è¯éè¯¯\n\n\n * ä¸è½åå»ºç±»ååæ°çå®ä¾\n\npublic static <e> void append(list<e> list) {\n    e elem = new e();  // ç¼è¯éè¯¯\n    list.add(elem);\n}\n\n\n * ä¸è½å£°æç±»åä¸ºç±»ååæ°çéææå\n\npublic class mobiledevice<t> {\n    private static t os; // error\n\n    // ...\n}\n\n\n * ç±»ååæ°ä¸è½ä½¿ç¨ç±»åè½¬æ¢æ instanceof\n\npublic static <e> void rtti(list<e> list) {\n    if (list instanceof arraylist<integer>) {  // ç¼è¯éè¯¯\n        // ...\n    }\n}\n\n\nlist<integer> li = new arraylist<>();\nlist<number>  ln = (list<number>) li;  // ç¼è¯éè¯¯\n\n\n * ä¸è½åå»ºç±»ååæ°çæ°ç»\n\nlist<integer>[] arrayoflists = new list<integer>[2];  // ç¼è¯éè¯¯\n\n\n * ä¸è½åå»ºãcatch æ throw åæ°åç±»åå¯¹è±¡\n\n// extends throwable indirectly\nclass mathexception<t> extends exception { /* ... */ }    // ç¼è¯éè¯¯\n\n// extends throwable directly\nclass queuefullexception<t> extends throwable { /* ... */ // ç¼è¯éè¯¯\n\n\npublic static <t extends exception, j> void execute(list<j> jobs) {\n    try {\n        for (j job : jobs)\n            // ...\n    } catch (t e) {   // compile-time error\n        // ...\n    }\n}\n\n\n * ä»ä»æ¯æ³åç±»ç¸åï¼èç±»ååæ°ä¸åçæ¹æ³ä¸è½éè½½\n\npublic class example {\n    public void print(set<string> strset) { }\n    public void print(set<integer> intset) { } // ç¼è¯éè¯¯\n}\n\n\n\n# æ³åæä½³å®è·µ\n\n\n# æ³åå½å\n\næ³åä¸äºçº¦å®ä¿æçå½åï¼\n\n * e - element\n * k - key\n * n - number\n * t - type\n * v - value\n * s,u,v etc. - 2nd, 3rd, 4th types\n\n\n# ä½¿ç¨æ³åçå»ºè®®\n\n * æ¶é¤ç±»åæ£æ¥åè­¦\n * list ä¼åäºæ°ç»\n * ä¼åèèä½¿ç¨æ³åæ¥æé«ä»£ç éç¨æ§\n * ä¼åèèæ³åæ¹æ³æ¥éå®æ³åçèå´\n * å©ç¨æéå¶ééç¬¦æ¥æå api ççµæ´»æ§\n * ä¼åèèç±»åå®å¨çå¼æå®¹å¨\n\n\n# å°ç»\n\n\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * effective java\n * oracle æ³åææ¡£\n * java æ³åè¯¦è§£',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java åå°åå¨æä»£ç",frontmatter:{title:"æ·±å¥çè§£ Java åå°åå¨æä»£ç",date:"2020-06-04T13:51:01.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","åå°","å¨æä»£ç"],permalink:"/pages/0d066a/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/10.Java%E5%8F%8D%E5%B0%84.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/10.Javaåå°.md",key:"v-604f94c1",path:"/pages/0d066a/",headers:[{level:2,title:"åå°ç®ä»",slug:"åå°ç®ä»",normalizedTitle:"åå°ç®ä»",charIndex:24},{level:3,title:"ä»ä¹æ¯åå°",slug:"ä»ä¹æ¯åå°",normalizedTitle:"ä»ä¹æ¯åå°",charIndex:35},{level:3,title:"åå°çåºç¨åºæ¯",slug:"åå°çåºç¨åºæ¯",normalizedTitle:"åå°çåºç¨åºæ¯",charIndex:157},{level:3,title:"åå°çç¼ºç¹",slug:"åå°çç¼ºç¹",normalizedTitle:"åå°çç¼ºç¹",charIndex:524},{level:2,title:"åå°æºå¶",slug:"åå°æºå¶",normalizedTitle:"åå°æºå¶",charIndex:118},{level:3,title:"ç±»å è½½è¿ç¨",slug:"ç±»å è½½è¿ç¨",normalizedTitle:"ç±»å è½½è¿ç¨",charIndex:800},{level:3,title:"Class å¯¹è±¡",slug:"class-å¯¹è±¡",normalizedTitle:"class å¯¹è±¡",charIndex:1044},{level:3,title:"æ¹æ³çåå°è°ç¨",slug:"æ¹æ³çåå°è°ç¨",normalizedTitle:"æ¹æ³çåå°è°ç¨",charIndex:1555},{level:3,title:"åå°è°ç¨çå¼é",slug:"åå°è°ç¨çå¼é",normalizedTitle:"åå°è°ç¨çå¼é",charIndex:6818},{level:2,title:"ä½¿ç¨åå°",slug:"ä½¿ç¨åå°",normalizedTitle:"ä½¿ç¨åå°",charIndex:1126},{level:3,title:"java.lang.reflect å",slug:"java-lang-reflect-å",normalizedTitle:"java.lang.reflect å",charIndex:7484},{level:3,title:"è·å Class å¯¹è±¡",slug:"è·å-class-å¯¹è±¡",normalizedTitle:"è·å class å¯¹è±¡",charIndex:7884},{level:3,title:"å¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾",slug:"å¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾",normalizedTitle:"å¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾",charIndex:10050},{level:3,title:"åå»ºå®ä¾",slug:"åå»ºå®ä¾",normalizedTitle:"åå»ºå®ä¾",charIndex:10556},{level:3,title:"åå»ºæ°ç»å®ä¾",slug:"åå»ºæ°ç»å®ä¾",normalizedTitle:"åå»ºæ°ç»å®ä¾",charIndex:11340},{level:3,title:"Field",slug:"field",normalizedTitle:"field",charIndex:7654},{level:3,title:"Method",slug:"method",normalizedTitle:"method",charIndex:1576},{level:3,title:"Constructor",slug:"constructor",normalizedTitle:"constructor",charIndex:7723},{level:3,title:"ç»å¼è®¿é®éå¶",slug:"ç»å¼è®¿é®éå¶",normalizedTitle:"ç»å¼è®¿é®éå¶",charIndex:15997},{level:2,title:"å¨æä»£ç",slug:"å¨æä»£ç",normalizedTitle:"å¨æä»£ç",charIndex:15},{level:3,title:"éæä»£ç",slug:"éæä»£ç",normalizedTitle:"éæä»£ç",charIndex:16299},{level:3,title:"JDK å¨æä»£ç",slug:"jdk-å¨æä»£ç",normalizedTitle:"jdk å¨æä»£ç",charIndex:17108},{level:4,title:"InvocationHandler æ¥å£",slug:"invocationhandler-æ¥å£",normalizedTitle:"invocationhandler æ¥å£",charIndex:17796},{level:4,title:"Proxy ç±»",slug:"proxy-ç±»",normalizedTitle:"proxy ç±»",charIndex:7851},{level:4,title:"JDK å¨æä»£çå®ä¾",slug:"jdk-å¨æä»£çå®ä¾",normalizedTitle:"jdk å¨æä»£çå®ä¾",charIndex:18952},{level:4,title:"JDK å¨æä»£çå°ç»",slug:"jdk-å¨æä»£çå°ç»",normalizedTitle:"jdk å¨æä»£çå°ç»",charIndex:22967},{level:3,title:"CGLIB å¨æä»£ç",slug:"cglib-å¨æä»£ç",normalizedTitle:"cglib å¨æä»£ç",charIndex:23156},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:23531}],headersStr:"åå°ç®ä» ä»ä¹æ¯åå° åå°çåºç¨åºæ¯ åå°çç¼ºç¹ åå°æºå¶ ç±»å è½½è¿ç¨ Class å¯¹è±¡ æ¹æ³çåå°è°ç¨ åå°è°ç¨çå¼é ä½¿ç¨åå° java.lang.reflect å è·å Class å¯¹è±¡ å¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾ åå»ºå®ä¾ åå»ºæ°ç»å®ä¾ Field Method Constructor ç»å¼è®¿é®éå¶ å¨æä»£ç éæä»£ç JDK å¨æä»£ç InvocationHandler æ¥å£ Proxy ç±» JDK å¨æä»£çå®ä¾ JDK å¨æä»£çå°ç» CGLIB å¨æä»£ç åèèµæ",content:'# æ·±å¥çè§£ Java åå°åå¨æä»£ç\n\n\n# åå°ç®ä»\n\n\n\n\n# ä»ä¹æ¯åå°\n\nåå°(Reflection)æ¯ Java ç¨åºå¼åè¯­è¨çç¹å¾ä¹ä¸ï¼å®åè®¸è¿è¡ä¸­ç Java ç¨åºè·åèªèº«çä¿¡æ¯ï¼å¹¶ä¸å¯ä»¥æä½ç±»æå¯¹è±¡çåé¨å±æ§ã\n\néè¿åå°æºå¶ï¼å¯ä»¥å¨è¿è¡æ¶è®¿é® Java å¯¹è±¡çå±æ§ï¼æ¹æ³ï¼æé æ¹æ³ç­ã\n\n\n# åå°çåºç¨åºæ¯\n\nåå°çä¸»è¦åºç¨åºæ¯æï¼\n\n * å¼åéç¨æ¡æ¶ - åå°æéè¦çç¨éå°±æ¯å¼ååç§éç¨æ¡æ¶ãå¾å¤æ¡æ¶ï¼æ¯å¦ Springï¼é½æ¯éç½®åçï¼æ¯å¦éè¿ XML æä»¶éç½® JavaBeanãFilter ç­ï¼ï¼ä¸ºäºä¿è¯æ¡æ¶çéç¨æ§ï¼å®ä»¬å¯è½éè¦æ ¹æ®éç½®æä»¶å è½½ä¸åçå¯¹è±¡æç±»ï¼è°ç¨ä¸åçæ¹æ³ï¼è¿ä¸ªæ¶åå°±å¿é¡»ç¨å°åå°ââè¿è¡æ¶å¨æå è½½éè¦å è½½çå¯¹è±¡ã\n * å¨æä»£ç - å¨åé¢ç¼ç¨ï¼AOPï¼ä¸­ï¼éè¦æ¦æªç¹å®çæ¹æ³ï¼éå¸¸ï¼ä¼éæ©å¨æä»£çæ¹å¼ãè¿æ¶ï¼å°±éè¦åå°ææ¯æ¥å®ç°äºã\n * æ³¨è§£ - æ³¨è§£æ¬èº«ä»ä»æ¯èµ·å°æ è®°ä½ç¨ï¼å®éè¦å©ç¨åå°æºå¶ï¼æ ¹æ®æ³¨è§£æ è®°å»è°ç¨æ³¨è§£è§£éå¨ï¼æ§è¡è¡ä¸ºãå¦ææ²¡æåå°æºå¶ï¼æ³¨è§£å¹¶ä¸æ¯æ³¨éæ´æç¨ã\n * å¯æ©å±æ§åè½ - åºç¨ç¨åºå¯ä»¥éè¿ä½¿ç¨å®å¨éå®åç§°åå»ºå¯æ©å±æ§å¯¹è±¡å®ä¾æ¥ä½¿ç¨å¤é¨çç¨æ·å®ä¹ç±»ã\n\n\n# åå°çç¼ºç¹\n\n * æ§è½å¼é - ç±äºåå°æ¶åå¨æè§£æçç±»åï¼å æ­¤æ æ³æ§è¡æäº Java èææºä¼åãå æ­¤ï¼åå°æä½çæ§è½è¦æ¯éåå°æä½çæ§è½è¦å·®ï¼åºè¯¥å¨æ§è½ææçåºç¨ç¨åºä¸­é¢ç¹è°ç¨çä»£ç æ®µä¸­é¿åã\n * ç ´åå°è£æ§ - åå°è°ç¨æ¹æ³æ¶å¯ä»¥å¿½ç¥æéæ£æ¥ï¼å æ­¤å¯è½ä¼ç ´åå°è£æ§èå¯¼è´å®å¨é®é¢ã\n * åé¨æå - ç±äºåå°åè®¸ä»£ç æ§è¡å¨éåå°ä»£ç ä¸­éæ³çæä½ï¼ä¾å¦è®¿é®ç§æå­æ®µåæ¹æ³ï¼æä»¥åå°çä½¿ç¨å¯è½ä¼å¯¼è´ææ³ä¸å°çå¯ä½ç¨ï¼è¿å¯è½ä¼å¯¼è´ä»£ç åè½å¤±å¸¸å¹¶å¯è½ç ´åå¯ç§»æ¤æ§ãåå°ä»£ç æç ´äºæ½è±¡ï¼å æ­¤å¯è½ä¼éçå¹³å°çåçº§èæ¹åè¡ä¸ºã\n\n\n# åå°æºå¶\n\n\n# ç±»å è½½è¿ç¨\n\n\n\nç±»å è½½çå®æ´è¿ç¨å¦ä¸ï¼\n\n 1. å¨ç¼è¯æ¶ï¼Java ç¼è¯å¨ç¼è¯å¥½ .java æä»¶ä¹åï¼å¨ç£çä¸­äº§ç .class æä»¶ã.class æä»¶æ¯äºè¿å¶æä»¶ï¼åå®¹æ¯åªæ JVM è½å¤è¯å«çæºå¨ç ã\n 2. JVM ä¸­çç±»å è½½å¨è¯»åå­èç æä»¶ï¼ååºäºè¿å¶æ°æ®ï¼å è½½å°åå­ä¸­ï¼è§£æ.class æä»¶åçä¿¡æ¯ãç±»å è½½å¨ä¼æ ¹æ®ç±»çå¨éå®åæ¥è·åæ­¤ç±»çäºè¿å¶å­èæµï¼ç¶åï¼å°å­èæµæä»£è¡¨çéæå­å¨ç»æè½¬åä¸ºæ¹æ³åºçè¿è¡æ¶æ°æ®ç»æï¼æ¥çï¼å¨åå­ä¸­çæä»£è¡¨è¿ä¸ªç±»ç java.lang.Class å¯¹è±¡ã\n 3. å è½½ç»æåï¼JVM å¼å§è¿è¡è¿æ¥é¶æ®µï¼åå«éªè¯ãåå¤ãåå§åï¼ãç»è¿è¿ä¸ç³»åæä½ï¼ç±»çåéä¼è¢«åå§åã\n\n\n# Class å¯¹è±¡\n\nè¦æ³ä½¿ç¨åå°ï¼é¦åéè¦è·å¾å¾æä½çç±»æå¯¹åºç Class å¯¹è±¡ãJava ä¸­ï¼æ è®ºçææä¸ªç±»çå¤å°ä¸ªå¯¹è±¡ï¼è¿äºå¯¹è±¡é½ä¼å¯¹åºäºåä¸ä¸ª Class å¯¹è±¡ãè¿ä¸ª Class å¯¹è±¡æ¯ç± JVM çæçï¼éè¿å®è½å¤è·ææ´ä¸ªç±»çç»æãæä»¥ï¼java.lang.Class å¯ä»¥è§ä¸ºææåå° API çå¥å£ç¹ã\n\nåå°çæ¬è´¨å°±æ¯ï¼å¨è¿è¡æ¶ï¼æ Java ç±»ä¸­çåç§æåæ å°æä¸ä¸ªä¸ªç Java å¯¹è±¡ã\n\nä¸¾ä¾æ¥è¯´ï¼åå¦å®ä¹äºä»¥ä¸ä»£ç ï¼\n\nUser user = new User();\n\n\næ­¥éª¤è¯´æï¼\n\n 1. JVM å è½½æ¹æ³çæ¶åï¼éå° new User()ï¼JVM ä¼æ ¹æ® User çå¨éå®åå»å è½½ User.class ã\n 2. JVM ä¼å»æ¬å°ç£çæ¥æ¾ User.class æä»¶å¹¶å è½½ JVM åå­ä¸­ã\n 3. JVM éè¿è°ç¨ç±»å è½½å¨èªå¨åå»ºè¿ä¸ªç±»å¯¹åºç Class å¯¹è±¡ï¼å¹¶ä¸å­å¨å¨ JVM çæ¹æ³åºãæ³¨æï¼ä¸ä¸ªç±»æä¸åªæä¸ä¸ª Class å¯¹è±¡ã\n\n\n# æ¹æ³çåå°è°ç¨\n\næ¹æ³çåå°è°ç¨ï¼ä¹å°±æ¯ Method.invoke æ¹æ³ã\n\nMethod.invoke æ¹æ³æºç ï¼\n\npublic final class Method extends Executable {\n  ...\n  public Object invoke(Object obj, Object... args) throws ... {\n    ... // æéæ£æ¥\n    MethodAccessor ma = methodAccessor;\n    if (ma == null) {\n      ma = acquireMethodAccessor();\n    }\n    return ma.invoke(obj, args);\n  }\n}\n\n\nMethod.invoke æ¹æ³å®éä¸å§æ´¾ç» MethodAccessor æ¥å£æ¥å¤çãå®æä¸¤ä¸ªå·²æçå·ä½å®ç°ï¼\n\n * NativeMethodAccessorImplï¼æ¬å°æ¹æ³æ¥å®ç°åå°è°ç¨\n * DelegatingMethodAccessorImplï¼å§æ´¾æ¨¡å¼æ¥å®ç°åå°è°ç¨\n\næ¯ä¸ª Method å®ä¾çç¬¬ä¸æ¬¡åå°è°ç¨é½ä¼çæä¸ä¸ªå§æ´¾å®ç°ï¼DelegatingMethodAccessorImplï¼ï¼å®æå§æ´¾çå·ä½å®ç°ä¾¿æ¯ä¸ä¸ªæ¬å°å®ç°ï¼NativeMethodAccessorImplï¼ãæ¬å°å®ç°éå¸¸å®¹æçè§£ãå½è¿å¥äº Java èææºåé¨ä¹åï¼æä»¬ä¾¿æ¥æäº Method å®ä¾ææåæ¹æ³çå·ä½å°åãè¿æ¶åï¼åå°è°ç¨æ éå°±æ¯å°ä¼ å¥çåæ°åå¤å¥½ï¼ç¶åè°ç¨è¿å¥ç®æ æ¹æ³ã\n\nãç¤ºä¾ãéè¿æåºå¼å¸¸æ¹å¼ æå° Method.invoke è°ç¨è½¨è¿¹\n\npublic class MethodDemo01 {\n\n    public static void target(int i) {\n        new Exception("#" + i).printStackTrace();\n    }\n\n    public static void main(String[] args) throws Exception {\n        Class<?> clazz = Class.forName("io.github.dunwu.javacore.reflect.MethodDemo01");\n        Method method = clazz.getMethod("target", int.class);\n        method.invoke(null, 0);\n    }\n\n}\n// Output:\n// java.lang.Exception: #0\n//     at io.github.dunwu.javacore.reflect.MethodDemo01.target(MethodDemo01.java:12)\n//     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n//     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\n\nåè°ç¨ DelegatingMethodAccessorImplï¼ç¶åè°ç¨ NativeMethodAccessorImplï¼æåè°ç¨å®éæ¹æ³ã\n\nä¸ºä»ä¹åå°è°ç¨DelegatingMethodAccessorImpl ä½ä¸ºä¸­é´å±ï¼èä¸æ¯ç´æ¥äº¤ç»æ¬å°å®ç°ï¼\n\nå¶å®ï¼Java çåå°è°ç¨æºå¶è¿è®¾ç«äºå¦ä¸ç§å¨æçæå­èç çå®ç°ï¼ä¸ç§°å¨æå®ç°ï¼ï¼ç´æ¥ä½¿ç¨ invoke æä»¤æ¥è°ç¨ç®æ æ¹æ³ãä¹æä»¥éç¨å§æ´¾å®ç°ï¼ä¾¿æ¯ä¸ºäºè½å¤å¨æ¬å°å®ç°ä»¥åå¨æå®ç°ä¸­åæ¢ãå¨æå®ç°åæ¬å°å®ç°ç¸æ¯ï¼å¶è¿è¡æçè¦å¿«ä¸ 20 åãè¿æ¯å ä¸ºå¨æå®ç°æ éç»è¿ Java å° C++ åå° Java çåæ¢ï¼ä½ç±äºçæå­èç ååèæ¶ï¼ä»è°ç¨ä¸æ¬¡çè¯ï¼åèæ¯æ¬å°å®ç°è¦å¿«ä¸ 3 å° 4 åã\n\nèèå°è®¸å¤åå°è°ç¨ä»ä¼æ§è¡ä¸æ¬¡ï¼Java èææºè®¾ç½®äºä¸ä¸ªéå¼ 15ï¼å¯ä»¥éè¿ -Dsun.reflect.inflationThreshold æ¥è°æ´ï¼ï¼å½æä¸ªåå°è°ç¨çè°ç¨æ¬¡æ°å¨ 15 ä¹ä¸æ¶ï¼éç¨æ¬å°å®ç°ï¼å½è¾¾å° 15 æ¶ï¼ä¾¿å¼å§å¨æçæå­èç ï¼å¹¶å°å§æ´¾å®ç°çå§æ´¾å¯¹è±¡åæ¢è³å¨æå®ç°ï¼è¿ä¸ªè¿ç¨æä»¬ç§°ä¹ä¸º Inflationã\n\nãç¤ºä¾ãæ§è¡ java -verbose:class MethodDemo02 å¯å¨\n\npublic class MethodDemo02 {\n\n    public static void target(int i) {\n        new Exception("#" + i).printStackTrace();\n    }\n\n    public static void main(String[] args) throws Exception {\n        Class<?> klass = Class.forName("io.github.dunwu.javacore.reflect.MethodDemo02");\n        Method method = klass.getMethod("target", int.class);\n        for (int i = 0; i < 20; i++) {\n            method.invoke(null, i);\n        }\n    }\n\n}\n\n\nè¾åºåå®¹ï¼\n\n// ...çç¥\njava.lang.Exception: #14\n        at io.github.dunwu.javacore.reflect.MethodDemo02.target(MethodDemo02.java:13)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at io.github.dunwu.javacore.reflect.MethodDemo02.main(MethodDemo02.java:20)\n[Loaded sun.reflect.ClassFileConstants from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.AccessorGenerator from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.MethodAccessorGenerator from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.ByteVectorFactory from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.ByteVector from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.ByteVectorImpl from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.ClassFileAssembler from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.UTF8 from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.Label from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.Label$PatchInfo from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded java.util.ArrayList$Itr from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.MethodAccessorGenerator$1 from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.ClassDefiner from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.ClassDefiner$1 from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[Loaded sun.reflect.GeneratedMethodAccessor1 from __JVM_DefineClass__]\njava.lang.Exception: #15\n        at io.github.dunwu.javacore.reflect.MethodDemo02.target(MethodDemo02.java:13)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at io.github.dunwu.javacore.reflect.MethodDemo02.main(MethodDemo02.java:20)\n[Loaded java.util.concurrent.ConcurrentHashMap$ForwardingNode from D:\\Tools\\Java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\njava.lang.Exception: #16\n        at io.github.dunwu.javacore.reflect.MethodDemo02.target(MethodDemo02.java:13)\n        at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at io.github.dunwu.javacore.reflect.MethodDemo02.main(MethodDemo02.java:20)\n// ...çç¥\n\n\nå¯ä»¥çå°ï¼ä»ç¬¬ 16 æ¬¡å¼å§åï¼é½æ¯ä½¿ç¨ DelegatingMethodAccessorImpl ï¼ä¸åä½¿ç¨æ¬å°å®ç° NativeMethodAccessorImplã\n\n\n# åå°è°ç¨çå¼é\n\næ¹æ³çåå°è°ç¨ä¼å¸¦æ¥ä¸å°æ§è½å¼éï¼åå ä¸»è¦æä¸ä¸ªï¼\n\n * åé¿åæ°æ¹æ³å¯¼è´ç Object æ°ç»\n * åºæ¬ç±»åçèªå¨è£ç®±ãæç®±\n * è¿ææéè¦çæ¹æ³åè\n\nClass.forName ä¼è°ç¨æ¬å°æ¹æ³ï¼Class.getMethod åä¼éåè¯¥ç±»çå¬ææ¹æ³ãå¦ææ²¡æå¹éå°ï¼å®è¿å°éåç¶ç±»çå¬ææ¹æ³ãå¯æ³èç¥ï¼è¿ä¸¤ä¸ªæä½é½éå¸¸è´¹æ¶ã\n\n> æ³¨æï¼ä»¥ getMethod ä¸ºä»£è¡¨çæ¥æ¾æ¹æ³æä½ï¼ä¼è¿åæ¥æ¾å¾å°ç»æçä¸ä»½æ·è´ãå æ­¤ï¼æä»¬åºå½é¿åå¨ç­ç¹ä»£ç ä¸­ä½¿ç¨è¿å Method æ°ç»ç getMethods æè getDeclaredMethods æ¹æ³ï¼ä»¥åå°ä¸å¿è¦çå ç©ºé´æ¶èãå¨å®è·µä¸­ï¼æä»¬å¾å¾ä¼å¨åºç¨ç¨åºä¸­ç¼å­ Class.forName å Class.getMethod çç»æã\n\nä¸é¢åªå³æ³¨åå°è°ç¨æ¬èº«çæ§è½å¼éã\n\nç¬¬ä¸ï¼ç±äº Method.invoke æ¯ä¸ä¸ªåé¿åæ°æ¹æ³ï¼å¨å­èç å±é¢å®çæåä¸ä¸ªåæ°ä¼æ¯ Object æ°ç»ï¼æå´è¶£çåå­¦ç§ä¸å¯ä»¥ç¨ javap æ¥çï¼ãJava ç¼è¯å¨ä¼å¨æ¹æ³è°ç¨å¤çæä¸ä¸ªé¿åº¦ä¸ºä¼ å¥åæ°æ°éç Object æ°ç»ï¼å¹¶å°ä¼ å¥åæ°ä¸ä¸å­å¨è¿è¯¥æ°ç»ä¸­ã\n\nç¬¬äºï¼ç±äº Object æ°ç»ä¸è½å­å¨åºæ¬ç±»åï¼Java ç¼è¯å¨ä¼å¯¹ä¼ å¥çåºæ¬ç±»ååæ°è¿è¡èªå¨è£ç®±ã\n\nè¿ä¸¤ä¸ªæä½é¤äºå¸¦æ¥æ§è½å¼éå¤ï¼è¿å¯è½å ç¨å åå­ï¼ä½¿å¾ GC æ´å é¢ç¹ãï¼å¦æä½ æå´è¶£çè¯ï¼å¯ä»¥ç¨èææºåæ° -XX:+PrintGC è¯è¯ãï¼é£ä¹ï¼å¦ä½æ¶é¤è¿é¨åå¼éå¢ï¼\n\n\n# ä½¿ç¨åå°\n\n\n# java.lang.reflect å\n\nJava ä¸­ç java.lang.reflect åæä¾äºåå°åè½ãjava.lang.reflect åä¸­çç±»é½æ²¡æ public æé æ¹æ³ã\n\njava.lang.reflect åçæ ¸å¿æ¥å£åç±»å¦ä¸ï¼\n\n * Member æ¥å£ï¼åæ å³äºåä¸ªæå(å­æ®µææ¹æ³)ææé å½æ°çæ è¯ä¿¡æ¯ã\n * Field ç±»ï¼æä¾ä¸ä¸ªç±»çåçä¿¡æ¯ä»¥åè®¿é®ç±»çåçæ¥å£ã\n * Method ç±»ï¼æä¾ä¸ä¸ªç±»çæ¹æ³çä¿¡æ¯ä»¥åè®¿é®ç±»çæ¹æ³çæ¥å£ã\n * Constructor ç±»ï¼æä¾ä¸ä¸ªç±»çæé å½æ°çä¿¡æ¯ä»¥åè®¿é®ç±»çæé å½æ°çæ¥å£ã\n * Array ç±»ï¼è¯¥ç±»æä¾å¨æå°çæåè®¿é® JAVA æ°ç»çæ¹æ³ã\n * Modifier ç±»ï¼æä¾äº static æ¹æ³åå¸¸éï¼å¯¹ç±»åæåè®¿é®ä¿®é¥°ç¬¦è¿è¡è§£ç ã\n * Proxy ç±»ï¼æä¾å¨æå°çæä»£çç±»åç±»å®ä¾çéææ¹æ³ã\n\n\n# è·å Class å¯¹è±¡\n\nè·å Class å¯¹è±¡çä¸ç§æ¹æ³ï¼\n\nï¼1ï¼Class.forName éææ¹æ³\n\nãç¤ºä¾ãä½¿ç¨ Class.forName éææ¹æ³è·å Class å¯¹è±¡\n\npackage io.github.dunwu.javacore.reflect;\n\npublic class ReflectClassDemo01 {\n    public static void main(String[] args) throws ClassNotFoundException {\n        Class c1 = Class.forName("io.github.dunwu.javacore.reflect.ReflectClassDemo01");\n        System.out.println(c1.getCanonicalName());\n\n        Class c2 = Class.forName("[D");\n        System.out.println(c2.getCanonicalName());\n\n        Class c3 = Class.forName("[[Ljava.lang.String;");\n        System.out.println(c3.getCanonicalName());\n    }\n}\n//Output:\n//io.github.dunwu.javacore.reflect.ReflectClassDemo01\n//double[]\n//java.lang.String[][]\n\n\nä½¿ç¨ç±»çå®å¨éå®åæ¥åå°å¯¹è±¡çç±»ãå¸¸è§çåºç¨åºæ¯ä¸ºï¼å¨ JDBC å¼åä¸­å¸¸ç¨æ­¤æ¹æ³å è½½æ°æ®åºé©±å¨ã\n\nï¼2ï¼ç±»å + .class\n\nãç¤ºä¾ãç´æ¥ç¨ç±»å + .class è·å Class å¯¹è±¡\n\npublic class ReflectClassDemo02 {\n    public static void main(String[] args) {\n        boolean b;\n        // Class c = b.getClass(); // ç¼è¯éè¯¯\n        Class c1 = boolean.class;\n        System.out.println(c1.getCanonicalName());\n\n        Class c2 = java.io.PrintStream.class;\n        System.out.println(c2.getCanonicalName());\n\n        Class c3 = int[][][].class;\n        System.out.println(c3.getCanonicalName());\n    }\n}\n//Output:\n//boolean\n//java.io.PrintStream\n//int[][][]\n\n\nï¼3ï¼Object ç getClass æ¹æ³\n\nObject ç±»ä¸­æ getClass æ¹æ³ï¼å ä¸ºææç±»é½ç»§æ¿ Object ç±»ãä»èè°ç¨ Object ç±»æ¥è·å Class å¯¹è±¡ã\n\nãç¤ºä¾ãObject ç getClass æ¹æ³è·å Class å¯¹è±¡\n\npackage io.github.dunwu.javacore.reflect;\n\nimport java.util.HashSet;\nimport java.util.Set;\n\npublic class ReflectClassDemo03 {\n    enum E {A, B}\n\n    public static void main(String[] args) {\n        Class c = "foo".getClass();\n        System.out.println(c.getCanonicalName());\n\n        Class c2 = ReflectClassDemo03.E.A.getClass();\n        System.out.println(c2.getCanonicalName());\n\n        byte[] bytes = new byte[1024];\n        Class c3 = bytes.getClass();\n        System.out.println(c3.getCanonicalName());\n\n        Set<String> set = new HashSet<>();\n        Class c4 = set.getClass();\n        System.out.println(c4.getCanonicalName());\n    }\n}\n//Output:\n//java.lang.String\n//io.github.dunwu.javacore.reflect.ReflectClassDemo.E\n//byte[]\n//java.util.HashSet\n\n\n\n# å¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾\n\nå¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾æä¸¤ç§æ¹å¼ï¼\n\n 1. ç¨ instanceof å³é®å­\n 2. ç¨ Class å¯¹è±¡ç isInstance æ¹æ³ï¼å®æ¯ä¸ä¸ª Native æ¹æ³ï¼\n\nãç¤ºä¾ã\n\npublic class InstanceofDemo {\n    public static void main(String[] args) {\n        ArrayList arrayList = new ArrayList();\n        if (arrayList instanceof List) {\n            System.out.println("ArrayList is List");\n        }\n        if (List.class.isInstance(arrayList)) {\n            System.out.println("ArrayList is List");\n        }\n    }\n}\n//Output:\n//ArrayList is List\n//ArrayList is List\n\n\n\n# åå»ºå®ä¾\n\néè¿åå°æ¥åå»ºå®ä¾å¯¹è±¡ä¸»è¦æä¸¤ç§æ¹å¼ï¼\n\n * ç¨ Class å¯¹è±¡ç newInstance æ¹æ³ã\n * ç¨ Constructor å¯¹è±¡ç newInstance æ¹æ³ã\n\nãç¤ºä¾ã\n\npublic class NewInstanceDemo {\n    public static void main(String[] args)\n        throws IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException {\n        Class<?> c1 = StringBuilder.class;\n        StringBuilder sb = (StringBuilder) c1.newInstance();\n        sb.append("aaa");\n        System.out.println(sb.toString());\n\n        //è·åStringæå¯¹åºçClasså¯¹è±¡\n        Class<?> c2 = String.class;\n        //è·åStringç±»å¸¦ä¸ä¸ªStringåæ°çæé å¨\n        Constructor constructor = c2.getConstructor(String.class);\n        //æ ¹æ®æé å¨åå»ºå®ä¾\n        String str2 = (String) constructor.newInstance("bbb");\n        System.out.println(str2);\n    }\n}\n//Output:\n//aaa\n//bbb\n\n\n\n# åå»ºæ°ç»å®ä¾\n\næ°ç»å¨ Java éæ¯æ¯è¾ç¹æ®çä¸ç§ç±»åï¼å®å¯ä»¥èµå¼ç»ä¸ä¸ªå¯¹è±¡å¼ç¨ãJava ä¸­ï¼éè¿ Array.newInstance åå»ºæ°ç»çå®ä¾ã\n\nãç¤ºä¾ãå©ç¨åå°åå»ºæ°ç»\n\npublic class ReflectArrayDemo {\n    public static void main(String[] args) throws ClassNotFoundException {\n        Class<?> cls = Class.forName("java.lang.String");\n        Object array = Array.newInstance(cls, 25);\n        //å¾æ°ç»éæ·»å åå®¹\n        Array.set(array, 0, "Scala");\n        Array.set(array, 1, "Java");\n        Array.set(array, 2, "Groovy");\n        Array.set(array, 3, "Scala");\n        Array.set(array, 4, "Clojure");\n        //è·åæä¸é¡¹çåå®¹\n        System.out.println(Array.get(array, 3));\n    }\n}\n//Output:\n//Scala\n\n\nå¶ä¸­ç Array ç±»ä¸º java.lang.reflect.Array ç±»ãæä»¬Array.newInstance çååæ¯ï¼\n\npublic static Object newInstance(Class<?> componentType, int length)\n    throws NegativeArraySizeException {\n    return newArray(componentType, length);\n}\n\n\n\n# Field\n\nClass å¯¹è±¡æä¾ä»¥ä¸æ¹æ³è·åå¯¹è±¡çæåï¼Fieldï¼ï¼\n\n * getFiled - æ ¹æ®åç§°è·åå¬æçï¼publicï¼ç±»æåã\n * getDeclaredField - æ ¹æ®åç§°è·åå·²å£°æçç±»æåãä½ä¸è½å¾å°å¶ç¶ç±»çç±»æåã\n * getFields - è·åææå¬æçï¼publicï¼ç±»æåã\n * getDeclaredFields - è·åææå·²å£°æçç±»æåã\n\nç¤ºä¾å¦ä¸ï¼\n\npublic class ReflectFieldDemo {\n    class FieldSpy<T> {\n        public boolean[][] b = { {false, false}, {true, true} };\n        public String name = "Alice";\n        public List<Integer> list;\n        public T val;\n    }\n\n    public static void main(String[] args) throws NoSuchFieldException {\n        Field f1 = FieldSpy.class.getField("b");\n        System.out.format("Type: %s%n", f1.getType());\n\n        Field f2 = FieldSpy.class.getField("name");\n        System.out.format("Type: %s%n", f2.getType());\n\n        Field f3 = FieldSpy.class.getField("list");\n        System.out.format("Type: %s%n", f3.getType());\n\n        Field f4 = FieldSpy.class.getField("val");\n        System.out.format("Type: %s%n", f4.getType());\n    }\n}\n//Output:\n//Type: class [[Z\n//Type: class java.lang.String\n//Type: interface java.util.List\n//Type: class java.lang.Object\n\n\n\n# Method\n\nClass å¯¹è±¡æä¾ä»¥ä¸æ¹æ³è·åå¯¹è±¡çæ¹æ³ï¼Methodï¼ï¼\n\n * getMethod - è¿åç±»ææ¥å£çç¹å®æ¹æ³ãå¶ä¸­ç¬¬ä¸ä¸ªåæ°ä¸ºæ¹æ³åç§°ï¼åé¢çåæ°ä¸ºæ¹æ³åæ°å¯¹åº Class çå¯¹è±¡ã\n * getDeclaredMethod - è¿åç±»ææ¥å£çç¹å®å£°ææ¹æ³ãå¶ä¸­ç¬¬ä¸ä¸ªåæ°ä¸ºæ¹æ³åç§°ï¼åé¢çåæ°ä¸ºæ¹æ³åæ°å¯¹åº Class çå¯¹è±¡ã\n * getMethods - è¿åç±»ææ¥å£çææ public æ¹æ³ï¼åæ¬å¶ç¶ç±»ç public æ¹æ³ã\n * getDeclaredMethods - è¿åç±»ææ¥å£å£°æçæææ¹æ³ï¼åæ¬ publicãprotectedãé»è®¤ï¼åï¼è®¿é®å private æ¹æ³ï¼ä½ä¸åæ¬ç»§æ¿çæ¹æ³ã\n\nè·åä¸ä¸ª Method å¯¹è±¡åï¼å¯ä»¥ç¨ invoke æ¹æ³æ¥è°ç¨è¿ä¸ªæ¹æ³ã\n\ninvoke æ¹æ³çååä¸º:\n\npublic Object invoke(Object obj, Object... args)\n        throws IllegalAccessException, IllegalArgumentException,\n           InvocationTargetException\n\n\nãç¤ºä¾ã\n\npublic class ReflectMethodDemo {\n    public static void main(String[] args)\n        throws NoSuchMethodException, InvocationTargetException, IllegalAccessException {\n\n        // è¿åæææ¹æ³\n        Method[] methods1 = System.class.getDeclaredMethods();\n        System.out.println("System getDeclaredMethods æ¸åï¼æ°é = " + methods1.length + "ï¼ï¼");\n        for (Method m : methods1) {\n            System.out.println(m);\n        }\n\n        // è¿åææ public æ¹æ³\n        Method[] methods2 = System.class.getMethods();\n        System.out.println("System getMethods æ¸åï¼æ°é = " + methods2.length + "ï¼ï¼");\n        for (Method m : methods2) {\n            System.out.println(m);\n        }\n\n        // å©ç¨ Method ç invoke æ¹æ³è°ç¨ System.currentTimeMillis()\n        Method method = System.class.getMethod("currentTimeMillis");\n        System.out.println(method);\n        System.out.println(method.invoke(null));\n    }\n}\n\n\n\n# Constructor\n\nClass å¯¹è±¡æä¾ä»¥ä¸æ¹æ³è·åå¯¹è±¡çæé æ¹æ³ï¼Constructorï¼ï¼\n\n * getConstructor - è¿åç±»çç¹å® public æé æ¹æ³ãåæ°ä¸ºæ¹æ³åæ°å¯¹åº Class çå¯¹è±¡ã\n * getDeclaredConstructor - è¿åç±»çç¹å®æé æ¹æ³ãåæ°ä¸ºæ¹æ³åæ°å¯¹åº Class çå¯¹è±¡ã\n * getConstructors - è¿åç±»çææ public æé æ¹æ³ã\n * getDeclaredConstructors - è¿åç±»çæææé æ¹æ³ã\n\nè·åä¸ä¸ª Constructor å¯¹è±¡åï¼å¯ä»¥ç¨ newInstance æ¹æ³æ¥åå»ºç±»å®ä¾ã\n\nãç¤ºä¾ã\n\npublic class ReflectMethodConstructorDemo {\n    public static void main(String[] args)\n        throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {\n        Constructor<?>[] constructors1 = String.class.getDeclaredConstructors();\n        System.out.println("String getDeclaredConstructors æ¸åï¼æ°é = " + constructors1.length + "ï¼ï¼");\n        for (Constructor c : constructors1) {\n            System.out.println(c);\n        }\n\n        Constructor<?>[] constructors2 = String.class.getConstructors();\n        System.out.println("String getConstructors æ¸åï¼æ°é = " + constructors2.length + "ï¼ï¼");\n        for (Constructor c : constructors2) {\n            System.out.println(c);\n        }\n\n        System.out.println("====================");\n        Constructor constructor = String.class.getConstructor(String.class);\n        System.out.println(constructor);\n        String str = (String) constructor.newInstance("bbb");\n        System.out.println(str);\n    }\n}\n\n\n\n# ç»å¼è®¿é®éå¶\n\nææ¶åï¼æä»¬éè¦éè¿åå°è®¿é®ç§ææåãæ¹æ³ãå¯ä»¥ä½¿ç¨ Constructor/Field/Method.setAccessible(true) æ¥ç»å¼ Java è¯­è¨çè®¿é®éå¶ã\n\n\n# å¨æä»£ç\n\nå¨æä»£çæ¯ä¸ç§æ¹ä¾¿è¿è¡æ¶å¨ææå»ºä»£çãå¨æå¤çä»£çæ¹æ³è°ç¨çæºå¶ï¼å¾å¤åºæ¯é½æ¯å©ç¨ç±»ä¼¼æºå¶åå°çï¼æ¯å¦ç¨æ¥åè£ RPC è°ç¨ãé¢ååé¢çç¼ç¨ï¼AOPï¼ã\n\nå®ç°å¨æä»£ççæ¹å¼å¾å¤ï¼æ¯å¦ JDK èªèº«æä¾çå¨æä»£çï¼å°±æ¯ä¸»è¦å©ç¨äºä¸é¢æå°çåå°æºå¶ãè¿æå¶ä»çå®ç°æ¹å¼ï¼æ¯å¦å©ç¨ä¼ è¯´ä¸­æ´é«æ§è½çå­èç æä½æºå¶ï¼ç±»ä¼¼ ASMãcglibï¼åºäº ASMï¼ãJavassist ç­ã\n\n\n\n\n# éæä»£ç\n\n> éæä»£çå¶å®å°±æ¯æè®¾è®¡æ¨¡å¼ä¸­çä»£çæ¨¡å¼ã\n> \n> ä»£çæ¨¡å¼ä¸ºå¶ä»å¯¹è±¡æä¾ä¸ç§ä»£çä»¥æ§å¶å¯¹è¿ä¸ªå¯¹è±¡çè®¿é®ã\n\n\n\nSubject å®ä¹äº RealSubject å Proxy çå¬å±æ¥å£ï¼è¿æ ·å°±å¨ä»»ä½ä½¿ç¨ RealSubject çå°æ¹é½å¯ä»¥ä½¿ç¨ Proxy ã\n\nabstract class Subject {\n    public abstract void Request();\n}\n\n\nRealSubject å®ä¹ Proxy æä»£è¡¨ççå®å®ä½ã\n\nclass RealSubject extends Subject {\n    @Override\n    public void Request() {\n        System.out.println("çå®çè¯·æ±");\n    }\n}\n\n\nProxy ä¿å­ä¸ä¸ªå¼ç¨ä½¿å¾ä»£çå¯ä»¥è®¿é®å®ä½ï¼å¹¶æä¾ä¸ä¸ªä¸ Subject çæ¥å£ç¸åçæ¥å£ï¼è¿æ ·ä»£çå°±å¯ä»¥ç¨æ¥æ¿ä»£å®ä½ã\n\nclass Proxy extends Subject {\n    private RealSubject real;\n\n    @Override\n    public void Request() {\n        if (null == real) {\n            real = new RealSubject();\n        }\n        real.Request();\n    }\n}\n\n\n> è¯´æï¼\n> \n> éæä»£çæ¨¡å¼åºç¶å¨è®¿é®æ æ³è®¿é®çèµæºï¼å¢å¼ºç°æçæ¥å£ä¸å¡åè½æ¹é¢æå¾å¤§çä¼ç¹ï¼ä½æ¯å¤§éä½¿ç¨è¿ç§éæä»£çï¼ä¼ä½¿æä»¬ç³»ç»åçç±»çè§æ¨¡å¢å¤§ï¼å¹¶ä¸ä¸æç»´æ¤ï¼å¹¶ä¸ç±äº Proxy å RealSubject çåè½æ¬è´¨ä¸æ¯ç¸åçï¼Proxy åªæ¯èµ·å°äºä¸­ä»çä½ç¨ï¼è¿ç§ä»£çå¨ç³»ç»ä¸­çå­å¨ï¼å¯¼è´ç³»ç»ç»ææ¯è¾èè¿åæ¾æ£ã\n\n\n# JDK å¨æä»£ç\n\nä¸ºäºè§£å³éæä»£ççé®é¢ï¼å°±æäºåå»ºå¨æä»£ççæ³æ³ï¼\n\nå¨è¿è¡ç¶æä¸­ï¼éè¦ä»£ççå°æ¹ï¼æ ¹æ® Subject å RealSubjectï¼å¨æå°åå»ºä¸ä¸ª Proxyï¼ç¨å®ä¹åï¼å°±ä¼éæ¯ï¼è¿æ ·å°±å¯ä»¥é¿åäº Proxy è§è²ç class å¨ç³»ç»ä¸­åæçé®é¢äºã\n\n\n\nJava å¨æä»£çåºäºç»å¸ä»£çæ¨¡å¼ï¼å¼å¥äºä¸ä¸ª InvocationHandlerï¼InvocationHandler è´è´£ç»ä¸ç®¡çææçæ¹æ³è°ç¨ã\n\nå¨æä»£çæ­¥éª¤ï¼\n\n 1. è·å RealSubject ä¸çæææ¥å£åè¡¨ï¼\n 2. ç¡®å®è¦çæçä»£çç±»çç±»åï¼é»è®¤ä¸ºï¼com.sun.proxy.$ProxyXXXXï¼\n 3. æ ¹æ®éè¦å®ç°çæ¥å£ä¿¡æ¯ï¼å¨ä»£ç ä¸­å¨æåå»º è¯¥ Proxy ç±»çå­èç ï¼\n 4. å°å¯¹åºçå­èç è½¬æ¢ä¸ºå¯¹åºç class å¯¹è±¡ï¼\n 5. åå»º InvocationHandler å®ä¾ handlerï¼ç¨æ¥å¤ç Proxy æææ¹æ³è°ç¨ï¼\n 6. Proxy ç class å¯¹è±¡ ä»¥åå»ºç handler å¯¹è±¡ä¸ºåæ°ï¼å®ä¾åä¸ä¸ª proxy å¯¹è±¡ã\n\nä»ä¸é¢å¯ä»¥çåºï¼JDK å¨æä»£ççå®ç°æ¯åºäºå®ç°æ¥å£çæ¹å¼ï¼ä½¿å¾ Proxy å RealSubject å·æç¸åçåè½ã\n\nä½å¶å®è¿æä¸ç§æè·¯ï¼éè¿ç»§æ¿ãå³ï¼è®© Proxy ç»§æ¿ RealSubjectï¼è¿æ ·äºèåæ ·å·æç¸åçåè½ï¼Proxy è¿å¯ä»¥éè¿éå RealSubject ä¸­çæ¹æ³ï¼æ¥å®ç°å¤æãCGLIB å°±æ¯åºäºè¿ç§æè·¯è®¾è®¡çã\n\nå¨ Java çå¨æä»£çæºå¶ä¸­ï¼æä¸¤ä¸ªéè¦çç±»ï¼æ¥å£ï¼ï¼ä¸ä¸ªæ¯ InvocationHandler æ¥å£ãå¦ä¸ä¸ªåæ¯ Proxy ç±»ï¼è¿ä¸ä¸ªç±»åä¸ä¸ªæ¥å£æ¯å®ç°æä»¬å¨æä»£çæå¿é¡»ç¨å°çã\n\n# InvocationHandler æ¥å£\n\nInvocationHandler æ¥å£å®ä¹ï¼\n\npublic interface InvocationHandler {\n    public Object invoke(Object proxy, Method method, Object[] args)\n        throws Throwable;\n}\n\n\næ¯ä¸ä¸ªå¨æä»£çç±»é½å¿é¡»è¦å®ç° InvocationHandler è¿ä¸ªæ¥å£ï¼å¹¶ä¸æ¯ä¸ªä»£çç±»çå®ä¾é½å³èå°äºä¸ä¸ª Handlerï¼å½æä»¬éè¿ä»£çå¯¹è±¡è°ç¨ä¸ä¸ªæ¹æ³çæ¶åï¼è¿ä¸ªæ¹æ³çè°ç¨å°±ä¼è¢«è½¬åä¸ºç± InvocationHandler è¿ä¸ªæ¥å£ç invoke æ¹æ³æ¥è¿è¡è°ç¨ã\n\næä»¬æ¥çç InvocationHandler è¿ä¸ªæ¥å£çå¯ä¸ä¸ä¸ªæ¹æ³ invoke æ¹æ³ï¼\n\nObject invoke(Object proxy, Method method, Object[] args) throws Throwable\n\n\nåæ°è¯´æï¼\n\n * proxy - ä»£çççå®å¯¹è±¡ã\n * method - æè¦è°ç¨çå®å¯¹è±¡çæä¸ªæ¹æ³ç Method å¯¹è±¡\n * args - æè¦è°ç¨çå®å¯¹è±¡æä¸ªæ¹æ³æ¶æ¥åçåæ°\n\nå¦æä¸æ¯å¾æç½ï¼ç­ä¸éè¿ä¸ä¸ªå®ä¾ä¼å¯¹è¿å ä¸ªåæ°è¿è¡æ´æ·±çè®²è§£ã\n\n# Proxy ç±»\n\nProxy è¿ä¸ªç±»çä½ç¨å°±æ¯ç¨æ¥å¨æåå»ºä¸ä¸ªä»£çå¯¹è±¡çç±»ï¼å®æä¾äºè®¸å¤çæ¹æ³ï¼ä½æ¯æä»¬ç¨çæå¤çå°±æ¯ newProxyInstance è¿ä¸ªæ¹æ³ï¼\n\npublic static Object newProxyInstance(ClassLoader loader, Class<?>[] interfaces,  InvocationHandler h)  throws IllegalArgumentException\n\n\nè¿ä¸ªæ¹æ³çä½ç¨å°±æ¯å¾å°ä¸ä¸ªå¨æçä»£çå¯¹è±¡ã\n\nåæ°è¯´æï¼\n\n * loader - ä¸ä¸ª ClassLoader å¯¹è±¡ï¼å®ä¹äºç±åªä¸ª ClassLoader å¯¹è±¡æ¥å¯¹çæçä»£çå¯¹è±¡è¿è¡å è½½ã\n * interfaces - ä¸ä¸ª Class<?> å¯¹è±¡çæ°ç»ï¼è¡¨ç¤ºçæ¯æå°è¦ç»æéè¦ä»£ççå¯¹è±¡æä¾ä¸ç»ä»ä¹æ¥å£ï¼å¦æææä¾äºä¸ç»æ¥å£ç»å®ï¼é£ä¹è¿ä¸ªä»£çå¯¹è±¡å°±å®£ç§°å®ç°äºè¯¥æ¥å£(å¤æ)ï¼è¿æ ·æå°±è½è°ç¨è¿ç»æ¥å£ä¸­çæ¹æ³äº\n * h - ä¸ä¸ª InvocationHandler å¯¹è±¡ï¼è¡¨ç¤ºçæ¯å½æè¿ä¸ªå¨æä»£çå¯¹è±¡å¨è°ç¨æ¹æ³çæ¶åï¼ä¼å³èå°åªä¸ä¸ª InvocationHandler å¯¹è±¡ä¸\n\n# JDK å¨æä»£çå®ä¾\n\nä¸é¢çåå®¹ä»ç»å®è¿ä¸¤ä¸ªæ¥å£(ç±»)ä»¥åï¼æä»¬æ¥éè¿ä¸ä¸ªå®ä¾æ¥ççæä»¬çå¨æä»£çæ¨¡å¼æ¯ä»ä¹æ ·çï¼\n\né¦åæä»¬å®ä¹äºä¸ä¸ª Subject ç±»åçæ¥å£ï¼ä¸ºå¶å£°æäºä¸¤ä¸ªæ¹æ³ï¼\n\npublic interface Subject {\n\n    void hello(String str);\n\n    String bye();\n}\n\n\næ¥çï¼å®ä¹äºä¸ä¸ªç±»æ¥å®ç°è¿ä¸ªæ¥å£ï¼è¿ä¸ªç±»å°±æ¯æä»¬ççå®å¯¹è±¡ï¼RealSubject ç±»ï¼\n\npublic class RealSubject implements Subject {\n\n    @Override\n    public void hello(String str) {\n        System.out.println("Hello  " + str);\n    }\n\n    @Override\n    public String bye() {\n        System.out.println("Goodbye");\n        return "Over";\n    }\n}\n\n\nä¸ä¸æ­¥ï¼æä»¬å°±è¦å®ä¹ä¸ä¸ªå¨æä»£çç±»äºï¼åé¢è¯´ä¸ªï¼æ¯ä¸ä¸ªå¨æä»£çç±»é½å¿é¡»è¦å®ç° InvocationHandler è¿ä¸ªæ¥å£ï¼å æ­¤æä»¬è¿ä¸ªå¨æä»£çç±»ä¹ä¸ä¾å¤ï¼\n\npublic class InvocationHandlerDemo implements InvocationHandler {\n    // è¿ä¸ªå°±æ¯æä»¬è¦ä»£çççå®å¯¹è±¡\n    private Object subject;\n\n    // æé æ¹æ³ï¼ç»æä»¬è¦ä»£çççå®å¯¹è±¡èµåå¼\n    public InvocationHandlerDemo(Object subject) {\n        this.subject = subject;\n    }\n\n    @Override\n    public Object invoke(Object object, Method method, Object[] args)\n        throws Throwable {\n        // å¨ä»£ççå®å¯¹è±¡åæä»¬å¯ä»¥æ·»å ä¸äºèªå·±çæä½\n        System.out.println("Before method");\n\n        System.out.println("Call Method: " + method);\n\n        // å½ä»£çå¯¹è±¡è°ç¨çå®å¯¹è±¡çæ¹æ³æ¶ï¼å¶ä¼èªå¨çè·³è½¬å°ä»£çå¯¹è±¡å³èçhandlerå¯¹è±¡çinvokeæ¹æ³æ¥è¿è¡è°ç¨\n        Object obj = method.invoke(subject, args);\n\n        // å¨ä»£ççå®å¯¹è±¡åæä»¬ä¹å¯ä»¥æ·»å ä¸äºèªå·±çæä½\n        System.out.println("After method");\n        System.out.println();\n\n        return obj;\n    }\n}\n\n\næåï¼æ¥ççæä»¬ç Client ç±»ï¼\n\npublic class Client {\n    public static void main(String[] args) {\n        // æä»¬è¦ä»£çççå®å¯¹è±¡\n        Subject realSubject = new RealSubject();\n\n        // æä»¬è¦ä»£çåªä¸ªçå®å¯¹è±¡ï¼å°±å°è¯¥å¯¹è±¡ä¼ è¿å»ï¼æåæ¯éè¿è¯¥çå®å¯¹è±¡æ¥è°ç¨å¶æ¹æ³ç\n        InvocationHandler handler = new InvocationHandlerDemo(realSubject);\n\n        /*\n         * éè¿ProxyçnewProxyInstanceæ¹æ³æ¥åå»ºæä»¬çä»£çå¯¹è±¡ï¼æä»¬æ¥ççå¶ä¸ä¸ªåæ°\n         * ç¬¬ä¸ä¸ªåæ° handler.getClass().getClassLoader() ï¼æä»¬è¿éä½¿ç¨handlerè¿ä¸ªç±»çClassLoaderå¯¹è±¡æ¥å è½½æä»¬çä»£çå¯¹è±¡\n         * ç¬¬äºä¸ªåæ°realSubject.getClass().getInterfaces()ï¼æä»¬è¿éä¸ºä»£çå¯¹è±¡æä¾çæ¥å£æ¯çå®å¯¹è±¡æå®è¡çæ¥å£ï¼è¡¨ç¤ºæè¦ä»£ççæ¯è¯¥çå®å¯¹è±¡ï¼è¿æ ·æå°±è½è°ç¨è¿ç»æ¥å£ä¸­çæ¹æ³äº\n         * ç¬¬ä¸ä¸ªåæ°handlerï¼ æä»¬è¿éå°è¿ä¸ªä»£çå¯¹è±¡å³èå°äºä¸æ¹ç InvocationHandler è¿ä¸ªå¯¹è±¡ä¸\n         */\n        Subject subject = (Subject)Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject\n                .getClass().getInterfaces(), handler);\n\n        System.out.println(subject.getClass().getName());\n        subject.hello("World");\n        String result = subject.bye();\n        System.out.println("Result is: " + result);\n    }\n}\n\n\næä»¬åæ¥ççæ§å¶å°çè¾åºï¼\n\ncom.sun.proxy.$Proxy0\nBefore method\nCall Method: public abstract void io.github.dunwu.javacore.reflect.InvocationHandlerDemo$Subject.hello(java.lang.String)\nHello  World\nAfter method\n\nBefore method\nCall Method: public abstract java.lang.String io.github.dunwu.javacore.reflect.InvocationHandlerDemo$Subject.bye()\nGoodbye\nAfter method\n\nResult is: Over\n\n\næä»¬é¦åæ¥çç com.sun.proxy.$Proxy0 è¿ä¸è¥¿ï¼æä»¬çå°ï¼è¿ä¸ªä¸è¥¿æ¯ç± System.out.println(subject.getClass().getName()); è¿æ¡è¯­å¥æå°åºæ¥çï¼é£ä¹ä¸ºä»ä¹æä»¬è¿åçè¿ä¸ªä»£çå¯¹è±¡çç±»åæ¯è¿æ ·çå¢ï¼\n\nSubject subject = (Subject)Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject\n                .getClass().getInterfaces(), handler);\n\n\nå¯è½æä»¥ä¸ºè¿åçè¿ä¸ªä»£çå¯¹è±¡ä¼æ¯ Subject ç±»åçå¯¹è±¡ï¼æèæ¯ InvocationHandler çå¯¹è±¡ï¼ç»æå´ä¸æ¯ï¼é¦åæä»¬è§£éä¸ä¸ä¸ºä»ä¹æä»¬è¿éå¯ä»¥å°å¶è½¬åä¸º Subject ç±»åçå¯¹è±¡ï¼\n\nåå å°±æ¯ï¼å¨ newProxyInstance è¿ä¸ªæ¹æ³çç¬¬äºä¸ªåæ°ä¸ï¼æä»¬ç»è¿ä¸ªä»£çå¯¹è±¡æä¾äºä¸ç»ä»ä¹æ¥å£ï¼é£ä¹æè¿ä¸ªä»£çå¯¹è±¡å°±ä¼å®ç°äºè¿ç»æ¥å£ï¼è¿ä¸ªæ¶åæä»¬å½ç¶å¯ä»¥å°è¿ä¸ªä»£çå¯¹è±¡å¼ºå¶ç±»åè½¬åä¸ºè¿ç»æ¥å£ä¸­çä»»æä¸ä¸ªï¼å ä¸ºè¿éçæ¥å£æ¯ Subject ç±»åï¼æä»¥å°±å¯ä»¥å°å¶è½¬åä¸º Subject ç±»åäºã\n\nåæ¶æä»¬ä¸å®è¦è®°ä½ï¼éè¿ Proxy.newProxyInstance åå»ºçä»£çå¯¹è±¡æ¯å¨ jvm è¿è¡æ¶å¨æçæçä¸ä¸ªå¯¹è±¡ï¼å®å¹¶ä¸æ¯æä»¬ç InvocationHandler ç±»åï¼ä¹ä¸æ¯æä»¬å®ä¹çé£ç»æ¥å£çç±»åï¼èæ¯å¨è¿è¡æ¯å¨æçæçä¸ä¸ªå¯¹è±¡ï¼å¹¶ä¸å½åæ¹å¼é½æ¯è¿æ ·çå½¢å¼ï¼ä»¥$å¼å¤´ï¼proxy ä¸ºä¸­ï¼æåä¸ä¸ªæ°å­è¡¨ç¤ºå¯¹è±¡çæ å·ã\n\næ¥çæä»¬æ¥ççè¿ä¸¤å¥\n\nsubject.hello("World");\nString result = subject.bye();\n\n\nè¿éæ¯éè¿ä»£çå¯¹è±¡æ¥è°ç¨å®ç°çé£ç§æ¥å£ä¸­çæ¹æ³ï¼è¿ä¸ªæ¶åç¨åºå°±ä¼è·³è½¬å°ç±è¿ä¸ªä»£çå¯¹è±¡å³èå°ç handler ä¸­ç invoke æ¹æ³å»æ§è¡ï¼èæä»¬çè¿ä¸ª handler å¯¹è±¡åæ¥åäºä¸ä¸ª RealSubject ç±»åçåæ°ï¼è¡¨ç¤ºæè¦ä»£ççå°±æ¯è¿ä¸ªçå®å¯¹è±¡ï¼æä»¥æ­¤æ¶å°±ä¼è°ç¨ handler ä¸­ç invoke æ¹æ³å»æ§è¡ã\n\næä»¬çå°ï¼å¨çæ­£éè¿ä»£çå¯¹è±¡æ¥è°ç¨çå®å¯¹è±¡çæ¹æ³çæ¶åï¼æä»¬å¯ä»¥å¨è¯¥æ¹æ³ååæ·»å èªå·±çä¸äºæä½ï¼åæ¶æä»¬çå°æä»¬çè¿ä¸ª method å¯¹è±¡æ¯è¿æ ·çï¼\n\npublic abstract void io.github.dunwu.javacore.reflect.InvocationHandlerDemo$Subject.hello(java.lang.String)\npublic abstract java.lang.String io.github.dunwu.javacore.reflect.InvocationHandlerDemo$Subject.bye()\n\n\næ­£å¥½å°±æ¯æä»¬ç Subject æ¥å£ä¸­çä¸¤ä¸ªæ¹æ³ï¼è¿ä¹å°±è¯æäºå½æéè¿ä»£çå¯¹è±¡æ¥è°ç¨æ¹æ³çæ¶åï¼èµ·å®éå°±æ¯å§æç±å¶å³èå°ç handler å¯¹è±¡ç invoke æ¹æ³ä¸­æ¥è°ç¨ï¼å¹¶ä¸æ¯èªå·±æ¥çå®è°ç¨ï¼èæ¯éè¿ä»£ççæ¹å¼æ¥è°ç¨çã\n\n# JDK å¨æä»£çå°ç»\n\nä»£çç±»ä¸å§æç±»å®ç°åä¸æ¥å£ï¼ä¸»è¦æ¯éè¿ä»£çç±»å®ç° InvocationHandler å¹¶éå invoke æ¹æ³æ¥è¿è¡å¨æä»£ççï¼å¨ invoke æ¹æ³ä¸­å°å¯¹æ¹æ³è¿è¡å¤çã\n\nJDK å¨æä»£çç¹ç¹ï¼\n\n * ä¼ç¹ï¼ç¸å¯¹äºéæä»£çæ¨¡å¼ï¼ä¸éè¦ç¡¬ç¼ç æ¥å£ï¼ä»£ç å¤ç¨çé«ã\n\n * ç¼ºç¹ï¼å¼ºå¶è¦æ±ä»£çç±»å®ç° InvocationHandler æ¥å£ã\n\n\n# CGLIB å¨æä»£ç\n\nCGLIB æä¾äºä¸ JDK å¨æä»£çä¸åçæ¹æ¡ãå¾å¤æ¡æ¶ï¼ä¾å¦ Spring AOP ä¸­ï¼å°±ä½¿ç¨äº CGLIB å¨æä»£çã\n\nCGLIB åºå±ï¼å¶å®æ¯åå©äº ASM è¿ä¸ªå¼ºå¤§ç Java å­èç æ¡æ¶å»è¿è¡å­èç å¢å¼ºæä½ã\n\nCGLIB å¨æä»£ççå·¥ä½æ­¥éª¤ï¼\n\n * çæä»£çç±»çäºè¿å¶å­èç æä»¶ï¼\n * å è½½äºè¿å¶å­èç ï¼çæ Class å¯¹è±¡( ä¾å¦ä½¿ç¨ Class.forName() æ¹æ³ )ï¼\n * éè¿åå°æºå¶è·å¾å®ä¾æé ï¼å¹¶åå»ºä»£çç±»å¯¹è±¡ã\n\nCGLIB å¨æä»£çç¹ç¹ï¼\n\nä¼ç¹ï¼ä½¿ç¨å­èç å¢å¼ºï¼æ¯ JDK å¨æä»£çæ¹å¼æ§è½é«ãå¯ä»¥å¨è¿è¡æ¶å¯¹ç±»æèæ¯æ¥å£è¿è¡å¢å¼ºæä½ï¼ä¸å§æç±»æ éå®ç°æ¥å£ã\n\nç¼ºç¹ï¼ä¸è½å¯¹ final ç±»ä»¥å final æ¹æ³è¿è¡ä»£çã\n\n> åèï¼æ·±å¥çè§£ CGLIB å¨æä»£çæºå¶\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * æ·±å¥æè§£ Java èææº\n * æ·±å¥è§£æ Java åå°ï¼1ï¼ - åºç¡\n * Java åºç¡ä¹âåå°ï¼éå¸¸éè¦ï¼\n * å®æ¹ Reflection API ææ¡£\n * Java çå¨æä»£çæºå¶è¯¦è§£\n * Java å¨æä»£çæºå¶è¯¦è§£ï¼JDK å CGLIBï¼Javassistï¼ASMï¼\n * æ·±å¥çè§£ JDK å¨æä»£çæºå¶\n * æ·±å¥çè§£ CGLIB å¨æä»£çæºå¶',normalizedContent:'# æ·±å¥çè§£ java åå°åå¨æä»£ç\n\n\n# åå°ç®ä»\n\n\n\n\n# ä»ä¹æ¯åå°\n\nåå°(reflection)æ¯ java ç¨åºå¼åè¯­è¨çç¹å¾ä¹ä¸ï¼å®åè®¸è¿è¡ä¸­ç java ç¨åºè·åèªèº«çä¿¡æ¯ï¼å¹¶ä¸å¯ä»¥æä½ç±»æå¯¹è±¡çåé¨å±æ§ã\n\néè¿åå°æºå¶ï¼å¯ä»¥å¨è¿è¡æ¶è®¿é® java å¯¹è±¡çå±æ§ï¼æ¹æ³ï¼æé æ¹æ³ç­ã\n\n\n# åå°çåºç¨åºæ¯\n\nåå°çä¸»è¦åºç¨åºæ¯æï¼\n\n * å¼åéç¨æ¡æ¶ - åå°æéè¦çç¨éå°±æ¯å¼ååç§éç¨æ¡æ¶ãå¾å¤æ¡æ¶ï¼æ¯å¦ springï¼é½æ¯éç½®åçï¼æ¯å¦éè¿ xml æä»¶éç½® javabeanãfilter ç­ï¼ï¼ä¸ºäºä¿è¯æ¡æ¶çéç¨æ§ï¼å®ä»¬å¯è½éè¦æ ¹æ®éç½®æä»¶å è½½ä¸åçå¯¹è±¡æç±»ï¼è°ç¨ä¸åçæ¹æ³ï¼è¿ä¸ªæ¶åå°±å¿é¡»ç¨å°åå°ââè¿è¡æ¶å¨æå è½½éè¦å è½½çå¯¹è±¡ã\n * å¨æä»£ç - å¨åé¢ç¼ç¨ï¼aopï¼ä¸­ï¼éè¦æ¦æªç¹å®çæ¹æ³ï¼éå¸¸ï¼ä¼éæ©å¨æä»£çæ¹å¼ãè¿æ¶ï¼å°±éè¦åå°ææ¯æ¥å®ç°äºã\n * æ³¨è§£ - æ³¨è§£æ¬èº«ä»ä»æ¯èµ·å°æ è®°ä½ç¨ï¼å®éè¦å©ç¨åå°æºå¶ï¼æ ¹æ®æ³¨è§£æ è®°å»è°ç¨æ³¨è§£è§£éå¨ï¼æ§è¡è¡ä¸ºãå¦ææ²¡æåå°æºå¶ï¼æ³¨è§£å¹¶ä¸æ¯æ³¨éæ´æç¨ã\n * å¯æ©å±æ§åè½ - åºç¨ç¨åºå¯ä»¥éè¿ä½¿ç¨å®å¨éå®åç§°åå»ºå¯æ©å±æ§å¯¹è±¡å®ä¾æ¥ä½¿ç¨å¤é¨çç¨æ·å®ä¹ç±»ã\n\n\n# åå°çç¼ºç¹\n\n * æ§è½å¼é - ç±äºåå°æ¶åå¨æè§£æçç±»åï¼å æ­¤æ æ³æ§è¡æäº java èææºä¼åãå æ­¤ï¼åå°æä½çæ§è½è¦æ¯éåå°æä½çæ§è½è¦å·®ï¼åºè¯¥å¨æ§è½ææçåºç¨ç¨åºä¸­é¢ç¹è°ç¨çä»£ç æ®µä¸­é¿åã\n * ç ´åå°è£æ§ - åå°è°ç¨æ¹æ³æ¶å¯ä»¥å¿½ç¥æéæ£æ¥ï¼å æ­¤å¯è½ä¼ç ´åå°è£æ§èå¯¼è´å®å¨é®é¢ã\n * åé¨æå - ç±äºåå°åè®¸ä»£ç æ§è¡å¨éåå°ä»£ç ä¸­éæ³çæä½ï¼ä¾å¦è®¿é®ç§æå­æ®µåæ¹æ³ï¼æä»¥åå°çä½¿ç¨å¯è½ä¼å¯¼è´ææ³ä¸å°çå¯ä½ç¨ï¼è¿å¯è½ä¼å¯¼è´ä»£ç åè½å¤±å¸¸å¹¶å¯è½ç ´åå¯ç§»æ¤æ§ãåå°ä»£ç æç ´äºæ½è±¡ï¼å æ­¤å¯è½ä¼éçå¹³å°çåçº§èæ¹åè¡ä¸ºã\n\n\n# åå°æºå¶\n\n\n# ç±»å è½½è¿ç¨\n\n\n\nç±»å è½½çå®æ´è¿ç¨å¦ä¸ï¼\n\n 1. å¨ç¼è¯æ¶ï¼java ç¼è¯å¨ç¼è¯å¥½ .java æä»¶ä¹åï¼å¨ç£çä¸­äº§ç .class æä»¶ã.class æä»¶æ¯äºè¿å¶æä»¶ï¼åå®¹æ¯åªæ jvm è½å¤è¯å«çæºå¨ç ã\n 2. jvm ä¸­çç±»å è½½å¨è¯»åå­èç æä»¶ï¼ååºäºè¿å¶æ°æ®ï¼å è½½å°åå­ä¸­ï¼è§£æ.class æä»¶åçä¿¡æ¯ãç±»å è½½å¨ä¼æ ¹æ®ç±»çå¨éå®åæ¥è·åæ­¤ç±»çäºè¿å¶å­èæµï¼ç¶åï¼å°å­èæµæä»£è¡¨çéæå­å¨ç»æè½¬åä¸ºæ¹æ³åºçè¿è¡æ¶æ°æ®ç»æï¼æ¥çï¼å¨åå­ä¸­çæä»£è¡¨è¿ä¸ªç±»ç java.lang.class å¯¹è±¡ã\n 3. å è½½ç»æåï¼jvm å¼å§è¿è¡è¿æ¥é¶æ®µï¼åå«éªè¯ãåå¤ãåå§åï¼ãç»è¿è¿ä¸ç³»åæä½ï¼ç±»çåéä¼è¢«åå§åã\n\n\n# class å¯¹è±¡\n\nè¦æ³ä½¿ç¨åå°ï¼é¦åéè¦è·å¾å¾æä½çç±»æå¯¹åºç class å¯¹è±¡ãjava ä¸­ï¼æ è®ºçææä¸ªç±»çå¤å°ä¸ªå¯¹è±¡ï¼è¿äºå¯¹è±¡é½ä¼å¯¹åºäºåä¸ä¸ª class å¯¹è±¡ãè¿ä¸ª class å¯¹è±¡æ¯ç± jvm çæçï¼éè¿å®è½å¤è·ææ´ä¸ªç±»çç»æãæä»¥ï¼java.lang.class å¯ä»¥è§ä¸ºææåå° api çå¥å£ç¹ã\n\nåå°çæ¬è´¨å°±æ¯ï¼å¨è¿è¡æ¶ï¼æ java ç±»ä¸­çåç§æåæ å°æä¸ä¸ªä¸ªç java å¯¹è±¡ã\n\nä¸¾ä¾æ¥è¯´ï¼åå¦å®ä¹äºä»¥ä¸ä»£ç ï¼\n\nuser user = new user();\n\n\næ­¥éª¤è¯´æï¼\n\n 1. jvm å è½½æ¹æ³çæ¶åï¼éå° new user()ï¼jvm ä¼æ ¹æ® user çå¨éå®åå»å è½½ user.class ã\n 2. jvm ä¼å»æ¬å°ç£çæ¥æ¾ user.class æä»¶å¹¶å è½½ jvm åå­ä¸­ã\n 3. jvm éè¿è°ç¨ç±»å è½½å¨èªå¨åå»ºè¿ä¸ªç±»å¯¹åºç class å¯¹è±¡ï¼å¹¶ä¸å­å¨å¨ jvm çæ¹æ³åºãæ³¨æï¼ä¸ä¸ªç±»æä¸åªæä¸ä¸ª class å¯¹è±¡ã\n\n\n# æ¹æ³çåå°è°ç¨\n\næ¹æ³çåå°è°ç¨ï¼ä¹å°±æ¯ method.invoke æ¹æ³ã\n\nmethod.invoke æ¹æ³æºç ï¼\n\npublic final class method extends executable {\n  ...\n  public object invoke(object obj, object... args) throws ... {\n    ... // æéæ£æ¥\n    methodaccessor ma = methodaccessor;\n    if (ma == null) {\n      ma = acquiremethodaccessor();\n    }\n    return ma.invoke(obj, args);\n  }\n}\n\n\nmethod.invoke æ¹æ³å®éä¸å§æ´¾ç» methodaccessor æ¥å£æ¥å¤çãå®æä¸¤ä¸ªå·²æçå·ä½å®ç°ï¼\n\n * nativemethodaccessorimplï¼æ¬å°æ¹æ³æ¥å®ç°åå°è°ç¨\n * delegatingmethodaccessorimplï¼å§æ´¾æ¨¡å¼æ¥å®ç°åå°è°ç¨\n\næ¯ä¸ª method å®ä¾çç¬¬ä¸æ¬¡åå°è°ç¨é½ä¼çæä¸ä¸ªå§æ´¾å®ç°ï¼delegatingmethodaccessorimplï¼ï¼å®æå§æ´¾çå·ä½å®ç°ä¾¿æ¯ä¸ä¸ªæ¬å°å®ç°ï¼nativemethodaccessorimplï¼ãæ¬å°å®ç°éå¸¸å®¹æçè§£ãå½è¿å¥äº java èææºåé¨ä¹åï¼æä»¬ä¾¿æ¥æäº method å®ä¾ææåæ¹æ³çå·ä½å°åãè¿æ¶åï¼åå°è°ç¨æ éå°±æ¯å°ä¼ å¥çåæ°åå¤å¥½ï¼ç¶åè°ç¨è¿å¥ç®æ æ¹æ³ã\n\nãç¤ºä¾ãéè¿æåºå¼å¸¸æ¹å¼ æå° method.invoke è°ç¨è½¨è¿¹\n\npublic class methoddemo01 {\n\n    public static void target(int i) {\n        new exception("#" + i).printstacktrace();\n    }\n\n    public static void main(string[] args) throws exception {\n        class<?> clazz = class.forname("io.github.dunwu.javacore.reflect.methoddemo01");\n        method method = clazz.getmethod("target", int.class);\n        method.invoke(null, 0);\n    }\n\n}\n// output:\n// java.lang.exception: #0\n//     at io.github.dunwu.javacore.reflect.methoddemo01.target(methoddemo01.java:12)\n//     at sun.reflect.nativemethodaccessorimpl.invoke0(native method)\n//     at sun.reflect.nativemethodaccessorimpl.invoke(nativemethodaccessorimpl.java:62)\n\n\nåè°ç¨ delegatingmethodaccessorimplï¼ç¶åè°ç¨ nativemethodaccessorimplï¼æåè°ç¨å®éæ¹æ³ã\n\nä¸ºä»ä¹åå°è°ç¨delegatingmethodaccessorimpl ä½ä¸ºä¸­é´å±ï¼èä¸æ¯ç´æ¥äº¤ç»æ¬å°å®ç°ï¼\n\nå¶å®ï¼java çåå°è°ç¨æºå¶è¿è®¾ç«äºå¦ä¸ç§å¨æçæå­èç çå®ç°ï¼ä¸ç§°å¨æå®ç°ï¼ï¼ç´æ¥ä½¿ç¨ invoke æä»¤æ¥è°ç¨ç®æ æ¹æ³ãä¹æä»¥éç¨å§æ´¾å®ç°ï¼ä¾¿æ¯ä¸ºäºè½å¤å¨æ¬å°å®ç°ä»¥åå¨æå®ç°ä¸­åæ¢ãå¨æå®ç°åæ¬å°å®ç°ç¸æ¯ï¼å¶è¿è¡æçè¦å¿«ä¸ 20 åãè¿æ¯å ä¸ºå¨æå®ç°æ éç»è¿ java å° c++ åå° java çåæ¢ï¼ä½ç±äºçæå­èç ååèæ¶ï¼ä»è°ç¨ä¸æ¬¡çè¯ï¼åèæ¯æ¬å°å®ç°è¦å¿«ä¸ 3 å° 4 åã\n\nèèå°è®¸å¤åå°è°ç¨ä»ä¼æ§è¡ä¸æ¬¡ï¼java èææºè®¾ç½®äºä¸ä¸ªéå¼ 15ï¼å¯ä»¥éè¿ -dsun.reflect.inflationthreshold æ¥è°æ´ï¼ï¼å½æä¸ªåå°è°ç¨çè°ç¨æ¬¡æ°å¨ 15 ä¹ä¸æ¶ï¼éç¨æ¬å°å®ç°ï¼å½è¾¾å° 15 æ¶ï¼ä¾¿å¼å§å¨æçæå­èç ï¼å¹¶å°å§æ´¾å®ç°çå§æ´¾å¯¹è±¡åæ¢è³å¨æå®ç°ï¼è¿ä¸ªè¿ç¨æä»¬ç§°ä¹ä¸º inflationã\n\nãç¤ºä¾ãæ§è¡ java -verbose:class methoddemo02 å¯å¨\n\npublic class methoddemo02 {\n\n    public static void target(int i) {\n        new exception("#" + i).printstacktrace();\n    }\n\n    public static void main(string[] args) throws exception {\n        class<?> klass = class.forname("io.github.dunwu.javacore.reflect.methoddemo02");\n        method method = klass.getmethod("target", int.class);\n        for (int i = 0; i < 20; i++) {\n            method.invoke(null, i);\n        }\n    }\n\n}\n\n\nè¾åºåå®¹ï¼\n\n// ...çç¥\njava.lang.exception: #14\n        at io.github.dunwu.javacore.reflect.methoddemo02.target(methoddemo02.java:13)\n        at sun.reflect.nativemethodaccessorimpl.invoke0(native method)\n        at sun.reflect.nativemethodaccessorimpl.invoke(nativemethodaccessorimpl.java:62)\n        at sun.reflect.delegatingmethodaccessorimpl.invoke(delegatingmethodaccessorimpl.java:43)\n        at java.lang.reflect.method.invoke(method.java:498)\n        at io.github.dunwu.javacore.reflect.methoddemo02.main(methoddemo02.java:20)\n[loaded sun.reflect.classfileconstants from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.accessorgenerator from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.methodaccessorgenerator from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.bytevectorfactory from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.bytevector from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.bytevectorimpl from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.classfileassembler from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.utf8 from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.label from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.label$patchinfo from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded java.util.arraylist$itr from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.methodaccessorgenerator$1 from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.classdefiner from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.classdefiner$1 from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\n[loaded sun.reflect.generatedmethodaccessor1 from __jvm_defineclass__]\njava.lang.exception: #15\n        at io.github.dunwu.javacore.reflect.methoddemo02.target(methoddemo02.java:13)\n        at sun.reflect.nativemethodaccessorimpl.invoke0(native method)\n        at sun.reflect.nativemethodaccessorimpl.invoke(nativemethodaccessorimpl.java:62)\n        at sun.reflect.delegatingmethodaccessorimpl.invoke(delegatingmethodaccessorimpl.java:43)\n        at java.lang.reflect.method.invoke(method.java:498)\n        at io.github.dunwu.javacore.reflect.methoddemo02.main(methoddemo02.java:20)\n[loaded java.util.concurrent.concurrenthashmap$forwardingnode from d:\\tools\\java\\jdk1.8.0_192\\jre\\lib\\rt.jar]\njava.lang.exception: #16\n        at io.github.dunwu.javacore.reflect.methoddemo02.target(methoddemo02.java:13)\n        at sun.reflect.generatedmethodaccessor1.invoke(unknown source)\n        at sun.reflect.delegatingmethodaccessorimpl.invoke(delegatingmethodaccessorimpl.java:43)\n        at java.lang.reflect.method.invoke(method.java:498)\n        at io.github.dunwu.javacore.reflect.methoddemo02.main(methoddemo02.java:20)\n// ...çç¥\n\n\nå¯ä»¥çå°ï¼ä»ç¬¬ 16 æ¬¡å¼å§åï¼é½æ¯ä½¿ç¨ delegatingmethodaccessorimpl ï¼ä¸åä½¿ç¨æ¬å°å®ç° nativemethodaccessorimplã\n\n\n# åå°è°ç¨çå¼é\n\næ¹æ³çåå°è°ç¨ä¼å¸¦æ¥ä¸å°æ§è½å¼éï¼åå ä¸»è¦æä¸ä¸ªï¼\n\n * åé¿åæ°æ¹æ³å¯¼è´ç object æ°ç»\n * åºæ¬ç±»åçèªå¨è£ç®±ãæç®±\n * è¿ææéè¦çæ¹æ³åè\n\nclass.forname ä¼è°ç¨æ¬å°æ¹æ³ï¼class.getmethod åä¼éåè¯¥ç±»çå¬ææ¹æ³ãå¦ææ²¡æå¹éå°ï¼å®è¿å°éåç¶ç±»çå¬ææ¹æ³ãå¯æ³èç¥ï¼è¿ä¸¤ä¸ªæä½é½éå¸¸è´¹æ¶ã\n\n> æ³¨æï¼ä»¥ getmethod ä¸ºä»£è¡¨çæ¥æ¾æ¹æ³æä½ï¼ä¼è¿åæ¥æ¾å¾å°ç»æçä¸ä»½æ·è´ãå æ­¤ï¼æä»¬åºå½é¿åå¨ç­ç¹ä»£ç ä¸­ä½¿ç¨è¿å method æ°ç»ç getmethods æè getdeclaredmethods æ¹æ³ï¼ä»¥åå°ä¸å¿è¦çå ç©ºé´æ¶èãå¨å®è·µä¸­ï¼æä»¬å¾å¾ä¼å¨åºç¨ç¨åºä¸­ç¼å­ class.forname å class.getmethod çç»æã\n\nä¸é¢åªå³æ³¨åå°è°ç¨æ¬èº«çæ§è½å¼éã\n\nç¬¬ä¸ï¼ç±äº method.invoke æ¯ä¸ä¸ªåé¿åæ°æ¹æ³ï¼å¨å­èç å±é¢å®çæåä¸ä¸ªåæ°ä¼æ¯ object æ°ç»ï¼æå´è¶£çåå­¦ç§ä¸å¯ä»¥ç¨ javap æ¥çï¼ãjava ç¼è¯å¨ä¼å¨æ¹æ³è°ç¨å¤çæä¸ä¸ªé¿åº¦ä¸ºä¼ å¥åæ°æ°éç object æ°ç»ï¼å¹¶å°ä¼ å¥åæ°ä¸ä¸å­å¨è¿è¯¥æ°ç»ä¸­ã\n\nç¬¬äºï¼ç±äº object æ°ç»ä¸è½å­å¨åºæ¬ç±»åï¼java ç¼è¯å¨ä¼å¯¹ä¼ å¥çåºæ¬ç±»ååæ°è¿è¡èªå¨è£ç®±ã\n\nè¿ä¸¤ä¸ªæä½é¤äºå¸¦æ¥æ§è½å¼éå¤ï¼è¿å¯è½å ç¨å åå­ï¼ä½¿å¾ gc æ´å é¢ç¹ãï¼å¦æä½ æå´è¶£çè¯ï¼å¯ä»¥ç¨èææºåæ° -xx:+printgc è¯è¯ãï¼é£ä¹ï¼å¦ä½æ¶é¤è¿é¨åå¼éå¢ï¼\n\n\n# ä½¿ç¨åå°\n\n\n# java.lang.reflect å\n\njava ä¸­ç java.lang.reflect åæä¾äºåå°åè½ãjava.lang.reflect åä¸­çç±»é½æ²¡æ public æé æ¹æ³ã\n\njava.lang.reflect åçæ ¸å¿æ¥å£åç±»å¦ä¸ï¼\n\n * member æ¥å£ï¼åæ å³äºåä¸ªæå(å­æ®µææ¹æ³)ææé å½æ°çæ è¯ä¿¡æ¯ã\n * field ç±»ï¼æä¾ä¸ä¸ªç±»çåçä¿¡æ¯ä»¥åè®¿é®ç±»çåçæ¥å£ã\n * method ç±»ï¼æä¾ä¸ä¸ªç±»çæ¹æ³çä¿¡æ¯ä»¥åè®¿é®ç±»çæ¹æ³çæ¥å£ã\n * constructor ç±»ï¼æä¾ä¸ä¸ªç±»çæé å½æ°çä¿¡æ¯ä»¥åè®¿é®ç±»çæé å½æ°çæ¥å£ã\n * array ç±»ï¼è¯¥ç±»æä¾å¨æå°çæåè®¿é® java æ°ç»çæ¹æ³ã\n * modifier ç±»ï¼æä¾äº static æ¹æ³åå¸¸éï¼å¯¹ç±»åæåè®¿é®ä¿®é¥°ç¬¦è¿è¡è§£ç ã\n * proxy ç±»ï¼æä¾å¨æå°çæä»£çç±»åç±»å®ä¾çéææ¹æ³ã\n\n\n# è·å class å¯¹è±¡\n\nè·å class å¯¹è±¡çä¸ç§æ¹æ³ï¼\n\nï¼1ï¼class.forname éææ¹æ³\n\nãç¤ºä¾ãä½¿ç¨ class.forname éææ¹æ³è·å class å¯¹è±¡\n\npackage io.github.dunwu.javacore.reflect;\n\npublic class reflectclassdemo01 {\n    public static void main(string[] args) throws classnotfoundexception {\n        class c1 = class.forname("io.github.dunwu.javacore.reflect.reflectclassdemo01");\n        system.out.println(c1.getcanonicalname());\n\n        class c2 = class.forname("[d");\n        system.out.println(c2.getcanonicalname());\n\n        class c3 = class.forname("[[ljava.lang.string;");\n        system.out.println(c3.getcanonicalname());\n    }\n}\n//output:\n//io.github.dunwu.javacore.reflect.reflectclassdemo01\n//double[]\n//java.lang.string[][]\n\n\nä½¿ç¨ç±»çå®å¨éå®åæ¥åå°å¯¹è±¡çç±»ãå¸¸è§çåºç¨åºæ¯ä¸ºï¼å¨ jdbc å¼åä¸­å¸¸ç¨æ­¤æ¹æ³å è½½æ°æ®åºé©±å¨ã\n\nï¼2ï¼ç±»å + .class\n\nãç¤ºä¾ãç´æ¥ç¨ç±»å + .class è·å class å¯¹è±¡\n\npublic class reflectclassdemo02 {\n    public static void main(string[] args) {\n        boolean b;\n        // class c = b.getclass(); // ç¼è¯éè¯¯\n        class c1 = boolean.class;\n        system.out.println(c1.getcanonicalname());\n\n        class c2 = java.io.printstream.class;\n        system.out.println(c2.getcanonicalname());\n\n        class c3 = int[][][].class;\n        system.out.println(c3.getcanonicalname());\n    }\n}\n//output:\n//boolean\n//java.io.printstream\n//int[][][]\n\n\nï¼3ï¼object ç getclass æ¹æ³\n\nobject ç±»ä¸­æ getclass æ¹æ³ï¼å ä¸ºææç±»é½ç»§æ¿ object ç±»ãä»èè°ç¨ object ç±»æ¥è·å class å¯¹è±¡ã\n\nãç¤ºä¾ãobject ç getclass æ¹æ³è·å class å¯¹è±¡\n\npackage io.github.dunwu.javacore.reflect;\n\nimport java.util.hashset;\nimport java.util.set;\n\npublic class reflectclassdemo03 {\n    enum e {a, b}\n\n    public static void main(string[] args) {\n        class c = "foo".getclass();\n        system.out.println(c.getcanonicalname());\n\n        class c2 = reflectclassdemo03.e.a.getclass();\n        system.out.println(c2.getcanonicalname());\n\n        byte[] bytes = new byte[1024];\n        class c3 = bytes.getclass();\n        system.out.println(c3.getcanonicalname());\n\n        set<string> set = new hashset<>();\n        class c4 = set.getclass();\n        system.out.println(c4.getcanonicalname());\n    }\n}\n//output:\n//java.lang.string\n//io.github.dunwu.javacore.reflect.reflectclassdemo.e\n//byte[]\n//java.util.hashset\n\n\n\n# å¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾\n\nå¤æ­æ¯å¦ä¸ºæä¸ªç±»çå®ä¾æä¸¤ç§æ¹å¼ï¼\n\n 1. ç¨ instanceof å³é®å­\n 2. ç¨ class å¯¹è±¡ç isinstance æ¹æ³ï¼å®æ¯ä¸ä¸ª native æ¹æ³ï¼\n\nãç¤ºä¾ã\n\npublic class instanceofdemo {\n    public static void main(string[] args) {\n        arraylist arraylist = new arraylist();\n        if (arraylist instanceof list) {\n            system.out.println("arraylist is list");\n        }\n        if (list.class.isinstance(arraylist)) {\n            system.out.println("arraylist is list");\n        }\n    }\n}\n//output:\n//arraylist is list\n//arraylist is list\n\n\n\n# åå»ºå®ä¾\n\néè¿åå°æ¥åå»ºå®ä¾å¯¹è±¡ä¸»è¦æä¸¤ç§æ¹å¼ï¼\n\n * ç¨ class å¯¹è±¡ç newinstance æ¹æ³ã\n * ç¨ constructor å¯¹è±¡ç newinstance æ¹æ³ã\n\nãç¤ºä¾ã\n\npublic class newinstancedemo {\n    public static void main(string[] args)\n        throws illegalaccessexception, instantiationexception, nosuchmethodexception, invocationtargetexception {\n        class<?> c1 = stringbuilder.class;\n        stringbuilder sb = (stringbuilder) c1.newinstance();\n        sb.append("aaa");\n        system.out.println(sb.tostring());\n\n        //è·åstringæå¯¹åºçclasså¯¹è±¡\n        class<?> c2 = string.class;\n        //è·åstringç±»å¸¦ä¸ä¸ªstringåæ°çæé å¨\n        constructor constructor = c2.getconstructor(string.class);\n        //æ ¹æ®æé å¨åå»ºå®ä¾\n        string str2 = (string) constructor.newinstance("bbb");\n        system.out.println(str2);\n    }\n}\n//output:\n//aaa\n//bbb\n\n\n\n# åå»ºæ°ç»å®ä¾\n\næ°ç»å¨ java éæ¯æ¯è¾ç¹æ®çä¸ç§ç±»åï¼å®å¯ä»¥èµå¼ç»ä¸ä¸ªå¯¹è±¡å¼ç¨ãjava ä¸­ï¼éè¿ array.newinstance åå»ºæ°ç»çå®ä¾ã\n\nãç¤ºä¾ãå©ç¨åå°åå»ºæ°ç»\n\npublic class reflectarraydemo {\n    public static void main(string[] args) throws classnotfoundexception {\n        class<?> cls = class.forname("java.lang.string");\n        object array = array.newinstance(cls, 25);\n        //å¾æ°ç»éæ·»å åå®¹\n        array.set(array, 0, "scala");\n        array.set(array, 1, "java");\n        array.set(array, 2, "groovy");\n        array.set(array, 3, "scala");\n        array.set(array, 4, "clojure");\n        //è·åæä¸é¡¹çåå®¹\n        system.out.println(array.get(array, 3));\n    }\n}\n//output:\n//scala\n\n\nå¶ä¸­ç array ç±»ä¸º java.lang.reflect.array ç±»ãæä»¬array.newinstance çååæ¯ï¼\n\npublic static object newinstance(class<?> componenttype, int length)\n    throws negativearraysizeexception {\n    return newarray(componenttype, length);\n}\n\n\n\n# field\n\nclass å¯¹è±¡æä¾ä»¥ä¸æ¹æ³è·åå¯¹è±¡çæåï¼fieldï¼ï¼\n\n * getfiled - æ ¹æ®åç§°è·åå¬æçï¼publicï¼ç±»æåã\n * getdeclaredfield - æ ¹æ®åç§°è·åå·²å£°æçç±»æåãä½ä¸è½å¾å°å¶ç¶ç±»çç±»æåã\n * getfields - è·åææå¬æçï¼publicï¼ç±»æåã\n * getdeclaredfields - è·åææå·²å£°æçç±»æåã\n\nç¤ºä¾å¦ä¸ï¼\n\npublic class reflectfielddemo {\n    class fieldspy<t> {\n        public boolean[][] b = { {false, false}, {true, true} };\n        public string name = "alice";\n        public list<integer> list;\n        public t val;\n    }\n\n    public static void main(string[] args) throws nosuchfieldexception {\n        field f1 = fieldspy.class.getfield("b");\n        system.out.format("type: %s%n", f1.gettype());\n\n        field f2 = fieldspy.class.getfield("name");\n        system.out.format("type: %s%n", f2.gettype());\n\n        field f3 = fieldspy.class.getfield("list");\n        system.out.format("type: %s%n", f3.gettype());\n\n        field f4 = fieldspy.class.getfield("val");\n        system.out.format("type: %s%n", f4.gettype());\n    }\n}\n//output:\n//type: class [[z\n//type: class java.lang.string\n//type: interface java.util.list\n//type: class java.lang.object\n\n\n\n# method\n\nclass å¯¹è±¡æä¾ä»¥ä¸æ¹æ³è·åå¯¹è±¡çæ¹æ³ï¼methodï¼ï¼\n\n * getmethod - è¿åç±»ææ¥å£çç¹å®æ¹æ³ãå¶ä¸­ç¬¬ä¸ä¸ªåæ°ä¸ºæ¹æ³åç§°ï¼åé¢çåæ°ä¸ºæ¹æ³åæ°å¯¹åº class çå¯¹è±¡ã\n * getdeclaredmethod - è¿åç±»ææ¥å£çç¹å®å£°ææ¹æ³ãå¶ä¸­ç¬¬ä¸ä¸ªåæ°ä¸ºæ¹æ³åç§°ï¼åé¢çåæ°ä¸ºæ¹æ³åæ°å¯¹åº class çå¯¹è±¡ã\n * getmethods - è¿åç±»ææ¥å£çææ public æ¹æ³ï¼åæ¬å¶ç¶ç±»ç public æ¹æ³ã\n * getdeclaredmethods - è¿åç±»ææ¥å£å£°æçæææ¹æ³ï¼åæ¬ publicãprotectedãé»è®¤ï¼åï¼è®¿é®å private æ¹æ³ï¼ä½ä¸åæ¬ç»§æ¿çæ¹æ³ã\n\nè·åä¸ä¸ª method å¯¹è±¡åï¼å¯ä»¥ç¨ invoke æ¹æ³æ¥è°ç¨è¿ä¸ªæ¹æ³ã\n\ninvoke æ¹æ³çååä¸º:\n\npublic object invoke(object obj, object... args)\n        throws illegalaccessexception, illegalargumentexception,\n           invocationtargetexception\n\n\nãç¤ºä¾ã\n\npublic class reflectmethoddemo {\n    public static void main(string[] args)\n        throws nosuchmethodexception, invocationtargetexception, illegalaccessexception {\n\n        // è¿åæææ¹æ³\n        method[] methods1 = system.class.getdeclaredmethods();\n        system.out.println("system getdeclaredmethods æ¸åï¼æ°é = " + methods1.length + "ï¼ï¼");\n        for (method m : methods1) {\n            system.out.println(m);\n        }\n\n        // è¿åææ public æ¹æ³\n        method[] methods2 = system.class.getmethods();\n        system.out.println("system getmethods æ¸åï¼æ°é = " + methods2.length + "ï¼ï¼");\n        for (method m : methods2) {\n            system.out.println(m);\n        }\n\n        // å©ç¨ method ç invoke æ¹æ³è°ç¨ system.currenttimemillis()\n        method method = system.class.getmethod("currenttimemillis");\n        system.out.println(method);\n        system.out.println(method.invoke(null));\n    }\n}\n\n\n\n# constructor\n\nclass å¯¹è±¡æä¾ä»¥ä¸æ¹æ³è·åå¯¹è±¡çæé æ¹æ³ï¼constructorï¼ï¼\n\n * getconstructor - è¿åç±»çç¹å® public æé æ¹æ³ãåæ°ä¸ºæ¹æ³åæ°å¯¹åº class çå¯¹è±¡ã\n * getdeclaredconstructor - è¿åç±»çç¹å®æé æ¹æ³ãåæ°ä¸ºæ¹æ³åæ°å¯¹åº class çå¯¹è±¡ã\n * getconstructors - è¿åç±»çææ public æé æ¹æ³ã\n * getdeclaredconstructors - è¿åç±»çæææé æ¹æ³ã\n\nè·åä¸ä¸ª constructor å¯¹è±¡åï¼å¯ä»¥ç¨ newinstance æ¹æ³æ¥åå»ºç±»å®ä¾ã\n\nãç¤ºä¾ã\n\npublic class reflectmethodconstructordemo {\n    public static void main(string[] args)\n        throws nosuchmethodexception, illegalaccessexception, invocationtargetexception, instantiationexception {\n        constructor<?>[] constructors1 = string.class.getdeclaredconstructors();\n        system.out.println("string getdeclaredconstructors æ¸åï¼æ°é = " + constructors1.length + "ï¼ï¼");\n        for (constructor c : constructors1) {\n            system.out.println(c);\n        }\n\n        constructor<?>[] constructors2 = string.class.getconstructors();\n        system.out.println("string getconstructors æ¸åï¼æ°é = " + constructors2.length + "ï¼ï¼");\n        for (constructor c : constructors2) {\n            system.out.println(c);\n        }\n\n        system.out.println("====================");\n        constructor constructor = string.class.getconstructor(string.class);\n        system.out.println(constructor);\n        string str = (string) constructor.newinstance("bbb");\n        system.out.println(str);\n    }\n}\n\n\n\n# ç»å¼è®¿é®éå¶\n\nææ¶åï¼æä»¬éè¦éè¿åå°è®¿é®ç§ææåãæ¹æ³ãå¯ä»¥ä½¿ç¨ constructor/field/method.setaccessible(true) æ¥ç»å¼ java è¯­è¨çè®¿é®éå¶ã\n\n\n# å¨æä»£ç\n\nå¨æä»£çæ¯ä¸ç§æ¹ä¾¿è¿è¡æ¶å¨ææå»ºä»£çãå¨æå¤çä»£çæ¹æ³è°ç¨çæºå¶ï¼å¾å¤åºæ¯é½æ¯å©ç¨ç±»ä¼¼æºå¶åå°çï¼æ¯å¦ç¨æ¥åè£ rpc è°ç¨ãé¢ååé¢çç¼ç¨ï¼aopï¼ã\n\nå®ç°å¨æä»£ççæ¹å¼å¾å¤ï¼æ¯å¦ jdk èªèº«æä¾çå¨æä»£çï¼å°±æ¯ä¸»è¦å©ç¨äºä¸é¢æå°çåå°æºå¶ãè¿æå¶ä»çå®ç°æ¹å¼ï¼æ¯å¦å©ç¨ä¼ è¯´ä¸­æ´é«æ§è½çå­èç æä½æºå¶ï¼ç±»ä¼¼ asmãcglibï¼åºäº asmï¼ãjavassist ç­ã\n\n\n\n\n# éæä»£ç\n\n> éæä»£çå¶å®å°±æ¯æè®¾è®¡æ¨¡å¼ä¸­çä»£çæ¨¡å¼ã\n> \n> ä»£çæ¨¡å¼ä¸ºå¶ä»å¯¹è±¡æä¾ä¸ç§ä»£çä»¥æ§å¶å¯¹è¿ä¸ªå¯¹è±¡çè®¿é®ã\n\n\n\nsubject å®ä¹äº realsubject å proxy çå¬å±æ¥å£ï¼è¿æ ·å°±å¨ä»»ä½ä½¿ç¨ realsubject çå°æ¹é½å¯ä»¥ä½¿ç¨ proxy ã\n\nabstract class subject {\n    public abstract void request();\n}\n\n\nrealsubject å®ä¹ proxy æä»£è¡¨ççå®å®ä½ã\n\nclass realsubject extends subject {\n    @override\n    public void request() {\n        system.out.println("çå®çè¯·æ±");\n    }\n}\n\n\nproxy ä¿å­ä¸ä¸ªå¼ç¨ä½¿å¾ä»£çå¯ä»¥è®¿é®å®ä½ï¼å¹¶æä¾ä¸ä¸ªä¸ subject çæ¥å£ç¸åçæ¥å£ï¼è¿æ ·ä»£çå°±å¯ä»¥ç¨æ¥æ¿ä»£å®ä½ã\n\nclass proxy extends subject {\n    private realsubject real;\n\n    @override\n    public void request() {\n        if (null == real) {\n            real = new realsubject();\n        }\n        real.request();\n    }\n}\n\n\n> è¯´æï¼\n> \n> éæä»£çæ¨¡å¼åºç¶å¨è®¿é®æ æ³è®¿é®çèµæºï¼å¢å¼ºç°æçæ¥å£ä¸å¡åè½æ¹é¢æå¾å¤§çä¼ç¹ï¼ä½æ¯å¤§éä½¿ç¨è¿ç§éæä»£çï¼ä¼ä½¿æä»¬ç³»ç»åçç±»çè§æ¨¡å¢å¤§ï¼å¹¶ä¸ä¸æç»´æ¤ï¼å¹¶ä¸ç±äº proxy å realsubject çåè½æ¬è´¨ä¸æ¯ç¸åçï¼proxy åªæ¯èµ·å°äºä¸­ä»çä½ç¨ï¼è¿ç§ä»£çå¨ç³»ç»ä¸­çå­å¨ï¼å¯¼è´ç³»ç»ç»ææ¯è¾èè¿åæ¾æ£ã\n\n\n# jdk å¨æä»£ç\n\nä¸ºäºè§£å³éæä»£ççé®é¢ï¼å°±æäºåå»ºå¨æä»£ççæ³æ³ï¼\n\nå¨è¿è¡ç¶æä¸­ï¼éè¦ä»£ççå°æ¹ï¼æ ¹æ® subject å realsubjectï¼å¨æå°åå»ºä¸ä¸ª proxyï¼ç¨å®ä¹åï¼å°±ä¼éæ¯ï¼è¿æ ·å°±å¯ä»¥é¿åäº proxy è§è²ç class å¨ç³»ç»ä¸­åæçé®é¢äºã\n\n\n\njava å¨æä»£çåºäºç»å¸ä»£çæ¨¡å¼ï¼å¼å¥äºä¸ä¸ª invocationhandlerï¼invocationhandler è´è´£ç»ä¸ç®¡çææçæ¹æ³è°ç¨ã\n\nå¨æä»£çæ­¥éª¤ï¼\n\n 1. è·å realsubject ä¸çæææ¥å£åè¡¨ï¼\n 2. ç¡®å®è¦çæçä»£çç±»çç±»åï¼é»è®¤ä¸ºï¼com.sun.proxy.$proxyxxxxï¼\n 3. æ ¹æ®éè¦å®ç°çæ¥å£ä¿¡æ¯ï¼å¨ä»£ç ä¸­å¨æåå»º è¯¥ proxy ç±»çå­èç ï¼\n 4. å°å¯¹åºçå­èç è½¬æ¢ä¸ºå¯¹åºç class å¯¹è±¡ï¼\n 5. åå»º invocationhandler å®ä¾ handlerï¼ç¨æ¥å¤ç proxy æææ¹æ³è°ç¨ï¼\n 6. proxy ç class å¯¹è±¡ ä»¥åå»ºç handler å¯¹è±¡ä¸ºåæ°ï¼å®ä¾åä¸ä¸ª proxy å¯¹è±¡ã\n\nä»ä¸é¢å¯ä»¥çåºï¼jdk å¨æä»£ççå®ç°æ¯åºäºå®ç°æ¥å£çæ¹å¼ï¼ä½¿å¾ proxy å realsubject å·æç¸åçåè½ã\n\nä½å¶å®è¿æä¸ç§æè·¯ï¼éè¿ç»§æ¿ãå³ï¼è®© proxy ç»§æ¿ realsubjectï¼è¿æ ·äºèåæ ·å·æç¸åçåè½ï¼proxy è¿å¯ä»¥éè¿éå realsubject ä¸­çæ¹æ³ï¼æ¥å®ç°å¤æãcglib å°±æ¯åºäºè¿ç§æè·¯è®¾è®¡çã\n\nå¨ java çå¨æä»£çæºå¶ä¸­ï¼æä¸¤ä¸ªéè¦çç±»ï¼æ¥å£ï¼ï¼ä¸ä¸ªæ¯ invocationhandler æ¥å£ãå¦ä¸ä¸ªåæ¯ proxy ç±»ï¼è¿ä¸ä¸ªç±»åä¸ä¸ªæ¥å£æ¯å®ç°æä»¬å¨æä»£çæå¿é¡»ç¨å°çã\n\n# invocationhandler æ¥å£\n\ninvocationhandler æ¥å£å®ä¹ï¼\n\npublic interface invocationhandler {\n    public object invoke(object proxy, method method, object[] args)\n        throws throwable;\n}\n\n\næ¯ä¸ä¸ªå¨æä»£çç±»é½å¿é¡»è¦å®ç° invocationhandler è¿ä¸ªæ¥å£ï¼å¹¶ä¸æ¯ä¸ªä»£çç±»çå®ä¾é½å³èå°äºä¸ä¸ª handlerï¼å½æä»¬éè¿ä»£çå¯¹è±¡è°ç¨ä¸ä¸ªæ¹æ³çæ¶åï¼è¿ä¸ªæ¹æ³çè°ç¨å°±ä¼è¢«è½¬åä¸ºç± invocationhandler è¿ä¸ªæ¥å£ç invoke æ¹æ³æ¥è¿è¡è°ç¨ã\n\næä»¬æ¥çç invocationhandler è¿ä¸ªæ¥å£çå¯ä¸ä¸ä¸ªæ¹æ³ invoke æ¹æ³ï¼\n\nobject invoke(object proxy, method method, object[] args) throws throwable\n\n\nåæ°è¯´æï¼\n\n * proxy - ä»£çççå®å¯¹è±¡ã\n * method - æè¦è°ç¨çå®å¯¹è±¡çæä¸ªæ¹æ³ç method å¯¹è±¡\n * args - æè¦è°ç¨çå®å¯¹è±¡æä¸ªæ¹æ³æ¶æ¥åçåæ°\n\nå¦æä¸æ¯å¾æç½ï¼ç­ä¸éè¿ä¸ä¸ªå®ä¾ä¼å¯¹è¿å ä¸ªåæ°è¿è¡æ´æ·±çè®²è§£ã\n\n# proxy ç±»\n\nproxy è¿ä¸ªç±»çä½ç¨å°±æ¯ç¨æ¥å¨æåå»ºä¸ä¸ªä»£çå¯¹è±¡çç±»ï¼å®æä¾äºè®¸å¤çæ¹æ³ï¼ä½æ¯æä»¬ç¨çæå¤çå°±æ¯ newproxyinstance è¿ä¸ªæ¹æ³ï¼\n\npublic static object newproxyinstance(classloader loader, class<?>[] interfaces,  invocationhandler h)  throws illegalargumentexception\n\n\nè¿ä¸ªæ¹æ³çä½ç¨å°±æ¯å¾å°ä¸ä¸ªå¨æçä»£çå¯¹è±¡ã\n\nåæ°è¯´æï¼\n\n * loader - ä¸ä¸ª classloader å¯¹è±¡ï¼å®ä¹äºç±åªä¸ª classloader å¯¹è±¡æ¥å¯¹çæçä»£çå¯¹è±¡è¿è¡å è½½ã\n * interfaces - ä¸ä¸ª class<?> å¯¹è±¡çæ°ç»ï¼è¡¨ç¤ºçæ¯æå°è¦ç»æéè¦ä»£ççå¯¹è±¡æä¾ä¸ç»ä»ä¹æ¥å£ï¼å¦æææä¾äºä¸ç»æ¥å£ç»å®ï¼é£ä¹è¿ä¸ªä»£çå¯¹è±¡å°±å®£ç§°å®ç°äºè¯¥æ¥å£(å¤æ)ï¼è¿æ ·æå°±è½è°ç¨è¿ç»æ¥å£ä¸­çæ¹æ³äº\n * h - ä¸ä¸ª invocationhandler å¯¹è±¡ï¼è¡¨ç¤ºçæ¯å½æè¿ä¸ªå¨æä»£çå¯¹è±¡å¨è°ç¨æ¹æ³çæ¶åï¼ä¼å³èå°åªä¸ä¸ª invocationhandler å¯¹è±¡ä¸\n\n# jdk å¨æä»£çå®ä¾\n\nä¸é¢çåå®¹ä»ç»å®è¿ä¸¤ä¸ªæ¥å£(ç±»)ä»¥åï¼æä»¬æ¥éè¿ä¸ä¸ªå®ä¾æ¥ççæä»¬çå¨æä»£çæ¨¡å¼æ¯ä»ä¹æ ·çï¼\n\né¦åæä»¬å®ä¹äºä¸ä¸ª subject ç±»åçæ¥å£ï¼ä¸ºå¶å£°æäºä¸¤ä¸ªæ¹æ³ï¼\n\npublic interface subject {\n\n    void hello(string str);\n\n    string bye();\n}\n\n\næ¥çï¼å®ä¹äºä¸ä¸ªç±»æ¥å®ç°è¿ä¸ªæ¥å£ï¼è¿ä¸ªç±»å°±æ¯æä»¬ççå®å¯¹è±¡ï¼realsubject ç±»ï¼\n\npublic class realsubject implements subject {\n\n    @override\n    public void hello(string str) {\n        system.out.println("hello  " + str);\n    }\n\n    @override\n    public string bye() {\n        system.out.println("goodbye");\n        return "over";\n    }\n}\n\n\nä¸ä¸æ­¥ï¼æä»¬å°±è¦å®ä¹ä¸ä¸ªå¨æä»£çç±»äºï¼åé¢è¯´ä¸ªï¼æ¯ä¸ä¸ªå¨æä»£çç±»é½å¿é¡»è¦å®ç° invocationhandler è¿ä¸ªæ¥å£ï¼å æ­¤æä»¬è¿ä¸ªå¨æä»£çç±»ä¹ä¸ä¾å¤ï¼\n\npublic class invocationhandlerdemo implements invocationhandler {\n    // è¿ä¸ªå°±æ¯æä»¬è¦ä»£çççå®å¯¹è±¡\n    private object subject;\n\n    // æé æ¹æ³ï¼ç»æä»¬è¦ä»£çççå®å¯¹è±¡èµåå¼\n    public invocationhandlerdemo(object subject) {\n        this.subject = subject;\n    }\n\n    @override\n    public object invoke(object object, method method, object[] args)\n        throws throwable {\n        // å¨ä»£ççå®å¯¹è±¡åæä»¬å¯ä»¥æ·»å ä¸äºèªå·±çæä½\n        system.out.println("before method");\n\n        system.out.println("call method: " + method);\n\n        // å½ä»£çå¯¹è±¡è°ç¨çå®å¯¹è±¡çæ¹æ³æ¶ï¼å¶ä¼èªå¨çè·³è½¬å°ä»£çå¯¹è±¡å³èçhandlerå¯¹è±¡çinvokeæ¹æ³æ¥è¿è¡è°ç¨\n        object obj = method.invoke(subject, args);\n\n        // å¨ä»£ççå®å¯¹è±¡åæä»¬ä¹å¯ä»¥æ·»å ä¸äºèªå·±çæä½\n        system.out.println("after method");\n        system.out.println();\n\n        return obj;\n    }\n}\n\n\næåï¼æ¥ççæä»¬ç client ç±»ï¼\n\npublic class client {\n    public static void main(string[] args) {\n        // æä»¬è¦ä»£çççå®å¯¹è±¡\n        subject realsubject = new realsubject();\n\n        // æä»¬è¦ä»£çåªä¸ªçå®å¯¹è±¡ï¼å°±å°è¯¥å¯¹è±¡ä¼ è¿å»ï¼æåæ¯éè¿è¯¥çå®å¯¹è±¡æ¥è°ç¨å¶æ¹æ³ç\n        invocationhandler handler = new invocationhandlerdemo(realsubject);\n\n        /*\n         * éè¿proxyçnewproxyinstanceæ¹æ³æ¥åå»ºæä»¬çä»£çå¯¹è±¡ï¼æä»¬æ¥ççå¶ä¸ä¸ªåæ°\n         * ç¬¬ä¸ä¸ªåæ° handler.getclass().getclassloader() ï¼æä»¬è¿éä½¿ç¨handlerè¿ä¸ªç±»çclassloaderå¯¹è±¡æ¥å è½½æä»¬çä»£çå¯¹è±¡\n         * ç¬¬äºä¸ªåæ°realsubject.getclass().getinterfaces()ï¼æä»¬è¿éä¸ºä»£çå¯¹è±¡æä¾çæ¥å£æ¯çå®å¯¹è±¡æå®è¡çæ¥å£ï¼è¡¨ç¤ºæè¦ä»£ççæ¯è¯¥çå®å¯¹è±¡ï¼è¿æ ·æå°±è½è°ç¨è¿ç»æ¥å£ä¸­çæ¹æ³äº\n         * ç¬¬ä¸ä¸ªåæ°handlerï¼ æä»¬è¿éå°è¿ä¸ªä»£çå¯¹è±¡å³èå°äºä¸æ¹ç invocationhandler è¿ä¸ªå¯¹è±¡ä¸\n         */\n        subject subject = (subject)proxy.newproxyinstance(handler.getclass().getclassloader(), realsubject\n                .getclass().getinterfaces(), handler);\n\n        system.out.println(subject.getclass().getname());\n        subject.hello("world");\n        string result = subject.bye();\n        system.out.println("result is: " + result);\n    }\n}\n\n\næä»¬åæ¥ççæ§å¶å°çè¾åºï¼\n\ncom.sun.proxy.$proxy0\nbefore method\ncall method: public abstract void io.github.dunwu.javacore.reflect.invocationhandlerdemo$subject.hello(java.lang.string)\nhello  world\nafter method\n\nbefore method\ncall method: public abstract java.lang.string io.github.dunwu.javacore.reflect.invocationhandlerdemo$subject.bye()\ngoodbye\nafter method\n\nresult is: over\n\n\næä»¬é¦åæ¥çç com.sun.proxy.$proxy0 è¿ä¸è¥¿ï¼æä»¬çå°ï¼è¿ä¸ªä¸è¥¿æ¯ç± system.out.println(subject.getclass().getname()); è¿æ¡è¯­å¥æå°åºæ¥çï¼é£ä¹ä¸ºä»ä¹æä»¬è¿åçè¿ä¸ªä»£çå¯¹è±¡çç±»åæ¯è¿æ ·çå¢ï¼\n\nsubject subject = (subject)proxy.newproxyinstance(handler.getclass().getclassloader(), realsubject\n                .getclass().getinterfaces(), handler);\n\n\nå¯è½æä»¥ä¸ºè¿åçè¿ä¸ªä»£çå¯¹è±¡ä¼æ¯ subject ç±»åçå¯¹è±¡ï¼æèæ¯ invocationhandler çå¯¹è±¡ï¼ç»æå´ä¸æ¯ï¼é¦åæä»¬è§£éä¸ä¸ä¸ºä»ä¹æä»¬è¿éå¯ä»¥å°å¶è½¬åä¸º subject ç±»åçå¯¹è±¡ï¼\n\nåå å°±æ¯ï¼å¨ newproxyinstance è¿ä¸ªæ¹æ³çç¬¬äºä¸ªåæ°ä¸ï¼æä»¬ç»è¿ä¸ªä»£çå¯¹è±¡æä¾äºä¸ç»ä»ä¹æ¥å£ï¼é£ä¹æè¿ä¸ªä»£çå¯¹è±¡å°±ä¼å®ç°äºè¿ç»æ¥å£ï¼è¿ä¸ªæ¶åæä»¬å½ç¶å¯ä»¥å°è¿ä¸ªä»£çå¯¹è±¡å¼ºå¶ç±»åè½¬åä¸ºè¿ç»æ¥å£ä¸­çä»»æä¸ä¸ªï¼å ä¸ºè¿éçæ¥å£æ¯ subject ç±»åï¼æä»¥å°±å¯ä»¥å°å¶è½¬åä¸º subject ç±»åäºã\n\nåæ¶æä»¬ä¸å®è¦è®°ä½ï¼éè¿ proxy.newproxyinstance åå»ºçä»£çå¯¹è±¡æ¯å¨ jvm è¿è¡æ¶å¨æçæçä¸ä¸ªå¯¹è±¡ï¼å®å¹¶ä¸æ¯æä»¬ç invocationhandler ç±»åï¼ä¹ä¸æ¯æä»¬å®ä¹çé£ç»æ¥å£çç±»åï¼èæ¯å¨è¿è¡æ¯å¨æçæçä¸ä¸ªå¯¹è±¡ï¼å¹¶ä¸å½åæ¹å¼é½æ¯è¿æ ·çå½¢å¼ï¼ä»¥$å¼å¤´ï¼proxy ä¸ºä¸­ï¼æåä¸ä¸ªæ°å­è¡¨ç¤ºå¯¹è±¡çæ å·ã\n\næ¥çæä»¬æ¥ççè¿ä¸¤å¥\n\nsubject.hello("world");\nstring result = subject.bye();\n\n\nè¿éæ¯éè¿ä»£çå¯¹è±¡æ¥è°ç¨å®ç°çé£ç§æ¥å£ä¸­çæ¹æ³ï¼è¿ä¸ªæ¶åç¨åºå°±ä¼è·³è½¬å°ç±è¿ä¸ªä»£çå¯¹è±¡å³èå°ç handler ä¸­ç invoke æ¹æ³å»æ§è¡ï¼èæä»¬çè¿ä¸ª handler å¯¹è±¡åæ¥åäºä¸ä¸ª realsubject ç±»åçåæ°ï¼è¡¨ç¤ºæè¦ä»£ççå°±æ¯è¿ä¸ªçå®å¯¹è±¡ï¼æä»¥æ­¤æ¶å°±ä¼è°ç¨ handler ä¸­ç invoke æ¹æ³å»æ§è¡ã\n\næä»¬çå°ï¼å¨çæ­£éè¿ä»£çå¯¹è±¡æ¥è°ç¨çå®å¯¹è±¡çæ¹æ³çæ¶åï¼æä»¬å¯ä»¥å¨è¯¥æ¹æ³ååæ·»å èªå·±çä¸äºæä½ï¼åæ¶æä»¬çå°æä»¬çè¿ä¸ª method å¯¹è±¡æ¯è¿æ ·çï¼\n\npublic abstract void io.github.dunwu.javacore.reflect.invocationhandlerdemo$subject.hello(java.lang.string)\npublic abstract java.lang.string io.github.dunwu.javacore.reflect.invocationhandlerdemo$subject.bye()\n\n\næ­£å¥½å°±æ¯æä»¬ç subject æ¥å£ä¸­çä¸¤ä¸ªæ¹æ³ï¼è¿ä¹å°±è¯æäºå½æéè¿ä»£çå¯¹è±¡æ¥è°ç¨æ¹æ³çæ¶åï¼èµ·å®éå°±æ¯å§æç±å¶å³èå°ç handler å¯¹è±¡ç invoke æ¹æ³ä¸­æ¥è°ç¨ï¼å¹¶ä¸æ¯èªå·±æ¥çå®è°ç¨ï¼èæ¯éè¿ä»£ççæ¹å¼æ¥è°ç¨çã\n\n# jdk å¨æä»£çå°ç»\n\nä»£çç±»ä¸å§æç±»å®ç°åä¸æ¥å£ï¼ä¸»è¦æ¯éè¿ä»£çç±»å®ç° invocationhandler å¹¶éå invoke æ¹æ³æ¥è¿è¡å¨æä»£ççï¼å¨ invoke æ¹æ³ä¸­å°å¯¹æ¹æ³è¿è¡å¤çã\n\njdk å¨æä»£çç¹ç¹ï¼\n\n * ä¼ç¹ï¼ç¸å¯¹äºéæä»£çæ¨¡å¼ï¼ä¸éè¦ç¡¬ç¼ç æ¥å£ï¼ä»£ç å¤ç¨çé«ã\n\n * ç¼ºç¹ï¼å¼ºå¶è¦æ±ä»£çç±»å®ç° invocationhandler æ¥å£ã\n\n\n# cglib å¨æä»£ç\n\ncglib æä¾äºä¸ jdk å¨æä»£çä¸åçæ¹æ¡ãå¾å¤æ¡æ¶ï¼ä¾å¦ spring aop ä¸­ï¼å°±ä½¿ç¨äº cglib å¨æä»£çã\n\ncglib åºå±ï¼å¶å®æ¯åå©äº asm è¿ä¸ªå¼ºå¤§ç java å­èç æ¡æ¶å»è¿è¡å­èç å¢å¼ºæä½ã\n\ncglib å¨æä»£ççå·¥ä½æ­¥éª¤ï¼\n\n * çæä»£çç±»çäºè¿å¶å­èç æä»¶ï¼\n * å è½½äºè¿å¶å­èç ï¼çæ class å¯¹è±¡( ä¾å¦ä½¿ç¨ class.forname() æ¹æ³ )ï¼\n * éè¿åå°æºå¶è·å¾å®ä¾æé ï¼å¹¶åå»ºä»£çç±»å¯¹è±¡ã\n\ncglib å¨æä»£çç¹ç¹ï¼\n\nä¼ç¹ï¼ä½¿ç¨å­èç å¢å¼ºï¼æ¯ jdk å¨æä»£çæ¹å¼æ§è½é«ãå¯ä»¥å¨è¿è¡æ¶å¯¹ç±»æèæ¯æ¥å£è¿è¡å¢å¼ºæä½ï¼ä¸å§æç±»æ éå®ç°æ¥å£ã\n\nç¼ºç¹ï¼ä¸è½å¯¹ final ç±»ä»¥å final æ¹æ³è¿è¡ä»£çã\n\n> åèï¼æ·±å¥çè§£ cglib å¨æä»£çæºå¶\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * æ·±å¥æè§£ java èææº\n * æ·±å¥è§£æ java åå°ï¼1ï¼ - åºç¡\n * java åºç¡ä¹âåå°ï¼éå¸¸éè¦ï¼\n * å®æ¹ reflection api ææ¡£\n * java çå¨æä»£çæºå¶è¯¦è§£\n * java å¨æä»£çæºå¶è¯¦è§£ï¼jdk å cglibï¼javassistï¼asmï¼\n * æ·±å¥çè§£ jdk å¨æä»£çæºå¶\n * æ·±å¥çè§£ cglib å¨æä»£çæºå¶',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java æ³¨è§£",frontmatter:{title:"æ·±å¥çè§£ Java æ³¨è§£",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","æ³¨è§£"],permalink:"/pages/ecc011/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/11.Java%E6%B3%A8%E8%A7%A3.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/11.Javaæ³¨è§£.md",key:"v-615708fd",path:"/pages/ecc011/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:96},{level:3,title:"æ³¨è§£çå½¢å¼",slug:"æ³¨è§£çå½¢å¼",normalizedTitle:"æ³¨è§£çå½¢å¼",charIndex:103},{level:3,title:"ä»ä¹æ¯æ³¨è§£",slug:"ä»ä¹æ¯æ³¨è§£",normalizedTitle:"ä»ä¹æ¯æ³¨è§£",charIndex:419},{level:3,title:"æ³¨è§£çä½ç¨",slug:"æ³¨è§£çä½ç¨",normalizedTitle:"æ³¨è§£çä½ç¨",charIndex:646},{level:3,title:"æ³¨è§£çä»£ä»·",slug:"æ³¨è§£çä»£ä»·",normalizedTitle:"æ³¨è§£çä»£ä»·",charIndex:933},{level:3,title:"æ³¨è§£çåºç¨èå´",slug:"æ³¨è§£çåºç¨èå´",normalizedTitle:"æ³¨è§£çåºç¨èå´",charIndex:1166},{level:2,title:"åç½®æ³¨è§£",slug:"åç½®æ³¨è§£",normalizedTitle:"åç½®æ³¨è§£",charIndex:1487},{level:3,title:"@Override",slug:"override",normalizedTitle:"@override",charIndex:138},{level:3,title:"@Deprecated",slug:"deprecated",normalizedTitle:"@deprecated",charIndex:1524},{level:3,title:"@SuppressWarnnings",slug:"suppresswarnnings",normalizedTitle:"@suppresswarnnings",charIndex:1539},{level:3,title:"@SafeVarargs",slug:"safevarargs",normalizedTitle:"@safevarargs",charIndex:1561},{level:3,title:"@FunctionalInterface",slug:"functionalinterface",normalizedTitle:"@functionalinterface",charIndex:1586},{level:2,title:"åæ³¨è§£",slug:"åæ³¨è§£",normalizedTitle:"åæ³¨è§£",charIndex:7740},{level:3,title:"@Retention",slug:"retention",normalizedTitle:"@retention",charIndex:7851},{level:3,title:"@Documented",slug:"documented",normalizedTitle:"@documented",charIndex:7876},{level:3,title:"@Target",slug:"target",normalizedTitle:"@target",charIndex:7865},{level:3,title:"@Inherited",slug:"inherited",normalizedTitle:"@inherited",charIndex:7891},{level:3,title:"@Repeatable",slug:"repeatable",normalizedTitle:"@repeatable",charIndex:7914},{level:2,title:"èªå®ä¹æ³¨è§£",slug:"èªå®ä¹æ³¨è§£",normalizedTitle:"èªå®ä¹æ³¨è§£",charIndex:614},{level:3,title:"æ³¨è§£çå®ä¹",slug:"æ³¨è§£çå®ä¹",normalizedTitle:"æ³¨è§£çå®ä¹",charIndex:11321},{level:3,title:"æ³¨è§£å±æ§",slug:"æ³¨è§£å±æ§",normalizedTitle:"æ³¨è§£å±æ§",charIndex:11892},{level:3,title:"æ³¨è§£å¤çå¨",slug:"æ³¨è§£å¤çå¨",normalizedTitle:"æ³¨è§£å¤çå¨",charIndex:12408},{level:3,title:"ä½¿ç¨æ³¨è§£",slug:"ä½¿ç¨æ³¨è§£",normalizedTitle:"ä½¿ç¨æ³¨è§£",charIndex:746},{level:2,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:19110},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:19125}],headersStr:"ç®ä» æ³¨è§£çå½¢å¼ ä»ä¹æ¯æ³¨è§£ æ³¨è§£çä½ç¨ æ³¨è§£çä»£ä»· æ³¨è§£çåºç¨èå´ åç½®æ³¨è§£ @Override @Deprecated @SuppressWarnnings @SafeVarargs @FunctionalInterface åæ³¨è§£ @Retention @Documented @Target @Inherited @Repeatable èªå®ä¹æ³¨è§£ æ³¨è§£çå®ä¹ æ³¨è§£å±æ§ æ³¨è§£å¤çå¨ ä½¿ç¨æ³¨è§£ å°ç» åèèµæ",content:'# æ·±å¥çè§£ Java æ³¨è§£\n\n> æ¬æåå®¹åºäº JDK8ãæ³¨è§£æ¯ JDK5 å¼å¥çï¼åç»­ JDK çæ¬æ©å±äºä¸äºåå®¹ï¼æ¬æä¸­æ²¡ææç¡®ææçæ¬çæ³¨è§£é½æ¯ JDK5 å°±å·²ç»æ¯æçæ³¨è§£ã\n\n\n# ç®ä»\n\n\n# æ³¨è§£çå½¢å¼\n\nJava ä¸­ï¼æ³¨è§£æ¯ä»¥ @ å­ç¬¦å¼å§çä¿®é¥°ç¬¦ãå¦ä¸ï¼\n\n@Override\nvoid mySuperMethod() { ... }\n\n\næ³¨è§£å¯ä»¥åå«å½åææªå½åçå±æ§ï¼å¹¶ä¸è¿äºå±æ§æå¼ã\n\n@Author(\n   name = "Benjamin Franklin",\n   date = "3/27/2003"\n)\nclass MyClass() { ... }\n\n\nå¦æåªæä¸ä¸ªåä¸º value çå±æ§ï¼é£ä¹åç§°å¯ä»¥çç¥ï¼å¦ï¼\n\n@SuppressWarnings("unchecked")\nvoid myMethod() { ... }\n\n\nå¦ææ³¨è§£æ²¡æå±æ§ï¼åç§°ä¸ºæ è®°æ³¨è§£ãå¦ï¼@Overrideã\n\n\n# ä»ä¹æ¯æ³¨è§£\n\nä»æ¬è´¨ä¸æ¥è¯´ï¼æ³¨è§£æ¯ä¸ç§æ ç­¾ï¼å¶å®è´¨ä¸å¯ä»¥è§ä¸ºä¸ç§ç¹æ®çæ³¨éï¼å¦ææ²¡æè§£æå®çä»£ç ï¼å®å¹¶ä¸æ¯æ®éæ³¨éå¼ºã\n\nè§£æä¸ä¸ªæ³¨è§£å¾å¾æä¸¤ç§å½¢å¼ï¼\n\n * ç¼è¯æç´æ¥çæ«æ - ç¼è¯å¨çæ«ææçæ¯ç¼è¯å¨å¨å¯¹ java ä»£ç ç¼è¯å­èç çè¿ç¨ä¸­ä¼æ£æµå°æä¸ªç±»æèæ¹æ³è¢«ä¸äºæ³¨è§£ä¿®é¥°ï¼è¿æ¶å®å°±ä¼å¯¹äºè¿äºæ³¨è§£è¿è¡æäºå¤çãè¿ç§æåµåªéç¨äº JDK åç½®çæ³¨è§£ç±»ã\n * è¿è¡æçåå° - å¦æè¦èªå®ä¹æ³¨è§£ï¼Java ç¼è¯å¨æ æ³è¯å«å¹¶å¤çè¿ä¸ªæ³¨è§£ï¼å®åªè½æ ¹æ®è¯¥æ³¨è§£çä½ç¨èå´æ¥éæ©æ¯å¦ç¼è¯è¿å­èç æä»¶ãå¦æè¦å¤çæ³¨è§£ï¼å¿é¡»å©ç¨åå°ææ¯ï¼è¯å«è¯¥æ³¨è§£ä»¥åå®ææºå¸¦çä¿¡æ¯ï¼ç¶ååç¸åºçå¤çã\n\n\n# æ³¨è§£çä½ç¨\n\næ³¨è§£æè®¸å¤ç¨éï¼\n\n * ç¼è¯å¨ä¿¡æ¯ - ç¼è¯å¨å¯ä»¥ä½¿ç¨æ³¨è§£æ¥æ£æµéè¯¯ææå¶è­¦åã\n * ç¼è¯æ¶åé¨ç½²æ¶çå¤ç - ç¨åºå¯ä»¥å¤çæ³¨è§£ä¿¡æ¯ä»¥çæä»£ç ï¼XML æä»¶ç­ã\n * è¿è¡æ¶å¤ç - å¯ä»¥å¨è¿è¡æ¶æ£æ¥æäºæ³¨è§£å¹¶å¤çã\n\nä½ä¸º Java ç¨åºåï¼å¤å¤å°å°é½æ¾ç»åè¿è¢«åç§éç½®æä»¶ï¼xmlãpropertiesï¼æ¯éçææ§ãè¿å¤çéç½®æä»¶ä¼ä½¿å¾é¡¹ç®é¾ä»¥ç»´æ¤ãä¸ªäººè®¤ä¸ºï¼ä½¿ç¨æ³¨è§£ä»¥åå°éç½®æä»¶æä»£ç ï¼æ¯æ³¨è§£æå¤§çç¨å¤ã\n\n\n# æ³¨è§£çä»£ä»·\n\nå¡äºæå¾å¿æå¤±ï¼æ³¨è§£ææ¯åæ ·å¦æ­¤ãä½¿ç¨æ³¨è§£ä¹æä¸å®çä»£ä»·ï¼\n\n * æ¾ç¶ï¼å®æ¯ä¸ç§ä¾µå¥å¼ç¼ç¨ï¼é£ä¹ï¼èªç¶å°±å­å¨çå¢å ç¨åºè¦ååº¦çé®é¢ã\n * èªå®ä¹æ³¨è§£çå¤çéè¦å¨è¿è¡æ¶ï¼éè¿åå°ææ¯æ¥è·åå±æ§ãå¦ææ³¨è§£æä¿®é¥°çåç´ æ¯ç±»çé public æåï¼ä¹å¯ä»¥éè¿åå°è·åãè¿å°±è¿èäºé¢åå¯¹è±¡çå°è£æ§ã\n * æ³¨è§£æäº§ççé®é¢ï¼ç¸å¯¹èè¨ï¼æ´é¾ä»¥ debug æå®ä½ã\n\nä½æ¯ï¼æ­£æè°çä¸æ©çï¼æ³¨è§£æä»åºçä»£ä»·ï¼ç¸è¾äºå®æä¾çåè½èè¨ï¼è¿æ¯å¯ä»¥æ¥åçã\n\n\n# æ³¨è§£çåºç¨èå´\n\næ³¨è§£å¯ä»¥åºç¨äºç±»ãå­æ®µãæ¹æ³åå¶ä»ç¨åºåç´ çå£°æã\n\nJDK8 å¼å§ï¼æ³¨è§£çåºç¨èå´è¿ä¸æ­¥æ©å¤§ï¼ä»¥ä¸æ¯æ°çåºç¨èå´ï¼\n\nç±»å®ä¾åå§åè¡¨è¾¾å¼ï¼\n\nnew @Interned MyObject();\n\n\nç±»åè½¬æ¢ï¼\n\nmyString = (@NonNull String) str;\n\n\nå®ç°æ¥å£çå£°æï¼\n\nclass UnmodifiableList<T> implements\n    @Readonly List<@Readonly T> {}\n\n\næåºå¼å¸¸å£°æï¼\n\nvoid monitorTemperature()\n    throws @Critical TemperatureException {}\n\n\n\n# åç½®æ³¨è§£\n\nJDK ä¸­åç½®äºä»¥ä¸æ³¨è§£ï¼\n\n * @Override\n * @Deprecated\n * @SuppressWarnnings\n * @SafeVarargsï¼JDK7 å¼å¥ï¼\n * @FunctionalInterfaceï¼JDK8 å¼å¥ï¼\n\n\n# @Override\n\n@Override ç¨äºè¡¨æè¢«ä¿®é¥°æ¹æ³è¦åäºç¶ç±»çæ¹æ³ã\n\nå¦æè¯å¾ä½¿ç¨ @Override æ è®°ä¸ä¸ªå®éä¸å¹¶æ²¡æè¦åç¶ç±»çæ¹æ³æ¶ï¼java ç¼è¯å¨ä¼åè­¦ã\n\n@Override ç¤ºä¾ï¼\n\npublic class OverrideAnnotationDemo {\n\n    static class Person {\n        public String getName() {\n            return "getName";\n        }\n    }\n\n\n    static class Man extends Person {\n        @Override\n        public String getName() {\n            return "override getName";\n        }\n\n        /**\n         *  æ¾å¼ä¸é¢çæ³¨éï¼ç¼è¯æ¶ä¼åè­¦\n         */\n       /*\n        @Override\n        public String getName2() {\n            return "override getName2";\n        }\n        */\n    }\n\n    public static void main(String[] args) {\n        Person per = new Man();\n        System.out.println(per.getName());\n    }\n}\n\n\n\n# @Deprecated\n\n@Deprecated ç¨äºæ æè¢«ä¿®é¥°çç±»æç±»æåãç±»æ¹æ³å·²ç»åºå¼ãè¿æ¶ï¼ä¸å»ºè®®ä½¿ç¨ã\n\n@Deprecated æä¸å®çå»¶ç»­æ§ï¼å¦ææä»¬å¨ä»£ç ä¸­éè¿ç»§æ¿æèè¦ççæ¹å¼ä½¿ç¨äºè¿æ¶çç±»æç±»æåï¼å³ä½¿å­ç±»æå­æ¹æ³æ²¡ææ è®°ä¸º @Deprecatedï¼ä½ç¼è¯å¨ä»ç¶ä¼åè­¦ã\n\n> ð æ³¨æï¼ @Deprecated è¿ä¸ªæ³¨è§£ç±»åå javadoc ä¸­ç @deprecated è¿ä¸ª tag æ¯æåºå«çï¼åèæ¯ java ç¼è¯å¨è¯å«çï¼èåèæ¯è¢« javadoc å·¥å·æè¯å«ç¨æ¥çæææ¡£ï¼åå«ç¨åºæåä¸ºä»ä¹å·²ç»è¿æ¶ãå®åºå½å¦ä½è¢«ç¦æ­¢æèæ¿ä»£çæè¿°ï¼ã\n\n@Deprecated ç¤ºä¾ï¼\n\npublic class DeprecatedAnnotationDemo {\n    static class DeprecatedField {\n        @Deprecated\n        public static final String DEPRECATED_FIELD = "DeprecatedField";\n    }\n\n\n    static class DeprecatedMethod {\n        @Deprecated\n        public String print() {\n            return "DeprecatedMethod";\n        }\n    }\n\n\n    @Deprecated\n    static class DeprecatedClass {\n        public String print() {\n            return "DeprecatedClass";\n        }\n    }\n\n    public static void main(String[] args) {\n        System.out.println(DeprecatedField.DEPRECATED_FIELD);\n\n        DeprecatedMethod dm = new DeprecatedMethod();\n        System.out.println(dm.print());\n\n\n        DeprecatedClass dc = new DeprecatedClass();\n        System.out.println(dc.print());\n    }\n}\n//Output:\n//DeprecatedField\n//DeprecatedMethod\n//DeprecatedClass\n\n\n\n# @SuppressWarnnings\n\n@SuppressWarnings ç¨äºå³é­å¯¹ç±»ãæ¹æ³ãæåç¼è¯æ¶äº§ççç¹å®è­¦åã\n\n@SuppressWarning ä¸æ¯ä¸ä¸ªæ è®°æ³¨è§£ãå®æä¸ä¸ªç±»åä¸º String[] çæ°ç»æåï¼è¿ä¸ªæ°ç»ä¸­å­å¨çæ¯è¦å³é­çåè­¦ç±»åãå¯¹äº javac ç¼è¯å¨æ¥è®²ï¼å¯¹ -Xlint éé¡¹ææçè­¦ååä¹åæ ·å¯¹ @SuppressWarings ææï¼åæ¶ç¼è¯å¨ä¼å¿½ç¥ææ æ³è¯å«çè­¦ååã\n\n@SuppressWarning ç¤ºä¾ï¼\n\n@SuppressWarnings({"rawtypes", "unchecked"})\npublic class SuppressWarningsAnnotationDemo {\n    static class SuppressDemo<T> {\n        private T value;\n\n        public T getValue() {\n            return this.value;\n        }\n\n        public void setValue(T var) {\n            this.value = var;\n        }\n    }\n\n    @SuppressWarnings({"deprecation"})\n    public static void main(String[] args) {\n        SuppressDemo d = new SuppressDemo();\n        d.setValue("åäº¬");\n        System.out.println("å°åï¼" + d.getValue());\n    }\n}\n\n\n@SuppressWarnings æ³¨è§£çå¸¸è§åæ°å¼çç®åè¯´æï¼\n\n * deprecation - ä½¿ç¨äºä¸èµæä½¿ç¨çç±»ææ¹æ³æ¶çè­¦åï¼\n * unchecked - æ§è¡äºæªæ£æ¥çè½¬æ¢æ¶çè­¦åï¼ä¾å¦å½ä½¿ç¨éåæ¶æ²¡æç¨æ³å (Generics) æ¥æå®éåä¿å­çç±»å;\n * fallthrough - å½ Switch ç¨åºåç´æ¥éå¾ä¸ä¸ç§æåµèæ²¡æ Break æ¶çè­¦å;\n * path - å¨ç±»è·¯å¾ãæºæä»¶è·¯å¾ç­ä¸­æä¸å­å¨çè·¯å¾æ¶çè­¦å;\n * serial - å½å¨å¯åºååçç±»ä¸ç¼ºå° serialVersionUID å®ä¹æ¶çè­¦å;\n * finally - ä»»ä½ finally å­å¥ä¸è½æ­£å¸¸å®ææ¶çè­¦å;\n * all - ææçè­¦åã\n\n@SuppressWarnings({"uncheck", "deprecation"})\npublic class InternalAnnotationDemo {\n\n    /**\n     * @SuppressWarnings æ è®°æ¶é¤å½åç±»çåè­¦ä¿¡æ¯\n     */\n    @SuppressWarnings({"deprecation"})\n    static class A {\n        public void method1() {\n            System.out.println("call method1");\n        }\n\n        /**\n         * @Deprecated æ è®°å½åæ¹æ³ä¸ºåºå¼æ¹æ³ï¼ä¸å»ºè®®ä½¿ç¨\n         */\n        @Deprecated\n        public void method2() {\n            System.out.println("call method2");\n        }\n    }\n\n    /**\n     * @Deprecated æ è®°å½åç±»ä¸ºåºå¼ç±»ï¼ä¸å»ºè®®ä½¿ç¨\n     */\n    @Deprecated\n    static class B extends A {\n        /**\n         * @Override æ è®°æ¾ç¤ºææå½åæ¹æ³è¦åäºç¶ç±»ææ¥å£çæ¹æ³\n         */\n        @Override\n        public void method1() { }\n    }\n\n    public static void main(String[] args) {\n        A obj = new B();\n        obj.method1();\n        obj.method2();\n    }\n}\n\n\n\n# @SafeVarargs\n\n@SafeVarargs å¨ JDK7 ä¸­å¼å¥ã\n\n@SafeVarargs çä½ç¨æ¯ï¼åè¯ç¼è¯å¨ï¼å¨å¯åé¿åæ°ä¸­çæ³åæ¯ç±»åå®å¨çãå¯åé¿åæ°æ¯ä½¿ç¨æ°ç»å­å¨çï¼èæ°ç»åæ³åä¸è½å¾å¥½çæ··åä½¿ç¨ã\n\nç®åçè¯´ï¼æ°ç»åç´ çæ°æ®ç±»åå¨ç¼è¯åè¿è¡æ¶é½æ¯ç¡®å®çï¼èæ³åçæ°æ®ç±»ååªæå¨è¿è¡æ¶æè½ç¡®å®ä¸æ¥ãå æ­¤ï¼å½æä¸ä¸ªæ³åå­å¨å°æ°ç»ä¸­æ¶ï¼ç¼è¯å¨å¨ç¼è¯é¶æ®µæ æ³ç¡®è®¤æ°æ®ç±»åæ¯å¦å¹éï¼å æ­¤ä¼ç»åºè­¦åä¿¡æ¯ï¼å³å¦ææ³åççå®æ°æ®ç±»åæ æ³ååæ°æ°ç»çç±»åå¹éï¼ä¼å¯¼è´ ClassCastException å¼å¸¸ã\n\n@SafeVarargs æ³¨è§£ä½¿ç¨èå´ï¼\n\n * @SafeVarargs æ³¨è§£å¯ä»¥ç¨äºæé æ¹æ³ã\n * @SafeVarargs æ³¨è§£å¯ä»¥ç¨äº static æ final æ¹æ³ã\n\n@SafeVarargs ç¤ºä¾ï¼\n\npublic class SafeVarargsAnnotationDemo {\n    /**\n     * æ­¤æ¹æ³å®éä¸å¹¶ä¸å®å¨ï¼ä¸ä½¿ç¨æ­¤æ³¨è§£ï¼ç¼è¯æ¶ä¼åè­¦\n     */\n    @SafeVarargs\n    static void wrongMethod(List<String>... stringLists) {\n        Object[] array = stringLists;\n        List<Integer> tmpList = Arrays.asList(42);\n        array[0] = tmpList; // è¯­æ³éè¯¯ï¼ä½æ¯ç¼è¯ä¸åè­¦\n        String s = stringLists[0].get(0); // è¿è¡æ¶æ¥ ClassCastException\n    }\n\n    public static void main(String[] args) {\n        List<String> list = new ArrayList<>();\n        list.add("A");\n        list.add("B");\n\n        List<String> list2 = new ArrayList<>();\n        list.add("1");\n        list.add("2");\n\n        wrongMethod(list, list2);\n    }\n}\n\n\nä»¥ä¸ä»£ç ï¼å¦æä¸ä½¿ç¨ @SafeVarargs ï¼ç¼è¯æ¶ä¼åè­¦\n\n[WARNING] /D:/Codes/ZP/Java/javacore/codes/basics/src/main/java/io/github/dunwu/javacore/annotation/SafeVarargsAnnotationDemo.java: æäºè¾å¥æä»¶ä½¿ç¨äºæªç»æ£æ¥æä¸å®å¨çæä½ã\n[WARNING] /D:/Codes/ZP/Java/javacore/codes/basics/src/main/java/io/github/dunwu/javacore/annotation/SafeVarargsAnnotationDemo.java: æå³è¯¦ç»ä¿¡æ¯, è¯·ä½¿ç¨ -Xlint:unchecked éæ°ç¼è¯ã\n\n\n\n# @FunctionalInterface\n\n@FunctionalInterface å¨ JDK8 å¼å¥ã\n\n@FunctionalInterface ç¨äºæç¤ºè¢«ä¿®é¥°çæ¥å£æ¯å½æ°å¼æ¥å£ã\n\néè¦æ³¨æçæ¯ï¼å¦æä¸ä¸ªæ¥å£ç¬¦å"å½æ°å¼æ¥å£"å®ä¹ï¼ä¸å  @FunctionalInterface ä¹æ²¡å³ç³»ï¼ä½å¦æç¼åçä¸æ¯å½æ°å¼æ¥å£ï¼å´ä½¿ç¨ @FunctionInterfaceï¼é£ä¹ç¼è¯å¨ä¼æ¥éã\n\nä»ä¹æ¯å½æ°å¼æ¥å£ï¼\n\nå½æ°å¼æ¥å£(Functional Interface)å°±æ¯ä¸ä¸ªæä¸ä»æä¸ä¸ªæ½è±¡æ¹æ³ï¼ä½æ¯å¯ä»¥æå¤ä¸ªéæ½è±¡æ¹æ³çæ¥å£ãå½æ°å¼æ¥å£å¯ä»¥è¢«éå¼è½¬æ¢ä¸º lambda è¡¨è¾¾å¼ã\n\nå½æ°å¼æ¥å£çç¹ç¹ï¼\n\n * æ¥å£æä¸åªè½æä¸ªä¸ä¸ªæ½è±¡æ¹æ³ï¼æ½è±¡æ¹æ³åªææ¹æ³å®ä¹ï¼æ²¡ææ¹æ³ä½ï¼ã\n * ä¸è½å¨æ¥å£ä¸­è¦å Object ç±»ä¸­ç public æ¹æ³ï¼åäºç¼è¯å¨ä¹ä¼æ¥éï¼ã\n * åè®¸æ default å®ç°æ¹æ³ã\n\nç¤ºä¾ï¼\n\npublic class FunctionalInterfaceAnnotationDemo {\n\n    @FunctionalInterface\n    public interface Func1<T> {\n        void printMessage(T message);\n    }\n\n    /**\n     * @FunctionalInterface ä¿®é¥°çæ¥å£ä¸­å®ä¹ä¸¤ä¸ªæ½è±¡æ¹æ³ï¼ç¼è¯æ¶ä¼æ¥é\n     * @param <T>\n     */\n    /*@FunctionalInterface\n    public interface Func2<T> {\n        void printMessage(T message);\n        void printMessage2(T message);\n    }*/\n\n    public static void main(String[] args) {\n        Func1 func1 = message -> System.out.println(message);\n        func1.printMessage("Hello");\n        func1.printMessage(100);\n    }\n}\n\n\n\n# åæ³¨è§£\n\nJDK ä¸­è½ç¶åç½®äºå ä¸ªæ³¨è§£ï¼ä½è¿è¿è¿ä¸è½æ»¡è¶³å¼åè¿ç¨ä¸­éå°çååä¸åçéæ±ãæä»¥æä»¬éè¦èªå®ä¹æ³¨è§£ï¼èè¿å°±éè¦ç¨å°åæ³¨è§£ã\n\nåæ³¨è§£çä½ç¨å°±æ¯ç¨äºå®ä¹å¶å®çæ³¨è§£ã\n\nJava ä¸­æä¾äºä»¥ä¸åæ³¨è§£ç±»åï¼\n\n * @Retention\n * @Target\n * @Documented\n * @Inheritedï¼JDK8 å¼å¥ï¼\n * @Repeatableï¼JDK8 å¼å¥ï¼\n\nè¿äºç±»ååå®ä»¬ææ¯æçç±»å¨ java.lang.annotation åä¸­å¯ä»¥æ¾å°ãä¸é¢æä»¬çä¸ä¸æ¯ä¸ªåæ³¨è§£çä½ç¨åç¸åºååæ°çä½¿ç¨è¯´æã\n\n\n# @Retention\n\n@Retention ææäºæ³¨è§£çä¿ççº§å«ã\n\n@Retention æºç ï¼\n\n@Documented\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.ANNOTATION_TYPE)\npublic @interface Retention {\n    RetentionPolicy value();\n}\n\n\nRetentionPolicy æ¯ä¸ä¸ªæä¸¾ç±»åï¼å®å®ä¹äºè¢« @Retention ä¿®é¥°çæ³¨è§£ææ¯æçä¿ççº§å«ï¼\n\n * RetentionPolicy.SOURCE - æ è®°çæ³¨è§£ä»å¨æºæä»¶ä¸­ææï¼ç¼è¯å¨ä¼å¿½ç¥ã\n * RetentionPolicy.CLASS - æ è®°çæ³¨è§£å¨ class æä»¶ä¸­ææï¼JVM ä¼å¿½ç¥ã\n * RetentionPolicy.RUNTIME - æ è®°çæ³¨è§£å¨è¿è¡æ¶ææã\n\n@Retention ç¤ºä¾ï¼\n\n@Target(ElementType.FIELD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface Column {\n    public String name() default "fieldName";\n    public String setFuncName() default "setField";\n    public String getFuncName() default "getField";\n    public boolean defaultDBValue() default false;\n}\n\n\n\n# @Documented\n\n@Documented è¡¨ç¤ºæ è®ºä½æ¶ä½¿ç¨æå®çæ³¨è§£ï¼é½åºä½¿ç¨ Javadocï¼é»è®¤æåµä¸ï¼æ³¨éä¸åå«å¨ Javadoc ä¸­ï¼ãæ´å¤åå®¹å¯ä»¥åèï¼Javadoc tools pageã\n\n@Documented ç¤ºä¾ï¼\n\n@Target(ElementType.FIELD)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Column {\n    public String name() default "fieldName";\n    public String setFuncName() default "setField";\n    public String getFuncName() default "getField";\n    public boolean defaultDBValue() default false;\n}\n\n\n\n# @Target\n\n@Target æå®æ³¨è§£å¯ä»¥ä¿®é¥°çåç´ ç±»åã\n\n@Target æºç ï¼\n\n@Documented\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.ANNOTATION_TYPE)\npublic @interface Target {\n    ElementType[] value();\n}\n\n\nElementType æ¯ä¸ä¸ªæä¸¾ç±»åï¼å®å®ä¹äºè¢« @Target ä¿®é¥°çæ³¨è§£å¯ä»¥åºç¨çèå´ï¼\n\n * ElementType.ANNOTATION_TYPE - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæ³¨è§£ç±»åã\n * ElementType.CONSTRUCTOR - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæé å½æ°ã\n * ElementType.FIELD - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºå­æ®µæå±æ§ã\n * ElementType.LOCAL_VARIABLE - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºå±é¨åéã\n * ElementType.METHOD - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæ¹æ³ã\n * ElementType.PACKAGE - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºåå£°æã\n * ElementType.PARAMETER - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæ¹æ³çåæ°ã\n * ElementType.TYPE - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºç±»çä»»ä½åç´ ã\n\n@Target ç¤ºä¾ï¼\n\n@Target(ElementType.TYPE)\npublic @interface Table {\n    /**\n     * æ°æ®è¡¨åç§°æ³¨è§£ï¼é»è®¤å¼ä¸ºç±»åç§°\n     * @return\n     */\n    public String tableName() default "className";\n}\n\n@Target(ElementType.FIELD)\npublic @interface NoDBColumn {}\n\n\n\n# @Inherited\n\n@Inherited è¡¨ç¤ºæ³¨è§£ç±»åå¯ä»¥è¢«ç»§æ¿ï¼é»è®¤æåµä¸ä¸æ¯è¿æ ·ï¼ã\n\nè¡¨ç¤ºèªå¨ç»§æ¿æ³¨è§£ç±»åã å¦ææ³¨è§£ç±»åå£°æä¸­å­å¨ @Inherited åæ³¨è§£ï¼åæ³¨è§£æä¿®é¥°ç±»çææå­ç±»é½å°ä¼ç»§æ¿æ­¤æ³¨è§£ã\n\n> ð æ³¨æï¼@Inherited æ³¨è§£ç±»åæ¯è¢«æ æ³¨è¿çç±»çå­ç±»æç»§æ¿ãç±»å¹¶ä¸ä»å®æå®ç°çæ¥å£ç»§æ¿æ³¨è§£ï¼æ¹æ³å¹¶ä¸ä»å®æè¦åçæ¹æ³ç»§æ¿æ³¨è§£ã\n> \n> æ­¤å¤ï¼å½ @Inherited ç±»åæ æ³¨çæ³¨è§£ç @Retention æ¯ RetentionPolicy.RUNTIMEï¼ååå° API å¢å¼ºäºè¿ç§ç»§æ¿æ§ãå¦ææä»¬ä½¿ç¨ java.lang.reflect å»æ¥è¯¢ä¸ä¸ª @Inherited ç±»åçæ³¨è§£æ¶ï¼åå°ä»£ç æ£æ¥å°å±å¼å·¥ä½ï¼æ£æ¥ç±»åå¶ç¶ç±»ï¼ç´å°åç°æå®çæ³¨è§£ç±»åè¢«åç°ï¼æèå°è¾¾ç±»ç»§æ¿ç»æçé¡¶å±ã\n\n@Inherited\npublic @interface Greeting {\n    public enum FontColor{ BULE,RED,GREEN};\n    String name();\n    FontColor fontColor() default FontColor.GREEN;\n}\n\n\n\n# @Repeatable\n\n@Repeatable è¡¨ç¤ºæ³¨è§£å¯ä»¥éå¤ä½¿ç¨ã\n\nä»¥ Spring @Scheduled ä¸ºä¾ï¼\n\n@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Schedules {\n\tScheduled[] value();\n}\n\n@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Repeatable(Schedules.class)\npublic @interface Scheduled {\n  // ...\n}\n\n\nåºç¨ç¤ºä¾ï¼\n\npublic class TaskRunner {\n\n    @Scheduled("0 0/15 * * * ?")\n    @Scheduled("0 0 12 * ?")\n    public void task1() {}\n}\n\n\n\n# èªå®ä¹æ³¨è§£\n\nä½¿ç¨ @interface èªå®ä¹æ³¨è§£æ¶ï¼èªå¨ç»§æ¿äº java.lang.annotation.Annotation æ¥å£ï¼ç±ç¼è¯ç¨åºèªå¨å®æå¶ä»ç»èãå¨å®ä¹æ³¨è§£æ¶ï¼ä¸è½ç»§æ¿å¶ä»çæ³¨è§£ææ¥å£ã@interface ç¨æ¥å£°æä¸ä¸ªæ³¨è§£ï¼å¶ä¸­çæ¯ä¸ä¸ªæ¹æ³å®éä¸æ¯å£°æäºä¸ä¸ªéç½®åæ°ãæ¹æ³çåç§°å°±æ¯åæ°çåç§°ï¼è¿åå¼ç±»åå°±æ¯åæ°çç±»åï¼è¿åå¼ç±»ååªè½æ¯åºæ¬ç±»åãClassãStringãenumï¼ãå¯ä»¥éè¿ default æ¥å£°æåæ°çé»è®¤å¼ã\n\nè¿éï¼æä¼éè¿å®ç°ä¸ä¸ªåä¸º RegexValid çæ­£åæ ¡éªæ³¨è§£å·¥å·æ¥å±ç¤ºèªå®ä¹æ³¨è§£çå¨æ­¥éª¤ã\n\n\n# æ³¨è§£çå®ä¹\n\næ³¨è§£çè¯­æ³æ ¼å¼å¦ä¸ï¼\n\npublic @interface æ³¨è§£å {å®ä¹ä½}\n\n\næä»¬æ¥å®ä¹ä¸ä¸ªæ³¨è§£ï¼\n\n@Documented\n@Target({ElementType.FIELD, ElementType.PARAMETER})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface RegexValid {}\n\n\n> è¯´æï¼\n> \n> éè¿ä¸ä¸èå¯¹äºåæ³¨è§£ @Targetã@Retentionã@Documented çè¯´æï¼è¿éå°±å¾å®¹æçè§£äºã\n> \n>  * ä¸é¢çä»£ç ä¸­å®ä¹äºä¸ä¸ªåä¸º @RegexValid çæ³¨è§£ã\n>  * @Documented è¡¨ç¤º @RegexValid åºè¯¥ä½¿ç¨ javadocã\n>  * @Target({ElementType.FIELD, ElementType.PARAMETER}) è¡¨ç¤º @RegexValid å¯ä»¥å¨ç±»æåææ¹æ³åæ°ä¸ä¿®é¥°ã\n>  * @Retention(RetentionPolicy.RUNTIME) è¡¨ç¤º @RegexValid å¨è¿è¡æ¶ææã\n\næ­¤æ¶ï¼æä»¬å·²ç»å®ä¹äºä¸ä¸ªæ²¡æä»»ä½å±æ§çæ³¨è§£ï¼å¦æå°æ­¤ä¸ºæ­¢ï¼å®ä»ä»æ¯ä¸ä¸ªæ è®°æ³¨è§£ãä½ä¸ºæ­£åå·¥å·ï¼æ²¡æå±æ§å¯ä»ä¹ä¹åä¸äºãæ¥ä¸æ¥ï¼æä»¬å°ä¸ºå®æ·»å æ³¨è§£å±æ§ã\n\n\n# æ³¨è§£å±æ§\n\næ³¨è§£å±æ§çè¯­æ³å½¢å¼å¦ä¸ï¼\n\n[è®¿é®çº§å«ä¿®é¥°ç¬¦] [æ°æ®ç±»å] åç§°() default é»è®¤å¼;\n\n\nä¾å¦ï¼æä»¬è¦å®ä¹å¨æ³¨è§£ä¸­å®ä¹ä¸ä¸ªåä¸º value çå­ç¬¦ä¸²å±æ§ï¼å¶é»è®¤å¼ä¸ºç©ºå­ç¬¦ä¸²ï¼è®¿é®çº§å«ä¸ºé»è®¤çº§å«ï¼é£ä¹åºè¯¥å®ä¹å¦ä¸ï¼\n\nString value() default "";\n\n\n> ð æ³¨æï¼å¨æ³¨è§£ä¸­ï¼æä»¬å®ä¹å±æ§æ¶ï¼å±æ§ååé¢éè¦å  ()ã\n\nå®ä¹æ³¨è§£å±æ§æä»¥ä¸è¦ç¹ï¼\n\n * æ³¨è§£å±æ§åªè½ä½¿ç¨ public æé»è®¤è®¿é®çº§å«ï¼å³ä¸æå®è®¿é®çº§å«ä¿®é¥°ç¬¦ï¼ä¿®é¥°ã\n\n * æ³¨è§£å±æ§çæ°æ®ç±»åæéå¶è¦æ±ãæ¯æçæ°æ®ç±»åå¦ä¸ï¼\n   \n   * ææåºæ¬æ°æ®ç±»åï¼byteãcharãshortãintãlongãfloatãdoubleãbooleanï¼\n   * String ç±»å\n   * Class ç±»\n   * enum ç±»å\n   * Annotation ç±»å\n   * ä»¥ä¸ææç±»åçæ°ç»\n\n * æ³¨è§£å±æ§å¿é¡»æç¡®å®çå¼ï¼å»ºè®®æå®é»è®¤å¼ãæ³¨è§£å±æ§åªè½éè¿æå®é»è®¤å¼æä½¿ç¨æ³¨è§£æ¶æå®å±æ§å¼ï¼ç¸è¾ä¹ä¸ï¼æå®é»è®¤å¼çæ¹å¼æ´ä¸ºå¯é ãæ³¨è§£å±æ§å¦ææ¯å¼ç¨ç±»åï¼ä¸å¯ä»¥ä¸º nullãè¿ä¸ªçº¦æä½¿å¾æ³¨è§£å¤çå¨å¾é¾å¤æ­æ³¨è§£å±æ§æ¯é»è®¤å¼ï¼ææ¯ä½¿ç¨æ³¨è§£æ¶ææå®çå±æ§å¼ãä¸ºæ­¤ï¼æä»¬è®¾ç½®é»è®¤å¼æ¶ï¼ä¸è¬ä¼å®ä¹ä¸äºç¹æ®çå¼ï¼ä¾å¦ç©ºå­ç¬¦ä¸²æèè´æ°ã\n\n * å¦ææ³¨è§£ä¸­åªæä¸ä¸ªå±æ§å¼ï¼æå¥½å°å¶å½åä¸º valueãå ä¸ºï¼æå®å±æ§åä¸º valueï¼å¨ä½¿ç¨æ³¨è§£æ¶ï¼æå® value çå¼å¯ä»¥ä¸æå®å±æ§åç§°ã\n\n// è¿ä¸¤ç§æ¹å¼ææç¸å\n@RegexValid("^((\\\\+)?86\\\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\\\d{8}$")\n@RegexValid(value = "^((\\\\+)?86\\\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\\\d{8}$")\n\n\nç¤ºä¾ï¼\n\näºè§£äºæ³¨è§£å±æ§çå®ä¹è¦ç¹ï¼è®©æä»¬æ¥ä¸º @RegexValid æ³¨è§£å®ä¹å ä¸ªå±æ§ã\n\n@Documented\n@Target({ElementType.FIELD, ElementType.PARAMETER})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface RegexValid {\n    enum Policy {\n        // @formatter:off\n        EMPTY(null),\n        DATE("^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\\\1"\n            + "(?:29|30)|(?:0?[13578]|1[02])\\\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|"\n            + "(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\\\2(?:29))$"),\n        MAIL("^[A-Za-z0-9](([_\\\\.\\\\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\\\\.\\\\-]?[a-zA-Z0-9]+)*)\\\\.([A-Za-z]{2,})$");\n        // @formatter:on\n\n        private String policy;\n\n        Policy(String policy) {\n            this.policy = policy;\n        }\n\n        public String getPolicy() {\n            return policy;\n        }\n    }\n\n    String value() default "";\n    Policy policy() default Policy.EMPTY;\n}\n\n\n> è¯´æï¼\n> \n> å¨ä¸é¢çç¤ºä¾ä»£ç ä¸­ï¼æä»¬å®ä¹äºä¸¤ä¸ªæ³¨è§£å±æ§ï¼String ç±»åç value å±æ§å Policy æä¸¾ç±»åç policy å±æ§ãPolicy æä¸¾ä¸­å®ä¹äºå ä¸ªé»è®¤çæ­£åè¡¨è¾¾å¼ï¼è¿æ¯ä¸ºäºç´æ¥ä½¿ç¨è¿å ä¸ªå¸¸ç¨è¡¨è¾¾å¼å»æ­£åæ ¡éªãèèå°ï¼æä»¬å¯è½éè¦èªå·±ä¼ å¥ä¸äºèªå®ä¹æ­£åè¡¨è¾¾å¼å»æ ¡éªå¶ä»åºæ¯ï¼æä»¥å®ä¹äº value å±æ§ï¼åè®¸ä½¿ç¨èä¼ å¥æ­£åè¡¨è¾¾å¼ã\n\nè³æ­¤ï¼@RegexValid çå£°æå·²ç»ç»æãä½æ¯ï¼ç¨åºä»ä¸ç¥éå¦ä½å¤ç @RegexValid è¿ä¸ªæ³¨è§£ãæä»¬è¿éè¦å®ä¹æ³¨è§£å¤çå¨ã\n\n\n# æ³¨è§£å¤çå¨\n\nå¦ææ²¡æç¨æ¥è¯»åæ³¨è§£çæ¹æ³åå·¥ä½ï¼é£ä¹æ³¨è§£ä¹å°±ä¸ä¼æ¯æ³¨éæ´æç¨å¤äºãä½¿ç¨æ³¨è§£çè¿ç¨ä¸­ï¼å¾éè¦çä¸é¨åå°±æ¯åå»ºäºä½¿ç¨æ³¨è§£å¤çå¨ãJDK5 æ©å±äºåå°æºå¶ç APIï¼ä»¥å¸®å©ç¨åºåå¿«éçæé èªå®ä¹æ³¨è§£å¤çå¨ã\n\njava.lang.annotation.Annotation æ¯ä¸ä¸ªæ¥å£ï¼ç¨åºå¯ä»¥éè¿åå°æ¥è·åæå®ç¨åºåç´ çæ³¨è§£å¯¹è±¡ï¼ç¶åéè¿æ³¨è§£å¯¹è±¡æ¥è·åæ³¨è§£éé¢çåæ°æ®ã\n\nAnnotation æ¥å£æºç å¦ä¸ï¼\n\npublic interface Annotation {\n    boolean equals(Object obj);\n\n    int hashCode();\n\n    String toString();\n\n    Class<? extends Annotation> annotationType();\n}\n\n\né¤æ­¤ä¹å¤ï¼Java ä¸­æ¯ææ³¨è§£å¤çå¨æ¥å£ java.lang.reflect.AnnotatedElement ï¼è¯¥æ¥å£ä»£è¡¨ç¨åºä¸­å¯ä»¥æ¥åæ³¨è§£çç¨åºåç´ ï¼è¯¥æ¥å£ä¸»è¦æå¦ä¸å ä¸ªå®ç°ç±»ï¼\n\n * Class - ç±»å®ä¹\n * Constructor - æé å¨å®ä¹\n * Field - ç´¯çæååéå®ä¹\n * Method - ç±»çæ¹æ³å®ä¹\n * Package - ç±»çåå®ä¹\n\njava.lang.reflect åä¸ä¸»è¦åå«ä¸äºå®ç°åå°åè½çå·¥å·ç±»ãå®éä¸ï¼java.lang.reflect åæææä¾çåå° API æ©åäºè¯»åè¿è¡æ¶æ³¨è§£ä¿¡æ¯çè½åãå½ä¸ä¸ªæ³¨è§£ç±»åè¢«å®ä¹ä¸ºè¿è¡æ¶çæ³¨è§£åï¼è¯¥æ³¨è§£æè½æ¯è¿è¡æ¶å¯è§ï¼å½ class æä»¶è¢«è£è½½æ¶è¢«ä¿å­å¨ class æä»¶ä¸­çæ³¨è§£æä¼è¢«èææºè¯»åã AnnotatedElement æ¥å£æ¯ææç¨åºåç´ ï¼ClassãMethod å Constructorï¼çç¶æ¥å£ï¼æä»¥ç¨åºéè¿åå°è·åäºæä¸ªç±»çAnnotatedElement å¯¹è±¡ä¹åï¼ç¨åºå°±å¯ä»¥è°ç¨è¯¥å¯¹è±¡çå¦ä¸åä¸ªä¸ªæ¹æ³æ¥è®¿é®æ³¨è§£ä¿¡æ¯ï¼\n\n * getAnnotation - è¿åè¯¥ç¨åºåç´ ä¸å­å¨çãæå®ç±»åçæ³¨è§£ï¼å¦æè¯¥ç±»åæ³¨è§£ä¸å­å¨ï¼åè¿å nullã\n * getAnnotations - è¿åè¯¥ç¨åºåç´ ä¸å­å¨çæææ³¨è§£ã\n * isAnnotationPresent - å¤æ­è¯¥ç¨åºåç´ ä¸æ¯å¦åå«æå®ç±»åçæ³¨è§£ï¼å­å¨åè¿å trueï¼å¦åè¿å falseã\n * getDeclaredAnnotations - è¿åç´æ¥å­å¨äºæ­¤åç´ ä¸çæææ³¨éãä¸æ­¤æ¥å£ä¸­çå¶ä»æ¹æ³ä¸åï¼è¯¥æ¹æ³å°å¿½ç¥ç»§æ¿çæ³¨éãï¼å¦ææ²¡ææ³¨éç´æ¥å­å¨äºæ­¤åç´ ä¸ï¼åè¿åé¿åº¦ä¸ºé¶çä¸ä¸ªæ°ç»ãï¼è¯¥æ¹æ³çè°ç¨èå¯ä»¥éæä¿®æ¹è¿åçæ°ç»ï¼è¿ä¸ä¼å¯¹å¶ä»è°ç¨èè¿åçæ°ç»äº§çä»»ä½å½±åã\n\näºè§£äºä»¥ä¸åå®¹ï¼è®©æä»¬æ¥å®ç° @RegexValid çæ³¨è§£å¤çå¨ï¼\n\nimport java.lang.reflect.Field;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n\npublic class RegexValidUtil {\n    public static boolean check(Object obj) throws Exception {\n        boolean result = true;\n        StringBuilder sb = new StringBuilder();\n        Field[] fields = obj.getClass().getDeclaredFields();\n        for (Field field : fields) {\n            // å¤æ­æåæ¯å¦è¢« @RegexValid æ³¨è§£æä¿®é¥°\n            if (field.isAnnotationPresent(RegexValid.class)) {\n                RegexValid valid = field.getAnnotation(RegexValid.class);\n\n                // å¦æ value ä¸ºç©ºå­ç¬¦ä¸²ï¼è¯´ææ²¡ææ³¨å¥èªå®ä¹æ­£åè¡¨è¾¾å¼ï¼æ¹ç¨ policy å±æ§\n                String value = valid.value();\n                if ("".equals(value)) {\n                    RegexValid.Policy policy = valid.policy();\n                    value = policy.getPolicy();\n                }\n\n                // éè¿è®¾ç½® setAccessible(true) æ¥è®¿é®ç§ææå\n                field.setAccessible(true);\n                Object fieldObj = null;\n                try {\n                    fieldObj = field.get(obj);\n                } catch (IllegalAccessException e) {\n                    e.printStackTrace();\n                }\n                if (fieldObj == null) {\n                    sb.append("\\n")\n                        .append(String.format("%s ç±»ä¸­ç %s å­æ®µä¸è½ä¸ºç©ºï¼", obj.getClass().getName(), field.getName()));\n                    result = false;\n                } else {\n                    if (fieldObj instanceof String) {\n                        String text = (String) fieldObj;\n                        Pattern p = Pattern.compile(value);\n                        Matcher m = p.matcher(text);\n                        result = m.matches();\n                        if (!result) {\n                            sb.append("\\n").append(String.format("%s ä¸æ¯åæ³ç %s ï¼", text, field.getName()));\n                        }\n                    } else {\n                        sb.append("\\n").append(\n                            String.format("%s ç±»ä¸­ç %s å­æ®µä¸æ¯å­ç¬¦ä¸²ç±»åï¼ä¸è½ä½¿ç¨æ­¤æ³¨è§£æ ¡éªï¼", obj.getClass().getName(), field.getName()));\n                        result = false;\n                    }\n                }\n            }\n        }\n\n        if (sb.length() > 0) {\n            throw new Exception(sb.toString());\n        }\n        return result;\n    }\n}\n\n\n> è¯´æï¼\n> \n> ä»¥ä¸ç¤ºä¾ä¸­çæ³¨è§£å¤çå¨ï¼æ§è¡æ­¥éª¤å¦ä¸ï¼\n> \n>  1. éè¿ getDeclaredFields åå°æ¹æ³è·åä¼ å¥å¯¹è±¡çæææåã\n>  2. éåæåï¼ä½¿ç¨ isAnnotationPresent å¤æ­æåæ¯å¦è¢«æå®æ³¨è§£æä¿®é¥°ï¼å¦æä¸æ¯ï¼ç´æ¥è·³è¿ã\n>  3. å¦ææåè¢«æ³¨è§£æä¿®é¥°ï¼éè¿ RegexValid valid = field.getAnnotation(RegexValid.class); è¿æ ·çå½¢å¼è·åï¼æ³¨è§£å®ä¾åå¯¹è±¡ï¼ç¶åï¼å°±å¯ä»¥ä½¿ç¨ valid.value() æ valid.policy() è¿æ ·çå½¢å¼è·åæ³¨è§£ä¸­è®¾å®çå±æ§å¼ã\n>  4. æ ¹æ®å±æ§å¼ï¼è¿è¡é»è¾å¤çã\n\n\n# ä½¿ç¨æ³¨è§£\n\nå®æäºä»¥ä¸å·¥ä½ï¼æä»¬å°±å¯ä»¥ä½¿ç¨èªå®ä¹æ³¨è§£äºï¼ç¤ºä¾å¦ä¸ï¼\n\npublic class RegexValidDemo {\n    static class User {\n        private String name;\n        @RegexValid(policy = RegexValid.Policy.DATE)\n        private String date;\n        @RegexValid(policy = RegexValid.Policy.MAIL)\n        private String mail;\n        @RegexValid("^((\\\\+)?86\\\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\\\d{8}$")\n        private String phone;\n\n        public User(String name, String date, String mail, String phone) {\n            this.name = name;\n            this.date = date;\n            this.mail = mail;\n            this.phone = phone;\n        }\n\n        @Override\n        public String toString() {\n            return "User{" + "name=\'" + name + \'\\\'\' + ", date=\'" + date + \'\\\'\' + ", mail=\'" + mail + \'\\\'\' + ", phone=\'"\n                + phone + \'\\\'\' + \'}\';\n        }\n    }\n\n    static void printDate(@RegexValid(policy = RegexValid.Policy.DATE) String date){\n        System.out.println(date);\n    }\n\n    public static void main(String[] args) throws Exception {\n        User user = new User("Tom", "1990-01-31", "xxx@163.com", "18612341234");\n        User user2 = new User("Jack", "2019-02-29", "sadhgs", "183xxxxxxxx");\n        if (RegexValidUtil.check(user)) {\n            System.out.println(user + "æ­£åæ ¡éªéè¿");\n        }\n        if (RegexValidUtil.check(user2)) {\n            System.out.println(user2 + "æ­£åæ ¡éªéè¿");\n        }\n    }\n}\n\n\n\n# å°ç»\n\n\n\n\n\n\n\n\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * Effective java\n * Oracle å®æ¹ææ¡£ä¹æ³¨è§£ç¯\n * æ·±å¥çè§£ Javaï¼æ³¨è§£ï¼Annotationï¼èªå®ä¹æ³¨è§£å¥é¨\n * https://blog.csdn.net/briblue/article/details/73824058',normalizedContent:'# æ·±å¥çè§£ java æ³¨è§£\n\n> æ¬æåå®¹åºäº jdk8ãæ³¨è§£æ¯ jdk5 å¼å¥çï¼åç»­ jdk çæ¬æ©å±äºä¸äºåå®¹ï¼æ¬æä¸­æ²¡ææç¡®ææçæ¬çæ³¨è§£é½æ¯ jdk5 å°±å·²ç»æ¯æçæ³¨è§£ã\n\n\n# ç®ä»\n\n\n# æ³¨è§£çå½¢å¼\n\njava ä¸­ï¼æ³¨è§£æ¯ä»¥ @ å­ç¬¦å¼å§çä¿®é¥°ç¬¦ãå¦ä¸ï¼\n\n@override\nvoid mysupermethod() { ... }\n\n\næ³¨è§£å¯ä»¥åå«å½åææªå½åçå±æ§ï¼å¹¶ä¸è¿äºå±æ§æå¼ã\n\n@author(\n   name = "benjamin franklin",\n   date = "3/27/2003"\n)\nclass myclass() { ... }\n\n\nå¦æåªæä¸ä¸ªåä¸º value çå±æ§ï¼é£ä¹åç§°å¯ä»¥çç¥ï¼å¦ï¼\n\n@suppresswarnings("unchecked")\nvoid mymethod() { ... }\n\n\nå¦ææ³¨è§£æ²¡æå±æ§ï¼åç§°ä¸ºæ è®°æ³¨è§£ãå¦ï¼@overrideã\n\n\n# ä»ä¹æ¯æ³¨è§£\n\nä»æ¬è´¨ä¸æ¥è¯´ï¼æ³¨è§£æ¯ä¸ç§æ ç­¾ï¼å¶å®è´¨ä¸å¯ä»¥è§ä¸ºä¸ç§ç¹æ®çæ³¨éï¼å¦ææ²¡æè§£æå®çä»£ç ï¼å®å¹¶ä¸æ¯æ®éæ³¨éå¼ºã\n\nè§£æä¸ä¸ªæ³¨è§£å¾å¾æä¸¤ç§å½¢å¼ï¼\n\n * ç¼è¯æç´æ¥çæ«æ - ç¼è¯å¨çæ«ææçæ¯ç¼è¯å¨å¨å¯¹ java ä»£ç ç¼è¯å­èç çè¿ç¨ä¸­ä¼æ£æµå°æä¸ªç±»æèæ¹æ³è¢«ä¸äºæ³¨è§£ä¿®é¥°ï¼è¿æ¶å®å°±ä¼å¯¹äºè¿äºæ³¨è§£è¿è¡æäºå¤çãè¿ç§æåµåªéç¨äº jdk åç½®çæ³¨è§£ç±»ã\n * è¿è¡æçåå° - å¦æè¦èªå®ä¹æ³¨è§£ï¼java ç¼è¯å¨æ æ³è¯å«å¹¶å¤çè¿ä¸ªæ³¨è§£ï¼å®åªè½æ ¹æ®è¯¥æ³¨è§£çä½ç¨èå´æ¥éæ©æ¯å¦ç¼è¯è¿å­èç æä»¶ãå¦æè¦å¤çæ³¨è§£ï¼å¿é¡»å©ç¨åå°ææ¯ï¼è¯å«è¯¥æ³¨è§£ä»¥åå®ææºå¸¦çä¿¡æ¯ï¼ç¶ååç¸åºçå¤çã\n\n\n# æ³¨è§£çä½ç¨\n\næ³¨è§£æè®¸å¤ç¨éï¼\n\n * ç¼è¯å¨ä¿¡æ¯ - ç¼è¯å¨å¯ä»¥ä½¿ç¨æ³¨è§£æ¥æ£æµéè¯¯ææå¶è­¦åã\n * ç¼è¯æ¶åé¨ç½²æ¶çå¤ç - ç¨åºå¯ä»¥å¤çæ³¨è§£ä¿¡æ¯ä»¥çæä»£ç ï¼xml æä»¶ç­ã\n * è¿è¡æ¶å¤ç - å¯ä»¥å¨è¿è¡æ¶æ£æ¥æäºæ³¨è§£å¹¶å¤çã\n\nä½ä¸º java ç¨åºåï¼å¤å¤å°å°é½æ¾ç»åè¿è¢«åç§éç½®æä»¶ï¼xmlãpropertiesï¼æ¯éçææ§ãè¿å¤çéç½®æä»¶ä¼ä½¿å¾é¡¹ç®é¾ä»¥ç»´æ¤ãä¸ªäººè®¤ä¸ºï¼ä½¿ç¨æ³¨è§£ä»¥åå°éç½®æä»¶æä»£ç ï¼æ¯æ³¨è§£æå¤§çç¨å¤ã\n\n\n# æ³¨è§£çä»£ä»·\n\nå¡äºæå¾å¿æå¤±ï¼æ³¨è§£ææ¯åæ ·å¦æ­¤ãä½¿ç¨æ³¨è§£ä¹æä¸å®çä»£ä»·ï¼\n\n * æ¾ç¶ï¼å®æ¯ä¸ç§ä¾µå¥å¼ç¼ç¨ï¼é£ä¹ï¼èªç¶å°±å­å¨çå¢å ç¨åºè¦ååº¦çé®é¢ã\n * èªå®ä¹æ³¨è§£çå¤çéè¦å¨è¿è¡æ¶ï¼éè¿åå°ææ¯æ¥è·åå±æ§ãå¦ææ³¨è§£æä¿®é¥°çåç´ æ¯ç±»çé public æåï¼ä¹å¯ä»¥éè¿åå°è·åãè¿å°±è¿èäºé¢åå¯¹è±¡çå°è£æ§ã\n * æ³¨è§£æäº§ççé®é¢ï¼ç¸å¯¹èè¨ï¼æ´é¾ä»¥ debug æå®ä½ã\n\nä½æ¯ï¼æ­£æè°çä¸æ©çï¼æ³¨è§£æä»åºçä»£ä»·ï¼ç¸è¾äºå®æä¾çåè½èè¨ï¼è¿æ¯å¯ä»¥æ¥åçã\n\n\n# æ³¨è§£çåºç¨èå´\n\næ³¨è§£å¯ä»¥åºç¨äºç±»ãå­æ®µãæ¹æ³åå¶ä»ç¨åºåç´ çå£°æã\n\njdk8 å¼å§ï¼æ³¨è§£çåºç¨èå´è¿ä¸æ­¥æ©å¤§ï¼ä»¥ä¸æ¯æ°çåºç¨èå´ï¼\n\nç±»å®ä¾åå§åè¡¨è¾¾å¼ï¼\n\nnew @interned myobject();\n\n\nç±»åè½¬æ¢ï¼\n\nmystring = (@nonnull string) str;\n\n\nå®ç°æ¥å£çå£°æï¼\n\nclass unmodifiablelist<t> implements\n    @readonly list<@readonly t> {}\n\n\næåºå¼å¸¸å£°æï¼\n\nvoid monitortemperature()\n    throws @critical temperatureexception {}\n\n\n\n# åç½®æ³¨è§£\n\njdk ä¸­åç½®äºä»¥ä¸æ³¨è§£ï¼\n\n * @override\n * @deprecated\n * @suppresswarnnings\n * @safevarargsï¼jdk7 å¼å¥ï¼\n * @functionalinterfaceï¼jdk8 å¼å¥ï¼\n\n\n# @override\n\n@override ç¨äºè¡¨æè¢«ä¿®é¥°æ¹æ³è¦åäºç¶ç±»çæ¹æ³ã\n\nå¦æè¯å¾ä½¿ç¨ @override æ è®°ä¸ä¸ªå®éä¸å¹¶æ²¡æè¦åç¶ç±»çæ¹æ³æ¶ï¼java ç¼è¯å¨ä¼åè­¦ã\n\n@override ç¤ºä¾ï¼\n\npublic class overrideannotationdemo {\n\n    static class person {\n        public string getname() {\n            return "getname";\n        }\n    }\n\n\n    static class man extends person {\n        @override\n        public string getname() {\n            return "override getname";\n        }\n\n        /**\n         *  æ¾å¼ä¸é¢çæ³¨éï¼ç¼è¯æ¶ä¼åè­¦\n         */\n       /*\n        @override\n        public string getname2() {\n            return "override getname2";\n        }\n        */\n    }\n\n    public static void main(string[] args) {\n        person per = new man();\n        system.out.println(per.getname());\n    }\n}\n\n\n\n# @deprecated\n\n@deprecated ç¨äºæ æè¢«ä¿®é¥°çç±»æç±»æåãç±»æ¹æ³å·²ç»åºå¼ãè¿æ¶ï¼ä¸å»ºè®®ä½¿ç¨ã\n\n@deprecated æä¸å®çå»¶ç»­æ§ï¼å¦ææä»¬å¨ä»£ç ä¸­éè¿ç»§æ¿æèè¦ççæ¹å¼ä½¿ç¨äºè¿æ¶çç±»æç±»æåï¼å³ä½¿å­ç±»æå­æ¹æ³æ²¡ææ è®°ä¸º @deprecatedï¼ä½ç¼è¯å¨ä»ç¶ä¼åè­¦ã\n\n> ð æ³¨æï¼ @deprecated è¿ä¸ªæ³¨è§£ç±»åå javadoc ä¸­ç @deprecated è¿ä¸ª tag æ¯æåºå«çï¼åèæ¯ java ç¼è¯å¨è¯å«çï¼èåèæ¯è¢« javadoc å·¥å·æè¯å«ç¨æ¥çæææ¡£ï¼åå«ç¨åºæåä¸ºä»ä¹å·²ç»è¿æ¶ãå®åºå½å¦ä½è¢«ç¦æ­¢æèæ¿ä»£çæè¿°ï¼ã\n\n@deprecated ç¤ºä¾ï¼\n\npublic class deprecatedannotationdemo {\n    static class deprecatedfield {\n        @deprecated\n        public static final string deprecated_field = "deprecatedfield";\n    }\n\n\n    static class deprecatedmethod {\n        @deprecated\n        public string print() {\n            return "deprecatedmethod";\n        }\n    }\n\n\n    @deprecated\n    static class deprecatedclass {\n        public string print() {\n            return "deprecatedclass";\n        }\n    }\n\n    public static void main(string[] args) {\n        system.out.println(deprecatedfield.deprecated_field);\n\n        deprecatedmethod dm = new deprecatedmethod();\n        system.out.println(dm.print());\n\n\n        deprecatedclass dc = new deprecatedclass();\n        system.out.println(dc.print());\n    }\n}\n//output:\n//deprecatedfield\n//deprecatedmethod\n//deprecatedclass\n\n\n\n# @suppresswarnnings\n\n@suppresswarnings ç¨äºå³é­å¯¹ç±»ãæ¹æ³ãæåç¼è¯æ¶äº§ççç¹å®è­¦åã\n\n@suppresswarning ä¸æ¯ä¸ä¸ªæ è®°æ³¨è§£ãå®æä¸ä¸ªç±»åä¸º string[] çæ°ç»æåï¼è¿ä¸ªæ°ç»ä¸­å­å¨çæ¯è¦å³é­çåè­¦ç±»åãå¯¹äº javac ç¼è¯å¨æ¥è®²ï¼å¯¹ -xlint éé¡¹ææçè­¦ååä¹åæ ·å¯¹ @suppresswarings ææï¼åæ¶ç¼è¯å¨ä¼å¿½ç¥ææ æ³è¯å«çè­¦ååã\n\n@suppresswarning ç¤ºä¾ï¼\n\n@suppresswarnings({"rawtypes", "unchecked"})\npublic class suppresswarningsannotationdemo {\n    static class suppressdemo<t> {\n        private t value;\n\n        public t getvalue() {\n            return this.value;\n        }\n\n        public void setvalue(t var) {\n            this.value = var;\n        }\n    }\n\n    @suppresswarnings({"deprecation"})\n    public static void main(string[] args) {\n        suppressdemo d = new suppressdemo();\n        d.setvalue("åäº¬");\n        system.out.println("å°åï¼" + d.getvalue());\n    }\n}\n\n\n@suppresswarnings æ³¨è§£çå¸¸è§åæ°å¼çç®åè¯´æï¼\n\n * deprecation - ä½¿ç¨äºä¸èµæä½¿ç¨çç±»ææ¹æ³æ¶çè­¦åï¼\n * unchecked - æ§è¡äºæªæ£æ¥çè½¬æ¢æ¶çè­¦åï¼ä¾å¦å½ä½¿ç¨éåæ¶æ²¡æç¨æ³å (generics) æ¥æå®éåä¿å­çç±»å;\n * fallthrough - å½ switch ç¨åºåç´æ¥éå¾ä¸ä¸ç§æåµèæ²¡æ break æ¶çè­¦å;\n * path - å¨ç±»è·¯å¾ãæºæä»¶è·¯å¾ç­ä¸­æä¸å­å¨çè·¯å¾æ¶çè­¦å;\n * serial - å½å¨å¯åºååçç±»ä¸ç¼ºå° serialversionuid å®ä¹æ¶çè­¦å;\n * finally - ä»»ä½ finally å­å¥ä¸è½æ­£å¸¸å®ææ¶çè­¦å;\n * all - ææçè­¦åã\n\n@suppresswarnings({"uncheck", "deprecation"})\npublic class internalannotationdemo {\n\n    /**\n     * @suppresswarnings æ è®°æ¶é¤å½åç±»çåè­¦ä¿¡æ¯\n     */\n    @suppresswarnings({"deprecation"})\n    static class a {\n        public void method1() {\n            system.out.println("call method1");\n        }\n\n        /**\n         * @deprecated æ è®°å½åæ¹æ³ä¸ºåºå¼æ¹æ³ï¼ä¸å»ºè®®ä½¿ç¨\n         */\n        @deprecated\n        public void method2() {\n            system.out.println("call method2");\n        }\n    }\n\n    /**\n     * @deprecated æ è®°å½åç±»ä¸ºåºå¼ç±»ï¼ä¸å»ºè®®ä½¿ç¨\n     */\n    @deprecated\n    static class b extends a {\n        /**\n         * @override æ è®°æ¾ç¤ºææå½åæ¹æ³è¦åäºç¶ç±»ææ¥å£çæ¹æ³\n         */\n        @override\n        public void method1() { }\n    }\n\n    public static void main(string[] args) {\n        a obj = new b();\n        obj.method1();\n        obj.method2();\n    }\n}\n\n\n\n# @safevarargs\n\n@safevarargs å¨ jdk7 ä¸­å¼å¥ã\n\n@safevarargs çä½ç¨æ¯ï¼åè¯ç¼è¯å¨ï¼å¨å¯åé¿åæ°ä¸­çæ³åæ¯ç±»åå®å¨çãå¯åé¿åæ°æ¯ä½¿ç¨æ°ç»å­å¨çï¼èæ°ç»åæ³åä¸è½å¾å¥½çæ··åä½¿ç¨ã\n\nç®åçè¯´ï¼æ°ç»åç´ çæ°æ®ç±»åå¨ç¼è¯åè¿è¡æ¶é½æ¯ç¡®å®çï¼èæ³åçæ°æ®ç±»ååªæå¨è¿è¡æ¶æè½ç¡®å®ä¸æ¥ãå æ­¤ï¼å½æä¸ä¸ªæ³åå­å¨å°æ°ç»ä¸­æ¶ï¼ç¼è¯å¨å¨ç¼è¯é¶æ®µæ æ³ç¡®è®¤æ°æ®ç±»åæ¯å¦å¹éï¼å æ­¤ä¼ç»åºè­¦åä¿¡æ¯ï¼å³å¦ææ³åççå®æ°æ®ç±»åæ æ³ååæ°æ°ç»çç±»åå¹éï¼ä¼å¯¼è´ classcastexception å¼å¸¸ã\n\n@safevarargs æ³¨è§£ä½¿ç¨èå´ï¼\n\n * @safevarargs æ³¨è§£å¯ä»¥ç¨äºæé æ¹æ³ã\n * @safevarargs æ³¨è§£å¯ä»¥ç¨äº static æ final æ¹æ³ã\n\n@safevarargs ç¤ºä¾ï¼\n\npublic class safevarargsannotationdemo {\n    /**\n     * æ­¤æ¹æ³å®éä¸å¹¶ä¸å®å¨ï¼ä¸ä½¿ç¨æ­¤æ³¨è§£ï¼ç¼è¯æ¶ä¼åè­¦\n     */\n    @safevarargs\n    static void wrongmethod(list<string>... stringlists) {\n        object[] array = stringlists;\n        list<integer> tmplist = arrays.aslist(42);\n        array[0] = tmplist; // è¯­æ³éè¯¯ï¼ä½æ¯ç¼è¯ä¸åè­¦\n        string s = stringlists[0].get(0); // è¿è¡æ¶æ¥ classcastexception\n    }\n\n    public static void main(string[] args) {\n        list<string> list = new arraylist<>();\n        list.add("a");\n        list.add("b");\n\n        list<string> list2 = new arraylist<>();\n        list.add("1");\n        list.add("2");\n\n        wrongmethod(list, list2);\n    }\n}\n\n\nä»¥ä¸ä»£ç ï¼å¦æä¸ä½¿ç¨ @safevarargs ï¼ç¼è¯æ¶ä¼åè­¦\n\n[warning] /d:/codes/zp/java/javacore/codes/basics/src/main/java/io/github/dunwu/javacore/annotation/safevarargsannotationdemo.java: æäºè¾å¥æä»¶ä½¿ç¨äºæªç»æ£æ¥æä¸å®å¨çæä½ã\n[warning] /d:/codes/zp/java/javacore/codes/basics/src/main/java/io/github/dunwu/javacore/annotation/safevarargsannotationdemo.java: æå³è¯¦ç»ä¿¡æ¯, è¯·ä½¿ç¨ -xlint:unchecked éæ°ç¼è¯ã\n\n\n\n# @functionalinterface\n\n@functionalinterface å¨ jdk8 å¼å¥ã\n\n@functionalinterface ç¨äºæç¤ºè¢«ä¿®é¥°çæ¥å£æ¯å½æ°å¼æ¥å£ã\n\néè¦æ³¨æçæ¯ï¼å¦æä¸ä¸ªæ¥å£ç¬¦å"å½æ°å¼æ¥å£"å®ä¹ï¼ä¸å  @functionalinterface ä¹æ²¡å³ç³»ï¼ä½å¦æç¼åçä¸æ¯å½æ°å¼æ¥å£ï¼å´ä½¿ç¨ @functioninterfaceï¼é£ä¹ç¼è¯å¨ä¼æ¥éã\n\nä»ä¹æ¯å½æ°å¼æ¥å£ï¼\n\nå½æ°å¼æ¥å£(functional interface)å°±æ¯ä¸ä¸ªæä¸ä»æä¸ä¸ªæ½è±¡æ¹æ³ï¼ä½æ¯å¯ä»¥æå¤ä¸ªéæ½è±¡æ¹æ³çæ¥å£ãå½æ°å¼æ¥å£å¯ä»¥è¢«éå¼è½¬æ¢ä¸º lambda è¡¨è¾¾å¼ã\n\nå½æ°å¼æ¥å£çç¹ç¹ï¼\n\n * æ¥å£æä¸åªè½æä¸ªä¸ä¸ªæ½è±¡æ¹æ³ï¼æ½è±¡æ¹æ³åªææ¹æ³å®ä¹ï¼æ²¡ææ¹æ³ä½ï¼ã\n * ä¸è½å¨æ¥å£ä¸­è¦å object ç±»ä¸­ç public æ¹æ³ï¼åäºç¼è¯å¨ä¹ä¼æ¥éï¼ã\n * åè®¸æ default å®ç°æ¹æ³ã\n\nç¤ºä¾ï¼\n\npublic class functionalinterfaceannotationdemo {\n\n    @functionalinterface\n    public interface func1<t> {\n        void printmessage(t message);\n    }\n\n    /**\n     * @functionalinterface ä¿®é¥°çæ¥å£ä¸­å®ä¹ä¸¤ä¸ªæ½è±¡æ¹æ³ï¼ç¼è¯æ¶ä¼æ¥é\n     * @param <t>\n     */\n    /*@functionalinterface\n    public interface func2<t> {\n        void printmessage(t message);\n        void printmessage2(t message);\n    }*/\n\n    public static void main(string[] args) {\n        func1 func1 = message -> system.out.println(message);\n        func1.printmessage("hello");\n        func1.printmessage(100);\n    }\n}\n\n\n\n# åæ³¨è§£\n\njdk ä¸­è½ç¶åç½®äºå ä¸ªæ³¨è§£ï¼ä½è¿è¿è¿ä¸è½æ»¡è¶³å¼åè¿ç¨ä¸­éå°çååä¸åçéæ±ãæä»¥æä»¬éè¦èªå®ä¹æ³¨è§£ï¼èè¿å°±éè¦ç¨å°åæ³¨è§£ã\n\nåæ³¨è§£çä½ç¨å°±æ¯ç¨äºå®ä¹å¶å®çæ³¨è§£ã\n\njava ä¸­æä¾äºä»¥ä¸åæ³¨è§£ç±»åï¼\n\n * @retention\n * @target\n * @documented\n * @inheritedï¼jdk8 å¼å¥ï¼\n * @repeatableï¼jdk8 å¼å¥ï¼\n\nè¿äºç±»ååå®ä»¬ææ¯æçç±»å¨ java.lang.annotation åä¸­å¯ä»¥æ¾å°ãä¸é¢æä»¬çä¸ä¸æ¯ä¸ªåæ³¨è§£çä½ç¨åç¸åºååæ°çä½¿ç¨è¯´æã\n\n\n# @retention\n\n@retention ææäºæ³¨è§£çä¿ççº§å«ã\n\n@retention æºç ï¼\n\n@documented\n@retention(retentionpolicy.runtime)\n@target(elementtype.annotation_type)\npublic @interface retention {\n    retentionpolicy value();\n}\n\n\nretentionpolicy æ¯ä¸ä¸ªæä¸¾ç±»åï¼å®å®ä¹äºè¢« @retention ä¿®é¥°çæ³¨è§£ææ¯æçä¿ççº§å«ï¼\n\n * retentionpolicy.source - æ è®°çæ³¨è§£ä»å¨æºæä»¶ä¸­ææï¼ç¼è¯å¨ä¼å¿½ç¥ã\n * retentionpolicy.class - æ è®°çæ³¨è§£å¨ class æä»¶ä¸­ææï¼jvm ä¼å¿½ç¥ã\n * retentionpolicy.runtime - æ è®°çæ³¨è§£å¨è¿è¡æ¶ææã\n\n@retention ç¤ºä¾ï¼\n\n@target(elementtype.field)\n@retention(retentionpolicy.runtime)\npublic @interface column {\n    public string name() default "fieldname";\n    public string setfuncname() default "setfield";\n    public string getfuncname() default "getfield";\n    public boolean defaultdbvalue() default false;\n}\n\n\n\n# @documented\n\n@documented è¡¨ç¤ºæ è®ºä½æ¶ä½¿ç¨æå®çæ³¨è§£ï¼é½åºä½¿ç¨ javadocï¼é»è®¤æåµä¸ï¼æ³¨éä¸åå«å¨ javadoc ä¸­ï¼ãæ´å¤åå®¹å¯ä»¥åèï¼javadoc tools pageã\n\n@documented ç¤ºä¾ï¼\n\n@target(elementtype.field)\n@retention(retentionpolicy.runtime)\n@documented\npublic @interface column {\n    public string name() default "fieldname";\n    public string setfuncname() default "setfield";\n    public string getfuncname() default "getfield";\n    public boolean defaultdbvalue() default false;\n}\n\n\n\n# @target\n\n@target æå®æ³¨è§£å¯ä»¥ä¿®é¥°çåç´ ç±»åã\n\n@target æºç ï¼\n\n@documented\n@retention(retentionpolicy.runtime)\n@target(elementtype.annotation_type)\npublic @interface target {\n    elementtype[] value();\n}\n\n\nelementtype æ¯ä¸ä¸ªæä¸¾ç±»åï¼å®å®ä¹äºè¢« @target ä¿®é¥°çæ³¨è§£å¯ä»¥åºç¨çèå´ï¼\n\n * elementtype.annotation_type - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæ³¨è§£ç±»åã\n * elementtype.constructor - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæé å½æ°ã\n * elementtype.field - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºå­æ®µæå±æ§ã\n * elementtype.local_variable - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºå±é¨åéã\n * elementtype.method - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæ¹æ³ã\n * elementtype.package - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºåå£°æã\n * elementtype.parameter - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºæ¹æ³çåæ°ã\n * elementtype.type - æ è®°çæ³¨è§£å¯ä»¥åºç¨äºç±»çä»»ä½åç´ ã\n\n@target ç¤ºä¾ï¼\n\n@target(elementtype.type)\npublic @interface table {\n    /**\n     * æ°æ®è¡¨åç§°æ³¨è§£ï¼é»è®¤å¼ä¸ºç±»åç§°\n     * @return\n     */\n    public string tablename() default "classname";\n}\n\n@target(elementtype.field)\npublic @interface nodbcolumn {}\n\n\n\n# @inherited\n\n@inherited è¡¨ç¤ºæ³¨è§£ç±»åå¯ä»¥è¢«ç»§æ¿ï¼é»è®¤æåµä¸ä¸æ¯è¿æ ·ï¼ã\n\nè¡¨ç¤ºèªå¨ç»§æ¿æ³¨è§£ç±»åã å¦ææ³¨è§£ç±»åå£°æä¸­å­å¨ @inherited åæ³¨è§£ï¼åæ³¨è§£æä¿®é¥°ç±»çææå­ç±»é½å°ä¼ç»§æ¿æ­¤æ³¨è§£ã\n\n> ð æ³¨æï¼@inherited æ³¨è§£ç±»åæ¯è¢«æ æ³¨è¿çç±»çå­ç±»æç»§æ¿ãç±»å¹¶ä¸ä»å®æå®ç°çæ¥å£ç»§æ¿æ³¨è§£ï¼æ¹æ³å¹¶ä¸ä»å®æè¦åçæ¹æ³ç»§æ¿æ³¨è§£ã\n> \n> æ­¤å¤ï¼å½ @inherited ç±»åæ æ³¨çæ³¨è§£ç @retention æ¯ retentionpolicy.runtimeï¼ååå° api å¢å¼ºäºè¿ç§ç»§æ¿æ§ãå¦ææä»¬ä½¿ç¨ java.lang.reflect å»æ¥è¯¢ä¸ä¸ª @inherited ç±»åçæ³¨è§£æ¶ï¼åå°ä»£ç æ£æ¥å°å±å¼å·¥ä½ï¼æ£æ¥ç±»åå¶ç¶ç±»ï¼ç´å°åç°æå®çæ³¨è§£ç±»åè¢«åç°ï¼æèå°è¾¾ç±»ç»§æ¿ç»æçé¡¶å±ã\n\n@inherited\npublic @interface greeting {\n    public enum fontcolor{ bule,red,green};\n    string name();\n    fontcolor fontcolor() default fontcolor.green;\n}\n\n\n\n# @repeatable\n\n@repeatable è¡¨ç¤ºæ³¨è§£å¯ä»¥éå¤ä½¿ç¨ã\n\nä»¥ spring @scheduled ä¸ºä¾ï¼\n\n@target({elementtype.method, elementtype.annotation_type})\n@retention(retentionpolicy.runtime)\n@documented\npublic @interface schedules {\n\tscheduled[] value();\n}\n\n@target({elementtype.method, elementtype.annotation_type})\n@retention(retentionpolicy.runtime)\n@documented\n@repeatable(schedules.class)\npublic @interface scheduled {\n  // ...\n}\n\n\nåºç¨ç¤ºä¾ï¼\n\npublic class taskrunner {\n\n    @scheduled("0 0/15 * * * ?")\n    @scheduled("0 0 12 * ?")\n    public void task1() {}\n}\n\n\n\n# èªå®ä¹æ³¨è§£\n\nä½¿ç¨ @interface èªå®ä¹æ³¨è§£æ¶ï¼èªå¨ç»§æ¿äº java.lang.annotation.annotation æ¥å£ï¼ç±ç¼è¯ç¨åºèªå¨å®æå¶ä»ç»èãå¨å®ä¹æ³¨è§£æ¶ï¼ä¸è½ç»§æ¿å¶ä»çæ³¨è§£ææ¥å£ã@interface ç¨æ¥å£°æä¸ä¸ªæ³¨è§£ï¼å¶ä¸­çæ¯ä¸ä¸ªæ¹æ³å®éä¸æ¯å£°æäºä¸ä¸ªéç½®åæ°ãæ¹æ³çåç§°å°±æ¯åæ°çåç§°ï¼è¿åå¼ç±»åå°±æ¯åæ°çç±»åï¼è¿åå¼ç±»ååªè½æ¯åºæ¬ç±»åãclassãstringãenumï¼ãå¯ä»¥éè¿ default æ¥å£°æåæ°çé»è®¤å¼ã\n\nè¿éï¼æä¼éè¿å®ç°ä¸ä¸ªåä¸º regexvalid çæ­£åæ ¡éªæ³¨è§£å·¥å·æ¥å±ç¤ºèªå®ä¹æ³¨è§£çå¨æ­¥éª¤ã\n\n\n# æ³¨è§£çå®ä¹\n\næ³¨è§£çè¯­æ³æ ¼å¼å¦ä¸ï¼\n\npublic @interface æ³¨è§£å {å®ä¹ä½}\n\n\næä»¬æ¥å®ä¹ä¸ä¸ªæ³¨è§£ï¼\n\n@documented\n@target({elementtype.field, elementtype.parameter})\n@retention(retentionpolicy.runtime)\npublic @interface regexvalid {}\n\n\n> è¯´æï¼\n> \n> éè¿ä¸ä¸èå¯¹äºåæ³¨è§£ @targetã@retentionã@documented çè¯´æï¼è¿éå°±å¾å®¹æçè§£äºã\n> \n>  * ä¸é¢çä»£ç ä¸­å®ä¹äºä¸ä¸ªåä¸º @regexvalid çæ³¨è§£ã\n>  * @documented è¡¨ç¤º @regexvalid åºè¯¥ä½¿ç¨ javadocã\n>  * @target({elementtype.field, elementtype.parameter}) è¡¨ç¤º @regexvalid å¯ä»¥å¨ç±»æåææ¹æ³åæ°ä¸ä¿®é¥°ã\n>  * @retention(retentionpolicy.runtime) è¡¨ç¤º @regexvalid å¨è¿è¡æ¶ææã\n\næ­¤æ¶ï¼æä»¬å·²ç»å®ä¹äºä¸ä¸ªæ²¡æä»»ä½å±æ§çæ³¨è§£ï¼å¦æå°æ­¤ä¸ºæ­¢ï¼å®ä»ä»æ¯ä¸ä¸ªæ è®°æ³¨è§£ãä½ä¸ºæ­£åå·¥å·ï¼æ²¡æå±æ§å¯ä»ä¹ä¹åä¸äºãæ¥ä¸æ¥ï¼æä»¬å°ä¸ºå®æ·»å æ³¨è§£å±æ§ã\n\n\n# æ³¨è§£å±æ§\n\næ³¨è§£å±æ§çè¯­æ³å½¢å¼å¦ä¸ï¼\n\n[è®¿é®çº§å«ä¿®é¥°ç¬¦] [æ°æ®ç±»å] åç§°() default é»è®¤å¼;\n\n\nä¾å¦ï¼æä»¬è¦å®ä¹å¨æ³¨è§£ä¸­å®ä¹ä¸ä¸ªåä¸º value çå­ç¬¦ä¸²å±æ§ï¼å¶é»è®¤å¼ä¸ºç©ºå­ç¬¦ä¸²ï¼è®¿é®çº§å«ä¸ºé»è®¤çº§å«ï¼é£ä¹åºè¯¥å®ä¹å¦ä¸ï¼\n\nstring value() default "";\n\n\n> ð æ³¨æï¼å¨æ³¨è§£ä¸­ï¼æä»¬å®ä¹å±æ§æ¶ï¼å±æ§ååé¢éè¦å  ()ã\n\nå®ä¹æ³¨è§£å±æ§æä»¥ä¸è¦ç¹ï¼\n\n * æ³¨è§£å±æ§åªè½ä½¿ç¨ public æé»è®¤è®¿é®çº§å«ï¼å³ä¸æå®è®¿é®çº§å«ä¿®é¥°ç¬¦ï¼ä¿®é¥°ã\n\n * æ³¨è§£å±æ§çæ°æ®ç±»åæéå¶è¦æ±ãæ¯æçæ°æ®ç±»åå¦ä¸ï¼\n   \n   * ææåºæ¬æ°æ®ç±»åï¼byteãcharãshortãintãlongãfloatãdoubleãbooleanï¼\n   * string ç±»å\n   * class ç±»\n   * enum ç±»å\n   * annotation ç±»å\n   * ä»¥ä¸ææç±»åçæ°ç»\n\n * æ³¨è§£å±æ§å¿é¡»æç¡®å®çå¼ï¼å»ºè®®æå®é»è®¤å¼ãæ³¨è§£å±æ§åªè½éè¿æå®é»è®¤å¼æä½¿ç¨æ³¨è§£æ¶æå®å±æ§å¼ï¼ç¸è¾ä¹ä¸ï¼æå®é»è®¤å¼çæ¹å¼æ´ä¸ºå¯é ãæ³¨è§£å±æ§å¦ææ¯å¼ç¨ç±»åï¼ä¸å¯ä»¥ä¸º nullãè¿ä¸ªçº¦æä½¿å¾æ³¨è§£å¤çå¨å¾é¾å¤æ­æ³¨è§£å±æ§æ¯é»è®¤å¼ï¼ææ¯ä½¿ç¨æ³¨è§£æ¶ææå®çå±æ§å¼ãä¸ºæ­¤ï¼æä»¬è®¾ç½®é»è®¤å¼æ¶ï¼ä¸è¬ä¼å®ä¹ä¸äºç¹æ®çå¼ï¼ä¾å¦ç©ºå­ç¬¦ä¸²æèè´æ°ã\n\n * å¦ææ³¨è§£ä¸­åªæä¸ä¸ªå±æ§å¼ï¼æå¥½å°å¶å½åä¸º valueãå ä¸ºï¼æå®å±æ§åä¸º valueï¼å¨ä½¿ç¨æ³¨è§£æ¶ï¼æå® value çå¼å¯ä»¥ä¸æå®å±æ§åç§°ã\n\n// è¿ä¸¤ç§æ¹å¼ææç¸å\n@regexvalid("^((\\\\+)?86\\\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\\\d{8}$")\n@regexvalid(value = "^((\\\\+)?86\\\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\\\d{8}$")\n\n\nç¤ºä¾ï¼\n\näºè§£äºæ³¨è§£å±æ§çå®ä¹è¦ç¹ï¼è®©æä»¬æ¥ä¸º @regexvalid æ³¨è§£å®ä¹å ä¸ªå±æ§ã\n\n@documented\n@target({elementtype.field, elementtype.parameter})\n@retention(retentionpolicy.runtime)\npublic @interface regexvalid {\n    enum policy {\n        // @formatter:off\n        empty(null),\n        date("^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\\\1"\n            + "(?:29|30)|(?:0?[13578]|1[02])\\\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|"\n            + "(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\\\2(?:29))$"),\n        mail("^[a-za-z0-9](([_\\\\.\\\\-]?[a-za-z0-9]+)*)@([a-za-z0-9]+)(([\\\\.\\\\-]?[a-za-z0-9]+)*)\\\\.([a-za-z]{2,})$");\n        // @formatter:on\n\n        private string policy;\n\n        policy(string policy) {\n            this.policy = policy;\n        }\n\n        public string getpolicy() {\n            return policy;\n        }\n    }\n\n    string value() default "";\n    policy policy() default policy.empty;\n}\n\n\n> è¯´æï¼\n> \n> å¨ä¸é¢çç¤ºä¾ä»£ç ä¸­ï¼æä»¬å®ä¹äºä¸¤ä¸ªæ³¨è§£å±æ§ï¼string ç±»åç value å±æ§å policy æä¸¾ç±»åç policy å±æ§ãpolicy æä¸¾ä¸­å®ä¹äºå ä¸ªé»è®¤çæ­£åè¡¨è¾¾å¼ï¼è¿æ¯ä¸ºäºç´æ¥ä½¿ç¨è¿å ä¸ªå¸¸ç¨è¡¨è¾¾å¼å»æ­£åæ ¡éªãèèå°ï¼æä»¬å¯è½éè¦èªå·±ä¼ å¥ä¸äºèªå®ä¹æ­£åè¡¨è¾¾å¼å»æ ¡éªå¶ä»åºæ¯ï¼æä»¥å®ä¹äº value å±æ§ï¼åè®¸ä½¿ç¨èä¼ å¥æ­£åè¡¨è¾¾å¼ã\n\nè³æ­¤ï¼@regexvalid çå£°æå·²ç»ç»æãä½æ¯ï¼ç¨åºä»ä¸ç¥éå¦ä½å¤ç @regexvalid è¿ä¸ªæ³¨è§£ãæä»¬è¿éè¦å®ä¹æ³¨è§£å¤çå¨ã\n\n\n# æ³¨è§£å¤çå¨\n\nå¦ææ²¡æç¨æ¥è¯»åæ³¨è§£çæ¹æ³åå·¥ä½ï¼é£ä¹æ³¨è§£ä¹å°±ä¸ä¼æ¯æ³¨éæ´æç¨å¤äºãä½¿ç¨æ³¨è§£çè¿ç¨ä¸­ï¼å¾éè¦çä¸é¨åå°±æ¯åå»ºäºä½¿ç¨æ³¨è§£å¤çå¨ãjdk5 æ©å±äºåå°æºå¶ç apiï¼ä»¥å¸®å©ç¨åºåå¿«éçæé èªå®ä¹æ³¨è§£å¤çå¨ã\n\njava.lang.annotation.annotation æ¯ä¸ä¸ªæ¥å£ï¼ç¨åºå¯ä»¥éè¿åå°æ¥è·åæå®ç¨åºåç´ çæ³¨è§£å¯¹è±¡ï¼ç¶åéè¿æ³¨è§£å¯¹è±¡æ¥è·åæ³¨è§£éé¢çåæ°æ®ã\n\nannotation æ¥å£æºç å¦ä¸ï¼\n\npublic interface annotation {\n    boolean equals(object obj);\n\n    int hashcode();\n\n    string tostring();\n\n    class<? extends annotation> annotationtype();\n}\n\n\né¤æ­¤ä¹å¤ï¼java ä¸­æ¯ææ³¨è§£å¤çå¨æ¥å£ java.lang.reflect.annotatedelement ï¼è¯¥æ¥å£ä»£è¡¨ç¨åºä¸­å¯ä»¥æ¥åæ³¨è§£çç¨åºåç´ ï¼è¯¥æ¥å£ä¸»è¦æå¦ä¸å ä¸ªå®ç°ç±»ï¼\n\n * class - ç±»å®ä¹\n * constructor - æé å¨å®ä¹\n * field - ç´¯çæååéå®ä¹\n * method - ç±»çæ¹æ³å®ä¹\n * package - ç±»çåå®ä¹\n\njava.lang.reflect åä¸ä¸»è¦åå«ä¸äºå®ç°åå°åè½çå·¥å·ç±»ãå®éä¸ï¼java.lang.reflect åæææä¾çåå° api æ©åäºè¯»åè¿è¡æ¶æ³¨è§£ä¿¡æ¯çè½åãå½ä¸ä¸ªæ³¨è§£ç±»åè¢«å®ä¹ä¸ºè¿è¡æ¶çæ³¨è§£åï¼è¯¥æ³¨è§£æè½æ¯è¿è¡æ¶å¯è§ï¼å½ class æä»¶è¢«è£è½½æ¶è¢«ä¿å­å¨ class æä»¶ä¸­çæ³¨è§£æä¼è¢«èææºè¯»åã annotatedelement æ¥å£æ¯ææç¨åºåç´ ï¼classãmethod å constructorï¼çç¶æ¥å£ï¼æä»¥ç¨åºéè¿åå°è·åäºæä¸ªç±»çannotatedelement å¯¹è±¡ä¹åï¼ç¨åºå°±å¯ä»¥è°ç¨è¯¥å¯¹è±¡çå¦ä¸åä¸ªä¸ªæ¹æ³æ¥è®¿é®æ³¨è§£ä¿¡æ¯ï¼\n\n * getannotation - è¿åè¯¥ç¨åºåç´ ä¸å­å¨çãæå®ç±»åçæ³¨è§£ï¼å¦æè¯¥ç±»åæ³¨è§£ä¸å­å¨ï¼åè¿å nullã\n * getannotations - è¿åè¯¥ç¨åºåç´ ä¸å­å¨çæææ³¨è§£ã\n * isannotationpresent - å¤æ­è¯¥ç¨åºåç´ ä¸æ¯å¦åå«æå®ç±»åçæ³¨è§£ï¼å­å¨åè¿å trueï¼å¦åè¿å falseã\n * getdeclaredannotations - è¿åç´æ¥å­å¨äºæ­¤åç´ ä¸çæææ³¨éãä¸æ­¤æ¥å£ä¸­çå¶ä»æ¹æ³ä¸åï¼è¯¥æ¹æ³å°å¿½ç¥ç»§æ¿çæ³¨éãï¼å¦ææ²¡ææ³¨éç´æ¥å­å¨äºæ­¤åç´ ä¸ï¼åè¿åé¿åº¦ä¸ºé¶çä¸ä¸ªæ°ç»ãï¼è¯¥æ¹æ³çè°ç¨èå¯ä»¥éæä¿®æ¹è¿åçæ°ç»ï¼è¿ä¸ä¼å¯¹å¶ä»è°ç¨èè¿åçæ°ç»äº§çä»»ä½å½±åã\n\näºè§£äºä»¥ä¸åå®¹ï¼è®©æä»¬æ¥å®ç° @regexvalid çæ³¨è§£å¤çå¨ï¼\n\nimport java.lang.reflect.field;\nimport java.util.regex.matcher;\nimport java.util.regex.pattern;\n\npublic class regexvalidutil {\n    public static boolean check(object obj) throws exception {\n        boolean result = true;\n        stringbuilder sb = new stringbuilder();\n        field[] fields = obj.getclass().getdeclaredfields();\n        for (field field : fields) {\n            // å¤æ­æåæ¯å¦è¢« @regexvalid æ³¨è§£æä¿®é¥°\n            if (field.isannotationpresent(regexvalid.class)) {\n                regexvalid valid = field.getannotation(regexvalid.class);\n\n                // å¦æ value ä¸ºç©ºå­ç¬¦ä¸²ï¼è¯´ææ²¡ææ³¨å¥èªå®ä¹æ­£åè¡¨è¾¾å¼ï¼æ¹ç¨ policy å±æ§\n                string value = valid.value();\n                if ("".equals(value)) {\n                    regexvalid.policy policy = valid.policy();\n                    value = policy.getpolicy();\n                }\n\n                // éè¿è®¾ç½® setaccessible(true) æ¥è®¿é®ç§ææå\n                field.setaccessible(true);\n                object fieldobj = null;\n                try {\n                    fieldobj = field.get(obj);\n                } catch (illegalaccessexception e) {\n                    e.printstacktrace();\n                }\n                if (fieldobj == null) {\n                    sb.append("\\n")\n                        .append(string.format("%s ç±»ä¸­ç %s å­æ®µä¸è½ä¸ºç©ºï¼", obj.getclass().getname(), field.getname()));\n                    result = false;\n                } else {\n                    if (fieldobj instanceof string) {\n                        string text = (string) fieldobj;\n                        pattern p = pattern.compile(value);\n                        matcher m = p.matcher(text);\n                        result = m.matches();\n                        if (!result) {\n                            sb.append("\\n").append(string.format("%s ä¸æ¯åæ³ç %s ï¼", text, field.getname()));\n                        }\n                    } else {\n                        sb.append("\\n").append(\n                            string.format("%s ç±»ä¸­ç %s å­æ®µä¸æ¯å­ç¬¦ä¸²ç±»åï¼ä¸è½ä½¿ç¨æ­¤æ³¨è§£æ ¡éªï¼", obj.getclass().getname(), field.getname()));\n                        result = false;\n                    }\n                }\n            }\n        }\n\n        if (sb.length() > 0) {\n            throw new exception(sb.tostring());\n        }\n        return result;\n    }\n}\n\n\n> è¯´æï¼\n> \n> ä»¥ä¸ç¤ºä¾ä¸­çæ³¨è§£å¤çå¨ï¼æ§è¡æ­¥éª¤å¦ä¸ï¼\n> \n>  1. éè¿ getdeclaredfields åå°æ¹æ³è·åä¼ å¥å¯¹è±¡çæææåã\n>  2. éåæåï¼ä½¿ç¨ isannotationpresent å¤æ­æåæ¯å¦è¢«æå®æ³¨è§£æä¿®é¥°ï¼å¦æä¸æ¯ï¼ç´æ¥è·³è¿ã\n>  3. å¦ææåè¢«æ³¨è§£æä¿®é¥°ï¼éè¿ regexvalid valid = field.getannotation(regexvalid.class); è¿æ ·çå½¢å¼è·åï¼æ³¨è§£å®ä¾åå¯¹è±¡ï¼ç¶åï¼å°±å¯ä»¥ä½¿ç¨ valid.value() æ valid.policy() è¿æ ·çå½¢å¼è·åæ³¨è§£ä¸­è®¾å®çå±æ§å¼ã\n>  4. æ ¹æ®å±æ§å¼ï¼è¿è¡é»è¾å¤çã\n\n\n# ä½¿ç¨æ³¨è§£\n\nå®æäºä»¥ä¸å·¥ä½ï¼æä»¬å°±å¯ä»¥ä½¿ç¨èªå®ä¹æ³¨è§£äºï¼ç¤ºä¾å¦ä¸ï¼\n\npublic class regexvaliddemo {\n    static class user {\n        private string name;\n        @regexvalid(policy = regexvalid.policy.date)\n        private string date;\n        @regexvalid(policy = regexvalid.policy.mail)\n        private string mail;\n        @regexvalid("^((\\\\+)?86\\\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\\\d{8}$")\n        private string phone;\n\n        public user(string name, string date, string mail, string phone) {\n            this.name = name;\n            this.date = date;\n            this.mail = mail;\n            this.phone = phone;\n        }\n\n        @override\n        public string tostring() {\n            return "user{" + "name=\'" + name + \'\\\'\' + ", date=\'" + date + \'\\\'\' + ", mail=\'" + mail + \'\\\'\' + ", phone=\'"\n                + phone + \'\\\'\' + \'}\';\n        }\n    }\n\n    static void printdate(@regexvalid(policy = regexvalid.policy.date) string date){\n        system.out.println(date);\n    }\n\n    public static void main(string[] args) throws exception {\n        user user = new user("tom", "1990-01-31", "xxx@163.com", "18612341234");\n        user user2 = new user("jack", "2019-02-29", "sadhgs", "183xxxxxxxx");\n        if (regexvalidutil.check(user)) {\n            system.out.println(user + "æ­£åæ ¡éªéè¿");\n        }\n        if (regexvalidutil.check(user2)) {\n            system.out.println(user2 + "æ­£åæ ¡éªéè¿");\n        }\n    }\n}\n\n\n\n# å°ç»\n\n\n\n\n\n\n\n\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * effective java\n * oracle å®æ¹ææ¡£ä¹æ³¨è§£ç¯\n * æ·±å¥çè§£ javaï¼æ³¨è§£ï¼annotationï¼èªå®ä¹æ³¨è§£å¥é¨\n * https://blog.csdn.net/briblue/article/details/73824058',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å¸¸ç¨å·¥å·ç±»",frontmatter:{title:"Java å¸¸ç¨å·¥å·ç±»",date:"2019-12-16T16:59:15.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","å·¥å·ç±»"],permalink:"/pages/71bfcd/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/41.Java%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/41.Javaå¸¸ç¨å·¥å·ç±».md",key:"v-aed39f40",path:"/pages/71bfcd/",headers:[{level:2,title:"å­ç¬¦ä¸²",slug:"å­ç¬¦ä¸²",normalizedTitle:"å­ç¬¦ä¸²",charIndex:52},{level:3,title:"String",slug:"string",normalizedTitle:"string",charIndex:60},{level:3,title:"StringBuffer",slug:"stringbuffer",normalizedTitle:"stringbuffer",charIndex:71},{level:3,title:"StringBuilder",slug:"stringbuilder",normalizedTitle:"stringbuilder",charIndex:88},{level:2,title:"æ¥ææ¶é´",slug:"æ¥ææ¶é´",normalizedTitle:"æ¥ææ¶é´",charIndex:106},{level:3,title:"Date",slug:"date",normalizedTitle:"date",charIndex:115},{level:3,title:"SimpleDateFormat",slug:"simpledateformat",normalizedTitle:"simpledateformat",charIndex:124},{level:3,title:"Calendar",slug:"calendar",normalizedTitle:"calendar",charIndex:145},{level:2,title:"æ°å­¦",slug:"æ°å­¦",normalizedTitle:"æ°å­¦",charIndex:158},{level:3,title:"Number",slug:"number",normalizedTitle:"number",charIndex:165},{level:3,title:"Math",slug:"math",normalizedTitle:"math",charIndex:176},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:185}],headersStr:"å­ç¬¦ä¸² String StringBuffer StringBuilder æ¥ææ¶é´ Date SimpleDateFormat Calendar æ°å­¦ Number Math åèèµæ",content:"# Java å¸¸ç¨å·¥å·ç±»\n\n> å¹¶åãIOãå®¹å¨çå·¥å·ç±»ä¸ä¼å¨æ¬ææåï¼åé¢ä¼æä¸é¢ä¸ä¸éæ¥ã\n\n\n# å­ç¬¦ä¸²\n\n\n# String\n\n\n# StringBuffer\n\n\n# StringBuilder\n\n\n# æ¥ææ¶é´\n\n\n# Date\n\n\n# SimpleDateFormat\n\n\n# Calendar\n\n\n# æ°å­¦\n\n\n# Number\n\n\n# Math\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼",normalizedContent:"# java å¸¸ç¨å·¥å·ç±»\n\n> å¹¶åãioãå®¹å¨çå·¥å·ç±»ä¸ä¼å¨æ¬ææåï¼åé¢ä¼æä¸é¢ä¸ä¸éæ¥ã\n\n\n# å­ç¬¦ä¸²\n\n\n# string\n\n\n# stringbuffer\n\n\n# stringbuilder\n\n\n# æ¥ææ¶é´\n\n\n# date\n\n\n# simpledateformat\n\n\n# calendar\n\n\n# æ°å­¦\n\n\n# number\n\n\n# math\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java String ç±»å",frontmatter:{title:"æ·±å¥çè§£ Java String ç±»å",date:"2020-12-25T18:43:11.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE","å·¥å·ç±»","å­ç¬¦ä¸²"],permalink:"/pages/bc583c/"},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/42.JavaString%E7%B1%BB%E5%9E%8B.html",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/42.JavaStringç±»å.md",key:"v-e38dd302",path:"/pages/bc583c/",headers:[{level:2,title:"String çä¸å¯åæ§",slug:"string-çä¸å¯åæ§",normalizedTitle:"string çä¸å¯åæ§",charIndex:119},{level:2,title:"String çæ§è½èé",slug:"string-çæ§è½èé",normalizedTitle:"string çæ§è½èé",charIndex:929},{level:3,title:"å­ç¬¦ä¸²æ¼æ¥",slug:"å­ç¬¦ä¸²æ¼æ¥",normalizedTitle:"å­ç¬¦ä¸²æ¼æ¥",charIndex:946},{level:3,title:"å­ç¬¦ä¸²åå²",slug:"å­ç¬¦ä¸²åå²",normalizedTitle:"å­ç¬¦ä¸²åå²",charIndex:1696},{level:3,title:"String.intern",slug:"string-intern",normalizedTitle:"string.intern",charIndex:1903},{level:2,title:"StringãStringBufferãStringBuilder æä»ä¹åºå«",slug:"stringãstringbufferãstringbuilder-æä»ä¹åºå«",normalizedTitle:"stringãstringbufferãstringbuilder æä»ä¹åºå«",charIndex:2668},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:3478}],headersStr:"String çä¸å¯åæ§ String çæ§è½èé å­ç¬¦ä¸²æ¼æ¥ å­ç¬¦ä¸²åå² String.intern StringãStringBufferãStringBuilder æä»ä¹åºå« åèèµæ",content:'# æ·±å¥çè§£ Java String ç±»å\n\n> String ç±»åå¯è½æ¯ Java ä¸­åºç¨æé¢ç¹çå¼ç¨ç±»åï¼ä½å®çæ§è½é®é¢å´å¸¸å¸¸è¢«å¿½ç¥ãé«æçä½¿ç¨å­ç¬¦ä¸²ï¼å¯ä»¥æåç³»ç»çæ´ä½æ§è½ãå½ç¶ï¼è¦åå°é«æä½¿ç¨å­ç¬¦ä¸²ï¼éè¦æ·±å¥äºè§£å¶ç¹æ§ã\n\n\n# String çä¸å¯åæ§\n\næä»¬åæ¥çä¸ String çå®ä¹ï¼\n\npublic final class String\n    implements java.io.Serializable, Comparable<String>, CharSequence {\n    /** The value is used for character storage. */\n    private final char value[];\n\n\nString ç±»è¢« final å³é®å­ä¿®é¥°ï¼è¡¨ç¤ºä¸å¯ç»§æ¿ String ç±»ã\n\nString ç±»çæ°æ®å­å¨äº char[] æ°ç»ï¼è¿ä¸ªæ°ç»è¢« final å³é®å­ä¿®é¥°ï¼è¡¨ç¤º String å¯¹è±¡ä¸å¯è¢«æ´æ¹ã\n\nä¸ºä»ä¹ Java è¦è¿æ ·è®¾è®¡ï¼\n\nï¼1ï¼ä¿è¯ String å¯¹è±¡å®å¨æ§ãé¿å String è¢«ç¯¡æ¹ã\n\nï¼2ï¼ä¿è¯ hash å¼ä¸ä¼é¢ç¹åæ´ã\n\nï¼3ï¼å¯ä»¥å®ç°å­ç¬¦ä¸²å¸¸éæ± ãéå¸¸æä¸¤ç§åå»ºå­ç¬¦ä¸²å¯¹è±¡çæ¹å¼ï¼ä¸ç§æ¯éè¿å­ç¬¦ä¸²å¸¸éçæ¹å¼åå»ºï¼å¦ String str="abc"; å¦ä¸ç§æ¯å­ç¬¦ä¸²åééè¿ new å½¢å¼çåå»ºï¼å¦ String str = new String("abc")ã\n\nä½¿ç¨ç¬¬ä¸ç§æ¹å¼åå»ºå­ç¬¦ä¸²å¯¹è±¡æ¶ï¼JVM é¦åä¼æ£æ¥è¯¥å¯¹è±¡æ¯å¦å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­ï¼å¦æå¨ï¼å°±è¿åè¯¥å¯¹è±¡å¼ç¨ï¼å¦åæ°çå­ç¬¦ä¸²å°å¨å¸¸éæ± ä¸­è¢«åå»ºãè¿ç§æ¹å¼å¯ä»¥åå°åä¸ä¸ªå¼çå­ç¬¦ä¸²å¯¹è±¡çéå¤åå»ºï¼èçº¦åå­ã\n\nString str = new String("abc") è¿ç§æ¹å¼ï¼é¦åå¨ç¼è¯ç±»æä»¶æ¶ï¼"abc" å¸¸éå­ç¬¦ä¸²å°ä¼æ¾å¥å°å¸¸éç»æä¸­ï¼å¨ç±»å è½½æ¶ï¼"abc" å°ä¼å¨å¸¸éæ± ä¸­åå»ºï¼å¶æ¬¡ï¼å¨è°ç¨ new æ¶ï¼JVM å½ä»¤å°ä¼è°ç¨ String çæé å½æ°ï¼åæ¶å¼ç¨å¸¸éæ± ä¸­ç "abc" å­ç¬¦ä¸²ï¼å¨å åå­ä¸­åå»ºä¸ä¸ª String å¯¹è±¡ï¼æåï¼str å°å¼ç¨ String å¯¹è±¡ã\n\n\n# String çæ§è½èé\n\n\n# å­ç¬¦ä¸²æ¼æ¥\n\nå­ç¬¦ä¸²å¸¸éçæ¼æ¥ï¼ç¼è¯å¨ä¼å°å¶ä¼åä¸ºä¸ä¸ªå¸¸éå­ç¬¦ä¸²ã\n\nãç¤ºä¾ãå­ç¬¦ä¸²å¸¸éæ¼æ¥\n\npublic static void main(String[] args) {\n    // æ¬è¡ä»£ç å¨ class æä»¶ä¸­ï¼ä¼è¢«ç¼è¯å¨ç´æ¥ä¼åä¸ºï¼\n    // String str = "abc";\n    String str = "a" + "b" + "c";\n    System.out.println("str = " + str);\n}\n\n\nå­ç¬¦ä¸²åéçæ¼æ¥ï¼ç¼è¯å¨ä¼ä¼åæ StringBuilder çæ¹å¼ã\n\nãç¤ºä¾ãå­ç¬¦ä¸²åéçæ¼æ¥\n\npublic static void main(String[] args) {\n    String str = "";\n    for(int i=0; i<1000; i++) {\n        // æ¬è¡ä»£ç ä¼è¢«ç¼è¯å¨ä¼åä¸ºï¼\n        // str = (new StringBuilder(String.valueOf(str))).append(i).toString();\n        str = str + i;\n    }\n}\n\n\nä½æ¯ï¼æ¯æ¬¡å¾ªç¯é½ä¼çæä¸ä¸ªæ°ç StringBuilder å®ä¾ï¼åæ ·ä¹ä¼éä½ç³»ç»çæ§è½ã\n\nå­ç¬¦ä¸²æ¼æ¥çæ­£ç¡®æ¹æ¡ï¼\n\n * å¦æéè¦ä½¿ç¨å­ç¬¦ä¸²æ¼æ¥ï¼åºè¯¥ä¼åèè StringBuilder ç append æ¹æ³æ¿ä»£ä½¿ç¨ + å·ã\n * å¦æå¨å¹¶åç¼ç¨ä¸­ï¼String å¯¹è±¡çæ¼æ¥æ¶åå°çº¿ç¨å®å¨ï¼å¯ä»¥ä½¿ç¨ StringBufferãä½æ¯è¦æ³¨æï¼ç±äº StringBuffer æ¯çº¿ç¨å®å¨çï¼æ¶åå°éç«äºï¼æä»¥ä»æ§è½ä¸æ¥è¯´ï¼è¦æ¯ StringBuilder å·®ä¸äºã\n\n\n# å­ç¬¦ä¸²åå²\n\nString ç split() æ¹æ³ä½¿ç¨æ­£åè¡¨è¾¾å¼å®ç°å¶å¼ºå¤§çåå²åè½ãèæ­£åè¡¨è¾¾å¼çæ§è½æ¯éå¸¸ä¸ç¨³å®çï¼ä½¿ç¨ä¸æ°å½ä¼å¼èµ·åæº¯é®é¢ï¼å¾å¯è½å¯¼è´ CPU å±é«ä¸ä¸ã\n\næä»¥ï¼åºè¯¥æéä½¿ç¨ split() æ¹æ³ï¼å¯ä»¥èèç¨ String.indexOf() æ¹æ³ä»£æ¿ split() æ¹æ³å®æå­ç¬¦ä¸²çåå²ãå¦æå®å¨æ æ³æ»¡è¶³éæ±ï¼ä½ å°±å¨ä½¿ç¨ Split() æ¹æ³æ¶ï¼å¯¹åæº¯é®é¢å ä»¥éè§å°±å¯ä»¥äºã\n\n\n# String.intern\n\nå¨æ¯æ¬¡èµå¼çæ¶åä½¿ç¨ String ç intern æ¹æ³ï¼å¦æå¸¸éæ± ä¸­æç¸åå¼ï¼å°±ä¼éå¤ä½¿ç¨è¯¥å¯¹è±¡ï¼è¿åå¯¹è±¡å¼ç¨ï¼è¿æ ·ä¸å¼å§çå¯¹è±¡å°±å¯ä»¥è¢«åæ¶æã\n\nå¨å­ç¬¦ä¸²å¸¸éä¸­ï¼é»è®¤ä¼å°å¯¹è±¡æ¾å¥å¸¸éæ± ï¼å¨å­ç¬¦ä¸²åéä¸­ï¼å¯¹è±¡æ¯ä¼åå»ºå¨å åå­ä¸­ï¼åæ¶ä¹ä¼å¨å¸¸éæ± ä¸­åå»ºä¸ä¸ªå­ç¬¦ä¸²å¯¹è±¡ï¼å¤å¶å°å åå­å¯¹è±¡ä¸­ï¼å¹¶è¿åå åå­å¯¹è±¡å¼ç¨ã\n\nå¦æè°ç¨ intern æ¹æ³ï¼ä¼å»æ¥çå­ç¬¦ä¸²å¸¸éæ± ä¸­æ¯å¦æç­äºè¯¥å¯¹è±¡çå­ç¬¦ä¸²ï¼å¦ææ²¡æï¼å°±å¨å¸¸éæ± ä¸­æ°å¢è¯¥å¯¹è±¡ï¼å¹¶è¿åè¯¥å¯¹è±¡å¼ç¨ï¼å¦ææï¼å°±è¿åå¸¸éæ± ä¸­çå­ç¬¦ä¸²å¼ç¨ãå åå­ä¸­åæçå¯¹è±¡ç±äºæ²¡æå¼ç¨æåå®ï¼å°ä¼éè¿åå¾åæ¶å¨åæ¶ã\n\nãç¤ºä¾ã\n\npublic class SharedLocation {\n\n\tprivate String city;\n\tprivate String region;\n\tprivate String countryCode;\n}\n\nSharedLocation sharedLocation = new SharedLocation();\nsharedLocation.setCity(messageInfo.getCity().intern());\t\tsharedLocation.setCountryCode(messageInfo.getRegion().intern());\nsharedLocation.setRegion(messageInfo.getCountryCode().intern());\n\n\n> ä½¿ç¨ intern æ¹æ³éè¦æ³¨æï¼ä¸å®è¦ç»åå®éåºæ¯ãå ä¸ºå¸¸éæ± çå®ç°æ¯ç±»ä¼¼äºä¸ä¸ª HashTable çå®ç°æ¹å¼ï¼HashTable å­å¨çæ°æ®è¶å¤§ï¼éåçæ¶é´å¤æåº¦å°±ä¼å¢å ãå¦ææ°æ®è¿å¤§ï¼ä¼å¢å æ´ä¸ªå­ç¬¦ä¸²å¸¸éæ± çè´æã\n\n\n# StringãStringBufferãStringBuilder æä»ä¹åºå«\n\nString æ¯ Java è¯­è¨éå¸¸åºç¡åéè¦çç±»ï¼æä¾äºæé åç®¡çå­ç¬¦ä¸²çåç§åºæ¬é»è¾ãå®æ¯å¸åç Immutable ç±»ï¼è¢«å£°ææä¸º final classï¼ææå±æ§ä¹é½æ¯ final çãä¹ç±äºå®çä¸å¯åæ§ï¼ç±»ä¼¼æ¼æ¥ãè£åªå­ç¬¦ä¸²ç­å¨ä½ï¼é½ä¼äº§çæ°ç String å¯¹è±¡ãç±äºå­ç¬¦ä¸²æä½çæ®éæ§ï¼æä»¥ç¸å³æä½çæçå¾å¾å¯¹åºç¨æ§è½æææ¾å½±åã\n\nStringBuffer æ¯ä¸ºè§£å³ä¸é¢æå°æ¼æ¥äº§çå¤ªå¤ä¸­é´å¯¹è±¡çé®é¢èæä¾çä¸ä¸ªç±»ï¼æä»¬å¯ä»¥ç¨ append æè add æ¹æ³ï¼æå­ç¬¦ä¸²æ·»å å°å·²æåºåçæ«å°¾æèæå®ä½ç½®ãStringBuffer æ¯ä¸ä¸ªçº¿ç¨å®å¨çå¯ä¿®æ¹å­ç¬¦åºåãStringBuffer ççº¿ç¨å®å¨æ¯éè¿å¨åç§ä¿®æ¹æ°æ®çæ¹æ³ä¸ç¨ synchronized å³é®å­ä¿®é¥°å®ç°çã\n\nStringBuilder æ¯ Java 1.5 ä¸­æ°å¢çï¼å¨è½åä¸å StringBuffer æ²¡ææ¬è´¨åºå«ï¼ä½æ¯å®å»æäºçº¿ç¨å®å¨çé¨åï¼ææåå°äºå¼éï¼æ¯ç»å¤§é¨åæåµä¸è¿è¡å­ç¬¦ä¸²æ¼æ¥çé¦éã\n\nStringBuffer å StringBuilder åºå±é½æ¯å©ç¨å¯ä¿®æ¹çï¼charï¼JDK 9 ä»¥åæ¯ byteï¼æ°ç»ï¼äºèé½ç»§æ¿äº AbstractStringBuilderï¼éé¢åå«äºåºæ¬æä½ï¼åºå«ä»å¨äºæç»çæ¹æ³æ¯å¦å äº synchronizedãæå»ºæ¶åå§å­ç¬¦ä¸²é¿åº¦å  16ï¼è¿æå³çï¼å¦ææ²¡ææå»ºå¯¹è±¡æ¶è¾å¥æåçå­ç¬¦ä¸²ï¼é£ä¹åå§å¼å°±æ¯ 16ï¼ãæä»¬å¦æç¡®å®æ¼æ¥ä¼åçéå¸¸å¤æ¬¡ï¼èä¸å¤§æ¦æ¯å¯é¢è®¡çï¼é£ä¹å°±å¯ä»¥æå®åéçå¤§å°ï¼é¿åå¾å¤æ¬¡æ©å®¹çå¼éãæ©å®¹ä¼äº§çå¤éå¼éï¼å ä¸ºè¦æå¼åææ°ç»ï¼åå»ºæ°çï¼å¯ä»¥ç®åè®¤ä¸ºæ¯åæ°ï¼æ°ç»ï¼è¿è¦è¿è¡ arraycopyã\n\né¤éæçº¿ç¨å®å¨çéè¦ï¼ä¸ç¶ä¸è¬é½ä½¿ç¨ StringBuilderã\n\n\n# åèèµæ\n\n * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n * ãJava æ§è½è°ä¼å®æã\n * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * Java åºæ¬æ°æ®ç±»ååå¼ç¨ç±»å\n * æ·±å¥åæ Java ä¸­çè£ç®±åæç®±',normalizedContent:'# æ·±å¥çè§£ java string ç±»å\n\n> string ç±»åå¯è½æ¯ java ä¸­åºç¨æé¢ç¹çå¼ç¨ç±»åï¼ä½å®çæ§è½é®é¢å´å¸¸å¸¸è¢«å¿½ç¥ãé«æçä½¿ç¨å­ç¬¦ä¸²ï¼å¯ä»¥æåç³»ç»çæ´ä½æ§è½ãå½ç¶ï¼è¦åå°é«æä½¿ç¨å­ç¬¦ä¸²ï¼éè¦æ·±å¥äºè§£å¶ç¹æ§ã\n\n\n# string çä¸å¯åæ§\n\næä»¬åæ¥çä¸ string çå®ä¹ï¼\n\npublic final class string\n    implements java.io.serializable, comparable<string>, charsequence {\n    /** the value is used for character storage. */\n    private final char value[];\n\n\nstring ç±»è¢« final å³é®å­ä¿®é¥°ï¼è¡¨ç¤ºä¸å¯ç»§æ¿ string ç±»ã\n\nstring ç±»çæ°æ®å­å¨äº char[] æ°ç»ï¼è¿ä¸ªæ°ç»è¢« final å³é®å­ä¿®é¥°ï¼è¡¨ç¤º string å¯¹è±¡ä¸å¯è¢«æ´æ¹ã\n\nä¸ºä»ä¹ java è¦è¿æ ·è®¾è®¡ï¼\n\nï¼1ï¼ä¿è¯ string å¯¹è±¡å®å¨æ§ãé¿å string è¢«ç¯¡æ¹ã\n\nï¼2ï¼ä¿è¯ hash å¼ä¸ä¼é¢ç¹åæ´ã\n\nï¼3ï¼å¯ä»¥å®ç°å­ç¬¦ä¸²å¸¸éæ± ãéå¸¸æä¸¤ç§åå»ºå­ç¬¦ä¸²å¯¹è±¡çæ¹å¼ï¼ä¸ç§æ¯éè¿å­ç¬¦ä¸²å¸¸éçæ¹å¼åå»ºï¼å¦ string str="abc"; å¦ä¸ç§æ¯å­ç¬¦ä¸²åééè¿ new å½¢å¼çåå»ºï¼å¦ string str = new string("abc")ã\n\nä½¿ç¨ç¬¬ä¸ç§æ¹å¼åå»ºå­ç¬¦ä¸²å¯¹è±¡æ¶ï¼jvm é¦åä¼æ£æ¥è¯¥å¯¹è±¡æ¯å¦å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­ï¼å¦æå¨ï¼å°±è¿åè¯¥å¯¹è±¡å¼ç¨ï¼å¦åæ°çå­ç¬¦ä¸²å°å¨å¸¸éæ± ä¸­è¢«åå»ºãè¿ç§æ¹å¼å¯ä»¥åå°åä¸ä¸ªå¼çå­ç¬¦ä¸²å¯¹è±¡çéå¤åå»ºï¼èçº¦åå­ã\n\nstring str = new string("abc") è¿ç§æ¹å¼ï¼é¦åå¨ç¼è¯ç±»æä»¶æ¶ï¼"abc" å¸¸éå­ç¬¦ä¸²å°ä¼æ¾å¥å°å¸¸éç»æä¸­ï¼å¨ç±»å è½½æ¶ï¼"abc" å°ä¼å¨å¸¸éæ± ä¸­åå»ºï¼å¶æ¬¡ï¼å¨è°ç¨ new æ¶ï¼jvm å½ä»¤å°ä¼è°ç¨ string çæé å½æ°ï¼åæ¶å¼ç¨å¸¸éæ± ä¸­ç "abc" å­ç¬¦ä¸²ï¼å¨å åå­ä¸­åå»ºä¸ä¸ª string å¯¹è±¡ï¼æåï¼str å°å¼ç¨ string å¯¹è±¡ã\n\n\n# string çæ§è½èé\n\n\n# å­ç¬¦ä¸²æ¼æ¥\n\nå­ç¬¦ä¸²å¸¸éçæ¼æ¥ï¼ç¼è¯å¨ä¼å°å¶ä¼åä¸ºä¸ä¸ªå¸¸éå­ç¬¦ä¸²ã\n\nãç¤ºä¾ãå­ç¬¦ä¸²å¸¸éæ¼æ¥\n\npublic static void main(string[] args) {\n    // æ¬è¡ä»£ç å¨ class æä»¶ä¸­ï¼ä¼è¢«ç¼è¯å¨ç´æ¥ä¼åä¸ºï¼\n    // string str = "abc";\n    string str = "a" + "b" + "c";\n    system.out.println("str = " + str);\n}\n\n\nå­ç¬¦ä¸²åéçæ¼æ¥ï¼ç¼è¯å¨ä¼ä¼åæ stringbuilder çæ¹å¼ã\n\nãç¤ºä¾ãå­ç¬¦ä¸²åéçæ¼æ¥\n\npublic static void main(string[] args) {\n    string str = "";\n    for(int i=0; i<1000; i++) {\n        // æ¬è¡ä»£ç ä¼è¢«ç¼è¯å¨ä¼åä¸ºï¼\n        // str = (new stringbuilder(string.valueof(str))).append(i).tostring();\n        str = str + i;\n    }\n}\n\n\nä½æ¯ï¼æ¯æ¬¡å¾ªç¯é½ä¼çæä¸ä¸ªæ°ç stringbuilder å®ä¾ï¼åæ ·ä¹ä¼éä½ç³»ç»çæ§è½ã\n\nå­ç¬¦ä¸²æ¼æ¥çæ­£ç¡®æ¹æ¡ï¼\n\n * å¦æéè¦ä½¿ç¨å­ç¬¦ä¸²æ¼æ¥ï¼åºè¯¥ä¼åèè stringbuilder ç append æ¹æ³æ¿ä»£ä½¿ç¨ + å·ã\n * å¦æå¨å¹¶åç¼ç¨ä¸­ï¼string å¯¹è±¡çæ¼æ¥æ¶åå°çº¿ç¨å®å¨ï¼å¯ä»¥ä½¿ç¨ stringbufferãä½æ¯è¦æ³¨æï¼ç±äº stringbuffer æ¯çº¿ç¨å®å¨çï¼æ¶åå°éç«äºï¼æä»¥ä»æ§è½ä¸æ¥è¯´ï¼è¦æ¯ stringbuilder å·®ä¸äºã\n\n\n# å­ç¬¦ä¸²åå²\n\nstring ç split() æ¹æ³ä½¿ç¨æ­£åè¡¨è¾¾å¼å®ç°å¶å¼ºå¤§çåå²åè½ãèæ­£åè¡¨è¾¾å¼çæ§è½æ¯éå¸¸ä¸ç¨³å®çï¼ä½¿ç¨ä¸æ°å½ä¼å¼èµ·åæº¯é®é¢ï¼å¾å¯è½å¯¼è´ cpu å±é«ä¸ä¸ã\n\næä»¥ï¼åºè¯¥æéä½¿ç¨ split() æ¹æ³ï¼å¯ä»¥èèç¨ string.indexof() æ¹æ³ä»£æ¿ split() æ¹æ³å®æå­ç¬¦ä¸²çåå²ãå¦æå®å¨æ æ³æ»¡è¶³éæ±ï¼ä½ å°±å¨ä½¿ç¨ split() æ¹æ³æ¶ï¼å¯¹åæº¯é®é¢å ä»¥éè§å°±å¯ä»¥äºã\n\n\n# string.intern\n\nå¨æ¯æ¬¡èµå¼çæ¶åä½¿ç¨ string ç intern æ¹æ³ï¼å¦æå¸¸éæ± ä¸­æç¸åå¼ï¼å°±ä¼éå¤ä½¿ç¨è¯¥å¯¹è±¡ï¼è¿åå¯¹è±¡å¼ç¨ï¼è¿æ ·ä¸å¼å§çå¯¹è±¡å°±å¯ä»¥è¢«åæ¶æã\n\nå¨å­ç¬¦ä¸²å¸¸éä¸­ï¼é»è®¤ä¼å°å¯¹è±¡æ¾å¥å¸¸éæ± ï¼å¨å­ç¬¦ä¸²åéä¸­ï¼å¯¹è±¡æ¯ä¼åå»ºå¨å åå­ä¸­ï¼åæ¶ä¹ä¼å¨å¸¸éæ± ä¸­åå»ºä¸ä¸ªå­ç¬¦ä¸²å¯¹è±¡ï¼å¤å¶å°å åå­å¯¹è±¡ä¸­ï¼å¹¶è¿åå åå­å¯¹è±¡å¼ç¨ã\n\nå¦æè°ç¨ intern æ¹æ³ï¼ä¼å»æ¥çå­ç¬¦ä¸²å¸¸éæ± ä¸­æ¯å¦æç­äºè¯¥å¯¹è±¡çå­ç¬¦ä¸²ï¼å¦ææ²¡æï¼å°±å¨å¸¸éæ± ä¸­æ°å¢è¯¥å¯¹è±¡ï¼å¹¶è¿åè¯¥å¯¹è±¡å¼ç¨ï¼å¦ææï¼å°±è¿åå¸¸éæ± ä¸­çå­ç¬¦ä¸²å¼ç¨ãå åå­ä¸­åæçå¯¹è±¡ç±äºæ²¡æå¼ç¨æåå®ï¼å°ä¼éè¿åå¾åæ¶å¨åæ¶ã\n\nãç¤ºä¾ã\n\npublic class sharedlocation {\n\n\tprivate string city;\n\tprivate string region;\n\tprivate string countrycode;\n}\n\nsharedlocation sharedlocation = new sharedlocation();\nsharedlocation.setcity(messageinfo.getcity().intern());\t\tsharedlocation.setcountrycode(messageinfo.getregion().intern());\nsharedlocation.setregion(messageinfo.getcountrycode().intern());\n\n\n> ä½¿ç¨ intern æ¹æ³éè¦æ³¨æï¼ä¸å®è¦ç»åå®éåºæ¯ãå ä¸ºå¸¸éæ± çå®ç°æ¯ç±»ä¼¼äºä¸ä¸ª hashtable çå®ç°æ¹å¼ï¼hashtable å­å¨çæ°æ®è¶å¤§ï¼éåçæ¶é´å¤æåº¦å°±ä¼å¢å ãå¦ææ°æ®è¿å¤§ï¼ä¼å¢å æ´ä¸ªå­ç¬¦ä¸²å¸¸éæ± çè´æã\n\n\n# stringãstringbufferãstringbuilder æä»ä¹åºå«\n\nstring æ¯ java è¯­è¨éå¸¸åºç¡åéè¦çç±»ï¼æä¾äºæé åç®¡çå­ç¬¦ä¸²çåç§åºæ¬é»è¾ãå®æ¯å¸åç immutable ç±»ï¼è¢«å£°ææä¸º final classï¼ææå±æ§ä¹é½æ¯ final çãä¹ç±äºå®çä¸å¯åæ§ï¼ç±»ä¼¼æ¼æ¥ãè£åªå­ç¬¦ä¸²ç­å¨ä½ï¼é½ä¼äº§çæ°ç string å¯¹è±¡ãç±äºå­ç¬¦ä¸²æä½çæ®éæ§ï¼æä»¥ç¸å³æä½çæçå¾å¾å¯¹åºç¨æ§è½æææ¾å½±åã\n\nstringbuffer æ¯ä¸ºè§£å³ä¸é¢æå°æ¼æ¥äº§çå¤ªå¤ä¸­é´å¯¹è±¡çé®é¢èæä¾çä¸ä¸ªç±»ï¼æä»¬å¯ä»¥ç¨ append æè add æ¹æ³ï¼æå­ç¬¦ä¸²æ·»å å°å·²æåºåçæ«å°¾æèæå®ä½ç½®ãstringbuffer æ¯ä¸ä¸ªçº¿ç¨å®å¨çå¯ä¿®æ¹å­ç¬¦åºåãstringbuffer ççº¿ç¨å®å¨æ¯éè¿å¨åç§ä¿®æ¹æ°æ®çæ¹æ³ä¸ç¨ synchronized å³é®å­ä¿®é¥°å®ç°çã\n\nstringbuilder æ¯ java 1.5 ä¸­æ°å¢çï¼å¨è½åä¸å stringbuffer æ²¡ææ¬è´¨åºå«ï¼ä½æ¯å®å»æäºçº¿ç¨å®å¨çé¨åï¼ææåå°äºå¼éï¼æ¯ç»å¤§é¨åæåµä¸è¿è¡å­ç¬¦ä¸²æ¼æ¥çé¦éã\n\nstringbuffer å stringbuilder åºå±é½æ¯å©ç¨å¯ä¿®æ¹çï¼charï¼jdk 9 ä»¥åæ¯ byteï¼æ°ç»ï¼äºèé½ç»§æ¿äº abstractstringbuilderï¼éé¢åå«äºåºæ¬æä½ï¼åºå«ä»å¨äºæç»çæ¹æ³æ¯å¦å äº synchronizedãæå»ºæ¶åå§å­ç¬¦ä¸²é¿åº¦å  16ï¼è¿æå³çï¼å¦ææ²¡ææå»ºå¯¹è±¡æ¶è¾å¥æåçå­ç¬¦ä¸²ï¼é£ä¹åå§å¼å°±æ¯ 16ï¼ãæä»¬å¦æç¡®å®æ¼æ¥ä¼åçéå¸¸å¤æ¬¡ï¼èä¸å¤§æ¦æ¯å¯é¢è®¡çï¼é£ä¹å°±å¯ä»¥æå®åéçå¤§å°ï¼é¿åå¾å¤æ¬¡æ©å®¹çå¼éãæ©å®¹ä¼äº§çå¤éå¼éï¼å ä¸ºè¦æå¼åææ°ç»ï¼åå»ºæ°çï¼å¯ä»¥ç®åè®¤ä¸ºæ¯åæ°ï¼æ°ç»ï¼è¿è¦è¿è¡ arraycopyã\n\né¤éæçº¿ç¨å®å¨çéè¦ï¼ä¸ç¶ä¸è¬é½ä½¿ç¨ stringbuilderã\n\n\n# åèèµæ\n\n * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n * ãjava æ§è½è°ä¼å®æã\n * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * java åºæ¬æ°æ®ç±»ååå¼ç¨ç±»å\n * æ·±å¥åæ java ä¸­çè£ç®±åæç®±',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java åºç¡ç¹æ§",frontmatter:{title:"Java åºç¡ç¹æ§",date:"2020-06-04T13:51:01.000Z",categories:["Java","JavaSE","åºç¡ç¹æ§"],tags:["Java","JavaSE"],permalink:"/pages/8ea213/",hidden:!0},regularPath:"/01.Java/01.JavaSE/01.%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/",relativePath:"01.Java/01.JavaSE/01.åºç¡ç¹æ§/README.md",key:"v-2ab9bc43",path:"/pages/8ea213/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:44},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:219},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:852}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# Java åºç¡ç¹æ§\n\n> Java åºç¡ç¯æ»ç» Java çä¸äºåºç¡ç¹æ§ã\n\n\n# ð åå®¹\n\n * Java å¼åç¯å¢\n * Java åºç¡è¯­æ³ç¹æ§\n * Java åºæ¬æ°æ®ç±»å\n * Java é¢åå¯¹è±¡\n * Java æ¹æ³\n * Java æ°ç»\n * Java æä¸¾\n * Java æ§å¶è¯­å¥\n * Java å¼å¸¸\n * Java æ³å\n * Java åå°\n * Java æ³¨è§£\n * Java String ç±»å\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * Java åå¤§åè\n     * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n     * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n     * ãJava æ ¸å¿ææ¯ å· II é«çº§ç¹æ§ã\n     * ãEffective Javaã\n   * Java å¹¶å\n     * ãJava å¹¶åç¼ç¨å®æã\n     * ãJava å¹¶åç¼ç¨çèºæ¯ã\n   * Java èææº\n     * ãæ·±å¥çè§£ Java èææºã\n   * Java å¥é¨\n     * ãO'Reillyï¼Head First Javaã\n     * ãç¯ç Java è®²ä¹ã\n   * å¶ä»\n     * ãHead First è®¾è®¡æ¨¡å¼ã\n     * ãJava ç½ç»ç¼ç¨ã\n     * ãJava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ Java å¼åæåã\n * æç¨ãç¤¾åº\n   * Runoob Java æç¨\n   * java-design-patterns\n   * Java\n   * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãJava æ§è½è°ä¼å®æã\n   * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ Java èææº\n   * ãJava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * CS-Notes\n   * JavaGuide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð  JAVACORE é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# java åºç¡ç¹æ§\n\n> java åºç¡ç¯æ»ç» java çä¸äºåºç¡ç¹æ§ã\n\n\n# ð åå®¹\n\n * java å¼åç¯å¢\n * java åºç¡è¯­æ³ç¹æ§\n * java åºæ¬æ°æ®ç±»å\n * java é¢åå¯¹è±¡\n * java æ¹æ³\n * java æ°ç»\n * java æä¸¾\n * java æ§å¶è¯­å¥\n * java å¼å¸¸\n * java æ³å\n * java åå°\n * java æ³¨è§£\n * java string ç±»å\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * java åå¤§åè\n     * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n     * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n     * ãjava æ ¸å¿ææ¯ å· ii é«çº§ç¹æ§ã\n     * ãeffective javaã\n   * java å¹¶å\n     * ãjava å¹¶åç¼ç¨å®æã\n     * ãjava å¹¶åç¼ç¨çèºæ¯ã\n   * java èææº\n     * ãæ·±å¥çè§£ java èææºã\n   * java å¥é¨\n     * ão'reillyï¼head first javaã\n     * ãç¯ç java è®²ä¹ã\n   * å¶ä»\n     * ãhead first è®¾è®¡æ¨¡å¼ã\n     * ãjava ç½ç»ç¼ç¨ã\n     * ãjava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ java å¼åæåã\n * æç¨ãç¤¾åº\n   * runoob java æç¨\n   * java-design-patterns\n   * java\n   * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãjava æ§è½è°ä¼å®æã\n   * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ java èææº\n   * ãjava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * cs-notes\n   * javaguide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð  javacore é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java ç¼ç åå å¯",frontmatter:{title:"Java ç¼ç åå å¯",date:"2021-05-24T15:41:47.000Z",categories:["Java","JavaSE","é«çº§ç¹æ§"],tags:["Java","JavaSE","ç¼ç ","å å¯"],permalink:"/pages/a249ff/"},regularPath:"/01.Java/01.JavaSE/02.%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/02.Java%E7%BC%96%E7%A0%81%E5%92%8C%E5%8A%A0%E5%AF%86.html",relativePath:"01.Java/01.JavaSE/02.é«çº§ç¹æ§/02.Javaç¼ç åå å¯.md",key:"v-aedbe21a",path:"/pages/a249ff/",headers:[{level:2,title:"Base64 ç¼ç ",slug:"base64-ç¼ç ",normalizedTitle:"base64 ç¼ç ",charIndex:84},{level:3,title:"Base64 åç",slug:"base64-åç",normalizedTitle:"base64 åç",charIndex:98},{level:3,title:"Base64 åºç¨",slug:"base64-åºç¨",normalizedTitle:"base64 åºç¨",charIndex:1499},{level:2,title:"æ¶æ¯æè¦",slug:"æ¶æ¯æè¦",normalizedTitle:"æ¶æ¯æè¦",charIndex:27},{level:3,title:"æ¶æ¯æè¦æ¦è¿°",slug:"æ¶æ¯æè¦æ¦è¿°",normalizedTitle:"æ¶æ¯æè¦æ¦è¿°",charIndex:3341},{level:3,title:"æ¶æ¯æè¦ç¹ç¹",slug:"æ¶æ¯æè¦ç¹ç¹",normalizedTitle:"æ¶æ¯æè¦ç¹ç¹",charIndex:3650},{level:3,title:"æ¶æ¯æè¦å¸¸ç¨ç®æ³",slug:"æ¶æ¯æè¦å¸¸ç¨ç®æ³",normalizedTitle:"æ¶æ¯æè¦å¸¸ç¨ç®æ³",charIndex:3801},{level:3,title:"æ¶æ¯æè¦åºç¨",slug:"æ¶æ¯æè¦åºç¨",normalizedTitle:"æ¶æ¯æè¦åºç¨",charIndex:4046},{level:4,title:"MD5ãSHA çèä¾",slug:"md5ãsha-çèä¾",normalizedTitle:"md5ãsha çèä¾",charIndex:4056},{level:4,title:"HMAC çèä¾",slug:"hmac-çèä¾",normalizedTitle:"hmac çèä¾",charIndex:6219},{level:2,title:"æ°å­ç­¾å",slug:"æ°å­ç­¾å",normalizedTitle:"æ°å­ç­¾å",charIndex:32},{level:3,title:"æ°å­ç­¾åæ¦è¿°",slug:"æ°å­ç­¾åæ¦è¿°",normalizedTitle:"æ°å­ç­¾åæ¦è¿°",charIndex:8402},{level:3,title:"æ°å­ç­¾åç®æ³åºç¨",slug:"æ°å­ç­¾åç®æ³åºç¨",normalizedTitle:"æ°å­ç­¾åç®æ³åºç¨",charIndex:8635},{level:4,title:"DSA çèä¾",slug:"dsa-çèä¾",normalizedTitle:"dsa çèä¾",charIndex:8647},{level:2,title:"å¯¹ç§°å å¯",slug:"å¯¹ç§°å å¯",normalizedTitle:"å¯¹ç§°å å¯",charIndex:37},{level:3,title:"å¯¹ç§°å å¯æ¦è¿°",slug:"å¯¹ç§°å å¯æ¦è¿°",normalizedTitle:"å¯¹ç§°å å¯æ¦è¿°",charIndex:11087},{level:4,title:"å¯¹ç§°å å¯åç",slug:"å¯¹ç§°å å¯åç",normalizedTitle:"å¯¹ç§°å å¯åç",charIndex:11591},{level:4,title:"å¯¹ç§°å å¯å·¥ä½æ¨¡å¼",slug:"å¯¹ç§°å å¯å·¥ä½æ¨¡å¼",normalizedTitle:"å¯¹ç§°å å¯å·¥ä½æ¨¡å¼",charIndex:11829},{level:4,title:"å¯¹ç§°å å¯å¡«åæ¹æ³",slug:"å¯¹ç§°å å¯å¡«åæ¹æ³",normalizedTitle:"å¯¹ç§°å å¯å¡«åæ¹æ³",charIndex:12420},{level:3,title:"å¯¹ç§°å å¯åºç¨",slug:"å¯¹ç§°å å¯åºç¨",normalizedTitle:"å¯¹ç§°å å¯åºç¨",charIndex:12722},{level:4,title:"åºäºå¯é¥å å¯çæµç¨ï¼DESãDESedeãAES å IDEAï¼",slug:"åºäºå¯é¥å å¯çæµç¨-desãdesedeãaes-å-idea",normalizedTitle:"åºäºå¯é¥å å¯çæµç¨ï¼desãdesedeãaes å ideaï¼",charIndex:12732},{level:4,title:"åºäºå£ä»¤å å¯çæµç¨ï¼PBEï¼",slug:"åºäºå£ä»¤å å¯çæµç¨-pbe",normalizedTitle:"åºäºå£ä»¤å å¯çæµç¨ï¼pbeï¼",charIndex:17576},{level:2,title:"éå¯¹ç§°å å¯",slug:"éå¯¹ç§°å å¯",normalizedTitle:"éå¯¹ç§°å å¯",charIndex:42},{level:3,title:"éå¯¹ç§°å å¯æ¦è¿°",slug:"éå¯¹ç§°å å¯æ¦è¿°",normalizedTitle:"éå¯¹ç§°å å¯æ¦è¿°",charIndex:21619},{level:3,title:"éå¯¹ç§°å å¯ç®æ³åºç¨",slug:"éå¯¹ç§°å å¯ç®æ³åºç¨",normalizedTitle:"éå¯¹ç§°å å¯ç®æ³åºç¨",charIndex:22105},{level:2,title:"æ¯è¯­",slug:"æ¯è¯­",normalizedTitle:"æ¯è¯­",charIndex:29740},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:30022}],headersStr:"Base64 ç¼ç  Base64 åç Base64 åºç¨ æ¶æ¯æè¦ æ¶æ¯æè¦æ¦è¿° æ¶æ¯æè¦ç¹ç¹ æ¶æ¯æè¦å¸¸ç¨ç®æ³ æ¶æ¯æè¦åºç¨ MD5ãSHA çèä¾ HMAC çèä¾ æ°å­ç­¾å æ°å­ç­¾åæ¦è¿° æ°å­ç­¾åç®æ³åºç¨ DSA çèä¾ å¯¹ç§°å å¯ å¯¹ç§°å å¯æ¦è¿° å¯¹ç§°å å¯åç å¯¹ç§°å å¯å·¥ä½æ¨¡å¼ å¯¹ç§°å å¯å¡«åæ¹æ³ å¯¹ç§°å å¯åºç¨ åºäºå¯é¥å å¯çæµç¨ï¼DESãDESedeãAES å IDEAï¼ åºäºå£ä»¤å å¯çæµç¨ï¼PBEï¼ éå¯¹ç§°å å¯ éå¯¹ç§°å å¯æ¦è¿° éå¯¹ç§°å å¯ç®æ³åºç¨ æ¯è¯­ åèèµæ",content:'# Java ç¼ç åå å¯\n\n> å³é®è¯ï¼Base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãMD5ãSHAãHMACãAESãDESãDESedeãRSA\n\n\n# Base64 ç¼ç \n\n\n# Base64 åç\n\nBase64 åå®¹ä¼ éç¼ç æ¯ä¸ç§ä»¥ä»»æ 8 ä½å­èåºåç»åçæè¿°å½¢å¼ï¼è¿ç§å½¢å¼ä¸æè¢«äººç´æ¥è¯å«ã\n\nBase64 æ¯ä¸ç§å¾å¸¸è§çç¼ç è§èï¼å¶ä½ç¨æ¯å°äºè¿å¶åºåè½¬æ¢ä¸ºäººç±»å¯è¯»ç ASCII å­ç¬¦åºåï¼å¸¸ç¨å¨éç¨éè¿ææ¬åè®®ï¼æ¯å¦ HTTP å SMTPï¼æ¥ä¼ è¾äºè¿å¶æ°æ®çæåµä¸ãBase64 å¹¶ä¸æ¯å å¯è§£å¯ç®æ³ï¼å°½ç®¡æä»¬ææ¶ä¹å¬å°ä½¿ç¨ Base64 æ¥å å¯è§£å¯çè¯´æ³ï¼ä½è¿éæè¯´çå å¯ä¸è§£å¯å®éæ¯æ**ç¼ç ï¼encodeï¼åè§£ç ï¼decodeï¼**çè¿ç¨ï¼å¶åæ¢æ¯éå¸¸ç®åçï¼ä»ä»è½å¤é¿åä¿¡æ¯è¢«ç´æ¥è¯å«ã\n\nBase64 ç®æ³ä¸»è¦æ¯å°ç»å®çå­ç¬¦ä»¥å­ç¬¦ç¼ç (å¦ ASCII ç ï¼UTF-8 ç )å¯¹åºçåè¿å¶æ°ä¸ºåºåï¼åç¼ç æä½ï¼\n\n 1. å°ç»å®çå­ç¬¦ä¸²ä»¥å­ç¬¦ä¸ºåä½ï¼è½¬æ¢ä¸ºå¯¹åºçå­ç¬¦ç¼ç ã\n 2. å°è·å¾å­ç¬¦ç¼ç è½¬æ¢ä¸ºäºè¿å¶\n 3. å¯¹äºè¿å¶ç ååç»è½¬æ¢ï¼æ¯ 3 ä¸ªå­èä¸ºä¸ç»ï¼è½¬æ¢ä¸ºæ¯ 4 ä¸ª 6 ä½äºè¿å¶ä½ä¸ç»ï¼ä¸è¶³ 6 ä½æ¶ä½ä½è¡¥ 0ï¼ãè¿æ¯ä¸ä¸ªåç»ååçè¿ç¨ï¼3 ä¸ª 8 ä½äºè¿å¶ç å 4 ä¸ª 6 ä½äºè¿å¶ç çé¿åº¦é½æ¯ 24 ä½ï¼38 = 46 = 24ï¼ã\n 4. å¯¹è·å¾ç 4-6 äºè¿å¶ç è¡¥ä½ï¼å 6 ä½äºè¿å¶ç æ·»å  2 ä½é«ä½ 0ï¼ç»æ 4 ä¸ª 8 ä½äºè¿å¶ç ã\n 5. å¯¹è·å¾ç 4-8 äºè¿å¶ç è½¬æ¢ä¸ºåè¿å¶ç ã\n 6. å°è·å¾çåè¿å¶ç è½¬æ¢ä¸º Base64 å­ç¬¦è¡¨ä¸­å¯¹åºçå­ç¬¦ã\n\nBase64 ç¼ç è¡¨\n\nç´¢å¼   å¯¹åºå­ç¬¦   ç´¢å¼   å¯¹åºå­ç¬¦   ç´¢å¼   å¯¹åºå­ç¬¦   ç´¢å¼   å¯¹åºå­ç¬¦\n0    A      17   R      34   i      51   z\n1    B      18   S      35   j      52   0\n2    C      19   T      36   k      53   1\n3    D      20   U      37   l      54   2\n4    E      21   V      38   m      55   3\n5    F      22   W      39   n      56   4\n6    G      23   X      40   o      57   5\n7    H      24   Y      41   p      58   6\n8    I      25   Z      42   q      59   7\n9    J      26   a      43   r      60   8\n10   K      27   b      44   s      61   9\n11   L      28   c      45   t      62   +\n12   M      29   d      46   u      63   /\n13   N      30   e      47   v           \n14   O      31   f      48   w           \n15   P      32   g      49   x           \n16   Q      33   h      50   y           \n\n\n# Base64 åºç¨\n\nBase64 ç¼ç å¯ç¨äºå¨ HTTP ç¯å¢ä¸ä¼ éè¾é¿çæ è¯ä¿¡æ¯ãå¨å¶ä»åºç¨ç¨åºä¸­ï¼ä¹å¸¸å¸¸éè¦æäºè¿å¶æ°æ®ç¼ç ä¸ºéåæ¾å¨ URL(åæ¬éèè¡¨åå)ä¸­çå½¢å¼ãæ­¤æ¶ï¼éç¨ Base64 ç¼ç å·æä¸å¯è¯»æ§ï¼å³æç¼ç çæ°æ®ä¸ä¼è¢«äººç¨èç¼æç´æ¥çå°ï¼ç®æ¯èµ·å°ä¸ä¸ªå å¯çä½ç¨ã\n\nç¶èï¼æ åç Base64 å¹¶ä¸éåç´æ¥æ¾å¨ URL éä¼ è¾ï¼å ä¸º URL ç¼ç å¨ä¼ææ å Base64 ä¸­ç / å + å­ç¬¦åä¸ºå½¢å¦ %XX çå½¢å¼ï¼èè¿äº % å·å¨å­å¥æ°æ®åºæ¶è¿éè¦åè¿è¡è½¬æ¢ï¼å ä¸º ANSI SQL ä¸­å·²å° % å·ç¨ä½ééç¬¦ã\n\nä¸ºè§£å³æ­¤é®é¢ï¼å¯éç¨ä¸ç§ç¨äº URL çæ¹è¿ Base64 ç¼ç ï¼å®ä¸ä»å¨æ«å°¾å¡«å = å·ï¼å¹¶å°æ å Base64 ä¸­çâ+âåâ/âåå«æ¹æäº - å _ï¼è¿æ ·å°±åå»äºå¨ URL ç¼è§£ç åæ°æ®åºå­å¨æ¶æè¦ä½çè½¬æ¢ï¼é¿åäºç¼ç ä¿¡æ¯é¿åº¦å¨æ­¤è¿ç¨ä¸­çå¢å ï¼å¹¶ç»ä¸äºæ°æ®åºãè¡¨åç­å¤å¯¹è±¡æ è¯ç¬¦çæ ¼å¼ã\n\nå¦æä¸ç§ç¨äºæ­£åè¡¨è¾¾å¼çæ¹è¿ Base64 åç§ï¼å®å° + å / æ¹æäº ! å -ï¼å ä¸º +, * ä»¥ååé¢å¨ IRCu ä¸­ç¨å°ç [ å ] å¨æ­£åè¡¨è¾¾å¼ä¸­é½å¯è½å·æç¹æ®å«ä¹ã\n\nãç¤ºä¾ãjava.util.Base64 ç¼ç ãè§£ç ç¤ºä¾\n\nBase64.getEncoder() å Base64.getDecoder() æä¾äºçæ¯æ åç Base64 ç¼ç ãè§£ç æ¹å¼ï¼\n\nBase64.getUrlEncoder() å Base64.getUrlDecoder() æä¾äº URL å®å¨ç Base64 ç¼ç ãè§£ç æ¹å¼ï¼å° + å / æ¿æ¢ä¸º - å _ï¼ã\n\nimport java.nio.charset.StandardCharsets;\nimport java.util.Base64;\n\npublic class Base64Demo {\n\n    public static void main(String[] args) {\n        String url = "https://www.baidu.com";\n        System.out.println("url:" + url);\n        // æ åç Base64 ç¼ç ãè§£ç \n        byte[] encoded = Base64.getEncoder().encode(url.getBytes(StandardCharsets.UTF_8));\n        byte[] decoded = Base64.getDecoder().decode(encoded);\n        System.out.println("Url Safe Base64 encoded:" + new String(encoded));\n        System.out.println("Url Safe Base64 decoded:" + new String(decoded));\n        // URL å®å¨ç Base64 ç¼ç ãè§£ç \n        byte[] encoded2 = Base64.getUrlEncoder().encode(url.getBytes(StandardCharsets.UTF_8));\n        byte[] decoded2 = Base64.getUrlDecoder().decode(encoded2);\n        System.out.println("Base64 encoded:" + new String(encoded2));\n        System.out.println("Base64 decoded:" + new String(decoded2));\n    }\n\n}\n\n\nè¾åºï¼\n\nurl:https://www.baidu.com\nUrl Safe Base64 encoded:aHR0cHM6Ly93d3cuYmFpZHUuY29t\nUrl Safe Base64 decoded:https://www.baidu.com\nBase64 encoded:aHR0cHM6Ly93d3cuYmFpZHUuY29t\nBase64 decoded:https://www.baidu.com\n\n\n\n# æ¶æ¯æè¦\n\n\n# æ¶æ¯æè¦æ¦è¿°\n\næ¶æ¯æè¦ï¼å¶å®å°±æ¯å°éè¦æè¦çæ°æ®ä½ä¸ºåæ°ï¼ç»è¿åå¸å½æ°(Hash)çè®¡ç®ï¼å¾å°çæ£åå¼ã\n\næ¶æ¯æè¦æ¯ä¸ä¸ªå¯ä¸å¯¹åºä¸ä¸ªæ¶æ¯æææ¬çåºå®é¿åº¦çå¼ï¼å®ç±ä¸ä¸ªåå Hash å å¯å½æ°å¯¹æ¶æ¯è¿è¡ä½ç¨èäº§çãå¦ææ¶æ¯å¨éä¸­æ¹åäºï¼åæ¥æ¶èéè¿å¯¹æ¶å°æ¶æ¯çæ°äº§ççæè¦ä¸åæè¦æ¯è¾ï¼å°±å¯ç¥éæ¶æ¯æ¯å¦è¢«æ¹åäºãå æ­¤æ¶æ¯æè¦ä¿è¯äºæ¶æ¯çå®æ´æ§ãæ¶æ¯æè¦éç¨åå Hash å½æ°å°éå å¯çææ"æè¦"æä¸ä¸²å¯æï¼è¿ä¸ä¸²å¯æäº¦ç§°ä¸ºæ°å­æçº¹(Finger Print)ãå®æåºå®çé¿åº¦ï¼ä¸ä¸åçæææè¦æå¯æï¼å¶ç»ææ»æ¯ä¸åçï¼èåæ ·çææå¶æè¦å¿å®ä¸è´ãè¿æ ·è¿ä¸²æè¦ä¾¿å¯æä¸ºéªè¯æææ¯å¦æ¯"çèº«"ç"æçº¹"äºã\n\n\n# æ¶æ¯æè¦ç¹ç¹\n\n * å¯ä¸æ§ï¼æ°æ®åªè¦æä¸ç¹æ¹åï¼é£ä¹åéè¿æ¶æ¯æè¦ç®æ³å¾å°çæè¦ä¹ä¼åçååãè½ç¶çè®ºä¸æå¯è½ä¼åçç¢°æï¼ä½æ¯æ¦çæå¶ä½ã\n * ä¸å¯éï¼æ¶æ¯æè¦ç®æ³çå¯ææ æ³è¢«è§£å¯ã\n * ä¸éè¦å¯é¥ï¼å¯ä½¿ç¨äºåå¸å¼ç½ç»ã\n * æ è®ºè¾å¥çæææå¤é¿ï¼è®¡ç®åºæ¥çæ¶æ¯æè¦çé¿åº¦æ»æ¯åºå®çã\n\n\n# æ¶æ¯æè¦å¸¸ç¨ç®æ³\n\næ¶æ¯æè¦ç®æ³åæ¬MD(Message Digestï¼æ¶æ¯æè¦ç®æ³)ãSHA(Secure Hash Algorithmï¼å®å¨æ£åç®æ³)ã**MAC(Message AuthenticationCodeï¼æ¶æ¯è®¤è¯ç ç®æ³)**å± 3 å¤§ç³»åï¼å¸¸ç¨äºéªè¯æ°æ®çå®æ´æ§ï¼æ¯æ°å­ç­¾åç®æ³çæ ¸å¿ç®æ³ã\n\nMD5åSHA1åå«æ¯MDãSHAç®æ³ç³»åä¸­ææä»£è¡¨æ§çç®æ³ã\n\nå¦ä»ï¼MD5 å·²è¢«åç°æè®¸å¤æ¼æ´ï¼ä»èä¸åå®å¨ãSHA ç®æ³æ¯ MD ç®æ³çæè¦é¿åº¦æ´é¿ï¼ä¹æ´å å®å¨ã\n\n\n# æ¶æ¯æè¦åºç¨\n\n# MD5ãSHA çèä¾\n\nJDK ä¸­ä½¿ç¨ MD5 å SHA è¿ä¸¤ç§æ¶æ¯æè¦çæ¹å¼åºæ¬ä¸è´ï¼æ­¥éª¤å¦ä¸ï¼\n\n 1. åå§å MessageDigest å¯¹è±¡\n 2. æ´æ°è¦è®¡ç®çåå®¹\n 3. çææè¦\n\nimport java.security.MessageDigest;\nimport java.util.Base64;\n\npublic class MessageDigestDemo {\n\n    public static byte[] encode(byte[] input, Type type) throws Exception {\n        // æ ¹æ®ç±»åï¼åå§åæ¶æ¯æè¦å¯¹è±¡\n        MessageDigest md5Digest = MessageDigest.getInstance(type.getName());\n\n        // æ´æ°è¦è®¡ç®çåå®¹\n        md5Digest.update(input);\n\n        // å®æåå¸è®¡ç®ï¼è¿åæè¦\n        return md5Digest.digest();\n    }\n\n    public static byte[] encodeWithBase64(byte[] input, Type type) throws Exception {\n        return Base64.getUrlEncoder().encode(encode(input, type));\n    }\n\n    public static String encodeWithBase64String(byte[] input, Type type) throws Exception {\n        return Base64.getUrlEncoder().encodeToString(encode(input, type));\n    }\n\n    public enum Type {\n        MD2("MD2"),\n        MD5("MD5"),\n        SHA1("SHA1"),\n        SHA256("SHA-256"),\n        SHA384("SHA-384"),\n        SHA512("SHA-512");\n\n        private String name;\n\n        Type(String name) {\n            this.name = name;\n        }\n\n        public String getName() {\n            return this.name;\n        }\n    }\n\n    public static void main(String[] args) throws Exception {\n        String msg = "Hello World!";\n        System.out.println("MD2: " + encodeWithBase64String(msg.getBytes(), Type.MD2));\n        System.out.println("MD5: " + encodeWithBase64String(msg.getBytes(), Type.MD5));\n        System.out.println("SHA1: " + encodeWithBase64String(msg.getBytes(), Type.SHA1));\n        System.out.println("SHA256: " + encodeWithBase64String(msg.getBytes(), Type.SHA256));\n        System.out.println("SHA384: " + encodeWithBase64String(msg.getBytes(), Type.SHA384));\n        System.out.println("SHA512: " + encodeWithBase64String(msg.getBytes(), Type.SHA512));\n    }\n\n}\n\n\nãè¾åºã\n\nMD2: MV98ZyI_Aft8q0uVEA6HLg==\nMD5: 7Qdih1MuhjZehB6Sv8UNjA==\nSHA1: Lve95gjOVATpfV8EL5X4nxwjKHE=\nSHA256: f4OxZX_x_FO5LcGBSKHWXfwtSx-j1ncoSt3SABJtkGk=\nSHA384: v9dsDrvQBv7lg0EFR8GIewKSvnbVgtlsJC0qeScj4_1v0GH51c_RO4-WE1jmrbpK\nSHA512: hhhE1nBOhXP-w02WfiC8_vPUJM9IvgTm3AjyvVjHKXQzcQFerYkcw88cnTS0kmS1EHUbH_nlN5N7xGtdb_TsyA==\n\n\n# HMAC çèä¾\n\n\nimport java.nio.charset.StandardCharsets;\nimport java.util.Base64;\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\n\npublic class HmacMessageDigest {\n\n    public static void main(String[] args) throws Exception {\n        String msg = "Hello World!";\n        byte[] salt = "My Salt".getBytes(StandardCharsets.UTF_8);\n        System.out.println("åæ: " + msg);\n        System.out.println("HmacMD5: " + encodeWithBase64String(msg.getBytes(), salt, HmacTypeEn.HmacMD5));\n        System.out.println("HmacSHA1: " + encodeWithBase64String(msg.getBytes(), salt, HmacTypeEn.HmacSHA1));\n        System.out.println("HmacSHA256: " + encodeWithBase64String(msg.getBytes(), salt, HmacTypeEn.HmacSHA256));\n        System.out.println("HmacSHA384: " + encodeWithBase64String(msg.getBytes(), salt, HmacTypeEn.HmacSHA384));\n        System.out.println("HmacSHA512: " + encodeWithBase64String(msg.getBytes(), salt, HmacTypeEn.HmacSHA512));\n    }\n\n    public static byte[] encode(byte[] plaintext, byte[] salt, HmacTypeEn type) throws Exception {\n        SecretKeySpec keySpec = new SecretKeySpec(salt, type.name());\n        Mac mac = Mac.getInstance(keySpec.getAlgorithm());\n        mac.init(keySpec);\n        return mac.doFinal(plaintext);\n    }\n\n    public static byte[] encodeWithBase64(byte[] plaintext, byte[] salt, HmacTypeEn type) throws Exception {\n        return Base64.getUrlEncoder().encode(encode(plaintext, salt, type));\n    }\n\n    public static String encodeWithBase64String(byte[] plaintext, byte[] salt, HmacTypeEn type) throws Exception {\n        return Base64.getUrlEncoder().encodeToString(encode(plaintext, salt, type));\n    }\n\n    /**\n     * JDKæ¯æ HmacMD5, HmacSHA1, HmacSHA256, HmacSHA384, HmacSHA512\n     */\n    public enum HmacTypeEn {\n\n        HmacMD5, HmacSHA1, HmacSHA256, HmacSHA384, HmacSHA512;\n    }\n\n}\n\n\nè¾åº\n\nåæ: Hello World!\nHmacMD5: re6BLRsB1Q26SfJTwXZUSQ==\nHmacSHA1: CFu8a9H6CbY9C5fo0OmJ2bnuILM=\nHmacSHA256: Z1czUqDWWfYYl7qEDJ2sUH6iieHVI7o83dXMl0JYER0=\nHmacSHA384: 34mKtRQBOYnwwznmQubjrDk_MsLDGqM2PmgcplZUpLsKNrG_cwfz4bLPJCbBW88b\nHmacSHA512: 6n77htTZ_atc04-SsmxhSK3wzh1sAmdudCl0Cb_RZp4DpienG4LZkhXMbq8lcK7XSnz6my_wIpnStDp6PC_-5w==\n\n\n\n# æ°å­ç­¾å\n\n\n# æ°å­ç­¾åæ¦è¿°\n\næ°å­ç­¾åç®æ³å¯ä»¥çåæ¯ä¸ç§å¸¦æå¯é¥çæ¶æ¯æè¦ç®æ³ï¼å¹¶ä¸è¿ç§å¯é¥åå«äºå¬é¥åç§é¥ãä¹å°±æ¯è¯´ï¼æ°å­ç­¾åç®æ³æ¯éå¯¹ç§°å å¯ç®æ³åæ¶æ¯æè¦ç®æ³çç»åä½ã\n\næ°å­ç­¾åç®æ³è¦æ±è½å¤éªè¯æ°æ®å®æ´æ§ãè®¤è¯æ°æ®æ¥æºï¼å¹¶èµ·å°æå¦è®¤çä½ç¨ã\n\næ°å­ç­¾åç®æ³åå«ç­¾ååéªè¯ä¸¤é¡¹æä½ï¼éµå¾ªç§é¥ç­¾åï¼å¬é¥éªè¯çæ¹å¼ã\n\nç­¾åæ¶è¦ä½¿ç¨ç§é¥åå¾ç­¾åæ°æ®ï¼éªè¯æ¶åéè¦å¬é¥ãç­¾åå¼åå¾ç­¾åæ°æ®ï¼å¶æ ¸å¿ç®æ³ä¸»è¦æ¯æ¶æ¯æè¦ç®æ³ã\n\n\n\næ°å­ç­¾åå¸¸ç¨ç®æ³ï¼RSAãDSAãECDSA\n\n\n# æ°å­ç­¾åç®æ³åºç¨\n\n# DSA çèä¾\n\næ°å­ç­¾åæä¸¤ä¸ªæµç¨ï¼ç­¾ååéªè¯ã\n\nå®ä»¬çåæé½æ¯è¦æä¸ä¸ªå¬é¥ãå¯é¥å¯¹ã\n\næ°å­ç­¾åç¨ç§é¥ä¸ºæ¶æ¯è®¡ç®ç­¾åã\n\nãç¤ºä¾ãç¨å¬é¥éªè¯æè¦\n\npublic class DsaCoder {\n\n    public static final String KEY_ALGORITHM = "DSA";\n\n    public static final String SIGN_ALGORITHM = "SHA1withDSA";\n\n    /**\n     * DSAå¯é¥é¿åº¦é»è®¤1024ä½ã å¯é¥é¿åº¦å¿é¡»æ¯64çæ´æ°åï¼èå´å¨512~1024ä¹é´\n     */\n    private static final int KEY_SIZE = 1024;\n\n    private KeyPair keyPair;\n\n    public DsaCoder() throws Exception {\n        this.keyPair = initKey();\n    }\n\n    private KeyPair initKey() throws Exception {\n        // åå§åå¯é¥å¯¹çæå¨\n        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(DsaCoder.KEY_ALGORITHM);\n        // å®ä¾åå¯é¥å¯¹çæå¨\n        keyPairGen.initialize(KEY_SIZE);\n        // å®ä¾åå¯é¥å¯¹\n        return keyPairGen.genKeyPair();\n    }\n\n    public byte[] signature(byte[] data, byte[] privateKey) throws Exception {\n        PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(privateKey);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PrivateKey key = keyFactory.generatePrivate(keySpec);\n\n        Signature signature = Signature.getInstance(SIGN_ALGORITHM);\n        signature.initSign(key);\n        signature.update(data);\n        return signature.sign();\n    }\n\n    public byte[] getPrivateKey() {\n        return keyPair.getPrivate().getEncoded();\n    }\n\n    public boolean verify(byte[] data, byte[] publicKey, byte[] sign) throws Exception {\n        X509EncodedKeySpec keySpec = new X509EncodedKeySpec(publicKey);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PublicKey key = keyFactory.generatePublic(keySpec);\n\n        Signature signature = Signature.getInstance(SIGN_ALGORITHM);\n        signature.initVerify(key);\n        signature.update(data);\n        return signature.verify(sign);\n    }\n\n    public byte[] getPublicKey() {\n        return keyPair.getPublic().getEncoded();\n    }\n\n    public static void main(String[] args) throws Exception {\n        String msg = "Hello World";\n        DsaCoder dsa = new DsaCoder();\n        byte[] sign = dsa.signature(msg.getBytes(), dsa.getPrivateKey());\n        boolean flag = dsa.verify(msg.getBytes(), dsa.getPublicKey(), sign);\n        String result = flag ? "æ°å­ç­¾åå¹é" : "æ°å­ç­¾åä¸å¹é";\n        System.out.println("æ°å­ç­¾åï¼" + Base64.getUrlEncoder().encodeToString(sign));\n        System.out.println("éªè¯ç»æï¼" + result);\n    }\n\n}\n\n\nãè¾åºã\n\næ°å­ç­¾åï¼MCwCFDPUO_VrONl5ST0AWary-MLXJuSCAhRMeMnUVhpizfa2H2M37tne0pUtoA==\néªè¯ç»æï¼æ°å­ç­¾åå¹é\n\n\n\n# å¯¹ç§°å å¯\n\n\n# å¯¹ç§°å å¯æ¦è¿°\n\nå¯¹ç§°å å¯ç®æ³ä¸»è¦æ DESã3DESï¼TripleDESï¼ãAESãIDEAãRC2ãRC4ãRC5 å Blowfish ç­ã\n\nå¯¹ç§°å å¯ç®æ³æ¯åºç¨è¾æ©çå å¯ç®æ³ï¼ææ¯æçãå¨å¯¹ç§°å å¯ç®æ³ä¸­ï¼æ°æ®åä¿¡æ¹å°ææï¼åå§æ°æ®ï¼åå å¯å¯é¥ï¼mi yaoï¼ä¸èµ·ç»è¿ç¹æ®å å¯ç®æ³å¤çåï¼ä½¿å¶åæå¤æçå å¯å¯æåéåºå»ãæ¶ä¿¡æ¹æ¶å°å¯æåï¼è¥æ³è§£è¯»åæï¼åéè¦ä½¿ç¨å å¯ç¨è¿çå¯é¥åç¸åç®æ³çéç®æ³å¯¹å¯æè¿è¡è§£å¯ï¼æè½ä½¿å¶æ¢å¤æå¯è¯»ææãå¨å¯¹ç§°å å¯ç®æ³ä¸­ï¼ä½¿ç¨çå¯é¥åªæä¸ä¸ªï¼åæ¶ä¿¡åæ¹é½ä½¿ç¨è¿ä¸ªå¯é¥å¯¹æ°æ®è¿è¡å å¯åè§£å¯ï¼è¿å°±è¦æ±è§£å¯æ¹äºåå¿é¡»ç¥éå å¯å¯é¥ã\n\nå¯¹ç§°å å¯ç¹ç¹ï¼\n\n * ä¼ç¹ï¼è®¡ç®éå°ãå å¯éåº¦å¿«ãå å¯æçé«ã\n * ç¼ºç¹ï¼ç®æ³æ¯å¬å¼çï¼å®å¨æ§å¾ä¸å°ä¿è¯ã\n\néä¿¡åæ¹æ¯æ¬¡ä½¿ç¨å¯¹ç§°å å¯ç®æ³æ¶ï¼é½éè¦ä½¿ç¨å¶ä»äººä¸ç¥éçæä¸å¯é¥ï¼è¿ä¼ä½¿å¾éä¿¡åæ¹ææ¥æçå¯é¥æ°éåå ä½çº§æ°å¢é¿ï¼å¯é¥ç®¡çæä¸ºç¨æ·çè´æãå¯¹ç§°å å¯ç®æ³å¨åå¸å¼ç½ç»ç³»ç»ä¸ä½¿ç¨è¾ä¸ºå°é¾ï¼ä¸»è¦æ¯å ä¸ºå¯é¥ç®¡çå°é¾ï¼ä½¿ç¨ææ¬è¾é«ã\n\nèä¸å¬é¥ãå¯é¥å å¯ç®æ³æ¯èµ·æ¥ï¼å¯¹ç§°å å¯ç®æ³è½å¤æä¾å å¯åè®¤è¯å´ç¼ºä¹äºç­¾ååè½ï¼ä½¿å¾ä½¿ç¨èå´ææç¼©å°ã\n\n# å¯¹ç§°å å¯åç\n\nå¯¹ç§°å å¯è¦æ±å å¯ä¸è§£å¯ä½¿ç¨åä¸ä¸ªå¯é¥ï¼è§£å¯æ¯å å¯çéè¿ç®ãç±äºå å¯ãè§£å¯ä½¿ç¨åä¸ä¸ªå¯é¥ï¼è¿è¦æ±éä¿¡åæ¹å¿é¡»å¨éä¿¡ååå®è¯¥å¯é¥ï¼å¹¶å¦¥åä¿å­è¯¥å¯é¥ã\n\nå¯¹ç§°å å¯ä½å¶åä¸ºä¸¤ç§ï¼\n\nä¸ç§æ¯å¯¹ææçåä¸ªä½ï¼æå­èï¼è¿è¡è¿ç®ï¼ç§°ä¸ºæµå¯ç ï¼ä¹ç§°ä¸ºåºåå¯ç ï¼\n\nä¸ç§æ¯æææä¿¡æ¯ååä¸ºä¸åçç»ï¼æåï¼ç»æï¼åå«å¯¹æ¯ä¸ªç»ï¼æåï¼è¿è¡å å¯ãè§£å¯ï¼ç§°ä¸ºåç»å¯ç ã\n\n\n\nåè®¾ç²ä¹æ¹ä½ä¸ºéä¿¡åæ¹ãåå®ç²ä¹åæ¹å¨æ¶æ¯ä¼ éåå·²åå®å å¯ç®æ³ï¼æ¬²å®æä¸æ¬¡æ¶æ¯ä¼ ééè¦ç»è¿å¦ä¸æ­¥éª¤ã\n\n\n\n# å¯¹ç§°å å¯å·¥ä½æ¨¡å¼\n\nä»¥ DES ç®æ³çå·¥ä½æ¨¡å¼ä¸ºä¾ï¼DES ç®æ³æ ¹æ®å¶å å¯ç®æ³æå®ä¹çææåç»çå¤§å°ï¼56 ä½ï¼ï¼å°æ°æ®åå²æè¥å¹² 56 ä½çå å¯åºåï¼åä»¥å å¯åºåä¸ºåä½ï¼åå«è¿è¡å å¯å¤çãå¦ææåå©ä¸ä¸è¶³ä¸ä¸ªåºåçå¤§å°ï¼ç§°ä¹ä¸ºç­åãç­åçå¤çæ¹æ³æå¡«åæ³ãæµå¯ç å å¯æ³ãå¯ææªç¨ææ¯ã\n\næ ¹æ®æ°æ®å å¯æ¶æ¯ä¸ªå å¯åºåè§å¾å³èæ¹å¼æ¥åºåï¼å¯ä»¥åä¸ºä»¥ä¸ç§å·¥ä½æ¨¡å¼ï¼\n\n(1) çµå­å¯ç æ¬æ¨¡å¼(Electronic Code Book, ECB)\n\nç¨éï¼éåå å¯å¯é¥ï¼éæºæ°ç­ç­æ°æ®ãä¾å¦ï¼å®å¨å°ä¼ é DES å¯é¥ï¼ECB æ¯æåéçæ¨¡å¼ã\n\n(2) å¯æé¾æ¥æ¨¡å¼(Cipher Booki Chaining, CBC)\n\nç¨éï¼å¯å å¯ä»»æé¿åº¦çæ°æ®ï¼éç¨äºè®¡ç®äº§çæ£æµæ°æ®å®æ´æ§çæ¶æ¯è®¤è¯ MACã\n\n(3) å¯æåé¦æ¨¡å¼(Cipher Feed Back, CFB)\n\nç¨éï¼å éè¯¯ä¼ æ­æ çï¼å¯ä»¥ç¨äºæ£æ¥åç°ææå¯æçç¯¡æ¹ã\n\n(4) è¾åºåé¦æ¨¡å¼(Output Feed Back, OFB)\n\nç¨éï¼ä½¿ç¨äºå å¯åä½æ§è¾å¤§çæ°æ®ï¼æ¯å¦è¯­é³åå¾åæ°æ®ã\n\nAES ç®æ³é¤äºä»¥ä¸ 4 ä¸­æ¨¡å¼å¤ï¼è¿æä¸ç§æ°çå·¥ä½æ¨¡å¼ï¼\n\n(5) è®¡æ°å¨æ¨¡å¼(Counter, CTR)\n\nç¨éï¼éç¨äºåç§å å¯åºç¨ã\n\næ¬æå¯¹äºåç§å·¥ä½æ¨¡å¼çåçå±å¼æè¿°ãä¸ªäººè®¤ä¸ºï¼ä½ä¸ºå·¥ç¨åºç¨ï¼äºè§£å¶ç¨éå³å¯ã\n\n# å¯¹ç§°å å¯å¡«åæ¹æ³\n\nJava ä¸­å¯¹ç§°å å¯å¯¹äºç­åçå¤çï¼ä¸è¬æ¯éç¨å¡«åæ¹å¼ã\n\nå¸¸éç¨çæ¯ï¼NoPaddingï¼ä¸å¡«åï¼ãZeros å¡«åï¼0 å¡«åï¼ãPKCS5Padding å¡«åã\n\nZerosPadding\n\næ¹å¼ï¼å¨é¨å¡«åä¸º 0 çå­è\n\nç»æå¦ä¸ï¼\n\nF1 F2 F3 F4 F5 F6 F7 F8 //ç¬¬ä¸å\n\nF9 00 00 00 00 00 00 00 //ç¬¬äºå\n\nPKCS5Padding\n\næ¹å¼ï¼æ¯ä¸ªå¡«åçå­èé½è®°å½äºå¡«åçæ»å­èæ°\n\nç»æå¦ä¸ï¼\n\nF1 F2 F3 F4 F5 F6 F7 F8 //ç¬¬ä¸å\n\nF9 07 07 07 07 07 07 07 //ç¬¬äºå\n\n\n# å¯¹ç§°å å¯åºç¨\n\n# åºäºå¯é¥å å¯çæµç¨ï¼DESãDESedeãAES å IDEAï¼\n\nDESãDESedeãAES å IDEA ç­ç®æ³é½æ¯åºäºå¯é¥å å¯çå¯¹ç§°å å¯ç®æ³ï¼å®ä»¬çå®ç°æµç¨ä¹åºæ¬ä¸è´ãæ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼çæå¯é¥\n\nKeyGenerator kg = KeyGenerator.getInstance("DES");\nSecureRandom random = new SecureRandom();\nkg.init(random);\nSecretKey secretKey = kg.generateKey();\n\n\nå»ºè®®ä½¿ç¨éæºæ°æ¥åå§åå¯é¥ççæã\n\nï¼2ï¼åå§åå¯ç å¯¹è±¡\n\nCipher cipher = Cipher.getInstance("DES/ECB/PKCS5Padding");\ncipher.init(Cipher.ENCRYPT_MODE, secretKey);\n\n\nENCRYPT_MODEï¼å å¯æ¨¡å¼\n\nDECRYPT_MODEï¼è§£å¯æ¨¡å¼\n\nï¼3ï¼æ§è¡\n\nString plaintext = "Hello World";\nbyte[] ciphertext = cipher.doFinal(plaintext.getBytes());\n\n\nä¸ä¸ªå®æ´ç DES å å¯è§£å¯èä¾\n\nimport java.nio.charset.StandardCharsets;\nimport java.security.*;\nimport java.util.Base64;\nimport javax.crypto.*;\nimport javax.crypto.spec.IvParameterSpec;\n\n/**\n * DESå®å¨ç¼ç ï¼æ¯ç»å¸çå¯¹ç§°å å¯ç®æ³ãå¯é¥ä»56ä½ï¼ä¸è¿­ä»£æ¬¡æ°åå°ãå·²è¢«è§ä¸ºå¹¶ä¸å®å¨çå å¯ç®æ³ã\n *\n * @author Zhang Peng\n * @since 2016å¹´7æ14æ¥\n */\npublic class DESCoder {\n\n    public static final String KEY_ALGORITHM_DES = "DES";\n\n    public static final String CIPHER_DES_DEFAULT = "DES";\n\n    public static final String CIPHER_DES_ECB_PKCS5PADDING = "DES/ECB/PKCS5Padding"; // ç®æ³/æ¨¡å¼/è¡¥ç æ¹å¼\n\n    public static final String CIPHER_DES_CBC_PKCS5PADDING = "DES/CBC/PKCS5Padding";\n\n    public static final String CIPHER_DES_CBC_NOPADDING = "DES/CBC/NoPadding";\n\n    private static final String SEED = "%%%today is nice***"; // ç¨äºçæéæºæ°çç§å­\n\n    private Key key;\n\n    private Cipher cipher;\n\n    private String transformation;\n\n    public DESCoder() throws NoSuchAlgorithmException, NoSuchPaddingException, NoSuchProviderException {\n        this.key = initKey();\n        this.cipher = Cipher.getInstance(CIPHER_DES_DEFAULT);\n        this.transformation = CIPHER_DES_DEFAULT;\n    }\n\n    /**\n     * æ ¹æ®éæºæ°ç§å­çæä¸ä¸ªå¯é¥\n     *\n     * @return Key\n     * @throws NoSuchAlgorithmException\n     * @throws NoSuchProviderException\n     * @author Zhang Peng\n     * @since 2016å¹´7æ14æ¥\n     */\n    private Key initKey() throws NoSuchAlgorithmException, NoSuchProviderException {\n        // æ ¹æ®ç§å­çæä¸ä¸ªå®å¨çéæºæ°\n        SecureRandom secureRandom = null;\n        secureRandom = new SecureRandom(SEED.getBytes());\n\n        KeyGenerator keyGen = KeyGenerator.getInstance(KEY_ALGORITHM_DES);\n        keyGen.init(secureRandom);\n        return keyGen.generateKey();\n    }\n\n    public DESCoder(String transformation)\n        throws NoSuchAlgorithmException, NoSuchPaddingException, NoSuchProviderException {\n        this.key = initKey();\n        this.cipher = Cipher.getInstance(transformation);\n        this.transformation = transformation;\n    }\n\n    /**\n     * å å¯\n     *\n     * @param input ææ\n     * @return byte[] å¯æ\n     * @throws InvalidKeyException\n     * @throws IllegalBlockSizeException\n     * @throws BadPaddingException\n     * @throws InvalidAlgorithmParameterException\n     * @author Zhang Peng\n     * @since 2016å¹´7æ20æ¥\n     */\n    public byte[] encrypt(byte[] input) throws InvalidKeyException, IllegalBlockSizeException, BadPaddingException,\n        InvalidAlgorithmParameterException {\n        if (transformation.equals(CIPHER_DES_CBC_PKCS5PADDING) || transformation.equals(CIPHER_DES_CBC_NOPADDING)) {\n            cipher.init(Cipher.ENCRYPT_MODE, key, new IvParameterSpec(getIV()));\n        } else {\n            cipher.init(Cipher.ENCRYPT_MODE, key);\n        }\n        return cipher.doFinal(input);\n    }\n\n    /**\n     * è§£å¯\n     *\n     * @param input å¯æ\n     * @return byte[] ææ\n     * @throws InvalidKeyException\n     * @throws IllegalBlockSizeException\n     * @throws BadPaddingException\n     * @throws InvalidAlgorithmParameterException\n     * @author Zhang Peng\n     * @since 2016å¹´7æ20æ¥\n     */\n    public byte[] decrypt(byte[] input) throws InvalidKeyException, IllegalBlockSizeException, BadPaddingException,\n        InvalidAlgorithmParameterException {\n        if (transformation.equals(CIPHER_DES_CBC_PKCS5PADDING) || transformation.equals(CIPHER_DES_CBC_NOPADDING)) {\n            cipher.init(Cipher.DECRYPT_MODE, key, new IvParameterSpec(getIV()));\n        } else {\n            cipher.init(Cipher.DECRYPT_MODE, key);\n        }\n        return cipher.doFinal(input);\n    }\n\n    private byte[] getIV() {\n        String iv = "01234567"; // IV length: must be 8 bytes long\n        return iv.getBytes();\n    }\n\n    public static void main(String[] args) throws Exception {\n        DESCoder aes = new DESCoder(CIPHER_DES_CBC_PKCS5PADDING);\n\n        String msg = "Hello World!";\n        System.out.println("åæ: " + msg);\n        byte[] encoded = aes.encrypt(msg.getBytes(StandardCharsets.UTF_8));\n        String encodedBase64 = Base64.getUrlEncoder().encodeToString(encoded);\n        System.out.println("å¯æ: " + encodedBase64);\n\n        byte[] decodedBase64 = Base64.getUrlDecoder().decode(encodedBase64);\n        byte[] decoded = aes.decrypt(decodedBase64);\n        System.out.println("ææ: " + new String(decoded));\n    }\n\n}\n\n\nè¾åº\n\nåæ: Hello World!\nå¯æ: TtnEu9ezNQtxFKpmq_37Qw==\nææ: Hello World!\n\n\n# åºäºå£ä»¤å å¯çæµç¨ï¼PBEï¼\n\nDESãDESedeãAESãIDEA è¿å ç§ç®æ³çåºç¨æ¨¡åå ä¹å¦åºä¸è¾ã\n\nä½æ¯ï¼å¹¶éææå¯¹ç§°å å¯ç®æ³é½æ¯å¦æ­¤ã\n\nåºäºå£ä»¤å å¯(Password Based Encryption, PBE)æ¯ä¸ç§åºäºå£ä»¤å å¯çç®æ³ãå¶ç¹ç¹æ¯ï¼å£ä»¤ç±ç¨æ·èªå·±æç®¡ï¼éç¨éæºæ°ï¼è¿éå«åçï¼æåå¤éå å¯ç­æ¹æ³ä¿è¯æ°æ®çå®å¨æ§ã\n\nPBE æ²¡æå¯é¥æ¦å¿µï¼å¯é¥å¨å¶ä»å¯¹ç§°å å¯ç®æ³ä¸­æ¯ç»è¿è®¡ç®å¾åºçï¼PBE åä½¿ç¨å£ä»¤æ¿ä»£äºå¯é¥ã\n\næµç¨ï¼\n\n\n\næ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼äº§çç\n\nSecureRandom secureRandom = new SecureRandom();\nbyte[] salt = secureRandom.generateSeed(8); // çé¿åº¦å¿é¡»ä¸º8å­è\n\n\nï¼2ï¼æ ¹æ®å¯ç äº§ç Key\n\nString password = "123456";\nPBEKeySpec keySpec = new PBEKeySpec(password.toCharArray());\nSecretKeyFactory keyFactory = SecretKeyFactory.getInstance(KEY_ALGORITHM);\nSecretKey secretKey = keyFactory.generateSecret(keySpec);\n\n\nï¼3ï¼åå§åå å¯æè§£å¯å¯¹è±¡\n\nPBEParameterSpec paramSpec = new PBEParameterSpec(salt, ITERATION_COUNT);\nCipher cipher = Cipher.getInstance(KEY_ALGORITHM);\ncipher.init(Cipher.ENCRYPT_MODE, secretKey, paramSpec);\n\n\nï¼4ï¼æ§è¡\n\nbyte[] plaintext = "Hello World".getBytes();\nbyte[] ciphertext = cipher.doFinal(plaintext);\n\n\nï¼5ï¼å®æ´ PBE ç¤ºä¾\n\nimport java.security.Key;\nimport java.security.SecureRandom;\nimport java.util.Base64;\nimport javax.crypto.Cipher;\nimport javax.crypto.SecretKey;\nimport javax.crypto.SecretKeyFactory;\nimport javax.crypto.spec.PBEKeySpec;\nimport javax.crypto.spec.PBEParameterSpec;\n\n/**\n * åºäºå£ä»¤å å¯(Password Based Encryption, PBE)ï¼æ¯ä¸ç§å¯¹ç§°å å¯ç®æ³ã å¶ç¹ç¹æ¯ï¼å£ä»¤ç±ç¨æ·èªå·±æç®¡ï¼éç¨éæºæ°ï¼è¿éå«åçï¼æåå¤éå å¯ç­æ¹æ³ä¿è¯æ°æ®çå®å¨æ§ã\n * PBEæ²¡æå¯é¥æ¦å¿µï¼å¯é¥å¨å¶ä»å¯¹ç§°å å¯ç®æ³ä¸­æ¯ç»è¿è®¡ç®å¾åºçï¼PBEåä½¿ç¨å£ä»¤æ¿ä»£äºå¯é¥ã\n *\n * @author Zhang Peng\n * @since 2016å¹´7æ20æ¥\n */\npublic class PBECoder {\n\n    public static final String KEY_ALGORITHM = "PBEWITHMD5andDES";\n\n    public static final int ITERATION_COUNT = 100;\n\n    private Key key;\n\n    private byte[] salt;\n\n    public PBECoder(String password) throws Exception {\n        this.salt = initSalt();\n        this.key = initKey(password);\n    }\n\n    private byte[] initSalt() {\n        SecureRandom secureRandom = new SecureRandom();\n        return secureRandom.generateSeed(8); // çé¿åº¦å¿é¡»ä¸º8å­è\n    }\n\n    private Key initKey(String password) throws Exception {\n        PBEKeySpec keySpec = new PBEKeySpec(password.toCharArray());\n        SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(KEY_ALGORITHM);\n        return keyFactory.generateSecret(keySpec);\n    }\n\n    public byte[] encrypt(byte[] plaintext) throws Exception {\n        PBEParameterSpec paramSpec = new PBEParameterSpec(salt, ITERATION_COUNT);\n        Cipher cipher = Cipher.getInstance(KEY_ALGORITHM);\n        cipher.init(Cipher.ENCRYPT_MODE, key, paramSpec);\n        return cipher.doFinal(plaintext);\n    }\n\n    public byte[] decrypt(byte[] ciphertext) throws Exception {\n        PBEParameterSpec paramSpec = new PBEParameterSpec(salt, ITERATION_COUNT);\n        Cipher cipher = Cipher.getInstance(KEY_ALGORITHM);\n        cipher.init(Cipher.DECRYPT_MODE, key, paramSpec);\n        return cipher.doFinal(ciphertext);\n    }\n\n    public static void test1() throws Exception {\n\n        // äº§çç\n        SecureRandom secureRandom = new SecureRandom();\n        byte[] salt = secureRandom.generateSeed(8); // çé¿åº¦å¿é¡»ä¸º8å­è\n\n        // äº§çKey\n        String password = "123456";\n        PBEKeySpec keySpec = new PBEKeySpec(password.toCharArray());\n        SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(KEY_ALGORITHM);\n        SecretKey secretKey = keyFactory.generateSecret(keySpec);\n\n        PBEParameterSpec paramSpec = new PBEParameterSpec(salt, ITERATION_COUNT);\n        Cipher cipher = Cipher.getInstance(KEY_ALGORITHM);\n        cipher.init(Cipher.ENCRYPT_MODE, secretKey, paramSpec);\n\n        byte[] plaintext = "Hello World".getBytes();\n        byte[] ciphertext = cipher.doFinal(plaintext);\n        new String(ciphertext);\n    }\n\n    public static void main(String[] args) throws Exception {\n        PBECoder encode = new PBECoder("123456");\n        String message = "Hello World!";\n        byte[] ciphertext = encode.encrypt(message.getBytes());\n        byte[] plaintext = encode.decrypt(ciphertext);\n\n        System.out.println("åæï¼" + message);\n        System.out.println("å¯æï¼" + Base64.getUrlEncoder().encodeToString(ciphertext));\n        System.out.println("ææï¼" + new String(plaintext));\n    }\n\n}\n\n\n\n# éå¯¹ç§°å å¯\n\n\n# éå¯¹ç§°å å¯æ¦è¿°\n\néå¯¹ç§°å å¯å¸¸ç¨ç®æ³ï¼DH(Diffie-Hellmanï¼å¯é¥äº¤æ¢ç®æ³)ãRSA\n\néå¯¹ç§°å å¯ç®æ³åå¯¹ç§°å å¯ç®æ³çä¸»è¦å·®å«å¨äºéå¯¹ç§°å å¯ç®æ³ç¨äºå å¯åè§£å¯çå¯é¥æ¯ä¸åçãä¸ä¸ªå¬å¼ï¼ç§°ä¸ºå¬é¥ï¼public keyï¼ï¼ä¸ä¸ªä¿å¯ï¼ç§°ä¸ºç§é¥ï¼private keyï¼ãå æ­¤ï¼éå¯¹ç§°å å¯ç®æ³ä¹ç§°ä¸ºåé¥å å¯ç®æ³æå¬é¥å å¯ç®æ³ã\n\néå¯¹ç§°å å¯ç¹ç¹ï¼\n\n * ä¼ç¹ï¼éå¯¹ç§°å å¯ç®æ³è§£å³äºå¯¹ç§°å å¯ç®æ³çå¯é¥åéé®é¢ï¼å¹¶æå¤§å°æé«äºç®æ³å®å¨æ§ã\n * ç¼ºç¹ï¼ç®æ³æ¯å¯¹ç§°ç®æ³æ´å¤æï¼å æ­¤å å¯ãè§£å¯éåº¦é½æ¯å¯¹ç§°ç®æ³æ¢å¾å¤ã\n\n\n\néå¯¹ç§°å å¯ç®æ³å®ç°æºå¯ä¿¡æ¯äº¤æ¢çåºæ¬è¿ç¨æ¯ï¼ç²æ¹çæä¸å¯¹å¯é¥å¹¶å°å¶ä¸­çä¸æä½ä¸ºå¬ç¨å¯é¥åå¶å®æ¹å¬å¼ï¼å¾å°è¯¥å¬ç¨å¯é¥çä¹æ¹ä½¿ç¨è¯¥å¯é¥å¯¹æºå¯ä¿¡æ¯è¿è¡å å¯åååéç»ç²æ¹ï¼ç²æ¹åç¨èªå·±ä¿å­çå¦ä¸æä¸ç¨å¯é¥å¯¹å å¯åçä¿¡æ¯è¿è¡è§£å¯ã\n\nå¦ä¸æ¹é¢ï¼ç²æ¹å¯ä»¥ä½¿ç¨ä¹æ¹çå¬é¥å¯¹æºå¯ä¿¡æ¯è¿è¡ç­¾ååååéç»ä¹æ¹ï¼ä¹æ¹åç¨èªå·±çç§åå¯¹æ°æ®è¿è¡éªè¯ã\n\nç²æ¹åªè½ç¨å¶ç§é¥è§£å¯ï¼ç±å¶å¬é¥å å¯åçä»»ä½ä¿¡æ¯ã éå¯¹ç§°å å¯ç®æ³çä¿å¯æ§æ¯è¾å¥½ï¼å®æ¶é¤äºæç»ç¨æ·äº¤æ¢å¯é¥çéè¦ã\n\n\n# éå¯¹ç§°å å¯ç®æ³åºç¨\n\nimport java.nio.charset.StandardCharsets;\nimport java.security.*;\nimport java.security.spec.PKCS8EncodedKeySpec;\nimport java.security.spec.X509EncodedKeySpec;\nimport java.util.Base64;\nimport javax.crypto.Cipher;\n\n/**\n * RSAå®å¨ç¼ç ï¼éå¯¹ç§°å å¯ç®æ³ãå®æ¢å¯ä»¥ç¨æ¥å å¯ãè§£å¯ï¼ä¹å¯ä»¥ç¨æ¥åæ°å­ç­¾å\n *\n * @author Zhang Peng\n * @since 2016å¹´7æ20æ¥\n */\npublic class RSACoder {\n\n    public final static String KEY_ALGORITHM = "RSA";\n\n    public final static String SIGN_ALGORITHM = "MD5WithRSA";\n\n    private KeyPair keyPair;\n\n    public RSACoder() throws Exception {\n        this.keyPair = initKeyPair();\n    }\n\n    private KeyPair initKeyPair() throws Exception {\n        // KeyPairGeneratorç±»ç¨äºçæå¬é¥åç§é¥å¯¹ï¼åºäºRSAç®æ³çæå¯¹è±¡\n        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(KEY_ALGORITHM);\n        // åå§åå¯é¥å¯¹çæå¨ï¼å¯é¥å¤§å°ä¸º1024ä½\n        keyPairGen.initialize(1024);\n        // çæä¸ä¸ªå¯é¥å¯¹\n        return keyPairGen.genKeyPair();\n    }\n\n    public byte[] encryptByPrivateKey(byte[] plaintext, byte[] key) throws Exception {\n        PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(key);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PrivateKey privateKey = keyFactory.generatePrivate(keySpec);\n        Cipher cipher = Cipher.getInstance(keyFactory.getAlgorithm());\n        cipher.init(Cipher.ENCRYPT_MODE, privateKey);\n        return cipher.doFinal(plaintext);\n    }\n\n    public byte[] decryptByPublicKey(byte[] ciphertext, byte[] key) throws Exception {\n        X509EncodedKeySpec keySpec = new X509EncodedKeySpec(key);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PublicKey publicKey = keyFactory.generatePublic(keySpec);\n        Cipher cipher = Cipher.getInstance(keyFactory.getAlgorithm());\n        cipher.init(Cipher.DECRYPT_MODE, publicKey);\n        return cipher.doFinal(ciphertext);\n    }\n\n    public byte[] encryptByPublicKey(byte[] plaintext, byte[] key) throws Exception {\n        X509EncodedKeySpec keySpec = new X509EncodedKeySpec(key);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PublicKey publicKey = keyFactory.generatePublic(keySpec);\n        Cipher cipher = Cipher.getInstance(keyFactory.getAlgorithm());\n        cipher.init(Cipher.ENCRYPT_MODE, publicKey);\n        return cipher.doFinal(plaintext);\n    }\n\n    public byte[] decryptByPrivateKey(byte[] ciphertext, byte[] key) throws Exception {\n        PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(key);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PrivateKey privateKey = keyFactory.generatePrivate(keySpec);\n        Cipher cipher = Cipher.getInstance(keyFactory.getAlgorithm());\n        cipher.init(Cipher.DECRYPT_MODE, privateKey);\n        return cipher.doFinal(ciphertext);\n    }\n\n    public byte[] signature(byte[] data, byte[] privateKey, RsaSignTypeEn type) throws Exception {\n        PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(privateKey);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PrivateKey key = keyFactory.generatePrivate(keySpec);\n\n        Signature signature = Signature.getInstance(type.name());\n        signature.initSign(key);\n        signature.update(data);\n        return signature.sign();\n    }\n\n    public byte[] getPrivateKey() {\n        return keyPair.getPrivate().getEncoded();\n    }\n\n    public boolean verify(byte[] data, byte[] publicKey, byte[] sign, RsaSignTypeEn type) throws Exception {\n        X509EncodedKeySpec keySpec = new X509EncodedKeySpec(publicKey);\n        KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);\n        PublicKey key = keyFactory.generatePublic(keySpec);\n\n        Signature signature = Signature.getInstance(type.name());\n        signature.initVerify(key);\n        signature.update(data);\n        return signature.verify(sign);\n    }\n\n    public byte[] getPublicKey() {\n        return keyPair.getPublic().getEncoded();\n    }\n\n    public enum RsaSignTypeEn {\n\n        MD2WithRSA,\n        MD5WithRSA,\n        SHA1WithRSA\n    }\n\n    public static void main(String[] args) throws Exception {\n        String msg = "Hello World!";\n        RSACoder coder = new RSACoder();\n        // ç§é¥å å¯ï¼å¬é¥è§£å¯\n        byte[] ciphertext = coder.encryptByPrivateKey(msg.getBytes(StandardCharsets.UTF_8), coder.keyPair.getPrivate().getEncoded());\n        byte[] plaintext = coder.decryptByPublicKey(ciphertext, coder.keyPair.getPublic().getEncoded());\n\n        // å¬é¥å å¯ï¼ç§é¥è§£å¯\n        byte[] ciphertext2 = coder.encryptByPublicKey(msg.getBytes(), coder.keyPair.getPublic().getEncoded());\n        byte[] plaintext2 = coder.decryptByPrivateKey(ciphertext2, coder.keyPair.getPrivate().getEncoded());\n\n        byte[] sign = coder.signature(msg.getBytes(), coder.getPrivateKey(), RsaSignTypeEn.SHA1WithRSA);\n        boolean flag = coder.verify(msg.getBytes(), coder.getPublicKey(), sign, RsaSignTypeEn.SHA1WithRSA);\n        String result = flag ? "æ°å­ç­¾åå¹é" : "æ°å­ç­¾åä¸å¹é";\n\n        System.out.println("åæï¼" + msg);\n        System.out.println("å¬é¥ï¼" + Base64.getUrlEncoder().encodeToString(coder.keyPair.getPublic().getEncoded()));\n        System.out.println("ç§é¥ï¼" + Base64.getUrlEncoder().encodeToString(coder.keyPair.getPrivate().getEncoded()));\n\n        System.out.println("============== ç§é¥å å¯ï¼å¬é¥è§£å¯ ==============");\n        System.out.println("å¯æï¼" + Base64.getUrlEncoder().encodeToString(ciphertext));\n        System.out.println("ææï¼" + new String(plaintext));\n\n        System.out.println("============== å¬é¥å å¯ï¼ç§é¥è§£å¯ ==============");\n        System.out.println("å¯æï¼" + Base64.getUrlEncoder().encodeToString(ciphertext2));\n        System.out.println("ææï¼" + new String(plaintext2));\n\n        System.out.println("============== æ°å­ç­¾å ==============");\n        System.out.println("æ°å­ç­¾åï¼" + Base64.getUrlEncoder().encodeToString(sign));\n        System.out.println("éªè¯ç»æï¼" + result);\n    }\n\n}\n\n\nè¾åº\n\nåæï¼Hello World!\nå¬é¥ï¼MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCzPtRLErTUcYtr8GmIpvbso7FN18thuEq02U21mh7TA4FH4TjvNgOZrZEORYu94dxrPdnrPjh0p62P5pDIjx_dtGlZr0aGWgtTvBbPwAKE4keXyPqv4VV6iXRzyQ2HdOvFOovim5eu0Tu_TxGeNpFfp0pYj2LXCzpsgSrdUPuPmwIDAQAB\nç§é¥ï¼MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALM-1EsStNRxi2vwaYim9uyjsU3Xy2G4SrTZTbWaHtMDgUfhOO82A5mtkQ5Fi73h3Gs92es-OHSnrY_mkMiPH920aVmvRoZaC1O8Fs_AAoTiR5fI-q_hVXqJdHPJDYd068U6i-Kbl67RO79PEZ42kV-nSliPYtcLOmyBKt1Q-4-bAgMBAAECgYBJxOXiL8S0WjajKcKFNxIQuh3Sh6lwgkRcwcI1p0RgW-TtDEg-SuCYctJsKTsl3rq0eDQjmOvrNsc7ngygPidCiTdbD1H6m3tLrebBB-wZdXMSWPsHtQJsq4dE0e93mmfysciOP6QExOs0JqVjTyyBSK37LpUcLdalj2IJDtC0gQJBAPfMngZAuIPmXued7PUuWNBuwxnkmdMcs308eC_9vnLLXWhDB9xKMuXCMwqk16MJ6j1FQWtJu62T21yniWWQHIsCQQC5LWqKfRxVukgnBg0Pa95NVWWY01Yttnb125JsLxeKbR97KU4VgBaBcB9TyUdPr9lxAzGFg6Y3A1wfsfukaGsxAkEA1l719oLXHYSWZdmBvTozK14m-qeBS9lwjc9aSmpB8B1u2Vvj2Pd3wLyYW4Tv5-QT-J2JUr-e1TMseqOVgX-CsQJAETRoBq_zFv_0vjNwuTMTd2nsw5M3GY4vZU5eP1Dsxf63gxDmYVcCQEpzjqxPxNaYxEhArJ_7rHbSc1ts_ux4sQJBAIlbGQC4-92foXGzWT80rsqZlMQ8J8Nbjpoo7RUN9tgx60Vkr3xv26Vos77oqdufWlt5IiBZBS9acTA2suav6Qg=\n============== ç§é¥å å¯ï¼å¬é¥è§£å¯ ==============\nå¯æï¼qn6iGjSJV45EnH21RYRx2UZfMueqplbm1g3VIpBBQBuF63RdHdSgMJsVPAuB__V0rxpPlU3gR6qLyWu1mpaJ-ix_6KogAH64wqTWqPRh7E6aj767rybNpt9JyVlCmmpy9DiqHAUFWtBJDo34q-a7Fhq9c8bWrJ6jnn47IdmzHfU=\nææï¼Hello World!\n============== å¬é¥å å¯ï¼ç§é¥è§£å¯ ==============\nå¯æï¼fsz2IFs69d7JDrH-yoe5pi5WKQU1Zml7SDSpPqTZUn6muSCjNp6x312deQCXKMGSeAdMpVeb01yZBfa0MT_6eYJYVseU7Rd6bDf6YIg3AZFC41yh5ITiTvQ-XzxugnppS12sLpXSWg0faa5qjcVZnoTX9p7nHr8n20y4CNMI6Rw=\nææï¼Hello World!\n============== æ°å­ç­¾å ==============\næ°å­ç­¾åï¼dTtUUlWX1wRQbW1PcA8O6WJcWcrHinEZRXwgLKEwBOm2DpvHnynvV_HYKS-qFE5_4vJQcPGJ2hZqWbfv1VKLHMUWuiXM7VJk70g3g7BF8i8RWbrCDOxgTR77jrEwidpr1PYJzWJVGq_HP36MxInGFLcVh2sN0fu8MppzsXUENZQ=\néªè¯ç»æï¼æ°å­ç­¾åå¹é\n\n\n\n# æ¯è¯­\n\n * ææ(Plaintext)ï¼æå¾å å¯ä¿¡æ¯ãææå¯ä»¥æ¯ææ¬æä»¶ãå¾çæä»¶ãäºè¿å¶æ°æ®ç­ã\n * å¯æ(Ciphertext)ï¼æç»è¿å å¯åçææãå¯æéå¸¸ä»¥ææ¬ãäºè¿å¶ç­å½¢å¼å­å¨ã\n * å å¯(Encryption)ï¼æå°ææè½¬æ¢ä¸ºå¯æçè¿ç¨ã\n * è§£å¯(Decryption)ï¼æå°å¯æè½¬æ¢ä¸ºææçè¿ç¨ã\n * å å¯å¯é¥(Encryption Key)ï¼æéè¿å å¯ç®æ³è¿è¡å å¯æä½ç¨çå¯é¥ã\n * è§£å¯å¯é¥(Decryption Key)ï¼æéè¿è§£å¯ç®æ³è¿è¡è§£å¯æä½ç¨çå¯é¥ã\n * ä¿¡é(Channel)ï¼éä¿¡çééï¼æ¯ä¿¡å·ä¼ è¾çåªä»ã\n\n\n# åèèµæ\n\n * ãJava æ ¸å¿ææ¯ å· II é«çº§ç¹æ§ã\n * ãJava å å¯ä¸è§£å¯çèºæ¯ã',normalizedContent:'# java ç¼ç åå å¯\n\n> å³é®è¯ï¼base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãmd5ãshaãhmacãaesãdesãdesedeãrsa\n\n\n# base64 ç¼ç \n\n\n# base64 åç\n\nbase64 åå®¹ä¼ éç¼ç æ¯ä¸ç§ä»¥ä»»æ 8 ä½å­èåºåç»åçæè¿°å½¢å¼ï¼è¿ç§å½¢å¼ä¸æè¢«äººç´æ¥è¯å«ã\n\nbase64 æ¯ä¸ç§å¾å¸¸è§çç¼ç è§èï¼å¶ä½ç¨æ¯å°äºè¿å¶åºåè½¬æ¢ä¸ºäººç±»å¯è¯»ç ascii å­ç¬¦åºåï¼å¸¸ç¨å¨éç¨éè¿ææ¬åè®®ï¼æ¯å¦ http å smtpï¼æ¥ä¼ è¾äºè¿å¶æ°æ®çæåµä¸ãbase64 å¹¶ä¸æ¯å å¯è§£å¯ç®æ³ï¼å°½ç®¡æä»¬ææ¶ä¹å¬å°ä½¿ç¨ base64 æ¥å å¯è§£å¯çè¯´æ³ï¼ä½è¿éæè¯´çå å¯ä¸è§£å¯å®éæ¯æ**ç¼ç ï¼encodeï¼åè§£ç ï¼decodeï¼**çè¿ç¨ï¼å¶åæ¢æ¯éå¸¸ç®åçï¼ä»ä»è½å¤é¿åä¿¡æ¯è¢«ç´æ¥è¯å«ã\n\nbase64 ç®æ³ä¸»è¦æ¯å°ç»å®çå­ç¬¦ä»¥å­ç¬¦ç¼ç (å¦ ascii ç ï¼utf-8 ç )å¯¹åºçåè¿å¶æ°ä¸ºåºåï¼åç¼ç æä½ï¼\n\n 1. å°ç»å®çå­ç¬¦ä¸²ä»¥å­ç¬¦ä¸ºåä½ï¼è½¬æ¢ä¸ºå¯¹åºçå­ç¬¦ç¼ç ã\n 2. å°è·å¾å­ç¬¦ç¼ç è½¬æ¢ä¸ºäºè¿å¶\n 3. å¯¹äºè¿å¶ç ååç»è½¬æ¢ï¼æ¯ 3 ä¸ªå­èä¸ºä¸ç»ï¼è½¬æ¢ä¸ºæ¯ 4 ä¸ª 6 ä½äºè¿å¶ä½ä¸ç»ï¼ä¸è¶³ 6 ä½æ¶ä½ä½è¡¥ 0ï¼ãè¿æ¯ä¸ä¸ªåç»ååçè¿ç¨ï¼3 ä¸ª 8 ä½äºè¿å¶ç å 4 ä¸ª 6 ä½äºè¿å¶ç çé¿åº¦é½æ¯ 24 ä½ï¼38 = 46 = 24ï¼ã\n 4. å¯¹è·å¾ç 4-6 äºè¿å¶ç è¡¥ä½ï¼å 6 ä½äºè¿å¶ç æ·»å  2 ä½é«ä½ 0ï¼ç»æ 4 ä¸ª 8 ä½äºè¿å¶ç ã\n 5. å¯¹è·å¾ç 4-8 äºè¿å¶ç è½¬æ¢ä¸ºåè¿å¶ç ã\n 6. å°è·å¾çåè¿å¶ç è½¬æ¢ä¸º base64 å­ç¬¦è¡¨ä¸­å¯¹åºçå­ç¬¦ã\n\nbase64 ç¼ç è¡¨\n\nç´¢å¼   å¯¹åºå­ç¬¦   ç´¢å¼   å¯¹åºå­ç¬¦   ç´¢å¼   å¯¹åºå­ç¬¦   ç´¢å¼   å¯¹åºå­ç¬¦\n0    a      17   r      34   i      51   z\n1    b      18   s      35   j      52   0\n2    c      19   t      36   k      53   1\n3    d      20   u      37   l      54   2\n4    e      21   v      38   m      55   3\n5    f      22   w      39   n      56   4\n6    g      23   x      40   o      57   5\n7    h      24   y      41   p      58   6\n8    i      25   z      42   q      59   7\n9    j      26   a      43   r      60   8\n10   k      27   b      44   s      61   9\n11   l      28   c      45   t      62   +\n12   m      29   d      46   u      63   /\n13   n      30   e      47   v           \n14   o      31   f      48   w           \n15   p      32   g      49   x           \n16   q      33   h      50   y           \n\n\n# base64 åºç¨\n\nbase64 ç¼ç å¯ç¨äºå¨ http ç¯å¢ä¸ä¼ éè¾é¿çæ è¯ä¿¡æ¯ãå¨å¶ä»åºç¨ç¨åºä¸­ï¼ä¹å¸¸å¸¸éè¦æäºè¿å¶æ°æ®ç¼ç ä¸ºéåæ¾å¨ url(åæ¬éèè¡¨åå)ä¸­çå½¢å¼ãæ­¤æ¶ï¼éç¨ base64 ç¼ç å·æä¸å¯è¯»æ§ï¼å³æç¼ç çæ°æ®ä¸ä¼è¢«äººç¨èç¼æç´æ¥çå°ï¼ç®æ¯èµ·å°ä¸ä¸ªå å¯çä½ç¨ã\n\nç¶èï¼æ åç base64 å¹¶ä¸éåç´æ¥æ¾å¨ url éä¼ è¾ï¼å ä¸º url ç¼ç å¨ä¼ææ å base64 ä¸­ç / å + å­ç¬¦åä¸ºå½¢å¦ %xx çå½¢å¼ï¼èè¿äº % å·å¨å­å¥æ°æ®åºæ¶è¿éè¦åè¿è¡è½¬æ¢ï¼å ä¸º ansi sql ä¸­å·²å° % å·ç¨ä½ééç¬¦ã\n\nä¸ºè§£å³æ­¤é®é¢ï¼å¯éç¨ä¸ç§ç¨äº url çæ¹è¿ base64 ç¼ç ï¼å®ä¸ä»å¨æ«å°¾å¡«å = å·ï¼å¹¶å°æ å base64 ä¸­çâ+âåâ/âåå«æ¹æäº - å _ï¼è¿æ ·å°±åå»äºå¨ url ç¼è§£ç åæ°æ®åºå­å¨æ¶æè¦ä½çè½¬æ¢ï¼é¿åäºç¼ç ä¿¡æ¯é¿åº¦å¨æ­¤è¿ç¨ä¸­çå¢å ï¼å¹¶ç»ä¸äºæ°æ®åºãè¡¨åç­å¤å¯¹è±¡æ è¯ç¬¦çæ ¼å¼ã\n\nå¦æä¸ç§ç¨äºæ­£åè¡¨è¾¾å¼çæ¹è¿ base64 åç§ï¼å®å° + å / æ¹æäº ! å -ï¼å ä¸º +, * ä»¥ååé¢å¨ ircu ä¸­ç¨å°ç [ å ] å¨æ­£åè¡¨è¾¾å¼ä¸­é½å¯è½å·æç¹æ®å«ä¹ã\n\nãç¤ºä¾ãjava.util.base64 ç¼ç ãè§£ç ç¤ºä¾\n\nbase64.getencoder() å base64.getdecoder() æä¾äºçæ¯æ åç base64 ç¼ç ãè§£ç æ¹å¼ï¼\n\nbase64.geturlencoder() å base64.geturldecoder() æä¾äº url å®å¨ç base64 ç¼ç ãè§£ç æ¹å¼ï¼å° + å / æ¿æ¢ä¸º - å _ï¼ã\n\nimport java.nio.charset.standardcharsets;\nimport java.util.base64;\n\npublic class base64demo {\n\n    public static void main(string[] args) {\n        string url = "https://www.baidu.com";\n        system.out.println("url:" + url);\n        // æ åç base64 ç¼ç ãè§£ç \n        byte[] encoded = base64.getencoder().encode(url.getbytes(standardcharsets.utf_8));\n        byte[] decoded = base64.getdecoder().decode(encoded);\n        system.out.println("url safe base64 encoded:" + new string(encoded));\n        system.out.println("url safe base64 decoded:" + new string(decoded));\n        // url å®å¨ç base64 ç¼ç ãè§£ç \n        byte[] encoded2 = base64.geturlencoder().encode(url.getbytes(standardcharsets.utf_8));\n        byte[] decoded2 = base64.geturldecoder().decode(encoded2);\n        system.out.println("base64 encoded:" + new string(encoded2));\n        system.out.println("base64 decoded:" + new string(decoded2));\n    }\n\n}\n\n\nè¾åºï¼\n\nurl:https://www.baidu.com\nurl safe base64 encoded:ahr0chm6ly93d3cuymfpzhuuy29t\nurl safe base64 decoded:https://www.baidu.com\nbase64 encoded:ahr0chm6ly93d3cuymfpzhuuy29t\nbase64 decoded:https://www.baidu.com\n\n\n\n# æ¶æ¯æè¦\n\n\n# æ¶æ¯æè¦æ¦è¿°\n\næ¶æ¯æè¦ï¼å¶å®å°±æ¯å°éè¦æè¦çæ°æ®ä½ä¸ºåæ°ï¼ç»è¿åå¸å½æ°(hash)çè®¡ç®ï¼å¾å°çæ£åå¼ã\n\næ¶æ¯æè¦æ¯ä¸ä¸ªå¯ä¸å¯¹åºä¸ä¸ªæ¶æ¯æææ¬çåºå®é¿åº¦çå¼ï¼å®ç±ä¸ä¸ªåå hash å å¯å½æ°å¯¹æ¶æ¯è¿è¡ä½ç¨èäº§çãå¦ææ¶æ¯å¨éä¸­æ¹åäºï¼åæ¥æ¶èéè¿å¯¹æ¶å°æ¶æ¯çæ°äº§ççæè¦ä¸åæè¦æ¯è¾ï¼å°±å¯ç¥éæ¶æ¯æ¯å¦è¢«æ¹åäºãå æ­¤æ¶æ¯æè¦ä¿è¯äºæ¶æ¯çå®æ´æ§ãæ¶æ¯æè¦éç¨åå hash å½æ°å°éå å¯çææ"æè¦"æä¸ä¸²å¯æï¼è¿ä¸ä¸²å¯æäº¦ç§°ä¸ºæ°å­æçº¹(finger print)ãå®æåºå®çé¿åº¦ï¼ä¸ä¸åçæææè¦æå¯æï¼å¶ç»ææ»æ¯ä¸åçï¼èåæ ·çææå¶æè¦å¿å®ä¸è´ãè¿æ ·è¿ä¸²æè¦ä¾¿å¯æä¸ºéªè¯æææ¯å¦æ¯"çèº«"ç"æçº¹"äºã\n\n\n# æ¶æ¯æè¦ç¹ç¹\n\n * å¯ä¸æ§ï¼æ°æ®åªè¦æä¸ç¹æ¹åï¼é£ä¹åéè¿æ¶æ¯æè¦ç®æ³å¾å°çæè¦ä¹ä¼åçååãè½ç¶çè®ºä¸æå¯è½ä¼åçç¢°æï¼ä½æ¯æ¦çæå¶ä½ã\n * ä¸å¯éï¼æ¶æ¯æè¦ç®æ³çå¯ææ æ³è¢«è§£å¯ã\n * ä¸éè¦å¯é¥ï¼å¯ä½¿ç¨äºåå¸å¼ç½ç»ã\n * æ è®ºè¾å¥çæææå¤é¿ï¼è®¡ç®åºæ¥çæ¶æ¯æè¦çé¿åº¦æ»æ¯åºå®çã\n\n\n# æ¶æ¯æè¦å¸¸ç¨ç®æ³\n\næ¶æ¯æè¦ç®æ³åæ¬md(message digestï¼æ¶æ¯æè¦ç®æ³)ãsha(secure hash algorithmï¼å®å¨æ£åç®æ³)ã**mac(message authenticationcodeï¼æ¶æ¯è®¤è¯ç ç®æ³)**å± 3 å¤§ç³»åï¼å¸¸ç¨äºéªè¯æ°æ®çå®æ´æ§ï¼æ¯æ°å­ç­¾åç®æ³çæ ¸å¿ç®æ³ã\n\nmd5åsha1åå«æ¯mdãshaç®æ³ç³»åä¸­ææä»£è¡¨æ§çç®æ³ã\n\nå¦ä»ï¼md5 å·²è¢«åç°æè®¸å¤æ¼æ´ï¼ä»èä¸åå®å¨ãsha ç®æ³æ¯ md ç®æ³çæè¦é¿åº¦æ´é¿ï¼ä¹æ´å å®å¨ã\n\n\n# æ¶æ¯æè¦åºç¨\n\n# md5ãsha çèä¾\n\njdk ä¸­ä½¿ç¨ md5 å sha è¿ä¸¤ç§æ¶æ¯æè¦çæ¹å¼åºæ¬ä¸è´ï¼æ­¥éª¤å¦ä¸ï¼\n\n 1. åå§å messagedigest å¯¹è±¡\n 2. æ´æ°è¦è®¡ç®çåå®¹\n 3. çææè¦\n\nimport java.security.messagedigest;\nimport java.util.base64;\n\npublic class messagedigestdemo {\n\n    public static byte[] encode(byte[] input, type type) throws exception {\n        // æ ¹æ®ç±»åï¼åå§åæ¶æ¯æè¦å¯¹è±¡\n        messagedigest md5digest = messagedigest.getinstance(type.getname());\n\n        // æ´æ°è¦è®¡ç®çåå®¹\n        md5digest.update(input);\n\n        // å®æåå¸è®¡ç®ï¼è¿åæè¦\n        return md5digest.digest();\n    }\n\n    public static byte[] encodewithbase64(byte[] input, type type) throws exception {\n        return base64.geturlencoder().encode(encode(input, type));\n    }\n\n    public static string encodewithbase64string(byte[] input, type type) throws exception {\n        return base64.geturlencoder().encodetostring(encode(input, type));\n    }\n\n    public enum type {\n        md2("md2"),\n        md5("md5"),\n        sha1("sha1"),\n        sha256("sha-256"),\n        sha384("sha-384"),\n        sha512("sha-512");\n\n        private string name;\n\n        type(string name) {\n            this.name = name;\n        }\n\n        public string getname() {\n            return this.name;\n        }\n    }\n\n    public static void main(string[] args) throws exception {\n        string msg = "hello world!";\n        system.out.println("md2: " + encodewithbase64string(msg.getbytes(), type.md2));\n        system.out.println("md5: " + encodewithbase64string(msg.getbytes(), type.md5));\n        system.out.println("sha1: " + encodewithbase64string(msg.getbytes(), type.sha1));\n        system.out.println("sha256: " + encodewithbase64string(msg.getbytes(), type.sha256));\n        system.out.println("sha384: " + encodewithbase64string(msg.getbytes(), type.sha384));\n        system.out.println("sha512: " + encodewithbase64string(msg.getbytes(), type.sha512));\n    }\n\n}\n\n\nãè¾åºã\n\nmd2: mv98zyi_aft8q0uvea6hlg==\nmd5: 7qdih1muhjzehb6sv8unja==\nsha1: lve95gjovatpfv8el5x4nxwjkhe=\nsha256: f4oxzx_x_fo5lcgbskhwxfwtsx-j1ncost3sabjtkgk=\nsha384: v9dsdrvqbv7lg0efr8giewksvnbvgtlsjc0qescj4_1v0gh51c_ro4-we1jmrbpk\nsha512: hhhe1nbohxp-w02wfic8_vpujm9ivgtm3ajyvvjhkxqzcqferykcw88cnts0kms1ehubh_nln5n7xgtdb_tsya==\n\n\n# hmac çèä¾\n\n\nimport java.nio.charset.standardcharsets;\nimport java.util.base64;\nimport javax.crypto.mac;\nimport javax.crypto.spec.secretkeyspec;\n\npublic class hmacmessagedigest {\n\n    public static void main(string[] args) throws exception {\n        string msg = "hello world!";\n        byte[] salt = "my salt".getbytes(standardcharsets.utf_8);\n        system.out.println("åæ: " + msg);\n        system.out.println("hmacmd5: " + encodewithbase64string(msg.getbytes(), salt, hmactypeen.hmacmd5));\n        system.out.println("hmacsha1: " + encodewithbase64string(msg.getbytes(), salt, hmactypeen.hmacsha1));\n        system.out.println("hmacsha256: " + encodewithbase64string(msg.getbytes(), salt, hmactypeen.hmacsha256));\n        system.out.println("hmacsha384: " + encodewithbase64string(msg.getbytes(), salt, hmactypeen.hmacsha384));\n        system.out.println("hmacsha512: " + encodewithbase64string(msg.getbytes(), salt, hmactypeen.hmacsha512));\n    }\n\n    public static byte[] encode(byte[] plaintext, byte[] salt, hmactypeen type) throws exception {\n        secretkeyspec keyspec = new secretkeyspec(salt, type.name());\n        mac mac = mac.getinstance(keyspec.getalgorithm());\n        mac.init(keyspec);\n        return mac.dofinal(plaintext);\n    }\n\n    public static byte[] encodewithbase64(byte[] plaintext, byte[] salt, hmactypeen type) throws exception {\n        return base64.geturlencoder().encode(encode(plaintext, salt, type));\n    }\n\n    public static string encodewithbase64string(byte[] plaintext, byte[] salt, hmactypeen type) throws exception {\n        return base64.geturlencoder().encodetostring(encode(plaintext, salt, type));\n    }\n\n    /**\n     * jdkæ¯æ hmacmd5, hmacsha1, hmacsha256, hmacsha384, hmacsha512\n     */\n    public enum hmactypeen {\n\n        hmacmd5, hmacsha1, hmacsha256, hmacsha384, hmacsha512;\n    }\n\n}\n\n\nè¾åº\n\nåæ: hello world!\nhmacmd5: re6blrsb1q26sfjtwxzusq==\nhmacsha1: cfu8a9h6cby9c5fo0omj2bnuilm=\nhmacsha256: z1czuqdwwfyyl7qedj2suh6iiehvi7o83dxml0jyer0=\nhmacsha384: 34mktrqboynwwznmqubjrdk_msldgqm2pmgcplzuplsknrg_cwfz4blpjcbbw88b\nhmacsha512: 6n77httz_atc04-ssmxhsk3wzh1samdudcl0cb_rzp4dpieng4lzkhxmbq8lck7xsnz6my_wipnstdp6pc_-5w==\n\n\n\n# æ°å­ç­¾å\n\n\n# æ°å­ç­¾åæ¦è¿°\n\næ°å­ç­¾åç®æ³å¯ä»¥çåæ¯ä¸ç§å¸¦æå¯é¥çæ¶æ¯æè¦ç®æ³ï¼å¹¶ä¸è¿ç§å¯é¥åå«äºå¬é¥åç§é¥ãä¹å°±æ¯è¯´ï¼æ°å­ç­¾åç®æ³æ¯éå¯¹ç§°å å¯ç®æ³åæ¶æ¯æè¦ç®æ³çç»åä½ã\n\næ°å­ç­¾åç®æ³è¦æ±è½å¤éªè¯æ°æ®å®æ´æ§ãè®¤è¯æ°æ®æ¥æºï¼å¹¶èµ·å°æå¦è®¤çä½ç¨ã\n\næ°å­ç­¾åç®æ³åå«ç­¾ååéªè¯ä¸¤é¡¹æä½ï¼éµå¾ªç§é¥ç­¾åï¼å¬é¥éªè¯çæ¹å¼ã\n\nç­¾åæ¶è¦ä½¿ç¨ç§é¥åå¾ç­¾åæ°æ®ï¼éªè¯æ¶åéè¦å¬é¥ãç­¾åå¼åå¾ç­¾åæ°æ®ï¼å¶æ ¸å¿ç®æ³ä¸»è¦æ¯æ¶æ¯æè¦ç®æ³ã\n\n\n\næ°å­ç­¾åå¸¸ç¨ç®æ³ï¼rsaãdsaãecdsa\n\n\n# æ°å­ç­¾åç®æ³åºç¨\n\n# dsa çèä¾\n\næ°å­ç­¾åæä¸¤ä¸ªæµç¨ï¼ç­¾ååéªè¯ã\n\nå®ä»¬çåæé½æ¯è¦æä¸ä¸ªå¬é¥ãå¯é¥å¯¹ã\n\næ°å­ç­¾åç¨ç§é¥ä¸ºæ¶æ¯è®¡ç®ç­¾åã\n\nãç¤ºä¾ãç¨å¬é¥éªè¯æè¦\n\npublic class dsacoder {\n\n    public static final string key_algorithm = "dsa";\n\n    public static final string sign_algorithm = "sha1withdsa";\n\n    /**\n     * dsaå¯é¥é¿åº¦é»è®¤1024ä½ã å¯é¥é¿åº¦å¿é¡»æ¯64çæ´æ°åï¼èå´å¨512~1024ä¹é´\n     */\n    private static final int key_size = 1024;\n\n    private keypair keypair;\n\n    public dsacoder() throws exception {\n        this.keypair = initkey();\n    }\n\n    private keypair initkey() throws exception {\n        // åå§åå¯é¥å¯¹çæå¨\n        keypairgenerator keypairgen = keypairgenerator.getinstance(dsacoder.key_algorithm);\n        // å®ä¾åå¯é¥å¯¹çæå¨\n        keypairgen.initialize(key_size);\n        // å®ä¾åå¯é¥å¯¹\n        return keypairgen.genkeypair();\n    }\n\n    public byte[] signature(byte[] data, byte[] privatekey) throws exception {\n        pkcs8encodedkeyspec keyspec = new pkcs8encodedkeyspec(privatekey);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        privatekey key = keyfactory.generateprivate(keyspec);\n\n        signature signature = signature.getinstance(sign_algorithm);\n        signature.initsign(key);\n        signature.update(data);\n        return signature.sign();\n    }\n\n    public byte[] getprivatekey() {\n        return keypair.getprivate().getencoded();\n    }\n\n    public boolean verify(byte[] data, byte[] publickey, byte[] sign) throws exception {\n        x509encodedkeyspec keyspec = new x509encodedkeyspec(publickey);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        publickey key = keyfactory.generatepublic(keyspec);\n\n        signature signature = signature.getinstance(sign_algorithm);\n        signature.initverify(key);\n        signature.update(data);\n        return signature.verify(sign);\n    }\n\n    public byte[] getpublickey() {\n        return keypair.getpublic().getencoded();\n    }\n\n    public static void main(string[] args) throws exception {\n        string msg = "hello world";\n        dsacoder dsa = new dsacoder();\n        byte[] sign = dsa.signature(msg.getbytes(), dsa.getprivatekey());\n        boolean flag = dsa.verify(msg.getbytes(), dsa.getpublickey(), sign);\n        string result = flag ? "æ°å­ç­¾åå¹é" : "æ°å­ç­¾åä¸å¹é";\n        system.out.println("æ°å­ç­¾åï¼" + base64.geturlencoder().encodetostring(sign));\n        system.out.println("éªè¯ç»æï¼" + result);\n    }\n\n}\n\n\nãè¾åºã\n\næ°å­ç­¾åï¼mcwcfdpuo_vronl5st0awary-mlxjuscahrmemnuvhpizfa2h2m37tne0putoa==\néªè¯ç»æï¼æ°å­ç­¾åå¹é\n\n\n\n# å¯¹ç§°å å¯\n\n\n# å¯¹ç§°å å¯æ¦è¿°\n\nå¯¹ç§°å å¯ç®æ³ä¸»è¦æ desã3desï¼tripledesï¼ãaesãideaãrc2ãrc4ãrc5 å blowfish ç­ã\n\nå¯¹ç§°å å¯ç®æ³æ¯åºç¨è¾æ©çå å¯ç®æ³ï¼ææ¯æçãå¨å¯¹ç§°å å¯ç®æ³ä¸­ï¼æ°æ®åä¿¡æ¹å°ææï¼åå§æ°æ®ï¼åå å¯å¯é¥ï¼mi yaoï¼ä¸èµ·ç»è¿ç¹æ®å å¯ç®æ³å¤çåï¼ä½¿å¶åæå¤æçå å¯å¯æåéåºå»ãæ¶ä¿¡æ¹æ¶å°å¯æåï¼è¥æ³è§£è¯»åæï¼åéè¦ä½¿ç¨å å¯ç¨è¿çå¯é¥åç¸åç®æ³çéç®æ³å¯¹å¯æè¿è¡è§£å¯ï¼æè½ä½¿å¶æ¢å¤æå¯è¯»ææãå¨å¯¹ç§°å å¯ç®æ³ä¸­ï¼ä½¿ç¨çå¯é¥åªæä¸ä¸ªï¼åæ¶ä¿¡åæ¹é½ä½¿ç¨è¿ä¸ªå¯é¥å¯¹æ°æ®è¿è¡å å¯åè§£å¯ï¼è¿å°±è¦æ±è§£å¯æ¹äºåå¿é¡»ç¥éå å¯å¯é¥ã\n\nå¯¹ç§°å å¯ç¹ç¹ï¼\n\n * ä¼ç¹ï¼è®¡ç®éå°ãå å¯éåº¦å¿«ãå å¯æçé«ã\n * ç¼ºç¹ï¼ç®æ³æ¯å¬å¼çï¼å®å¨æ§å¾ä¸å°ä¿è¯ã\n\néä¿¡åæ¹æ¯æ¬¡ä½¿ç¨å¯¹ç§°å å¯ç®æ³æ¶ï¼é½éè¦ä½¿ç¨å¶ä»äººä¸ç¥éçæä¸å¯é¥ï¼è¿ä¼ä½¿å¾éä¿¡åæ¹ææ¥æçå¯é¥æ°éåå ä½çº§æ°å¢é¿ï¼å¯é¥ç®¡çæä¸ºç¨æ·çè´æãå¯¹ç§°å å¯ç®æ³å¨åå¸å¼ç½ç»ç³»ç»ä¸ä½¿ç¨è¾ä¸ºå°é¾ï¼ä¸»è¦æ¯å ä¸ºå¯é¥ç®¡çå°é¾ï¼ä½¿ç¨ææ¬è¾é«ã\n\nèä¸å¬é¥ãå¯é¥å å¯ç®æ³æ¯èµ·æ¥ï¼å¯¹ç§°å å¯ç®æ³è½å¤æä¾å å¯åè®¤è¯å´ç¼ºä¹äºç­¾ååè½ï¼ä½¿å¾ä½¿ç¨èå´ææç¼©å°ã\n\n# å¯¹ç§°å å¯åç\n\nå¯¹ç§°å å¯è¦æ±å å¯ä¸è§£å¯ä½¿ç¨åä¸ä¸ªå¯é¥ï¼è§£å¯æ¯å å¯çéè¿ç®ãç±äºå å¯ãè§£å¯ä½¿ç¨åä¸ä¸ªå¯é¥ï¼è¿è¦æ±éä¿¡åæ¹å¿é¡»å¨éä¿¡ååå®è¯¥å¯é¥ï¼å¹¶å¦¥åä¿å­è¯¥å¯é¥ã\n\nå¯¹ç§°å å¯ä½å¶åä¸ºä¸¤ç§ï¼\n\nä¸ç§æ¯å¯¹ææçåä¸ªä½ï¼æå­èï¼è¿è¡è¿ç®ï¼ç§°ä¸ºæµå¯ç ï¼ä¹ç§°ä¸ºåºåå¯ç ï¼\n\nä¸ç§æ¯æææä¿¡æ¯ååä¸ºä¸åçç»ï¼æåï¼ç»æï¼åå«å¯¹æ¯ä¸ªç»ï¼æåï¼è¿è¡å å¯ãè§£å¯ï¼ç§°ä¸ºåç»å¯ç ã\n\n\n\nåè®¾ç²ä¹æ¹ä½ä¸ºéä¿¡åæ¹ãåå®ç²ä¹åæ¹å¨æ¶æ¯ä¼ éåå·²åå®å å¯ç®æ³ï¼æ¬²å®æä¸æ¬¡æ¶æ¯ä¼ ééè¦ç»è¿å¦ä¸æ­¥éª¤ã\n\n\n\n# å¯¹ç§°å å¯å·¥ä½æ¨¡å¼\n\nä»¥ des ç®æ³çå·¥ä½æ¨¡å¼ä¸ºä¾ï¼des ç®æ³æ ¹æ®å¶å å¯ç®æ³æå®ä¹çææåç»çå¤§å°ï¼56 ä½ï¼ï¼å°æ°æ®åå²æè¥å¹² 56 ä½çå å¯åºåï¼åä»¥å å¯åºåä¸ºåä½ï¼åå«è¿è¡å å¯å¤çãå¦ææåå©ä¸ä¸è¶³ä¸ä¸ªåºåçå¤§å°ï¼ç§°ä¹ä¸ºç­åãç­åçå¤çæ¹æ³æå¡«åæ³ãæµå¯ç å å¯æ³ãå¯ææªç¨ææ¯ã\n\næ ¹æ®æ°æ®å å¯æ¶æ¯ä¸ªå å¯åºåè§å¾å³èæ¹å¼æ¥åºåï¼å¯ä»¥åä¸ºä»¥ä¸ç§å·¥ä½æ¨¡å¼ï¼\n\n(1) çµå­å¯ç æ¬æ¨¡å¼(electronic code book, ecb)\n\nç¨éï¼éåå å¯å¯é¥ï¼éæºæ°ç­ç­æ°æ®ãä¾å¦ï¼å®å¨å°ä¼ é des å¯é¥ï¼ecb æ¯æåéçæ¨¡å¼ã\n\n(2) å¯æé¾æ¥æ¨¡å¼(cipher booki chaining, cbc)\n\nç¨éï¼å¯å å¯ä»»æé¿åº¦çæ°æ®ï¼éç¨äºè®¡ç®äº§çæ£æµæ°æ®å®æ´æ§çæ¶æ¯è®¤è¯ macã\n\n(3) å¯æåé¦æ¨¡å¼(cipher feed back, cfb)\n\nç¨éï¼å éè¯¯ä¼ æ­æ çï¼å¯ä»¥ç¨äºæ£æ¥åç°ææå¯æçç¯¡æ¹ã\n\n(4) è¾åºåé¦æ¨¡å¼(output feed back, ofb)\n\nç¨éï¼ä½¿ç¨äºå å¯åä½æ§è¾å¤§çæ°æ®ï¼æ¯å¦è¯­é³åå¾åæ°æ®ã\n\naes ç®æ³é¤äºä»¥ä¸ 4 ä¸­æ¨¡å¼å¤ï¼è¿æä¸ç§æ°çå·¥ä½æ¨¡å¼ï¼\n\n(5) è®¡æ°å¨æ¨¡å¼(counter, ctr)\n\nç¨éï¼éç¨äºåç§å å¯åºç¨ã\n\næ¬æå¯¹äºåç§å·¥ä½æ¨¡å¼çåçå±å¼æè¿°ãä¸ªäººè®¤ä¸ºï¼ä½ä¸ºå·¥ç¨åºç¨ï¼äºè§£å¶ç¨éå³å¯ã\n\n# å¯¹ç§°å å¯å¡«åæ¹æ³\n\njava ä¸­å¯¹ç§°å å¯å¯¹äºç­åçå¤çï¼ä¸è¬æ¯éç¨å¡«åæ¹å¼ã\n\nå¸¸éç¨çæ¯ï¼nopaddingï¼ä¸å¡«åï¼ãzeros å¡«åï¼0 å¡«åï¼ãpkcs5padding å¡«åã\n\nzerospadding\n\næ¹å¼ï¼å¨é¨å¡«åä¸º 0 çå­è\n\nç»æå¦ä¸ï¼\n\nf1 f2 f3 f4 f5 f6 f7 f8 //ç¬¬ä¸å\n\nf9 00 00 00 00 00 00 00 //ç¬¬äºå\n\npkcs5padding\n\næ¹å¼ï¼æ¯ä¸ªå¡«åçå­èé½è®°å½äºå¡«åçæ»å­èæ°\n\nç»æå¦ä¸ï¼\n\nf1 f2 f3 f4 f5 f6 f7 f8 //ç¬¬ä¸å\n\nf9 07 07 07 07 07 07 07 //ç¬¬äºå\n\n\n# å¯¹ç§°å å¯åºç¨\n\n# åºäºå¯é¥å å¯çæµç¨ï¼desãdesedeãaes å ideaï¼\n\ndesãdesedeãaes å idea ç­ç®æ³é½æ¯åºäºå¯é¥å å¯çå¯¹ç§°å å¯ç®æ³ï¼å®ä»¬çå®ç°æµç¨ä¹åºæ¬ä¸è´ãæ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼çæå¯é¥\n\nkeygenerator kg = keygenerator.getinstance("des");\nsecurerandom random = new securerandom();\nkg.init(random);\nsecretkey secretkey = kg.generatekey();\n\n\nå»ºè®®ä½¿ç¨éæºæ°æ¥åå§åå¯é¥ççæã\n\nï¼2ï¼åå§åå¯ç å¯¹è±¡\n\ncipher cipher = cipher.getinstance("des/ecb/pkcs5padding");\ncipher.init(cipher.encrypt_mode, secretkey);\n\n\nencrypt_modeï¼å å¯æ¨¡å¼\n\ndecrypt_modeï¼è§£å¯æ¨¡å¼\n\nï¼3ï¼æ§è¡\n\nstring plaintext = "hello world";\nbyte[] ciphertext = cipher.dofinal(plaintext.getbytes());\n\n\nä¸ä¸ªå®æ´ç des å å¯è§£å¯èä¾\n\nimport java.nio.charset.standardcharsets;\nimport java.security.*;\nimport java.util.base64;\nimport javax.crypto.*;\nimport javax.crypto.spec.ivparameterspec;\n\n/**\n * deså®å¨ç¼ç ï¼æ¯ç»å¸çå¯¹ç§°å å¯ç®æ³ãå¯é¥ä»56ä½ï¼ä¸è¿­ä»£æ¬¡æ°åå°ãå·²è¢«è§ä¸ºå¹¶ä¸å®å¨çå å¯ç®æ³ã\n *\n * @author zhang peng\n * @since 2016å¹´7æ14æ¥\n */\npublic class descoder {\n\n    public static final string key_algorithm_des = "des";\n\n    public static final string cipher_des_default = "des";\n\n    public static final string cipher_des_ecb_pkcs5padding = "des/ecb/pkcs5padding"; // ç®æ³/æ¨¡å¼/è¡¥ç æ¹å¼\n\n    public static final string cipher_des_cbc_pkcs5padding = "des/cbc/pkcs5padding";\n\n    public static final string cipher_des_cbc_nopadding = "des/cbc/nopadding";\n\n    private static final string seed = "%%%today is nice***"; // ç¨äºçæéæºæ°çç§å­\n\n    private key key;\n\n    private cipher cipher;\n\n    private string transformation;\n\n    public descoder() throws nosuchalgorithmexception, nosuchpaddingexception, nosuchproviderexception {\n        this.key = initkey();\n        this.cipher = cipher.getinstance(cipher_des_default);\n        this.transformation = cipher_des_default;\n    }\n\n    /**\n     * æ ¹æ®éæºæ°ç§å­çæä¸ä¸ªå¯é¥\n     *\n     * @return key\n     * @throws nosuchalgorithmexception\n     * @throws nosuchproviderexception\n     * @author zhang peng\n     * @since 2016å¹´7æ14æ¥\n     */\n    private key initkey() throws nosuchalgorithmexception, nosuchproviderexception {\n        // æ ¹æ®ç§å­çæä¸ä¸ªå®å¨çéæºæ°\n        securerandom securerandom = null;\n        securerandom = new securerandom(seed.getbytes());\n\n        keygenerator keygen = keygenerator.getinstance(key_algorithm_des);\n        keygen.init(securerandom);\n        return keygen.generatekey();\n    }\n\n    public descoder(string transformation)\n        throws nosuchalgorithmexception, nosuchpaddingexception, nosuchproviderexception {\n        this.key = initkey();\n        this.cipher = cipher.getinstance(transformation);\n        this.transformation = transformation;\n    }\n\n    /**\n     * å å¯\n     *\n     * @param input ææ\n     * @return byte[] å¯æ\n     * @throws invalidkeyexception\n     * @throws illegalblocksizeexception\n     * @throws badpaddingexception\n     * @throws invalidalgorithmparameterexception\n     * @author zhang peng\n     * @since 2016å¹´7æ20æ¥\n     */\n    public byte[] encrypt(byte[] input) throws invalidkeyexception, illegalblocksizeexception, badpaddingexception,\n        invalidalgorithmparameterexception {\n        if (transformation.equals(cipher_des_cbc_pkcs5padding) || transformation.equals(cipher_des_cbc_nopadding)) {\n            cipher.init(cipher.encrypt_mode, key, new ivparameterspec(getiv()));\n        } else {\n            cipher.init(cipher.encrypt_mode, key);\n        }\n        return cipher.dofinal(input);\n    }\n\n    /**\n     * è§£å¯\n     *\n     * @param input å¯æ\n     * @return byte[] ææ\n     * @throws invalidkeyexception\n     * @throws illegalblocksizeexception\n     * @throws badpaddingexception\n     * @throws invalidalgorithmparameterexception\n     * @author zhang peng\n     * @since 2016å¹´7æ20æ¥\n     */\n    public byte[] decrypt(byte[] input) throws invalidkeyexception, illegalblocksizeexception, badpaddingexception,\n        invalidalgorithmparameterexception {\n        if (transformation.equals(cipher_des_cbc_pkcs5padding) || transformation.equals(cipher_des_cbc_nopadding)) {\n            cipher.init(cipher.decrypt_mode, key, new ivparameterspec(getiv()));\n        } else {\n            cipher.init(cipher.decrypt_mode, key);\n        }\n        return cipher.dofinal(input);\n    }\n\n    private byte[] getiv() {\n        string iv = "01234567"; // iv length: must be 8 bytes long\n        return iv.getbytes();\n    }\n\n    public static void main(string[] args) throws exception {\n        descoder aes = new descoder(cipher_des_cbc_pkcs5padding);\n\n        string msg = "hello world!";\n        system.out.println("åæ: " + msg);\n        byte[] encoded = aes.encrypt(msg.getbytes(standardcharsets.utf_8));\n        string encodedbase64 = base64.geturlencoder().encodetostring(encoded);\n        system.out.println("å¯æ: " + encodedbase64);\n\n        byte[] decodedbase64 = base64.geturldecoder().decode(encodedbase64);\n        byte[] decoded = aes.decrypt(decodedbase64);\n        system.out.println("ææ: " + new string(decoded));\n    }\n\n}\n\n\nè¾åº\n\nåæ: hello world!\nå¯æ: ttneu9eznqtxfkpmq_37qw==\nææ: hello world!\n\n\n# åºäºå£ä»¤å å¯çæµç¨ï¼pbeï¼\n\ndesãdesedeãaesãidea è¿å ç§ç®æ³çåºç¨æ¨¡åå ä¹å¦åºä¸è¾ã\n\nä½æ¯ï¼å¹¶éææå¯¹ç§°å å¯ç®æ³é½æ¯å¦æ­¤ã\n\nåºäºå£ä»¤å å¯(password based encryption, pbe)æ¯ä¸ç§åºäºå£ä»¤å å¯çç®æ³ãå¶ç¹ç¹æ¯ï¼å£ä»¤ç±ç¨æ·èªå·±æç®¡ï¼éç¨éæºæ°ï¼è¿éå«åçï¼æåå¤éå å¯ç­æ¹æ³ä¿è¯æ°æ®çå®å¨æ§ã\n\npbe æ²¡æå¯é¥æ¦å¿µï¼å¯é¥å¨å¶ä»å¯¹ç§°å å¯ç®æ³ä¸­æ¯ç»è¿è®¡ç®å¾åºçï¼pbe åä½¿ç¨å£ä»¤æ¿ä»£äºå¯é¥ã\n\næµç¨ï¼\n\n\n\næ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼äº§çç\n\nsecurerandom securerandom = new securerandom();\nbyte[] salt = securerandom.generateseed(8); // çé¿åº¦å¿é¡»ä¸º8å­è\n\n\nï¼2ï¼æ ¹æ®å¯ç äº§ç key\n\nstring password = "123456";\npbekeyspec keyspec = new pbekeyspec(password.tochararray());\nsecretkeyfactory keyfactory = secretkeyfactory.getinstance(key_algorithm);\nsecretkey secretkey = keyfactory.generatesecret(keyspec);\n\n\nï¼3ï¼åå§åå å¯æè§£å¯å¯¹è±¡\n\npbeparameterspec paramspec = new pbeparameterspec(salt, iteration_count);\ncipher cipher = cipher.getinstance(key_algorithm);\ncipher.init(cipher.encrypt_mode, secretkey, paramspec);\n\n\nï¼4ï¼æ§è¡\n\nbyte[] plaintext = "hello world".getbytes();\nbyte[] ciphertext = cipher.dofinal(plaintext);\n\n\nï¼5ï¼å®æ´ pbe ç¤ºä¾\n\nimport java.security.key;\nimport java.security.securerandom;\nimport java.util.base64;\nimport javax.crypto.cipher;\nimport javax.crypto.secretkey;\nimport javax.crypto.secretkeyfactory;\nimport javax.crypto.spec.pbekeyspec;\nimport javax.crypto.spec.pbeparameterspec;\n\n/**\n * åºäºå£ä»¤å å¯(password based encryption, pbe)ï¼æ¯ä¸ç§å¯¹ç§°å å¯ç®æ³ã å¶ç¹ç¹æ¯ï¼å£ä»¤ç±ç¨æ·èªå·±æç®¡ï¼éç¨éæºæ°ï¼è¿éå«åçï¼æåå¤éå å¯ç­æ¹æ³ä¿è¯æ°æ®çå®å¨æ§ã\n * pbeæ²¡æå¯é¥æ¦å¿µï¼å¯é¥å¨å¶ä»å¯¹ç§°å å¯ç®æ³ä¸­æ¯ç»è¿è®¡ç®å¾åºçï¼pbeåä½¿ç¨å£ä»¤æ¿ä»£äºå¯é¥ã\n *\n * @author zhang peng\n * @since 2016å¹´7æ20æ¥\n */\npublic class pbecoder {\n\n    public static final string key_algorithm = "pbewithmd5anddes";\n\n    public static final int iteration_count = 100;\n\n    private key key;\n\n    private byte[] salt;\n\n    public pbecoder(string password) throws exception {\n        this.salt = initsalt();\n        this.key = initkey(password);\n    }\n\n    private byte[] initsalt() {\n        securerandom securerandom = new securerandom();\n        return securerandom.generateseed(8); // çé¿åº¦å¿é¡»ä¸º8å­è\n    }\n\n    private key initkey(string password) throws exception {\n        pbekeyspec keyspec = new pbekeyspec(password.tochararray());\n        secretkeyfactory keyfactory = secretkeyfactory.getinstance(key_algorithm);\n        return keyfactory.generatesecret(keyspec);\n    }\n\n    public byte[] encrypt(byte[] plaintext) throws exception {\n        pbeparameterspec paramspec = new pbeparameterspec(salt, iteration_count);\n        cipher cipher = cipher.getinstance(key_algorithm);\n        cipher.init(cipher.encrypt_mode, key, paramspec);\n        return cipher.dofinal(plaintext);\n    }\n\n    public byte[] decrypt(byte[] ciphertext) throws exception {\n        pbeparameterspec paramspec = new pbeparameterspec(salt, iteration_count);\n        cipher cipher = cipher.getinstance(key_algorithm);\n        cipher.init(cipher.decrypt_mode, key, paramspec);\n        return cipher.dofinal(ciphertext);\n    }\n\n    public static void test1() throws exception {\n\n        // äº§çç\n        securerandom securerandom = new securerandom();\n        byte[] salt = securerandom.generateseed(8); // çé¿åº¦å¿é¡»ä¸º8å­è\n\n        // äº§çkey\n        string password = "123456";\n        pbekeyspec keyspec = new pbekeyspec(password.tochararray());\n        secretkeyfactory keyfactory = secretkeyfactory.getinstance(key_algorithm);\n        secretkey secretkey = keyfactory.generatesecret(keyspec);\n\n        pbeparameterspec paramspec = new pbeparameterspec(salt, iteration_count);\n        cipher cipher = cipher.getinstance(key_algorithm);\n        cipher.init(cipher.encrypt_mode, secretkey, paramspec);\n\n        byte[] plaintext = "hello world".getbytes();\n        byte[] ciphertext = cipher.dofinal(plaintext);\n        new string(ciphertext);\n    }\n\n    public static void main(string[] args) throws exception {\n        pbecoder encode = new pbecoder("123456");\n        string message = "hello world!";\n        byte[] ciphertext = encode.encrypt(message.getbytes());\n        byte[] plaintext = encode.decrypt(ciphertext);\n\n        system.out.println("åæï¼" + message);\n        system.out.println("å¯æï¼" + base64.geturlencoder().encodetostring(ciphertext));\n        system.out.println("ææï¼" + new string(plaintext));\n    }\n\n}\n\n\n\n# éå¯¹ç§°å å¯\n\n\n# éå¯¹ç§°å å¯æ¦è¿°\n\néå¯¹ç§°å å¯å¸¸ç¨ç®æ³ï¼dh(diffie-hellmanï¼å¯é¥äº¤æ¢ç®æ³)ãrsa\n\néå¯¹ç§°å å¯ç®æ³åå¯¹ç§°å å¯ç®æ³çä¸»è¦å·®å«å¨äºéå¯¹ç§°å å¯ç®æ³ç¨äºå å¯åè§£å¯çå¯é¥æ¯ä¸åçãä¸ä¸ªå¬å¼ï¼ç§°ä¸ºå¬é¥ï¼public keyï¼ï¼ä¸ä¸ªä¿å¯ï¼ç§°ä¸ºç§é¥ï¼private keyï¼ãå æ­¤ï¼éå¯¹ç§°å å¯ç®æ³ä¹ç§°ä¸ºåé¥å å¯ç®æ³æå¬é¥å å¯ç®æ³ã\n\néå¯¹ç§°å å¯ç¹ç¹ï¼\n\n * ä¼ç¹ï¼éå¯¹ç§°å å¯ç®æ³è§£å³äºå¯¹ç§°å å¯ç®æ³çå¯é¥åéé®é¢ï¼å¹¶æå¤§å°æé«äºç®æ³å®å¨æ§ã\n * ç¼ºç¹ï¼ç®æ³æ¯å¯¹ç§°ç®æ³æ´å¤æï¼å æ­¤å å¯ãè§£å¯éåº¦é½æ¯å¯¹ç§°ç®æ³æ¢å¾å¤ã\n\n\n\néå¯¹ç§°å å¯ç®æ³å®ç°æºå¯ä¿¡æ¯äº¤æ¢çåºæ¬è¿ç¨æ¯ï¼ç²æ¹çæä¸å¯¹å¯é¥å¹¶å°å¶ä¸­çä¸æä½ä¸ºå¬ç¨å¯é¥åå¶å®æ¹å¬å¼ï¼å¾å°è¯¥å¬ç¨å¯é¥çä¹æ¹ä½¿ç¨è¯¥å¯é¥å¯¹æºå¯ä¿¡æ¯è¿è¡å å¯åååéç»ç²æ¹ï¼ç²æ¹åç¨èªå·±ä¿å­çå¦ä¸æä¸ç¨å¯é¥å¯¹å å¯åçä¿¡æ¯è¿è¡è§£å¯ã\n\nå¦ä¸æ¹é¢ï¼ç²æ¹å¯ä»¥ä½¿ç¨ä¹æ¹çå¬é¥å¯¹æºå¯ä¿¡æ¯è¿è¡ç­¾ååååéç»ä¹æ¹ï¼ä¹æ¹åç¨èªå·±çç§åå¯¹æ°æ®è¿è¡éªè¯ã\n\nç²æ¹åªè½ç¨å¶ç§é¥è§£å¯ï¼ç±å¶å¬é¥å å¯åçä»»ä½ä¿¡æ¯ã éå¯¹ç§°å å¯ç®æ³çä¿å¯æ§æ¯è¾å¥½ï¼å®æ¶é¤äºæç»ç¨æ·äº¤æ¢å¯é¥çéè¦ã\n\n\n# éå¯¹ç§°å å¯ç®æ³åºç¨\n\nimport java.nio.charset.standardcharsets;\nimport java.security.*;\nimport java.security.spec.pkcs8encodedkeyspec;\nimport java.security.spec.x509encodedkeyspec;\nimport java.util.base64;\nimport javax.crypto.cipher;\n\n/**\n * rsaå®å¨ç¼ç ï¼éå¯¹ç§°å å¯ç®æ³ãå®æ¢å¯ä»¥ç¨æ¥å å¯ãè§£å¯ï¼ä¹å¯ä»¥ç¨æ¥åæ°å­ç­¾å\n *\n * @author zhang peng\n * @since 2016å¹´7æ20æ¥\n */\npublic class rsacoder {\n\n    public final static string key_algorithm = "rsa";\n\n    public final static string sign_algorithm = "md5withrsa";\n\n    private keypair keypair;\n\n    public rsacoder() throws exception {\n        this.keypair = initkeypair();\n    }\n\n    private keypair initkeypair() throws exception {\n        // keypairgeneratorç±»ç¨äºçæå¬é¥åç§é¥å¯¹ï¼åºäºrsaç®æ³çæå¯¹è±¡\n        keypairgenerator keypairgen = keypairgenerator.getinstance(key_algorithm);\n        // åå§åå¯é¥å¯¹çæå¨ï¼å¯é¥å¤§å°ä¸º1024ä½\n        keypairgen.initialize(1024);\n        // çæä¸ä¸ªå¯é¥å¯¹\n        return keypairgen.genkeypair();\n    }\n\n    public byte[] encryptbyprivatekey(byte[] plaintext, byte[] key) throws exception {\n        pkcs8encodedkeyspec keyspec = new pkcs8encodedkeyspec(key);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        privatekey privatekey = keyfactory.generateprivate(keyspec);\n        cipher cipher = cipher.getinstance(keyfactory.getalgorithm());\n        cipher.init(cipher.encrypt_mode, privatekey);\n        return cipher.dofinal(plaintext);\n    }\n\n    public byte[] decryptbypublickey(byte[] ciphertext, byte[] key) throws exception {\n        x509encodedkeyspec keyspec = new x509encodedkeyspec(key);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        publickey publickey = keyfactory.generatepublic(keyspec);\n        cipher cipher = cipher.getinstance(keyfactory.getalgorithm());\n        cipher.init(cipher.decrypt_mode, publickey);\n        return cipher.dofinal(ciphertext);\n    }\n\n    public byte[] encryptbypublickey(byte[] plaintext, byte[] key) throws exception {\n        x509encodedkeyspec keyspec = new x509encodedkeyspec(key);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        publickey publickey = keyfactory.generatepublic(keyspec);\n        cipher cipher = cipher.getinstance(keyfactory.getalgorithm());\n        cipher.init(cipher.encrypt_mode, publickey);\n        return cipher.dofinal(plaintext);\n    }\n\n    public byte[] decryptbyprivatekey(byte[] ciphertext, byte[] key) throws exception {\n        pkcs8encodedkeyspec keyspec = new pkcs8encodedkeyspec(key);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        privatekey privatekey = keyfactory.generateprivate(keyspec);\n        cipher cipher = cipher.getinstance(keyfactory.getalgorithm());\n        cipher.init(cipher.decrypt_mode, privatekey);\n        return cipher.dofinal(ciphertext);\n    }\n\n    public byte[] signature(byte[] data, byte[] privatekey, rsasigntypeen type) throws exception {\n        pkcs8encodedkeyspec keyspec = new pkcs8encodedkeyspec(privatekey);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        privatekey key = keyfactory.generateprivate(keyspec);\n\n        signature signature = signature.getinstance(type.name());\n        signature.initsign(key);\n        signature.update(data);\n        return signature.sign();\n    }\n\n    public byte[] getprivatekey() {\n        return keypair.getprivate().getencoded();\n    }\n\n    public boolean verify(byte[] data, byte[] publickey, byte[] sign, rsasigntypeen type) throws exception {\n        x509encodedkeyspec keyspec = new x509encodedkeyspec(publickey);\n        keyfactory keyfactory = keyfactory.getinstance(key_algorithm);\n        publickey key = keyfactory.generatepublic(keyspec);\n\n        signature signature = signature.getinstance(type.name());\n        signature.initverify(key);\n        signature.update(data);\n        return signature.verify(sign);\n    }\n\n    public byte[] getpublickey() {\n        return keypair.getpublic().getencoded();\n    }\n\n    public enum rsasigntypeen {\n\n        md2withrsa,\n        md5withrsa,\n        sha1withrsa\n    }\n\n    public static void main(string[] args) throws exception {\n        string msg = "hello world!";\n        rsacoder coder = new rsacoder();\n        // ç§é¥å å¯ï¼å¬é¥è§£å¯\n        byte[] ciphertext = coder.encryptbyprivatekey(msg.getbytes(standardcharsets.utf_8), coder.keypair.getprivate().getencoded());\n        byte[] plaintext = coder.decryptbypublickey(ciphertext, coder.keypair.getpublic().getencoded());\n\n        // å¬é¥å å¯ï¼ç§é¥è§£å¯\n        byte[] ciphertext2 = coder.encryptbypublickey(msg.getbytes(), coder.keypair.getpublic().getencoded());\n        byte[] plaintext2 = coder.decryptbyprivatekey(ciphertext2, coder.keypair.getprivate().getencoded());\n\n        byte[] sign = coder.signature(msg.getbytes(), coder.getprivatekey(), rsasigntypeen.sha1withrsa);\n        boolean flag = coder.verify(msg.getbytes(), coder.getpublickey(), sign, rsasigntypeen.sha1withrsa);\n        string result = flag ? "æ°å­ç­¾åå¹é" : "æ°å­ç­¾åä¸å¹é";\n\n        system.out.println("åæï¼" + msg);\n        system.out.println("å¬é¥ï¼" + base64.geturlencoder().encodetostring(coder.keypair.getpublic().getencoded()));\n        system.out.println("ç§é¥ï¼" + base64.geturlencoder().encodetostring(coder.keypair.getprivate().getencoded()));\n\n        system.out.println("============== ç§é¥å å¯ï¼å¬é¥è§£å¯ ==============");\n        system.out.println("å¯æï¼" + base64.geturlencoder().encodetostring(ciphertext));\n        system.out.println("ææï¼" + new string(plaintext));\n\n        system.out.println("============== å¬é¥å å¯ï¼ç§é¥è§£å¯ ==============");\n        system.out.println("å¯æï¼" + base64.geturlencoder().encodetostring(ciphertext2));\n        system.out.println("ææï¼" + new string(plaintext2));\n\n        system.out.println("============== æ°å­ç­¾å ==============");\n        system.out.println("æ°å­ç­¾åï¼" + base64.geturlencoder().encodetostring(sign));\n        system.out.println("éªè¯ç»æï¼" + result);\n    }\n\n}\n\n\nè¾åº\n\nåæï¼hello world!\nå¬é¥ï¼migfma0gcsqgsib3dqebaquaa4gnadcbiqkbgqczptrlertucytr8gmipvbso7fn18thueq02u21mh7ta4fh4tjvngozrzeoryu94dxrpdnrpjh0p62p5pdijx_dtglzr0agwgttvbbpwake4kexypqv4vv6ixrzyq2hdovfoovim5eu0tu_txgenpffp0pyj2lxczpsgsrdupupmwidaqab\nç§é¥ï¼miicdwibadanbgkqhkig9w0baqefaascamewggjdageaaogbalm-1esstnrxi2vwayim9uyjsu3xy2g4srtztbwahtmdgufhoo82a5mtkq5fi73h3gs92es-ohsnry_mkmiph920avmvrozac1o8fs_aaotir5fi-q_hvxqjdhpjdyd068u6i-kbl67ro79pez42kv-nslipytclomybkt1q-4-bagmbaaecgybjxoxil8s0wjajkckfnxiquh3sh6lwgkrcwci1p0rgw-ttdeg-sucyctjsktsl3rq0edqjmovrnsc7ngygpidcitdbd1h6m3tlrebbb-wzdxmswpshtqjsq4de0e93mmfysciop6qexos0jqvjtyybsk37lpucldalj2ijdtc0gqjbapfmngzauipmxued7puuwnbuwxnkmdmcs308ec_9vnllxwhdb9xkmuxcmwqk16mj6j1fqwtju62t21yniwwqhiscqqc5lwqkfrxvukgnbg0pa95nvwwy01yttnb125jslxekbr97ku4vgbabcb9tyudpr9lxazgfg6y3a1wfsfukagsxakea1l719olxhyswzdmbvtozk14m-qebs9lwjc9asmpb8b1u2vvj2pd3wlyyw4tv5-qt-j2jur-e1tmseqovgx-csqjaetrobq_zfv_0vjnwutmtd2nsw5m3gy4vzu5ep1dsxf63gxdmyvccqepzjqxpxnayxeharj_7rhbsc1ts_ux4sqjbailbgqc4-92foxgzwt80rsqzlmq8j8nbjpoo7run9tgx60vkr3xv26vos77oqdufwlt5iibzbs9acta2suav6qg=\n============== ç§é¥å å¯ï¼å¬é¥è§£å¯ ==============\nå¯æï¼qn6igjsjv45enh21ryrx2uzfmueqplbm1g3vipbbqbuf63rdhdsgmjsvpaub__v0rxpplu3gr6qlywu1mpaj-ix_6kogah64wqtwqprh7e6aj767rybnpt9jyvlcmmpy9diqhaufwtbjdo34q-a7fhq9c8bwrj6jnn47idmzhfu=\nææï¼hello world!\n============== å¬é¥å å¯ï¼ç§é¥è§£å¯ ==============\nå¯æï¼fsz2ifs69d7jdrh-yoe5pi5wkqu1zml7sdsppqtzun6muscjnp6x312deqcxkmgseadmpveb01yzbfa0mt_6eyjyvseu7rd6bdf6yig3azfc41yh5ititvq-xzxugnpps12slpxswg0faa5qjcvznotx9p7nhr8n20y4cnmi6rw=\nææï¼hello world!\n============== æ°å­ç­¾å ==============\næ°å­ç­¾åï¼dttuulwx1wrqbw1pca8o6wjcwcrhinezrxwglkewbom2dpvhnynvv_hyks-qfe5_4vjqcpgj2hzqwbfv1vklhmuwuixm7vjk70g3g7bf8i8rwbrcdoxgtr77jrewidpr1pyjzwjvgq_hp36mxingflcvh2sn0fu8mppzsxuenzq=\néªè¯ç»æï¼æ°å­ç­¾åå¹é\n\n\n\n# æ¯è¯­\n\n * ææ(plaintext)ï¼æå¾å å¯ä¿¡æ¯ãææå¯ä»¥æ¯ææ¬æä»¶ãå¾çæä»¶ãäºè¿å¶æ°æ®ç­ã\n * å¯æ(ciphertext)ï¼æç»è¿å å¯åçææãå¯æéå¸¸ä»¥ææ¬ãäºè¿å¶ç­å½¢å¼å­å¨ã\n * å å¯(encryption)ï¼æå°ææè½¬æ¢ä¸ºå¯æçè¿ç¨ã\n * è§£å¯(decryption)ï¼æå°å¯æè½¬æ¢ä¸ºææçè¿ç¨ã\n * å å¯å¯é¥(encryption key)ï¼æéè¿å å¯ç®æ³è¿è¡å å¯æä½ç¨çå¯é¥ã\n * è§£å¯å¯é¥(decryption key)ï¼æéè¿è§£å¯ç®æ³è¿è¡è§£å¯æä½ç¨çå¯é¥ã\n * ä¿¡é(channel)ï¼éä¿¡çééï¼æ¯ä¿¡å·ä¼ è¾çåªä»ã\n\n\n# åèèµæ\n\n * ãjava æ ¸å¿ææ¯ å· ii é«çº§ç¹æ§ã\n * ãjava å å¯ä¸è§£å¯çèºæ¯ã',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java æ­£åä»å¥é¨å°ç²¾é",frontmatter:{title:"Java æ­£åä»å¥é¨å°ç²¾é",date:"2020-12-25T18:43:11.000Z",categories:["Java","JavaSE","é«çº§ç¹æ§"],tags:["Java","JavaSE","æ­£å"],permalink:"/pages/4c1dd4/"},regularPath:"/01.Java/01.JavaSE/02.%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/01.Java%E6%AD%A3%E5%88%99.html",relativePath:"01.Java/01.JavaSE/02.é«çº§ç¹æ§/01.Javaæ­£å.md",key:"v-19cb262c",path:"/pages/4c1dd4/",headers:[{level:2,title:"æ­£åç®ä»",slug:"æ­£åç®ä»",normalizedTitle:"æ­£åç®ä»",charIndex:78},{level:3,title:"æ­£åè¡¨è¾¾å¼æ¯ä»ä¹",slug:"æ­£åè¡¨è¾¾å¼æ¯ä»ä¹",normalizedTitle:"æ­£åè¡¨è¾¾å¼æ¯ä»ä¹",charIndex:87},{level:3,title:"å¦ä½å­¦ä¹ æ­£å",slug:"å¦ä½å­¦ä¹ æ­£å",normalizedTitle:"å¦ä½å­¦ä¹ æ­£å",charIndex:222},{level:2,title:"æ­£åå·¥å·ç±»",slug:"æ­£åå·¥å·ç±»",normalizedTitle:"æ­£åå·¥å·ç±»",charIndex:534},{level:3,title:"Pattern ç±»",slug:"pattern-ç±»",normalizedTitle:"pattern ç±»",charIndex:608},{level:3,title:"Matcher ç±»",slug:"matcher-ç±»",normalizedTitle:"matcher ç±»",charIndex:644},{level:4,title:"æ ¡éª",slug:"æ ¡éª",normalizedTitle:"æ ¡éª",charIndex:1187},{level:4,title:"æ¥æ¾",slug:"æ¥æ¾",normalizedTitle:"æ¥æ¾",charIndex:1190},{level:4,title:"æ¿æ¢",slug:"æ¿æ¢",normalizedTitle:"æ¿æ¢",charIndex:1193},{level:2,title:"åå­ç¬¦",slug:"åå­ç¬¦",normalizedTitle:"åå­ç¬¦",charIndex:62},{level:3,title:"åºæ¬åå­ç¬¦",slug:"åºæ¬åå­ç¬¦",normalizedTitle:"åºæ¬åå­ç¬¦",charIndex:8256},{level:4,title:"å¤éï¼|ï¼",slug:"å¤é",normalizedTitle:"å¤éï¼|ï¼",charIndex:8372},{level:4,title:"åç»ï¼()ï¼",slug:"åç»",normalizedTitle:"åç»ï¼()ï¼",charIndex:8770},{level:4,title:"æå®åå­ç¬¦ææèå´ï¼[]ï¼",slug:"æå®åå­ç¬¦ææèå´",normalizedTitle:"æå®åå­ç¬¦ææèå´ï¼[]ï¼",charIndex:9243},{level:4,title:"æå®åå­ç¬¦æ æèå´ï¼ [^]ï¼",slug:"æå®åå­ç¬¦æ æèå´",normalizedTitle:"æå®åå­ç¬¦æ æèå´ï¼ [^]ï¼",charIndex:9833},{level:4,title:"éå¶å­ç¬¦æ°éï¼{}ï¼",slug:"éå¶å­ç¬¦æ°é",normalizedTitle:"éå¶å­ç¬¦æ°éï¼{}ï¼",charIndex:10461},{level:4,title:"è½¬ä¹å­ç¬¦ï¼/ï¼",slug:"è½¬ä¹å­ç¬¦",normalizedTitle:"è½¬ä¹å­ç¬¦ï¼/ï¼",charIndex:11459},{level:4,title:"æå®è¡¨è¾¾å¼å­ç¬¦ä¸²çå¼å§ï¼^ï¼åç»å°¾ï¼$ï¼",slug:"æå®è¡¨è¾¾å¼å­ç¬¦ä¸²çå¼å§-åç»å°¾",normalizedTitle:"æå®è¡¨è¾¾å¼å­ç¬¦ä¸²çå¼å§ï¼^ï¼åç»å°¾ï¼$ï¼",charIndex:11614},{level:3,title:"ç­ä»·å­ç¬¦",slug:"ç­ä»·å­ç¬¦",normalizedTitle:"ç­ä»·å­ç¬¦",charIndex:8298},{level:4,title:"è¡¨ç¤ºæä¸ç±»åå­ç¬¦çç­ä»·å­ç¬¦",slug:"è¡¨ç¤ºæä¸ç±»åå­ç¬¦çç­ä»·å­ç¬¦",normalizedTitle:"è¡¨ç¤ºæä¸ç±»åå­ç¬¦çç­ä»·å­ç¬¦",charIndex:12306},{level:4,title:"éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦",slug:"éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦",normalizedTitle:"éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦",charIndex:14302},{level:4,title:"åå­ç¬¦ä¼åçº§é¡ºåº",slug:"åå­ç¬¦ä¼åçº§é¡ºåº",normalizedTitle:"åå­ç¬¦ä¼åçº§é¡ºåº",charIndex:15236},{level:2,title:"åç»æé ",slug:"åç»æé ",normalizedTitle:"åç»æé ",charIndex:15569},{level:3,title:"æè·ä¸éæè·",slug:"æè·ä¸éæè·",normalizedTitle:"æè·ä¸éæè·",charIndex:39},{level:3,title:"ååå¼ç¨",slug:"ååå¼ç¨",normalizedTitle:"ååå¼ç¨",charIndex:46},{level:5,title:"å¸¦ç¼å·çååå¼ç¨",slug:"å¸¦ç¼å·çååå¼ç¨",normalizedTitle:"å¸¦ç¼å·çååå¼ç¨",charIndex:15982},{level:4,title:"å½åçååå¼ç¨",slug:"å½åçååå¼ç¨",normalizedTitle:"å½åçååå¼ç¨",charIndex:15772},{level:3,title:"éæè·ç»",slug:"éæè·ç»",normalizedTitle:"éæè·ç»",charIndex:15803},{level:3,title:"é¶å®½æ­è¨",slug:"é¶å®½æ­è¨",normalizedTitle:"é¶å®½æ­è¨",charIndex:51},{level:4,title:"å¹é exp åé¢çä½ç½®",slug:"å¹é-exp-åé¢çä½ç½®",normalizedTitle:"å¹é exp åé¢çä½ç½®",charIndex:17833},{level:4,title:"å¹é exp åé¢çä½ç½®",slug:"å¹é-exp-åé¢çä½ç½®",normalizedTitle:"å¹é exp åé¢çä½ç½®",charIndex:17857},{level:4,title:"å¹éåé¢è·çä¸æ¯ exp çä½ç½®",slug:"å¹éåé¢è·çä¸æ¯-exp-çä½ç½®",normalizedTitle:"å¹éåé¢è·çä¸æ¯ exp çä½ç½®",charIndex:17881},{level:4,title:"å¹éåé¢ä¸æ¯ exp çä½ç½®",slug:"å¹éåé¢ä¸æ¯-exp-çä½ç½®",normalizedTitle:"å¹éåé¢ä¸æ¯ exp çä½ç½®",charIndex:17909},{level:2,title:"è´ªå©ªä¸ææ°",slug:"è´ªå©ªä¸ææ°",normalizedTitle:"è´ªå©ªä¸ææ°",charIndex:56},{level:2,title:"æ­£åéå½",slug:"æ­£åéå½",normalizedTitle:"æ­£åéå½",charIndex:23180},{level:3,title:"å¹éæ­£åå­ç¬¦ä¸²çæ¹æ³",slug:"å¹éæ­£åå­ç¬¦ä¸²çæ¹æ³",normalizedTitle:"å¹éæ­£åå­ç¬¦ä¸²çæ¹æ³",charIndex:23189},{level:3,title:"éæ¥åå­ç¬¦å­å¸",slug:"éæ¥åå­ç¬¦å­å¸",normalizedTitle:"éæ¥åå­ç¬¦å­å¸",charIndex:24442},{level:4,title:"éå®ç¬¦",slug:"éå®ç¬¦",normalizedTitle:"éå®ç¬¦",charIndex:15419},{level:4,title:"å®ä½ç¬¦",slug:"å®ä½ç¬¦",normalizedTitle:"å®ä½ç¬¦",charIndex:25071},{level:4,title:"éæå°å­ç¬¦",slug:"éæå°å­ç¬¦",normalizedTitle:"éæå°å­ç¬¦",charIndex:25276},{level:4,title:"åç»",slug:"åç»-2",normalizedTitle:"åç»",charIndex:8770},{level:4,title:"ç¹æ®ç¬¦å·",slug:"ç¹æ®ç¬¦å·",normalizedTitle:"ç¹æ®ç¬¦å·",charIndex:25906},{level:2,title:"æ­£åå®æ",slug:"æ­£åå®æ",normalizedTitle:"æ­£åå®æ",charIndex:26102},{level:3,title:"æå®ç¨çæ­£å",slug:"æå®ç¨çæ­£å",normalizedTitle:"æå®ç¨çæ­£å",charIndex:26233},{level:4,title:"æ ¡éªä¸­æ",slug:"æ ¡éªä¸­æ",normalizedTitle:"æ ¡éªä¸­æ",charIndex:26243},{level:4,title:"æ ¡éªèº«ä»½è¯å·ç ",slug:"æ ¡éªèº«ä»½è¯å·ç ",normalizedTitle:"æ ¡éªèº«ä»½è¯å·ç ",charIndex:26394},{level:4,title:"æ ¡éªææç¨æ·åãå¯ç ",slug:"æ ¡éªææç¨æ·åãå¯ç ",normalizedTitle:"æ ¡éªææç¨æ·åãå¯ç ",charIndex:27540},{level:4,title:"æ ¡éªé®ç®±",slug:"æ ¡éªé®ç®±",normalizedTitle:"æ ¡éªé®ç®±",charIndex:27758},{level:4,title:"æ ¡éª URL",slug:"æ ¡éª-url",normalizedTitle:"æ ¡éª url",charIndex:28164},{level:4,title:"æ ¡éªæ¶é´",slug:"æ ¡éªæ¶é´",normalizedTitle:"æ ¡éªæ¶é´",charIndex:28471},{level:4,title:"æ ¡éªæ¥æ",slug:"æ ¡éªæ¥æ",normalizedTitle:"æ ¡éªæ¥æ",charIndex:28635},{level:4,title:"æ ¡éªä¸­å½ææºå·ç ",slug:"æ ¡éªä¸­å½ææºå·ç ",normalizedTitle:"æ ¡éªä¸­å½ææºå·ç ",charIndex:29183},{level:4,title:"æ ¡éªä¸­å½åºè¯å·ç ",slug:"æ ¡éªä¸­å½åºè¯å·ç ",normalizedTitle:"æ ¡éªä¸­å½åºè¯å·ç ",charIndex:29760},{level:4,title:"æ ¡éª IPv4 å°å",slug:"æ ¡éª-ipv4-å°å",normalizedTitle:"æ ¡éª ipv4 å°å",charIndex:30047},{level:4,title:"æ ¡éª IPv6 å°å",slug:"æ ¡éª-ipv6-å°å",normalizedTitle:"æ ¡éª ipv6 å°å",charIndex:30392},{level:3,title:"ç¹å®å­ç¬¦",slug:"ç¹å®å­ç¬¦",normalizedTitle:"ç¹å®å­ç¬¦",charIndex:11649},{level:3,title:"ç¹å®æ°å­",slug:"ç¹å®æ°å­",normalizedTitle:"ç¹å®æ°å­",charIndex:31993},{level:2,title:"æ­£åè¡¨è¾¾å¼çæ§è½",slug:"æ­£åè¡¨è¾¾å¼çæ§è½",normalizedTitle:"æ­£åè¡¨è¾¾å¼çæ§è½",charIndex:32199},{level:3,title:"NFA èªå¨æºçåæº¯",slug:"nfa-èªå¨æºçåæº¯",normalizedTitle:"nfa èªå¨æºçåæº¯",charIndex:32624},{level:3,title:"å¦ä½é¿ååæº¯",slug:"å¦ä½é¿ååæº¯",normalizedTitle:"å¦ä½é¿ååæº¯",charIndex:33164},{level:4,title:"è´ªå©ªæ¨¡å¼ï¼Greedyï¼",slug:"è´ªå©ªæ¨¡å¼-greedy",normalizedTitle:"è´ªå©ªæ¨¡å¼ï¼greedyï¼",charIndex:33174},{level:4,title:"ææ°æ¨¡å¼ï¼Reluctantï¼",slug:"ææ°æ¨¡å¼-reluctant",normalizedTitle:"ææ°æ¨¡å¼ï¼reluctantï¼",charIndex:33410},{level:4,title:"ç¬å æ¨¡å¼ï¼Possessiveï¼",slug:"ç¬å æ¨¡å¼-possessive",normalizedTitle:"ç¬å æ¨¡å¼ï¼possessiveï¼",charIndex:33599},{level:3,title:"æ­£åè¡¨è¾¾å¼çä¼å",slug:"æ­£åè¡¨è¾¾å¼çä¼å",normalizedTitle:"æ­£åè¡¨è¾¾å¼çä¼å",charIndex:33809},{level:4,title:"å°ç¨è´ªå©ªæ¨¡å¼ï¼å¤ç¨ç¬å æ¨¡å¼",slug:"å°ç¨è´ªå©ªæ¨¡å¼-å¤ç¨ç¬å æ¨¡å¼",normalizedTitle:"å°ç¨è´ªå©ªæ¨¡å¼ï¼å¤ç¨ç¬å æ¨¡å¼",charIndex:33821},{level:4,title:"åå°åæ¯éæ©",slug:"åå°åæ¯éæ©",normalizedTitle:"åå°åæ¯éæ©",charIndex:33866},{level:4,title:"åå°æè·åµå¥",slug:"åå°æè·åµå¥",normalizedTitle:"åå°æè·åµå¥",charIndex:34172},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:35361}],headersStr:"æ­£åç®ä» æ­£åè¡¨è¾¾å¼æ¯ä»ä¹ å¦ä½å­¦ä¹ æ­£å æ­£åå·¥å·ç±» Pattern ç±» Matcher ç±» æ ¡éª æ¥æ¾ æ¿æ¢ åå­ç¬¦ åºæ¬åå­ç¬¦ å¤éï¼|ï¼ åç»ï¼()ï¼ æå®åå­ç¬¦ææèå´ï¼[]ï¼ æå®åå­ç¬¦æ æèå´ï¼ [^]ï¼ éå¶å­ç¬¦æ°éï¼{}ï¼ è½¬ä¹å­ç¬¦ï¼/ï¼ æå®è¡¨è¾¾å¼å­ç¬¦ä¸²çå¼å§ï¼^ï¼åç»å°¾ï¼$ï¼ ç­ä»·å­ç¬¦ è¡¨ç¤ºæä¸ç±»åå­ç¬¦çç­ä»·å­ç¬¦ éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦ åå­ç¬¦ä¼åçº§é¡ºåº åç»æé  æè·ä¸éæè· ååå¼ç¨ å¸¦ç¼å·çååå¼ç¨ å½åçååå¼ç¨ éæè·ç» é¶å®½æ­è¨ å¹é exp åé¢çä½ç½® å¹é exp åé¢çä½ç½® å¹éåé¢è·çä¸æ¯ exp çä½ç½® å¹éåé¢ä¸æ¯ exp çä½ç½® è´ªå©ªä¸ææ° æ­£åéå½ å¹éæ­£åå­ç¬¦ä¸²çæ¹æ³ éæ¥åå­ç¬¦å­å¸ éå®ç¬¦ å®ä½ç¬¦ éæå°å­ç¬¦ åç» ç¹æ®ç¬¦å· æ­£åå®æ æå®ç¨çæ­£å æ ¡éªä¸­æ æ ¡éªèº«ä»½è¯å·ç  æ ¡éªææç¨æ·åãå¯ç  æ ¡éªé®ç®± æ ¡éª URL æ ¡éªæ¶é´ æ ¡éªæ¥æ æ ¡éªä¸­å½ææºå·ç  æ ¡éªä¸­å½åºè¯å·ç  æ ¡éª IPv4 å°å æ ¡éª IPv6 å°å ç¹å®å­ç¬¦ ç¹å®æ°å­ æ­£åè¡¨è¾¾å¼çæ§è½ NFA èªå¨æºçåæº¯ å¦ä½é¿ååæº¯ è´ªå©ªæ¨¡å¼ï¼Greedyï¼ ææ°æ¨¡å¼ï¼Reluctantï¼ ç¬å æ¨¡å¼ï¼Possessiveï¼ æ­£åè¡¨è¾¾å¼çä¼å å°ç¨è´ªå©ªæ¨¡å¼ï¼å¤ç¨ç¬å æ¨¡å¼ åå°åæ¯éæ© åå°æè·åµå¥ åèèµæ",content:'# Java æ­£åä»å¥é¨å°ç²¾é\n\n> å³é®è¯ï¼PatternãMatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãDFAãNFA\n\n\n# æ­£åç®ä»\n\n\n# æ­£åè¡¨è¾¾å¼æ¯ä»ä¹\n\næ­£åè¡¨è¾¾å¼ï¼Regular Expressionï¼æ¯ä¸ä¸ªç¨æ­£åç¬¦å·ååºçå¬å¼ï¼ç¨åºå¯¹è¿ä¸ªå¬å¼è¿è¡è¯­æ³åæï¼å»ºç«ä¸ä¸ªè¯­æ³åææ ï¼åæ ¹æ®è¿ä¸ªåææ ç»åæ­£åè¡¨è¾¾å¼çå¼æçææ§è¡ç¨åºï¼è¿ä¸ªæ§è¡ç¨åºæä»¬æå®ç§°ä½ç¶ææºï¼ä¹å«ç¶æèªå¨æºï¼ï¼ç¨äºå­ç¬¦å¹éã\n\n\n# å¦ä½å­¦ä¹ æ­£å\n\næ­£åè¡¨è¾¾å¼æ¯ä¸ä¸ªå¼ºå¤§çææ¬å¹éå·¥å·ï¼ä½æ¯å®çè§åå¾å¤æï¼çè§£èµ·æ¥è¾ä¸ºå°é¾ï¼å®¹æè®©äººæèççã\n\nåæ¥è§¦æ­£åæ¶ï¼æçäºä¸å æ­£åçè¯­ä¹è¯´æï¼ä½æ¯ä»ç¶ä¸ææä»¥ãåæ¥ï¼æå¤æ¥è§¦ä¸äºæ­£åçåºç¨å®ä¾ï¼æ¸æ¸æäºæè§ï¼åç»åè¯­ä¹è¯´æï¼ç»æé¢æãæè§å¾æ­£åè¡¨è¾¾å¼åæ­¦ä¾ ä¿®ç»æ­¦åå·®ä¸å¤ï¼åºè¯¥åç»æå¼ï¼åç»å¿æ³ãå¦æä¸å¼å§å°±ç´æ¥çæ­£åçè§åï¼ä¿è¯ä½ ä¼æµé¼ãå½ä½ çæåºæ¬æå¼ï¼æ­£ååºæ¬ä½¿ç¨æ¡ä¾ï¼åï¼ä¹è¯¥ä¿®ç¼ä¿®ç¼å¿æ³ï¼æ­£åè¯­æ³ï¼äºãçæ­£çé«æä¸è½åªé æ­»è®°ç¡¬èé£ä¹å ææå¼ãå°±åå¼ ä¸ä¸°æå¼ æ å¿å¤ªææ³ä¸æ ·ï¼é¢æå¿æ³ï¼èä¼è´¯éï¼å°ä¾ ä½ å°±å¯ä»¥æ æèææï¼æä¸ºä¼ è¯´ä¸­çç»ä¸é«æã\n\nä»¥ä¸é²è¯å¯å½çº³ä¸ºä¸å¥ï¼å­¦ä¹ æ­£ååºè¯¥ä»å®ä¾å»çè§£è§åã\n\n\n# æ­£åå·¥å·ç±»\n\nJDK ä¸­ç java.util.regex åæä¾äºå¯¹æ­£åè¡¨è¾¾å¼çæ¯æã\n\njava.util.regex æä¸ä¸ªæ ¸å¿ç±»ï¼\n\n * Pattern ç±»ï¼Pattern æ¯ä¸ä¸ªæ­£åè¡¨è¾¾å¼çç¼è¯è¡¨ç¤ºã\n * Matcher ç±»ï¼Matcher æ¯å¯¹è¾å¥å­ç¬¦ä¸²è¿è¡è§£éåå¹éæä½çå¼æã\n * PatternSyntaxExceptionï¼PatternSyntaxException æ¯ä¸ä¸ªéå¼ºå¶å¼å¸¸ç±»ï¼å®è¡¨ç¤ºä¸ä¸ªæ­£åè¡¨è¾¾å¼æ¨¡å¼ä¸­çè¯­æ³éè¯¯ã\n\n**æ³¨ï¼**éè¦æ ¼å¤æ³¨æä¸ç¹ï¼å¨ Java ä¸­ä½¿ç¨åææ "\\"æ¶å¿é¡»åæ "\\\\"ãæä»¥æ¬æçä»£ç åºç°å½¢å¦ String regex = "\\\\$\\\\{.*?\\\\}" å¶å®å°±æ¯ \\$\\{.\\*?\\}ã\n\n\n# Pattern ç±»\n\nPatternç±»æ²¡æå¬å±æé æ¹æ³ãè¦åå»ºä¸ä¸ªPatternå¯¹è±¡ï¼ä½ å¿é¡»é¦åè°ç¨å¶éææ¹æ³compileï¼å è½½æ­£åè§åå­ç¬¦ä¸²ï¼ç¶åè¿åä¸ä¸ª Pattern å¯¹è±¡ã\n\nä¸Patternç±»ä¸æ ·ï¼Matcherç±»ä¹æ²¡æå¬å±æé æ¹æ³ãä½ éè¦è°ç¨Patternå¯¹è±¡çmatcheræ¹æ³æ¥è·å¾ä¸ä¸ªMatcherå¯¹è±¡ã\n\nãç¤ºä¾ãPattern å Matcher çåå§å\n\nPattern p = Pattern.compile(regex);\nMatcher m = p.matcher(content);\n\n\n\n# Matcher ç±»\n\nMatcher ç±»å¯ä»¥è¯´æ¯ java.util.regex ä¸­çæ ¸å¿ç±»ï¼å®æä¸ç±»åè½ï¼æ ¡éªãæ¥æ¾ãæ¿æ¢ã\n\n# æ ¡éª\n\nä¸ºäºæ ¡éªææ¬æ¯å¦ä¸æ­£åè§åå¹éï¼Matcher æä¾äºä»¥ä¸å ä¸ªè¿åå¼ä¸º boolean çæ¹æ³ã\n\nåºå·   æ¹æ³åè¯´æ\n1    **public boolean lookingAt() ** å°è¯å°ä»åºåå¼å¤´å¼å§çè¾å¥åºåä¸è¯¥æ¨¡å¼å¹éã\n2    **public boolean find() **å°è¯æ¥æ¾ä¸è¯¥æ¨¡å¼å¹éçè¾å¥åºåçä¸ä¸ä¸ªå­åºåã\n3    **public boolean find(int\n     startï¼**éç½®æ­¤å¹éå¨ï¼ç¶åå°è¯æ¥æ¾å¹éè¯¥æ¨¡å¼ãä»æå®ç´¢å¼å¼å§çè¾å¥åºåçä¸ä¸ä¸ªå­åºåã\n4    **public boolean matches() **å°è¯å°æ´ä¸ªåºåä¸æ¨¡å¼å¹éã\n\nå¦æä½ å»å»åä¸æ¸ä¸é¢çæ¥æ¾æ¹æ³æä»ä¹åºå«ï¼é£ä¹ä¸é¢ä¸ä¸ªä¾å­å°±å¯ä»¥è®©ä½ ç§æã\n\nãç¤ºä¾ãlookingAtãfindãmatches\n\npublic static void main(String[] args) {\n\tcheckLookingAt("hello", "helloworld");\n\tcheckLookingAt("world", "helloworld");\n\n\tcheckFind("hello", "helloworld");\n\tcheckFind("world", "helloworld");\n\n\tcheckMatches("hello", "helloworld");\n\tcheckMatches("world", "helloworld");\n\tcheckMatches("helloworld", "helloworld");\n}\n\nprivate static void checkLookingAt(String regex, String content) {\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tif (m.lookingAt()) {\n\t\tSystem.out.println(content + "\\tlookingAtï¼ " + regex);\n\t} else {\n\t\tSystem.out.println(content + "\\tnot lookingAtï¼ " + regex);\n\t}\n}\n\nprivate static void checkFind(String regex, String content) {\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tif (m.find()) {\n\t\tSystem.out.println(content + "\\tfindï¼ " + regex);\n\t} else {\n\t\tSystem.out.println(content + "\\tnot findï¼ " + regex);\n\t}\n}\n\nprivate static void checkMatches(String regex, String content) {\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tif (m.matches()) {\n\t\tSystem.out.println(content + "\\tmatchesï¼ " + regex);\n\t} else {\n\t\tSystem.out.println(content + "\\tnot matchesï¼ " + regex);\n\t}\n}\n\n\nè¾åºï¼\n\nhelloworld\tlookingAtï¼ hello\nhelloworld\tnot lookingAtï¼ world\nhelloworld\tfindï¼ hello\nhelloworld\tfindï¼ world\nhelloworld\tnot matchesï¼ hello\nhelloworld\tnot matchesï¼ world\nhelloworld\tmatchesï¼ helloworld\n\n\nè¯´æ\n\nregex = "world" è¡¨ç¤ºçæ­£åè§åæ¯ä»¥ world å¼å¤´çå­ç¬¦ä¸²ï¼regex = "hello" å regex = "helloworld" ä¹æ¯åçã\n\n * lookingAtæ¹æ³ä»å¤´é¨å¼å§ï¼æ£æ¥ content å­ç¬¦ä¸²æ¯å¦æå­å­ç¬¦ä¸²äºæ­£åè§åå¹éã\n * findæ¹æ³æ£æ¥ content å­ç¬¦ä¸²æ¯å¦æå­å­ç¬¦ä¸²äºæ­£åè§åå¹éï¼ä¸ç®¡å­ç¬¦ä¸²æå¨ä½ç½®ã\n * matchesæ¹æ³æ£æ¥ content å­ç¬¦ä¸²æ´ä½æ¯å¦ä¸æ­£åè§åå¹éã\n\n# æ¥æ¾\n\nä¸ºäºæ¥æ¾ææ¬å¹éæ­£åè§åçä½ç½®ï¼Matcheræä¾äºä»¥ä¸æ¹æ³ï¼\n\nåºå·   æ¹æ³åè¯´æ\n1    **public int start() **è¿åä»¥åå¹éçåå§ç´¢å¼ã\n2    public int start(int group) è¿åå¨ä»¥åçå¹éæä½æé´ï¼ç±ç»å®ç»ææè·çå­åºåçåå§ç´¢å¼\n3    **public int end()**è¿åæåå¹éå­ç¬¦ä¹åçåç§»éã\n4    **public int end(int\n     group)**è¿åå¨ä»¥åçå¹éæä½æé´ï¼ç±ç»å®ç»ææè·å­åºåçæåå­ç¬¦ä¹åçåç§»éã\n5    **public String group()**è¿ååä¸ä¸ªç¬¦åå¹éæ¡ä»¶çå­åºåã\n6    **public String group(int group)**è¿åæå®çç¬¦åå¹éæ¡ä»¶çå­åºåã\n\nãç¤ºä¾ãä½¿ç¨ start()ãend()ãgroup() æ¥æ¾ææå¹éæ­£åæ¡ä»¶çå­åºå\n\npublic static void main(String[] args) {\n\tfinal String regex = "world";\n\tfinal String content = "helloworld helloworld";\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tSystem.out.println("content: " + content);\n\n\tint i = 0;\n\twhile (m.find()) {\n\t\ti++;\n\t\tSystem.out.println("[" + i + "th] found");\n\t\tSystem.out.print("start: " + m.start() + ", ");\n\t\tSystem.out.print("end: " + m.end() + ", ");\n\t\tSystem.out.print("group: " + m.group() + "\\n");\n\t}\n}\n\n\nè¾åº\n\ncontent: helloworld helloworld\n[1th] found\nstart: 5, end: 10, group: world\n[2th] found\nstart: 16, end: 21, group: world\n\n\nè¯´æ\n\nä¾å­å¾ç´ç½ï¼ä¸è¨èªæäºå§ã\n\n# æ¿æ¢\n\næ¿æ¢æ¹æ³æ¯æ¿æ¢è¾å¥å­ç¬¦ä¸²éææ¬çæ¹æ³ï¼\n\nåºå·   æ¹æ³åè¯´æ\n1    **public Matcher appendReplacement(StringBuffer sb, String\n     replacement)**å®ç°éç»ç«¯æ·»å åæ¿æ¢æ­¥éª¤ã\n2    **public StringBuffer appendTail(StringBuffer\n     sb)**å®ç°ç»ç«¯æ·»å åæ¿æ¢æ­¥éª¤ã\n3    **public String replaceAll(String replacement) **\n     æ¿æ¢æ¨¡å¼ä¸ç»å®æ¿æ¢å­ç¬¦ä¸²ç¸å¹éçè¾å¥åºåçæ¯ä¸ªå­åºåã\n4    public String replaceFirst(String replacement)\n     æ¿æ¢æ¨¡å¼ä¸ç»å®æ¿æ¢å­ç¬¦ä¸²å¹éçè¾å¥åºåçç¬¬ä¸ä¸ªå­åºåã\n5    **public static String quoteReplacement(String\n     s)**è¿åæå®å­ç¬¦ä¸²çå­é¢æ¿æ¢å­ç¬¦ä¸²ãè¿ä¸ªæ¹æ³è¿åä¸ä¸ªå­ç¬¦ä¸²ï¼å°±åä¼ éç» Matcher ç±»ç\n     appendReplacement æ¹æ³ä¸ä¸ªå­é¢å­ç¬¦ä¸²ä¸æ ·å·¥ä½ã\n\nãç¤ºä¾ãreplaceFirst å replaceAll\n\npublic static void main(String[] args) {\n\tString regex = "can";\n\tString replace = "can not";\n\tString content = "I can because I think I can.";\n\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\n\tSystem.out.println("content: " + content);\n\tSystem.out.println("replaceFirst: " + m.replaceFirst(replace));\n\tSystem.out.println("replaceAll: " + m.replaceAll(replace));\n}\n\n\nè¾åº\n\ncontent: I can because I think I can.\nreplaceFirst: I can not because I think I can.\nreplaceAll: I can not because I think I can not.\n\n\nè¯´æ\n\nreplaceFirstï¼æ¿æ¢ç¬¬ä¸ä¸ªå¹éæ­£åè§åçå­åºåã\n\nreplaceAllï¼æ¿æ¢ææå¹éæ­£åè§åçå­åºåã\n\nãç¤ºä¾ãappendReplacementãappendTail å replaceAll\n\npublic static void main(String[] args) {\n\tString regex = "can";\n\tString replace = "can not";\n\tString content = "I can because I think I can.";\n\tStringBuffer sb = new StringBuffer();\n\tStringBuffer sb2 = new StringBuffer();\n\n\tSystem.out.println("content: " + content);\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\twhile (m.find()) {\n\t\tm.appendReplacement(sb, replace);\n\t}\n\tSystem.out.println("appendReplacement: " + sb);\n\tm.appendTail(sb);\n\tSystem.out.println("appendTail: " + sb);\n}\n\n\nè¾åº\n\ncontent: I can because I think I can.\nappendReplacement: I can not because I think I can not\nappendTail: I can not because I think I can not.\n\n\nè¯´æ\n\nä»è¾åºç»æå¯ä»¥çåºï¼appendReplacementåappendTailæ¹æ³ç»åèµ·æ¥ç¨ï¼åè½åreplaceAllæ¯ä¸æ ·çã\n\nå¦æä½ æ¥çreplaceAllçæºç ï¼ä¼åç°å¶åé¨å°±æ¯ä½¿ç¨appendReplacementåappendTailæ¹æ³ç»åæ¥å®ç°çã\n\nãç¤ºä¾ãquoteReplacement å replaceAllï¼è§£å³ç¹æ®å­ç¬¦æ¿æ¢é®é¢\n\npublic static void main(String[] args) {\n\tString regex = "\\\\$\\\\{.*?\\\\}";\n\tString replace = "${product}";\n\tString content = "product is ${productName}.";\n\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tString replaceAll = m.replaceAll(replace);\n\n\tSystem.out.println("content: " + content);\n\tSystem.out.println("replaceAll: " + replaceAll);\n}\n\n\nè¾åº\n\nException in thread "main" java.lang.IllegalArgumentException: No group with name {product}\n\tat java.util.regex.Matcher.appendReplacement(Matcher.java:849)\n\tat java.util.regex.Matcher.replaceAll(Matcher.java:955)\n\tat org.zp.notes.javase.regex.RegexDemo.wrongMethod(RegexDemo.java:42)\n\tat org.zp.notes.javase.regex.RegexDemo.main(RegexDemo.java:18)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:147)\n\n\nè¯´æ\n\nString regex = "\\\\$\\\\{.*?\\\\}";è¡¨ç¤ºå¹éç±»ä¼¼${name}è¿æ ·çå­ç¬¦ä¸²ãç±äº$ã{ ã}é½æ¯ç¹æ®å­ç¬¦ï¼éè¦ç¨åä¹å­ç¬¦\\æ¥ä¿®é¥°æè½è¢«å½åä¸ä¸ªå­ç¬¦ä¸²å­ç¬¦æ¥å¤çã\n\nä¸é¢çä¾å­æ¯æ³å° ${productName} æ¿æ¢ä¸º ${product} ï¼ç¶èreplaceAllæ¹æ³å´å°ä¼ å¥çå­ç¬¦ä¸²ä¸­ç$å½åç¹æ®å­ç¬¦æ¥å¤çäºãç»æäº§çå¼å¸¸ã\n\nå¦ä½è§£å³è¿ä¸ªé®é¢?\n\nJDK1.5 å¼å¥äºquoteReplacementæ¹æ³ãå®å¯ä»¥ç¨æ¥è½¬æ¢ç¹æ®å­ç¬¦ãå¶å®æºç éå¸¸ç®åï¼å°±æ¯å¤æ­å­ç¬¦ä¸²ä¸­å¦ææ\\æ$ï¼å°±ä¸ºå®å ä¸ä¸ªè½¬ä¹å­ç¬¦\\\n\næä»¬å¯¹ä¸é¢çä»£ç ç¥ä½è°æ´ï¼\n\nm.replaceAll(replace)æ¹ä¸ºm.replaceAll(Matcher.quoteReplacement(replace))ï¼æ°ä»£ç å¦ä¸ï¼\n\npublic static void main(String[] args) {\n\tString regex = "\\\\$\\\\{.*?\\\\}";\n\tString replace = "${product}";\n\tString content = "product is ${productName}.";\n\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tString replaceAll = m.replaceAll(Matcher.quoteReplacement(replace));\n\n\tSystem.out.println("content: " + content);\n\tSystem.out.println("replaceAll: " + replaceAll);\n}\n\n\nè¾åº\n\ncontent: product is ${productName}.\nreplaceAll: product is ${product}.\n\n\nè¯´æ\n\nå­ç¬¦ä¸²ä¸­å¦ææ\\æ$ï¼ä¸è½è¢«æ­£å¸¸è§£æçé®é¢è§£å³ã\n\n\n# åå­ç¬¦\n\nåå­ç¬¦(metacharacters)å°±æ¯æ­£åè¡¨è¾¾å¼ä¸­å·æç¹æ®æä¹çä¸ç¨å­ç¬¦ã\n\n\n# åºæ¬åå­ç¬¦\n\næ­£åè¡¨è¾¾å¼çåå­ç¬¦é¾ä»¥è®°å¿ï¼å¾å¤§ç¨åº¦ä¸æ¯å ä¸ºæå¾å¤ä¸ºäºç®åè¡¨è¾¾èåºç°çç­ä»·å­ç¬¦ãèå®éä¸æåºæ¬çåå­ç¬¦ï¼å¹¶æ²¡æé£ä¹å¤ãå¯¹äºå¤§é¨åçåºæ¯ï¼åºæ¬åå­ç¬¦é½å¯ä»¥æå®ãè®©æä»¬ä»ä¸ä¸ªä¸ªå®ä¾åºåï¼ç±æµå¥æ·±çå»ä½ä¼æ­£åçå¥¥å¦ã\n\n# å¤éï¼|ï¼\n\nãç¤ºä¾ãå¹éä¸ä¸ªç¡®å®çå­ç¬¦ä¸²\n\ncheckMatches("abc", "abc");\n\n\nå¦æè¦å¹éä¸ä¸ªç¡®å®çå­ç¬¦ä¸²ï¼éå¸¸ç®åï¼å¦ä¾ 1 æç¤ºãä½æ¯ï¼å¦æä½ ä¸ç¡®å®è¦å¹éçå­ç¬¦ä¸²ï¼å¸ææå¤ä¸ªéæ©ï¼æä¹åï¼ç­æ¡æ¯ï¼ä½¿ç¨åå­ç¬¦| ï¼å®çå«ä¹æ¯æã\n\nãç¤ºä¾ãå¹éå¤ä¸ªå¯éçå­ç¬¦ä¸²\n\n// æµè¯æ­£åè¡¨è¾¾å¼å­ç¬¦ï¼|\nAssert.assertTrue(checkMatches("yes|no", "yes"));\nAssert.assertTrue(checkMatches("yes|no", "no"));\nAssert.assertFalse(checkMatches("yes|no", "right"));\n\n// è¾åº\n// yes\tmatchesï¼ yes|no\n// no\tmatchesï¼ yes|no\n// right\tnot matchesï¼ yes|no\n\n\n# åç»ï¼()ï¼\n\nå¦æä½ å¸æè¡¨è¾¾å¼ç±å¤ä¸ªå­è¡¨è¾¾å¼ç»æï¼ä½ å¯ä»¥ä½¿ç¨ ()ã\n\nãç¤ºä¾ãå¹éç»åå­ç¬¦ä¸²\n\nAssert.assertTrue(checkMatches("(play|end)(ing|ed)", "ended"));\nAssert.assertTrue(checkMatches("(play|end)(ing|ed)", "ending"));\nAssert.assertTrue(checkMatches("(play|end)(ing|ed)", "playing"));\nAssert.assertTrue(checkMatches("(play|end)(ing|ed)", "played"));\n\n// è¾åº\n// ended\tmatchesï¼ (play|end)(ing|ed)\n// ending\tmatchesï¼ (play|end)(ing|ed)\n// playing\tmatchesï¼ (play|end)(ing|ed)\n// played\tmatchesï¼ (play|end)(ing|ed)\n\n\n# æå®åå­ç¬¦ææèå´ï¼[]ï¼\n\nåé¢å±ç¤ºäºå¦ä½å¹éå­ç¬¦ä¸²ï¼ä½æ¯å¾å¤æ¶åä½ éè¦ç²¾ç¡®çå¹éä¸ä¸ªå­ç¬¦ï¼è¿æ¶å¯ä»¥ä½¿ç¨[] ã\n\nãç¤ºä¾ãå­ç¬¦å¨æå®èå´\n\n// æµè¯æ­£åè¡¨è¾¾å¼å­ç¬¦ï¼[]\nAssert.assertTrue(checkMatches("[abc]", "b"));  // å­ç¬¦åªè½æ¯aãbãc\nAssert.assertTrue(checkMatches("[a-z]", "m")); // å­ç¬¦åªè½æ¯a - z\nAssert.assertTrue(checkMatches("[A-Z]", "O")); // å­ç¬¦åªè½æ¯A - Z\nAssert.assertTrue(checkMatches("[a-zA-Z]", "K")); // å­ç¬¦åªè½æ¯a - zåA - Z\nAssert.assertTrue(checkMatches("[a-zA-Z]", "k"));\nAssert.assertTrue(checkMatches("[0-9]", "5")); // å­ç¬¦åªè½æ¯0 - 9\n\n// è¾åº\n// b\tmatchesï¼ [abc]\n// m\tmatchesï¼ [a-z]\n// O\tmatchesï¼ [A-Z]\n// K\tmatchesï¼ [a-zA-Z]\n// k\tmatchesï¼ [a-zA-Z]\n// 5\tmatchesï¼ [0-9]\n\n\n# æå®åå­ç¬¦æ æèå´ï¼ [^]ï¼\n\nãç¤ºä¾ãå­ç¬¦ä¸è½å¨æå®èå´\n\nå¦æéè¦å¹éä¸ä¸ªå­ç¬¦çéæä½ï¼å³å­ç¬¦ä¸è½å¨æå®èå´ï¼å¯ä»¥ä½¿ç¨[^]ã\n\n// æµè¯æ­£åè¡¨è¾¾å¼å­ç¬¦ï¼[^]\nAssert.assertFalse(checkMatches("[^abc]", "b")); // å­ç¬¦ä¸è½æ¯aãbãc\nAssert.assertFalse(checkMatches("[^a-z]", "m")); // å­ç¬¦ä¸è½æ¯a - z\nAssert.assertFalse(checkMatches("[^A-Z]", "O")); // å­ç¬¦ä¸è½æ¯A - Z\nAssert.assertFalse(checkMatches("[^a-zA-Z]", "K")); // å­ç¬¦ä¸è½æ¯a - zåA - Z\nAssert.assertFalse(checkMatches("[^a-zA-Z]", "k"));\nAssert.assertFalse(checkMatches("[^0-9]", "5")); // å­ç¬¦ä¸è½æ¯0 - 9\n\n// è¾åº\n// b\tnot matchesï¼ [^abc]\n// m\tnot matchesï¼ [^a-z]\n// O\tnot matchesï¼ [^A-Z]\n// K\tnot matchesï¼ [^a-zA-Z]\n// k\tnot matchesï¼ [^a-zA-Z]\n// 5\tnot matchesï¼ [^0-9]\n\n\n# éå¶å­ç¬¦æ°éï¼{}ï¼\n\nå¦ææ³è¦æ§å¶å­ç¬¦åºç°çæ¬¡æ°ï¼å¯ä»¥ä½¿ç¨ {}ã\n\nå­ç¬¦      æè¿°\n{n}     n æ¯ä¸ä¸ªéè´æ´æ°ãå¹éç¡®å®ç n æ¬¡ã\n{n,}    n æ¯ä¸ä¸ªéè´æ´æ°ãè³å°å¹é n æ¬¡ã\n{n,m}   m å n åä¸ºéè´æ´æ°ï¼å¶ä¸­ n <= mãæå°å¹é n æ¬¡ä¸æå¤å¹é m æ¬¡ã\n\nãç¤ºä¾ãéå¶å­ç¬¦åºç°æ¬¡æ°\n\n// {n}: n æ¯ä¸ä¸ªéè´æ´æ°ãå¹éç¡®å®ç n æ¬¡ã\ncheckMatches("ap{1}", "a");\ncheckMatches("ap{1}", "ap");\ncheckMatches("ap{1}", "app");\ncheckMatches("ap{1}", "apppppppppp");\n\n// {n,}: n æ¯ä¸ä¸ªéè´æ´æ°ãè³å°å¹é n æ¬¡ã\ncheckMatches("ap{1,}", "a");\ncheckMatches("ap{1,}", "ap");\ncheckMatches("ap{1,}", "app");\ncheckMatches("ap{1,}", "apppppppppp");\n\n// {n,m}: m å n åä¸ºéè´æ´æ°ï¼å¶ä¸­ n <= mãæå°å¹é n æ¬¡ä¸æå¤å¹é m æ¬¡ã\ncheckMatches("ap{2,5}", "a");\ncheckMatches("ap{2,5}", "ap");\ncheckMatches("ap{2,5}", "app");\ncheckMatches("ap{2,5}", "apppppppppp");\n\n// è¾åº\n// a\tnot matchesï¼ ap{1}\n// ap\tmatchesï¼ ap{1}\n// app\tnot matchesï¼ ap{1}\n// apppppppppp\tnot matchesï¼ ap{1}\n// a\tnot matchesï¼ ap{1,}\n// ap\tmatchesï¼ ap{1,}\n// app\tmatchesï¼ ap{1,}\n// apppppppppp\tmatchesï¼ ap{1,}\n// a\tnot matchesï¼ ap{2,5}\n// ap\tnot matchesï¼ ap{2,5}\n// app\tmatchesï¼ ap{2,5}\n// apppppppppp\tnot matchesï¼ ap{2,5}\n\n\n# è½¬ä¹å­ç¬¦ï¼/ï¼\n\nå¦ææ³è¦æ¥æ¾åå­ç¬¦æ¬èº«ï¼ä½ éè¦ä½¿ç¨è½¬ä¹ç¬¦ï¼ä½¿å¾æ­£åå¼æå°å¶è§ä½ä¸ä¸ªæ®éå­ç¬¦ï¼èä¸æ¯ä¸ä¸ªåå­ç¬¦å»å¤çã\n\n* çè½¬ä¹å­ç¬¦ï¼\\*\n+ çè½¬ä¹å­ç¬¦ï¼\\+\n? çè½¬ä¹å­ç¬¦ï¼\\?\n^ çè½¬ä¹å­ç¬¦ï¼\\^\n$ çè½¬ä¹å­ç¬¦ï¼\\$\n. çè½¬ä¹å­ç¬¦ï¼\\.\n\n\nå¦ææ¯è½¬ä¹ç¬¦ \\ æ¬èº«ï¼ä½ éè¦ä½¿ç¨ \\\\ ã\n\n# æå®è¡¨è¾¾å¼å­ç¬¦ä¸²çå¼å§ï¼^ï¼åç»å°¾ï¼$ï¼\n\nå¦æå¸æå¹éçå­ç¬¦ä¸²å¿é¡»ä»¥ç¹å®å­ç¬¦ä¸²å¼å¤´ï¼å¯ä»¥ä½¿ç¨ ^ ã\n\n> æ³¨æï¼è¯·ç¹å«çæï¼è¿éç ^ ä¸å®è¦å [^] ä¸­ç ^ åºåã\n\nãç¤ºä¾ãéå¶å­ç¬¦ä¸²å¤´é¨\n\nAssert.assertTrue(checkMatches("^app[a-z]{0,}", "apple")); // å­ç¬¦ä¸²å¿é¡»ä»¥appå¼å¤´\nAssert.assertFalse(checkMatches("^app[a-z]{0,}", "aplause"));\n\n// è¾åº\n// apple\tmatchesï¼ ^app[a-z]{0,}\n// aplause\tnot matchesï¼ ^app[a-z]{0,}\n\n\nå¦æå¸æå¹éçå­ç¬¦ä¸²å¿é¡»ä»¥ç¹å®å­ç¬¦ä¸²ç»å°¾ï¼å¯ä»¥ä½¿ç¨ $ ã\n\nãç¤ºä¾ãéå¶å­ç¬¦ä¸²å°¾é¨\n\nAssert.assertTrue(checkMatches("[a-z]{0,}ing$", "playing")); // å­ç¬¦ä¸²å¿é¡»ä»¥ingç»å°¾\nAssert.assertFalse(checkMatches("[a-z]{0,}ing$", "long"));\n\n// è¾åº\n// playing\tmatchesï¼ [a-z]{0,}ing$\n// long\tnot matchesï¼ [a-z]{0,}ing$\n\n\n\n# ç­ä»·å­ç¬¦\n\nç­ä»·å­ç¬¦ï¼é¡¾åæä¹ï¼å°±æ¯å¯¹äºåºæ¬åå­ç¬¦è¡¨è¾¾çä¸ç§ç®åï¼ç­ä»·å­ç¬¦çåè½é½å¯ä»¥éè¿åºæ¬åå­ç¬¦æ¥å®ç°ï¼ã\n\nå¨æ²¡æææ¡åºæ¬åå­ç¬¦ä¹åï¼å¯ä»¥åä¸ç¨çä¼ï¼å ä¸ºå¾å®¹ææäººç»æã\n\nç­ä»·å­ç¬¦çå¥½å¤å¨äºç®åäºåºæ¬åå­ç¬¦çåæ³ã\n\n# è¡¨ç¤ºæä¸ç±»åå­ç¬¦çç­ä»·å­ç¬¦\n\nä¸è¡¨ä¸­çç­ä»·å­ç¬¦é½è¡¨ç¤ºæä¸ç±»åçå­ç¬¦ã\n\nå­ç¬¦   æè¿°\n.    å¹éé¤â\\nâä¹å¤çä»»ä½åä¸ªå­ç¬¦ã\n\\d   å¹éä¸ä¸ªæ°å­å­ç¬¦ãç­ä»·äº[0-9]ã\n\\D   å¹éä¸ä¸ªéæ°å­å­ç¬¦ãç­ä»·äº[^0-9]ã\n\\w   å¹éåæ¬ä¸åçº¿çä»»ä½åè¯å­ç¬¦ãç±»ä¼¼ä½ä¸ç­ä»·äºâ[A-Za-z0-9_]âï¼è¿éçåè¯å­ç¬¦æçæ¯ Unicode å­ç¬¦éã\n\\W   å¹éä»»ä½éåè¯å­ç¬¦ã\n\\s   å¹éä»»ä½ä¸å¯è§å­ç¬¦ï¼åæ¬ç©ºæ ¼ãå¶è¡¨ç¬¦ãæ¢é¡µç¬¦ç­ç­ãç­ä»·äº[ \\f\\n\\r\\t\\v]ã\n\\S   å¹éä»»ä½å¯è§å­ç¬¦ãç­ä»·äº[ \\f\\n\\r\\t\\v]ã\n\nãç¤ºä¾ãåºæ¬ç­ä»·å­ç¬¦çç¨æ³\n\n// å¹éé¤â\\nâä¹å¤çä»»ä½åä¸ªå­ç¬¦\nAssert.assertTrue(checkMatches(".{1,}", "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"));\nAssert.assertTrue(checkMatches(".{1,}", "~!@#$%^&*()+`-=[]{};:<>,./?|\\\\"));\nAssert.assertFalse(checkMatches(".", "\\n"));\nAssert.assertFalse(checkMatches("[^\\n]", "\\n"));\n\n// å¹éä¸ä¸ªæ°å­å­ç¬¦ãç­ä»·äº[0-9]\nAssert.assertTrue(checkMatches("\\\\d{1,}", "0123456789"));\n// å¹éä¸ä¸ªéæ°å­å­ç¬¦ãç­ä»·äº[^0-9]\nAssert.assertFalse(checkMatches("\\\\D{1,}", "0123456789"));\n\n// å¹éåæ¬ä¸åçº¿çä»»ä½åè¯å­ç¬¦ãç±»ä¼¼ä½ä¸ç­ä»·äºâ[A-Za-z0-9_]âï¼è¿éçåè¯å­ç¬¦æçæ¯Unicodeå­ç¬¦é\nAssert.assertTrue(checkMatches("\\\\w{1,}", "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"));\nAssert.assertFalse(checkMatches("\\\\w{1,}", "~!@#$%^&*()+`-=[]{};:<>,./?|\\\\"));\n// å¹éä»»ä½éåè¯å­ç¬¦\nAssert.assertFalse(checkMatches("\\\\W{1,}", "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"));\nAssert.assertTrue(checkMatches("\\\\W{1,}", "~!@#$%^&*()+`-=[]{};:<>,./?|\\\\"));\n\n// å¹éä»»ä½ä¸å¯è§å­ç¬¦ï¼åæ¬ç©ºæ ¼ãå¶è¡¨ç¬¦ãæ¢é¡µç¬¦ç­ç­ãç­ä»·äº[ \\f\\n\\r\\t\\v]\nAssert.assertTrue(checkMatches("\\\\s{1,}", " \\f\\r\\n\\t"));\n// å¹éä»»ä½å¯è§å­ç¬¦ãç­ä»·äº[^ \\f\\n\\r\\t\\v]\nAssert.assertFalse(checkMatches("\\\\S{1,}", " \\f\\r\\n\\t"));\n\n// è¾åº\n// ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_\tmatchesï¼ .{1,}\n// ~!@#$%^&*()+`-=[]{};:<>,./?|\\\\\tmatchesï¼ .{1,}\n// \\n\tnot matchesï¼ .\n// \\n\tnot matchesï¼ [^\\n]\n// 0123456789\tmatchesï¼ \\\\d{1,}\n// 0123456789\tnot matchesï¼ \\\\D{1,}\n// ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_\tmatchesï¼ \\\\w{1,}\n// ~!@#$%^&*()+`-=[]{};:<>,./?|\\\\\tnot matchesï¼ \\\\w{1,}\n// ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_\tnot matchesï¼ \\\\W{1,}\n// ~!@#$%^&*()+`-=[]{};:<>,./?|\\\\\tmatchesï¼ \\\\W{1,}\n// \\f\\r\\n\\t\tmatchesï¼ \\\\s{1,}\n// \\f\\r\\n\\t\tnot matchesï¼ \\\\S{1,}\n\n\n# éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦\n\nå¨åºæ¬åå­ç¬¦ç« èä¸­ï¼å·²ç»ä»ç»äºéå¶å­ç¬¦æ°éçåºæ¬åå­ç¬¦ - {} ã\n\næ­¤å¤ï¼è¿æ *ã+ã? è¿ä¸ªä¸ä¸ªä¸ºäºç®ååæ³èåºç°çç­ä»·å­ç¬¦ï¼æä»¬æ¥è®¤è¯ä¸ä¸ã\n\nå­ç¬¦   æè¿°\n*    å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æå¤æ¬¡ãç­ä»·äº{0,}ã\n+    å¹éåé¢çå­è¡¨è¾¾å¼ä¸æ¬¡æå¤æ¬¡ãç­ä»·äº{1,}ã\n?    å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æä¸æ¬¡ãç­ä»·äº {0,1}ã\n\næ¡ä¾ éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦\n\n// *: å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æå¤æ¬¡ã* ç­ä»·äº{0,}ã\ncheckMatches("ap*", "a");\ncheckMatches("ap*", "ap");\ncheckMatches("ap*", "app");\ncheckMatches("ap*", "apppppppppp");\n\n// +: å¹éåé¢çå­è¡¨è¾¾å¼ä¸æ¬¡æå¤æ¬¡ã+ ç­ä»·äº {1,}ã\ncheckMatches("ap+", "a");\ncheckMatches("ap+", "ap");\ncheckMatches("ap+", "app");\ncheckMatches("ap+", "apppppppppp");\n\n// ?: å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æä¸æ¬¡ã? ç­ä»·äº {0,1}ã\ncheckMatches("ap?", "a");\ncheckMatches("ap?", "ap");\ncheckMatches("ap?", "app");\ncheckMatches("ap?", "apppppppppp");\n\n// è¾åº\n// a\tmatchesï¼ ap*\n// ap\tmatchesï¼ ap*\n// app\tmatchesï¼ ap*\n// apppppppppp\tmatchesï¼ ap*\n// a\tnot matchesï¼ ap+\n// ap\tmatchesï¼ ap+\n// app\tmatchesï¼ ap+\n// apppppppppp\tmatchesï¼ ap+\n// a\tmatchesï¼ ap?\n// ap\tmatchesï¼ ap?\n// app\tnot matchesï¼ ap?\n// apppppppppp\tnot matchesï¼ ap?\n\n\n# åå­ç¬¦ä¼åçº§é¡ºåº\n\næ­£åè¡¨è¾¾å¼ä»å·¦å°å³è¿è¡è®¡ç®ï¼å¹¶éµå¾ªä¼åçº§é¡ºåºï¼è¿ä¸ç®æ¯è¡¨è¾¾å¼éå¸¸ç±»ä¼¼ã\n\nä¸è¡¨ä»æé«å°æä½è¯´æäºåç§æ­£åè¡¨è¾¾å¼è¿ç®ç¬¦çä¼åçº§é¡ºåºï¼\n\nè¿ç®ç¬¦                    è¯´æ\n\\                      è½¬ä¹ç¬¦\n()ã(?:)ã(?=)ã[]        æ¬å·åä¸­æ¬å·\n*ã+ã?ã{n}ã{n,}ã{n,m}   éå®ç¬¦\n^ã$ã*ä»»ä½å­ç¬¦ãä»»ä½å­ç¬¦*        å®ä½ç¹ååºå\n|                      æ¿æ¢\n\nå­ç¬¦å·æé«äºæ¿æ¢è¿ç®ç¬¦çä¼åçº§ï¼ä½¿å¾ m|food å¹é m æ food ãè¥è¦å¹é mood æ food ï¼è¯·ä½¿ç¨æ¬å·åå»ºå­è¡¨è¾¾å¼ï¼ä»èäº§ç (m|f)ood ã\n\n\n# åç»æé \n\nå¨åºæ¬åå­ç¬¦ç« èï¼æå°äº () å­ç¬¦å¯ä»¥ç¨æ¥å¯¹è¡¨è¾¾å¼åç»ãå®éä¸åç»è¿ææ´å¤å¤æçç¨æ³ã\n\næè°åç»æé ï¼æ¯ç¨æ¥æè¿°æ­£åè¡¨è¾¾å¼çå­è¡¨è¾¾å¼ï¼ç¨äºæè·å­ç¬¦ä¸²ä¸­çå­å­ç¬¦ä¸²ã\n\n\n# æè·ä¸éæè·\n\nä¸è¡¨ä¸ºåç»æé ä¸­çæè·åéæè·åç±»ã\n\nè¡¨è¾¾å¼            æè¿°           æè·æéæè·\n(exp)          å¹éçå­è¡¨è¾¾å¼      æè·\n(?<name>exp)   å½åçååå¼ç¨      æè·\n(?:exp)        éæè·ç»         éæè·\n(?=exp)        é¶å®½åº¦æ­£é¢æµåè¡æ­è¨   éæè·\n(?!exp)        é¶å®½åº¦è´é¢æµåè¡æ­è¨   éæè·\n(?<=exp)       é¶å®½åº¦æ­£åé¡¾ååæ­è¨   éæè·\n(?<!exp)       é¶å®½åº¦è´åé¡¾ååæ­è¨   éæè·\n\n> æ³¨ï¼Java æ­£åå¼æä¸æ¯æå¹³è¡¡ç»ã\n\n\n# ååå¼ç¨\n\n# å¸¦ç¼å·çååå¼ç¨\n\nå¸¦ç¼å·çååå¼ç¨ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\\number\n\nå¶ä¸­number æ¯æ­£åè¡¨è¾¾å¼ä¸­æè·ç»çåºå·ä½ç½®ã ä¾å¦ï¼\\4 å¹éç¬¬åä¸ªæè·ç»çåå®¹ã å¦ææ­£åè¡¨è¾¾å¼æ¨¡å¼ä¸­æªå®ä¹numberï¼åå°åçåæéè¯¯\n\nãç¤ºä¾ãå¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯(ä¸å½åå­è¡¨è¾¾å¼)\n\n// (\\w+)\\s\\1\\W(\\w+) å¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯\nAssert.assertTrue(findAll("(\\\\w+)\\\\s\\\\1\\\\W(\\\\w+)",\n\t\t"He said that that was the the correct answer.") > 0);\n\n// è¾åº\n// regex = (\\w+)\\s\\1\\W(\\w+), content: He said that that was the the correct answer.\n// [1th] start: 8, end: 21, group: that that was\n// [2th] start: 22, end: 37, group: the the correct\n\n\nè¯´æï¼\n\n * (\\w+)ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã\n * \\sï¼ä¸ç©ºç½å­ç¬¦å¹éã\n * \\1ï¼å¹éç¬¬ä¸ä¸ªç»ï¼å³(\\w+)ã\n * \\Wï¼å¹éåæ¬ç©ºæ ¼åæ ç¹ç¬¦å·çä¸ä¸ªéåè¯å­ç¬¦ã è¿æ ·å¯ä»¥é²æ­¢æ­£åè¡¨è¾¾å¼æ¨¡å¼å¹éä»ç¬¬ä¸ä¸ªæè·ç»çåè¯å¼å¤´çåè¯ã\n\n# å½åçååå¼ç¨\n\nå½åååå¼ç¨éè¿ä½¿ç¨ä¸é¢çè¯­æ³è¿è¡å®ä¹ï¼\\k<name >\n\nãç¤ºä¾ãå¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯(å½åå­è¡¨è¾¾å¼)\n\n// (?<duplicateWord>\\w+)\\s\\k<duplicateWord>\\W(?<nextWord>\\w+) å¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯\nAssert.assertTrue(findAll("(?<duplicateWord>\\\\w+)\\\\s\\\\k<duplicateWord>\\\\W(?<nextWord>\\\\w+)",\n\t\t"He said that that was the the correct answer.") > 0);\n\n// è¾åº\n// regex = (?<duplicateWord>\\w+)\\s\\k<duplicateWord>\\W(?<nextWord>\\w+), content: He said that that was the the correct answer.\n// [1th] start: 8, end: 21, group: that that was\n// [2th] start: 22, end: 37, group: the the correct\n\n\nè¯´æï¼\n\n * (?<duplicateWord>\\w+)ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã å½åæ­¤æè·ç» duplicateWordã\n * \\s: ä¸ç©ºç½å­ç¬¦å¹éã\n * \\k<duplicateWord>ï¼å¹éåä¸º duplicateWord çæè·çç»ã\n * \\Wï¼å¹éåæ¬ç©ºæ ¼åæ ç¹ç¬¦å·çä¸ä¸ªéåè¯å­ç¬¦ã è¿æ ·å¯ä»¥é²æ­¢æ­£åè¡¨è¾¾å¼æ¨¡å¼å¹éä»ç¬¬ä¸ä¸ªæè·ç»çåè¯å¼å¤´çåè¯ã\n * (?<nextWord>\\w+)ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã å½åæ­¤æè·ç» nextWordã\n\n\n# éæè·ç»\n\n(?:exp) è¡¨ç¤ºå½ä¸ä¸ªéå®ç¬¦åºç¨å°ä¸ä¸ªç»ï¼ä½ç»æè·çå­å­ç¬¦ä¸²å¹¶éæéæ¶ï¼éå¸¸ä¼ä½¿ç¨éæè·ç»æé ã\n\nãç¤ºä¾ãå¹éä»¥.ç»æçè¯­å¥ã\n\n// å¹éç±å¥å·ç»æ­¢çè¯­å¥ã\nAssert.assertTrue(findAll("(?:\\\\b(?:\\\\w+)\\\\W*)+\\\\.", "This is a short sentence. Never end") > 0);\n\n// è¾åº\n// regex = (?:\\b(?:\\w+)\\W*)+\\., content: This is a short sentence. Never end\n// [1th] start: 0, end: 25, group: This is a short sentence.\n\n\n\n# é¶å®½æ­è¨\n\nç¨äºæ¥æ¾å¨æäºåå®¹(ä½å¹¶ä¸åæ¬è¿äºåå®¹)ä¹åæä¹åçä¸è¥¿ï¼ä¹å°±æ¯è¯´å®ä»¬å\\b,^,$é£æ ·ç¨äºæå®ä¸ä¸ªä½ç½®ï¼è¿ä¸ªä½ç½®åºè¯¥æ»¡è¶³ä¸å®çæ¡ä»¶(å³æ­è¨)ï¼å æ­¤å®ä»¬ä¹è¢«ç§°ä¸ºé¶å®½æ­è¨ã\n\nè¡¨è¾¾å¼        æè¿°\n(?=exp)    å¹é exp åé¢çä½ç½®\n(?<=exp)   å¹é exp åé¢çä½ç½®\n(?!exp)    å¹éåé¢è·çä¸æ¯ exp çä½ç½®\n(?<!exp)   å¹éåé¢ä¸æ¯ exp çä½ç½®\n\n# å¹é exp åé¢çä½ç½®\n\n(?=exp) è¡¨ç¤ºè¾å¥å­ç¬¦ä¸²å¿é¡»å¹éå­è¡¨è¾¾å¼ä¸­çæ­£åè¡¨è¾¾å¼æ¨¡å¼ï¼å°½ç®¡å¹éçå­å­ç¬¦ä¸²æªåå«å¨å¹éç»æä¸­ã\n\n// \\b\\w+(?=\\sis\\b) è¡¨ç¤ºè¦æè·isä¹åçåè¯\nAssert.assertTrue(findAll("\\\\b\\\\w+(?=\\\\sis\\\\b)", "The dog is a Malamute.") > 0);\nAssert.assertFalse(findAll("\\\\b\\\\w+(?=\\\\sis\\\\b)", "The island has beautiful birds.") > 0);\nAssert.assertFalse(findAll("\\\\b\\\\w+(?=\\\\sis\\\\b)", "The pitch missed home plate.") > 0);\nAssert.assertTrue(findAll("\\\\b\\\\w+(?=\\\\sis\\\\b)", "Sunday is a weekend day.") > 0);\n\n// è¾åº\n// regex = \\b\\w+(?=\\sis\\b), content: The dog is a Malamute.\n// [1th] start: 4, end: 7, group: dog\n// regex = \\b\\w+(?=\\sis\\b), content: The island has beautiful birds.\n// not found\n// regex = \\b\\w+(?=\\sis\\b), content: The pitch missed home plate.\n// not found\n// regex = \\b\\w+(?=\\sis\\b), content: Sunday is a weekend day.\n// [1th] start: 0, end: 6, group: Sunday\n\n\nè¯´æï¼\n\n * \\bï¼å¨åè¯è¾¹çå¤å¼å§å¹éã\n * \\w+ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã\n * (?=\\sis\\b)ï¼ç¡®å®åè¯å­ç¬¦æ¯å¦åæ¥ç©ºç½å­ç¬¦åå­ç¬¦ä¸²âisâï¼å¶å¨åè¯è¾¹çå¤ç»æã å¦æå¦æ­¤ï¼åå¹éæåã\n\n# å¹é exp åé¢çä½ç½®\n\n(?<=exp) è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾å¨è¾å¥å­ç¬¦ä¸²å½åä½ç½®å·¦ä¾§åºç°ï¼å°½ç®¡å­è¡¨è¾¾å¼æªåå«å¨å¹éç»æä¸­ãé¶å®½åº¦æ­£åé¡¾ååæ­è¨ä¸ä¼åæº¯ã\n\n// (?<=\\b20)\\d{2}\\b è¡¨ç¤ºè¦æè·ä»¥20å¼å¤´çæ°å­çåé¢é¨å\nAssert.assertTrue(findAll("(?<=\\\\b20)\\\\d{2}\\\\b", "2010 1999 1861 2140 2009") > 0);\n\n// è¾åº\n// regex = (?<=\\b20)\\d{2}\\b, content: 2010 1999 1861 2140 2009\n// [1th] start: 2, end: 4, group: 10\n// [2th] start: 22, end: 24, group: 09\n\n\nè¯´æï¼\n\n * \\d{2}ï¼å¹éä¸¤ä¸ªåè¿å¶æ°å­ã\n * {?<=\\b20)ï¼å¦æä¸¤ä¸ªåè¿å¶æ°å­çå­è¾¹çä»¥å°æ°ä½æ°â20âå¼å¤´ï¼åç»§ç»­å¹éã\n * \\bï¼å¨åè¯è¾¹çå¤ç»æå¹éã\n\n# å¹éåé¢è·çä¸æ¯ exp çä½ç½®\n\n(?!exp) è¡¨ç¤ºè¾å¥å­ç¬¦ä¸²ä¸å¾å¹éå­è¡¨è¾¾å¼ä¸­çæ­£åè¡¨è¾¾å¼æ¨¡å¼ï¼å°½ç®¡å¹éçå­å­ç¬¦ä¸²æªåå«å¨å¹éç»æä¸­ã\n\nãç¤ºä¾ãæè·æªä»¥âunâå¼å¤´çåè¯\n\n// \\b(?!un)\\w+\\b è¡¨ç¤ºè¦æè·æªä»¥âunâå¼å¤´çåè¯\nAssert.assertTrue(findAll("\\\\b(?!un)\\\\w+\\\\b", "unite one unethical ethics use untie ultimate") > 0);\n\n// è¾åº\n// regex = \\b(?!un)\\w+\\b, content: unite one unethical ethics use untie ultimate\n// [1th] start: 6, end: 9, group: one\n// [2th] start: 20, end: 26, group: ethics\n// [3th] start: 27, end: 30, group: use\n// [4th] start: 37, end: 45, group: ultimate\n\n\nè¯´æï¼\n\n * \\bï¼å¨åè¯è¾¹çå¤å¼å§å¹éã\n * (?!un)ï¼ç¡®å®æ¥ä¸æ¥çä¸¤ä¸ªçå­ç¬¦æ¯å¦ä¸ºâunâã å¦ææ²¡æï¼åå¯è½å¹éã\n * \\w+ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã\n * \\bï¼å¨åè¯è¾¹çå¤ç»æå¹éã\n\n# å¹éåé¢ä¸æ¯ exp çä½ç½®\n\n(?<!exp) è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾å¨è¾å¥å­ç¬¦ä¸²å½åä½ç½®çå·¦ä¾§åºç°ã ä½æ¯ï¼ä»»ä½ä¸å¹éå­è¡¨è¾¾å¼ çå­å­ç¬¦ä¸²ä¸åå«å¨å¹éç»æä¸­ã\n\nãç¤ºä¾ãæè·ä»»æå·¥ä½æ¥\n\n// (?<!(Saturday|Sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b è¡¨ç¤ºè¦æè·ä»»æå·¥ä½æ¥ï¼å³å¨ä¸å°å¨äºï¼\nAssert.assertTrue(findAll("(?<!(Saturday|Sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "Monday February 1, 2010") > 0);\nAssert.assertTrue(findAll("(?<!(Saturday|Sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "Wednesday February 3, 2010") > 0);\nAssert.assertFalse(findAll("(?<!(Saturday|Sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "Saturday February 6, 2010") > 0);\nAssert.assertFalse(findAll("(?<!(Saturday|Sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "Sunday February 7, 2010") > 0);\nAssert.assertTrue(findAll("(?<!(Saturday|Sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "Monday, February 8, 2010") > 0);\n\n// è¾åº\n// regex = (?<!(Saturday|Sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: Monday February 1, 2010\n// [1th] start: 7, end: 23, group: February 1, 2010\n// regex = (?<!(Saturday|Sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: Wednesday February 3, 2010\n// [1th] start: 10, end: 26, group: February 3, 2010\n// regex = (?<!(Saturday|Sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: Saturday February 6, 2010\n// not found\n// regex = (?<!(Saturday|Sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: Sunday February 7, 2010\n// not found\n// regex = (?<!(Saturday|Sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: Monday, February 8, 2010\n// [1th] start: 8, end: 24, group: February 8, 2010\n\n\n\n# è´ªå©ªä¸ææ°\n\nå½æ­£åè¡¨è¾¾å¼ä¸­åå«è½æ¥åéå¤çéå®ç¬¦æ¶ï¼éå¸¸çè¡ä¸ºæ¯ï¼å¨ä½¿æ´ä¸ªè¡¨è¾¾å¼è½å¾å°å¹éçåæä¸ï¼å¹éå°½å¯è½å¤çå­ç¬¦ãä»¥è¿ä¸ªè¡¨è¾¾å¼ä¸ºä¾ï¼a.*bï¼å®å°ä¼å¹éæé¿çä»¥ a å¼å§ï¼ä»¥ b ç»æçå­ç¬¦ä¸²ãå¦æç¨å®æ¥æç´¢ aabab çè¯ï¼å®ä¼å¹éæ´ä¸ªå­ç¬¦ä¸² aababãè¿è¢«ç§°ä¸ºè´ªå©ªå¹éã\n\nææ¶ï¼æä»¬æ´éè¦ææ°å¹éï¼ä¹å°±æ¯å¹éå°½å¯è½å°çå­ç¬¦ãåé¢ç»åºçéå®ç¬¦é½å¯ä»¥è¢«è½¬åä¸ºææ°å¹éæ¨¡å¼ï¼åªè¦å¨å®åé¢å ä¸ä¸ä¸ªé®å·?ãè¿æ ·.*?å°±æå³çå¹éä»»ææ°éçéå¤ï¼ä½æ¯å¨è½ä½¿æ´ä¸ªå¹éæåçåæä¸ä½¿ç¨æå°çéå¤ã\n\nè¡¨è¾¾å¼      æè¿°\n*?       éå¤ä»»ææ¬¡ï¼ä½å°½å¯è½å°éå¤\n+?       éå¤ 1 æ¬¡ææ´å¤æ¬¡ï¼ä½å°½å¯è½å°éå¤\n??       éå¤ 0 æ¬¡æ 1 æ¬¡ï¼ä½å°½å¯è½å°éå¤\n{n,m}?   éå¤ n å° m æ¬¡ï¼ä½å°½å¯è½å°éå¤\n{n,}?    éå¤ n æ¬¡ä»¥ä¸ï¼ä½å°½å¯è½å°éå¤\n\nãç¤ºä¾ãJava æ­£åä¸­è´ªå©ªä¸ææ°çç¤ºä¾\n\n// è´ªå©ªå¹é\nAssert.assertTrue(findAll("a\\\\w*b", "abaabaaabaaaab") > 0);\n\n// ææ°å¹é\nAssert.assertTrue(findAll("a\\\\w*?b", "abaabaaabaaaab") > 0);\nAssert.assertTrue(findAll("a\\\\w+?b", "abaabaaabaaaab") > 0);\nAssert.assertTrue(findAll("a\\\\w??b", "abaabaaabaaaab") > 0);\nAssert.assertTrue(findAll("a\\\\w{0,4}?b", "abaabaaabaaaab") > 0);\nAssert.assertTrue(findAll("a\\\\w{3,}?b", "abaabaaabaaaab") > 0);\n\n// è¾åº\n// regex = a\\w*b, content: abaabaaabaaaab\n// [1th] start: 0, end: 14, group: abaabaaabaaaab\n// regex = a\\w*?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 2, group: ab\n// [2th] start: 2, end: 5, group: aab\n// [3th] start: 5, end: 9, group: aaab\n// [4th] start: 9, end: 14, group: aaaab\n// regex = a\\w+?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 5, group: abaab\n// [2th] start: 5, end: 9, group: aaab\n// [3th] start: 9, end: 14, group: aaaab\n// regex = a\\w??b, content: abaabaaabaaaab\n// [1th] start: 0, end: 2, group: ab\n// [2th] start: 2, end: 5, group: aab\n// [3th] start: 6, end: 9, group: aab\n// [4th] start: 11, end: 14, group: aab\n// regex = a\\w{0,4}?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 2, group: ab\n// [2th] start: 2, end: 5, group: aab\n// [3th] start: 5, end: 9, group: aaab\n// [4th] start: 9, end: 14, group: aaaab\n// regex = a\\w{3,}?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 5, group: abaab\n// [2th] start: 5, end: 14, group: aaabaaaab\n\n\nè¯´æï¼\n\næ¬ä¾ä¸­ä»£ç å±ç¤ºçæ¯ä½¿ç¨ä¸åè´ªå©ªæææ°ç­ç¥å»æ¥æ¾å­ç¬¦ä¸² abaabaaabaaaab ä¸­å¹éä»¥ a å¼å¤´ï¼ä»¥ b ç»å°¾çææå­å­ç¬¦ä¸²ãè¯·ä»è¾åºç»æä¸­ï¼ç»ç»ä½å³ä½¿ç¨ä¸åçè´ªå©ªæææ°ç­ç¥ï¼å¯¹äºå¹éå­å­ç¬¦ä¸²æä»ä¹å½±åã\n\n\n# æ­£åéå½\n\n\n# å¹éæ­£åå­ç¬¦ä¸²çæ¹æ³\n\nç±äºæ­£åè¡¨è¾¾å¼ä¸­å¾å¤åå­ç¬¦æ¬èº«å°±æ¯è½¬ä¹å­ç¬¦ï¼å¨ Java å­ç¬¦ä¸²çè§åä¸­ä¸ä¼è¢«æ¾ç¤ºåºæ¥ã\n\nä¸ºæ­¤ï¼å¯ä»¥ä½¿ç¨ä¸ä¸ªå·¥å·ç±»org.apache.commons.lang3.StringEscapeUtilsæ¥åç¹æ®å¤çï¼ä½¿å¾è½¬ä¹å­ç¬¦å¯ä»¥æå°ãè¿ä¸ªå·¥å·ç±»æä¾çé½æ¯éææ¹æ³ï¼ä»æ¹æ³å½åå¤§è´ä¹å¯ä»¥çåºç¨æ³ï¼è¿éä¸å¤åè¯´æã\n\nå¦æä½ äºè§£ mavenï¼å¯ä»¥ç´æ¥å¼å¥ä¾èµ\n\n<dependency>\n  <groupId>org.apache.commons</groupId>\n  <artifactId>commons-lang3</artifactId>\n  <version>${commons-lang3.version}</version>\n</dependency>\n\n\nãç¤ºä¾ãæ¬æä¸ºäºå±ç¤ºæ­£åå¹éè§åç¨å°çæ¹æ³\n\nprivate boolean checkMatches(String regex, String content) {\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tboolean flag = m.matches();\n\tif (m.matches()) {\n\t\tSystem.out.println(StringEscapeUtils.escapeJava(content) + "\\tmatchesï¼ " + StringEscapeUtils.escapeJava(regex));\n\t} else {\n\t\tSystem.out.println(StringEscapeUtils.escapeJava(content) + "\\tnot matchesï¼ " + StringEscapeUtils.escapeJava(regex));\n\t}\n\treturn flag;\n}\n\npublic int findAll(String regex, String content) {\n\tPattern p = Pattern.compile(regex);\n\tMatcher m = p.matcher(content);\n\tSystem.out.println("regex = " + regex + ", content: " + content);\n\n\tint count = 0;\n\twhile (m.find()) {\n\t\tcount++;\n\t\tSystem.out.println("[" + count + "th] " + "start: " + m.start() + ", end: " + m.end()\n\t\t\t\t+ ", group: " + m.group());\n\t}\n\tif (0 == count) {\n\t\tSystem.out.println("not found");\n\t}\n\treturn count;\n}\n\n\n\n# éæ¥åå­ç¬¦å­å¸\n\nä¸ºäºæ¹ä¾¿å¿«æ¥æ­£åçåå­ç¬¦å«ä¹ï¼å¨æ¬èæ ¹æ®åå­ç¬¦çåè½éä¸­ç½åæ­£åçåç§åå­ç¬¦ã\n\n# éå®ç¬¦\n\nå­ç¬¦      æè¿°\n*       å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æå¤æ¬¡ãä¾å¦ï¼zo* è½å¹é "z" ä»¥å "zoo"ã* ç­ä»·äº{0,}ã\n+       å¹éåé¢çå­è¡¨è¾¾å¼ä¸æ¬¡æå¤æ¬¡ãä¾å¦ï¼\'zo+\' è½å¹é "zo" ä»¥å "zoo"ï¼ä½ä¸è½å¹é "z"ã+ ç­ä»·äº\n        {1,}ã\n?       å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æä¸æ¬¡ãä¾å¦ï¼"do(es)?" å¯ä»¥å¹é "do" æ "does" ä¸­ç"do" ã? ç­ä»·äº\n        {0,1}ã\n{n}     n æ¯ä¸ä¸ªéè´æ´æ°ãå¹éç¡®å®ç n æ¬¡ãä¾å¦ï¼\'o{2}\' ä¸è½å¹é "Bob" ä¸­ç \'o\'ï¼ä½æ¯è½å¹é "food"\n        ä¸­çä¸¤ä¸ª oã\n{n,}    n æ¯ä¸ä¸ªéè´æ´æ°ãè³å°å¹é n æ¬¡ãä¾å¦ï¼\'o{2,}\' ä¸è½å¹é "Bob" ä¸­ç \'o\'ï¼ä½è½å¹é\n        "foooood" ä¸­çææ oã\'o{1,}\' ç­ä»·äº \'o+\'ã\'o{0,}\' åç­ä»·äº \'o*\'ã\n{n,m}   m å n åä¸ºéè´æ´æ°ï¼å¶ä¸­ n <= mãæå°å¹é n æ¬¡ä¸æå¤å¹é m æ¬¡ãä¾å¦ï¼"o{1,3}" å°å¹é\n        "fooooood" ä¸­çåä¸ä¸ª oã\'o{0,1}\' ç­ä»·äº \'o?\'ãè¯·æ³¨æå¨éå·åä¸¤ä¸ªæ°ä¹é´ä¸è½æç©ºæ ¼ã\n\n# å®ä½ç¬¦\n\nå­ç¬¦   æè¿°\n^    å¹éè¾å¥å­ç¬¦ä¸²å¼å§çä½ç½®ãå¦æè®¾ç½®äº RegExp å¯¹è±¡ç Multiline å±æ§ï¼^ è¿ä¼ä¸ \\n æ \\r\n     ä¹åçä½ç½®å¹éã\n$    å¹éè¾å¥å­ç¬¦ä¸²ç»å°¾çä½ç½®ãå¦æè®¾ç½®äº RegExp å¯¹è±¡ç Multiline å±æ§ï¼$ è¿ä¼ä¸ \\n æ \\r\n     ä¹åçä½ç½®å¹éã\n\\b   å¹éä¸ä¸ªå­è¾¹çï¼å³å­ä¸ç©ºæ ¼é´çä½ç½®ã\n\\B   éå­è¾¹çå¹éã\n\n# éæå°å­ç¬¦\n\nå­ç¬¦    æè¿°\n\\cx   å¹éç± x ææçæ§å¶å­ç¬¦ãä¾å¦ï¼ \\cM å¹éä¸ä¸ª Control-M æåè½¦ç¬¦ãx çå¼å¿é¡»ä¸º A-Z æ a-z\n      ä¹ä¸ãå¦åï¼å° c è§ä¸ºä¸ä¸ªåä¹ç \'c\' å­ç¬¦ã\n\\f    å¹éä¸ä¸ªæ¢é¡µç¬¦ãç­ä»·äº \\x0c å \\cLã\n\\n    å¹éä¸ä¸ªæ¢è¡ç¬¦ãç­ä»·äº \\x0a å \\cJã\n\\r    å¹éä¸ä¸ªåè½¦ç¬¦ãç­ä»·äº \\x0d å \\cMã\n\\s    å¹éä»»ä½ç©ºç½å­ç¬¦ï¼åæ¬ç©ºæ ¼ãå¶è¡¨ç¬¦ãæ¢é¡µç¬¦ç­ç­ãç­ä»·äº [ \\f\\n\\r\\t\\v]ã\n\\S    å¹éä»»ä½éç©ºç½å­ç¬¦ãç­ä»·äº [ \\f\\n\\r\\t\\v]ã\n\\t    å¹éä¸ä¸ªå¶è¡¨ç¬¦ãç­ä»·äº \\x09 å \\cIã\n\\v    å¹éä¸ä¸ªåç´å¶è¡¨ç¬¦ãç­ä»·äº \\x0b å \\cKã\n\n# åç»\n\nè¡¨è¾¾å¼            æè¿°\n(exp)          å¹éçå­è¡¨è¾¾å¼ã()ä¸­çåå®¹å°±æ¯å­è¡¨è¾¾å¼ã\n(?<name>exp)   å½åçå­è¡¨è¾¾å¼ï¼ååå¼ç¨ï¼ã\n(?:exp)        éæè·ç»ï¼è¡¨ç¤ºå½ä¸ä¸ªéå®ç¬¦åºç¨å°ä¸ä¸ªç»ï¼ä½ç»æè·çå­å­ç¬¦ä¸²å¹¶éæéæ¶ï¼éå¸¸ä¼ä½¿ç¨éæè·ç»æé ã\n(?=exp)        å¹é exp åé¢çä½ç½®ã\n(?<=exp)       å¹é exp åé¢çä½ç½®ã\n(?!exp)        å¹éåé¢è·çä¸æ¯ exp çä½ç½®ã\n(?<!exp)       å¹éåé¢ä¸æ¯ exp çä½ç½®ã\n\n# ç¹æ®ç¬¦å·\n\nå­ç¬¦   æè¿°\n\\    å°ä¸ä¸ä¸ªå­ç¬¦æ è®°ä¸ºæç¹æ®å­ç¬¦ãæåä¹å­ç¬¦ãæååå¼ç¨ãæå«è¿å¶è½¬ä¹ç¬¦ãä¾å¦ï¼ \'n\' å¹éå­ç¬¦ \'n\'ã\'\\n\'\n     å¹éæ¢è¡ç¬¦ãåºå \'\\\' å¹é ""ï¼è \'(\' åå¹é "("ã\n\\|   ææä¸¤é¡¹ä¹é´çä¸ä¸ªéæ©ã\n[]   å¹éæ¹æ¬å·èå´åçä»»æä¸ä¸ªå­ç¬¦ãå½¢å¼å¦ï¼[xyz]ã[^xyz]ã[a-z]ã[^a-z]ã[x,y,z]\n\n\n# æ­£åå®æ\n\nè½ç¶æ¬ç³»åæ´æ´æ´æ´çå¤§è°ç¹è°æ­£åè¡¨è¾¾å¼ãä½æ¯æè¿æ¯è¦å¨è¿éå»ºè®®ï¼å¦æä¸ä¸ªæ­£åè¡¨è¾¾å¼æ²¡æç»è¿ååæµè¯ï¼è¿æ¯è¦è°¨æä½¿ç¨ã\n\næ­£åæ¯æåååï¼å®å¯ä»¥ä¸ºä½ èçå¤§éçä»£ç è¡ãä½æ¯ç±äºå®ä¸æéè¯»ï¼ç»´æ¤èµ·æ¥å¯æ¯å¤´ç¼çå¦ï¼ä½ éè¦ä¸ä¸ªå­ç¬¦ä¸ä¸ªå­ç¬¦çå»çè§£ï¼ã\n\n\n# æå®ç¨çæ­£å\n\n# æ ¡éªä¸­æ\n\næ ¡éªå­ç¬¦ä¸²ä¸­åªè½æä¸­æå­ç¬¦ï¼ä¸åæ¬ä¸­ææ ç¹ç¬¦å·ï¼ãä¸­æå­ç¬¦ç Unicode ç¼ç èå´æ¯ \\u4e00 å° \\u9fa5ã\n\n> å¦æå´è¶£ï¼å¯ä»¥åèç¾åº¦ç¾ç§-Unicode ã\n\n^[\\u4e00-\\u9fa5]+$\n\n\n * å¹éï¼ æ¥ç ä¸è§æ\n * **ä¸å¹éï¼**æ¥ç ä¸è§æï¼\n\n# æ ¡éªèº«ä»½è¯å·ç \n\nèº«ä»½è¯ä¸º 15 ä½æ 18 ä½ã15 ä½æ¯ç¬¬ä¸ä»£èº«ä»½è¯ãä» 1999 å¹´ 10 æ 1 æ¥èµ·ï¼å¨å½å®è¡å¬æ°èº«ä»½è¯å·ç å¶åº¦ï¼å±æ°èº«ä»½è¯ç¼å·ç±å 15 ä½åè³ 18 ä½ã\n\n * 15 ä½èº«ä»½è¯ï¼ç± 15 ä½æ°å­ç»æãæåé¡ºåºä»å·¦è³å³ä¾æ¬¡ä¸ºï¼å­ä½æ°å­å°åºç ï¼å­ä½æ°å­åºçæ¥æï¼ä¸ä½é¡ºåºå·ï¼å¶ä¸­ 15 ä½ç·ä¸ºåæ°ï¼å¥³ä¸ºåæ°ã\n * 18 ä½èº«ä»½è¯ï¼ç±åä¸ä½æ°å­æ¬ä½ç åä¸ä½æ°å­æ ¡éªç ç»æãæåé¡ºåºä»å·¦è³å³ä¾æ¬¡ä¸ºï¼å­ä½æ°å­å°åºç ï¼å«ä½æ°å­åºçæ¥æï¼ä¸ä½æ°å­é¡ºåºç åä¸ä½æ°å­æ ¡éªç ï¼ä¹å¯è½æ¯ Xï¼ã\n\n> èº«ä»½è¯å·å«ä¹è¯¦æè¯·è§ï¼ç¾åº¦ç¾ç§-å±æ°èº«ä»½è¯å·ç \n\nå°åºç ï¼6 ä½ï¼\n\n(1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\\d{4}\n\n\nåºçæ¥æï¼8 ä½ï¼\n\næ³¨ï¼ä¸é¢çæ¯ 18 ä½èº«ä»½è¯çææåºçæ¥æï¼å¦ææ¯ 15 ä½èº«ä»½è¯ï¼åªè¦å°ç¬¬ä¸ä¸ª\\d{4}æ¹ä¸º\\d{2}å³å¯ã\n\n((\\d{4}((0[13578]|1[02])(0[1-9]|[12]\\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\\d|30)|02(0[1-9]|1\\d|2[0-8])))|([02468][048]|[13579][26])0229)\n\n\n15 ä½ææèº«ä»½è¯\n\n^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\\d{4})((\\d{2}((0[13578]|1[02])(0[1-9]|[12]\\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\\d|30)|02(0[1-9]|1\\d|2[0-8])))|([02468][048]|[13579][26])0229)(\\d{3})$\n\n\n * **å¹éï¼**110001700101031\n\n * **ä¸å¹éï¼**110001701501031\n\n18 ä½ææèº«ä»½è¯\n\n^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\\d{4})((\\d{4}((0[13578]|1[02])(0[1-9]|[12]\\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\\d|30)|02(0[1-9]|1\\d|2[0-8])))|([02468][048]|[13579][26])0229)(\\d{3}(\\d|X))$\n\n\n * **å¹éï¼**110001199001010310 | 11000019900101015X\n\n * **ä¸å¹éï¼**990000199001010310 | 110001199013010310\n\n# æ ¡éªææç¨æ·åãå¯ç \n\n**æè¿°ï¼**é¿åº¦ä¸º 6-18 ä¸ªå­ç¬¦ï¼åè®¸è¾å¥å­æ¯ãæ°å­ãä¸åçº¿ï¼é¦å­ç¬¦å¿é¡»ä¸ºå­æ¯ã\n\n^[a-zA-Z]\\w{5,17}$\n\n\n * **å¹éï¼**he_llo@worl.d.com | hel.l-o@wor-ld.museum | h1ello@123.com\n\n * **ä¸å¹éï¼**hello@worl_d.com | he&llo@world.co1 | .hello@wor#.co.uk\n\n# æ ¡éªé®ç®±\n\n**æè¿°ï¼**ä¸åè®¸ä½¿ç¨ IP ä½ä¸ºååï¼å¦ : hello@154.145.68.12\n\n@ç¬¦å·åçé®ç®±ç¨æ·å.ç¬¦å·åçåå(domain)å¿é¡»æ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * å­ç¬¦åªè½æ¯è±æå­æ¯ãæ°å­ãä¸åçº¿_ã.ã- ï¼\n * é¦å­ç¬¦å¿é¡»ä¸ºå­æ¯ææ°å­ï¼\n * _ã.ã- ä¸è½è¿ç»­åºç°ã\n\nååçæ ¹ååªè½ä¸ºå­æ¯ï¼ä¸è³å°ä¸ºä¸¤ä¸ªå­ç¬¦ã\n\n^[A-Za-z0-9](([_\\.\\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\\.\\-]?[a-zA-Z0-9]+)*)\\.([A-Za-z]{2,})$\n\n\n * **å¹éï¼**he_llo@worl.d.com | hel.l-o@wor-ld.museum | h1ello@123.com\n * **ä¸å¹éï¼**hello@worl_d.com | he&llo@world.co1 | .hello@wor#.co.uk\n\n# æ ¡éª URL\n\n**æè¿°ï¼**æ ¡éª URLãæ¯æ httpãhttpsãftpãftpsã\n\n^(ht|f)(tp|tps)\\://[a-zA-Z0-9\\-\\.]+\\.([a-zA-Z]{2,3})?(/\\S*)?$\n\n\n * **å¹éï¼**http://google.com/help/me | http://www.google.com/help/me/ | https://www.google.com/help.asp | ftp://www.google.com | ftps://google.org\n\n * **ä¸å¹éï¼**http://un/www.google.com/index.asp\n\n# æ ¡éªæ¶é´\n\n**æè¿°ï¼**æ ¡éªæ¶é´ãæ¶ãåãç§å¿é¡»æ¯æææ°å­ï¼å¦ææ°å¼ä¸æ¯ä¸¤ä½æ°ï¼åä½éè¦è¡¥é¶ã\n\n^([0-1][0-9]|[2][0-3]):([0-5][0-9])$\n\n\n * **å¹éï¼**00:00:00 | 23:59:59 | 17:06:30\n\n * **ä¸å¹éï¼**17:6:30 | 24:16:30\n\n# æ ¡éªæ¥æ\n\n**æè¿°ï¼**æ ¡éªæ¥æãæ¥ææ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * æ ¼å¼ yyyy-MM-dd æ yyyy-M-d\n * è¿å­ç¬¦å¯ä»¥æ²¡æææ¯â-âãâ/âãâ.âä¹ä¸\n * é°å¹´çäºæå¯ä»¥æ 29 æ¥ï¼èå¹³å¹´ä¸å¯ä»¥ã\n * ä¸ãä¸ãäºãä¸ãå«ãåãåäºæä¸º 31 æ¥ãåãå­ãä¹ãåä¸æä¸º 30 æ¥ã\n\n^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$\n\n\n * **å¹éï¼**2016/1/1 | 2016/01/01 | 20160101 | 2016-01-01 | 2016.01.01 | 2000-02-29\n * **ä¸å¹éï¼**2001-02-29 | 2016/12/32 | 2016/6/31 | 2016/13/1 | 2016/0/1\n\n# æ ¡éªä¸­å½ææºå·ç \n\n**æè¿°ï¼**ä¸­å½ææºå·ç æ­£ç¡®æ ¼å¼ï¼11 ä½æ°å­ã\n\n> ç§»å¨æ 16 ä¸ªå·æ®µï¼134ã135ã136ã137ã138ã139ã147ã150ã151ã152ã157ã158ã159ã182ã187ã188ãå¶ä¸­ 147ã157ã188 æ¯ 3G å·æ®µï¼å¶ä»é½æ¯ 2G å·æ®µãèéæ 7 ç§å·æ®µï¼130ã131ã132ã155ã156ã185ã186ãå¶ä¸­ 186 æ¯ 3Gï¼WCDMAï¼å·æ®µï¼å¶ä½ä¸º 2G å·æ®µãçµä¿¡æ 4 ä¸ªå·æ®µï¼133ã153ã180ã189ãå¶ä¸­ 189 æ¯ 3G å·æ®µï¼CDMA2000ï¼ï¼133 å·æ®µä¸»è¦ç¨ä½æ çº¿ç½å¡å·ãæ»ç»ï¼13 å¼å¤´ææºå· 0-9ï¼15 å¼å¤´ææºå· 0-3ã5-9ï¼18 å¼å¤´ææºå· 0ã2ã5-9ã\n> \n> æ­¤å¤ï¼ä¸­å½å¨å½éä¸çåºå·ä¸º 86ï¼æä»¥ææºå·å¼å¤´æ+86ã86 ä¹æ¯åæ³çã\n> \n> ä»¥ä¸ä¿¡æ¯æ¥æºäº ç¾åº¦ç¾ç§-ææºå·\n\n^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d{8}$\n\n\n * å¹éï¼+86 18012345678 | 86 18012345678 | 15812345678\n\n * **ä¸å¹éï¼**15412345678 | 12912345678 | 180123456789\n\n# æ ¡éªä¸­å½åºè¯å·ç \n\n**æè¿°ï¼**åºè¯å·ç ï¼å¿é¡»å åºå·ï¼ä»¥ 0 å¼å¤´ï¼ã 3 ä½ææåºå·ï¼010ã020~029ï¼åºè¯ä½æ°ä¸º 8 ä½ã 4 ä½ææåºå·ï¼03xx å¼å¤´å° 09xxï¼åºè¯ä½æ°ä¸º 7ã\n\n> å¦ææ³äºè§£æ´è¯¦ç»çä¿¡æ¯ï¼è¯·åè ç¾åº¦ç¾ç§-çµè¯åºå· ã\n\n^(010|02[0-9])(\\s|-)\\d{8}|(0[3-9]\\d{2})(\\s|-)\\d{7}$\n\n\n * **å¹éï¼**010-12345678 | 010 12345678 | 0512-1234567 | 0512 1234567\n\n * **ä¸å¹éï¼**1234567 | 12345678\n\n# æ ¡éª IPv4 å°å\n\n**æè¿°ï¼**IP å°åæ¯ä¸ä¸ª 32 ä½çäºè¿å¶æ°ï¼éå¸¸è¢«åå²ä¸º 4 ä¸ªâ8 ä½äºè¿å¶æ°âï¼ä¹å°±æ¯ 4 ä¸ªå­èï¼ãIP å°åéå¸¸ç¨âç¹ååè¿å¶âè¡¨ç¤ºæï¼a.b.c.dï¼çå½¢å¼ï¼å¶ä¸­ï¼a,b,c,d é½æ¯ 0~255 ä¹é´çåè¿å¶æ´æ°ã\n\n^([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\.([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\.([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\.([01]?\\d\\d?|2[0-4]\\d|25[0-5])$\n\n\n * **å¹éï¼**0.0.0.0 | 255.255.255.255 | 127.0.0.1\n\n * **ä¸å¹éï¼**10.10.10 | 10.10.10.256\n\n# æ ¡éª IPv6 å°å\n\n**æè¿°ï¼**IPv6 ç 128 ä½å°åéå¸¸åæ 8 ç»ï¼æ¯ç»ä¸ºåä¸ªåå­è¿å¶æ°çå½¢å¼ã\n\nIPv6 å°åå¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸å½¢å¼ï¼\n\n * IPv6 å°å\n * é¶åç¼© IPv6 å°å(section 2.2 of rfc5952)\n * å¸¦ææ¬å°é¾æ¥åºåç´¢å¼ç IPv6 å°å (section 11 of rfc4007)\n * åµå¥ IPv4 ç IPv6 å°å(section 2 of rfc6052\n * æ å° IPv4 ç IPv6 å°å (section 2.1 of rfc2765)\n * ç¿»è¯ IPv4 ç IPv6 å°å (section 2.1 of rfc2765)\n\n> æ¾ç¶ï¼IPv6 å°åçè¡¨ç¤ºæ¹å¼å¾å¤æãä½ ä¹å¯ä»¥åèï¼\n> \n> ç¾åº¦ç¾ç§-IPv6\n> \n> Stack overflow ä¸ç IPv6 æ­£åè¡¨è¾¾é«ç¥¨ç­æ¡\n\n(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\n\n\n * **å¹éï¼**1:2:3:4:5:6:7:8 | 1:: | 1::8 | 1::6:7:8 | 1::5:6:7:8 | 1::4:5:6:7:8 | 1::3:4:5:6:7:8 | ::2:3:4:5:6:7:8 | 1:2:3:4:5:6:7:: | 1:2:3:4:5:6::8 | 1:2:3:4:5::8 | 1:2:3:4::8 | 1:2:3::8 | 1:2::8 | 1::8 | ::8 | fe80::7:8%1 | ::255.255.255.255 | 2001:db8:3:4::192.0.2.33 | 64:ff9b::192.0.2.33\n\n * **ä¸å¹éï¼**1.2.3.4.5.6.7.8 | 1::2::3\n\n\n# ç¹å®å­ç¬¦\n\n * å¹éé¿åº¦ä¸º 3 çå­ç¬¦ä¸²ï¼^.{3}$ã\n * å¹éç± 26 ä¸ªè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[A-Za-z]+$ã\n * å¹éç± 26 ä¸ªå¤§åè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[A-Z]+$ã\n * å¹éç± 26 ä¸ªå°åè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[a-z]+$ã\n * å¹éç±æ°å­å 26 ä¸ªè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[A-Za-z0-9]+$ã\n * å¹éç±æ°å­ã26 ä¸ªè±æå­æ¯æèä¸åçº¿ç»æçå­ç¬¦ä¸²ï¼^\\w+$ã\n\n\n# ç¹å®æ°å­\n\n * å¹éæ­£æ´æ°ï¼^[1-9]\\d*$\n * å¹éè´æ´æ°ï¼^-[1-9]\\d*$\n * å¹éæ´æ°ï¼^(-?[1-9]\\d*)|0$\n * å¹éæ­£æµ®ç¹æ°ï¼^[1-9]\\d*\\.\\d+|0\\.\\d+$\n * å¹éè´æµ®ç¹æ°ï¼^-([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*)$\n * å¹éæµ®ç¹æ°ï¼^-?([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*|0?\\.0+|0)$\n\n\n# æ­£åè¡¨è¾¾å¼çæ§è½\n\nç®åå®ç°æ­£åè¡¨è¾¾å¼å¼æçæ¹å¼æä¸¤ç§ï¼DFA èªå¨æºï¼Deterministic Final Automata ç¡®å®æéç¶æèªå¨æºï¼å NFA èªå¨æºï¼Non deterministic Finite Automaton éç¡®å®æéç¶æèªå¨æºï¼ãå¯¹æ¯æ¥çï¼æé  DFA èªå¨æºçä»£ä»·è¿å¤§äº NFA èªå¨æºï¼ä½ DFA èªå¨æºçæ§è¡æçé«äº NFA èªå¨æºã\n\nåè®¾ä¸ä¸ªå­ç¬¦ä¸²çé¿åº¦æ¯ nï¼å¦æç¨ DFA èªå¨æºä½ä¸ºæ­£åè¡¨è¾¾å¼å¼æï¼åå¹éçæ¶é´å¤æåº¦ä¸º O(n)ï¼å¦æç¨ NFA èªå¨æºä½ä¸ºæ­£åè¡¨è¾¾å¼å¼æï¼ç±äº NFA èªå¨æºå¨å¹éè¿ç¨ä¸­å­å¨å¤§éçåæ¯ååæº¯ï¼åè®¾ NFA çç¶ææ°ä¸º sï¼åè¯¥å¹éç®æ³çæ¶é´å¤æåº¦ä¸º Oï¼nsï¼ã\n\nNFA èªå¨æºçä¼å¿æ¯æ¯ææ´å¤åè½ãä¾å¦ï¼æè· groupãç¯è§ãå æä¼åéè¯ç­é«çº§åè½ãè¿äºåè½é½æ¯åºäºå­è¡¨è¾¾å¼ç¬ç«è¿è¡å¹éï¼å æ­¤å¨ç¼ç¨è¯­è¨éï¼ä½¿ç¨çæ­£åè¡¨è¾¾å¼åºé½æ¯åºäº NFA å®ç°çã\n\n\n# NFA èªå¨æºçåæº¯\n\nç¨ NFA èªå¨æºå®ç°çæ¯è¾å¤æçæ­£åè¡¨è¾¾å¼ï¼å¨å¹éè¿ç¨ä¸­ç»å¸¸ä¼å¼èµ·åæº¯é®é¢ãå¤§éçåæº¯ä¼é¿æ¶é´å°å ç¨ CPUï¼ä»èå¸¦æ¥ç³»ç»æ§è½å¼éã\n\ntext=âabbcâ\nregex=âab{1,3}câ\n\n\nè¿ä¸ªä¾å­å¹éç®çæ¯ï¼å¹éä»¥ a å¼å¤´ï¼ä»¥ c ç»å°¾ï¼ä¸­é´æ 1-3 ä¸ª b å­ç¬¦çå­ç¬¦ä¸²ãNFA èªå¨æºå¯¹å¶è§£æçè¿ç¨æ¯è¿æ ·çï¼\n\n * è¯»åæ­£åè¡¨è¾¾å¼ç¬¬ä¸ä¸ªå¹éç¬¦ a åå­ç¬¦ä¸²ç¬¬ä¸ä¸ªå­ç¬¦ a è¿è¡æ¯è¾ï¼a å¯¹ aï¼å¹éã\n * ç¶åï¼è¯»åæ­£åè¡¨è¾¾å¼ç¬¬äºä¸ªå¹éç¬¦ b{1,3} åå­ç¬¦ä¸²çç¬¬äºä¸ªå­ç¬¦ b è¿è¡æ¯è¾ï¼å¹éãä½å ä¸º b{1,3} è¡¨ç¤º 1-3 ä¸ª b å­ç¬¦ä¸²ï¼NFA èªå¨æºåå·æè´ªå©ªç¹æ§ï¼æä»¥æ­¤æ¶ä¸ä¼ç»§ç»­è¯»åæ­£åè¡¨è¾¾å¼çä¸ä¸ä¸ªå¹éç¬¦ï¼èæ¯ä¾æ§ä½¿ç¨ b{1,3} åå­ç¬¦ä¸²çç¬¬ä¸ä¸ªå­ç¬¦ b è¿è¡æ¯è¾ï¼ç»æè¿æ¯å¹éã\n * æ¥çç»§ç»­ä½¿ç¨ b{1,3} åå­ç¬¦ä¸²çç¬¬åä¸ªå­ç¬¦ c è¿è¡æ¯è¾ï¼åç°ä¸å¹éäºï¼æ­¤æ¶å°±ä¼åçåæº¯ï¼å·²ç»è¯»åçå­ç¬¦ä¸²ç¬¬åä¸ªå­ç¬¦ c å°è¢«ååºå»ï¼æéåå°ç¬¬ä¸ä¸ªå­ç¬¦ b çä½ç½®ã\n * é£ä¹åçåæº¯ä»¥åï¼å¹éè¿ç¨æä¹ç»§ç»­å¢ï¼ç¨åºä¼è¯»åæ­£åè¡¨è¾¾å¼çä¸ä¸ä¸ªå¹éç¬¦ cï¼åå­ç¬¦ä¸²ä¸­çç¬¬åä¸ªå­ç¬¦ c è¿è¡æ¯è¾ï¼ç»æå¹éï¼ç»æã\n\n\n# å¦ä½é¿ååæº¯\n\n# è´ªå©ªæ¨¡å¼ï¼Greedyï¼\n\né¡¾åæä¹ï¼å°±æ¯å¨æ°éå¹éä¸­ï¼å¦æåç¬ä½¿ç¨ +ã ? ã* æ{min,max} ç­éè¯ï¼æ­£åè¡¨è¾¾å¼ä¼å¹éå°½å¯è½å¤çåå®¹ã\n\nä¾å¦ï¼ä¸è¾¹é£ä¸ªä¾å­ï¼\n\ntext=âabbcâ\nregex=âab{1,3}câ\n\n\nå°±æ¯å¨è´ªå©ªæ¨¡å¼ä¸ï¼NFA èªå¨æºè¯»åäºæå¤§çå¹éèå´ï¼å³å¹é 3 ä¸ª b å­ç¬¦ãå¹éåçäºä¸æ¬¡å¤±è´¥ï¼å°±å¼èµ·äºä¸æ¬¡åæº¯ãå¦æå¹éç»ææ¯âabbbcâï¼å°±ä¼å¹éæåã\n\ntext=âabbbcâ\nregex=âab{1,3}câ\n\n\n# ææ°æ¨¡å¼ï¼Reluctantï¼\n\nå¨è¯¥æ¨¡å¼ä¸ï¼æ­£åè¡¨è¾¾å¼ä¼å°½å¯è½å°å°éå¤å¹éå­ç¬¦ãå¦æå¹éæåï¼å®ä¼ç»§ç»­å¹éå©ä½çå­ç¬¦ä¸²ã\n\nä¾å¦ï¼å¨ä¸é¢ä¾å­çå­ç¬¦åé¢å ä¸ä¸ªâï¼âï¼å°±å¯ä»¥å¼å¯ææ°æ¨¡å¼ã\n\ntext=âabcâ\nregex=âab{1,3}?câ\n\n\nå¹éç»ææ¯âabcâï¼è¯¥æ¨¡å¼ä¸ NFA èªå¨æºé¦åéæ©æå°çå¹éèå´ï¼å³å¹é 1 ä¸ª b å­ç¬¦ï¼å æ­¤å°±é¿åäºåæº¯é®é¢ã\n\n# ç¬å æ¨¡å¼ï¼Possessiveï¼\n\nåè´ªå©ªæ¨¡å¼ä¸æ ·ï¼ç¬å æ¨¡å¼ä¸æ ·ä¼æå¤§éåº¦å°å¹éæ´å¤åå®¹ï¼ä¸åçæ¯ï¼å¨ç¬å æ¨¡å¼ä¸ï¼å¹éå¤±è´¥å°±ä¼ç»æå¹éï¼ä¸ä¼åçåæº¯é®é¢ã\n\nè¿æ¯ä¸è¾¹çä¾å­ï¼å¨å­ç¬¦åé¢å ä¸ä¸ªâ+âï¼å°±å¯ä»¥å¼å¯ç¬å æ¨¡å¼ã\n\ntext=âabbcâ\nregex=âab{1,3}+bcâ\n\n\nç»ææ¯ä¸å¹éï¼ç»æå¹éï¼ä¸ä¼åçåæº¯é®é¢ã\n\n> è®²å°è¿éï¼ä½ åºè¯¥éå¸¸æ¸æ¥äºï¼é¿ååæº¯çæ¹æ³å°±æ¯ï¼ä½¿ç¨ææ°æ¨¡å¼åç¬å æ¨¡å¼ã\n\n\n# æ­£åè¡¨è¾¾å¼çä¼å\n\n# å°ç¨è´ªå©ªæ¨¡å¼ï¼å¤ç¨ç¬å æ¨¡å¼\n\nè´ªå©ªæ¨¡å¼ä¼å¼èµ·åæº¯é®é¢ï¼å¯ä»¥ä½¿ç¨ç¬å æ¨¡å¼æ¥é¿ååæº¯ã\n\n# åå°åæ¯éæ©\n\nåæ¯éæ©ç±»å (X|Y|Z) çæ­£åè¡¨è¾¾å¼ä¼éä½æ§è½ï¼æä»¬å¨å¼åçæ¶åè¦å°½éåå°ä½¿ç¨ãå¦æä¸å®è¦ç¨ï¼æä»¬å¯ä»¥éè¿ä»¥ä¸å ç§æ¹å¼æ¥ä¼åï¼\n\n * é¦åï¼æä»¬éè¦èèéæ©çé¡ºåºï¼å°æ¯è¾å¸¸ç¨çéæ©é¡¹æ¾å¨åé¢ï¼ä½¿å®ä»¬å¯ä»¥è¾å¿«å°è¢«å¹éï¼\n * å¶æ¬¡ï¼æä»¬å¯ä»¥å°è¯æåå±ç¨æ¨¡å¼ï¼ä¾å¦ï¼å° (abcd|abef) æ¿æ¢ä¸º ab(cd|ef)ï¼åèå¹ééåº¦è¾å¿«ï¼å ä¸º NFA èªå¨æºä¼å°è¯å¹é abï¼å¦ææ²¡ææ¾å°ï¼å°±ä¸ä¼åå°è¯ä»»ä½éé¡¹ï¼\n * æåï¼å¦ææ¯ç®åçåæ¯éæ©ç±»åï¼æä»¬å¯ä»¥ç¨ä¸æ¬¡ index ä»£æ¿ (X|Y|Z)ï¼å¦ææµè¯çè¯ï¼ä½ å°±ä¼åç°ä¸æ¬¡ index çæçè¦æ¯ (X|Y|Z) é«åºä¸äºã\n\n# åå°æè·åµå¥\n\n * æè·ç»æ¯æææ­£åè¡¨è¾¾å¼ä¸­ï¼å­è¡¨è¾¾å¼å¹éçåå®¹ä¿å­å°ä»¥æ°å­ç¼å·ææ¾å¼å½åçæ°ç»ä¸­ï¼æ¹ä¾¿åé¢å¼ç¨ãä¸è¬ä¸ä¸ª () å°±æ¯ä¸ä¸ªæè·ç»ï¼æè·ç»å¯ä»¥è¿è¡åµå¥ã\n * éæè·ç»åæ¯æåä¸å¹éå´ä¸è¿è¡åç»ç¼å·çæè·ç»ï¼å¶è¡¨è¾¾å¼ä¸è¬ç± (?:exp) ç»æã\n\nå¨æ­£åè¡¨è¾¾å¼ä¸­ï¼æ¯ä¸ªæè·ç»é½æä¸ä¸ªç¼å·ï¼ç¼å· 0 ä»£è¡¨æ´ä¸ªå¹éå°çåå®¹ãæä»¬å¯ä»¥çä¸é¢çä¾å­ï¼\n\npublic static void main(String[] args) {\n\tString text = "<input high=\\"20\\" weight=\\"70\\">test</input>";\n\tString reg="(<input.*?>)(.*?)(</input>)";\n\tPattern p = Pattern.compile(reg);\n\tMatcher m = p.matcher(text);\n\twhile(m.find()) {\n\t\tSystem.out.println(m.group(0));// æ´ä¸ªå¹éå°çåå®¹\n\t\tSystem.out.println(m.group(1));//(<input.*?>)\n\t\tSystem.out.println(m.group(2));//(.*?)\n\t\tSystem.out.println(m.group(3));//(</input>)\n\t}\n}\n\n\nè¿è¡ç»æï¼\n\n<input high=\\"20\\" weight=\\"70\\">test</input>\n<input high=\\"20\\" weight=\\"70\\">\ntest\n</input>\n\n\nå¦æä½ å¹¶ä¸éè¦è·åæä¸ä¸ªåç»åçææ¬ï¼é£ä¹å°±ä½¿ç¨éæè·åç»ãä¾å¦ï¼ä½¿ç¨â(?:X)âä»£æ¿â(X)âï¼æä»¬åçä¸é¢çä¾å­ï¼\n\npublic static void main(String[] args) {\n\tString text = "<input high=\\"20\\" weight=\\"70\\">test</input>";\n\tString reg="(?:<input.*?>)(.*?)(?:</input>)";\n\tPattern p = Pattern.compile(reg);\n\tMatcher m = p.matcher(text);\n\twhile(m.find()) {\n\t\tSystem.out.println(m.group(0));// æ´ä¸ªå¹éå°çåå®¹\n\t\tSystem.out.println(m.group(1));//(.*?)\n\t}\n}\n\n\nè¿è¡ç»æï¼\n\n<input high=\\"20\\" weight=\\"70\\">test</input>\ntest\n\n\nç»¼ä¸å¯ç¥ï¼åå°ä¸éè¦è·åçåç»ï¼å¯ä»¥æé«æ­£åè¡¨è¾¾å¼çæ§è½ã\n\n\n# åèèµæ\n\n * æ­£åè¡¨è¾¾å¼ 30 åéå¥é¨æç¨\n * msdn æ­£åè¡¨è¾¾å¼æç¨\n * æ­£ååºç¨ä¹ââæ¥ææ­£åè¡¨è¾¾å¼\n * http://www.regexlib.com/\n * ãJava æ§è½è°ä¼å®æã',normalizedContent:'# java æ­£åä»å¥é¨å°ç²¾é\n\n> å³é®è¯ï¼patternãmatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãdfaãnfa\n\n\n# æ­£åç®ä»\n\n\n# æ­£åè¡¨è¾¾å¼æ¯ä»ä¹\n\næ­£åè¡¨è¾¾å¼ï¼regular expressionï¼æ¯ä¸ä¸ªç¨æ­£åç¬¦å·ååºçå¬å¼ï¼ç¨åºå¯¹è¿ä¸ªå¬å¼è¿è¡è¯­æ³åæï¼å»ºç«ä¸ä¸ªè¯­æ³åææ ï¼åæ ¹æ®è¿ä¸ªåææ ç»åæ­£åè¡¨è¾¾å¼çå¼æçææ§è¡ç¨åºï¼è¿ä¸ªæ§è¡ç¨åºæä»¬æå®ç§°ä½ç¶ææºï¼ä¹å«ç¶æèªå¨æºï¼ï¼ç¨äºå­ç¬¦å¹éã\n\n\n# å¦ä½å­¦ä¹ æ­£å\n\næ­£åè¡¨è¾¾å¼æ¯ä¸ä¸ªå¼ºå¤§çææ¬å¹éå·¥å·ï¼ä½æ¯å®çè§åå¾å¤æï¼çè§£èµ·æ¥è¾ä¸ºå°é¾ï¼å®¹æè®©äººæèççã\n\nåæ¥è§¦æ­£åæ¶ï¼æçäºä¸å æ­£åçè¯­ä¹è¯´æï¼ä½æ¯ä»ç¶ä¸ææä»¥ãåæ¥ï¼æå¤æ¥è§¦ä¸äºæ­£åçåºç¨å®ä¾ï¼æ¸æ¸æäºæè§ï¼åç»åè¯­ä¹è¯´æï¼ç»æé¢æãæè§å¾æ­£åè¡¨è¾¾å¼åæ­¦ä¾ ä¿®ç»æ­¦åå·®ä¸å¤ï¼åºè¯¥åç»æå¼ï¼åç»å¿æ³ãå¦æä¸å¼å§å°±ç´æ¥çæ­£åçè§åï¼ä¿è¯ä½ ä¼æµé¼ãå½ä½ çæåºæ¬æå¼ï¼æ­£ååºæ¬ä½¿ç¨æ¡ä¾ï¼åï¼ä¹è¯¥ä¿®ç¼ä¿®ç¼å¿æ³ï¼æ­£åè¯­æ³ï¼äºãçæ­£çé«æä¸è½åªé æ­»è®°ç¡¬èé£ä¹å ææå¼ãå°±åå¼ ä¸ä¸°æå¼ æ å¿å¤ªææ³ä¸æ ·ï¼é¢æå¿æ³ï¼èä¼è´¯éï¼å°ä¾ ä½ å°±å¯ä»¥æ æèææï¼æä¸ºä¼ è¯´ä¸­çç»ä¸é«æã\n\nä»¥ä¸é²è¯å¯å½çº³ä¸ºä¸å¥ï¼å­¦ä¹ æ­£ååºè¯¥ä»å®ä¾å»çè§£è§åã\n\n\n# æ­£åå·¥å·ç±»\n\njdk ä¸­ç java.util.regex åæä¾äºå¯¹æ­£åè¡¨è¾¾å¼çæ¯æã\n\njava.util.regex æä¸ä¸ªæ ¸å¿ç±»ï¼\n\n * pattern ç±»ï¼pattern æ¯ä¸ä¸ªæ­£åè¡¨è¾¾å¼çç¼è¯è¡¨ç¤ºã\n * matcher ç±»ï¼matcher æ¯å¯¹è¾å¥å­ç¬¦ä¸²è¿è¡è§£éåå¹éæä½çå¼æã\n * patternsyntaxexceptionï¼patternsyntaxexception æ¯ä¸ä¸ªéå¼ºå¶å¼å¸¸ç±»ï¼å®è¡¨ç¤ºä¸ä¸ªæ­£åè¡¨è¾¾å¼æ¨¡å¼ä¸­çè¯­æ³éè¯¯ã\n\n**æ³¨ï¼**éè¦æ ¼å¤æ³¨æä¸ç¹ï¼å¨ java ä¸­ä½¿ç¨åææ "\\"æ¶å¿é¡»åæ "\\\\"ãæä»¥æ¬æçä»£ç åºç°å½¢å¦ string regex = "\\\\$\\\\{.*?\\\\}" å¶å®å°±æ¯ \\$\\{.\\*?\\}ã\n\n\n# pattern ç±»\n\npatternç±»æ²¡æå¬å±æé æ¹æ³ãè¦åå»ºä¸ä¸ªpatternå¯¹è±¡ï¼ä½ å¿é¡»é¦åè°ç¨å¶éææ¹æ³compileï¼å è½½æ­£åè§åå­ç¬¦ä¸²ï¼ç¶åè¿åä¸ä¸ª pattern å¯¹è±¡ã\n\nä¸patternç±»ä¸æ ·ï¼matcherç±»ä¹æ²¡æå¬å±æé æ¹æ³ãä½ éè¦è°ç¨patternå¯¹è±¡çmatcheræ¹æ³æ¥è·å¾ä¸ä¸ªmatcherå¯¹è±¡ã\n\nãç¤ºä¾ãpattern å matcher çåå§å\n\npattern p = pattern.compile(regex);\nmatcher m = p.matcher(content);\n\n\n\n# matcher ç±»\n\nmatcher ç±»å¯ä»¥è¯´æ¯ java.util.regex ä¸­çæ ¸å¿ç±»ï¼å®æä¸ç±»åè½ï¼æ ¡éªãæ¥æ¾ãæ¿æ¢ã\n\n# æ ¡éª\n\nä¸ºäºæ ¡éªææ¬æ¯å¦ä¸æ­£åè§åå¹éï¼matcher æä¾äºä»¥ä¸å ä¸ªè¿åå¼ä¸º boolean çæ¹æ³ã\n\nåºå·   æ¹æ³åè¯´æ\n1    **public boolean lookingat() ** å°è¯å°ä»åºåå¼å¤´å¼å§çè¾å¥åºåä¸è¯¥æ¨¡å¼å¹éã\n2    **public boolean find() **å°è¯æ¥æ¾ä¸è¯¥æ¨¡å¼å¹éçè¾å¥åºåçä¸ä¸ä¸ªå­åºåã\n3    **public boolean find(int\n     startï¼**éç½®æ­¤å¹éå¨ï¼ç¶åå°è¯æ¥æ¾å¹éè¯¥æ¨¡å¼ãä»æå®ç´¢å¼å¼å§çè¾å¥åºåçä¸ä¸ä¸ªå­åºåã\n4    **public boolean matches() **å°è¯å°æ´ä¸ªåºåä¸æ¨¡å¼å¹éã\n\nå¦æä½ å»å»åä¸æ¸ä¸é¢çæ¥æ¾æ¹æ³æä»ä¹åºå«ï¼é£ä¹ä¸é¢ä¸ä¸ªä¾å­å°±å¯ä»¥è®©ä½ ç§æã\n\nãç¤ºä¾ãlookingatãfindãmatches\n\npublic static void main(string[] args) {\n\tchecklookingat("hello", "helloworld");\n\tchecklookingat("world", "helloworld");\n\n\tcheckfind("hello", "helloworld");\n\tcheckfind("world", "helloworld");\n\n\tcheckmatches("hello", "helloworld");\n\tcheckmatches("world", "helloworld");\n\tcheckmatches("helloworld", "helloworld");\n}\n\nprivate static void checklookingat(string regex, string content) {\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tif (m.lookingat()) {\n\t\tsystem.out.println(content + "\\tlookingatï¼ " + regex);\n\t} else {\n\t\tsystem.out.println(content + "\\tnot lookingatï¼ " + regex);\n\t}\n}\n\nprivate static void checkfind(string regex, string content) {\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tif (m.find()) {\n\t\tsystem.out.println(content + "\\tfindï¼ " + regex);\n\t} else {\n\t\tsystem.out.println(content + "\\tnot findï¼ " + regex);\n\t}\n}\n\nprivate static void checkmatches(string regex, string content) {\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tif (m.matches()) {\n\t\tsystem.out.println(content + "\\tmatchesï¼ " + regex);\n\t} else {\n\t\tsystem.out.println(content + "\\tnot matchesï¼ " + regex);\n\t}\n}\n\n\nè¾åºï¼\n\nhelloworld\tlookingatï¼ hello\nhelloworld\tnot lookingatï¼ world\nhelloworld\tfindï¼ hello\nhelloworld\tfindï¼ world\nhelloworld\tnot matchesï¼ hello\nhelloworld\tnot matchesï¼ world\nhelloworld\tmatchesï¼ helloworld\n\n\nè¯´æ\n\nregex = "world" è¡¨ç¤ºçæ­£åè§åæ¯ä»¥ world å¼å¤´çå­ç¬¦ä¸²ï¼regex = "hello" å regex = "helloworld" ä¹æ¯åçã\n\n * lookingatæ¹æ³ä»å¤´é¨å¼å§ï¼æ£æ¥ content å­ç¬¦ä¸²æ¯å¦æå­å­ç¬¦ä¸²äºæ­£åè§åå¹éã\n * findæ¹æ³æ£æ¥ content å­ç¬¦ä¸²æ¯å¦æå­å­ç¬¦ä¸²äºæ­£åè§åå¹éï¼ä¸ç®¡å­ç¬¦ä¸²æå¨ä½ç½®ã\n * matchesæ¹æ³æ£æ¥ content å­ç¬¦ä¸²æ´ä½æ¯å¦ä¸æ­£åè§åå¹éã\n\n# æ¥æ¾\n\nä¸ºäºæ¥æ¾ææ¬å¹éæ­£åè§åçä½ç½®ï¼matcheræä¾äºä»¥ä¸æ¹æ³ï¼\n\nåºå·   æ¹æ³åè¯´æ\n1    **public int start() **è¿åä»¥åå¹éçåå§ç´¢å¼ã\n2    public int start(int group) è¿åå¨ä»¥åçå¹éæä½æé´ï¼ç±ç»å®ç»ææè·çå­åºåçåå§ç´¢å¼\n3    **public int end()**è¿åæåå¹éå­ç¬¦ä¹åçåç§»éã\n4    **public int end(int\n     group)**è¿åå¨ä»¥åçå¹éæä½æé´ï¼ç±ç»å®ç»ææè·å­åºåçæåå­ç¬¦ä¹åçåç§»éã\n5    **public string group()**è¿ååä¸ä¸ªç¬¦åå¹éæ¡ä»¶çå­åºåã\n6    **public string group(int group)**è¿åæå®çç¬¦åå¹éæ¡ä»¶çå­åºåã\n\nãç¤ºä¾ãä½¿ç¨ start()ãend()ãgroup() æ¥æ¾ææå¹éæ­£åæ¡ä»¶çå­åºå\n\npublic static void main(string[] args) {\n\tfinal string regex = "world";\n\tfinal string content = "helloworld helloworld";\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tsystem.out.println("content: " + content);\n\n\tint i = 0;\n\twhile (m.find()) {\n\t\ti++;\n\t\tsystem.out.println("[" + i + "th] found");\n\t\tsystem.out.print("start: " + m.start() + ", ");\n\t\tsystem.out.print("end: " + m.end() + ", ");\n\t\tsystem.out.print("group: " + m.group() + "\\n");\n\t}\n}\n\n\nè¾åº\n\ncontent: helloworld helloworld\n[1th] found\nstart: 5, end: 10, group: world\n[2th] found\nstart: 16, end: 21, group: world\n\n\nè¯´æ\n\nä¾å­å¾ç´ç½ï¼ä¸è¨èªæäºå§ã\n\n# æ¿æ¢\n\næ¿æ¢æ¹æ³æ¯æ¿æ¢è¾å¥å­ç¬¦ä¸²éææ¬çæ¹æ³ï¼\n\nåºå·   æ¹æ³åè¯´æ\n1    **public matcher appendreplacement(stringbuffer sb, string\n     replacement)**å®ç°éç»ç«¯æ·»å åæ¿æ¢æ­¥éª¤ã\n2    **public stringbuffer appendtail(stringbuffer\n     sb)**å®ç°ç»ç«¯æ·»å åæ¿æ¢æ­¥éª¤ã\n3    **public string replaceall(string replacement) **\n     æ¿æ¢æ¨¡å¼ä¸ç»å®æ¿æ¢å­ç¬¦ä¸²ç¸å¹éçè¾å¥åºåçæ¯ä¸ªå­åºåã\n4    public string replacefirst(string replacement)\n     æ¿æ¢æ¨¡å¼ä¸ç»å®æ¿æ¢å­ç¬¦ä¸²å¹éçè¾å¥åºåçç¬¬ä¸ä¸ªå­åºåã\n5    **public static string quotereplacement(string\n     s)**è¿åæå®å­ç¬¦ä¸²çå­é¢æ¿æ¢å­ç¬¦ä¸²ãè¿ä¸ªæ¹æ³è¿åä¸ä¸ªå­ç¬¦ä¸²ï¼å°±åä¼ éç» matcher ç±»ç\n     appendreplacement æ¹æ³ä¸ä¸ªå­é¢å­ç¬¦ä¸²ä¸æ ·å·¥ä½ã\n\nãç¤ºä¾ãreplacefirst å replaceall\n\npublic static void main(string[] args) {\n\tstring regex = "can";\n\tstring replace = "can not";\n\tstring content = "i can because i think i can.";\n\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\n\tsystem.out.println("content: " + content);\n\tsystem.out.println("replacefirst: " + m.replacefirst(replace));\n\tsystem.out.println("replaceall: " + m.replaceall(replace));\n}\n\n\nè¾åº\n\ncontent: i can because i think i can.\nreplacefirst: i can not because i think i can.\nreplaceall: i can not because i think i can not.\n\n\nè¯´æ\n\nreplacefirstï¼æ¿æ¢ç¬¬ä¸ä¸ªå¹éæ­£åè§åçå­åºåã\n\nreplaceallï¼æ¿æ¢ææå¹éæ­£åè§åçå­åºåã\n\nãç¤ºä¾ãappendreplacementãappendtail å replaceall\n\npublic static void main(string[] args) {\n\tstring regex = "can";\n\tstring replace = "can not";\n\tstring content = "i can because i think i can.";\n\tstringbuffer sb = new stringbuffer();\n\tstringbuffer sb2 = new stringbuffer();\n\n\tsystem.out.println("content: " + content);\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\twhile (m.find()) {\n\t\tm.appendreplacement(sb, replace);\n\t}\n\tsystem.out.println("appendreplacement: " + sb);\n\tm.appendtail(sb);\n\tsystem.out.println("appendtail: " + sb);\n}\n\n\nè¾åº\n\ncontent: i can because i think i can.\nappendreplacement: i can not because i think i can not\nappendtail: i can not because i think i can not.\n\n\nè¯´æ\n\nä»è¾åºç»æå¯ä»¥çåºï¼appendreplacementåappendtailæ¹æ³ç»åèµ·æ¥ç¨ï¼åè½åreplaceallæ¯ä¸æ ·çã\n\nå¦æä½ æ¥çreplaceallçæºç ï¼ä¼åç°å¶åé¨å°±æ¯ä½¿ç¨appendreplacementåappendtailæ¹æ³ç»åæ¥å®ç°çã\n\nãç¤ºä¾ãquotereplacement å replaceallï¼è§£å³ç¹æ®å­ç¬¦æ¿æ¢é®é¢\n\npublic static void main(string[] args) {\n\tstring regex = "\\\\$\\\\{.*?\\\\}";\n\tstring replace = "${product}";\n\tstring content = "product is ${productname}.";\n\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tstring replaceall = m.replaceall(replace);\n\n\tsystem.out.println("content: " + content);\n\tsystem.out.println("replaceall: " + replaceall);\n}\n\n\nè¾åº\n\nexception in thread "main" java.lang.illegalargumentexception: no group with name {product}\n\tat java.util.regex.matcher.appendreplacement(matcher.java:849)\n\tat java.util.regex.matcher.replaceall(matcher.java:955)\n\tat org.zp.notes.javase.regex.regexdemo.wrongmethod(regexdemo.java:42)\n\tat org.zp.notes.javase.regex.regexdemo.main(regexdemo.java:18)\n\tat sun.reflect.nativemethodaccessorimpl.invoke0(native method)\n\tat sun.reflect.nativemethodaccessorimpl.invoke(nativemethodaccessorimpl.java:62)\n\tat sun.reflect.delegatingmethodaccessorimpl.invoke(delegatingmethodaccessorimpl.java:43)\n\tat java.lang.reflect.method.invoke(method.java:498)\n\tat com.intellij.rt.execution.application.appmain.main(appmain.java:147)\n\n\nè¯´æ\n\nstring regex = "\\\\$\\\\{.*?\\\\}";è¡¨ç¤ºå¹éç±»ä¼¼${name}è¿æ ·çå­ç¬¦ä¸²ãç±äº$ã{ ã}é½æ¯ç¹æ®å­ç¬¦ï¼éè¦ç¨åä¹å­ç¬¦\\æ¥ä¿®é¥°æè½è¢«å½åä¸ä¸ªå­ç¬¦ä¸²å­ç¬¦æ¥å¤çã\n\nä¸é¢çä¾å­æ¯æ³å° ${productname} æ¿æ¢ä¸º ${product} ï¼ç¶èreplaceallæ¹æ³å´å°ä¼ å¥çå­ç¬¦ä¸²ä¸­ç$å½åç¹æ®å­ç¬¦æ¥å¤çäºãç»æäº§çå¼å¸¸ã\n\nå¦ä½è§£å³è¿ä¸ªé®é¢?\n\njdk1.5 å¼å¥äºquotereplacementæ¹æ³ãå®å¯ä»¥ç¨æ¥è½¬æ¢ç¹æ®å­ç¬¦ãå¶å®æºç éå¸¸ç®åï¼å°±æ¯å¤æ­å­ç¬¦ä¸²ä¸­å¦ææ\\æ$ï¼å°±ä¸ºå®å ä¸ä¸ªè½¬ä¹å­ç¬¦\\\n\næä»¬å¯¹ä¸é¢çä»£ç ç¥ä½è°æ´ï¼\n\nm.replaceall(replace)æ¹ä¸ºm.replaceall(matcher.quotereplacement(replace))ï¼æ°ä»£ç å¦ä¸ï¼\n\npublic static void main(string[] args) {\n\tstring regex = "\\\\$\\\\{.*?\\\\}";\n\tstring replace = "${product}";\n\tstring content = "product is ${productname}.";\n\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tstring replaceall = m.replaceall(matcher.quotereplacement(replace));\n\n\tsystem.out.println("content: " + content);\n\tsystem.out.println("replaceall: " + replaceall);\n}\n\n\nè¾åº\n\ncontent: product is ${productname}.\nreplaceall: product is ${product}.\n\n\nè¯´æ\n\nå­ç¬¦ä¸²ä¸­å¦ææ\\æ$ï¼ä¸è½è¢«æ­£å¸¸è§£æçé®é¢è§£å³ã\n\n\n# åå­ç¬¦\n\nåå­ç¬¦(metacharacters)å°±æ¯æ­£åè¡¨è¾¾å¼ä¸­å·æç¹æ®æä¹çä¸ç¨å­ç¬¦ã\n\n\n# åºæ¬åå­ç¬¦\n\næ­£åè¡¨è¾¾å¼çåå­ç¬¦é¾ä»¥è®°å¿ï¼å¾å¤§ç¨åº¦ä¸æ¯å ä¸ºæå¾å¤ä¸ºäºç®åè¡¨è¾¾èåºç°çç­ä»·å­ç¬¦ãèå®éä¸æåºæ¬çåå­ç¬¦ï¼å¹¶æ²¡æé£ä¹å¤ãå¯¹äºå¤§é¨åçåºæ¯ï¼åºæ¬åå­ç¬¦é½å¯ä»¥æå®ãè®©æä»¬ä»ä¸ä¸ªä¸ªå®ä¾åºåï¼ç±æµå¥æ·±çå»ä½ä¼æ­£åçå¥¥å¦ã\n\n# å¤éï¼|ï¼\n\nãç¤ºä¾ãå¹éä¸ä¸ªç¡®å®çå­ç¬¦ä¸²\n\ncheckmatches("abc", "abc");\n\n\nå¦æè¦å¹éä¸ä¸ªç¡®å®çå­ç¬¦ä¸²ï¼éå¸¸ç®åï¼å¦ä¾ 1 æç¤ºãä½æ¯ï¼å¦æä½ ä¸ç¡®å®è¦å¹éçå­ç¬¦ä¸²ï¼å¸ææå¤ä¸ªéæ©ï¼æä¹åï¼ç­æ¡æ¯ï¼ä½¿ç¨åå­ç¬¦| ï¼å®çå«ä¹æ¯æã\n\nãç¤ºä¾ãå¹éå¤ä¸ªå¯éçå­ç¬¦ä¸²\n\n// æµè¯æ­£åè¡¨è¾¾å¼å­ç¬¦ï¼|\nassert.asserttrue(checkmatches("yes|no", "yes"));\nassert.asserttrue(checkmatches("yes|no", "no"));\nassert.assertfalse(checkmatches("yes|no", "right"));\n\n// è¾åº\n// yes\tmatchesï¼ yes|no\n// no\tmatchesï¼ yes|no\n// right\tnot matchesï¼ yes|no\n\n\n# åç»ï¼()ï¼\n\nå¦æä½ å¸æè¡¨è¾¾å¼ç±å¤ä¸ªå­è¡¨è¾¾å¼ç»æï¼ä½ å¯ä»¥ä½¿ç¨ ()ã\n\nãç¤ºä¾ãå¹éç»åå­ç¬¦ä¸²\n\nassert.asserttrue(checkmatches("(play|end)(ing|ed)", "ended"));\nassert.asserttrue(checkmatches("(play|end)(ing|ed)", "ending"));\nassert.asserttrue(checkmatches("(play|end)(ing|ed)", "playing"));\nassert.asserttrue(checkmatches("(play|end)(ing|ed)", "played"));\n\n// è¾åº\n// ended\tmatchesï¼ (play|end)(ing|ed)\n// ending\tmatchesï¼ (play|end)(ing|ed)\n// playing\tmatchesï¼ (play|end)(ing|ed)\n// played\tmatchesï¼ (play|end)(ing|ed)\n\n\n# æå®åå­ç¬¦ææèå´ï¼[]ï¼\n\nåé¢å±ç¤ºäºå¦ä½å¹éå­ç¬¦ä¸²ï¼ä½æ¯å¾å¤æ¶åä½ éè¦ç²¾ç¡®çå¹éä¸ä¸ªå­ç¬¦ï¼è¿æ¶å¯ä»¥ä½¿ç¨[] ã\n\nãç¤ºä¾ãå­ç¬¦å¨æå®èå´\n\n// æµè¯æ­£åè¡¨è¾¾å¼å­ç¬¦ï¼[]\nassert.asserttrue(checkmatches("[abc]", "b"));  // å­ç¬¦åªè½æ¯aãbãc\nassert.asserttrue(checkmatches("[a-z]", "m")); // å­ç¬¦åªè½æ¯a - z\nassert.asserttrue(checkmatches("[a-z]", "o")); // å­ç¬¦åªè½æ¯a - z\nassert.asserttrue(checkmatches("[a-za-z]", "k")); // å­ç¬¦åªè½æ¯a - zåa - z\nassert.asserttrue(checkmatches("[a-za-z]", "k"));\nassert.asserttrue(checkmatches("[0-9]", "5")); // å­ç¬¦åªè½æ¯0 - 9\n\n// è¾åº\n// b\tmatchesï¼ [abc]\n// m\tmatchesï¼ [a-z]\n// o\tmatchesï¼ [a-z]\n// k\tmatchesï¼ [a-za-z]\n// k\tmatchesï¼ [a-za-z]\n// 5\tmatchesï¼ [0-9]\n\n\n# æå®åå­ç¬¦æ æèå´ï¼ [^]ï¼\n\nãç¤ºä¾ãå­ç¬¦ä¸è½å¨æå®èå´\n\nå¦æéè¦å¹éä¸ä¸ªå­ç¬¦çéæä½ï¼å³å­ç¬¦ä¸è½å¨æå®èå´ï¼å¯ä»¥ä½¿ç¨[^]ã\n\n// æµè¯æ­£åè¡¨è¾¾å¼å­ç¬¦ï¼[^]\nassert.assertfalse(checkmatches("[^abc]", "b")); // å­ç¬¦ä¸è½æ¯aãbãc\nassert.assertfalse(checkmatches("[^a-z]", "m")); // å­ç¬¦ä¸è½æ¯a - z\nassert.assertfalse(checkmatches("[^a-z]", "o")); // å­ç¬¦ä¸è½æ¯a - z\nassert.assertfalse(checkmatches("[^a-za-z]", "k")); // å­ç¬¦ä¸è½æ¯a - zåa - z\nassert.assertfalse(checkmatches("[^a-za-z]", "k"));\nassert.assertfalse(checkmatches("[^0-9]", "5")); // å­ç¬¦ä¸è½æ¯0 - 9\n\n// è¾åº\n// b\tnot matchesï¼ [^abc]\n// m\tnot matchesï¼ [^a-z]\n// o\tnot matchesï¼ [^a-z]\n// k\tnot matchesï¼ [^a-za-z]\n// k\tnot matchesï¼ [^a-za-z]\n// 5\tnot matchesï¼ [^0-9]\n\n\n# éå¶å­ç¬¦æ°éï¼{}ï¼\n\nå¦ææ³è¦æ§å¶å­ç¬¦åºç°çæ¬¡æ°ï¼å¯ä»¥ä½¿ç¨ {}ã\n\nå­ç¬¦      æè¿°\n{n}     n æ¯ä¸ä¸ªéè´æ´æ°ãå¹éç¡®å®ç n æ¬¡ã\n{n,}    n æ¯ä¸ä¸ªéè´æ´æ°ãè³å°å¹é n æ¬¡ã\n{n,m}   m å n åä¸ºéè´æ´æ°ï¼å¶ä¸­ n <= mãæå°å¹é n æ¬¡ä¸æå¤å¹é m æ¬¡ã\n\nãç¤ºä¾ãéå¶å­ç¬¦åºç°æ¬¡æ°\n\n// {n}: n æ¯ä¸ä¸ªéè´æ´æ°ãå¹éç¡®å®ç n æ¬¡ã\ncheckmatches("ap{1}", "a");\ncheckmatches("ap{1}", "ap");\ncheckmatches("ap{1}", "app");\ncheckmatches("ap{1}", "apppppppppp");\n\n// {n,}: n æ¯ä¸ä¸ªéè´æ´æ°ãè³å°å¹é n æ¬¡ã\ncheckmatches("ap{1,}", "a");\ncheckmatches("ap{1,}", "ap");\ncheckmatches("ap{1,}", "app");\ncheckmatches("ap{1,}", "apppppppppp");\n\n// {n,m}: m å n åä¸ºéè´æ´æ°ï¼å¶ä¸­ n <= mãæå°å¹é n æ¬¡ä¸æå¤å¹é m æ¬¡ã\ncheckmatches("ap{2,5}", "a");\ncheckmatches("ap{2,5}", "ap");\ncheckmatches("ap{2,5}", "app");\ncheckmatches("ap{2,5}", "apppppppppp");\n\n// è¾åº\n// a\tnot matchesï¼ ap{1}\n// ap\tmatchesï¼ ap{1}\n// app\tnot matchesï¼ ap{1}\n// apppppppppp\tnot matchesï¼ ap{1}\n// a\tnot matchesï¼ ap{1,}\n// ap\tmatchesï¼ ap{1,}\n// app\tmatchesï¼ ap{1,}\n// apppppppppp\tmatchesï¼ ap{1,}\n// a\tnot matchesï¼ ap{2,5}\n// ap\tnot matchesï¼ ap{2,5}\n// app\tmatchesï¼ ap{2,5}\n// apppppppppp\tnot matchesï¼ ap{2,5}\n\n\n# è½¬ä¹å­ç¬¦ï¼/ï¼\n\nå¦ææ³è¦æ¥æ¾åå­ç¬¦æ¬èº«ï¼ä½ éè¦ä½¿ç¨è½¬ä¹ç¬¦ï¼ä½¿å¾æ­£åå¼æå°å¶è§ä½ä¸ä¸ªæ®éå­ç¬¦ï¼èä¸æ¯ä¸ä¸ªåå­ç¬¦å»å¤çã\n\n* çè½¬ä¹å­ç¬¦ï¼\\*\n+ çè½¬ä¹å­ç¬¦ï¼\\+\n? çè½¬ä¹å­ç¬¦ï¼\\?\n^ çè½¬ä¹å­ç¬¦ï¼\\^\n$ çè½¬ä¹å­ç¬¦ï¼\\$\n. çè½¬ä¹å­ç¬¦ï¼\\.\n\n\nå¦ææ¯è½¬ä¹ç¬¦ \\ æ¬èº«ï¼ä½ éè¦ä½¿ç¨ \\\\ ã\n\n# æå®è¡¨è¾¾å¼å­ç¬¦ä¸²çå¼å§ï¼^ï¼åç»å°¾ï¼$ï¼\n\nå¦æå¸æå¹éçå­ç¬¦ä¸²å¿é¡»ä»¥ç¹å®å­ç¬¦ä¸²å¼å¤´ï¼å¯ä»¥ä½¿ç¨ ^ ã\n\n> æ³¨æï¼è¯·ç¹å«çæï¼è¿éç ^ ä¸å®è¦å [^] ä¸­ç ^ åºåã\n\nãç¤ºä¾ãéå¶å­ç¬¦ä¸²å¤´é¨\n\nassert.asserttrue(checkmatches("^app[a-z]{0,}", "apple")); // å­ç¬¦ä¸²å¿é¡»ä»¥appå¼å¤´\nassert.assertfalse(checkmatches("^app[a-z]{0,}", "aplause"));\n\n// è¾åº\n// apple\tmatchesï¼ ^app[a-z]{0,}\n// aplause\tnot matchesï¼ ^app[a-z]{0,}\n\n\nå¦æå¸æå¹éçå­ç¬¦ä¸²å¿é¡»ä»¥ç¹å®å­ç¬¦ä¸²ç»å°¾ï¼å¯ä»¥ä½¿ç¨ $ ã\n\nãç¤ºä¾ãéå¶å­ç¬¦ä¸²å°¾é¨\n\nassert.asserttrue(checkmatches("[a-z]{0,}ing$", "playing")); // å­ç¬¦ä¸²å¿é¡»ä»¥ingç»å°¾\nassert.assertfalse(checkmatches("[a-z]{0,}ing$", "long"));\n\n// è¾åº\n// playing\tmatchesï¼ [a-z]{0,}ing$\n// long\tnot matchesï¼ [a-z]{0,}ing$\n\n\n\n# ç­ä»·å­ç¬¦\n\nç­ä»·å­ç¬¦ï¼é¡¾åæä¹ï¼å°±æ¯å¯¹äºåºæ¬åå­ç¬¦è¡¨è¾¾çä¸ç§ç®åï¼ç­ä»·å­ç¬¦çåè½é½å¯ä»¥éè¿åºæ¬åå­ç¬¦æ¥å®ç°ï¼ã\n\nå¨æ²¡æææ¡åºæ¬åå­ç¬¦ä¹åï¼å¯ä»¥åä¸ç¨çä¼ï¼å ä¸ºå¾å®¹ææäººç»æã\n\nç­ä»·å­ç¬¦çå¥½å¤å¨äºç®åäºåºæ¬åå­ç¬¦çåæ³ã\n\n# è¡¨ç¤ºæä¸ç±»åå­ç¬¦çç­ä»·å­ç¬¦\n\nä¸è¡¨ä¸­çç­ä»·å­ç¬¦é½è¡¨ç¤ºæä¸ç±»åçå­ç¬¦ã\n\nå­ç¬¦   æè¿°\n.    å¹éé¤â\\nâä¹å¤çä»»ä½åä¸ªå­ç¬¦ã\n\\d   å¹éä¸ä¸ªæ°å­å­ç¬¦ãç­ä»·äº[0-9]ã\n\\d   å¹éä¸ä¸ªéæ°å­å­ç¬¦ãç­ä»·äº[^0-9]ã\n\\w   å¹éåæ¬ä¸åçº¿çä»»ä½åè¯å­ç¬¦ãç±»ä¼¼ä½ä¸ç­ä»·äºâ[a-za-z0-9_]âï¼è¿éçåè¯å­ç¬¦æçæ¯ unicode å­ç¬¦éã\n\\w   å¹éä»»ä½éåè¯å­ç¬¦ã\n\\s   å¹éä»»ä½ä¸å¯è§å­ç¬¦ï¼åæ¬ç©ºæ ¼ãå¶è¡¨ç¬¦ãæ¢é¡µç¬¦ç­ç­ãç­ä»·äº[ \\f\\n\\r\\t\\v]ã\n\\s   å¹éä»»ä½å¯è§å­ç¬¦ãç­ä»·äº[ \\f\\n\\r\\t\\v]ã\n\nãç¤ºä¾ãåºæ¬ç­ä»·å­ç¬¦çç¨æ³\n\n// å¹éé¤â\\nâä¹å¤çä»»ä½åä¸ªå­ç¬¦\nassert.asserttrue(checkmatches(".{1,}", "abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz0123456789_"));\nassert.asserttrue(checkmatches(".{1,}", "~!@#$%^&*()+`-=[]{};:<>,./?|\\\\"));\nassert.assertfalse(checkmatches(".", "\\n"));\nassert.assertfalse(checkmatches("[^\\n]", "\\n"));\n\n// å¹éä¸ä¸ªæ°å­å­ç¬¦ãç­ä»·äº[0-9]\nassert.asserttrue(checkmatches("\\\\d{1,}", "0123456789"));\n// å¹éä¸ä¸ªéæ°å­å­ç¬¦ãç­ä»·äº[^0-9]\nassert.assertfalse(checkmatches("\\\\d{1,}", "0123456789"));\n\n// å¹éåæ¬ä¸åçº¿çä»»ä½åè¯å­ç¬¦ãç±»ä¼¼ä½ä¸ç­ä»·äºâ[a-za-z0-9_]âï¼è¿éçåè¯å­ç¬¦æçæ¯unicodeå­ç¬¦é\nassert.asserttrue(checkmatches("\\\\w{1,}", "abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz0123456789_"));\nassert.assertfalse(checkmatches("\\\\w{1,}", "~!@#$%^&*()+`-=[]{};:<>,./?|\\\\"));\n// å¹éä»»ä½éåè¯å­ç¬¦\nassert.assertfalse(checkmatches("\\\\w{1,}", "abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz0123456789_"));\nassert.asserttrue(checkmatches("\\\\w{1,}", "~!@#$%^&*()+`-=[]{};:<>,./?|\\\\"));\n\n// å¹éä»»ä½ä¸å¯è§å­ç¬¦ï¼åæ¬ç©ºæ ¼ãå¶è¡¨ç¬¦ãæ¢é¡µç¬¦ç­ç­ãç­ä»·äº[ \\f\\n\\r\\t\\v]\nassert.asserttrue(checkmatches("\\\\s{1,}", " \\f\\r\\n\\t"));\n// å¹éä»»ä½å¯è§å­ç¬¦ãç­ä»·äº[^ \\f\\n\\r\\t\\v]\nassert.assertfalse(checkmatches("\\\\s{1,}", " \\f\\r\\n\\t"));\n\n// è¾åº\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz0123456789_\tmatchesï¼ .{1,}\n// ~!@#$%^&*()+`-=[]{};:<>,./?|\\\\\tmatchesï¼ .{1,}\n// \\n\tnot matchesï¼ .\n// \\n\tnot matchesï¼ [^\\n]\n// 0123456789\tmatchesï¼ \\\\d{1,}\n// 0123456789\tnot matchesï¼ \\\\d{1,}\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz0123456789_\tmatchesï¼ \\\\w{1,}\n// ~!@#$%^&*()+`-=[]{};:<>,./?|\\\\\tnot matchesï¼ \\\\w{1,}\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz0123456789_\tnot matchesï¼ \\\\w{1,}\n// ~!@#$%^&*()+`-=[]{};:<>,./?|\\\\\tmatchesï¼ \\\\w{1,}\n// \\f\\r\\n\\t\tmatchesï¼ \\\\s{1,}\n// \\f\\r\\n\\t\tnot matchesï¼ \\\\s{1,}\n\n\n# éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦\n\nå¨åºæ¬åå­ç¬¦ç« èä¸­ï¼å·²ç»ä»ç»äºéå¶å­ç¬¦æ°éçåºæ¬åå­ç¬¦ - {} ã\n\næ­¤å¤ï¼è¿æ *ã+ã? è¿ä¸ªä¸ä¸ªä¸ºäºç®ååæ³èåºç°çç­ä»·å­ç¬¦ï¼æä»¬æ¥è®¤è¯ä¸ä¸ã\n\nå­ç¬¦   æè¿°\n*    å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æå¤æ¬¡ãç­ä»·äº{0,}ã\n+    å¹éåé¢çå­è¡¨è¾¾å¼ä¸æ¬¡æå¤æ¬¡ãç­ä»·äº{1,}ã\n?    å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æä¸æ¬¡ãç­ä»·äº {0,1}ã\n\næ¡ä¾ éå¶å­ç¬¦æ°éçç­ä»·å­ç¬¦\n\n// *: å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æå¤æ¬¡ã* ç­ä»·äº{0,}ã\ncheckmatches("ap*", "a");\ncheckmatches("ap*", "ap");\ncheckmatches("ap*", "app");\ncheckmatches("ap*", "apppppppppp");\n\n// +: å¹éåé¢çå­è¡¨è¾¾å¼ä¸æ¬¡æå¤æ¬¡ã+ ç­ä»·äº {1,}ã\ncheckmatches("ap+", "a");\ncheckmatches("ap+", "ap");\ncheckmatches("ap+", "app");\ncheckmatches("ap+", "apppppppppp");\n\n// ?: å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æä¸æ¬¡ã? ç­ä»·äº {0,1}ã\ncheckmatches("ap?", "a");\ncheckmatches("ap?", "ap");\ncheckmatches("ap?", "app");\ncheckmatches("ap?", "apppppppppp");\n\n// è¾åº\n// a\tmatchesï¼ ap*\n// ap\tmatchesï¼ ap*\n// app\tmatchesï¼ ap*\n// apppppppppp\tmatchesï¼ ap*\n// a\tnot matchesï¼ ap+\n// ap\tmatchesï¼ ap+\n// app\tmatchesï¼ ap+\n// apppppppppp\tmatchesï¼ ap+\n// a\tmatchesï¼ ap?\n// ap\tmatchesï¼ ap?\n// app\tnot matchesï¼ ap?\n// apppppppppp\tnot matchesï¼ ap?\n\n\n# åå­ç¬¦ä¼åçº§é¡ºåº\n\næ­£åè¡¨è¾¾å¼ä»å·¦å°å³è¿è¡è®¡ç®ï¼å¹¶éµå¾ªä¼åçº§é¡ºåºï¼è¿ä¸ç®æ¯è¡¨è¾¾å¼éå¸¸ç±»ä¼¼ã\n\nä¸è¡¨ä»æé«å°æä½è¯´æäºåç§æ­£åè¡¨è¾¾å¼è¿ç®ç¬¦çä¼åçº§é¡ºåºï¼\n\nè¿ç®ç¬¦                    è¯´æ\n\\                      è½¬ä¹ç¬¦\n()ã(?:)ã(?=)ã[]        æ¬å·åä¸­æ¬å·\n*ã+ã?ã{n}ã{n,}ã{n,m}   éå®ç¬¦\n^ã$ã*ä»»ä½å­ç¬¦ãä»»ä½å­ç¬¦*        å®ä½ç¹ååºå\n|                      æ¿æ¢\n\nå­ç¬¦å·æé«äºæ¿æ¢è¿ç®ç¬¦çä¼åçº§ï¼ä½¿å¾ m|food å¹é m æ food ãè¥è¦å¹é mood æ food ï¼è¯·ä½¿ç¨æ¬å·åå»ºå­è¡¨è¾¾å¼ï¼ä»èäº§ç (m|f)ood ã\n\n\n# åç»æé \n\nå¨åºæ¬åå­ç¬¦ç« èï¼æå°äº () å­ç¬¦å¯ä»¥ç¨æ¥å¯¹è¡¨è¾¾å¼åç»ãå®éä¸åç»è¿ææ´å¤å¤æçç¨æ³ã\n\næè°åç»æé ï¼æ¯ç¨æ¥æè¿°æ­£åè¡¨è¾¾å¼çå­è¡¨è¾¾å¼ï¼ç¨äºæè·å­ç¬¦ä¸²ä¸­çå­å­ç¬¦ä¸²ã\n\n\n# æè·ä¸éæè·\n\nä¸è¡¨ä¸ºåç»æé ä¸­çæè·åéæè·åç±»ã\n\nè¡¨è¾¾å¼            æè¿°           æè·æéæè·\n(exp)          å¹éçå­è¡¨è¾¾å¼      æè·\n(?<name>exp)   å½åçååå¼ç¨      æè·\n(?:exp)        éæè·ç»         éæè·\n(?=exp)        é¶å®½åº¦æ­£é¢æµåè¡æ­è¨   éæè·\n(?!exp)        é¶å®½åº¦è´é¢æµåè¡æ­è¨   éæè·\n(?<=exp)       é¶å®½åº¦æ­£åé¡¾ååæ­è¨   éæè·\n(?<!exp)       é¶å®½åº¦è´åé¡¾ååæ­è¨   éæè·\n\n> æ³¨ï¼java æ­£åå¼æä¸æ¯æå¹³è¡¡ç»ã\n\n\n# ååå¼ç¨\n\n# å¸¦ç¼å·çååå¼ç¨\n\nå¸¦ç¼å·çååå¼ç¨ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\\number\n\nå¶ä¸­number æ¯æ­£åè¡¨è¾¾å¼ä¸­æè·ç»çåºå·ä½ç½®ã ä¾å¦ï¼\\4 å¹éç¬¬åä¸ªæè·ç»çåå®¹ã å¦ææ­£åè¡¨è¾¾å¼æ¨¡å¼ä¸­æªå®ä¹numberï¼åå°åçåæéè¯¯\n\nãç¤ºä¾ãå¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯(ä¸å½åå­è¡¨è¾¾å¼)\n\n// (\\w+)\\s\\1\\w(\\w+) å¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯\nassert.asserttrue(findall("(\\\\w+)\\\\s\\\\1\\\\w(\\\\w+)",\n\t\t"he said that that was the the correct answer.") > 0);\n\n// è¾åº\n// regex = (\\w+)\\s\\1\\w(\\w+), content: he said that that was the the correct answer.\n// [1th] start: 8, end: 21, group: that that was\n// [2th] start: 22, end: 37, group: the the correct\n\n\nè¯´æï¼\n\n * (\\w+)ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã\n * \\sï¼ä¸ç©ºç½å­ç¬¦å¹éã\n * \\1ï¼å¹éç¬¬ä¸ä¸ªç»ï¼å³(\\w+)ã\n * \\wï¼å¹éåæ¬ç©ºæ ¼åæ ç¹ç¬¦å·çä¸ä¸ªéåè¯å­ç¬¦ã è¿æ ·å¯ä»¥é²æ­¢æ­£åè¡¨è¾¾å¼æ¨¡å¼å¹éä»ç¬¬ä¸ä¸ªæè·ç»çåè¯å¼å¤´çåè¯ã\n\n# å½åçååå¼ç¨\n\nå½åååå¼ç¨éè¿ä½¿ç¨ä¸é¢çè¯­æ³è¿è¡å®ä¹ï¼\\k<name >\n\nãç¤ºä¾ãå¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯(å½åå­è¡¨è¾¾å¼)\n\n// (?<duplicateword>\\w+)\\s\\k<duplicateword>\\w(?<nextword>\\w+) å¹ééå¤çåè¯åç´§éæ¯ä¸ªéå¤çåè¯çåè¯\nassert.asserttrue(findall("(?<duplicateword>\\\\w+)\\\\s\\\\k<duplicateword>\\\\w(?<nextword>\\\\w+)",\n\t\t"he said that that was the the correct answer.") > 0);\n\n// è¾åº\n// regex = (?<duplicateword>\\w+)\\s\\k<duplicateword>\\w(?<nextword>\\w+), content: he said that that was the the correct answer.\n// [1th] start: 8, end: 21, group: that that was\n// [2th] start: 22, end: 37, group: the the correct\n\n\nè¯´æï¼\n\n * (?<duplicateword>\\w+)ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã å½åæ­¤æè·ç» duplicatewordã\n * \\s: ä¸ç©ºç½å­ç¬¦å¹éã\n * \\k<duplicateword>ï¼å¹éåä¸º duplicateword çæè·çç»ã\n * \\wï¼å¹éåæ¬ç©ºæ ¼åæ ç¹ç¬¦å·çä¸ä¸ªéåè¯å­ç¬¦ã è¿æ ·å¯ä»¥é²æ­¢æ­£åè¡¨è¾¾å¼æ¨¡å¼å¹éä»ç¬¬ä¸ä¸ªæè·ç»çåè¯å¼å¤´çåè¯ã\n * (?<nextword>\\w+)ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã å½åæ­¤æè·ç» nextwordã\n\n\n# éæè·ç»\n\n(?:exp) è¡¨ç¤ºå½ä¸ä¸ªéå®ç¬¦åºç¨å°ä¸ä¸ªç»ï¼ä½ç»æè·çå­å­ç¬¦ä¸²å¹¶éæéæ¶ï¼éå¸¸ä¼ä½¿ç¨éæè·ç»æé ã\n\nãç¤ºä¾ãå¹éä»¥.ç»æçè¯­å¥ã\n\n// å¹éç±å¥å·ç»æ­¢çè¯­å¥ã\nassert.asserttrue(findall("(?:\\\\b(?:\\\\w+)\\\\w*)+\\\\.", "this is a short sentence. never end") > 0);\n\n// è¾åº\n// regex = (?:\\b(?:\\w+)\\w*)+\\., content: this is a short sentence. never end\n// [1th] start: 0, end: 25, group: this is a short sentence.\n\n\n\n# é¶å®½æ­è¨\n\nç¨äºæ¥æ¾å¨æäºåå®¹(ä½å¹¶ä¸åæ¬è¿äºåå®¹)ä¹åæä¹åçä¸è¥¿ï¼ä¹å°±æ¯è¯´å®ä»¬å\\b,^,$é£æ ·ç¨äºæå®ä¸ä¸ªä½ç½®ï¼è¿ä¸ªä½ç½®åºè¯¥æ»¡è¶³ä¸å®çæ¡ä»¶(å³æ­è¨)ï¼å æ­¤å®ä»¬ä¹è¢«ç§°ä¸ºé¶å®½æ­è¨ã\n\nè¡¨è¾¾å¼        æè¿°\n(?=exp)    å¹é exp åé¢çä½ç½®\n(?<=exp)   å¹é exp åé¢çä½ç½®\n(?!exp)    å¹éåé¢è·çä¸æ¯ exp çä½ç½®\n(?<!exp)   å¹éåé¢ä¸æ¯ exp çä½ç½®\n\n# å¹é exp åé¢çä½ç½®\n\n(?=exp) è¡¨ç¤ºè¾å¥å­ç¬¦ä¸²å¿é¡»å¹éå­è¡¨è¾¾å¼ä¸­çæ­£åè¡¨è¾¾å¼æ¨¡å¼ï¼å°½ç®¡å¹éçå­å­ç¬¦ä¸²æªåå«å¨å¹éç»æä¸­ã\n\n// \\b\\w+(?=\\sis\\b) è¡¨ç¤ºè¦æè·isä¹åçåè¯\nassert.asserttrue(findall("\\\\b\\\\w+(?=\\\\sis\\\\b)", "the dog is a malamute.") > 0);\nassert.assertfalse(findall("\\\\b\\\\w+(?=\\\\sis\\\\b)", "the island has beautiful birds.") > 0);\nassert.assertfalse(findall("\\\\b\\\\w+(?=\\\\sis\\\\b)", "the pitch missed home plate.") > 0);\nassert.asserttrue(findall("\\\\b\\\\w+(?=\\\\sis\\\\b)", "sunday is a weekend day.") > 0);\n\n// è¾åº\n// regex = \\b\\w+(?=\\sis\\b), content: the dog is a malamute.\n// [1th] start: 4, end: 7, group: dog\n// regex = \\b\\w+(?=\\sis\\b), content: the island has beautiful birds.\n// not found\n// regex = \\b\\w+(?=\\sis\\b), content: the pitch missed home plate.\n// not found\n// regex = \\b\\w+(?=\\sis\\b), content: sunday is a weekend day.\n// [1th] start: 0, end: 6, group: sunday\n\n\nè¯´æï¼\n\n * \\bï¼å¨åè¯è¾¹çå¤å¼å§å¹éã\n * \\w+ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã\n * (?=\\sis\\b)ï¼ç¡®å®åè¯å­ç¬¦æ¯å¦åæ¥ç©ºç½å­ç¬¦åå­ç¬¦ä¸²âisâï¼å¶å¨åè¯è¾¹çå¤ç»æã å¦æå¦æ­¤ï¼åå¹éæåã\n\n# å¹é exp åé¢çä½ç½®\n\n(?<=exp) è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾å¨è¾å¥å­ç¬¦ä¸²å½åä½ç½®å·¦ä¾§åºç°ï¼å°½ç®¡å­è¡¨è¾¾å¼æªåå«å¨å¹éç»æä¸­ãé¶å®½åº¦æ­£åé¡¾ååæ­è¨ä¸ä¼åæº¯ã\n\n// (?<=\\b20)\\d{2}\\b è¡¨ç¤ºè¦æè·ä»¥20å¼å¤´çæ°å­çåé¢é¨å\nassert.asserttrue(findall("(?<=\\\\b20)\\\\d{2}\\\\b", "2010 1999 1861 2140 2009") > 0);\n\n// è¾åº\n// regex = (?<=\\b20)\\d{2}\\b, content: 2010 1999 1861 2140 2009\n// [1th] start: 2, end: 4, group: 10\n// [2th] start: 22, end: 24, group: 09\n\n\nè¯´æï¼\n\n * \\d{2}ï¼å¹éä¸¤ä¸ªåè¿å¶æ°å­ã\n * {?<=\\b20)ï¼å¦æä¸¤ä¸ªåè¿å¶æ°å­çå­è¾¹çä»¥å°æ°ä½æ°â20âå¼å¤´ï¼åç»§ç»­å¹éã\n * \\bï¼å¨åè¯è¾¹çå¤ç»æå¹éã\n\n# å¹éåé¢è·çä¸æ¯ exp çä½ç½®\n\n(?!exp) è¡¨ç¤ºè¾å¥å­ç¬¦ä¸²ä¸å¾å¹éå­è¡¨è¾¾å¼ä¸­çæ­£åè¡¨è¾¾å¼æ¨¡å¼ï¼å°½ç®¡å¹éçå­å­ç¬¦ä¸²æªåå«å¨å¹éç»æä¸­ã\n\nãç¤ºä¾ãæè·æªä»¥âunâå¼å¤´çåè¯\n\n// \\b(?!un)\\w+\\b è¡¨ç¤ºè¦æè·æªä»¥âunâå¼å¤´çåè¯\nassert.asserttrue(findall("\\\\b(?!un)\\\\w+\\\\b", "unite one unethical ethics use untie ultimate") > 0);\n\n// è¾åº\n// regex = \\b(?!un)\\w+\\b, content: unite one unethical ethics use untie ultimate\n// [1th] start: 6, end: 9, group: one\n// [2th] start: 20, end: 26, group: ethics\n// [3th] start: 27, end: 30, group: use\n// [4th] start: 37, end: 45, group: ultimate\n\n\nè¯´æï¼\n\n * \\bï¼å¨åè¯è¾¹çå¤å¼å§å¹éã\n * (?!un)ï¼ç¡®å®æ¥ä¸æ¥çä¸¤ä¸ªçå­ç¬¦æ¯å¦ä¸ºâunâã å¦ææ²¡æï¼åå¯è½å¹éã\n * \\w+ï¼å¹éä¸ä¸ªæå¤ä¸ªåè¯å­ç¬¦ã\n * \\bï¼å¨åè¯è¾¹çå¤ç»æå¹éã\n\n# å¹éåé¢ä¸æ¯ exp çä½ç½®\n\n(?<!exp) è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾å¨è¾å¥å­ç¬¦ä¸²å½åä½ç½®çå·¦ä¾§åºç°ã ä½æ¯ï¼ä»»ä½ä¸å¹éå­è¡¨è¾¾å¼ çå­å­ç¬¦ä¸²ä¸åå«å¨å¹éç»æä¸­ã\n\nãç¤ºä¾ãæè·ä»»æå·¥ä½æ¥\n\n// (?<!(saturday|sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b è¡¨ç¤ºè¦æè·ä»»æå·¥ä½æ¥ï¼å³å¨ä¸å°å¨äºï¼\nassert.asserttrue(findall("(?<!(saturday|sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "monday february 1, 2010") > 0);\nassert.asserttrue(findall("(?<!(saturday|sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "wednesday february 3, 2010") > 0);\nassert.assertfalse(findall("(?<!(saturday|sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "saturday february 6, 2010") > 0);\nassert.assertfalse(findall("(?<!(saturday|sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "sunday february 7, 2010") > 0);\nassert.asserttrue(findall("(?<!(saturday|sunday) )\\\\b\\\\w+ \\\\d{1,2}, \\\\d{4}\\\\b", "monday, february 8, 2010") > 0);\n\n// è¾åº\n// regex = (?<!(saturday|sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: monday february 1, 2010\n// [1th] start: 7, end: 23, group: february 1, 2010\n// regex = (?<!(saturday|sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: wednesday february 3, 2010\n// [1th] start: 10, end: 26, group: february 3, 2010\n// regex = (?<!(saturday|sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: saturday february 6, 2010\n// not found\n// regex = (?<!(saturday|sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: sunday february 7, 2010\n// not found\n// regex = (?<!(saturday|sunday) )\\b\\w+ \\d{1,2}, \\d{4}\\b, content: monday, february 8, 2010\n// [1th] start: 8, end: 24, group: february 8, 2010\n\n\n\n# è´ªå©ªä¸ææ°\n\nå½æ­£åè¡¨è¾¾å¼ä¸­åå«è½æ¥åéå¤çéå®ç¬¦æ¶ï¼éå¸¸çè¡ä¸ºæ¯ï¼å¨ä½¿æ´ä¸ªè¡¨è¾¾å¼è½å¾å°å¹éçåæä¸ï¼å¹éå°½å¯è½å¤çå­ç¬¦ãä»¥è¿ä¸ªè¡¨è¾¾å¼ä¸ºä¾ï¼a.*bï¼å®å°ä¼å¹éæé¿çä»¥ a å¼å§ï¼ä»¥ b ç»æçå­ç¬¦ä¸²ãå¦æç¨å®æ¥æç´¢ aabab çè¯ï¼å®ä¼å¹éæ´ä¸ªå­ç¬¦ä¸² aababãè¿è¢«ç§°ä¸ºè´ªå©ªå¹éã\n\nææ¶ï¼æä»¬æ´éè¦ææ°å¹éï¼ä¹å°±æ¯å¹éå°½å¯è½å°çå­ç¬¦ãåé¢ç»åºçéå®ç¬¦é½å¯ä»¥è¢«è½¬åä¸ºææ°å¹éæ¨¡å¼ï¼åªè¦å¨å®åé¢å ä¸ä¸ä¸ªé®å·?ãè¿æ ·.*?å°±æå³çå¹éä»»ææ°éçéå¤ï¼ä½æ¯å¨è½ä½¿æ´ä¸ªå¹éæåçåæä¸ä½¿ç¨æå°çéå¤ã\n\nè¡¨è¾¾å¼      æè¿°\n*?       éå¤ä»»ææ¬¡ï¼ä½å°½å¯è½å°éå¤\n+?       éå¤ 1 æ¬¡ææ´å¤æ¬¡ï¼ä½å°½å¯è½å°éå¤\n??       éå¤ 0 æ¬¡æ 1 æ¬¡ï¼ä½å°½å¯è½å°éå¤\n{n,m}?   éå¤ n å° m æ¬¡ï¼ä½å°½å¯è½å°éå¤\n{n,}?    éå¤ n æ¬¡ä»¥ä¸ï¼ä½å°½å¯è½å°éå¤\n\nãç¤ºä¾ãjava æ­£åä¸­è´ªå©ªä¸ææ°çç¤ºä¾\n\n// è´ªå©ªå¹é\nassert.asserttrue(findall("a\\\\w*b", "abaabaaabaaaab") > 0);\n\n// ææ°å¹é\nassert.asserttrue(findall("a\\\\w*?b", "abaabaaabaaaab") > 0);\nassert.asserttrue(findall("a\\\\w+?b", "abaabaaabaaaab") > 0);\nassert.asserttrue(findall("a\\\\w??b", "abaabaaabaaaab") > 0);\nassert.asserttrue(findall("a\\\\w{0,4}?b", "abaabaaabaaaab") > 0);\nassert.asserttrue(findall("a\\\\w{3,}?b", "abaabaaabaaaab") > 0);\n\n// è¾åº\n// regex = a\\w*b, content: abaabaaabaaaab\n// [1th] start: 0, end: 14, group: abaabaaabaaaab\n// regex = a\\w*?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 2, group: ab\n// [2th] start: 2, end: 5, group: aab\n// [3th] start: 5, end: 9, group: aaab\n// [4th] start: 9, end: 14, group: aaaab\n// regex = a\\w+?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 5, group: abaab\n// [2th] start: 5, end: 9, group: aaab\n// [3th] start: 9, end: 14, group: aaaab\n// regex = a\\w??b, content: abaabaaabaaaab\n// [1th] start: 0, end: 2, group: ab\n// [2th] start: 2, end: 5, group: aab\n// [3th] start: 6, end: 9, group: aab\n// [4th] start: 11, end: 14, group: aab\n// regex = a\\w{0,4}?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 2, group: ab\n// [2th] start: 2, end: 5, group: aab\n// [3th] start: 5, end: 9, group: aaab\n// [4th] start: 9, end: 14, group: aaaab\n// regex = a\\w{3,}?b, content: abaabaaabaaaab\n// [1th] start: 0, end: 5, group: abaab\n// [2th] start: 5, end: 14, group: aaabaaaab\n\n\nè¯´æï¼\n\næ¬ä¾ä¸­ä»£ç å±ç¤ºçæ¯ä½¿ç¨ä¸åè´ªå©ªæææ°ç­ç¥å»æ¥æ¾å­ç¬¦ä¸² abaabaaabaaaab ä¸­å¹éä»¥ a å¼å¤´ï¼ä»¥ b ç»å°¾çææå­å­ç¬¦ä¸²ãè¯·ä»è¾åºç»æä¸­ï¼ç»ç»ä½å³ä½¿ç¨ä¸åçè´ªå©ªæææ°ç­ç¥ï¼å¯¹äºå¹éå­å­ç¬¦ä¸²æä»ä¹å½±åã\n\n\n# æ­£åéå½\n\n\n# å¹éæ­£åå­ç¬¦ä¸²çæ¹æ³\n\nç±äºæ­£åè¡¨è¾¾å¼ä¸­å¾å¤åå­ç¬¦æ¬èº«å°±æ¯è½¬ä¹å­ç¬¦ï¼å¨ java å­ç¬¦ä¸²çè§åä¸­ä¸ä¼è¢«æ¾ç¤ºåºæ¥ã\n\nä¸ºæ­¤ï¼å¯ä»¥ä½¿ç¨ä¸ä¸ªå·¥å·ç±»org.apache.commons.lang3.stringescapeutilsæ¥åç¹æ®å¤çï¼ä½¿å¾è½¬ä¹å­ç¬¦å¯ä»¥æå°ãè¿ä¸ªå·¥å·ç±»æä¾çé½æ¯éææ¹æ³ï¼ä»æ¹æ³å½åå¤§è´ä¹å¯ä»¥çåºç¨æ³ï¼è¿éä¸å¤åè¯´æã\n\nå¦æä½ äºè§£ mavenï¼å¯ä»¥ç´æ¥å¼å¥ä¾èµ\n\n<dependency>\n  <groupid>org.apache.commons</groupid>\n  <artifactid>commons-lang3</artifactid>\n  <version>${commons-lang3.version}</version>\n</dependency>\n\n\nãç¤ºä¾ãæ¬æä¸ºäºå±ç¤ºæ­£åå¹éè§åç¨å°çæ¹æ³\n\nprivate boolean checkmatches(string regex, string content) {\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tboolean flag = m.matches();\n\tif (m.matches()) {\n\t\tsystem.out.println(stringescapeutils.escapejava(content) + "\\tmatchesï¼ " + stringescapeutils.escapejava(regex));\n\t} else {\n\t\tsystem.out.println(stringescapeutils.escapejava(content) + "\\tnot matchesï¼ " + stringescapeutils.escapejava(regex));\n\t}\n\treturn flag;\n}\n\npublic int findall(string regex, string content) {\n\tpattern p = pattern.compile(regex);\n\tmatcher m = p.matcher(content);\n\tsystem.out.println("regex = " + regex + ", content: " + content);\n\n\tint count = 0;\n\twhile (m.find()) {\n\t\tcount++;\n\t\tsystem.out.println("[" + count + "th] " + "start: " + m.start() + ", end: " + m.end()\n\t\t\t\t+ ", group: " + m.group());\n\t}\n\tif (0 == count) {\n\t\tsystem.out.println("not found");\n\t}\n\treturn count;\n}\n\n\n\n# éæ¥åå­ç¬¦å­å¸\n\nä¸ºäºæ¹ä¾¿å¿«æ¥æ­£åçåå­ç¬¦å«ä¹ï¼å¨æ¬èæ ¹æ®åå­ç¬¦çåè½éä¸­ç½åæ­£åçåç§åå­ç¬¦ã\n\n# éå®ç¬¦\n\nå­ç¬¦      æè¿°\n*       å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æå¤æ¬¡ãä¾å¦ï¼zo* è½å¹é "z" ä»¥å "zoo"ã* ç­ä»·äº{0,}ã\n+       å¹éåé¢çå­è¡¨è¾¾å¼ä¸æ¬¡æå¤æ¬¡ãä¾å¦ï¼\'zo+\' è½å¹é "zo" ä»¥å "zoo"ï¼ä½ä¸è½å¹é "z"ã+ ç­ä»·äº\n        {1,}ã\n?       å¹éåé¢çå­è¡¨è¾¾å¼é¶æ¬¡æä¸æ¬¡ãä¾å¦ï¼"do(es)?" å¯ä»¥å¹é "do" æ "does" ä¸­ç"do" ã? ç­ä»·äº\n        {0,1}ã\n{n}     n æ¯ä¸ä¸ªéè´æ´æ°ãå¹éç¡®å®ç n æ¬¡ãä¾å¦ï¼\'o{2}\' ä¸è½å¹é "bob" ä¸­ç \'o\'ï¼ä½æ¯è½å¹é "food"\n        ä¸­çä¸¤ä¸ª oã\n{n,}    n æ¯ä¸ä¸ªéè´æ´æ°ãè³å°å¹é n æ¬¡ãä¾å¦ï¼\'o{2,}\' ä¸è½å¹é "bob" ä¸­ç \'o\'ï¼ä½è½å¹é\n        "foooood" ä¸­çææ oã\'o{1,}\' ç­ä»·äº \'o+\'ã\'o{0,}\' åç­ä»·äº \'o*\'ã\n{n,m}   m å n åä¸ºéè´æ´æ°ï¼å¶ä¸­ n <= mãæå°å¹é n æ¬¡ä¸æå¤å¹é m æ¬¡ãä¾å¦ï¼"o{1,3}" å°å¹é\n        "fooooood" ä¸­çåä¸ä¸ª oã\'o{0,1}\' ç­ä»·äº \'o?\'ãè¯·æ³¨æå¨éå·åä¸¤ä¸ªæ°ä¹é´ä¸è½æç©ºæ ¼ã\n\n# å®ä½ç¬¦\n\nå­ç¬¦   æè¿°\n^    å¹éè¾å¥å­ç¬¦ä¸²å¼å§çä½ç½®ãå¦æè®¾ç½®äº regexp å¯¹è±¡ç multiline å±æ§ï¼^ è¿ä¼ä¸ \\n æ \\r\n     ä¹åçä½ç½®å¹éã\n$    å¹éè¾å¥å­ç¬¦ä¸²ç»å°¾çä½ç½®ãå¦æè®¾ç½®äº regexp å¯¹è±¡ç multiline å±æ§ï¼$ è¿ä¼ä¸ \\n æ \\r\n     ä¹åçä½ç½®å¹éã\n\\b   å¹éä¸ä¸ªå­è¾¹çï¼å³å­ä¸ç©ºæ ¼é´çä½ç½®ã\n\\b   éå­è¾¹çå¹éã\n\n# éæå°å­ç¬¦\n\nå­ç¬¦    æè¿°\n\\cx   å¹éç± x ææçæ§å¶å­ç¬¦ãä¾å¦ï¼ \\cm å¹éä¸ä¸ª control-m æåè½¦ç¬¦ãx çå¼å¿é¡»ä¸º a-z æ a-z\n      ä¹ä¸ãå¦åï¼å° c è§ä¸ºä¸ä¸ªåä¹ç \'c\' å­ç¬¦ã\n\\f    å¹éä¸ä¸ªæ¢é¡µç¬¦ãç­ä»·äº \\x0c å \\clã\n\\n    å¹éä¸ä¸ªæ¢è¡ç¬¦ãç­ä»·äº \\x0a å \\cjã\n\\r    å¹éä¸ä¸ªåè½¦ç¬¦ãç­ä»·äº \\x0d å \\cmã\n\\s    å¹éä»»ä½ç©ºç½å­ç¬¦ï¼åæ¬ç©ºæ ¼ãå¶è¡¨ç¬¦ãæ¢é¡µç¬¦ç­ç­ãç­ä»·äº [ \\f\\n\\r\\t\\v]ã\n\\s    å¹éä»»ä½éç©ºç½å­ç¬¦ãç­ä»·äº [ \\f\\n\\r\\t\\v]ã\n\\t    å¹éä¸ä¸ªå¶è¡¨ç¬¦ãç­ä»·äº \\x09 å \\ciã\n\\v    å¹éä¸ä¸ªåç´å¶è¡¨ç¬¦ãç­ä»·äº \\x0b å \\ckã\n\n# åç»\n\nè¡¨è¾¾å¼            æè¿°\n(exp)          å¹éçå­è¡¨è¾¾å¼ã()ä¸­çåå®¹å°±æ¯å­è¡¨è¾¾å¼ã\n(?<name>exp)   å½åçå­è¡¨è¾¾å¼ï¼ååå¼ç¨ï¼ã\n(?:exp)        éæè·ç»ï¼è¡¨ç¤ºå½ä¸ä¸ªéå®ç¬¦åºç¨å°ä¸ä¸ªç»ï¼ä½ç»æè·çå­å­ç¬¦ä¸²å¹¶éæéæ¶ï¼éå¸¸ä¼ä½¿ç¨éæè·ç»æé ã\n(?=exp)        å¹é exp åé¢çä½ç½®ã\n(?<=exp)       å¹é exp åé¢çä½ç½®ã\n(?!exp)        å¹éåé¢è·çä¸æ¯ exp çä½ç½®ã\n(?<!exp)       å¹éåé¢ä¸æ¯ exp çä½ç½®ã\n\n# ç¹æ®ç¬¦å·\n\nå­ç¬¦   æè¿°\n\\    å°ä¸ä¸ä¸ªå­ç¬¦æ è®°ä¸ºæç¹æ®å­ç¬¦ãæåä¹å­ç¬¦ãæååå¼ç¨ãæå«è¿å¶è½¬ä¹ç¬¦ãä¾å¦ï¼ \'n\' å¹éå­ç¬¦ \'n\'ã\'\\n\'\n     å¹éæ¢è¡ç¬¦ãåºå \'\\\' å¹é ""ï¼è \'(\' åå¹é "("ã\n\\|   ææä¸¤é¡¹ä¹é´çä¸ä¸ªéæ©ã\n[]   å¹éæ¹æ¬å·èå´åçä»»æä¸ä¸ªå­ç¬¦ãå½¢å¼å¦ï¼[xyz]ã[^xyz]ã[a-z]ã[^a-z]ã[x,y,z]\n\n\n# æ­£åå®æ\n\nè½ç¶æ¬ç³»åæ´æ´æ´æ´çå¤§è°ç¹è°æ­£åè¡¨è¾¾å¼ãä½æ¯æè¿æ¯è¦å¨è¿éå»ºè®®ï¼å¦æä¸ä¸ªæ­£åè¡¨è¾¾å¼æ²¡æç»è¿ååæµè¯ï¼è¿æ¯è¦è°¨æä½¿ç¨ã\n\næ­£åæ¯æåååï¼å®å¯ä»¥ä¸ºä½ èçå¤§éçä»£ç è¡ãä½æ¯ç±äºå®ä¸æéè¯»ï¼ç»´æ¤èµ·æ¥å¯æ¯å¤´ç¼çå¦ï¼ä½ éè¦ä¸ä¸ªå­ç¬¦ä¸ä¸ªå­ç¬¦çå»çè§£ï¼ã\n\n\n# æå®ç¨çæ­£å\n\n# æ ¡éªä¸­æ\n\næ ¡éªå­ç¬¦ä¸²ä¸­åªè½æä¸­æå­ç¬¦ï¼ä¸åæ¬ä¸­ææ ç¹ç¬¦å·ï¼ãä¸­æå­ç¬¦ç unicode ç¼ç èå´æ¯ \\u4e00 å° \\u9fa5ã\n\n> å¦æå´è¶£ï¼å¯ä»¥åèç¾åº¦ç¾ç§-unicode ã\n\n^[\\u4e00-\\u9fa5]+$\n\n\n * å¹éï¼ æ¥ç ä¸è§æ\n * **ä¸å¹éï¼**æ¥ç ä¸è§æï¼\n\n# æ ¡éªèº«ä»½è¯å·ç \n\nèº«ä»½è¯ä¸º 15 ä½æ 18 ä½ã15 ä½æ¯ç¬¬ä¸ä»£èº«ä»½è¯ãä» 1999 å¹´ 10 æ 1 æ¥èµ·ï¼å¨å½å®è¡å¬æ°èº«ä»½è¯å·ç å¶åº¦ï¼å±æ°èº«ä»½è¯ç¼å·ç±å 15 ä½åè³ 18 ä½ã\n\n * 15 ä½èº«ä»½è¯ï¼ç± 15 ä½æ°å­ç»æãæåé¡ºåºä»å·¦è³å³ä¾æ¬¡ä¸ºï¼å­ä½æ°å­å°åºç ï¼å­ä½æ°å­åºçæ¥æï¼ä¸ä½é¡ºåºå·ï¼å¶ä¸­ 15 ä½ç·ä¸ºåæ°ï¼å¥³ä¸ºåæ°ã\n * 18 ä½èº«ä»½è¯ï¼ç±åä¸ä½æ°å­æ¬ä½ç åä¸ä½æ°å­æ ¡éªç ç»æãæåé¡ºåºä»å·¦è³å³ä¾æ¬¡ä¸ºï¼å­ä½æ°å­å°åºç ï¼å«ä½æ°å­åºçæ¥æï¼ä¸ä½æ°å­é¡ºåºç åä¸ä½æ°å­æ ¡éªç ï¼ä¹å¯è½æ¯ xï¼ã\n\n> èº«ä»½è¯å·å«ä¹è¯¦æè¯·è§ï¼ç¾åº¦ç¾ç§-å±æ°èº«ä»½è¯å·ç \n\nå°åºç ï¼6 ä½ï¼\n\n(1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\\d{4}\n\n\nåºçæ¥æï¼8 ä½ï¼\n\næ³¨ï¼ä¸é¢çæ¯ 18 ä½èº«ä»½è¯çææåºçæ¥æï¼å¦ææ¯ 15 ä½èº«ä»½è¯ï¼åªè¦å°ç¬¬ä¸ä¸ª\\d{4}æ¹ä¸º\\d{2}å³å¯ã\n\n((\\d{4}((0[13578]|1[02])(0[1-9]|[12]\\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\\d|30)|02(0[1-9]|1\\d|2[0-8])))|([02468][048]|[13579][26])0229)\n\n\n15 ä½ææèº«ä»½è¯\n\n^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\\d{4})((\\d{2}((0[13578]|1[02])(0[1-9]|[12]\\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\\d|30)|02(0[1-9]|1\\d|2[0-8])))|([02468][048]|[13579][26])0229)(\\d{3})$\n\n\n * **å¹éï¼**110001700101031\n\n * **ä¸å¹éï¼**110001701501031\n\n18 ä½ææèº«ä»½è¯\n\n^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\\d{4})((\\d{4}((0[13578]|1[02])(0[1-9]|[12]\\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\\d|30)|02(0[1-9]|1\\d|2[0-8])))|([02468][048]|[13579][26])0229)(\\d{3}(\\d|x))$\n\n\n * **å¹éï¼**110001199001010310 | 11000019900101015x\n\n * **ä¸å¹éï¼**990000199001010310 | 110001199013010310\n\n# æ ¡éªææç¨æ·åãå¯ç \n\n**æè¿°ï¼**é¿åº¦ä¸º 6-18 ä¸ªå­ç¬¦ï¼åè®¸è¾å¥å­æ¯ãæ°å­ãä¸åçº¿ï¼é¦å­ç¬¦å¿é¡»ä¸ºå­æ¯ã\n\n^[a-za-z]\\w{5,17}$\n\n\n * **å¹éï¼**he_llo@worl.d.com | hel.l-o@wor-ld.museum | h1ello@123.com\n\n * **ä¸å¹éï¼**hello@worl_d.com | he&llo@world.co1 | .hello@wor#.co.uk\n\n# æ ¡éªé®ç®±\n\n**æè¿°ï¼**ä¸åè®¸ä½¿ç¨ ip ä½ä¸ºååï¼å¦ : hello@154.145.68.12\n\n@ç¬¦å·åçé®ç®±ç¨æ·å.ç¬¦å·åçåå(domain)å¿é¡»æ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * å­ç¬¦åªè½æ¯è±æå­æ¯ãæ°å­ãä¸åçº¿_ã.ã- ï¼\n * é¦å­ç¬¦å¿é¡»ä¸ºå­æ¯ææ°å­ï¼\n * _ã.ã- ä¸è½è¿ç»­åºç°ã\n\nååçæ ¹ååªè½ä¸ºå­æ¯ï¼ä¸è³å°ä¸ºä¸¤ä¸ªå­ç¬¦ã\n\n^[a-za-z0-9](([_\\.\\-]?[a-za-z0-9]+)*)@([a-za-z0-9]+)(([\\.\\-]?[a-za-z0-9]+)*)\\.([a-za-z]{2,})$\n\n\n * **å¹éï¼**he_llo@worl.d.com | hel.l-o@wor-ld.museum | h1ello@123.com\n * **ä¸å¹éï¼**hello@worl_d.com | he&llo@world.co1 | .hello@wor#.co.uk\n\n# æ ¡éª url\n\n**æè¿°ï¼**æ ¡éª urlãæ¯æ httpãhttpsãftpãftpsã\n\n^(ht|f)(tp|tps)\\://[a-za-z0-9\\-\\.]+\\.([a-za-z]{2,3})?(/\\s*)?$\n\n\n * **å¹éï¼**http://google.com/help/me | http://www.google.com/help/me/ | https://www.google.com/help.asp | ftp://www.google.com | ftps://google.org\n\n * **ä¸å¹éï¼**http://un/www.google.com/index.asp\n\n# æ ¡éªæ¶é´\n\n**æè¿°ï¼**æ ¡éªæ¶é´ãæ¶ãåãç§å¿é¡»æ¯æææ°å­ï¼å¦ææ°å¼ä¸æ¯ä¸¤ä½æ°ï¼åä½éè¦è¡¥é¶ã\n\n^([0-1][0-9]|[2][0-3]):([0-5][0-9])$\n\n\n * **å¹éï¼**00:00:00 | 23:59:59 | 17:06:30\n\n * **ä¸å¹éï¼**17:6:30 | 24:16:30\n\n# æ ¡éªæ¥æ\n\n**æè¿°ï¼**æ ¡éªæ¥æãæ¥ææ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * æ ¼å¼ yyyy-mm-dd æ yyyy-m-d\n * è¿å­ç¬¦å¯ä»¥æ²¡æææ¯â-âãâ/âãâ.âä¹ä¸\n * é°å¹´çäºæå¯ä»¥æ 29 æ¥ï¼èå¹³å¹´ä¸å¯ä»¥ã\n * ä¸ãä¸ãäºãä¸ãå«ãåãåäºæä¸º 31 æ¥ãåãå­ãä¹ãåä¸æä¸º 30 æ¥ã\n\n^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$\n\n\n * **å¹éï¼**2016/1/1 | 2016/01/01 | 20160101 | 2016-01-01 | 2016.01.01 | 2000-02-29\n * **ä¸å¹éï¼**2001-02-29 | 2016/12/32 | 2016/6/31 | 2016/13/1 | 2016/0/1\n\n# æ ¡éªä¸­å½ææºå·ç \n\n**æè¿°ï¼**ä¸­å½ææºå·ç æ­£ç¡®æ ¼å¼ï¼11 ä½æ°å­ã\n\n> ç§»å¨æ 16 ä¸ªå·æ®µï¼134ã135ã136ã137ã138ã139ã147ã150ã151ã152ã157ã158ã159ã182ã187ã188ãå¶ä¸­ 147ã157ã188 æ¯ 3g å·æ®µï¼å¶ä»é½æ¯ 2g å·æ®µãèéæ 7 ç§å·æ®µï¼130ã131ã132ã155ã156ã185ã186ãå¶ä¸­ 186 æ¯ 3gï¼wcdmaï¼å·æ®µï¼å¶ä½ä¸º 2g å·æ®µãçµä¿¡æ 4 ä¸ªå·æ®µï¼133ã153ã180ã189ãå¶ä¸­ 189 æ¯ 3g å·æ®µï¼cdma2000ï¼ï¼133 å·æ®µä¸»è¦ç¨ä½æ çº¿ç½å¡å·ãæ»ç»ï¼13 å¼å¤´ææºå· 0-9ï¼15 å¼å¤´ææºå· 0-3ã5-9ï¼18 å¼å¤´ææºå· 0ã2ã5-9ã\n> \n> æ­¤å¤ï¼ä¸­å½å¨å½éä¸çåºå·ä¸º 86ï¼æä»¥ææºå·å¼å¤´æ+86ã86 ä¹æ¯åæ³çã\n> \n> ä»¥ä¸ä¿¡æ¯æ¥æºäº ç¾åº¦ç¾ç§-ææºå·\n\n^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d{8}$\n\n\n * å¹éï¼+86 18012345678 | 86 18012345678 | 15812345678\n\n * **ä¸å¹éï¼**15412345678 | 12912345678 | 180123456789\n\n# æ ¡éªä¸­å½åºè¯å·ç \n\n**æè¿°ï¼**åºè¯å·ç ï¼å¿é¡»å åºå·ï¼ä»¥ 0 å¼å¤´ï¼ã 3 ä½ææåºå·ï¼010ã020~029ï¼åºè¯ä½æ°ä¸º 8 ä½ã 4 ä½ææåºå·ï¼03xx å¼å¤´å° 09xxï¼åºè¯ä½æ°ä¸º 7ã\n\n> å¦ææ³äºè§£æ´è¯¦ç»çä¿¡æ¯ï¼è¯·åè ç¾åº¦ç¾ç§-çµè¯åºå· ã\n\n^(010|02[0-9])(\\s|-)\\d{8}|(0[3-9]\\d{2})(\\s|-)\\d{7}$\n\n\n * **å¹éï¼**010-12345678 | 010 12345678 | 0512-1234567 | 0512 1234567\n\n * **ä¸å¹éï¼**1234567 | 12345678\n\n# æ ¡éª ipv4 å°å\n\n**æè¿°ï¼**ip å°åæ¯ä¸ä¸ª 32 ä½çäºè¿å¶æ°ï¼éå¸¸è¢«åå²ä¸º 4 ä¸ªâ8 ä½äºè¿å¶æ°âï¼ä¹å°±æ¯ 4 ä¸ªå­èï¼ãip å°åéå¸¸ç¨âç¹ååè¿å¶âè¡¨ç¤ºæï¼a.b.c.dï¼çå½¢å¼ï¼å¶ä¸­ï¼a,b,c,d é½æ¯ 0~255 ä¹é´çåè¿å¶æ´æ°ã\n\n^([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\.([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\.([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\.([01]?\\d\\d?|2[0-4]\\d|25[0-5])$\n\n\n * **å¹éï¼**0.0.0.0 | 255.255.255.255 | 127.0.0.1\n\n * **ä¸å¹éï¼**10.10.10 | 10.10.10.256\n\n# æ ¡éª ipv6 å°å\n\n**æè¿°ï¼**ipv6 ç 128 ä½å°åéå¸¸åæ 8 ç»ï¼æ¯ç»ä¸ºåä¸ªåå­è¿å¶æ°çå½¢å¼ã\n\nipv6 å°åå¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸å½¢å¼ï¼\n\n * ipv6 å°å\n * é¶åç¼© ipv6 å°å(section 2.2 of rfc5952)\n * å¸¦ææ¬å°é¾æ¥åºåç´¢å¼ç ipv6 å°å (section 11 of rfc4007)\n * åµå¥ ipv4 ç ipv6 å°å(section 2 of rfc6052\n * æ å° ipv4 ç ipv6 å°å (section 2.1 of rfc2765)\n * ç¿»è¯ ipv4 ç ipv6 å°å (section 2.1 of rfc2765)\n\n> æ¾ç¶ï¼ipv6 å°åçè¡¨ç¤ºæ¹å¼å¾å¤æãä½ ä¹å¯ä»¥åèï¼\n> \n> ç¾åº¦ç¾ç§-ipv6\n> \n> stack overflow ä¸ç ipv6 æ­£åè¡¨è¾¾é«ç¥¨ç­æ¡\n\n(([0-9a-fa-f]{1,4}:){7,7}[0-9a-fa-f]{1,4}|([0-9a-fa-f]{1,4}:){1,7}:|([0-9a-fa-f]{1,4}:){1,6}:[0-9a-fa-f]{1,4}|([0-9a-fa-f]{1,4}:){1,5}(:[0-9a-fa-f]{1,4}){1,2}|([0-9a-fa-f]{1,4}:){1,4}(:[0-9a-fa-f]{1,4}){1,3}|([0-9a-fa-f]{1,4}:){1,3}(:[0-9a-fa-f]{1,4}){1,4}|([0-9a-fa-f]{1,4}:){1,2}(:[0-9a-fa-f]{1,4}){1,5}|[0-9a-fa-f]{1,4}:((:[0-9a-fa-f]{1,4}){1,6})|:((:[0-9a-fa-f]{1,4}){1,7}|:)|fe80:(:[0-9a-fa-f]{0,4}){0,4}%[0-9a-za-z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fa-f]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\n\n\n * **å¹éï¼**1:2:3:4:5:6:7:8 | 1:: | 1::8 | 1::6:7:8 | 1::5:6:7:8 | 1::4:5:6:7:8 | 1::3:4:5:6:7:8 | ::2:3:4:5:6:7:8 | 1:2:3:4:5:6:7:: | 1:2:3:4:5:6::8 | 1:2:3:4:5::8 | 1:2:3:4::8 | 1:2:3::8 | 1:2::8 | 1::8 | ::8 | fe80::7:8%1 | ::255.255.255.255 | 2001:db8:3:4::192.0.2.33 | 64:ff9b::192.0.2.33\n\n * **ä¸å¹éï¼**1.2.3.4.5.6.7.8 | 1::2::3\n\n\n# ç¹å®å­ç¬¦\n\n * å¹éé¿åº¦ä¸º 3 çå­ç¬¦ä¸²ï¼^.{3}$ã\n * å¹éç± 26 ä¸ªè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[a-za-z]+$ã\n * å¹éç± 26 ä¸ªå¤§åè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[a-z]+$ã\n * å¹éç± 26 ä¸ªå°åè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[a-z]+$ã\n * å¹éç±æ°å­å 26 ä¸ªè±æå­æ¯ç»æçå­ç¬¦ä¸²ï¼^[a-za-z0-9]+$ã\n * å¹éç±æ°å­ã26 ä¸ªè±æå­æ¯æèä¸åçº¿ç»æçå­ç¬¦ä¸²ï¼^\\w+$ã\n\n\n# ç¹å®æ°å­\n\n * å¹éæ­£æ´æ°ï¼^[1-9]\\d*$\n * å¹éè´æ´æ°ï¼^-[1-9]\\d*$\n * å¹éæ´æ°ï¼^(-?[1-9]\\d*)|0$\n * å¹éæ­£æµ®ç¹æ°ï¼^[1-9]\\d*\\.\\d+|0\\.\\d+$\n * å¹éè´æµ®ç¹æ°ï¼^-([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*)$\n * å¹éæµ®ç¹æ°ï¼^-?([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*|0?\\.0+|0)$\n\n\n# æ­£åè¡¨è¾¾å¼çæ§è½\n\nç®åå®ç°æ­£åè¡¨è¾¾å¼å¼æçæ¹å¼æä¸¤ç§ï¼dfa èªå¨æºï¼deterministic final automata ç¡®å®æéç¶æèªå¨æºï¼å nfa èªå¨æºï¼non deterministic finite automaton éç¡®å®æéç¶æèªå¨æºï¼ãå¯¹æ¯æ¥çï¼æé  dfa èªå¨æºçä»£ä»·è¿å¤§äº nfa èªå¨æºï¼ä½ dfa èªå¨æºçæ§è¡æçé«äº nfa èªå¨æºã\n\nåè®¾ä¸ä¸ªå­ç¬¦ä¸²çé¿åº¦æ¯ nï¼å¦æç¨ dfa èªå¨æºä½ä¸ºæ­£åè¡¨è¾¾å¼å¼æï¼åå¹éçæ¶é´å¤æåº¦ä¸º o(n)ï¼å¦æç¨ nfa èªå¨æºä½ä¸ºæ­£åè¡¨è¾¾å¼å¼æï¼ç±äº nfa èªå¨æºå¨å¹éè¿ç¨ä¸­å­å¨å¤§éçåæ¯ååæº¯ï¼åè®¾ nfa çç¶ææ°ä¸º sï¼åè¯¥å¹éç®æ³çæ¶é´å¤æåº¦ä¸º oï¼nsï¼ã\n\nnfa èªå¨æºçä¼å¿æ¯æ¯ææ´å¤åè½ãä¾å¦ï¼æè· groupãç¯è§ãå æä¼åéè¯ç­é«çº§åè½ãè¿äºåè½é½æ¯åºäºå­è¡¨è¾¾å¼ç¬ç«è¿è¡å¹éï¼å æ­¤å¨ç¼ç¨è¯­è¨éï¼ä½¿ç¨çæ­£åè¡¨è¾¾å¼åºé½æ¯åºäº nfa å®ç°çã\n\n\n# nfa èªå¨æºçåæº¯\n\nç¨ nfa èªå¨æºå®ç°çæ¯è¾å¤æçæ­£åè¡¨è¾¾å¼ï¼å¨å¹éè¿ç¨ä¸­ç»å¸¸ä¼å¼èµ·åæº¯é®é¢ãå¤§éçåæº¯ä¼é¿æ¶é´å°å ç¨ cpuï¼ä»èå¸¦æ¥ç³»ç»æ§è½å¼éã\n\ntext=âabbcâ\nregex=âab{1,3}câ\n\n\nè¿ä¸ªä¾å­å¹éç®çæ¯ï¼å¹éä»¥ a å¼å¤´ï¼ä»¥ c ç»å°¾ï¼ä¸­é´æ 1-3 ä¸ª b å­ç¬¦çå­ç¬¦ä¸²ãnfa èªå¨æºå¯¹å¶è§£æçè¿ç¨æ¯è¿æ ·çï¼\n\n * è¯»åæ­£åè¡¨è¾¾å¼ç¬¬ä¸ä¸ªå¹éç¬¦ a åå­ç¬¦ä¸²ç¬¬ä¸ä¸ªå­ç¬¦ a è¿è¡æ¯è¾ï¼a å¯¹ aï¼å¹éã\n * ç¶åï¼è¯»åæ­£åè¡¨è¾¾å¼ç¬¬äºä¸ªå¹éç¬¦ b{1,3} åå­ç¬¦ä¸²çç¬¬äºä¸ªå­ç¬¦ b è¿è¡æ¯è¾ï¼å¹éãä½å ä¸º b{1,3} è¡¨ç¤º 1-3 ä¸ª b å­ç¬¦ä¸²ï¼nfa èªå¨æºåå·æè´ªå©ªç¹æ§ï¼æä»¥æ­¤æ¶ä¸ä¼ç»§ç»­è¯»åæ­£åè¡¨è¾¾å¼çä¸ä¸ä¸ªå¹éç¬¦ï¼èæ¯ä¾æ§ä½¿ç¨ b{1,3} åå­ç¬¦ä¸²çç¬¬ä¸ä¸ªå­ç¬¦ b è¿è¡æ¯è¾ï¼ç»æè¿æ¯å¹éã\n * æ¥çç»§ç»­ä½¿ç¨ b{1,3} åå­ç¬¦ä¸²çç¬¬åä¸ªå­ç¬¦ c è¿è¡æ¯è¾ï¼åç°ä¸å¹éäºï¼æ­¤æ¶å°±ä¼åçåæº¯ï¼å·²ç»è¯»åçå­ç¬¦ä¸²ç¬¬åä¸ªå­ç¬¦ c å°è¢«ååºå»ï¼æéåå°ç¬¬ä¸ä¸ªå­ç¬¦ b çä½ç½®ã\n * é£ä¹åçåæº¯ä»¥åï¼å¹éè¿ç¨æä¹ç»§ç»­å¢ï¼ç¨åºä¼è¯»åæ­£åè¡¨è¾¾å¼çä¸ä¸ä¸ªå¹éç¬¦ cï¼åå­ç¬¦ä¸²ä¸­çç¬¬åä¸ªå­ç¬¦ c è¿è¡æ¯è¾ï¼ç»æå¹éï¼ç»æã\n\n\n# å¦ä½é¿ååæº¯\n\n# è´ªå©ªæ¨¡å¼ï¼greedyï¼\n\né¡¾åæä¹ï¼å°±æ¯å¨æ°éå¹éä¸­ï¼å¦æåç¬ä½¿ç¨ +ã ? ã* æ{min,max} ç­éè¯ï¼æ­£åè¡¨è¾¾å¼ä¼å¹éå°½å¯è½å¤çåå®¹ã\n\nä¾å¦ï¼ä¸è¾¹é£ä¸ªä¾å­ï¼\n\ntext=âabbcâ\nregex=âab{1,3}câ\n\n\nå°±æ¯å¨è´ªå©ªæ¨¡å¼ä¸ï¼nfa èªå¨æºè¯»åäºæå¤§çå¹éèå´ï¼å³å¹é 3 ä¸ª b å­ç¬¦ãå¹éåçäºä¸æ¬¡å¤±è´¥ï¼å°±å¼èµ·äºä¸æ¬¡åæº¯ãå¦æå¹éç»ææ¯âabbbcâï¼å°±ä¼å¹éæåã\n\ntext=âabbbcâ\nregex=âab{1,3}câ\n\n\n# ææ°æ¨¡å¼ï¼reluctantï¼\n\nå¨è¯¥æ¨¡å¼ä¸ï¼æ­£åè¡¨è¾¾å¼ä¼å°½å¯è½å°å°éå¤å¹éå­ç¬¦ãå¦æå¹éæåï¼å®ä¼ç»§ç»­å¹éå©ä½çå­ç¬¦ä¸²ã\n\nä¾å¦ï¼å¨ä¸é¢ä¾å­çå­ç¬¦åé¢å ä¸ä¸ªâï¼âï¼å°±å¯ä»¥å¼å¯ææ°æ¨¡å¼ã\n\ntext=âabcâ\nregex=âab{1,3}?câ\n\n\nå¹éç»ææ¯âabcâï¼è¯¥æ¨¡å¼ä¸ nfa èªå¨æºé¦åéæ©æå°çå¹éèå´ï¼å³å¹é 1 ä¸ª b å­ç¬¦ï¼å æ­¤å°±é¿åäºåæº¯é®é¢ã\n\n# ç¬å æ¨¡å¼ï¼possessiveï¼\n\nåè´ªå©ªæ¨¡å¼ä¸æ ·ï¼ç¬å æ¨¡å¼ä¸æ ·ä¼æå¤§éåº¦å°å¹éæ´å¤åå®¹ï¼ä¸åçæ¯ï¼å¨ç¬å æ¨¡å¼ä¸ï¼å¹éå¤±è´¥å°±ä¼ç»æå¹éï¼ä¸ä¼åçåæº¯é®é¢ã\n\nè¿æ¯ä¸è¾¹çä¾å­ï¼å¨å­ç¬¦åé¢å ä¸ä¸ªâ+âï¼å°±å¯ä»¥å¼å¯ç¬å æ¨¡å¼ã\n\ntext=âabbcâ\nregex=âab{1,3}+bcâ\n\n\nç»ææ¯ä¸å¹éï¼ç»æå¹éï¼ä¸ä¼åçåæº¯é®é¢ã\n\n> è®²å°è¿éï¼ä½ åºè¯¥éå¸¸æ¸æ¥äºï¼é¿ååæº¯çæ¹æ³å°±æ¯ï¼ä½¿ç¨ææ°æ¨¡å¼åç¬å æ¨¡å¼ã\n\n\n# æ­£åè¡¨è¾¾å¼çä¼å\n\n# å°ç¨è´ªå©ªæ¨¡å¼ï¼å¤ç¨ç¬å æ¨¡å¼\n\nè´ªå©ªæ¨¡å¼ä¼å¼èµ·åæº¯é®é¢ï¼å¯ä»¥ä½¿ç¨ç¬å æ¨¡å¼æ¥é¿ååæº¯ã\n\n# åå°åæ¯éæ©\n\nåæ¯éæ©ç±»å (x|y|z) çæ­£åè¡¨è¾¾å¼ä¼éä½æ§è½ï¼æä»¬å¨å¼åçæ¶åè¦å°½éåå°ä½¿ç¨ãå¦æä¸å®è¦ç¨ï¼æä»¬å¯ä»¥éè¿ä»¥ä¸å ç§æ¹å¼æ¥ä¼åï¼\n\n * é¦åï¼æä»¬éè¦èèéæ©çé¡ºåºï¼å°æ¯è¾å¸¸ç¨çéæ©é¡¹æ¾å¨åé¢ï¼ä½¿å®ä»¬å¯ä»¥è¾å¿«å°è¢«å¹éï¼\n * å¶æ¬¡ï¼æä»¬å¯ä»¥å°è¯æåå±ç¨æ¨¡å¼ï¼ä¾å¦ï¼å° (abcd|abef) æ¿æ¢ä¸º ab(cd|ef)ï¼åèå¹ééåº¦è¾å¿«ï¼å ä¸º nfa èªå¨æºä¼å°è¯å¹é abï¼å¦ææ²¡ææ¾å°ï¼å°±ä¸ä¼åå°è¯ä»»ä½éé¡¹ï¼\n * æåï¼å¦ææ¯ç®åçåæ¯éæ©ç±»åï¼æä»¬å¯ä»¥ç¨ä¸æ¬¡ index ä»£æ¿ (x|y|z)ï¼å¦ææµè¯çè¯ï¼ä½ å°±ä¼åç°ä¸æ¬¡ index çæçè¦æ¯ (x|y|z) é«åºä¸äºã\n\n# åå°æè·åµå¥\n\n * æè·ç»æ¯æææ­£åè¡¨è¾¾å¼ä¸­ï¼å­è¡¨è¾¾å¼å¹éçåå®¹ä¿å­å°ä»¥æ°å­ç¼å·ææ¾å¼å½åçæ°ç»ä¸­ï¼æ¹ä¾¿åé¢å¼ç¨ãä¸è¬ä¸ä¸ª () å°±æ¯ä¸ä¸ªæè·ç»ï¼æè·ç»å¯ä»¥è¿è¡åµå¥ã\n * éæè·ç»åæ¯æåä¸å¹éå´ä¸è¿è¡åç»ç¼å·çæè·ç»ï¼å¶è¡¨è¾¾å¼ä¸è¬ç± (?:exp) ç»æã\n\nå¨æ­£åè¡¨è¾¾å¼ä¸­ï¼æ¯ä¸ªæè·ç»é½æä¸ä¸ªç¼å·ï¼ç¼å· 0 ä»£è¡¨æ´ä¸ªå¹éå°çåå®¹ãæä»¬å¯ä»¥çä¸é¢çä¾å­ï¼\n\npublic static void main(string[] args) {\n\tstring text = "<input high=\\"20\\" weight=\\"70\\">test</input>";\n\tstring reg="(<input.*?>)(.*?)(</input>)";\n\tpattern p = pattern.compile(reg);\n\tmatcher m = p.matcher(text);\n\twhile(m.find()) {\n\t\tsystem.out.println(m.group(0));// æ´ä¸ªå¹éå°çåå®¹\n\t\tsystem.out.println(m.group(1));//(<input.*?>)\n\t\tsystem.out.println(m.group(2));//(.*?)\n\t\tsystem.out.println(m.group(3));//(</input>)\n\t}\n}\n\n\nè¿è¡ç»æï¼\n\n<input high=\\"20\\" weight=\\"70\\">test</input>\n<input high=\\"20\\" weight=\\"70\\">\ntest\n</input>\n\n\nå¦æä½ å¹¶ä¸éè¦è·åæä¸ä¸ªåç»åçææ¬ï¼é£ä¹å°±ä½¿ç¨éæè·åç»ãä¾å¦ï¼ä½¿ç¨â(?:x)âä»£æ¿â(x)âï¼æä»¬åçä¸é¢çä¾å­ï¼\n\npublic static void main(string[] args) {\n\tstring text = "<input high=\\"20\\" weight=\\"70\\">test</input>";\n\tstring reg="(?:<input.*?>)(.*?)(?:</input>)";\n\tpattern p = pattern.compile(reg);\n\tmatcher m = p.matcher(text);\n\twhile(m.find()) {\n\t\tsystem.out.println(m.group(0));// æ´ä¸ªå¹éå°çåå®¹\n\t\tsystem.out.println(m.group(1));//(.*?)\n\t}\n}\n\n\nè¿è¡ç»æï¼\n\n<input high=\\"20\\" weight=\\"70\\">test</input>\ntest\n\n\nç»¼ä¸å¯ç¥ï¼åå°ä¸éè¦è·åçåç»ï¼å¯ä»¥æé«æ­£åè¡¨è¾¾å¼çæ§è½ã\n\n\n# åèèµæ\n\n * æ­£åè¡¨è¾¾å¼ 30 åéå¥é¨æç¨\n * msdn æ­£åè¡¨è¾¾å¼æç¨\n * æ­£ååºç¨ä¹ââæ¥ææ­£åè¡¨è¾¾å¼\n * http://www.regexlib.com/\n * ãjava æ§è½è°ä¼å®æã',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å½éå",frontmatter:{title:"Java å½éå",date:"2017-11-08T14:38:26.000Z",categories:["Java","JavaSE","é«çº§ç¹æ§"],tags:["Java","JavaSE","å½éå"],permalink:"/pages/57003e/"},regularPath:"/01.Java/01.JavaSE/02.%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/03.Java%E5%9B%BD%E9%99%85%E5%8C%96.html",relativePath:"01.Java/01.JavaSE/02.é«çº§ç¹æ§/03.Javaå½éå.md",key:"v-061c6092",path:"/pages/57003e/",headers:[{level:2,title:"èæ¯ç¥è¯",slug:"èæ¯ç¥è¯",normalizedTitle:"èæ¯ç¥è¯",charIndex:15},{level:3,title:"è¯­è¨ç¼ç ãå½å®¶/å°åºç¼ç ",slug:"è¯­è¨ç¼ç ãå½å®¶-å°åºç¼ç ",normalizedTitle:"è¯­è¨ç¼ç ãå½å®¶/å°åºç¼ç ",charIndex:150},{level:3,title:"å­ç¬¦ç¼ç ",slug:"å­ç¬¦ç¼ç ",normalizedTitle:"å­ç¬¦ç¼ç ",charIndex:1596},{level:2,title:"Java ä¸­å®ç°å½éå",slug:"java-ä¸­å®ç°å½éå",normalizedTitle:"java ä¸­å®ç°å½éå",charIndex:2174},{level:3,title:"å®ä¹ä¸åè¯­ç§çæ¨¡æ¿",slug:"å®ä¹ä¸åè¯­ç§çæ¨¡æ¿",normalizedTitle:"å®ä¹ä¸åè¯­ç§çæ¨¡æ¿",charIndex:2274},{level:4,title:"å®ä¹ properties æä»¶",slug:"å®ä¹-properties-æä»¶",normalizedTitle:"å®ä¹ properties æä»¶",charIndex:2476},{level:4,title:"Unicode è½¬æ¢å·¥å·",slug:"unicode-è½¬æ¢å·¥å·",normalizedTitle:"unicode è½¬æ¢å·¥å·",charIndex:2879},{level:3,title:"éæ©è¯­ç§",slug:"éæ©è¯­ç§",normalizedTitle:"éæ©è¯­ç§",charIndex:2222},{level:4,title:"Locale",slug:"locale",normalizedTitle:"locale",charIndex:2847},{level:3,title:"å è½½æå®è¯­ç§çæ¨¡æ¿",slug:"å è½½æå®è¯­ç§çæ¨¡æ¿",normalizedTitle:"å è½½æå®è¯­ç§çæ¨¡æ¿",charIndex:2232},{level:4,title:"ResourceBoundle",slug:"resourceboundle",normalizedTitle:"resourceboundle",charIndex:4206},{level:2,title:"æ¯æå½éåçå·¥å·ç±»",slug:"æ¯æå½éåçå·¥å·ç±»",normalizedTitle:"æ¯æå½éåçå·¥å·ç±»",charIndex:5825},{level:3,title:"NumberFormat",slug:"numberformat",normalizedTitle:"numberformat",charIndex:5864},{level:3,title:"DateFormat",slug:"dateformat",normalizedTitle:"dateformat",charIndex:5877},{level:3,title:"MessageFormat",slug:"messageformat",normalizedTitle:"messageformat",charIndex:5888}],headersStr:"èæ¯ç¥è¯ è¯­è¨ç¼ç ãå½å®¶/å°åºç¼ç  å­ç¬¦ç¼ç  Java ä¸­å®ç°å½éå å®ä¹ä¸åè¯­ç§çæ¨¡æ¿ å®ä¹ properties æä»¶ Unicode è½¬æ¢å·¥å· éæ©è¯­ç§ Locale å è½½æå®è¯­ç§çæ¨¡æ¿ ResourceBoundle æ¯æå½éåçå·¥å·ç±» NumberFormat DateFormat MessageFormat",content:'# Java å½éå\n\n\n# èæ¯ç¥è¯\n\néè®¯çåè¾¾ï¼ä½¿å¾ä¸çåå°äº¤æµè¶æ¥è¶ç´§å¯ãè®¸å¤çè½¯ä»¶äº§åä¹è¦é¢åä¸çä¸ä¸åå½å®¶çç¨æ·ãå¶ä¸­ï¼è¯­è¨éç¢æ¾ç¶æ¯äº§åå¨ä¸åè¯­ç§ç¨æ·ä¸­è¿è¡æ¨å¹¿çä¸ä¸ªéè¦é®é¢ã\n\næ¬æå´ç»å½éåè¿ä¸ä¸»é¢ï¼åä»ç»å½éæ åçè¯­è¨ç¼ç ï¼ç¶åè®²è§£å¨ Java åºç¨ä¸­å¦ä½å»å®ç°å½éåã\n\n\n# è¯­è¨ç¼ç ãå½å®¶/å°åºç¼ç \n\nå web å¼åçæåå¯è½å¤å¤å°å°æ¥è§¦è¿ç±»ä¼¼ zh-cn, en-us è¿æ ·çç¼ç å­æ ·ã\n\nè¿äºç¼ç æ¯ç¨æ¥è¡¨ç¤ºæå®çå½å®¶å°åºçè¯­è¨ç±»åçãé£ä¹ï¼è¿äºå«æç¹æ®å«ä¹çç¼ç æ¯å¦ä½äº§ççå¢ï¼\n\nISO-639 æ åä½¿ç¨ç¼ç å®ä¹äºå½éä¸å¸¸è§çè¯­è¨ï¼æ¯ä¸ç§è¯­è¨ç±ä¸¤ä¸ªå°åå­æ¯è¡¨ç¤ºã\n\nISO-3166 æ åä½¿ç¨ç¼ç å®ä¹äºå½å®¶/å°åºï¼æ¯ä¸ªå½å®¶/å°åºç±ä¸¤ä¸ªå¤§åå­æ¯è¡¨ç¤ºã\n\nä¸è¡¨åä¸¾äºä¸äºå¸¸è§å½å®¶ãå°åºçè¯­è¨ç¼ç ï¼\n\nå½å®¶/å°åº        è¯­è¨ç¼ç     å½å®¶/å°åº        è¯­è¨ç¼ç \nç®ä½ä¸­æ(ä¸­å½)     zh-cn   ç¹ä½ä¸­æ(å°æ¹¾å°åº)   zh-tw\nç¹ä½ä¸­æ(é¦æ¸¯)     zh-hk   è±è¯­(é¦æ¸¯)       en-hk\nè±è¯­(ç¾å½)       en-us   è±è¯­(è±å½)       en-gb\nè±è¯­(å¨ç)       en-ww   è±è¯­(å æ¿å¤§)      en-ca\nè±è¯­(æ¾³å¤§å©äº)     en-au   è±è¯­(ç±å°å°)      en-ie\nè±è¯­(è¬å°)       en-fi   è¬å°è¯­(è¬å°)      fi-fi\nè±è¯­(ä¸¹éº¦)       en-dk   ä¸¹éº¦è¯­(ä¸¹éº¦)      da-dk\nè±è¯­(ä»¥è²å)      en-il   å¸ä¼¯æ¥è¯­(ä»¥è²å)    he-il\nè±è¯­(åé)       en-za   è±è¯­(å°åº¦)       en-in\nè±è¯­(æªå¨)       en-no   è±è¯­(æ°å å¡)      en-sg\nè±è¯­(æ°è¥¿å°)      en-nz   è±è¯­(å°åº¦å°¼è¥¿äº)    en-id\nè±è¯­(è²å¾å®¾)      en-ph   è±è¯­(æ³°å½)       en-th\nè±è¯­(é©¬æ¥è¥¿äº)     en-my   è±è¯­(é¿æä¼¯)      en-xa\né©æ(é©å½)       ko-kr   æ¥è¯­(æ¥æ¬)       ja-jp\nè·å°è¯­(è·å°)      nl-nl   è·å°è¯­(æ¯å©æ¶)     nl-be\nè¡èçè¯­(è¡èç)    pt-pt   è¡èçè¯­(å·´è¥¿)     pt-br\næ³è¯­(æ³å½)       fr-fr   æ³è¯­(å¢æ£®å ¡)      fr-lu\næ³è¯­(çå£«)       fr-ch   æ³è¯­(æ¯å©æ¶)      fr-be\næ³è¯­(å æ¿å¤§)      fr-ca   è¥¿ç­çè¯­(æä¸ç¾æ´²)   es-la\nè¥¿ç­çè¯­(è¥¿ç­ç)    es-es   è¥¿ç­çè¯­(é¿æ ¹å»·)    es-ar\nè¥¿ç­çè¯­(ç¾å½)     es-us   è¥¿ç­çè¯­(å¢¨è¥¿å¥)    es-mx\nè¥¿ç­çè¯­(å¥ä¼¦æ¯äº)   es-co   è¥¿ç­çè¯­(æ³¢å¤é»å)   es-pr\nå¾·è¯­(å¾·å½)       de-de   å¾·è¯­(å¥¥å°å©)      de-at\nå¾·è¯­(çå£«)       de-ch   ä¿è¯­(ä¿ç½æ¯)      ru-ru\næå¤§å©è¯­(æå¤§å©)    it-it   å¸èè¯­(å¸è)      el-gr\næªå¨è¯­(æªå¨)      no-no   åçå©è¯­(åçå©)    hu-hu\nåè³å¶è¯­(åè³å¶)    tr-tr   æ·åè¯­(æ·åå±åå½)   cs-cz\næ¯æ´æå°¼äºè¯­       sl-sl   æ³¢å°è¯­(æ³¢å°)      pl-pl\nçå¸è¯­(çå¸)      sv-se                \n\næ³¨ï¼ç±è¡¨ä¸­å¯ä»¥çåºè¯­è¨ãå½å®¶/å°åºç¼ç ä¸è¬é½æ¯è±æåè¯çç¼©åã\n\n\n# å­ç¬¦ç¼ç \n\nå¨æ­¤å¤ï¼å¼ç³ä¸ä¸å­ç¬¦ç¼ç çæ¦å¿µã\n\næ¯ä¸æ¯æäºè¯­è¨ãå½å®¶/å°åºç¼ç ï¼è®¡ç®æºå°±å¯ä»¥è¯å«åç§è¯­è¨äºï¼\n\nç­æ¡æ¯å¦ãä½ä¸ºç¨åºåï¼ç¸ä¿¡æ¯ä¸ªäººé½ä¼éå°è¿è¿æ ·çæåµï¼æææå°ä¸­æï¼ç»æè¾åºçå´æ¯ä¹±ç ã\n\nè¿ç§æåµï¼å¾å¾æ¯å ä¸ºå­ç¬¦ç¼ç çé®é¢ã\n\nè®¡ç®æºå¨è®¾è®¡ä¹åï¼å¹¶æ²¡æèèå¤ä¸ªå½å®¶ï¼å¤ç§ä¸åè¯­è¨çåºç¨åºæ¯ãå½æ¶å®ä¹ä¸ç§ASCIIç ï¼å°å­æ¯ãæ°å­åå¶ä»ç¬¦å·ç¼å·ç¨ 7 æ¯ç¹çäºè¿å¶æ°æ¥è¡¨ç¤ºãåæ¥ï¼è®¡ç®æºå¨ä¸çå¼å§æ®åï¼ä¸ºäºéåºå¤ç§æå­ï¼åºç°äºå¤ç§ç¼ç æ ¼å¼ï¼ä¾å¦ä¸­ææ±å­ä¸è¬ä½¿ç¨çç¼ç æ ¼å¼ä¸ºGB2312ãGBKã\n\nç±æ­¤ï¼åäº§çäºä¸ä¸ªé®é¢ï¼ä¸åå­ç¬¦ç¼ç ä¹é´äºç¸æ æ³è¯å«ãäºæ¯ï¼ä¸ºäºä¸ç»æ±æ¹ï¼åºç°äº unicode ç¼ç ãå®ä¸ºæ¯ç§è¯­è¨çæ¯ä¸ªå­ç¬¦è®¾å®äºç»ä¸å¹¶ä¸å¯ä¸çäºè¿å¶ç¼ç ï¼ä»¥æ»¡è¶³è·¨è¯­è¨ãè·¨å¹³å°çææ¬è½¬æ¢éæ±ã\n\næäººä¸ç¦è¦é®ï¼æ¢ç¶ Unicode å¯ä»¥æ¯æææè¯­è¨çå­ç¬¦ï¼é£è¿è¦å¶ä»å­ç¬¦ç¼ç åä»ä¹ï¼\n\nUnicode æä¸ä¸ªç¼ºç¹ï¼ä¸ºäºæ¯æææè¯­è¨çå­ç¬¦ï¼æä»¥å®éè¦ç¨æ´å¤ä½æ°å»è¡¨ç¤ºï¼æ¯å¦ ASCII è¡¨ç¤ºä¸ä¸ªè±æå­ç¬¦åªéè¦ä¸ä¸ªå­èï¼è Unicode åéè¦ä¸¤ä¸ªå­èãå¾ææ¾ï¼å¦æå­ç¬¦æ°å¤ï¼è¿æ ·çæçä¼å¾ä½ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æåºç°äºä¸äºä¸­é´æ ¼å¼çå­ç¬¦ç¼ç ï¼å¦ UTF-8ãUTF-16ãUTF-32 ç­ï¼ä¸­å½çç¨åºåä¸è¬ä½¿ç¨UTF-8ç¼ç ï¼ã\n\n\n# Java ä¸­å®ç°å½éå\n\nå½éåçå®ç°åçå¾ç®åï¼\n\n 1. åå®ä¹å¥½ä¸åè¯­ç§çæ¨¡æ¿ï¼\n 2. éæ©è¯­ç§ï¼\n 3. å è½½æå®è¯­ç§çæ¨¡æ¿ã\n\næ¥ä¸æ¥ï¼æ¬æä¼æç§æ­¥éª¤éä¸è®²è§£å®ç°å½éåçå·ä½æ­¥éª¤\n\n\n# å®ä¹ä¸åè¯­ç§çæ¨¡æ¿\n\nJava ä¸­å°å¤è¯­è¨ææ¬å­å¨å¨æ ¼å¼ä¸º properties çèµæºæä»¶ä¸­ã\n\nå®å¿é¡»éµç§ä»¥ä¸çå½åè§èï¼\n\n<èµæºå>_<è¯­è¨ä»£ç >_<å½å®¶/å°åºç¼ç >.properties\n\n\nå¶ä¸­ï¼è¯­è¨ç¼ç åå½å®¶/å°åºç¼ç é½æ¯å¯éçã\n\næ³¨ï¼<èµæºå>.properties å½åçå½éåèµæºæä»¶æ¯é»è®¤çèµæºæä»¶ï¼å³æä¸ªå½éåç±»åå¨ç³»ç»ä¸­æ¾ä¸å°å¯¹åºçèµæºæä»¶ï¼å°±éç¨è¿ä¸ªé»è®¤çèµæºæä»¶ã\n\n# å®ä¹ properties æä»¶\n\nå¨src/main/resources/locales è·¯å¾ä¸å®ä¹åä¸º content çä¸åè¯­ç§èµæºæä»¶ï¼\n\ncontent_en_US.properties\n\nhelloWorld = HelloWorld!\ntime = The current time is %s.\n\n\ncontent_zh_CN.properties\n\nhelloWorld = \\u4e16\\u754c\\uff0c\\u4f60\\u597d\\uff01\ntime = \\u5f53\\u524d\\u65f6\\u95f4\\u662f\\u0025\\u0073\\u3002\n\n\nå¯ä»¥çå°ï¼å ä¸ªèµæºæä»¶ä¸­ï¼å®ä¹ç Key å®å¨ä¸è´ï¼åªæ¯ Value æ¯å¯¹åºè¯­è¨çå­ç¬¦ä¸²ã\n\nè½ç¶å±æ§å¼åä¸ç¸åï¼ä½å±æ§åå´æ¯ç¸åçï¼è¿æ ·åºç¨ç¨åºå°±å¯ä»¥éè¿ Locale å¯¹è±¡åå±æ§åç²¾ç¡®è°ç¨å°æä¸ªå·ä½çå±æ§å¼äºã\n\n# Unicode è½¬æ¢å·¥å·\n\nä¸ä¸èä¸­ï¼æä»¬å®ä¹çä¸­æèµæºæä»¶ä¸­çå±æ§å¼é½æ¯ä»¥\\u å¼å¤´çåä½ 16 è¿å¶æ°ãå¶å®ï¼è¿è¡¨ç¤ºçæ¯ä¸ä¸ª Unicode ç¼ç ã\n\nhelloWorld = \\u4e16\\u754c\\uff0c\\u4f60\\u597d\\uff01\ntime = \\u5f53\\u524d\\u65f6\\u95f4\\u662f\\u0025\\u0073\\u3002\n\n\næ¬æçå­ç¬¦ç¼ç ä¸­æå°äºï¼ä¸ºäºè¾¾å°è·¨ç¼ç ä¹æ­£å¸¸æ¾ç¤ºçç®çï¼æå¿è¦å°é ASCII å­ç¬¦è½¬ä¸º Unicode ç¼ç ãä¸é¢çä¸­æèµæºæä»¶å°±æ¯ä¸­æè½¬ä¸º Unicode çç»æã\n\næä¹å°é ASCII å­ç¬¦è½¬ä¸º Unicode ç¼ç å¢ï¼\n\nJDK å¨ bin ç®å½ä¸ä¸ºæä»¬æä¾äºä¸ä¸ªè½¬æ¢å·¥å·ï¼native2asciiã\n\nå®å¯ä»¥å°ä¸­æå­ç¬¦çèµæºæä»¶è½¬æ¢ä¸º Unicode ä»£ç æ ¼å¼çæä»¶ï¼å½ä»¤æ ¼å¼å¦ä¸ï¼\n\nnative2ascii [-reverse] [-encoding ç¼ç ] [è¾å¥æä»¶ [è¾åºæä»¶]]\n\n\nåè®¾content_zh_CN.properties å¨ d:\\ ç®å½ãæ§è¡ä»¥ä¸å½ä»¤å¯ä»¥æ°å»ºä¸ä¸ªåä¸º content_zh_CN_new.properties çæä»¶ï¼å¶ä¸­çåå®¹å°±ä¸­æå­ç¬¦è½¬ä¸º UTF-8 ç¼ç æ ¼å¼çç»æã\n\nnative2ascii -encoding utf-8 d:\\content_zh_CN.properties d:\\content_zh_CN_new.properties\n\n\n\n# éæ©è¯­ç§\n\nå®ä¹äºå¤è¯­è¨èµæºæä»¶ï¼ç¬¬äºæ­¥å°±æ¯æ ¹æ®æ¬å°è¯­ç§éæ©æ¨¡æ¿æä»¶äºã\n\n# Locale\n\nå¨ Java ä¸­ï¼ä¸ä¸ª java.util.Locale å¯¹è±¡è¡¨ç¤ºäºç¹å®çå°çãæ¿æ²»åæåå°åºãéè¦ Locale æ¥æ§è¡å¶ä»»å¡çæä½ç§°ä¸ºè¯­è¨ç¯å¢ææçæä½ï¼å®ä½¿ç¨ Locale ä¸ºç¨æ·éèº«å®å¶æ¬å°ä¿¡æ¯ã\n\nå®æä¸ä¸ªæé æ¹æ³\n\nLocale(String language) ï¼æ ¹æ®è¯­è¨ç¼ç åå§å Locale(String language, String country) ï¼æ ¹æ®è¯­è¨ç¼ç ãå½å®¶ç¼ç åå§å Locale(String language, String country, String variant) ï¼æ ¹æ®è¯­è¨ç¼ç ãå½å®¶ç¼ç ãåä½åå§å\n\næ­¤å¤ï¼Locale å®ä¹äºä¸äºå¸¸ç¨ç Locale å¸¸éï¼Locale.ENGLISHãLocale.CHINESE ç­ã\n\n// åå§åä¸ä¸ªéç¨è±è¯­çlocale.\nLocale locale1 = new Locale("en");\n// åå§åä¸ä¸ªå æ¿å¤§è±è¯­çlocale.\nLocale locale2 = new Locale("en", "CA");\n// åå§åä¸ä¸ªç¾å¼è±è¯­åç§ç¡è°·è±è¯­çlocale\nLocale locale3 = new Locale("en", "US", "SiliconValley");\n// æ ¹æ®Localeå¸¸éåå§åä¸ä¸ªç®ä½ä¸­æ\nLocale locale4 = Locale.SIMPLIFIED_CHINESE;\n\n\n\n# å è½½æå®è¯­ç§çæ¨¡æ¿\n\n# ResourceBoundle\n\nJava ä¸ºæä»¬æä¾äºç¨äºå è½½å½éåèµæºæä»¶çå·¥å·ç±»ï¼java.util.ResourceBoundleã\n\nResourceBoundle æä¾äºå¤ä¸ªåä¸º getBundle çéæéè½½æ¹æ³ï¼è¿äºæ¹æ³çä½ç¨æ¯ç¨æ¥æ ¹æ®èµæºåãLocale éæ©æå®è¯­ç§çèµæºæä»¶ãéè¦è¯´æçæ¯ï¼ getBundle æ¹æ³çç¬¬ä¸ä¸ªåæ°ä¸è¬é½æ¯baseName ï¼è¿ä¸ªåæ°è¡¨ç¤ºèµæºæä»¶åã\n\nResourceBoundle è¿æä¾äºåä¸º getString çæ¹æ³ï¼ç¨æ¥è·åèµæºæä»¶ä¸­ key å¯¹åºç valueã\n\nimport java.util.Locale;\nimport java.util.ResourceBundle;\n\npublic class ResourceBundleDemo {\n\n    public static void main(String[] args) {\n        // æ ¹æ®è¯­è¨+å°åºç¼ç åå§å\n        ResourceBundle rbUS = ResourceBundle.getBundle("locales.content", new Locale("en", "US"));\n        // æ ¹æ®Localeå¸¸éåå§å\n        ResourceBundle rbZhCN = ResourceBundle.getBundle("locales.content", Locale.SIMPLIFIED_CHINESE);\n        // è·åæ¬å°ç³»ç»é»è®¤çLocaleåå§å\n        ResourceBundle rbDefault = ResourceBundle.getBundle("locales.content");\n        // ResourceBundle rbDefault =ResourceBundle.getBundle("locales.content", Locale.getDefault()); // ä¸ä¸è¡ä»£ç ç­ä»·\n\n        System.out.println("en-US:" + rbUS.getString("helloWorld"));\n        System.out.println("en-US:" + String.format(rbUS.getString("time"), "08:00"));\n        System.out.println("zh-CNï¼" + rbZhCN.getString("helloWorld"));\n        System.out.println("zh-CNï¼" + String.format(rbZhCN.getString("time"), "08:00"));\n        System.out.println("defaultï¼" + rbDefault.getString("helloWorld"));\n        System.out.println("defaultï¼" + String.format(rbDefault.getString("time"), "08:00"));\n    }\n\n}\n\n// è¾åºï¼\n// en-US:HelloWorld!\n// en-US:The current time is 08:00.\n// zh-CNï¼ä¸çï¼ä½ å¥½ï¼\n// zh-CNï¼å½åæ¶é´æ¯08:00ã\n// defaultï¼ä¸çï¼ä½ å¥½ï¼\n// defaultï¼å½åæ¶é´æ¯08:00ã\n\n\næ³¨ï¼å¨å è½½èµæºæ¶ï¼å¦ææå®çå½éåèµæºæä»¶ä¸å­å¨ï¼å®ä¼å°è¯æä¸é¢çé¡ºåºå è½½å¶ä»çèµæºï¼æ¬å°ç³»ç»é»è®¤å½éåå¯¹è±¡å¯¹åºçèµæº -> é»è®¤çèµæºãå¦ææå®éè¯¯ï¼Java ä¼æç¤ºæ¾ä¸å°èµæºæä»¶ã\n\n\n# æ¯æå½éåçå·¥å·ç±»\n\nJava ä¸­ä¹æä¾äºå ä¸ªæ¯æå½éåçæ ¼å¼åå·¥å·ç±»ãä¾å¦ï¼NumberFormatãDateFormatãMessageFormat\n\n\n# NumberFormat\n\nNumberFormat æ¯æææ°å­æ ¼å¼ç±»çåºç±»ãå®æä¾æ ¼å¼ååè§£ææ°å­çæ¥å£ãå®ä¹æä¾äºå³å®æ°å­æå±è¯­è¨ç±»åçæ¹æ³ã\n\nimport java.text.NumberFormat;\nimport java.util.Locale;\n\npublic class NumberFormatDemo {\n\n    public static void main(String[] args) {\n        double num = 123456.78;\n        NumberFormat format = NumberFormat.getCurrencyInstance(Locale.SIMPLIFIED_CHINESE);\n        System.out.format("%f çå½éåï¼%sï¼ç»æ: %s\\n", num, Locale.SIMPLIFIED_CHINESE, format.format(num));\n    }\n\n}\n\n// è¾åºï¼\n// 123456.780000 çå½éåï¼zh_CNï¼ç»æ: ï¿¥123,456.78\n\n\n\n# DateFormat\n\nDateFormat æ¯æ¥æãæ¶é´æ ¼å¼åç±»çæ½è±¡ç±»ãå®æ¯æåºäºè¯­è¨ä¹ æ¯çæ¥æãæ¶é´æ ¼å¼ã\n\nimport java.text.DateFormat;\nimport java.util.Date;\nimport java.util.Locale;\n\npublic class DateFormatDemo {\n\n    public static void main(String[] args) {\n        Date date = new Date();\n        DateFormat df = DateFormat.getDateInstance(DateFormat.MEDIUM, Locale.ENGLISH);\n        DateFormat df2 = DateFormat.getDateInstance(DateFormat.MEDIUM, Locale.SIMPLIFIED_CHINESE);\n        System.out.format("%s çå½éåï¼%sï¼ç»æ: %s\\n", date, Locale.ENGLISH, df.format(date));\n        System.out.format("%s çå½éåï¼%sï¼ç»æ: %s\\n", date, Locale.SIMPLIFIED_CHINESE, df2.format(date));\n    }\n\n}\n\n// è¾åº\n// Fri Dec 23 11:14:45 CST 2022 çå½éåï¼enï¼ç»æ: Dec 23, 2022\n// Fri Dec 23 11:14:45 CST 2022 çå½éåï¼zh_CNï¼ç»æ: 2022-12-23\n\n\n\n# MessageFormat\n\nMessageformat æä¾ä¸ç§ä¸è¯­è¨æ å³çæ¼æ¥æ¶æ¯çæ¹å¼ãéè¿è¿ç§æ¼æ¥æ¹å¼ï¼å°æç»åç°è¿åç»ä½¿ç¨èã\n\nimport java.text.MessageFormat;\nimport java.util.GregorianCalendar;\nimport java.util.Locale;\n\npublic class MessageFormatDemo {\n\n    public static void main(String[] args) {\n        String pattern1 = "{0}ï¼ä½ å¥½ï¼ä½ äº {1} æ¶è´¹ {2} åã";\n        String pattern2 = "At {1,time,short} On {1,date,long}ï¼{0} paid {2,number, currency}.";\n        Object[] params = { "Jack", new GregorianCalendar().getTime(), 8888 };\n        String msg1 = MessageFormat.format(pattern1, params);\n        MessageFormat mf = new MessageFormat(pattern2, Locale.US);\n        String msg2 = mf.format(params);\n        System.out.println(msg1);\n        System.out.println(msg2);\n    }\n\n}\n\n// è¾åºï¼\n// Jackï¼ä½ å¥½ï¼ä½ äº 22-12-23 ä¸å11:05 æ¶è´¹ 8,888 åã\n// At 11:05 AM On December 23, 2022ï¼Jack paid $8,888.00.\n',normalizedContent:'# java å½éå\n\n\n# èæ¯ç¥è¯\n\néè®¯çåè¾¾ï¼ä½¿å¾ä¸çåå°äº¤æµè¶æ¥è¶ç´§å¯ãè®¸å¤çè½¯ä»¶äº§åä¹è¦é¢åä¸çä¸ä¸åå½å®¶çç¨æ·ãå¶ä¸­ï¼è¯­è¨éç¢æ¾ç¶æ¯äº§åå¨ä¸åè¯­ç§ç¨æ·ä¸­è¿è¡æ¨å¹¿çä¸ä¸ªéè¦é®é¢ã\n\næ¬æå´ç»å½éåè¿ä¸ä¸»é¢ï¼åä»ç»å½éæ åçè¯­è¨ç¼ç ï¼ç¶åè®²è§£å¨ java åºç¨ä¸­å¦ä½å»å®ç°å½éåã\n\n\n# è¯­è¨ç¼ç ãå½å®¶/å°åºç¼ç \n\nå web å¼åçæåå¯è½å¤å¤å°å°æ¥è§¦è¿ç±»ä¼¼ zh-cn, en-us è¿æ ·çç¼ç å­æ ·ã\n\nè¿äºç¼ç æ¯ç¨æ¥è¡¨ç¤ºæå®çå½å®¶å°åºçè¯­è¨ç±»åçãé£ä¹ï¼è¿äºå«æç¹æ®å«ä¹çç¼ç æ¯å¦ä½äº§ççå¢ï¼\n\niso-639 æ åä½¿ç¨ç¼ç å®ä¹äºå½éä¸å¸¸è§çè¯­è¨ï¼æ¯ä¸ç§è¯­è¨ç±ä¸¤ä¸ªå°åå­æ¯è¡¨ç¤ºã\n\niso-3166 æ åä½¿ç¨ç¼ç å®ä¹äºå½å®¶/å°åºï¼æ¯ä¸ªå½å®¶/å°åºç±ä¸¤ä¸ªå¤§åå­æ¯è¡¨ç¤ºã\n\nä¸è¡¨åä¸¾äºä¸äºå¸¸è§å½å®¶ãå°åºçè¯­è¨ç¼ç ï¼\n\nå½å®¶/å°åº        è¯­è¨ç¼ç     å½å®¶/å°åº        è¯­è¨ç¼ç \nç®ä½ä¸­æ(ä¸­å½)     zh-cn   ç¹ä½ä¸­æ(å°æ¹¾å°åº)   zh-tw\nç¹ä½ä¸­æ(é¦æ¸¯)     zh-hk   è±è¯­(é¦æ¸¯)       en-hk\nè±è¯­(ç¾å½)       en-us   è±è¯­(è±å½)       en-gb\nè±è¯­(å¨ç)       en-ww   è±è¯­(å æ¿å¤§)      en-ca\nè±è¯­(æ¾³å¤§å©äº)     en-au   è±è¯­(ç±å°å°)      en-ie\nè±è¯­(è¬å°)       en-fi   è¬å°è¯­(è¬å°)      fi-fi\nè±è¯­(ä¸¹éº¦)       en-dk   ä¸¹éº¦è¯­(ä¸¹éº¦)      da-dk\nè±è¯­(ä»¥è²å)      en-il   å¸ä¼¯æ¥è¯­(ä»¥è²å)    he-il\nè±è¯­(åé)       en-za   è±è¯­(å°åº¦)       en-in\nè±è¯­(æªå¨)       en-no   è±è¯­(æ°å å¡)      en-sg\nè±è¯­(æ°è¥¿å°)      en-nz   è±è¯­(å°åº¦å°¼è¥¿äº)    en-id\nè±è¯­(è²å¾å®¾)      en-ph   è±è¯­(æ³°å½)       en-th\nè±è¯­(é©¬æ¥è¥¿äº)     en-my   è±è¯­(é¿æä¼¯)      en-xa\né©æ(é©å½)       ko-kr   æ¥è¯­(æ¥æ¬)       ja-jp\nè·å°è¯­(è·å°)      nl-nl   è·å°è¯­(æ¯å©æ¶)     nl-be\nè¡èçè¯­(è¡èç)    pt-pt   è¡èçè¯­(å·´è¥¿)     pt-br\næ³è¯­(æ³å½)       fr-fr   æ³è¯­(å¢æ£®å ¡)      fr-lu\næ³è¯­(çå£«)       fr-ch   æ³è¯­(æ¯å©æ¶)      fr-be\næ³è¯­(å æ¿å¤§)      fr-ca   è¥¿ç­çè¯­(æä¸ç¾æ´²)   es-la\nè¥¿ç­çè¯­(è¥¿ç­ç)    es-es   è¥¿ç­çè¯­(é¿æ ¹å»·)    es-ar\nè¥¿ç­çè¯­(ç¾å½)     es-us   è¥¿ç­çè¯­(å¢¨è¥¿å¥)    es-mx\nè¥¿ç­çè¯­(å¥ä¼¦æ¯äº)   es-co   è¥¿ç­çè¯­(æ³¢å¤é»å)   es-pr\nå¾·è¯­(å¾·å½)       de-de   å¾·è¯­(å¥¥å°å©)      de-at\nå¾·è¯­(çå£«)       de-ch   ä¿è¯­(ä¿ç½æ¯)      ru-ru\næå¤§å©è¯­(æå¤§å©)    it-it   å¸èè¯­(å¸è)      el-gr\næªå¨è¯­(æªå¨)      no-no   åçå©è¯­(åçå©)    hu-hu\nåè³å¶è¯­(åè³å¶)    tr-tr   æ·åè¯­(æ·åå±åå½)   cs-cz\næ¯æ´æå°¼äºè¯­       sl-sl   æ³¢å°è¯­(æ³¢å°)      pl-pl\nçå¸è¯­(çå¸)      sv-se                \n\næ³¨ï¼ç±è¡¨ä¸­å¯ä»¥çåºè¯­è¨ãå½å®¶/å°åºç¼ç ä¸è¬é½æ¯è±æåè¯çç¼©åã\n\n\n# å­ç¬¦ç¼ç \n\nå¨æ­¤å¤ï¼å¼ç³ä¸ä¸å­ç¬¦ç¼ç çæ¦å¿µã\n\næ¯ä¸æ¯æäºè¯­è¨ãå½å®¶/å°åºç¼ç ï¼è®¡ç®æºå°±å¯ä»¥è¯å«åç§è¯­è¨äºï¼\n\nç­æ¡æ¯å¦ãä½ä¸ºç¨åºåï¼ç¸ä¿¡æ¯ä¸ªäººé½ä¼éå°è¿è¿æ ·çæåµï¼æææå°ä¸­æï¼ç»æè¾åºçå´æ¯ä¹±ç ã\n\nè¿ç§æåµï¼å¾å¾æ¯å ä¸ºå­ç¬¦ç¼ç çé®é¢ã\n\nè®¡ç®æºå¨è®¾è®¡ä¹åï¼å¹¶æ²¡æèèå¤ä¸ªå½å®¶ï¼å¤ç§ä¸åè¯­è¨çåºç¨åºæ¯ãå½æ¶å®ä¹ä¸ç§asciiç ï¼å°å­æ¯ãæ°å­åå¶ä»ç¬¦å·ç¼å·ç¨ 7 æ¯ç¹çäºè¿å¶æ°æ¥è¡¨ç¤ºãåæ¥ï¼è®¡ç®æºå¨ä¸çå¼å§æ®åï¼ä¸ºäºéåºå¤ç§æå­ï¼åºç°äºå¤ç§ç¼ç æ ¼å¼ï¼ä¾å¦ä¸­ææ±å­ä¸è¬ä½¿ç¨çç¼ç æ ¼å¼ä¸ºgb2312ãgbkã\n\nç±æ­¤ï¼åäº§çäºä¸ä¸ªé®é¢ï¼ä¸åå­ç¬¦ç¼ç ä¹é´äºç¸æ æ³è¯å«ãäºæ¯ï¼ä¸ºäºä¸ç»æ±æ¹ï¼åºç°äº unicode ç¼ç ãå®ä¸ºæ¯ç§è¯­è¨çæ¯ä¸ªå­ç¬¦è®¾å®äºç»ä¸å¹¶ä¸å¯ä¸çäºè¿å¶ç¼ç ï¼ä»¥æ»¡è¶³è·¨è¯­è¨ãè·¨å¹³å°çææ¬è½¬æ¢éæ±ã\n\næäººä¸ç¦è¦é®ï¼æ¢ç¶ unicode å¯ä»¥æ¯æææè¯­è¨çå­ç¬¦ï¼é£è¿è¦å¶ä»å­ç¬¦ç¼ç åä»ä¹ï¼\n\nunicode æä¸ä¸ªç¼ºç¹ï¼ä¸ºäºæ¯æææè¯­è¨çå­ç¬¦ï¼æä»¥å®éè¦ç¨æ´å¤ä½æ°å»è¡¨ç¤ºï¼æ¯å¦ ascii è¡¨ç¤ºä¸ä¸ªè±æå­ç¬¦åªéè¦ä¸ä¸ªå­èï¼è unicode åéè¦ä¸¤ä¸ªå­èãå¾ææ¾ï¼å¦æå­ç¬¦æ°å¤ï¼è¿æ ·çæçä¼å¾ä½ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æåºç°äºä¸äºä¸­é´æ ¼å¼çå­ç¬¦ç¼ç ï¼å¦ utf-8ãutf-16ãutf-32 ç­ï¼ä¸­å½çç¨åºåä¸è¬ä½¿ç¨utf-8ç¼ç ï¼ã\n\n\n# java ä¸­å®ç°å½éå\n\nå½éåçå®ç°åçå¾ç®åï¼\n\n 1. åå®ä¹å¥½ä¸åè¯­ç§çæ¨¡æ¿ï¼\n 2. éæ©è¯­ç§ï¼\n 3. å è½½æå®è¯­ç§çæ¨¡æ¿ã\n\næ¥ä¸æ¥ï¼æ¬æä¼æç§æ­¥éª¤éä¸è®²è§£å®ç°å½éåçå·ä½æ­¥éª¤\n\n\n# å®ä¹ä¸åè¯­ç§çæ¨¡æ¿\n\njava ä¸­å°å¤è¯­è¨ææ¬å­å¨å¨æ ¼å¼ä¸º properties çèµæºæä»¶ä¸­ã\n\nå®å¿é¡»éµç§ä»¥ä¸çå½åè§èï¼\n\n<èµæºå>_<è¯­è¨ä»£ç >_<å½å®¶/å°åºç¼ç >.properties\n\n\nå¶ä¸­ï¼è¯­è¨ç¼ç åå½å®¶/å°åºç¼ç é½æ¯å¯éçã\n\næ³¨ï¼<èµæºå>.properties å½åçå½éåèµæºæä»¶æ¯é»è®¤çèµæºæä»¶ï¼å³æä¸ªå½éåç±»åå¨ç³»ç»ä¸­æ¾ä¸å°å¯¹åºçèµæºæä»¶ï¼å°±éç¨è¿ä¸ªé»è®¤çèµæºæä»¶ã\n\n# å®ä¹ properties æä»¶\n\nå¨src/main/resources/locales è·¯å¾ä¸å®ä¹åä¸º content çä¸åè¯­ç§èµæºæä»¶ï¼\n\ncontent_en_us.properties\n\nhelloworld = helloworld!\ntime = the current time is %s.\n\n\ncontent_zh_cn.properties\n\nhelloworld = \\u4e16\\u754c\\uff0c\\u4f60\\u597d\\uff01\ntime = \\u5f53\\u524d\\u65f6\\u95f4\\u662f\\u0025\\u0073\\u3002\n\n\nå¯ä»¥çå°ï¼å ä¸ªèµæºæä»¶ä¸­ï¼å®ä¹ç key å®å¨ä¸è´ï¼åªæ¯ value æ¯å¯¹åºè¯­è¨çå­ç¬¦ä¸²ã\n\nè½ç¶å±æ§å¼åä¸ç¸åï¼ä½å±æ§åå´æ¯ç¸åçï¼è¿æ ·åºç¨ç¨åºå°±å¯ä»¥éè¿ locale å¯¹è±¡åå±æ§åç²¾ç¡®è°ç¨å°æä¸ªå·ä½çå±æ§å¼äºã\n\n# unicode è½¬æ¢å·¥å·\n\nä¸ä¸èä¸­ï¼æä»¬å®ä¹çä¸­æèµæºæä»¶ä¸­çå±æ§å¼é½æ¯ä»¥\\u å¼å¤´çåä½ 16 è¿å¶æ°ãå¶å®ï¼è¿è¡¨ç¤ºçæ¯ä¸ä¸ª unicode ç¼ç ã\n\nhelloworld = \\u4e16\\u754c\\uff0c\\u4f60\\u597d\\uff01\ntime = \\u5f53\\u524d\\u65f6\\u95f4\\u662f\\u0025\\u0073\\u3002\n\n\næ¬æçå­ç¬¦ç¼ç ä¸­æå°äºï¼ä¸ºäºè¾¾å°è·¨ç¼ç ä¹æ­£å¸¸æ¾ç¤ºçç®çï¼æå¿è¦å°é ascii å­ç¬¦è½¬ä¸º unicode ç¼ç ãä¸é¢çä¸­æèµæºæä»¶å°±æ¯ä¸­æè½¬ä¸º unicode çç»æã\n\næä¹å°é ascii å­ç¬¦è½¬ä¸º unicode ç¼ç å¢ï¼\n\njdk å¨ bin ç®å½ä¸ä¸ºæä»¬æä¾äºä¸ä¸ªè½¬æ¢å·¥å·ï¼native2asciiã\n\nå®å¯ä»¥å°ä¸­æå­ç¬¦çèµæºæä»¶è½¬æ¢ä¸º unicode ä»£ç æ ¼å¼çæä»¶ï¼å½ä»¤æ ¼å¼å¦ä¸ï¼\n\nnative2ascii [-reverse] [-encoding ç¼ç ] [è¾å¥æä»¶ [è¾åºæä»¶]]\n\n\nåè®¾content_zh_cn.properties å¨ d:\\ ç®å½ãæ§è¡ä»¥ä¸å½ä»¤å¯ä»¥æ°å»ºä¸ä¸ªåä¸º content_zh_cn_new.properties çæä»¶ï¼å¶ä¸­çåå®¹å°±ä¸­æå­ç¬¦è½¬ä¸º utf-8 ç¼ç æ ¼å¼çç»æã\n\nnative2ascii -encoding utf-8 d:\\content_zh_cn.properties d:\\content_zh_cn_new.properties\n\n\n\n# éæ©è¯­ç§\n\nå®ä¹äºå¤è¯­è¨èµæºæä»¶ï¼ç¬¬äºæ­¥å°±æ¯æ ¹æ®æ¬å°è¯­ç§éæ©æ¨¡æ¿æä»¶äºã\n\n# locale\n\nå¨ java ä¸­ï¼ä¸ä¸ª java.util.locale å¯¹è±¡è¡¨ç¤ºäºç¹å®çå°çãæ¿æ²»åæåå°åºãéè¦ locale æ¥æ§è¡å¶ä»»å¡çæä½ç§°ä¸ºè¯­è¨ç¯å¢ææçæä½ï¼å®ä½¿ç¨ locale ä¸ºç¨æ·éèº«å®å¶æ¬å°ä¿¡æ¯ã\n\nå®æä¸ä¸ªæé æ¹æ³\n\nlocale(string language) ï¼æ ¹æ®è¯­è¨ç¼ç åå§å locale(string language, string country) ï¼æ ¹æ®è¯­è¨ç¼ç ãå½å®¶ç¼ç åå§å locale(string language, string country, string variant) ï¼æ ¹æ®è¯­è¨ç¼ç ãå½å®¶ç¼ç ãåä½åå§å\n\næ­¤å¤ï¼locale å®ä¹äºä¸äºå¸¸ç¨ç locale å¸¸éï¼locale.englishãlocale.chinese ç­ã\n\n// åå§åä¸ä¸ªéç¨è±è¯­çlocale.\nlocale locale1 = new locale("en");\n// åå§åä¸ä¸ªå æ¿å¤§è±è¯­çlocale.\nlocale locale2 = new locale("en", "ca");\n// åå§åä¸ä¸ªç¾å¼è±è¯­åç§ç¡è°·è±è¯­çlocale\nlocale locale3 = new locale("en", "us", "siliconvalley");\n// æ ¹æ®localeå¸¸éåå§åä¸ä¸ªç®ä½ä¸­æ\nlocale locale4 = locale.simplified_chinese;\n\n\n\n# å è½½æå®è¯­ç§çæ¨¡æ¿\n\n# resourceboundle\n\njava ä¸ºæä»¬æä¾äºç¨äºå è½½å½éåèµæºæä»¶çå·¥å·ç±»ï¼java.util.resourceboundleã\n\nresourceboundle æä¾äºå¤ä¸ªåä¸º getbundle çéæéè½½æ¹æ³ï¼è¿äºæ¹æ³çä½ç¨æ¯ç¨æ¥æ ¹æ®èµæºåãlocale éæ©æå®è¯­ç§çèµæºæä»¶ãéè¦è¯´æçæ¯ï¼ getbundle æ¹æ³çç¬¬ä¸ä¸ªåæ°ä¸è¬é½æ¯basename ï¼è¿ä¸ªåæ°è¡¨ç¤ºèµæºæä»¶åã\n\nresourceboundle è¿æä¾äºåä¸º getstring çæ¹æ³ï¼ç¨æ¥è·åèµæºæä»¶ä¸­ key å¯¹åºç valueã\n\nimport java.util.locale;\nimport java.util.resourcebundle;\n\npublic class resourcebundledemo {\n\n    public static void main(string[] args) {\n        // æ ¹æ®è¯­è¨+å°åºç¼ç åå§å\n        resourcebundle rbus = resourcebundle.getbundle("locales.content", new locale("en", "us"));\n        // æ ¹æ®localeå¸¸éåå§å\n        resourcebundle rbzhcn = resourcebundle.getbundle("locales.content", locale.simplified_chinese);\n        // è·åæ¬å°ç³»ç»é»è®¤çlocaleåå§å\n        resourcebundle rbdefault = resourcebundle.getbundle("locales.content");\n        // resourcebundle rbdefault =resourcebundle.getbundle("locales.content", locale.getdefault()); // ä¸ä¸è¡ä»£ç ç­ä»·\n\n        system.out.println("en-us:" + rbus.getstring("helloworld"));\n        system.out.println("en-us:" + string.format(rbus.getstring("time"), "08:00"));\n        system.out.println("zh-cnï¼" + rbzhcn.getstring("helloworld"));\n        system.out.println("zh-cnï¼" + string.format(rbzhcn.getstring("time"), "08:00"));\n        system.out.println("defaultï¼" + rbdefault.getstring("helloworld"));\n        system.out.println("defaultï¼" + string.format(rbdefault.getstring("time"), "08:00"));\n    }\n\n}\n\n// è¾åºï¼\n// en-us:helloworld!\n// en-us:the current time is 08:00.\n// zh-cnï¼ä¸çï¼ä½ å¥½ï¼\n// zh-cnï¼å½åæ¶é´æ¯08:00ã\n// defaultï¼ä¸çï¼ä½ å¥½ï¼\n// defaultï¼å½åæ¶é´æ¯08:00ã\n\n\næ³¨ï¼å¨å è½½èµæºæ¶ï¼å¦ææå®çå½éåèµæºæä»¶ä¸å­å¨ï¼å®ä¼å°è¯æä¸é¢çé¡ºåºå è½½å¶ä»çèµæºï¼æ¬å°ç³»ç»é»è®¤å½éåå¯¹è±¡å¯¹åºçèµæº -> é»è®¤çèµæºãå¦ææå®éè¯¯ï¼java ä¼æç¤ºæ¾ä¸å°èµæºæä»¶ã\n\n\n# æ¯æå½éåçå·¥å·ç±»\n\njava ä¸­ä¹æä¾äºå ä¸ªæ¯æå½éåçæ ¼å¼åå·¥å·ç±»ãä¾å¦ï¼numberformatãdateformatãmessageformat\n\n\n# numberformat\n\nnumberformat æ¯æææ°å­æ ¼å¼ç±»çåºç±»ãå®æä¾æ ¼å¼ååè§£ææ°å­çæ¥å£ãå®ä¹æä¾äºå³å®æ°å­æå±è¯­è¨ç±»åçæ¹æ³ã\n\nimport java.text.numberformat;\nimport java.util.locale;\n\npublic class numberformatdemo {\n\n    public static void main(string[] args) {\n        double num = 123456.78;\n        numberformat format = numberformat.getcurrencyinstance(locale.simplified_chinese);\n        system.out.format("%f çå½éåï¼%sï¼ç»æ: %s\\n", num, locale.simplified_chinese, format.format(num));\n    }\n\n}\n\n// è¾åºï¼\n// 123456.780000 çå½éåï¼zh_cnï¼ç»æ: ï¿¥123,456.78\n\n\n\n# dateformat\n\ndateformat æ¯æ¥æãæ¶é´æ ¼å¼åç±»çæ½è±¡ç±»ãå®æ¯æåºäºè¯­è¨ä¹ æ¯çæ¥æãæ¶é´æ ¼å¼ã\n\nimport java.text.dateformat;\nimport java.util.date;\nimport java.util.locale;\n\npublic class dateformatdemo {\n\n    public static void main(string[] args) {\n        date date = new date();\n        dateformat df = dateformat.getdateinstance(dateformat.medium, locale.english);\n        dateformat df2 = dateformat.getdateinstance(dateformat.medium, locale.simplified_chinese);\n        system.out.format("%s çå½éåï¼%sï¼ç»æ: %s\\n", date, locale.english, df.format(date));\n        system.out.format("%s çå½éåï¼%sï¼ç»æ: %s\\n", date, locale.simplified_chinese, df2.format(date));\n    }\n\n}\n\n// è¾åº\n// fri dec 23 11:14:45 cst 2022 çå½éåï¼enï¼ç»æ: dec 23, 2022\n// fri dec 23 11:14:45 cst 2022 çå½éåï¼zh_cnï¼ç»æ: 2022-12-23\n\n\n\n# messageformat\n\nmessageformat æä¾ä¸ç§ä¸è¯­è¨æ å³çæ¼æ¥æ¶æ¯çæ¹å¼ãéè¿è¿ç§æ¼æ¥æ¹å¼ï¼å°æç»åç°è¿åç»ä½¿ç¨èã\n\nimport java.text.messageformat;\nimport java.util.gregoriancalendar;\nimport java.util.locale;\n\npublic class messageformatdemo {\n\n    public static void main(string[] args) {\n        string pattern1 = "{0}ï¼ä½ å¥½ï¼ä½ äº {1} æ¶è´¹ {2} åã";\n        string pattern2 = "at {1,time,short} on {1,date,long}ï¼{0} paid {2,number, currency}.";\n        object[] params = { "jack", new gregoriancalendar().gettime(), 8888 };\n        string msg1 = messageformat.format(pattern1, params);\n        messageformat mf = new messageformat(pattern2, locale.us);\n        string msg2 = mf.format(params);\n        system.out.println(msg1);\n        system.out.println(msg2);\n    }\n\n}\n\n// è¾åºï¼\n// jackï¼ä½ å¥½ï¼ä½ äº 22-12-23 ä¸å11:05 æ¶è´¹ 8,888 åã\n// at 11:05 am on december 23, 2022ï¼jack paid $8,888.00.\n',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JDK8 å¥é¨æå",frontmatter:{title:"JDK8 å¥é¨æå",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","é«çº§ç¹æ§"],tags:["Java","JavaSE","JDK8"],permalink:"/pages/ad1cce/"},regularPath:"/01.Java/01.JavaSE/02.%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/04.JDK8.html",relativePath:"01.Java/01.JavaSE/02.é«çº§ç¹æ§/04.JDK8.md",key:"v-2bdfddf8",path:"/pages/ad1cce/",headers:[{level:2,title:"Default Methods for Interfaces(æ¥å£çé»è®¤æ¹æ³)",slug:"default-methods-for-interfaces-æ¥å£çé»è®¤æ¹æ³",normalizedTitle:"default methods for interfaces(æ¥å£çé»è®¤æ¹æ³)",charIndex:150},{level:2,title:"Lambda expressions(Lambda è¡¨è¾¾å¼)",slug:"lambda-expressions-lambda-è¡¨è¾¾å¼",normalizedTitle:"lambda expressions(lambda è¡¨è¾¾å¼)",charIndex:766},{level:2,title:"Functional Interfaces(å½æ°æ¥å£)",slug:"functional-interfaces-å½æ°æ¥å£",normalizedTitle:"functional interfaces(å½æ°æ¥å£)",charIndex:1537},{level:2,title:"Method and Constructor References(æ¹æ³åæé å¨å¼ç¨)",slug:"method-and-constructor-references-æ¹æ³åæé å¨å¼ç¨",normalizedTitle:"method and constructor references(æ¹æ³åæé å¨å¼ç¨)",charIndex:2120},{level:2,title:"Lambda Scopes(Lambda ä½ç¨å)",slug:"lambda-scopes-lambda-ä½ç¨å",normalizedTitle:"lambda scopes(lambda ä½ç¨å)",charIndex:3321},{level:3,title:"Accessing local variables(è®¿é®æ¬å°åé)",slug:"accessing-local-variables-è®¿é®æ¬å°åé",normalizedTitle:"accessing local variables(è®¿é®æ¬å°åé)",charIndex:3414},{level:3,title:"Accessing fields and static variables(è®¿é®æååéåéæåé)",slug:"accessing-fields-and-static-variables-è®¿é®æååéåéæåé",normalizedTitle:"accessing fields and static variables(è®¿é®æååéåéæåé)",charIndex:4001},{level:3,title:"Accessing Default Interface Methodsï¼è®¿é®é»è®¤çæ¥å£æ¹æ³ï¼",slug:"accessing-default-interface-methods-è®¿é®é»è®¤çæ¥å£æ¹æ³",normalizedTitle:"accessing default interface methodsï¼è®¿é®é»è®¤çæ¥å£æ¹æ³ï¼",charIndex:4521},{level:2,title:"Built-in Functional Interfaces(åç½®å½æ°æ¥å£)",slug:"built-in-functional-interfaces-åç½®å½æ°æ¥å£",normalizedTitle:"built-in functional interfaces(åç½®å½æ°æ¥å£)",charIndex:4745},{level:3,title:"Predicates",slug:"predicates",normalizedTitle:"predicates",charIndex:5020},{level:3,title:"Functions",slug:"functions",normalizedTitle:"functions",charIndex:5428},{level:3,title:"Suppliers",slug:"suppliers",normalizedTitle:"suppliers",charIndex:5678},{level:3,title:"Consumers",slug:"consumers",normalizedTitle:"consumers",charIndex:5828},{level:3,title:"Comparators",slug:"comparators",normalizedTitle:"comparators",charIndex:6e3},{level:2,title:"Optionals",slug:"optionals",normalizedTitle:"optionals",charIndex:6327},{level:2,title:"Streams",slug:"streams",normalizedTitle:"streams",charIndex:6777},{level:3,title:"Filter",slug:"filter",normalizedTitle:"filter",charIndex:7451},{level:3,title:"Sorted",slug:"sorted",normalizedTitle:"sorted",charIndex:7711},{level:3,title:"Map",slug:"map",normalizedTitle:"map",charIndex:8052},{level:3,title:"Match",slug:"match",normalizedTitle:"match",charIndex:8359},{level:4,title:"Count",slug:"count",normalizedTitle:"count",charIndex:8897},{level:3,title:"Reduce",slug:"reduce",normalizedTitle:"reduce",charIndex:9095},{level:2,title:"Parallel Streams",slug:"parallel-streams",normalizedTitle:"parallel streams",charIndex:9375},{level:3,title:"Sequential Sort",slug:"sequential-sort",normalizedTitle:"sequential sort",charIndex:9692},{level:3,title:"Parallel Sort",slug:"parallel-sort",normalizedTitle:"parallel sort",charIndex:10010},{level:2,title:"Maps",slug:"maps",normalizedTitle:"maps",charIndex:10400},{level:2,title:"Date API",slug:"date-api",normalizedTitle:"date api",charIndex:11636},{level:3,title:"Clock",slug:"clock",normalizedTitle:"clock",charIndex:11741},{level:3,title:"Timezones",slug:"timezones",normalizedTitle:"timezones",charIndex:12089},{level:3,title:"LocalTime",slug:"localtime",normalizedTitle:"localtime",charIndex:12503},{level:3,title:"LocalDate",slug:"localdate",normalizedTitle:"localdate",charIndex:13329},{level:3,title:"LocalDateTime",slug:"localdatetime",normalizedTitle:"localdatetime",charIndex:14042},{level:2,title:"Annotations",slug:"annotations",normalizedTitle:"annotations",charIndex:15211},{level:3,title:"Variant 1: ä½¿ç¨å®¹å¨æ³¨è§£ (èå¥è·¯)",slug:"variant-1-ä½¿ç¨å®¹å¨æ³¨è§£-èå¥è·¯",normalizedTitle:"variant 1: ä½¿ç¨å®¹å¨æ³¨è§£ (èå¥è·¯)",charIndex:15441},{level:3,title:"Variant 2: ä½¿ç¨ repeatable æ³¨è§£ (æ°å¥è·¯)",slug:"variant-2-ä½¿ç¨-repeatable-æ³¨è§£-æ°å¥è·¯",normalizedTitle:"variant 2: ä½¿ç¨ repeatable æ³¨è§£ (æ°å¥è·¯)",charIndex:15528},{level:2,title:"JDK8 åçº§å¸¸è§é®é¢",slug:"jdk8-åçº§å¸¸è§é®é¢",normalizedTitle:"jdk8 åçº§å¸¸è§é®é¢",charIndex:15},{level:3,title:"Intellij ä¸­ç JDK ç¯å¢è®¾ç½®",slug:"intellij-ä¸­ç-jdk-ç¯å¢è®¾ç½®",normalizedTitle:"intellij ä¸­ç jdk ç¯å¢è®¾ç½®",charIndex:16524},{level:4,title:"Settings",slug:"settings",normalizedTitle:"settings",charIndex:16548},{level:4,title:"Projcet Settings",slug:"projcet-settings",normalizedTitle:"projcet settings",charIndex:16710},{level:4,title:"Application",slug:"application",normalizedTitle:"application",charIndex:16750},{level:3,title:"Linux ç¯å¢ä¿®æ¹",slug:"linux-ç¯å¢ä¿®æ¹",normalizedTitle:"linux ç¯å¢ä¿®æ¹",charIndex:16864},{level:4,title:"ä¿®æ¹ç¯å¢åé",slug:"ä¿®æ¹ç¯å¢åé",normalizedTitle:"ä¿®æ¹ç¯å¢åé",charIndex:16878},{level:4,title:"ä¿®æ¹ maven",slug:"ä¿®æ¹-maven",normalizedTitle:"ä¿®æ¹ maven",charIndex:17017},{level:4,title:"ä¿®æ¹ server",slug:"ä¿®æ¹-server",normalizedTitle:"ä¿®æ¹ server",charIndex:17143},{level:3,title:"sun.* åç¼ºå¤±é®é¢",slug:"sun-åç¼ºå¤±é®é¢",normalizedTitle:"sun.* åç¼ºå¤±é®é¢",charIndex:17269},{level:3,title:"é»è®¤å®å¨ç­ç¥ä¿®æ¹",slug:"é»è®¤å®å¨ç­ç¥ä¿®æ¹",normalizedTitle:"é»è®¤å®å¨ç­ç¥ä¿®æ¹",charIndex:17537},{level:3,title:"JVM åæ°è°æ´",slug:"jvm-åæ°è°æ´",normalizedTitle:"jvm åæ°è°æ´",charIndex:17689},{level:3,title:"å­èç é®é¢",slug:"å­èç é®é¢",normalizedTitle:"å­èç é®é¢",charIndex:18954},{level:3,title:"Java è¿æ¥ redis å¯å¨æ¥é Error redis clients jedis HostAndPort cant resolve localhost address",slug:"java-è¿æ¥-redis-å¯å¨æ¥é-error-redis-clients-jedis-hostandport-cant-resolve-localhost-address",normalizedTitle:"java è¿æ¥ redis å¯å¨æ¥é error redis clients jedis hostandport cant resolve localhost address",charIndex:19531},{level:3,title:"Resin å®¹å¨æå® JDK 1.8",slug:"resin-å®¹å¨æå®-jdk-1-8",normalizedTitle:"resin å®¹å¨æå® jdk 1.8",charIndex:19841},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:20181}],headersStr:"Default Methods for Interfaces(æ¥å£çé»è®¤æ¹æ³) Lambda expressions(Lambda è¡¨è¾¾å¼) Functional Interfaces(å½æ°æ¥å£) Method and Constructor References(æ¹æ³åæé å¨å¼ç¨) Lambda Scopes(Lambda ä½ç¨å) Accessing local variables(è®¿é®æ¬å°åé) Accessing fields and static variables(è®¿é®æååéåéæåé) Accessing Default Interface Methodsï¼è®¿é®é»è®¤çæ¥å£æ¹æ³ï¼ Built-in Functional Interfaces(åç½®å½æ°æ¥å£) Predicates Functions Suppliers Consumers Comparators Optionals Streams Filter Sorted Map Match Count Reduce Parallel Streams Sequential Sort Parallel Sort Maps Date API Clock Timezones LocalTime LocalDate LocalDateTime Annotations Variant 1: ä½¿ç¨å®¹å¨æ³¨è§£ (èå¥è·¯) Variant 2: ä½¿ç¨ repeatable æ³¨è§£ (æ°å¥è·¯) JDK8 åçº§å¸¸è§é®é¢ Intellij ä¸­ç JDK ç¯å¢è®¾ç½® Settings Projcet Settings Application Linux ç¯å¢ä¿®æ¹ ä¿®æ¹ç¯å¢åé ä¿®æ¹ maven ä¿®æ¹ server sun.* åç¼ºå¤±é®é¢ é»è®¤å®å¨ç­ç¥ä¿®æ¹ JVM åæ°è°æ´ å­èç é®é¢ Java è¿æ¥ redis å¯å¨æ¥é Error redis clients jedis HostAndPort cant resolve localhost address Resin å®¹å¨æå® JDK 1.8 åèèµæ",content:'# JDK8 å¥é¨æå\n\n> JDK8 åçº§å¸¸è§é®é¢ç« èæ¯æä¸ªäººçç»éªæ´çãå¶ä»åå®¹åºæ¬ç¿»è¯èª java8-tutorial\n> \n> ð¦ æ¬æä»¥åç¤ºä¾æºç å·²å½æ¡£å¨ javacore\n> \n> å³é®è¯ï¼StreamãlambdaãOptionalã@FunctionalInterface\n\n\n# Default Methods for Interfaces(æ¥å£çé»è®¤æ¹æ³)\n\nJava 8 ä½¿æä»¬è½å¤éè¿ä½¿ç¨ default å³é®å­å°éæ½è±¡æ¹æ³å®ç°æ·»å å°æ¥å£ãè¿ä¸ªåè½ä¹è¢«ç§°ä¸ºèææ©å±æ¹æ³ã\n\nè¿æ¯æä»¬çç¬¬ä¸ä¸ªä¾å­ï¼\n\ninterface Formula {\n    double calculate(int a);\n\n    default double sqrt(int a) {\n        return Math.sqrt(a);\n    }\n}\n\n\né¤äºæ½è±¡æ¹æ³ calculate ï¼æ¥å£ Formula è¿å®ä¹äºé»è®¤æ¹æ³ sqrtãå·ä½ç±»åªéè¦æ§è¡æ½è±¡æ¹æ³è®¡ç®ãé»è®¤çæ¹æ³ sqrt å¯ä»¥ç¨äºå¼ç®±å³ç¨ã\n\nFormula formula = new Formula() {\n    @Override\n    public double calculate(int a) {\n        return sqrt(a * 100);\n    }\n};\n\nformula.calculate(100);     // 100.0\nformula.sqrt(16);           // 4.0\n\n\nFormula è¢«å®ç°ä¸ºä¸ä¸ªå¿åå¯¹è±¡ãä»£ç éå¸¸åé¿ï¼ç¨äº sqrt(a * 100) è¿æ ·ç®åçè®¡ç®ç 6 è¡ä»£ç ãæ­£å¦æä»¬å°å¨ä¸ä¸èä¸­çå°çï¼å¨ Java 8 ä¸­å®ç°åä¸ªæ¹æ³å¯¹è±¡ææ´å¥½çæ¹æ³ã\n\n\n# Lambda expressions(Lambda è¡¨è¾¾å¼)\n\nè®©æä»¬ä»ä¸ä¸ªç®åçä¾å­æ¥è¯´æå¦ä½å¨ä»¥åçæ¬ç Java ä¸­å¯¹å­ç¬¦ä¸²åè¡¨è¿è¡æåºï¼\n\nList<String> names = Arrays.asList("peter", "anna", "mike", "xenia");\n\nCollections.sort(names, new Comparator<String>() {\n    @Override\n    public int compare(String a, String b) {\n        return b.compareTo(a);\n    }\n});\n\n\néæå·¥å·æ¹æ³ Collections.sort ä¸ºäºå¯¹æå®çåè¡¨è¿è¡æåºï¼æ¥åä¸ä¸ªåè¡¨åä¸ä¸ªæ¯è¾å¨ãæ¨ä¼åç°èªå·±ç»å¸¸éè¦åå»ºå¿åæ¯è¾å¨å¹¶å°å¶ä¼ éç»æåºæ¹æ³ã\n\nJava 8 ä½¿ç¨æ´ç®ç­ç lambda è¡¨è¾¾å¼æ¥é¿åå¸¸å¸¸åå»ºå¿åå¯¹è±¡çé®é¢ï¼\n\nCollections.sort(names, (String a, String b) -> {\n    return b.compareTo(a);\n});\n\n\nå¦æ¨æè§ï¼è¿æ®µä»£ç æ¯ä¸æ®µä»£ç ç®æ´å¾å¤ãä½æ¯ï¼è¿å¯ä»¥æ´å ç®æ´ï¼\n\nCollections.sort(names, (String a, String b) -> b.compareTo(a));\n\n\nè¿è¡ä»£ç ä¸­ï¼ä½ çå»äºè±æ¬å· {} å return å³é®å­ãä½æ¯ï¼è¿è¿ä¸ç®å®ï¼å®è¿å¯ä»¥åè¿ä¸æ­¥ç®æ´ï¼\n\nnames.sort((a, b) -> b.compareTo(a));\n\n\nåè¡¨ç°å¨æä¸ä¸ª sort æ¹æ³ãæ­¤å¤ï¼java ç¼è¯å¨ç¥éåæ°ç±»åï¼æä»¥ä½ å¯ä»¥ä¸æå®å¥åçæ°æ®ç±»åãè®©æä»¬æ·±å¥æ¢è®¨å¦ä½ä½¿ç¨ lambda è¡¨è¾¾å¼ã\n\n\n# Functional Interfaces(å½æ°æ¥å£)\n\nlambda è¡¨è¾¾å¼å¦ä½éåº Java çç±»åç³»ç»ï¼æ¯ä¸ª lambda å¯¹åºä¸ä¸ªç±æ¥å£æå®çç±»åãä¸ä¸ªæè°çå½æ°æ¥å£å¿é¡»åå«ä¸ä¸ªæ½è±¡æ¹æ³å£°æãè¯¥ç±»åçæ¯ä¸ª lambda è¡¨è¾¾å¼é½å°ä¸æ­¤æ½è±¡æ¹æ³å¹éãç±äºé»è®¤æ¹æ³ä¸æ¯æ½è±¡çï¼æä»¥ä½ å¯ä»¥èªç±å°æ·»å é»è®¤æ¹æ³å°ä½ çå½æ°æ¥å£ã\n\nåªè¦ä¿è¯æ¥å£ä»åå«ä¸ä¸ªæ½è±¡æ¹æ³ï¼å°±å¯ä»¥ä½¿ç¨ä»»æçæ¥å£ä½ä¸º lambda è¡¨è¾¾å¼ãä¸ºç¡®ä¿æ¨çæ¥å£ç¬¦åè¦æ±ï¼æ¨åºè¯¥æ·»å  @FunctionalInterface æ³¨è§£ãç¼è¯å¨æ³¨æå°è¿ä¸ªæ³¨è§£åï¼ä¸æ¦æ¨å°è¯å¨æ¥å£ä¸­æ·»å ç¬¬äºä¸ªæ½è±¡æ¹æ³å£°æï¼ç¼è¯å¨å°±ä¼æåºç¼è¯å¨éè¯¯ã\n\nç¤ºä¾ï¼\n\n@FunctionalInterface\ninterface Converter<F, T> {\n    T convert(F from);\n}\n\n\nConverter<String, Integer> converter = (from) -> Integer.valueOf(from);\nInteger converted = converter.convert("123");\nSystem.out.println(converted);    // 123\n\n\nè¯·è®°ä½ï¼å¦æ @FunctionalInterface æ³¨è§£è¢«çç¥ï¼ä»£ç ä¹æ¯ææçã\n\n\n# Method and Constructor References(æ¹æ³åæé å¨å¼ç¨)\n\nä¸é¢çç¤ºä¾ä»£ç å¯ä»¥éè¿ä½¿ç¨éææ¹æ³å¼ç¨è¿ä¸æ­¥ç®åï¼\n\nConverter<String, Integer> converter = Integer::valueOf;\nInteger converted = converter.convert("123");\nSystem.out.println(converted);   // 123\n\n\nJava 8 åè®¸æ¨éè¿ :: å³é®å­ä¼ éæ¹æ³ææé å½æ°çå¼ç¨ãä¸é¢çä¾å­å±ç¤ºäºå¦ä½å¼ç¨ä¸ä¸ªéææ¹æ³ãä½æ¯æä»¬ä¹å¯ä»¥å¼ç¨å¯¹è±¡æ¹æ³ï¼\n\nclass Something {\n    String startsWith(String s) {\n        return String.valueOf(s.charAt(0));\n    }\n}\n\n\nSomething something = new Something();\nConverter<String, String> converter = something::startsWith;\nString converted = converter.convert("Java");\nSystem.out.println(converted);    // "J"\n\n\næä»¬æ¥è§å¯ä¸ä¸ :: å³é®å­æ¯å¦ä½ä½ç¨äºæé å¨çãé¦åï¼æä»¬å®ä¹ä¸ä¸ªæå¤ä¸ªæé å¨çç¤ºä¾ç±»ã\n\nclass Person {\n    String firstName;\n    String lastName;\n\n    Person() {}\n\n    Person(String firstName, String lastName) {\n        this.firstName = firstName;\n        this.lastName = lastName;\n    }\n}\n\n\næ¥çï¼æä»¬æå®ä¸ä¸ªç¨äºåå»º Person å¯¹è±¡ç PersonFactory æ¥å£ã\n\ninterface PersonFactory<P extends Person> {\n    P create(String firstName, String lastName);\n}\n\n\næä»¬ä¸æ¯æå¨å®ç°å·¥åï¼èæ¯éè¿æé å¼ç¨å°ææä¸è¥¿ç²åå¨ä¸èµ·ï¼\n\nPersonFactory<Person> personFactory = Person::new;\nPerson person = personFactory.create("Peter", "Parker");\n\n\næä»¬éè¿ Person::new æ¥åå»ºä¸ä¸ª Person æé å¨çå¼ç¨ãJava ç¼è¯å¨ä¼æ ¹æ®PersonFactory.create çç­¾åèªå¨å¹éæ­£ç¡®çæé å¨ã\n\n\n# Lambda Scopes(Lambda ä½ç¨å)\n\nä» lambda è¡¨è¾¾å¼è®¿é®å¤é¨ä½ç¨ååéä¸å¿åå¯¹è±¡éå¸¸ç¸ä¼¼ãæ¨å¯ä»¥è®¿é®æ¬å°å¤é¨ä½ç¨åçå¸¸éä»¥åå®ä¾çæååéåéæåéã\n\n\n# Accessing local variables(è®¿é®æ¬å°åé)\n\næä»¬å¯ä»¥è®¿é® lambda è¡¨è¾¾å¼ä½ç¨åå¤é¨çå¸¸éï¼\n\nfinal int num = 1;\nConverter<Integer, String> stringConverter =\n        (from) -> String.valueOf(from + num);\n\nstringConverter.convert(2);     // 3\n\n\nä¸åäºå¿åå¯¹è±¡çæ¯ï¼è¿ä¸ªåé num ä¸æ¯ä¸å®è¦è¢« final ä¿®é¥°ãä¸é¢çä»£ç ä¸æ ·åæ³ï¼\n\nint num = 1;\nConverter<Integer, String> stringConverter =\n        (from) -> String.valueOf(from + num);\n\nstringConverter.convert(2);     // 3\n\n\nä½æ¯ï¼num å¿é¡»æ¯éå¼å¸¸éçãä¸é¢çä»£ç ä¸è½ç¼è¯éè¿ï¼\n\nint num = 1;\nConverter<Integer, String> stringConverter =\n        (from) -> String.valueOf(from + num);\nnum = 3;\n\n\næ­¤å¤ï¼å¨ lambda è¡¨è¾¾å¼ä¸­å¯¹ num ååæä½ä¹æ¯è¢«ç¦æ­¢çã\n\n\n# Accessing fields and static variables(è®¿é®æååéåéæåé)\n\nä¸å±é¨åéç¸æ¯ï¼æä»¬æ¢å¯ä»¥å¨ lambda è¡¨è¾¾å¼ä¸­è¯»åå®ä¾çæååéï¼ä¹å¯ä»¥è¯»åå®ä¾çéæåéãè¿ç§è¡ä¸ºå¨å¿åå¯¹è±¡ä¸­æ¯ä¼æå¨ç¥çã\n\nclass Lambda4 {\n    static int outerStaticNum;\n    int outerNum;\n\n    void testScopes() {\n        Converter<Integer, String> stringConverter1 = (from) -> {\n            outerNum = 23;\n            return String.valueOf(from);\n        };\n\n        Converter<Integer, String> stringConverter2 = (from) -> {\n            outerStaticNum = 72;\n            return String.valueOf(from);\n        };\n    }\n}\n\n\n\n# Accessing Default Interface Methodsï¼è®¿é®é»è®¤çæ¥å£æ¹æ³ï¼\n\nè¿è®°å¾ç¬¬ä¸èç formula ä¾å­åï¼ Formula æ¥å£å®ä¹äºä¸ä¸ªé»è®¤æ¹æ³ sqrtï¼å®å¯ä»¥è¢«æ¯ä¸ª formula å®ä¾ï¼åæ¬å¿åå¯¹è±¡ï¼è®¿é®ãè¿ä¸ªç¹æ§ä¸éç¨äº lambda è¡¨è¾¾å¼ã\n\né»è®¤æ¹æ³ä¸è½è¢« lambda è¡¨è¾¾å¼è®¿é®ãä¸é¢çä»£ç ä¸è½ç¼è¯éè¿ï¼\n\nFormula formula = (a) -> sqrt(a * 100);\n\n\n\n# Built-in Functional Interfaces(åç½®å½æ°æ¥å£)\n\nJDK 1.8 API åå«è®¸å¤åç½®çåè½æ¥å£ãå®ä»¬ä¸­çä¸äºå¨è¾æ©ç Java çæ¬ï¼æ¯å¦ Comparator æ Runnableï¼ä¸­æ¯ä¼æå¨ç¥çãè¿äºç°æçæ¥å£éè¿ @FunctionalInterfaceannotation æ³¨è§£è¢«æ©å±ä¸ºæ¯æ Lambdaã\n\nä½æ¯ï¼Java 8 API ä¹æä¾äºä¸å°æ°çå½æ°æ¥å£ãå¶ä¸­ä¸äºæ°æ¥å£å¨ Google Guava åºä¸­æ¯ä¼æå¨ç¥çãå³ä½¿æ¨çæè¿ä¸ªåºï¼ä¹åºè¯¥å¯åå³æ³¨å¦ä½éè¿ä¸äºæç¨çæ¹æ³æ©å±æ¥æ©å±è¿äºæ¥å£ã\n\n\n# Predicates\n\nPredicate æ¯åªæä¸ä¸ªåæ°çå¸å°å¼å½æ°ãè¯¥æ¥å£åå«åç§é»è®¤æ¹æ³ï¼ç¨äºå°è°è¯ç»åæå¤æçé»è¾æ¯è¯­ï¼ä¸ãæãéï¼\n\nPredicate<String> predicate = (s) -> s.length() > 0;\n\npredicate.test("foo");              // true\npredicate.negate().test("foo");     // false\n\nPredicate<Boolean> nonNull = Objects::nonNull;\nPredicate<Boolean> isNull = Objects::isNull;\n\nPredicate<String> isEmpty = String::isEmpty;\nPredicate<String> isNotEmpty = isEmpty.negate();\n\n\n\n# Functions\n\nFunction æ¥åä¸ä¸ªåæ°å¹¶äº§çä¸ä¸ªç»æãå¯ä»¥ä½¿ç¨é»è®¤æ¹æ³å°å¤ä¸ªå½æ°é¾æ¥å¨ä¸èµ·ï¼composeãandThenï¼ã\n\nFunction<String, Integer> toInteger = Integer::valueOf;\nFunction<String, String> backToString = toInteger.andThen(String::valueOf);\n\nbackToString.apply("123");     // "123"\n\n\n\n# Suppliers\n\nSupplier äº§çä¸ä¸ªæ³åç»æãä¸ Function ä¸åï¼Supplier ä¸æ¥ååæ°ã\n\nSupplier<Person> personSupplier = Person::new;\npersonSupplier.get();   // new Person\n\n\n\n# Consumers\n\nConsumer è¡¨ç¤ºè¦å¨ä¸ä¸ªè¾å¥åæ°ä¸æ§è¡çæä½ã\n\nConsumer<Person> greeter = (p) -> System.out.println("Hello, " + p.firstName);\ngreeter.accept(new Person("Luke", "Skywalker"));\n\n\n\n# Comparators\n\næ¯è¾å¨å¨èçæ¬ç Java ä¸­æ¯ä¼æå¨ç¥çã Java 8 ä¸ºæ¥å£æ·»å äºåç§é»è®¤æ¹æ³ã\n\nComparator<Person> comparator = (p1, p2) -> p1.firstName.compareTo(p2.firstName);\n\nPerson p1 = new Person("John", "Doe");\nPerson p2 = new Person("Alice", "Wonderland");\n\ncomparator.compare(p1, p2);             // > 0\ncomparator.reversed().compare(p1, p2);  // < 0\n\n\n\n# Optionals\n\nOptional ä¸æ¯åè½æ§æ¥å£ï¼èæ¯é²æ­¢ NullPointerException çå¥½å·¥å·ãè¿æ¯ä¸ä¸èçä¸ä¸ªéè¦æ¦å¿µï¼æä»¥è®©æä»¬å¿«éçç Optional æ¯å¦ä½å·¥ä½çã\n\nOptional æ¯ä¸ä¸ªç®åçå®¹å¨ï¼å¶å¼å¯ä»¥æ¯ null æé nullãæ³æ³ä¸ä¸ªå¯è½è¿åä¸ä¸ªéç©ºç»æçæ¹æ³ï¼ä½ææ¶åä»ä¹é½ä¸è¿åãä¸æ¯è¿å nullï¼èæ¯è¿å Java 8 ä¸­ç Optionalã\n\nOptional<String> optional = Optional.of("bam");\n\noptional.isPresent();           // true\noptional.get();                 // "bam"\noptional.orElse("fallback");    // "bam"\n\noptional.ifPresent((s) -> System.out.println(s.charAt(0)));     // "b"\n\n\n\n# Streams\n\njava.util.Stream è¡¨ç¤ºå¯ä»¥å¨å¶ä¸æ§è¡ä¸ä¸ªæå¤ä¸ªæä½çåç´ åºåãæµæä½æ¯ä¸­é´æç»ç«¯ãå½ç»ç«¯æä½è¿åä¸ä¸ªç¹å®ç±»åçç»ææ¶ï¼ä¸­é´æä½è¿åæµæ¬èº«ï¼æä»¥ä½ å¯ä»¥é¾æ¥å¤ä¸ªæ¹æ³è°ç¨ãæµå¨æºä¸åå»ºï¼ä¾å¦ä¸ä¸ª java.util.Collection ååè¡¨æéåï¼ä¸æ¯ææ å°ï¼ãæµæä½æ¢å¯ä»¥æé¡ºåºæ§è¡ï¼ä¹å¯ä»¥å¹¶è¡æ§è¡ã\n\n> æµæ¯éå¸¸å¼ºå¤§çï¼æä»¥ï¼æåäºä¸ä¸ªç¬ç«ç Java8 Streams æç¨ ãæ¨è¿åºè¯¥æ¥ç Sequentï¼å°å¶ä½ä¸º Web çç±»ä¼¼åºã\n\næä»¬åæ¥ççé¡ºåºæµå¦ä½å·¥ä½ãé¦åï¼æä»¬ä»¥å­ç¬¦ä¸²åè¡¨çå½¢å¼åå»ºä¸ä¸ªç¤ºä¾æºä»£ç ï¼\n\nList<String> stringCollection = new ArrayList<>();\nstringCollection.add("ddd2");\nstringCollection.add("aaa2");\nstringCollection.add("bbb1");\nstringCollection.add("aaa1");\nstringCollection.add("bbb3");\nstringCollection.add("ccc");\nstringCollection.add("bbb2");\nstringCollection.add("ddd1");\n\n\nJava 8 ä¸­çéåå·²è¢«æ©å±ï¼å æ­¤æ¨å¯ä»¥éè¿è°ç¨ Collection.stream() æCollection.parallelStream() æ¥ç®åå°åå»ºæµãä»¥ä¸åèä»ç»æå¸¸è§çæµæä½ã\n\n\n# Filter\n\nè¿æ»¤å¨æ¥åä¸ä¸ªè°è¯æ¥è¿æ»¤æµçææåç´ ãè¿ä¸ªæä½æ¯ä¸­é´çï¼ä½¿æä»¬è½å¤è°ç¨å¦ä¸ä¸ªæµæä½ï¼forEachï¼çç»æã ForEach æ¥åä¸ä¸ªæ¶è´¹èè¢«æ§è¡çè¿æ»¤æµä¸­çæ¯ä¸ªåç´ ã ForEach æ¯ä¸ä¸ªç»ç«¯æä½ãå®æ¯æ æçï¼æä»¥æä»¬ä¸è½è°ç¨å¦ä¸ä¸ªæµæä½ã\n\nstringCollection\n    .stream()\n    .filter((s) -> s.startsWith("a"))\n    .forEach(System.out::println);\n\n// "aaa2", "aaa1"\n\n\n\n# Sorted\n\næåºæ¯ä¸ä¸ªä¸­é´æä½ï¼è¿åæµçæåºè§å¾ãåç´ æèªç¶é¡ºåºæåºï¼é¤éæ¨ä¼ éèªå®ä¹æ¯è¾å¨ã\n\nstringCollection\n    .stream()\n    .sorted()\n    .filter((s) -> s.startsWith("a"))\n    .forEach(System.out::println);\n\n// "aaa1", "aaa2"\n\n\nè¯·è®°ä½ï¼æåºåªä¼åå»ºæµçæåºè§å¾ï¼èä¸ä¼æçºµæ¯æçéåçæåºã stringCollection çæåºæ¯ä¸åçï¼\n\nSystem.out.println(stringCollection);\n// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1\n\n\n\n# Map\n\nä¸­é´æä½æ å°éè¿ç»å®å½æ°å°æ¯ä¸ªåç´ è½¬æ¢ä¸ºå¦ä¸ä¸ªå¯¹è±¡ãä»¥ä¸ç¤ºä¾å°æ¯ä¸ªå­ç¬¦ä¸²è½¬æ¢ä¸ºå¤§åå­æ¯å­ç¬¦ä¸²ãä½æ¯æ¨ä¹å¯ä»¥ä½¿ç¨ map å°æ¯ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸ç§ç±»åãç»ææµçæ³åç±»ååå³äºæ¨ä¼ éç» map çå½æ°çæ³åç±»åã\n\nstringCollection\n    .stream()\n    .map(String::toUpperCase)\n    .sorted((a, b) -> b.compareTo(a))\n    .forEach(System.out::println);\n\n// "DDD2", "DDD1", "CCC", "BBB3", "BBB2", "AAA2", "AAA1"\n\n\n\n# Match\n\nå¯ä»¥ä½¿ç¨åç§å¹éæä½æ¥æ£æ¥æä¸ªè°è¯æ¯å¦ä¸æµå¹éãææè¿äºæä½é½æ¯ç»ç«¯å¹¶è¿åå¸å°ç»æã\n\nboolean anyStartsWithA =\n    stringCollection\n        .stream()\n        .anyMatch((s) -> s.startsWith("a"));\n\nSystem.out.println(anyStartsWithA);      // true\n\nboolean allStartsWithA =\n    stringCollection\n        .stream()\n        .allMatch((s) -> s.startsWith("a"));\n\nSystem.out.println(allStartsWithA);      // false\n\nboolean noneStartsWithZ =\n    stringCollection\n        .stream()\n        .noneMatch((s) -> s.startsWith("z"));\n\nSystem.out.println(noneStartsWithZ);      // true\n\n\n# Count\n\nCount æ¯ä¸ä¸ªç»ç«¯æä½ï¼è¿åæµä¸­åç´ çä¸ªæ°ã\n\nlong startsWithB =\n    stringCollection\n        .stream()\n        .filter((s) -> s.startsWith("b"))\n        .count();\n\nSystem.out.println(startsWithB);    // 3\n\n\n\n# Reduce\n\nè¯¥ç»ç«¯æä½ä½¿ç¨ç»å®çåè½å¯¹æµçåç´ è¿è¡ç¼©åãç»ææ¯ä¸ä¸ª Optional ææç¼©å°åçå¼ã\n\nOptional<String> reduced =\n    stringCollection\n        .stream()\n        .sorted()\n        .reduce((s1, s2) -> s1 + "#" + s2);\n\nreduced.ifPresent(System.out::println);\n// "aaa1##aaa2##bbb1##bbb2##bbb3##ccc##ddd1##ddd2"\n\n\n\n# Parallel Streams\n\nå¦ä¸æè¿°ï¼æµå¯ä»¥æ¯é¡ºåºçä¹å¯ä»¥æ¯å¹¶è¡çãé¡ºåºæµä¸çæä½å¨åä¸ªçº¿ç¨ä¸æ§è¡ï¼èå¹¶è¡æµä¸çæä½å¨å¤ä¸ªçº¿ç¨ä¸åæ¶æ§è¡ã\n\nä»¥ä¸ç¤ºä¾æ¼ç¤ºäºéè¿ä½¿ç¨å¹¶è¡æµæé«æ§è½æ¯å¤ä¹å®¹æã\n\né¦åï¼æä»¬åå»ºä¸ä¸ªè¾å¤§çç¬ç¹åç´ çåè¡¨ï¼\n\nint max = 1000000;\nList<String> values = new ArrayList<>(max);\nfor (int i = 0; i < max; i++) {\n    UUID uuid = UUID.randomUUID();\n    values.add(uuid.toString());\n}\n\n\nç°å¨æä»¬æµéå¯¹è¿ä¸ªéåè¿è¡æåºæè±è´¹çæ¶é´ã\n\n\n# Sequential Sort\n\nlong t0 = System.nanoTime();\n\nlong count = values.stream().sorted().count();\nSystem.out.println(count);\n\nlong t1 = System.nanoTime();\n\nlong millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);\nSystem.out.println(String.format("sequential sort took: %d ms", millis));\n\n// sequential sort took: 899 ms\n\n\n\n# Parallel Sort\n\nlong t0 = System.nanoTime();\n\nlong count = values.parallelStream().sorted().count();\nSystem.out.println(count);\n\nlong t1 = System.nanoTime();\n\nlong millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);\nSystem.out.println(String.format("parallel sort took: %d ms", millis));\n\n// parallel sort took: 472 ms\n\n\nå¦ä½ æè§ï¼ä¸¤ä¸ªä»£ç æ®µå·®ä¸å¤ï¼ä½æ¯å¹¶è¡æåºå¿«äºè¿ 50%ãä½ æéåçä»ä»æ¯å° stream() æ¹ä¸º parallelStream() ã\n\n\n# Maps\n\nå¦åæè¿°ï¼map ä¸ç´æ¥æ¯ææµãMap æ¥å£æ¬èº«æ²¡æå¯ç¨ç stream() æ¹æ³ï¼ä½æ¯ä½ å¯ä»¥éè¿ map.keySet().stream() ã map.values().stream() å map.entrySet().stream() åå»ºæå®çæµã\n\næ­¤å¤ï¼map æ¯æåç§æ°çãæç¨çæ¹æ³æ¥å¤çå¸¸è§ä»»å¡ã\n\nMap<Integer, String> map = new HashMap<>();\n\nfor (int i = 0; i < 10; i++) {\n    map.putIfAbsent(i, "val" + i);\n}\n\nmap.forEach((id, val) -> System.out.println(val));\n\n\nä¸é¢çä»£ç åºè¯¥æ¯èªæè§£éçï¼putIfAbsent é»æ­¢æä»¬åå¥é¢å¤çç©ºå¼æ£æ¥ï¼forEach æ¥åæ¶è´¹èä¸º map çæ¯ä¸ªå¼å®ç°æä½ã\n\nè¿ä¸ªä¾å­å±ç¤ºäºå¦ä½å©ç¨å½æ°æ¥è®¡ç® map ä¸çä»£ç ï¼\n\nmap.computeIfPresent(3, (num, val) -> val + num);\nmap.get(3);             // val33\n\nmap.computeIfPresent(9, (num, val) -> null);\nmap.containsKey(9);     // false\n\nmap.computeIfAbsent(23, num -> "val" + num);\nmap.containsKey(23);    // true\n\nmap.computeIfAbsent(3, num -> "bam");\nmap.get(3);             // val33\n\n\næ¥ä¸æ¥ï¼æä»¬å­¦ä¹ å¦ä½å é¤ç»å®é®çæ¡ç®ï¼åªæå½åé®æ å°å°ç»å®å¼æ¶ï¼\n\nmap.remove(3, "val3");\nmap.get(3);             // val33\n\nmap.remove(3, "val33");\nmap.get(3);             // null\n\n\nå¦ä¸ä¸ªæç¨æ¹æ³ï¼\n\nmap.getOrDefault(42, "not found");  // not found\n\n\nåå¹¶ä¸ä¸ª map ç entry å¾ç®åï¼\n\nmap.merge(9, "val9", (value, newValue) -> value.concat(newValue));\nmap.get(9);             // val9\n\nmap.merge(9, "concat", (value, newValue) -> value.concat(newValue));\nmap.get(9);             // val9concat\n\n\nå¦æä¸å­å¨è¯¥é®çæ¡ç®ï¼åå¹¶æèå°é®/å¼æ¾å¥ map ä¸­ï¼å¦åå°è°ç¨åå¹¶å½æ°æ¥æ´æ¹ç°æå¼ã\n\n\n# Date API\n\nJava 8 å¨ java.time åä¸æ°å¢äºä¸ä¸ªå¨æ°çæ¥æåæ¶é´ APIãæ°çæ¥æ API ä¸ Joda-Time åºç¸ä¼¼ï¼ä½ä¸ä¸æ ·ãä»¥ä¸ç¤ºä¾æ¶µçäºæ­¤æ° API çæéè¦é¨åã\n\n\n# Clock\n\nClock æä¾å¯¹å½åæ¥æåæ¶é´çè®¿é®ãClock ç¥éä¸ä¸ªæ¶åºï¼å¯ä»¥ä½¿ç¨å®æ¥ä»£æ¿ System.currentTimeMillis() ï¼è·åä» Unix EPOCH å¼å§çä»¥æ¯«ç§ä¸ºåä½çå½åæ¶é´ãæ¶é´çº¿ä¸çæä¸æ¶å»ä¹ç±ç±» Instant è¡¨ç¤ºã Instants å¯ä»¥ç¨æ¥åå»ºéçç java.util.Date å¯¹è±¡ã\n\nClock clock = Clock.systemDefaultZone();\nlong millis = clock.millis();\n\nInstant instant = clock.instant();\nDate legacyDate = Date.from(instant);   // legacy java.util.Date\n\n\n\n# Timezones\n\næ¶åºç± ZoneId è¡¨ç¤ºãä»ä»¬å¯ä»¥å¾å®¹æå°éè¿éæå·¥åæ¹æ³è®¿é®ãæ¶åºå®ä¹äºæä¸æ¶å»åå½å°æ¥æãæ¶é´ä¹é´è½¬æ¢çéè¦åç§»éã\n\nSystem.out.println(ZoneId.getAvailableZoneIds());\n// prints all available timezone ids\n\nZoneId zone1 = ZoneId.of("Europe/Berlin");\nZoneId zone2 = ZoneId.of("Brazil/East");\nSystem.out.println(zone1.getRules());\nSystem.out.println(zone2.getRules());\n\n// ZoneRules[currentStandardOffset=+01:00]\n// ZoneRules[currentStandardOffset=-03:00]\n\n\n\n# LocalTime\n\nLocalTime ä»£è¡¨æ²¡ææ¶åºçæ¶é´ï¼ä¾å¦æä¸ 10 ç¹æ 17:30:15ãä»¥ä¸ç¤ºä¾ä¸ºä¸é¢å®ä¹çæ¶åºåå»ºä¸¤ä¸ªæ¬å°æ¶é´ãç¶åæä»¬æ¯è¾ä¸¤æ¬¡ï¼å¹¶è®¡ç®ä¸¤æ¬¡ä¹é´çå°æ¶ååéçå·®å¼ã\n\nLocalTime now1 = LocalTime.now(zone1);\nLocalTime now2 = LocalTime.now(zone2);\n\nSystem.out.println(now1.isBefore(now2));  // false\n\nlong hoursBetween = ChronoUnit.HOURS.between(now1, now2);\nlong minutesBetween = ChronoUnit.MINUTES.between(now1, now2);\n\nSystem.out.println(hoursBetween);       // -3\nSystem.out.println(minutesBetween);     // -239\n\n\nLocalTime å¸¦æåç§å·¥åæ¹æ³ï¼ä»¥ç®åæ°å®ä¾çåå»ºï¼åæ¬è§£ææ¶é´å­ç¬¦ä¸²ã\n\nLocalTime late = LocalTime.of(23, 59, 59);\nSystem.out.println(late);       // 23:59:59\n\nDateTimeFormatter germanFormatter =\n    DateTimeFormatter\n        .ofLocalizedTime(FormatStyle.SHORT)\n        .withLocale(Locale.GERMAN);\n\nLocalTime leetTime = LocalTime.parse("13:37", germanFormatter);\nSystem.out.println(leetTime);   // 13:37\n\n\n\n# LocalDate\n\nLocalDate è¡¨ç¤ºä¸åçæ¥æï¼ä¾å¦ï¼2014 å¹´ 3 æ 11 æ¥ãå®æ¯ä¸å¯åçï¼å¹¶ä¸ä¸ LocalTime å®å¨ç±»ä¼¼ãè¯¥ç¤ºä¾æ¼ç¤ºå¦ä½éè¿å åæ¥ãææå¹´æ¥è®¡ç®æ°æ¥æãè¯·è®°ä½ï¼æ¯ä¸ªæä½é½ä¼è¿åä¸ä¸ªæ°çå®ä¾ã\n\nLocalDate today = LocalDate.now();\nLocalDate tomorrow = today.plus(1, ChronoUnit.DAYS);\nLocalDate yesterday = tomorrow.minusDays(2);\n\nLocalDate independenceDay = LocalDate.of(2014, Month.JULY, 4);\nDayOfWeek dayOfWeek = independenceDay.getDayOfWeek();\nSystem.out.println(dayOfWeek);    // FRIDAY\n\n\nä»ä¸ä¸ªå­ç¬¦ä¸²ä¸­è§£æåº LocalDate å¯¹è±¡ï¼åè§£æ LocalTime ä¸æ ·çç®åï¼\n\nDateTimeFormatter germanFormatter =\n    DateTimeFormatter\n        .ofLocalizedDate(FormatStyle.MEDIUM)\n        .withLocale(Locale.GERMAN);\n\nLocalDate xmas = LocalDate.parse("24.12.2014", germanFormatter);\nSystem.out.println(xmas);   // 2014-12-24\n\n\n\n# LocalDateTime\n\nLocalDateTime è¡¨ç¤ºæ¥ææ¶é´ãå®å°æ¥æåæ¶é´ç»åæä¸ä¸ªå®ä¾ã LocalDateTime æ¯ä¸å¯åçï¼å¶ä½ç¨ç±»ä¼¼äº LocalTime å LocalDateãæä»¬å¯ä»¥å©ç¨æ¹æ³å»è·åæ¥ææ¶é´ä¸­æä¸ªåä½çå¼ã\n\nLocalDateTime sylvester = LocalDateTime.of(2014, Month.DECEMBER, 31, 23, 59, 59);\n\nDayOfWeek dayOfWeek = sylvester.getDayOfWeek();\nSystem.out.println(dayOfWeek);      // WEDNESDAY\n\nMonth month = sylvester.getMonth();\nSystem.out.println(month);          // DECEMBER\n\nlong minuteOfDay = sylvester.getLong(ChronoField.MINUTE_OF_DAY);\nSystem.out.println(minuteOfDay);    // 1439\n\n\néè¿ä¸ä¸ªæ¶åºçéå ä¿¡æ¯å¯ä»¥è½¬ä¸ºä¸ä¸ªå®ä¾ãè¿ä¸ªå®ä¾å¾å®¹æè½¬ä¸ºjava.util.Date ç±»åã\n\nInstant instant = sylvester\n        .atZone(ZoneId.systemDefault())\n        .toInstant();\n\nDate legacyDate = Date.from(instant);\nSystem.out.println(legacyDate);     // Wed Dec 31 23:59:59 CET 2014\n\n\næ¥ææ¶é´çæ ¼å¼åç±»ä¼¼äº Date æ Timeãæä»¬å¯ä»¥ä½¿ç¨èªå®ä¹æ¨¡å¼åå»ºæ ¼å¼åç¨åºï¼èä¸æ¯ä½¿ç¨é¢å®ä¹çæ ¼å¼ã\n\nDateTimeFormatter formatter =\n    DateTimeFormatter\n        .ofPattern("MMM dd, yyyy - HH:mm");\n\nLocalDateTime parsed = LocalDateTime.parse("Nov 03, 2014 - 07:13", formatter);\nString string = formatter.format(parsed);\nSystem.out.println(string);     // Nov 03, 2014 - 07:13\n\n\nä¸åäº java.text.NumberFormat ï¼ DateTimeFormatter æ¯ä¸å¯åä¸çº¿ç¨å®å¨ç ã\n\næ´å¤å³äºæ¥ææ ¼å¼åçåå®¹å¯ä»¥åèè¿é.\n\n\n# Annotations\n\nJava 8 ä¸­çæ³¨éæ¯å¯éå¤çãè®©æä»¬ç´æ¥çä¸ä¸ªä¾å­æ¥è§£å³è¿ä¸ªé®é¢ã\n\né¦åï¼æä»¬å®ä¹ä¸ä¸ªåå«å®éæ³¨éæ°ç»çå¤å±æ³¨éï¼\n\n@interface Hints {\n    Hint[] value();\n}\n\n@Repeatable(Hints.class)\n@interface Hint {\n    String value();\n}\n\n\nJava8 åè®¸æä»¬éè¿ä½¿ç¨ @Repeatable æ³¨è§£æ¥å¼å¥å¤ä¸ªåç±»åçæ³¨è§£ã\n\n\n# Variant 1: ä½¿ç¨å®¹å¨æ³¨è§£ (èå¥è·¯)\n\n@Hints({@Hint("hint1"), @Hint("hint2")})\nclass Person {}\n\n\n\n# Variant 2: ä½¿ç¨ repeatable æ³¨è§£ (æ°å¥è·¯)\n\n@Hint("hint1")\n@Hint("hint2")\nclass Person {}\n\n\nä½¿ç¨åºæ¯ 2ï¼Java ç¼è¯å¨éå¼å°è®¾ç½®äº @Hints æ³¨è§£ã\n\nè¿å¯¹äºéè¿åå°æ¥è¯»åæ³¨è§£ä¿¡æ¯å¾éè¦ã\n\nHint hint = Person.class.getAnnotation(Hint.class);\nSystem.out.println(hint);                   // null\n\nHints hints1 = Person.class.getAnnotation(Hints.class);\nSystem.out.println(hints1.value().length);  // 2\n\nHint[] hints2 = Person.class.getAnnotationsByType(Hint.class);\nSystem.out.println(hints2.length);          // 2\n\n\nå°½ç®¡ï¼æä»¬ä»æ²¡æå¨ Person ç±»ä¸å£°æ @Hints æ³¨è§£ï¼ä½æ¯ä»å¯ä»¥éè¿getAnnotation(Hints.class) è¯»åå®ãç¶èï¼æ´ä¾¿å©çæ¹å¼æ¯ getAnnotationsByType ï¼å®å¯ä»¥ç´æ¥è®¿é®ææ @Hint æ³¨è§£ã\n\næ­¤å¤ï¼Java 8 ä¸­çæ³¨éä½¿ç¨æ©å±äºä¸¤ä¸ªæ°çç®æ ï¼\n\n@Target({ElementType.TYPE_PARAMETER, ElementType.TYPE_USE})\n@interface MyAnnotation {}\n\n\næ°´å¹³çº¿ä»¥ä¸ä¸º java8-tutorial ç¿»è¯åå®¹ã\n\n----------------------------------------\n\n\n# JDK8 åçº§å¸¸è§é®é¢\n\n> JDK8 åå¸å¾ä¹äºï¼å®æä¾äºè®¸å¤å¸å¼äººçæ°ç¹æ§ï¼è½å¤æé«ç¼ç¨æçã\n> \n> å¦ææ¯æ°çé¡¹ç®ï¼ä½¿ç¨ JDK8 å½ç¶æ¯æå¥½çéæ©ãä½æ¯ï¼å¯¹äºä¸äºèçé¡¹ç®ï¼åçº§å° JDK8 åå­å¨ä¸äºå¼å®¹æ§é®é¢ï¼æ¯å¦åçº§éè¦éæèèã\n> \n> è¿æï¼æå¨å·¥ä½ä¸­éå°ä¸ä¸ªä»»å¡ï¼å°é¨é¨ææé¡¹ç®ç JDK çæ¬åçº§å° 1.8 ï¼èçæ¬å¤§å¤æ¯ 1.6ï¼ãå¨è¿ä¸ªè¿ç¨ä¸­ï¼éå°ä¸äºé®é¢ç¹ï¼å¹¶ç»åå¨ç½ä¸çå°çåï¼å¨è¿éæ»ç»ä¸ä¸ã\n\n\n# Intellij ä¸­ç JDK ç¯å¢è®¾ç½®\n\n# Settings\n\nç¹å» File > Settings > Java Compiler\n\nProject bytecode version éæ© 1.8\n\nç¹å» File > Settings > Build Tools > Maven > Importing\n\néæ© JDK for importer ä¸º 1.8\n\n# Projcet Settings\n\nProject SDK éæ© 1.8\n\n# Application\n\nå¦æ web åºç¨çå¯å¨æ¹å¼ä¸º Application ï¼éè¦ä¿®æ¹ JRE\n\nç¹å» Run/Debug Configurations > Configuration\n\néæ© JRE ä¸º 1.8\n\n\n# Linux ç¯å¢ä¿®æ¹\n\n# ä¿®æ¹ç¯å¢åé\n\nä¿®æ¹ /etc/profile ä¸­ç JAVA_HOMEï¼è®¾ç½® ä¸º jdk8 æå¨è·¯å¾ã\n\nä¿®æ¹åï¼æ§è¡ source /etc/profile çæã\n\nç¼è¯ãåå¸èæ¬ä¸­å¦ææ export JAVA_HOME ï¼éè¦æ³¨æï¼éè¦ä½¿ç¨ jdk8 çè·¯å¾ã\n\n# ä¿®æ¹ maven\n\nsettings.xml ä¸­ profile çæ¿æ´»æ¡ä»¶å¦ææ¯ jdkï¼éè¦ä¿®æ¹ä¸ä¸ jdk çæ¬\n\n<activation>\n  <jdk>1.8</jdk> \x3c!-- ä¿®æ¹ä¸º 1.8 --\x3e\n</activation>\n\n\n# ä¿®æ¹ server\n\nä¿®æ¹ server ä¸­ç javac çæ¬ï¼ä»¥ resin ä¸ºä¾ï¼\n\nä¿®æ¹ resin éç½®æä»¶ä¸­ç javac åæ°ã\n\n<javac compiler="internal" args="-source 1.8"/>\n\n\n\n# sun.* åç¼ºå¤±é®é¢\n\nJDK8 ä¸åæä¾ sun.* åä¾å¼åèä½¿ç¨ï¼å ä¸ºè¿äºæ¥å£ä¸æ¯å¬å±æ¥å£ï¼ä¸è½ä¿è¯å¨ææ Java å¼å®¹çå¹³å°ä¸å·¥ä½ã\n\nä½¿ç¨äºè¿äº API çç¨åºå¦æè¦åçº§å° JDK 1.8 éè¦å¯»æ±æ¿ä»£æ¹æ¡ã\n\nè½ç¶ï¼ä¹å¯ä»¥èªå·±å¯¼å¥åå« sun.* æ¥å£ jar åå° classpath ç®å½ï¼ä½è¿ä¸æ¯ä¸ä¸ªå¥½çåæ³ã\n\néè¦è¯¦ç»äºè§£ä¸ºä»ä¹ä¸è¦ä½¿ç¨ sun.* ï¼å¯ä»¥åèå®æ¹ææ¡£ï¼Why Developers Should Not Write Programs That Call \'sun\' Packages\n\n\n# é»è®¤å®å¨ç­ç¥ä¿®æ¹\n\nåçº§åä¼°è®¡æäºå°ä¼ä¼´å¨ä½¿ç¨ä¸å®å¨ç®æ³æ¶å¯è½ä¼åçéè¯¯ï¼soï¼æ¯æä¸å®å¨ç®æ³è¿æ¯æå¿è¦ç\n\næ¾å°$JAVA_HOME ä¸ jre/lib/security/java.security ï¼å°ç¦ç¨çç®æ³è®¾ç½®ä¸ºç©ºï¼jdk.certpath.disabledAlgorithms= ã\n\n\n# JVM åæ°è°æ´\n\nå¨ jdk8 ä¸­ï¼PermSize ç¸å³çåæ°å·²ç»ä¸è¢«ä½¿ç¨ï¼\n\n-XX:MaxPermSize=size\n\nSets the maximum permanent generation space size (in bytes). This option was deprecated in JDK 8, and superseded by the -XX:MaxMetaspaceSize option.\n\n-XX:PermSize=size\n\nSets the space (in bytes) allocated to the permanent generation that triggers a garbage collection if it is exceeded. This option was deprecated un JDK 8, and superseded by the -XX:MetaspaceSize option.\n\n\nJDK8 ä¸­åä¹æ²¡æ PermGen äºãå¶ä¸­çæäºé¨åï¼å¦è¢« intern çå­ç¬¦ä¸²ï¼å¨ JDK7 ä¸­å·²ç»ç§»å°äºæ®éå éãå¶ä½ç»æå¨ JDK8 ä¸­ä¼è¢«ç§»å°ç§°ä½âMetaspaceâçæ¬æºåå­åºä¸­ï¼è¯¥åºåå¨é»è®¤æåµä¸ä¼èªå¨çé¿ï¼ä¹ä¼è¢«åå¾åæ¶ãå®æä¸¤ä¸ªæ è®°ï¼MetaspaceSize å MaxMetaspaceSizeã\n\n-XX:MetaspaceSize=size\n\n> Sets the size of the allocated class metadata space that will trigger a garbage collection the first time it is exceeded. This threshold for a garbage collection is increased or decreased depending on the amount of metadata used. The default size depends on the platform.\n\n-XX:MaxMetaspaceSize=size\n\n> Sets the maximum amount of native memory that can be allocated for class metadata. By default, the size is not limited. The amount of metadata for an application depends on the application itself, other running applications, and the amount of memory available on the system.\n\nä»¥ä¸ç¤ºä¾æ¾ç¤ºå¦ä½å°ç±»ç±»åæ°æ®çä¸éè®¾ç½®ä¸º 256 MBï¼\n\nXX:MaxMetaspaceSize=256m\n\n\n# å­èç é®é¢\n\nASM 5.0 beta å¼å§æ¯æ JDK8\n\nå­èç éè¯¯\n\nCaused by: java.io.IOException: invalid constant type: 15\n\tat javassist.bytecode.ConstPool.readOne(ConstPool.java:1113)\n\n\n * æ¥æ¾ç»ä»¶ç¨å°äº mvelï¼mvel ä¸ºäºæé«æçè¿è¡äºå­èç ä¼åï¼æ­£å¥½ç¢°ä¸ JDK8 æ­»ç©´ï¼æä»¥éè¦åçº§ã\n\n<dependency>\n  <groupId>org.mvel</groupId>\n  <artifactId>mvel2</artifactId>\n  <version>2.2.7.Final</version>\n</dependency>\n\n\n * javassist\n\n<dependency>\n  <groupId>org.javassist</groupId>\n  <artifactId>javassist</artifactId>\n  <version>3.18.1-GA</version>\n</dependency>\n\n\n> æ³¨æ\n> \n> æäºé¨ç½²å·¥å·ä¸ä¼å é¤æ§çæ¬ jar åï¼æä»¥å¯ä»¥å°è¯æå¨å é¤èçæ¬ jar åã\n\nhttp://asm.ow2.org/history.html\n\n\n# Java è¿æ¥ redis å¯å¨æ¥é Error redis clients jedis HostAndPort cant resolve localhost address\n\néè¯¯ç¯å¢: æ¬å° window å¼åç¯å¢æ²¡æé®é¢ãä¸å° Linux ç¯å¢,å¯å¨åºç°é®é¢ã éè¯¯ä¿¡æ¯: Error redis clients jedis HostAndPort cant resolve localhost address\n\nè§£å³åæ³:\n\nï¼1ï¼æ¥ç Linux ç³»ç»çä¸»æºå\n\n# hostname\ntemplate\n\n\nï¼2ï¼æ¥ç/etc/hosts æä»¶ä¸­æ¯å¦æ 127.0.0.1 å¯¹åºä¸»æºåï¼å¦ææ²¡æåæ·»å \n\n\n# Resin å®¹å¨æå® JDK 1.8\n\nå¦æ resin å®¹å¨åæ¥çæ¬ä½äº JDK1.8ï¼è¿è¡ JDK 1.8 ç¼è¯ç web app æ¶ï¼å¯è½ä¼æç¤ºéè¯¯ï¼\n\njava.lang.UnsupportedClassVersionError: PR/Sort : Unsupported major.minor version 52.0\n\n\nè§£å³æ¹æ³å°±æ¯ï¼ä½¿ç¨ JDK 1.8 è¦éæ°ç¼è¯ä¸ä¸ãç¶åï¼æå¨é¨ç½²æ¶åºç°è¿ç¼è¯åä»æ¥éçæåµï¼éå¯ä¸ä¸æå¡å¨åï¼é®é¢è§£å³ï¼ä¸ç¥æ¯ä»ä¹åå ã\n\n./configure --prefix=/usr/local/resin  --with-java=/usr/local/jdk1.8.0_121\nmake & make install\n\n\n\n# åèèµæ\n\n * java8-tutorial\n * Compatibility Guide for JDK 8\n * Compatibility Guide for JDK 8 ä¸­æç¿»è¯\n * Why Developers Should Not Write Programs That Call \'sun\' Packages',normalizedContent:'# jdk8 å¥é¨æå\n\n> jdk8 åçº§å¸¸è§é®é¢ç« èæ¯æä¸ªäººçç»éªæ´çãå¶ä»åå®¹åºæ¬ç¿»è¯èª java8-tutorial\n> \n> ð¦ æ¬æä»¥åç¤ºä¾æºç å·²å½æ¡£å¨ javacore\n> \n> å³é®è¯ï¼streamãlambdaãoptionalã@functionalinterface\n\n\n# default methods for interfaces(æ¥å£çé»è®¤æ¹æ³)\n\njava 8 ä½¿æä»¬è½å¤éè¿ä½¿ç¨ default å³é®å­å°éæ½è±¡æ¹æ³å®ç°æ·»å å°æ¥å£ãè¿ä¸ªåè½ä¹è¢«ç§°ä¸ºèææ©å±æ¹æ³ã\n\nè¿æ¯æä»¬çç¬¬ä¸ä¸ªä¾å­ï¼\n\ninterface formula {\n    double calculate(int a);\n\n    default double sqrt(int a) {\n        return math.sqrt(a);\n    }\n}\n\n\né¤äºæ½è±¡æ¹æ³ calculate ï¼æ¥å£ formula è¿å®ä¹äºé»è®¤æ¹æ³ sqrtãå·ä½ç±»åªéè¦æ§è¡æ½è±¡æ¹æ³è®¡ç®ãé»è®¤çæ¹æ³ sqrt å¯ä»¥ç¨äºå¼ç®±å³ç¨ã\n\nformula formula = new formula() {\n    @override\n    public double calculate(int a) {\n        return sqrt(a * 100);\n    }\n};\n\nformula.calculate(100);     // 100.0\nformula.sqrt(16);           // 4.0\n\n\nformula è¢«å®ç°ä¸ºä¸ä¸ªå¿åå¯¹è±¡ãä»£ç éå¸¸åé¿ï¼ç¨äº sqrt(a * 100) è¿æ ·ç®åçè®¡ç®ç 6 è¡ä»£ç ãæ­£å¦æä»¬å°å¨ä¸ä¸èä¸­çå°çï¼å¨ java 8 ä¸­å®ç°åä¸ªæ¹æ³å¯¹è±¡ææ´å¥½çæ¹æ³ã\n\n\n# lambda expressions(lambda è¡¨è¾¾å¼)\n\nè®©æä»¬ä»ä¸ä¸ªç®åçä¾å­æ¥è¯´æå¦ä½å¨ä»¥åçæ¬ç java ä¸­å¯¹å­ç¬¦ä¸²åè¡¨è¿è¡æåºï¼\n\nlist<string> names = arrays.aslist("peter", "anna", "mike", "xenia");\n\ncollections.sort(names, new comparator<string>() {\n    @override\n    public int compare(string a, string b) {\n        return b.compareto(a);\n    }\n});\n\n\néæå·¥å·æ¹æ³ collections.sort ä¸ºäºå¯¹æå®çåè¡¨è¿è¡æåºï¼æ¥åä¸ä¸ªåè¡¨åä¸ä¸ªæ¯è¾å¨ãæ¨ä¼åç°èªå·±ç»å¸¸éè¦åå»ºå¿åæ¯è¾å¨å¹¶å°å¶ä¼ éç»æåºæ¹æ³ã\n\njava 8 ä½¿ç¨æ´ç®ç­ç lambda è¡¨è¾¾å¼æ¥é¿åå¸¸å¸¸åå»ºå¿åå¯¹è±¡çé®é¢ï¼\n\ncollections.sort(names, (string a, string b) -> {\n    return b.compareto(a);\n});\n\n\nå¦æ¨æè§ï¼è¿æ®µä»£ç æ¯ä¸æ®µä»£ç ç®æ´å¾å¤ãä½æ¯ï¼è¿å¯ä»¥æ´å ç®æ´ï¼\n\ncollections.sort(names, (string a, string b) -> b.compareto(a));\n\n\nè¿è¡ä»£ç ä¸­ï¼ä½ çå»äºè±æ¬å· {} å return å³é®å­ãä½æ¯ï¼è¿è¿ä¸ç®å®ï¼å®è¿å¯ä»¥åè¿ä¸æ­¥ç®æ´ï¼\n\nnames.sort((a, b) -> b.compareto(a));\n\n\nåè¡¨ç°å¨æä¸ä¸ª sort æ¹æ³ãæ­¤å¤ï¼java ç¼è¯å¨ç¥éåæ°ç±»åï¼æä»¥ä½ å¯ä»¥ä¸æå®å¥åçæ°æ®ç±»åãè®©æä»¬æ·±å¥æ¢è®¨å¦ä½ä½¿ç¨ lambda è¡¨è¾¾å¼ã\n\n\n# functional interfaces(å½æ°æ¥å£)\n\nlambda è¡¨è¾¾å¼å¦ä½éåº java çç±»åç³»ç»ï¼æ¯ä¸ª lambda å¯¹åºä¸ä¸ªç±æ¥å£æå®çç±»åãä¸ä¸ªæè°çå½æ°æ¥å£å¿é¡»åå«ä¸ä¸ªæ½è±¡æ¹æ³å£°æãè¯¥ç±»åçæ¯ä¸ª lambda è¡¨è¾¾å¼é½å°ä¸æ­¤æ½è±¡æ¹æ³å¹éãç±äºé»è®¤æ¹æ³ä¸æ¯æ½è±¡çï¼æä»¥ä½ å¯ä»¥èªç±å°æ·»å é»è®¤æ¹æ³å°ä½ çå½æ°æ¥å£ã\n\nåªè¦ä¿è¯æ¥å£ä»åå«ä¸ä¸ªæ½è±¡æ¹æ³ï¼å°±å¯ä»¥ä½¿ç¨ä»»æçæ¥å£ä½ä¸º lambda è¡¨è¾¾å¼ãä¸ºç¡®ä¿æ¨çæ¥å£ç¬¦åè¦æ±ï¼æ¨åºè¯¥æ·»å  @functionalinterface æ³¨è§£ãç¼è¯å¨æ³¨æå°è¿ä¸ªæ³¨è§£åï¼ä¸æ¦æ¨å°è¯å¨æ¥å£ä¸­æ·»å ç¬¬äºä¸ªæ½è±¡æ¹æ³å£°æï¼ç¼è¯å¨å°±ä¼æåºç¼è¯å¨éè¯¯ã\n\nç¤ºä¾ï¼\n\n@functionalinterface\ninterface converter<f, t> {\n    t convert(f from);\n}\n\n\nconverter<string, integer> converter = (from) -> integer.valueof(from);\ninteger converted = converter.convert("123");\nsystem.out.println(converted);    // 123\n\n\nè¯·è®°ä½ï¼å¦æ @functionalinterface æ³¨è§£è¢«çç¥ï¼ä»£ç ä¹æ¯ææçã\n\n\n# method and constructor references(æ¹æ³åæé å¨å¼ç¨)\n\nä¸é¢çç¤ºä¾ä»£ç å¯ä»¥éè¿ä½¿ç¨éææ¹æ³å¼ç¨è¿ä¸æ­¥ç®åï¼\n\nconverter<string, integer> converter = integer::valueof;\ninteger converted = converter.convert("123");\nsystem.out.println(converted);   // 123\n\n\njava 8 åè®¸æ¨éè¿ :: å³é®å­ä¼ éæ¹æ³ææé å½æ°çå¼ç¨ãä¸é¢çä¾å­å±ç¤ºäºå¦ä½å¼ç¨ä¸ä¸ªéææ¹æ³ãä½æ¯æä»¬ä¹å¯ä»¥å¼ç¨å¯¹è±¡æ¹æ³ï¼\n\nclass something {\n    string startswith(string s) {\n        return string.valueof(s.charat(0));\n    }\n}\n\n\nsomething something = new something();\nconverter<string, string> converter = something::startswith;\nstring converted = converter.convert("java");\nsystem.out.println(converted);    // "j"\n\n\næä»¬æ¥è§å¯ä¸ä¸ :: å³é®å­æ¯å¦ä½ä½ç¨äºæé å¨çãé¦åï¼æä»¬å®ä¹ä¸ä¸ªæå¤ä¸ªæé å¨çç¤ºä¾ç±»ã\n\nclass person {\n    string firstname;\n    string lastname;\n\n    person() {}\n\n    person(string firstname, string lastname) {\n        this.firstname = firstname;\n        this.lastname = lastname;\n    }\n}\n\n\næ¥çï¼æä»¬æå®ä¸ä¸ªç¨äºåå»º person å¯¹è±¡ç personfactory æ¥å£ã\n\ninterface personfactory<p extends person> {\n    p create(string firstname, string lastname);\n}\n\n\næä»¬ä¸æ¯æå¨å®ç°å·¥åï¼èæ¯éè¿æé å¼ç¨å°ææä¸è¥¿ç²åå¨ä¸èµ·ï¼\n\npersonfactory<person> personfactory = person::new;\nperson person = personfactory.create("peter", "parker");\n\n\næä»¬éè¿ person::new æ¥åå»ºä¸ä¸ª person æé å¨çå¼ç¨ãjava ç¼è¯å¨ä¼æ ¹æ®personfactory.create çç­¾åèªå¨å¹éæ­£ç¡®çæé å¨ã\n\n\n# lambda scopes(lambda ä½ç¨å)\n\nä» lambda è¡¨è¾¾å¼è®¿é®å¤é¨ä½ç¨ååéä¸å¿åå¯¹è±¡éå¸¸ç¸ä¼¼ãæ¨å¯ä»¥è®¿é®æ¬å°å¤é¨ä½ç¨åçå¸¸éä»¥åå®ä¾çæååéåéæåéã\n\n\n# accessing local variables(è®¿é®æ¬å°åé)\n\næä»¬å¯ä»¥è®¿é® lambda è¡¨è¾¾å¼ä½ç¨åå¤é¨çå¸¸éï¼\n\nfinal int num = 1;\nconverter<integer, string> stringconverter =\n        (from) -> string.valueof(from + num);\n\nstringconverter.convert(2);     // 3\n\n\nä¸åäºå¿åå¯¹è±¡çæ¯ï¼è¿ä¸ªåé num ä¸æ¯ä¸å®è¦è¢« final ä¿®é¥°ãä¸é¢çä»£ç ä¸æ ·åæ³ï¼\n\nint num = 1;\nconverter<integer, string> stringconverter =\n        (from) -> string.valueof(from + num);\n\nstringconverter.convert(2);     // 3\n\n\nä½æ¯ï¼num å¿é¡»æ¯éå¼å¸¸éçãä¸é¢çä»£ç ä¸è½ç¼è¯éè¿ï¼\n\nint num = 1;\nconverter<integer, string> stringconverter =\n        (from) -> string.valueof(from + num);\nnum = 3;\n\n\næ­¤å¤ï¼å¨ lambda è¡¨è¾¾å¼ä¸­å¯¹ num ååæä½ä¹æ¯è¢«ç¦æ­¢çã\n\n\n# accessing fields and static variables(è®¿é®æååéåéæåé)\n\nä¸å±é¨åéç¸æ¯ï¼æä»¬æ¢å¯ä»¥å¨ lambda è¡¨è¾¾å¼ä¸­è¯»åå®ä¾çæååéï¼ä¹å¯ä»¥è¯»åå®ä¾çéæåéãè¿ç§è¡ä¸ºå¨å¿åå¯¹è±¡ä¸­æ¯ä¼æå¨ç¥çã\n\nclass lambda4 {\n    static int outerstaticnum;\n    int outernum;\n\n    void testscopes() {\n        converter<integer, string> stringconverter1 = (from) -> {\n            outernum = 23;\n            return string.valueof(from);\n        };\n\n        converter<integer, string> stringconverter2 = (from) -> {\n            outerstaticnum = 72;\n            return string.valueof(from);\n        };\n    }\n}\n\n\n\n# accessing default interface methodsï¼è®¿é®é»è®¤çæ¥å£æ¹æ³ï¼\n\nè¿è®°å¾ç¬¬ä¸èç formula ä¾å­åï¼ formula æ¥å£å®ä¹äºä¸ä¸ªé»è®¤æ¹æ³ sqrtï¼å®å¯ä»¥è¢«æ¯ä¸ª formula å®ä¾ï¼åæ¬å¿åå¯¹è±¡ï¼è®¿é®ãè¿ä¸ªç¹æ§ä¸éç¨äº lambda è¡¨è¾¾å¼ã\n\né»è®¤æ¹æ³ä¸è½è¢« lambda è¡¨è¾¾å¼è®¿é®ãä¸é¢çä»£ç ä¸è½ç¼è¯éè¿ï¼\n\nformula formula = (a) -> sqrt(a * 100);\n\n\n\n# built-in functional interfaces(åç½®å½æ°æ¥å£)\n\njdk 1.8 api åå«è®¸å¤åç½®çåè½æ¥å£ãå®ä»¬ä¸­çä¸äºå¨è¾æ©ç java çæ¬ï¼æ¯å¦ comparator æ runnableï¼ä¸­æ¯ä¼æå¨ç¥çãè¿äºç°æçæ¥å£éè¿ @functionalinterfaceannotation æ³¨è§£è¢«æ©å±ä¸ºæ¯æ lambdaã\n\nä½æ¯ï¼java 8 api ä¹æä¾äºä¸å°æ°çå½æ°æ¥å£ãå¶ä¸­ä¸äºæ°æ¥å£å¨ google guava åºä¸­æ¯ä¼æå¨ç¥çãå³ä½¿æ¨çæè¿ä¸ªåºï¼ä¹åºè¯¥å¯åå³æ³¨å¦ä½éè¿ä¸äºæç¨çæ¹æ³æ©å±æ¥æ©å±è¿äºæ¥å£ã\n\n\n# predicates\n\npredicate æ¯åªæä¸ä¸ªåæ°çå¸å°å¼å½æ°ãè¯¥æ¥å£åå«åç§é»è®¤æ¹æ³ï¼ç¨äºå°è°è¯ç»åæå¤æçé»è¾æ¯è¯­ï¼ä¸ãæãéï¼\n\npredicate<string> predicate = (s) -> s.length() > 0;\n\npredicate.test("foo");              // true\npredicate.negate().test("foo");     // false\n\npredicate<boolean> nonnull = objects::nonnull;\npredicate<boolean> isnull = objects::isnull;\n\npredicate<string> isempty = string::isempty;\npredicate<string> isnotempty = isempty.negate();\n\n\n\n# functions\n\nfunction æ¥åä¸ä¸ªåæ°å¹¶äº§çä¸ä¸ªç»æãå¯ä»¥ä½¿ç¨é»è®¤æ¹æ³å°å¤ä¸ªå½æ°é¾æ¥å¨ä¸èµ·ï¼composeãandthenï¼ã\n\nfunction<string, integer> tointeger = integer::valueof;\nfunction<string, string> backtostring = tointeger.andthen(string::valueof);\n\nbacktostring.apply("123");     // "123"\n\n\n\n# suppliers\n\nsupplier äº§çä¸ä¸ªæ³åç»æãä¸ function ä¸åï¼supplier ä¸æ¥ååæ°ã\n\nsupplier<person> personsupplier = person::new;\npersonsupplier.get();   // new person\n\n\n\n# consumers\n\nconsumer è¡¨ç¤ºè¦å¨ä¸ä¸ªè¾å¥åæ°ä¸æ§è¡çæä½ã\n\nconsumer<person> greeter = (p) -> system.out.println("hello, " + p.firstname);\ngreeter.accept(new person("luke", "skywalker"));\n\n\n\n# comparators\n\næ¯è¾å¨å¨èçæ¬ç java ä¸­æ¯ä¼æå¨ç¥çã java 8 ä¸ºæ¥å£æ·»å äºåç§é»è®¤æ¹æ³ã\n\ncomparator<person> comparator = (p1, p2) -> p1.firstname.compareto(p2.firstname);\n\nperson p1 = new person("john", "doe");\nperson p2 = new person("alice", "wonderland");\n\ncomparator.compare(p1, p2);             // > 0\ncomparator.reversed().compare(p1, p2);  // < 0\n\n\n\n# optionals\n\noptional ä¸æ¯åè½æ§æ¥å£ï¼èæ¯é²æ­¢ nullpointerexception çå¥½å·¥å·ãè¿æ¯ä¸ä¸èçä¸ä¸ªéè¦æ¦å¿µï¼æä»¥è®©æä»¬å¿«éçç optional æ¯å¦ä½å·¥ä½çã\n\noptional æ¯ä¸ä¸ªç®åçå®¹å¨ï¼å¶å¼å¯ä»¥æ¯ null æé nullãæ³æ³ä¸ä¸ªå¯è½è¿åä¸ä¸ªéç©ºç»æçæ¹æ³ï¼ä½ææ¶åä»ä¹é½ä¸è¿åãä¸æ¯è¿å nullï¼èæ¯è¿å java 8 ä¸­ç optionalã\n\noptional<string> optional = optional.of("bam");\n\noptional.ispresent();           // true\noptional.get();                 // "bam"\noptional.orelse("fallback");    // "bam"\n\noptional.ifpresent((s) -> system.out.println(s.charat(0)));     // "b"\n\n\n\n# streams\n\njava.util.stream è¡¨ç¤ºå¯ä»¥å¨å¶ä¸æ§è¡ä¸ä¸ªæå¤ä¸ªæä½çåç´ åºåãæµæä½æ¯ä¸­é´æç»ç«¯ãå½ç»ç«¯æä½è¿åä¸ä¸ªç¹å®ç±»åçç»ææ¶ï¼ä¸­é´æä½è¿åæµæ¬èº«ï¼æä»¥ä½ å¯ä»¥é¾æ¥å¤ä¸ªæ¹æ³è°ç¨ãæµå¨æºä¸åå»ºï¼ä¾å¦ä¸ä¸ª java.util.collection ååè¡¨æéåï¼ä¸æ¯ææ å°ï¼ãæµæä½æ¢å¯ä»¥æé¡ºåºæ§è¡ï¼ä¹å¯ä»¥å¹¶è¡æ§è¡ã\n\n> æµæ¯éå¸¸å¼ºå¤§çï¼æä»¥ï¼æåäºä¸ä¸ªç¬ç«ç java8 streams æç¨ ãæ¨è¿åºè¯¥æ¥ç sequentï¼å°å¶ä½ä¸º web çç±»ä¼¼åºã\n\næä»¬åæ¥ççé¡ºåºæµå¦ä½å·¥ä½ãé¦åï¼æä»¬ä»¥å­ç¬¦ä¸²åè¡¨çå½¢å¼åå»ºä¸ä¸ªç¤ºä¾æºä»£ç ï¼\n\nlist<string> stringcollection = new arraylist<>();\nstringcollection.add("ddd2");\nstringcollection.add("aaa2");\nstringcollection.add("bbb1");\nstringcollection.add("aaa1");\nstringcollection.add("bbb3");\nstringcollection.add("ccc");\nstringcollection.add("bbb2");\nstringcollection.add("ddd1");\n\n\njava 8 ä¸­çéåå·²è¢«æ©å±ï¼å æ­¤æ¨å¯ä»¥éè¿è°ç¨ collection.stream() æcollection.parallelstream() æ¥ç®åå°åå»ºæµãä»¥ä¸åèä»ç»æå¸¸è§çæµæä½ã\n\n\n# filter\n\nè¿æ»¤å¨æ¥åä¸ä¸ªè°è¯æ¥è¿æ»¤æµçææåç´ ãè¿ä¸ªæä½æ¯ä¸­é´çï¼ä½¿æä»¬è½å¤è°ç¨å¦ä¸ä¸ªæµæä½ï¼foreachï¼çç»æã foreach æ¥åä¸ä¸ªæ¶è´¹èè¢«æ§è¡çè¿æ»¤æµä¸­çæ¯ä¸ªåç´ ã foreach æ¯ä¸ä¸ªç»ç«¯æä½ãå®æ¯æ æçï¼æä»¥æä»¬ä¸è½è°ç¨å¦ä¸ä¸ªæµæä½ã\n\nstringcollection\n    .stream()\n    .filter((s) -> s.startswith("a"))\n    .foreach(system.out::println);\n\n// "aaa2", "aaa1"\n\n\n\n# sorted\n\næåºæ¯ä¸ä¸ªä¸­é´æä½ï¼è¿åæµçæåºè§å¾ãåç´ æèªç¶é¡ºåºæåºï¼é¤éæ¨ä¼ éèªå®ä¹æ¯è¾å¨ã\n\nstringcollection\n    .stream()\n    .sorted()\n    .filter((s) -> s.startswith("a"))\n    .foreach(system.out::println);\n\n// "aaa1", "aaa2"\n\n\nè¯·è®°ä½ï¼æåºåªä¼åå»ºæµçæåºè§å¾ï¼èä¸ä¼æçºµæ¯æçéåçæåºã stringcollection çæåºæ¯ä¸åçï¼\n\nsystem.out.println(stringcollection);\n// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1\n\n\n\n# map\n\nä¸­é´æä½æ å°éè¿ç»å®å½æ°å°æ¯ä¸ªåç´ è½¬æ¢ä¸ºå¦ä¸ä¸ªå¯¹è±¡ãä»¥ä¸ç¤ºä¾å°æ¯ä¸ªå­ç¬¦ä¸²è½¬æ¢ä¸ºå¤§åå­æ¯å­ç¬¦ä¸²ãä½æ¯æ¨ä¹å¯ä»¥ä½¿ç¨ map å°æ¯ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸ç§ç±»åãç»ææµçæ³åç±»ååå³äºæ¨ä¼ éç» map çå½æ°çæ³åç±»åã\n\nstringcollection\n    .stream()\n    .map(string::touppercase)\n    .sorted((a, b) -> b.compareto(a))\n    .foreach(system.out::println);\n\n// "ddd2", "ddd1", "ccc", "bbb3", "bbb2", "aaa2", "aaa1"\n\n\n\n# match\n\nå¯ä»¥ä½¿ç¨åç§å¹éæä½æ¥æ£æ¥æä¸ªè°è¯æ¯å¦ä¸æµå¹éãææè¿äºæä½é½æ¯ç»ç«¯å¹¶è¿åå¸å°ç»æã\n\nboolean anystartswitha =\n    stringcollection\n        .stream()\n        .anymatch((s) -> s.startswith("a"));\n\nsystem.out.println(anystartswitha);      // true\n\nboolean allstartswitha =\n    stringcollection\n        .stream()\n        .allmatch((s) -> s.startswith("a"));\n\nsystem.out.println(allstartswitha);      // false\n\nboolean nonestartswithz =\n    stringcollection\n        .stream()\n        .nonematch((s) -> s.startswith("z"));\n\nsystem.out.println(nonestartswithz);      // true\n\n\n# count\n\ncount æ¯ä¸ä¸ªç»ç«¯æä½ï¼è¿åæµä¸­åç´ çä¸ªæ°ã\n\nlong startswithb =\n    stringcollection\n        .stream()\n        .filter((s) -> s.startswith("b"))\n        .count();\n\nsystem.out.println(startswithb);    // 3\n\n\n\n# reduce\n\nè¯¥ç»ç«¯æä½ä½¿ç¨ç»å®çåè½å¯¹æµçåç´ è¿è¡ç¼©åãç»ææ¯ä¸ä¸ª optional ææç¼©å°åçå¼ã\n\noptional<string> reduced =\n    stringcollection\n        .stream()\n        .sorted()\n        .reduce((s1, s2) -> s1 + "#" + s2);\n\nreduced.ifpresent(system.out::println);\n// "aaa1##aaa2##bbb1##bbb2##bbb3##ccc##ddd1##ddd2"\n\n\n\n# parallel streams\n\nå¦ä¸æè¿°ï¼æµå¯ä»¥æ¯é¡ºåºçä¹å¯ä»¥æ¯å¹¶è¡çãé¡ºåºæµä¸çæä½å¨åä¸ªçº¿ç¨ä¸æ§è¡ï¼èå¹¶è¡æµä¸çæä½å¨å¤ä¸ªçº¿ç¨ä¸åæ¶æ§è¡ã\n\nä»¥ä¸ç¤ºä¾æ¼ç¤ºäºéè¿ä½¿ç¨å¹¶è¡æµæé«æ§è½æ¯å¤ä¹å®¹æã\n\né¦åï¼æä»¬åå»ºä¸ä¸ªè¾å¤§çç¬ç¹åç´ çåè¡¨ï¼\n\nint max = 1000000;\nlist<string> values = new arraylist<>(max);\nfor (int i = 0; i < max; i++) {\n    uuid uuid = uuid.randomuuid();\n    values.add(uuid.tostring());\n}\n\n\nç°å¨æä»¬æµéå¯¹è¿ä¸ªéåè¿è¡æåºæè±è´¹çæ¶é´ã\n\n\n# sequential sort\n\nlong t0 = system.nanotime();\n\nlong count = values.stream().sorted().count();\nsystem.out.println(count);\n\nlong t1 = system.nanotime();\n\nlong millis = timeunit.nanoseconds.tomillis(t1 - t0);\nsystem.out.println(string.format("sequential sort took: %d ms", millis));\n\n// sequential sort took: 899 ms\n\n\n\n# parallel sort\n\nlong t0 = system.nanotime();\n\nlong count = values.parallelstream().sorted().count();\nsystem.out.println(count);\n\nlong t1 = system.nanotime();\n\nlong millis = timeunit.nanoseconds.tomillis(t1 - t0);\nsystem.out.println(string.format("parallel sort took: %d ms", millis));\n\n// parallel sort took: 472 ms\n\n\nå¦ä½ æè§ï¼ä¸¤ä¸ªä»£ç æ®µå·®ä¸å¤ï¼ä½æ¯å¹¶è¡æåºå¿«äºè¿ 50%ãä½ æéåçä»ä»æ¯å° stream() æ¹ä¸º parallelstream() ã\n\n\n# maps\n\nå¦åæè¿°ï¼map ä¸ç´æ¥æ¯ææµãmap æ¥å£æ¬èº«æ²¡æå¯ç¨ç stream() æ¹æ³ï¼ä½æ¯ä½ å¯ä»¥éè¿ map.keyset().stream() ã map.values().stream() å map.entryset().stream() åå»ºæå®çæµã\n\næ­¤å¤ï¼map æ¯æåç§æ°çãæç¨çæ¹æ³æ¥å¤çå¸¸è§ä»»å¡ã\n\nmap<integer, string> map = new hashmap<>();\n\nfor (int i = 0; i < 10; i++) {\n    map.putifabsent(i, "val" + i);\n}\n\nmap.foreach((id, val) -> system.out.println(val));\n\n\nä¸é¢çä»£ç åºè¯¥æ¯èªæè§£éçï¼putifabsent é»æ­¢æä»¬åå¥é¢å¤çç©ºå¼æ£æ¥ï¼foreach æ¥åæ¶è´¹èä¸º map çæ¯ä¸ªå¼å®ç°æä½ã\n\nè¿ä¸ªä¾å­å±ç¤ºäºå¦ä½å©ç¨å½æ°æ¥è®¡ç® map ä¸çä»£ç ï¼\n\nmap.computeifpresent(3, (num, val) -> val + num);\nmap.get(3);             // val33\n\nmap.computeifpresent(9, (num, val) -> null);\nmap.containskey(9);     // false\n\nmap.computeifabsent(23, num -> "val" + num);\nmap.containskey(23);    // true\n\nmap.computeifabsent(3, num -> "bam");\nmap.get(3);             // val33\n\n\næ¥ä¸æ¥ï¼æä»¬å­¦ä¹ å¦ä½å é¤ç»å®é®çæ¡ç®ï¼åªæå½åé®æ å°å°ç»å®å¼æ¶ï¼\n\nmap.remove(3, "val3");\nmap.get(3);             // val33\n\nmap.remove(3, "val33");\nmap.get(3);             // null\n\n\nå¦ä¸ä¸ªæç¨æ¹æ³ï¼\n\nmap.getordefault(42, "not found");  // not found\n\n\nåå¹¶ä¸ä¸ª map ç entry å¾ç®åï¼\n\nmap.merge(9, "val9", (value, newvalue) -> value.concat(newvalue));\nmap.get(9);             // val9\n\nmap.merge(9, "concat", (value, newvalue) -> value.concat(newvalue));\nmap.get(9);             // val9concat\n\n\nå¦æä¸å­å¨è¯¥é®çæ¡ç®ï¼åå¹¶æèå°é®/å¼æ¾å¥ map ä¸­ï¼å¦åå°è°ç¨åå¹¶å½æ°æ¥æ´æ¹ç°æå¼ã\n\n\n# date api\n\njava 8 å¨ java.time åä¸æ°å¢äºä¸ä¸ªå¨æ°çæ¥æåæ¶é´ apiãæ°çæ¥æ api ä¸ joda-time åºç¸ä¼¼ï¼ä½ä¸ä¸æ ·ãä»¥ä¸ç¤ºä¾æ¶µçäºæ­¤æ° api çæéè¦é¨åã\n\n\n# clock\n\nclock æä¾å¯¹å½åæ¥æåæ¶é´çè®¿é®ãclock ç¥éä¸ä¸ªæ¶åºï¼å¯ä»¥ä½¿ç¨å®æ¥ä»£æ¿ system.currenttimemillis() ï¼è·åä» unix epoch å¼å§çä»¥æ¯«ç§ä¸ºåä½çå½åæ¶é´ãæ¶é´çº¿ä¸çæä¸æ¶å»ä¹ç±ç±» instant è¡¨ç¤ºã instants å¯ä»¥ç¨æ¥åå»ºéçç java.util.date å¯¹è±¡ã\n\nclock clock = clock.systemdefaultzone();\nlong millis = clock.millis();\n\ninstant instant = clock.instant();\ndate legacydate = date.from(instant);   // legacy java.util.date\n\n\n\n# timezones\n\næ¶åºç± zoneid è¡¨ç¤ºãä»ä»¬å¯ä»¥å¾å®¹æå°éè¿éæå·¥åæ¹æ³è®¿é®ãæ¶åºå®ä¹äºæä¸æ¶å»åå½å°æ¥æãæ¶é´ä¹é´è½¬æ¢çéè¦åç§»éã\n\nsystem.out.println(zoneid.getavailablezoneids());\n// prints all available timezone ids\n\nzoneid zone1 = zoneid.of("europe/berlin");\nzoneid zone2 = zoneid.of("brazil/east");\nsystem.out.println(zone1.getrules());\nsystem.out.println(zone2.getrules());\n\n// zonerules[currentstandardoffset=+01:00]\n// zonerules[currentstandardoffset=-03:00]\n\n\n\n# localtime\n\nlocaltime ä»£è¡¨æ²¡ææ¶åºçæ¶é´ï¼ä¾å¦æä¸ 10 ç¹æ 17:30:15ãä»¥ä¸ç¤ºä¾ä¸ºä¸é¢å®ä¹çæ¶åºåå»ºä¸¤ä¸ªæ¬å°æ¶é´ãç¶åæä»¬æ¯è¾ä¸¤æ¬¡ï¼å¹¶è®¡ç®ä¸¤æ¬¡ä¹é´çå°æ¶ååéçå·®å¼ã\n\nlocaltime now1 = localtime.now(zone1);\nlocaltime now2 = localtime.now(zone2);\n\nsystem.out.println(now1.isbefore(now2));  // false\n\nlong hoursbetween = chronounit.hours.between(now1, now2);\nlong minutesbetween = chronounit.minutes.between(now1, now2);\n\nsystem.out.println(hoursbetween);       // -3\nsystem.out.println(minutesbetween);     // -239\n\n\nlocaltime å¸¦æåç§å·¥åæ¹æ³ï¼ä»¥ç®åæ°å®ä¾çåå»ºï¼åæ¬è§£ææ¶é´å­ç¬¦ä¸²ã\n\nlocaltime late = localtime.of(23, 59, 59);\nsystem.out.println(late);       // 23:59:59\n\ndatetimeformatter germanformatter =\n    datetimeformatter\n        .oflocalizedtime(formatstyle.short)\n        .withlocale(locale.german);\n\nlocaltime leettime = localtime.parse("13:37", germanformatter);\nsystem.out.println(leettime);   // 13:37\n\n\n\n# localdate\n\nlocaldate è¡¨ç¤ºä¸åçæ¥æï¼ä¾å¦ï¼2014 å¹´ 3 æ 11 æ¥ãå®æ¯ä¸å¯åçï¼å¹¶ä¸ä¸ localtime å®å¨ç±»ä¼¼ãè¯¥ç¤ºä¾æ¼ç¤ºå¦ä½éè¿å åæ¥ãææå¹´æ¥è®¡ç®æ°æ¥æãè¯·è®°ä½ï¼æ¯ä¸ªæä½é½ä¼è¿åä¸ä¸ªæ°çå®ä¾ã\n\nlocaldate today = localdate.now();\nlocaldate tomorrow = today.plus(1, chronounit.days);\nlocaldate yesterday = tomorrow.minusdays(2);\n\nlocaldate independenceday = localdate.of(2014, month.july, 4);\ndayofweek dayofweek = independenceday.getdayofweek();\nsystem.out.println(dayofweek);    // friday\n\n\nä»ä¸ä¸ªå­ç¬¦ä¸²ä¸­è§£æåº localdate å¯¹è±¡ï¼åè§£æ localtime ä¸æ ·çç®åï¼\n\ndatetimeformatter germanformatter =\n    datetimeformatter\n        .oflocalizeddate(formatstyle.medium)\n        .withlocale(locale.german);\n\nlocaldate xmas = localdate.parse("24.12.2014", germanformatter);\nsystem.out.println(xmas);   // 2014-12-24\n\n\n\n# localdatetime\n\nlocaldatetime è¡¨ç¤ºæ¥ææ¶é´ãå®å°æ¥æåæ¶é´ç»åæä¸ä¸ªå®ä¾ã localdatetime æ¯ä¸å¯åçï¼å¶ä½ç¨ç±»ä¼¼äº localtime å localdateãæä»¬å¯ä»¥å©ç¨æ¹æ³å»è·åæ¥ææ¶é´ä¸­æä¸ªåä½çå¼ã\n\nlocaldatetime sylvester = localdatetime.of(2014, month.december, 31, 23, 59, 59);\n\ndayofweek dayofweek = sylvester.getdayofweek();\nsystem.out.println(dayofweek);      // wednesday\n\nmonth month = sylvester.getmonth();\nsystem.out.println(month);          // december\n\nlong minuteofday = sylvester.getlong(chronofield.minute_of_day);\nsystem.out.println(minuteofday);    // 1439\n\n\néè¿ä¸ä¸ªæ¶åºçéå ä¿¡æ¯å¯ä»¥è½¬ä¸ºä¸ä¸ªå®ä¾ãè¿ä¸ªå®ä¾å¾å®¹æè½¬ä¸ºjava.util.date ç±»åã\n\ninstant instant = sylvester\n        .atzone(zoneid.systemdefault())\n        .toinstant();\n\ndate legacydate = date.from(instant);\nsystem.out.println(legacydate);     // wed dec 31 23:59:59 cet 2014\n\n\næ¥ææ¶é´çæ ¼å¼åç±»ä¼¼äº date æ timeãæä»¬å¯ä»¥ä½¿ç¨èªå®ä¹æ¨¡å¼åå»ºæ ¼å¼åç¨åºï¼èä¸æ¯ä½¿ç¨é¢å®ä¹çæ ¼å¼ã\n\ndatetimeformatter formatter =\n    datetimeformatter\n        .ofpattern("mmm dd, yyyy - hh:mm");\n\nlocaldatetime parsed = localdatetime.parse("nov 03, 2014 - 07:13", formatter);\nstring string = formatter.format(parsed);\nsystem.out.println(string);     // nov 03, 2014 - 07:13\n\n\nä¸åäº java.text.numberformat ï¼ datetimeformatter æ¯ä¸å¯åä¸çº¿ç¨å®å¨ç ã\n\næ´å¤å³äºæ¥ææ ¼å¼åçåå®¹å¯ä»¥åèè¿é.\n\n\n# annotations\n\njava 8 ä¸­çæ³¨éæ¯å¯éå¤çãè®©æä»¬ç´æ¥çä¸ä¸ªä¾å­æ¥è§£å³è¿ä¸ªé®é¢ã\n\né¦åï¼æä»¬å®ä¹ä¸ä¸ªåå«å®éæ³¨éæ°ç»çå¤å±æ³¨éï¼\n\n@interface hints {\n    hint[] value();\n}\n\n@repeatable(hints.class)\n@interface hint {\n    string value();\n}\n\n\njava8 åè®¸æä»¬éè¿ä½¿ç¨ @repeatable æ³¨è§£æ¥å¼å¥å¤ä¸ªåç±»åçæ³¨è§£ã\n\n\n# variant 1: ä½¿ç¨å®¹å¨æ³¨è§£ (èå¥è·¯)\n\n@hints({@hint("hint1"), @hint("hint2")})\nclass person {}\n\n\n\n# variant 2: ä½¿ç¨ repeatable æ³¨è§£ (æ°å¥è·¯)\n\n@hint("hint1")\n@hint("hint2")\nclass person {}\n\n\nä½¿ç¨åºæ¯ 2ï¼java ç¼è¯å¨éå¼å°è®¾ç½®äº @hints æ³¨è§£ã\n\nè¿å¯¹äºéè¿åå°æ¥è¯»åæ³¨è§£ä¿¡æ¯å¾éè¦ã\n\nhint hint = person.class.getannotation(hint.class);\nsystem.out.println(hint);                   // null\n\nhints hints1 = person.class.getannotation(hints.class);\nsystem.out.println(hints1.value().length);  // 2\n\nhint[] hints2 = person.class.getannotationsbytype(hint.class);\nsystem.out.println(hints2.length);          // 2\n\n\nå°½ç®¡ï¼æä»¬ä»æ²¡æå¨ person ç±»ä¸å£°æ @hints æ³¨è§£ï¼ä½æ¯ä»å¯ä»¥éè¿getannotation(hints.class) è¯»åå®ãç¶èï¼æ´ä¾¿å©çæ¹å¼æ¯ getannotationsbytype ï¼å®å¯ä»¥ç´æ¥è®¿é®ææ @hint æ³¨è§£ã\n\næ­¤å¤ï¼java 8 ä¸­çæ³¨éä½¿ç¨æ©å±äºä¸¤ä¸ªæ°çç®æ ï¼\n\n@target({elementtype.type_parameter, elementtype.type_use})\n@interface myannotation {}\n\n\næ°´å¹³çº¿ä»¥ä¸ä¸º java8-tutorial ç¿»è¯åå®¹ã\n\n----------------------------------------\n\n\n# jdk8 åçº§å¸¸è§é®é¢\n\n> jdk8 åå¸å¾ä¹äºï¼å®æä¾äºè®¸å¤å¸å¼äººçæ°ç¹æ§ï¼è½å¤æé«ç¼ç¨æçã\n> \n> å¦ææ¯æ°çé¡¹ç®ï¼ä½¿ç¨ jdk8 å½ç¶æ¯æå¥½çéæ©ãä½æ¯ï¼å¯¹äºä¸äºèçé¡¹ç®ï¼åçº§å° jdk8 åå­å¨ä¸äºå¼å®¹æ§é®é¢ï¼æ¯å¦åçº§éè¦éæèèã\n> \n> è¿æï¼æå¨å·¥ä½ä¸­éå°ä¸ä¸ªä»»å¡ï¼å°é¨é¨ææé¡¹ç®ç jdk çæ¬åçº§å° 1.8 ï¼èçæ¬å¤§å¤æ¯ 1.6ï¼ãå¨è¿ä¸ªè¿ç¨ä¸­ï¼éå°ä¸äºé®é¢ç¹ï¼å¹¶ç»åå¨ç½ä¸çå°çåï¼å¨è¿éæ»ç»ä¸ä¸ã\n\n\n# intellij ä¸­ç jdk ç¯å¢è®¾ç½®\n\n# settings\n\nç¹å» file > settings > java compiler\n\nproject bytecode version éæ© 1.8\n\nç¹å» file > settings > build tools > maven > importing\n\néæ© jdk for importer ä¸º 1.8\n\n# projcet settings\n\nproject sdk éæ© 1.8\n\n# application\n\nå¦æ web åºç¨çå¯å¨æ¹å¼ä¸º application ï¼éè¦ä¿®æ¹ jre\n\nç¹å» run/debug configurations > configuration\n\néæ© jre ä¸º 1.8\n\n\n# linux ç¯å¢ä¿®æ¹\n\n# ä¿®æ¹ç¯å¢åé\n\nä¿®æ¹ /etc/profile ä¸­ç java_homeï¼è®¾ç½® ä¸º jdk8 æå¨è·¯å¾ã\n\nä¿®æ¹åï¼æ§è¡ source /etc/profile çæã\n\nç¼è¯ãåå¸èæ¬ä¸­å¦ææ export java_home ï¼éè¦æ³¨æï¼éè¦ä½¿ç¨ jdk8 çè·¯å¾ã\n\n# ä¿®æ¹ maven\n\nsettings.xml ä¸­ profile çæ¿æ´»æ¡ä»¶å¦ææ¯ jdkï¼éè¦ä¿®æ¹ä¸ä¸ jdk çæ¬\n\n<activation>\n  <jdk>1.8</jdk> \x3c!-- ä¿®æ¹ä¸º 1.8 --\x3e\n</activation>\n\n\n# ä¿®æ¹ server\n\nä¿®æ¹ server ä¸­ç javac çæ¬ï¼ä»¥ resin ä¸ºä¾ï¼\n\nä¿®æ¹ resin éç½®æä»¶ä¸­ç javac åæ°ã\n\n<javac compiler="internal" args="-source 1.8"/>\n\n\n\n# sun.* åç¼ºå¤±é®é¢\n\njdk8 ä¸åæä¾ sun.* åä¾å¼åèä½¿ç¨ï¼å ä¸ºè¿äºæ¥å£ä¸æ¯å¬å±æ¥å£ï¼ä¸è½ä¿è¯å¨ææ java å¼å®¹çå¹³å°ä¸å·¥ä½ã\n\nä½¿ç¨äºè¿äº api çç¨åºå¦æè¦åçº§å° jdk 1.8 éè¦å¯»æ±æ¿ä»£æ¹æ¡ã\n\nè½ç¶ï¼ä¹å¯ä»¥èªå·±å¯¼å¥åå« sun.* æ¥å£ jar åå° classpath ç®å½ï¼ä½è¿ä¸æ¯ä¸ä¸ªå¥½çåæ³ã\n\néè¦è¯¦ç»äºè§£ä¸ºä»ä¹ä¸è¦ä½¿ç¨ sun.* ï¼å¯ä»¥åèå®æ¹ææ¡£ï¼why developers should not write programs that call \'sun\' packages\n\n\n# é»è®¤å®å¨ç­ç¥ä¿®æ¹\n\nåçº§åä¼°è®¡æäºå°ä¼ä¼´å¨ä½¿ç¨ä¸å®å¨ç®æ³æ¶å¯è½ä¼åçéè¯¯ï¼soï¼æ¯æä¸å®å¨ç®æ³è¿æ¯æå¿è¦ç\n\næ¾å°$java_home ä¸ jre/lib/security/java.security ï¼å°ç¦ç¨çç®æ³è®¾ç½®ä¸ºç©ºï¼jdk.certpath.disabledalgorithms= ã\n\n\n# jvm åæ°è°æ´\n\nå¨ jdk8 ä¸­ï¼permsize ç¸å³çåæ°å·²ç»ä¸è¢«ä½¿ç¨ï¼\n\n-xx:maxpermsize=size\n\nsets the maximum permanent generation space size (in bytes). this option was deprecated in jdk 8, and superseded by the -xx:maxmetaspacesize option.\n\n-xx:permsize=size\n\nsets the space (in bytes) allocated to the permanent generation that triggers a garbage collection if it is exceeded. this option was deprecated un jdk 8, and superseded by the -xx:metaspacesize option.\n\n\njdk8 ä¸­åä¹æ²¡æ permgen äºãå¶ä¸­çæäºé¨åï¼å¦è¢« intern çå­ç¬¦ä¸²ï¼å¨ jdk7 ä¸­å·²ç»ç§»å°äºæ®éå éãå¶ä½ç»æå¨ jdk8 ä¸­ä¼è¢«ç§»å°ç§°ä½âmetaspaceâçæ¬æºåå­åºä¸­ï¼è¯¥åºåå¨é»è®¤æåµä¸ä¼èªå¨çé¿ï¼ä¹ä¼è¢«åå¾åæ¶ãå®æä¸¤ä¸ªæ è®°ï¼metaspacesize å maxmetaspacesizeã\n\n-xx:metaspacesize=size\n\n> sets the size of the allocated class metadata space that will trigger a garbage collection the first time it is exceeded. this threshold for a garbage collection is increased or decreased depending on the amount of metadata used. the default size depends on the platform.\n\n-xx:maxmetaspacesize=size\n\n> sets the maximum amount of native memory that can be allocated for class metadata. by default, the size is not limited. the amount of metadata for an application depends on the application itself, other running applications, and the amount of memory available on the system.\n\nä»¥ä¸ç¤ºä¾æ¾ç¤ºå¦ä½å°ç±»ç±»åæ°æ®çä¸éè®¾ç½®ä¸º 256 mbï¼\n\nxx:maxmetaspacesize=256m\n\n\n# å­èç é®é¢\n\nasm 5.0 beta å¼å§æ¯æ jdk8\n\nå­èç éè¯¯\n\ncaused by: java.io.ioexception: invalid constant type: 15\n\tat javassist.bytecode.constpool.readone(constpool.java:1113)\n\n\n * æ¥æ¾ç»ä»¶ç¨å°äº mvelï¼mvel ä¸ºäºæé«æçè¿è¡äºå­èç ä¼åï¼æ­£å¥½ç¢°ä¸ jdk8 æ­»ç©´ï¼æä»¥éè¦åçº§ã\n\n<dependency>\n  <groupid>org.mvel</groupid>\n  <artifactid>mvel2</artifactid>\n  <version>2.2.7.final</version>\n</dependency>\n\n\n * javassist\n\n<dependency>\n  <groupid>org.javassist</groupid>\n  <artifactid>javassist</artifactid>\n  <version>3.18.1-ga</version>\n</dependency>\n\n\n> æ³¨æ\n> \n> æäºé¨ç½²å·¥å·ä¸ä¼å é¤æ§çæ¬ jar åï¼æä»¥å¯ä»¥å°è¯æå¨å é¤èçæ¬ jar åã\n\nhttp://asm.ow2.org/history.html\n\n\n# java è¿æ¥ redis å¯å¨æ¥é error redis clients jedis hostandport cant resolve localhost address\n\néè¯¯ç¯å¢: æ¬å° window å¼åç¯å¢æ²¡æé®é¢ãä¸å° linux ç¯å¢,å¯å¨åºç°é®é¢ã éè¯¯ä¿¡æ¯: error redis clients jedis hostandport cant resolve localhost address\n\nè§£å³åæ³:\n\nï¼1ï¼æ¥ç linux ç³»ç»çä¸»æºå\n\n# hostname\ntemplate\n\n\nï¼2ï¼æ¥ç/etc/hosts æä»¶ä¸­æ¯å¦æ 127.0.0.1 å¯¹åºä¸»æºåï¼å¦ææ²¡æåæ·»å \n\n\n# resin å®¹å¨æå® jdk 1.8\n\nå¦æ resin å®¹å¨åæ¥çæ¬ä½äº jdk1.8ï¼è¿è¡ jdk 1.8 ç¼è¯ç web app æ¶ï¼å¯è½ä¼æç¤ºéè¯¯ï¼\n\njava.lang.unsupportedclassversionerror: pr/sort : unsupported major.minor version 52.0\n\n\nè§£å³æ¹æ³å°±æ¯ï¼ä½¿ç¨ jdk 1.8 è¦éæ°ç¼è¯ä¸ä¸ãç¶åï¼æå¨é¨ç½²æ¶åºç°è¿ç¼è¯åä»æ¥éçæåµï¼éå¯ä¸ä¸æå¡å¨åï¼é®é¢è§£å³ï¼ä¸ç¥æ¯ä»ä¹åå ã\n\n./configure --prefix=/usr/local/resin  --with-java=/usr/local/jdk1.8.0_121\nmake & make install\n\n\n\n# åèèµæ\n\n * java8-tutorial\n * compatibility guide for jdk 8\n * compatibility guide for jdk 8 ä¸­æç¿»è¯\n * why developers should not write programs that call \'sun\' packages',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java ç¼ç¨è§è",frontmatter:{title:"Java ç¼ç¨è§è",date:"2019-05-06T15:02:02.000Z",categories:["Java","JavaSE","é«çº§ç¹æ§"],tags:["Java","JavaSE"],permalink:"/pages/d71f2c/"},regularPath:"/01.Java/01.JavaSE/02.%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/99.Java%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83.html",relativePath:"01.Java/01.JavaSE/02.é«çº§ç¹æ§/99.Javaç¼ç¨è§è.md",key:"v-7ac23752",path:"/pages/d71f2c/",headers:[{level:2,title:"Effective Java",slug:"effective-java",normalizedTitle:"effective java",charIndex:51},{level:2,title:"èµæº",slug:"èµæº",normalizedTitle:"èµæº",charIndex:2235}],headersStr:"Effective Java èµæº",content:"# Java ç¼ç¨è§è\n\n> ç¼ç¨è§èå°±æ¯ Java å¼åçæä½³å®è·µãå¸®å©å¼åäººåå°èµ°å¼¯è·¯ã\n\n\n# Effective Java\n\n * ç¬¬ 2 ç«  åå»ºãéæ¯å¯¹è±¡\n   * ç¬¬ 1 æ¡ï¼èèç¨éæå·¥åæ¹æ³ä»£æ¿æé å¨\n   * ç¬¬ 2 æ¡ï¼éå°å¤ä¸ªæé å¨åæ°æ¶è¦èèç¨æå»ºå¨\n   * ç¬¬ 3 æ¡ï¼ç¨ç§ææé å¨æèæä¸¾ç±»åå¼ºå Singleton å±æ§\n   * ç¬¬ 4 æ¡ï¼éè¿ç§ææé å¨å¼ºåä¸å¯å®ä¾åçè½å\n   * ç¬¬ 5 æ¡ï¼é¿ååå»ºä¸å¿è¦çå¯¹è±¡\n   * ç¬¬ 6 æ¡ï¼æ¶é¤è¿æçå¯¹è±¡å¼ç¨\n   * ç¬¬ 7 æ¡ï¼é¿åä½¿ç¨ç»ç»æ¹æ³\n * ç¬¬ 3 ç«  å¯¹äºææå¯¹è±¡é½éç¨çæ¹æ³\n   * ç¬¬ 8 æ¡ï¼è¦ç equals æ¶è¯·éµå®éç¨çº¦å®\n   * ç¬¬ 9 æ¡ï¼è¦ç equals æ¶æ»è¦è¦ç hashCode\n   * ç¬¬ 10 æ¡ï¼å§ç»è¦è¦ç toString\n   * ç¬¬ 11 æ¡ï¼è°¨æå°è¦ç clone\n   * ç¬¬ 12 æ¡ï¼èèå®ç° Comparable æ¥å£\n * ç¬¬ 4 ç«  ç±»åæ¥å£\n   * ç¬¬ 13 æ¡ï¼ä½¿ç±»åæåçå¯è®¿é®æ§æå°å\n   * ç¬¬ 14 æ¡ï¼å¨å¬æç±»ä¸­ä½¿ç¨è®¿é®æ¹æ³èéå¬æå\n   * ç¬¬ 15 æ¡ï¼ä½¿å¯åæ§æå°å\n   * ç¬¬ 16 æ¡ï¼å¤åä¼åäºç»§æ¿\n   * ç¬¬ 17 æ¡ï¼è¦ä¹ä¸ºç»§æ¿èè®¾è®¡ï¼å¹¶æä¾ææ¡£è¯´æï¼è¦ä¹å°±ç¦æ­¢ç»§æ¿\n   * ç¬¬ 18 æ¡ï¼æ¥å£ä¼äºæ½è±¡ç±»\n   * ç¬¬ 19 æ¡ï¼æ¥å£åªç¨äºå®ä¹ç±»å\n   * ç¬¬ 20 æ¡ï¼ç±»å±æ¬¡ä¼äºæ ç­¾ç±»\n   * ç¬¬ 21 æ¡ï¼ç¨å½æ°å¯¹è±¡è¡¨ç¤ºç­ç¥\n   * ç¬¬ 22 æ¡ï¼ä¼åèèéææåç±»\n * ç¬¬ 5 ç«  æ³å\n   * ç¬¬ 23 æ¡ï¼è¯·ä¸è¦å¨æ°ä»£ç ä¸­ä½¿ç¨åçæç±»å\n   * ç¬¬ 24 æ¡ï¼æ¶é¤éåæ£è­¦å\n   * ç¬¬ 25 æ¡ï¼åè¡¨ä¼åäºæ°ç»\n   * ç¬¬ 26 æ¡ï¼ä¼åèèæ³å\n   * ç¬¬ 27 æ¡ï¼ä¼åèèæ³åæ¹æ³\n   * ç¬¬ 28 æ¡ï¼å©ç¨æéå¶ééç¬¦æ¥æå API ççµæ´»æ§\n   * ç¬¬ 29 æ¡ï¼ä¼åèèç±»åå®å¨çå¼æå®¹å¨\n * ç¬¬ 6 ç«  æä¸¾åæ³¨è§£\n   * ç¬¬ 30 æ¡ï¼ç¨ enum ä»£æ¿ int å¸¸é\n   * ç¬¬ 31 æ¡ï¼ç¨å®ä¾åä»£æ¿åºæ°\n   * ç¬¬ 32 æ¡ï¼ç¨ EnumSet ä»£æ¿ä½å\n   * ç¬¬ 33 æ¡ï¼ç¨ EnumMap ä»£æ¿åºæ°ç´¢å¼\n   * ç¬¬ 34 æ¡ï¼ç¨æ¥å£æ¨¡æå¯ä¼¸ç¼©çæä¸¾\n   * ç¬¬ 35 æ¡ï¼æ³¨è§£ä¼åäºå½åæ¨¡å¼\n   * ç¬¬ 36 æ¡ï¼åæä½¿ç¨ Override æ³¨è§£\n   * ç¬¬ 37 æ¡ï¼ç¨æ è®°æ¥å£å®ä¹ç±»å\n * ç¬¬ 7 ç«  æ¹æ³\n   * ç¬¬ 38 æ¡ï¼æ£æ¥åæ°çæææ§\n   * ç¬¬ 39 æ¡ï¼å¿è¦æ¶è¿è¡ä¿æ¤æ§æ·è´\n   * ç¬¬ 40 æ¡ï¼è°¨æè®¾è®¡æ¹æ³ç­¾å\n   * ç¬¬ 41 æ¡ï¼æç¨éè½½\n   * ç¬¬ 42 æ¡ï¼æç¨å¯ååæ°\n   * ç¬¬ 43 æ¡ï¼è¿åé¶é¿åº¦çæ°ç»æèéåï¼èä¸æ¯ï¼null\n   * ç¬¬ 44 æ¡ï¼ä¸ºææå¯¼åºç API åç´ ç¼åææ¡£æ³¨é\n * ç¬¬ 8 ç«  éç¨ç¨åºè®¾è®¡\n   * ç¬¬ 45 æ¡ï¼å°å±é¨åéçä½ç¨åæå°å\n   * ç¬¬ 46 æ¡ï¼for-each å¾ªç¯ä¼åäºä¼ ç»ç for å¾ªç¯\n   * ç¬¬ 47 æ¡ï¼äºè§£åä½¿ç¨ç±»åº\n   * ç¬¬ 48 æ¡ï¼å¦æéè¦ç²¾ç¡®çç­æ¡ï¼è¯·é¿åä½¿ç¨ float å double\n   * ç¬¬ 49 æ¡ï¼åºæ¬ç±»åä¼åäºè£ç®±åºæ¬ç±»å\n   * ç¬¬ 50 æ¡ï¼å¦æå¶ä»ç±»åæ´éåï¼åå°½éé¿åä½¿ç¨å­ç¬¦ä¸²\n   * ç¬¬ 51 æ¡ï¼å½å¿å­ç¬¦ä¸²è¿æ¥çæ§è½\n   * ç¬¬ 52 æ¡ï¼éè¿æ¥å£å¼ç¨å¯¹è±¡\n   * ç¬¬ 53 æ¡ï¼æ¥å£ä¼åäºåå°æºå¶\n   * ç¬¬ 54 æ¡ï¼è°¨æå°ä½¿ç¨æ¬å°æ¹æ³\n   * ç¬¬ 55 æ¡ï¼è°¨æå°è¿è¡ä¼å\n   * ç¬¬ 56 æ¡ï¼éµå®æ®éæ¥åçå½åæ¯ä¾\n * ç¬¬ 9 ç«  å¼å¸¸\n   * ç¬¬ 57 æ¡ï¼åªéå¯¹å¼å¸¸çæåµæä½¿ç¨å¼å¸¸\n   * ç¬¬ 58 æ¡ï¼å¯¹å¯æ¢å¤çæåµä½¿ç¨åæ£å¼å¸¸ï¼å¯¹ç¼ç¨éè¯¯ä½¿ç¨è¿è¡æ¶å¼å¸¸\n   * ç¬¬ 59 æ¡ï¼é¿åä¸å¿è¦å°ä½¿ç¨åæ£çå¼å¸¸\n   * ç¬¬ 60 æ¡ï¼ä¼åä½¿ç¨æ åçå¼å¸¸\n   * ç¬¬ 61 æ¡ï¼æåºä¸æ½è±¡ç¸å¯¹åºçå¼å¸¸\n   * ç¬¬ 62 æ¡ï¼æ¯ä¸ªæ¹æ³æåºçå¼å¸¸é½è¦æææ¡£\n   * ç¬¬ 63 æ¡ï¼å¨ç»èæ¶æ¯ä¸­åå«è½æè·å¤±è´¥çä¿¡æ¯\n   * ç¬¬ 64 æ¡ï¼åªåä½¿å¤±è´¥ä¿æåå­æ§\n   * ç¬¬ 65 æ¡ï¼ä¸è¦å¿½ç¥å¼å¸¸\n * ç¬¬ 10 ç«  å¹¶å\n   * ç¬¬ 66 æ¡ï¼åæ­¥è®¿é®å±äº«çå¯åæ°æ®\n   * ç¬¬ 67 æ¡ï¼é¿åè¿åº¦åæ­¥\n   * ç¬¬ 68 æ¡ï¼executor å task ä¼åå¹²çº¿ç¨\n   * ç¬¬ 69 æ¡ï¼å¹¶åå·¥å·ä¼åäº wait å notify\n   * ç¬¬ 70 æ¡ï¼çº¿ç¨å®å¨æ§çææ¡£å\n   * ç¬¬ 71 æ¡ï¼æç¨å»¶è¿åå§å\n   * ç¬¬ 72 æ¡ï¼ä¸è¦ä¾èµäºçº¿ç¨è°åº¦å¨\n   * ç¬¬ 73 æ¡ï¼é¿åä½¿ç¨çº¿ç¨ç»\n * ç¬¬ 11 ç«  åºåå\n   * ç¬¬ 74 æ¡ï¼è°¨æå°å®ç° Serializable æ¥å£\n   * ç¬¬ 75 æ¡ï¼èèä½¿ç¨èªå®ä¹çåºååå½¢å¼\n   * ç¬¬ 76 æ¡ï¼ä¿æ¤æ§å°ç¼å readObject æ¹æ³\n   * ç¬¬ 77 æ¡ï¼å¯¹äºå®ä¾æ§å¶ï¼æä¸¾ç±»åä¼åäº readResolve\n   * ç¬¬ 78 æ¡ï¼èèç¨åºååä»£çä»£æ¿åºååå®ä¾\n\n\n# èµæº\n\n * Effective Java\n * é¿éå·´å·´ Java å¼åæå\n * Google Java ç¼ç¨æå",normalizedContent:"# java ç¼ç¨è§è\n\n> ç¼ç¨è§èå°±æ¯ java å¼åçæä½³å®è·µãå¸®å©å¼åäººåå°èµ°å¼¯è·¯ã\n\n\n# effective java\n\n * ç¬¬ 2 ç«  åå»ºãéæ¯å¯¹è±¡\n   * ç¬¬ 1 æ¡ï¼èèç¨éæå·¥åæ¹æ³ä»£æ¿æé å¨\n   * ç¬¬ 2 æ¡ï¼éå°å¤ä¸ªæé å¨åæ°æ¶è¦èèç¨æå»ºå¨\n   * ç¬¬ 3 æ¡ï¼ç¨ç§ææé å¨æèæä¸¾ç±»åå¼ºå singleton å±æ§\n   * ç¬¬ 4 æ¡ï¼éè¿ç§ææé å¨å¼ºåä¸å¯å®ä¾åçè½å\n   * ç¬¬ 5 æ¡ï¼é¿ååå»ºä¸å¿è¦çå¯¹è±¡\n   * ç¬¬ 6 æ¡ï¼æ¶é¤è¿æçå¯¹è±¡å¼ç¨\n   * ç¬¬ 7 æ¡ï¼é¿åä½¿ç¨ç»ç»æ¹æ³\n * ç¬¬ 3 ç«  å¯¹äºææå¯¹è±¡é½éç¨çæ¹æ³\n   * ç¬¬ 8 æ¡ï¼è¦ç equals æ¶è¯·éµå®éç¨çº¦å®\n   * ç¬¬ 9 æ¡ï¼è¦ç equals æ¶æ»è¦è¦ç hashcode\n   * ç¬¬ 10 æ¡ï¼å§ç»è¦è¦ç tostring\n   * ç¬¬ 11 æ¡ï¼è°¨æå°è¦ç clone\n   * ç¬¬ 12 æ¡ï¼èèå®ç° comparable æ¥å£\n * ç¬¬ 4 ç«  ç±»åæ¥å£\n   * ç¬¬ 13 æ¡ï¼ä½¿ç±»åæåçå¯è®¿é®æ§æå°å\n   * ç¬¬ 14 æ¡ï¼å¨å¬æç±»ä¸­ä½¿ç¨è®¿é®æ¹æ³èéå¬æå\n   * ç¬¬ 15 æ¡ï¼ä½¿å¯åæ§æå°å\n   * ç¬¬ 16 æ¡ï¼å¤åä¼åäºç»§æ¿\n   * ç¬¬ 17 æ¡ï¼è¦ä¹ä¸ºç»§æ¿èè®¾è®¡ï¼å¹¶æä¾ææ¡£è¯´æï¼è¦ä¹å°±ç¦æ­¢ç»§æ¿\n   * ç¬¬ 18 æ¡ï¼æ¥å£ä¼äºæ½è±¡ç±»\n   * ç¬¬ 19 æ¡ï¼æ¥å£åªç¨äºå®ä¹ç±»å\n   * ç¬¬ 20 æ¡ï¼ç±»å±æ¬¡ä¼äºæ ç­¾ç±»\n   * ç¬¬ 21 æ¡ï¼ç¨å½æ°å¯¹è±¡è¡¨ç¤ºç­ç¥\n   * ç¬¬ 22 æ¡ï¼ä¼åèèéææåç±»\n * ç¬¬ 5 ç«  æ³å\n   * ç¬¬ 23 æ¡ï¼è¯·ä¸è¦å¨æ°ä»£ç ä¸­ä½¿ç¨åçæç±»å\n   * ç¬¬ 24 æ¡ï¼æ¶é¤éåæ£è­¦å\n   * ç¬¬ 25 æ¡ï¼åè¡¨ä¼åäºæ°ç»\n   * ç¬¬ 26 æ¡ï¼ä¼åèèæ³å\n   * ç¬¬ 27 æ¡ï¼ä¼åèèæ³åæ¹æ³\n   * ç¬¬ 28 æ¡ï¼å©ç¨æéå¶ééç¬¦æ¥æå api ççµæ´»æ§\n   * ç¬¬ 29 æ¡ï¼ä¼åèèç±»åå®å¨çå¼æå®¹å¨\n * ç¬¬ 6 ç«  æä¸¾åæ³¨è§£\n   * ç¬¬ 30 æ¡ï¼ç¨ enum ä»£æ¿ int å¸¸é\n   * ç¬¬ 31 æ¡ï¼ç¨å®ä¾åä»£æ¿åºæ°\n   * ç¬¬ 32 æ¡ï¼ç¨ enumset ä»£æ¿ä½å\n   * ç¬¬ 33 æ¡ï¼ç¨ enummap ä»£æ¿åºæ°ç´¢å¼\n   * ç¬¬ 34 æ¡ï¼ç¨æ¥å£æ¨¡æå¯ä¼¸ç¼©çæä¸¾\n   * ç¬¬ 35 æ¡ï¼æ³¨è§£ä¼åäºå½åæ¨¡å¼\n   * ç¬¬ 36 æ¡ï¼åæä½¿ç¨ override æ³¨è§£\n   * ç¬¬ 37 æ¡ï¼ç¨æ è®°æ¥å£å®ä¹ç±»å\n * ç¬¬ 7 ç«  æ¹æ³\n   * ç¬¬ 38 æ¡ï¼æ£æ¥åæ°çæææ§\n   * ç¬¬ 39 æ¡ï¼å¿è¦æ¶è¿è¡ä¿æ¤æ§æ·è´\n   * ç¬¬ 40 æ¡ï¼è°¨æè®¾è®¡æ¹æ³ç­¾å\n   * ç¬¬ 41 æ¡ï¼æç¨éè½½\n   * ç¬¬ 42 æ¡ï¼æç¨å¯ååæ°\n   * ç¬¬ 43 æ¡ï¼è¿åé¶é¿åº¦çæ°ç»æèéåï¼èä¸æ¯ï¼null\n   * ç¬¬ 44 æ¡ï¼ä¸ºææå¯¼åºç api åç´ ç¼åææ¡£æ³¨é\n * ç¬¬ 8 ç«  éç¨ç¨åºè®¾è®¡\n   * ç¬¬ 45 æ¡ï¼å°å±é¨åéçä½ç¨åæå°å\n   * ç¬¬ 46 æ¡ï¼for-each å¾ªç¯ä¼åäºä¼ ç»ç for å¾ªç¯\n   * ç¬¬ 47 æ¡ï¼äºè§£åä½¿ç¨ç±»åº\n   * ç¬¬ 48 æ¡ï¼å¦æéè¦ç²¾ç¡®çç­æ¡ï¼è¯·é¿åä½¿ç¨ float å double\n   * ç¬¬ 49 æ¡ï¼åºæ¬ç±»åä¼åäºè£ç®±åºæ¬ç±»å\n   * ç¬¬ 50 æ¡ï¼å¦æå¶ä»ç±»åæ´éåï¼åå°½éé¿åä½¿ç¨å­ç¬¦ä¸²\n   * ç¬¬ 51 æ¡ï¼å½å¿å­ç¬¦ä¸²è¿æ¥çæ§è½\n   * ç¬¬ 52 æ¡ï¼éè¿æ¥å£å¼ç¨å¯¹è±¡\n   * ç¬¬ 53 æ¡ï¼æ¥å£ä¼åäºåå°æºå¶\n   * ç¬¬ 54 æ¡ï¼è°¨æå°ä½¿ç¨æ¬å°æ¹æ³\n   * ç¬¬ 55 æ¡ï¼è°¨æå°è¿è¡ä¼å\n   * ç¬¬ 56 æ¡ï¼éµå®æ®éæ¥åçå½åæ¯ä¾\n * ç¬¬ 9 ç«  å¼å¸¸\n   * ç¬¬ 57 æ¡ï¼åªéå¯¹å¼å¸¸çæåµæä½¿ç¨å¼å¸¸\n   * ç¬¬ 58 æ¡ï¼å¯¹å¯æ¢å¤çæåµä½¿ç¨åæ£å¼å¸¸ï¼å¯¹ç¼ç¨éè¯¯ä½¿ç¨è¿è¡æ¶å¼å¸¸\n   * ç¬¬ 59 æ¡ï¼é¿åä¸å¿è¦å°ä½¿ç¨åæ£çå¼å¸¸\n   * ç¬¬ 60 æ¡ï¼ä¼åä½¿ç¨æ åçå¼å¸¸\n   * ç¬¬ 61 æ¡ï¼æåºä¸æ½è±¡ç¸å¯¹åºçå¼å¸¸\n   * ç¬¬ 62 æ¡ï¼æ¯ä¸ªæ¹æ³æåºçå¼å¸¸é½è¦æææ¡£\n   * ç¬¬ 63 æ¡ï¼å¨ç»èæ¶æ¯ä¸­åå«è½æè·å¤±è´¥çä¿¡æ¯\n   * ç¬¬ 64 æ¡ï¼åªåä½¿å¤±è´¥ä¿æåå­æ§\n   * ç¬¬ 65 æ¡ï¼ä¸è¦å¿½ç¥å¼å¸¸\n * ç¬¬ 10 ç«  å¹¶å\n   * ç¬¬ 66 æ¡ï¼åæ­¥è®¿é®å±äº«çå¯åæ°æ®\n   * ç¬¬ 67 æ¡ï¼é¿åè¿åº¦åæ­¥\n   * ç¬¬ 68 æ¡ï¼executor å task ä¼åå¹²çº¿ç¨\n   * ç¬¬ 69 æ¡ï¼å¹¶åå·¥å·ä¼åäº wait å notify\n   * ç¬¬ 70 æ¡ï¼çº¿ç¨å®å¨æ§çææ¡£å\n   * ç¬¬ 71 æ¡ï¼æç¨å»¶è¿åå§å\n   * ç¬¬ 72 æ¡ï¼ä¸è¦ä¾èµäºçº¿ç¨è°åº¦å¨\n   * ç¬¬ 73 æ¡ï¼é¿åä½¿ç¨çº¿ç¨ç»\n * ç¬¬ 11 ç«  åºåå\n   * ç¬¬ 74 æ¡ï¼è°¨æå°å®ç° serializable æ¥å£\n   * ç¬¬ 75 æ¡ï¼èèä½¿ç¨èªå®ä¹çåºååå½¢å¼\n   * ç¬¬ 76 æ¡ï¼ä¿æ¤æ§å°ç¼å readobject æ¹æ³\n   * ç¬¬ 77 æ¡ï¼å¯¹äºå®ä¾æ§å¶ï¼æä¸¾ç±»åä¼åäº readresolve\n   * ç¬¬ 78 æ¡ï¼èèç¨åºååä»£çä»£æ¿åºååå®ä¾\n\n\n# èµæº\n\n * effective java\n * é¿éå·´å·´ java å¼åæå\n * google java ç¼ç¨æå",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æºç çº§æ·±åº¦çè§£ Java SPI",frontmatter:{title:"æºç çº§æ·±åº¦çè§£ Java SPI",date:"2022-04-26T19:11:59.000Z",categories:["Java","JavaSE","é«çº§ç¹æ§"],tags:["Java","JavaSE","SPI","Dubbo","Spring Boot","common-logging","JDBC"],permalink:"/pages/496a7e/"},regularPath:"/01.Java/01.JavaSE/02.%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/05.JavaSPI.html",relativePath:"01.Java/01.JavaSE/02.é«çº§ç¹æ§/05.JavaSPI.md",key:"v-61ba4cc8",path:"/pages/496a7e/",headers:[{level:2,title:"SPI ç®ä»",slug:"spi-ç®ä»",normalizedTitle:"spi ç®ä»",charIndex:23},{level:2,title:"SPI ç¤ºä¾",slug:"spi-ç¤ºä¾",normalizedTitle:"spi ç¤ºä¾",charIndex:472},{level:3,title:"SPI æ¥å£",slug:"spi-æ¥å£",normalizedTitle:"spi æ¥å£",charIndex:190},{level:3,title:"SPI å®ç°ç±»",slug:"spi-å®ç°ç±»",normalizedTitle:"spi å®ç°ç±»",charIndex:221},{level:3,title:"SPI éç½®",slug:"spi-éç½®",normalizedTitle:"spi éç½®",charIndex:244},{level:3,title:"ServiceLoader",slug:"serviceloader",normalizedTitle:"serviceloader",charIndex:383},{level:2,title:"SPI åç",slug:"spi-åç",normalizedTitle:"spi åç",charIndex:2045},{level:3,title:"ServiceLoader çæååé",slug:"serviceloader-çæååé",normalizedTitle:"serviceloader çæååé",charIndex:2295},{level:3,title:"ServiceLoader çå·¥ä½æµç¨",slug:"serviceloader-çå·¥ä½æµç¨",normalizedTitle:"serviceloader çå·¥ä½æµç¨",charIndex:2192},{level:3,title:"SPI åç±»å è½½å¨",slug:"spi-åç±»å è½½å¨",normalizedTitle:"spi åç±»å è½½å¨",charIndex:6649},{level:3,title:"Java SPI çä¸è¶³",slug:"java-spi-çä¸è¶³",normalizedTitle:"java spi çä¸è¶³",charIndex:8070},{level:2,title:"SPI åºç¨åºæ¯",slug:"spi-åºç¨åºæ¯",normalizedTitle:"spi åºç¨åºæ¯",charIndex:8288},{level:3,title:"SPI åºç¨æ¡ä¾ä¹ JDBC DriverManager",slug:"spi-åºç¨æ¡ä¾ä¹-jdbc-drivermanager",normalizedTitle:"spi åºç¨æ¡ä¾ä¹ jdbc drivermanager",charIndex:8682},{level:4,title:"åå»ºæ°æ®åºè¿æ¥",slug:"åå»ºæ°æ®åºè¿æ¥",normalizedTitle:"åå»ºæ°æ®åºè¿æ¥",charIndex:8818},{level:4,title:"DriverManager",slug:"drivermanager",normalizedTitle:"drivermanager",charIndex:8697},{level:3,title:"SPI åºç¨æ¡ä¾ä¹ Common-Logging",slug:"spi-åºç¨æ¡ä¾ä¹-common-logging",normalizedTitle:"spi åºç¨æ¡ä¾ä¹ common-logging",charIndex:11609},{level:3,title:"SPI åºç¨æ¡ä¾ä¹ Spring Boot",slug:"spi-åºç¨æ¡ä¾ä¹-spring-boot",normalizedTitle:"spi åºç¨æ¡ä¾ä¹ spring boot",charIndex:17516},{level:4,title:"@SpringBootApplication æ³¨è§£",slug:"springbootapplication-æ³¨è§£",normalizedTitle:"@springbootapplication æ³¨è§£",charIndex:18408},{level:4,title:"@SpringBootConfiguration æ³¨è§£",slug:"springbootconfiguration-æ³¨è§£",normalizedTitle:"@springbootconfiguration æ³¨è§£",charIndex:19091},{level:4,title:"@EnableAutoConfiguration æ³¨è§£",slug:"enableautoconfiguration-æ³¨è§£",normalizedTitle:"@enableautoconfiguration æ³¨è§£",charIndex:19517},{level:4,title:"@AutoConfigurationPackage æ³¨è§£",slug:"autoconfigurationpackage-æ³¨è§£",normalizedTitle:"@autoconfigurationpackage æ³¨è§£",charIndex:20063},{level:4,title:"SpringFactoriesLoader.loadFactoryNames æ¹æ³",slug:"springfactoriesloader-loadfactorynames-æ¹æ³",normalizedTitle:"springfactoriesloader.loadfactorynames æ¹æ³",charIndex:20468},{level:4,title:"Spring Boot ç AutoConfiguration ç±»",slug:"spring-boot-ç-autoconfiguration-ç±»",normalizedTitle:"spring boot ç autoconfiguration ç±»",charIndex:22780},{level:2,title:"SPI åºç¨æ¡ä¾ä¹ Dubbo",slug:"spi-åºç¨æ¡ä¾ä¹-dubbo",normalizedTitle:"spi åºç¨æ¡ä¾ä¹ dubbo",charIndex:23668},{level:4,title:"ExtensionLoader å¥å£",slug:"extensionloader-å¥å£",normalizedTitle:"extensionloader å¥å£",charIndex:23963},{level:4,title:"è·åææçæå±ç±»",slug:"è·åææçæå±ç±»",normalizedTitle:"è·åææçæå±ç±»",charIndex:26266},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:33368}],headersStr:"SPI ç®ä» SPI ç¤ºä¾ SPI æ¥å£ SPI å®ç°ç±» SPI éç½® ServiceLoader SPI åç ServiceLoader çæååé ServiceLoader çå·¥ä½æµç¨ SPI åç±»å è½½å¨ Java SPI çä¸è¶³ SPI åºç¨åºæ¯ SPI åºç¨æ¡ä¾ä¹ JDBC DriverManager åå»ºæ°æ®åºè¿æ¥ DriverManager SPI åºç¨æ¡ä¾ä¹ Common-Logging SPI åºç¨æ¡ä¾ä¹ Spring Boot @SpringBootApplication æ³¨è§£ @SpringBootConfiguration æ³¨è§£ @EnableAutoConfiguration æ³¨è§£ @AutoConfigurationPackage æ³¨è§£ SpringFactoriesLoader.loadFactoryNames æ¹æ³ Spring Boot ç AutoConfiguration ç±» SPI åºç¨æ¡ä¾ä¹ Dubbo ExtensionLoader å¥å£ è·åææçæå±ç±» åèèµæ",content:'# æºç çº§æ·±åº¦çè§£ Java SPI\n\n\n# SPI ç®ä»\n\nSPI å¨ç§° Service Provider Interfaceï¼æ¯ Java æä¾çï¼æ¨å¨ç±ç¬¬ä¸æ¹å®ç°ææ©å±ç APIï¼å®æ¯ä¸ç§ç¨äºå¨æå è½½æå¡çæºå¶ãJava ä¸­ SPI æºå¶ä¸»è¦ææ³æ¯å°è£éçæ§å¶æç§»å°ç¨åºä¹å¤ï¼å¨æ¨¡ååè®¾è®¡ä¸­è¿ä¸ªæºå¶å°¤å¶éè¦ï¼å¶æ ¸å¿ææ³å°±æ¯ è§£è¦ã\n\nJava SPI æåä¸ªè¦ç´ ï¼\n\n * SPI æ¥å£ï¼ä¸ºæå¡æä¾èå®ç°ç±»çº¦å®ççæ¥å£ææ½è±¡ç±»ã\n * SPI å®ç°ç±»ï¼å®éæä¾æå¡çå®ç°ç±»ã\n * SPI éç½®ï¼Java SPI æºå¶çº¦å®çéç½®æä»¶ï¼æä¾æ¥æ¾æå¡å®ç°ç±»çé»è¾ãéç½®æä»¶å¿é¡»ç½®äº META-INF/services ç®å½ä¸­ï¼å¹¶ä¸ï¼æä»¶ååºä¸æå¡æä¾èæ¥å£çå®å¨éå®åä¿æä¸è´ãæä»¶ä¸­çæ¯ä¸è¡é½æä¸ä¸ªå®ç°æå¡ç±»çè¯¦ç»ä¿¡æ¯ï¼åæ ·æ¯æå¡æä¾èç±»çå®å¨éå®åç§°ã\n * ServiceLoaderï¼Java SPI çæ ¸å¿ç±»ï¼ç¨äºå è½½ SPI å®ç°ç±»ã ServiceLoader ä¸­æåç§å®ç¨æ¹æ³æ¥è·åç¹å®å®ç°ãè¿­ä»£å®ä»¬æéæ°å è½½æå¡ã\n\n\n# SPI ç¤ºä¾\n\næ­£æè°ï¼å®è·µåºçç¥ï¼æä»¬ä¸å¦¨éè¿ä¸ä¸ªå·ä½çç¤ºä¾æ¥çä¸ä¸ï¼å¦ä½ä½¿ç¨ Java SPIã\n\n\n# SPI æ¥å£\n\né¦åï¼éè¦å®ä¹ä¸ä¸ª SPI æ¥å£ï¼åæ®éæ¥å£å¹¶æ²¡æä»ä¹å·®å«ã\n\npackage io.github.dunwu.javacore.spi;\n\npublic interface DataStorage {\n    String search(String key);\n}\n\n\n\n# SPI å®ç°ç±»\n\nåè®¾ï¼æä»¬éè¦å¨ç¨åºä¸­ä½¿ç¨ä¸¤ç§ä¸åçæ°æ®å­å¨ââMysql å Redisãå æ­¤ï¼æä»¬éè¦ä¸¤ä¸ªä¸åçå®ç°ç±»å»åå«å®æç¸åºå·¥ä½ã\n\nMysql æ¥è¯¢ MOCK ç±»\n\npackage io.github.dunwu.javacore.spi;\n\npublic class MysqlStorage implements DataStorage {\n    @Override\n    public String search(String key) {\n        return "ãMysqlãæç´¢" + key + "ï¼ç»æï¼No";\n    }\n}\n\n\nRedis æ¥è¯¢ MOCK ç±»\n\npackage io.github.dunwu.javacore.spi;\n\npublic class RedisStorage implements DataStorage {\n    @Override\n    public String search(String key) {\n        return "ãRedisãæç´¢" + key + "ï¼ç»æï¼Yes";\n    }\n}\n\n\nå°ç®åä¸ºæ­¢ï¼å®ä¹æ¥å£ï¼å¹¶å®ç°æ¥å£åæ®éç Java æ¥å£å®ç°æ²¡æä»»ä½ä¸åã\n\n\n# SPI éç½®\n\nå¦ææ³éè¿ Java SPI æºå¶æ¥åç°æå¡ï¼å°±éè¦å¨ SPI éç½®ä¸­çº¦å®å¥½åç°æå¡çé»è¾ãéç½®æä»¶å¿é¡»ç½®äº META-INF/services ç®å½ä¸­ï¼å¹¶ä¸ï¼æä»¶ååºä¸æå¡æä¾èæ¥å£çå®å¨éå®åä¿æä¸è´ãæä»¶ä¸­çæ¯ä¸è¡é½æä¸ä¸ªå®ç°æå¡ç±»çè¯¦ç»ä¿¡æ¯ï¼åæ ·æ¯æå¡æä¾èç±»çå®å¨éå®åç§°ãä»¥æ¬ç¤ºä¾ä»£ç ä¸ºä¾ï¼å¶æä»¶ååºè¯¥ä¸º io.github.dunwu.javacore.spi.DataStorageï¼æä»¶ä¸­çåå®¹å¦ä¸ï¼\n\nio.github.dunwu.javacore.spi.MysqlStorage\nio.github.dunwu.javacore.spi.RedisStorage\n\n\n\n# ServiceLoader\n\nå®æäºä¸é¢çæ­¥éª¤ï¼å°±å¯ä»¥éè¿ ServiceLoader æ¥å è½½æå¡ãç¤ºä¾å¦ä¸ï¼\n\nimport java.util.ServiceLoader;\n\npublic class SpiDemo {\n\n    public static void main(String[] args) {\n        ServiceLoader<DataStorage> serviceLoader = ServiceLoader.load(DataStorage.class);\n        System.out.println("============ Java SPI æµè¯============");\n        serviceLoader.forEach(loader -> System.out.println(loader.search("Yes Or No")));\n    }\n\n}\n\n\nè¾åºï¼\n\n============ Java SPI æµè¯============\nãMysqlãæç´¢Yes Or Noï¼ç»æï¼No\nãRedisãæç´¢Yes Or Noï¼ç»æï¼Yes\n\n\n\n# SPI åç\n\nä¸æä¸­ï¼æä»¬å·²ç»äºè§£ Java SPI çè¦ç´ ä»¥åä½¿ç¨ Java SPI çæ¹æ³ãä½ ææ²¡ææ³è¿ï¼Java SPI åæ®é Java æ¥å£æä½ä¸åï¼Java SPI æ¯å¦ä½å·¥ä½çãå®éä¸ï¼Java SPI æºå¶ä¾èµäº ServiceLoader ç±»å»è§£æãå è½½æå¡ãå æ­¤ï¼ææ¡äº ServiceLoader çå·¥ä½æµç¨ï¼å°±ææ¡äº SPI çåçãServiceLoader çä»£ç æ¬èº«å¾ç²¾ç»ï¼æ¥ä¸æ¥ï¼è®©æä»¬éè¿èµ°è¯»æºç çæ¹å¼ï¼éä¸çè§£ ServiceLoader çå·¥ä½æµç¨ã\n\n\n# ServiceLoader çæååé\n\nåçä¸ä¸ ServiceLoader ç±»çæååéï¼å¤§è´æä¸ªå°è±¡ï¼åé¢çæºç ä¸­é½ä¼ä½¿ç¨å°ã\n\npublic final class ServiceLoader<S> implements Iterable<S> {\n\n    // SPI éç½®æä»¶ç®å½\n    private static final String PREFIX = "META-INF/services/";\n\n    // å°è¦è¢«å è½½ç SPI æå¡\n    private final Class<S> service;\n\n    // ç¨äºå è½½ SPI æå¡çç±»å è½½å¨\n    private final ClassLoader loader;\n\n    // ServiceLoader åå»ºæ¶çè®¿é®æ§å¶ä¸ä¸æ\n    private final AccessControlContext acc;\n\n    // SPI æå¡ç¼å­ï¼æå®ä¾åçé¡ºåºæå\n    private LinkedHashMap<String,S> providers = new LinkedHashMap<>();\n\n    // ææ¥è¯¢è¿­ä»£å¨\n    private LazyIterator lookupIterator;\n\n    // ...\n}\n\n\n\n# ServiceLoader çå·¥ä½æµç¨\n\nï¼1ï¼ServiceLoader.load éææ¹æ³\n\nåºç¨ç¨åºå è½½ Java SPI æå¡ï¼é½æ¯åè°ç¨ ServiceLoader.load éææ¹æ³ãServiceLoader.load éææ¹æ³çä½ç¨æ¯ï¼\n\n 1. æå®ç±»å è½½ ClassLoader åè®¿é®æ§å¶ä¸ä¸æï¼\n 2. ç¶åï¼éæ°å è½½ SPI æå¡\n    1. æ¸ç©ºç¼å­ä¸­ææå·²å®ä¾åç SPI æå¡\n    2. æ ¹æ® ClassLoader å SPI ç±»åï¼åå»ºæå è½½è¿­ä»£å¨\n\nè¿éï¼æå½ ServiceLoader.load ç¸å³æºç ï¼å¦ä¸ï¼\n\n// service ä¼ å¥çæ¯ææå è½½ç SPI æ¥å£ç±»å\n// loader æ¯ç¨äºå è½½ SPI æå¡çç±»å è½½å¨\npublic static <S> ServiceLoader<S> load(Class<S> service,\n\t\t\t\t\t\t\t\t\t\tClassLoader loader)\n{\n\treturn new ServiceLoader<>(service, loader);\n}\n\npublic void reload() {\n    // æ¸ç©ºç¼å­ä¸­ææå·²å®ä¾åç SPI æå¡\n\tproviders.clear();\n    // æ ¹æ® ClassLoader å SPI ç±»åï¼åå»ºæå è½½è¿­ä»£å¨\n\tlookupIterator = new LazyIterator(service, loader);\n}\n\n// ç§ææé æ¹æ³\n// éæ°å è½½ SPI æå¡\nprivate ServiceLoader(Class<S> svc, ClassLoader cl) {\n\tservice = Objects.requireNonNull(svc, "Service interface cannot be null");\n    // æå®ç±»å è½½ ClassLoader åè®¿é®æ§å¶ä¸ä¸æ\n\tloader = (cl == null) ? ClassLoader.getSystemClassLoader() : cl;\n\tacc = (System.getSecurityManager() != null) ? AccessController.getContext() : null;\n    // ç¶åï¼éæ°å è½½ SPI æå¡\n\treload();\n}\n\n\nï¼2ï¼åºç¨ç¨åºéè¿ ServiceLoader ç iterator æ¹æ³éå SPI å®ä¾\n\nServiceLoader çç±»å®ä¹ï¼æç¡®äº ServiceLoader ç±»å®ç°äº Iterable<T> æ¥å£ï¼æä»¥ï¼å®æ¯å¯ä»¥è¿­ä»£éåçãå®éä¸ï¼ServiceLoader ç±»ç»´æ¤äºä¸ä¸ªç¼å­ providersï¼ LinkedHashMap å¯¹è±¡ï¼ï¼ç¼å­ providers ä¸­ä¿å­äºå·²ç»è¢«æåå è½½ç SPI å®ä¾ï¼è¿ä¸ª Map ç key æ¯ SPI æ¥å£å®ç°ç±»çå¨éå®åï¼value æ¯è¯¥å®ç°ç±»çä¸ä¸ªå®ä¾å¯¹è±¡ã\n\nå½åºç¨ç¨åºè°ç¨ ServiceLoader ç iterator æ¹æ³æ¶ï¼ServiceLoader ä¼åå¤æ­ç¼å­ providers ä¸­æ¯å¦ææ°æ®ï¼å¦ææï¼åç´æ¥è¿åç¼å­ providers çè¿­ä»£å¨ï¼å¦ææ²¡æï¼åè¿åæå è½½è¿­ä»£å¨çè¿­ä»£å¨ã\n\npublic Iterator<S> iterator() {\n\treturn new Iterator<S>() {\n\n        // ç¼å­ SPI providers\n\t\tIterator<Map.Entry<String,S>> knownProviders\n\t\t\t= providers.entrySet().iterator();\n\n        // lookupIterator æ¯ LazyIterator å®ä¾ï¼ç¨äºæå è½½ SPI å®ä¾\n\t\tpublic boolean hasNext() {\n\t\t\tif (knownProviders.hasNext())\n\t\t\t\treturn true;\n\t\t\treturn lookupIterator.hasNext();\n\t\t}\n\n\t\tpublic S next() {\n\t\t\tif (knownProviders.hasNext())\n\t\t\t\treturn knownProviders.next().getValue();\n\t\t\treturn lookupIterator.next();\n\t\t}\n\n\t\tpublic void remove() {\n\t\t\tthrow new UnsupportedOperationException();\n\t\t}\n\n\t};\n}\n\n\nï¼3ï¼æå è½½è¿­ä»£å¨çå·¥ä½æµç¨\n\nä¸é¢çæºç ä¸­æå°äºï¼lookupIterator æ¯ LazyIterator å®ä¾ï¼è LazyIterator ç¨äºæå è½½ SPI å®ä¾ãé£ä¹ï¼ LazyIterator æ¯å¦ä½å·¥ä½çå¢ï¼\n\nè¿éï¼æå LazyIterator å³é®ä»£ç \n\n * hasNextService æ¹æ³ï¼\n   1. æ¼æ¥ META-INF/services/ + SPI æ¥å£å¨éå®å\n   2. éè¿ç±»å è½½å¨ï¼å°è¯å è½½èµæºæä»¶\n   3. è§£æèµæºæä»¶ä¸­çåå®¹ï¼è·å SPI æ¥å£çå®ç°ç±»çå¨éå®å nextName\n * nextService æ¹æ³ï¼\n   1. hasNextService() æ¹æ³è§£æåºäº SPI å®ç°ç±»ççå¨éå®å nextNameï¼éè¿åå°ï¼è·å SPI å®ç°ç±»çç±»å®ä¹ Class<?>ã\n   2. ç¶åï¼å°è¯éè¿ Class<?> ç newInstance æ¹æ³å®ä¾åä¸ä¸ª SPI æå¡å¯¹è±¡ãå¦ææåï¼åå°è¿ä¸ªå¯¹è±¡å å¥å°ç¼å­ providers ä¸­å¹¶è¿åè¯¥å¯¹è±¡ã\n\nprivate boolean hasNextService() {\n\tif (nextName != null) {\n\t\treturn true;\n\t}\n\tif (configs == null) {\n\t\ttry {\n            // 1.æ¼æ¥ META-INF/services/ + SPI æ¥å£å¨éå®å\n            // 2.éè¿ç±»å è½½å¨ï¼å°è¯å è½½èµæºæä»¶\n            // 3.è§£æèµæºæä»¶ä¸­çåå®¹\n\t\t\tString fullName = PREFIX + service.getName();\n\t\t\tif (loader == null)\n\t\t\t\tconfigs = ClassLoader.getSystemResources(fullName);\n\t\t\telse\n\t\t\t\tconfigs = loader.getResources(fullName);\n\t\t} catch (IOException x) {\n\t\t\tfail(service, "Error locating configuration files", x);\n\t\t}\n\t}\n\twhile ((pending == null) || !pending.hasNext()) {\n\t\tif (!configs.hasMoreElements()) {\n\t\t\treturn false;\n\t\t}\n\t\tpending = parse(service, configs.nextElement());\n\t}\n\tnextName = pending.next();\n\treturn true;\n}\n\nprivate S nextService() {\n\tif (!hasNextService())\n\t\tthrow new NoSuchElementException();\n\tString cn = nextName;\n\tnextName = null;\n\tClass<?> c = null;\n\ttry {\n\t\tc = Class.forName(cn, false, loader);\n\t} catch (ClassNotFoundException x) {\n\t\tfail(service,\n\t\t\t "Provider " + cn + " not found");\n\t}\n\tif (!service.isAssignableFrom(c)) {\n\t\tfail(service,\n\t\t\t "Provider " + cn  + " not a s");\n\t}\n\ttry {\n\t\tS p = service.cast(c.newInstance());\n\t\tproviders.put(cn, p);\n\t\treturn p;\n\t} catch (Throwable x) {\n\t\tfail(service,\n\t\t\t "Provider " + cn + " could not be instantiated",\n\t\t\t x);\n\t}\n\tthrow new Error();          // This cannot happen\n}\n\n\n\n# SPI åç±»å è½½å¨\n\néè¿ä¸é¢ä¸¤ä¸ªç« èä¸­ï¼èµ°è¯» ServiceLoader ä»£ç ï¼æä»¬å·²ç»å¤§è´äºè§£ Java SPI çå·¥ä½åçï¼å³éè¿ ClassLoader å è½½ SPI éç½®æä»¶ï¼è§£æ SPI æå¡ï¼ç¶åéè¿åå°ï¼å®ä¾å SPI æå¡å®ä¾ãæä»¬ä¸å¦¨æèä¸ä¸ï¼ä¸ºä»ä¹å è½½ SPI æå¡æ¶ï¼éè¦æå®ç±»å è½½å¨ ClassLoader å¢ï¼\n\nå­¦ä¹ è¿ JVM çè¯»èï¼æ³å¿é½äºè§£è¿ç±»å è½½å¨çåäº²å§æ´¾æ¨¡åï¼Parents Delegation Modelï¼ãåäº²å§æ´¾æ¨¡åè¦æ±é¤äºé¡¶å±ç BootstrapClassLoader å¤ï¼å¶ä½çç±»å è½½å¨é½åºæèªå·±çç¶ç±»å è½½å¨ãè¿éç±»å è½½å¨ä¹é´çç¶å­å³ç³»ä¸è¬éè¿ç»åï¼Compositionï¼å³ç³»æ¥å®ç°ï¼èä¸æ¯éè¿ç»§æ¿ï¼Inheritanceï¼çå³ç³»å®ç°ãåäº²å§æ´¾ç»§æ¿ä½ç³»å¾å¦ä¸ï¼\n\nåäº²å§æ´¾æºå¶çº¦å®äºï¼ä¸ä¸ªç±»å è½½å¨é¦åå°ç±»å è½½è¯·æ±ä¼ éå°ç¶ç±»å è½½å¨ï¼åªæå½ç¶ç±»å è½½å¨æ æ³å®æç±»å è½½è¯·æ±æ¶æå°è¯å è½½ã\n\nåäº²å§æ´¾çå¥½å¤ï¼ä½¿å¾ Java ç±»ä¼´éçå®çç±»å è½½å¨ï¼å¤©ç¶å·å¤ä¸ç§å¸¦æä¼åçº§çå±æ¬¡å³ç³»ï¼ä»èä½¿å¾ç±»å è½½å¾å°ç»ä¸ï¼ä¸ä¼åºç°éå¤å è½½çé®é¢ï¼\n\n * ç³»ç»ç±»é²æ­¢åå­ä¸­åºç°å¤ä»½åæ ·çå­èç \n * ä¿è¯ Java ç¨åºå®å¨ç¨³å®è¿è¡\n\nä¾å¦ï¼ java.lang.Object å­æ¾å¨ rt.jar ä¸­ï¼å¦æç¼åå¦å¤ä¸ä¸ª java.lang.Object çç±»å¹¶æ¾å° classpath ä¸­ï¼ç¨åºå¯ä»¥ç¼è¯éè¿ãå ä¸ºåäº²å§æ´¾æ¨¡åçå­å¨ï¼æä»¥å¨ rt.jar ä¸­ç Object æ¯å¨ classpath ä¸­ç Object ä¼åçº§æ´é«ï¼å ä¸º rt.jar ä¸­ç Object ä½¿ç¨çæ¯å¯å¨ç±»å è½½å¨ï¼è classpath ä¸­ç Object ä½¿ç¨çæ¯åºç¨ç¨åºç±»å è½½å¨ãæ­£å ä¸º rt.jar ä¸­ç Object ä¼åçº§æ´é«ï¼å ä¸ºç¨åºä¸­ææç Object é½æ¯è¿ä¸ª Objectã\n\nåäº²å§æ´¾çéå¶ï¼å­ç±»å è½½å¨å¯ä»¥ä½¿ç¨ç¶ç±»å è½½å¨å·²ç»å è½½çç±»ï¼èç¶ç±»å è½½å¨æ æ³ä½¿ç¨å­ç±»å è½½å¨å·²ç»å è½½çãââè¿å°±å¯¼è´äºåäº²å§æ´¾æ¨¡åå¹¶ä¸è½è§£å³ææçç±»å è½½å¨é®é¢ãJava SPI å°±é¢ä¸´çè¿æ ·çé®é¢ï¼\n\n * SPI çæ¥å£æ¯ Java æ ¸å¿åºçä¸é¨åï¼æ¯ç± BootstrapClassLoader å è½½çï¼\n * è SPI å®ç°ç Java ç±»ä¸è¬æ¯ç± AppClassLoader æ¥å è½½çãBootstrapClassLoader æ¯æ æ³æ¾å° SPI çå®ç°ç±»çï¼å ä¸ºå®åªå è½½ Java çæ ¸å¿åºãå®ä¹ä¸è½ä»£çç» AppClassLoaderï¼å ä¸ºå®æ¯æé¡¶å±çç±»å è½½å¨ãè¿ä¹è§£éäºæ¬èå¼å§çé®é¢ââä¸ºä»ä¹å è½½ SPI æå¡æ¶ï¼éè¦æå®ç±»å è½½å¨ ClassLoader å¢ï¼å ä¸ºå¦æä¸æå® ClassLoaderï¼åæ æ³è·å SPI æå¡ã\n\nå¦æä¸åä»»ä½çè®¾ç½®ï¼Java åºç¨ççº¿ç¨çä¸ä¸æç±»å è½½å¨é»è®¤å°±æ¯ AppClassLoaderãå¨æ ¸å¿ç±»åºä½¿ç¨ SPI æ¥å£æ¶ï¼ä¼ éçç±»å è½½å¨ä½¿ç¨çº¿ç¨ä¸ä¸æç±»å è½½å¨ï¼å°±å¯ä»¥æåçå è½½å° SPI å®ç°çç±»ãçº¿ç¨ä¸ä¸æç±»å è½½å¨å¨å¾å¤ SPI çå®ç°ä¸­é½ä¼ç¨å°ã\n\néå¸¸å¯ä»¥éè¿ Thread.currentThread().getClassLoader() å Thread.currentThread().getContextClassLoader() è·åçº¿ç¨ä¸ä¸æç±»å è½½å¨ã\n\n\n# Java SPI çä¸è¶³\n\nJava SPI å­å¨ä¸äºä¸è¶³ï¼\n\n * ä¸è½æéå è½½ï¼éè¦éåææçå®ç°ï¼å¹¶å®ä¾åï¼ç¶åå¨å¾ªç¯ä¸­æè½æ¾å°æä»¬éè¦çå®ç°ãå¦æä¸æ³ç¨æäºå®ç°ç±»ï¼æèæäºç±»å®ä¾åå¾èæ¶ï¼å®ä¹è¢«è½½å¥å¹¶å®ä¾åäºï¼è¿å°±é æäºæµªè´¹ã\n\n * è·åæä¸ªå®ç°ç±»çæ¹å¼ä¸å¤çµæ´»ï¼åªè½éè¿ Iterator å½¢å¼è·åï¼ä¸è½æ ¹æ®æä¸ªåæ°æ¥è·åå¯¹åºçå®ç°ç±»ã\n\n * å¤ä¸ªå¹¶åå¤çº¿ç¨ä½¿ç¨ ServiceLoader ç±»çå®ä¾æ¯ä¸å®å¨çã\n\n\n# SPI åºç¨åºæ¯\n\nSPI å¨ Java å¼åä¸­åºç¨ååå¹¿æ³ãé¦åï¼å¨ Java ç java.util.spi package ä¸­å°±çº¦å®äºå¾å¤ SPI æ¥å£ãä¸é¢ï¼åä¸¾ä¸äº SPI æ¥å£ï¼\n\n * TimeZoneNameProvider: ä¸º TimeZone ç±»æä¾æ¬å°åçæ¶åºåç§°ã\n * DateFormatProvider: ä¸ºæå®çè¯­è¨ç¯å¢æä¾æ¥æåæ¶é´æ ¼å¼ã\n * NumberFormatProvider: ä¸º NumberFormat ç±»æä¾è´§å¸ãæ´æ°åç¾åæ¯å¼ã\n * Driver: ä» 4.0 çå¼å§ï¼JDBC API æ¯æ SPI æ¨¡å¼ãæ§çæ¬ä½¿ç¨ Class.forName() æ¹æ³å è½½é©±å¨ç¨åºã\n * PersistenceProvider: æä¾ JPA API çå®ç°ã\n * ç­ç­\n\né¤æ­¤ä»¥å¤ï¼SPI è¿æå¾å¤åºç¨ï¼ä¸é¢åä¸¾å ä¸ªç»å¸æ¡ä¾ã\n\n\n# SPI åºç¨æ¡ä¾ä¹ JDBC DriverManager\n\nä½ä¸º Java å·¥ç¨å¸ï¼å°¤å¶æ¯ CRUD å·¥ç¨å¸ï¼ç¸å¿é½éå¸¸çæ JDBCãä¼æå¨ç¥ï¼å³ç³»åæ°æ®åºæå¾å¤ç§ï¼å¦ï¼MysqlãOracleãPostgreSQL ç­ç­ãJDBC å¦ä½è¯å«åç§æ°æ®åºçé©±å¨å¢ï¼\n\n# åå»ºæ°æ®åºè¿æ¥\n\næä»¬ååé¡¾ä¸ä¸ï¼JDBC å¦ä½åå»ºæ°æ®åºè¿æ¥çå¢ï¼\n\nå¨ JDBC4.0 ä¹åï¼è¿æ¥æ°æ®åºçæ¶åï¼éå¸¸ä¼ç¨ Class.forName(XXX) æ¹æ³æ¥å è½½æ°æ®åºç¸åºçé©±å¨ï¼ç¶ååè·åæ°æ®åºè¿æ¥ï¼ç»§èè¿è¡ CRUD ç­æä½ã\n\nClass.forName("com.mysql.jdbc.Driver")\n\n\nè JDBC4.0 ä¹åï¼ä¸åéè¦ç¨ Class.forName(XXX) æ¹æ³æ¥å è½½æ°æ®åºé©±å¨ï¼ç´æ¥è·åè¿æ¥å°±å¯ä»¥äºãæ¾ç¶ï¼è¿ç§æ¹å¼å¾æ¹ä¾¿ï¼ä½æ¯å¦ä½åå°çå¢ï¼\n\n * JDBC æ¥å£ï¼é¦åï¼Java ä¸­åç½®äºæ¥å£ java.sql.Driverã\n\n * JDBC æ¥å£å®ç°ï¼åä¸ªæ°æ®åºçé©±å¨èªè¡å®ç° java.sql.Driver æ¥å£ï¼ç¨äºç®¡çæ°æ®åºè¿æ¥ã\n   \n   * Mysqlï¼å¨ mysql ç Java é©±å¨å mysql-connector-java-XXX.jar ä¸­ï¼å¯ä»¥æ¾å° META-INF/services ç®å½ï¼è¯¥ç®å½ä¸ä¼æä¸ä¸ªåå­ä¸ºjava.sql.Driver çæä»¶ï¼æä»¶åå®¹æ¯ com.mysql.cj.jdbc.Driverã com.mysql.cj.jdbc.Driver æ­£æ¯ Mysql çç java.sql.Driver å®ç°ãå¦ä¸å¾æç¤ºï¼\n   \n   \n   \n   * PostgreSQL å®ç°ï¼å¨ PostgreSQL ç Java é©±å¨å postgresql-42.0.0.jar ä¸­ï¼ä¹å¯ä»¥æ¾å°åæ ·çéç½®æä»¶ï¼æä»¶åå®¹æ¯ org.postgresql.Driverï¼org.postgresql.Driver æ­£æ¯ PostgreSQL çç java.sql.Driver å®ç°ã\n\n * åå»ºæ°æ®åºè¿æ¥\n   \n   ä»¥ Mysql ä¸ºä¾ï¼åå»ºæ°æ®åºè¿æ¥ä»£ç å¦ä¸ï¼\n   \n   final String DB_URL = String.format("jdbc:mysql://%s:%s/%s", DB_HOST, DB_PORT, DB_SCHEMA);\n   connection = DriverManager.getConnection(DB_URL, DB_USER, DB_PASSWORD);\n   \n\n# DriverManager\n\nä»åæï¼æä»¬å·²ç»ç¥é DriverManager æ¯åå»ºæ°æ®åºè¿æ¥çå³é®ãå®ç©¶ç«æ¯å¦ä½å·¥ä½çå¢ï¼\n\nå¯ä»¥çå°æ¯å è½½å®ä¾åé©±å¨çï¼æ¥çç loadInitialDrivers æ¹æ³ï¼\n\nprivate static void loadInitialDrivers() {\n\tString drivers;\n\ttry {\n\t\tdrivers = AccessController.doPrivileged(new PrivilegedAction<String>() {\n\t\t\tpublic String run() {\n\t\t\t\treturn System.getProperty("jdbc.drivers");\n\t\t\t}\n\t\t});\n\t} catch (Exception ex) {\n\t\tdrivers = null;\n\t}\n\t// éè¿ classloader è·åææå®ç° java.sql.Driver çé©±å¨ç±»\n\tAccessController.doPrivileged(new PrivilegedAction<Void>() {\n\t\tpublic Void run() {\n            // å©ç¨ SPIï¼è®°è½½ææ Driver æå¡\n\t\t\tServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);\n            // è·åè¿­ä»£å¨\n\t\t\tIterator<Driver> driversIterator = loadedDrivers.iterator();\n\t\t\ttry{\n                // éåè¿­ä»£å¨\n\t\t\t\twhile(driversIterator.hasNext()) {\n\t\t\t\t\tdriversIterator.next();\n\t\t\t\t}\n\t\t\t} catch(Throwable t) {\n\t\t\t// Do nothing\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t});\n\n    // æå°æ°æ®åºé©±å¨ä¿¡æ¯\n\tprintln("DriverManager.initialize: jdbc.drivers = " + drivers);\n\n\tif (drivers == null || drivers.equals("")) {\n\t\treturn;\n\t}\n\tString[] driversList = drivers.split(":");\n\tprintln("number of Drivers:" + driversList.length);\n\tfor (String aDriver : driversList) {\n\t\ttry {\n\t\t\tprintln("DriverManager.Initialize: loading " + aDriver);\n            // å°è¯å®ä¾åé©±å¨\n\t\t\tClass.forName(aDriver, true,\n\t\t\t\t\tClassLoader.getSystemClassLoader());\n\t\t} catch (Exception ex) {\n\t\t\tprintln("DriverManager.Initialize: load failed: " + ex);\n\t\t}\n\t}\n}\n\n\nä¸é¢çä»£ç ä¸»è¦æ­¥éª¤æ¯ï¼\n\n 1. ä»ç³»ç»åéä¸­è·åé©±å¨çå®ç°ç±»ã\n 2. å©ç¨ SPI æ¥è·åææé©±å¨çå®ç°ç±»ã\n 3. éåææé©±å¨ï¼å°è¯å®ä¾ååä¸ªå®ç°ç±»ã\n 4. æ ¹æ®ç¬¬ 1 æ­¥è·åå°çé©±å¨åè¡¨æ¥å®ä¾åå·ä½çå®ç°ç±»ã\n\néè¦å³æ³¨çæ¯ä¸é¢è¿è¡ä»£ç ï¼\n\nServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);\n\n\nè¿éå®éè·åçæ¯ java.util.ServiceLoader.LazyIterator è¿­ä»£å¨ãè°ç¨å¶ hasNext æ¹æ³æ¶ï¼ä¼æç´¢ classpath ä¸ä»¥å jar åä¸­ç META-INF/services ç®å½ï¼æ¥æ¾ java.sql.Driver æä»¶ï¼å¹¶æ¾å°æä»¶ä¸­çé©±å¨å®ç°ç±»çå¨éå®åãè°ç¨å¶ next æ¹æ³æ¶ï¼ä¼æ ¹æ®é©±å¨ç±»çå¨éå®åå»å°è¯å®ä¾åä¸ä¸ªé©±å¨ç±»çå¯¹è±¡ã\n\n\n# SPI åºç¨æ¡ä¾ä¹ Common-Logging\n\ncommon-loggingï¼ä¹ç§° Jakarta Commons Loggingï¼ç¼©å JCLï¼æ¯å¸¸ç¨çæ¥å¿é¨é¢å·¥å·åã\n\ncommon-logging çæ ¸å¿ç±»æ¯å¥å£æ¯ LogFactoryï¼LogFatory æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®è´è´£å è½½å·ä½çæ¥å¿å®ç°ã\n\nå¶å¥å£æ¹æ³æ¯ LogFactory.getLog æ¹æ³ï¼æºç å¦ä¸ï¼\n\npublic static Log getLog(Class clazz) throws LogConfigurationException {\n\treturn getFactory().getInstance(clazz);\n}\n\npublic static Log getLog(String name) throws LogConfigurationException {\n\treturn getFactory().getInstance(name);\n}\n\n\nä»ä»¥ä¸æºç å¯ç¥ï¼getLog éç¨äºå·¥åè®¾è®¡æ¨¡å¼ï¼æ¯åè°ç¨ getFactory æ¹æ³è·åå·ä½æ¥å¿åºçå·¥åç±»ï¼ç¶åæ ¹æ®ç±»åç§°æç±»ååå»ºæ¥å¿å®ä¾ã\n\nLogFatory.getFactory æ¹æ³è´è´£éåºå¹éçæ¥å¿å·¥åï¼å¶æºç å¦ä¸ï¼\n\npublic static LogFactory getFactory() throws LogConfigurationException {\n\t// çç¥...\n\n\t// å è½½ commons-logging.properties éç½®æä»¶\n\tProperties props = getConfigurationFile(contextClassLoader, FACTORY_PROPERTIES);\n\n\t// çç¥...\n\n    // å³å®åå»ºåªä¸ª LogFactory å®ä¾\n\t// ï¼1ï¼å°è¯è¯»åå¨å±å±æ§ org.apache.commons.logging.LogFactory\n\tif (isDiagnosticsEnabled()) {\n\t\tlogDiagnostic("[LOOKUP] Looking for system property [" + FACTORY_PROPERTY +\n\t\t\t\t\t  "] to define the LogFactory subclass to use...");\n\t}\n\n\ttry {\n        // å¦ææå®äº org.apache.commons.logging.LogFactory å±æ§ï¼å°è¯å®ä¾åå·ä½å®ç°ç±»\n\t\tString factoryClass = getSystemProperty(FACTORY_PROPERTY, null);\n\t\tif (factoryClass != null) {\n\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\tlogDiagnostic("[LOOKUP] Creating an instance of LogFactory class \'" + factoryClass +\n\t\t\t\t\t\t\t  "\' as specified by system property " + FACTORY_PROPERTY);\n\t\t\t}\n\t\t\tfactory = newFactory(factoryClass, baseClassLoader, contextClassLoader);\n\t\t} else {\n\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\tlogDiagnostic("[LOOKUP] No system property [" + FACTORY_PROPERTY + "] defined.");\n\t\t\t}\n\t\t}\n\t} catch (SecurityException e) {\n\t    // å¼å¸¸å¤ç\n\t} catch (RuntimeException e) {\n\t    // å¼å¸¸å¤ç\n\t}\n\n    // ï¼2ï¼å©ç¨ Java SPI æºå¶ï¼å°è¯å¨ classpatch ç META-INF/services ç®å½ä¸å¯»æ¾ org.apache.commons.logging.LogFactory å®ç°ç±»\n\tif (factory == null) {\n\t\tif (isDiagnosticsEnabled()) {\n\t\t\tlogDiagnostic("[LOOKUP] Looking for a resource file of name [" + SERVICE_ID +\n\t\t\t\t\t\t  "] to define the LogFactory subclass to use...");\n\t\t}\n\t\ttry {\n\t\t\tfinal InputStream is = getResourceAsStream(contextClassLoader, SERVICE_ID);\n\n\t\t\tif( is != null ) {\n\t\t\t\t// This code is needed by EBCDIC and other strange systems.\n\t\t\t\t// It\'s a fix for bugs reported in xerces\n\t\t\t\tBufferedReader rd;\n\t\t\t\ttry {\n\t\t\t\t\trd = new BufferedReader(new InputStreamReader(is, "UTF-8"));\n\t\t\t\t} catch (java.io.UnsupportedEncodingException e) {\n\t\t\t\t\trd = new BufferedReader(new InputStreamReader(is));\n\t\t\t\t}\n\n\t\t\t\tString factoryClassName = rd.readLine();\n\t\t\t\trd.close();\n\n\t\t\t\tif (factoryClassName != null && ! "".equals(factoryClassName)) {\n\t\t\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\t\t\tlogDiagnostic("[LOOKUP]  Creating an instance of LogFactory class " +\n\t\t\t\t\t\t\t\t\t  factoryClassName +\n\t\t\t\t\t\t\t\t\t  " as specified by file \'" + SERVICE_ID +\n\t\t\t\t\t\t\t\t\t  "\' which was present in the path of the context classloader.");\n\t\t\t\t\t}\n\t\t\t\t\tfactory = newFactory(factoryClassName, baseClassLoader, contextClassLoader );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// is == null\n\t\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\t\tlogDiagnostic("[LOOKUP] No resource file with name \'" + SERVICE_ID + "\' found.");\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (Exception ex) {\n\t\t\t// note: if the specified LogFactory class wasn\'t compatible with LogFactory\n\t\t\t// for some reason, a ClassCastException will be caught here, and attempts will\n\t\t\t// continue to find a compatible class.\n\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\tlogDiagnostic(\n\t\t\t\t\t"[LOOKUP] A security exception occurred while trying to create an" +\n\t\t\t\t\t" instance of the custom factory class" +\n\t\t\t\t\t": [" + trim(ex.getMessage()) +\n\t\t\t\t\t"]. Trying alternative implementations...");\n\t\t\t}\n\t\t\t// ignore\n\t\t}\n\t}\n\n\t// ï¼3ï¼å°è¯ä» classpath ç®å½ä¸ç commons-logging.properties æä»¶ä¸­æ¥æ¾ org.apache.commons.logging.LogFactory å±æ§\n\n\tif (factory == null) {\n\t\tif (props != null) {\n\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\tlogDiagnostic(\n\t\t\t\t\t"[LOOKUP] Looking in properties file for entry with key \'" + FACTORY_PROPERTY +\n\t\t\t\t\t"\' to define the LogFactory subclass to use...");\n\t\t\t}\n\t\t\tString factoryClass = props.getProperty(FACTORY_PROPERTY);\n\t\t\tif (factoryClass != null) {\n\t\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\t\tlogDiagnostic(\n\t\t\t\t\t\t"[LOOKUP] Properties file specifies LogFactory subclass \'" + factoryClass + "\'");\n\t\t\t\t}\n\t\t\t\tfactory = newFactory(factoryClass, baseClassLoader, contextClassLoader);\n\n\t\t\t\t// TODO: think about whether we need to handle exceptions from newFactory\n\t\t\t} else {\n\t\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\t\tlogDiagnostic("[LOOKUP] Properties file has no entry specifying LogFactory subclass.");\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (isDiagnosticsEnabled()) {\n\t\t\t\tlogDiagnostic("[LOOKUP] No properties file available to determine" + " LogFactory subclass from..");\n\t\t\t}\n\t\t}\n\t}\n\n\t// ï¼4ï¼ä»¥ä¸æåµé½ä¸æ»¡è¶³ï¼å®ä¾åé»è®¤å®ç°ç±» org.apache.commons.logging.impl.LogFactoryImpl\n\n\tif (factory == null) {\n\t\tif (isDiagnosticsEnabled()) {\n\t\t\tlogDiagnostic(\n\t\t\t\t"[LOOKUP] Loading the default LogFactory implementation \'" + FACTORY_DEFAULT +\n\t\t\t\t"\' via the same classloader that loaded this LogFactory" +\n\t\t\t\t" class (ie not looking in the context classloader).");\n\t\t}\n\n\t\tfactory = newFactory(FACTORY_DEFAULT, thisClassLoader, contextClassLoader);\n\t}\n\n\tif (factory != null) {\n\t\t/**\n\t\t * Always cache using context class loader.\n\t\t */\n\t\tcacheFactory(contextClassLoader, factory);\n\n\t\tif (props != null) {\n\t\t\tEnumeration names = props.propertyNames();\n\t\t\twhile (names.hasMoreElements()) {\n\t\t\t\tString name = (String) names.nextElement();\n\t\t\t\tString value = props.getProperty(name);\n\t\t\t\tfactory.setAttribute(name, value);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn factory;\n}\n\n\nä» getFactory æ¹æ³çæºç å¯ä»¥çåºï¼å¶æ ¸å¿é»è¾åä¸º 4 æ­¥ï¼\n\n 1. é¦åï¼å°è¯æ¥æ¾å¨å±å±æ§ org.apache.commons.logging.LogFactoryï¼å¦ææå®äºå·ä½ç±»ï¼å°è¯åå»ºå®ä¾ã\n 2. å©ç¨ Java SPI æºå¶ï¼å°è¯å¨ classpatch ç META-INF/services ç®å½ä¸å¯»æ¾ org.apache.commons.logging.LogFactory çå®ç°ç±»ã\n 3. å°è¯ä» classpath ç®å½ä¸ç commons-logging.properties æä»¶ä¸­æ¥æ¾ org.apache.commons.logging.LogFactory å±æ§ï¼å¦ææå®äºå·ä½ç±»ï¼å°è¯åå»ºå®ä¾ã\n 4. ä»¥ä¸æåµå¦æé½ä¸æ»¡è¶³ï¼åå®ä¾åé»è®¤å®ç°ç±»ï¼å³ org.apache.commons.logging.impl.LogFactoryImplã\n\n\n# SPI åºç¨æ¡ä¾ä¹ Spring Boot\n\nSpring Boot æ¯åºäº Spring æå»ºçæ¡æ¶ï¼å¶è®¾è®¡ç®çå¨äºç®å Spring åºç¨çéç½®ãè¿è¡ãå¨ Spring Boot ä¸­ï¼å¤§éè¿ç¨äºèªå¨è£éæ¥å°½å¯è½åå°éç½®ã\n\nä¸é¢æ¯ä¸ä¸ª Spring Boot å¥å£ç¤ºä¾ï¼å¯ä»¥çå°ï¼ä»£ç éå¸¸ç®æ´ã\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@SpringBootApplication\n@RestController\npublic class DemoApplication {\n\n    public static void main(String[] args) {\n    \t\tSpringApplication.run(DemoApplication.class, args);\n    }\n\n    @GetMapping("/hello")\n    public String hello(@RequestParam(value = "name", defaultValue = "World") String name) {\n    \t\treturn String.format("Hello %s!", name);\n    }\n}\n\n\né£ä¹ï¼Spring Boot æ¯å¦ä½åå°å¯¥å¯¥å è¡ä»£ç ï¼å°±å¯ä»¥è¿è¡ä¸ä¸ª Spring Boot åºç¨çå¢ãæä»¬ä¸å¦¨å¸¦ççé®ï¼ä»æºç å¥æï¼ä¸æ­¥æ­¥æ¢ç©¶å¶åçã\n\n# @SpringBootApplication æ³¨è§£\n\né¦åï¼Spring Boot åºç¨çå¯å¨ç±»ä¸é½ä¼æ è®°ä¸ä¸ª @SpringBootApplication æ³¨è§£ã@SpringBootApplication æ³¨è§£å®ä¹å¦ä¸ï¼\n\n@Target({ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Inherited\n@SpringBootConfiguration\n@EnableAutoConfiguration\n@ComponentScan(\n    excludeFilters = {@Filter(\n    type = FilterType.CUSTOM,\n    classes = {TypeExcludeFilter.class}\n), @Filter(\n    type = FilterType.CUSTOM,\n    classes = {AutoConfigurationExcludeFilter.class}\n)}\n)\npublic @interface SpringBootApplication {\n\t\t// ç¥\n}\n\n\né¤äº @Targetã @Retentionã@Documentedã@Inherited è¿å ä¸ªåæ³¨è§£ï¼ @SpringBootApplication æ³¨è§£çå®ä¹ä¸­è¿æ è®°äº @SpringBootConfigurationã@EnableAutoConfigurationã@ComponentScan ä¸ä¸ªæ³¨è§£ã\n\n# @SpringBootConfiguration æ³¨è§£\n\nä»@SpringBootConfiguration æ³¨è§£çå®ä¹æ¥çï¼@SpringBootConfiguration æ³¨è§£æ¬è´¨ä¸å°±æ¯ä¸ä¸ª @Configuration æ³¨è§£ï¼è¿æå³çè¢«@SpringBootConfiguration æ³¨è§£ä¿®é¥°çç±»ä¼è¢« Spring Boot è¯å«ä¸ºä¸ä¸ªéç½®ç±»ã\n\n@Target({ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Configuration\npublic @interface SpringBootConfiguration {\n    @AliasFor(\n        annotation = Configuration.class\n    )\n    boolean proxyBeanMethods() default true;\n}\n\n\n# @EnableAutoConfiguration æ³¨è§£\n\n@EnableAutoConfiguration æ³¨è§£å®ä¹å¦ä¸ï¼\n\n@Target({ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Inherited\n@AutoConfigurationPackage\n@Import({AutoConfigurationImportSelector.class})\npublic @interface EnableAutoConfiguration {\n    String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";\n\n    Class<?>[] exclude() default {};\n\n    String[] excludeName() default {};\n}\n\n\n@EnableAutoConfiguration æ³¨è§£åå«äº @AutoConfigurationPackage ä¸ @Import({AutoConfigurationImportSelector.class}) ä¸¤ä¸ªæ³¨è§£ã\n\n# @AutoConfigurationPackage æ³¨è§£\n\n@AutoConfigurationPackage ä¼å°è¢«ä¿®é¥°çç±»ä½ä¸ºä¸»éç½®ç±»ï¼è¯¥ç±»æå¨ç package ä¼è¢«è§ä¸ºæ ¹è·¯å¾ï¼Spring Boot é»è®¤ä¼èªå¨æ«ææ ¹è·¯å¾ä¸çææ Spring Beanï¼è¢« @Component ä»¥åç»§æ¿ @Component çåä¸ªæ³¨è§£æä¿®é¥°çç±»ï¼ãââè¿å°±æ¯ä¸ºä»ä¹ Spring Boot çå¯å¨ç±»ä¸è¬è¦ç½®äºæ ¹è·¯å¾çåå ãè¿ä¸ªåè½ç­åäºå¨ Spring xml éç½®ä¸­éè¿ context:component-scan æ¥æå®æ«æè·¯å¾ã@Import æ³¨è§£çä½ç¨æ¯å Spring å®¹å¨ä¸­ç´æ¥æ³¨å¥æå®ç»ä»¶ã@AutoConfigurationPackage æ³¨è§£ä¸­æ³¨æäº @Import({Registrar.class})ãRegistrar ç±»ç¨äºä¿å­ Spring Boot çå¥å£ç±»ãæ ¹è·¯å¾ç­ä¿¡æ¯ã\n\n# SpringFactoriesLoader.loadFactoryNames æ¹æ³\n\n@Import(AutoConfigurationImportSelector.class) è¡¨ç¤ºç´æ¥æ³¨å¥ AutoConfigurationImportSelectorãAutoConfigurationImportSelector æä¸ä¸ªæ ¸å¿æ¹æ³ getCandidateConfigurations ç¨äºè·ååééç½®ãè¯¥æ¹æ³è°ç¨äº SpringFactoriesLoader.loadFactoryNames æ¹æ³ï¼è¿ä¸ªæ¹æ³å³ä¸º Spring Boot SPI çå³é®ï¼å®è´è´£å è½½ææ META-INF/spring.factories æä»¶ï¼å è½½çè¿ç¨ç± SpringFactoriesLoader è´è´£ã\n\nSpring Boot ç META-INF/spring.factories æä»¶æ¬è´¨ä¸å°±æ¯ä¸ä¸ª properties æä»¶ï¼æ°æ®åå®¹å°±æ¯ä¸ä¸ªä¸ªé®å¼å¯¹ã\n\nSpringFactoriesLoader.loadFactoryNames æ¹æ³çå³é®æºç ï¼\n\n// spring.factories æä»¶çæ ¼å¼ä¸ºï¼key=value1,value2,value3\n// éåææ META-INF/spring.factories æä»¶\n// è§£ææä»¶ï¼è·å¾ key=factoryClass çç±»åç§°\npublic static List<String> loadFactoryNames(Class<?> factoryType, @Nullable ClassLoader classLoader) {\n\tString factoryTypeName = factoryType.getName();\n\treturn loadSpringFactories(classLoader).getOrDefault(factoryTypeName, Collections.emptyList());\n}\n\nprivate static Map<String, List<String>> loadSpringFactories(@Nullable ClassLoader classLoader) {\n  // å°è¯è·åç¼å­ï¼å¦æç¼å­ä¸­ææ°æ®ï¼ç´æ¥è¿å\n\tMultiValueMap<String, String> result = cache.get(classLoader);\n\tif (result != null) {\n\t\treturn result;\n\t}\n\n\ttry {\n    // è·åèµæºæä»¶è·¯å¾\n\t\tEnumeration<URL> urls = (classLoader != null ?\n\t\t\t\tclassLoader.getResources(FACTORIES_RESOURCE_LOCATION) :\n\t\t\t\tClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));\n\t\tresult = new LinkedMultiValueMap<>();\n    // éåææè·¯å¾\n\t\twhile (urls.hasMoreElements()) {\n\t\t\tURL url = urls.nextElement();\n\t\t\tUrlResource resource = new UrlResource(url);\n      // è§£ææä»¶ï¼å¾å°å¯¹åºçä¸ç» Properties\n\t\t\tProperties properties = PropertiesLoaderUtils.loadProperties(resource);\n      // éåè§£æåºç propertiesï¼ç»è£æ°æ®\n\t\t\tfor (Map.Entry<?, ?> entry : properties.entrySet()) {\n\t\t\t\tString factoryTypeName = ((String) entry.getKey()).trim();\n\t\t\t\tfor (String factoryImplementationName : StringUtils.commaDelimitedListToStringArray((String) entry.getValue())) {\n\t\t\t\t\tresult.add(factoryTypeName, factoryImplementationName.trim());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcache.put(classLoader, result);\n\t\treturn result;\n\t}\n\tcatch (IOException ex) {\n\t\tthrow new IllegalArgumentException("Unable to load factories from location [" +\n\t\t\t\tFACTORIES_RESOURCE_LOCATION + "]", ex);\n\t}\n}\n\n\nå½çº³ä¸é¢çæ¹æ³ï¼ä¸»è¦ä½äºè¿äºäºï¼\n\nå è½½ææ META-INF/spring.factories æä»¶ï¼å è½½è¿ç¨æ SpringFactoriesLoader è´è´£ã\n\n * å¨ CLASSPATH ä¸­æå¯»ææ META-INF/spring.factories éç½®æä»¶\n * ç¶åï¼è§£æ spring.factories æä»¶ï¼è·åæå®èªå¨è£éç±»çå¨éå®å\n\n# Spring Boot ç AutoConfiguration ç±»\n\nSpring Boot æåç§ starter åï¼å¯ä»¥æ ¹æ®å®éé¡¹ç®éè¦ï¼æéåæãå¨é¡¹ç®å¼åä¸­ï¼åªè¦å° starter åå¼å¥ï¼æä»¬å°±å¯ä»¥ç¨å¾å°çéç½®ï¼çè³ä»ä¹é½ä¸éç½®ï¼å³å¯è·åç¸å³çè½åãéè¿åé¢ç Spring Boot SPI æµç¨ï¼åªå®æäºèªå¨è£éå·¥ä½çä¸åï¼å©ä¸çå·¥ä½å¦ä½å¤çå¢ ï¼\n\nä»¥ spring-boot-starter-web ç jar åä¸ºä¾ï¼æ¥çå¶ maven pomï¼å¯ä»¥çå°ï¼å®ä¾èµäº spring-boot-starterï¼ææ Spring Boot å®æ¹ starter åé½ä¼ä¾èµäºè¿ä¸ª jar åãè spring-boot-starter åä¾èµäº spring-boot-autoconfigureï¼Spring Boot çèªå¨è£éç§å¯ï¼å°±å¨äºè¿ä¸ª jar åã\n\nä» spring-boot-autoconfigure åçç»ææ¥çï¼å®æä¸ä¸ª META-INF/spring.factories ï¼æ¾ç¶å©ç¨äº Spring Boot SPIï¼æ¥èªå¨è£éå¶ä¸­çéç½®ç±»ã\n\n\n\nä¸å¾æ¯ spring-boot-autoconfigure ç META-INF/spring.factories æä»¶çé¨ååå®¹ï¼å¯ä»¥çå°å¶ä¸­æ³¨åäºä¸é¿ä¸²ä¼è¢«èªå¨å è½½ç AutoConfiguration ç±»ã\n\n\n\nä»¥ RedisAutoConfiguration ä¸ºä¾ï¼è¿ä¸ªéç½®ç±»ä¸­ï¼ä¼æ ¹æ® @ConditionalXXX ä¸­çæ¡ä»¶å»å³å®æ¯å¦å®ä¾åå¯¹åºç Beanï¼å®ä¾å Bean æä¾èµçéè¦åæ°åéè¿ RedisProperties ä¼ å¥ã\n\n\n\nRedisProperties ä¸­ç»´æ¤äº Redis è¿æ¥æéè¦çå³é®å±æ§ï¼åªè¦å¨ yml æ properties éç½®æä»¶ä¸­ï¼æå® spring.redis å¼å¤´çå±æ§ï¼é½ä¼è¢«èªå¨è£è½½å° RedisProperties å®ä¾ä¸­ã\n\n\n\néè¿ä»¥ä¸åæï¼å·²ç»ä¸æ­¥æ­¥è§£è¯»åº Spring Boot èªå¨è£è½½çåçã\n\n\n# SPI åºç¨æ¡ä¾ä¹ Dubbo\n\nDubbo å¹¶æªä½¿ç¨ Java SPIï¼èæ¯èªå·±å°è£äºä¸å¥æ°ç SPI æºå¶ãDubbo SPI æéçéç½®æä»¶éæ¾ç½®å¨ META-INF/dubbo è·¯å¾ä¸ï¼éç½®åå®¹å½¢å¼å¦ä¸ï¼\n\noptimusPrime = org.apache.spi.OptimusPrime\nbumblebee = org.apache.spi.Bumblebee\n\n\nä¸ Java SPI å®ç°ç±»éç½®ä¸åï¼Dubbo SPI æ¯éè¿é®å¼å¯¹çæ¹å¼è¿è¡éç½®ï¼è¿æ ·å¯ä»¥æéå è½½æå®çå®ç°ç±»ãDubbo SPI é¤äºæ¯ææéå è½½æ¥å£å®ç°ç±»ï¼è¿å¢å äº IOC å AOP ç­ç¹æ§ã\n\n# ExtensionLoader å¥å£\n\nDubbo SPI çç¸å³é»è¾è¢«å°è£å¨äº ExtensionLoader ç±»ä¸­ï¼éè¿ ExtensionLoaderï¼å¯ä»¥å è½½æå®çå®ç°ç±»ã\n\nExtensionLoader ç getExtension æ¹æ³æ¯å¶å¥å£æ¹æ³ï¼å¶æºç å¦ä¸ï¼\n\npublic T getExtension(String name) {\n    if (name == null || name.length() == 0)\n        throw new IllegalArgumentException("Extension name == null");\n    if ("true".equals(name)) {\n        // è·åé»è®¤çæå±å®ç°ç±»\n        return getDefaultExtension();\n    }\n    // Holderï¼é¡¾åæä¹ï¼ç¨äºææç®æ å¯¹è±¡\n    Holder<Object> holder = cachedInstances.get(name);\n    if (holder == null) {\n        cachedInstances.putIfAbsent(name, new Holder<Object>());\n        holder = cachedInstances.get(name);\n    }\n    Object instance = holder.get();\n    // åéæ£æ¥\n    if (instance == null) {\n        synchronized (holder) {\n            instance = holder.get();\n            if (instance == null) {\n                // åå»ºæå±å®ä¾\n                instance = createExtension(name);\n                // è®¾ç½®å®ä¾å° holder ä¸­\n                holder.set(instance);\n            }\n        }\n    }\n    return (T) instance;\n}\n\n\nå¯ä»¥çåºï¼è¿ä¸ªæ¹æ³çä½ç¨å°±æ¯ï¼é¦åæ£æ¥ç¼å­ï¼ç¼å­æªå½ä¸­åè°ç¨ createExtension æ¹æ³åå»ºæå±å¯¹è±¡ãé£ä¹ï¼createExtension æ¯å¦ä½åå»ºæå±å¯¹è±¡çå¢ï¼å¶æºç å¦ä¸ï¼\n\nprivate T createExtension(String name) {\n    // ä»éç½®æä»¶ä¸­å è½½ææçæå±ç±»ï¼å¯å¾å°âéç½®é¡¹åç§°âå°âéç½®ç±»âçæ å°å³ç³»è¡¨\n    Class<?> clazz = getExtensionClasses().get(name);\n    if (clazz == null) {\n        throw findException(name);\n    }\n    try {\n        T instance = (T) EXTENSION_INSTANCES.get(clazz);\n        if (instance == null) {\n            // éè¿åå°åå»ºå®ä¾\n            EXTENSION_INSTANCES.putIfAbsent(clazz, clazz.newInstance());\n            instance = (T) EXTENSION_INSTANCES.get(clazz);\n        }\n        // åå®ä¾ä¸­æ³¨å¥ä¾èµ\n        injectExtension(instance);\n        Set<Class<?>> wrapperClasses = cachedWrapperClasses;\n        if (wrapperClasses != null && !wrapperClasses.isEmpty()) {\n            // å¾ªç¯åå»º Wrapper å®ä¾\n            for (Class<?> wrapperClass : wrapperClasses) {\n                // å°å½å instance ä½ä¸ºåæ°ä¼ ç» Wrapper çæé æ¹æ³ï¼å¹¶éè¿åå°åå»º Wrapper å®ä¾ã\n                // ç¶åå Wrapper å®ä¾ä¸­æ³¨å¥ä¾èµï¼æåå° Wrapper å®ä¾åæ¬¡èµå¼ç» instance åé\n                instance = injectExtension(\n                    (T) wrapperClass.getConstructor(type).newInstance(instance));\n            }\n        }\n        return instance;\n    } catch (Throwable t) {\n        throw new IllegalStateException("...");\n    }\n}\n\n\ncreateExtension æ¹æ³ççå·¥ä½æ­¥éª¤å¯ä»¥å½çº³ä¸ºï¼\n\n 1. éè¿ getExtensionClasses è·åææçæå±ç±»\n 2. éè¿åå°åå»ºæå±å¯¹è±¡\n 3. åæå±å¯¹è±¡ä¸­æ³¨å¥ä¾èµ\n 4. å°æå±å¯¹è±¡åè£¹å¨ç¸åºç Wrapper å¯¹è±¡ä¸­\n\nä»¥ä¸æ­¥éª¤ä¸­ï¼ç¬¬ä¸ä¸ªæ­¥éª¤æ¯å è½½æå±ç±»çå³é®ï¼ç¬¬ä¸åç¬¬åä¸ªæ­¥éª¤æ¯ Dubbo IOC ä¸ AOP çå·ä½å®ç°ã\n\n# è·åææçæå±ç±»\n\nDubbo å¨éè¿åç§°è·åæå±ç±»ä¹åï¼é¦åéè¦æ ¹æ®éç½®æä»¶è§£æåºæå±é¡¹åç§°å°æå±ç±»çæ å°å³ç³»è¡¨ï¼Map<åç§°, æå±ç±»>ï¼ï¼ä¹ååæ ¹æ®æå±é¡¹åç§°ä»æ å°å³ç³»è¡¨ä¸­ååºç¸åºçæå±ç±»å³å¯ãç¸å³è¿ç¨çä»£ç åæå¦ä¸ï¼\n\nprivate Map<String, Class<?>> getExtensionClasses() {\n    // ä»ç¼å­ä¸­è·åå·²å è½½çæå±ç±»\n    Map<String, Class<?>> classes = cachedClasses.get();\n    // åéæ£æ¥\n    if (classes == null) {\n        synchronized (cachedClasses) {\n            classes = cachedClasses.get();\n            if (classes == null) {\n                // å è½½æå±ç±»\n                classes = loadExtensionClasses();\n                cachedClasses.set(classes);\n            }\n        }\n    }\n    return classes;\n}\n\n\nè¿éä¹æ¯åæ£æ¥ç¼å­ï¼è¥ç¼å­æªå½ä¸­ï¼åéè¿ synchronized å éãå éååæ¬¡æ£æ¥ç¼å­ï¼å¹¶å¤ç©ºãæ­¤æ¶å¦æ classes ä»ä¸º nullï¼åéè¿ loadExtensionClasses å è½½æå±ç±»ãä¸é¢åæ loadExtensionClasses æ¹æ³çé»è¾ã\n\nprivate Map<String, Class<?>> loadExtensionClasses() {\n    // è·å SPI æ³¨è§£ï¼è¿éç type åéæ¯å¨è°ç¨ getExtensionLoader æ¹æ³æ¶ä¼ å¥ç\n    final SPI defaultAnnotation = type.getAnnotation(SPI.class);\n    if (defaultAnnotation != null) {\n        String value = defaultAnnotation.value();\n        if ((value = value.trim()).length() > 0) {\n            // å¯¹ SPI æ³¨è§£åå®¹è¿è¡åå\n            String[] names = NAME_SEPARATOR.split(value);\n            // æ£æµ SPI æ³¨è§£åå®¹æ¯å¦åæ³ï¼ä¸åæ³åæåºå¼å¸¸\n            if (names.length > 1) {\n                throw new IllegalStateException("more than 1 default extension name on extension...");\n            }\n\n            // è®¾ç½®é»è®¤åç§°ï¼åè getDefaultExtension æ¹æ³\n            if (names.length == 1) {\n                cachedDefaultName = names[0];\n            }\n        }\n    }\n\n    Map<String, Class<?>> extensionClasses = new HashMap<String, Class<?>>();\n    // å è½½æå®æä»¶å¤¹ä¸çéç½®æä»¶\n    loadDirectory(extensionClasses, DUBBO_INTERNAL_DIRECTORY);\n    loadDirectory(extensionClasses, DUBBO_DIRECTORY);\n    loadDirectory(extensionClasses, SERVICES_DIRECTORY);\n    return extensionClasses;\n}\n\n\nloadExtensionClasses æ¹æ³æ»å±åäºä¸¤ä»¶äºæï¼ä¸æ¯å¯¹ SPI æ³¨è§£è¿è¡è§£æï¼äºæ¯è°ç¨ loadDirectory æ¹æ³å è½½æå®æä»¶å¤¹éç½®æä»¶ãSPI æ³¨è§£è§£æè¿ç¨æ¯è¾ç®åï¼æ éå¤è¯´ãä¸é¢æä»¬æ¥çä¸ä¸ loadDirectory åäºåªäºäºæã\n\nprivate void loadDirectory(Map<String, Class<?>> extensionClasses, String dir) {\n    // fileName = æä»¶å¤¹è·¯å¾ + type å¨éå®å\n    String fileName = dir + type.getName();\n    try {\n        Enumeration<java.net.URL> urls;\n        ClassLoader classLoader = findClassLoader();\n        // æ ¹æ®æä»¶åå è½½ææçååæä»¶\n        if (classLoader != null) {\n            urls = classLoader.getResources(fileName);\n        } else {\n            urls = ClassLoader.getSystemResources(fileName);\n        }\n        if (urls != null) {\n            while (urls.hasMoreElements()) {\n                java.net.URL resourceURL = urls.nextElement();\n                // å è½½èµæº\n                loadResource(extensionClasses, classLoader, resourceURL);\n            }\n        }\n    } catch (Throwable t) {\n        logger.error("...");\n    }\n}\n\n\nloadDirectory æ¹æ³åéè¿ classLoader è·åææèµæºé¾æ¥ï¼ç¶ååéè¿ loadResource æ¹æ³å è½½èµæºãæä»¬ç»§ç»­è·ä¸å»ï¼çä¸ä¸ loadResource æ¹æ³çå®ç°ã\n\nprivate void loadResource(Map<String, Class<?>> extensionClasses,\n\tClassLoader classLoader, java.net.URL resourceURL) {\n    try {\n        BufferedReader reader = new BufferedReader(\n            new InputStreamReader(resourceURL.openStream(), "utf-8"));\n        try {\n            String line;\n            // æè¡è¯»åéç½®åå®¹\n            while ((line = reader.readLine()) != null) {\n                // å®ä½ # å­ç¬¦\n                final int ci = line.indexOf(\'#\');\n                if (ci >= 0) {\n                    // æªå # ä¹åçå­ç¬¦ä¸²ï¼# ä¹åçåå®¹ä¸ºæ³¨éï¼éè¦å¿½ç¥\n                    line = line.substring(0, ci);\n                }\n                line = line.trim();\n                if (line.length() > 0) {\n                    try {\n                        String name = null;\n                        int i = line.indexOf(\'=\');\n                        if (i > 0) {\n                            // ä»¥ç­äºå· = ä¸ºçï¼æªåé®ä¸å¼\n                            name = line.substring(0, i).trim();\n                            line = line.substring(i + 1).trim();\n                        }\n                        if (line.length() > 0) {\n                            // å è½½ç±»ï¼å¹¶éè¿ loadClass æ¹æ³å¯¹ç±»è¿è¡ç¼å­\n                            loadClass(extensionClasses, resourceURL,\n                                      Class.forName(line, true, classLoader), name);\n                        }\n                    } catch (Throwable t) {\n                        IllegalStateException e = new IllegalStateException("Failed to load extension class...");\n                    }\n                }\n            }\n        } finally {\n            reader.close();\n        }\n    } catch (Throwable t) {\n        logger.error("Exception when load extension class...");\n    }\n}\n\n\nloadResource æ¹æ³ç¨äºè¯»ååè§£æéç½®æä»¶ï¼å¹¶éè¿åå°å è½½ç±»ï¼æåè°ç¨ loadClass æ¹æ³è¿è¡å¶ä»æä½ãloadClass æ¹æ³ç¨äºä¸»è¦ç¨äºæä½ç¼å­ï¼è¯¥æ¹æ³çé»è¾å¦ä¸ï¼\n\nprivate void loadClass(Map<String, Class<?>> extensionClasses, java.net.URL resourceURL,\n    Class<?> clazz, String name) throws NoSuchMethodException {\n\n    if (!type.isAssignableFrom(clazz)) {\n        throw new IllegalStateException("...");\n    }\n\n    // æ£æµç®æ ç±»ä¸æ¯å¦æ Adaptive æ³¨è§£\n    if (clazz.isAnnotationPresent(Adaptive.class)) {\n        if (cachedAdaptiveClass == null) {\n            // è®¾ç½® cachedAdaptiveClassç¼å­\n            cachedAdaptiveClass = clazz;\n        } else if (!cachedAdaptiveClass.equals(clazz)) {\n            throw new IllegalStateException("...");\n        }\n\n    // æ£æµ clazz æ¯å¦æ¯ Wrapper ç±»å\n    } else if (isWrapperClass(clazz)) {\n        Set<Class<?>> wrappers = cachedWrapperClasses;\n        if (wrappers == null) {\n            cachedWrapperClasses = new ConcurrentHashSet<Class<?>>();\n            wrappers = cachedWrapperClasses;\n        }\n        // å­å¨ clazz å° cachedWrapperClasses ç¼å­ä¸­\n        wrappers.add(clazz);\n\n    // ç¨åºè¿å¥æ­¤åæ¯ï¼è¡¨æ clazz æ¯ä¸ä¸ªæ®éçæå±ç±»\n    } else {\n        // æ£æµ clazz æ¯å¦æé»è®¤çæé æ¹æ³ï¼å¦ææ²¡æï¼åæåºå¼å¸¸\n        clazz.getConstructor();\n        if (name == null || name.length() == 0) {\n            // å¦æ name ä¸ºç©ºï¼åå°è¯ä» Extension æ³¨è§£ä¸­è·å nameï¼æä½¿ç¨å°åçç±»åä½ä¸º name\n            name = findAnnotationName(clazz);\n            if (name.length() == 0) {\n                throw new IllegalStateException("...");\n            }\n        }\n        // åå name\n        String[] names = NAME_SEPARATOR.split(name);\n        if (names != null && names.length > 0) {\n            Activate activate = clazz.getAnnotation(Activate.class);\n            if (activate != null) {\n                // å¦æç±»ä¸æ Activate æ³¨è§£ï¼åä½¿ç¨ names æ°ç»çç¬¬ä¸ä¸ªåç´ ä½ä¸ºé®ï¼\n                // å­å¨ name å° Activate æ³¨è§£å¯¹è±¡çæ å°å³ç³»\n                cachedActivates.put(names[0], activate);\n            }\n            for (String n : names) {\n                if (!cachedNames.containsKey(clazz)) {\n                    // å­å¨ Class å°åç§°çæ å°å³ç³»\n                    cachedNames.put(clazz, n);\n                }\n                Class<?> c = extensionClasses.get(n);\n                if (c == null) {\n                    // å­å¨åç§°å° Class çæ å°å³ç³»\n                    extensionClasses.put(n, clazz);\n                } else if (c != clazz) {\n                    throw new IllegalStateException("...");\n                }\n            }\n        }\n    }\n}\n\n\nå¦ä¸ï¼loadClass æ¹æ³æä½äºä¸åçç¼å­ï¼æ¯å¦ cachedAdaptiveClassãcachedWrapperClasses å cachedNames ç­ç­ãé¤æ­¤ä¹å¤ï¼è¯¥æ¹æ³æ²¡æå¶ä»ä»ä¹é»è¾äºã\n\n\n# åèèµæ\n\n * Java SPI ææ³æ¢³ç\n * Dubbo SPI\n * springboot ä¸­ SPI æºå¶\n * SpringBoot çèªå¨è£éåçãèªå®ä¹ starter ä¸ spi æºå¶ï¼ä¸ç½æå°½',normalizedContent:'# æºç çº§æ·±åº¦çè§£ java spi\n\n\n# spi ç®ä»\n\nspi å¨ç§° service provider interfaceï¼æ¯ java æä¾çï¼æ¨å¨ç±ç¬¬ä¸æ¹å®ç°ææ©å±ç apiï¼å®æ¯ä¸ç§ç¨äºå¨æå è½½æå¡çæºå¶ãjava ä¸­ spi æºå¶ä¸»è¦ææ³æ¯å°è£éçæ§å¶æç§»å°ç¨åºä¹å¤ï¼å¨æ¨¡ååè®¾è®¡ä¸­è¿ä¸ªæºå¶å°¤å¶éè¦ï¼å¶æ ¸å¿ææ³å°±æ¯ è§£è¦ã\n\njava spi æåä¸ªè¦ç´ ï¼\n\n * spi æ¥å£ï¼ä¸ºæå¡æä¾èå®ç°ç±»çº¦å®ççæ¥å£ææ½è±¡ç±»ã\n * spi å®ç°ç±»ï¼å®éæä¾æå¡çå®ç°ç±»ã\n * spi éç½®ï¼java spi æºå¶çº¦å®çéç½®æä»¶ï¼æä¾æ¥æ¾æå¡å®ç°ç±»çé»è¾ãéç½®æä»¶å¿é¡»ç½®äº meta-inf/services ç®å½ä¸­ï¼å¹¶ä¸ï¼æä»¶ååºä¸æå¡æä¾èæ¥å£çå®å¨éå®åä¿æä¸è´ãæä»¶ä¸­çæ¯ä¸è¡é½æä¸ä¸ªå®ç°æå¡ç±»çè¯¦ç»ä¿¡æ¯ï¼åæ ·æ¯æå¡æä¾èç±»çå®å¨éå®åç§°ã\n * serviceloaderï¼java spi çæ ¸å¿ç±»ï¼ç¨äºå è½½ spi å®ç°ç±»ã serviceloader ä¸­æåç§å®ç¨æ¹æ³æ¥è·åç¹å®å®ç°ãè¿­ä»£å®ä»¬æéæ°å è½½æå¡ã\n\n\n# spi ç¤ºä¾\n\næ­£æè°ï¼å®è·µåºçç¥ï¼æä»¬ä¸å¦¨éè¿ä¸ä¸ªå·ä½çç¤ºä¾æ¥çä¸ä¸ï¼å¦ä½ä½¿ç¨ java spiã\n\n\n# spi æ¥å£\n\né¦åï¼éè¦å®ä¹ä¸ä¸ª spi æ¥å£ï¼åæ®éæ¥å£å¹¶æ²¡æä»ä¹å·®å«ã\n\npackage io.github.dunwu.javacore.spi;\n\npublic interface datastorage {\n    string search(string key);\n}\n\n\n\n# spi å®ç°ç±»\n\nåè®¾ï¼æä»¬éè¦å¨ç¨åºä¸­ä½¿ç¨ä¸¤ç§ä¸åçæ°æ®å­å¨ââmysql å redisãå æ­¤ï¼æä»¬éè¦ä¸¤ä¸ªä¸åçå®ç°ç±»å»åå«å®æç¸åºå·¥ä½ã\n\nmysql æ¥è¯¢ mock ç±»\n\npackage io.github.dunwu.javacore.spi;\n\npublic class mysqlstorage implements datastorage {\n    @override\n    public string search(string key) {\n        return "ãmysqlãæç´¢" + key + "ï¼ç»æï¼no";\n    }\n}\n\n\nredis æ¥è¯¢ mock ç±»\n\npackage io.github.dunwu.javacore.spi;\n\npublic class redisstorage implements datastorage {\n    @override\n    public string search(string key) {\n        return "ãredisãæç´¢" + key + "ï¼ç»æï¼yes";\n    }\n}\n\n\nå°ç®åä¸ºæ­¢ï¼å®ä¹æ¥å£ï¼å¹¶å®ç°æ¥å£åæ®éç java æ¥å£å®ç°æ²¡æä»»ä½ä¸åã\n\n\n# spi éç½®\n\nå¦ææ³éè¿ java spi æºå¶æ¥åç°æå¡ï¼å°±éè¦å¨ spi éç½®ä¸­çº¦å®å¥½åç°æå¡çé»è¾ãéç½®æä»¶å¿é¡»ç½®äº meta-inf/services ç®å½ä¸­ï¼å¹¶ä¸ï¼æä»¶ååºä¸æå¡æä¾èæ¥å£çå®å¨éå®åä¿æä¸è´ãæä»¶ä¸­çæ¯ä¸è¡é½æä¸ä¸ªå®ç°æå¡ç±»çè¯¦ç»ä¿¡æ¯ï¼åæ ·æ¯æå¡æä¾èç±»çå®å¨éå®åç§°ãä»¥æ¬ç¤ºä¾ä»£ç ä¸ºä¾ï¼å¶æä»¶ååºè¯¥ä¸º io.github.dunwu.javacore.spi.datastorageï¼æä»¶ä¸­çåå®¹å¦ä¸ï¼\n\nio.github.dunwu.javacore.spi.mysqlstorage\nio.github.dunwu.javacore.spi.redisstorage\n\n\n\n# serviceloader\n\nå®æäºä¸é¢çæ­¥éª¤ï¼å°±å¯ä»¥éè¿ serviceloader æ¥å è½½æå¡ãç¤ºä¾å¦ä¸ï¼\n\nimport java.util.serviceloader;\n\npublic class spidemo {\n\n    public static void main(string[] args) {\n        serviceloader<datastorage> serviceloader = serviceloader.load(datastorage.class);\n        system.out.println("============ java spi æµè¯============");\n        serviceloader.foreach(loader -> system.out.println(loader.search("yes or no")));\n    }\n\n}\n\n\nè¾åºï¼\n\n============ java spi æµè¯============\nãmysqlãæç´¢yes or noï¼ç»æï¼no\nãredisãæç´¢yes or noï¼ç»æï¼yes\n\n\n\n# spi åç\n\nä¸æä¸­ï¼æä»¬å·²ç»äºè§£ java spi çè¦ç´ ä»¥åä½¿ç¨ java spi çæ¹æ³ãä½ ææ²¡ææ³è¿ï¼java spi åæ®é java æ¥å£æä½ä¸åï¼java spi æ¯å¦ä½å·¥ä½çãå®éä¸ï¼java spi æºå¶ä¾èµäº serviceloader ç±»å»è§£æãå è½½æå¡ãå æ­¤ï¼ææ¡äº serviceloader çå·¥ä½æµç¨ï¼å°±ææ¡äº spi çåçãserviceloader çä»£ç æ¬èº«å¾ç²¾ç»ï¼æ¥ä¸æ¥ï¼è®©æä»¬éè¿èµ°è¯»æºç çæ¹å¼ï¼éä¸çè§£ serviceloader çå·¥ä½æµç¨ã\n\n\n# serviceloader çæååé\n\nåçä¸ä¸ serviceloader ç±»çæååéï¼å¤§è´æä¸ªå°è±¡ï¼åé¢çæºç ä¸­é½ä¼ä½¿ç¨å°ã\n\npublic final class serviceloader<s> implements iterable<s> {\n\n    // spi éç½®æä»¶ç®å½\n    private static final string prefix = "meta-inf/services/";\n\n    // å°è¦è¢«å è½½ç spi æå¡\n    private final class<s> service;\n\n    // ç¨äºå è½½ spi æå¡çç±»å è½½å¨\n    private final classloader loader;\n\n    // serviceloader åå»ºæ¶çè®¿é®æ§å¶ä¸ä¸æ\n    private final accesscontrolcontext acc;\n\n    // spi æå¡ç¼å­ï¼æå®ä¾åçé¡ºåºæå\n    private linkedhashmap<string,s> providers = new linkedhashmap<>();\n\n    // ææ¥è¯¢è¿­ä»£å¨\n    private lazyiterator lookupiterator;\n\n    // ...\n}\n\n\n\n# serviceloader çå·¥ä½æµç¨\n\nï¼1ï¼serviceloader.load éææ¹æ³\n\nåºç¨ç¨åºå è½½ java spi æå¡ï¼é½æ¯åè°ç¨ serviceloader.load éææ¹æ³ãserviceloader.load éææ¹æ³çä½ç¨æ¯ï¼\n\n 1. æå®ç±»å è½½ classloader åè®¿é®æ§å¶ä¸ä¸æï¼\n 2. ç¶åï¼éæ°å è½½ spi æå¡\n    1. æ¸ç©ºç¼å­ä¸­ææå·²å®ä¾åç spi æå¡\n    2. æ ¹æ® classloader å spi ç±»åï¼åå»ºæå è½½è¿­ä»£å¨\n\nè¿éï¼æå½ serviceloader.load ç¸å³æºç ï¼å¦ä¸ï¼\n\n// service ä¼ å¥çæ¯ææå è½½ç spi æ¥å£ç±»å\n// loader æ¯ç¨äºå è½½ spi æå¡çç±»å è½½å¨\npublic static <s> serviceloader<s> load(class<s> service,\n\t\t\t\t\t\t\t\t\t\tclassloader loader)\n{\n\treturn new serviceloader<>(service, loader);\n}\n\npublic void reload() {\n    // æ¸ç©ºç¼å­ä¸­ææå·²å®ä¾åç spi æå¡\n\tproviders.clear();\n    // æ ¹æ® classloader å spi ç±»åï¼åå»ºæå è½½è¿­ä»£å¨\n\tlookupiterator = new lazyiterator(service, loader);\n}\n\n// ç§ææé æ¹æ³\n// éæ°å è½½ spi æå¡\nprivate serviceloader(class<s> svc, classloader cl) {\n\tservice = objects.requirenonnull(svc, "service interface cannot be null");\n    // æå®ç±»å è½½ classloader åè®¿é®æ§å¶ä¸ä¸æ\n\tloader = (cl == null) ? classloader.getsystemclassloader() : cl;\n\tacc = (system.getsecuritymanager() != null) ? accesscontroller.getcontext() : null;\n    // ç¶åï¼éæ°å è½½ spi æå¡\n\treload();\n}\n\n\nï¼2ï¼åºç¨ç¨åºéè¿ serviceloader ç iterator æ¹æ³éå spi å®ä¾\n\nserviceloader çç±»å®ä¹ï¼æç¡®äº serviceloader ç±»å®ç°äº iterable<t> æ¥å£ï¼æä»¥ï¼å®æ¯å¯ä»¥è¿­ä»£éåçãå®éä¸ï¼serviceloader ç±»ç»´æ¤äºä¸ä¸ªç¼å­ providersï¼ linkedhashmap å¯¹è±¡ï¼ï¼ç¼å­ providers ä¸­ä¿å­äºå·²ç»è¢«æåå è½½ç spi å®ä¾ï¼è¿ä¸ª map ç key æ¯ spi æ¥å£å®ç°ç±»çå¨éå®åï¼value æ¯è¯¥å®ç°ç±»çä¸ä¸ªå®ä¾å¯¹è±¡ã\n\nå½åºç¨ç¨åºè°ç¨ serviceloader ç iterator æ¹æ³æ¶ï¼serviceloader ä¼åå¤æ­ç¼å­ providers ä¸­æ¯å¦ææ°æ®ï¼å¦ææï¼åç´æ¥è¿åç¼å­ providers çè¿­ä»£å¨ï¼å¦ææ²¡æï¼åè¿åæå è½½è¿­ä»£å¨çè¿­ä»£å¨ã\n\npublic iterator<s> iterator() {\n\treturn new iterator<s>() {\n\n        // ç¼å­ spi providers\n\t\titerator<map.entry<string,s>> knownproviders\n\t\t\t= providers.entryset().iterator();\n\n        // lookupiterator æ¯ lazyiterator å®ä¾ï¼ç¨äºæå è½½ spi å®ä¾\n\t\tpublic boolean hasnext() {\n\t\t\tif (knownproviders.hasnext())\n\t\t\t\treturn true;\n\t\t\treturn lookupiterator.hasnext();\n\t\t}\n\n\t\tpublic s next() {\n\t\t\tif (knownproviders.hasnext())\n\t\t\t\treturn knownproviders.next().getvalue();\n\t\t\treturn lookupiterator.next();\n\t\t}\n\n\t\tpublic void remove() {\n\t\t\tthrow new unsupportedoperationexception();\n\t\t}\n\n\t};\n}\n\n\nï¼3ï¼æå è½½è¿­ä»£å¨çå·¥ä½æµç¨\n\nä¸é¢çæºç ä¸­æå°äºï¼lookupiterator æ¯ lazyiterator å®ä¾ï¼è lazyiterator ç¨äºæå è½½ spi å®ä¾ãé£ä¹ï¼ lazyiterator æ¯å¦ä½å·¥ä½çå¢ï¼\n\nè¿éï¼æå lazyiterator å³é®ä»£ç \n\n * hasnextservice æ¹æ³ï¼\n   1. æ¼æ¥ meta-inf/services/ + spi æ¥å£å¨éå®å\n   2. éè¿ç±»å è½½å¨ï¼å°è¯å è½½èµæºæä»¶\n   3. è§£æèµæºæä»¶ä¸­çåå®¹ï¼è·å spi æ¥å£çå®ç°ç±»çå¨éå®å nextname\n * nextservice æ¹æ³ï¼\n   1. hasnextservice() æ¹æ³è§£æåºäº spi å®ç°ç±»ççå¨éå®å nextnameï¼éè¿åå°ï¼è·å spi å®ç°ç±»çç±»å®ä¹ class<?>ã\n   2. ç¶åï¼å°è¯éè¿ class<?> ç newinstance æ¹æ³å®ä¾åä¸ä¸ª spi æå¡å¯¹è±¡ãå¦ææåï¼åå°è¿ä¸ªå¯¹è±¡å å¥å°ç¼å­ providers ä¸­å¹¶è¿åè¯¥å¯¹è±¡ã\n\nprivate boolean hasnextservice() {\n\tif (nextname != null) {\n\t\treturn true;\n\t}\n\tif (configs == null) {\n\t\ttry {\n            // 1.æ¼æ¥ meta-inf/services/ + spi æ¥å£å¨éå®å\n            // 2.éè¿ç±»å è½½å¨ï¼å°è¯å è½½èµæºæä»¶\n            // 3.è§£æèµæºæä»¶ä¸­çåå®¹\n\t\t\tstring fullname = prefix + service.getname();\n\t\t\tif (loader == null)\n\t\t\t\tconfigs = classloader.getsystemresources(fullname);\n\t\t\telse\n\t\t\t\tconfigs = loader.getresources(fullname);\n\t\t} catch (ioexception x) {\n\t\t\tfail(service, "error locating configuration files", x);\n\t\t}\n\t}\n\twhile ((pending == null) || !pending.hasnext()) {\n\t\tif (!configs.hasmoreelements()) {\n\t\t\treturn false;\n\t\t}\n\t\tpending = parse(service, configs.nextelement());\n\t}\n\tnextname = pending.next();\n\treturn true;\n}\n\nprivate s nextservice() {\n\tif (!hasnextservice())\n\t\tthrow new nosuchelementexception();\n\tstring cn = nextname;\n\tnextname = null;\n\tclass<?> c = null;\n\ttry {\n\t\tc = class.forname(cn, false, loader);\n\t} catch (classnotfoundexception x) {\n\t\tfail(service,\n\t\t\t "provider " + cn + " not found");\n\t}\n\tif (!service.isassignablefrom(c)) {\n\t\tfail(service,\n\t\t\t "provider " + cn  + " not a s");\n\t}\n\ttry {\n\t\ts p = service.cast(c.newinstance());\n\t\tproviders.put(cn, p);\n\t\treturn p;\n\t} catch (throwable x) {\n\t\tfail(service,\n\t\t\t "provider " + cn + " could not be instantiated",\n\t\t\t x);\n\t}\n\tthrow new error();          // this cannot happen\n}\n\n\n\n# spi åç±»å è½½å¨\n\néè¿ä¸é¢ä¸¤ä¸ªç« èä¸­ï¼èµ°è¯» serviceloader ä»£ç ï¼æä»¬å·²ç»å¤§è´äºè§£ java spi çå·¥ä½åçï¼å³éè¿ classloader å è½½ spi éç½®æä»¶ï¼è§£æ spi æå¡ï¼ç¶åéè¿åå°ï¼å®ä¾å spi æå¡å®ä¾ãæä»¬ä¸å¦¨æèä¸ä¸ï¼ä¸ºä»ä¹å è½½ spi æå¡æ¶ï¼éè¦æå®ç±»å è½½å¨ classloader å¢ï¼\n\nå­¦ä¹ è¿ jvm çè¯»èï¼æ³å¿é½äºè§£è¿ç±»å è½½å¨çåäº²å§æ´¾æ¨¡åï¼parents delegation modelï¼ãåäº²å§æ´¾æ¨¡åè¦æ±é¤äºé¡¶å±ç bootstrapclassloader å¤ï¼å¶ä½çç±»å è½½å¨é½åºæèªå·±çç¶ç±»å è½½å¨ãè¿éç±»å è½½å¨ä¹é´çç¶å­å³ç³»ä¸è¬éè¿ç»åï¼compositionï¼å³ç³»æ¥å®ç°ï¼èä¸æ¯éè¿ç»§æ¿ï¼inheritanceï¼çå³ç³»å®ç°ãåäº²å§æ´¾ç»§æ¿ä½ç³»å¾å¦ä¸ï¼\n\nåäº²å§æ´¾æºå¶çº¦å®äºï¼ä¸ä¸ªç±»å è½½å¨é¦åå°ç±»å è½½è¯·æ±ä¼ éå°ç¶ç±»å è½½å¨ï¼åªæå½ç¶ç±»å è½½å¨æ æ³å®æç±»å è½½è¯·æ±æ¶æå°è¯å è½½ã\n\nåäº²å§æ´¾çå¥½å¤ï¼ä½¿å¾ java ç±»ä¼´éçå®çç±»å è½½å¨ï¼å¤©ç¶å·å¤ä¸ç§å¸¦æä¼åçº§çå±æ¬¡å³ç³»ï¼ä»èä½¿å¾ç±»å è½½å¾å°ç»ä¸ï¼ä¸ä¼åºç°éå¤å è½½çé®é¢ï¼\n\n * ç³»ç»ç±»é²æ­¢åå­ä¸­åºç°å¤ä»½åæ ·çå­èç \n * ä¿è¯ java ç¨åºå®å¨ç¨³å®è¿è¡\n\nä¾å¦ï¼ java.lang.object å­æ¾å¨ rt.jar ä¸­ï¼å¦æç¼åå¦å¤ä¸ä¸ª java.lang.object çç±»å¹¶æ¾å° classpath ä¸­ï¼ç¨åºå¯ä»¥ç¼è¯éè¿ãå ä¸ºåäº²å§æ´¾æ¨¡åçå­å¨ï¼æä»¥å¨ rt.jar ä¸­ç object æ¯å¨ classpath ä¸­ç object ä¼åçº§æ´é«ï¼å ä¸º rt.jar ä¸­ç object ä½¿ç¨çæ¯å¯å¨ç±»å è½½å¨ï¼è classpath ä¸­ç object ä½¿ç¨çæ¯åºç¨ç¨åºç±»å è½½å¨ãæ­£å ä¸º rt.jar ä¸­ç object ä¼åçº§æ´é«ï¼å ä¸ºç¨åºä¸­ææç object é½æ¯è¿ä¸ª objectã\n\nåäº²å§æ´¾çéå¶ï¼å­ç±»å è½½å¨å¯ä»¥ä½¿ç¨ç¶ç±»å è½½å¨å·²ç»å è½½çç±»ï¼èç¶ç±»å è½½å¨æ æ³ä½¿ç¨å­ç±»å è½½å¨å·²ç»å è½½çãââè¿å°±å¯¼è´äºåäº²å§æ´¾æ¨¡åå¹¶ä¸è½è§£å³ææçç±»å è½½å¨é®é¢ãjava spi å°±é¢ä¸´çè¿æ ·çé®é¢ï¼\n\n * spi çæ¥å£æ¯ java æ ¸å¿åºçä¸é¨åï¼æ¯ç± bootstrapclassloader å è½½çï¼\n * è spi å®ç°ç java ç±»ä¸è¬æ¯ç± appclassloader æ¥å è½½çãbootstrapclassloader æ¯æ æ³æ¾å° spi çå®ç°ç±»çï¼å ä¸ºå®åªå è½½ java çæ ¸å¿åºãå®ä¹ä¸è½ä»£çç» appclassloaderï¼å ä¸ºå®æ¯æé¡¶å±çç±»å è½½å¨ãè¿ä¹è§£éäºæ¬èå¼å§çé®é¢ââä¸ºä»ä¹å è½½ spi æå¡æ¶ï¼éè¦æå®ç±»å è½½å¨ classloader å¢ï¼å ä¸ºå¦æä¸æå® classloaderï¼åæ æ³è·å spi æå¡ã\n\nå¦æä¸åä»»ä½çè®¾ç½®ï¼java åºç¨ççº¿ç¨çä¸ä¸æç±»å è½½å¨é»è®¤å°±æ¯ appclassloaderãå¨æ ¸å¿ç±»åºä½¿ç¨ spi æ¥å£æ¶ï¼ä¼ éçç±»å è½½å¨ä½¿ç¨çº¿ç¨ä¸ä¸æç±»å è½½å¨ï¼å°±å¯ä»¥æåçå è½½å° spi å®ç°çç±»ãçº¿ç¨ä¸ä¸æç±»å è½½å¨å¨å¾å¤ spi çå®ç°ä¸­é½ä¼ç¨å°ã\n\néå¸¸å¯ä»¥éè¿ thread.currentthread().getclassloader() å thread.currentthread().getcontextclassloader() è·åçº¿ç¨ä¸ä¸æç±»å è½½å¨ã\n\n\n# java spi çä¸è¶³\n\njava spi å­å¨ä¸äºä¸è¶³ï¼\n\n * ä¸è½æéå è½½ï¼éè¦éåææçå®ç°ï¼å¹¶å®ä¾åï¼ç¶åå¨å¾ªç¯ä¸­æè½æ¾å°æä»¬éè¦çå®ç°ãå¦æä¸æ³ç¨æäºå®ç°ç±»ï¼æèæäºç±»å®ä¾åå¾èæ¶ï¼å®ä¹è¢«è½½å¥å¹¶å®ä¾åäºï¼è¿å°±é æäºæµªè´¹ã\n\n * è·åæä¸ªå®ç°ç±»çæ¹å¼ä¸å¤çµæ´»ï¼åªè½éè¿ iterator å½¢å¼è·åï¼ä¸è½æ ¹æ®æä¸ªåæ°æ¥è·åå¯¹åºçå®ç°ç±»ã\n\n * å¤ä¸ªå¹¶åå¤çº¿ç¨ä½¿ç¨ serviceloader ç±»çå®ä¾æ¯ä¸å®å¨çã\n\n\n# spi åºç¨åºæ¯\n\nspi å¨ java å¼åä¸­åºç¨ååå¹¿æ³ãé¦åï¼å¨ java ç java.util.spi package ä¸­å°±çº¦å®äºå¾å¤ spi æ¥å£ãä¸é¢ï¼åä¸¾ä¸äº spi æ¥å£ï¼\n\n * timezonenameprovider: ä¸º timezone ç±»æä¾æ¬å°åçæ¶åºåç§°ã\n * dateformatprovider: ä¸ºæå®çè¯­è¨ç¯å¢æä¾æ¥æåæ¶é´æ ¼å¼ã\n * numberformatprovider: ä¸º numberformat ç±»æä¾è´§å¸ãæ´æ°åç¾åæ¯å¼ã\n * driver: ä» 4.0 çå¼å§ï¼jdbc api æ¯æ spi æ¨¡å¼ãæ§çæ¬ä½¿ç¨ class.forname() æ¹æ³å è½½é©±å¨ç¨åºã\n * persistenceprovider: æä¾ jpa api çå®ç°ã\n * ç­ç­\n\né¤æ­¤ä»¥å¤ï¼spi è¿æå¾å¤åºç¨ï¼ä¸é¢åä¸¾å ä¸ªç»å¸æ¡ä¾ã\n\n\n# spi åºç¨æ¡ä¾ä¹ jdbc drivermanager\n\nä½ä¸º java å·¥ç¨å¸ï¼å°¤å¶æ¯ crud å·¥ç¨å¸ï¼ç¸å¿é½éå¸¸çæ jdbcãä¼æå¨ç¥ï¼å³ç³»åæ°æ®åºæå¾å¤ç§ï¼å¦ï¼mysqlãoracleãpostgresql ç­ç­ãjdbc å¦ä½è¯å«åç§æ°æ®åºçé©±å¨å¢ï¼\n\n# åå»ºæ°æ®åºè¿æ¥\n\næä»¬ååé¡¾ä¸ä¸ï¼jdbc å¦ä½åå»ºæ°æ®åºè¿æ¥çå¢ï¼\n\nå¨ jdbc4.0 ä¹åï¼è¿æ¥æ°æ®åºçæ¶åï¼éå¸¸ä¼ç¨ class.forname(xxx) æ¹æ³æ¥å è½½æ°æ®åºç¸åºçé©±å¨ï¼ç¶ååè·åæ°æ®åºè¿æ¥ï¼ç»§èè¿è¡ crud ç­æä½ã\n\nclass.forname("com.mysql.jdbc.driver")\n\n\nè jdbc4.0 ä¹åï¼ä¸åéè¦ç¨ class.forname(xxx) æ¹æ³æ¥å è½½æ°æ®åºé©±å¨ï¼ç´æ¥è·åè¿æ¥å°±å¯ä»¥äºãæ¾ç¶ï¼è¿ç§æ¹å¼å¾æ¹ä¾¿ï¼ä½æ¯å¦ä½åå°çå¢ï¼\n\n * jdbc æ¥å£ï¼é¦åï¼java ä¸­åç½®äºæ¥å£ java.sql.driverã\n\n * jdbc æ¥å£å®ç°ï¼åä¸ªæ°æ®åºçé©±å¨èªè¡å®ç° java.sql.driver æ¥å£ï¼ç¨äºç®¡çæ°æ®åºè¿æ¥ã\n   \n   * mysqlï¼å¨ mysql ç java é©±å¨å mysql-connector-java-xxx.jar ä¸­ï¼å¯ä»¥æ¾å° meta-inf/services ç®å½ï¼è¯¥ç®å½ä¸ä¼æä¸ä¸ªåå­ä¸ºjava.sql.driver çæä»¶ï¼æä»¶åå®¹æ¯ com.mysql.cj.jdbc.driverã com.mysql.cj.jdbc.driver æ­£æ¯ mysql çç java.sql.driver å®ç°ãå¦ä¸å¾æç¤ºï¼\n   \n   \n   \n   * postgresql å®ç°ï¼å¨ postgresql ç java é©±å¨å postgresql-42.0.0.jar ä¸­ï¼ä¹å¯ä»¥æ¾å°åæ ·çéç½®æä»¶ï¼æä»¶åå®¹æ¯ org.postgresql.driverï¼org.postgresql.driver æ­£æ¯ postgresql çç java.sql.driver å®ç°ã\n\n * åå»ºæ°æ®åºè¿æ¥\n   \n   ä»¥ mysql ä¸ºä¾ï¼åå»ºæ°æ®åºè¿æ¥ä»£ç å¦ä¸ï¼\n   \n   final string db_url = string.format("jdbc:mysql://%s:%s/%s", db_host, db_port, db_schema);\n   connection = drivermanager.getconnection(db_url, db_user, db_password);\n   \n\n# drivermanager\n\nä»åæï¼æä»¬å·²ç»ç¥é drivermanager æ¯åå»ºæ°æ®åºè¿æ¥çå³é®ãå®ç©¶ç«æ¯å¦ä½å·¥ä½çå¢ï¼\n\nå¯ä»¥çå°æ¯å è½½å®ä¾åé©±å¨çï¼æ¥çç loadinitialdrivers æ¹æ³ï¼\n\nprivate static void loadinitialdrivers() {\n\tstring drivers;\n\ttry {\n\t\tdrivers = accesscontroller.doprivileged(new privilegedaction<string>() {\n\t\t\tpublic string run() {\n\t\t\t\treturn system.getproperty("jdbc.drivers");\n\t\t\t}\n\t\t});\n\t} catch (exception ex) {\n\t\tdrivers = null;\n\t}\n\t// éè¿ classloader è·åææå®ç° java.sql.driver çé©±å¨ç±»\n\taccesscontroller.doprivileged(new privilegedaction<void>() {\n\t\tpublic void run() {\n            // å©ç¨ spiï¼è®°è½½ææ driver æå¡\n\t\t\tserviceloader<driver> loadeddrivers = serviceloader.load(driver.class);\n            // è·åè¿­ä»£å¨\n\t\t\titerator<driver> driversiterator = loadeddrivers.iterator();\n\t\t\ttry{\n                // éåè¿­ä»£å¨\n\t\t\t\twhile(driversiterator.hasnext()) {\n\t\t\t\t\tdriversiterator.next();\n\t\t\t\t}\n\t\t\t} catch(throwable t) {\n\t\t\t// do nothing\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t});\n\n    // æå°æ°æ®åºé©±å¨ä¿¡æ¯\n\tprintln("drivermanager.initialize: jdbc.drivers = " + drivers);\n\n\tif (drivers == null || drivers.equals("")) {\n\t\treturn;\n\t}\n\tstring[] driverslist = drivers.split(":");\n\tprintln("number of drivers:" + driverslist.length);\n\tfor (string adriver : driverslist) {\n\t\ttry {\n\t\t\tprintln("drivermanager.initialize: loading " + adriver);\n            // å°è¯å®ä¾åé©±å¨\n\t\t\tclass.forname(adriver, true,\n\t\t\t\t\tclassloader.getsystemclassloader());\n\t\t} catch (exception ex) {\n\t\t\tprintln("drivermanager.initialize: load failed: " + ex);\n\t\t}\n\t}\n}\n\n\nä¸é¢çä»£ç ä¸»è¦æ­¥éª¤æ¯ï¼\n\n 1. ä»ç³»ç»åéä¸­è·åé©±å¨çå®ç°ç±»ã\n 2. å©ç¨ spi æ¥è·åææé©±å¨çå®ç°ç±»ã\n 3. éåææé©±å¨ï¼å°è¯å®ä¾ååä¸ªå®ç°ç±»ã\n 4. æ ¹æ®ç¬¬ 1 æ­¥è·åå°çé©±å¨åè¡¨æ¥å®ä¾åå·ä½çå®ç°ç±»ã\n\néè¦å³æ³¨çæ¯ä¸é¢è¿è¡ä»£ç ï¼\n\nserviceloader<driver> loadeddrivers = serviceloader.load(driver.class);\n\n\nè¿éå®éè·åçæ¯ java.util.serviceloader.lazyiterator è¿­ä»£å¨ãè°ç¨å¶ hasnext æ¹æ³æ¶ï¼ä¼æç´¢ classpath ä¸ä»¥å jar åä¸­ç meta-inf/services ç®å½ï¼æ¥æ¾ java.sql.driver æä»¶ï¼å¹¶æ¾å°æä»¶ä¸­çé©±å¨å®ç°ç±»çå¨éå®åãè°ç¨å¶ next æ¹æ³æ¶ï¼ä¼æ ¹æ®é©±å¨ç±»çå¨éå®åå»å°è¯å®ä¾åä¸ä¸ªé©±å¨ç±»çå¯¹è±¡ã\n\n\n# spi åºç¨æ¡ä¾ä¹ common-logging\n\ncommon-loggingï¼ä¹ç§° jakarta commons loggingï¼ç¼©å jclï¼æ¯å¸¸ç¨çæ¥å¿é¨é¢å·¥å·åã\n\ncommon-logging çæ ¸å¿ç±»æ¯å¥å£æ¯ logfactoryï¼logfatory æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®è´è´£å è½½å·ä½çæ¥å¿å®ç°ã\n\nå¶å¥å£æ¹æ³æ¯ logfactory.getlog æ¹æ³ï¼æºç å¦ä¸ï¼\n\npublic static log getlog(class clazz) throws logconfigurationexception {\n\treturn getfactory().getinstance(clazz);\n}\n\npublic static log getlog(string name) throws logconfigurationexception {\n\treturn getfactory().getinstance(name);\n}\n\n\nä»ä»¥ä¸æºç å¯ç¥ï¼getlog éç¨äºå·¥åè®¾è®¡æ¨¡å¼ï¼æ¯åè°ç¨ getfactory æ¹æ³è·åå·ä½æ¥å¿åºçå·¥åç±»ï¼ç¶åæ ¹æ®ç±»åç§°æç±»ååå»ºæ¥å¿å®ä¾ã\n\nlogfatory.getfactory æ¹æ³è´è´£éåºå¹éçæ¥å¿å·¥åï¼å¶æºç å¦ä¸ï¼\n\npublic static logfactory getfactory() throws logconfigurationexception {\n\t// çç¥...\n\n\t// å è½½ commons-logging.properties éç½®æä»¶\n\tproperties props = getconfigurationfile(contextclassloader, factory_properties);\n\n\t// çç¥...\n\n    // å³å®åå»ºåªä¸ª logfactory å®ä¾\n\t// ï¼1ï¼å°è¯è¯»åå¨å±å±æ§ org.apache.commons.logging.logfactory\n\tif (isdiagnosticsenabled()) {\n\t\tlogdiagnostic("[lookup] looking for system property [" + factory_property +\n\t\t\t\t\t  "] to define the logfactory subclass to use...");\n\t}\n\n\ttry {\n        // å¦ææå®äº org.apache.commons.logging.logfactory å±æ§ï¼å°è¯å®ä¾åå·ä½å®ç°ç±»\n\t\tstring factoryclass = getsystemproperty(factory_property, null);\n\t\tif (factoryclass != null) {\n\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\tlogdiagnostic("[lookup] creating an instance of logfactory class \'" + factoryclass +\n\t\t\t\t\t\t\t  "\' as specified by system property " + factory_property);\n\t\t\t}\n\t\t\tfactory = newfactory(factoryclass, baseclassloader, contextclassloader);\n\t\t} else {\n\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\tlogdiagnostic("[lookup] no system property [" + factory_property + "] defined.");\n\t\t\t}\n\t\t}\n\t} catch (securityexception e) {\n\t    // å¼å¸¸å¤ç\n\t} catch (runtimeexception e) {\n\t    // å¼å¸¸å¤ç\n\t}\n\n    // ï¼2ï¼å©ç¨ java spi æºå¶ï¼å°è¯å¨ classpatch ç meta-inf/services ç®å½ä¸å¯»æ¾ org.apache.commons.logging.logfactory å®ç°ç±»\n\tif (factory == null) {\n\t\tif (isdiagnosticsenabled()) {\n\t\t\tlogdiagnostic("[lookup] looking for a resource file of name [" + service_id +\n\t\t\t\t\t\t  "] to define the logfactory subclass to use...");\n\t\t}\n\t\ttry {\n\t\t\tfinal inputstream is = getresourceasstream(contextclassloader, service_id);\n\n\t\t\tif( is != null ) {\n\t\t\t\t// this code is needed by ebcdic and other strange systems.\n\t\t\t\t// it\'s a fix for bugs reported in xerces\n\t\t\t\tbufferedreader rd;\n\t\t\t\ttry {\n\t\t\t\t\trd = new bufferedreader(new inputstreamreader(is, "utf-8"));\n\t\t\t\t} catch (java.io.unsupportedencodingexception e) {\n\t\t\t\t\trd = new bufferedreader(new inputstreamreader(is));\n\t\t\t\t}\n\n\t\t\t\tstring factoryclassname = rd.readline();\n\t\t\t\trd.close();\n\n\t\t\t\tif (factoryclassname != null && ! "".equals(factoryclassname)) {\n\t\t\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\t\t\tlogdiagnostic("[lookup]  creating an instance of logfactory class " +\n\t\t\t\t\t\t\t\t\t  factoryclassname +\n\t\t\t\t\t\t\t\t\t  " as specified by file \'" + service_id +\n\t\t\t\t\t\t\t\t\t  "\' which was present in the path of the context classloader.");\n\t\t\t\t\t}\n\t\t\t\t\tfactory = newfactory(factoryclassname, baseclassloader, contextclassloader );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// is == null\n\t\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\t\tlogdiagnostic("[lookup] no resource file with name \'" + service_id + "\' found.");\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (exception ex) {\n\t\t\t// note: if the specified logfactory class wasn\'t compatible with logfactory\n\t\t\t// for some reason, a classcastexception will be caught here, and attempts will\n\t\t\t// continue to find a compatible class.\n\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\tlogdiagnostic(\n\t\t\t\t\t"[lookup] a security exception occurred while trying to create an" +\n\t\t\t\t\t" instance of the custom factory class" +\n\t\t\t\t\t": [" + trim(ex.getmessage()) +\n\t\t\t\t\t"]. trying alternative implementations...");\n\t\t\t}\n\t\t\t// ignore\n\t\t}\n\t}\n\n\t// ï¼3ï¼å°è¯ä» classpath ç®å½ä¸ç commons-logging.properties æä»¶ä¸­æ¥æ¾ org.apache.commons.logging.logfactory å±æ§\n\n\tif (factory == null) {\n\t\tif (props != null) {\n\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\tlogdiagnostic(\n\t\t\t\t\t"[lookup] looking in properties file for entry with key \'" + factory_property +\n\t\t\t\t\t"\' to define the logfactory subclass to use...");\n\t\t\t}\n\t\t\tstring factoryclass = props.getproperty(factory_property);\n\t\t\tif (factoryclass != null) {\n\t\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\t\tlogdiagnostic(\n\t\t\t\t\t\t"[lookup] properties file specifies logfactory subclass \'" + factoryclass + "\'");\n\t\t\t\t}\n\t\t\t\tfactory = newfactory(factoryclass, baseclassloader, contextclassloader);\n\n\t\t\t\t// todo: think about whether we need to handle exceptions from newfactory\n\t\t\t} else {\n\t\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\t\tlogdiagnostic("[lookup] properties file has no entry specifying logfactory subclass.");\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (isdiagnosticsenabled()) {\n\t\t\t\tlogdiagnostic("[lookup] no properties file available to determine" + " logfactory subclass from..");\n\t\t\t}\n\t\t}\n\t}\n\n\t// ï¼4ï¼ä»¥ä¸æåµé½ä¸æ»¡è¶³ï¼å®ä¾åé»è®¤å®ç°ç±» org.apache.commons.logging.impl.logfactoryimpl\n\n\tif (factory == null) {\n\t\tif (isdiagnosticsenabled()) {\n\t\t\tlogdiagnostic(\n\t\t\t\t"[lookup] loading the default logfactory implementation \'" + factory_default +\n\t\t\t\t"\' via the same classloader that loaded this logfactory" +\n\t\t\t\t" class (ie not looking in the context classloader).");\n\t\t}\n\n\t\tfactory = newfactory(factory_default, thisclassloader, contextclassloader);\n\t}\n\n\tif (factory != null) {\n\t\t/**\n\t\t * always cache using context class loader.\n\t\t */\n\t\tcachefactory(contextclassloader, factory);\n\n\t\tif (props != null) {\n\t\t\tenumeration names = props.propertynames();\n\t\t\twhile (names.hasmoreelements()) {\n\t\t\t\tstring name = (string) names.nextelement();\n\t\t\t\tstring value = props.getproperty(name);\n\t\t\t\tfactory.setattribute(name, value);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn factory;\n}\n\n\nä» getfactory æ¹æ³çæºç å¯ä»¥çåºï¼å¶æ ¸å¿é»è¾åä¸º 4 æ­¥ï¼\n\n 1. é¦åï¼å°è¯æ¥æ¾å¨å±å±æ§ org.apache.commons.logging.logfactoryï¼å¦ææå®äºå·ä½ç±»ï¼å°è¯åå»ºå®ä¾ã\n 2. å©ç¨ java spi æºå¶ï¼å°è¯å¨ classpatch ç meta-inf/services ç®å½ä¸å¯»æ¾ org.apache.commons.logging.logfactory çå®ç°ç±»ã\n 3. å°è¯ä» classpath ç®å½ä¸ç commons-logging.properties æä»¶ä¸­æ¥æ¾ org.apache.commons.logging.logfactory å±æ§ï¼å¦ææå®äºå·ä½ç±»ï¼å°è¯åå»ºå®ä¾ã\n 4. ä»¥ä¸æåµå¦æé½ä¸æ»¡è¶³ï¼åå®ä¾åé»è®¤å®ç°ç±»ï¼å³ org.apache.commons.logging.impl.logfactoryimplã\n\n\n# spi åºç¨æ¡ä¾ä¹ spring boot\n\nspring boot æ¯åºäº spring æå»ºçæ¡æ¶ï¼å¶è®¾è®¡ç®çå¨äºç®å spring åºç¨çéç½®ãè¿è¡ãå¨ spring boot ä¸­ï¼å¤§éè¿ç¨äºèªå¨è£éæ¥å°½å¯è½åå°éç½®ã\n\nä¸é¢æ¯ä¸ä¸ª spring boot å¥å£ç¤ºä¾ï¼å¯ä»¥çå°ï¼ä»£ç éå¸¸ç®æ´ã\n\nimport org.springframework.boot.springapplication;\nimport org.springframework.boot.autoconfigure.springbootapplication;\nimport org.springframework.web.bind.annotation.getmapping;\nimport org.springframework.web.bind.annotation.requestparam;\nimport org.springframework.web.bind.annotation.restcontroller;\n\n@springbootapplication\n@restcontroller\npublic class demoapplication {\n\n    public static void main(string[] args) {\n    \t\tspringapplication.run(demoapplication.class, args);\n    }\n\n    @getmapping("/hello")\n    public string hello(@requestparam(value = "name", defaultvalue = "world") string name) {\n    \t\treturn string.format("hello %s!", name);\n    }\n}\n\n\né£ä¹ï¼spring boot æ¯å¦ä½åå°å¯¥å¯¥å è¡ä»£ç ï¼å°±å¯ä»¥è¿è¡ä¸ä¸ª spring boot åºç¨çå¢ãæä»¬ä¸å¦¨å¸¦ççé®ï¼ä»æºç å¥æï¼ä¸æ­¥æ­¥æ¢ç©¶å¶åçã\n\n# @springbootapplication æ³¨è§£\n\né¦åï¼spring boot åºç¨çå¯å¨ç±»ä¸é½ä¼æ è®°ä¸ä¸ª @springbootapplication æ³¨è§£ã@springbootapplication æ³¨è§£å®ä¹å¦ä¸ï¼\n\n@target({elementtype.type})\n@retention(retentionpolicy.runtime)\n@documented\n@inherited\n@springbootconfiguration\n@enableautoconfiguration\n@componentscan(\n    excludefilters = {@filter(\n    type = filtertype.custom,\n    classes = {typeexcludefilter.class}\n), @filter(\n    type = filtertype.custom,\n    classes = {autoconfigurationexcludefilter.class}\n)}\n)\npublic @interface springbootapplication {\n\t\t// ç¥\n}\n\n\né¤äº @targetã @retentionã@documentedã@inherited è¿å ä¸ªåæ³¨è§£ï¼ @springbootapplication æ³¨è§£çå®ä¹ä¸­è¿æ è®°äº @springbootconfigurationã@enableautoconfigurationã@componentscan ä¸ä¸ªæ³¨è§£ã\n\n# @springbootconfiguration æ³¨è§£\n\nä»@springbootconfiguration æ³¨è§£çå®ä¹æ¥çï¼@springbootconfiguration æ³¨è§£æ¬è´¨ä¸å°±æ¯ä¸ä¸ª @configuration æ³¨è§£ï¼è¿æå³çè¢«@springbootconfiguration æ³¨è§£ä¿®é¥°çç±»ä¼è¢« spring boot è¯å«ä¸ºä¸ä¸ªéç½®ç±»ã\n\n@target({elementtype.type})\n@retention(retentionpolicy.runtime)\n@documented\n@configuration\npublic @interface springbootconfiguration {\n    @aliasfor(\n        annotation = configuration.class\n    )\n    boolean proxybeanmethods() default true;\n}\n\n\n# @enableautoconfiguration æ³¨è§£\n\n@enableautoconfiguration æ³¨è§£å®ä¹å¦ä¸ï¼\n\n@target({elementtype.type})\n@retention(retentionpolicy.runtime)\n@documented\n@inherited\n@autoconfigurationpackage\n@import({autoconfigurationimportselector.class})\npublic @interface enableautoconfiguration {\n    string enabled_override_property = "spring.boot.enableautoconfiguration";\n\n    class<?>[] exclude() default {};\n\n    string[] excludename() default {};\n}\n\n\n@enableautoconfiguration æ³¨è§£åå«äº @autoconfigurationpackage ä¸ @import({autoconfigurationimportselector.class}) ä¸¤ä¸ªæ³¨è§£ã\n\n# @autoconfigurationpackage æ³¨è§£\n\n@autoconfigurationpackage ä¼å°è¢«ä¿®é¥°çç±»ä½ä¸ºä¸»éç½®ç±»ï¼è¯¥ç±»æå¨ç package ä¼è¢«è§ä¸ºæ ¹è·¯å¾ï¼spring boot é»è®¤ä¼èªå¨æ«ææ ¹è·¯å¾ä¸çææ spring beanï¼è¢« @component ä»¥åç»§æ¿ @component çåä¸ªæ³¨è§£æä¿®é¥°çç±»ï¼ãââè¿å°±æ¯ä¸ºä»ä¹ spring boot çå¯å¨ç±»ä¸è¬è¦ç½®äºæ ¹è·¯å¾çåå ãè¿ä¸ªåè½ç­åäºå¨ spring xml éç½®ä¸­éè¿ context:component-scan æ¥æå®æ«æè·¯å¾ã@import æ³¨è§£çä½ç¨æ¯å spring å®¹å¨ä¸­ç´æ¥æ³¨å¥æå®ç»ä»¶ã@autoconfigurationpackage æ³¨è§£ä¸­æ³¨æäº @import({registrar.class})ãregistrar ç±»ç¨äºä¿å­ spring boot çå¥å£ç±»ãæ ¹è·¯å¾ç­ä¿¡æ¯ã\n\n# springfactoriesloader.loadfactorynames æ¹æ³\n\n@import(autoconfigurationimportselector.class) è¡¨ç¤ºç´æ¥æ³¨å¥ autoconfigurationimportselectorãautoconfigurationimportselector æä¸ä¸ªæ ¸å¿æ¹æ³ getcandidateconfigurations ç¨äºè·ååééç½®ãè¯¥æ¹æ³è°ç¨äº springfactoriesloader.loadfactorynames æ¹æ³ï¼è¿ä¸ªæ¹æ³å³ä¸º spring boot spi çå³é®ï¼å®è´è´£å è½½ææ meta-inf/spring.factories æä»¶ï¼å è½½çè¿ç¨ç± springfactoriesloader è´è´£ã\n\nspring boot ç meta-inf/spring.factories æä»¶æ¬è´¨ä¸å°±æ¯ä¸ä¸ª properties æä»¶ï¼æ°æ®åå®¹å°±æ¯ä¸ä¸ªä¸ªé®å¼å¯¹ã\n\nspringfactoriesloader.loadfactorynames æ¹æ³çå³é®æºç ï¼\n\n// spring.factories æä»¶çæ ¼å¼ä¸ºï¼key=value1,value2,value3\n// éåææ meta-inf/spring.factories æä»¶\n// è§£ææä»¶ï¼è·å¾ key=factoryclass çç±»åç§°\npublic static list<string> loadfactorynames(class<?> factorytype, @nullable classloader classloader) {\n\tstring factorytypename = factorytype.getname();\n\treturn loadspringfactories(classloader).getordefault(factorytypename, collections.emptylist());\n}\n\nprivate static map<string, list<string>> loadspringfactories(@nullable classloader classloader) {\n  // å°è¯è·åç¼å­ï¼å¦æç¼å­ä¸­ææ°æ®ï¼ç´æ¥è¿å\n\tmultivaluemap<string, string> result = cache.get(classloader);\n\tif (result != null) {\n\t\treturn result;\n\t}\n\n\ttry {\n    // è·åèµæºæä»¶è·¯å¾\n\t\tenumeration<url> urls = (classloader != null ?\n\t\t\t\tclassloader.getresources(factories_resource_location) :\n\t\t\t\tclassloader.getsystemresources(factories_resource_location));\n\t\tresult = new linkedmultivaluemap<>();\n    // éåææè·¯å¾\n\t\twhile (urls.hasmoreelements()) {\n\t\t\turl url = urls.nextelement();\n\t\t\turlresource resource = new urlresource(url);\n      // è§£ææä»¶ï¼å¾å°å¯¹åºçä¸ç» properties\n\t\t\tproperties properties = propertiesloaderutils.loadproperties(resource);\n      // éåè§£æåºç propertiesï¼ç»è£æ°æ®\n\t\t\tfor (map.entry<?, ?> entry : properties.entryset()) {\n\t\t\t\tstring factorytypename = ((string) entry.getkey()).trim();\n\t\t\t\tfor (string factoryimplementationname : stringutils.commadelimitedlisttostringarray((string) entry.getvalue())) {\n\t\t\t\t\tresult.add(factorytypename, factoryimplementationname.trim());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcache.put(classloader, result);\n\t\treturn result;\n\t}\n\tcatch (ioexception ex) {\n\t\tthrow new illegalargumentexception("unable to load factories from location [" +\n\t\t\t\tfactories_resource_location + "]", ex);\n\t}\n}\n\n\nå½çº³ä¸é¢çæ¹æ³ï¼ä¸»è¦ä½äºè¿äºäºï¼\n\nå è½½ææ meta-inf/spring.factories æä»¶ï¼å è½½è¿ç¨æ springfactoriesloader è´è´£ã\n\n * å¨ classpath ä¸­æå¯»ææ meta-inf/spring.factories éç½®æä»¶\n * ç¶åï¼è§£æ spring.factories æä»¶ï¼è·åæå®èªå¨è£éç±»çå¨éå®å\n\n# spring boot ç autoconfiguration ç±»\n\nspring boot æåç§ starter åï¼å¯ä»¥æ ¹æ®å®éé¡¹ç®éè¦ï¼æéåæãå¨é¡¹ç®å¼åä¸­ï¼åªè¦å° starter åå¼å¥ï¼æä»¬å°±å¯ä»¥ç¨å¾å°çéç½®ï¼çè³ä»ä¹é½ä¸éç½®ï¼å³å¯è·åç¸å³çè½åãéè¿åé¢ç spring boot spi æµç¨ï¼åªå®æäºèªå¨è£éå·¥ä½çä¸åï¼å©ä¸çå·¥ä½å¦ä½å¤çå¢ ï¼\n\nä»¥ spring-boot-starter-web ç jar åä¸ºä¾ï¼æ¥çå¶ maven pomï¼å¯ä»¥çå°ï¼å®ä¾èµäº spring-boot-starterï¼ææ spring boot å®æ¹ starter åé½ä¼ä¾èµäºè¿ä¸ª jar åãè spring-boot-starter åä¾èµäº spring-boot-autoconfigureï¼spring boot çèªå¨è£éç§å¯ï¼å°±å¨äºè¿ä¸ª jar åã\n\nä» spring-boot-autoconfigure åçç»ææ¥çï¼å®æä¸ä¸ª meta-inf/spring.factories ï¼æ¾ç¶å©ç¨äº spring boot spiï¼æ¥èªå¨è£éå¶ä¸­çéç½®ç±»ã\n\n\n\nä¸å¾æ¯ spring-boot-autoconfigure ç meta-inf/spring.factories æä»¶çé¨ååå®¹ï¼å¯ä»¥çå°å¶ä¸­æ³¨åäºä¸é¿ä¸²ä¼è¢«èªå¨å è½½ç autoconfiguration ç±»ã\n\n\n\nä»¥ redisautoconfiguration ä¸ºä¾ï¼è¿ä¸ªéç½®ç±»ä¸­ï¼ä¼æ ¹æ® @conditionalxxx ä¸­çæ¡ä»¶å»å³å®æ¯å¦å®ä¾åå¯¹åºç beanï¼å®ä¾å bean æä¾èµçéè¦åæ°åéè¿ redisproperties ä¼ å¥ã\n\n\n\nredisproperties ä¸­ç»´æ¤äº redis è¿æ¥æéè¦çå³é®å±æ§ï¼åªè¦å¨ yml æ properties éç½®æä»¶ä¸­ï¼æå® spring.redis å¼å¤´çå±æ§ï¼é½ä¼è¢«èªå¨è£è½½å° redisproperties å®ä¾ä¸­ã\n\n\n\néè¿ä»¥ä¸åæï¼å·²ç»ä¸æ­¥æ­¥è§£è¯»åº spring boot èªå¨è£è½½çåçã\n\n\n# spi åºç¨æ¡ä¾ä¹ dubbo\n\ndubbo å¹¶æªä½¿ç¨ java spiï¼èæ¯èªå·±å°è£äºä¸å¥æ°ç spi æºå¶ãdubbo spi æéçéç½®æä»¶éæ¾ç½®å¨ meta-inf/dubbo è·¯å¾ä¸ï¼éç½®åå®¹å½¢å¼å¦ä¸ï¼\n\noptimusprime = org.apache.spi.optimusprime\nbumblebee = org.apache.spi.bumblebee\n\n\nä¸ java spi å®ç°ç±»éç½®ä¸åï¼dubbo spi æ¯éè¿é®å¼å¯¹çæ¹å¼è¿è¡éç½®ï¼è¿æ ·å¯ä»¥æéå è½½æå®çå®ç°ç±»ãdubbo spi é¤äºæ¯ææéå è½½æ¥å£å®ç°ç±»ï¼è¿å¢å äº ioc å aop ç­ç¹æ§ã\n\n# extensionloader å¥å£\n\ndubbo spi çç¸å³é»è¾è¢«å°è£å¨äº extensionloader ç±»ä¸­ï¼éè¿ extensionloaderï¼å¯ä»¥å è½½æå®çå®ç°ç±»ã\n\nextensionloader ç getextension æ¹æ³æ¯å¶å¥å£æ¹æ³ï¼å¶æºç å¦ä¸ï¼\n\npublic t getextension(string name) {\n    if (name == null || name.length() == 0)\n        throw new illegalargumentexception("extension name == null");\n    if ("true".equals(name)) {\n        // è·åé»è®¤çæå±å®ç°ç±»\n        return getdefaultextension();\n    }\n    // holderï¼é¡¾åæä¹ï¼ç¨äºææç®æ å¯¹è±¡\n    holder<object> holder = cachedinstances.get(name);\n    if (holder == null) {\n        cachedinstances.putifabsent(name, new holder<object>());\n        holder = cachedinstances.get(name);\n    }\n    object instance = holder.get();\n    // åéæ£æ¥\n    if (instance == null) {\n        synchronized (holder) {\n            instance = holder.get();\n            if (instance == null) {\n                // åå»ºæå±å®ä¾\n                instance = createextension(name);\n                // è®¾ç½®å®ä¾å° holder ä¸­\n                holder.set(instance);\n            }\n        }\n    }\n    return (t) instance;\n}\n\n\nå¯ä»¥çåºï¼è¿ä¸ªæ¹æ³çä½ç¨å°±æ¯ï¼é¦åæ£æ¥ç¼å­ï¼ç¼å­æªå½ä¸­åè°ç¨ createextension æ¹æ³åå»ºæå±å¯¹è±¡ãé£ä¹ï¼createextension æ¯å¦ä½åå»ºæå±å¯¹è±¡çå¢ï¼å¶æºç å¦ä¸ï¼\n\nprivate t createextension(string name) {\n    // ä»éç½®æä»¶ä¸­å è½½ææçæå±ç±»ï¼å¯å¾å°âéç½®é¡¹åç§°âå°âéç½®ç±»âçæ å°å³ç³»è¡¨\n    class<?> clazz = getextensionclasses().get(name);\n    if (clazz == null) {\n        throw findexception(name);\n    }\n    try {\n        t instance = (t) extension_instances.get(clazz);\n        if (instance == null) {\n            // éè¿åå°åå»ºå®ä¾\n            extension_instances.putifabsent(clazz, clazz.newinstance());\n            instance = (t) extension_instances.get(clazz);\n        }\n        // åå®ä¾ä¸­æ³¨å¥ä¾èµ\n        injectextension(instance);\n        set<class<?>> wrapperclasses = cachedwrapperclasses;\n        if (wrapperclasses != null && !wrapperclasses.isempty()) {\n            // å¾ªç¯åå»º wrapper å®ä¾\n            for (class<?> wrapperclass : wrapperclasses) {\n                // å°å½å instance ä½ä¸ºåæ°ä¼ ç» wrapper çæé æ¹æ³ï¼å¹¶éè¿åå°åå»º wrapper å®ä¾ã\n                // ç¶åå wrapper å®ä¾ä¸­æ³¨å¥ä¾èµï¼æåå° wrapper å®ä¾åæ¬¡èµå¼ç» instance åé\n                instance = injectextension(\n                    (t) wrapperclass.getconstructor(type).newinstance(instance));\n            }\n        }\n        return instance;\n    } catch (throwable t) {\n        throw new illegalstateexception("...");\n    }\n}\n\n\ncreateextension æ¹æ³ççå·¥ä½æ­¥éª¤å¯ä»¥å½çº³ä¸ºï¼\n\n 1. éè¿ getextensionclasses è·åææçæå±ç±»\n 2. éè¿åå°åå»ºæå±å¯¹è±¡\n 3. åæå±å¯¹è±¡ä¸­æ³¨å¥ä¾èµ\n 4. å°æå±å¯¹è±¡åè£¹å¨ç¸åºç wrapper å¯¹è±¡ä¸­\n\nä»¥ä¸æ­¥éª¤ä¸­ï¼ç¬¬ä¸ä¸ªæ­¥éª¤æ¯å è½½æå±ç±»çå³é®ï¼ç¬¬ä¸åç¬¬åä¸ªæ­¥éª¤æ¯ dubbo ioc ä¸ aop çå·ä½å®ç°ã\n\n# è·åææçæå±ç±»\n\ndubbo å¨éè¿åç§°è·åæå±ç±»ä¹åï¼é¦åéè¦æ ¹æ®éç½®æä»¶è§£æåºæå±é¡¹åç§°å°æå±ç±»çæ å°å³ç³»è¡¨ï¼map<åç§°, æå±ç±»>ï¼ï¼ä¹ååæ ¹æ®æå±é¡¹åç§°ä»æ å°å³ç³»è¡¨ä¸­ååºç¸åºçæå±ç±»å³å¯ãç¸å³è¿ç¨çä»£ç åæå¦ä¸ï¼\n\nprivate map<string, class<?>> getextensionclasses() {\n    // ä»ç¼å­ä¸­è·åå·²å è½½çæå±ç±»\n    map<string, class<?>> classes = cachedclasses.get();\n    // åéæ£æ¥\n    if (classes == null) {\n        synchronized (cachedclasses) {\n            classes = cachedclasses.get();\n            if (classes == null) {\n                // å è½½æå±ç±»\n                classes = loadextensionclasses();\n                cachedclasses.set(classes);\n            }\n        }\n    }\n    return classes;\n}\n\n\nè¿éä¹æ¯åæ£æ¥ç¼å­ï¼è¥ç¼å­æªå½ä¸­ï¼åéè¿ synchronized å éãå éååæ¬¡æ£æ¥ç¼å­ï¼å¹¶å¤ç©ºãæ­¤æ¶å¦æ classes ä»ä¸º nullï¼åéè¿ loadextensionclasses å è½½æå±ç±»ãä¸é¢åæ loadextensionclasses æ¹æ³çé»è¾ã\n\nprivate map<string, class<?>> loadextensionclasses() {\n    // è·å spi æ³¨è§£ï¼è¿éç type åéæ¯å¨è°ç¨ getextensionloader æ¹æ³æ¶ä¼ å¥ç\n    final spi defaultannotation = type.getannotation(spi.class);\n    if (defaultannotation != null) {\n        string value = defaultannotation.value();\n        if ((value = value.trim()).length() > 0) {\n            // å¯¹ spi æ³¨è§£åå®¹è¿è¡åå\n            string[] names = name_separator.split(value);\n            // æ£æµ spi æ³¨è§£åå®¹æ¯å¦åæ³ï¼ä¸åæ³åæåºå¼å¸¸\n            if (names.length > 1) {\n                throw new illegalstateexception("more than 1 default extension name on extension...");\n            }\n\n            // è®¾ç½®é»è®¤åç§°ï¼åè getdefaultextension æ¹æ³\n            if (names.length == 1) {\n                cacheddefaultname = names[0];\n            }\n        }\n    }\n\n    map<string, class<?>> extensionclasses = new hashmap<string, class<?>>();\n    // å è½½æå®æä»¶å¤¹ä¸çéç½®æä»¶\n    loaddirectory(extensionclasses, dubbo_internal_directory);\n    loaddirectory(extensionclasses, dubbo_directory);\n    loaddirectory(extensionclasses, services_directory);\n    return extensionclasses;\n}\n\n\nloadextensionclasses æ¹æ³æ»å±åäºä¸¤ä»¶äºæï¼ä¸æ¯å¯¹ spi æ³¨è§£è¿è¡è§£æï¼äºæ¯è°ç¨ loaddirectory æ¹æ³å è½½æå®æä»¶å¤¹éç½®æä»¶ãspi æ³¨è§£è§£æè¿ç¨æ¯è¾ç®åï¼æ éå¤è¯´ãä¸é¢æä»¬æ¥çä¸ä¸ loaddirectory åäºåªäºäºæã\n\nprivate void loaddirectory(map<string, class<?>> extensionclasses, string dir) {\n    // filename = æä»¶å¤¹è·¯å¾ + type å¨éå®å\n    string filename = dir + type.getname();\n    try {\n        enumeration<java.net.url> urls;\n        classloader classloader = findclassloader();\n        // æ ¹æ®æä»¶åå è½½ææçååæä»¶\n        if (classloader != null) {\n            urls = classloader.getresources(filename);\n        } else {\n            urls = classloader.getsystemresources(filename);\n        }\n        if (urls != null) {\n            while (urls.hasmoreelements()) {\n                java.net.url resourceurl = urls.nextelement();\n                // å è½½èµæº\n                loadresource(extensionclasses, classloader, resourceurl);\n            }\n        }\n    } catch (throwable t) {\n        logger.error("...");\n    }\n}\n\n\nloaddirectory æ¹æ³åéè¿ classloader è·åææèµæºé¾æ¥ï¼ç¶ååéè¿ loadresource æ¹æ³å è½½èµæºãæä»¬ç»§ç»­è·ä¸å»ï¼çä¸ä¸ loadresource æ¹æ³çå®ç°ã\n\nprivate void loadresource(map<string, class<?>> extensionclasses,\n\tclassloader classloader, java.net.url resourceurl) {\n    try {\n        bufferedreader reader = new bufferedreader(\n            new inputstreamreader(resourceurl.openstream(), "utf-8"));\n        try {\n            string line;\n            // æè¡è¯»åéç½®åå®¹\n            while ((line = reader.readline()) != null) {\n                // å®ä½ # å­ç¬¦\n                final int ci = line.indexof(\'#\');\n                if (ci >= 0) {\n                    // æªå # ä¹åçå­ç¬¦ä¸²ï¼# ä¹åçåå®¹ä¸ºæ³¨éï¼éè¦å¿½ç¥\n                    line = line.substring(0, ci);\n                }\n                line = line.trim();\n                if (line.length() > 0) {\n                    try {\n                        string name = null;\n                        int i = line.indexof(\'=\');\n                        if (i > 0) {\n                            // ä»¥ç­äºå· = ä¸ºçï¼æªåé®ä¸å¼\n                            name = line.substring(0, i).trim();\n                            line = line.substring(i + 1).trim();\n                        }\n                        if (line.length() > 0) {\n                            // å è½½ç±»ï¼å¹¶éè¿ loadclass æ¹æ³å¯¹ç±»è¿è¡ç¼å­\n                            loadclass(extensionclasses, resourceurl,\n                                      class.forname(line, true, classloader), name);\n                        }\n                    } catch (throwable t) {\n                        illegalstateexception e = new illegalstateexception("failed to load extension class...");\n                    }\n                }\n            }\n        } finally {\n            reader.close();\n        }\n    } catch (throwable t) {\n        logger.error("exception when load extension class...");\n    }\n}\n\n\nloadresource æ¹æ³ç¨äºè¯»ååè§£æéç½®æä»¶ï¼å¹¶éè¿åå°å è½½ç±»ï¼æåè°ç¨ loadclass æ¹æ³è¿è¡å¶ä»æä½ãloadclass æ¹æ³ç¨äºä¸»è¦ç¨äºæä½ç¼å­ï¼è¯¥æ¹æ³çé»è¾å¦ä¸ï¼\n\nprivate void loadclass(map<string, class<?>> extensionclasses, java.net.url resourceurl,\n    class<?> clazz, string name) throws nosuchmethodexception {\n\n    if (!type.isassignablefrom(clazz)) {\n        throw new illegalstateexception("...");\n    }\n\n    // æ£æµç®æ ç±»ä¸æ¯å¦æ adaptive æ³¨è§£\n    if (clazz.isannotationpresent(adaptive.class)) {\n        if (cachedadaptiveclass == null) {\n            // è®¾ç½® cachedadaptiveclassç¼å­\n            cachedadaptiveclass = clazz;\n        } else if (!cachedadaptiveclass.equals(clazz)) {\n            throw new illegalstateexception("...");\n        }\n\n    // æ£æµ clazz æ¯å¦æ¯ wrapper ç±»å\n    } else if (iswrapperclass(clazz)) {\n        set<class<?>> wrappers = cachedwrapperclasses;\n        if (wrappers == null) {\n            cachedwrapperclasses = new concurrenthashset<class<?>>();\n            wrappers = cachedwrapperclasses;\n        }\n        // å­å¨ clazz å° cachedwrapperclasses ç¼å­ä¸­\n        wrappers.add(clazz);\n\n    // ç¨åºè¿å¥æ­¤åæ¯ï¼è¡¨æ clazz æ¯ä¸ä¸ªæ®éçæå±ç±»\n    } else {\n        // æ£æµ clazz æ¯å¦æé»è®¤çæé æ¹æ³ï¼å¦ææ²¡æï¼åæåºå¼å¸¸\n        clazz.getconstructor();\n        if (name == null || name.length() == 0) {\n            // å¦æ name ä¸ºç©ºï¼åå°è¯ä» extension æ³¨è§£ä¸­è·å nameï¼æä½¿ç¨å°åçç±»åä½ä¸º name\n            name = findannotationname(clazz);\n            if (name.length() == 0) {\n                throw new illegalstateexception("...");\n            }\n        }\n        // åå name\n        string[] names = name_separator.split(name);\n        if (names != null && names.length > 0) {\n            activate activate = clazz.getannotation(activate.class);\n            if (activate != null) {\n                // å¦æç±»ä¸æ activate æ³¨è§£ï¼åä½¿ç¨ names æ°ç»çç¬¬ä¸ä¸ªåç´ ä½ä¸ºé®ï¼\n                // å­å¨ name å° activate æ³¨è§£å¯¹è±¡çæ å°å³ç³»\n                cachedactivates.put(names[0], activate);\n            }\n            for (string n : names) {\n                if (!cachednames.containskey(clazz)) {\n                    // å­å¨ class å°åç§°çæ å°å³ç³»\n                    cachednames.put(clazz, n);\n                }\n                class<?> c = extensionclasses.get(n);\n                if (c == null) {\n                    // å­å¨åç§°å° class çæ å°å³ç³»\n                    extensionclasses.put(n, clazz);\n                } else if (c != clazz) {\n                    throw new illegalstateexception("...");\n                }\n            }\n        }\n    }\n}\n\n\nå¦ä¸ï¼loadclass æ¹æ³æä½äºä¸åçç¼å­ï¼æ¯å¦ cachedadaptiveclassãcachedwrapperclasses å cachednames ç­ç­ãé¤æ­¤ä¹å¤ï¼è¯¥æ¹æ³æ²¡æå¶ä»ä»ä¹é»è¾äºã\n\n\n# åèèµæ\n\n * java spi ææ³æ¢³ç\n * dubbo spi\n * springboot ä¸­ spi æºå¶\n * springboot çèªå¨è£éåçãèªå®ä¹ starter ä¸ spi æºå¶ï¼ä¸ç½æå°½',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å®¹å¨ç®ä»",frontmatter:{title:"Java å®¹å¨ç®ä»",date:"2019-12-29T21:49:58.000Z",categories:["Java","JavaSE","å®¹å¨"],tags:["Java","JavaSE","å®¹å¨"],permalink:"/pages/1cadba/"},regularPath:"/01.Java/01.JavaSE/03.%E5%AE%B9%E5%99%A8/01.Java%E5%AE%B9%E5%99%A8%E7%AE%80%E4%BB%8B.html",relativePath:"01.Java/01.JavaSE/03.å®¹å¨/01.Javaå®¹å¨ç®ä».md",key:"v-3f95b793",path:"/pages/1cadba/",headers:[{level:2,title:"å®¹å¨ç®ä»",slug:"å®¹å¨ç®ä»",normalizedTitle:"å®¹å¨ç®ä»",charIndex:7},{level:3,title:"æ°ç»ä¸å®¹å¨",slug:"æ°ç»ä¸å®¹å¨",normalizedTitle:"æ°ç»ä¸å®¹å¨",charIndex:27},{level:3,title:"å®¹å¨æ¡æ¶",slug:"å®¹å¨æ¡æ¶",normalizedTitle:"å®¹å¨æ¡æ¶",charIndex:246},{level:2,title:"å®¹å¨çåºæ¬æºå¶",slug:"å®¹å¨çåºæ¬æºå¶",normalizedTitle:"å®¹å¨çåºæ¬æºå¶",charIndex:501},{level:3,title:"æ³å",slug:"æ³å",normalizedTitle:"æ³å",charIndex:584},{level:3,title:"Iterable å Iterator",slug:"iterable-å-iterator",normalizedTitle:"iterable å iterator",charIndex:1024},{level:3,title:"Comparable å Comparator",slug:"comparable-å-comparator",normalizedTitle:"comparable å comparator",charIndex:2289},{level:3,title:"Cloneable",slug:"cloneable",normalizedTitle:"cloneable",charIndex:3353},{level:3,title:"fail-fast",slug:"fail-fast",normalizedTitle:"fail-fast",charIndex:3642},{level:4,title:"fail-fast çè¦ç¹",slug:"fail-fast-çè¦ç¹",normalizedTitle:"fail-fast çè¦ç¹",charIndex:3655},{level:4,title:"è§£å³ fail-fast",slug:"è§£å³-fail-fast",normalizedTitle:"è§£å³ fail-fast",charIndex:5576},{level:2,title:"å®¹å¨åçº¿ç¨å®å¨",slug:"å®¹å¨åçº¿ç¨å®å¨",normalizedTitle:"å®¹å¨åçº¿ç¨å®å¨",charIndex:5768},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5844}],headersStr:"å®¹å¨ç®ä» æ°ç»ä¸å®¹å¨ å®¹å¨æ¡æ¶ å®¹å¨çåºæ¬æºå¶ æ³å Iterable å Iterator Comparable å Comparator Cloneable fail-fast fail-fast çè¦ç¹ è§£å³ fail-fast å®¹å¨åçº¿ç¨å®å¨ åèèµæ",content:'# Java å®¹å¨ç®ä»\n\n\n\n\n# å®¹å¨ç®ä»\n\n\n# æ°ç»ä¸å®¹å¨\n\nJava ä¸­å¸¸ç¨çå­å¨å®¹å¨å°±æ¯æ°ç»åå®¹å¨ï¼äºèæä»¥ä¸åºå«ï¼\n\n * å­å¨å¤§å°æ¯å¦åºå®\n   * æ°ç»çé¿åº¦åºå®ï¼\n   * å®¹å¨çé¿åº¦å¯åã\n * æ°æ®ç±»å\n   * æ°ç»å¯ä»¥å­å¨åºæ¬æ°æ®ç±»åï¼ä¹å¯ä»¥å­å¨å¼ç¨æ°æ®ç±»åï¼\n   * å®¹å¨åªè½å­å¨å¼ç¨æ°æ®ç±»åï¼åºæ¬æ°æ®ç±»åçåéè¦è½¬æ¢æå¯¹åºçåè£ç±»æè½æ¾å¥å®¹å¨ç±»ä¸­ã\n\n> ð¡ ä¸äºè§£ä»ä¹æ¯åºæ¬æ°æ®ç±»åãå¼ç¨æ°æ®ç±»åãåè£ç±»è¿äºæ¦å¿µï¼å¯ä»¥åèï¼Java åºæ¬æ°æ®ç±»å\n\n\n# å®¹å¨æ¡æ¶\n\n\n\nJava å®¹å¨æ¡æ¶ä¸»è¦åä¸º Collection å Map ä¸¤ç§ãå¶ä¸­ï¼Collection ååä¸º ListãSet ä»¥å Queueã\n\n * Collection - ä¸ä¸ªç¬ç«åç´ çåºåï¼è¿äºåç´ é½æä»ä¸æ¡æèå¤æ¡è§åã\n   * List - å¿é¡»æç§æå¥çé¡ºåºä¿å­åç´ ã\n   * Set - ä¸è½æéå¤çåç´ ã\n   * Queue - æç§æéè§åæ¥ç¡®å®å¯¹è±¡äº§ççé¡ºåºï¼éå¸¸ä¸å®ä»¬è¢«æå¥çé¡ºåºç¸åï¼ã\n * Map - ä¸ç»æå¯¹çâé®å¼å¯¹âå¯¹è±¡ï¼åè®¸ä½ ä½¿ç¨é®æ¥æ¥æ¾å¼ã\n\n\n# å®¹å¨çåºæ¬æºå¶\n\n> Java çå®¹å¨å·æä¸å®çå±æ§ï¼å®ä»¬æå¨é¨æé¨åä¾èµä»¥ä¸ææ¯ãæä»¥ï¼å­¦ä¹ ä»¥ä¸ææ¯ç¹ï¼å¯¹äºçè§£ Java å®¹å¨çç¹æ§ååçæå¾å¤§çå¸®å©ã\n\n\n# æ³å\n\nJava 1.5 å¼å¥äºæ³åææ¯ã\n\nJava å®¹å¨éè¿æ³åææ¯æ¥ä¿è¯å¶æ°æ®çç±»åå®å¨ãä»ä¹æ¯ç±»åå®å¨å¢ï¼\n\nä¸¾ä¾æ¥è¯´ï¼å¦ææä¸ä¸ª List<Object> å®¹å¨ï¼Java ç¼è¯å¨å¨ç¼è¯æ¶ä¸ä¼å¯¹åå§ç±»åè¿è¡ç±»åå®å¨æ£æ¥ï¼å´ä¼å¯¹å¸¦åæ°çç±»åè¿è¡æ£æ¥ï¼éè¿ä½¿ç¨ Object ä½ä¸ºç±»åï¼å¯ä»¥åç¥ç¼è¯å¨è¯¥æ¹æ³å¯ä»¥æ¥åä»»ä½ç±»åçå¯¹è±¡ï¼æ¯å¦ String æ Integerã\n\nList<Object> list = new ArrayList<Object>();\nlist.add("123");\nlist.add(123);\n\n\nå¦ææ²¡ææ³åææ¯ï¼å¦ç¤ºä¾ä¸­çä»£ç é£æ ·ï¼å®¹å¨ä¸­å°±å¯è½å­å¨ä»»ææ°æ®ç±»åï¼è¿æ¯å¾å±é©çè¡ä¸ºã\n\nList<String> list = new ArrayList<String>();\nlist.add("123");\nlist.add(123);\n\n\n> ð¡ æ³æ·±å¥äºè§£ Java æ³åææ¯çç¨æ³ååçå¯ä»¥åèï¼æ·±å¥çè§£ Java æ³å\n\n\n# Iterable å Iterator\n\n> Iterable å Iterator ç®çå¨äºéåè®¿é®å®¹å¨ä¸­çåç´ ã\n\nIterator æ¥å£å®ä¹ï¼\n\npublic interface Iterator<E> {\n\n    boolean hasNext();\n\n    E next();\n\n    default void remove() {\n        throw new UnsupportedOperationException("remove");\n    }\n\n    default void forEachRemaining(Consumer<? super E> action) {\n        Objects.requireNonNull(action);\n        while (hasNext())\n            action.accept(next());\n    }\n}\n\n\nIterable æ¥å£å®ä¹ï¼\n\npublic interface Iterable<T> {\n\n    Iterator<T> iterator();\n\n    default void forEach(Consumer<? super T> action) {\n        Objects.requireNonNull(action);\n        for (T t : this) {\n            action.accept(t);\n        }\n    }\n\n    default Spliterator<T> spliterator() {\n        return Spliterators.spliteratorUnknownSize(iterator(), 0);\n    }\n}\n\n\nCollection æ¥å£æ©å±äº Iterable æ¥å£ã\n\nè¿­ä»£å¶å®æä»¬å¯ä»¥ç®åå°çè§£ä¸ºéåï¼æ¯ä¸ä¸ªæ ååéååç±»å®¹å¨éé¢çææå¯¹è±¡çæ¥å£ãå®æ¯ä¸ä¸ªç»å¸çè®¾è®¡æ¨¡å¼ââè¿­ä»£å¨æ¨¡å¼ï¼Iteratorï¼ã\n\nè¿­ä»£å¨æ¨¡å¼ - æä¾ä¸ç§æ¹æ³é¡ºåºè®¿é®ä¸ä¸ªèåå¯¹è±¡ä¸­åä¸ªåç´ ï¼èåæ é¡»æ´é²è¯¥å¯¹è±¡çåé¨è¡¨ç¤ºã\n\n\n\nç¤ºä¾ï¼è¿­ä»£å¨éå\n\npublic class IteratorDemo {\n\n    public static void main(String[] args) {\n        List<Integer> list = new ArrayList<>();\n        list.add(1);\n        list.add(2);\n        list.add(3);\n        Iterator it = list.iterator();\n        while (it.hasNext()) {\n            System.out.println(it.next());\n        }\n    }\n\n}\n\n\n\n# Comparable å Comparator\n\nComparable æ¯æåºæ¥å£ãè¥ä¸ä¸ªç±»å®ç°äº Comparable æ¥å£ï¼è¡¨ç¤ºè¯¥ç±»çå®ä¾å¯ä»¥æ¯è¾ï¼ä¹å°±æå³çæ¯ææåºãå®ç°äº Comparable æ¥å£çç±»çå¯¹è±¡çåè¡¨ææ°ç»å¯ä»¥éè¿ Collections.sort æ Arrays.sort è¿è¡èªå¨æåºã\n\nComparable æ¥å£å®ä¹ï¼\n\npublic interface Comparable<T> {\n    public int compareTo(T o);\n}\n\n\nComparator æ¯æ¯è¾æ¥å£ï¼æä»¬å¦æéè¦æ§å¶æä¸ªç±»çæ¬¡åºï¼èè¯¥ç±»æ¬èº«ä¸æ¯ææåº(å³æ²¡æå®ç° Comparable æ¥å£)ï¼é£ä¹æä»¬å°±å¯ä»¥å»ºç«ä¸ä¸ªâè¯¥ç±»çæ¯è¾å¨âæ¥è¿è¡æåºï¼è¿ä¸ªâæ¯è¾å¨âåªéè¦å®ç° Comparator æ¥å£å³å¯ãä¹å°±æ¯è¯´ï¼æä»¬å¯ä»¥éè¿å®ç° Comparator æ¥æ°å»ºä¸ä¸ªæ¯è¾å¨ï¼ç¶åéè¿è¿ä¸ªæ¯è¾å¨å¯¹ç±»è¿è¡æåºã\n\nComparator æ¥å£å®ä¹ï¼\n\n@FunctionalInterface\npublic interface Comparator<T> {\n\n    int compare(T o1, T o2);\n\n    boolean equals(Object obj);\n\n    // åè½¬\n    default Comparator<T> reversed() {\n        return Collections.reverseOrder(this);\n    }\n\n    default Comparator<T> thenComparing(Comparator<? super T> other) {\n        Objects.requireNonNull(other);\n        return (Comparator<T> & Serializable) (c1, c2) -> {\n            int res = compare(c1, c2);\n            return (res != 0) ? res : other.compare(c1, c2);\n        };\n    }\n\n    // thenComparingXXX æ¹æ³ç¥\n\n    // éææ¹æ³ç¥\n}\n\n\nå¨ Java å®¹å¨ä¸­ï¼ä¸äºå¯ä»¥æåºçå®¹å¨ï¼å¦ TreeMapãTreeSetï¼é½å¯ä»¥éè¿ä¼ å¥ Comparatorï¼æ¥å®ä¹åé¨åç´ çæåºè§åã\n\n\n# Cloneable\n\nJava ä¸­ ä¸ä¸ªç±»è¦å®ç° clone åè½ å¿é¡»å®ç° Cloneable æ¥å£ï¼å¦åå¨è°ç¨ clone() æ¶ä¼æ¥ CloneNotSupportedException å¼å¸¸ã\n\nJava ä¸­ææç±»é½é»è®¤ç»§æ¿ java.lang.Object ç±»ï¼å¨ java.lang.Object ç±»ä¸­æä¸ä¸ªæ¹æ³ clone()ï¼è¿ä¸ªæ¹æ³å°è¿å Object å¯¹è±¡çä¸ä¸ªæ·è´ãObject ç±»éç clone() æ¹æ³ä»ä»ç¨äºæµæ·è´ï¼æ·è´åºæ¬æåå±æ§ï¼å¯¹äºå¼ç¨ç±»åä»è¿åæåæ¹å°åçå¼ç¨ï¼ã\n\nå¦æ Java ç±»éè¦æ·±æ·è´ï¼éè¦è¦å clone() æ¹æ³ã\n\n\n# fail-fast\n\n# fail-fast çè¦ç¹\n\nJava å®¹å¨ï¼å¦ï¼ArrayListãHashMapãTreeSet ç­å¾ï¼ç javadoc ä¸­å¸¸å¸¸æå°ç±»ä¼¼çæè¿°ï¼\n\n> æ³¨æï¼è¿­ä»£å¨çå¿«éå¤±è´¥è¡ä¸ºæ æ³å¾å°ä¿è¯ï¼å ä¸ºä¸è¬æ¥è¯´ï¼ä¸å¯è½å¯¹æ¯å¦åºç°ä¸åæ­¥å¹¶åä¿®æ¹ååºä»»ä½ç¡¬æ§ä¿è¯ãå¿«éå¤±è´¥ï¼fail-fastï¼è¿­ä»£å¨ä¼å°½æå¤§åªåæåº ConcurrentModificationExceptionãå æ­¤ï¼ä¸ºæé«è¿ç±»è¿­ä»£å¨çæ­£ç¡®æ§èç¼åä¸ä¸ªä¾èµäºæ­¤å¼å¸¸çç¨åºæ¯éè¯¯çåæ³ï¼è¿­ä»£å¨çå¿«éå¤±è´¥è¡ä¸ºåºè¯¥ä»ç¨äºæ£æµ bugã\n\né£ä¹ï¼æä»¬ä¸ç¦è¦é®ï¼ä»ä¹æ¯ fail-fastï¼ä¸ºä»ä¹è¦æ fail-fast æºå¶ï¼\n\nfail-fast æ¯ Java å®¹å¨çä¸ç§éè¯¯æ£æµæºå¶ãå½å¤ä¸ªçº¿ç¨å¯¹å®¹å¨è¿è¡ç»æä¸çæ¹åçæä½æ¶ï¼å°±å¯è½è§¦å fail-fast æºå¶ãè®°ä½æ¯æå¯è½ï¼èä¸æ¯ä¸å®ã\n\nä¾å¦ï¼åè®¾å­å¨ä¸¤ä¸ªçº¿ç¨ï¼çº¿ç¨ 1ãçº¿ç¨ 2ï¼ï¼çº¿ç¨ 1 éè¿ Iterator å¨éåå®¹å¨ A ä¸­çåç´ ï¼å¨æä¸ªæ¶åçº¿ç¨ 2 ä¿®æ¹äºå®¹å¨ A çç»æï¼æ¯ç»æä¸é¢çä¿®æ¹ï¼èä¸æ¯ç®åçä¿®æ¹å®¹å¨åç´ çåå®¹ï¼ï¼é£ä¹è¿ä¸ªæ¶åç¨åºå°±ä¼æåº ConcurrentModificationException å¼å¸¸ï¼ä»èäº§ç fail-fast æºå¶ã\n\nå®¹å¨å¨è¿­ä»£æä½ä¸­æ¹ååç´ ä¸ªæ°ï¼æ·»å ãå é¤åç´ ï¼é½å¯è½ä¼å¯¼è´ fail-fastã\n\nç¤ºä¾ï¼fail-fast ç¤ºä¾\n\npublic class FailFastDemo {\n\n    private static int MAX = 100;\n\n    private static List<Integer> list = new ArrayList<>();\n\n    public static void main(String[] args) {\n        for (int i = 0; i < MAX; i++) {\n            list.add(i);\n        }\n        new Thread(new MyThreadA()).start();\n        new Thread(new MyThreadB()).start();\n    }\n\n    /** è¿­ä»£éåå®¹å¨ææåç´  */\n    static class MyThreadA implements Runnable {\n\n        @Override\n        public void run() {\n            Iterator<Integer> iterator = list.iterator();\n            while (iterator.hasNext()) {\n                int i = iterator.next();\n                System.out.println("MyThreadA è®¿é®åç´ :" + i);\n                try {\n                    TimeUnit.MILLISECONDS.sleep(100);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n\n    }\n\n    /** éåå é¤æå®èå´åçææå¶æ° */\n    static class MyThreadB implements Runnable {\n\n        @Override\n        public void run() {\n            int i = 0;\n            while (i < MAX) {\n                if (i % 2 == 0) {\n                    System.out.println("MyThreadB å é¤åç´ " + i);\n                    list.remove(i);\n                }\n                i++;\n            }\n        }\n\n    }\n\n}\n\n\næ§è¡åï¼ä¼æåº java.util.ConcurrentModificationException å¼å¸¸ã\n\n# è§£å³ fail-fast\n\nfail-fast æä¸¤ç§è§£å³æ¹æ¡ï¼\n\n * å¨éåè¿ç¨ä¸­æææ¶åå°æ¹åå®¹å¨ä¸ªæ°çå°æ¹å¨é¨å ä¸ synchronized æèç´æ¥ä½¿ç¨ Collections.synchronizedXXX å®¹å¨ï¼è¿æ ·å°±å¯ä»¥è§£å³ãä½æ¯ä¸æ¨èï¼å ä¸ºå¢å é æçåæ­¥éå¯è½ä¼é»å¡éåæä½ï¼å½±åååã\n * ä½¿ç¨å¹¶åå®¹å¨ï¼å¦ï¼CopyOnWriterArrayListã\n\n\n# å®¹å¨åçº¿ç¨å®å¨\n\nä¸ºäºå¨å¹¶åç¯å¢ä¸å®å¨å°ä½¿ç¨å®¹å¨ï¼Java æä¾äºåæ­¥å®¹å¨åå¹¶åå®¹å¨ã\n\n> åæ­¥å®¹å¨åå¹¶åå®¹å¨è¯¦æè¯·åèï¼Java å¹¶åå®¹å¨\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³ï¼ç¬¬ 4 çï¼\n * ç±æµå¥æ·±çè§£ java éå(ä¸)ââéåæ¡æ¶ CollectionãMap\n * ç±æµå¥æ·±çè§£ java éå(äº)ââéå Set\n * Java æé«ç¯ï¼ä¸åï¼-----Iterator\n * Java æé«ç¯ï¼ä¸åï¼-----fail-fast æºå¶',normalizedContent:'# java å®¹å¨ç®ä»\n\n\n\n\n# å®¹å¨ç®ä»\n\n\n# æ°ç»ä¸å®¹å¨\n\njava ä¸­å¸¸ç¨çå­å¨å®¹å¨å°±æ¯æ°ç»åå®¹å¨ï¼äºèæä»¥ä¸åºå«ï¼\n\n * å­å¨å¤§å°æ¯å¦åºå®\n   * æ°ç»çé¿åº¦åºå®ï¼\n   * å®¹å¨çé¿åº¦å¯åã\n * æ°æ®ç±»å\n   * æ°ç»å¯ä»¥å­å¨åºæ¬æ°æ®ç±»åï¼ä¹å¯ä»¥å­å¨å¼ç¨æ°æ®ç±»åï¼\n   * å®¹å¨åªè½å­å¨å¼ç¨æ°æ®ç±»åï¼åºæ¬æ°æ®ç±»åçåéè¦è½¬æ¢æå¯¹åºçåè£ç±»æè½æ¾å¥å®¹å¨ç±»ä¸­ã\n\n> ð¡ ä¸äºè§£ä»ä¹æ¯åºæ¬æ°æ®ç±»åãå¼ç¨æ°æ®ç±»åãåè£ç±»è¿äºæ¦å¿µï¼å¯ä»¥åèï¼java åºæ¬æ°æ®ç±»å\n\n\n# å®¹å¨æ¡æ¶\n\n\n\njava å®¹å¨æ¡æ¶ä¸»è¦åä¸º collection å map ä¸¤ç§ãå¶ä¸­ï¼collection ååä¸º listãset ä»¥å queueã\n\n * collection - ä¸ä¸ªç¬ç«åç´ çåºåï¼è¿äºåç´ é½æä»ä¸æ¡æèå¤æ¡è§åã\n   * list - å¿é¡»æç§æå¥çé¡ºåºä¿å­åç´ ã\n   * set - ä¸è½æéå¤çåç´ ã\n   * queue - æç§æéè§åæ¥ç¡®å®å¯¹è±¡äº§ççé¡ºåºï¼éå¸¸ä¸å®ä»¬è¢«æå¥çé¡ºåºç¸åï¼ã\n * map - ä¸ç»æå¯¹çâé®å¼å¯¹âå¯¹è±¡ï¼åè®¸ä½ ä½¿ç¨é®æ¥æ¥æ¾å¼ã\n\n\n# å®¹å¨çåºæ¬æºå¶\n\n> java çå®¹å¨å·æä¸å®çå±æ§ï¼å®ä»¬æå¨é¨æé¨åä¾èµä»¥ä¸ææ¯ãæä»¥ï¼å­¦ä¹ ä»¥ä¸ææ¯ç¹ï¼å¯¹äºçè§£ java å®¹å¨çç¹æ§ååçæå¾å¤§çå¸®å©ã\n\n\n# æ³å\n\njava 1.5 å¼å¥äºæ³åææ¯ã\n\njava å®¹å¨éè¿æ³åææ¯æ¥ä¿è¯å¶æ°æ®çç±»åå®å¨ãä»ä¹æ¯ç±»åå®å¨å¢ï¼\n\nä¸¾ä¾æ¥è¯´ï¼å¦ææä¸ä¸ª list<object> å®¹å¨ï¼java ç¼è¯å¨å¨ç¼è¯æ¶ä¸ä¼å¯¹åå§ç±»åè¿è¡ç±»åå®å¨æ£æ¥ï¼å´ä¼å¯¹å¸¦åæ°çç±»åè¿è¡æ£æ¥ï¼éè¿ä½¿ç¨ object ä½ä¸ºç±»åï¼å¯ä»¥åç¥ç¼è¯å¨è¯¥æ¹æ³å¯ä»¥æ¥åä»»ä½ç±»åçå¯¹è±¡ï¼æ¯å¦ string æ integerã\n\nlist<object> list = new arraylist<object>();\nlist.add("123");\nlist.add(123);\n\n\nå¦ææ²¡ææ³åææ¯ï¼å¦ç¤ºä¾ä¸­çä»£ç é£æ ·ï¼å®¹å¨ä¸­å°±å¯è½å­å¨ä»»ææ°æ®ç±»åï¼è¿æ¯å¾å±é©çè¡ä¸ºã\n\nlist<string> list = new arraylist<string>();\nlist.add("123");\nlist.add(123);\n\n\n> ð¡ æ³æ·±å¥äºè§£ java æ³åææ¯çç¨æ³ååçå¯ä»¥åèï¼æ·±å¥çè§£ java æ³å\n\n\n# iterable å iterator\n\n> iterable å iterator ç®çå¨äºéåè®¿é®å®¹å¨ä¸­çåç´ ã\n\niterator æ¥å£å®ä¹ï¼\n\npublic interface iterator<e> {\n\n    boolean hasnext();\n\n    e next();\n\n    default void remove() {\n        throw new unsupportedoperationexception("remove");\n    }\n\n    default void foreachremaining(consumer<? super e> action) {\n        objects.requirenonnull(action);\n        while (hasnext())\n            action.accept(next());\n    }\n}\n\n\niterable æ¥å£å®ä¹ï¼\n\npublic interface iterable<t> {\n\n    iterator<t> iterator();\n\n    default void foreach(consumer<? super t> action) {\n        objects.requirenonnull(action);\n        for (t t : this) {\n            action.accept(t);\n        }\n    }\n\n    default spliterator<t> spliterator() {\n        return spliterators.spliteratorunknownsize(iterator(), 0);\n    }\n}\n\n\ncollection æ¥å£æ©å±äº iterable æ¥å£ã\n\nè¿­ä»£å¶å®æä»¬å¯ä»¥ç®åå°çè§£ä¸ºéåï¼æ¯ä¸ä¸ªæ ååéååç±»å®¹å¨éé¢çææå¯¹è±¡çæ¥å£ãå®æ¯ä¸ä¸ªç»å¸çè®¾è®¡æ¨¡å¼ââè¿­ä»£å¨æ¨¡å¼ï¼iteratorï¼ã\n\nè¿­ä»£å¨æ¨¡å¼ - æä¾ä¸ç§æ¹æ³é¡ºåºè®¿é®ä¸ä¸ªèåå¯¹è±¡ä¸­åä¸ªåç´ ï¼èåæ é¡»æ´é²è¯¥å¯¹è±¡çåé¨è¡¨ç¤ºã\n\n\n\nç¤ºä¾ï¼è¿­ä»£å¨éå\n\npublic class iteratordemo {\n\n    public static void main(string[] args) {\n        list<integer> list = new arraylist<>();\n        list.add(1);\n        list.add(2);\n        list.add(3);\n        iterator it = list.iterator();\n        while (it.hasnext()) {\n            system.out.println(it.next());\n        }\n    }\n\n}\n\n\n\n# comparable å comparator\n\ncomparable æ¯æåºæ¥å£ãè¥ä¸ä¸ªç±»å®ç°äº comparable æ¥å£ï¼è¡¨ç¤ºè¯¥ç±»çå®ä¾å¯ä»¥æ¯è¾ï¼ä¹å°±æå³çæ¯ææåºãå®ç°äº comparable æ¥å£çç±»çå¯¹è±¡çåè¡¨ææ°ç»å¯ä»¥éè¿ collections.sort æ arrays.sort è¿è¡èªå¨æåºã\n\ncomparable æ¥å£å®ä¹ï¼\n\npublic interface comparable<t> {\n    public int compareto(t o);\n}\n\n\ncomparator æ¯æ¯è¾æ¥å£ï¼æä»¬å¦æéè¦æ§å¶æä¸ªç±»çæ¬¡åºï¼èè¯¥ç±»æ¬èº«ä¸æ¯ææåº(å³æ²¡æå®ç° comparable æ¥å£)ï¼é£ä¹æä»¬å°±å¯ä»¥å»ºç«ä¸ä¸ªâè¯¥ç±»çæ¯è¾å¨âæ¥è¿è¡æåºï¼è¿ä¸ªâæ¯è¾å¨âåªéè¦å®ç° comparator æ¥å£å³å¯ãä¹å°±æ¯è¯´ï¼æä»¬å¯ä»¥éè¿å®ç° comparator æ¥æ°å»ºä¸ä¸ªæ¯è¾å¨ï¼ç¶åéè¿è¿ä¸ªæ¯è¾å¨å¯¹ç±»è¿è¡æåºã\n\ncomparator æ¥å£å®ä¹ï¼\n\n@functionalinterface\npublic interface comparator<t> {\n\n    int compare(t o1, t o2);\n\n    boolean equals(object obj);\n\n    // åè½¬\n    default comparator<t> reversed() {\n        return collections.reverseorder(this);\n    }\n\n    default comparator<t> thencomparing(comparator<? super t> other) {\n        objects.requirenonnull(other);\n        return (comparator<t> & serializable) (c1, c2) -> {\n            int res = compare(c1, c2);\n            return (res != 0) ? res : other.compare(c1, c2);\n        };\n    }\n\n    // thencomparingxxx æ¹æ³ç¥\n\n    // éææ¹æ³ç¥\n}\n\n\nå¨ java å®¹å¨ä¸­ï¼ä¸äºå¯ä»¥æåºçå®¹å¨ï¼å¦ treemapãtreesetï¼é½å¯ä»¥éè¿ä¼ å¥ comparatorï¼æ¥å®ä¹åé¨åç´ çæåºè§åã\n\n\n# cloneable\n\njava ä¸­ ä¸ä¸ªç±»è¦å®ç° clone åè½ å¿é¡»å®ç° cloneable æ¥å£ï¼å¦åå¨è°ç¨ clone() æ¶ä¼æ¥ clonenotsupportedexception å¼å¸¸ã\n\njava ä¸­ææç±»é½é»è®¤ç»§æ¿ java.lang.object ç±»ï¼å¨ java.lang.object ç±»ä¸­æä¸ä¸ªæ¹æ³ clone()ï¼è¿ä¸ªæ¹æ³å°è¿å object å¯¹è±¡çä¸ä¸ªæ·è´ãobject ç±»éç clone() æ¹æ³ä»ä»ç¨äºæµæ·è´ï¼æ·è´åºæ¬æåå±æ§ï¼å¯¹äºå¼ç¨ç±»åä»è¿åæåæ¹å°åçå¼ç¨ï¼ã\n\nå¦æ java ç±»éè¦æ·±æ·è´ï¼éè¦è¦å clone() æ¹æ³ã\n\n\n# fail-fast\n\n# fail-fast çè¦ç¹\n\njava å®¹å¨ï¼å¦ï¼arraylistãhashmapãtreeset ç­å¾ï¼ç javadoc ä¸­å¸¸å¸¸æå°ç±»ä¼¼çæè¿°ï¼\n\n> æ³¨æï¼è¿­ä»£å¨çå¿«éå¤±è´¥è¡ä¸ºæ æ³å¾å°ä¿è¯ï¼å ä¸ºä¸è¬æ¥è¯´ï¼ä¸å¯è½å¯¹æ¯å¦åºç°ä¸åæ­¥å¹¶åä¿®æ¹ååºä»»ä½ç¡¬æ§ä¿è¯ãå¿«éå¤±è´¥ï¼fail-fastï¼è¿­ä»£å¨ä¼å°½æå¤§åªåæåº concurrentmodificationexceptionãå æ­¤ï¼ä¸ºæé«è¿ç±»è¿­ä»£å¨çæ­£ç¡®æ§èç¼åä¸ä¸ªä¾èµäºæ­¤å¼å¸¸çç¨åºæ¯éè¯¯çåæ³ï¼è¿­ä»£å¨çå¿«éå¤±è´¥è¡ä¸ºåºè¯¥ä»ç¨äºæ£æµ bugã\n\né£ä¹ï¼æä»¬ä¸ç¦è¦é®ï¼ä»ä¹æ¯ fail-fastï¼ä¸ºä»ä¹è¦æ fail-fast æºå¶ï¼\n\nfail-fast æ¯ java å®¹å¨çä¸ç§éè¯¯æ£æµæºå¶ãå½å¤ä¸ªçº¿ç¨å¯¹å®¹å¨è¿è¡ç»æä¸çæ¹åçæä½æ¶ï¼å°±å¯è½è§¦å fail-fast æºå¶ãè®°ä½æ¯æå¯è½ï¼èä¸æ¯ä¸å®ã\n\nä¾å¦ï¼åè®¾å­å¨ä¸¤ä¸ªçº¿ç¨ï¼çº¿ç¨ 1ãçº¿ç¨ 2ï¼ï¼çº¿ç¨ 1 éè¿ iterator å¨éåå®¹å¨ a ä¸­çåç´ ï¼å¨æä¸ªæ¶åçº¿ç¨ 2 ä¿®æ¹äºå®¹å¨ a çç»æï¼æ¯ç»æä¸é¢çä¿®æ¹ï¼èä¸æ¯ç®åçä¿®æ¹å®¹å¨åç´ çåå®¹ï¼ï¼é£ä¹è¿ä¸ªæ¶åç¨åºå°±ä¼æåº concurrentmodificationexception å¼å¸¸ï¼ä»èäº§ç fail-fast æºå¶ã\n\nå®¹å¨å¨è¿­ä»£æä½ä¸­æ¹ååç´ ä¸ªæ°ï¼æ·»å ãå é¤åç´ ï¼é½å¯è½ä¼å¯¼è´ fail-fastã\n\nç¤ºä¾ï¼fail-fast ç¤ºä¾\n\npublic class failfastdemo {\n\n    private static int max = 100;\n\n    private static list<integer> list = new arraylist<>();\n\n    public static void main(string[] args) {\n        for (int i = 0; i < max; i++) {\n            list.add(i);\n        }\n        new thread(new mythreada()).start();\n        new thread(new mythreadb()).start();\n    }\n\n    /** è¿­ä»£éåå®¹å¨ææåç´  */\n    static class mythreada implements runnable {\n\n        @override\n        public void run() {\n            iterator<integer> iterator = list.iterator();\n            while (iterator.hasnext()) {\n                int i = iterator.next();\n                system.out.println("mythreada è®¿é®åç´ :" + i);\n                try {\n                    timeunit.milliseconds.sleep(100);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n            }\n        }\n\n    }\n\n    /** éåå é¤æå®èå´åçææå¶æ° */\n    static class mythreadb implements runnable {\n\n        @override\n        public void run() {\n            int i = 0;\n            while (i < max) {\n                if (i % 2 == 0) {\n                    system.out.println("mythreadb å é¤åç´ " + i);\n                    list.remove(i);\n                }\n                i++;\n            }\n        }\n\n    }\n\n}\n\n\næ§è¡åï¼ä¼æåº java.util.concurrentmodificationexception å¼å¸¸ã\n\n# è§£å³ fail-fast\n\nfail-fast æä¸¤ç§è§£å³æ¹æ¡ï¼\n\n * å¨éåè¿ç¨ä¸­æææ¶åå°æ¹åå®¹å¨ä¸ªæ°çå°æ¹å¨é¨å ä¸ synchronized æèç´æ¥ä½¿ç¨ collections.synchronizedxxx å®¹å¨ï¼è¿æ ·å°±å¯ä»¥è§£å³ãä½æ¯ä¸æ¨èï¼å ä¸ºå¢å é æçåæ­¥éå¯è½ä¼é»å¡éåæä½ï¼å½±åååã\n * ä½¿ç¨å¹¶åå®¹å¨ï¼å¦ï¼copyonwriterarraylistã\n\n\n# å®¹å¨åçº¿ç¨å®å¨\n\nä¸ºäºå¨å¹¶åç¯å¢ä¸å®å¨å°ä½¿ç¨å®¹å¨ï¼java æä¾äºåæ­¥å®¹å¨åå¹¶åå®¹å¨ã\n\n> åæ­¥å®¹å¨åå¹¶åå®¹å¨è¯¦æè¯·åèï¼java å¹¶åå®¹å¨\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³ï¼ç¬¬ 4 çï¼\n * ç±æµå¥æ·±çè§£ java éå(ä¸)ââéåæ¡æ¶ collectionãmap\n * ç±æµå¥æ·±çè§£ java éå(äº)ââéå set\n * java æé«ç¯ï¼ä¸åï¼-----iterator\n * java æé«ç¯ï¼ä¸åï¼-----fail-fast æºå¶',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java é«çº§ç¹æ§",frontmatter:{title:"Java é«çº§ç¹æ§",date:"2020-06-04T13:51:01.000Z",categories:["Java","JavaSE","é«çº§ç¹æ§"],tags:["Java","JavaSE"],permalink:"/pages/016137/",hidden:!0},regularPath:"/01.Java/01.JavaSE/02.%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/",relativePath:"01.Java/01.JavaSE/02.é«çº§ç¹æ§/README.md",key:"v-56fce25d",path:"/pages/016137/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:43},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:383},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:1016}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# Java é«çº§ç¹æ§\n\n> Java é«çº§æ»ç» Java çä¸äºé«çº§ç¹æ§ã\n\n\n# ð åå®¹\n\n * Java æ­£åä»å¥é¨å°ç²¾é - å³é®è¯ï¼PatternãMatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãDFAãNFA\n * Java ç¼ç åå å¯ - å³é®è¯ï¼Base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãMD5ãSHAãHMACãAESãDESãDESedeãRSA\n * Java å½éå - å³é®è¯ï¼LocaleãResourceBundleãNumberFormatãDateFormatãMessageFormat\n * Java JDK8 - å³é®è¯ï¼StreamãlambdaãOptionalã@FunctionalInterface\n * Java SPI - å³é®è¯ï¼SPIãClassLoader\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * Java åå¤§åè\n     * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n     * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n     * ãJava æ ¸å¿ææ¯ å· II é«çº§ç¹æ§ã\n     * ãEffective Javaã\n   * Java å¹¶å\n     * ãJava å¹¶åç¼ç¨å®æã\n     * ãJava å¹¶åç¼ç¨çèºæ¯ã\n   * Java èææº\n     * ãæ·±å¥çè§£ Java èææºã\n   * Java å¥é¨\n     * ãO'Reillyï¼Head First Javaã\n     * ãç¯ç Java è®²ä¹ã\n   * å¶ä»\n     * ãHead First è®¾è®¡æ¨¡å¼ã\n     * ãJava ç½ç»ç¼ç¨ã\n     * ãJava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ Java å¼åæåã\n * æç¨ãç¤¾åº\n   * Runoob Java æç¨\n   * java-design-patterns\n   * Java\n   * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãJava æ§è½è°ä¼å®æã\n   * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ Java èææº\n   * ãJava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * CS-Notes\n   * JavaGuide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð  JAVACORE é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# java é«çº§ç¹æ§\n\n> java é«çº§æ»ç» java çä¸äºé«çº§ç¹æ§ã\n\n\n# ð åå®¹\n\n * java æ­£åä»å¥é¨å°ç²¾é - å³é®è¯ï¼patternãmatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãdfaãnfa\n * java ç¼ç åå å¯ - å³é®è¯ï¼base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãmd5ãshaãhmacãaesãdesãdesedeãrsa\n * java å½éå - å³é®è¯ï¼localeãresourcebundleãnumberformatãdateformatãmessageformat\n * java jdk8 - å³é®è¯ï¼streamãlambdaãoptionalã@functionalinterface\n * java spi - å³é®è¯ï¼spiãclassloader\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * java åå¤§åè\n     * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n     * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n     * ãjava æ ¸å¿ææ¯ å· ii é«çº§ç¹æ§ã\n     * ãeffective javaã\n   * java å¹¶å\n     * ãjava å¹¶åç¼ç¨å®æã\n     * ãjava å¹¶åç¼ç¨çèºæ¯ã\n   * java èææº\n     * ãæ·±å¥çè§£ java èææºã\n   * java å¥é¨\n     * ão'reillyï¼head first javaã\n     * ãç¯ç java è®²ä¹ã\n   * å¶ä»\n     * ãhead first è®¾è®¡æ¨¡å¼ã\n     * ãjava ç½ç»ç¼ç¨ã\n     * ãjava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ java å¼åæåã\n * æç¨ãç¤¾åº\n   * runoob java æç¨\n   * java-design-patterns\n   * java\n   * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãjava æ§è½è°ä¼å®æã\n   * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ java èææº\n   * ãjava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * cs-notes\n   * javaguide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð  javacore é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å®¹å¨ä¹ List",frontmatter:{title:"Java å®¹å¨ä¹ List",date:"2018-06-27T23:12:18.000Z",categories:["Java","JavaSE","å®¹å¨"],tags:["Java","JavaSE","å®¹å¨"],permalink:"/pages/69deb2/"},regularPath:"/01.Java/01.JavaSE/03.%E5%AE%B9%E5%99%A8/02.Java%E5%AE%B9%E5%99%A8%E4%B9%8BList.html",relativePath:"01.Java/01.JavaSE/03.å®¹å¨/02.Javaå®¹å¨ä¹List.md",key:"v-107bd1fe",path:"/pages/69deb2/",headers:[{level:2,title:"List ç®ä»",slug:"list-ç®ä»",normalizedTitle:"list ç®ä»",charIndex:61},{level:3,title:"ArrayList å LinkedList",slug:"arraylist-å-linkedlist",normalizedTitle:"arraylist å linkedlist",charIndex:324},{level:3,title:"Vector å Stack",slug:"vector-å-stack",normalizedTitle:"vector å stack",charIndex:568},{level:2,title:"ArrayList",slug:"arraylist",normalizedTitle:"arraylist",charIndex:324},{level:3,title:"ArrayList è¦ç¹",slug:"arraylist-è¦ç¹",normalizedTitle:"arraylist è¦ç¹",charIndex:869},{level:3,title:"ArrayList åç",slug:"arraylist-åç",normalizedTitle:"arraylist åç",charIndex:1516},{level:4,title:"ArrayList çæ°æ®ç»æ",slug:"arraylist-çæ°æ®ç»æ",normalizedTitle:"arraylist çæ°æ®ç»æ",charIndex:1532},{level:4,title:"ArrayList çåºåå",slug:"arraylist-çåºåå",normalizedTitle:"arraylist çåºåå",charIndex:1798},{level:4,title:"ArrayList æé æ¹æ³",slug:"arraylist-æé æ¹æ³",normalizedTitle:"arraylist æé æ¹æ³",charIndex:2070},{level:4,title:"ArrayList è®¿é®åç´ ",slug:"arraylist-è®¿é®åç´ ",normalizedTitle:"arraylist è®¿é®åç´ ",charIndex:2776},{level:4,title:"ArrayList æ·»å åç´ ",slug:"arraylist-æ·»å åç´ ",normalizedTitle:"arraylist æ·»å åç´ ",charIndex:3035},{level:4,title:"ArrayList å é¤åç´ ",slug:"arraylist-å é¤åç´ ",normalizedTitle:"arraylist å é¤åç´ ",charIndex:4855},{level:4,title:"ArrayList ç Fail-Fast",slug:"arraylist-ç-fail-fast",normalizedTitle:"arraylist ç fail-fast",charIndex:5369},{level:2,title:"LinkedList",slug:"linkedlist",normalizedTitle:"linkedlist",charIndex:336},{level:3,title:"LinkedList è¦ç¹",slug:"linkedlist-è¦ç¹",normalizedTitle:"linkedlist è¦ç¹",charIndex:6172},{level:3,title:"LinkedList åç",slug:"linkedlist-åç",normalizedTitle:"linkedlist åç",charIndex:6682},{level:4,title:"LinkedList çæ°æ®ç»æ",slug:"linkedlist-çæ°æ®ç»æ",normalizedTitle:"linkedlist çæ°æ®ç»æ",charIndex:6699},{level:4,title:"LinkedList çåºåå",slug:"linkedlist-çåºåå",normalizedTitle:"linkedlist çåºåå",charIndex:7157},{level:4,title:"LinkedList è®¿é®åç´ ",slug:"linkedlist-è®¿é®åç´ ",normalizedTitle:"linkedlist è®¿é®åç´ ",charIndex:7367},{level:4,title:"LinkedList æ·»å åç´ ",slug:"linkedlist-æ·»å åç´ ",normalizedTitle:"linkedlist æ·»å åç´ ",charIndex:8118},{level:4,title:"LinkedList å é¤åç´ ",slug:"linkedlist-å é¤åç´ ",normalizedTitle:"linkedlist å é¤åç´ ",charIndex:9435},{level:2,title:"List å¸¸è§é®é¢",slug:"list-å¸¸è§é®é¢",normalizedTitle:"list å¸¸è§é®é¢",charIndex:10591},{level:3,title:"Arrays.asList é®é¢ç¹",slug:"arrays-aslist-é®é¢ç¹",normalizedTitle:"arrays.aslist é®é¢ç¹",charIndex:10605},{level:3,title:"List.subList é®é¢ç¹",slug:"list-sublist-é®é¢ç¹",normalizedTitle:"list.sublist é®é¢ç¹",charIndex:13312},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:14836}],headersStr:"List ç®ä» ArrayList å LinkedList Vector å Stack ArrayList ArrayList è¦ç¹ ArrayList åç ArrayList çæ°æ®ç»æ ArrayList çåºåå ArrayList æé æ¹æ³ ArrayList è®¿é®åç´  ArrayList æ·»å åç´  ArrayList å é¤åç´  ArrayList ç Fail-Fast LinkedList LinkedList è¦ç¹ LinkedList åç LinkedList çæ°æ®ç»æ LinkedList çåºåå LinkedList è®¿é®åç´  LinkedList æ·»å åç´  LinkedList å é¤åç´  List å¸¸è§é®é¢ Arrays.asList é®é¢ç¹ List.subList é®é¢ç¹ åèèµæ",content:'# Java å®¹å¨ä¹ List\n\n> List æ¯ Collection çå­æ¥å£ï¼å¶ä¸­å¯ä»¥ä¿å­åä¸ªéå¤çåå®¹ã\n\n\n# List ç®ä»\n\nList æ¯ä¸ä¸ªæ¥å£ï¼å®ç»§æ¿äº Collection çæ¥å£ãå®ä»£è¡¨çæåºçéåã\n\nAbstractList æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®ç»§æ¿äº AbstractCollectionãAbstractList å®ç°äº List æ¥å£ä¸­é¤ size()ãget(int location) ä¹å¤çå½æ°ã\n\nAbstractSequentialList æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®ç»§æ¿äº AbstractListãAbstractSequentialList å®ç°äºâé¾è¡¨ä¸­ï¼æ ¹æ® index ç´¢å¼å¼æä½é¾è¡¨çå¨é¨å½æ°âã\n\n\n# ArrayList å LinkedList\n\nArrayListãLinkedList æ¯ List æå¸¸ç¨çå®ç°ã\n\n * ArrayList åºäºå¨ææ°ç»å®ç°ï¼å­å¨å®¹ééå¶ï¼å½åç´ æ°è¶è¿æå¤§å®¹éæ¶ï¼ä¼èªå¨æ©å®¹ï¼LinkedList åºäºååé¾è¡¨å®ç°ï¼ä¸å­å¨å®¹ééå¶ã\n * ArrayList éæºè®¿é®éåº¦è¾å¿«ï¼éæºæå¥ãå é¤éåº¦è¾æ¢ï¼LinkedList éæºæå¥ãå é¤éåº¦è¾å¿«ï¼éæºè®¿é®éåº¦è¾æ¢ã\n * ArrayList å LinkedList é½ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# Vector å Stack\n\nVector å Stack çè®¾è®¡ç®æ æ¯ä½ä¸ºçº¿ç¨å®å¨ç List å®ç°ï¼æ¿ä»£ ArrayListã\n\n * Vector - Vector å ArrayList ç±»ä¼¼ï¼ä¹å®ç°äº List æ¥å£ãä½æ¯ï¼ Vector ä¸­çä¸»è¦æ¹æ³é½æ¯ synchronized æ¹æ³ï¼å³éè¿äºæ¥åæ­¥æ¹å¼ä¿è¯æä½ççº¿ç¨å®å¨ã\n * Stack - Stack ä¹æ¯ä¸ä¸ªåæ­¥å®¹å¨ï¼å®çæ¹æ³ä¹ç¨ synchronized è¿è¡äºåæ­¥ï¼å®å®éä¸æ¯ç»§æ¿äº Vector ç±»ã\n\n\n# ArrayList\n\n> ArrayList ä»æ°æ®ç»æè§åº¦æ¥çï¼å¯ä»¥è§ä¸ºæ¯æå¨ææ©å®¹ççº¿æ§è¡¨ã\n\n\n\n\n# ArrayList è¦ç¹\n\nArrayList æ¯ä¸ä¸ªæ°ç»éåï¼ç¸å½äºå¨ææ°ç»ãArrayList é»è®¤åå§å®¹éå¤§å°ä¸º 10 ï¼æ·»å åç´ æ¶ï¼å¦æåç°å®¹éå·²æ»¡ï¼ä¼èªå¨æ©å®¹ä¸ºåå§å¤§å°ç 1.5 åãå æ­¤ï¼åºè¯¥å°½éå¨åå§å ArrayList æ¶ï¼ä¸ºå¶æå®åéçåå§åå®¹éå¤§å°ï¼åå°æ©å®¹æä½äº§ççæ§è½å¼éã\n\nArrayList å®ä¹ï¼\n\npublic class ArrayList<E> extends AbstractList<E>\n        implements List<E>, RandomAccess, Cloneable, java.io.Serializable\n\n\nä» ArrayList çå®ä¹ï¼ä¸é¾çåº ArrayList çä¸äºåºæ¬ç¹æ§ï¼\n\n * ArrayList å®ç°äº List æ¥å£ï¼å¹¶ç»§æ¿äº AbstractListï¼å®æ¯æææ List çæä½ã\n * ArrayList å®ç°äº RandomAccess æ¥å£ï¼æ¯æéæºè®¿é®ãRandomAccess æ¯ä¸ä¸ªæ å¿æ¥å£ï¼å®æå³çâåªè¦å®ç°è¯¥æ¥å£ç List ç±»ï¼é½æ¯æå¿«ééæºè®¿é®âãå¨ ArrayList ä¸­ï¼æä»¬å³å¯ä»¥éè¿åç´ çåºå·å¿«éè·ååç´ å¯¹è±¡ï¼è¿å°±æ¯å¿«ééæºè®¿é®ã\n * ArrayList å®ç°äº Cloneable æ¥å£ï¼é»è®¤ä¸ºæµæ·è´ã\n * ArrayList å®ç°äº Serializable æ¥å£ï¼æ¯æåºååï¼è½éè¿åºååæ¹å¼ä¼ è¾ã\n * ArrayList æ¯éçº¿ç¨å®å¨çã\n\n\n# ArrayList åç\n\n# ArrayList çæ°æ®ç»æ\n\nArrayList åå«äºä¸¤ä¸ªéè¦çåç´ ï¼elementData å sizeã\n\n// é»è®¤åå§åå®¹é\nprivate static final int DEFAULT_CAPACITY = 10;\n// å¯¹è±¡æ°ç»\ntransient Object[] elementData;\n// æ°ç»é¿åº¦\nprivate int size;\n\n\n * size - æ¯å¨ææ°ç»çå®éå¤§å°ã\n * elementData - æ¯ä¸ä¸ª Object æ°ç»ï¼ç¨äºä¿å­æ·»å å° ArrayList ä¸­çåç´ ã\n\n# ArrayList çåºåå\n\nArrayList å·æå¨ææ©å®¹ç¹æ§ï¼å æ­¤ä¿å­åç´ çæ°ç»ä¸ä¸å®é½ä¼è¢«ä½¿ç¨ï¼é£ä¹å°±æ²¡å¿è¦å¨é¨è¿è¡åºååãä¸ºæ­¤ï¼ArrayList å®å¶äºå¶åºååæ¹å¼ãå·ä½åæ³æ¯ï¼\n\n * å­å¨åç´ ç Object æ°ç»ï¼å³ elementDataï¼ä½¿ç¨ transient ä¿®é¥°ï¼ä½¿å¾å®å¯ä»¥è¢« Java åºååæå¿½ç¥ã\n * ArrayList éåäº writeObject() å readObject() æ¥æ§å¶åºååæ°ç»ä¸­æåç´ å¡«åé£é¨ååå®¹ã\n\n> ð¡ ä¸äºè§£ Java åºååæ¹å¼ï¼å¯ä»¥åèï¼Java åºåå\n\n# ArrayList æé æ¹æ³\n\nArrayList ç±»å®ç°äºä¸ä¸ªæé å½æ°ï¼\n\n * ç¬¬ä¸ä¸ªæ¯é»è®¤æé æ¹æ³ï¼ArrayList ä¼åå»ºä¸ä¸ªç©ºæ°ç»ï¼\n * ç¬¬äºä¸ªæ¯åå»º ArrayList å¯¹è±¡æ¶ï¼ä¼ å¥ä¸ä¸ªåå§åå¼ï¼\n * ç¬¬ä¸ä¸ªæ¯ä¼ å¥ä¸ä¸ªéåç±»åè¿è¡åå§åã\n\nå½ ArrayList æ°å¢åç´ æ¶ï¼å¦ææå­å¨çåç´ å·²ç»è¶è¿å¶å½åå®¹éï¼å®ä¼è®¡ç®å®¹éååè¿è¡å¨ææ©å®¹ãæ°ç»çå¨ææ©å®¹ä¼å¯¼è´æ´ä¸ªæ°ç»è¿è¡ä¸æ¬¡åå­å¤å¶ãå æ­¤ï¼åå§å ArrayList æ¶ï¼æå®æ°ç»åå§å¤§å°ï¼æå©äºåå°æ°ç»çæ©å®¹æ¬¡æ°ï¼ä»èæé«ç³»ç»æ§è½ã\n\npublic ArrayList() {\n    // åå»ºä¸ä¸ªç©ºæ°ç»\n\tthis.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n}\n\npublic ArrayList(int initialCapacity) {\n\tif (initialCapacity > 0) {\n        // æ ¹æ®åå§åå¼åå»ºæ°ç»å¤§å°\n\t\tthis.elementData = new Object[initialCapacity];\n\t} else if (initialCapacity == 0) {\n        // åå§åå¼ä¸º 0 æ¶ï¼åå»ºä¸ä¸ªç©ºæ°ç»\n\t\tthis.elementData = EMPTY_ELEMENTDATA;\n\t} else {\n\t\tthrow new IllegalArgumentException("Illegal Capacity: "+\n\t\t\t\t\t\t\t\t\t\t   initialCapacity);\n\t}\n}\n\n\n# ArrayList è®¿é®åç´ \n\nArrayList è®¿é®åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\n// è·åç¬¬ index ä¸ªåç´ \npublic E get(int index) {\n    rangeCheck(index);\n    return elementData(index);\n}\n\nE elementData(int index) {\n    return (E) elementData[index];\n}\n\n\nå®ç°éå¸¸ç®åï¼å¶å®å°±æ¯éè¿æ°ç»ä¸æ è®¿é®æ°ç»åç´ ï¼å¶æ¶é´å¤æåº¦ä¸º O(1)ï¼æä»¥å¾å¿«ã\n\n# ArrayList æ·»å åç´ \n\nArrayList æ·»å åç´ æä¸¤ç§æ¹æ³ï¼ä¸ç§æ¯æ·»å åç´ å°æ°ç»æ«å°¾ï¼å¦å¤ä¸ç§æ¯æ·»å åç´ å°ä»»æä½ç½®ã\n\n// æ·»å åç´ å°æ°ç»æ«å°¾\npublic boolean add(E e) {\n    ensureCapacityInternal(size + 1);  // Increments modCount!!\n    elementData[size++] = e;\n    return true;\n}\n\n// æ·»å åç´ å°ä»»æä½ç½®\npublic void add(int index, E element) {\n\trangeCheckForAdd(index);\n\n\tensureCapacityInternal(size + 1);  // Increments modCount!!\n\tSystem.arraycopy(elementData, index, elementData, index + 1,\n\t\t\t\t\t size - index);\n\telementData[index] = element;\n\tsize++;\n}\n\n\nä¸¤ç§æ·»å åç´ æ¹æ³çä¸åç¹æ¯ï¼\n\n * æ·»å åç´ å°ä»»æä½ç½®ï¼ä¼å¯¼è´å¨è¯¥ä½ç½®åçææåç´ é½éè¦éæ°æåï¼\n * èæ·»å åç´ å°æ°ç»æ«å°¾ï¼å¨æ²¡æåçæ©å®¹çåæä¸ï¼æ¯ä¸ä¼æåç´ å¤å¶æåºè¿ç¨çã\n\nä¸¤ç§æ·»å åç´ æ¹æ³çå±åç¹æ¯ï¼æ·»å åç´ æ¶ï¼ä¼åæ£æ¥å®¹éå¤§å°ï¼å¦æåç°å®¹éä¸è¶³ï¼ä¼èªå¨æ©å®¹ä¸ºåå§å¤§å°ç 1.5 åã\n\nArrayList æ·»å åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\nprivate void ensureCapacityInternal(int minCapacity) {\n    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\n        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);\n    }\n\n    ensureExplicitCapacity(minCapacity);\n}\n\nprivate void ensureExplicitCapacity(int minCapacity) {\n    modCount++;\n\n    // overflow-conscious code\n    if (minCapacity - elementData.length > 0)\n        grow(minCapacity);\n}\n\nprivate void grow(int minCapacity) {\n    // overflow-conscious code\n    int oldCapacity = elementData.length;\n    int newCapacity = oldCapacity + (oldCapacity >> 1);\n    if (newCapacity - minCapacity < 0)\n        newCapacity = minCapacity;\n    if (newCapacity - MAX_ARRAY_SIZE > 0)\n        newCapacity = hugeCapacity(minCapacity);\n    // minCapacity is usually close to size, so this is a win:\n    elementData = Arrays.copyOf(elementData, newCapacity);\n}\n\n\nArrayList æ§è¡æ·»å åç´ å¨ä½ï¼add æ¹æ³ï¼æ¶ï¼è°ç¨ ensureCapacityInternal æ¹æ³æ¥ä¿è¯å®¹éè¶³å¤ã\n\n * å¦æå®¹éè¶³å¤æ¶ï¼å°æ°æ®ä½ä¸ºæ°ç»ä¸­ size+1 ä½ç½®ä¸çåç´ åå¥ï¼å¹¶å° size èªå¢ 1ã\n * å¦æå®¹éä¸å¤æ¶ï¼éè¦ä½¿ç¨ grow æ¹æ³è¿è¡æ©å®¹æ°ç»ï¼æ°å®¹éçå¤§å°ä¸º oldCapacity + (oldCapacity >> 1)ï¼ä¹å°±æ¯æ§å®¹éç 1.5 åãæ©å®¹æä½å®éä¸æ¯è°ç¨ Arrays.copyOf() æåæ°ç»æ·è´ä¸ºä¸ä¸ªæ°æ°ç»ï¼å æ­¤æå¥½å¨åå»º ArrayList å¯¹è±¡æ¶å°±æå®å¤§æ¦çå®¹éå¤§å°ï¼åå°æ©å®¹æä½çæ¬¡æ°ã\n\n# ArrayList å é¤åç´ \n\nArrayList çå é¤æ¹æ³åæ·»å åç´ å°ä»»æä½ç½®æ¹æ³æäºç¸ä¼¼ã\n\nArrayList å¨æ¯ä¸æ¬¡ææçå é¤æä½åï¼é½è¦è¿è¡æ°ç»çéç»ï¼å¹¶ä¸å é¤çåç´ ä½ç½®è¶é åï¼æ°ç»éç»çå¼éå°±è¶å¤§ãå·ä½æ¥è¯´ï¼ArrayList ä¼**è°ç¨ System.arraycopy() å° index+1 åé¢çåç´ é½å¤å¶å° index ä½ç½®ä¸ã\n\npublic E remove(int index) {\n    rangeCheck(index);\n\n    modCount++;\n    E oldValue = elementData(index);\n\n    int numMoved = size - index - 1;\n    if (numMoved > 0)\n        System.arraycopy(elementData, index+1, elementData, index, numMoved);\n    elementData[--size] = null; // clear to let GC do its work\n\n    return oldValue;\n}\n\n\n# ArrayList ç Fail-Fast\n\nArrayList ä½¿ç¨ modCount æ¥è®°å½ç»æåçååçæ¬¡æ°ãç»æåçååæ¯ææ·»å æèå é¤è³å°ä¸ä¸ªåç´ çæææä½ï¼æèæ¯è°æ´åé¨æ°ç»çå¤§å°ï¼ä»ä»åªæ¯è®¾ç½®åç´ çå¼ä¸ç®ç»æåçååã\n\nå¨è¿è¡åºååæèè¿­ä»£ç­æä½æ¶ï¼éè¦æ¯è¾æä½åå modCount æ¯å¦æ¹åï¼å¦æåçæ¹åï¼ArrayList ä¼æåº ConcurrentModificationExceptionã\n\nprivate void writeObject(java.io.ObjectOutputStream s)\n    throws java.io.IOException{\n    // Write out element count, and any hidden stuff\n    int expectedModCount = modCount;\n    s.defaultWriteObject();\n\n    // Write out size as capacity for behavioural compatibility with clone()\n    s.writeInt(size);\n\n    // Write out all elements in the proper order.\n    for (int i=0; i<size; i++) {\n        s.writeObject(elementData[i]);\n    }\n\n    if (modCount != expectedModCount) {\n        throw new ConcurrentModificationException();\n    }\n}\n\n\n\n# LinkedList\n\n> LinkedList ä»æ°æ®ç»æè§åº¦æ¥çï¼å¯ä»¥è§ä¸ºåé¾è¡¨ã\n\n\n\n\n# LinkedList è¦ç¹\n\nLinkedList åºäºåé¾è¡¨ç»æå®ç°ãç±äºæ¯åé¾è¡¨ï¼æä»¥é¡ºåºè®¿é®ä¼éå¸¸é«æï¼èéæºè®¿é®æçæ¯è¾ä½ã\n\nLinkedList å®ä¹ï¼\n\npublic class LinkedList<E>\n    extends AbstractSequentialList<E>\n    implements List<E>, Deque<E>, Cloneable, java.io.Serializable\n\n\nä» LinkedList çå®ä¹ï¼å¯ä»¥å¾åº LinkedList çä¸äºåºæ¬ç¹æ§ï¼\n\n * LinkedList å®ç°äº List æ¥å£ï¼å¹¶ç»§æ¿äº AbstractSequentialList ï¼å®æ¯æææ List çæä½ã\n * LinkedList å®ç°äº Deque æ¥å£ï¼ä¹å¯ä»¥è¢«å½ä½éåï¼Queueï¼æåç«¯éåï¼Dequeï¼è¿è¡æä½ï¼æ­¤å¤ï¼ä¹å¯ä»¥ç¨æ¥å®ç°æ ã\n * LinkedList å®ç°äº Cloneable æ¥å£ï¼é»è®¤ä¸ºæµæ·è´ã\n * LinkedList å®ç°äº Serializable æ¥å£ï¼æ¯æåºååã\n * LinkedList æ¯éçº¿ç¨å®å¨çã\n\n\n# LinkedList åç\n\n# LinkedList çæ°æ®ç»æ\n\nLinkedList åé¨ç»´æ¤äºä¸ä¸ªåé¾è¡¨ã\n\nLinkedList éè¿ Node ç±»åçå¤´å°¾æéï¼first å lastï¼æ¥è®¿é®æ°æ®ã\n\n// é¾è¡¨é¿åº¦\ntransient int size = 0;\n// é¾è¡¨å¤´èç¹\ntransient Node<E> first;\n// é¾è¡¨å°¾èç¹\ntransient Node<E> last;\n\n\n * size - è¡¨ç¤ºåé¾è¡¨ä¸­èç¹çä¸ªæ°ï¼åå§ä¸º 0ã\n * first å last - åå«æ¯åé¾è¡¨çå¤´èç¹åå°¾èç¹ã\n\nNode æ¯ LinkedList çåé¨ç±»ï¼å®è¡¨ç¤ºé¾è¡¨ä¸­çåç´ å®ä¾ãNode ä¸­åå«ä¸ä¸ªåç´ ï¼\n\n * prev æ¯è¯¥èç¹çä¸ä¸ä¸ªèç¹ï¼\n * next æ¯è¯¥èç¹çä¸ä¸ä¸ªèç¹ï¼\n * item æ¯è¯¥èç¹æåå«çå¼ã\n\nprivate static class Node<E> {\n    E item;\n    Node<E> next;\n    Node<E> prev;\n    ...\n}\n\n\n# LinkedList çåºåå\n\nLinkedList ä¸ ArrayList ä¸æ ·ä¹å®å¶äºèªèº«çåºååæ¹å¼ãå·ä½åæ³æ¯ï¼\n\n * å° size ï¼åé¾è¡¨å®¹éå¤§å°ï¼ãfirst ålast ï¼åé¾è¡¨çå¤´å°¾èç¹ï¼ä¿®é¥°ä¸º transientï¼ä½¿å¾å®ä»¬å¯ä»¥è¢« Java åºååæå¿½ç¥ã\n * éåäº writeObject() å readObject() æ¥æ§å¶åºååæ¶ï¼åªå¤çåé¾è¡¨ä¸­è½è¢«å¤´èç¹é¾å¼å¼ç¨çèç¹åç´ ã\n\n# LinkedList è®¿é®åç´ \n\nLinkedList è®¿é®åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\npublic E get(int index) {\n\tcheckElementIndex(index);\n\treturn node(index).item;\n}\n\nNode<E> node(int index) {\n    // assert isElementIndex(index);\n\n    if (index < (size >> 1)) {\n        Node<E> x = first;\n        for (int i = 0; i < index; i++)\n            x = x.next;\n        return x;\n    } else {\n        Node<E> x = last;\n        for (int i = size - 1; i > index; i--)\n            x = x.prev;\n        return x;\n    }\n}\n\n\nè·å LinkedList ç¬¬ index ä¸ªåç´ çç®æ³æ¯ï¼\n\n * å¤æ­ index å¨é¾è¡¨ååé¨åï¼è¿æ¯ååé¨åã\n * å¦ææ¯ååé¨åï¼ä»å¤´èç¹å¼å§æ¥æ¾ï¼å¦ææ¯ååé¨åï¼ä»å°¾ç»ç¹å¼å§æ¥æ¾ã\n\nLinkedList è¿ç§è®¿é®åç´ çæ§è½æ¯ O(N) çº§å«çï¼æç«¯æåµä¸ï¼æ«æ N/2 ä¸ªåç´ ï¼ï¼ç¸æ¯äº ArrayList ç O(1)ï¼æ¾ç¶è¦æ¢ä¸å°ã\n\næ¨èä½¿ç¨è¿­ä»£å¨éå LinkedList ï¼ä¸è¦ä½¿ç¨ä¼ ç»ç for å¾ªç¯ãæ³¨ï¼foreach è¯­æ³ä¼è¢«ç¼è¯å¨è½¬æ¢æè¿­ä»£å¨éåï¼ä½æ¯å®çéåè¿ç¨ä¸­ä¸åè®¸ä¿®æ¹ List é¿åº¦ï¼å³ä¸è½è¿è¡å¢å æä½ã\n\n# LinkedList æ·»å åç´ \n\nLinkedList æå¤ç§æ·»å åç´ æ¹æ³ï¼\n\n * add(E e)ï¼é»è®¤æ·»å åç´ æ¹æ³ï¼æå¥å°¾é¨ï¼\n * add(int index, E element)ï¼æ·»å åç´ å°ä»»æä½ç½®\n * addFirst(E e)ï¼å¨å¤´é¨æ·»å åç´ \n * addLast(E e)ï¼å¨å°¾é¨æ·»å åç´ \n\npublic boolean add(E e) {\n\tlinkLast(e);\n\treturn true;\n}\n\npublic void add(int index, E element) {\n\tcheckPositionIndex(index);\n\n\tif (index == size)\n\t\tlinkLast(element);\n\telse\n\t\tlinkBefore(element, node(index));\n}\n\npublic void addFirst(E e) {\n\tlinkFirst(e);\n}\n\npublic void addLast(E e) {\n\tlinkLast(e);\n}\n\n\nLinkedList æ·»å åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\nprivate void linkFirst(E e) {\n\tfinal Node<E> f = first;\n\tfinal Node<E> newNode = new Node<>(null, e, f);\n\tfirst = newNode;\n\tif (f == null)\n\t\tlast = newNode;\n\telse\n\t\tf.prev = newNode;\n\tsize++;\n\tmodCount++;\n}\n\nvoid linkLast(E e) {\n\tfinal Node<E> l = last;\n\tfinal Node<E> newNode = new Node<>(l, e, null);\n\tlast = newNode;\n\tif (l == null)\n\t\tfirst = newNode;\n\telse\n\t\tl.next = newNode;\n\tsize++;\n\tmodCount++;\n}\n\nvoid linkBefore(E e, Node<E> succ) {\n\t// assert succ != null;\n\tfinal Node<E> pred = succ.prev;\n\tfinal Node<E> newNode = new Node<>(pred, e, succ);\n\tsucc.prev = newNode;\n\tif (pred == null)\n\t\tfirst = newNode;\n\telse\n\t\tpred.next = newNode;\n\tsize++;\n\tmodCount++;\n}\n\n\nç®æ³å¦ä¸ï¼\n\n * å°æ°æ·»å çæ°æ®åè£ä¸º Nodeï¼\n * å¦æå¾å¤´é¨æ·»å åç´ ï¼å°å¤´æé first æåæ°ç Nodeï¼ä¹åç first å¯¹è±¡ç prev æåæ°ç Nodeã\n * å¦ææ¯åå°¾é¨æ·»å åç´ ï¼åå°å°¾æé last æåæ°ç Nodeï¼ä¹åç last å¯¹è±¡ç next æåæ°ç Nodeã\n\n# LinkedList å é¤åç´ \n\nLinkedList å é¤åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\npublic boolean remove(Object o) {\n    if (o == null) {\n        // éåæ¾å°è¦å é¤çåç´ èç¹\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (x.item == null) {\n                unlink(x);\n                return true;\n            }\n        }\n    } else {\n        // éåæ¾å°è¦å é¤çåç´ èç¹\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (o.equals(x.item)) {\n                unlink(x);\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\nE unlink(Node<E> x) {\n    // assert x != null;\n    final E element = x.item;\n    final Node<E> next = x.next;\n    final Node<E> prev = x.prev;\n\n    if (prev == null) {\n        first = next;\n    } else {\n        prev.next = next;\n        x.prev = null;\n    }\n\n    if (next == null) {\n        last = prev;\n    } else {\n        next.prev = prev;\n        x.next = null;\n    }\n\n    x.item = null;\n    size--;\n    modCount++;\n    return element;\n}\n\n\nç®æ³è¯´æï¼\n\n * éåæ¾å°è¦å é¤çåç´ èç¹ï¼ç¶åè°ç¨ unlink æ¹æ³å é¤èç¹ï¼\n * unlink å é¤èç¹çæ¹æ³ï¼\n   * å¦æå½åèç¹æåé©±èç¹ï¼åè®©åé©±èç¹æåå½åèç¹çä¸ä¸ä¸ªèç¹ï¼å¦åï¼è®©åé¾è¡¨å¤´æéæåä¸ä¸ä¸ªèç¹ã\n   * å¦æå½åèç¹æåç»§èç¹ï¼åè®©åç»§èç¹æåå½åèç¹çåä¸ä¸ªèç¹ï¼å¦åï¼è®©åé¾è¡¨å°¾æéæåä¸ä¸ä¸ªèç¹ã\n\n\n# List å¸¸è§é®é¢\n\n\n# Arrays.asList é®é¢ç¹\n\nå¨ä¸å¡å¼åä¸­ï¼æä»¬å¸¸å¸¸ä¼æåå§çæ°ç»è½¬æ¢ä¸º List ç±»æ°æ®ç»æï¼æ¥ç»§ç»­å±å¼åç§ Stream æä½ãéå¸¸ï¼æä»¬ä¼ä½¿ç¨ Arrays.asList æ¹æ³å¯ä»¥ææ°ç»ä¸é®è½¬æ¢ä¸º Listã\n\nãç¤ºä¾ãArrays.asList è½¬æ¢åºæ¬ç±»åæ°ç»\n\nint[] arr = { 1, 2, 3 };\nList list = Arrays.asList(arr);\nlog.info("list:{} size:{} class:{}", list, list.size(), list.get(0).getClass());\n\n\nãè¾åºã\n\n11:26:33.214 [main] INFO io.github.dunwu.javacore.container.list.AsListç¤ºä¾ - list:[[I@ae45eb6] size:1 class:class [I\n\n\næ°ç»åç´ ä¸ªæ°ä¸º 3ï¼ä½è½¬æ¢åçåè¡¨ä¸ªæ°ä¸º 1ã\n\nç±æ­¤å¯ç¥ï¼ Arrays.asList ç¬¬ä¸ä¸ªé®é¢ç¹ï¼ä¸è½ç´æ¥ä½¿ç¨ Arrays.asList æ¥è½¬æ¢åºæ¬ç±»åæ°ç»ã\n\nå¶åå æ¯ï¼Arrays.asList æ¹æ³ä¼ å¥çæ¯ä¸ä¸ªæ³å T ç±»åå¯ååæ°ï¼æç» int æ°ç»æ´ä½ä½ä¸ºäºä¸ä¸ªå¯¹è±¡æä¸ºäºæ³åç±»å Tï¼\n\npublic static <T> List<T> asList(T... a) {\n    return new ArrayList<>(a);\n}\n\n\nç´æ¥éåè¿æ ·ç List å¿ç¶ä¼åºç° Bugï¼ä¿®å¤æ¹å¼æä¸¤ç§ï¼å¦æä½¿ç¨ Java8 ä»¥ä¸çæ¬å¯ä»¥ä½¿ç¨ Arrays.stream æ¹æ³æ¥è½¬æ¢ï¼å¦åå¯ä»¥æ int æ°ç»å£°æä¸ºåè£ç±»å Integer æ°ç»ï¼\n\nãç¤ºä¾ãè½¬æ¢æ´åæ°ç»ä¸º List çæ­£ç¡®æ¹å¼\n\nint[] arr1 = { 1, 2, 3 };\nList list1 = Arrays.stream(arr1).boxed().collect(Collectors.toList());\nlog.info("list:{} size:{} class:{}", list1, list1.size(), list1.get(0).getClass());\n\nInteger[] arr2 = { 1, 2, 3 };\nList list2 = Arrays.asList(arr2);\nlog.info("list:{} size:{} class:{}", list2, list2.size(), list2.get(0).getClass());\n\n\nãç¤ºä¾ãArrays.asList è½¬æ¢å¼ç¨ç±»åæ°ç»\n\nString[] arr = { "1", "2", "3" };\nList list = Arrays.asList(arr);\narr[1] = "4";\ntry {\n    list.add("5");\n} catch (Exception ex) {\n    ex.printStackTrace();\n}\nlog.info("arr:{} list:{}", Arrays.toString(arr), list);\n\n\næåº java.lang.UnsupportedOperationExceptionã\n\næåºå¼å¸¸çåå å¨äº Arrays.asList ç¬¬äºä¸ªé®é¢ç¹ï¼Arrays.asList è¿åç List ä¸æ¯æå¢å æä½ãArrays.asList è¿åç List å¹¶ä¸æ¯æä»¬ææç java.util.ArrayListï¼èæ¯ Arrays çåé¨ç±» ArrayListã\n\næ¥çæºç ï¼æä»¬å¯ä»¥åç° Arrays.asList è¿åç ArrayList ç»§æ¿äº AbstractListï¼ä½æ¯å¹¶æ²¡æè¦å add å remove æ¹æ³ã\n\nprivate static class ArrayList<E> extends AbstractList<E>\n    implements RandomAccess, java.io.Serializable\n{\n    private static final long serialVersionUID = -2764017481108945198L;\n    private final E[] a;\n\n    ArrayList(E[] array) {\n        a = Objects.requireNonNull(array);\n    }\n\n    // ...\n\n    @Override\n    public E set(int index, E element) {\n        E oldValue = a[index];\n        a[index] = element;\n        return oldValue;\n    }\n\n}\n\npublic abstract class AbstractList<E> extends AbstractCollection<E> implements List<E> {\n    public void add(int index, E element) {\n        throw new UnsupportedOperationException();\n    }\n\n    public E remove(int index) {\n        throw new UnsupportedOperationException();\n    }\n}\n\n\nArrays.asList ç¬¬ä¸ä¸ªé®é¢ç¹ï¼å¯¹åå§æ°ç»çä¿®æ¹ä¼å½±åå°æä»¬è·å¾çé£ä¸ª ListãArrayList å¶å®æ¯ç´æ¥ä½¿ç¨äºåå§çæ°ç»ã\n\nè§£å³æ¹æ³å¾ç®åï¼éæ° new ä¸ä¸ª ArrayList åå§å Arrays.asList è¿åç List å³å¯ï¼\n\nString[] arr = { "1", "2", "3" };\nList list = new ArrayList(Arrays.asList(arr));\narr[1] = "4";\ntry {\n    list.add("5");\n} catch (Exception ex) {\n    ex.printStackTrace();\n}\nlog.info("arr:{} list:{}", Arrays.toString(arr), list);\n\n\n\n# List.subList é®é¢ç¹\n\nList.subList ç´æ¥å¼ç¨äºåå§ç Listï¼ä¹å¯ä»¥è®¤ä¸ºæ¯å±äº«âå­å¨âï¼èä¸å¯¹åå§ List ç´æ¥è¿è¡ç»ææ§ä¿®æ¹ä¼å¯¼è´ SubList åºç°å¼å¸¸ã\n\nprivate static List<List<Integer>> data = new ArrayList<>();\n\nprivate static void oom() {\n    for (int i = 0; i < 1000; i++) {\n        List<Integer> rawList = IntStream.rangeClosed(1, 100000).boxed().collect(Collectors.toList());\n        data.add(rawList.subList(0, 1));\n    }\n}\n\n\nåºç° OOM çåå æ¯ï¼å¾ªç¯ä¸­ç 1000 ä¸ªå·æ 10 ä¸ä¸ªåç´ ç List å§ç»å¾ä¸å°åæ¶ï¼å ä¸ºå®å§ç»è¢« subList æ¹æ³è¿åç List å¼ºå¼ç¨ã\n\nè§£å³æ¹æ³æ¯ï¼\n\nprivate static void oomfix() {\n    for (int i = 0; i < 1000; i++) {\n        List<Integer> rawList = IntStream.rangeClosed(1, 100000).boxed().collect(Collectors.toList());\n        data.add(new ArrayList<>(rawList.subList(0, 1)));\n    }\n}\n\n\nãç¤ºä¾ãå­ List å¼ºå¼ç¨åå§ç List\n\nprivate static void wrong() {\n    List<Integer> list = IntStream.rangeClosed(1, 10).boxed().collect(Collectors.toList());\n    List<Integer> subList = list.subList(1, 4);\n    System.out.println(subList);\n    subList.remove(1);\n    System.out.println(list);\n    list.add(0);\n    try {\n        subList.forEach(System.out::println);\n    } catch (Exception ex) {\n        ex.printStackTrace();\n    }\n}\n\n\næåº java.util.ConcurrentModificationExceptionã\n\nè§£å³æ¹æ³ï¼\n\nä¸ç§æ¯ï¼ä¸ç´æ¥ä½¿ç¨ subList æ¹æ³è¿åç SubListï¼èæ¯éæ°ä½¿ç¨ new ArrayListï¼å¨æé æ¹æ³ä¼ å¥ SubListï¼æ¥æå»ºä¸ä¸ªç¬ç«ç ArrayListï¼\n\nå¦ä¸ç§æ¯ï¼å¯¹äº Java 8 ä½¿ç¨ Stream ç skip å limit API æ¥è·³è¿æµä¸­çåç´ ï¼ä»¥åéå¶æµä¸­åç´ çä¸ªæ°ï¼åæ ·å¯ä»¥è¾¾å° SubList åççç®çã\n\n//æ¹å¼ä¸ï¼\nList<Integer> subList = new ArrayList<>(list.subList(1, 4));\n//æ¹å¼äºï¼\nList<Integer> subList = list.stream().skip(1).limit(3).collect(Collectors.toList());\n\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³ï¼ç¬¬ 4 çï¼\n * https://www.cnblogs.com/skywang12345/p/3308556.html\n * http://www.cnblogs.com/skywang12345/p/3308807.html',normalizedContent:'# java å®¹å¨ä¹ list\n\n> list æ¯ collection çå­æ¥å£ï¼å¶ä¸­å¯ä»¥ä¿å­åä¸ªéå¤çåå®¹ã\n\n\n# list ç®ä»\n\nlist æ¯ä¸ä¸ªæ¥å£ï¼å®ç»§æ¿äº collection çæ¥å£ãå®ä»£è¡¨çæåºçéåã\n\nabstractlist æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®ç»§æ¿äº abstractcollectionãabstractlist å®ç°äº list æ¥å£ä¸­é¤ size()ãget(int location) ä¹å¤çå½æ°ã\n\nabstractsequentiallist æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®ç»§æ¿äº abstractlistãabstractsequentiallist å®ç°äºâé¾è¡¨ä¸­ï¼æ ¹æ® index ç´¢å¼å¼æä½é¾è¡¨çå¨é¨å½æ°âã\n\n\n# arraylist å linkedlist\n\narraylistãlinkedlist æ¯ list æå¸¸ç¨çå®ç°ã\n\n * arraylist åºäºå¨ææ°ç»å®ç°ï¼å­å¨å®¹ééå¶ï¼å½åç´ æ°è¶è¿æå¤§å®¹éæ¶ï¼ä¼èªå¨æ©å®¹ï¼linkedlist åºäºååé¾è¡¨å®ç°ï¼ä¸å­å¨å®¹ééå¶ã\n * arraylist éæºè®¿é®éåº¦è¾å¿«ï¼éæºæå¥ãå é¤éåº¦è¾æ¢ï¼linkedlist éæºæå¥ãå é¤éåº¦è¾å¿«ï¼éæºè®¿é®éåº¦è¾æ¢ã\n * arraylist å linkedlist é½ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# vector å stack\n\nvector å stack çè®¾è®¡ç®æ æ¯ä½ä¸ºçº¿ç¨å®å¨ç list å®ç°ï¼æ¿ä»£ arraylistã\n\n * vector - vector å arraylist ç±»ä¼¼ï¼ä¹å®ç°äº list æ¥å£ãä½æ¯ï¼ vector ä¸­çä¸»è¦æ¹æ³é½æ¯ synchronized æ¹æ³ï¼å³éè¿äºæ¥åæ­¥æ¹å¼ä¿è¯æä½ççº¿ç¨å®å¨ã\n * stack - stack ä¹æ¯ä¸ä¸ªåæ­¥å®¹å¨ï¼å®çæ¹æ³ä¹ç¨ synchronized è¿è¡äºåæ­¥ï¼å®å®éä¸æ¯ç»§æ¿äº vector ç±»ã\n\n\n# arraylist\n\n> arraylist ä»æ°æ®ç»æè§åº¦æ¥çï¼å¯ä»¥è§ä¸ºæ¯æå¨ææ©å®¹ççº¿æ§è¡¨ã\n\n\n\n\n# arraylist è¦ç¹\n\narraylist æ¯ä¸ä¸ªæ°ç»éåï¼ç¸å½äºå¨ææ°ç»ãarraylist é»è®¤åå§å®¹éå¤§å°ä¸º 10 ï¼æ·»å åç´ æ¶ï¼å¦æåç°å®¹éå·²æ»¡ï¼ä¼èªå¨æ©å®¹ä¸ºåå§å¤§å°ç 1.5 åãå æ­¤ï¼åºè¯¥å°½éå¨åå§å arraylist æ¶ï¼ä¸ºå¶æå®åéçåå§åå®¹éå¤§å°ï¼åå°æ©å®¹æä½äº§ççæ§è½å¼éã\n\narraylist å®ä¹ï¼\n\npublic class arraylist<e> extends abstractlist<e>\n        implements list<e>, randomaccess, cloneable, java.io.serializable\n\n\nä» arraylist çå®ä¹ï¼ä¸é¾çåº arraylist çä¸äºåºæ¬ç¹æ§ï¼\n\n * arraylist å®ç°äº list æ¥å£ï¼å¹¶ç»§æ¿äº abstractlistï¼å®æ¯æææ list çæä½ã\n * arraylist å®ç°äº randomaccess æ¥å£ï¼æ¯æéæºè®¿é®ãrandomaccess æ¯ä¸ä¸ªæ å¿æ¥å£ï¼å®æå³çâåªè¦å®ç°è¯¥æ¥å£ç list ç±»ï¼é½æ¯æå¿«ééæºè®¿é®âãå¨ arraylist ä¸­ï¼æä»¬å³å¯ä»¥éè¿åç´ çåºå·å¿«éè·ååç´ å¯¹è±¡ï¼è¿å°±æ¯å¿«ééæºè®¿é®ã\n * arraylist å®ç°äº cloneable æ¥å£ï¼é»è®¤ä¸ºæµæ·è´ã\n * arraylist å®ç°äº serializable æ¥å£ï¼æ¯æåºååï¼è½éè¿åºååæ¹å¼ä¼ è¾ã\n * arraylist æ¯éçº¿ç¨å®å¨çã\n\n\n# arraylist åç\n\n# arraylist çæ°æ®ç»æ\n\narraylist åå«äºä¸¤ä¸ªéè¦çåç´ ï¼elementdata å sizeã\n\n// é»è®¤åå§åå®¹é\nprivate static final int default_capacity = 10;\n// å¯¹è±¡æ°ç»\ntransient object[] elementdata;\n// æ°ç»é¿åº¦\nprivate int size;\n\n\n * size - æ¯å¨ææ°ç»çå®éå¤§å°ã\n * elementdata - æ¯ä¸ä¸ª object æ°ç»ï¼ç¨äºä¿å­æ·»å å° arraylist ä¸­çåç´ ã\n\n# arraylist çåºåå\n\narraylist å·æå¨ææ©å®¹ç¹æ§ï¼å æ­¤ä¿å­åç´ çæ°ç»ä¸ä¸å®é½ä¼è¢«ä½¿ç¨ï¼é£ä¹å°±æ²¡å¿è¦å¨é¨è¿è¡åºååãä¸ºæ­¤ï¼arraylist å®å¶äºå¶åºååæ¹å¼ãå·ä½åæ³æ¯ï¼\n\n * å­å¨åç´ ç object æ°ç»ï¼å³ elementdataï¼ä½¿ç¨ transient ä¿®é¥°ï¼ä½¿å¾å®å¯ä»¥è¢« java åºååæå¿½ç¥ã\n * arraylist éåäº writeobject() å readobject() æ¥æ§å¶åºååæ°ç»ä¸­æåç´ å¡«åé£é¨ååå®¹ã\n\n> ð¡ ä¸äºè§£ java åºååæ¹å¼ï¼å¯ä»¥åèï¼java åºåå\n\n# arraylist æé æ¹æ³\n\narraylist ç±»å®ç°äºä¸ä¸ªæé å½æ°ï¼\n\n * ç¬¬ä¸ä¸ªæ¯é»è®¤æé æ¹æ³ï¼arraylist ä¼åå»ºä¸ä¸ªç©ºæ°ç»ï¼\n * ç¬¬äºä¸ªæ¯åå»º arraylist å¯¹è±¡æ¶ï¼ä¼ å¥ä¸ä¸ªåå§åå¼ï¼\n * ç¬¬ä¸ä¸ªæ¯ä¼ å¥ä¸ä¸ªéåç±»åè¿è¡åå§åã\n\nå½ arraylist æ°å¢åç´ æ¶ï¼å¦ææå­å¨çåç´ å·²ç»è¶è¿å¶å½åå®¹éï¼å®ä¼è®¡ç®å®¹éååè¿è¡å¨ææ©å®¹ãæ°ç»çå¨ææ©å®¹ä¼å¯¼è´æ´ä¸ªæ°ç»è¿è¡ä¸æ¬¡åå­å¤å¶ãå æ­¤ï¼åå§å arraylist æ¶ï¼æå®æ°ç»åå§å¤§å°ï¼æå©äºåå°æ°ç»çæ©å®¹æ¬¡æ°ï¼ä»èæé«ç³»ç»æ§è½ã\n\npublic arraylist() {\n    // åå»ºä¸ä¸ªç©ºæ°ç»\n\tthis.elementdata = defaultcapacity_empty_elementdata;\n}\n\npublic arraylist(int initialcapacity) {\n\tif (initialcapacity > 0) {\n        // æ ¹æ®åå§åå¼åå»ºæ°ç»å¤§å°\n\t\tthis.elementdata = new object[initialcapacity];\n\t} else if (initialcapacity == 0) {\n        // åå§åå¼ä¸º 0 æ¶ï¼åå»ºä¸ä¸ªç©ºæ°ç»\n\t\tthis.elementdata = empty_elementdata;\n\t} else {\n\t\tthrow new illegalargumentexception("illegal capacity: "+\n\t\t\t\t\t\t\t\t\t\t   initialcapacity);\n\t}\n}\n\n\n# arraylist è®¿é®åç´ \n\narraylist è®¿é®åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\n// è·åç¬¬ index ä¸ªåç´ \npublic e get(int index) {\n    rangecheck(index);\n    return elementdata(index);\n}\n\ne elementdata(int index) {\n    return (e) elementdata[index];\n}\n\n\nå®ç°éå¸¸ç®åï¼å¶å®å°±æ¯éè¿æ°ç»ä¸æ è®¿é®æ°ç»åç´ ï¼å¶æ¶é´å¤æåº¦ä¸º o(1)ï¼æä»¥å¾å¿«ã\n\n# arraylist æ·»å åç´ \n\narraylist æ·»å åç´ æä¸¤ç§æ¹æ³ï¼ä¸ç§æ¯æ·»å åç´ å°æ°ç»æ«å°¾ï¼å¦å¤ä¸ç§æ¯æ·»å åç´ å°ä»»æä½ç½®ã\n\n// æ·»å åç´ å°æ°ç»æ«å°¾\npublic boolean add(e e) {\n    ensurecapacityinternal(size + 1);  // increments modcount!!\n    elementdata[size++] = e;\n    return true;\n}\n\n// æ·»å åç´ å°ä»»æä½ç½®\npublic void add(int index, e element) {\n\trangecheckforadd(index);\n\n\tensurecapacityinternal(size + 1);  // increments modcount!!\n\tsystem.arraycopy(elementdata, index, elementdata, index + 1,\n\t\t\t\t\t size - index);\n\telementdata[index] = element;\n\tsize++;\n}\n\n\nä¸¤ç§æ·»å åç´ æ¹æ³çä¸åç¹æ¯ï¼\n\n * æ·»å åç´ å°ä»»æä½ç½®ï¼ä¼å¯¼è´å¨è¯¥ä½ç½®åçææåç´ é½éè¦éæ°æåï¼\n * èæ·»å åç´ å°æ°ç»æ«å°¾ï¼å¨æ²¡æåçæ©å®¹çåæä¸ï¼æ¯ä¸ä¼æåç´ å¤å¶æåºè¿ç¨çã\n\nä¸¤ç§æ·»å åç´ æ¹æ³çå±åç¹æ¯ï¼æ·»å åç´ æ¶ï¼ä¼åæ£æ¥å®¹éå¤§å°ï¼å¦æåç°å®¹éä¸è¶³ï¼ä¼èªå¨æ©å®¹ä¸ºåå§å¤§å°ç 1.5 åã\n\narraylist æ·»å åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\nprivate void ensurecapacityinternal(int mincapacity) {\n    if (elementdata == defaultcapacity_empty_elementdata) {\n        mincapacity = math.max(default_capacity, mincapacity);\n    }\n\n    ensureexplicitcapacity(mincapacity);\n}\n\nprivate void ensureexplicitcapacity(int mincapacity) {\n    modcount++;\n\n    // overflow-conscious code\n    if (mincapacity - elementdata.length > 0)\n        grow(mincapacity);\n}\n\nprivate void grow(int mincapacity) {\n    // overflow-conscious code\n    int oldcapacity = elementdata.length;\n    int newcapacity = oldcapacity + (oldcapacity >> 1);\n    if (newcapacity - mincapacity < 0)\n        newcapacity = mincapacity;\n    if (newcapacity - max_array_size > 0)\n        newcapacity = hugecapacity(mincapacity);\n    // mincapacity is usually close to size, so this is a win:\n    elementdata = arrays.copyof(elementdata, newcapacity);\n}\n\n\narraylist æ§è¡æ·»å åç´ å¨ä½ï¼add æ¹æ³ï¼æ¶ï¼è°ç¨ ensurecapacityinternal æ¹æ³æ¥ä¿è¯å®¹éè¶³å¤ã\n\n * å¦æå®¹éè¶³å¤æ¶ï¼å°æ°æ®ä½ä¸ºæ°ç»ä¸­ size+1 ä½ç½®ä¸çåç´ åå¥ï¼å¹¶å° size èªå¢ 1ã\n * å¦æå®¹éä¸å¤æ¶ï¼éè¦ä½¿ç¨ grow æ¹æ³è¿è¡æ©å®¹æ°ç»ï¼æ°å®¹éçå¤§å°ä¸º oldcapacity + (oldcapacity >> 1)ï¼ä¹å°±æ¯æ§å®¹éç 1.5 åãæ©å®¹æä½å®éä¸æ¯è°ç¨ arrays.copyof() æåæ°ç»æ·è´ä¸ºä¸ä¸ªæ°æ°ç»ï¼å æ­¤æå¥½å¨åå»º arraylist å¯¹è±¡æ¶å°±æå®å¤§æ¦çå®¹éå¤§å°ï¼åå°æ©å®¹æä½çæ¬¡æ°ã\n\n# arraylist å é¤åç´ \n\narraylist çå é¤æ¹æ³åæ·»å åç´ å°ä»»æä½ç½®æ¹æ³æäºç¸ä¼¼ã\n\narraylist å¨æ¯ä¸æ¬¡ææçå é¤æä½åï¼é½è¦è¿è¡æ°ç»çéç»ï¼å¹¶ä¸å é¤çåç´ ä½ç½®è¶é åï¼æ°ç»éç»çå¼éå°±è¶å¤§ãå·ä½æ¥è¯´ï¼arraylist ä¼**è°ç¨ system.arraycopy() å° index+1 åé¢çåç´ é½å¤å¶å° index ä½ç½®ä¸ã\n\npublic e remove(int index) {\n    rangecheck(index);\n\n    modcount++;\n    e oldvalue = elementdata(index);\n\n    int nummoved = size - index - 1;\n    if (nummoved > 0)\n        system.arraycopy(elementdata, index+1, elementdata, index, nummoved);\n    elementdata[--size] = null; // clear to let gc do its work\n\n    return oldvalue;\n}\n\n\n# arraylist ç fail-fast\n\narraylist ä½¿ç¨ modcount æ¥è®°å½ç»æåçååçæ¬¡æ°ãç»æåçååæ¯ææ·»å æèå é¤è³å°ä¸ä¸ªåç´ çæææä½ï¼æèæ¯è°æ´åé¨æ°ç»çå¤§å°ï¼ä»ä»åªæ¯è®¾ç½®åç´ çå¼ä¸ç®ç»æåçååã\n\nå¨è¿è¡åºååæèè¿­ä»£ç­æä½æ¶ï¼éè¦æ¯è¾æä½åå modcount æ¯å¦æ¹åï¼å¦æåçæ¹åï¼arraylist ä¼æåº concurrentmodificationexceptionã\n\nprivate void writeobject(java.io.objectoutputstream s)\n    throws java.io.ioexception{\n    // write out element count, and any hidden stuff\n    int expectedmodcount = modcount;\n    s.defaultwriteobject();\n\n    // write out size as capacity for behavioural compatibility with clone()\n    s.writeint(size);\n\n    // write out all elements in the proper order.\n    for (int i=0; i<size; i++) {\n        s.writeobject(elementdata[i]);\n    }\n\n    if (modcount != expectedmodcount) {\n        throw new concurrentmodificationexception();\n    }\n}\n\n\n\n# linkedlist\n\n> linkedlist ä»æ°æ®ç»æè§åº¦æ¥çï¼å¯ä»¥è§ä¸ºåé¾è¡¨ã\n\n\n\n\n# linkedlist è¦ç¹\n\nlinkedlist åºäºåé¾è¡¨ç»æå®ç°ãç±äºæ¯åé¾è¡¨ï¼æä»¥é¡ºåºè®¿é®ä¼éå¸¸é«æï¼èéæºè®¿é®æçæ¯è¾ä½ã\n\nlinkedlist å®ä¹ï¼\n\npublic class linkedlist<e>\n    extends abstractsequentiallist<e>\n    implements list<e>, deque<e>, cloneable, java.io.serializable\n\n\nä» linkedlist çå®ä¹ï¼å¯ä»¥å¾åº linkedlist çä¸äºåºæ¬ç¹æ§ï¼\n\n * linkedlist å®ç°äº list æ¥å£ï¼å¹¶ç»§æ¿äº abstractsequentiallist ï¼å®æ¯æææ list çæä½ã\n * linkedlist å®ç°äº deque æ¥å£ï¼ä¹å¯ä»¥è¢«å½ä½éåï¼queueï¼æåç«¯éåï¼dequeï¼è¿è¡æä½ï¼æ­¤å¤ï¼ä¹å¯ä»¥ç¨æ¥å®ç°æ ã\n * linkedlist å®ç°äº cloneable æ¥å£ï¼é»è®¤ä¸ºæµæ·è´ã\n * linkedlist å®ç°äº serializable æ¥å£ï¼æ¯æåºååã\n * linkedlist æ¯éçº¿ç¨å®å¨çã\n\n\n# linkedlist åç\n\n# linkedlist çæ°æ®ç»æ\n\nlinkedlist åé¨ç»´æ¤äºä¸ä¸ªåé¾è¡¨ã\n\nlinkedlist éè¿ node ç±»åçå¤´å°¾æéï¼first å lastï¼æ¥è®¿é®æ°æ®ã\n\n// é¾è¡¨é¿åº¦\ntransient int size = 0;\n// é¾è¡¨å¤´èç¹\ntransient node<e> first;\n// é¾è¡¨å°¾èç¹\ntransient node<e> last;\n\n\n * size - è¡¨ç¤ºåé¾è¡¨ä¸­èç¹çä¸ªæ°ï¼åå§ä¸º 0ã\n * first å last - åå«æ¯åé¾è¡¨çå¤´èç¹åå°¾èç¹ã\n\nnode æ¯ linkedlist çåé¨ç±»ï¼å®è¡¨ç¤ºé¾è¡¨ä¸­çåç´ å®ä¾ãnode ä¸­åå«ä¸ä¸ªåç´ ï¼\n\n * prev æ¯è¯¥èç¹çä¸ä¸ä¸ªèç¹ï¼\n * next æ¯è¯¥èç¹çä¸ä¸ä¸ªèç¹ï¼\n * item æ¯è¯¥èç¹æåå«çå¼ã\n\nprivate static class node<e> {\n    e item;\n    node<e> next;\n    node<e> prev;\n    ...\n}\n\n\n# linkedlist çåºåå\n\nlinkedlist ä¸ arraylist ä¸æ ·ä¹å®å¶äºèªèº«çåºååæ¹å¼ãå·ä½åæ³æ¯ï¼\n\n * å° size ï¼åé¾è¡¨å®¹éå¤§å°ï¼ãfirst ålast ï¼åé¾è¡¨çå¤´å°¾èç¹ï¼ä¿®é¥°ä¸º transientï¼ä½¿å¾å®ä»¬å¯ä»¥è¢« java åºååæå¿½ç¥ã\n * éåäº writeobject() å readobject() æ¥æ§å¶åºååæ¶ï¼åªå¤çåé¾è¡¨ä¸­è½è¢«å¤´èç¹é¾å¼å¼ç¨çèç¹åç´ ã\n\n# linkedlist è®¿é®åç´ \n\nlinkedlist è®¿é®åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\npublic e get(int index) {\n\tcheckelementindex(index);\n\treturn node(index).item;\n}\n\nnode<e> node(int index) {\n    // assert iselementindex(index);\n\n    if (index < (size >> 1)) {\n        node<e> x = first;\n        for (int i = 0; i < index; i++)\n            x = x.next;\n        return x;\n    } else {\n        node<e> x = last;\n        for (int i = size - 1; i > index; i--)\n            x = x.prev;\n        return x;\n    }\n}\n\n\nè·å linkedlist ç¬¬ index ä¸ªåç´ çç®æ³æ¯ï¼\n\n * å¤æ­ index å¨é¾è¡¨ååé¨åï¼è¿æ¯ååé¨åã\n * å¦ææ¯ååé¨åï¼ä»å¤´èç¹å¼å§æ¥æ¾ï¼å¦ææ¯ååé¨åï¼ä»å°¾ç»ç¹å¼å§æ¥æ¾ã\n\nlinkedlist è¿ç§è®¿é®åç´ çæ§è½æ¯ o(n) çº§å«çï¼æç«¯æåµä¸ï¼æ«æ n/2 ä¸ªåç´ ï¼ï¼ç¸æ¯äº arraylist ç o(1)ï¼æ¾ç¶è¦æ¢ä¸å°ã\n\næ¨èä½¿ç¨è¿­ä»£å¨éå linkedlist ï¼ä¸è¦ä½¿ç¨ä¼ ç»ç for å¾ªç¯ãæ³¨ï¼foreach è¯­æ³ä¼è¢«ç¼è¯å¨è½¬æ¢æè¿­ä»£å¨éåï¼ä½æ¯å®çéåè¿ç¨ä¸­ä¸åè®¸ä¿®æ¹ list é¿åº¦ï¼å³ä¸è½è¿è¡å¢å æä½ã\n\n# linkedlist æ·»å åç´ \n\nlinkedlist æå¤ç§æ·»å åç´ æ¹æ³ï¼\n\n * add(e e)ï¼é»è®¤æ·»å åç´ æ¹æ³ï¼æå¥å°¾é¨ï¼\n * add(int index, e element)ï¼æ·»å åç´ å°ä»»æä½ç½®\n * addfirst(e e)ï¼å¨å¤´é¨æ·»å åç´ \n * addlast(e e)ï¼å¨å°¾é¨æ·»å åç´ \n\npublic boolean add(e e) {\n\tlinklast(e);\n\treturn true;\n}\n\npublic void add(int index, e element) {\n\tcheckpositionindex(index);\n\n\tif (index == size)\n\t\tlinklast(element);\n\telse\n\t\tlinkbefore(element, node(index));\n}\n\npublic void addfirst(e e) {\n\tlinkfirst(e);\n}\n\npublic void addlast(e e) {\n\tlinklast(e);\n}\n\n\nlinkedlist æ·»å åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\nprivate void linkfirst(e e) {\n\tfinal node<e> f = first;\n\tfinal node<e> newnode = new node<>(null, e, f);\n\tfirst = newnode;\n\tif (f == null)\n\t\tlast = newnode;\n\telse\n\t\tf.prev = newnode;\n\tsize++;\n\tmodcount++;\n}\n\nvoid linklast(e e) {\n\tfinal node<e> l = last;\n\tfinal node<e> newnode = new node<>(l, e, null);\n\tlast = newnode;\n\tif (l == null)\n\t\tfirst = newnode;\n\telse\n\t\tl.next = newnode;\n\tsize++;\n\tmodcount++;\n}\n\nvoid linkbefore(e e, node<e> succ) {\n\t// assert succ != null;\n\tfinal node<e> pred = succ.prev;\n\tfinal node<e> newnode = new node<>(pred, e, succ);\n\tsucc.prev = newnode;\n\tif (pred == null)\n\t\tfirst = newnode;\n\telse\n\t\tpred.next = newnode;\n\tsize++;\n\tmodcount++;\n}\n\n\nç®æ³å¦ä¸ï¼\n\n * å°æ°æ·»å çæ°æ®åè£ä¸º nodeï¼\n * å¦æå¾å¤´é¨æ·»å åç´ ï¼å°å¤´æé first æåæ°ç nodeï¼ä¹åç first å¯¹è±¡ç prev æåæ°ç nodeã\n * å¦ææ¯åå°¾é¨æ·»å åç´ ï¼åå°å°¾æé last æåæ°ç nodeï¼ä¹åç last å¯¹è±¡ç next æåæ°ç nodeã\n\n# linkedlist å é¤åç´ \n\nlinkedlist å é¤åç´ çå®ç°ä¸»è¦åºäºä»¥ä¸å³é®æ§æºç ï¼\n\npublic boolean remove(object o) {\n    if (o == null) {\n        // éåæ¾å°è¦å é¤çåç´ èç¹\n        for (node<e> x = first; x != null; x = x.next) {\n            if (x.item == null) {\n                unlink(x);\n                return true;\n            }\n        }\n    } else {\n        // éåæ¾å°è¦å é¤çåç´ èç¹\n        for (node<e> x = first; x != null; x = x.next) {\n            if (o.equals(x.item)) {\n                unlink(x);\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\ne unlink(node<e> x) {\n    // assert x != null;\n    final e element = x.item;\n    final node<e> next = x.next;\n    final node<e> prev = x.prev;\n\n    if (prev == null) {\n        first = next;\n    } else {\n        prev.next = next;\n        x.prev = null;\n    }\n\n    if (next == null) {\n        last = prev;\n    } else {\n        next.prev = prev;\n        x.next = null;\n    }\n\n    x.item = null;\n    size--;\n    modcount++;\n    return element;\n}\n\n\nç®æ³è¯´æï¼\n\n * éåæ¾å°è¦å é¤çåç´ èç¹ï¼ç¶åè°ç¨ unlink æ¹æ³å é¤èç¹ï¼\n * unlink å é¤èç¹çæ¹æ³ï¼\n   * å¦æå½åèç¹æåé©±èç¹ï¼åè®©åé©±èç¹æåå½åèç¹çä¸ä¸ä¸ªèç¹ï¼å¦åï¼è®©åé¾è¡¨å¤´æéæåä¸ä¸ä¸ªèç¹ã\n   * å¦æå½åèç¹æåç»§èç¹ï¼åè®©åç»§èç¹æåå½åèç¹çåä¸ä¸ªèç¹ï¼å¦åï¼è®©åé¾è¡¨å°¾æéæåä¸ä¸ä¸ªèç¹ã\n\n\n# list å¸¸è§é®é¢\n\n\n# arrays.aslist é®é¢ç¹\n\nå¨ä¸å¡å¼åä¸­ï¼æä»¬å¸¸å¸¸ä¼æåå§çæ°ç»è½¬æ¢ä¸º list ç±»æ°æ®ç»æï¼æ¥ç»§ç»­å±å¼åç§ stream æä½ãéå¸¸ï¼æä»¬ä¼ä½¿ç¨ arrays.aslist æ¹æ³å¯ä»¥ææ°ç»ä¸é®è½¬æ¢ä¸º listã\n\nãç¤ºä¾ãarrays.aslist è½¬æ¢åºæ¬ç±»åæ°ç»\n\nint[] arr = { 1, 2, 3 };\nlist list = arrays.aslist(arr);\nlog.info("list:{} size:{} class:{}", list, list.size(), list.get(0).getclass());\n\n\nãè¾åºã\n\n11:26:33.214 [main] info io.github.dunwu.javacore.container.list.aslistç¤ºä¾ - list:[[i@ae45eb6] size:1 class:class [i\n\n\næ°ç»åç´ ä¸ªæ°ä¸º 3ï¼ä½è½¬æ¢åçåè¡¨ä¸ªæ°ä¸º 1ã\n\nç±æ­¤å¯ç¥ï¼ arrays.aslist ç¬¬ä¸ä¸ªé®é¢ç¹ï¼ä¸è½ç´æ¥ä½¿ç¨ arrays.aslist æ¥è½¬æ¢åºæ¬ç±»åæ°ç»ã\n\nå¶åå æ¯ï¼arrays.aslist æ¹æ³ä¼ å¥çæ¯ä¸ä¸ªæ³å t ç±»åå¯ååæ°ï¼æç» int æ°ç»æ´ä½ä½ä¸ºäºä¸ä¸ªå¯¹è±¡æä¸ºäºæ³åç±»å tï¼\n\npublic static <t> list<t> aslist(t... a) {\n    return new arraylist<>(a);\n}\n\n\nç´æ¥éåè¿æ ·ç list å¿ç¶ä¼åºç° bugï¼ä¿®å¤æ¹å¼æä¸¤ç§ï¼å¦æä½¿ç¨ java8 ä»¥ä¸çæ¬å¯ä»¥ä½¿ç¨ arrays.stream æ¹æ³æ¥è½¬æ¢ï¼å¦åå¯ä»¥æ int æ°ç»å£°æä¸ºåè£ç±»å integer æ°ç»ï¼\n\nãç¤ºä¾ãè½¬æ¢æ´åæ°ç»ä¸º list çæ­£ç¡®æ¹å¼\n\nint[] arr1 = { 1, 2, 3 };\nlist list1 = arrays.stream(arr1).boxed().collect(collectors.tolist());\nlog.info("list:{} size:{} class:{}", list1, list1.size(), list1.get(0).getclass());\n\ninteger[] arr2 = { 1, 2, 3 };\nlist list2 = arrays.aslist(arr2);\nlog.info("list:{} size:{} class:{}", list2, list2.size(), list2.get(0).getclass());\n\n\nãç¤ºä¾ãarrays.aslist è½¬æ¢å¼ç¨ç±»åæ°ç»\n\nstring[] arr = { "1", "2", "3" };\nlist list = arrays.aslist(arr);\narr[1] = "4";\ntry {\n    list.add("5");\n} catch (exception ex) {\n    ex.printstacktrace();\n}\nlog.info("arr:{} list:{}", arrays.tostring(arr), list);\n\n\næåº java.lang.unsupportedoperationexceptionã\n\næåºå¼å¸¸çåå å¨äº arrays.aslist ç¬¬äºä¸ªé®é¢ç¹ï¼arrays.aslist è¿åç list ä¸æ¯æå¢å æä½ãarrays.aslist è¿åç list å¹¶ä¸æ¯æä»¬ææç java.util.arraylistï¼èæ¯ arrays çåé¨ç±» arraylistã\n\næ¥çæºç ï¼æä»¬å¯ä»¥åç° arrays.aslist è¿åç arraylist ç»§æ¿äº abstractlistï¼ä½æ¯å¹¶æ²¡æè¦å add å remove æ¹æ³ã\n\nprivate static class arraylist<e> extends abstractlist<e>\n    implements randomaccess, java.io.serializable\n{\n    private static final long serialversionuid = -2764017481108945198l;\n    private final e[] a;\n\n    arraylist(e[] array) {\n        a = objects.requirenonnull(array);\n    }\n\n    // ...\n\n    @override\n    public e set(int index, e element) {\n        e oldvalue = a[index];\n        a[index] = element;\n        return oldvalue;\n    }\n\n}\n\npublic abstract class abstractlist<e> extends abstractcollection<e> implements list<e> {\n    public void add(int index, e element) {\n        throw new unsupportedoperationexception();\n    }\n\n    public e remove(int index) {\n        throw new unsupportedoperationexception();\n    }\n}\n\n\narrays.aslist ç¬¬ä¸ä¸ªé®é¢ç¹ï¼å¯¹åå§æ°ç»çä¿®æ¹ä¼å½±åå°æä»¬è·å¾çé£ä¸ª listãarraylist å¶å®æ¯ç´æ¥ä½¿ç¨äºåå§çæ°ç»ã\n\nè§£å³æ¹æ³å¾ç®åï¼éæ° new ä¸ä¸ª arraylist åå§å arrays.aslist è¿åç list å³å¯ï¼\n\nstring[] arr = { "1", "2", "3" };\nlist list = new arraylist(arrays.aslist(arr));\narr[1] = "4";\ntry {\n    list.add("5");\n} catch (exception ex) {\n    ex.printstacktrace();\n}\nlog.info("arr:{} list:{}", arrays.tostring(arr), list);\n\n\n\n# list.sublist é®é¢ç¹\n\nlist.sublist ç´æ¥å¼ç¨äºåå§ç listï¼ä¹å¯ä»¥è®¤ä¸ºæ¯å±äº«âå­å¨âï¼èä¸å¯¹åå§ list ç´æ¥è¿è¡ç»ææ§ä¿®æ¹ä¼å¯¼è´ sublist åºç°å¼å¸¸ã\n\nprivate static list<list<integer>> data = new arraylist<>();\n\nprivate static void oom() {\n    for (int i = 0; i < 1000; i++) {\n        list<integer> rawlist = intstream.rangeclosed(1, 100000).boxed().collect(collectors.tolist());\n        data.add(rawlist.sublist(0, 1));\n    }\n}\n\n\nåºç° oom çåå æ¯ï¼å¾ªç¯ä¸­ç 1000 ä¸ªå·æ 10 ä¸ä¸ªåç´ ç list å§ç»å¾ä¸å°åæ¶ï¼å ä¸ºå®å§ç»è¢« sublist æ¹æ³è¿åç list å¼ºå¼ç¨ã\n\nè§£å³æ¹æ³æ¯ï¼\n\nprivate static void oomfix() {\n    for (int i = 0; i < 1000; i++) {\n        list<integer> rawlist = intstream.rangeclosed(1, 100000).boxed().collect(collectors.tolist());\n        data.add(new arraylist<>(rawlist.sublist(0, 1)));\n    }\n}\n\n\nãç¤ºä¾ãå­ list å¼ºå¼ç¨åå§ç list\n\nprivate static void wrong() {\n    list<integer> list = intstream.rangeclosed(1, 10).boxed().collect(collectors.tolist());\n    list<integer> sublist = list.sublist(1, 4);\n    system.out.println(sublist);\n    sublist.remove(1);\n    system.out.println(list);\n    list.add(0);\n    try {\n        sublist.foreach(system.out::println);\n    } catch (exception ex) {\n        ex.printstacktrace();\n    }\n}\n\n\næåº java.util.concurrentmodificationexceptionã\n\nè§£å³æ¹æ³ï¼\n\nä¸ç§æ¯ï¼ä¸ç´æ¥ä½¿ç¨ sublist æ¹æ³è¿åç sublistï¼èæ¯éæ°ä½¿ç¨ new arraylistï¼å¨æé æ¹æ³ä¼ å¥ sublistï¼æ¥æå»ºä¸ä¸ªç¬ç«ç arraylistï¼\n\nå¦ä¸ç§æ¯ï¼å¯¹äº java 8 ä½¿ç¨ stream ç skip å limit api æ¥è·³è¿æµä¸­çåç´ ï¼ä»¥åéå¶æµä¸­åç´ çä¸ªæ°ï¼åæ ·å¯ä»¥è¾¾å° sublist åççç®çã\n\n//æ¹å¼ä¸ï¼\nlist<integer> sublist = new arraylist<>(list.sublist(1, 4));\n//æ¹å¼äºï¼\nlist<integer> sublist = list.stream().skip(1).limit(3).collect(collectors.tolist());\n\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³ï¼ç¬¬ 4 çï¼\n * https://www.cnblogs.com/skywang12345/p/3308556.html\n * http://www.cnblogs.com/skywang12345/p/3308807.html',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å®¹å¨ä¹ Set",frontmatter:{title:"Java å®¹å¨ä¹ Set",date:"2019-12-29T21:49:58.000Z",categories:["Java","JavaSE","å®¹å¨"],tags:["Java","JavaSE","å®¹å¨"],permalink:"/pages/794c6b/"},regularPath:"/01.Java/01.JavaSE/03.%E5%AE%B9%E5%99%A8/04.Java%E5%AE%B9%E5%99%A8%E4%B9%8BSet.html",relativePath:"01.Java/01.JavaSE/03.å®¹å¨/04.Javaå®¹å¨ä¹Set.md",key:"v-9a8a8b92",path:"/pages/794c6b/",headers:[{level:2,title:"Set ç®ä»",slug:"set-ç®ä»",normalizedTitle:"set ç®ä»",charIndex:19},{level:3,title:"Set æ¥å£",slug:"set-æ¥å£",normalizedTitle:"set æ¥å£",charIndex:589},{level:3,title:"SortedSet æ¥å£",slug:"sortedset-æ¥å£",normalizedTitle:"sortedset æ¥å£",charIndex:723},{level:3,title:"NavigableSet æ¥å£",slug:"navigableset-æ¥å£",normalizedTitle:"navigableset æ¥å£",charIndex:1046},{level:3,title:"AbstractSet æ½è±¡ç±»",slug:"abstractset-æ½è±¡ç±»",normalizedTitle:"abstractset æ½è±¡ç±»",charIndex:1544},{level:2,title:"HashSet ç±»",slug:"hashset-ç±»",normalizedTitle:"hashset ç±»",charIndex:371},{level:3,title:"HashSet è¦ç¹",slug:"hashset-è¦ç¹",normalizedTitle:"hashset è¦ç¹",charIndex:1972},{level:3,title:"HashSet åç",slug:"hashset-åç",normalizedTitle:"hashset åç",charIndex:2172},{level:2,title:"TreeSet ç±»",slug:"treeset-ç±»",normalizedTitle:"treeset ç±»",charIndex:437},{level:3,title:"TreeSet è¦ç¹",slug:"treeset-è¦ç¹",normalizedTitle:"treeset è¦ç¹",charIndex:2823},{level:3,title:"TreeSet æºç ",slug:"treeset-æºç ",normalizedTitle:"treeset æºç ",charIndex:3041},{level:2,title:"LinkedHashSet ç±»",slug:"linkedhashset-ç±»",normalizedTitle:"linkedhashset ç±»",charIndex:3479},{level:3,title:"LinkedHashSet è¦ç¹",slug:"linkedhashset-è¦ç¹",normalizedTitle:"linkedhashset è¦ç¹",charIndex:3664},{level:3,title:"LinkedHashSet åç",slug:"linkedhashset-åç",normalizedTitle:"linkedhashset åç",charIndex:3877},{level:2,title:"EnumSet ç±»",slug:"enumset-ç±»",normalizedTitle:"enumset ç±»",charIndex:4561},{level:3,title:"EnumSet è¦ç¹",slug:"enumset-è¦ç¹",normalizedTitle:"enumset è¦ç¹",charIndex:4715},{level:2,title:"è¦ç¹æ»ç»",slug:"è¦ç¹æ»ç»",normalizedTitle:"è¦ç¹æ»ç»",charIndex:5015},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5026}],headersStr:"Set ç®ä» Set æ¥å£ SortedSet æ¥å£ NavigableSet æ¥å£ AbstractSet æ½è±¡ç±» HashSet ç±» HashSet è¦ç¹ HashSet åç TreeSet ç±» TreeSet è¦ç¹ TreeSet æºç  LinkedHashSet ç±» LinkedHashSet è¦ç¹ LinkedHashSet åç EnumSet ç±» EnumSet è¦ç¹ è¦ç¹æ»ç» åèèµæ",content:'# Java å®¹å¨ä¹ Set\n\n\n# Set ç®ä»\n\n\n\nSet å®¶ææåç®ä»ï¼\n\n * Set ç»§æ¿äº Collection çæ¥å£ãå®éä¸ Set å°±æ¯ Collectionï¼åªæ¯è¡ä¸ºç¥æä¸åï¼Set éåä¸åè®¸æéå¤åç´ ã\n * SortedSet ç»§æ¿äº Set çæ¥å£ãSortedSet ä¸­çåå®¹æ¯æåºçå¯ä¸å¼ï¼æåºçæ¹æ³æ¯éè¿æ¯è¾å¨(Comparator)ã\n * NavigableSet ç»§æ¿äº SortedSet çæ¥å£ãå®æä¾äºä¸°å¯çæ¥æ¾æ¹æ³ï¼å¦"è·åå¤§äº/ç­äºæå¼çåç´ "ãâè·åå°äº/ç­äºæå¼çåç´ âç­ç­ã\n * AbstractSet æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®ç»§æ¿äº AbstractCollectionï¼AbstractCollection å®ç°äº Set ä¸­çç»å¤§é¨åæ¹æ³ï¼ä¸ºå®ç° Set çå®ä¾ç±»æä¾äºä¾¿å©ã\n * HashSet ç±»ä¾èµäº HashMapï¼å®å®éä¸æ¯éè¿ HashMap å®ç°çãHashSet ä¸­çåç´ æ¯æ åºçãæ£åçã\n * TreeSet ç±»ä¾èµäº TreeMapï¼å®å®éä¸æ¯éè¿ TreeMap å®ç°çãTreeSet ä¸­çåç´ æ¯æåºçï¼å®æ¯æèªç¶æåºæèç¨æ·æå®æ¯è¾å¨æåºç Setã\n * LinkedHashSet æ¯ææå¥é¡ºåºæåºç Setã\n * EnumSet æ¯åªè½å­æ¾ Emum æä¸¾ç±»åç Setã\n\n\n# Set æ¥å£\n\nSet ç»§æ¿äº Collection çæ¥å£ãå®éä¸ï¼Set å°±æ¯ Collectionï¼äºèæä¾çæ¹æ³å®å¨ç¸åã\n\nSet æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface Set<E> extends Collection<E> {}\n\n\n\n# SortedSet æ¥å£\n\nç»§æ¿äº Set çæ¥å£ãSortedSet ä¸­çåå®¹æ¯æåºçå¯ä¸å¼ï¼æåºçæ¹æ³æ¯éè¿æ¯è¾å¨(Comparator)ã\n\nSortedSet æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface SortedSet<E> extends Set<E> {}\n\n\nSortedSet æ¥å£æ°æ©å±çæ¹æ³ï¼\n\n * comparator - è¿å Comparator\n * subSet - è¿åæå®åºé´çå­é\n * headSet - è¿åå°äºæå®åç´ çå­é\n * tailSet - è¿åå¤§äºæå®åç´ çå­é\n * first - è¿åç¬¬ä¸ä¸ªåç´ \n * last - è¿åæåä¸ä¸ªåç´ \n * spliterator\n\n\n# NavigableSet æ¥å£\n\nNavigableSet ç»§æ¿äº SortedSetãå®æä¾äºä¸°å¯çæ¥æ¾æ¹æ³ã\n\nNavigableSet æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface NavigableSet<E> extends SortedSet<E> {}\n\n\nNavigableSet æ¥å£æ°æ©å±çæ¹æ³ï¼\n\n * lower - è¿åå°äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * higher - è¿åå¤§äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * floor - è¿åå°äºæç­äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * ceiling - è¿åå¤§äºæç­äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * pollFirst - æ£ç´¢å¹¶ç§»é¤ç¬¬ä¸ä¸ªï¼æå°çï¼åç´ \n * pollLast - æ£ç´¢å¹¶ç§»é¤æåä¸ä¸ªï¼æå¤§çï¼åç´ \n * descendingSet - è¿åååºæåç Set\n * descendingIterator - è¿åååºæåç Set çè¿­ä»£å¨\n * subSet - è¿åæå®åºé´çå­é\n * headSet - è¿åå°äºæå®åç´ çå­é\n * tailSet - è¿åå¤§äºæå®åç´ çå­é\n\n\n# AbstractSet æ½è±¡ç±»\n\nAbstractSet ç±»æä¾ Set æ¥å£çæ ¸å¿å®ç°ï¼ä»¥æå¤§éåº¦å°åå°å®ç° Set æ¥å£æéçå·¥ä½ã\n\nAbstractSet æ½è±¡ç±»å®ä¹å¦ä¸ï¼\n\npublic abstract class AbstractSet<E> extends AbstractCollection<E> implements Set<E> {}\n\n\näºå®ä¸ï¼ä¸»è¦çå®ç°å·²ç»å¨ AbstractCollection ä¸­å®æã\n\n\n# HashSet ç±»\n\nHashSet ç±»ä¾èµäº HashMapï¼å®å®éä¸æ¯éè¿ HashMap å®ç°çãHashSet ä¸­çåç´ æ¯æ åºçãæ£åçã\n\nHashSet ç±»å®ä¹å¦ä¸ï¼\n\npublic class HashSet<E>\n    extends AbstractSet<E>\n    implements Set<E>, Cloneable, java.io.Serializable {}\n\n\n\n# HashSet è¦ç¹\n\n * HashSet éè¿ç»§æ¿ AbstractSet å®ç°äº Set æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * HashSet å®ç°äº Cloneableï¼æä»¥æ¯æåéã\n * HashSet å®ç°äº Serializableï¼æä»¥æ¯æåºååã\n * HashSet ä¸­å­å¨çåç´ æ¯æ åºçã\n * HashSet åè®¸ null å¼çåç´ ã\n * HashSet ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# HashSet åç\n\nHashSet æ¯åºäº HashMap å®ç°çã\n\n// HashSet çæ ¸å¿ï¼éè¿ç»´æ¤ä¸ä¸ª HashMap å®ä½æ¥å®ç° HashSet æ¹æ³\nprivate transient HashMap<E,Object> map;\n\n// PRESENT æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼\nprivate static final Object PRESENT = new Object();\n}\n\n\n * HashSet ä¸­ç»´æ¤äºä¸ä¸ª HashMap å¯¹è±¡ mapï¼HashSet çéè¦æ¹æ³ï¼å¦ addãremoveãiteratorãclearãsize ç­é½æ¯å´ç» map å®ç°çã\n   * HashSet ç±»ä¸­éè¿å®ä¹ writeObject() å readObject() æ¹æ³ç¡®å®äºå¶åºåååååºååçæºå¶ã\n * PRESENT æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼ã\n\n\n# TreeSet ç±»\n\nTreeSet ç±»ä¾èµäº TreeMapï¼å®å®éä¸æ¯éè¿ TreeMap å®ç°çãTreeSet ä¸­çåç´ æ¯æåºçï¼å®æ¯æèªç¶æåºæèç¨æ·æå®æ¯è¾å¨æåºç Setã\n\nTreeSet ç±»å®ä¹å¦ä¸ï¼\n\npublic class TreeSet<E> extends AbstractSet<E>\n    implements NavigableSet<E>, Cloneable, java.io.Serializable {}\n\n\n\n# TreeSet è¦ç¹\n\n * TreeSet éè¿ç»§æ¿ AbstractSet å®ç°äº NavigableSet æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * TreeSet å®ç°äº Cloneableï¼æä»¥æ¯æåéã\n * TreeSet å®ç°äº Serializableï¼æä»¥æ¯æåºååã\n * TreeSet ä¸­å­å¨çåç´ æ¯æåºçãæåºè§åæ¯èªç¶é¡ºåºææ¯è¾å¨ï¼Comparatorï¼ä¸­æä¾çé¡ºåºè§åã\n * TreeSet ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# TreeSet æºç \n\nTreeSet æ¯åºäº TreeMap å®ç°çã\n\n// TreeSet çæ ¸å¿ï¼éè¿ç»´æ¤ä¸ä¸ª NavigableMap å®ä½æ¥å®ç° TreeSet æ¹æ³\nprivate transient NavigableMap<E,Object> m;\n\n// PRESENT æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼\nprivate static final Object PRESENT = new Object();\n\n\n * TreeSet ä¸­ç»´æ¤äºä¸ä¸ª NavigableMap å¯¹è±¡ mapï¼å®éä¸æ¯ä¸ä¸ª TreeMap å®ä¾ï¼ï¼TreeSet çéè¦æ¹æ³ï¼å¦ addãremoveãiteratorãclearãsize ç­é½æ¯å´ç» map å®ç°çã\n * PRESENT æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼ãTreeSet ä¸­çåç´ é½è¢«å½æ TreeMap ç key å­å¨ï¼è value é½å¡«çæ¯ PRESENTã\n\n\n# LinkedHashSet ç±»\n\nLinkedHashSet æ¯ææå¥é¡ºåºæåºç Setã\n\nLinkedHashSet ç±»å®ä¹å¦ä¸ï¼\n\npublic class LinkedHashSet<E>\n    extends HashSet<E>\n    implements Set<E>, Cloneable, java.io.Serializable {}\n\n\n\n# LinkedHashSet è¦ç¹\n\n * LinkedHashSet éè¿ç»§æ¿ HashSet å®ç°äº Set æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * LinkedHashSet å®ç°äº Cloneableï¼æä»¥æ¯æåéã\n * LinkedHashSet å®ç°äº Serializableï¼æä»¥æ¯æåºååã\n * LinkedHashSet ä¸­å­å¨çåç´ æ¯æç§æå¥é¡ºåºä¿å­çã\n * LinkedHashSet ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# LinkedHashSet åç\n\nLinkedHashSet æä¸ä¸ªæé æ¹æ³ï¼æ ä¸ä¾å¤ï¼é½æ¯è°ç¨ç¶ç±» HashSet çæé æ¹æ³ã\n\npublic LinkedHashSet(int initialCapacity, float loadFactor) {\n    super(initialCapacity, loadFactor, true);\n}\npublic LinkedHashSet(int initialCapacity) {\n    super(initialCapacity, .75f, true);\n}\npublic LinkedHashSet() {\n    super(16, .75f, true);\n}\n\n\néè¦å¼ºè°çæ¯ï¼LinkedHashSet æé æ¹æ³å®éä¸è°ç¨çæ¯ç¶ç±» HashSet çé public æé æ¹æ³ã\n\nHashSet(int initialCapacity, float loadFactor, boolean dummy) {\n    map = new LinkedHashMap<>(initialCapacity, loadFactor);\n}\n\n\nä¸åäº HashSet public æé æ¹æ³ä¸­åå§åç HashMap å®ä¾ï¼è¿ä¸ªæé æ¹æ³ä¸­ï¼åå§åäº LinkedHashMap å®ä¾ã\n\nä¹å°±æ¯è¯´ï¼å®éä¸ï¼LinkedHashSet ç»´æ¤äºä¸ä¸ªåé¾è¡¨ãç±åé¾è¡¨çç¹æ§å¯ä»¥ç¥éï¼å®æ¯æç§åç´ çæå¥é¡ºåºä¿å­çãæä»¥ï¼è¿å°±æ¯ LinkedHashSet ä¸­å­å¨çåç´ æ¯æç§æå¥é¡ºåºä¿å­çåçã\n\n\n# EnumSet ç±»\n\nEnumSet ç±»å®ä¹å¦ä¸ï¼\n\npublic abstract class EnumSet<E extends Enum<E>> extends AbstractSet<E>\n    implements Cloneable, java.io.Serializable {}\n\n\n\n# EnumSet è¦ç¹\n\n * EnumSet ç»§æ¿äº AbstractSetï¼æä»¥æ Set æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * EnumSet å®ç°äº Cloneableï¼æä»¥æ¯æåéã\n * EnumSet å®ç°äº Serializableï¼æä»¥æ¯æåºååã\n * EnumSet éè¿ <E extends Enum<E>> éå®äºå­å¨åç´ å¿é¡»æ¯æä¸¾å¼ã\n * EnumSet æ²¡ææé æ¹æ³ï¼åªè½éè¿ç±»ä¸­ç static æ¹æ³æ¥åå»º EnumSet å¯¹è±¡ã\n * EnumSet æ¯æåºçãä»¥æä¸¾å¼å¨ EnumSet ç±»ä¸­çå®ä¹é¡ºåºæ¥å³å®éååç´ çé¡ºåºã\n * EnumSet ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# è¦ç¹æ»ç»\n\n\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³ï¼Thinking in javaï¼',normalizedContent:'# java å®¹å¨ä¹ set\n\n\n# set ç®ä»\n\n\n\nset å®¶ææåç®ä»ï¼\n\n * set ç»§æ¿äº collection çæ¥å£ãå®éä¸ set å°±æ¯ collectionï¼åªæ¯è¡ä¸ºç¥æä¸åï¼set éåä¸åè®¸æéå¤åç´ ã\n * sortedset ç»§æ¿äº set çæ¥å£ãsortedset ä¸­çåå®¹æ¯æåºçå¯ä¸å¼ï¼æåºçæ¹æ³æ¯éè¿æ¯è¾å¨(comparator)ã\n * navigableset ç»§æ¿äº sortedset çæ¥å£ãå®æä¾äºä¸°å¯çæ¥æ¾æ¹æ³ï¼å¦"è·åå¤§äº/ç­äºæå¼çåç´ "ãâè·åå°äº/ç­äºæå¼çåç´ âç­ç­ã\n * abstractset æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®ç»§æ¿äº abstractcollectionï¼abstractcollection å®ç°äº set ä¸­çç»å¤§é¨åæ¹æ³ï¼ä¸ºå®ç° set çå®ä¾ç±»æä¾äºä¾¿å©ã\n * hashset ç±»ä¾èµäº hashmapï¼å®å®éä¸æ¯éè¿ hashmap å®ç°çãhashset ä¸­çåç´ æ¯æ åºçãæ£åçã\n * treeset ç±»ä¾èµäº treemapï¼å®å®éä¸æ¯éè¿ treemap å®ç°çãtreeset ä¸­çåç´ æ¯æåºçï¼å®æ¯æèªç¶æåºæèç¨æ·æå®æ¯è¾å¨æåºç setã\n * linkedhashset æ¯ææå¥é¡ºåºæåºç setã\n * enumset æ¯åªè½å­æ¾ emum æä¸¾ç±»åç setã\n\n\n# set æ¥å£\n\nset ç»§æ¿äº collection çæ¥å£ãå®éä¸ï¼set å°±æ¯ collectionï¼äºèæä¾çæ¹æ³å®å¨ç¸åã\n\nset æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface set<e> extends collection<e> {}\n\n\n\n# sortedset æ¥å£\n\nç»§æ¿äº set çæ¥å£ãsortedset ä¸­çåå®¹æ¯æåºçå¯ä¸å¼ï¼æåºçæ¹æ³æ¯éè¿æ¯è¾å¨(comparator)ã\n\nsortedset æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface sortedset<e> extends set<e> {}\n\n\nsortedset æ¥å£æ°æ©å±çæ¹æ³ï¼\n\n * comparator - è¿å comparator\n * subset - è¿åæå®åºé´çå­é\n * headset - è¿åå°äºæå®åç´ çå­é\n * tailset - è¿åå¤§äºæå®åç´ çå­é\n * first - è¿åç¬¬ä¸ä¸ªåç´ \n * last - è¿åæåä¸ä¸ªåç´ \n * spliterator\n\n\n# navigableset æ¥å£\n\nnavigableset ç»§æ¿äº sortedsetãå®æä¾äºä¸°å¯çæ¥æ¾æ¹æ³ã\n\nnavigableset æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface navigableset<e> extends sortedset<e> {}\n\n\nnavigableset æ¥å£æ°æ©å±çæ¹æ³ï¼\n\n * lower - è¿åå°äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * higher - è¿åå¤§äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * floor - è¿åå°äºæç­äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * ceiling - è¿åå¤§äºæç­äºæå®å¼çåç´ ä¸­ææ¥è¿çåç´ \n * pollfirst - æ£ç´¢å¹¶ç§»é¤ç¬¬ä¸ä¸ªï¼æå°çï¼åç´ \n * polllast - æ£ç´¢å¹¶ç§»é¤æåä¸ä¸ªï¼æå¤§çï¼åç´ \n * descendingset - è¿åååºæåç set\n * descendingiterator - è¿åååºæåç set çè¿­ä»£å¨\n * subset - è¿åæå®åºé´çå­é\n * headset - è¿åå°äºæå®åç´ çå­é\n * tailset - è¿åå¤§äºæå®åç´ çå­é\n\n\n# abstractset æ½è±¡ç±»\n\nabstractset ç±»æä¾ set æ¥å£çæ ¸å¿å®ç°ï¼ä»¥æå¤§éåº¦å°åå°å®ç° set æ¥å£æéçå·¥ä½ã\n\nabstractset æ½è±¡ç±»å®ä¹å¦ä¸ï¼\n\npublic abstract class abstractset<e> extends abstractcollection<e> implements set<e> {}\n\n\näºå®ä¸ï¼ä¸»è¦çå®ç°å·²ç»å¨ abstractcollection ä¸­å®æã\n\n\n# hashset ç±»\n\nhashset ç±»ä¾èµäº hashmapï¼å®å®éä¸æ¯éè¿ hashmap å®ç°çãhashset ä¸­çåç´ æ¯æ åºçãæ£åçã\n\nhashset ç±»å®ä¹å¦ä¸ï¼\n\npublic class hashset<e>\n    extends abstractset<e>\n    implements set<e>, cloneable, java.io.serializable {}\n\n\n\n# hashset è¦ç¹\n\n * hashset éè¿ç»§æ¿ abstractset å®ç°äº set æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * hashset å®ç°äº cloneableï¼æä»¥æ¯æåéã\n * hashset å®ç°äº serializableï¼æä»¥æ¯æåºååã\n * hashset ä¸­å­å¨çåç´ æ¯æ åºçã\n * hashset åè®¸ null å¼çåç´ ã\n * hashset ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# hashset åç\n\nhashset æ¯åºäº hashmap å®ç°çã\n\n// hashset çæ ¸å¿ï¼éè¿ç»´æ¤ä¸ä¸ª hashmap å®ä½æ¥å®ç° hashset æ¹æ³\nprivate transient hashmap<e,object> map;\n\n// present æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼\nprivate static final object present = new object();\n}\n\n\n * hashset ä¸­ç»´æ¤äºä¸ä¸ª hashmap å¯¹è±¡ mapï¼hashset çéè¦æ¹æ³ï¼å¦ addãremoveãiteratorãclearãsize ç­é½æ¯å´ç» map å®ç°çã\n   * hashset ç±»ä¸­éè¿å®ä¹ writeobject() å readobject() æ¹æ³ç¡®å®äºå¶åºåååååºååçæºå¶ã\n * present æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼ã\n\n\n# treeset ç±»\n\ntreeset ç±»ä¾èµäº treemapï¼å®å®éä¸æ¯éè¿ treemap å®ç°çãtreeset ä¸­çåç´ æ¯æåºçï¼å®æ¯æèªç¶æåºæèç¨æ·æå®æ¯è¾å¨æåºç setã\n\ntreeset ç±»å®ä¹å¦ä¸ï¼\n\npublic class treeset<e> extends abstractset<e>\n    implements navigableset<e>, cloneable, java.io.serializable {}\n\n\n\n# treeset è¦ç¹\n\n * treeset éè¿ç»§æ¿ abstractset å®ç°äº navigableset æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * treeset å®ç°äº cloneableï¼æä»¥æ¯æåéã\n * treeset å®ç°äº serializableï¼æä»¥æ¯æåºååã\n * treeset ä¸­å­å¨çåç´ æ¯æåºçãæåºè§åæ¯èªç¶é¡ºåºææ¯è¾å¨ï¼comparatorï¼ä¸­æä¾çé¡ºåºè§åã\n * treeset ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# treeset æºç \n\ntreeset æ¯åºäº treemap å®ç°çã\n\n// treeset çæ ¸å¿ï¼éè¿ç»´æ¤ä¸ä¸ª navigablemap å®ä½æ¥å®ç° treeset æ¹æ³\nprivate transient navigablemap<e,object> m;\n\n// present æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼\nprivate static final object present = new object();\n\n\n * treeset ä¸­ç»´æ¤äºä¸ä¸ª navigablemap å¯¹è±¡ mapï¼å®éä¸æ¯ä¸ä¸ª treemap å®ä¾ï¼ï¼treeset çéè¦æ¹æ³ï¼å¦ addãremoveãiteratorãclearãsize ç­é½æ¯å´ç» map å®ç°çã\n * present æ¯ç¨äºå³è map ä¸­å½åæä½åç´ çä¸ä¸ªèæå¼ãtreeset ä¸­çåç´ é½è¢«å½æ treemap ç key å­å¨ï¼è value é½å¡«çæ¯ presentã\n\n\n# linkedhashset ç±»\n\nlinkedhashset æ¯ææå¥é¡ºåºæåºç setã\n\nlinkedhashset ç±»å®ä¹å¦ä¸ï¼\n\npublic class linkedhashset<e>\n    extends hashset<e>\n    implements set<e>, cloneable, java.io.serializable {}\n\n\n\n# linkedhashset è¦ç¹\n\n * linkedhashset éè¿ç»§æ¿ hashset å®ç°äº set æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * linkedhashset å®ç°äº cloneableï¼æä»¥æ¯æåéã\n * linkedhashset å®ç°äº serializableï¼æä»¥æ¯æåºååã\n * linkedhashset ä¸­å­å¨çåç´ æ¯æç§æå¥é¡ºåºä¿å­çã\n * linkedhashset ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# linkedhashset åç\n\nlinkedhashset æä¸ä¸ªæé æ¹æ³ï¼æ ä¸ä¾å¤ï¼é½æ¯è°ç¨ç¶ç±» hashset çæé æ¹æ³ã\n\npublic linkedhashset(int initialcapacity, float loadfactor) {\n    super(initialcapacity, loadfactor, true);\n}\npublic linkedhashset(int initialcapacity) {\n    super(initialcapacity, .75f, true);\n}\npublic linkedhashset() {\n    super(16, .75f, true);\n}\n\n\néè¦å¼ºè°çæ¯ï¼linkedhashset æé æ¹æ³å®éä¸è°ç¨çæ¯ç¶ç±» hashset çé public æé æ¹æ³ã\n\nhashset(int initialcapacity, float loadfactor, boolean dummy) {\n    map = new linkedhashmap<>(initialcapacity, loadfactor);\n}\n\n\nä¸åäº hashset public æé æ¹æ³ä¸­åå§åç hashmap å®ä¾ï¼è¿ä¸ªæé æ¹æ³ä¸­ï¼åå§åäº linkedhashmap å®ä¾ã\n\nä¹å°±æ¯è¯´ï¼å®éä¸ï¼linkedhashset ç»´æ¤äºä¸ä¸ªåé¾è¡¨ãç±åé¾è¡¨çç¹æ§å¯ä»¥ç¥éï¼å®æ¯æç§åç´ çæå¥é¡ºåºä¿å­çãæä»¥ï¼è¿å°±æ¯ linkedhashset ä¸­å­å¨çåç´ æ¯æç§æå¥é¡ºåºä¿å­çåçã\n\n\n# enumset ç±»\n\nenumset ç±»å®ä¹å¦ä¸ï¼\n\npublic abstract class enumset<e extends enum<e>> extends abstractset<e>\n    implements cloneable, java.io.serializable {}\n\n\n\n# enumset è¦ç¹\n\n * enumset ç»§æ¿äº abstractsetï¼æä»¥æ set æ¥å£ä¸­çéª¨å¹²æ¹æ³ã\n * enumset å®ç°äº cloneableï¼æä»¥æ¯æåéã\n * enumset å®ç°äº serializableï¼æä»¥æ¯æåºååã\n * enumset éè¿ <e extends enum<e>> éå®äºå­å¨åç´ å¿é¡»æ¯æä¸¾å¼ã\n * enumset æ²¡ææé æ¹æ³ï¼åªè½éè¿ç±»ä¸­ç static æ¹æ³æ¥åå»º enumset å¯¹è±¡ã\n * enumset æ¯æåºçãä»¥æä¸¾å¼å¨ enumset ç±»ä¸­çå®ä¹é¡ºåºæ¥å³å®éååç´ çé¡ºåºã\n * enumset ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# è¦ç¹æ»ç»\n\n\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³ï¼thinking in javaï¼',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å®¹å¨ä¹ Map",frontmatter:{title:"Java å®¹å¨ä¹ Map",date:"2019-12-29T21:49:58.000Z",categories:["Java","JavaSE","å®¹å¨"],tags:["Java","JavaSE","å®¹å¨"],permalink:"/pages/385755/"},regularPath:"/01.Java/01.JavaSE/03.%E5%AE%B9%E5%99%A8/03.Java%E5%AE%B9%E5%99%A8%E4%B9%8BMap.html",relativePath:"01.Java/01.JavaSE/03.å®¹å¨/03.Javaå®¹å¨ä¹Map.md",key:"v-5b80a7d7",path:"/pages/385755/",headers:[{level:2,title:"Map ç®ä»",slug:"map-ç®ä»",normalizedTitle:"map ç®ä»",charIndex:19},{level:3,title:"Map æ¶æ",slug:"map-æ¶æ",normalizedTitle:"map æ¶æ",charIndex:30},{level:3,title:"Map æ¥å£",slug:"map-æ¥å£",normalizedTitle:"map æ¥å£",charIndex:450},{level:3,title:"Map.Entry æ¥å£",slug:"map-entry-æ¥å£",normalizedTitle:"map.entry æ¥å£",charIndex:1475},{level:3,title:"AbstractMap æ½è±¡ç±»",slug:"abstractmap-æ½è±¡ç±»",normalizedTitle:"abstractmap æ½è±¡ç±»",charIndex:1630},{level:3,title:"SortedMap æ¥å£",slug:"sortedmap-æ¥å£",normalizedTitle:"sortedmap æ¥å£",charIndex:2066},{level:3,title:"NavigableMap æ¥å£",slug:"navigablemap-æ¥å£",normalizedTitle:"navigablemap æ¥å£",charIndex:441},{level:3,title:"Dictionary æ½è±¡ç±»",slug:"dictionary-æ½è±¡ç±»",normalizedTitle:"dictionary æ½è±¡ç±»",charIndex:3194},{level:2,title:"HashMap ç±»",slug:"hashmap-ç±»",normalizedTitle:"hashmap ç±»",charIndex:1260},{level:3,title:"HashMap è¦ç¹",slug:"hashmap-è¦ç¹",normalizedTitle:"hashmap è¦ç¹",charIndex:3361},{level:3,title:"HashMap åç",slug:"hashmap-åç",normalizedTitle:"hashmap åç",charIndex:4018},{level:4,title:"HashMap æ°æ®ç»æ",slug:"hashmap-æ°æ®ç»æ",normalizedTitle:"hashmap æ°æ®ç»æ",charIndex:4032},{level:4,title:"HashMap æé æ¹æ³",slug:"hashmap-æé æ¹æ³",normalizedTitle:"hashmap æé æ¹æ³",charIndex:4721},{level:4,title:"put æ¹æ³çå®ç°",slug:"put-æ¹æ³çå®ç°",normalizedTitle:"put æ¹æ³çå®ç°",charIndex:5011},{level:4,title:"get æ¹æ³çå®ç°",slug:"get-æ¹æ³çå®ç°",normalizedTitle:"get æ¹æ³çå®ç°",charIndex:7645},{level:4,title:"hash æ¹æ³çå®ç°",slug:"hash-æ¹æ³çå®ç°",normalizedTitle:"hash æ¹æ³çå®ç°",charIndex:8871},{level:4,title:"resize çå®ç°",slug:"resize-çå®ç°",normalizedTitle:"resize çå®ç°",charIndex:10269},{level:2,title:"LinkedHashMap ç±»",slug:"linkedhashmap-ç±»",normalizedTitle:"linkedhashmap ç±»",charIndex:13933},{level:3,title:"LinkedHashMap è¦ç¹",slug:"linkedhashmap-è¦ç¹",normalizedTitle:"linkedhashmap è¦ç¹",charIndex:13953},{level:3,title:"LinkedHashMap è¦ç¹",slug:"linkedhashmap-è¦ç¹-2",normalizedTitle:"linkedhashmap è¦ç¹",charIndex:13953},{level:4,title:"LinkedHashMap æ°æ®ç»æ",slug:"linkedhashmap-æ°æ®ç»æ",normalizedTitle:"linkedhashmap æ°æ®ç»æ",charIndex:14196},{level:2,title:"TreeMap ç±»",slug:"treemap-ç±»",normalizedTitle:"treemap ç±»",charIndex:14652},{level:3,title:"TreeMap è¦ç¹",slug:"treemap-è¦ç¹",normalizedTitle:"treemap è¦ç¹",charIndex:14666},{level:3,title:"TreeMap åç",slug:"treemap-åç",normalizedTitle:"treemap åç",charIndex:14789},{level:4,title:"put æ¹æ³",slug:"put-æ¹æ³",normalizedTitle:"put æ¹æ³",charIndex:1968},{level:4,title:"get æ¹æ³",slug:"get-æ¹æ³",normalizedTitle:"get æ¹æ³",charIndex:7645},{level:3,title:"remove æ¹æ³",slug:"remove-æ¹æ³",normalizedTitle:"remove æ¹æ³",charIndex:17066},{level:3,title:"TreeMap ç¤ºä¾",slug:"treemap-ç¤ºä¾",normalizedTitle:"treemap ç¤ºä¾",charIndex:18802},{level:2,title:"WeakHashMap",slug:"weakhashmap",normalizedTitle:"weakhashmap",charIndex:886},{level:2,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:20781},{level:3,title:"Map ç®ä»",slug:"map-ç®ä»-2",normalizedTitle:"map ç®ä»",charIndex:19},{level:3,title:"HashMap",slug:"hashmap",normalizedTitle:"hashmap",charIndex:412},{level:3,title:"å¶ä» Map",slug:"å¶ä»-map",normalizedTitle:"å¶ä» map",charIndex:20815},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:20828}],headersStr:"Map ç®ä» Map æ¶æ Map æ¥å£ Map.Entry æ¥å£ AbstractMap æ½è±¡ç±» SortedMap æ¥å£ NavigableMap æ¥å£ Dictionary æ½è±¡ç±» HashMap ç±» HashMap è¦ç¹ HashMap åç HashMap æ°æ®ç»æ HashMap æé æ¹æ³ put æ¹æ³çå®ç° get æ¹æ³çå®ç° hash æ¹æ³çå®ç° resize çå®ç° LinkedHashMap ç±» LinkedHashMap è¦ç¹ LinkedHashMap è¦ç¹ LinkedHashMap æ°æ®ç»æ TreeMap ç±» TreeMap è¦ç¹ TreeMap åç put æ¹æ³ get æ¹æ³ remove æ¹æ³ TreeMap ç¤ºä¾ WeakHashMap æ»ç» Map ç®ä» HashMap å¶ä» Map åèèµæ",content:'# Java å®¹å¨ä¹ Map\n\n\n# Map ç®ä»\n\n\n# Map æ¶æ\n\n\n\nMap å®¶æä¸»è¦æååè½å¦ä¸ï¼\n\n * Map æ¯ Map å®¹å¨å®¶æçç¥åï¼Map æ¯ä¸ä¸ªç¨äºä¿å­é®å¼å¯¹(key-value)çæ¥å£ãMap ä¸­ä¸è½åå«éå¤çé®ï¼æ¯ä¸ªé®æå¤åªè½æ å°å°ä¸ä¸ªå¼ã\n * AbstractMap ç»§æ¿äº Map çæ½è±¡ç±»ï¼å®å®ç°äº Map ä¸­çæ ¸å¿ APIãå¶å® Map çå®ç°ç±»å¯ä»¥éè¿ç»§æ¿ AbstractMap æ¥åå°éå¤ç¼ç ã\n * SortedMap ç»§æ¿äº Map çæ¥å£ãSortedMap ä¸­çåå®¹æ¯æåºçé®å¼å¯¹ï¼æåºçæ¹æ³æ¯éè¿å®ç°æ¯è¾å¨(Comparator)å®æçã\n * NavigableMap ç»§æ¿äº SortedMap çæ¥å£ãç¸æ¯äº SortedMapï¼NavigableMap æä¸ç³»åçâå¯¼èªâæ¹æ³ï¼å¦"è·åå¤§äº/ç­äºæå¯¹è±¡çé®å¼å¯¹"ãâè·åå°äº/ç­äºæå¯¹è±¡çé®å¼å¯¹âç­ç­ã\n * HashMap ç»§æ¿äº AbstractMapï¼ä½æ²¡å®ç° NavigableMap æ¥å£ãHashMap çä¸»è¦ä½ç¨æ¯å¨å­æ åºçé®å¼å¯¹ï¼è Hash ä¹ä½ç°äºå®çæ¥æ¾æçå¾é«ãHashMap æ¯ä½¿ç¨æå¹¿æ³ç Mapã\n * Hashtable è½ç¶æ²¡æç»§æ¿ AbstractMapï¼ä½å®ç»§æ¿äº Dictionaryï¼Dictionary ä¹æ¯é®å¼å¯¹çæ¥å£ï¼ï¼èä¸ä¹å®ç° Map æ¥å£ãå æ­¤ï¼Hashtable çä¸»è¦ä½ç¨æ¯å¨å­æ åºçé®å¼å¯¹ãå HashMap ç¸æ¯ï¼Hashtable å¨å®çä¸»è¦æ¹æ³ä¸­ä½¿ç¨ synchronized å³é®å­ä¿®é¥°ï¼æ¥ä¿è¯çº¿ç¨å®å¨ãä½æ¯ï¼ç±äºå®çéç²åº¦å¤ªå¤§ï¼éå¸¸å½±åè¯»åéåº¦ï¼æä»¥ï¼ç°ä»£ Java ç¨åºå ä¹ä¸ä¼ä½¿ç¨ Hashtable ï¼å¦æéè¦ä¿è¯çº¿ç¨å®å¨ï¼ä¸è¬ä¼ç¨ ConcurrentHashMap æ¥æ¿ä»£ã\n * TreeMap ç»§æ¿äº AbstractMapï¼ä¸å®ç°äº NavigableMap æ¥å£ãTreeMap çä¸»è¦ä½ç¨æ¯å¨å­æåºçé®å¼å¯¹ï¼æåºä¾æ®æ ¹æ®åç´ ç±»åç Comparator èå®ã\n * WeakHashMap ç»§æ¿äº AbstractMapãWeakHashMap çé®æ¯å¼±å¼ç¨ ï¼å³ WeakReferenceï¼ï¼å®çä¸»è¦ä½ç¨æ¯å½ GC åå­ä¸è¶³æ¶ï¼ä¼èªå¨å° WeakHashMap ä¸­ç key åæ¶ï¼è¿é¿åäº WeakHashMap çåå­ç©ºé´æ éè¨èãå¾ææ¾ï¼WeakHashMap éç¨äºä½ä¸ºç¼å­ã\n\n\n# Map æ¥å£\n\nMap çå®ä¹å¦ä¸ï¼\n\npublic interface Map<K,V> { }\n\n\nMap æ¯ä¸ä¸ªç¨äºä¿å­é®å¼å¯¹(key-value)çæ¥å£ãMap ä¸­ä¸è½åå«éå¤çé®ï¼æ¯ä¸ªé®æå¤åªè½æ å°å°ä¸ä¸ªå¼ã\n\nMap æ¥å£æä¾ä¸ç§ Collection è§å¾ï¼åè®¸ä»¥é®éãå¼éæé®-å¼æ å°å³ç³»éçå½¢å¼è®¿é®æ°æ®ã\n\nMap æäºå®ç°ç±»ï¼å¯ä»¥æåºçä¿å­åç´ ï¼å¦ TreeMapï¼å¦ä¸äºå®ç°ç±»åä¸ä¿è¯é¡ºåºï¼å¦ HashMap ç±»ã\n\nMap çå®ç°ç±»åºè¯¥æä¾ 2 ä¸ªâæ åçâæé æ¹æ³ï¼\n\n * voidï¼æ åæ°ï¼æé æ¹æ³ï¼ç¨äºåå»ºç©º Mapï¼\n * å¸¦æåä¸ª Map ç±»ååæ°çæé æ¹æ³ï¼ç¨äºåå»ºä¸ä¸ªä¸å¶åæ°å·æç¸åé®-å¼æ å°å³ç³»çæ° Mapã\n\nå®éä¸ï¼åä¸ä¸ªæé æ¹æ³åè®¸ç¨æ·å¤å¶ä»»æ Mapï¼çææéç±»çä¸ä¸ªç­ä»· Mapãå°½ç®¡æ æ³å¼ºå¶æ§è¡æ­¤å»ºè®®ï¼å ä¸ºæ¥å£ä¸è½åå«æé æ¹æ³ï¼ï¼ä½æ¯ JDK ä¸­ææéç¨ç Map å®ç°é½éµä»å®ã\n\n\n# Map.Entry æ¥å£\n\nMap.Entry ä¸è¬ç¨äºéè¿è¿­ä»£å¨ï¼Iteratorï¼è®¿é®é® Mapã\n\nMap.Entry æ¯ Map ä¸­åé¨çä¸ä¸ªæ¥å£ï¼Map.Entry ä»£è¡¨äº é®å¼å¯¹ å®ä½ï¼Map éè¿ entrySet() è·å Map.Entry éåï¼ä»èéè¿è¯¥éåå®ç°å¯¹é®å¼å¯¹çæä½ã\n\n\n# AbstractMap æ½è±¡ç±»\n\nAbstractMap çå®ä¹å¦ä¸ï¼\n\npublic abstract class AbstractMap<K,V> implements Map<K,V> {}\n\n\nAbstractMap æ½è±¡ç±»æä¾äº Map æ¥å£çæ ¸å¿å®ç°ï¼ä»¥æå¤§éåº¦å°åå°å®ç° Map æ¥å£æéçå·¥ä½ã\n\nè¦å®ç°ä¸å¯ä¿®æ¹ç Mapï¼ç¼ç¨äººååªéæ©å±æ­¤ç±»å¹¶æä¾ entrySet() æ¹æ³çå®ç°å³å¯ï¼è¯¥æ¹æ³å°è¿å Map çæ å°å³ç³» Set è§å¾ãéå¸¸ï¼è¿åç set å°ä¾æ¬¡å¨ AbstractSet ä¸å®ç°ãæ­¤ Set ä¸æ¯æ add() æ remove() æ¹æ³ï¼å¶è¿­ä»£å¨ä¹ä¸æ¯æ remove() æ¹æ³ã\n\nè¦å®ç°å¯ä¿®æ¹ç Mapï¼ç¼ç¨äººåå¿é¡»å¦å¤éåæ­¤ç±»ç put æ¹æ³ï¼å¦åå°æåº UnsupportedOperationExceptionï¼ï¼entrySet().iterator() è¿åçè¿­ä»£å¨ä¹å¿é¡»å¦å¤å®ç°å¶ remove() æ¹æ³ã\n\n\n# SortedMap æ¥å£\n\nSortedMap çå®ä¹å¦ä¸ï¼\n\npublic interface SortedMap<K,V> extends Map<K,V> { }\n\n\nSortedMap ç»§æ¿äº Map ï¼å®æ¯ä¸ä¸ªæåºç Mapã\n\nSortedMap çæåºæ¹å¼æä¸¤ç§ï¼èªç¶æåºæèç¨æ·æå®æ¯è¾å¨ãæå¥æåº SortedMap çææåç´ é½å¿é¡»å®ç° Comparable æ¥å£ï¼æèè¢«æå®çæ¯è¾å¨ææ¥åï¼ã\n\nå¦å¤ï¼ææ SortedMap å®ç°ç±»é½åºè¯¥æä¾ 4 ä¸ªâæ åâæé æ¹æ³ï¼\n\n 1. voidï¼æ åæ°ï¼æé æ¹æ³ï¼å®åå»ºä¸ä¸ªç©ºçæåº Mapï¼æç§é®çèªç¶é¡ºåºè¿è¡æåºã\n 2. å¸¦æä¸ä¸ª Comparator ç±»ååæ°çæé æ¹æ³ï¼å®åå»ºä¸ä¸ªç©ºçæåº Mapï¼æ ¹æ®æå®çæ¯è¾å¨è¿è¡æåºã\n 3. å¸¦æä¸ä¸ª Map ç±»ååæ°çæé æ¹æ³ï¼å®åå»ºä¸ä¸ªæ°çæåº Mapï¼å¶é®-å¼æ å°å³ç³»ä¸åæ°ç¸åï¼æç§é®çèªç¶é¡ºåºè¿è¡æåºã\n 4. å¸¦æä¸ä¸ª SortedMap ç±»ååæ°çæé æ¹æ³ï¼å®åå»ºä¸ä¸ªæ°çæåº Mapï¼å¶é®-å¼æ å°å³ç³»åæåºæ¹æ³ä¸è¾å¥çæåº Map ç¸åãæ æ³ä¿è¯å¼ºå¶å®æ½æ­¤å»ºè®®ï¼å ä¸ºæ¥å£ä¸è½åå«æé æ¹æ³ã\n\n\n# NavigableMap æ¥å£\n\nNavigableMap çå®ä¹å¦ä¸ï¼\n\npublic interface NavigableMap<K,V> extends SortedMap<K,V> { }\n\n\nNavigableMap ç»§æ¿äº SortedMap ï¼å®æä¾äºä¸°å¯çæ¥æ¾æ¹æ³ã\n\nNavigableMap åå«æä¾äºè·åâé®âãâé®-å¼å¯¹âãâé®éâãâé®-å¼å¯¹éâçç¸å³æ¹æ³ã\n\nNavigableMap æä¾çåè½å¯ä»¥åä¸º 4 ç±»ï¼\n\n * è·åé®-å¼å¯¹\n   * lowerEntryãfloorEntryãceilingEntry å higherEntry æ¹æ³ï¼å®ä»¬åå«è¿åä¸å°äºãå°äºç­äºãå¤§äºç­äºãå¤§äºç»å®é®çé®å³èç Map.Entry å¯¹è±¡ã\n   * firstEntryãpollFirstEntryãlastEntry å pollLastEntry æ¹æ³ï¼å®ä»¬è¿åå/æç§»é¤æå°åæå¤§çæ å°å³ç³»ï¼å¦æå­å¨ï¼ï¼å¦åè¿å nullã\n * è·åé®ãè¿ä¸ªåç¬¬ 1 ç±»æ¯è¾ç±»ä¼¼ã\n   * lowerKeyãfloorKeyãceilingKey å higherKey æ¹æ³ï¼å®ä»¬åå«è¿åä¸å°äºãå°äºç­äºãå¤§äºç­äºãå¤§äºç»å®é®çé®ã\n * è·åé®çéå\n   * navigableKeySetãdescendingKeySet åå«è·åæ­£åº/ååºçé®éã\n * è·åé®-å¼å¯¹çå­é\n\n\n# Dictionary æ½è±¡ç±»\n\nDictionary çå®ä¹å¦ä¸ï¼\n\npublic abstract class Dictionary<K,V> {}\n\n\nDictionary æ¯ JDK 1.0 å®ä¹çæä½é®å¼å¯¹çæ½è±¡ç±»ï¼å®åæ¬äºæä½é®å¼å¯¹çåºæ¬æ¹æ³ã\n\n\n# HashMap ç±»\n\nHashMap ç±»æ¯æå¸¸ç¨ç Mapã\n\n\n# HashMap è¦ç¹\n\nä» HashMap çå½åï¼ä¹å¯ä»¥çåºï¼HashMap ä»¥æ£åæ¹å¼å­å¨é®å¼å¯¹ã\n\nHashMap åè®¸ä½¿ç¨ç©ºå¼åç©ºé®ãï¼HashMap ç±»å¤§è´ç­åäº Hashtableï¼é¤äºå®æ¯ä¸åæ­¥çå¹¶ä¸åè®¸ä¸ºç©ºå¼ãï¼è¿ä¸ªç±»ä¸ä¿åºï¼ç¹å«æ¯ï¼å®çåç´ é¡ºåºå¯è½ä¼éçæ¶é´çæ¨ç§»ååã\n\nHashMap æä¸¤ä¸ªå½±åå¶æ§è½çåæ°ï¼åå§å®¹éåè´è½½å å­ã\n\n * å®¹éæ¯åå¸è¡¨ä¸­æ¡¶çæ°éï¼åå§å®¹éå°±æ¯åå¸è¡¨åå»ºæ¶çå®¹éã\n * å è½½å å­æ¯æ£åè¡¨å¨å¶å®¹éèªå¨æ©å®¹ä¹åè¢«åè®¸çæå¤§é¥±åéãå½åå¸è¡¨ä¸­ç entry æ°éè¶è¿è´è½½å å­åå½åå®¹éçä¹ç§¯æ¶ï¼æ£åè¡¨å°±ä¼è¢«éæ°æ å°ï¼å³éå»ºåé¨æ°æ®ç»æï¼ï¼ä¸è¬æ£åè¡¨å¤§çº¦æ¯å­å¨æ¡¶æ°éçä¸¤åã\n\néå¸¸ï¼é»è®¤å è½½å å­ï¼0.75ï¼å¨æ¶é´åç©ºé´ææ¬ä¹é´æä¾äºè¯å¥½çå¹³è¡¡ãè¾é«çå¼ä¼åå°ç©ºé´å¼éï¼ä½ä¼å¢å æ¥æ¾ææ¬ï¼åæ å¨å¤§é¨å HashMap ç±»çæä½ä¸­ï¼åæ¬ get å putï¼ãå¨è®¾ç½®åå§å®¹éæ¶ï¼åºèèæ å°ä¸­çæ¡ç®æ°éåå¶è´è½½å å­ï¼ä»¥å°½éåå°éæ°è¿è¡æä½çæ¬¡æ°ãå¦æåå§å®¹éå¤§äºæå¤§å¥å£æ°é¤ä»¥è´è½½å å­ï¼åä¸ä¼åçéæ°å·æ°æä½ã\n\nå¦æè®¸å¤æ å°è¦å­å¨å¨ HashMap å®ä¾ä¸­ï¼ä½¿ç¨è¶³å¤å¤§çå®¹éåå»ºæ å°å°åè®¸æ å°å­å¨çæçé«äºæ ¹æ®éè¦æ§è¡èªå¨éæ°æ£åä»¥å¢é¿è¡¨ãè¯·æ³¨æï¼ä½¿ç¨å¤ä¸ªå·æç¸å hashCode() çå¯é¥æ¯éä½ä»»ä½æ£åè¡¨æ§è½çä¸ä¸ªå¯é æ¹æ³ãä¸ºäºæ¹åå½±åï¼å½é®æ¯ Comparable æ¶ï¼è¯¥ç±»å¯ä»¥ä½¿ç¨é®ä¹é´çæ¯è¾é¡ºåºæ¥å¸®å©æ­å¼å³ç³»ã\n\nHashMap ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# HashMap åç\n\n# HashMap æ°æ®ç»æ\n\nHashMap çæ ¸å¿å­æ®µï¼\n\n * table - HashMap ä½¿ç¨ä¸ä¸ª Node<K,V>[] ç±»åçæ°ç» table æ¥å¨å­åç´ ã\n * size - åå§å®¹éã åå§ä¸º 16ï¼æ¯æ¬¡å®¹éä¸å¤èªå¨æ©å®¹\n * loadFactor - è´è½½å å­ãèªå¨æ©å®¹ä¹åè¢«åè®¸çæå¤§é¥±åéï¼é»è®¤ 0.75ã\n\npublic class HashMap<K,V> extends AbstractMap<K,V>\n    implements Map<K,V>, Cloneable, Serializable {\n\n    // è¯¥è¡¨å¨åæ¬¡ä½¿ç¨æ¶åå§åï¼å¹¶æ ¹æ®éè¦è°æ´å¤§å°ãåéæ¶ï¼é¿åº¦æ»æ¯2çå¹ã\n    transient Node<K,V>[] table;\n    // ä¿å­ç¼å­ç entrySet()ãè¯·æ³¨æï¼AbstractMap å­æ®µç¨äº keySet() å values()ã\n    transient Set<Map.Entry<K,V>> entrySet;\n    // map ä¸­çé®å¼å¯¹æ°\n    transient int size;\n    // è¿ä¸ªHashMapè¢«ç»æä¿®æ¹çæ¬¡æ°ç»æä¿®æ¹æ¯é£äºæ¹åHashMapä¸­çæ å°æ°éæèä¿®æ¹å¶åé¨ç»æï¼ä¾å¦ï¼éæ°æ£åï¼çä¿®æ¹ã\n    transient int modCount;\n    // ä¸ä¸ä¸ªè°æ´å¤§å°çå¼ï¼å®¹é*å è½½å å­ï¼ã\n    int threshold;\n    // æ£åè¡¨çå è½½å å­\n    final float loadFactor;\n}\n\n\n# HashMap æé æ¹æ³\n\npublic HashMap(); // é»è®¤å è½½å å­0.75\npublic HashMap(int initialCapacity); // é»è®¤å è½½å å­0.75ï¼ä»¥ initialCapacity åå§åå®¹é\npublic HashMap(int initialCapacity, float loadFactor); // ä»¥ initialCapacity åå§åå®¹éï¼ä»¥ loadFactor åå§åå è½½å å­\npublic HashMap(Map<? extends K, ? extends V> m) // é»è®¤å è½½å å­0.75\n\n\n# put æ¹æ³çå®ç°\n\nput æ¹æ³å¤§è´çæè·¯ä¸ºï¼\n\n * å¯¹ key ç hashCode() å hash è®¡ç®ï¼ç¶åæ ¹æ® hash å¼åè®¡ç® Node çå­å¨ä½ç½®;\n * å¦ææ²¡æåå¸ç¢°æï¼ç´æ¥æ¾å°æ¡¶éï¼å¦ææåå¸ç¢°æï¼ä»¥é¾è¡¨çå½¢å¼å­å¨æ¡¶åã\n * å¦æåå¸ç¢°æå¯¼è´é¾è¡¨è¿é¿(å¤§äºç­äº TREEIFY_THRESHOLDï¼æ°å¼ä¸º 8)ï¼å°±æé¾è¡¨è½¬æ¢æçº¢é»æ ï¼\n * å¦æèç¹å·²ç»å­å¨å°±æ¿æ¢æ§å¼\n * æ¡¶æ°éè¶è¿å®¹é*è´è½½å å­ï¼å³ load factor * current capacityï¼ï¼HashMap è°ç¨ resize èªå¨æ©å®¹ä¸å\n\nå·ä½ä»£ç çå®ç°å¦ä¸ï¼\n\npublic V put(K key, V value) {\n    return putVal(hash(key), key, value, false, true);\n}\n\n// hashcode æ ç¬¦å·ä½ç§» 16 ä½\nstatic final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n}\n\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,\n                   boolean evict) {\n    Node<K,V>[] tab; Node<K,V> p; int n, i;\n    // tab ä¸ºç©ºååå»º\n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    // è®¡ç® indexï¼å¹¶å¯¹ null åå¤ç\n    if ((p = tab[i = (n - 1) & hash]) == null)\n        tab[i] = newNode(hash, key, value, null);\n    else {\n        Node<K,V> e; K k;\n        // èç¹å­å¨\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            e = p;\n        // è¯¥é¾ä¸ºæ \n        else if (p instanceof TreeNode)\n            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);\n        // è¯¥é¾ä¸ºé¾è¡¨\n        else {\n            for (int binCount = 0; ; ++binCount) {\n                if ((e = p.next) == null) {\n                    p.next = newNode(hash, key, value, null);\n                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                        treeifyBin(tab, hash);\n                    break;\n                }\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    break;\n                p = e;\n            }\n        }\n        // åå¥\n        if (e != null) { // existing mapping for key\n            V oldValue = e.value;\n            if (!onlyIfAbsent || oldValue == null)\n                e.value = value;\n            afterNodeAccess(e);\n            return oldValue;\n        }\n    }\n    ++modCount;\n    if (++size > threshold)\n        resize();\n    afterNodeInsertion(evict);\n    return null;\n}\n\n\nä¸ºä»ä¹è®¡ç® hash ä½¿ç¨ hashcode æ ç¬¦å·ä½ç§» 16 ä½ã\n\nåè®¾è¦æ·»å ä¸¤ä¸ªå¯¹è±¡ a å bï¼å¦ææ°ç»é¿åº¦æ¯ 16ï¼è¿æ¶å¯¹è±¡ a å b éè¿å¬å¼ (n - 1) & hash è¿ç®ï¼ä¹å°±æ¯ (16-1)ï¼a.hashCode å (16-1)ï¼b.hashCodeï¼15 çäºè¿å¶ä¸º 0000000000000000000000000001111ï¼åè®¾å¯¹è±¡ A ç hashCode ä¸º 1000010001110001000001111000000ï¼å¯¹è±¡ B ç hashCode ä¸º 0111011100111000101000010100000ï¼ä½ ä¼åç°ä¸è¿°ä¸è¿ç®ç»æé½æ¯ 0ãè¿æ ·çåå¸ç»æå°±å¤ªè®©äººå¤±æäºï¼å¾ææ¾ä¸æ¯ä¸ä¸ªå¥½çåå¸ç®æ³ã\n\nä½å¦ææä»¬å° hashCode å¼å³ç§» 16 ä½ï¼h >>> 16 ä»£è¡¨æ ç¬¦å·å³ç§» 16 ä½ï¼ï¼ä¹å°±æ¯å int ç±»åçä¸åï¼åå¥½å¯ä»¥å°è¯¥äºè¿å¶æ°å¯¹ååå¼ï¼å¹¶ä¸ä½¿ç¨ä½å¼æè¿ç®ï¼å¦æä¸¤ä¸ªæ°å¯¹åºçä½ç½®ç¸åï¼åç»æä¸º 1ï¼åä¹ä¸º 0ï¼ï¼è¿æ ·çè¯ï¼å°±è½é¿åä¸é¢çæåµåçãè¿å°±æ¯ hash() æ¹æ³çå·ä½å®ç°æ¹å¼ãç®èè¨ä¹ï¼å°±æ¯å°½éæä¹± hashCode çæ­£åä¸è¿ç®çä½ 16 ä½ã\n\n# get æ¹æ³çå®ç°\n\nå¨çè§£äº put ä¹åï¼get å°±å¾ç®åäºãå¤§è´æè·¯å¦ä¸ï¼\n\n * å¯¹ key ç hashCode() å hash è®¡ç®ï¼ç¶åæ ¹æ® hash å¼åè®¡ç®æ¡¶ç index\n\n * å¦ææ¡¶ä¸­çç¬¬ä¸ä¸ªèç¹å½ä¸­ï¼ç´æ¥è¿åï¼\n\n * å¦ææå²çªï¼åéè¿ key.equals(k) å»æ¥æ¾å¯¹åºç entry\n   \n   * è¥ä¸ºæ ï¼åå¨çº¢é»æ ä¸­éè¿ key.equals(k) æ¥æ¾ï¼O(logn)ï¼\n   \n   * è¥ä¸ºé¾è¡¨ï¼åå¨é¾è¡¨ä¸­éè¿ key.equals(k) æ¥æ¾ï¼O(n)ã\n\nå·ä½ä»£ç çå®ç°å¦ä¸ï¼\n\npublic V get(Object key) {\n    Node<K,V> e;\n    return (e = getNode(hash(key), key)) == null ? null : e.value;\n}\n\nfinal Node<K,V> getNode(int hash, Object key) {\n        Node<K,V>[] tab; Node<K,V> first, e; int n; K k;\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (first = tab[(n - 1) & hash]) != null) {\n        // ç´æ¥å½ä¸­\n        if (first.hash == hash && // always check first node\n            ((k = first.key) == key || (key != null && key.equals(k))))\n            return first;\n        // æªå½ä¸­\n        if ((e = first.next) != null) {\n            // å¨æ ä¸­ get\n            if (first instanceof TreeNode)\n                return ((TreeNode<K,V>)first).getTreeNode(hash, key);\n            // å¨é¾è¡¨ä¸­ get\n            do {\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    return e;\n            } while ((e = e.next) != null);\n        }\n    }\n    return null;\n}\n\n\n# hash æ¹æ³çå®ç°\n\nHashMap è®¡ç®æ¡¶ä¸æ ï¼indexï¼å¬å¼ï¼key.hashCode() ^ (h >>> 16)ã\n\nä¸é¢éå¯¹è¿ä¸ªå¬å¼æ¥è¯¦ç»è®²è§£ã\n\nå¨ get å put çè¿ç¨ä¸­ï¼è®¡ç®ä¸æ æ¶ï¼åå¯¹ hashCode è¿è¡ hash æä½ï¼ç¶ååéè¿ hash å¼è¿ä¸æ­¥è®¡ç®ä¸æ ï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå¨å¯¹ hashCode() è®¡ç® hash æ¶å·ä½å®ç°æ¯è¿æ ·çï¼\n\nstatic final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n}\n\n\nå¯ä»¥çå°è¿ä¸ªæ¹æ³å¤§æ¦çä½ç¨å°±æ¯ï¼é« 16bit ä¸åï¼ä½ 16bit åé« 16bit åäºä¸ä¸ªå¼æã\n\nå¨è®¾è®¡ hash æ¹æ³æ¶ï¼å ä¸ºç®åç table é¿åº¦ n ä¸º 2 çå¹ï¼èè®¡ç®ä¸æ çæ¶åï¼æ¯è¿æ ·å®ç°ç(ä½¿ç¨ & ä½æä½ï¼èé % æ±ä½)ï¼\n\n(n - 1) & hash\n\n\nè®¾è®¡èè®¤ä¸ºè¿æ¹æ³å¾å®¹æåçç¢°æãä¸ºä»ä¹è¿ä¹è¯´å¢ï¼ä¸å¦¨æèä¸ä¸ï¼å¨ n - 1 ä¸º 15(0x1111) æ¶ï¼å¶å®æ£åçæ­£çæçåªæ¯ä½ 4bit çææä½ï¼å½ç¶å®¹æç¢°æäºã\n\nå æ­¤ï¼è®¾è®¡èæ³äºä¸ä¸ªé¡¾å¨å¤§å±çæ¹æ³(ç»¼åèèäºéåº¦ãä½ç¨ãè´¨é)ï¼å°±æ¯æé« 16bit åä½ 16bit å¼æäºä¸ä¸ãè®¾è®¡èè¿è§£éå°å ä¸ºç°å¨å¤§å¤æ°ç hashCode çåå¸å·²ç»å¾ä¸éäºï¼å°±ç®æ¯åçäºç¢°æä¹ç¨ O(logn)ç tree å»åäºãä»ä»å¼æä¸ä¸ï¼æ¢åå°äºç³»ç»çå¼éï¼ä¹ä¸ä¼é æçå ä¸ºé«ä½æ²¡æåä¸ä¸æ çè®¡ç®(table é¿åº¦æ¯è¾å°æ¶)ï¼ä»èå¼èµ·çç¢°æã\n\nå¦æè¿æ¯äº§çäºé¢ç¹çç¢°æï¼ä¼åçä»ä¹é®é¢å¢ï¼ä½èæ³¨éè¯´ï¼ä»ä»¬ä½¿ç¨æ æ¥å¤çé¢ç¹çç¢°æ(we use trees to handle large sets of collisions in bins)ï¼å¨ JEP-180 ä¸­ï¼æè¿°äºè¿ä¸ªé®é¢ï¼\n\n> Improve the performance of java.util.HashMap under high hash-collision conditions by using balanced trees rather than linked lists to store map entries. Implement the same improvement in the LinkedHashMap class.\n\nä¹åå·²ç»æè¿ï¼å¨è·å HashMap çåç´ æ¶ï¼åºæ¬åä¸¤æ­¥ï¼\n\n 1. é¦åæ ¹æ® hashCode()å hashï¼ç¶åç¡®å® bucket ç indexï¼\n\n 2. å¦æ bucket çèç¹ç key ä¸æ¯æä»¬éè¦çï¼åéè¿ keys.equals()å¨é¾ä¸­æ¾ã\n\nå¨ JDK8 ä¹åçå®ç°ä¸­æ¯ç¨é¾è¡¨è§£å³å²çªçï¼å¨äº§çç¢°æçæåµä¸ï¼è¿è¡ get æ¶ï¼ä¸¤æ­¥çæ¶é´å¤æåº¦æ¯ O(1)+O(n)ãå æ­¤ï¼å½ç¢°æå¾åå®³çæ¶å n å¾å¤§ï¼O(n)çéåº¦æ¾ç¶æ¯å½±åéåº¦çã\n\nå æ­¤å¨ JDK8 ä¸­ï¼å©ç¨çº¢é»æ æ¿æ¢é¾è¡¨ï¼è¿æ ·å¤æåº¦å°±åæäº O(1)+O(logn)äºï¼è¿æ ·å¨ n å¾å¤§çæ¶åï¼è½å¤æ¯è¾çæ³çè§£å³è¿ä¸ªé®é¢ï¼å¨ JDK8ï¼HashMap çæ§è½æåä¸æä¸­ææ§è½æµè¯çç»æã\n\n# resize çå®ç°\n\nå½ put æ¶ï¼å¦æåç°ç®åç bucket å ç¨ç¨åº¦å·²ç»è¶è¿äº Load Factor æå¸æçæ¯ä¾ï¼é£ä¹å°±ä¼åç resizeãå¨ resize çè¿ç¨ï¼ç®åçè¯´å°±æ¯æ bucket æ©åä¸º 2 åï¼ä¹åéæ°è®¡ç® indexï¼æèç¹åæ¾å°æ°ç bucket ä¸­ã\n\nå½è¶è¿éå¶çæ¶åä¼ resizeï¼ç¶èåå ä¸ºæä»¬ä½¿ç¨çæ¯ 2 æ¬¡å¹çæ©å±(æé¿åº¦æ©ä¸ºåæ¥ 2 å)ï¼æä»¥ï¼åç´ çä½ç½®è¦ä¹æ¯å¨åä½ç½®ï¼è¦ä¹æ¯å¨åä½ç½®åç§»å¨ 2 æ¬¡å¹çä½ç½®ã\n\næä¹çè§£å¢ï¼ä¾å¦æä»¬ä» 16 æ©å±ä¸º 32 æ¶ï¼å·ä½çååå¦ä¸æç¤ºï¼\n\n\n\nå æ­¤åç´ å¨éæ°è®¡ç® hash ä¹åï¼å ä¸º n åä¸º 2 åï¼é£ä¹ n-1 ç mask èå´å¨é«ä½å¤ 1bit(çº¢è²)ï¼å æ­¤æ°ç index å°±ä¼åçè¿æ ·çååï¼\n\n\n\nå æ­¤ï¼æä»¬å¨æ©å HashMap çæ¶åï¼ä¸éè¦éæ°è®¡ç® hashï¼åªéè¦ççåæ¥ç hash å¼æ°å¢çé£ä¸ª bit æ¯ 1 è¿æ¯ 0 å°±å¥½äºï¼æ¯ 0 çè¯ç´¢å¼æ²¡åï¼æ¯ 1 çè¯ç´¢å¼åæâåç´¢å¼+oldCapâãå¯ä»¥ççä¸å¾ä¸º 16 æ©åä¸º 32 ç resize ç¤ºæå¾ï¼\n\n\n\nè¿ä¸ªè®¾è®¡ç¡®å®éå¸¸çå·§å¦ï¼æ¢çå»äºéæ°è®¡ç® hash å¼çæ¶é´ï¼èä¸åæ¶ï¼ç±äºæ°å¢ç 1bit æ¯ 0 è¿æ¯ 1 å¯ä»¥è®¤ä¸ºæ¯éæºçï¼å æ­¤ resize çè¿ç¨ï¼ååçæä¹åçå²çªçèç¹åæ£å°æ°ç bucket äºã\n\nfinal Node<K,V>[] resize() {\n    Node<K,V>[] oldTab = table;\n    int oldCap = (oldTab == null) ? 0 : oldTab.length;\n    int oldThr = threshold;\n    int newCap, newThr = 0;\n    if (oldCap > 0) {\n        // è¶è¿æå¤§å¼å°±ä¸åæ©åäºï¼å°±åªå¥½éä½ ç¢°æå»å§\n        if (oldCap >= MAXIMUM_CAPACITY) {\n            threshold = Integer.MAX_VALUE;\n            return oldTab;\n        }\n        // æ²¡è¶è¿æå¤§å¼ï¼å°±æ©åä¸ºåæ¥ç 2 å\n        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&\n                    oldCap >= DEFAULT_INITIAL_CAPACITY)\n            newThr = oldThr << 1; // double threshold\n    }\n    else if (oldThr > 0) // initial capacity was placed in threshold\n        newCap = oldThr;\n    else {               // zero initial threshold signifies using defaults\n        newCap = DEFAULT_INITIAL_CAPACITY;\n        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);\n    }\n\n    // è®¡ç®æ°ç resize ä¸é\n    if (newThr == 0) {\n        float ft = (float)newCap * loadFactor;\n        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?\n                    (int)ft : Integer.MAX_VALUE);\n    }\n    threshold = newThr;\n    @SuppressWarnings({"rawtypes","unchecked"})\n        Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];\n    table = newTab;\n    if (oldTab != null) {\n        // ææ¯ä¸ª bucket é½ç§»å¨å°æ°ç buckets ä¸­\n        for (int j = 0; j < oldCap; ++j) {\n            Node<K,V> e;\n            if ((e = oldTab[j]) != null) {\n                oldTab[j] = null;\n                if (e.next == null)\n                    newTab[e.hash & (newCap - 1)] = e;\n                else if (e instanceof TreeNode)\n                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);\n                else { // preserve order\n                    Node<K,V> loHead = null, loTail = null;\n                    Node<K,V> hiHead = null, hiTail = null;\n                    Node<K,V> next;\n                    do {\n                        next = e.next;\n                        // åç´¢å¼\n                        if ((e.hash & oldCap) == 0) {\n                            if (loTail == null)\n                                loHead = e;\n                            else\n                                loTail.next = e;\n                            loTail = e;\n                        }\n                        // åç´¢å¼+oldCap\n                        else {\n                            if (hiTail == null)\n                                hiHead = e;\n                            else\n                                hiTail.next = e;\n                            hiTail = e;\n                        }\n                    } while ((e = next) != null);\n                    // åç´¢å¼æ¾å°bucketé\n                    if (loTail != null) {\n                        loTail.next = null;\n                        newTab[j] = loHead;\n                    }\n                    // åç´¢å¼+oldCapæ¾å°bucketé\n                    if (hiTail != null) {\n                        hiTail.next = null;\n                        newTab[j + oldCap] = hiHead;\n                    }\n                }\n            }\n        }\n    }\n    return newTab;\n}\n\n\n\n# LinkedHashMap ç±»\n\n\n# LinkedHashMap è¦ç¹\n\nLinkedHashMap éè¿ç»´æ¤ä¸ä¸ªä¿å­æææ¡ç®ï¼Entryï¼çååé¾è¡¨ï¼ä¿è¯äºåç´ è¿­ä»£çé¡ºåºï¼å³æå¥é¡ºåºï¼ã\n\nå³æ³¨ç¹             ç»è®º\næ¯å¦åè®¸é®å¼å¯¹ä¸º null   Key å Value é½åè®¸ null\næ¯å¦åè®¸éå¤æ°æ®        Key éå¤ä¼è¦çãValue åè®¸éå¤\næ¯å¦æåº            æç§åç´ æå¥é¡ºåºå­å¨\næ¯å¦çº¿ç¨å®å¨          éçº¿ç¨å®å¨\n\n\n# LinkedHashMap è¦ç¹\n\n# LinkedHashMap æ°æ®ç»æ\n\nLinkedHashMap éè¿ç»´æ¤ä¸å¯¹ LinkedHashMap.Entry<K,V> ç±»åçå¤´å°¾æéï¼ä»¥åé¾è¡¨å½¢å¼ï¼ä¿å­æææ°æ®ã\n\nå­¦ä¹ è¿æ°æ®ç»æçåé¾è¡¨ï¼å°±è½çè§£å¶åç´ å­å¨ä»¥åè®¿é®å¿ç¶æ¯æåºçã\n\npublic class LinkedHashMap<K,V>\n    extends HashMap<K,V>\n    implements Map<K,V> {\n\n    // åé¾è¡¨çå¤´æé\n    transient LinkedHashMap.Entry<K,V> head;\n    // åé¾è¡¨çå°¾æé\n    transient LinkedHashMap.Entry<K,V> tail;\n    // è¿­ä»£æåºæ¹æ³ï¼true è¡¨ç¤ºè®¿é®é¡ºåºï¼false è¡¨ç¤ºæå¥é¡ºåº\n    final boolean accessOrder;\n}\n\n\nLinkedHashMap ç»§æ¿äº HashMap ç put æ¹æ³ï¼æ¬èº«æ²¡æå®ç° put æ¹æ³ã\n\n\n# TreeMap ç±»\n\n\n# TreeMap è¦ç¹\n\nTreeMap åºäºçº¢é»æ å®ç°ã\n\nTreeMap æ¯æåºçãå®çæåºè§åæ¯ï¼æ ¹æ® map ä¸­ç key çèªç¶è¯­ä¹é¡ºåºææä¾çæ¯è¾å¨ï¼Comparatorï¼çèªå®ä¹æ¯è¾é¡ºåºã\n\nTreeMap ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# TreeMap åç\n\n# put æ¹æ³\n\npublic V put(K key, V value) {\n    Entry<K,V> t = root;\n    // å¦ææ ¹èç¹ä¸º nullï¼æå¥ç¬¬ä¸ä¸ªèç¹\n    if (t == null) {\n        compare(key, key); // type (and possibly null) check\n\n        root = new Entry<>(key, value, null);\n        size = 1;\n        modCount++;\n        return null;\n    }\n    int cmp;\n    Entry<K,V> parent;\n    // split comparator and comparable paths\n    Comparator<? super K> cpr = comparator;\n    // æ¯ä¸ªèç¹çå·¦å­©å­èç¹çå¼å°äºå®ï¼å³å­©å­èç¹çå¼å¤§äºå®\n    // å¦æææ¯è¾å¨ï¼ä½¿ç¨æ¯è¾å¨è¿è¡æ¯è¾\n    if (cpr != null) {\n        do {\n            parent = t;\n            cmp = cpr.compare(key, t.key);\n            if (cmp < 0)\n                t = t.left;\n            else if (cmp > 0)\n                t = t.right;\n            else\n                return t.setValue(value);\n        } while (t != null);\n    }\n    // æ²¡ææ¯è¾å¨ï¼ä½¿ç¨ key çèªç¶é¡ºåºè¿è¡æ¯è¾\n    else {\n        if (key == null)\n            throw new NullPointerException();\n        @SuppressWarnings("unchecked")\n            Comparable<? super K> k = (Comparable<? super K>) key;\n        do {\n            parent = t;\n            cmp = k.compareTo(t.key);\n            if (cmp < 0)\n                t = t.left;\n            else if (cmp > 0)\n                t = t.right;\n            else\n                return t.setValue(value);\n        } while (t != null);\n    }\n    // éè¿ä¸é¢çéåæªæ¾å° key å¼ï¼åæ°æå¥èç¹\n    Entry<K,V> e = new Entry<>(key, value, parent);\n    if (cmp < 0)\n        parent.left = e;\n    else\n        parent.right = e;\n    // æå¥åï¼ä¸ºäºç»´æçº¢é»æ çå¹³è¡¡éè¦è°æ´\n    fixAfterInsertion(e);\n    size++;\n    modCount++;\n    return null;\n}\n\n\n# get æ¹æ³\n\npublic V get(Object key) {\n    Entry<K,V> p = getEntry(key);\n    return (p==null ? null : p.value);\n}\n\nfinal Entry<K,V> getEntry(Object key) {\n    // Offload comparator-based version for sake of performance\n    if (comparator != null)\n        return getEntryUsingComparator(key);\n    if (key == null)\n        throw new NullPointerException();\n    @SuppressWarnings("unchecked")\n        Comparable<? super K> k = (Comparable<? super K>) key;\n    Entry<K,V> p = root;\n    // æç§äºåæ æç´¢çæ¹å¼è¿è¡æç´¢ï¼æå°è¿å\n    while (p != null) {\n        int cmp = k.compareTo(p.key);\n        if (cmp < 0)\n            p = p.left;\n        else if (cmp > 0)\n            p = p.right;\n        else\n            return p;\n    }\n    return null;\n}\n\n\n\n# remove æ¹æ³\n\npublic V remove(Object key) {\n    Entry<K,V> p = getEntry(key);\n    if (p == null)\n        return null;\n\n    V oldValue = p.value;\n    deleteEntry(p);\n    return oldValue;\n}\nprivate void deleteEntry(Entry<K,V> p) {\n    modCount++;\n    size--;\n\n    // å¦æå½åèç¹æå·¦å³å­©å­èç¹ï¼ä½¿ç¨åç»§èç¹æ¿æ¢è¦å é¤çèç¹\n    // If strictly internal, copy successor\'s element to p and then make p\n    // point to successor.\n    if (p.left != null && p.right != null) {\n        Entry<K,V> s = successor(p);\n        p.key = s.key;\n        p.value = s.value;\n        p = s;\n    } // p has 2 children\n\n    // Start fixup at replacement node, if it exists.\n    Entry<K,V> replacement = (p.left != null ? p.left : p.right);\n\n    if (replacement != null) { // è¦å é¤çèç¹æä¸ä¸ªå­©å­èç¹\n        // Link replacement to parent\n        replacement.parent = p.parent;\n        if (p.parent == null)\n            root = replacement;\n        else if (p == p.parent.left)\n            p.parent.left  = replacement;\n        else\n D:\\codes\\zp\\java\\database\\docs\\redis\\åå¸å¼é.md           p.parent.right = replacement;\n\n        // Null out links so they are OK to use by fixAfterDeletion.\n        p.left = p.right = p.parent = null;\n\n        // Fix replacement\n        if (p.color == BLACK)\n            fixAfterDeletion(replacement);\n    } else if (p.parent == null) { // return if we are the only node.\n        root = null;\n    } else { //  No children. Use self as phantom replacement and unlink.\n        if (p.color == BLACK)\n            fixAfterDeletion(p);\n\n        if (p.parent != null) {\n            if (p == p.parent.left)\n                p.parent.left = null;\n            else if (p == p.parent.right)\n                p.parent.right = null;\n            p.parent = null;\n        }\n    }\n}\n\n\n\n# TreeMap ç¤ºä¾\n\npublic class TreeMapDemo {\n\n    private static final String[] chars = "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ");\n\n    public static void main(String[] args) {\n        TreeMap<Integer, String> treeMap = new TreeMap<>();\n        for (int i = 0; i < chars.length; i++) {\n            treeMap.put(i, chars[i]);\n        }\n        System.out.println(treeMap);\n        Integer low = treeMap.firstKey();\n        Integer high = treeMap.lastKey();\n        System.out.println(low);\n        System.out.println(high);\n        Iterator<Integer> it = treeMap.keySet().iterator();\n        for (int i = 0; i <= 6; i++) {\n            if (i == 3) { low = it.next(); }\n            if (i == 6) { high = it.next(); } else { it.next(); }\n        }\n        System.out.println(low);\n        System.out.println(high);\n        System.out.println(treeMap.subMap(low, high));\n        System.out.println(treeMap.headMap(high));\n        System.out.println(treeMap.tailMap(low));\n    }\n}\n\n\n\n# WeakHashMap\n\nWeakHashMap çå®ä¹å¦ä¸ï¼\n\npublic class WeakHashMap<K,V>\n    extends AbstractMap<K,V>\n    implements Map<K,V> {}\n\n\nWeakHashMap ç»§æ¿äº AbstractMapï¼å®ç°äº Map æ¥å£ã\n\nå HashMap ä¸æ ·ï¼WeakHashMap ä¹æ¯ä¸ä¸ªæ£åè¡¨ï¼å®å­å¨çåå®¹ä¹æ¯é®å¼å¯¹(key-value)æ å°ï¼èä¸é®åå¼é½å¯ä»¥æ¯ nullã\n\nä¸è¿ WeakHashMap çé®æ¯å¼±é®ãå¨ WeakHashMap ä¸­ï¼å½æä¸ªé®ä¸åè¢«å¶å®å¯¹è±¡å¼ç¨ï¼ä¼è¢«ä» WeakHashMap ä¸­è¢«èªå¨ç§»é¤ãæ´ç²¾ç¡®å°è¯´ï¼å¯¹äºä¸ä¸ªç»å®çé®ï¼å¶æ å°çå­å¨å¹¶ä¸é»æ­¢åå¾åæ¶å¨å¯¹è¯¥é®çä¸¢å¼ï¼è¿å°±ä½¿è¯¥é®æä¸ºå¯ç»æ­¢çï¼è¢«ç»æ­¢ï¼ç¶åè¢«åæ¶ãæä¸ªé®è¢«ç»æ­¢æ¶ï¼å®å¯¹åºçé®å¼å¯¹ä¹å°±ä»æ å°ä¸­ææå°ç§»é¤äºã\n\nè¿ä¸ªå¼±é®çåçå¢ï¼å¤§è´ä¸å°±æ¯ï¼éè¿ WeakReference å ReferenceQueue å®ç°çã\n\nWeakHashMap ç key æ¯å¼±é®ï¼å³æ¯ WeakReference ç±»åçï¼ReferenceQueue æ¯ä¸ä¸ªéåï¼å®ä¼ä¿å­è¢« GC åæ¶çå¼±é®ãå®ç°æ­¥éª¤æ¯ï¼\n\n 1. æ°å»º WeakHashMapï¼å°é®å¼å¯¹æ·»å å° WeakHashMap ä¸­ãå®éä¸ï¼WeakHashMap æ¯éè¿æ°ç» table ä¿å­ Entry(é®å¼å¯¹)ï¼æ¯ä¸ä¸ª Entry å®éä¸æ¯ä¸ä¸ªååé¾è¡¨ï¼å³ Entry æ¯é®å¼å¯¹é¾è¡¨ã\n 2. å½æå¼±é®ä¸åè¢«å¶å®å¯¹è±¡å¼ç¨ï¼å¹¶è¢« GC åæ¶æ¶ãå¨ GC åæ¶è¯¥å¼±é®æ¶ï¼è¿ä¸ªå¼±é®ä¹åæ¶ä¼è¢«æ·»å å° ReferenceQueue(queue)éåä¸­ã\n 3. å½ä¸ä¸æ¬¡æä»¬éè¦æä½ WeakHashMap æ¶ï¼ä¼ååæ­¥ table å queueãtable ä¸­ä¿å­äºå¨é¨çé®å¼å¯¹ï¼è queue ä¸­ä¿å­è¢« GC åæ¶çé®å¼å¯¹ï¼åæ­¥å®ä»¬ï¼å°±æ¯å é¤ table ä¸­è¢« GC åæ¶çé®å¼å¯¹ã\n\nè¿å°±æ¯å¼±é®å¦ä½è¢«èªå¨ä» WeakHashMap ä¸­å é¤çæ­¥éª¤äºã\n\nå HashMap ä¸æ ·ï¼WeakHashMap æ¯ä¸åæ­¥çãå¯ä»¥ä½¿ç¨ Collections.synchronizedMap æ¹æ³æ¥æé åæ­¥ç WeakHashMapã\n\n\n# æ»ç»\n\n\n# Map ç®ä»\n\n\n\n\n# HashMap\n\n\n\n\n# å¶ä» Map\n\n\n\n\n# åèèµæ\n\n * Java-HashMap å·¥ä½åçåå®ç°\n * Map ç»¼è¿°ï¼äºï¼ï¼å½»å¤´å½»å°¾çè§£ LinkedHashMap\n * Java éåç³»å 09 ä¹ Map æ¶æ\n * Java éåç³»å 13 ä¹ WeakHashMap è¯¦ç»ä»ç»(æºç è§£æ)åä½¿ç¨ç¤ºä¾',normalizedContent:'# java å®¹å¨ä¹ map\n\n\n# map ç®ä»\n\n\n# map æ¶æ\n\n\n\nmap å®¶æä¸»è¦æååè½å¦ä¸ï¼\n\n * map æ¯ map å®¹å¨å®¶æçç¥åï¼map æ¯ä¸ä¸ªç¨äºä¿å­é®å¼å¯¹(key-value)çæ¥å£ãmap ä¸­ä¸è½åå«éå¤çé®ï¼æ¯ä¸ªé®æå¤åªè½æ å°å°ä¸ä¸ªå¼ã\n * abstractmap ç»§æ¿äº map çæ½è±¡ç±»ï¼å®å®ç°äº map ä¸­çæ ¸å¿ apiãå¶å® map çå®ç°ç±»å¯ä»¥éè¿ç»§æ¿ abstractmap æ¥åå°éå¤ç¼ç ã\n * sortedmap ç»§æ¿äº map çæ¥å£ãsortedmap ä¸­çåå®¹æ¯æåºçé®å¼å¯¹ï¼æåºçæ¹æ³æ¯éè¿å®ç°æ¯è¾å¨(comparator)å®æçã\n * navigablemap ç»§æ¿äº sortedmap çæ¥å£ãç¸æ¯äº sortedmapï¼navigablemap æä¸ç³»åçâå¯¼èªâæ¹æ³ï¼å¦"è·åå¤§äº/ç­äºæå¯¹è±¡çé®å¼å¯¹"ãâè·åå°äº/ç­äºæå¯¹è±¡çé®å¼å¯¹âç­ç­ã\n * hashmap ç»§æ¿äº abstractmapï¼ä½æ²¡å®ç° navigablemap æ¥å£ãhashmap çä¸»è¦ä½ç¨æ¯å¨å­æ åºçé®å¼å¯¹ï¼è hash ä¹ä½ç°äºå®çæ¥æ¾æçå¾é«ãhashmap æ¯ä½¿ç¨æå¹¿æ³ç mapã\n * hashtable è½ç¶æ²¡æç»§æ¿ abstractmapï¼ä½å®ç»§æ¿äº dictionaryï¼dictionary ä¹æ¯é®å¼å¯¹çæ¥å£ï¼ï¼èä¸ä¹å®ç° map æ¥å£ãå æ­¤ï¼hashtable çä¸»è¦ä½ç¨æ¯å¨å­æ åºçé®å¼å¯¹ãå hashmap ç¸æ¯ï¼hashtable å¨å®çä¸»è¦æ¹æ³ä¸­ä½¿ç¨ synchronized å³é®å­ä¿®é¥°ï¼æ¥ä¿è¯çº¿ç¨å®å¨ãä½æ¯ï¼ç±äºå®çéç²åº¦å¤ªå¤§ï¼éå¸¸å½±åè¯»åéåº¦ï¼æä»¥ï¼ç°ä»£ java ç¨åºå ä¹ä¸ä¼ä½¿ç¨ hashtable ï¼å¦æéè¦ä¿è¯çº¿ç¨å®å¨ï¼ä¸è¬ä¼ç¨ concurrenthashmap æ¥æ¿ä»£ã\n * treemap ç»§æ¿äº abstractmapï¼ä¸å®ç°äº navigablemap æ¥å£ãtreemap çä¸»è¦ä½ç¨æ¯å¨å­æåºçé®å¼å¯¹ï¼æåºä¾æ®æ ¹æ®åç´ ç±»åç comparator èå®ã\n * weakhashmap ç»§æ¿äº abstractmapãweakhashmap çé®æ¯å¼±å¼ç¨ ï¼å³ weakreferenceï¼ï¼å®çä¸»è¦ä½ç¨æ¯å½ gc åå­ä¸è¶³æ¶ï¼ä¼èªå¨å° weakhashmap ä¸­ç key åæ¶ï¼è¿é¿åäº weakhashmap çåå­ç©ºé´æ éè¨èãå¾ææ¾ï¼weakhashmap éç¨äºä½ä¸ºç¼å­ã\n\n\n# map æ¥å£\n\nmap çå®ä¹å¦ä¸ï¼\n\npublic interface map<k,v> { }\n\n\nmap æ¯ä¸ä¸ªç¨äºä¿å­é®å¼å¯¹(key-value)çæ¥å£ãmap ä¸­ä¸è½åå«éå¤çé®ï¼æ¯ä¸ªé®æå¤åªè½æ å°å°ä¸ä¸ªå¼ã\n\nmap æ¥å£æä¾ä¸ç§ collection è§å¾ï¼åè®¸ä»¥é®éãå¼éæé®-å¼æ å°å³ç³»éçå½¢å¼è®¿é®æ°æ®ã\n\nmap æäºå®ç°ç±»ï¼å¯ä»¥æåºçä¿å­åç´ ï¼å¦ treemapï¼å¦ä¸äºå®ç°ç±»åä¸ä¿è¯é¡ºåºï¼å¦ hashmap ç±»ã\n\nmap çå®ç°ç±»åºè¯¥æä¾ 2 ä¸ªâæ åçâæé æ¹æ³ï¼\n\n * voidï¼æ åæ°ï¼æé æ¹æ³ï¼ç¨äºåå»ºç©º mapï¼\n * å¸¦æåä¸ª map ç±»ååæ°çæé æ¹æ³ï¼ç¨äºåå»ºä¸ä¸ªä¸å¶åæ°å·æç¸åé®-å¼æ å°å³ç³»çæ° mapã\n\nå®éä¸ï¼åä¸ä¸ªæé æ¹æ³åè®¸ç¨æ·å¤å¶ä»»æ mapï¼çææéç±»çä¸ä¸ªç­ä»· mapãå°½ç®¡æ æ³å¼ºå¶æ§è¡æ­¤å»ºè®®ï¼å ä¸ºæ¥å£ä¸è½åå«æé æ¹æ³ï¼ï¼ä½æ¯ jdk ä¸­ææéç¨ç map å®ç°é½éµä»å®ã\n\n\n# map.entry æ¥å£\n\nmap.entry ä¸è¬ç¨äºéè¿è¿­ä»£å¨ï¼iteratorï¼è®¿é®é® mapã\n\nmap.entry æ¯ map ä¸­åé¨çä¸ä¸ªæ¥å£ï¼map.entry ä»£è¡¨äº é®å¼å¯¹ å®ä½ï¼map éè¿ entryset() è·å map.entry éåï¼ä»èéè¿è¯¥éåå®ç°å¯¹é®å¼å¯¹çæä½ã\n\n\n# abstractmap æ½è±¡ç±»\n\nabstractmap çå®ä¹å¦ä¸ï¼\n\npublic abstract class abstractmap<k,v> implements map<k,v> {}\n\n\nabstractmap æ½è±¡ç±»æä¾äº map æ¥å£çæ ¸å¿å®ç°ï¼ä»¥æå¤§éåº¦å°åå°å®ç° map æ¥å£æéçå·¥ä½ã\n\nè¦å®ç°ä¸å¯ä¿®æ¹ç mapï¼ç¼ç¨äººååªéæ©å±æ­¤ç±»å¹¶æä¾ entryset() æ¹æ³çå®ç°å³å¯ï¼è¯¥æ¹æ³å°è¿å map çæ å°å³ç³» set è§å¾ãéå¸¸ï¼è¿åç set å°ä¾æ¬¡å¨ abstractset ä¸å®ç°ãæ­¤ set ä¸æ¯æ add() æ remove() æ¹æ³ï¼å¶è¿­ä»£å¨ä¹ä¸æ¯æ remove() æ¹æ³ã\n\nè¦å®ç°å¯ä¿®æ¹ç mapï¼ç¼ç¨äººåå¿é¡»å¦å¤éåæ­¤ç±»ç put æ¹æ³ï¼å¦åå°æåº unsupportedoperationexceptionï¼ï¼entryset().iterator() è¿åçè¿­ä»£å¨ä¹å¿é¡»å¦å¤å®ç°å¶ remove() æ¹æ³ã\n\n\n# sortedmap æ¥å£\n\nsortedmap çå®ä¹å¦ä¸ï¼\n\npublic interface sortedmap<k,v> extends map<k,v> { }\n\n\nsortedmap ç»§æ¿äº map ï¼å®æ¯ä¸ä¸ªæåºç mapã\n\nsortedmap çæåºæ¹å¼æä¸¤ç§ï¼èªç¶æåºæèç¨æ·æå®æ¯è¾å¨ãæå¥æåº sortedmap çææåç´ é½å¿é¡»å®ç° comparable æ¥å£ï¼æèè¢«æå®çæ¯è¾å¨ææ¥åï¼ã\n\nå¦å¤ï¼ææ sortedmap å®ç°ç±»é½åºè¯¥æä¾ 4 ä¸ªâæ åâæé æ¹æ³ï¼\n\n 1. voidï¼æ åæ°ï¼æé æ¹æ³ï¼å®åå»ºä¸ä¸ªç©ºçæåº mapï¼æç§é®çèªç¶é¡ºåºè¿è¡æåºã\n 2. å¸¦æä¸ä¸ª comparator ç±»ååæ°çæé æ¹æ³ï¼å®åå»ºä¸ä¸ªç©ºçæåº mapï¼æ ¹æ®æå®çæ¯è¾å¨è¿è¡æåºã\n 3. å¸¦æä¸ä¸ª map ç±»ååæ°çæé æ¹æ³ï¼å®åå»ºä¸ä¸ªæ°çæåº mapï¼å¶é®-å¼æ å°å³ç³»ä¸åæ°ç¸åï¼æç§é®çèªç¶é¡ºåºè¿è¡æåºã\n 4. å¸¦æä¸ä¸ª sortedmap ç±»ååæ°çæé æ¹æ³ï¼å®åå»ºä¸ä¸ªæ°çæåº mapï¼å¶é®-å¼æ å°å³ç³»åæåºæ¹æ³ä¸è¾å¥çæåº map ç¸åãæ æ³ä¿è¯å¼ºå¶å®æ½æ­¤å»ºè®®ï¼å ä¸ºæ¥å£ä¸è½åå«æé æ¹æ³ã\n\n\n# navigablemap æ¥å£\n\nnavigablemap çå®ä¹å¦ä¸ï¼\n\npublic interface navigablemap<k,v> extends sortedmap<k,v> { }\n\n\nnavigablemap ç»§æ¿äº sortedmap ï¼å®æä¾äºä¸°å¯çæ¥æ¾æ¹æ³ã\n\nnavigablemap åå«æä¾äºè·åâé®âãâé®-å¼å¯¹âãâé®éâãâé®-å¼å¯¹éâçç¸å³æ¹æ³ã\n\nnavigablemap æä¾çåè½å¯ä»¥åä¸º 4 ç±»ï¼\n\n * è·åé®-å¼å¯¹\n   * lowerentryãfloorentryãceilingentry å higherentry æ¹æ³ï¼å®ä»¬åå«è¿åä¸å°äºãå°äºç­äºãå¤§äºç­äºãå¤§äºç»å®é®çé®å³èç map.entry å¯¹è±¡ã\n   * firstentryãpollfirstentryãlastentry å polllastentry æ¹æ³ï¼å®ä»¬è¿åå/æç§»é¤æå°åæå¤§çæ å°å³ç³»ï¼å¦æå­å¨ï¼ï¼å¦åè¿å nullã\n * è·åé®ãè¿ä¸ªåç¬¬ 1 ç±»æ¯è¾ç±»ä¼¼ã\n   * lowerkeyãfloorkeyãceilingkey å higherkey æ¹æ³ï¼å®ä»¬åå«è¿åä¸å°äºãå°äºç­äºãå¤§äºç­äºãå¤§äºç»å®é®çé®ã\n * è·åé®çéå\n   * navigablekeysetãdescendingkeyset åå«è·åæ­£åº/ååºçé®éã\n * è·åé®-å¼å¯¹çå­é\n\n\n# dictionary æ½è±¡ç±»\n\ndictionary çå®ä¹å¦ä¸ï¼\n\npublic abstract class dictionary<k,v> {}\n\n\ndictionary æ¯ jdk 1.0 å®ä¹çæä½é®å¼å¯¹çæ½è±¡ç±»ï¼å®åæ¬äºæä½é®å¼å¯¹çåºæ¬æ¹æ³ã\n\n\n# hashmap ç±»\n\nhashmap ç±»æ¯æå¸¸ç¨ç mapã\n\n\n# hashmap è¦ç¹\n\nä» hashmap çå½åï¼ä¹å¯ä»¥çåºï¼hashmap ä»¥æ£åæ¹å¼å­å¨é®å¼å¯¹ã\n\nhashmap åè®¸ä½¿ç¨ç©ºå¼åç©ºé®ãï¼hashmap ç±»å¤§è´ç­åäº hashtableï¼é¤äºå®æ¯ä¸åæ­¥çå¹¶ä¸åè®¸ä¸ºç©ºå¼ãï¼è¿ä¸ªç±»ä¸ä¿åºï¼ç¹å«æ¯ï¼å®çåç´ é¡ºåºå¯è½ä¼éçæ¶é´çæ¨ç§»ååã\n\nhashmap æä¸¤ä¸ªå½±åå¶æ§è½çåæ°ï¼åå§å®¹éåè´è½½å å­ã\n\n * å®¹éæ¯åå¸è¡¨ä¸­æ¡¶çæ°éï¼åå§å®¹éå°±æ¯åå¸è¡¨åå»ºæ¶çå®¹éã\n * å è½½å å­æ¯æ£åè¡¨å¨å¶å®¹éèªå¨æ©å®¹ä¹åè¢«åè®¸çæå¤§é¥±åéãå½åå¸è¡¨ä¸­ç entry æ°éè¶è¿è´è½½å å­åå½åå®¹éçä¹ç§¯æ¶ï¼æ£åè¡¨å°±ä¼è¢«éæ°æ å°ï¼å³éå»ºåé¨æ°æ®ç»æï¼ï¼ä¸è¬æ£åè¡¨å¤§çº¦æ¯å­å¨æ¡¶æ°éçä¸¤åã\n\néå¸¸ï¼é»è®¤å è½½å å­ï¼0.75ï¼å¨æ¶é´åç©ºé´ææ¬ä¹é´æä¾äºè¯å¥½çå¹³è¡¡ãè¾é«çå¼ä¼åå°ç©ºé´å¼éï¼ä½ä¼å¢å æ¥æ¾ææ¬ï¼åæ å¨å¤§é¨å hashmap ç±»çæä½ä¸­ï¼åæ¬ get å putï¼ãå¨è®¾ç½®åå§å®¹éæ¶ï¼åºèèæ å°ä¸­çæ¡ç®æ°éåå¶è´è½½å å­ï¼ä»¥å°½éåå°éæ°è¿è¡æä½çæ¬¡æ°ãå¦æåå§å®¹éå¤§äºæå¤§å¥å£æ°é¤ä»¥è´è½½å å­ï¼åä¸ä¼åçéæ°å·æ°æä½ã\n\nå¦æè®¸å¤æ å°è¦å­å¨å¨ hashmap å®ä¾ä¸­ï¼ä½¿ç¨è¶³å¤å¤§çå®¹éåå»ºæ å°å°åè®¸æ å°å­å¨çæçé«äºæ ¹æ®éè¦æ§è¡èªå¨éæ°æ£åä»¥å¢é¿è¡¨ãè¯·æ³¨æï¼ä½¿ç¨å¤ä¸ªå·æç¸å hashcode() çå¯é¥æ¯éä½ä»»ä½æ£åè¡¨æ§è½çä¸ä¸ªå¯é æ¹æ³ãä¸ºäºæ¹åå½±åï¼å½é®æ¯ comparable æ¶ï¼è¯¥ç±»å¯ä»¥ä½¿ç¨é®ä¹é´çæ¯è¾é¡ºåºæ¥å¸®å©æ­å¼å³ç³»ã\n\nhashmap ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# hashmap åç\n\n# hashmap æ°æ®ç»æ\n\nhashmap çæ ¸å¿å­æ®µï¼\n\n * table - hashmap ä½¿ç¨ä¸ä¸ª node<k,v>[] ç±»åçæ°ç» table æ¥å¨å­åç´ ã\n * size - åå§å®¹éã åå§ä¸º 16ï¼æ¯æ¬¡å®¹éä¸å¤èªå¨æ©å®¹\n * loadfactor - è´è½½å å­ãèªå¨æ©å®¹ä¹åè¢«åè®¸çæå¤§é¥±åéï¼é»è®¤ 0.75ã\n\npublic class hashmap<k,v> extends abstractmap<k,v>\n    implements map<k,v>, cloneable, serializable {\n\n    // è¯¥è¡¨å¨åæ¬¡ä½¿ç¨æ¶åå§åï¼å¹¶æ ¹æ®éè¦è°æ´å¤§å°ãåéæ¶ï¼é¿åº¦æ»æ¯2çå¹ã\n    transient node<k,v>[] table;\n    // ä¿å­ç¼å­ç entryset()ãè¯·æ³¨æï¼abstractmap å­æ®µç¨äº keyset() å values()ã\n    transient set<map.entry<k,v>> entryset;\n    // map ä¸­çé®å¼å¯¹æ°\n    transient int size;\n    // è¿ä¸ªhashmapè¢«ç»æä¿®æ¹çæ¬¡æ°ç»æä¿®æ¹æ¯é£äºæ¹åhashmapä¸­çæ å°æ°éæèä¿®æ¹å¶åé¨ç»æï¼ä¾å¦ï¼éæ°æ£åï¼çä¿®æ¹ã\n    transient int modcount;\n    // ä¸ä¸ä¸ªè°æ´å¤§å°çå¼ï¼å®¹é*å è½½å å­ï¼ã\n    int threshold;\n    // æ£åè¡¨çå è½½å å­\n    final float loadfactor;\n}\n\n\n# hashmap æé æ¹æ³\n\npublic hashmap(); // é»è®¤å è½½å å­0.75\npublic hashmap(int initialcapacity); // é»è®¤å è½½å å­0.75ï¼ä»¥ initialcapacity åå§åå®¹é\npublic hashmap(int initialcapacity, float loadfactor); // ä»¥ initialcapacity åå§åå®¹éï¼ä»¥ loadfactor åå§åå è½½å å­\npublic hashmap(map<? extends k, ? extends v> m) // é»è®¤å è½½å å­0.75\n\n\n# put æ¹æ³çå®ç°\n\nput æ¹æ³å¤§è´çæè·¯ä¸ºï¼\n\n * å¯¹ key ç hashcode() å hash è®¡ç®ï¼ç¶åæ ¹æ® hash å¼åè®¡ç® node çå­å¨ä½ç½®;\n * å¦ææ²¡æåå¸ç¢°æï¼ç´æ¥æ¾å°æ¡¶éï¼å¦ææåå¸ç¢°æï¼ä»¥é¾è¡¨çå½¢å¼å­å¨æ¡¶åã\n * å¦æåå¸ç¢°æå¯¼è´é¾è¡¨è¿é¿(å¤§äºç­äº treeify_thresholdï¼æ°å¼ä¸º 8)ï¼å°±æé¾è¡¨è½¬æ¢æçº¢é»æ ï¼\n * å¦æèç¹å·²ç»å­å¨å°±æ¿æ¢æ§å¼\n * æ¡¶æ°éè¶è¿å®¹é*è´è½½å å­ï¼å³ load factor * current capacityï¼ï¼hashmap è°ç¨ resize èªå¨æ©å®¹ä¸å\n\nå·ä½ä»£ç çå®ç°å¦ä¸ï¼\n\npublic v put(k key, v value) {\n    return putval(hash(key), key, value, false, true);\n}\n\n// hashcode æ ç¬¦å·ä½ç§» 16 ä½\nstatic final int hash(object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashcode()) ^ (h >>> 16);\n}\n\nfinal v putval(int hash, k key, v value, boolean onlyifabsent,\n                   boolean evict) {\n    node<k,v>[] tab; node<k,v> p; int n, i;\n    // tab ä¸ºç©ºååå»º\n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    // è®¡ç® indexï¼å¹¶å¯¹ null åå¤ç\n    if ((p = tab[i = (n - 1) & hash]) == null)\n        tab[i] = newnode(hash, key, value, null);\n    else {\n        node<k,v> e; k k;\n        // èç¹å­å¨\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            e = p;\n        // è¯¥é¾ä¸ºæ \n        else if (p instanceof treenode)\n            e = ((treenode<k,v>)p).puttreeval(this, tab, hash, key, value);\n        // è¯¥é¾ä¸ºé¾è¡¨\n        else {\n            for (int bincount = 0; ; ++bincount) {\n                if ((e = p.next) == null) {\n                    p.next = newnode(hash, key, value, null);\n                    if (bincount >= treeify_threshold - 1) // -1 for 1st\n                        treeifybin(tab, hash);\n                    break;\n                }\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    break;\n                p = e;\n            }\n        }\n        // åå¥\n        if (e != null) { // existing mapping for key\n            v oldvalue = e.value;\n            if (!onlyifabsent || oldvalue == null)\n                e.value = value;\n            afternodeaccess(e);\n            return oldvalue;\n        }\n    }\n    ++modcount;\n    if (++size > threshold)\n        resize();\n    afternodeinsertion(evict);\n    return null;\n}\n\n\nä¸ºä»ä¹è®¡ç® hash ä½¿ç¨ hashcode æ ç¬¦å·ä½ç§» 16 ä½ã\n\nåè®¾è¦æ·»å ä¸¤ä¸ªå¯¹è±¡ a å bï¼å¦ææ°ç»é¿åº¦æ¯ 16ï¼è¿æ¶å¯¹è±¡ a å b éè¿å¬å¼ (n - 1) & hash è¿ç®ï¼ä¹å°±æ¯ (16-1)ï¼a.hashcode å (16-1)ï¼b.hashcodeï¼15 çäºè¿å¶ä¸º 0000000000000000000000000001111ï¼åè®¾å¯¹è±¡ a ç hashcode ä¸º 1000010001110001000001111000000ï¼å¯¹è±¡ b ç hashcode ä¸º 0111011100111000101000010100000ï¼ä½ ä¼åç°ä¸è¿°ä¸è¿ç®ç»æé½æ¯ 0ãè¿æ ·çåå¸ç»æå°±å¤ªè®©äººå¤±æäºï¼å¾ææ¾ä¸æ¯ä¸ä¸ªå¥½çåå¸ç®æ³ã\n\nä½å¦ææä»¬å° hashcode å¼å³ç§» 16 ä½ï¼h >>> 16 ä»£è¡¨æ ç¬¦å·å³ç§» 16 ä½ï¼ï¼ä¹å°±æ¯å int ç±»åçä¸åï¼åå¥½å¯ä»¥å°è¯¥äºè¿å¶æ°å¯¹ååå¼ï¼å¹¶ä¸ä½¿ç¨ä½å¼æè¿ç®ï¼å¦æä¸¤ä¸ªæ°å¯¹åºçä½ç½®ç¸åï¼åç»æä¸º 1ï¼åä¹ä¸º 0ï¼ï¼è¿æ ·çè¯ï¼å°±è½é¿åä¸é¢çæåµåçãè¿å°±æ¯ hash() æ¹æ³çå·ä½å®ç°æ¹å¼ãç®èè¨ä¹ï¼å°±æ¯å°½éæä¹± hashcode çæ­£åä¸è¿ç®çä½ 16 ä½ã\n\n# get æ¹æ³çå®ç°\n\nå¨çè§£äº put ä¹åï¼get å°±å¾ç®åäºãå¤§è´æè·¯å¦ä¸ï¼\n\n * å¯¹ key ç hashcode() å hash è®¡ç®ï¼ç¶åæ ¹æ® hash å¼åè®¡ç®æ¡¶ç index\n\n * å¦ææ¡¶ä¸­çç¬¬ä¸ä¸ªèç¹å½ä¸­ï¼ç´æ¥è¿åï¼\n\n * å¦ææå²çªï¼åéè¿ key.equals(k) å»æ¥æ¾å¯¹åºç entry\n   \n   * è¥ä¸ºæ ï¼åå¨çº¢é»æ ä¸­éè¿ key.equals(k) æ¥æ¾ï¼o(logn)ï¼\n   \n   * è¥ä¸ºé¾è¡¨ï¼åå¨é¾è¡¨ä¸­éè¿ key.equals(k) æ¥æ¾ï¼o(n)ã\n\nå·ä½ä»£ç çå®ç°å¦ä¸ï¼\n\npublic v get(object key) {\n    node<k,v> e;\n    return (e = getnode(hash(key), key)) == null ? null : e.value;\n}\n\nfinal node<k,v> getnode(int hash, object key) {\n        node<k,v>[] tab; node<k,v> first, e; int n; k k;\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (first = tab[(n - 1) & hash]) != null) {\n        // ç´æ¥å½ä¸­\n        if (first.hash == hash && // always check first node\n            ((k = first.key) == key || (key != null && key.equals(k))))\n            return first;\n        // æªå½ä¸­\n        if ((e = first.next) != null) {\n            // å¨æ ä¸­ get\n            if (first instanceof treenode)\n                return ((treenode<k,v>)first).gettreenode(hash, key);\n            // å¨é¾è¡¨ä¸­ get\n            do {\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    return e;\n            } while ((e = e.next) != null);\n        }\n    }\n    return null;\n}\n\n\n# hash æ¹æ³çå®ç°\n\nhashmap è®¡ç®æ¡¶ä¸æ ï¼indexï¼å¬å¼ï¼key.hashcode() ^ (h >>> 16)ã\n\nä¸é¢éå¯¹è¿ä¸ªå¬å¼æ¥è¯¦ç»è®²è§£ã\n\nå¨ get å put çè¿ç¨ä¸­ï¼è®¡ç®ä¸æ æ¶ï¼åå¯¹ hashcode è¿è¡ hash æä½ï¼ç¶ååéè¿ hash å¼è¿ä¸æ­¥è®¡ç®ä¸æ ï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå¨å¯¹ hashcode() è®¡ç® hash æ¶å·ä½å®ç°æ¯è¿æ ·çï¼\n\nstatic final int hash(object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashcode()) ^ (h >>> 16);\n}\n\n\nå¯ä»¥çå°è¿ä¸ªæ¹æ³å¤§æ¦çä½ç¨å°±æ¯ï¼é« 16bit ä¸åï¼ä½ 16bit åé« 16bit åäºä¸ä¸ªå¼æã\n\nå¨è®¾è®¡ hash æ¹æ³æ¶ï¼å ä¸ºç®åç table é¿åº¦ n ä¸º 2 çå¹ï¼èè®¡ç®ä¸æ çæ¶åï¼æ¯è¿æ ·å®ç°ç(ä½¿ç¨ & ä½æä½ï¼èé % æ±ä½)ï¼\n\n(n - 1) & hash\n\n\nè®¾è®¡èè®¤ä¸ºè¿æ¹æ³å¾å®¹æåçç¢°æãä¸ºä»ä¹è¿ä¹è¯´å¢ï¼ä¸å¦¨æèä¸ä¸ï¼å¨ n - 1 ä¸º 15(0x1111) æ¶ï¼å¶å®æ£åçæ­£çæçåªæ¯ä½ 4bit çææä½ï¼å½ç¶å®¹æç¢°æäºã\n\nå æ­¤ï¼è®¾è®¡èæ³äºä¸ä¸ªé¡¾å¨å¤§å±çæ¹æ³(ç»¼åèèäºéåº¦ãä½ç¨ãè´¨é)ï¼å°±æ¯æé« 16bit åä½ 16bit å¼æäºä¸ä¸ãè®¾è®¡èè¿è§£éå°å ä¸ºç°å¨å¤§å¤æ°ç hashcode çåå¸å·²ç»å¾ä¸éäºï¼å°±ç®æ¯åçäºç¢°æä¹ç¨ o(logn)ç tree å»åäºãä»ä»å¼æä¸ä¸ï¼æ¢åå°äºç³»ç»çå¼éï¼ä¹ä¸ä¼é æçå ä¸ºé«ä½æ²¡æåä¸ä¸æ çè®¡ç®(table é¿åº¦æ¯è¾å°æ¶)ï¼ä»èå¼èµ·çç¢°æã\n\nå¦æè¿æ¯äº§çäºé¢ç¹çç¢°æï¼ä¼åçä»ä¹é®é¢å¢ï¼ä½èæ³¨éè¯´ï¼ä»ä»¬ä½¿ç¨æ æ¥å¤çé¢ç¹çç¢°æ(we use trees to handle large sets of collisions in bins)ï¼å¨ jep-180 ä¸­ï¼æè¿°äºè¿ä¸ªé®é¢ï¼\n\n> improve the performance of java.util.hashmap under high hash-collision conditions by using balanced trees rather than linked lists to store map entries. implement the same improvement in the linkedhashmap class.\n\nä¹åå·²ç»æè¿ï¼å¨è·å hashmap çåç´ æ¶ï¼åºæ¬åä¸¤æ­¥ï¼\n\n 1. é¦åæ ¹æ® hashcode()å hashï¼ç¶åç¡®å® bucket ç indexï¼\n\n 2. å¦æ bucket çèç¹ç key ä¸æ¯æä»¬éè¦çï¼åéè¿ keys.equals()å¨é¾ä¸­æ¾ã\n\nå¨ jdk8 ä¹åçå®ç°ä¸­æ¯ç¨é¾è¡¨è§£å³å²çªçï¼å¨äº§çç¢°æçæåµä¸ï¼è¿è¡ get æ¶ï¼ä¸¤æ­¥çæ¶é´å¤æåº¦æ¯ o(1)+o(n)ãå æ­¤ï¼å½ç¢°æå¾åå®³çæ¶å n å¾å¤§ï¼o(n)çéåº¦æ¾ç¶æ¯å½±åéåº¦çã\n\nå æ­¤å¨ jdk8 ä¸­ï¼å©ç¨çº¢é»æ æ¿æ¢é¾è¡¨ï¼è¿æ ·å¤æåº¦å°±åæäº o(1)+o(logn)äºï¼è¿æ ·å¨ n å¾å¤§çæ¶åï¼è½å¤æ¯è¾çæ³çè§£å³è¿ä¸ªé®é¢ï¼å¨ jdk8ï¼hashmap çæ§è½æåä¸æä¸­ææ§è½æµè¯çç»æã\n\n# resize çå®ç°\n\nå½ put æ¶ï¼å¦æåç°ç®åç bucket å ç¨ç¨åº¦å·²ç»è¶è¿äº load factor æå¸æçæ¯ä¾ï¼é£ä¹å°±ä¼åç resizeãå¨ resize çè¿ç¨ï¼ç®åçè¯´å°±æ¯æ bucket æ©åä¸º 2 åï¼ä¹åéæ°è®¡ç® indexï¼æèç¹åæ¾å°æ°ç bucket ä¸­ã\n\nå½è¶è¿éå¶çæ¶åä¼ resizeï¼ç¶èåå ä¸ºæä»¬ä½¿ç¨çæ¯ 2 æ¬¡å¹çæ©å±(æé¿åº¦æ©ä¸ºåæ¥ 2 å)ï¼æä»¥ï¼åç´ çä½ç½®è¦ä¹æ¯å¨åä½ç½®ï¼è¦ä¹æ¯å¨åä½ç½®åç§»å¨ 2 æ¬¡å¹çä½ç½®ã\n\næä¹çè§£å¢ï¼ä¾å¦æä»¬ä» 16 æ©å±ä¸º 32 æ¶ï¼å·ä½çååå¦ä¸æç¤ºï¼\n\n\n\nå æ­¤åç´ å¨éæ°è®¡ç® hash ä¹åï¼å ä¸º n åä¸º 2 åï¼é£ä¹ n-1 ç mask èå´å¨é«ä½å¤ 1bit(çº¢è²)ï¼å æ­¤æ°ç index å°±ä¼åçè¿æ ·çååï¼\n\n\n\nå æ­¤ï¼æä»¬å¨æ©å hashmap çæ¶åï¼ä¸éè¦éæ°è®¡ç® hashï¼åªéè¦ççåæ¥ç hash å¼æ°å¢çé£ä¸ª bit æ¯ 1 è¿æ¯ 0 å°±å¥½äºï¼æ¯ 0 çè¯ç´¢å¼æ²¡åï¼æ¯ 1 çè¯ç´¢å¼åæâåç´¢å¼+oldcapâãå¯ä»¥ççä¸å¾ä¸º 16 æ©åä¸º 32 ç resize ç¤ºæå¾ï¼\n\n\n\nè¿ä¸ªè®¾è®¡ç¡®å®éå¸¸çå·§å¦ï¼æ¢çå»äºéæ°è®¡ç® hash å¼çæ¶é´ï¼èä¸åæ¶ï¼ç±äºæ°å¢ç 1bit æ¯ 0 è¿æ¯ 1 å¯ä»¥è®¤ä¸ºæ¯éæºçï¼å æ­¤ resize çè¿ç¨ï¼ååçæä¹åçå²çªçèç¹åæ£å°æ°ç bucket äºã\n\nfinal node<k,v>[] resize() {\n    node<k,v>[] oldtab = table;\n    int oldcap = (oldtab == null) ? 0 : oldtab.length;\n    int oldthr = threshold;\n    int newcap, newthr = 0;\n    if (oldcap > 0) {\n        // è¶è¿æå¤§å¼å°±ä¸åæ©åäºï¼å°±åªå¥½éä½ ç¢°æå»å§\n        if (oldcap >= maximum_capacity) {\n            threshold = integer.max_value;\n            return oldtab;\n        }\n        // æ²¡è¶è¿æå¤§å¼ï¼å°±æ©åä¸ºåæ¥ç 2 å\n        else if ((newcap = oldcap << 1) < maximum_capacity &&\n                    oldcap >= default_initial_capacity)\n            newthr = oldthr << 1; // double threshold\n    }\n    else if (oldthr > 0) // initial capacity was placed in threshold\n        newcap = oldthr;\n    else {               // zero initial threshold signifies using defaults\n        newcap = default_initial_capacity;\n        newthr = (int)(default_load_factor * default_initial_capacity);\n    }\n\n    // è®¡ç®æ°ç resize ä¸é\n    if (newthr == 0) {\n        float ft = (float)newcap * loadfactor;\n        newthr = (newcap < maximum_capacity && ft < (float)maximum_capacity ?\n                    (int)ft : integer.max_value);\n    }\n    threshold = newthr;\n    @suppresswarnings({"rawtypes","unchecked"})\n        node<k,v>[] newtab = (node<k,v>[])new node[newcap];\n    table = newtab;\n    if (oldtab != null) {\n        // ææ¯ä¸ª bucket é½ç§»å¨å°æ°ç buckets ä¸­\n        for (int j = 0; j < oldcap; ++j) {\n            node<k,v> e;\n            if ((e = oldtab[j]) != null) {\n                oldtab[j] = null;\n                if (e.next == null)\n                    newtab[e.hash & (newcap - 1)] = e;\n                else if (e instanceof treenode)\n                    ((treenode<k,v>)e).split(this, newtab, j, oldcap);\n                else { // preserve order\n                    node<k,v> lohead = null, lotail = null;\n                    node<k,v> hihead = null, hitail = null;\n                    node<k,v> next;\n                    do {\n                        next = e.next;\n                        // åç´¢å¼\n                        if ((e.hash & oldcap) == 0) {\n                            if (lotail == null)\n                                lohead = e;\n                            else\n                                lotail.next = e;\n                            lotail = e;\n                        }\n                        // åç´¢å¼+oldcap\n                        else {\n                            if (hitail == null)\n                                hihead = e;\n                            else\n                                hitail.next = e;\n                            hitail = e;\n                        }\n                    } while ((e = next) != null);\n                    // åç´¢å¼æ¾å°bucketé\n                    if (lotail != null) {\n                        lotail.next = null;\n                        newtab[j] = lohead;\n                    }\n                    // åç´¢å¼+oldcapæ¾å°bucketé\n                    if (hitail != null) {\n                        hitail.next = null;\n                        newtab[j + oldcap] = hihead;\n                    }\n                }\n            }\n        }\n    }\n    return newtab;\n}\n\n\n\n# linkedhashmap ç±»\n\n\n# linkedhashmap è¦ç¹\n\nlinkedhashmap éè¿ç»´æ¤ä¸ä¸ªä¿å­æææ¡ç®ï¼entryï¼çååé¾è¡¨ï¼ä¿è¯äºåç´ è¿­ä»£çé¡ºåºï¼å³æå¥é¡ºåºï¼ã\n\nå³æ³¨ç¹             ç»è®º\næ¯å¦åè®¸é®å¼å¯¹ä¸º null   key å value é½åè®¸ null\næ¯å¦åè®¸éå¤æ°æ®        key éå¤ä¼è¦çãvalue åè®¸éå¤\næ¯å¦æåº            æç§åç´ æå¥é¡ºåºå­å¨\næ¯å¦çº¿ç¨å®å¨          éçº¿ç¨å®å¨\n\n\n# linkedhashmap è¦ç¹\n\n# linkedhashmap æ°æ®ç»æ\n\nlinkedhashmap éè¿ç»´æ¤ä¸å¯¹ linkedhashmap.entry<k,v> ç±»åçå¤´å°¾æéï¼ä»¥åé¾è¡¨å½¢å¼ï¼ä¿å­æææ°æ®ã\n\nå­¦ä¹ è¿æ°æ®ç»æçåé¾è¡¨ï¼å°±è½çè§£å¶åç´ å­å¨ä»¥åè®¿é®å¿ç¶æ¯æåºçã\n\npublic class linkedhashmap<k,v>\n    extends hashmap<k,v>\n    implements map<k,v> {\n\n    // åé¾è¡¨çå¤´æé\n    transient linkedhashmap.entry<k,v> head;\n    // åé¾è¡¨çå°¾æé\n    transient linkedhashmap.entry<k,v> tail;\n    // è¿­ä»£æåºæ¹æ³ï¼true è¡¨ç¤ºè®¿é®é¡ºåºï¼false è¡¨ç¤ºæå¥é¡ºåº\n    final boolean accessorder;\n}\n\n\nlinkedhashmap ç»§æ¿äº hashmap ç put æ¹æ³ï¼æ¬èº«æ²¡æå®ç° put æ¹æ³ã\n\n\n# treemap ç±»\n\n\n# treemap è¦ç¹\n\ntreemap åºäºçº¢é»æ å®ç°ã\n\ntreemap æ¯æåºçãå®çæåºè§åæ¯ï¼æ ¹æ® map ä¸­ç key çèªç¶è¯­ä¹é¡ºåºææä¾çæ¯è¾å¨ï¼comparatorï¼çèªå®ä¹æ¯è¾é¡ºåºã\n\ntreemap ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# treemap åç\n\n# put æ¹æ³\n\npublic v put(k key, v value) {\n    entry<k,v> t = root;\n    // å¦ææ ¹èç¹ä¸º nullï¼æå¥ç¬¬ä¸ä¸ªèç¹\n    if (t == null) {\n        compare(key, key); // type (and possibly null) check\n\n        root = new entry<>(key, value, null);\n        size = 1;\n        modcount++;\n        return null;\n    }\n    int cmp;\n    entry<k,v> parent;\n    // split comparator and comparable paths\n    comparator<? super k> cpr = comparator;\n    // æ¯ä¸ªèç¹çå·¦å­©å­èç¹çå¼å°äºå®ï¼å³å­©å­èç¹çå¼å¤§äºå®\n    // å¦æææ¯è¾å¨ï¼ä½¿ç¨æ¯è¾å¨è¿è¡æ¯è¾\n    if (cpr != null) {\n        do {\n            parent = t;\n            cmp = cpr.compare(key, t.key);\n            if (cmp < 0)\n                t = t.left;\n            else if (cmp > 0)\n                t = t.right;\n            else\n                return t.setvalue(value);\n        } while (t != null);\n    }\n    // æ²¡ææ¯è¾å¨ï¼ä½¿ç¨ key çèªç¶é¡ºåºè¿è¡æ¯è¾\n    else {\n        if (key == null)\n            throw new nullpointerexception();\n        @suppresswarnings("unchecked")\n            comparable<? super k> k = (comparable<? super k>) key;\n        do {\n            parent = t;\n            cmp = k.compareto(t.key);\n            if (cmp < 0)\n                t = t.left;\n            else if (cmp > 0)\n                t = t.right;\n            else\n                return t.setvalue(value);\n        } while (t != null);\n    }\n    // éè¿ä¸é¢çéåæªæ¾å° key å¼ï¼åæ°æå¥èç¹\n    entry<k,v> e = new entry<>(key, value, parent);\n    if (cmp < 0)\n        parent.left = e;\n    else\n        parent.right = e;\n    // æå¥åï¼ä¸ºäºç»´æçº¢é»æ çå¹³è¡¡éè¦è°æ´\n    fixafterinsertion(e);\n    size++;\n    modcount++;\n    return null;\n}\n\n\n# get æ¹æ³\n\npublic v get(object key) {\n    entry<k,v> p = getentry(key);\n    return (p==null ? null : p.value);\n}\n\nfinal entry<k,v> getentry(object key) {\n    // offload comparator-based version for sake of performance\n    if (comparator != null)\n        return getentryusingcomparator(key);\n    if (key == null)\n        throw new nullpointerexception();\n    @suppresswarnings("unchecked")\n        comparable<? super k> k = (comparable<? super k>) key;\n    entry<k,v> p = root;\n    // æç§äºåæ æç´¢çæ¹å¼è¿è¡æç´¢ï¼æå°è¿å\n    while (p != null) {\n        int cmp = k.compareto(p.key);\n        if (cmp < 0)\n            p = p.left;\n        else if (cmp > 0)\n            p = p.right;\n        else\n            return p;\n    }\n    return null;\n}\n\n\n\n# remove æ¹æ³\n\npublic v remove(object key) {\n    entry<k,v> p = getentry(key);\n    if (p == null)\n        return null;\n\n    v oldvalue = p.value;\n    deleteentry(p);\n    return oldvalue;\n}\nprivate void deleteentry(entry<k,v> p) {\n    modcount++;\n    size--;\n\n    // å¦æå½åèç¹æå·¦å³å­©å­èç¹ï¼ä½¿ç¨åç»§èç¹æ¿æ¢è¦å é¤çèç¹\n    // if strictly internal, copy successor\'s element to p and then make p\n    // point to successor.\n    if (p.left != null && p.right != null) {\n        entry<k,v> s = successor(p);\n        p.key = s.key;\n        p.value = s.value;\n        p = s;\n    } // p has 2 children\n\n    // start fixup at replacement node, if it exists.\n    entry<k,v> replacement = (p.left != null ? p.left : p.right);\n\n    if (replacement != null) { // è¦å é¤çèç¹æä¸ä¸ªå­©å­èç¹\n        // link replacement to parent\n        replacement.parent = p.parent;\n        if (p.parent == null)\n            root = replacement;\n        else if (p == p.parent.left)\n            p.parent.left  = replacement;\n        else\n d:\\codes\\zp\\java\\database\\docs\\redis\\åå¸å¼é.md           p.parent.right = replacement;\n\n        // null out links so they are ok to use by fixafterdeletion.\n        p.left = p.right = p.parent = null;\n\n        // fix replacement\n        if (p.color == black)\n            fixafterdeletion(replacement);\n    } else if (p.parent == null) { // return if we are the only node.\n        root = null;\n    } else { //  no children. use self as phantom replacement and unlink.\n        if (p.color == black)\n            fixafterdeletion(p);\n\n        if (p.parent != null) {\n            if (p == p.parent.left)\n                p.parent.left = null;\n            else if (p == p.parent.right)\n                p.parent.right = null;\n            p.parent = null;\n        }\n    }\n}\n\n\n\n# treemap ç¤ºä¾\n\npublic class treemapdemo {\n\n    private static final string[] chars = "a b c d e f g h i j k l m n o p q r s t u v w x y z".split(" ");\n\n    public static void main(string[] args) {\n        treemap<integer, string> treemap = new treemap<>();\n        for (int i = 0; i < chars.length; i++) {\n            treemap.put(i, chars[i]);\n        }\n        system.out.println(treemap);\n        integer low = treemap.firstkey();\n        integer high = treemap.lastkey();\n        system.out.println(low);\n        system.out.println(high);\n        iterator<integer> it = treemap.keyset().iterator();\n        for (int i = 0; i <= 6; i++) {\n            if (i == 3) { low = it.next(); }\n            if (i == 6) { high = it.next(); } else { it.next(); }\n        }\n        system.out.println(low);\n        system.out.println(high);\n        system.out.println(treemap.submap(low, high));\n        system.out.println(treemap.headmap(high));\n        system.out.println(treemap.tailmap(low));\n    }\n}\n\n\n\n# weakhashmap\n\nweakhashmap çå®ä¹å¦ä¸ï¼\n\npublic class weakhashmap<k,v>\n    extends abstractmap<k,v>\n    implements map<k,v> {}\n\n\nweakhashmap ç»§æ¿äº abstractmapï¼å®ç°äº map æ¥å£ã\n\nå hashmap ä¸æ ·ï¼weakhashmap ä¹æ¯ä¸ä¸ªæ£åè¡¨ï¼å®å­å¨çåå®¹ä¹æ¯é®å¼å¯¹(key-value)æ å°ï¼èä¸é®åå¼é½å¯ä»¥æ¯ nullã\n\nä¸è¿ weakhashmap çé®æ¯å¼±é®ãå¨ weakhashmap ä¸­ï¼å½æä¸ªé®ä¸åè¢«å¶å®å¯¹è±¡å¼ç¨ï¼ä¼è¢«ä» weakhashmap ä¸­è¢«èªå¨ç§»é¤ãæ´ç²¾ç¡®å°è¯´ï¼å¯¹äºä¸ä¸ªç»å®çé®ï¼å¶æ å°çå­å¨å¹¶ä¸é»æ­¢åå¾åæ¶å¨å¯¹è¯¥é®çä¸¢å¼ï¼è¿å°±ä½¿è¯¥é®æä¸ºå¯ç»æ­¢çï¼è¢«ç»æ­¢ï¼ç¶åè¢«åæ¶ãæä¸ªé®è¢«ç»æ­¢æ¶ï¼å®å¯¹åºçé®å¼å¯¹ä¹å°±ä»æ å°ä¸­ææå°ç§»é¤äºã\n\nè¿ä¸ªå¼±é®çåçå¢ï¼å¤§è´ä¸å°±æ¯ï¼éè¿ weakreference å referencequeue å®ç°çã\n\nweakhashmap ç key æ¯å¼±é®ï¼å³æ¯ weakreference ç±»åçï¼referencequeue æ¯ä¸ä¸ªéåï¼å®ä¼ä¿å­è¢« gc åæ¶çå¼±é®ãå®ç°æ­¥éª¤æ¯ï¼\n\n 1. æ°å»º weakhashmapï¼å°é®å¼å¯¹æ·»å å° weakhashmap ä¸­ãå®éä¸ï¼weakhashmap æ¯éè¿æ°ç» table ä¿å­ entry(é®å¼å¯¹)ï¼æ¯ä¸ä¸ª entry å®éä¸æ¯ä¸ä¸ªååé¾è¡¨ï¼å³ entry æ¯é®å¼å¯¹é¾è¡¨ã\n 2. å½æå¼±é®ä¸åè¢«å¶å®å¯¹è±¡å¼ç¨ï¼å¹¶è¢« gc åæ¶æ¶ãå¨ gc åæ¶è¯¥å¼±é®æ¶ï¼è¿ä¸ªå¼±é®ä¹åæ¶ä¼è¢«æ·»å å° referencequeue(queue)éåä¸­ã\n 3. å½ä¸ä¸æ¬¡æä»¬éè¦æä½ weakhashmap æ¶ï¼ä¼ååæ­¥ table å queueãtable ä¸­ä¿å­äºå¨é¨çé®å¼å¯¹ï¼è queue ä¸­ä¿å­è¢« gc åæ¶çé®å¼å¯¹ï¼åæ­¥å®ä»¬ï¼å°±æ¯å é¤ table ä¸­è¢« gc åæ¶çé®å¼å¯¹ã\n\nè¿å°±æ¯å¼±é®å¦ä½è¢«èªå¨ä» weakhashmap ä¸­å é¤çæ­¥éª¤äºã\n\nå hashmap ä¸æ ·ï¼weakhashmap æ¯ä¸åæ­¥çãå¯ä»¥ä½¿ç¨ collections.synchronizedmap æ¹æ³æ¥æé åæ­¥ç weakhashmapã\n\n\n# æ»ç»\n\n\n# map ç®ä»\n\n\n\n\n# hashmap\n\n\n\n\n# å¶ä» map\n\n\n\n\n# åèèµæ\n\n * java-hashmap å·¥ä½åçåå®ç°\n * map ç»¼è¿°ï¼äºï¼ï¼å½»å¤´å½»å°¾çè§£ linkedhashmap\n * java éåç³»å 09 ä¹ map æ¶æ\n * java éåç³»å 13 ä¹ weakhashmap è¯¦ç»ä»ç»(æºç è§£æ)åä½¿ç¨ç¤ºä¾',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å®¹å¨ä¹ Queue",frontmatter:{title:"Java å®¹å¨ä¹ Queue",date:"2020-02-21T16:26:21.000Z",categories:["Java","JavaSE","å®¹å¨"],tags:["Java","JavaSE","å®¹å¨"],permalink:"/pages/ffa963/"},regularPath:"/01.Java/01.JavaSE/03.%E5%AE%B9%E5%99%A8/05.Java%E5%AE%B9%E5%99%A8%E4%B9%8BQueue.html",relativePath:"01.Java/01.JavaSE/03.å®¹å¨/05.Javaå®¹å¨ä¹Queue.md",key:"v-826b0392",path:"/pages/ffa963/",headers:[{level:2,title:"Queue ç®ä»",slug:"queue-ç®ä»",normalizedTitle:"queue ç®ä»",charIndex:21},{level:3,title:"Queue æ¥å£",slug:"queue-æ¥å£",normalizedTitle:"queue æ¥å£",charIndex:36},{level:3,title:"AbstractQueue æ½è±¡ç±»",slug:"abstractqueue-æ½è±¡ç±»",normalizedTitle:"abstractqueue æ½è±¡ç±»",charIndex:117},{level:3,title:"Deque æ¥å£",slug:"deque-æ¥å£",normalizedTitle:"deque æ¥å£",charIndex:324},{level:2,title:"ArrayDeque",slug:"arraydeque",normalizedTitle:"arraydeque",charIndex:558},{level:2,title:"LinkedList",slug:"linkedlist",normalizedTitle:"linkedlist",charIndex:636},{level:2,title:"PriorityQueue",slug:"priorityqueue",normalizedTitle:"priorityqueue",charIndex:1570},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1901}],headersStr:"Queue ç®ä» Queue æ¥å£ AbstractQueue æ½è±¡ç±» Deque æ¥å£ ArrayDeque LinkedList PriorityQueue åèèµæ",content:'# Java å®¹å¨ä¹ Queue\n\n\n# Queue ç®ä»\n\n\n\n\n# Queue æ¥å£\n\nQueue æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface Queue<E> extends Collection<E> {}\n\n\n\n# AbstractQueue æ½è±¡ç±»\n\nAbstractQueue ç±»æä¾ Queue æ¥å£çæ ¸å¿å®ç°ï¼ä»¥æå¤§éåº¦å°åå°å®ç° Queue æ¥å£æéçå·¥ä½ã\n\nAbstractQueue æ½è±¡ç±»å®ä¹å¦ä¸ï¼\n\npublic abstract class AbstractQueue<E>\n    extends AbstractCollection<E>\n    implements Queue<E> {}\n\n\n\n# Deque æ¥å£\n\nDeque æ¥å£æ¯ double ended queue çç¼©åï¼å³åç«¯éåãDeque ç»§æ¿ Queue æ¥å£ï¼å¹¶æ©å±æ¯æå¨éåçä¸¤ç«¯æå¥åå é¤åç´ ã\n\næä»¥æä¾äºç¹å®çæ¹æ³ï¼å¦:\n\n * å°¾é¨æå¥æ¶éè¦ç addLast(e)ãofferLast(e)ã\n * å°¾é¨å é¤æéè¦ç removeLast()ãpollLast()ã\n\nå¤§å¤æ°çå®ç°å¯¹åç´ çæ°éæ²¡æéå¶ï¼ä½è¿ä¸ªæ¥å£æ¢æ¯ææå®¹ééå¶ç dequeï¼ä¹æ¯ææ²¡æåºå®å¤§å°éå¶çã\n\n\n# ArrayDeque\n\nArrayDeque æ¯ Deque çé¡ºåºè¡¨å®ç°ã\n\nArrayDeque ç¨ä¸ä¸ªå¨ææ°ç»å®ç°äºæ åéåæéçæææä½ã\n\n\n# LinkedList\n\nLinkedList æ¯ Deque çé¾è¡¨å®ç°ã\n\nç¤ºä¾ï¼\n\npublic class LinkedListQueueDemo {\n\n    public static void main(String[] args) {\n        //add()åremove()æ¹æ³å¨å¤±è´¥çæ¶åä¼æåºå¼å¸¸(ä¸æ¨è)\n        Queue<String> queue = new LinkedList<>();\n\n        queue.offer("a"); // å¥é\n        queue.offer("b"); // å¥é\n        queue.offer("c"); // å¥é\n        for (String q : queue) {\n            System.out.println(q);\n        }\n        System.out.println("===");\n        System.out.println("poll=" + queue.poll()); // åºé\n        for (String q : queue) {\n            System.out.println(q);\n        }\n        System.out.println("===");\n        System.out.println("element=" + queue.element()); //è¿åç¬¬ä¸ä¸ªåç´ \n        for (String q : queue) {\n            System.out.println(q);\n        }\n        System.out.println("===");\n        System.out.println("peek=" + queue.peek()); //è¿åç¬¬ä¸ä¸ªåç´ \n        for (String q : queue) {\n            System.out.println(q);\n        }\n    }\n\n}\n\n\n\n# PriorityQueue\n\nPriorityQueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class PriorityQueue<E> extends AbstractQueue<E>\n    implements java.io.Serializable {}\n\n\nPriorityQueue è¦ç¹ï¼\n\n * PriorityQueue å®ç°äº Serializableï¼æ¯æåºååã\n * PriorityQueue ç±»æ¯æ çä¼åçº§éåã\n * PriorityQueue ä¸­çåç´ æ ¹æ®èªç¶é¡ºåºæ Comparator æä¾çé¡ºåºæåºã\n * PriorityQueue ä¸æ¥å null å¼åç´ ã\n * PriorityQueue ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# åèèµæ\n\n * è§£è¯» Java å¹¶åéå BlockingQueue',normalizedContent:'# java å®¹å¨ä¹ queue\n\n\n# queue ç®ä»\n\n\n\n\n# queue æ¥å£\n\nqueue æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface queue<e> extends collection<e> {}\n\n\n\n# abstractqueue æ½è±¡ç±»\n\nabstractqueue ç±»æä¾ queue æ¥å£çæ ¸å¿å®ç°ï¼ä»¥æå¤§éåº¦å°åå°å®ç° queue æ¥å£æéçå·¥ä½ã\n\nabstractqueue æ½è±¡ç±»å®ä¹å¦ä¸ï¼\n\npublic abstract class abstractqueue<e>\n    extends abstractcollection<e>\n    implements queue<e> {}\n\n\n\n# deque æ¥å£\n\ndeque æ¥å£æ¯ double ended queue çç¼©åï¼å³åç«¯éåãdeque ç»§æ¿ queue æ¥å£ï¼å¹¶æ©å±æ¯æå¨éåçä¸¤ç«¯æå¥åå é¤åç´ ã\n\næä»¥æä¾äºç¹å®çæ¹æ³ï¼å¦:\n\n * å°¾é¨æå¥æ¶éè¦ç addlast(e)ãofferlast(e)ã\n * å°¾é¨å é¤æéè¦ç removelast()ãpolllast()ã\n\nå¤§å¤æ°çå®ç°å¯¹åç´ çæ°éæ²¡æéå¶ï¼ä½è¿ä¸ªæ¥å£æ¢æ¯ææå®¹ééå¶ç dequeï¼ä¹æ¯ææ²¡æåºå®å¤§å°éå¶çã\n\n\n# arraydeque\n\narraydeque æ¯ deque çé¡ºåºè¡¨å®ç°ã\n\narraydeque ç¨ä¸ä¸ªå¨ææ°ç»å®ç°äºæ åéåæéçæææä½ã\n\n\n# linkedlist\n\nlinkedlist æ¯ deque çé¾è¡¨å®ç°ã\n\nç¤ºä¾ï¼\n\npublic class linkedlistqueuedemo {\n\n    public static void main(string[] args) {\n        //add()åremove()æ¹æ³å¨å¤±è´¥çæ¶åä¼æåºå¼å¸¸(ä¸æ¨è)\n        queue<string> queue = new linkedlist<>();\n\n        queue.offer("a"); // å¥é\n        queue.offer("b"); // å¥é\n        queue.offer("c"); // å¥é\n        for (string q : queue) {\n            system.out.println(q);\n        }\n        system.out.println("===");\n        system.out.println("poll=" + queue.poll()); // åºé\n        for (string q : queue) {\n            system.out.println(q);\n        }\n        system.out.println("===");\n        system.out.println("element=" + queue.element()); //è¿åç¬¬ä¸ä¸ªåç´ \n        for (string q : queue) {\n            system.out.println(q);\n        }\n        system.out.println("===");\n        system.out.println("peek=" + queue.peek()); //è¿åç¬¬ä¸ä¸ªåç´ \n        for (string q : queue) {\n            system.out.println(q);\n        }\n    }\n\n}\n\n\n\n# priorityqueue\n\npriorityqueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class priorityqueue<e> extends abstractqueue<e>\n    implements java.io.serializable {}\n\n\npriorityqueue è¦ç¹ï¼\n\n * priorityqueue å®ç°äº serializableï¼æ¯æåºååã\n * priorityqueue ç±»æ¯æ çä¼åçº§éåã\n * priorityqueue ä¸­çåç´ æ ¹æ®èªç¶é¡ºåºæ comparator æä¾çé¡ºåºæåºã\n * priorityqueue ä¸æ¥å null å¼åç´ ã\n * priorityqueue ä¸æ¯çº¿ç¨å®å¨çã\n\n\n# åèèµæ\n\n * è§£è¯» java å¹¶åéå blockingqueue',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java IO æ¨¡å",frontmatter:{title:"Java IO æ¨¡å",date:"2020-11-21T16:36:40.000Z",categories:["Java","JavaSE","IO"],tags:["Java","JavaSE","IO"],permalink:"/pages/b165ad/"},regularPath:"/01.Java/01.JavaSE/04.IO/01.JavaIO%E6%A8%A1%E5%9E%8B.html",relativePath:"01.Java/01.JavaSE/04.IO/01.JavaIOæ¨¡å.md",key:"v-32719e6b",path:"/pages/b165ad/",headers:[{level:2,title:"UNIX I/O æ¨¡å",slug:"unix-i-o-æ¨¡å",normalizedTitle:"unix i/o æ¨¡å",charIndex:152},{level:3,title:"åæ­¥é»å¡ I/O",slug:"åæ­¥é»å¡-i-o",normalizedTitle:"åæ­¥é»å¡ i/o",charIndex:192},{level:3,title:"åæ­¥éé»å¡ I/O",slug:"åæ­¥éé»å¡-i-o",normalizedTitle:"åæ­¥éé»å¡ i/o",charIndex:204},{level:3,title:"I/O å¤è·¯å¤ç¨",slug:"i-o-å¤è·¯å¤ç¨",normalizedTitle:"i/o å¤è·¯å¤ç¨",charIndex:217},{level:3,title:"ä¿¡å·é©±å¨ I/O",slug:"ä¿¡å·é©±å¨-i-o",normalizedTitle:"ä¿¡å·é©±å¨ i/o",charIndex:229},{level:3,title:"å¼æ­¥ I/O",slug:"å¼æ­¥-i-o",normalizedTitle:"å¼æ­¥ i/o",charIndex:241},{level:2,title:"Java I/O æ¨¡å",slug:"java-i-o-æ¨¡å",normalizedTitle:"java i/o æ¨¡å",charIndex:1486},{level:3,title:"BIO",slug:"bio",normalizedTitle:"bio",charIndex:1502},{level:4,title:"BIO ç®ä»",slug:"bio-ç®ä»",normalizedTitle:"bio ç®ä»",charIndex:1565},{level:4,title:"BIO çæ§è½ç¼ºé·",slug:"bio-çæ§è½ç¼ºé·",normalizedTitle:"bio çæ§è½ç¼ºé·",charIndex:1853},{level:3,title:"NIO",slug:"nio",normalizedTitle:"nio",charIndex:2323},{level:4,title:"ä½¿ç¨ç¼å²åºä¼åè¯»åæµ",slug:"ä½¿ç¨ç¼å²åºä¼åè¯»åæµ",normalizedTitle:"ä½¿ç¨ç¼å²åºä¼åè¯»åæµ",charIndex:2569},{level:4,title:"ä½¿ç¨ DirectBuffer åå°åå­å¤å¶",slug:"ä½¿ç¨-directbuffer-åå°åå­å¤å¶",normalizedTitle:"ä½¿ç¨ directbuffer åå°åå­å¤å¶",charIndex:2791},{level:4,title:"ä¼å I/Oï¼é¿åé»å¡",slug:"ä¼å-i-o-é¿åé»å¡",normalizedTitle:"ä¼å i/oï¼é¿åé»å¡",charIndex:3123},{level:3,title:"AIO",slug:"aio",normalizedTitle:"aio",charIndex:3307},{level:2,title:"ä¼ ç» IO æµ",slug:"ä¼ ç»-io-æµ",normalizedTitle:"ä¼ ç» io æµ",charIndex:3552},{level:3,title:"å­èæµ",slug:"å­èæµ",normalizedTitle:"å­èæµ",charIndex:3638},{level:4,title:"æä»¶å­èæµ",slug:"æä»¶å­èæµ",normalizedTitle:"æä»¶å­èæµ",charIndex:3860},{level:4,title:"åå­å­èæµ",slug:"åå­å­èæµ",normalizedTitle:"åå­å­èæµ",charIndex:5262},{level:4,title:"ç®¡éæµ",slug:"ç®¡éæµ",normalizedTitle:"ç®¡éæµ",charIndex:6226},{level:4,title:"å¯¹è±¡å­èæµ",slug:"å¯¹è±¡å­èæµ",normalizedTitle:"å¯¹è±¡å­èæµ",charIndex:8170},{level:4,title:"æ°æ®æä½æµ",slug:"æ°æ®æä½æµ",normalizedTitle:"æ°æ®æä½æµ",charIndex:8272},{level:4,title:"åå¹¶æµ",slug:"åå¹¶æµ",normalizedTitle:"åå¹¶æµ",charIndex:10574},{level:3,title:"å­ç¬¦æµ",slug:"å­ç¬¦æµ",normalizedTitle:"å­ç¬¦æµ",charIndex:3642},{level:4,title:"æä»¶å­ç¬¦æµ",slug:"æä»¶å­ç¬¦æµ",normalizedTitle:"æä»¶å­ç¬¦æµ",charIndex:11356},{level:4,title:"å­èæµè½¬æ¢å­ç¬¦æµ",slug:"å­èæµè½¬æ¢å­ç¬¦æµ",normalizedTitle:"å­èæµè½¬æ¢å­ç¬¦æµ",charIndex:12824},{level:3,title:"å­èæµ vs. å­ç¬¦æµ",slug:"å­èæµ-vs-å­ç¬¦æµ",normalizedTitle:"å­èæµ vs. å­ç¬¦æµ",charIndex:13697},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:14087}],headersStr:"UNIX I/O æ¨¡å åæ­¥é»å¡ I/O åæ­¥éé»å¡ I/O I/O å¤è·¯å¤ç¨ ä¿¡å·é©±å¨ I/O å¼æ­¥ I/O Java I/O æ¨¡å BIO BIO ç®ä» BIO çæ§è½ç¼ºé· NIO ä½¿ç¨ç¼å²åºä¼åè¯»åæµ ä½¿ç¨ DirectBuffer åå°åå­å¤å¶ ä¼å I/Oï¼é¿åé»å¡ AIO ä¼ ç» IO æµ å­èæµ æä»¶å­èæµ åå­å­èæµ ç®¡éæµ å¯¹è±¡å­èæµ æ°æ®æä½æµ åå¹¶æµ å­ç¬¦æµ æä»¶å­ç¬¦æµ å­èæµè½¬æ¢å­ç¬¦æµ å­èæµ vs. å­ç¬¦æµ åèèµæ",content:'# Java IO æ¨¡å\n\n> æè°çI/Oï¼å°±æ¯è®¡ç®æºåå­ä¸å¤é¨è®¾å¤ä¹é´æ·è´æ°æ®çè¿ç¨ãç±äº CPU è®¿é®åå­çéåº¦è¿è¿é«äºå¤é¨è®¾å¤ï¼å æ­¤ CPU æ¯åæå¤é¨è®¾å¤çæ°æ®è¯»å°åå­éï¼ç¶ååè¿è¡å¤çã\n> \n> å³é®è¯ï¼InputStreamãOutputStreamãReaderãWriter\n\n\n# UNIX I/O æ¨¡å\n\nUNIX ç³»ç»ä¸ç I/O æ¨¡åæ 5 ç§ï¼\n\n * åæ­¥é»å¡ I/O\n * åæ­¥éé»å¡ I/O\n * I/O å¤è·¯å¤ç¨\n * ä¿¡å·é©±å¨ I/O\n * å¼æ­¥ I/O\n\nå¦ä½å»çè§£ UNIX I/O æ¨¡åï¼å¤§è´æä»¥ä¸ä¸¤ä¸ªç»´åº¦ï¼\n\n * åºååæ­¥æå¼æ­¥ï¼synchronous/asynchronousï¼ãç®åæ¥è¯´ï¼åæ­¥æ¯ä¸ç§å¯é çæåºè¿è¡æºå¶ï¼å½æä»¬è¿è¡åæ­¥æä½æ¶ï¼åç»­çä»»å¡æ¯ç­å¾å½åè°ç¨è¿åï¼æä¼è¿è¡ä¸ä¸æ­¥ï¼èå¼æ­¥åç¸åï¼å¶ä»ä»»å¡ä¸éè¦ç­å¾å½åè°ç¨è¿åï¼éå¸¸ä¾é äºä»¶ãåè°ç­æºå¶æ¥å®ç°ä»»å¡é´æ¬¡åºå³ç³»ã\n * åºåé»å¡ä¸éé»å¡ï¼blocking/non-blockingï¼ãå¨è¿è¡é»å¡æä½æ¶ï¼å½åçº¿ç¨ä¼å¤äºé»å¡ç¶æï¼æ æ³ä»äºå¶ä»ä»»å¡ï¼åªæå½æ¡ä»¶å°±ç»ªæè½ç»§ç»­ï¼æ¯å¦ ServerSocket æ°è¿æ¥å»ºç«å®æ¯ï¼ææ°æ®è¯»åãåå¥æä½å®æï¼èéé»å¡åæ¯ä¸ç®¡ IO æä½æ¯å¦ç»æï¼ç´æ¥è¿åï¼ç¸åºæä½å¨åå°ç»§ç»­å¤çã\n\nä¸è½ä¸æ¦èè®ºè®¤ä¸ºåæ­¥æé»å¡å°±æ¯ä½æï¼å·ä½è¿è¦çåºç¨åç³»ç»ç¹å¾ã\n\nå¯¹äºä¸ä¸ªç½ç» I/O éä¿¡è¿ç¨ï¼æ¯å¦ç½ç»æ°æ®è¯»åï¼ä¼æ¶åä¸¤ä¸ªå¯¹è±¡ï¼ä¸ä¸ªæ¯è°ç¨è¿ä¸ª I/O æä½çç¨æ·çº¿ç¨ï¼å¦å¤ä¸ä¸ªå°±æ¯æä½ç³»ç»åæ ¸ãä¸ä¸ªè¿ç¨çå°åç©ºé´åä¸ºç¨æ·ç©ºé´ååæ ¸ç©ºé´ï¼ç¨æ·çº¿ç¨ä¸è½ç´æ¥è®¿é®åæ ¸ç©ºé´ã\n\nå½ç¨æ·çº¿ç¨åèµ· I/O æä½åï¼ç½ç»æ°æ®è¯»åæä½ä¼ç»åä¸¤ä¸ªæ­¥éª¤ï¼\n\n * ç¨æ·çº¿ç¨ç­å¾åæ ¸å°æ°æ®ä»ç½å¡æ·è´å°åæ ¸ç©ºé´ã\n * åæ ¸å°æ°æ®ä»åæ ¸ç©ºé´æ·è´å°ç¨æ·ç©ºé´ã\n\nåç§ I/O æ¨¡åçåºå«å°±æ¯ï¼å®ä»¬å®ç°è¿ä¸¤ä¸ªæ­¥éª¤çæ¹å¼æ¯ä¸ä¸æ ·çã\n\n\n# åæ­¥é»å¡ I/O\n\nç¨æ·çº¿ç¨åèµ· read è°ç¨åå°±é»å¡äºï¼è®©åº CPUãåæ ¸ç­å¾ç½å¡æ°æ®å°æ¥ï¼ææ°æ®ä»ç½å¡æ·è´å°åæ ¸ç©ºé´ï¼æ¥çææ°æ®æ·è´å°ç¨æ·ç©ºé´ï¼åæç¨æ·çº¿ç¨å«éã\n\n\n\n\n# åæ­¥éé»å¡ I/O\n\nç¨æ·çº¿ç¨ä¸æ­çåèµ· read è°ç¨ï¼æ°æ®æ²¡å°åæ ¸ç©ºé´æ¶ï¼æ¯æ¬¡é½è¿åå¤±è´¥ï¼ç´å°æ°æ®å°äºåæ ¸ç©ºé´ï¼è¿ä¸æ¬¡ read è°ç¨åï¼å¨ç­å¾æ°æ®ä»åæ ¸ç©ºé´æ·è´å°ç¨æ·ç©ºé´è¿æ®µæ¶é´éï¼çº¿ç¨è¿æ¯é»å¡çï¼ç­æ°æ®å°äºç¨æ·ç©ºé´åæçº¿ç¨å«éã\n\n\n\n\n# I/O å¤è·¯å¤ç¨\n\nç¨æ·çº¿ç¨çè¯»åæä½åæä¸¤æ­¥äºï¼çº¿ç¨ååèµ· select è°ç¨ï¼ç®çæ¯é®åæ ¸æ°æ®åå¤å¥½äºåï¼ç­åæ ¸ææ°æ®åå¤å¥½äºï¼ç¨æ·çº¿ç¨ååèµ· read è°ç¨ãå¨ç­å¾æ°æ®ä»åæ ¸ç©ºé´æ·è´å°ç¨æ·ç©ºé´è¿æ®µæ¶é´éï¼çº¿ç¨è¿æ¯é»å¡çãé£ä¸ºä»ä¹å« I/O å¤è·¯å¤ç¨å¢ï¼å ä¸ºä¸æ¬¡ select è°ç¨å¯ä»¥ååæ ¸æ¥å¤ä¸ªæ°æ®ééï¼Channelï¼çç¶æï¼æä»¥å«å¤è·¯å¤ç¨ã\n\n\n\n\n# ä¿¡å·é©±å¨ I/O\n\né¦åå¼å¯ Socket çä¿¡å·é©±å¨ I/O åè½ï¼å¹¶å®è£ä¸ä¸ªä¿¡å·å¤çå½æ°ï¼è¿ç¨ç»§ç»­è¿è¡å¹¶ä¸é»å¡ãå½æ°æ®åå¤å¥½æ¶ï¼è¿ç¨ä¼æ¶å°ä¸ä¸ª SIGIO ä¿¡å·ï¼å¯ä»¥å¨ä¿¡å·å¤çå½æ°ä¸­è°ç¨ I/O æä½å½æ°å¤çæ°æ®ãä¿¡å·é©±å¨å¼ I/O æ¨¡åçä¼ç¹æ¯æä»¬å¨æ°æ®æ¥å°è¾¾æé´è¿ç¨ä¸ä¼è¢«é»å¡ï¼æä»¬åªè¦ç­å¾ä¿¡å·å¤çå½æ°çéç¥å³å¯\n\n\n# å¼æ­¥ I/O\n\nç¨æ·çº¿ç¨åèµ· read è°ç¨çåæ¶æ³¨åä¸ä¸ªåè°å½æ°ï¼read ç«å³è¿åï¼ç­åæ ¸å°æ°æ®åå¤å¥½åï¼åè°ç¨æå®çåè°å½æ°å®æå¤çãå¨è¿ä¸ªè¿ç¨ä¸­ï¼ç¨æ·çº¿ç¨ä¸ç´æ²¡æé»å¡ã\n\n\n\n\n# Java I/O æ¨¡å\n\n\n# BIO\n\n> BIOï¼blocking IOï¼ å³é»å¡ IOãæçä¸»è¦æ¯ä¼ ç»ç java.io åï¼å®åºäºæµæ¨¡åå®ç°ã\n\n# BIO ç®ä»\n\njava.io åæä¾äºæä»¬æçç¥çä¸äº IO åè½ï¼æ¯å¦ File æ½è±¡ãè¾å¥è¾åºæµç­ãäº¤äºæ¹å¼æ¯åæ­¥ãé»å¡çæ¹å¼ï¼ä¹å°±æ¯è¯´ï¼å¨è¯»åè¾å¥æµæèåå¥è¾åºæµæ¶ï¼å¨è¯»ãåå¨ä½å®æä¹åï¼çº¿ç¨ä¼ä¸ç´é»å¡å¨é£éï¼å®ä»¬ä¹é´çè°ç¨æ¯å¯é ççº¿æ§é¡ºåºã\n\nå¾å¤æ¶åï¼äººä»¬ä¹æ java.net ä¸é¢æä¾çé¨åç½ç» APIï¼æ¯å¦ SocketãServerSocketãHttpURLConnection ä¹å½ç±»å°åæ­¥é»å¡ IO ç±»åºï¼å ä¸ºç½ç»éä¿¡åæ ·æ¯ IO è¡ä¸ºã\n\nBIO çä¼ç¹æ¯ä»£ç æ¯è¾ç®åãç´è§ï¼ç¼ºç¹åæ¯ IO æçåæ©å±æ§å­å¨å±éæ§ï¼å®¹ææä¸ºåºç¨æ§è½çç¶é¢ã\n\n# BIO çæ§è½ç¼ºé·\n\nBIO ä¼é»å¡è¿ç¨ï¼ä¸éåé«å¹¶ååºæ¯ã\n\néç¨ BIO çæå¡ç«¯ï¼éå¸¸ç±ä¸ä¸ªç¬ç«ç Acceptor çº¿ç¨è´è´£çå¬å®¢æ·ç«¯è¿æ¥ãæå¡ç«¯ä¸è¬å¨while(true) å¾ªç¯ä¸­è°ç¨ accept() æ¹æ³ç­å¾å®¢æ·ç«¯çè¿æ¥è¯·æ±ï¼ä¸æ¦æ¥æ¶å°ä¸ä¸ªè¿æ¥è¯·æ±ï¼å°±å¯ä»¥å»ºç« Socketï¼å¹¶åºäºè¿ä¸ª Socket è¿è¡è¯»åæä½ãæ­¤æ¶ï¼ä¸è½åæ¥æ¶å¶ä»å®¢æ·ç«¯è¿æ¥è¯·æ±ï¼åªè½ç­å¾å½åè¿æ¥çæä½æ§è¡å®æã\n\nå¦æè¦è®© BIO éä¿¡æ¨¡å è½å¤åæ¶å¤çå¤ä¸ªå®¢æ·ç«¯è¯·æ±ï¼å°±å¿é¡»ä½¿ç¨å¤çº¿ç¨ï¼ä¸»è¦åå æ¯socket.accept()ãsocket.read()ãsocket.write() æ¶åçä¸ä¸ªä¸»è¦å½æ°é½æ¯åæ­¥é»å¡çï¼ï¼ä½ä¼é æä¸å¿è¦ççº¿ç¨å¼éãä¸è¿å¯ä»¥éè¿ çº¿ç¨æ± æºå¶ æ¹åï¼çº¿ç¨æ± è¿å¯ä»¥è®©çº¿ç¨çåå»ºååæ¶ææ¬ç¸å¯¹è¾ä½ã\n\nå³ä½¿å¯ä»¥ç¨çº¿ç¨æ± ç¥å¾®ä¼åï¼ä½æ¯ä¼æ¶èå®è´µççº¿ç¨èµæºï¼å¹¶ä¸å¨ç¾ä¸çº§å¹¶ååºæ¯ä¸ä¹æä¸ä½ãå¦æå¹¶åè®¿é®éå¢å ä¼å¯¼è´çº¿ç¨æ°æ¥å§è¨èå¯è½ä¼å¯¼è´çº¿ç¨å æ æº¢åºãåå»ºæ°çº¿ç¨å¤±è´¥ç­é®é¢ï¼æç»å¯¼è´è¿ç¨å®æºæèåµæ­»ï¼ä¸è½å¯¹å¤æä¾æå¡ã\n\n\n# NIO\n\n> NIOï¼non-blocking IOï¼ å³éé»å¡ IOãæçæ¯ Java 1.4 ä¸­å¼å¥ç java.nio åã\n\nä¸ºäºè§£å³ BIO çæ§è½é®é¢ï¼ Java 1.4 ä¸­å¼å¥ç java.nio åãNIO ä¼åäºåå­å¤å¶ä»¥åé»å¡å¯¼è´çä¸¥éæ§è½é®é¢ã\n\njava.nio åæä¾äº ChannelãSelectorãBuffer ç­æ°çæ½è±¡ï¼å¯ä»¥æå»ºå¤è·¯å¤ç¨çãåæ­¥éé»å¡ IO ç¨åºï¼åæ¶æä¾äºæ´æ¥è¿æä½ç³»ç»åºå±çé«æ§è½æ°æ®æä½æ¹å¼ã\n\nNIO æåªäºæ§è½ä¼åç¹å¢ï¼\n\n# ä½¿ç¨ç¼å²åºä¼åè¯»åæµ\n\nNIO ä¸ä¼ ç» I/O ä¸åï¼å®æ¯åºäºåï¼Blockï¼çï¼å®ä»¥åä¸ºåºæ¬åä½å¤çæ°æ®ãå¨ NIO ä¸­ï¼æä¸ºéè¦çä¸¤ä¸ªç»ä»¶æ¯ç¼å²åºï¼Bufferï¼åééï¼Channelï¼ã\n\nBuffer æ¯ä¸åè¿ç»­çåå­åï¼æ¯ NIO è¯»åæ°æ®çç¼å²ãBuffer å¯ä»¥å°æä»¶ä¸æ¬¡æ§è¯»å¥åå­åååç»­å¤çï¼èä¼ ç»çæ¹å¼æ¯è¾¹è¯»æä»¶è¾¹å¤çæ°æ®ãChannel è¡¨ç¤ºç¼å²æ°æ®çæºå¤´æèç®çå°ï¼å®ç¨äºè¯»åç¼å²æèåå¥æ°æ®ï¼æ¯è®¿é®ç¼å²çæ¥å£ã\n\n# ä½¿ç¨ DirectBuffer åå°åå­å¤å¶\n\nNIO è¿æä¾äºä¸ä¸ªå¯ä»¥ç´æ¥è®¿é®ç©çåå­çç±» DirectBufferãæ®éç Buffer åéçæ¯ JVM å åå­ï¼è DirectBuffer æ¯ç´æ¥åéç©çåå­ã\n\næ°æ®è¦è¾åºå°å¤é¨è®¾å¤ï¼å¿é¡»åä»ç¨æ·ç©ºé´å¤å¶å°åæ ¸ç©ºé´ï¼åå¤å¶å°è¾åºè®¾å¤ï¼è DirectBuffer åæ¯ç´æ¥å°æ­¥éª¤ç®åä¸ºä»åæ ¸ç©ºé´å¤å¶å°å¤é¨è®¾å¤ï¼åå°äºæ°æ®æ·è´ã\n\nè¿éæå±ä¸ç¹ï¼ç±äº DirectBuffer ç³è¯·çæ¯é JVM çç©çåå­ï¼æä»¥åå»ºåéæ¯çä»£ä»·å¾é«ãDirectBuffer ç³è¯·çåå­å¹¶ä¸æ¯ç´æ¥ç± JVM è´è´£åå¾åæ¶ï¼ä½å¨ DirectBuffer åè£ç±»è¢«åæ¶æ¶ï¼ä¼éè¿ Java å¼ç¨æºå¶æ¥éæ¾è¯¥åå­åã\n\n# ä¼å I/Oï¼é¿åé»å¡\n\nä¼ ç» I/O çæ°æ®è¯»åæ¯å¨ç¨æ·ç©ºé´ååæ ¸ç©ºé´æ¥åå¤å¶ï¼èåæ ¸ç©ºé´çæ°æ®æ¯éè¿æä½ç³»ç»å±é¢ç I/O æ¥å£ä»ç£çè¯»åæåå¥ã\n\nNIO ç Channel æèªå·±çå¤çå¨ï¼å¯ä»¥å®æåæ ¸ç©ºé´åç£çä¹é´ç I/O æä½ãå¨ NIO ä¸­ï¼æä»¬è¯»åååå¥æ°æ®é½è¦éè¿ Channelï¼ç±äº Channel æ¯ååçï¼æä»¥è¯»ãåå¯ä»¥åæ¶è¿è¡ã\n\n\n# AIO\n\n> AIOï¼Asynchronous IOï¼ å³å¼æ­¥éé»å¡ IOï¼æçæ¯ Java 7 ä¸­ï¼å¯¹ NIO æäºè¿ä¸æ­¥çæ¹è¿ï¼ä¹ç§°ä¸º NIO2ï¼å¼å¥äºå¼æ­¥éé»å¡ IO æ¹å¼ã\n\nå¨ Java 7 ä¸­ï¼NIO æäºè¿ä¸æ­¥çæ¹è¿ï¼ä¹å°±æ¯ NIO 2ï¼å¼å¥äºå¼æ­¥éé»å¡ IO æ¹å¼ï¼ä¹æå¾å¤äººå«å® AIOï¼Asynchronous IOï¼ãå¼æ­¥ IO æä½åºäºäºä»¶ååè°æºå¶ï¼å¯ä»¥ç®åçè§£ä¸ºï¼åºç¨æä½ç´æ¥è¿åï¼èä¸ä¼é»å¡å¨é£éï¼å½åå°å¤çå®æï¼æä½ç³»ç»ä¼éç¥ç¸åºçº¿ç¨è¿è¡åç»­å·¥ä½ã\n\n\n# ä¼ ç» IO æµ\n\næµä»æ¦å¿µä¸æ¥è¯´æ¯ä¸ä¸ªè¿ç»­çæ°æ®æµãå½ç¨åºéè¦è¯»æ°æ®çæ¶åå°±éè¦ä½¿ç¨è¾å¥æµè¯»åæ°æ®ï¼å½éè¦å¾å¤åæ°æ®çæ¶åå°±éè¦è¾åºæµã\n\nBIO ä¸­æä½çæµä¸»è¦æä¸¤å¤§ç±»ï¼å­èæµåå­ç¬¦æµï¼ä¸¤ç±»æ ¹æ®æµçæ¹åé½å¯ä»¥åä¸ºè¾å¥æµåè¾åºæµã\n\n * å­èæµ\n   * è¾å¥å­èæµï¼InputStream\n   * è¾åºå­èæµï¼OutputStream\n * å­ç¬¦æµ\n   * è¾å¥å­ç¬¦æµï¼Reader\n   * è¾åºå­ç¬¦æµï¼Writer\n\n\n\n\n# å­èæµ\n\nå­èæµä¸»è¦æä½å­èæ°æ®æäºè¿å¶å¯¹è±¡ã\n\nå­èæµæä¸¤ä¸ªæ ¸å¿æ½è±¡ç±»ï¼InputStream å OutputStreamãææçå­èæµç±»é½ç»§æ¿èªè¿ä¸¤ä¸ªæ½è±¡ç±»ã\n\n\n\n# æä»¶å­èæµ\n\nFileOutputStream å FileInputStream æä¾äºè¯»åå­èå°æä»¶çè½åã\n\næä»¶æµæä½ä¸è¬æ­¥éª¤ï¼\n\n 1. ä½¿ç¨ File ç±»ç»å®ä¸ä¸ªæä»¶ã\n 2. æ File å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸ã\n 3. è¿è¡è¯»æåæä½ã\n 4. å³é­æµ\n\nFileOutputStream å FileInputStream ç¤ºä¾ï¼\n\npublic class FileStreamDemo {\n\n    private static final String FILEPATH = "temp.log";\n\n    public static void main(String[] args) throws Exception {\n        write(FILEPATH);\n        read(FILEPATH);\n    }\n\n    public static void write(String filepath) throws IOException {\n        // ç¬¬1æ­¥ãä½¿ç¨Fileç±»æ¾å°ä¸ä¸ªæä»¶\n        File f = new File(filepath);\n\n        // ç¬¬2æ­¥ãéè¿å­ç±»å®ä¾åç¶ç±»å¯¹è±¡\n        OutputStream out = new FileOutputStream(f);\n        // å®ä¾åæ¶ï¼é»è®¤ä¸ºè¦çåæä»¶åå®¹æ¹å¼ï¼å¦ææ·»å trueåæ°ï¼ååä¸ºå¯¹åæä»¶è¿½å åå®¹çæ¹å¼ã\n        // OutputStream out = new FileOutputStream(f, true);\n\n        // ç¬¬3æ­¥ãè¿è¡åæä½\n        String str = "Hello World\\n";\n        byte[] bytes = str.getBytes();\n        out.write(bytes);\n\n        // ç¬¬4æ­¥ãå³é­è¾åºæµ\n        out.close();\n    }\n\n    public static void read(String filepath) throws IOException {\n        // ç¬¬1æ­¥ãä½¿ç¨Fileç±»æ¾å°ä¸ä¸ªæä»¶\n        File f = new File(filepath);\n\n        // ç¬¬2æ­¥ãéè¿å­ç±»å®ä¾åç¶ç±»å¯¹è±¡\n        InputStream input = new FileInputStream(f);\n\n        // ç¬¬3æ­¥ãè¿è¡è¯»æä½\n        // æä¸ç§è¯»åæ¹å¼ï¼ä½ä¼å¶å·®å¼\n        byte[] bytes = new byte[(int) f.length()];\n        int len = input.read(bytes); // è¯»ååå®¹\n        System.out.println("è¯»å¥æ°æ®çé¿åº¦ï¼" + len);\n\n        // ç¬¬4æ­¥ãå³é­è¾å¥æµ\n        input.close();\n        System.out.println("åå®¹ä¸ºï¼\\n" + new String(bytes));\n    }\n\n}\n\n\n# åå­å­èæµ\n\nByteArrayInputStream å ByteArrayOutputStream æ¯ç¨æ¥å®æåå­çè¾å¥åè¾åºåè½ã\n\nåå­æä½æµä¸è¬å¨çæä¸äºä¸´æ¶ä¿¡æ¯æ¶æä½¿ç¨ã å¦æä¸´æ¶ä¿¡æ¯ä¿å­å¨æä»¶ä¸­ï¼è¿éè¦å¨æææè¿åå é¤æä»¶ï¼è¿æ ·æ¯è¾éº»ç¦ã\n\nByteArrayInputStream å ByteArrayOutputStream ç¤ºä¾ï¼\n\npublic class ByteArrayStreamDemo {\n\n    public static void main(String[] args) {\n        String str = "HELLOWORLD"; // å®ä¹ä¸ä¸ªå­ç¬¦ä¸²ï¼å¨é¨ç±å¤§åå­æ¯ç»æ\n        ByteArrayInputStream bis = new ByteArrayInputStream(str.getBytes());\n        ByteArrayOutputStream bos = new ByteArrayOutputStream();\n        // åå¤ä»åå­ByteArrayInputStreamä¸­è¯»ååå®¹\n        int temp = 0;\n        while ((temp = bis.read()) != -1) {\n            char c = (char) temp; // è¯»åçæ°å­åä¸ºå­ç¬¦\n            bos.write(Character.toLowerCase(c)); // å°å­ç¬¦åä¸ºå°å\n        }\n        // ææçæ°æ®å°±å¨é¨é½å¨ByteArrayOutputStreamä¸­\n        String newStr = bos.toString(); // ååºåå®¹\n        try {\n            bis.close();\n            bos.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        System.out.println(newStr);\n    }\n\n}\n\n\n# ç®¡éæµ\n\nç®¡éæµçä¸»è¦ä½ç¨æ¯å¯ä»¥è¿è¡ä¸¤ä¸ªçº¿ç¨é´çéä¿¡ã\n\nå¦æè¦è¿è¡ç®¡ééä¿¡ï¼åå¿é¡»æ PipedOutputStream è¿æ¥å¨ PipedInputStream ä¸ãä¸ºæ­¤ï¼PipedOutputStream ä¸­æä¾äº connect() æ¹æ³ã\n\npublic class PipedStreamDemo {\n\n    public static void main(String[] args) {\n        Send s = new Send();\n        Receive r = new Receive();\n        try {\n            s.getPos().connect(r.getPis()); // è¿æ¥ç®¡é\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        new Thread(s).start(); // å¯å¨çº¿ç¨\n        new Thread(r).start(); // å¯å¨çº¿ç¨\n    }\n\n    static class Send implements Runnable {\n\n        private PipedOutputStream pos = null;\n\n        Send() {\n            pos = new PipedOutputStream(); // å®ä¾åè¾åºæµ\n        }\n\n        @Override\n        public void run() {\n            String str = "Hello World!!!";\n            try {\n                pos.write(str.getBytes());\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            try {\n                pos.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n\n        /**\n         * å¾å°æ­¤çº¿ç¨çç®¡éè¾åºæµ\n         */\n        PipedOutputStream getPos() {\n            return pos;\n        }\n\n    }\n\n    static class Receive implements Runnable {\n\n        private PipedInputStream pis = null;\n\n        Receive() {\n            pis = new PipedInputStream();\n        }\n\n        @Override\n        public void run() {\n            byte[] b = new byte[1024];\n            int len = 0;\n            try {\n                len = pis.read(b);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            try {\n                pis.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            System.out.println("æ¥æ¶çåå®¹ä¸ºï¼" + new String(b, 0, len));\n        }\n\n        /**\n         * å¾å°æ­¤çº¿ç¨çç®¡éè¾å¥æµ\n         */\n        PipedInputStream getPis() {\n            return pis;\n        }\n\n    }\n\n}\n\n\n# å¯¹è±¡å­èæµ\n\nObjectInputStream å ObjectOutputStream æ¯å¯¹è±¡è¾å¥è¾åºæµï¼ä¸è¬ç¨äºå¯¹è±¡åºååã\n\nè¿éä¸å±å¼åè¿°ï¼æ³äºè§£è¯¦ç»åå®¹åç¤ºä¾å¯ä»¥åèï¼Java åºåå\n\n# æ°æ®æä½æµ\n\næ°æ®æä½æµæä¾äºæ ¼å¼åè¯»å¥åè¾åºæ°æ®çæ¹æ³ï¼åå«ä¸º DataInputStream å DataOutputStreamã\n\nDataInputStream å DataOutputStream æ ¼å¼åè¯»åæ°æ®ç¤ºä¾ï¼\n\npublic class DataStreamDemo {\n\n    public static final String FILEPATH = "temp.log";\n\n    public static void main(String[] args) throws IOException {\n        write(FILEPATH);\n        read(FILEPATH);\n    }\n\n    private static void write(String filepath) throws IOException {\n        // 1.ä½¿ç¨ File ç±»ç»å®ä¸ä¸ªæä»¶\n        File f = new File(filepath);\n\n        // 2.æ File å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        DataOutputStream dos = new DataOutputStream(new FileOutputStream(f));\n\n        // 3.è¿è¡è¯»æåæä½\n        String[] names = { "è¡¬è¡£", "æå¥", "å´å·¾" };\n        float[] prices = { 98.3f, 30.3f, 50.5f };\n        int[] nums = { 3, 2, 1 };\n        for (int i = 0; i < names.length; i++) {\n            dos.writeChars(names[i]);\n            dos.writeChar(\'\\t\');\n            dos.writeFloat(prices[i]);\n            dos.writeChar(\'\\t\');\n            dos.writeInt(nums[i]);\n            dos.writeChar(\'\\n\');\n        }\n\n        // 4.å³é­æµ\n        dos.close();\n    }\n\n    private static void read(String filepath) throws IOException {\n        // 1.ä½¿ç¨ File ç±»ç»å®ä¸ä¸ªæä»¶\n        File f = new File(filepath);\n\n        // 2.æ File å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        DataInputStream dis = new DataInputStream(new FileInputStream(f));\n\n        // 3.è¿è¡è¯»æåæä½\n        String name = null; // æ¥æ¶åç§°\n        float price = 0.0f; // æ¥æ¶ä»·æ ¼\n        int num = 0; // æ¥æ¶æ°é\n        char[] temp = null; // æ¥æ¶åååç§°\n        int len = 0; // ä¿å­è¯»åæ°æ®çä¸ªæ°\n        char c = 0; // \'\\u0000\'\n        try {\n            while (true) {\n                temp = new char[200]; // å¼è¾ç©ºé´\n                len = 0;\n                while ((c = dis.readChar()) != \'\\t\') { // æ¥æ¶åå®¹\n                    temp[len] = c;\n                    len++; // è¯»åé¿åº¦å 1\n                }\n                name = new String(temp, 0, len); // å°å­ç¬¦æ°ç»åä¸ºString\n                price = dis.readFloat(); // è¯»åä»·æ ¼\n                dis.readChar(); // è¯»å\\t\n                num = dis.readInt(); // è¯»åint\n                dis.readChar(); // è¯»å\\n\n                System.out.printf("åç§°ï¼%sï¼ä»·æ ¼ï¼%5.2fï¼æ°éï¼%d\\n", name, price, num);\n            }\n        } catch (EOFException e) {\n            System.out.println("ç»æ");\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n\n        // 4.å³é­æµ\n        dis.close();\n    }\n\n}\n\n\n# åå¹¶æµ\n\nåå¹¶æµçä¸»è¦åè½æ¯å°å¤ä¸ª InputStream åå¹¶ä¸ºä¸ä¸ª InputStream æµãåå¹¶æµçåè½ç± SequenceInputStream å®æã\n\npublic class SequenceInputStreamDemo {\n\n    public static void main(String[] args) throws Exception {\n\n        InputStream is1 = new FileInputStream("temp1.log");\n        InputStream is2 = new FileInputStream("temp2.log");\n        SequenceInputStream sis = new SequenceInputStream(is1, is2);\n\n        int temp = 0; // æ¥æ¶åå®¹\n        OutputStream os = new FileOutputStream("temp3.logt");\n        while ((temp = sis.read()) != -1) { // å¾ªç¯è¾åº\n            os.write(temp); // ä¿å­åå®¹\n        }\n\n        sis.close(); // å³é­åå¹¶æµ\n        is1.close(); // å³é­è¾å¥æµ1\n        is2.close(); // å³é­è¾å¥æµ2\n        os.close(); // å³é­è¾åºæµ\n    }\n\n}\n\n\n\n# å­ç¬¦æµ\n\nå­ç¬¦æµä¸»è¦æä½å­ç¬¦ï¼ä¸ä¸ªå­ç¬¦ç­äºä¸¤ä¸ªå­èã\n\nå­ç¬¦æµæä¸¤ä¸ªæ ¸å¿ç±»ï¼Reader ç±»å Writer ãææçå­ç¬¦æµç±»é½ç»§æ¿èªè¿ä¸¤ä¸ªæ½è±¡ç±»ã\n\n\n\n# æä»¶å­ç¬¦æµ\n\næä»¶å­ç¬¦æµ FileReader å FileWriter å¯ä»¥åæä»¶è¯»åææ¬æ°æ®ã\n\nFileReader å FileWriter è¯»åæä»¶ç¤ºä¾ï¼\n\npublic class FileReadWriteDemo {\n\n    private static final String FILEPATH = "temp.log";\n\n    public static void main(String[] args) throws IOException {\n        write(FILEPATH);\n        System.out.println("åå®¹ä¸ºï¼" + new String(read(FILEPATH)));\n    }\n\n    public static void write(String filepath) throws IOException {\n        // 1.ä½¿ç¨ File ç±»ç»å®ä¸ä¸ªæä»¶\n        File f = new File(filepath);\n\n        // 2.æ File å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        Writer out = new FileWriter(f);\n        // Writer out = new FileWriter(f, true); // è¿½å åå®¹æ¹å¼\n\n        // 3.è¿è¡è¯»æåæä½\n        String str = "Hello World!!!\\r\\n";\n        out.write(str);\n\n        // 4.å³é­æµ\n        // å­ç¬¦æµæä½æ¶ä½¿ç¨äºç¼å²åºï¼å¹¶å¨å³é­å­ç¬¦æµæ¶ä¼å¼ºå¶å°ç¼å²åºåå®¹è¾åº\n        // å¦æä¸å³é­æµï¼åç¼å²åºçåå®¹æ¯æ æ³è¾åºç\n        // å¦ææ³å¨ä¸å³é­æµæ¶ï¼å°ç¼å²åºåå®¹è¾åºï¼å¯ä»¥ä½¿ç¨ flush å¼ºå¶æ¸ç©ºç¼å²åº\n        out.flush();\n        out.close();\n    }\n\n    public static char[] read(String filepath) throws IOException {\n        // 1.ä½¿ç¨ File ç±»ç»å®ä¸ä¸ªæä»¶\n        File f = new File(filepath);\n\n        // 2.æ File å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        Reader input = new FileReader(f);\n\n        // 3.è¿è¡è¯»æåæä½\n        int temp = 0; // æ¥æ¶æ¯ä¸ä¸ªåå®¹\n        int len = 0; // è¯»ååå®¹\n        char[] c = new char[1024];\n        while ((temp = input.read()) != -1) {\n            // å¦æä¸æ¯-1å°±è¡¨ç¤ºè¿æåå®¹ï¼å¯ä»¥ç»§ç»­è¯»å\n            c[len] = (char) temp;\n            len++;\n        }\n        System.out.println("æä»¶å­ç¬¦æ°ä¸ºï¼" + len);\n\n        // 4.å³é­æµ\n        input.close();\n\n        return c;\n    }\n\n}\n\n\n# å­èæµè½¬æ¢å­ç¬¦æµ\n\næä»¬å¯ä»¥å¨ç¨åºä¸­éè¿ InputStream å Reader ä»æ°æ®æºä¸­è¯»åæ°æ®ï¼ç¶åä¹å¯ä»¥å¨ç¨åºä¸­å°æ°æ®éè¿ OutputStream å Writer è¾åºå°ç®æ åªä»ä¸­\n\nä½¿ç¨ InputStreamReader å¯ä»¥å°è¾å¥å­èæµè½¬åä¸ºè¾å¥å­ç¬¦æµï¼ä½¿ç¨OutputStreamWriterå¯ä»¥å°è¾åºå­èæµè½¬åä¸ºè¾åºå­ç¬¦æµã\n\nOutputStreamWriter ç¤ºä¾ï¼\n\npublic class OutputStreamWriterDemo {\n\n    public static void main(String[] args) throws IOException {\n        File f = new File("temp.log");\n        Writer out = new OutputStreamWriter(new FileOutputStream(f));\n        out.write("hello world!!");\n        out.close();\n    }\n\n}\n\n\nInputStreamReader ç¤ºä¾ï¼\n\npublic class InputStreamReaderDemo {\n\n    public static void main(String[] args) throws IOException {\n        File f = new File("temp.log");\n        Reader reader = new InputStreamReader(new FileInputStream(f));\n        char[] c = new char[1024];\n        int len = reader.read(c);\n        reader.close();\n        System.out.println(new String(c, 0, len));\n    }\n\n}\n\n\n\n# å­èæµ vs. å­ç¬¦æµ\n\nç¸åç¹ï¼\n\nå­èæµåå­ç¬¦æµé½æ read()ãwrite()ãflush()ãclose() è¿æ ·çæ¹æ³ï¼è¿å³å®äºå®ä»¬çæä½æ¹å¼è¿ä¼¼ã\n\nä¸åç¹ï¼\n\n * æ°æ®ç±»å\n   * å­èæµçæ°æ®æ¯å­èï¼äºè¿å¶å¯¹è±¡ï¼ãä¸»è¦æ ¸å¿ç±»æ¯ InputStream ç±»å OutputStream ç±»ã\n   * å­ç¬¦æµçæ°æ®æ¯å­ç¬¦ï¼ä¸ä¸ªå­ç¬¦ç­äºä¸¤ä¸ªå­èãä¸»è¦æ ¸å¿ç±»æ¯ Reader ç±»å Writer ç±»ã\n * ç¼å²åº\n   * å­èæµå¨æä½æ¶æ¬èº«ä¸ä¼ç¨å°ç¼å²åºï¼åå­ï¼ï¼æ¯æä»¶ç´æ¥æä½çã\n   * å­ç¬¦æµå¨æä½æ¶æ¯ä½¿ç¨äºç¼å²åºï¼éè¿ç¼å²åºåæä½æä»¶ã\n\néæ©ï¼\n\nææçæä»¶å¨ç¡¬çæä¼ è¾æ¶é½æ¯ä»¥å­èæ¹å¼ä¿å­çï¼ä¾å¦å¾çï¼å½±é³æä»¶ç­é½æ¯æå­èæ¹å¼å­å¨çãå­ç¬¦æµæ æ³è¯»åè¿äºæä»¶ã\n\næä»¥ï¼é¤äºçº¯ææ¬æ°æ®æä»¶ä½¿ç¨å­ç¬¦æµä»¥å¤ï¼å¶ä»æä»¶ç±»åé½åºè¯¥ä½¿ç¨å­èæµæ¹å¼ã\n\n\n# åèèµæ\n\n * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n * ãJava ä»å¥é¨å°ç²¾éã\n * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * BIO,NIO,AIO æ»ç»\n * æ·±å¥æè§£ Tomcat & Jetty',normalizedContent:'# java io æ¨¡å\n\n> æè°çi/oï¼å°±æ¯è®¡ç®æºåå­ä¸å¤é¨è®¾å¤ä¹é´æ·è´æ°æ®çè¿ç¨ãç±äº cpu è®¿é®åå­çéåº¦è¿è¿é«äºå¤é¨è®¾å¤ï¼å æ­¤ cpu æ¯åæå¤é¨è®¾å¤çæ°æ®è¯»å°åå­éï¼ç¶ååè¿è¡å¤çã\n> \n> å³é®è¯ï¼inputstreamãoutputstreamãreaderãwriter\n\n\n# unix i/o æ¨¡å\n\nunix ç³»ç»ä¸ç i/o æ¨¡åæ 5 ç§ï¼\n\n * åæ­¥é»å¡ i/o\n * åæ­¥éé»å¡ i/o\n * i/o å¤è·¯å¤ç¨\n * ä¿¡å·é©±å¨ i/o\n * å¼æ­¥ i/o\n\nå¦ä½å»çè§£ unix i/o æ¨¡åï¼å¤§è´æä»¥ä¸ä¸¤ä¸ªç»´åº¦ï¼\n\n * åºååæ­¥æå¼æ­¥ï¼synchronous/asynchronousï¼ãç®åæ¥è¯´ï¼åæ­¥æ¯ä¸ç§å¯é çæåºè¿è¡æºå¶ï¼å½æä»¬è¿è¡åæ­¥æä½æ¶ï¼åç»­çä»»å¡æ¯ç­å¾å½åè°ç¨è¿åï¼æä¼è¿è¡ä¸ä¸æ­¥ï¼èå¼æ­¥åç¸åï¼å¶ä»ä»»å¡ä¸éè¦ç­å¾å½åè°ç¨è¿åï¼éå¸¸ä¾é äºä»¶ãåè°ç­æºå¶æ¥å®ç°ä»»å¡é´æ¬¡åºå³ç³»ã\n * åºåé»å¡ä¸éé»å¡ï¼blocking/non-blockingï¼ãå¨è¿è¡é»å¡æä½æ¶ï¼å½åçº¿ç¨ä¼å¤äºé»å¡ç¶æï¼æ æ³ä»äºå¶ä»ä»»å¡ï¼åªæå½æ¡ä»¶å°±ç»ªæè½ç»§ç»­ï¼æ¯å¦ serversocket æ°è¿æ¥å»ºç«å®æ¯ï¼ææ°æ®è¯»åãåå¥æä½å®æï¼èéé»å¡åæ¯ä¸ç®¡ io æä½æ¯å¦ç»æï¼ç´æ¥è¿åï¼ç¸åºæä½å¨åå°ç»§ç»­å¤çã\n\nä¸è½ä¸æ¦èè®ºè®¤ä¸ºåæ­¥æé»å¡å°±æ¯ä½æï¼å·ä½è¿è¦çåºç¨åç³»ç»ç¹å¾ã\n\nå¯¹äºä¸ä¸ªç½ç» i/o éä¿¡è¿ç¨ï¼æ¯å¦ç½ç»æ°æ®è¯»åï¼ä¼æ¶åä¸¤ä¸ªå¯¹è±¡ï¼ä¸ä¸ªæ¯è°ç¨è¿ä¸ª i/o æä½çç¨æ·çº¿ç¨ï¼å¦å¤ä¸ä¸ªå°±æ¯æä½ç³»ç»åæ ¸ãä¸ä¸ªè¿ç¨çå°åç©ºé´åä¸ºç¨æ·ç©ºé´ååæ ¸ç©ºé´ï¼ç¨æ·çº¿ç¨ä¸è½ç´æ¥è®¿é®åæ ¸ç©ºé´ã\n\nå½ç¨æ·çº¿ç¨åèµ· i/o æä½åï¼ç½ç»æ°æ®è¯»åæä½ä¼ç»åä¸¤ä¸ªæ­¥éª¤ï¼\n\n * ç¨æ·çº¿ç¨ç­å¾åæ ¸å°æ°æ®ä»ç½å¡æ·è´å°åæ ¸ç©ºé´ã\n * åæ ¸å°æ°æ®ä»åæ ¸ç©ºé´æ·è´å°ç¨æ·ç©ºé´ã\n\nåç§ i/o æ¨¡åçåºå«å°±æ¯ï¼å®ä»¬å®ç°è¿ä¸¤ä¸ªæ­¥éª¤çæ¹å¼æ¯ä¸ä¸æ ·çã\n\n\n# åæ­¥é»å¡ i/o\n\nç¨æ·çº¿ç¨åèµ· read è°ç¨åå°±é»å¡äºï¼è®©åº cpuãåæ ¸ç­å¾ç½å¡æ°æ®å°æ¥ï¼ææ°æ®ä»ç½å¡æ·è´å°åæ ¸ç©ºé´ï¼æ¥çææ°æ®æ·è´å°ç¨æ·ç©ºé´ï¼åæç¨æ·çº¿ç¨å«éã\n\n\n\n\n# åæ­¥éé»å¡ i/o\n\nç¨æ·çº¿ç¨ä¸æ­çåèµ· read è°ç¨ï¼æ°æ®æ²¡å°åæ ¸ç©ºé´æ¶ï¼æ¯æ¬¡é½è¿åå¤±è´¥ï¼ç´å°æ°æ®å°äºåæ ¸ç©ºé´ï¼è¿ä¸æ¬¡ read è°ç¨åï¼å¨ç­å¾æ°æ®ä»åæ ¸ç©ºé´æ·è´å°ç¨æ·ç©ºé´è¿æ®µæ¶é´éï¼çº¿ç¨è¿æ¯é»å¡çï¼ç­æ°æ®å°äºç¨æ·ç©ºé´åæçº¿ç¨å«éã\n\n\n\n\n# i/o å¤è·¯å¤ç¨\n\nç¨æ·çº¿ç¨çè¯»åæä½åæä¸¤æ­¥äºï¼çº¿ç¨ååèµ· select è°ç¨ï¼ç®çæ¯é®åæ ¸æ°æ®åå¤å¥½äºåï¼ç­åæ ¸ææ°æ®åå¤å¥½äºï¼ç¨æ·çº¿ç¨ååèµ· read è°ç¨ãå¨ç­å¾æ°æ®ä»åæ ¸ç©ºé´æ·è´å°ç¨æ·ç©ºé´è¿æ®µæ¶é´éï¼çº¿ç¨è¿æ¯é»å¡çãé£ä¸ºä»ä¹å« i/o å¤è·¯å¤ç¨å¢ï¼å ä¸ºä¸æ¬¡ select è°ç¨å¯ä»¥ååæ ¸æ¥å¤ä¸ªæ°æ®ééï¼channelï¼çç¶æï¼æä»¥å«å¤è·¯å¤ç¨ã\n\n\n\n\n# ä¿¡å·é©±å¨ i/o\n\né¦åå¼å¯ socket çä¿¡å·é©±å¨ i/o åè½ï¼å¹¶å®è£ä¸ä¸ªä¿¡å·å¤çå½æ°ï¼è¿ç¨ç»§ç»­è¿è¡å¹¶ä¸é»å¡ãå½æ°æ®åå¤å¥½æ¶ï¼è¿ç¨ä¼æ¶å°ä¸ä¸ª sigio ä¿¡å·ï¼å¯ä»¥å¨ä¿¡å·å¤çå½æ°ä¸­è°ç¨ i/o æä½å½æ°å¤çæ°æ®ãä¿¡å·é©±å¨å¼ i/o æ¨¡åçä¼ç¹æ¯æä»¬å¨æ°æ®æ¥å°è¾¾æé´è¿ç¨ä¸ä¼è¢«é»å¡ï¼æä»¬åªè¦ç­å¾ä¿¡å·å¤çå½æ°çéç¥å³å¯\n\n\n# å¼æ­¥ i/o\n\nç¨æ·çº¿ç¨åèµ· read è°ç¨çåæ¶æ³¨åä¸ä¸ªåè°å½æ°ï¼read ç«å³è¿åï¼ç­åæ ¸å°æ°æ®åå¤å¥½åï¼åè°ç¨æå®çåè°å½æ°å®æå¤çãå¨è¿ä¸ªè¿ç¨ä¸­ï¼ç¨æ·çº¿ç¨ä¸ç´æ²¡æé»å¡ã\n\n\n\n\n# java i/o æ¨¡å\n\n\n# bio\n\n> bioï¼blocking ioï¼ å³é»å¡ ioãæçä¸»è¦æ¯ä¼ ç»ç java.io åï¼å®åºäºæµæ¨¡åå®ç°ã\n\n# bio ç®ä»\n\njava.io åæä¾äºæä»¬æçç¥çä¸äº io åè½ï¼æ¯å¦ file æ½è±¡ãè¾å¥è¾åºæµç­ãäº¤äºæ¹å¼æ¯åæ­¥ãé»å¡çæ¹å¼ï¼ä¹å°±æ¯è¯´ï¼å¨è¯»åè¾å¥æµæèåå¥è¾åºæµæ¶ï¼å¨è¯»ãåå¨ä½å®æä¹åï¼çº¿ç¨ä¼ä¸ç´é»å¡å¨é£éï¼å®ä»¬ä¹é´çè°ç¨æ¯å¯é ççº¿æ§é¡ºåºã\n\nå¾å¤æ¶åï¼äººä»¬ä¹æ java.net ä¸é¢æä¾çé¨åç½ç» apiï¼æ¯å¦ socketãserversocketãhttpurlconnection ä¹å½ç±»å°åæ­¥é»å¡ io ç±»åºï¼å ä¸ºç½ç»éä¿¡åæ ·æ¯ io è¡ä¸ºã\n\nbio çä¼ç¹æ¯ä»£ç æ¯è¾ç®åãç´è§ï¼ç¼ºç¹åæ¯ io æçåæ©å±æ§å­å¨å±éæ§ï¼å®¹ææä¸ºåºç¨æ§è½çç¶é¢ã\n\n# bio çæ§è½ç¼ºé·\n\nbio ä¼é»å¡è¿ç¨ï¼ä¸éåé«å¹¶ååºæ¯ã\n\néç¨ bio çæå¡ç«¯ï¼éå¸¸ç±ä¸ä¸ªç¬ç«ç acceptor çº¿ç¨è´è´£çå¬å®¢æ·ç«¯è¿æ¥ãæå¡ç«¯ä¸è¬å¨while(true) å¾ªç¯ä¸­è°ç¨ accept() æ¹æ³ç­å¾å®¢æ·ç«¯çè¿æ¥è¯·æ±ï¼ä¸æ¦æ¥æ¶å°ä¸ä¸ªè¿æ¥è¯·æ±ï¼å°±å¯ä»¥å»ºç« socketï¼å¹¶åºäºè¿ä¸ª socket è¿è¡è¯»åæä½ãæ­¤æ¶ï¼ä¸è½åæ¥æ¶å¶ä»å®¢æ·ç«¯è¿æ¥è¯·æ±ï¼åªè½ç­å¾å½åè¿æ¥çæä½æ§è¡å®æã\n\nå¦æè¦è®© bio éä¿¡æ¨¡å è½å¤åæ¶å¤çå¤ä¸ªå®¢æ·ç«¯è¯·æ±ï¼å°±å¿é¡»ä½¿ç¨å¤çº¿ç¨ï¼ä¸»è¦åå æ¯socket.accept()ãsocket.read()ãsocket.write() æ¶åçä¸ä¸ªä¸»è¦å½æ°é½æ¯åæ­¥é»å¡çï¼ï¼ä½ä¼é æä¸å¿è¦ççº¿ç¨å¼éãä¸è¿å¯ä»¥éè¿ çº¿ç¨æ± æºå¶ æ¹åï¼çº¿ç¨æ± è¿å¯ä»¥è®©çº¿ç¨çåå»ºååæ¶ææ¬ç¸å¯¹è¾ä½ã\n\nå³ä½¿å¯ä»¥ç¨çº¿ç¨æ± ç¥å¾®ä¼åï¼ä½æ¯ä¼æ¶èå®è´µççº¿ç¨èµæºï¼å¹¶ä¸å¨ç¾ä¸çº§å¹¶ååºæ¯ä¸ä¹æä¸ä½ãå¦æå¹¶åè®¿é®éå¢å ä¼å¯¼è´çº¿ç¨æ°æ¥å§è¨èå¯è½ä¼å¯¼è´çº¿ç¨å æ æº¢åºãåå»ºæ°çº¿ç¨å¤±è´¥ç­é®é¢ï¼æç»å¯¼è´è¿ç¨å®æºæèåµæ­»ï¼ä¸è½å¯¹å¤æä¾æå¡ã\n\n\n# nio\n\n> nioï¼non-blocking ioï¼ å³éé»å¡ ioãæçæ¯ java 1.4 ä¸­å¼å¥ç java.nio åã\n\nä¸ºäºè§£å³ bio çæ§è½é®é¢ï¼ java 1.4 ä¸­å¼å¥ç java.nio åãnio ä¼åäºåå­å¤å¶ä»¥åé»å¡å¯¼è´çä¸¥éæ§è½é®é¢ã\n\njava.nio åæä¾äº channelãselectorãbuffer ç­æ°çæ½è±¡ï¼å¯ä»¥æå»ºå¤è·¯å¤ç¨çãåæ­¥éé»å¡ io ç¨åºï¼åæ¶æä¾äºæ´æ¥è¿æä½ç³»ç»åºå±çé«æ§è½æ°æ®æä½æ¹å¼ã\n\nnio æåªäºæ§è½ä¼åç¹å¢ï¼\n\n# ä½¿ç¨ç¼å²åºä¼åè¯»åæµ\n\nnio ä¸ä¼ ç» i/o ä¸åï¼å®æ¯åºäºåï¼blockï¼çï¼å®ä»¥åä¸ºåºæ¬åä½å¤çæ°æ®ãå¨ nio ä¸­ï¼æä¸ºéè¦çä¸¤ä¸ªç»ä»¶æ¯ç¼å²åºï¼bufferï¼åééï¼channelï¼ã\n\nbuffer æ¯ä¸åè¿ç»­çåå­åï¼æ¯ nio è¯»åæ°æ®çç¼å²ãbuffer å¯ä»¥å°æä»¶ä¸æ¬¡æ§è¯»å¥åå­åååç»­å¤çï¼èä¼ ç»çæ¹å¼æ¯è¾¹è¯»æä»¶è¾¹å¤çæ°æ®ãchannel è¡¨ç¤ºç¼å²æ°æ®çæºå¤´æèç®çå°ï¼å®ç¨äºè¯»åç¼å²æèåå¥æ°æ®ï¼æ¯è®¿é®ç¼å²çæ¥å£ã\n\n# ä½¿ç¨ directbuffer åå°åå­å¤å¶\n\nnio è¿æä¾äºä¸ä¸ªå¯ä»¥ç´æ¥è®¿é®ç©çåå­çç±» directbufferãæ®éç buffer åéçæ¯ jvm å åå­ï¼è directbuffer æ¯ç´æ¥åéç©çåå­ã\n\næ°æ®è¦è¾åºå°å¤é¨è®¾å¤ï¼å¿é¡»åä»ç¨æ·ç©ºé´å¤å¶å°åæ ¸ç©ºé´ï¼åå¤å¶å°è¾åºè®¾å¤ï¼è directbuffer åæ¯ç´æ¥å°æ­¥éª¤ç®åä¸ºä»åæ ¸ç©ºé´å¤å¶å°å¤é¨è®¾å¤ï¼åå°äºæ°æ®æ·è´ã\n\nè¿éæå±ä¸ç¹ï¼ç±äº directbuffer ç³è¯·çæ¯é jvm çç©çåå­ï¼æä»¥åå»ºåéæ¯çä»£ä»·å¾é«ãdirectbuffer ç³è¯·çåå­å¹¶ä¸æ¯ç´æ¥ç± jvm è´è´£åå¾åæ¶ï¼ä½å¨ directbuffer åè£ç±»è¢«åæ¶æ¶ï¼ä¼éè¿ java å¼ç¨æºå¶æ¥éæ¾è¯¥åå­åã\n\n# ä¼å i/oï¼é¿åé»å¡\n\nä¼ ç» i/o çæ°æ®è¯»åæ¯å¨ç¨æ·ç©ºé´ååæ ¸ç©ºé´æ¥åå¤å¶ï¼èåæ ¸ç©ºé´çæ°æ®æ¯éè¿æä½ç³»ç»å±é¢ç i/o æ¥å£ä»ç£çè¯»åæåå¥ã\n\nnio ç channel æèªå·±çå¤çå¨ï¼å¯ä»¥å®æåæ ¸ç©ºé´åç£çä¹é´ç i/o æä½ãå¨ nio ä¸­ï¼æä»¬è¯»åååå¥æ°æ®é½è¦éè¿ channelï¼ç±äº channel æ¯ååçï¼æä»¥è¯»ãåå¯ä»¥åæ¶è¿è¡ã\n\n\n# aio\n\n> aioï¼asynchronous ioï¼ å³å¼æ­¥éé»å¡ ioï¼æçæ¯ java 7 ä¸­ï¼å¯¹ nio æäºè¿ä¸æ­¥çæ¹è¿ï¼ä¹ç§°ä¸º nio2ï¼å¼å¥äºå¼æ­¥éé»å¡ io æ¹å¼ã\n\nå¨ java 7 ä¸­ï¼nio æäºè¿ä¸æ­¥çæ¹è¿ï¼ä¹å°±æ¯ nio 2ï¼å¼å¥äºå¼æ­¥éé»å¡ io æ¹å¼ï¼ä¹æå¾å¤äººå«å® aioï¼asynchronous ioï¼ãå¼æ­¥ io æä½åºäºäºä»¶ååè°æºå¶ï¼å¯ä»¥ç®åçè§£ä¸ºï¼åºç¨æä½ç´æ¥è¿åï¼èä¸ä¼é»å¡å¨é£éï¼å½åå°å¤çå®æï¼æä½ç³»ç»ä¼éç¥ç¸åºçº¿ç¨è¿è¡åç»­å·¥ä½ã\n\n\n# ä¼ ç» io æµ\n\næµä»æ¦å¿µä¸æ¥è¯´æ¯ä¸ä¸ªè¿ç»­çæ°æ®æµãå½ç¨åºéè¦è¯»æ°æ®çæ¶åå°±éè¦ä½¿ç¨è¾å¥æµè¯»åæ°æ®ï¼å½éè¦å¾å¤åæ°æ®çæ¶åå°±éè¦è¾åºæµã\n\nbio ä¸­æä½çæµä¸»è¦æä¸¤å¤§ç±»ï¼å­èæµåå­ç¬¦æµï¼ä¸¤ç±»æ ¹æ®æµçæ¹åé½å¯ä»¥åä¸ºè¾å¥æµåè¾åºæµã\n\n * å­èæµ\n   * è¾å¥å­èæµï¼inputstream\n   * è¾åºå­èæµï¼outputstream\n * å­ç¬¦æµ\n   * è¾å¥å­ç¬¦æµï¼reader\n   * è¾åºå­ç¬¦æµï¼writer\n\n\n\n\n# å­èæµ\n\nå­èæµä¸»è¦æä½å­èæ°æ®æäºè¿å¶å¯¹è±¡ã\n\nå­èæµæä¸¤ä¸ªæ ¸å¿æ½è±¡ç±»ï¼inputstream å outputstreamãææçå­èæµç±»é½ç»§æ¿èªè¿ä¸¤ä¸ªæ½è±¡ç±»ã\n\n\n\n# æä»¶å­èæµ\n\nfileoutputstream å fileinputstream æä¾äºè¯»åå­èå°æä»¶çè½åã\n\næä»¶æµæä½ä¸è¬æ­¥éª¤ï¼\n\n 1. ä½¿ç¨ file ç±»ç»å®ä¸ä¸ªæä»¶ã\n 2. æ file å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸ã\n 3. è¿è¡è¯»æåæä½ã\n 4. å³é­æµ\n\nfileoutputstream å fileinputstream ç¤ºä¾ï¼\n\npublic class filestreamdemo {\n\n    private static final string filepath = "temp.log";\n\n    public static void main(string[] args) throws exception {\n        write(filepath);\n        read(filepath);\n    }\n\n    public static void write(string filepath) throws ioexception {\n        // ç¬¬1æ­¥ãä½¿ç¨fileç±»æ¾å°ä¸ä¸ªæä»¶\n        file f = new file(filepath);\n\n        // ç¬¬2æ­¥ãéè¿å­ç±»å®ä¾åç¶ç±»å¯¹è±¡\n        outputstream out = new fileoutputstream(f);\n        // å®ä¾åæ¶ï¼é»è®¤ä¸ºè¦çåæä»¶åå®¹æ¹å¼ï¼å¦ææ·»å trueåæ°ï¼ååä¸ºå¯¹åæä»¶è¿½å åå®¹çæ¹å¼ã\n        // outputstream out = new fileoutputstream(f, true);\n\n        // ç¬¬3æ­¥ãè¿è¡åæä½\n        string str = "hello world\\n";\n        byte[] bytes = str.getbytes();\n        out.write(bytes);\n\n        // ç¬¬4æ­¥ãå³é­è¾åºæµ\n        out.close();\n    }\n\n    public static void read(string filepath) throws ioexception {\n        // ç¬¬1æ­¥ãä½¿ç¨fileç±»æ¾å°ä¸ä¸ªæä»¶\n        file f = new file(filepath);\n\n        // ç¬¬2æ­¥ãéè¿å­ç±»å®ä¾åç¶ç±»å¯¹è±¡\n        inputstream input = new fileinputstream(f);\n\n        // ç¬¬3æ­¥ãè¿è¡è¯»æä½\n        // æä¸ç§è¯»åæ¹å¼ï¼ä½ä¼å¶å·®å¼\n        byte[] bytes = new byte[(int) f.length()];\n        int len = input.read(bytes); // è¯»ååå®¹\n        system.out.println("è¯»å¥æ°æ®çé¿åº¦ï¼" + len);\n\n        // ç¬¬4æ­¥ãå³é­è¾å¥æµ\n        input.close();\n        system.out.println("åå®¹ä¸ºï¼\\n" + new string(bytes));\n    }\n\n}\n\n\n# åå­å­èæµ\n\nbytearrayinputstream å bytearrayoutputstream æ¯ç¨æ¥å®æåå­çè¾å¥åè¾åºåè½ã\n\nåå­æä½æµä¸è¬å¨çæä¸äºä¸´æ¶ä¿¡æ¯æ¶æä½¿ç¨ã å¦æä¸´æ¶ä¿¡æ¯ä¿å­å¨æä»¶ä¸­ï¼è¿éè¦å¨æææè¿åå é¤æä»¶ï¼è¿æ ·æ¯è¾éº»ç¦ã\n\nbytearrayinputstream å bytearrayoutputstream ç¤ºä¾ï¼\n\npublic class bytearraystreamdemo {\n\n    public static void main(string[] args) {\n        string str = "helloworld"; // å®ä¹ä¸ä¸ªå­ç¬¦ä¸²ï¼å¨é¨ç±å¤§åå­æ¯ç»æ\n        bytearrayinputstream bis = new bytearrayinputstream(str.getbytes());\n        bytearrayoutputstream bos = new bytearrayoutputstream();\n        // åå¤ä»åå­bytearrayinputstreamä¸­è¯»ååå®¹\n        int temp = 0;\n        while ((temp = bis.read()) != -1) {\n            char c = (char) temp; // è¯»åçæ°å­åä¸ºå­ç¬¦\n            bos.write(character.tolowercase(c)); // å°å­ç¬¦åä¸ºå°å\n        }\n        // ææçæ°æ®å°±å¨é¨é½å¨bytearrayoutputstreamä¸­\n        string newstr = bos.tostring(); // ååºåå®¹\n        try {\n            bis.close();\n            bos.close();\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        system.out.println(newstr);\n    }\n\n}\n\n\n# ç®¡éæµ\n\nç®¡éæµçä¸»è¦ä½ç¨æ¯å¯ä»¥è¿è¡ä¸¤ä¸ªçº¿ç¨é´çéä¿¡ã\n\nå¦æè¦è¿è¡ç®¡ééä¿¡ï¼åå¿é¡»æ pipedoutputstream è¿æ¥å¨ pipedinputstream ä¸ãä¸ºæ­¤ï¼pipedoutputstream ä¸­æä¾äº connect() æ¹æ³ã\n\npublic class pipedstreamdemo {\n\n    public static void main(string[] args) {\n        send s = new send();\n        receive r = new receive();\n        try {\n            s.getpos().connect(r.getpis()); // è¿æ¥ç®¡é\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        new thread(s).start(); // å¯å¨çº¿ç¨\n        new thread(r).start(); // å¯å¨çº¿ç¨\n    }\n\n    static class send implements runnable {\n\n        private pipedoutputstream pos = null;\n\n        send() {\n            pos = new pipedoutputstream(); // å®ä¾åè¾åºæµ\n        }\n\n        @override\n        public void run() {\n            string str = "hello world!!!";\n            try {\n                pos.write(str.getbytes());\n            } catch (ioexception e) {\n                e.printstacktrace();\n            }\n            try {\n                pos.close();\n            } catch (ioexception e) {\n                e.printstacktrace();\n            }\n        }\n\n        /**\n         * å¾å°æ­¤çº¿ç¨çç®¡éè¾åºæµ\n         */\n        pipedoutputstream getpos() {\n            return pos;\n        }\n\n    }\n\n    static class receive implements runnable {\n\n        private pipedinputstream pis = null;\n\n        receive() {\n            pis = new pipedinputstream();\n        }\n\n        @override\n        public void run() {\n            byte[] b = new byte[1024];\n            int len = 0;\n            try {\n                len = pis.read(b);\n            } catch (ioexception e) {\n                e.printstacktrace();\n            }\n            try {\n                pis.close();\n            } catch (ioexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("æ¥æ¶çåå®¹ä¸ºï¼" + new string(b, 0, len));\n        }\n\n        /**\n         * å¾å°æ­¤çº¿ç¨çç®¡éè¾å¥æµ\n         */\n        pipedinputstream getpis() {\n            return pis;\n        }\n\n    }\n\n}\n\n\n# å¯¹è±¡å­èæµ\n\nobjectinputstream å objectoutputstream æ¯å¯¹è±¡è¾å¥è¾åºæµï¼ä¸è¬ç¨äºå¯¹è±¡åºååã\n\nè¿éä¸å±å¼åè¿°ï¼æ³äºè§£è¯¦ç»åå®¹åç¤ºä¾å¯ä»¥åèï¼java åºåå\n\n# æ°æ®æä½æµ\n\næ°æ®æä½æµæä¾äºæ ¼å¼åè¯»å¥åè¾åºæ°æ®çæ¹æ³ï¼åå«ä¸º datainputstream å dataoutputstreamã\n\ndatainputstream å dataoutputstream æ ¼å¼åè¯»åæ°æ®ç¤ºä¾ï¼\n\npublic class datastreamdemo {\n\n    public static final string filepath = "temp.log";\n\n    public static void main(string[] args) throws ioexception {\n        write(filepath);\n        read(filepath);\n    }\n\n    private static void write(string filepath) throws ioexception {\n        // 1.ä½¿ç¨ file ç±»ç»å®ä¸ä¸ªæä»¶\n        file f = new file(filepath);\n\n        // 2.æ file å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        dataoutputstream dos = new dataoutputstream(new fileoutputstream(f));\n\n        // 3.è¿è¡è¯»æåæä½\n        string[] names = { "è¡¬è¡£", "æå¥", "å´å·¾" };\n        float[] prices = { 98.3f, 30.3f, 50.5f };\n        int[] nums = { 3, 2, 1 };\n        for (int i = 0; i < names.length; i++) {\n            dos.writechars(names[i]);\n            dos.writechar(\'\\t\');\n            dos.writefloat(prices[i]);\n            dos.writechar(\'\\t\');\n            dos.writeint(nums[i]);\n            dos.writechar(\'\\n\');\n        }\n\n        // 4.å³é­æµ\n        dos.close();\n    }\n\n    private static void read(string filepath) throws ioexception {\n        // 1.ä½¿ç¨ file ç±»ç»å®ä¸ä¸ªæä»¶\n        file f = new file(filepath);\n\n        // 2.æ file å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        datainputstream dis = new datainputstream(new fileinputstream(f));\n\n        // 3.è¿è¡è¯»æåæä½\n        string name = null; // æ¥æ¶åç§°\n        float price = 0.0f; // æ¥æ¶ä»·æ ¼\n        int num = 0; // æ¥æ¶æ°é\n        char[] temp = null; // æ¥æ¶åååç§°\n        int len = 0; // ä¿å­è¯»åæ°æ®çä¸ªæ°\n        char c = 0; // \'\\u0000\'\n        try {\n            while (true) {\n                temp = new char[200]; // å¼è¾ç©ºé´\n                len = 0;\n                while ((c = dis.readchar()) != \'\\t\') { // æ¥æ¶åå®¹\n                    temp[len] = c;\n                    len++; // è¯»åé¿åº¦å 1\n                }\n                name = new string(temp, 0, len); // å°å­ç¬¦æ°ç»åä¸ºstring\n                price = dis.readfloat(); // è¯»åä»·æ ¼\n                dis.readchar(); // è¯»å\\t\n                num = dis.readint(); // è¯»åint\n                dis.readchar(); // è¯»å\\n\n                system.out.printf("åç§°ï¼%sï¼ä»·æ ¼ï¼%5.2fï¼æ°éï¼%d\\n", name, price, num);\n            }\n        } catch (eofexception e) {\n            system.out.println("ç»æ");\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n\n        // 4.å³é­æµ\n        dis.close();\n    }\n\n}\n\n\n# åå¹¶æµ\n\nåå¹¶æµçä¸»è¦åè½æ¯å°å¤ä¸ª inputstream åå¹¶ä¸ºä¸ä¸ª inputstream æµãåå¹¶æµçåè½ç± sequenceinputstream å®æã\n\npublic class sequenceinputstreamdemo {\n\n    public static void main(string[] args) throws exception {\n\n        inputstream is1 = new fileinputstream("temp1.log");\n        inputstream is2 = new fileinputstream("temp2.log");\n        sequenceinputstream sis = new sequenceinputstream(is1, is2);\n\n        int temp = 0; // æ¥æ¶åå®¹\n        outputstream os = new fileoutputstream("temp3.logt");\n        while ((temp = sis.read()) != -1) { // å¾ªç¯è¾åº\n            os.write(temp); // ä¿å­åå®¹\n        }\n\n        sis.close(); // å³é­åå¹¶æµ\n        is1.close(); // å³é­è¾å¥æµ1\n        is2.close(); // å³é­è¾å¥æµ2\n        os.close(); // å³é­è¾åºæµ\n    }\n\n}\n\n\n\n# å­ç¬¦æµ\n\nå­ç¬¦æµä¸»è¦æä½å­ç¬¦ï¼ä¸ä¸ªå­ç¬¦ç­äºä¸¤ä¸ªå­èã\n\nå­ç¬¦æµæä¸¤ä¸ªæ ¸å¿ç±»ï¼reader ç±»å writer ãææçå­ç¬¦æµç±»é½ç»§æ¿èªè¿ä¸¤ä¸ªæ½è±¡ç±»ã\n\n\n\n# æä»¶å­ç¬¦æµ\n\næä»¶å­ç¬¦æµ filereader å filewriter å¯ä»¥åæä»¶è¯»åææ¬æ°æ®ã\n\nfilereader å filewriter è¯»åæä»¶ç¤ºä¾ï¼\n\npublic class filereadwritedemo {\n\n    private static final string filepath = "temp.log";\n\n    public static void main(string[] args) throws ioexception {\n        write(filepath);\n        system.out.println("åå®¹ä¸ºï¼" + new string(read(filepath)));\n    }\n\n    public static void write(string filepath) throws ioexception {\n        // 1.ä½¿ç¨ file ç±»ç»å®ä¸ä¸ªæä»¶\n        file f = new file(filepath);\n\n        // 2.æ file å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        writer out = new filewriter(f);\n        // writer out = new filewriter(f, true); // è¿½å åå®¹æ¹å¼\n\n        // 3.è¿è¡è¯»æåæä½\n        string str = "hello world!!!\\r\\n";\n        out.write(str);\n\n        // 4.å³é­æµ\n        // å­ç¬¦æµæä½æ¶ä½¿ç¨äºç¼å²åºï¼å¹¶å¨å³é­å­ç¬¦æµæ¶ä¼å¼ºå¶å°ç¼å²åºåå®¹è¾åº\n        // å¦æä¸å³é­æµï¼åç¼å²åºçåå®¹æ¯æ æ³è¾åºç\n        // å¦ææ³å¨ä¸å³é­æµæ¶ï¼å°ç¼å²åºåå®¹è¾åºï¼å¯ä»¥ä½¿ç¨ flush å¼ºå¶æ¸ç©ºç¼å²åº\n        out.flush();\n        out.close();\n    }\n\n    public static char[] read(string filepath) throws ioexception {\n        // 1.ä½¿ç¨ file ç±»ç»å®ä¸ä¸ªæä»¶\n        file f = new file(filepath);\n\n        // 2.æ file å¯¹è±¡ç»å®å°æµå¯¹è±¡ä¸\n        reader input = new filereader(f);\n\n        // 3.è¿è¡è¯»æåæä½\n        int temp = 0; // æ¥æ¶æ¯ä¸ä¸ªåå®¹\n        int len = 0; // è¯»ååå®¹\n        char[] c = new char[1024];\n        while ((temp = input.read()) != -1) {\n            // å¦æä¸æ¯-1å°±è¡¨ç¤ºè¿æåå®¹ï¼å¯ä»¥ç»§ç»­è¯»å\n            c[len] = (char) temp;\n            len++;\n        }\n        system.out.println("æä»¶å­ç¬¦æ°ä¸ºï¼" + len);\n\n        // 4.å³é­æµ\n        input.close();\n\n        return c;\n    }\n\n}\n\n\n# å­èæµè½¬æ¢å­ç¬¦æµ\n\næä»¬å¯ä»¥å¨ç¨åºä¸­éè¿ inputstream å reader ä»æ°æ®æºä¸­è¯»åæ°æ®ï¼ç¶åä¹å¯ä»¥å¨ç¨åºä¸­å°æ°æ®éè¿ outputstream å writer è¾åºå°ç®æ åªä»ä¸­\n\nä½¿ç¨ inputstreamreader å¯ä»¥å°è¾å¥å­èæµè½¬åä¸ºè¾å¥å­ç¬¦æµï¼ä½¿ç¨outputstreamwriterå¯ä»¥å°è¾åºå­èæµè½¬åä¸ºè¾åºå­ç¬¦æµã\n\noutputstreamwriter ç¤ºä¾ï¼\n\npublic class outputstreamwriterdemo {\n\n    public static void main(string[] args) throws ioexception {\n        file f = new file("temp.log");\n        writer out = new outputstreamwriter(new fileoutputstream(f));\n        out.write("hello world!!");\n        out.close();\n    }\n\n}\n\n\ninputstreamreader ç¤ºä¾ï¼\n\npublic class inputstreamreaderdemo {\n\n    public static void main(string[] args) throws ioexception {\n        file f = new file("temp.log");\n        reader reader = new inputstreamreader(new fileinputstream(f));\n        char[] c = new char[1024];\n        int len = reader.read(c);\n        reader.close();\n        system.out.println(new string(c, 0, len));\n    }\n\n}\n\n\n\n# å­èæµ vs. å­ç¬¦æµ\n\nç¸åç¹ï¼\n\nå­èæµåå­ç¬¦æµé½æ read()ãwrite()ãflush()ãclose() è¿æ ·çæ¹æ³ï¼è¿å³å®äºå®ä»¬çæä½æ¹å¼è¿ä¼¼ã\n\nä¸åç¹ï¼\n\n * æ°æ®ç±»å\n   * å­èæµçæ°æ®æ¯å­èï¼äºè¿å¶å¯¹è±¡ï¼ãä¸»è¦æ ¸å¿ç±»æ¯ inputstream ç±»å outputstream ç±»ã\n   * å­ç¬¦æµçæ°æ®æ¯å­ç¬¦ï¼ä¸ä¸ªå­ç¬¦ç­äºä¸¤ä¸ªå­èãä¸»è¦æ ¸å¿ç±»æ¯ reader ç±»å writer ç±»ã\n * ç¼å²åº\n   * å­èæµå¨æä½æ¶æ¬èº«ä¸ä¼ç¨å°ç¼å²åºï¼åå­ï¼ï¼æ¯æä»¶ç´æ¥æä½çã\n   * å­ç¬¦æµå¨æä½æ¶æ¯ä½¿ç¨äºç¼å²åºï¼éè¿ç¼å²åºåæä½æä»¶ã\n\néæ©ï¼\n\nææçæä»¶å¨ç¡¬çæä¼ è¾æ¶é½æ¯ä»¥å­èæ¹å¼ä¿å­çï¼ä¾å¦å¾çï¼å½±é³æä»¶ç­é½æ¯æå­èæ¹å¼å­å¨çãå­ç¬¦æµæ æ³è¯»åè¿äºæä»¶ã\n\næä»¥ï¼é¤äºçº¯ææ¬æ°æ®æä»¶ä½¿ç¨å­ç¬¦æµä»¥å¤ï¼å¶ä»æä»¶ç±»åé½åºè¯¥ä½¿ç¨å­èæµæ¹å¼ã\n\n\n# åèèµæ\n\n * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n * ãjava ä»å¥é¨å°ç²¾éã\n * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * bio,nio,aio æ»ç»\n * æ·±å¥æè§£ tomcat & jetty',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å®¹å¨ä¹ Stream",frontmatter:{title:"Java å®¹å¨ä¹ Stream",date:"2020-12-05T18:30:22.000Z",categories:["Java","JavaSE","å®¹å¨"],tags:["Java","JavaSE","å®¹å¨"],permalink:"/pages/529fad/"},regularPath:"/01.Java/01.JavaSE/03.%E5%AE%B9%E5%99%A8/06.Java%E5%AE%B9%E5%99%A8%E4%B9%8BStream.html",relativePath:"01.Java/01.JavaSE/03.å®¹å¨/06.Javaå®¹å¨ä¹Stream.md",key:"v-3295fff5",path:"/pages/529fad/",headers:[{level:2,title:"Stream ç®ä»",slug:"stream-ç®ä»",normalizedTitle:"stream ç®ä»",charIndex:22},{level:2,title:"Stream æä½åç±»",slug:"stream-æä½åç±»",normalizedTitle:"stream æä½åç±»",charIndex:215},{level:2,title:"Stream æºç å®ç°",slug:"stream-æºç å®ç°",normalizedTitle:"stream æºç å®ç°",charIndex:500},{level:2,title:"Stream å¹¶è¡å¤ç",slug:"stream-å¹¶è¡å¤ç",normalizedTitle:"stream å¹¶è¡å¤ç",charIndex:1186},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:1232}],headersStr:"Stream ç®ä» Stream æä½åç±» Stream æºç å®ç° Stream å¹¶è¡å¤ç 4. åèèµæ",content:"# Java å®¹å¨ä¹ Stream\n\n\n# Stream ç®ä»\n\nå¨ Java8 ä¸­ï¼Collection æ°å¢äºä¸¤ä¸ªæµæ¹æ³ï¼åå«æ¯ stream() å parallelStream()ã\n\nStream ç¸å½äºé«çº§çç Iteratorï¼ä»å¯ä»¥éè¿ Lambda è¡¨è¾¾å¼å¯¹éåè¿è¡åç§éå¸¸ä¾¿å©ãé«æçèåæä½ï¼Aggregate Operationï¼ï¼æèå¤§æ¹éæ°æ®æä½ (Bulk Data Operation)ã\n\n\n# Stream æä½åç±»\n\nå®æ¹å° Stream ä¸­çæä½åä¸ºä¸¤å¤§ç±»ï¼ä¸­é´æä½ï¼Intermediate operationsï¼åç»ç»æä½ï¼Terminal operationsï¼ã\n\nä¸­é´æä½åå¯ä»¥åä¸ºæ ç¶æï¼Statelessï¼ä¸æç¶æï¼Statefulï¼æä½ï¼åèæ¯æåç´ çå¤çä¸åä¹ååç´ çå½±åï¼åèæ¯æè¯¥æä½åªææ¿å°ææåç´ ä¹åæè½ç»§ç»­ä¸å»ã\n\nç»ç»æä½åå¯ä»¥åä¸ºç­è·¯ï¼Short-circuitingï¼ä¸éç­è·¯ï¼Unshort-circuitingï¼æä½ï¼åèæ¯æéå°æäºç¬¦åæ¡ä»¶çåç´ å°±å¯ä»¥å¾å°æç»ç»æï¼åèæ¯æå¿é¡»å¤çå®ææåç´ æè½å¾å°æç»ç»æã\n\n\n# Stream æºç å®ç°\n\n\n\nBaseStream å Stream æ¯æé¡¶å±çæ¥å£ç±»ãBaseStream ä¸»è¦å®ä¹äºæµçåºæ¬æ¥å£æ¹æ³ï¼ä¾å¦ï¼spliteratorãisParallel ç­ï¼Stream åå®ä¹äºä¸äºæµçå¸¸ç¨æä½æ¹æ³ï¼ä¾å¦ï¼mapãfilter ç­ã\n\nSink æ¥å£æ¯å®ä¹æ¯ä¸ª Stream æä½ä¹é´å³ç³»çåè®®ï¼ä»åå« begin()ãend()ãcancellationRequested()ãaccpt() åä¸ªæ¹æ³ãReferencePipeline æç»ä¼å°æ´ä¸ª Stream æµæä½ç»è£æä¸ä¸ªè°ç¨é¾ï¼èè¿æ¡è°ç¨é¾ä¸çåä¸ª Stream æä½çä¸ä¸å³ç³»å°±æ¯éè¿ Sink æ¥å£åè®®æ¥å®ä¹å®ç°çã\n\nReferencePipeline æ¯ä¸ä¸ªç»æç±»ï¼ä»éè¿å®ä¹åé¨ç±»ç»è£äºåç§æä½æµãä»å®ä¹äº HeadãStatelessOpãStatefulOp ä¸ä¸ªåé¨ç±»ï¼å®ç°äº BaseStream ä¸ Stream çæ¥å£æ¹æ³ãHead ç±»ä¸»è¦ç¨æ¥å®ä¹æ°æ®æºæä½ï¼å¨åæ¬¡è°ç¨ names.stream() æ¹æ³æ¶ï¼ä¼å è½½ Head å¯¹è±¡ï¼æ­¤æ¶ä¸ºå è½½æ°æ®æºæä½ï¼æ¥çå è½½çæ¯ä¸­é´æä½ï¼åå«ä¸ºæ ç¶æä¸­é´æä½ StatelessOp å¯¹è±¡åæç¶ææä½ StatefulOp å¯¹è±¡ï¼æ­¤æ¶ç Stage å¹¶æ²¡ææ§è¡ï¼èæ¯éè¿ AbstractPipeline çæäºä¸ä¸ªä¸­é´æä½ Stage é¾è¡¨ï¼å½æä»¬è°ç¨ç»ç»æä½æ¶ï¼ä¼çæä¸ä¸ªæç»ç Stageï¼éè¿è¿ä¸ª Stage è§¦åä¹åçä¸­é´æä½ï¼ä»æåä¸ä¸ª Stage å¼å§ï¼éå½äº§çä¸ä¸ª Sink é¾ã\n\n\n# Stream å¹¶è¡å¤ç\n\nStream å¤çæ°æ®çæ¹å¼æä¸¤ç§ï¼ä¸²è¡å¤çåå¹¶è¡å¤çã\n\n\n# 4. åèèµæ\n\n * Java ç¼ç¨ææ³ï¼ç¬¬ 4 çï¼",normalizedContent:"# java å®¹å¨ä¹ stream\n\n\n# stream ç®ä»\n\nå¨ java8 ä¸­ï¼collection æ°å¢äºä¸¤ä¸ªæµæ¹æ³ï¼åå«æ¯ stream() å parallelstream()ã\n\nstream ç¸å½äºé«çº§çç iteratorï¼ä»å¯ä»¥éè¿ lambda è¡¨è¾¾å¼å¯¹éåè¿è¡åç§éå¸¸ä¾¿å©ãé«æçèåæä½ï¼aggregate operationï¼ï¼æèå¤§æ¹éæ°æ®æä½ (bulk data operation)ã\n\n\n# stream æä½åç±»\n\nå®æ¹å° stream ä¸­çæä½åä¸ºä¸¤å¤§ç±»ï¼ä¸­é´æä½ï¼intermediate operationsï¼åç»ç»æä½ï¼terminal operationsï¼ã\n\nä¸­é´æä½åå¯ä»¥åä¸ºæ ç¶æï¼statelessï¼ä¸æç¶æï¼statefulï¼æä½ï¼åèæ¯æåç´ çå¤çä¸åä¹ååç´ çå½±åï¼åèæ¯æè¯¥æä½åªææ¿å°ææåç´ ä¹åæè½ç»§ç»­ä¸å»ã\n\nç»ç»æä½åå¯ä»¥åä¸ºç­è·¯ï¼short-circuitingï¼ä¸éç­è·¯ï¼unshort-circuitingï¼æä½ï¼åèæ¯æéå°æäºç¬¦åæ¡ä»¶çåç´ å°±å¯ä»¥å¾å°æç»ç»æï¼åèæ¯æå¿é¡»å¤çå®ææåç´ æè½å¾å°æç»ç»æã\n\n\n# stream æºç å®ç°\n\n\n\nbasestream å stream æ¯æé¡¶å±çæ¥å£ç±»ãbasestream ä¸»è¦å®ä¹äºæµçåºæ¬æ¥å£æ¹æ³ï¼ä¾å¦ï¼spliteratorãisparallel ç­ï¼stream åå®ä¹äºä¸äºæµçå¸¸ç¨æä½æ¹æ³ï¼ä¾å¦ï¼mapãfilter ç­ã\n\nsink æ¥å£æ¯å®ä¹æ¯ä¸ª stream æä½ä¹é´å³ç³»çåè®®ï¼ä»åå« begin()ãend()ãcancellationrequested()ãaccpt() åä¸ªæ¹æ³ãreferencepipeline æç»ä¼å°æ´ä¸ª stream æµæä½ç»è£æä¸ä¸ªè°ç¨é¾ï¼èè¿æ¡è°ç¨é¾ä¸çåä¸ª stream æä½çä¸ä¸å³ç³»å°±æ¯éè¿ sink æ¥å£åè®®æ¥å®ä¹å®ç°çã\n\nreferencepipeline æ¯ä¸ä¸ªç»æç±»ï¼ä»éè¿å®ä¹åé¨ç±»ç»è£äºåç§æä½æµãä»å®ä¹äº headãstatelessopãstatefulop ä¸ä¸ªåé¨ç±»ï¼å®ç°äº basestream ä¸ stream çæ¥å£æ¹æ³ãhead ç±»ä¸»è¦ç¨æ¥å®ä¹æ°æ®æºæä½ï¼å¨åæ¬¡è°ç¨ names.stream() æ¹æ³æ¶ï¼ä¼å è½½ head å¯¹è±¡ï¼æ­¤æ¶ä¸ºå è½½æ°æ®æºæä½ï¼æ¥çå è½½çæ¯ä¸­é´æä½ï¼åå«ä¸ºæ ç¶æä¸­é´æä½ statelessop å¯¹è±¡åæç¶ææä½ statefulop å¯¹è±¡ï¼æ­¤æ¶ç stage å¹¶æ²¡ææ§è¡ï¼èæ¯éè¿ abstractpipeline çæäºä¸ä¸ªä¸­é´æä½ stage é¾è¡¨ï¼å½æä»¬è°ç¨ç»ç»æä½æ¶ï¼ä¼çæä¸ä¸ªæç»ç stageï¼éè¿è¿ä¸ª stage è§¦åä¹åçä¸­é´æä½ï¼ä»æåä¸ä¸ª stage å¼å§ï¼éå½äº§çä¸ä¸ª sink é¾ã\n\n\n# stream å¹¶è¡å¤ç\n\nstream å¤çæ°æ®çæ¹å¼æä¸¤ç§ï¼ä¸²è¡å¤çåå¹¶è¡å¤çã\n\n\n# 4. åèèµæ\n\n * java ç¼ç¨ææ³ï¼ç¬¬ 4 çï¼",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å®¹å¨",frontmatter:{title:"Java å®¹å¨",date:"2020-06-04T13:51:01.000Z",categories:["Java","JavaSE","å®¹å¨"],tags:["Java","JavaSE","å®¹å¨"],permalink:"/pages/9eb49b/",hidden:!0},regularPath:"/01.Java/01.JavaSE/03.%E5%AE%B9%E5%99%A8/",relativePath:"01.Java/01.JavaSE/03.å®¹å¨/README.md",key:"v-777420e7",path:"/pages/9eb49b/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:48},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:424},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:886}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# Java å®¹å¨\n\n> Java å®¹å¨æ¶åè®¸å¤æ°æ®ç»æç¥è¯ç¹ï¼æä»¥è®¾ç«ä¸é¢è¿è¡æ»ç»ã\n\n\n# ð åå®¹\n\n * Java å®¹å¨ç®ä» - å³é®è¯ï¼Collectionãæ³åãIterableãIteratorãComparableãComparatorãCloneableãfail-fast\n * Java å®¹å¨ä¹ List - å³é®è¯ï¼ListãArrayListãLinkedList\n * Java å®¹å¨ä¹ Map - å³é®è¯ï¼MapãHashMapãTreeMapãLinkedHashMapãWeakHashMap\n * Java å®¹å¨ä¹ Set - å³é®è¯ï¼SetãHashSetãTreeSetãLinkedHashSetãEmumSet\n * Java å®¹å¨ä¹ Queue - å³é®è¯ï¼QueueãDequeãArrayDequeãLinkedListãPriorityQueue\n * Java å®¹å¨ä¹ Stream\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * Java åå¤§åè\n     * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n     * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n     * ãJava æ ¸å¿ææ¯ å· II é«çº§ç¹æ§ã\n     * ãEffective Javaã\n   * Java å¥é¨\n     * ãO'Reillyï¼Head First Javaã\n     * ãJava ä»å¥é¨å°ç²¾éã\n     * ãç¯ç Java è®²ä¹ã\n * æç¨ãç¤¾åº\n   * Runoob Java æç¨\n   * java-design-patterns\n   * Java\n   * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãJava æ§è½è°ä¼å®æã\n   * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ Java èææº\n   * ãJava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * CS-Notes\n   * JavaGuide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð  JAVACORE é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# java å®¹å¨\n\n> java å®¹å¨æ¶åè®¸å¤æ°æ®ç»æç¥è¯ç¹ï¼æä»¥è®¾ç«ä¸é¢è¿è¡æ»ç»ã\n\n\n# ð åå®¹\n\n * java å®¹å¨ç®ä» - å³é®è¯ï¼collectionãæ³åãiterableãiteratorãcomparableãcomparatorãcloneableãfail-fast\n * java å®¹å¨ä¹ list - å³é®è¯ï¼listãarraylistãlinkedlist\n * java å®¹å¨ä¹ map - å³é®è¯ï¼mapãhashmapãtreemapãlinkedhashmapãweakhashmap\n * java å®¹å¨ä¹ set - å³é®è¯ï¼setãhashsetãtreesetãlinkedhashsetãemumset\n * java å®¹å¨ä¹ queue - å³é®è¯ï¼queueãdequeãarraydequeãlinkedlistãpriorityqueue\n * java å®¹å¨ä¹ stream\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * java åå¤§åè\n     * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n     * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n     * ãjava æ ¸å¿ææ¯ å· ii é«çº§ç¹æ§ã\n     * ãeffective javaã\n   * java å¥é¨\n     * ão'reillyï¼head first javaã\n     * ãjava ä»å¥é¨å°ç²¾éã\n     * ãç¯ç java è®²ä¹ã\n * æç¨ãç¤¾åº\n   * runoob java æç¨\n   * java-design-patterns\n   * java\n   * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãjava æ§è½è°ä¼å®æã\n   * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ java èææº\n   * ãjava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * cs-notes\n   * javaguide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð  javacore é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java NIO",frontmatter:{title:"Java NIO",date:"2020-02-19T18:54:21.000Z",categories:["Java","JavaSE","IO"],tags:["Java","JavaSE","IO","NIO"],permalink:"/pages/6912a8/"},regularPath:"/01.Java/01.JavaSE/04.IO/02.JavaNIO.html",relativePath:"01.Java/01.JavaSE/04.IO/02.JavaNIO.md",key:"v-3240456a",path:"/pages/6912a8/",headers:[{level:2,title:"NIO ç®ä»",slug:"nio-ç®ä»",normalizedTitle:"nio ç®ä»",charIndex:55},{level:3,title:"NIO å BIO çåºå«",slug:"nio-å-bio-çåºå«",normalizedTitle:"nio å bio çåºå«",charIndex:461},{level:4,title:"Non-blocking IO(éé»å¡)",slug:"non-blocking-io-éé»å¡",normalizedTitle:"non-blocking io(éé»å¡)",charIndex:478},{level:4,title:"Buffer(ç¼å²åº)",slug:"buffer-ç¼å²åº",normalizedTitle:"buffer(ç¼å²åº)",charIndex:765},{level:4,title:"Channel (éé)",slug:"channel-éé",normalizedTitle:"channel (éé)",charIndex:1238},{level:4,title:"Selector (éæ©å¨)",slug:"selector-éæ©å¨",normalizedTitle:"selector (éæ©å¨)",charIndex:1346},{level:3,title:"NIO çåºæ¬æµç¨",slug:"nio-çåºæ¬æµç¨",normalizedTitle:"nio çåºæ¬æµç¨",charIndex:1463},{level:3,title:"NIO æ ¸å¿ç»ä»¶",slug:"nio-æ ¸å¿ç»ä»¶",normalizedTitle:"nio æ ¸å¿ç»ä»¶",charIndex:1589},{level:2,title:"Channel(éé)",slug:"channel-éé-2",normalizedTitle:"channel(éé)",charIndex:1620},{level:2,title:"Buffer(ç¼å²åº)",slug:"buffer-ç¼å²åº-2",normalizedTitle:"buffer(ç¼å²åº)",charIndex:765},{level:3,title:"ç¼å²åºç¶æåé",slug:"ç¼å²åºç¶æåé",normalizedTitle:"ç¼å²åºç¶æåé",charIndex:2682},{level:3,title:"æä»¶ NIO ç¤ºä¾",slug:"æä»¶-nio-ç¤ºä¾",normalizedTitle:"æä»¶ nio ç¤ºä¾",charIndex:3158},{level:3,title:"DirectBuffer",slug:"directbuffer",normalizedTitle:"directbuffer",charIndex:3969},{level:2,title:"Selector(éæ©å¨)",slug:"selector-éæ©å¨-2",normalizedTitle:"selector(éæ©å¨)",charIndex:1650},{level:3,title:"åå»ºéæ©å¨",slug:"åå»ºéæ©å¨",normalizedTitle:"åå»ºéæ©å¨",charIndex:4924},{level:3,title:"å°ééæ³¨åå°éæ©å¨ä¸",slug:"å°ééæ³¨åå°éæ©å¨ä¸",normalizedTitle:"å°ééæ³¨åå°éæ©å¨ä¸",charIndex:4973},{level:3,title:"çå¬äºä»¶",slug:"çå¬äºä»¶",normalizedTitle:"çå¬äºä»¶",charIndex:4537},{level:3,title:"è·åå°è¾¾çäºä»¶",slug:"è·åå°è¾¾çäºä»¶",normalizedTitle:"è·åå°è¾¾çäºä»¶",charIndex:5760},{level:3,title:"äºä»¶å¾ªç¯",slug:"äºä»¶å¾ªç¯",normalizedTitle:"äºä»¶å¾ªç¯",charIndex:6082},{level:3,title:"å¥æ¥å­ NIO ç¤ºä¾",slug:"å¥æ¥å­-nio-ç¤ºä¾",normalizedTitle:"å¥æ¥å­ nio ç¤ºä¾",charIndex:6567},{level:3,title:"åå­æ å°æä»¶",slug:"åå­æ å°æä»¶",normalizedTitle:"åå­æ å°æä»¶",charIndex:9083},{level:2,title:"NIO vs. BIO",slug:"nio-vs-bio",normalizedTitle:"nio vs. bio",charIndex:9421},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:9715}],headersStr:"NIO ç®ä» NIO å BIO çåºå« Non-blocking IO(éé»å¡) Buffer(ç¼å²åº) Channel (éé) Selector (éæ©å¨) NIO çåºæ¬æµç¨ NIO æ ¸å¿ç»ä»¶ Channel(éé) Buffer(ç¼å²åº) ç¼å²åºç¶æåé æä»¶ NIO ç¤ºä¾ DirectBuffer Selector(éæ©å¨) åå»ºéæ©å¨ å°ééæ³¨åå°éæ©å¨ä¸ çå¬äºä»¶ è·åå°è¾¾çäºä»¶ äºä»¶å¾ªç¯ å¥æ¥å­ NIO ç¤ºä¾ åå­æ å°æä»¶ NIO vs. BIO åèèµæ",content:'# Java NIO\n\n> å³é®è¯ï¼ChannelãBufferãSelectorãéé»å¡ãå¤è·¯å¤ç¨\n\n\n# NIO ç®ä»\n\nNIO æ¯ä¸ç§åæ­¥éé»å¡ç I/O æ¨¡åï¼å¨ Java 1.4 ä¸­å¼å¥äº NIO æ¡æ¶ï¼å¯¹åº java.nio åï¼æä¾äº Channel ãSelectorãBuffer ç­æ½è±¡ã\n\nNIO ä¸­ç N å¯ä»¥çè§£ä¸º Non-blockingï¼ä¸åçº¯æ¯ Newãå®æ¯æé¢åç¼å²çï¼åºäºééç I/O æä½æ¹æ³ã NIO æä¾äºä¸ä¼ ç» BIO æ¨¡åä¸­ç Socket å ServerSocket ç¸å¯¹åºç SocketChannel å ServerSocketChannel ä¸¤ç§ä¸åçå¥æ¥å­ééå®ç°,ä¸¤ç§ééé½æ¯æé»å¡åéé»å¡ä¸¤ç§æ¨¡å¼ãé»å¡æ¨¡å¼ä½¿ç¨å°±åä¼ ç»ä¸­çæ¯æä¸æ ·ï¼æ¯è¾ç®åï¼ä½æ¯æ§è½åå¯é æ§é½ä¸å¥½ï¼éé»å¡æ¨¡å¼æ­£å¥½ä¸ä¹ç¸åãå¯¹äºä½è´è½½ãä½å¹¶åçåºç¨ç¨åºï¼å¯ä»¥ä½¿ç¨åæ­¥é»å¡ I/O æ¥æåå¼åéçåæ´å¥½çç»´æ¤æ§ï¼å¯¹äºé«è´è½½ãé«å¹¶åçï¼ç½ç»ï¼åºç¨ï¼åºä½¿ç¨ NIO çéé»å¡æ¨¡å¼æ¥å¼åã\n\n\n# NIO å BIO çåºå«\n\n# Non-blocking IO(éé»å¡)\n\nBIO æ¯é»å¡çï¼NIO æ¯éé»å¡çã\n\nBIO çåç§æµæ¯é»å¡çãè¿æå³çï¼å½ä¸ä¸ªçº¿ç¨è°ç¨ read() æ write() æ¶ï¼è¯¥çº¿ç¨è¢«é»å¡ï¼ç´å°æä¸äºæ°æ®è¢«è¯»åï¼ææ°æ®å®å¨åå¥ãå¨æ­¤æé´ï¼è¯¥çº¿ç¨ä¸è½åå¹²å¶ä»ä»»ä½äºã\n\nNIO ä½¿æä»¬å¯ä»¥è¿è¡éé»å¡ IO æä½ãæ¯å¦è¯´ï¼åçº¿ç¨ä¸­ä»ééè¯»åæ°æ®å° bufferï¼åæ¶å¯ä»¥ç»§ç»­åå«çäºæï¼å½æ°æ®è¯»åå° buffer ä¸­åï¼çº¿ç¨åç»§ç»­å¤çæ°æ®ãåæ°æ®ä¹æ¯ä¸æ ·çãå¦å¤ï¼éé»å¡åä¹æ¯å¦æ­¤ãä¸ä¸ªçº¿ç¨è¯·æ±åå¥ä¸äºæ°æ®å°æééï¼ä½ä¸éè¦ç­å¾å®å®å¨åå¥ï¼è¿ä¸ªçº¿ç¨åæ¶å¯ä»¥å»åå«çäºæã\n\n# Buffer(ç¼å²åº)\n\nBIO é¢åæµ(Stream oriented)ï¼è NIO é¢åç¼å²åº(Buffer oriented)ã\n\nBuffer æ¯ä¸ä¸ªå¯¹è±¡ï¼å®åå«ä¸äºè¦åå¥æèè¦è¯»åºçæ°æ®ãå¨ NIO ç±»åºä¸­å å¥ Buffer å¯¹è±¡ï¼ä½ç°äº NIO ä¸ BIO çä¸ä¸ªéè¦åºå«ãå¨é¢åæµç BIO ä¸­å¯ä»¥å°æ°æ®ç´æ¥åå¥æèå°æ°æ®ç´æ¥è¯»å° Stream å¯¹è±¡ä¸­ãè½ç¶ Stream ä¸­ä¹æ Buffer å¼å¤´çæ©å±ç±»ï¼ä½åªæ¯æµçåè£ç±»ï¼è¿æ¯ä»æµè¯»å°ç¼å²åºï¼è NIO å´æ¯ç´æ¥è¯»å° Buffer ä¸­è¿è¡æä½ã\n\nå¨ NIO åä¸­ï¼æææ°æ®é½æ¯ç¨ç¼å²åºå¤ççãå¨è¯»åæ°æ®æ¶ï¼å®æ¯ç´æ¥è¯»ç¼å²åºä¸­çæ°æ®; å¨åå¥æ°æ®æ¶ï¼åå¥å°ç¼å²åºä¸­ãä»»ä½æ¶åè®¿é® NIO ä¸­çæ°æ®ï¼é½æ¯éè¿ç¼å²åºè¿è¡æä½ã\n\næå¸¸ç¨çç¼å²åºæ¯ ByteBuffer,ä¸ä¸ª ByteBuffer æä¾äºä¸ç»åè½ç¨äºæä½ byte æ°ç»ãé¤äº ByteBuffer,è¿æå¶ä»çä¸äºç¼å²åºï¼äºå®ä¸ï¼æ¯ä¸ç§ Java åºæ¬ç±»åï¼é¤äº Boolean ç±»åï¼é½å¯¹åºæä¸ç§ç¼å²åºã\n\n# Channel (éé)\n\nNIO éè¿ Channelï¼ééï¼ è¿è¡è¯»åã\n\nééæ¯ååçï¼å¯è¯»ä¹å¯åï¼èæµçè¯»åæ¯ååçãæ è®ºè¯»åï¼ééåªè½å Buffer äº¤äºãå ä¸º Bufferï¼ééå¯ä»¥å¼æ­¥å°è¯»åã\n\n# Selector (éæ©å¨)\n\nNIO æéæ©å¨ï¼è IO æ²¡æã\n\néæ©å¨ç¨äºä½¿ç¨åä¸ªçº¿ç¨å¤çå¤ä¸ªééãå æ­¤ï¼å®éè¦è¾å°ççº¿ç¨æ¥å¤çè¿äºééãçº¿ç¨ä¹é´çåæ¢å¯¹äºæä½ç³»ç»æ¥è¯´æ¯æè´µçã å æ­¤ï¼ä¸ºäºæé«ç³»ç»æçéæ©å¨æ¯æç¨çã\n\n\n# NIO çåºæ¬æµç¨\n\néå¸¸æ¥è¯´ NIO ä¸­çææ IO é½æ¯ä» Channelï¼ééï¼ å¼å§çã\n\n * ä»ééè¿è¡æ°æ®è¯»å ï¼åå»ºä¸ä¸ªç¼å²åºï¼ç¶åè¯·æ±ééè¯»åæ°æ®ã\n * ä»ééè¿è¡æ°æ®åå¥ ï¼åå»ºä¸ä¸ªç¼å²åºï¼å¡«åæ°æ®ï¼å¹¶è¦æ±ééåå¥æ°æ®ã\n\n\n# NIO æ ¸å¿ç»ä»¶\n\nNIO åå«ä¸é¢å ä¸ªæ ¸å¿çç»ä»¶ï¼\n\n * Channel(éé)\n * Buffer(ç¼å²åº)\n * Selector(éæ©å¨)\n\n\n# Channel(éé)\n\nééï¼Channelï¼æ¯å¯¹ BIO ä¸­çæµçæ¨¡æï¼å¯ä»¥éè¿å®è¯»åæ°æ®ã\n\nChannelï¼ç±»ä¼¼å¨ Linux ä¹ç±»æä½ç³»ç»ä¸çå°çæä»¶æè¿°ç¬¦ï¼æ¯ NIO ä¸­è¢«ç¨æ¥æ¯ææ¹éå¼ IO æä½çä¸ç§æ½è±¡ã\n\nFile æè Socketï¼éå¸¸è¢«è®¤ä¸ºæ¯æ¯è¾é«å±æ¬¡çæ½è±¡ï¼è Channel åæ¯æ´å æä½ç³»ç»åºå±çä¸ç§æ½è±¡ï¼è¿ä¹ä½¿å¾ NIO å¾ä»¥ååå©ç¨ç°ä»£æä½ç³»ç»åºå±æºå¶ï¼è·å¾ç¹å®åºæ¯çæ§è½ä¼åï¼ä¾å¦ï¼DMAï¼Direct Memory Accessï¼ç­ãä¸åå±æ¬¡çæ½è±¡æ¯ç¸äºå³èçï¼æä»¬å¯ä»¥éè¿ Socket è·å Channelï¼åä¹äº¦ç¶ã\n\nééä¸æµçä¸åä¹å¤å¨äºï¼\n\n * æµæ¯ååç - ä¸ä¸ªæµåªè½åçº¯çè´è´£è¯»æåã\n * ééæ¯ååç - ä¸ä¸ªééå¯ä»¥åæ¶ç¨äºè¯»åã\n\nééåæ¬ä»¥ä¸ç±»åï¼\n\n * FileChannelï¼ä»æä»¶ä¸­è¯»åæ°æ®ï¼\n * DatagramChannelï¼éè¿ UDP è¯»åç½ç»ä¸­æ°æ®ï¼\n * SocketChannelï¼éè¿ TCP è¯»åç½ç»ä¸­æ°æ®ï¼\n * ServerSocketChannelï¼å¯ä»¥çå¬æ°è¿æ¥ç TCP è¿æ¥ï¼å¯¹æ¯ä¸ä¸ªæ°è¿æ¥çè¿æ¥é½ä¼åå»ºä¸ä¸ª SocketChannelã\n\n\n# Buffer(ç¼å²åº)\n\nNIO ä¸ä¼ ç» I/O ä¸åï¼å®æ¯åºäºåï¼Blockï¼çï¼å®ä»¥åä¸ºåºæ¬åä½å¤çæ°æ®ãBuffer æ¯ä¸åè¿ç»­çåå­åï¼æ¯ NIO è¯»åæ°æ®çç¼å²ãBuffer å¯ä»¥å°æä»¶ä¸æ¬¡æ§è¯»å¥åå­åååç»­å¤çï¼èä¼ ç»çæ¹å¼æ¯è¾¹è¯»æä»¶è¾¹å¤çæ°æ®ã\n\nå Channel è¯»åçæ°æ®é½å¿é¡»åç½®äºç¼å²åºä¸­ãä¹å°±æ¯è¯´ï¼ä¸ä¼ç´æ¥å¯¹ééè¿è¡è¯»åæ°æ®ï¼èæ¯è¦åç»è¿ç¼å²åºãç¼å²åºå®è´¨ä¸æ¯ä¸ä¸ªæ°ç»ï¼ä½å®ä¸ä»ä»æ¯ä¸ä¸ªæ°ç»ãç¼å²åºæä¾äºå¯¹æ°æ®çç»æåè®¿é®ï¼èä¸è¿å¯ä»¥è·è¸ªç³»ç»çè¯»/åè¿ç¨ã\n\nBIO å NIO å·²ç»å¾å¥½å°éæäºï¼java.io.* å·²ç»ä»¥ NIO ä¸ºåºç¡éæ°å®ç°äºï¼æä»¥ç°å¨å®å¯ä»¥å©ç¨ NIO çä¸äºç¹æ§ãä¾å¦ï¼java.io.* åä¸­çä¸äºç±»åå«ä»¥åçå½¢å¼è¯»åæ°æ®çæ¹æ³ï¼è¿ä½¿å¾å³ä½¿å¨é¢åæµçç³»ç»ä¸­ï¼å¤çéåº¦ä¹ä¼æ´å¿«ã\n\nç¼å²åºåæ¬ä»¥ä¸ç±»åï¼\n\n * ByteBuffer\n * CharBuffer\n * ShortBuffer\n * IntBuffer\n * LongBuffer\n * FloatBuffer\n * DoubleBuffer\n\n\n# ç¼å²åºç¶æåé\n\n * capacityï¼æå¤§å®¹éï¼\n * positionï¼å½åå·²ç»è¯»åçå­èæ°ï¼\n * limitï¼è¿å¯ä»¥è¯»åçå­èæ°ã\n * markï¼è®°å½ä¸ä¸æ¬¡ postion çä½ç½®ï¼é»è®¤æ¯ 0ï¼ç®æ¯ä¸ä¸ªä¾¿å©æ§çèèï¼å¾å¾ä¸æ¯å¿é¡» çã\n\nç¼å²åºç¶æåéçæ¹åè¿ç¨ä¸¾ä¾ï¼\n\n 1. æ°å»ºä¸ä¸ªå¤§å°ä¸º 8 ä¸ªå­èçç¼å²åºï¼æ­¤æ¶ position ä¸º 0ï¼è limit = capacity = 8ãcapacity åéä¸ä¼æ¹åï¼ä¸é¢çè®¨è®ºä¼å¿½ç¥å®ã\n 2. ä»è¾å¥ééä¸­è¯»å 5 ä¸ªå­èæ°æ®åå¥ç¼å²åºä¸­ï¼æ­¤æ¶ position ç§»å¨è®¾ç½®ä¸º 5ï¼limit ä¿æä¸åã\n 3. å¨å°ç¼å²åºçæ°æ®åå°è¾åºééä¹åï¼éè¦åè°ç¨ flip() æ¹æ³ï¼è¿ä¸ªæ¹æ³å° limit è®¾ç½®ä¸ºå½å positionï¼å¹¶å° position è®¾ç½®ä¸º 0ã\n 4. ä»ç¼å²åºä¸­å 4 ä¸ªå­èå°è¾åºç¼å²ä¸­ï¼æ­¤æ¶ position è®¾ä¸º 4ã\n 5. æåéè¦è°ç¨ clear() æ¹æ³æ¥æ¸ç©ºç¼å²åºï¼æ­¤æ¶ position å limit é½è¢«è®¾ç½®ä¸ºæåä½ç½®ã\n\n\n# æä»¶ NIO ç¤ºä¾\n\nä»¥ä¸å±ç¤ºäºä½¿ç¨ NIO å¿«éå¤å¶æä»¶çå®ä¾ï¼\n\npublic static void fastCopy(String src, String dist) throws IOException {\n\n    /* è·å¾æºæä»¶çè¾å¥å­èæµ */\n    FileInputStream fin = new FileInputStream(src);\n\n    /* è·åè¾å¥å­èæµçæä»¶éé */\n    FileChannel fcin = fin.getChannel();\n\n    /* è·åç®æ æä»¶çè¾åºå­èæµ */\n    FileOutputStream fout = new FileOutputStream(dist);\n\n    /* è·åè¾åºå­èæµçéé */\n    FileChannel fcout = fout.getChannel();\n\n    /* ä¸ºç¼å²åºåé 1024 ä¸ªå­è */\n    ByteBuffer buffer = ByteBuffer.allocateDirect(1024);\n\n    while (true) {\n\n        /* ä»è¾å¥ééä¸­è¯»åæ°æ®å°ç¼å²åºä¸­ */\n        int r = fcin.read(buffer);\n\n        /* read() è¿å -1 è¡¨ç¤º EOF */\n        if (r == -1) {\n            break;\n        }\n\n        /* åæ¢è¯»å */\n        buffer.flip();\n\n        /* æç¼å²åºçåå®¹åå¥è¾åºæä»¶ä¸­ */\n        fcout.write(buffer);\n\n        /* æ¸ç©ºç¼å²åº */\n        buffer.clear();\n    }\n}\n\n\n\n# DirectBuffer\n\nNIO è¿æä¾äºä¸ä¸ªå¯ä»¥ç´æ¥è®¿é®ç©çåå­çç±» DirectBufferãæ®éç Buffer åéçæ¯ JVM å åå­ï¼è DirectBuffer æ¯ç´æ¥åéç©çåå­ã\n\næ°æ®è¦è¾åºå°å¤é¨è®¾å¤ï¼å¿é¡»åä»ç¨æ·ç©ºé´å¤å¶å°åæ ¸ç©ºé´ï¼åå¤å¶å°è¾åºè®¾å¤ï¼è DirectBuffer åæ¯ç´æ¥å°æ­¥éª¤ç®åä¸ºä»åæ ¸ç©ºé´å¤å¶å°å¤é¨è®¾å¤ï¼åå°äºæ°æ®æ·è´ã\n\nè¿éæå±ä¸ç¹ï¼ç±äº DirectBuffer ç³è¯·çæ¯é JVM çç©çåå­ï¼æä»¥åå»ºåéæ¯çä»£ä»·å¾é«ãDirectBuffer ç³è¯·çåå­å¹¶ä¸æ¯ç´æ¥ç± JVM è´è´£åå¾åæ¶ï¼ä½å¨ DirectBuffer åè£ç±»è¢«åæ¶æ¶ï¼ä¼éè¿ Java å¼ç¨æºå¶æ¥éæ¾è¯¥åå­åã\n\n\n# Selector(éæ©å¨)\n\nNIO å¸¸å¸¸è¢«å«åéé»å¡ IOï¼ä¸»è¦æ¯å ä¸º NIO å¨ç½ç»éä¿¡ä¸­çéé»å¡ç¹æ§è¢«å¹¿æ³ä½¿ç¨ã\n\nSelector æ¯ Java NIO ç¼ç¨çåºç¡ãç¨äºæ£æ¥ä¸ä¸ªæå¤ä¸ª NIO Channel çç¶ææ¯å¦å¤äºå¯è¯»ãå¯åã\n\nNIO å®ç°äº IO å¤è·¯å¤ç¨ä¸­ç Reactor æ¨¡åï¼\n\n * ä¸ä¸ªçº¿ç¨ï¼Threadï¼ä½¿ç¨ä¸ä¸ªéæ©å¨ Selector éè¿è½®è¯¢çæ¹å¼å»çå¬å¤ä¸ªéé Channel ä¸çäºä»¶ï¼accpetãreadï¼ï¼å¦ææä¸ª Channel ä¸é¢åççå¬äºä»¶ï¼è¿ä¸ª Channel å°±å¤äºå°±ç»ªç¶æï¼ç¶åè¿è¡ I/O æä½ã\n\n * éè¿éç½®çå¬çéé Channel ä¸ºéé»å¡ï¼é£ä¹å½ Channel ä¸ç IO äºä»¶è¿æªå°è¾¾æ¶ï¼å°±ä¸ä¼è¿å¥é»å¡ç¶æä¸ç´ç­å¾ï¼èæ¯ç»§ç»­è½®è¯¢å¶å® Channelï¼æ¾å° IO äºä»¶å·²ç»å°è¾¾ç Channel æ§è¡ã\n\n * å ä¸ºåå»ºååæ¢çº¿ç¨çå¼éå¾å¤§ï¼å æ­¤ä½¿ç¨ä¸ä¸ªçº¿ç¨æ¥å¤çå¤ä¸ªäºä»¶èä¸æ¯ä¸ä¸ªçº¿ç¨å¤çä¸ä¸ªäºä»¶å·ææ´å¥½çæ§è½ã\n\néè¦æ³¨æçæ¯ï¼åªæ SocketChannel æè½éç½®ä¸ºéé»å¡ï¼è FileChannel ä¸è½ï¼å ä¸º FileChannel éç½®éé»å¡ä¹æ²¡ææä¹ã\n\n> ç®åæä½ç³»ç»ç I/O å¤è·¯å¤ç¨æºå¶é½ä½¿ç¨äº epollï¼ç¸æ¯ä¼ ç»ç select æºå¶ï¼epoll æ²¡ææå¤§è¿æ¥å¥æ 1024 çéå¶ãæä»¥ Selector å¨çè®ºä¸å¯ä»¥è½®è¯¢æåä¸ä¸çå®¢æ·ç«¯ã\n\n\n# åå»ºéæ©å¨\n\nSelector selector = Selector.open();\n\n\n\n# å°ééæ³¨åå°éæ©å¨ä¸\n\nServerSocketChannel ssChannel = ServerSocketChannel.open();\nssChannel.configureBlocking(false);\nssChannel.register(selector, SelectionKey.OP_ACCEPT);\n\n\nééå¿é¡»éç½®ä¸ºéé»å¡æ¨¡å¼ï¼å¦åä½¿ç¨éæ©å¨å°±æ²¡æä»»ä½æä¹äºï¼å ä¸ºå¦æééå¨æä¸ªäºä»¶ä¸è¢«é»å¡ï¼é£ä¹æå¡å¨å°±ä¸è½ååºå¶å®äºä»¶ï¼å¿é¡»ç­å¾è¿ä¸ªäºä»¶å¤çå®æ¯æè½å»å¤çå¶å®äºä»¶ï¼æ¾ç¶è¿åéæ©å¨çä½ç¨èéèé©°ã\n\nå¨å°ééæ³¨åå°éæ©å¨ä¸æ¶ï¼è¿éè¦æå®è¦æ³¨åçå·ä½äºä»¶ï¼ä¸»è¦æä»¥ä¸å ç±»ï¼\n\n * SelectionKey.OP_CONNECT\n * SelectionKey.OP_ACCEPT\n * SelectionKey.OP_READ\n * SelectionKey.OP_WRITE\n\nå®ä»¬å¨ SelectionKey çå®ä¹å¦ä¸ï¼\n\npublic static final int OP_READ = 1 << 0;\npublic static final int OP_WRITE = 1 << 2;\npublic static final int OP_CONNECT = 1 << 3;\npublic static final int OP_ACCEPT = 1 << 4;\n\n\nå¯ä»¥çåºæ¯ä¸ªäºä»¶å¯ä»¥è¢«å½æä¸ä¸ªä½åï¼ä»èç»æäºä»¶éæ´æ°ãä¾å¦ï¼\n\nint interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;\n\n\n\n# çå¬äºä»¶\n\nint num = selector.select();\n\n\nä½¿ç¨ select() æ¥çå¬å°è¾¾çäºä»¶ï¼å®ä¼ä¸ç´é»å¡ç´å°æè³å°ä¸ä¸ªäºä»¶å°è¾¾ã\n\n\n# è·åå°è¾¾çäºä»¶\n\nSet<SelectionKey> keys = selector.selectedKeys();\nIterator<SelectionKey> keyIterator = keys.iterator();\nwhile (keyIterator.hasNext()) {\n    SelectionKey key = keyIterator.next();\n    if (key.isAcceptable()) {\n        // ...\n    } else if (key.isReadable()) {\n        // ...\n    }\n    keyIterator.remove();\n}\n\n\n\n# äºä»¶å¾ªç¯\n\nå ä¸ºä¸æ¬¡ select() è°ç¨ä¸è½å¤çå®ææçäºä»¶ï¼å¹¶ä¸æå¡å¨ç«¯æå¯è½éè¦ä¸ç´çå¬äºä»¶ï¼å æ­¤æå¡å¨ç«¯å¤çäºä»¶çä»£ç ä¸è¬ä¼æ¾å¨ä¸ä¸ªæ­»å¾ªç¯åã\n\nwhile (true) {\n    int num = selector.select();\n    Set<SelectionKey> keys = selector.selectedKeys();\n    Iterator<SelectionKey> keyIterator = keys.iterator();\n    while (keyIterator.hasNext()) {\n        SelectionKey key = keyIterator.next();\n        if (key.isAcceptable()) {\n            // ...\n        } else if (key.isReadable()) {\n            // ...\n        }\n        keyIterator.remove();\n    }\n}\n\n\n\n# å¥æ¥å­ NIO ç¤ºä¾\n\npublic class NIOServer {\n\n    public static void main(String[] args) throws IOException {\n\n        Selector selector = Selector.open();\n\n        ServerSocketChannel ssChannel = ServerSocketChannel.open();\n        ssChannel.configureBlocking(false);\n        ssChannel.register(selector, SelectionKey.OP_ACCEPT);\n\n        ServerSocket serverSocket = ssChannel.socket();\n        InetSocketAddress address = new InetSocketAddress("127.0.0.1", 8888);\n        serverSocket.bind(address);\n\n        while (true) {\n\n            selector.select();\n            Set<SelectionKey> keys = selector.selectedKeys();\n            Iterator<SelectionKey> keyIterator = keys.iterator();\n\n            while (keyIterator.hasNext()) {\n\n                SelectionKey key = keyIterator.next();\n\n                if (key.isAcceptable()) {\n\n                    ServerSocketChannel ssChannel1 = (ServerSocketChannel) key.channel();\n\n                    // æå¡å¨ä¼ä¸ºæ¯ä¸ªæ°è¿æ¥åå»ºä¸ä¸ª SocketChannel\n                    SocketChannel sChannel = ssChannel1.accept();\n                    sChannel.configureBlocking(false);\n\n                    // è¿ä¸ªæ°è¿æ¥ä¸»è¦ç¨äºä»å®¢æ·ç«¯è¯»åæ°æ®\n                    sChannel.register(selector, SelectionKey.OP_READ);\n\n                } else if (key.isReadable()) {\n\n                    SocketChannel sChannel = (SocketChannel) key.channel();\n                    System.out.println(readDataFromSocketChannel(sChannel));\n                    sChannel.close();\n                }\n\n                keyIterator.remove();\n            }\n        }\n    }\n\n    private static String readDataFromSocketChannel(SocketChannel sChannel) throws IOException {\n\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        StringBuilder data = new StringBuilder();\n\n        while (true) {\n\n            buffer.clear();\n            int n = sChannel.read(buffer);\n            if (n == -1) {\n                break;\n            }\n            buffer.flip();\n            int limit = buffer.limit();\n            char[] dst = new char[limit];\n            for (int i = 0; i < limit; i++) {\n                dst[i] = (char) buffer.get(i);\n            }\n            data.append(dst);\n            buffer.clear();\n        }\n        return data.toString();\n    }\n}\n\n\npublic class NIOClient {\n\n    public static void main(String[] args) throws IOException {\n        Socket socket = new Socket("127.0.0.1", 8888);\n        OutputStream out = socket.getOutputStream();\n        String s = "hello world";\n        out.write(s.getBytes());\n        out.close();\n    }\n}\n\n\n\n# åå­æ å°æä»¶\n\nåå­æ å°æä»¶ I/O æ¯ä¸ç§è¯»ååæä»¶æ°æ®çæ¹æ³ï¼å®å¯ä»¥æ¯å¸¸è§çåºäºæµæèåºäºééç I/O å¿«å¾å¤ã\n\nååå­æ å°æä»¶åå¥å¯è½æ¯å±é©çï¼åªæ¯æ¹åæ°ç»çåä¸ªåç´ è¿æ ·çç®åæä½ï¼å°±å¯è½ä¼ç´æ¥ä¿®æ¹ç£çä¸çæä»¶ãä¿®æ¹æ°æ®ä¸å°æ°æ®ä¿å­å°ç£çæ¯æ²¡æåå¼çã\n\nä¸é¢ä»£ç è¡å°æä»¶çå 1024 ä¸ªå­èæ å°å°åå­ä¸­ï¼map() æ¹æ³è¿åä¸ä¸ª MappedByteBufferï¼å®æ¯ ByteBuffer çå­ç±»ãå æ­¤ï¼å¯ä»¥åä½¿ç¨å¶ä»ä»»ä½ ByteBuffer ä¸æ ·ä½¿ç¨æ°æ å°çç¼å²åºï¼æä½ç³»ç»ä¼å¨éè¦æ¶è´è´£æ§è¡æ å°ã\n\nMappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, 0, 1024);\n\n\n\n# NIO vs. BIO\n\nBIO ä¸ NIO æéè¦çåºå«æ¯æ°æ®æååä¼ è¾çæ¹å¼ï¼BIO ä»¥æµçæ¹å¼å¤çæ°æ®ï¼è NIO ä»¥åçæ¹å¼å¤çæ°æ®ã\n\n * é¢åæµç BIO ä¸æ¬¡å¤çä¸ä¸ªå­èæ°æ®ï¼ä¸ä¸ªè¾å¥æµäº§çä¸ä¸ªå­èæ°æ®ï¼ä¸ä¸ªè¾åºæµæ¶è´¹ä¸ä¸ªå­èæ°æ®ãä¸ºæµå¼æ°æ®åå»ºè¿æ»¤å¨éå¸¸å®¹æï¼é¾æ¥å ä¸ªè¿æ»¤å¨ï¼ä»¥ä¾¿æ¯ä¸ªè¿æ»¤å¨åªè´è´£å¤æå¤çæºå¶çä¸é¨åãä¸å©çä¸é¢æ¯ï¼é¢åæµç I/O éå¸¸ç¸å½æ¢ã\n * é¢ååç NIO ä¸æ¬¡å¤çä¸ä¸ªæ°æ®åï¼æåå¤çæ°æ®æ¯ææµå¤çæ°æ®è¦å¿«å¾å¤ãä½æ¯é¢ååç NIO ç¼ºå°ä¸äºé¢åæµç BIO æå·æçä¼éæ§åç®åæ§ã\n\nBIO æ¨¡å¼ï¼\n\n\n\nNIO æ¨¡å¼ï¼\n\n\n\n\n# åèèµæ\n\n * BIO,NIO,AIO æ»ç»\n * Java NIO æµæ\n * JavaNIO Tutorial\n * IBM: NIO å¥é¨',normalizedContent:'# java nio\n\n> å³é®è¯ï¼channelãbufferãselectorãéé»å¡ãå¤è·¯å¤ç¨\n\n\n# nio ç®ä»\n\nnio æ¯ä¸ç§åæ­¥éé»å¡ç i/o æ¨¡åï¼å¨ java 1.4 ä¸­å¼å¥äº nio æ¡æ¶ï¼å¯¹åº java.nio åï¼æä¾äº channel ãselectorãbuffer ç­æ½è±¡ã\n\nnio ä¸­ç n å¯ä»¥çè§£ä¸º non-blockingï¼ä¸åçº¯æ¯ newãå®æ¯æé¢åç¼å²çï¼åºäºééç i/o æä½æ¹æ³ã nio æä¾äºä¸ä¼ ç» bio æ¨¡åä¸­ç socket å serversocket ç¸å¯¹åºç socketchannel å serversocketchannel ä¸¤ç§ä¸åçå¥æ¥å­ééå®ç°,ä¸¤ç§ééé½æ¯æé»å¡åéé»å¡ä¸¤ç§æ¨¡å¼ãé»å¡æ¨¡å¼ä½¿ç¨å°±åä¼ ç»ä¸­çæ¯æä¸æ ·ï¼æ¯è¾ç®åï¼ä½æ¯æ§è½åå¯é æ§é½ä¸å¥½ï¼éé»å¡æ¨¡å¼æ­£å¥½ä¸ä¹ç¸åãå¯¹äºä½è´è½½ãä½å¹¶åçåºç¨ç¨åºï¼å¯ä»¥ä½¿ç¨åæ­¥é»å¡ i/o æ¥æåå¼åéçåæ´å¥½çç»´æ¤æ§ï¼å¯¹äºé«è´è½½ãé«å¹¶åçï¼ç½ç»ï¼åºç¨ï¼åºä½¿ç¨ nio çéé»å¡æ¨¡å¼æ¥å¼åã\n\n\n# nio å bio çåºå«\n\n# non-blocking io(éé»å¡)\n\nbio æ¯é»å¡çï¼nio æ¯éé»å¡çã\n\nbio çåç§æµæ¯é»å¡çãè¿æå³çï¼å½ä¸ä¸ªçº¿ç¨è°ç¨ read() æ write() æ¶ï¼è¯¥çº¿ç¨è¢«é»å¡ï¼ç´å°æä¸äºæ°æ®è¢«è¯»åï¼ææ°æ®å®å¨åå¥ãå¨æ­¤æé´ï¼è¯¥çº¿ç¨ä¸è½åå¹²å¶ä»ä»»ä½äºã\n\nnio ä½¿æä»¬å¯ä»¥è¿è¡éé»å¡ io æä½ãæ¯å¦è¯´ï¼åçº¿ç¨ä¸­ä»ééè¯»åæ°æ®å° bufferï¼åæ¶å¯ä»¥ç»§ç»­åå«çäºæï¼å½æ°æ®è¯»åå° buffer ä¸­åï¼çº¿ç¨åç»§ç»­å¤çæ°æ®ãåæ°æ®ä¹æ¯ä¸æ ·çãå¦å¤ï¼éé»å¡åä¹æ¯å¦æ­¤ãä¸ä¸ªçº¿ç¨è¯·æ±åå¥ä¸äºæ°æ®å°æééï¼ä½ä¸éè¦ç­å¾å®å®å¨åå¥ï¼è¿ä¸ªçº¿ç¨åæ¶å¯ä»¥å»åå«çäºæã\n\n# buffer(ç¼å²åº)\n\nbio é¢åæµ(stream oriented)ï¼è nio é¢åç¼å²åº(buffer oriented)ã\n\nbuffer æ¯ä¸ä¸ªå¯¹è±¡ï¼å®åå«ä¸äºè¦åå¥æèè¦è¯»åºçæ°æ®ãå¨ nio ç±»åºä¸­å å¥ buffer å¯¹è±¡ï¼ä½ç°äº nio ä¸ bio çä¸ä¸ªéè¦åºå«ãå¨é¢åæµç bio ä¸­å¯ä»¥å°æ°æ®ç´æ¥åå¥æèå°æ°æ®ç´æ¥è¯»å° stream å¯¹è±¡ä¸­ãè½ç¶ stream ä¸­ä¹æ buffer å¼å¤´çæ©å±ç±»ï¼ä½åªæ¯æµçåè£ç±»ï¼è¿æ¯ä»æµè¯»å°ç¼å²åºï¼è nio å´æ¯ç´æ¥è¯»å° buffer ä¸­è¿è¡æä½ã\n\nå¨ nio åä¸­ï¼æææ°æ®é½æ¯ç¨ç¼å²åºå¤ççãå¨è¯»åæ°æ®æ¶ï¼å®æ¯ç´æ¥è¯»ç¼å²åºä¸­çæ°æ®; å¨åå¥æ°æ®æ¶ï¼åå¥å°ç¼å²åºä¸­ãä»»ä½æ¶åè®¿é® nio ä¸­çæ°æ®ï¼é½æ¯éè¿ç¼å²åºè¿è¡æä½ã\n\næå¸¸ç¨çç¼å²åºæ¯ bytebuffer,ä¸ä¸ª bytebuffer æä¾äºä¸ç»åè½ç¨äºæä½ byte æ°ç»ãé¤äº bytebuffer,è¿æå¶ä»çä¸äºç¼å²åºï¼äºå®ä¸ï¼æ¯ä¸ç§ java åºæ¬ç±»åï¼é¤äº boolean ç±»åï¼é½å¯¹åºæä¸ç§ç¼å²åºã\n\n# channel (éé)\n\nnio éè¿ channelï¼ééï¼ è¿è¡è¯»åã\n\nééæ¯ååçï¼å¯è¯»ä¹å¯åï¼èæµçè¯»åæ¯ååçãæ è®ºè¯»åï¼ééåªè½å buffer äº¤äºãå ä¸º bufferï¼ééå¯ä»¥å¼æ­¥å°è¯»åã\n\n# selector (éæ©å¨)\n\nnio æéæ©å¨ï¼è io æ²¡æã\n\néæ©å¨ç¨äºä½¿ç¨åä¸ªçº¿ç¨å¤çå¤ä¸ªééãå æ­¤ï¼å®éè¦è¾å°ççº¿ç¨æ¥å¤çè¿äºééãçº¿ç¨ä¹é´çåæ¢å¯¹äºæä½ç³»ç»æ¥è¯´æ¯æè´µçã å æ­¤ï¼ä¸ºäºæé«ç³»ç»æçéæ©å¨æ¯æç¨çã\n\n\n# nio çåºæ¬æµç¨\n\néå¸¸æ¥è¯´ nio ä¸­çææ io é½æ¯ä» channelï¼ééï¼ å¼å§çã\n\n * ä»ééè¿è¡æ°æ®è¯»å ï¼åå»ºä¸ä¸ªç¼å²åºï¼ç¶åè¯·æ±ééè¯»åæ°æ®ã\n * ä»ééè¿è¡æ°æ®åå¥ ï¼åå»ºä¸ä¸ªç¼å²åºï¼å¡«åæ°æ®ï¼å¹¶è¦æ±ééåå¥æ°æ®ã\n\n\n# nio æ ¸å¿ç»ä»¶\n\nnio åå«ä¸é¢å ä¸ªæ ¸å¿çç»ä»¶ï¼\n\n * channel(éé)\n * buffer(ç¼å²åº)\n * selector(éæ©å¨)\n\n\n# channel(éé)\n\nééï¼channelï¼æ¯å¯¹ bio ä¸­çæµçæ¨¡æï¼å¯ä»¥éè¿å®è¯»åæ°æ®ã\n\nchannelï¼ç±»ä¼¼å¨ linux ä¹ç±»æä½ç³»ç»ä¸çå°çæä»¶æè¿°ç¬¦ï¼æ¯ nio ä¸­è¢«ç¨æ¥æ¯ææ¹éå¼ io æä½çä¸ç§æ½è±¡ã\n\nfile æè socketï¼éå¸¸è¢«è®¤ä¸ºæ¯æ¯è¾é«å±æ¬¡çæ½è±¡ï¼è channel åæ¯æ´å æä½ç³»ç»åºå±çä¸ç§æ½è±¡ï¼è¿ä¹ä½¿å¾ nio å¾ä»¥ååå©ç¨ç°ä»£æä½ç³»ç»åºå±æºå¶ï¼è·å¾ç¹å®åºæ¯çæ§è½ä¼åï¼ä¾å¦ï¼dmaï¼direct memory accessï¼ç­ãä¸åå±æ¬¡çæ½è±¡æ¯ç¸äºå³èçï¼æä»¬å¯ä»¥éè¿ socket è·å channelï¼åä¹äº¦ç¶ã\n\nééä¸æµçä¸åä¹å¤å¨äºï¼\n\n * æµæ¯ååç - ä¸ä¸ªæµåªè½åçº¯çè´è´£è¯»æåã\n * ééæ¯ååç - ä¸ä¸ªééå¯ä»¥åæ¶ç¨äºè¯»åã\n\nééåæ¬ä»¥ä¸ç±»åï¼\n\n * filechannelï¼ä»æä»¶ä¸­è¯»åæ°æ®ï¼\n * datagramchannelï¼éè¿ udp è¯»åç½ç»ä¸­æ°æ®ï¼\n * socketchannelï¼éè¿ tcp è¯»åç½ç»ä¸­æ°æ®ï¼\n * serversocketchannelï¼å¯ä»¥çå¬æ°è¿æ¥ç tcp è¿æ¥ï¼å¯¹æ¯ä¸ä¸ªæ°è¿æ¥çè¿æ¥é½ä¼åå»ºä¸ä¸ª socketchannelã\n\n\n# buffer(ç¼å²åº)\n\nnio ä¸ä¼ ç» i/o ä¸åï¼å®æ¯åºäºåï¼blockï¼çï¼å®ä»¥åä¸ºåºæ¬åä½å¤çæ°æ®ãbuffer æ¯ä¸åè¿ç»­çåå­åï¼æ¯ nio è¯»åæ°æ®çç¼å²ãbuffer å¯ä»¥å°æä»¶ä¸æ¬¡æ§è¯»å¥åå­åååç»­å¤çï¼èä¼ ç»çæ¹å¼æ¯è¾¹è¯»æä»¶è¾¹å¤çæ°æ®ã\n\nå channel è¯»åçæ°æ®é½å¿é¡»åç½®äºç¼å²åºä¸­ãä¹å°±æ¯è¯´ï¼ä¸ä¼ç´æ¥å¯¹ééè¿è¡è¯»åæ°æ®ï¼èæ¯è¦åç»è¿ç¼å²åºãç¼å²åºå®è´¨ä¸æ¯ä¸ä¸ªæ°ç»ï¼ä½å®ä¸ä»ä»æ¯ä¸ä¸ªæ°ç»ãç¼å²åºæä¾äºå¯¹æ°æ®çç»æåè®¿é®ï¼èä¸è¿å¯ä»¥è·è¸ªç³»ç»çè¯»/åè¿ç¨ã\n\nbio å nio å·²ç»å¾å¥½å°éæäºï¼java.io.* å·²ç»ä»¥ nio ä¸ºåºç¡éæ°å®ç°äºï¼æä»¥ç°å¨å®å¯ä»¥å©ç¨ nio çä¸äºç¹æ§ãä¾å¦ï¼java.io.* åä¸­çä¸äºç±»åå«ä»¥åçå½¢å¼è¯»åæ°æ®çæ¹æ³ï¼è¿ä½¿å¾å³ä½¿å¨é¢åæµçç³»ç»ä¸­ï¼å¤çéåº¦ä¹ä¼æ´å¿«ã\n\nç¼å²åºåæ¬ä»¥ä¸ç±»åï¼\n\n * bytebuffer\n * charbuffer\n * shortbuffer\n * intbuffer\n * longbuffer\n * floatbuffer\n * doublebuffer\n\n\n# ç¼å²åºç¶æåé\n\n * capacityï¼æå¤§å®¹éï¼\n * positionï¼å½åå·²ç»è¯»åçå­èæ°ï¼\n * limitï¼è¿å¯ä»¥è¯»åçå­èæ°ã\n * markï¼è®°å½ä¸ä¸æ¬¡ postion çä½ç½®ï¼é»è®¤æ¯ 0ï¼ç®æ¯ä¸ä¸ªä¾¿å©æ§çèèï¼å¾å¾ä¸æ¯å¿é¡» çã\n\nç¼å²åºç¶æåéçæ¹åè¿ç¨ä¸¾ä¾ï¼\n\n 1. æ°å»ºä¸ä¸ªå¤§å°ä¸º 8 ä¸ªå­èçç¼å²åºï¼æ­¤æ¶ position ä¸º 0ï¼è limit = capacity = 8ãcapacity åéä¸ä¼æ¹åï¼ä¸é¢çè®¨è®ºä¼å¿½ç¥å®ã\n 2. ä»è¾å¥ééä¸­è¯»å 5 ä¸ªå­èæ°æ®åå¥ç¼å²åºä¸­ï¼æ­¤æ¶ position ç§»å¨è®¾ç½®ä¸º 5ï¼limit ä¿æä¸åã\n 3. å¨å°ç¼å²åºçæ°æ®åå°è¾åºééä¹åï¼éè¦åè°ç¨ flip() æ¹æ³ï¼è¿ä¸ªæ¹æ³å° limit è®¾ç½®ä¸ºå½å positionï¼å¹¶å° position è®¾ç½®ä¸º 0ã\n 4. ä»ç¼å²åºä¸­å 4 ä¸ªå­èå°è¾åºç¼å²ä¸­ï¼æ­¤æ¶ position è®¾ä¸º 4ã\n 5. æåéè¦è°ç¨ clear() æ¹æ³æ¥æ¸ç©ºç¼å²åºï¼æ­¤æ¶ position å limit é½è¢«è®¾ç½®ä¸ºæåä½ç½®ã\n\n\n# æä»¶ nio ç¤ºä¾\n\nä»¥ä¸å±ç¤ºäºä½¿ç¨ nio å¿«éå¤å¶æä»¶çå®ä¾ï¼\n\npublic static void fastcopy(string src, string dist) throws ioexception {\n\n    /* è·å¾æºæä»¶çè¾å¥å­èæµ */\n    fileinputstream fin = new fileinputstream(src);\n\n    /* è·åè¾å¥å­èæµçæä»¶éé */\n    filechannel fcin = fin.getchannel();\n\n    /* è·åç®æ æä»¶çè¾åºå­èæµ */\n    fileoutputstream fout = new fileoutputstream(dist);\n\n    /* è·åè¾åºå­èæµçéé */\n    filechannel fcout = fout.getchannel();\n\n    /* ä¸ºç¼å²åºåé 1024 ä¸ªå­è */\n    bytebuffer buffer = bytebuffer.allocatedirect(1024);\n\n    while (true) {\n\n        /* ä»è¾å¥ééä¸­è¯»åæ°æ®å°ç¼å²åºä¸­ */\n        int r = fcin.read(buffer);\n\n        /* read() è¿å -1 è¡¨ç¤º eof */\n        if (r == -1) {\n            break;\n        }\n\n        /* åæ¢è¯»å */\n        buffer.flip();\n\n        /* æç¼å²åºçåå®¹åå¥è¾åºæä»¶ä¸­ */\n        fcout.write(buffer);\n\n        /* æ¸ç©ºç¼å²åº */\n        buffer.clear();\n    }\n}\n\n\n\n# directbuffer\n\nnio è¿æä¾äºä¸ä¸ªå¯ä»¥ç´æ¥è®¿é®ç©çåå­çç±» directbufferãæ®éç buffer åéçæ¯ jvm å åå­ï¼è directbuffer æ¯ç´æ¥åéç©çåå­ã\n\næ°æ®è¦è¾åºå°å¤é¨è®¾å¤ï¼å¿é¡»åä»ç¨æ·ç©ºé´å¤å¶å°åæ ¸ç©ºé´ï¼åå¤å¶å°è¾åºè®¾å¤ï¼è directbuffer åæ¯ç´æ¥å°æ­¥éª¤ç®åä¸ºä»åæ ¸ç©ºé´å¤å¶å°å¤é¨è®¾å¤ï¼åå°äºæ°æ®æ·è´ã\n\nè¿éæå±ä¸ç¹ï¼ç±äº directbuffer ç³è¯·çæ¯é jvm çç©çåå­ï¼æä»¥åå»ºåéæ¯çä»£ä»·å¾é«ãdirectbuffer ç³è¯·çåå­å¹¶ä¸æ¯ç´æ¥ç± jvm è´è´£åå¾åæ¶ï¼ä½å¨ directbuffer åè£ç±»è¢«åæ¶æ¶ï¼ä¼éè¿ java å¼ç¨æºå¶æ¥éæ¾è¯¥åå­åã\n\n\n# selector(éæ©å¨)\n\nnio å¸¸å¸¸è¢«å«åéé»å¡ ioï¼ä¸»è¦æ¯å ä¸º nio å¨ç½ç»éä¿¡ä¸­çéé»å¡ç¹æ§è¢«å¹¿æ³ä½¿ç¨ã\n\nselector æ¯ java nio ç¼ç¨çåºç¡ãç¨äºæ£æ¥ä¸ä¸ªæå¤ä¸ª nio channel çç¶ææ¯å¦å¤äºå¯è¯»ãå¯åã\n\nnio å®ç°äº io å¤è·¯å¤ç¨ä¸­ç reactor æ¨¡åï¼\n\n * ä¸ä¸ªçº¿ç¨ï¼threadï¼ä½¿ç¨ä¸ä¸ªéæ©å¨ selector éè¿è½®è¯¢çæ¹å¼å»çå¬å¤ä¸ªéé channel ä¸çäºä»¶ï¼accpetãreadï¼ï¼å¦ææä¸ª channel ä¸é¢åççå¬äºä»¶ï¼è¿ä¸ª channel å°±å¤äºå°±ç»ªç¶æï¼ç¶åè¿è¡ i/o æä½ã\n\n * éè¿éç½®çå¬çéé channel ä¸ºéé»å¡ï¼é£ä¹å½ channel ä¸ç io äºä»¶è¿æªå°è¾¾æ¶ï¼å°±ä¸ä¼è¿å¥é»å¡ç¶æä¸ç´ç­å¾ï¼èæ¯ç»§ç»­è½®è¯¢å¶å® channelï¼æ¾å° io äºä»¶å·²ç»å°è¾¾ç channel æ§è¡ã\n\n * å ä¸ºåå»ºååæ¢çº¿ç¨çå¼éå¾å¤§ï¼å æ­¤ä½¿ç¨ä¸ä¸ªçº¿ç¨æ¥å¤çå¤ä¸ªäºä»¶èä¸æ¯ä¸ä¸ªçº¿ç¨å¤çä¸ä¸ªäºä»¶å·ææ´å¥½çæ§è½ã\n\néè¦æ³¨æçæ¯ï¼åªæ socketchannel æè½éç½®ä¸ºéé»å¡ï¼è filechannel ä¸è½ï¼å ä¸º filechannel éç½®éé»å¡ä¹æ²¡ææä¹ã\n\n> ç®åæä½ç³»ç»ç i/o å¤è·¯å¤ç¨æºå¶é½ä½¿ç¨äº epollï¼ç¸æ¯ä¼ ç»ç select æºå¶ï¼epoll æ²¡ææå¤§è¿æ¥å¥æ 1024 çéå¶ãæä»¥ selector å¨çè®ºä¸å¯ä»¥è½®è¯¢æåä¸ä¸çå®¢æ·ç«¯ã\n\n\n# åå»ºéæ©å¨\n\nselector selector = selector.open();\n\n\n\n# å°ééæ³¨åå°éæ©å¨ä¸\n\nserversocketchannel sschannel = serversocketchannel.open();\nsschannel.configureblocking(false);\nsschannel.register(selector, selectionkey.op_accept);\n\n\nééå¿é¡»éç½®ä¸ºéé»å¡æ¨¡å¼ï¼å¦åä½¿ç¨éæ©å¨å°±æ²¡æä»»ä½æä¹äºï¼å ä¸ºå¦æééå¨æä¸ªäºä»¶ä¸è¢«é»å¡ï¼é£ä¹æå¡å¨å°±ä¸è½ååºå¶å®äºä»¶ï¼å¿é¡»ç­å¾è¿ä¸ªäºä»¶å¤çå®æ¯æè½å»å¤çå¶å®äºä»¶ï¼æ¾ç¶è¿åéæ©å¨çä½ç¨èéèé©°ã\n\nå¨å°ééæ³¨åå°éæ©å¨ä¸æ¶ï¼è¿éè¦æå®è¦æ³¨åçå·ä½äºä»¶ï¼ä¸»è¦æä»¥ä¸å ç±»ï¼\n\n * selectionkey.op_connect\n * selectionkey.op_accept\n * selectionkey.op_read\n * selectionkey.op_write\n\nå®ä»¬å¨ selectionkey çå®ä¹å¦ä¸ï¼\n\npublic static final int op_read = 1 << 0;\npublic static final int op_write = 1 << 2;\npublic static final int op_connect = 1 << 3;\npublic static final int op_accept = 1 << 4;\n\n\nå¯ä»¥çåºæ¯ä¸ªäºä»¶å¯ä»¥è¢«å½æä¸ä¸ªä½åï¼ä»èç»æäºä»¶éæ´æ°ãä¾å¦ï¼\n\nint interestset = selectionkey.op_read | selectionkey.op_write;\n\n\n\n# çå¬äºä»¶\n\nint num = selector.select();\n\n\nä½¿ç¨ select() æ¥çå¬å°è¾¾çäºä»¶ï¼å®ä¼ä¸ç´é»å¡ç´å°æè³å°ä¸ä¸ªäºä»¶å°è¾¾ã\n\n\n# è·åå°è¾¾çäºä»¶\n\nset<selectionkey> keys = selector.selectedkeys();\niterator<selectionkey> keyiterator = keys.iterator();\nwhile (keyiterator.hasnext()) {\n    selectionkey key = keyiterator.next();\n    if (key.isacceptable()) {\n        // ...\n    } else if (key.isreadable()) {\n        // ...\n    }\n    keyiterator.remove();\n}\n\n\n\n# äºä»¶å¾ªç¯\n\nå ä¸ºä¸æ¬¡ select() è°ç¨ä¸è½å¤çå®ææçäºä»¶ï¼å¹¶ä¸æå¡å¨ç«¯æå¯è½éè¦ä¸ç´çå¬äºä»¶ï¼å æ­¤æå¡å¨ç«¯å¤çäºä»¶çä»£ç ä¸è¬ä¼æ¾å¨ä¸ä¸ªæ­»å¾ªç¯åã\n\nwhile (true) {\n    int num = selector.select();\n    set<selectionkey> keys = selector.selectedkeys();\n    iterator<selectionkey> keyiterator = keys.iterator();\n    while (keyiterator.hasnext()) {\n        selectionkey key = keyiterator.next();\n        if (key.isacceptable()) {\n            // ...\n        } else if (key.isreadable()) {\n            // ...\n        }\n        keyiterator.remove();\n    }\n}\n\n\n\n# å¥æ¥å­ nio ç¤ºä¾\n\npublic class nioserver {\n\n    public static void main(string[] args) throws ioexception {\n\n        selector selector = selector.open();\n\n        serversocketchannel sschannel = serversocketchannel.open();\n        sschannel.configureblocking(false);\n        sschannel.register(selector, selectionkey.op_accept);\n\n        serversocket serversocket = sschannel.socket();\n        inetsocketaddress address = new inetsocketaddress("127.0.0.1", 8888);\n        serversocket.bind(address);\n\n        while (true) {\n\n            selector.select();\n            set<selectionkey> keys = selector.selectedkeys();\n            iterator<selectionkey> keyiterator = keys.iterator();\n\n            while (keyiterator.hasnext()) {\n\n                selectionkey key = keyiterator.next();\n\n                if (key.isacceptable()) {\n\n                    serversocketchannel sschannel1 = (serversocketchannel) key.channel();\n\n                    // æå¡å¨ä¼ä¸ºæ¯ä¸ªæ°è¿æ¥åå»ºä¸ä¸ª socketchannel\n                    socketchannel schannel = sschannel1.accept();\n                    schannel.configureblocking(false);\n\n                    // è¿ä¸ªæ°è¿æ¥ä¸»è¦ç¨äºä»å®¢æ·ç«¯è¯»åæ°æ®\n                    schannel.register(selector, selectionkey.op_read);\n\n                } else if (key.isreadable()) {\n\n                    socketchannel schannel = (socketchannel) key.channel();\n                    system.out.println(readdatafromsocketchannel(schannel));\n                    schannel.close();\n                }\n\n                keyiterator.remove();\n            }\n        }\n    }\n\n    private static string readdatafromsocketchannel(socketchannel schannel) throws ioexception {\n\n        bytebuffer buffer = bytebuffer.allocate(1024);\n        stringbuilder data = new stringbuilder();\n\n        while (true) {\n\n            buffer.clear();\n            int n = schannel.read(buffer);\n            if (n == -1) {\n                break;\n            }\n            buffer.flip();\n            int limit = buffer.limit();\n            char[] dst = new char[limit];\n            for (int i = 0; i < limit; i++) {\n                dst[i] = (char) buffer.get(i);\n            }\n            data.append(dst);\n            buffer.clear();\n        }\n        return data.tostring();\n    }\n}\n\n\npublic class nioclient {\n\n    public static void main(string[] args) throws ioexception {\n        socket socket = new socket("127.0.0.1", 8888);\n        outputstream out = socket.getoutputstream();\n        string s = "hello world";\n        out.write(s.getbytes());\n        out.close();\n    }\n}\n\n\n\n# åå­æ å°æä»¶\n\nåå­æ å°æä»¶ i/o æ¯ä¸ç§è¯»ååæä»¶æ°æ®çæ¹æ³ï¼å®å¯ä»¥æ¯å¸¸è§çåºäºæµæèåºäºééç i/o å¿«å¾å¤ã\n\nååå­æ å°æä»¶åå¥å¯è½æ¯å±é©çï¼åªæ¯æ¹åæ°ç»çåä¸ªåç´ è¿æ ·çç®åæä½ï¼å°±å¯è½ä¼ç´æ¥ä¿®æ¹ç£çä¸çæä»¶ãä¿®æ¹æ°æ®ä¸å°æ°æ®ä¿å­å°ç£çæ¯æ²¡æåå¼çã\n\nä¸é¢ä»£ç è¡å°æä»¶çå 1024 ä¸ªå­èæ å°å°åå­ä¸­ï¼map() æ¹æ³è¿åä¸ä¸ª mappedbytebufferï¼å®æ¯ bytebuffer çå­ç±»ãå æ­¤ï¼å¯ä»¥åä½¿ç¨å¶ä»ä»»ä½ bytebuffer ä¸æ ·ä½¿ç¨æ°æ å°çç¼å²åºï¼æä½ç³»ç»ä¼å¨éè¦æ¶è´è´£æ§è¡æ å°ã\n\nmappedbytebuffer mbb = fc.map(filechannel.mapmode.read_write, 0, 1024);\n\n\n\n# nio vs. bio\n\nbio ä¸ nio æéè¦çåºå«æ¯æ°æ®æååä¼ è¾çæ¹å¼ï¼bio ä»¥æµçæ¹å¼å¤çæ°æ®ï¼è nio ä»¥åçæ¹å¼å¤çæ°æ®ã\n\n * é¢åæµç bio ä¸æ¬¡å¤çä¸ä¸ªå­èæ°æ®ï¼ä¸ä¸ªè¾å¥æµäº§çä¸ä¸ªå­èæ°æ®ï¼ä¸ä¸ªè¾åºæµæ¶è´¹ä¸ä¸ªå­èæ°æ®ãä¸ºæµå¼æ°æ®åå»ºè¿æ»¤å¨éå¸¸å®¹æï¼é¾æ¥å ä¸ªè¿æ»¤å¨ï¼ä»¥ä¾¿æ¯ä¸ªè¿æ»¤å¨åªè´è´£å¤æå¤çæºå¶çä¸é¨åãä¸å©çä¸é¢æ¯ï¼é¢åæµç i/o éå¸¸ç¸å½æ¢ã\n * é¢ååç nio ä¸æ¬¡å¤çä¸ä¸ªæ°æ®åï¼æåå¤çæ°æ®æ¯ææµå¤çæ°æ®è¦å¿«å¾å¤ãä½æ¯é¢ååç nio ç¼ºå°ä¸äºé¢åæµç bio æå·æçä¼éæ§åç®åæ§ã\n\nbio æ¨¡å¼ï¼\n\n\n\nnio æ¨¡å¼ï¼\n\n\n\n\n# åèèµæ\n\n * bio,nio,aio æ»ç»\n * java nio æµæ\n * javanio tutorial\n * ibm: nio å¥é¨',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ·±å¥çè§£ Java åºåå",frontmatter:{title:"æ·±å¥çè§£ Java åºåå",date:"2019-05-09T19:06:05.000Z",categories:["Java","JavaSE","IO"],tags:["Java","JavaSE","IO","åºåå"],permalink:"/pages/2b2f0f/"},regularPath:"/01.Java/01.JavaSE/04.IO/03.Java%E5%BA%8F%E5%88%97%E5%8C%96.html",relativePath:"01.Java/01.JavaSE/04.IO/03.Javaåºåå.md",key:"v-18d0a24b",path:"/pages/2b2f0f/",headers:[{level:2,title:"åºååç®ä»",slug:"åºååç®ä»",normalizedTitle:"åºååç®ä»",charIndex:107},{level:2,title:"JDK åºåå",slug:"jdk-åºåå",normalizedTitle:"jdk åºåå",charIndex:354},{level:3,title:"ObjectInputStream å ObjectOutputStream",slug:"objectinputstream-å-objectoutputstream",normalizedTitle:"objectinputstream å objectoutputstream",charIndex:384},{level:3,title:"Serializable æ¥å£",slug:"serializable-æ¥å£",normalizedTitle:"serializable æ¥å£",charIndex:2673},{level:4,title:"serialVersionUID",slug:"serialversionuid",normalizedTitle:"serialversionuid",charIndex:36},{level:4,title:"é»è®¤åºååæºå¶",slug:"é»è®¤åºååæºå¶",normalizedTitle:"é»è®¤åºååæºå¶",charIndex:4259},{level:4,title:"JDK åºååè¦ç¹",slug:"jdk-åºååè¦ç¹",normalizedTitle:"jdk åºååè¦ç¹",charIndex:4570},{level:4,title:"transient",slug:"transient",normalizedTitle:"transient",charIndex:53},{level:3,title:"Externalizable æ¥å£",slug:"externalizable-æ¥å£",normalizedTitle:"externalizable æ¥å£",charIndex:5301},{level:4,title:"Externalizable æ¥å£çæ¿ä»£æ¹æ³",slug:"externalizable-æ¥å£çæ¿ä»£æ¹æ³",normalizedTitle:"externalizable æ¥å£çæ¿ä»£æ¹æ³",charIndex:7834},{level:3,title:"readResolve() æ¹æ³",slug:"readresolve-æ¹æ³",normalizedTitle:"readresolve() æ¹æ³",charIndex:8978},{level:3,title:"JDK åºååçé®é¢",slug:"jdk-åºååçé®é¢",normalizedTitle:"jdk åºååçé®é¢",charIndex:12055},{level:2,title:"äºè¿å¶åºåå",slug:"äºè¿å¶åºåå",normalizedTitle:"äºè¿å¶åºåå",charIndex:12720},{level:3,title:"Protobuf",slug:"protobuf",normalizedTitle:"protobuf",charIndex:12790},{level:3,title:"Thrift",slug:"thrift",normalizedTitle:"thrift",charIndex:13204},{level:3,title:"Hessian",slug:"hessian",normalizedTitle:"hessian",charIndex:12996},{level:3,title:"Kryo",slug:"kryo",normalizedTitle:"kryo",charIndex:13869},{level:3,title:"FST",slug:"fst",normalizedTitle:"fst",charIndex:14010},{level:2,title:"JSON åºåå",slug:"json-åºåå",normalizedTitle:"json åºåå",charIndex:13525},{level:3,title:"JSON æ¯ä»ä¹",slug:"json-æ¯ä»ä¹",normalizedTitle:"json æ¯ä»ä¹",charIndex:14248},{level:3,title:"JSON æ å",slug:"json-æ å",normalizedTitle:"json æ å",charIndex:14478},{level:3,title:"JSON ä¼ç¼ºç¹",slug:"json-ä¼ç¼ºç¹",normalizedTitle:"json ä¼ç¼ºç¹",charIndex:15031},{level:3,title:"JSON åº",slug:"json-åº",normalizedTitle:"json åº",charIndex:14433},{level:3,title:"JSON ç¼ç æå",slug:"json-ç¼ç æå",normalizedTitle:"json ç¼ç æå",charIndex:15829},{level:2,title:"åºååææ¯éå",slug:"åºååææ¯éå",normalizedTitle:"åºååææ¯éå",charIndex:16524},{level:3,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:16988}],headersStr:"åºååç®ä» JDK åºåå ObjectInputStream å ObjectOutputStream Serializable æ¥å£ serialVersionUID é»è®¤åºååæºå¶ JDK åºååè¦ç¹ transient Externalizable æ¥å£ Externalizable æ¥å£çæ¿ä»£æ¹æ³ readResolve() æ¹æ³ JDK åºååçé®é¢ äºè¿å¶åºåå Protobuf Thrift Hessian Kryo FST JSON åºåå JSON æ¯ä»ä¹ JSON æ å JSON ä¼ç¼ºç¹ JSON åº JSON ç¼ç æå åºååææ¯éå åèèµæ",content:'# æ·±å¥çè§£ Java åºåå\n\n> å³é®è¯ï¼SerializableãserialVersionUIDãtransientãExternalizableãwriteObjectãreadObject\n\n\n\n\n# åºååç®ä»\n\nç±äºï¼ç½ç»ä¼ è¾çæ°æ®å¿é¡»æ¯äºè¿å¶æ°æ®ï¼ä½è°ç¨æ¹è¯·æ±çåºå¥åæ°é½æ¯å¯¹è±¡ãå¯¹è±¡æ¯ä¸è½ç´æ¥å¨ç½ç»ä¸­ä¼ è¾çï¼æä»¥éè¦æåæå®è½¬æå¯ä¼ è¾çäºè¿å¶ï¼å¹¶ä¸è¦æ±è½¬æ¢ç®æ³æ¯å¯éçã\n\n * åºååï¼serializeï¼ï¼åºååæ¯å°å¯¹è±¡è½¬æ¢ä¸ºäºè¿å¶æ°æ®ã\n * ååºååï¼deserializeï¼ï¼ååºååæ¯å°äºè¿å¶æ°æ®è½¬æ¢ä¸ºå¯¹è±¡ã\n\n\n\nåºååç¨é\n\n * åºååå¯ä»¥å°å¯¹è±¡çå­èåºåæä¹åââä¿å­å¨åå­ãæä»¶ãæ°æ®åºä¸­ã\n * å¨ç½ç»ä¸ä¼ éå¯¹è±¡çå­èåºåã\n * RMI(è¿ç¨æ¹æ³è°ç¨)\n\n\n# JDK åºåå\n\nJDK ä¸­åç½®äºä¸ç§åºååæ¹å¼ã\n\n\n# ObjectInputStream å ObjectOutputStream\n\nJava éè¿å¯¹è±¡è¾å¥è¾åºæµæ¥å®ç°åºåååååºååï¼\n\n * java.io.ObjectOutputStream ç±»ç writeObject() æ¹æ³å¯ä»¥å®ç°åºååï¼\n * java.io.ObjectInputStream ç±»ç readObject() æ¹æ³ç¨äºå®ç°ååºååã\n\nåºåååååºååç¤ºä¾ï¼\n\npublic class SerializeDemo01 {\n    enum Sex {\n        MALE,\n        FEMALE\n    }\n\n\n    static class Person implements Serializable {\n        private static final long serialVersionUID = 1L;\n        private String name = null;\n        private Integer age = null;\n        private Sex sex;\n\n        public Person() { }\n\n        public Person(String name, Integer age, Sex sex) {\n            this.name = name;\n            this.age = age;\n            this.sex = sex;\n        }\n\n        @Override\n        public String toString() {\n            return "Person{" + "name=\'" + name + \'\\\'\' + ", age=" + age + ", sex=" + sex + \'}\';\n        }\n    }\n\n    /**\n     * åºåå\n     */\n    private static void serialize(String filename) throws IOException {\n        File f = new File(filename); // å®ä¹ä¿å­è·¯å¾\n        OutputStream out = new FileOutputStream(f); // æä»¶è¾åºæµ\n        ObjectOutputStream oos = new ObjectOutputStream(out); // å¯¹è±¡è¾åºæµ\n        oos.writeObject(new Person("Jack", 30, Sex.MALE)); // ä¿å­å¯¹è±¡\n        oos.close();\n        out.close();\n    }\n\n    /**\n     * ååºåå\n     */\n    private static void deserialize(String filename) throws IOException, ClassNotFoundException {\n        File f = new File(filename); // å®ä¹ä¿å­è·¯å¾\n        InputStream in = new FileInputStream(f); // æä»¶è¾å¥æµ\n        ObjectInputStream ois = new ObjectInputStream(in); // å¯¹è±¡è¾å¥æµ\n        Object obj = ois.readObject(); // è¯»åå¯¹è±¡\n        ois.close();\n        in.close();\n        System.out.println(obj);\n    }\n\n    public static void main(String[] args) throws IOException, ClassNotFoundException {\n        final String filename = "d:/text.dat";\n        serialize(filename);\n        deserialize(filename);\n    }\n}\n// Output:\n// Person{name=\'Jack\', age=30, sex=MALE}\n\n\nJDK çåºååè¿ç¨æ¯ææ ·å®æçå¢ï¼\n\n\n\nå¾æ¥èª RPC å®æä¸æ ¸å¿åç - åºåå\n\nåºååè¿ç¨å°±æ¯å¨è¯»åå¯¹è±¡æ°æ®çæ¶åï¼ä¸æ­å å¥ä¸äºç¹æ®åéç¬¦ï¼è¿äºç¹æ®åéç¬¦ç¨äºå¨ååºååè¿ç¨ä¸­æªæ­ç¨ï¼è¿å°±åæ¯æç« ä¸­çæ ç¹ç¬¦å·è¢«ç¨äºæ­å¥ä¸æ ·ã\n\n * å¤´é¨æ°æ®ç¨æ¥å£°æåºåååè®®ãåºååçæ¬ï¼ç¨äºé«ä½çæ¬ååå¼å®¹ã\n * å¯¹è±¡æ°æ®ä¸»è¦åæ¬ç±»åãç­¾åãå±æ§åãå±æ§ç±»ååå±æ§å¼ï¼å½ç¶è¿æå¼å¤´ç»å°¾ç­æ°æ®ï¼é¤äºå±æ§å¼å±äºçæ­£çå¯¹è±¡å¼ï¼å¶ä»é½æ¯ä¸ºäºååºååç¨çåæ°æ®ã\n * å­å¨å¯¹è±¡å¼ç¨ãç»§æ¿çæåµä¸ï¼å°±æ¯éå½éåâåå¯¹è±¡âé»è¾ã\n\n> ð æ³¨æï¼ä½¿ç¨ Java å¯¹è±¡åºååï¼å¨ä¿å­å¯¹è±¡æ¶ï¼ä¼æå¶ç¶æä¿å­ä¸ºä¸ç»å­èï¼å¨æªæ¥ï¼åå°è¿äºå­èç»è£æå¯¹è±¡ãå¿é¡»æ³¨æå°æ¯ï¼å¯¹è±¡åºååä¿å­çæ¯å¯¹è±¡çâç¶æâï¼å³å®çæååéãç±æ­¤å¯ç¥ï¼å¯¹è±¡åºååä¸ä¼å³æ³¨ç±»ä¸­çéæåéã\n\n\n# Serializable æ¥å£\n\nè¢«åºååçç±»å¿é¡»å±äº EnumãArray å Serializable ç±»åå¶ä¸­çä»»ä½ä¸ç§ï¼å¦åå°æåº NotSerializableException å¼å¸¸ãè¿æ¯å ä¸ºï¼å¨åºååæä½è¿ç¨ä¸­ä¼å¯¹ç±»åè¿è¡æ£æ¥ï¼å¦æä¸æ»¡è¶³åºååç±»åè¦æ±ï¼å°±ä¼æåºå¼å¸¸ã\n\nãç¤ºä¾ãNotSerializableException éè¯¯\n\npublic class UnSerializeDemo {\n    static class Person { // å¶ä»åå®¹ç¥ }\n    // å¶ä»åå®¹ç¥\n}\n\n\nè¾åºï¼ç»æå°±æ¯åºç°å¦ä¸å¼å¸¸ä¿¡æ¯ã\n\nException in thread "main" java.io.NotSerializableException:\n...\n\n\n# serialVersionUID\n\nè¯·æ³¨æ serialVersionUID å­æ®µï¼ä½ å¯ä»¥å¨ Java ä¸ççæ æ°ç±»ä¸­çå°è¿ä¸ªå­æ®µã\n\nserialVersionUID æä»ä¹ä½ç¨ï¼å¦ä½ä½¿ç¨ serialVersionUIDï¼\n\nserialVersionUID æ¯ Java ä¸ºæ¯ä¸ªåºååç±»äº§çççæ¬æ è¯ãå®å¯ä»¥ç¨æ¥ä¿è¯å¨ååºåæ¶ï¼åéæ¹åéçåæ¥åæ¹æ¥æ¶çæ¯å¯å¼å®¹çå¯¹è±¡ãå¦ææ¥æ¶æ¹æ¥æ¶çç±»ç serialVersionUID ä¸åéæ¹åéç serialVersionUID ä¸ä¸è´ï¼ä¼æåº InvalidClassExceptionã\n\nå¦æå¯åºååç±»æ²¡ææ¾å¼å£°æ serialVersionUIDï¼ååºååè¿è¡æ¶å°åºäºè¯¥ç±»çåä¸ªæ¹é¢è®¡ç®è¯¥ç±»çé»è®¤ serialVersionUID å¼ãå°½ç®¡è¿æ ·ï¼è¿æ¯å»ºè®®å¨æ¯ä¸ä¸ªåºååçç±»ä¸­æ¾å¼æå® serialVersionUID çå¼ãå ä¸ºä¸åç jdk ç¼è¯å¾å¯è½ä¼çæä¸åç serialVersionUID é»è®¤å¼ï¼ä»èå¯¼è´å¨ååºååæ¶æåº InvalidClassExceptions å¼å¸¸ã\n\nserialVersionUID å­æ®µå¿é¡»æ¯ static final long ç±»åã\n\næä»¬æ¥ä¸¾ä¸ªä¾å­ï¼\n\nï¼1ï¼æä¸ä¸ªå¯åºååç±» Person\n\npublic class Person implements Serializable {\n    private static final long serialVersionUID = 1L;\n    private String name;\n    private Integer age;\n    private String address;\n    // æé æ¹æ³ãgetãset æ¹æ³ç¥\n}\n\n\nï¼2ï¼å¼åè¿ç¨ä¸­ï¼å¯¹ Person åäºä¿®æ¹ï¼å¢å äºä¸ä¸ªå­æ®µ emailï¼å¦ä¸ï¼\n\npublic class Person implements Serializable {\n    private static final long serialVersionUID = 1L;\n    private String name;\n    private Integer age;\n    private String address;\n    private String email;\n    // æé æ¹æ³ãgetãset æ¹æ³ç¥\n}\n\n\nç±äºè¿ä¸ªç±»åèçæ¬ä¸å¼å®¹ï¼æä»¬éè¦ä¿®æ¹çæ¬å·ï¼\n\nprivate static final long serialVersionUID = 2L;\n\n\nåæ¬¡è¿è¡ååºååï¼åä¼æåº InvalidClassException å¼å¸¸ã\n\nç»¼ä¸æè¿°ï¼æä»¬å¤§æ¦å¯ä»¥æ¸æ¥ï¼serialVersionUID ç¨äºæ§å¶åºååçæ¬æ¯å¦å¼å®¹ãè¥æä»¬è®¤ä¸ºä¿®æ¹çå¯åºååç±»æ¯ååå¼å®¹çï¼åä¸ä¿®æ¹ serialVersionUIDã\n\n# é»è®¤åºååæºå¶\n\nå¦æä»ä»åªæ¯è®©æä¸ªç±»å®ç° Serializable æ¥å£ï¼èæ²¡æå¶å®ä»»ä½å¤ççè¯ï¼é£ä¹å°±ä¼ä½¿ç¨é»è®¤åºååæºå¶ã\n\nä½¿ç¨é»è®¤æºå¶ï¼å¨åºååå¯¹è±¡æ¶ï¼ä¸ä»ä¼åºååå½åå¯¹è±¡æ¬èº«ï¼è¿ä¼å¯¹å¶ç¶ç±»çå­æ®µä»¥åè¯¥å¯¹è±¡å¼ç¨çå¶å®å¯¹è±¡ä¹è¿è¡åºååãåæ ·å°ï¼è¿äºå¶å®å¯¹è±¡å¼ç¨çå¦å¤å¯¹è±¡ä¹å°è¢«åºååï¼ä»¥æ­¤ç±»æ¨ãæä»¥ï¼å¦æä¸ä¸ªå¯¹è±¡åå«çæååéæ¯å®¹å¨ç±»å¯¹è±¡ï¼èè¿äºå®¹å¨æå«æçåç´ ä¹æ¯å®¹å¨ç±»å¯¹è±¡ï¼é£ä¹è¿ä¸ªåºååçè¿ç¨å°±ä¼è¾å¤æï¼å¼éä¹è¾å¤§ã\n\n> ð æ³¨æï¼è¿éçç¶ç±»åå¼ç¨å¯¹è±¡æ¢ç¶è¦è¿è¡åºååï¼é£ä¹å®ä»¬å½ç¶ä¹è¦æ»¡è¶³åºååè¦æ±ï¼è¢«åºååçç±»å¿é¡»å±äº EnumãArray å Serializable ç±»åå¶ä¸­çä»»ä½ä¸ç§ã\n\n# JDK åºååè¦ç¹\n\nJava çåºååè½ä¿è¯å¯¹è±¡ç¶æçæä¹ä¿å­ï¼ä½æ¯éå°ä¸äºå¯¹è±¡ç»æå¤æçæåµè¿æ¯é¾ä»¥å¤çï¼è¿éå½çº³ä¸ä¸ï¼\n\n * ç¶ç±»æ¯ Serializableï¼ææå­ç±»é½å¯ä»¥è¢«åºååã\n * å­ç±»æ¯ Serializable ï¼ç¶ç±»ä¸æ¯ï¼åå­ç±»å¯ä»¥æ­£ç¡®åºååï¼ä½ç¶ç±»çå±æ§ä¸ä¼è¢«åºååï¼ä¸æ¥éï¼æ°æ®ä¸¢å¤±ï¼ã\n * å¦æåºååçå±æ§æ¯å¯¹è±¡ï¼åè¿ä¸ªå¯¹è±¡ä¹å¿é¡»æ¯ Serializable ï¼å¦åæ¥éã\n * ååºååæ¶ï¼å¦æå¯¹è±¡çå±æ§æä¿®æ¹æå åï¼åä¿®æ¹çé¨åå±æ§ä¼ä¸¢å¤±ï¼ä½ä¸ä¼æ¥éã\n * ååºååæ¶ï¼å¦æ serialVersionUID è¢«ä¿®æ¹ï¼åååºååä¼å¤±è´¥ã\n\n# transient\n\nå¨ç°å®åºç¨ä¸­ï¼æäºæ¶åä¸è½ä½¿ç¨é»è®¤åºååæºå¶ãæ¯å¦ï¼å¸æå¨åºååè¿ç¨ä¸­å¿½ç¥ææææ°æ®ï¼æèç®ååºååè¿ç¨ãä¸é¢å°ä»ç»è¥å¹²å½±ååºååçæ¹æ³ã\n\nåºååæ¶ï¼é»è®¤åºååæºå¶ä¼å¿½ç¥è¢«å£°æä¸º transient çå­æ®µï¼è¯¥å­æ®µçåå®¹å¨åºåååæ æ³è®¿é®ã\n\næä»¬å° SerializeDemo01 ç¤ºä¾ä¸­çåé¨ç±» Person ç age å­æ®µå£°æä¸º transientï¼å¦ä¸æç¤ºï¼\n\npublic class SerializeDemo02 {\n    static class Person implements Serializable {\n        transient private Integer age = null;\n        // å¶ä»åå®¹ç¥\n    }\n    // å¶ä»åå®¹ç¥\n}\n// Output:\n// name: Jack, age: null, sex: MALE\n\n\nä»è¾åºç»æå¯ä»¥çåºï¼age å­æ®µæ²¡æè¢«åºååã\n\n\n# Externalizable æ¥å£\n\næ è®ºæ¯ä½¿ç¨ transient å³é®å­ï¼è¿æ¯ä½¿ç¨ writeObject() å readObject() æ¹æ³ï¼å¶å®é½æ¯åºäº Serializable æ¥å£çåºååã\n\nJDK ä¸­æä¾äºå¦ä¸ä¸ªåºååæ¥å£--Externalizableã\n\nå¯åºååç±»å®ç° Externalizable æ¥å£ä¹åï¼åºäº Serializable æ¥å£çé»è®¤åºååæºå¶å°±ä¼å¤±æã\n\næä»¬æ¥åºäº SerializeDemo02 åæ¬¡åä¸äºæ¹å¨ï¼ä»£ç å¦ä¸ï¼\n\npublic class ExternalizeDemo01 {\n    static class Person implements Externalizable {\n        transient private Integer age = null;\n        // å¶ä»åå®¹ç¥\n\n        private void writeObject(ObjectOutputStream out) throws IOException {\n            out.defaultWriteObject();\n            out.writeInt(age);\n        }\n\n        private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n            in.defaultReadObject();\n            age = in.readInt();\n        }\n\n        @Override\n        public void writeExternal(ObjectOutput out) throws IOException { }\n\n        @Override\n        public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException { }\n    }\n     // å¶ä»åå®¹ç¥\n}\n// Output:\n// call Person()\n// name: null, age: null, sex: null\n\n\nä»è¯¥ç»æï¼ä¸æ¹é¢å¯ä»¥çåº Person å¯¹è±¡ä¸­ä»»ä½ä¸ä¸ªå­æ®µé½æ²¡æè¢«åºååãå¦ä¸æ¹é¢ï¼å¦æç»å¿çè¯ï¼è¿å¯ä»¥åç°è¿æ­¤æ¬¡åºååè¿ç¨è°ç¨äº Person ç±»çæ åæé æ¹æ³ã\n\n * Externalizable ç»§æ¿äº Serializableï¼å®å¢æ·»äºä¸¤ä¸ªæ¹æ³ï¼writeExternal() ä¸ readExternal()ãè¿ä¸¤ä¸ªæ¹æ³å¨åºåååååºååè¿ç¨ä¸­ä¼è¢«èªå¨è°ç¨ï¼ä»¥ä¾¿æ§è¡ä¸äºç¹æ®æä½ãå½ä½¿ç¨è¯¥æ¥å£æ¶ï¼åºååçç»èéè¦ç±ç¨åºåå»å®æãå¦ä¸æç¤ºçä»£ç ï¼ç±äº writeExternal() ä¸ readExternal() æ¹æ³æªä½ä»»ä½å¤çï¼é£ä¹è¯¥åºååè¡ä¸ºå°ä¸ä¼ä¿å­/è¯»åä»»ä½ä¸ä¸ªå­æ®µãè¿ä¹å°±æ¯ä¸ºä»ä¹è¾åºç»æä¸­ææå­æ®µçå¼åä¸ºç©ºã\n * å¦å¤ï¼è¥ä½¿ç¨ Externalizable è¿è¡åºååï¼å½è¯»åå¯¹è±¡æ¶ï¼ä¼è°ç¨è¢«åºååç±»çæ åæé æ¹æ³å»åå»ºä¸ä¸ªæ°çå¯¹è±¡ï¼ç¶ååå°è¢«ä¿å­å¯¹è±¡çå­æ®µçå¼åå«å¡«åå°æ°å¯¹è±¡ä¸­ãè¿å°±æ¯ä¸ºä»ä¹å¨æ­¤æ¬¡åºååè¿ç¨ä¸­ Person ç±»çæ åæé æ¹æ³ä¼è¢«è°ç¨ãç±äºè¿ä¸ªåå ï¼å®ç° Externalizable æ¥å£çç±»å¿é¡»è¦æä¾ä¸ä¸ªæ åçæé æ¹æ³ï¼ä¸å®çè®¿é®æéä¸º publicã\n\nå¯¹ä¸è¿° Person ç±»ä½è¿ä¸æ­¥çä¿®æ¹ï¼ä½¿å¶è½å¤å¯¹ name ä¸ age å­æ®µè¿è¡åºååï¼ä½è¦å¿½ç¥æ gender å­æ®µï¼å¦ä¸ä»£ç æç¤ºï¼\n\npublic class ExternalizeDemo02 {\n    static class Person implements Externalizable {\n        transient private Integer age = null;\n        // å¶ä»åå®¹ç¥\n\n        private void writeObject(ObjectOutputStream out) throws IOException {\n            out.defaultWriteObject();\n            out.writeInt(age);\n        }\n\n        private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n            in.defaultReadObject();\n            age = in.readInt();\n        }\n\n        @Override\n        public void writeExternal(ObjectOutput out) throws IOException {\n            out.writeObject(name);\n            out.writeInt(age);\n        }\n\n        @Override\n        public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {\n            name = (String) in.readObject();\n            age = in.readInt();\n        }\n    }\n     // å¶ä»åå®¹ç¥\n}\n// Output:\n// call Person()\n// name: Jack, age: 30, sex: null\n\n\n# Externalizable æ¥å£çæ¿ä»£æ¹æ³\n\nå®ç° Externalizable æ¥å£å¯ä»¥æ§å¶åºåååååºååçç»èãå®æä¸ä¸ªæ¿ä»£æ¹æ³ï¼å®ç° Serializable æ¥å£ï¼å¹¶æ·»å  writeObject(ObjectOutputStream out) ä¸ readObject(ObjectInputStream in) æ¹æ³ãåºåååååºååè¿ç¨ä¸­ä¼èªå¨åè°è¿ä¸¤ä¸ªæ¹æ³ã\n\nç¤ºä¾å¦ä¸æç¤ºï¼\n\npublic class SerializeDemo03 {\n    static class Person implements Serializable {\n        transient private Integer age = null;\n        // å¶ä»åå®¹ç¥\n\n        private void writeObject(ObjectOutputStream out) throws IOException {\n            out.defaultWriteObject();\n            out.writeInt(age);\n        }\n\n        private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n            in.defaultReadObject();\n            age = in.readInt();\n        }\n        // å¶ä»åå®¹ç¥\n    }\n    // å¶ä»åå®¹ç¥\n}\n// Output:\n// name: Jack, age: 30, sex: MALE\n\n\nå¨ writeObject() æ¹æ³ä¸­ä¼åè°ç¨ ObjectOutputStream ä¸­ç defaultWriteObject() æ¹æ³ï¼è¯¥æ¹æ³ä¼æ§è¡é»è®¤çåºååæºå¶ï¼å¦ä¸èæè¿°ï¼æ­¤æ¶ä¼å¿½ç¥æ age å­æ®µãç¶ååè°ç¨ writeInt() æ¹æ³æ¾ç¤ºå°å° age å­æ®µåå¥å° ObjectOutputStream ä¸­ãreadObject() çä½ç¨åæ¯éå¯¹å¯¹è±¡çè¯»åï¼å¶åçä¸ writeObject() æ¹æ³ç¸åã\n\n> ð æ³¨æï¼writeObject() ä¸ readObject() é½æ¯ private æ¹æ³ï¼é£ä¹å®ä»¬æ¯å¦ä½è¢«è°ç¨çå¢ï¼æ¯«æ çé®ï¼æ¯ä½¿ç¨åå°ãè¯¦æå¯è§ ObjectOutputStream ä¸­ç writeSerialData æ¹æ³ï¼ä»¥å ObjectInputStream ä¸­ç readSerialData æ¹æ³ã\n\n\n# readResolve() æ¹æ³\n\nå½æä»¬ä½¿ç¨ Singleton æ¨¡å¼æ¶ï¼åºè¯¥æ¯æææä¸ªç±»çå®ä¾åºè¯¥æ¯å¯ä¸çï¼ä½å¦æè¯¥ç±»æ¯å¯åºååçï¼é£ä¹æåµå¯è½ä¼ç¥æä¸åãæ­¤æ¶å¯¹ç¬¬ 2 èä½¿ç¨ç Person ç±»è¿è¡ä¿®æ¹ï¼ä½¿å¶å®ç° Singleton æ¨¡å¼ï¼å¦ä¸æç¤ºï¼\n\npublic class SerializeDemo04 {\n\n    enum Sex {\n        MALE, FEMALE\n    }\n\n    static class Person implements Serializable {\n        private static final long serialVersionUID = 1L;\n        private String name = null;\n        transient private Integer age = null;\n        private Sex sex;\n        static final Person instatnce = new Person("Tom", 31, Sex.MALE);\n\n        private Person() {\n            System.out.println("call Person()");\n        }\n\n        private Person(String name, Integer age, Sex sex) {\n            this.name = name;\n            this.age = age;\n            this.sex = sex;\n        }\n\n        public static Person getInstance() {\n            return instatnce;\n        }\n\n        private void writeObject(ObjectOutputStream out) throws IOException {\n            out.defaultWriteObject();\n            out.writeInt(age);\n        }\n\n        private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n            in.defaultReadObject();\n            age = in.readInt();\n        }\n\n        public String toString() {\n            return "name: " + this.name + ", age: " + this.age + ", sex: " + this.sex;\n        }\n    }\n\n    /**\n     * åºåå\n     */\n    private static void serialize(String filename) throws IOException {\n        File f = new File(filename); // å®ä¹ä¿å­è·¯å¾\n        OutputStream out = new FileOutputStream(f); // æä»¶è¾åºæµ\n        ObjectOutputStream oos = new ObjectOutputStream(out); // å¯¹è±¡è¾åºæµ\n        oos.writeObject(new Person("Jack", 30, Sex.MALE)); // ä¿å­å¯¹è±¡\n        oos.close();\n        out.close();\n    }\n\n    /**\n     * ååºåå\n     */\n    private static void deserialize(String filename) throws IOException, ClassNotFoundException {\n        File f = new File(filename); // å®ä¹ä¿å­è·¯å¾\n        InputStream in = new FileInputStream(f); // æä»¶è¾å¥æµ\n        ObjectInputStream ois = new ObjectInputStream(in); // å¯¹è±¡è¾å¥æµ\n        Object obj = ois.readObject(); // è¯»åå¯¹è±¡\n        ois.close();\n        in.close();\n        System.out.println(obj);\n        System.out.println(obj == Person.getInstance());\n    }\n\n    public static void main(String[] args) throws IOException, ClassNotFoundException {\n        final String filename = "d:/text.dat";\n        serialize(filename);\n        deserialize(filename);\n    }\n}\n// Output:\n// name: Jack, age: null, sex: MALE\n// false\n\n\nå¼å¾æ³¨æçæ¯ï¼ä»æä»¶ä¸­è·åç Person å¯¹è±¡ä¸ Person ç±»ä¸­çåä¾å¯¹è±¡å¹¶ä¸ç¸ç­ãä¸ºäºè½å¨åä¾ç±»ä¸­ä»ç¶ä¿æåºåçç¹æ§ï¼å¯ä»¥ä½¿ç¨ readResolve() æ¹æ³ãå¨è¯¥æ¹æ³ä¸­ç´æ¥è¿å Person çåä¾å¯¹è±¡ãæä»¬å¨ SerializeDemo04 ç¤ºä¾çåºç¡ä¸æ·»å ä¸ä¸ª readResolve æ¹æ³ï¼ å¦ä¸æç¤ºï¼\n\npublic class SerializeDemo05 {\n    // å¶ä»åå®¹ç¥\n\n    static class Person implements Serializable {\n\n        // private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n        //     in.defaultReadObject();\n        //     age = in.readInt();\n        // }\n\n        // æ·»å æ­¤æ¹æ³\n        private Object readResolve() {\n            return instatnce;\n        }\n        // å¶ä»åå®¹ç¥\n    }\n\n    // å¶ä»åå®¹ç¥\n}\n// Output:\n// name: Tom, age: 31, sex: MALE\n// true\n\n\n\n# JDK åºååçé®é¢\n\n * æ æ³è·¨è¯­è¨ï¼JDK åºååç®ååªéç¨åºäº Java è¯­è¨å®ç°çæ¡æ¶ï¼å¶å®è¯­è¨å¤§é¨åé½æ²¡æä½¿ç¨ Java çåºååæ¡æ¶ï¼ä¹æ²¡æå®ç° JDK åºååè¿å¥åè®®ãå æ­¤ï¼å¦ææ¯ä¸¤ä¸ªåºäºä¸åè¯­è¨ç¼åçåºç¨ç¨åºç¸äºéä¿¡ï¼åæ æ³å®ç°ä¸¤ä¸ªåºç¨æå¡ä¹é´ä¼ è¾å¯¹è±¡çåºååä¸ååºååã\n * å®¹æè¢«æ»å»ï¼å¯¹è±¡æ¯éè¿å¨ ObjectInputStream ä¸è°ç¨ readObject() æ¹æ³è¿è¡ååºååçï¼å®å¯ä»¥å°ç±»è·¯å¾ä¸å ä¹ææå®ç°äº Serializable æ¥å£çå¯¹è±¡é½å®ä¾åãè¿æå³çï¼å¨ååºååå­èæµçè¿ç¨ä¸­ï¼è¯¥æ¹æ³å¯ä»¥æ§è¡ä»»æç±»åçä»£ç ï¼è¿æ¯éå¸¸å±é©çãå¯¹äºéè¦é¿æ¶é´è¿è¡ååºååçå¯¹è±¡ï¼ä¸éè¦æ§è¡ä»»ä½ä»£ç ï¼ä¹å¯ä»¥åèµ·ä¸æ¬¡æ»å»ãæ»å»èå¯ä»¥åå»ºå¾ªç¯å¯¹è±¡é¾ï¼ç¶åå°åºåååçå¯¹è±¡ä¼ è¾å°ç¨åºä¸­ååºååï¼è¿ç§æåµä¼å¯¼è´ hashCode æ¹æ³è¢«è°ç¨æ¬¡æ°åæ¬¡æ¹çåå¼å¢é¿, ä»èå¼åæ æº¢åºå¼å¸¸ãä¾å¦ä¸é¢è¿ä¸ªæ¡ä¾å°±å¯ä»¥å¾å¥½å°è¯´æã\n * åºåååçæµå¤ªå¤§ï¼JDK åºååä¸­ä½¿ç¨äº ObjectOutputStream æ¥å®ç°å¯¹è±¡è½¬äºè¿å¶ç¼ç ï¼ç¼ç åçæ°ç»å¾å¤§ï¼éå¸¸å½±åå­å¨åä¼ è¾æçã\n * åºååæ§è½å¤ªå·®ï¼Java çåºååèæ¶æ¯è¾å¤§ãåºååçéåº¦ä¹æ¯ä½ç°åºååæ§è½çéè¦ææ ï¼å¦æåºååçéåº¦æ¢ï¼å°±ä¼å½±åç½ç»éä¿¡çæçï¼ä»èå¢å ç³»ç»çååºæ¶é´ã\n * åºååç¼ç¨éå¶ï¼\n   * JDK åºååä¸å®è¦å®ç° Serializable æ¥å£ã\n   * JDK åºååéè¦å³æ³¨ serialVersionUIDã\n\n\n# äºè¿å¶åºåå\n\nä¸èè¯¦ç»ä»ç»äº JDK åºååæ¹å¼ï¼ç±äºå¶æ§è½ä¸é«ï¼ä¸å­å¨å¾å¤å¶ä»é®é¢ï¼æä»¥ä¸çæäºå¾å¤å¶ä»ä¼ç§çäºè¿å¶åºåååºã\n\n\n# Protobuf\n\nProtobuf æ¯ Google å¬å¸åé¨çæ··åè¯­è¨æ°æ®æ åï¼æ¯ä¸ç§è½»ä¾¿ãé«æçç»æåæ°æ®å­å¨æ ¼å¼ï¼å¯ä»¥ç¨äºç»æåæ°æ®åºååï¼æ¯æ JavaãPythonãC++ãGo ç­è¯­è¨ãProtobuf ä½¿ç¨çæ¶åéè¦å®ä¹ IDLï¼Interface description languageï¼ï¼ç¶åä½¿ç¨ä¸åè¯­è¨ç IDL ç¼è¯å¨ï¼çæåºååå·¥å·ç±»ã\n\nä¼ç¹ï¼\n\n * åºåååä½ç§¯ç¸æ¯ JSONãHessian å°å¾å¤\n * åºååååºååéåº¦å¾å¿«ï¼ä¸éè¦éè¿åå°è·åç±»å\n * è¯­è¨åå¹³å°æ å³ï¼åºäº IDLï¼ï¼IDL è½æ¸æ°å°æè¿°è¯­ä¹ï¼æä»¥è¶³ä»¥å¸®å©å¹¶ä¿è¯åºç¨ç¨åºä¹é´çç±»åä¸ä¼ä¸¢å¤±ï¼æ éç±»ä¼¼ XML è§£æå¨\n * æ¶æ¯æ ¼å¼åçº§åå¼å®¹æ§ä¸éï¼å¯ä»¥åå°ååå¼å®¹\n * æ¯æ Java, C++, Python ä¸ç§è¯­è¨\n\nç¼ºç¹ï¼\n\n * Protobuf å¯¹äºå·æåå°åå¨æè½åçè¯­è¨æ¥è¯´ï¼ç¨èµ·æ¥å¾è´¹å²ã\n\n\n# Thrift\n\n> Thrift æ¯ apache å¼æºé¡¹ç®ï¼æ¯ä¸ä¸ªç¹å¯¹ç¹ç RPC å®ç°ã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * æ¯æå¤ç§è¯­è¨ï¼ç®åæ¯æ 28 ç§è¯­è¨ï¼å¦ï¼C++ãgoãJavaãPhpãPythonãRuby ç­ç­ï¼ã\n * ä½¿ç¨äºç»å»ºå¤§åæ°æ®äº¤æ¢åå­å¨å·¥å·ï¼å¯¹äºå¤§åç³»ç»ä¸­çåé¨æ°æ®ä¼ è¾ï¼ç¸å¯¹äº Json å xml å¨æ§è½ä¸åä¼ è¾å¤§å°ä¸é½æææ¾çä¼å¿ã\n * æ¯æä¸ç§æ¯è¾å¸åçç¼ç æ¹å¼ï¼éç¨äºè¿å¶ç¼ç ï¼åç¼©äºè¿å¶ç¼ç ï¼ä¼åçå¯éå­æ®µåç¼©ç¼è§£ç ï¼ã\n\n\n# Hessian\n\nHessian æ¯å¨æç±»åãäºè¿å¶ãç´§åçï¼å¹¶ä¸å¯è·¨è¯­è¨ç§»æ¤çä¸ç§åºååæ¡æ¶ãHessian åè®®è¦æ¯ JDKãJSON æ´å ç´§åï¼æ§è½ä¸è¦æ¯ JDKãJSON åºååé«æå¾å¤ï¼èä¸çæçå­èæ°ä¹æ´å°ã\n\nRPC æ¡æ¶ Dubbo å°±æ¯æ Thrift å Hessionã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * æ¯æå¤ç§è¯­è¨ãå¦ï¼JavaãPythonãC++ãC#ãPHPãRuby ç­ã\n * ç¸å¯¹å¶ä»äºè¿å¶åºåååºè¾æ¢ã\n\nHessian æ¬èº«ä¹æé®é¢ï¼å®æ¹çæ¬å¯¹ Java éé¢ä¸äºå¸¸è§å¯¹è±¡çç±»åä¸æ¯æï¼\n\n * Linked ç³»åï¼LinkedHashMapãLinkedHashSet ç­ï¼ä½æ¯å¯ä»¥éè¿æ©å± CollectionDeserializer ç±»ä¿®å¤ï¼\n * Locale ç±»ï¼å¯ä»¥éè¿æ©å± ContextSerializerFactory ç±»ä¿®å¤ï¼\n * Byte/Short ååºååçæ¶ååæ Integerã\n\n\n# Kryo\n\n> Kryo æ¯ç¨äº Java çå¿«éé«æçäºè¿å¶å¯¹è±¡å¾åºååæ¡æ¶ãKryo è¿å¯ä»¥æ§è¡èªå¨çæ·±æ·è´åæµæ·è´ã è¿æ¯ä»å¯¹è±¡å°å¯¹è±¡çç´æ¥å¤å¶ï¼èä¸æ¯ä»å¯¹è±¡å°å­èçå¤å¶ã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * éåº¦å¿«ï¼åºååä½ç§¯å°\n * å®æ¹ä¸æ¯æ Java ä»¥å¤çå¶ä»è¯­è¨\n\n\n# FST\n\n> FST æ¯ä¸ä¸ª Java å®ç°äºè¿å¶åºåååºã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * è¿ä¹äº 100% å¼å®¹ JDK åºååï¼ä¸æ¯ JDK ååºååæ¹å¼å¿« 10 å\n * 2.17 å¼å§ä¸ Android å¼å®¹\n * ï¼å¯éï¼2.29 å¼å§æ¯æå°ä»»ä½å¯åºååçå¯¹è±¡å¾ç¼ç /è§£ç ä¸º JSONï¼åæ¬å±äº«å¼ç¨ï¼\n\n\n# JSON åºåå\n\né¤äºäºè¿å¶åºååæ¹å¼ï¼è¿å¯ä»¥éæ© JSON åºååãå®çæ§è½æ¯äºè¿å¶åºååæ¹å¼å·®ï¼ä½æ¯å¯è¯»æ§éå¸¸å¥½ï¼ä¸å¹¿æ³åºç¨äº Web é¢åã\n\n\n# JSON æ¯ä»ä¹\n\nJSON èµ·æºäº 1999 å¹´ç JS è¯­è¨è§è ECMA262 çä¸ä¸ªå­éï¼å³ 15.12 ç« èæè¿°äºæ ¼å¼ä¸è§£æï¼ï¼åæ¥ 2003 å¹´ä½ä¸ºä¸ä¸ªæ°æ®æ ¼å¼ECMA404ï¼å¾å§çåºå·æä¸æï¼ï¼åå¸ã 2006 å¹´ï¼ä½ä¸º rfc4627 åå¸ï¼è¿æ¶è§èå¢å å° 18 é¡µï¼å»ææ²¡ç¨çé¨åï¼åé¡µä¸å°ã\n\nJSON çåºç¨å¾å¹¿æ³ï¼è¿éæè¶è¿ 100 ç§è¯­è¨ä¸ç JSON åºï¼json.orgã\n\næ´å¤çå¯ä»¥åèè¿éï¼å³äº json çä¸åã\n\n\n# JSON æ å\n\nè¿ä¼°è®¡æ¯æç®åæ åè§èä¹ä¸ï¼\n\n * åªæä¸¤ç§ç»æï¼å¯¹è±¡åçé®å¼å¯¹éåç»æåæ°ç»ï¼å¯¹è±¡ç¨ {} è¡¨ç¤ºãåé¨æ¯ "key":"value"ï¼æ°ç»ç¨ [] è¡¨ç¤ºï¼ä¸åå¼ç¨éå·åå¼\n * åºæ¬æ°å¼æ 7 ä¸ªï¼ false / null / true / object / array / number / string\n * åå ä¸ç»æå¯ä»¥åµå¥ï¼è¿èå¯ä»¥ç¨æ¥è¡¨è¾¾å¤æçæ°æ®\n * ä¸ä¸ªç®åå®ä¾ï¼\n\n{\n  "Image": {\n    "Width": 800,\n    "Height": 600,\n    "Title": "View from 15th Floor",\n    "Thumbnail": {\n      "Url": "http://www.example.com/image/481989943",\n      "Height": 125,\n      "Width": "100"\n    },\n    "IDs": [116, 943, 234, 38793]\n  }\n}\n\n\n> æ©å±éè¯»ï¼\n> \n>  * http://www.json.org/json-zh.html - å¾æå¹¶èä»ç» json æ°æ®å½¢å¼\n> \n>  * json ç RFC ææ¡£\n\n\n# JSON ä¼ç¼ºç¹\n\nJSON ä¼ç¹\n\n * åºäºçº¯ææ¬ï¼æä»¥å¯¹äºäººç±»éè¯»æ¯å¾åå¥½çã\n * è§èç®åï¼æä»¥å®¹æå¤çï¼å¼ç®±å³ç¨ï¼ç¹å«æ¯ JS ç±»ç ECMA èæ¬éæ¯åå»ºæ¯æçï¼å¯ä»¥ç´æ¥ä½ä¸ºå¯¹è±¡ä½¿ç¨ã\n * å¹³å°æ å³æ§ï¼å ä¸ºç±»ååç»æé½æ¯å¹³å°æ å³çï¼èä¸å¥½å¤çï¼å®¹æå®ç°ä¸åè¯­è¨çå¤çç±»åºï¼å¯ä»¥ä½ä¸ºå¤ä¸ªä¸åå¼æç³»ç»ä¹é´çæ°æ®ä¼ è¾æ ¼å¼åè®®ï¼ç¹å«æ¯å¨ HTTP/REST ä¸çæ°æ®æ ¼å¼ã\n\nJSON ç¼ºç¹\n\n * æ§è½ä¸è¬ï¼ææ¬è¡¨ç¤ºçæ°æ®ä¸è¬æ¥è¯´æ¯äºè¿å¶å¤§å¾å¤ï¼å¨æ°æ®ä¼ è¾ä¸åè§£æå¤çä¸é½è¦æ´å½±åæ§è½ã\n * ç¼ºä¹ schemaï¼è·åæ¯ææ¬æ°æ®æ ¼å¼ç XML æ¯ï¼å¨ç±»åçä¸¥æ ¼æ§åä¸°å¯æ§ä¸è¦å·®å¾å¤ãXML å¯ä»¥åç± XSD æ DTD æ¥å®ä¹å¤æçæ ¼å¼ï¼å¹¶ç±æ­¤æ¥éªè¯ XML ææ¡£æ¯å¦ç¬¦åæ ¼å¼è¦æ±ï¼çè³è¿ä¸æ­¥çï¼å¯ä»¥åºäº XSD æ¥çæå·ä½è¯­è¨çæä½ä»£ç ï¼ä¾å¦ apache xmlbeansãå¹¶ä¸è¿äºå·¥å·ç»åå°ä¸èµ·ï¼å½¢æä¸å¥åºå¤§ççæï¼ä¾å¦åºäº XML å¯ä»¥å®ç° SOAP å WSDLï¼ä¸ç³»åç ws-*è§èãä½æ¯æä»¬ä¹å¯ä»¥çå° JSON å¨ç¼ºä¹è§èçæåµä¸ï¼å®éä¸ææ´å¤§ä¸äºççµæ´»æ§ï¼ç¹å«æ¯è¿å¹´æ¥ REST çå¿«éåå±ï¼å·²ç»æä¸äº schema ç¸å³çåå±(ä¾å¦çè§£ JSON Schemaï¼ä½¿ç¨ JSON Schemaï¼ å¨çº¿ schema æµè¯)ï¼ä¹æç±»ä¼¼äº WSDL çWADLåºç°ã\n\n\n# JSON åº\n\nJava ä¸­æ¯è¾æµè¡ç JSON åºæï¼\n\n * Fastjson - é¿éå·´å·´å¼åç JSON åºï¼æ§è½ååä¼ç§ã\n * Jackson - ç¤¾åºååæ´»è·ä¸æ´æ°éåº¦å¾å¿«ãSpring æ¡æ¶é»è®¤ JSON åºã\n * Gson - è°·æ­å¼åç JSON åºï¼ç®ååè½æå¨ç JSON åº ã\n\nä»æ§è½ä¸æ¥çï¼ä¸è¬æåµä¸ï¼Fastjson > Jackson > Gson\n\n\n# JSON ç¼ç æå\n\n> éµå¾ªå¥½çè®¾è®¡ä¸ç¼ç é£æ ¼ï¼è½æåè§£å³ 80%çé®é¢ï¼ä¸ªäººæ¨è Google JSON é£æ ¼æåã\n> \n>  * è±æçGoogle JSON Style Guideï¼https://google.github.io/styleguide/jsoncstyleguide.xml\n>  * ä¸­æçGoogle JSON é£æ ¼æåï¼https://github.com/darcyliu/google-styleguide/blob/master/JSONStyleGuide.md\n\nç®åæå½å¦ä¸ï¼\n\n * å±æ§ååå¼é½æ¯ç¨åå¼å·ï¼ä¸è¦ææ³¨éåå°å¯¹è±¡éé¢ï¼å¯¹è±¡æ°æ®è¦ç®æ´\n * ä¸è¦éæç»æååç»å¯¹è±¡ï¼æ¨èæ¯ç¨æå¹³åæ¹å¼ï¼å±æ¬¡ä¸è¦å¤ªå¤æ\n * å½åæ¹å¼è¦ææä¹ï¼æ¯å¦åå¤æ°è¡¨ç¤º\n * é©¼å³°å¼å½åï¼éµå¾ª Bean è§è\n * ä½¿ç¨çæ¬æ¥æ§å¶åæ´å²çª\n * å¯¹äºä¸äºå³é®å­ï¼ä¸è¦æ¿æ¥å key\n * å¦æä¸ä¸ªå±æ§æ¯å¯éçæèåå«ç©ºå¼æ null å¼ï¼èèä» JSON ä¸­å»æè¯¥å±æ§ï¼é¤éå®çå­å¨æå¾å¼ºçè¯­ä¹åå \n * åºååæä¸¾ç±»åæ¶ï¼ä½¿ç¨ name èä¸æ¯ value\n * æ¥æè¦ç¨æ åæ ¼å¼å¤ç\n * è®¾è®¡å¥½éç¨çåé¡µåæ°\n * è®¾è®¡å¥½å¼å¸¸å¤ç\n\nJSON APIä¸ Google JSON é£æ ¼æåæå¾å¤å¯ä»¥ç¸äºåç§ä¹å¤ã\n\nJSON APIæ¯æ°æ®äº¤äºè§èï¼ç¨ä»¥å®ä¹å®¢æ·ç«¯å¦ä½è·åä¸ä¿®æ¹èµæºï¼ä»¥åæå¡å¨å¦ä½ååºå¯¹åºè¯·æ±ã\n\nJSON API è®¾è®¡ç¨æ¥æå°åè¯·æ±çæ°éï¼ä»¥åå®¢æ·ç«¯ä¸æå¡å¨é´ä¼ è¾çæ°æ®éãå¨é«æå®ç°çåæ¶ï¼æ éçºç²å¯è¯»æ§ãçµæ´»æ§åå¯åç°æ§ã\n\n\n# åºååææ¯éå\n\nå¸é¢ä¸æå¦æ­¤å¤çåºååææ¯ï¼é£ä¹æä»¬å¨åºç¨æ¶å¦ä½éæ©å¢?\n\nåºååææ¯éåï¼éè¦èéçç»´åº¦ï¼æ ¹æ®éè¦æ§ä»é«å°ä½ï¼ä¾æ¬¡æï¼\n\n * å®å¨æ§ï¼æ¯å¦å­å¨æ¼æ´ãå¦æå­å¨æ¼æ´ï¼å°±æè¢«æ»å»çå¯è½æ§ã\n * å¼å®¹æ§ï¼çæ¬åçº§åçå¼å®¹æ§æ¯å¦å¾å¥½ï¼æ¯å¦æ¯ææ´å¤çå¯¹è±¡ç±»åï¼æ¯å¦æ¯è·¨å¹³å°ãè·¨è¯­è¨çãæå¡è°ç¨çç¨³å®æ§ä¸å¯é æ§ï¼è¦æ¯æå¡çæ§è½æ´å éè¦ã\n * æ§è½\n   * æ¶é´å¼éï¼åºååãååºååçèæ¶æ§è½èªç¶è¶å°è¶å¥½ã\n   * ç©ºé´å¼éï¼åºåååçæ°æ®è¶å°è¶å¥½ï¼è¿æ ·ç½ç»ä¼ è¾æçå°±é«ã\n * æç¨æ§ï¼ç±»åºæ¯å¦è½»éåï¼API æ¯å¦ç®åææã\n\né´äºä»¥ä¸çèéï¼åºååææ¯çéåå»ºè®®å¦ä¸ï¼\n\n * JDK åºååï¼æ§è½è¾å·®ï¼ä¸æå¾å¤ä½¿ç¨éå¶ï¼ä¸å»ºè®®ä½¿ç¨ã\n * ThriftãProtobufï¼éç¨äºå¯¹æ§è½ææï¼å¯¹å¼åä½éªè¦æ±ä¸é«ã\n * Hessianï¼éç¨äºå¯¹å¼åä½éªææï¼æ§è½æè¦æ±ã\n * JacksonãGsonãFastjsonï¼éç¨äºå¯¹åºåååçæ°æ®è¦æ±æè¯å¥½çå¯è¯»æ§ï¼è½¬ä¸º json ãxml å½¢å¼ï¼ã\n\n\n# åèèµæ\n\n * Java ç¼ç¨ææ³\n * Java æ ¸å¿ææ¯ï¼å· 1ï¼\n * ãJava æ§è½è°ä¼å®æã\n * JDK åºååçé«çº§è®¤è¯\n * http://www.hollischuang.com/archives/1140\n * http://www.codenuclear.com/serialization-deserialization-java/\n * http://www.blogjava.net/jiangshachina/archive/2012/02/13/369898.html\n * https://agapple.iteye.com/blog/859052',normalizedContent:'# æ·±å¥çè§£ java åºåå\n\n> å³é®è¯ï¼serializableãserialversionuidãtransientãexternalizableãwriteobjectãreadobject\n\n\n\n\n# åºååç®ä»\n\nç±äºï¼ç½ç»ä¼ è¾çæ°æ®å¿é¡»æ¯äºè¿å¶æ°æ®ï¼ä½è°ç¨æ¹è¯·æ±çåºå¥åæ°é½æ¯å¯¹è±¡ãå¯¹è±¡æ¯ä¸è½ç´æ¥å¨ç½ç»ä¸­ä¼ è¾çï¼æä»¥éè¦æåæå®è½¬æå¯ä¼ è¾çäºè¿å¶ï¼å¹¶ä¸è¦æ±è½¬æ¢ç®æ³æ¯å¯éçã\n\n * åºååï¼serializeï¼ï¼åºååæ¯å°å¯¹è±¡è½¬æ¢ä¸ºäºè¿å¶æ°æ®ã\n * ååºååï¼deserializeï¼ï¼ååºååæ¯å°äºè¿å¶æ°æ®è½¬æ¢ä¸ºå¯¹è±¡ã\n\n\n\nåºååç¨é\n\n * åºååå¯ä»¥å°å¯¹è±¡çå­èåºåæä¹åââä¿å­å¨åå­ãæä»¶ãæ°æ®åºä¸­ã\n * å¨ç½ç»ä¸ä¼ éå¯¹è±¡çå­èåºåã\n * rmi(è¿ç¨æ¹æ³è°ç¨)\n\n\n# jdk åºåå\n\njdk ä¸­åç½®äºä¸ç§åºååæ¹å¼ã\n\n\n# objectinputstream å objectoutputstream\n\njava éè¿å¯¹è±¡è¾å¥è¾åºæµæ¥å®ç°åºåååååºååï¼\n\n * java.io.objectoutputstream ç±»ç writeobject() æ¹æ³å¯ä»¥å®ç°åºååï¼\n * java.io.objectinputstream ç±»ç readobject() æ¹æ³ç¨äºå®ç°ååºååã\n\nåºåååååºååç¤ºä¾ï¼\n\npublic class serializedemo01 {\n    enum sex {\n        male,\n        female\n    }\n\n\n    static class person implements serializable {\n        private static final long serialversionuid = 1l;\n        private string name = null;\n        private integer age = null;\n        private sex sex;\n\n        public person() { }\n\n        public person(string name, integer age, sex sex) {\n            this.name = name;\n            this.age = age;\n            this.sex = sex;\n        }\n\n        @override\n        public string tostring() {\n            return "person{" + "name=\'" + name + \'\\\'\' + ", age=" + age + ", sex=" + sex + \'}\';\n        }\n    }\n\n    /**\n     * åºåå\n     */\n    private static void serialize(string filename) throws ioexception {\n        file f = new file(filename); // å®ä¹ä¿å­è·¯å¾\n        outputstream out = new fileoutputstream(f); // æä»¶è¾åºæµ\n        objectoutputstream oos = new objectoutputstream(out); // å¯¹è±¡è¾åºæµ\n        oos.writeobject(new person("jack", 30, sex.male)); // ä¿å­å¯¹è±¡\n        oos.close();\n        out.close();\n    }\n\n    /**\n     * ååºåå\n     */\n    private static void deserialize(string filename) throws ioexception, classnotfoundexception {\n        file f = new file(filename); // å®ä¹ä¿å­è·¯å¾\n        inputstream in = new fileinputstream(f); // æä»¶è¾å¥æµ\n        objectinputstream ois = new objectinputstream(in); // å¯¹è±¡è¾å¥æµ\n        object obj = ois.readobject(); // è¯»åå¯¹è±¡\n        ois.close();\n        in.close();\n        system.out.println(obj);\n    }\n\n    public static void main(string[] args) throws ioexception, classnotfoundexception {\n        final string filename = "d:/text.dat";\n        serialize(filename);\n        deserialize(filename);\n    }\n}\n// output:\n// person{name=\'jack\', age=30, sex=male}\n\n\njdk çåºååè¿ç¨æ¯ææ ·å®æçå¢ï¼\n\n\n\nå¾æ¥èª rpc å®æä¸æ ¸å¿åç - åºåå\n\nåºååè¿ç¨å°±æ¯å¨è¯»åå¯¹è±¡æ°æ®çæ¶åï¼ä¸æ­å å¥ä¸äºç¹æ®åéç¬¦ï¼è¿äºç¹æ®åéç¬¦ç¨äºå¨ååºååè¿ç¨ä¸­æªæ­ç¨ï¼è¿å°±åæ¯æç« ä¸­çæ ç¹ç¬¦å·è¢«ç¨äºæ­å¥ä¸æ ·ã\n\n * å¤´é¨æ°æ®ç¨æ¥å£°æåºåååè®®ãåºååçæ¬ï¼ç¨äºé«ä½çæ¬ååå¼å®¹ã\n * å¯¹è±¡æ°æ®ä¸»è¦åæ¬ç±»åãç­¾åãå±æ§åãå±æ§ç±»ååå±æ§å¼ï¼å½ç¶è¿æå¼å¤´ç»å°¾ç­æ°æ®ï¼é¤äºå±æ§å¼å±äºçæ­£çå¯¹è±¡å¼ï¼å¶ä»é½æ¯ä¸ºäºååºååç¨çåæ°æ®ã\n * å­å¨å¯¹è±¡å¼ç¨ãç»§æ¿çæåµä¸ï¼å°±æ¯éå½éåâåå¯¹è±¡âé»è¾ã\n\n> ð æ³¨æï¼ä½¿ç¨ java å¯¹è±¡åºååï¼å¨ä¿å­å¯¹è±¡æ¶ï¼ä¼æå¶ç¶æä¿å­ä¸ºä¸ç»å­èï¼å¨æªæ¥ï¼åå°è¿äºå­èç»è£æå¯¹è±¡ãå¿é¡»æ³¨æå°æ¯ï¼å¯¹è±¡åºååä¿å­çæ¯å¯¹è±¡çâç¶æâï¼å³å®çæååéãç±æ­¤å¯ç¥ï¼å¯¹è±¡åºååä¸ä¼å³æ³¨ç±»ä¸­çéæåéã\n\n\n# serializable æ¥å£\n\nè¢«åºååçç±»å¿é¡»å±äº enumãarray å serializable ç±»åå¶ä¸­çä»»ä½ä¸ç§ï¼å¦åå°æåº notserializableexception å¼å¸¸ãè¿æ¯å ä¸ºï¼å¨åºååæä½è¿ç¨ä¸­ä¼å¯¹ç±»åè¿è¡æ£æ¥ï¼å¦æä¸æ»¡è¶³åºååç±»åè¦æ±ï¼å°±ä¼æåºå¼å¸¸ã\n\nãç¤ºä¾ãnotserializableexception éè¯¯\n\npublic class unserializedemo {\n    static class person { // å¶ä»åå®¹ç¥ }\n    // å¶ä»åå®¹ç¥\n}\n\n\nè¾åºï¼ç»æå°±æ¯åºç°å¦ä¸å¼å¸¸ä¿¡æ¯ã\n\nexception in thread "main" java.io.notserializableexception:\n...\n\n\n# serialversionuid\n\nè¯·æ³¨æ serialversionuid å­æ®µï¼ä½ å¯ä»¥å¨ java ä¸ççæ æ°ç±»ä¸­çå°è¿ä¸ªå­æ®µã\n\nserialversionuid æä»ä¹ä½ç¨ï¼å¦ä½ä½¿ç¨ serialversionuidï¼\n\nserialversionuid æ¯ java ä¸ºæ¯ä¸ªåºååç±»äº§çççæ¬æ è¯ãå®å¯ä»¥ç¨æ¥ä¿è¯å¨ååºåæ¶ï¼åéæ¹åéçåæ¥åæ¹æ¥æ¶çæ¯å¯å¼å®¹çå¯¹è±¡ãå¦ææ¥æ¶æ¹æ¥æ¶çç±»ç serialversionuid ä¸åéæ¹åéç serialversionuid ä¸ä¸è´ï¼ä¼æåº invalidclassexceptionã\n\nå¦æå¯åºååç±»æ²¡ææ¾å¼å£°æ serialversionuidï¼ååºååè¿è¡æ¶å°åºäºè¯¥ç±»çåä¸ªæ¹é¢è®¡ç®è¯¥ç±»çé»è®¤ serialversionuid å¼ãå°½ç®¡è¿æ ·ï¼è¿æ¯å»ºè®®å¨æ¯ä¸ä¸ªåºååçç±»ä¸­æ¾å¼æå® serialversionuid çå¼ãå ä¸ºä¸åç jdk ç¼è¯å¾å¯è½ä¼çæä¸åç serialversionuid é»è®¤å¼ï¼ä»èå¯¼è´å¨ååºååæ¶æåº invalidclassexceptions å¼å¸¸ã\n\nserialversionuid å­æ®µå¿é¡»æ¯ static final long ç±»åã\n\næä»¬æ¥ä¸¾ä¸ªä¾å­ï¼\n\nï¼1ï¼æä¸ä¸ªå¯åºååç±» person\n\npublic class person implements serializable {\n    private static final long serialversionuid = 1l;\n    private string name;\n    private integer age;\n    private string address;\n    // æé æ¹æ³ãgetãset æ¹æ³ç¥\n}\n\n\nï¼2ï¼å¼åè¿ç¨ä¸­ï¼å¯¹ person åäºä¿®æ¹ï¼å¢å äºä¸ä¸ªå­æ®µ emailï¼å¦ä¸ï¼\n\npublic class person implements serializable {\n    private static final long serialversionuid = 1l;\n    private string name;\n    private integer age;\n    private string address;\n    private string email;\n    // æé æ¹æ³ãgetãset æ¹æ³ç¥\n}\n\n\nç±äºè¿ä¸ªç±»åèçæ¬ä¸å¼å®¹ï¼æä»¬éè¦ä¿®æ¹çæ¬å·ï¼\n\nprivate static final long serialversionuid = 2l;\n\n\nåæ¬¡è¿è¡ååºååï¼åä¼æåº invalidclassexception å¼å¸¸ã\n\nç»¼ä¸æè¿°ï¼æä»¬å¤§æ¦å¯ä»¥æ¸æ¥ï¼serialversionuid ç¨äºæ§å¶åºååçæ¬æ¯å¦å¼å®¹ãè¥æä»¬è®¤ä¸ºä¿®æ¹çå¯åºååç±»æ¯ååå¼å®¹çï¼åä¸ä¿®æ¹ serialversionuidã\n\n# é»è®¤åºååæºå¶\n\nå¦æä»ä»åªæ¯è®©æä¸ªç±»å®ç° serializable æ¥å£ï¼èæ²¡æå¶å®ä»»ä½å¤ççè¯ï¼é£ä¹å°±ä¼ä½¿ç¨é»è®¤åºååæºå¶ã\n\nä½¿ç¨é»è®¤æºå¶ï¼å¨åºååå¯¹è±¡æ¶ï¼ä¸ä»ä¼åºååå½åå¯¹è±¡æ¬èº«ï¼è¿ä¼å¯¹å¶ç¶ç±»çå­æ®µä»¥åè¯¥å¯¹è±¡å¼ç¨çå¶å®å¯¹è±¡ä¹è¿è¡åºååãåæ ·å°ï¼è¿äºå¶å®å¯¹è±¡å¼ç¨çå¦å¤å¯¹è±¡ä¹å°è¢«åºååï¼ä»¥æ­¤ç±»æ¨ãæä»¥ï¼å¦æä¸ä¸ªå¯¹è±¡åå«çæååéæ¯å®¹å¨ç±»å¯¹è±¡ï¼èè¿äºå®¹å¨æå«æçåç´ ä¹æ¯å®¹å¨ç±»å¯¹è±¡ï¼é£ä¹è¿ä¸ªåºååçè¿ç¨å°±ä¼è¾å¤æï¼å¼éä¹è¾å¤§ã\n\n> ð æ³¨æï¼è¿éçç¶ç±»åå¼ç¨å¯¹è±¡æ¢ç¶è¦è¿è¡åºååï¼é£ä¹å®ä»¬å½ç¶ä¹è¦æ»¡è¶³åºååè¦æ±ï¼è¢«åºååçç±»å¿é¡»å±äº enumãarray å serializable ç±»åå¶ä¸­çä»»ä½ä¸ç§ã\n\n# jdk åºååè¦ç¹\n\njava çåºååè½ä¿è¯å¯¹è±¡ç¶æçæä¹ä¿å­ï¼ä½æ¯éå°ä¸äºå¯¹è±¡ç»æå¤æçæåµè¿æ¯é¾ä»¥å¤çï¼è¿éå½çº³ä¸ä¸ï¼\n\n * ç¶ç±»æ¯ serializableï¼ææå­ç±»é½å¯ä»¥è¢«åºååã\n * å­ç±»æ¯ serializable ï¼ç¶ç±»ä¸æ¯ï¼åå­ç±»å¯ä»¥æ­£ç¡®åºååï¼ä½ç¶ç±»çå±æ§ä¸ä¼è¢«åºååï¼ä¸æ¥éï¼æ°æ®ä¸¢å¤±ï¼ã\n * å¦æåºååçå±æ§æ¯å¯¹è±¡ï¼åè¿ä¸ªå¯¹è±¡ä¹å¿é¡»æ¯ serializable ï¼å¦åæ¥éã\n * ååºååæ¶ï¼å¦æå¯¹è±¡çå±æ§æä¿®æ¹æå åï¼åä¿®æ¹çé¨åå±æ§ä¼ä¸¢å¤±ï¼ä½ä¸ä¼æ¥éã\n * ååºååæ¶ï¼å¦æ serialversionuid è¢«ä¿®æ¹ï¼åååºååä¼å¤±è´¥ã\n\n# transient\n\nå¨ç°å®åºç¨ä¸­ï¼æäºæ¶åä¸è½ä½¿ç¨é»è®¤åºååæºå¶ãæ¯å¦ï¼å¸æå¨åºååè¿ç¨ä¸­å¿½ç¥ææææ°æ®ï¼æèç®ååºååè¿ç¨ãä¸é¢å°ä»ç»è¥å¹²å½±ååºååçæ¹æ³ã\n\nåºååæ¶ï¼é»è®¤åºååæºå¶ä¼å¿½ç¥è¢«å£°æä¸º transient çå­æ®µï¼è¯¥å­æ®µçåå®¹å¨åºåååæ æ³è®¿é®ã\n\næä»¬å° serializedemo01 ç¤ºä¾ä¸­çåé¨ç±» person ç age å­æ®µå£°æä¸º transientï¼å¦ä¸æç¤ºï¼\n\npublic class serializedemo02 {\n    static class person implements serializable {\n        transient private integer age = null;\n        // å¶ä»åå®¹ç¥\n    }\n    // å¶ä»åå®¹ç¥\n}\n// output:\n// name: jack, age: null, sex: male\n\n\nä»è¾åºç»æå¯ä»¥çåºï¼age å­æ®µæ²¡æè¢«åºååã\n\n\n# externalizable æ¥å£\n\næ è®ºæ¯ä½¿ç¨ transient å³é®å­ï¼è¿æ¯ä½¿ç¨ writeobject() å readobject() æ¹æ³ï¼å¶å®é½æ¯åºäº serializable æ¥å£çåºååã\n\njdk ä¸­æä¾äºå¦ä¸ä¸ªåºååæ¥å£--externalizableã\n\nå¯åºååç±»å®ç° externalizable æ¥å£ä¹åï¼åºäº serializable æ¥å£çé»è®¤åºååæºå¶å°±ä¼å¤±æã\n\næä»¬æ¥åºäº serializedemo02 åæ¬¡åä¸äºæ¹å¨ï¼ä»£ç å¦ä¸ï¼\n\npublic class externalizedemo01 {\n    static class person implements externalizable {\n        transient private integer age = null;\n        // å¶ä»åå®¹ç¥\n\n        private void writeobject(objectoutputstream out) throws ioexception {\n            out.defaultwriteobject();\n            out.writeint(age);\n        }\n\n        private void readobject(objectinputstream in) throws ioexception, classnotfoundexception {\n            in.defaultreadobject();\n            age = in.readint();\n        }\n\n        @override\n        public void writeexternal(objectoutput out) throws ioexception { }\n\n        @override\n        public void readexternal(objectinput in) throws ioexception, classnotfoundexception { }\n    }\n     // å¶ä»åå®¹ç¥\n}\n// output:\n// call person()\n// name: null, age: null, sex: null\n\n\nä»è¯¥ç»æï¼ä¸æ¹é¢å¯ä»¥çåº person å¯¹è±¡ä¸­ä»»ä½ä¸ä¸ªå­æ®µé½æ²¡æè¢«åºååãå¦ä¸æ¹é¢ï¼å¦æç»å¿çè¯ï¼è¿å¯ä»¥åç°è¿æ­¤æ¬¡åºååè¿ç¨è°ç¨äº person ç±»çæ åæé æ¹æ³ã\n\n * externalizable ç»§æ¿äº serializableï¼å®å¢æ·»äºä¸¤ä¸ªæ¹æ³ï¼writeexternal() ä¸ readexternal()ãè¿ä¸¤ä¸ªæ¹æ³å¨åºåååååºååè¿ç¨ä¸­ä¼è¢«èªå¨è°ç¨ï¼ä»¥ä¾¿æ§è¡ä¸äºç¹æ®æä½ãå½ä½¿ç¨è¯¥æ¥å£æ¶ï¼åºååçç»èéè¦ç±ç¨åºåå»å®æãå¦ä¸æç¤ºçä»£ç ï¼ç±äº writeexternal() ä¸ readexternal() æ¹æ³æªä½ä»»ä½å¤çï¼é£ä¹è¯¥åºååè¡ä¸ºå°ä¸ä¼ä¿å­/è¯»åä»»ä½ä¸ä¸ªå­æ®µãè¿ä¹å°±æ¯ä¸ºä»ä¹è¾åºç»æä¸­ææå­æ®µçå¼åä¸ºç©ºã\n * å¦å¤ï¼è¥ä½¿ç¨ externalizable è¿è¡åºååï¼å½è¯»åå¯¹è±¡æ¶ï¼ä¼è°ç¨è¢«åºååç±»çæ åæé æ¹æ³å»åå»ºä¸ä¸ªæ°çå¯¹è±¡ï¼ç¶ååå°è¢«ä¿å­å¯¹è±¡çå­æ®µçå¼åå«å¡«åå°æ°å¯¹è±¡ä¸­ãè¿å°±æ¯ä¸ºä»ä¹å¨æ­¤æ¬¡åºååè¿ç¨ä¸­ person ç±»çæ åæé æ¹æ³ä¼è¢«è°ç¨ãç±äºè¿ä¸ªåå ï¼å®ç° externalizable æ¥å£çç±»å¿é¡»è¦æä¾ä¸ä¸ªæ åçæé æ¹æ³ï¼ä¸å®çè®¿é®æéä¸º publicã\n\nå¯¹ä¸è¿° person ç±»ä½è¿ä¸æ­¥çä¿®æ¹ï¼ä½¿å¶è½å¤å¯¹ name ä¸ age å­æ®µè¿è¡åºååï¼ä½è¦å¿½ç¥æ gender å­æ®µï¼å¦ä¸ä»£ç æç¤ºï¼\n\npublic class externalizedemo02 {\n    static class person implements externalizable {\n        transient private integer age = null;\n        // å¶ä»åå®¹ç¥\n\n        private void writeobject(objectoutputstream out) throws ioexception {\n            out.defaultwriteobject();\n            out.writeint(age);\n        }\n\n        private void readobject(objectinputstream in) throws ioexception, classnotfoundexception {\n            in.defaultreadobject();\n            age = in.readint();\n        }\n\n        @override\n        public void writeexternal(objectoutput out) throws ioexception {\n            out.writeobject(name);\n            out.writeint(age);\n        }\n\n        @override\n        public void readexternal(objectinput in) throws ioexception, classnotfoundexception {\n            name = (string) in.readobject();\n            age = in.readint();\n        }\n    }\n     // å¶ä»åå®¹ç¥\n}\n// output:\n// call person()\n// name: jack, age: 30, sex: null\n\n\n# externalizable æ¥å£çæ¿ä»£æ¹æ³\n\nå®ç° externalizable æ¥å£å¯ä»¥æ§å¶åºåååååºååçç»èãå®æä¸ä¸ªæ¿ä»£æ¹æ³ï¼å®ç° serializable æ¥å£ï¼å¹¶æ·»å  writeobject(objectoutputstream out) ä¸ readobject(objectinputstream in) æ¹æ³ãåºåååååºååè¿ç¨ä¸­ä¼èªå¨åè°è¿ä¸¤ä¸ªæ¹æ³ã\n\nç¤ºä¾å¦ä¸æç¤ºï¼\n\npublic class serializedemo03 {\n    static class person implements serializable {\n        transient private integer age = null;\n        // å¶ä»åå®¹ç¥\n\n        private void writeobject(objectoutputstream out) throws ioexception {\n            out.defaultwriteobject();\n            out.writeint(age);\n        }\n\n        private void readobject(objectinputstream in) throws ioexception, classnotfoundexception {\n            in.defaultreadobject();\n            age = in.readint();\n        }\n        // å¶ä»åå®¹ç¥\n    }\n    // å¶ä»åå®¹ç¥\n}\n// output:\n// name: jack, age: 30, sex: male\n\n\nå¨ writeobject() æ¹æ³ä¸­ä¼åè°ç¨ objectoutputstream ä¸­ç defaultwriteobject() æ¹æ³ï¼è¯¥æ¹æ³ä¼æ§è¡é»è®¤çåºååæºå¶ï¼å¦ä¸èæè¿°ï¼æ­¤æ¶ä¼å¿½ç¥æ age å­æ®µãç¶ååè°ç¨ writeint() æ¹æ³æ¾ç¤ºå°å° age å­æ®µåå¥å° objectoutputstream ä¸­ãreadobject() çä½ç¨åæ¯éå¯¹å¯¹è±¡çè¯»åï¼å¶åçä¸ writeobject() æ¹æ³ç¸åã\n\n> ð æ³¨æï¼writeobject() ä¸ readobject() é½æ¯ private æ¹æ³ï¼é£ä¹å®ä»¬æ¯å¦ä½è¢«è°ç¨çå¢ï¼æ¯«æ çé®ï¼æ¯ä½¿ç¨åå°ãè¯¦æå¯è§ objectoutputstream ä¸­ç writeserialdata æ¹æ³ï¼ä»¥å objectinputstream ä¸­ç readserialdata æ¹æ³ã\n\n\n# readresolve() æ¹æ³\n\nå½æä»¬ä½¿ç¨ singleton æ¨¡å¼æ¶ï¼åºè¯¥æ¯æææä¸ªç±»çå®ä¾åºè¯¥æ¯å¯ä¸çï¼ä½å¦æè¯¥ç±»æ¯å¯åºååçï¼é£ä¹æåµå¯è½ä¼ç¥æä¸åãæ­¤æ¶å¯¹ç¬¬ 2 èä½¿ç¨ç person ç±»è¿è¡ä¿®æ¹ï¼ä½¿å¶å®ç° singleton æ¨¡å¼ï¼å¦ä¸æç¤ºï¼\n\npublic class serializedemo04 {\n\n    enum sex {\n        male, female\n    }\n\n    static class person implements serializable {\n        private static final long serialversionuid = 1l;\n        private string name = null;\n        transient private integer age = null;\n        private sex sex;\n        static final person instatnce = new person("tom", 31, sex.male);\n\n        private person() {\n            system.out.println("call person()");\n        }\n\n        private person(string name, integer age, sex sex) {\n            this.name = name;\n            this.age = age;\n            this.sex = sex;\n        }\n\n        public static person getinstance() {\n            return instatnce;\n        }\n\n        private void writeobject(objectoutputstream out) throws ioexception {\n            out.defaultwriteobject();\n            out.writeint(age);\n        }\n\n        private void readobject(objectinputstream in) throws ioexception, classnotfoundexception {\n            in.defaultreadobject();\n            age = in.readint();\n        }\n\n        public string tostring() {\n            return "name: " + this.name + ", age: " + this.age + ", sex: " + this.sex;\n        }\n    }\n\n    /**\n     * åºåå\n     */\n    private static void serialize(string filename) throws ioexception {\n        file f = new file(filename); // å®ä¹ä¿å­è·¯å¾\n        outputstream out = new fileoutputstream(f); // æä»¶è¾åºæµ\n        objectoutputstream oos = new objectoutputstream(out); // å¯¹è±¡è¾åºæµ\n        oos.writeobject(new person("jack", 30, sex.male)); // ä¿å­å¯¹è±¡\n        oos.close();\n        out.close();\n    }\n\n    /**\n     * ååºåå\n     */\n    private static void deserialize(string filename) throws ioexception, classnotfoundexception {\n        file f = new file(filename); // å®ä¹ä¿å­è·¯å¾\n        inputstream in = new fileinputstream(f); // æä»¶è¾å¥æµ\n        objectinputstream ois = new objectinputstream(in); // å¯¹è±¡è¾å¥æµ\n        object obj = ois.readobject(); // è¯»åå¯¹è±¡\n        ois.close();\n        in.close();\n        system.out.println(obj);\n        system.out.println(obj == person.getinstance());\n    }\n\n    public static void main(string[] args) throws ioexception, classnotfoundexception {\n        final string filename = "d:/text.dat";\n        serialize(filename);\n        deserialize(filename);\n    }\n}\n// output:\n// name: jack, age: null, sex: male\n// false\n\n\nå¼å¾æ³¨æçæ¯ï¼ä»æä»¶ä¸­è·åç person å¯¹è±¡ä¸ person ç±»ä¸­çåä¾å¯¹è±¡å¹¶ä¸ç¸ç­ãä¸ºäºè½å¨åä¾ç±»ä¸­ä»ç¶ä¿æåºåçç¹æ§ï¼å¯ä»¥ä½¿ç¨ readresolve() æ¹æ³ãå¨è¯¥æ¹æ³ä¸­ç´æ¥è¿å person çåä¾å¯¹è±¡ãæä»¬å¨ serializedemo04 ç¤ºä¾çåºç¡ä¸æ·»å ä¸ä¸ª readresolve æ¹æ³ï¼ å¦ä¸æç¤ºï¼\n\npublic class serializedemo05 {\n    // å¶ä»åå®¹ç¥\n\n    static class person implements serializable {\n\n        // private void readobject(objectinputstream in) throws ioexception, classnotfoundexception {\n        //     in.defaultreadobject();\n        //     age = in.readint();\n        // }\n\n        // æ·»å æ­¤æ¹æ³\n        private object readresolve() {\n            return instatnce;\n        }\n        // å¶ä»åå®¹ç¥\n    }\n\n    // å¶ä»åå®¹ç¥\n}\n// output:\n// name: tom, age: 31, sex: male\n// true\n\n\n\n# jdk åºååçé®é¢\n\n * æ æ³è·¨è¯­è¨ï¼jdk åºååç®ååªéç¨åºäº java è¯­è¨å®ç°çæ¡æ¶ï¼å¶å®è¯­è¨å¤§é¨åé½æ²¡æä½¿ç¨ java çåºååæ¡æ¶ï¼ä¹æ²¡æå®ç° jdk åºååè¿å¥åè®®ãå æ­¤ï¼å¦ææ¯ä¸¤ä¸ªåºäºä¸åè¯­è¨ç¼åçåºç¨ç¨åºç¸äºéä¿¡ï¼åæ æ³å®ç°ä¸¤ä¸ªåºç¨æå¡ä¹é´ä¼ è¾å¯¹è±¡çåºååä¸ååºååã\n * å®¹æè¢«æ»å»ï¼å¯¹è±¡æ¯éè¿å¨ objectinputstream ä¸è°ç¨ readobject() æ¹æ³è¿è¡ååºååçï¼å®å¯ä»¥å°ç±»è·¯å¾ä¸å ä¹ææå®ç°äº serializable æ¥å£çå¯¹è±¡é½å®ä¾åãè¿æå³çï¼å¨ååºååå­èæµçè¿ç¨ä¸­ï¼è¯¥æ¹æ³å¯ä»¥æ§è¡ä»»æç±»åçä»£ç ï¼è¿æ¯éå¸¸å±é©çãå¯¹äºéè¦é¿æ¶é´è¿è¡ååºååçå¯¹è±¡ï¼ä¸éè¦æ§è¡ä»»ä½ä»£ç ï¼ä¹å¯ä»¥åèµ·ä¸æ¬¡æ»å»ãæ»å»èå¯ä»¥åå»ºå¾ªç¯å¯¹è±¡é¾ï¼ç¶åå°åºåååçå¯¹è±¡ä¼ è¾å°ç¨åºä¸­ååºååï¼è¿ç§æåµä¼å¯¼è´ hashcode æ¹æ³è¢«è°ç¨æ¬¡æ°åæ¬¡æ¹çåå¼å¢é¿, ä»èå¼åæ æº¢åºå¼å¸¸ãä¾å¦ä¸é¢è¿ä¸ªæ¡ä¾å°±å¯ä»¥å¾å¥½å°è¯´æã\n * åºåååçæµå¤ªå¤§ï¼jdk åºååä¸­ä½¿ç¨äº objectoutputstream æ¥å®ç°å¯¹è±¡è½¬äºè¿å¶ç¼ç ï¼ç¼ç åçæ°ç»å¾å¤§ï¼éå¸¸å½±åå­å¨åä¼ è¾æçã\n * åºååæ§è½å¤ªå·®ï¼java çåºååèæ¶æ¯è¾å¤§ãåºååçéåº¦ä¹æ¯ä½ç°åºååæ§è½çéè¦ææ ï¼å¦æåºååçéåº¦æ¢ï¼å°±ä¼å½±åç½ç»éä¿¡çæçï¼ä»èå¢å ç³»ç»çååºæ¶é´ã\n * åºååç¼ç¨éå¶ï¼\n   * jdk åºååä¸å®è¦å®ç° serializable æ¥å£ã\n   * jdk åºååéè¦å³æ³¨ serialversionuidã\n\n\n# äºè¿å¶åºåå\n\nä¸èè¯¦ç»ä»ç»äº jdk åºååæ¹å¼ï¼ç±äºå¶æ§è½ä¸é«ï¼ä¸å­å¨å¾å¤å¶ä»é®é¢ï¼æä»¥ä¸çæäºå¾å¤å¶ä»ä¼ç§çäºè¿å¶åºåååºã\n\n\n# protobuf\n\nprotobuf æ¯ google å¬å¸åé¨çæ··åè¯­è¨æ°æ®æ åï¼æ¯ä¸ç§è½»ä¾¿ãé«æçç»æåæ°æ®å­å¨æ ¼å¼ï¼å¯ä»¥ç¨äºç»æåæ°æ®åºååï¼æ¯æ javaãpythonãc++ãgo ç­è¯­è¨ãprotobuf ä½¿ç¨çæ¶åéè¦å®ä¹ idlï¼interface description languageï¼ï¼ç¶åä½¿ç¨ä¸åè¯­è¨ç idl ç¼è¯å¨ï¼çæåºååå·¥å·ç±»ã\n\nä¼ç¹ï¼\n\n * åºåååä½ç§¯ç¸æ¯ jsonãhessian å°å¾å¤\n * åºååååºååéåº¦å¾å¿«ï¼ä¸éè¦éè¿åå°è·åç±»å\n * è¯­è¨åå¹³å°æ å³ï¼åºäº idlï¼ï¼idl è½æ¸æ°å°æè¿°è¯­ä¹ï¼æä»¥è¶³ä»¥å¸®å©å¹¶ä¿è¯åºç¨ç¨åºä¹é´çç±»åä¸ä¼ä¸¢å¤±ï¼æ éç±»ä¼¼ xml è§£æå¨\n * æ¶æ¯æ ¼å¼åçº§åå¼å®¹æ§ä¸éï¼å¯ä»¥åå°ååå¼å®¹\n * æ¯æ java, c++, python ä¸ç§è¯­è¨\n\nç¼ºç¹ï¼\n\n * protobuf å¯¹äºå·æåå°åå¨æè½åçè¯­è¨æ¥è¯´ï¼ç¨èµ·æ¥å¾è´¹å²ã\n\n\n# thrift\n\n> thrift æ¯ apache å¼æºé¡¹ç®ï¼æ¯ä¸ä¸ªç¹å¯¹ç¹ç rpc å®ç°ã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * æ¯æå¤ç§è¯­è¨ï¼ç®åæ¯æ 28 ç§è¯­è¨ï¼å¦ï¼c++ãgoãjavaãphpãpythonãruby ç­ç­ï¼ã\n * ä½¿ç¨äºç»å»ºå¤§åæ°æ®äº¤æ¢åå­å¨å·¥å·ï¼å¯¹äºå¤§åç³»ç»ä¸­çåé¨æ°æ®ä¼ è¾ï¼ç¸å¯¹äº json å xml å¨æ§è½ä¸åä¼ è¾å¤§å°ä¸é½æææ¾çä¼å¿ã\n * æ¯æä¸ç§æ¯è¾å¸åçç¼ç æ¹å¼ï¼éç¨äºè¿å¶ç¼ç ï¼åç¼©äºè¿å¶ç¼ç ï¼ä¼åçå¯éå­æ®µåç¼©ç¼è§£ç ï¼ã\n\n\n# hessian\n\nhessian æ¯å¨æç±»åãäºè¿å¶ãç´§åçï¼å¹¶ä¸å¯è·¨è¯­è¨ç§»æ¤çä¸ç§åºååæ¡æ¶ãhessian åè®®è¦æ¯ jdkãjson æ´å ç´§åï¼æ§è½ä¸è¦æ¯ jdkãjson åºååé«æå¾å¤ï¼èä¸çæçå­èæ°ä¹æ´å°ã\n\nrpc æ¡æ¶ dubbo å°±æ¯æ thrift å hessionã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * æ¯æå¤ç§è¯­è¨ãå¦ï¼javaãpythonãc++ãc#ãphpãruby ç­ã\n * ç¸å¯¹å¶ä»äºè¿å¶åºåååºè¾æ¢ã\n\nhessian æ¬èº«ä¹æé®é¢ï¼å®æ¹çæ¬å¯¹ java éé¢ä¸äºå¸¸è§å¯¹è±¡çç±»åä¸æ¯æï¼\n\n * linked ç³»åï¼linkedhashmapãlinkedhashset ç­ï¼ä½æ¯å¯ä»¥éè¿æ©å± collectiondeserializer ç±»ä¿®å¤ï¼\n * locale ç±»ï¼å¯ä»¥éè¿æ©å± contextserializerfactory ç±»ä¿®å¤ï¼\n * byte/short ååºååçæ¶ååæ integerã\n\n\n# kryo\n\n> kryo æ¯ç¨äº java çå¿«éé«æçäºè¿å¶å¯¹è±¡å¾åºååæ¡æ¶ãkryo è¿å¯ä»¥æ§è¡èªå¨çæ·±æ·è´åæµæ·è´ã è¿æ¯ä»å¯¹è±¡å°å¯¹è±¡çç´æ¥å¤å¶ï¼èä¸æ¯ä»å¯¹è±¡å°å­èçå¤å¶ã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * éåº¦å¿«ï¼åºååä½ç§¯å°\n * å®æ¹ä¸æ¯æ java ä»¥å¤çå¶ä»è¯­è¨\n\n\n# fst\n\n> fst æ¯ä¸ä¸ª java å®ç°äºè¿å¶åºåååºã\n\nå®å·æä»¥ä¸ç¹æ§ï¼\n\n * è¿ä¹äº 100% å¼å®¹ jdk åºååï¼ä¸æ¯ jdk ååºååæ¹å¼å¿« 10 å\n * 2.17 å¼å§ä¸ android å¼å®¹\n * ï¼å¯éï¼2.29 å¼å§æ¯æå°ä»»ä½å¯åºååçå¯¹è±¡å¾ç¼ç /è§£ç ä¸º jsonï¼åæ¬å±äº«å¼ç¨ï¼\n\n\n# json åºåå\n\né¤äºäºè¿å¶åºååæ¹å¼ï¼è¿å¯ä»¥éæ© json åºååãå®çæ§è½æ¯äºè¿å¶åºååæ¹å¼å·®ï¼ä½æ¯å¯è¯»æ§éå¸¸å¥½ï¼ä¸å¹¿æ³åºç¨äº web é¢åã\n\n\n# json æ¯ä»ä¹\n\njson èµ·æºäº 1999 å¹´ç js è¯­è¨è§è ecma262 çä¸ä¸ªå­éï¼å³ 15.12 ç« èæè¿°äºæ ¼å¼ä¸è§£æï¼ï¼åæ¥ 2003 å¹´ä½ä¸ºä¸ä¸ªæ°æ®æ ¼å¼ecma404ï¼å¾å§çåºå·æä¸æï¼ï¼åå¸ã 2006 å¹´ï¼ä½ä¸º rfc4627 åå¸ï¼è¿æ¶è§èå¢å å° 18 é¡µï¼å»ææ²¡ç¨çé¨åï¼åé¡µä¸å°ã\n\njson çåºç¨å¾å¹¿æ³ï¼è¿éæè¶è¿ 100 ç§è¯­è¨ä¸ç json åºï¼json.orgã\n\næ´å¤çå¯ä»¥åèè¿éï¼å³äº json çä¸åã\n\n\n# json æ å\n\nè¿ä¼°è®¡æ¯æç®åæ åè§èä¹ä¸ï¼\n\n * åªæä¸¤ç§ç»æï¼å¯¹è±¡åçé®å¼å¯¹éåç»æåæ°ç»ï¼å¯¹è±¡ç¨ {} è¡¨ç¤ºãåé¨æ¯ "key":"value"ï¼æ°ç»ç¨ [] è¡¨ç¤ºï¼ä¸åå¼ç¨éå·åå¼\n * åºæ¬æ°å¼æ 7 ä¸ªï¼ false / null / true / object / array / number / string\n * åå ä¸ç»æå¯ä»¥åµå¥ï¼è¿èå¯ä»¥ç¨æ¥è¡¨è¾¾å¤æçæ°æ®\n * ä¸ä¸ªç®åå®ä¾ï¼\n\n{\n  "image": {\n    "width": 800,\n    "height": 600,\n    "title": "view from 15th floor",\n    "thumbnail": {\n      "url": "http://www.example.com/image/481989943",\n      "height": 125,\n      "width": "100"\n    },\n    "ids": [116, 943, 234, 38793]\n  }\n}\n\n\n> æ©å±éè¯»ï¼\n> \n>  * http://www.json.org/json-zh.html - å¾æå¹¶èä»ç» json æ°æ®å½¢å¼\n> \n>  * json ç rfc ææ¡£\n\n\n# json ä¼ç¼ºç¹\n\njson ä¼ç¹\n\n * åºäºçº¯ææ¬ï¼æä»¥å¯¹äºäººç±»éè¯»æ¯å¾åå¥½çã\n * è§èç®åï¼æä»¥å®¹æå¤çï¼å¼ç®±å³ç¨ï¼ç¹å«æ¯ js ç±»ç ecma èæ¬éæ¯åå»ºæ¯æçï¼å¯ä»¥ç´æ¥ä½ä¸ºå¯¹è±¡ä½¿ç¨ã\n * å¹³å°æ å³æ§ï¼å ä¸ºç±»ååç»æé½æ¯å¹³å°æ å³çï¼èä¸å¥½å¤çï¼å®¹æå®ç°ä¸åè¯­è¨çå¤çç±»åºï¼å¯ä»¥ä½ä¸ºå¤ä¸ªä¸åå¼æç³»ç»ä¹é´çæ°æ®ä¼ è¾æ ¼å¼åè®®ï¼ç¹å«æ¯å¨ http/rest ä¸çæ°æ®æ ¼å¼ã\n\njson ç¼ºç¹\n\n * æ§è½ä¸è¬ï¼ææ¬è¡¨ç¤ºçæ°æ®ä¸è¬æ¥è¯´æ¯äºè¿å¶å¤§å¾å¤ï¼å¨æ°æ®ä¼ è¾ä¸åè§£æå¤çä¸é½è¦æ´å½±åæ§è½ã\n * ç¼ºä¹ schemaï¼è·åæ¯ææ¬æ°æ®æ ¼å¼ç xml æ¯ï¼å¨ç±»åçä¸¥æ ¼æ§åä¸°å¯æ§ä¸è¦å·®å¾å¤ãxml å¯ä»¥åç± xsd æ dtd æ¥å®ä¹å¤æçæ ¼å¼ï¼å¹¶ç±æ­¤æ¥éªè¯ xml ææ¡£æ¯å¦ç¬¦åæ ¼å¼è¦æ±ï¼çè³è¿ä¸æ­¥çï¼å¯ä»¥åºäº xsd æ¥çæå·ä½è¯­è¨çæä½ä»£ç ï¼ä¾å¦ apache xmlbeansãå¹¶ä¸è¿äºå·¥å·ç»åå°ä¸èµ·ï¼å½¢æä¸å¥åºå¤§ççæï¼ä¾å¦åºäº xml å¯ä»¥å®ç° soap å wsdlï¼ä¸ç³»åç ws-*è§èãä½æ¯æä»¬ä¹å¯ä»¥çå° json å¨ç¼ºä¹è§èçæåµä¸ï¼å®éä¸ææ´å¤§ä¸äºççµæ´»æ§ï¼ç¹å«æ¯è¿å¹´æ¥ rest çå¿«éåå±ï¼å·²ç»æä¸äº schema ç¸å³çåå±(ä¾å¦çè§£ json schemaï¼ä½¿ç¨ json schemaï¼ å¨çº¿ schema æµè¯)ï¼ä¹æç±»ä¼¼äº wsdl çwadlåºç°ã\n\n\n# json åº\n\njava ä¸­æ¯è¾æµè¡ç json åºæï¼\n\n * fastjson - é¿éå·´å·´å¼åç json åºï¼æ§è½ååä¼ç§ã\n * jackson - ç¤¾åºååæ´»è·ä¸æ´æ°éåº¦å¾å¿«ãspring æ¡æ¶é»è®¤ json åºã\n * gson - è°·æ­å¼åç json åºï¼ç®ååè½æå¨ç json åº ã\n\nä»æ§è½ä¸æ¥çï¼ä¸è¬æåµä¸ï¼fastjson > jackson > gson\n\n\n# json ç¼ç æå\n\n> éµå¾ªå¥½çè®¾è®¡ä¸ç¼ç é£æ ¼ï¼è½æåè§£å³ 80%çé®é¢ï¼ä¸ªäººæ¨è google json é£æ ¼æåã\n> \n>  * è±æçgoogle json style guideï¼https://google.github.io/styleguide/jsoncstyleguide.xml\n>  * ä¸­æçgoogle json é£æ ¼æåï¼https://github.com/darcyliu/google-styleguide/blob/master/jsonstyleguide.md\n\nç®åæå½å¦ä¸ï¼\n\n * å±æ§ååå¼é½æ¯ç¨åå¼å·ï¼ä¸è¦ææ³¨éåå°å¯¹è±¡éé¢ï¼å¯¹è±¡æ°æ®è¦ç®æ´\n * ä¸è¦éæç»æååç»å¯¹è±¡ï¼æ¨èæ¯ç¨æå¹³åæ¹å¼ï¼å±æ¬¡ä¸è¦å¤ªå¤æ\n * å½åæ¹å¼è¦ææä¹ï¼æ¯å¦åå¤æ°è¡¨ç¤º\n * é©¼å³°å¼å½åï¼éµå¾ª bean è§è\n * ä½¿ç¨çæ¬æ¥æ§å¶åæ´å²çª\n * å¯¹äºä¸äºå³é®å­ï¼ä¸è¦æ¿æ¥å key\n * å¦æä¸ä¸ªå±æ§æ¯å¯éçæèåå«ç©ºå¼æ null å¼ï¼èèä» json ä¸­å»æè¯¥å±æ§ï¼é¤éå®çå­å¨æå¾å¼ºçè¯­ä¹åå \n * åºååæä¸¾ç±»åæ¶ï¼ä½¿ç¨ name èä¸æ¯ value\n * æ¥æè¦ç¨æ åæ ¼å¼å¤ç\n * è®¾è®¡å¥½éç¨çåé¡µåæ°\n * è®¾è®¡å¥½å¼å¸¸å¤ç\n\njson apiä¸ google json é£æ ¼æåæå¾å¤å¯ä»¥ç¸äºåç§ä¹å¤ã\n\njson apiæ¯æ°æ®äº¤äºè§èï¼ç¨ä»¥å®ä¹å®¢æ·ç«¯å¦ä½è·åä¸ä¿®æ¹èµæºï¼ä»¥åæå¡å¨å¦ä½ååºå¯¹åºè¯·æ±ã\n\njson api è®¾è®¡ç¨æ¥æå°åè¯·æ±çæ°éï¼ä»¥åå®¢æ·ç«¯ä¸æå¡å¨é´ä¼ è¾çæ°æ®éãå¨é«æå®ç°çåæ¶ï¼æ éçºç²å¯è¯»æ§ãçµæ´»æ§åå¯åç°æ§ã\n\n\n# åºååææ¯éå\n\nå¸é¢ä¸æå¦æ­¤å¤çåºååææ¯ï¼é£ä¹æä»¬å¨åºç¨æ¶å¦ä½éæ©å¢?\n\nåºååææ¯éåï¼éè¦èéçç»´åº¦ï¼æ ¹æ®éè¦æ§ä»é«å°ä½ï¼ä¾æ¬¡æï¼\n\n * å®å¨æ§ï¼æ¯å¦å­å¨æ¼æ´ãå¦æå­å¨æ¼æ´ï¼å°±æè¢«æ»å»çå¯è½æ§ã\n * å¼å®¹æ§ï¼çæ¬åçº§åçå¼å®¹æ§æ¯å¦å¾å¥½ï¼æ¯å¦æ¯ææ´å¤çå¯¹è±¡ç±»åï¼æ¯å¦æ¯è·¨å¹³å°ãè·¨è¯­è¨çãæå¡è°ç¨çç¨³å®æ§ä¸å¯é æ§ï¼è¦æ¯æå¡çæ§è½æ´å éè¦ã\n * æ§è½\n   * æ¶é´å¼éï¼åºååãååºååçèæ¶æ§è½èªç¶è¶å°è¶å¥½ã\n   * ç©ºé´å¼éï¼åºåååçæ°æ®è¶å°è¶å¥½ï¼è¿æ ·ç½ç»ä¼ è¾æçå°±é«ã\n * æç¨æ§ï¼ç±»åºæ¯å¦è½»éåï¼api æ¯å¦ç®åææã\n\né´äºä»¥ä¸çèéï¼åºååææ¯çéåå»ºè®®å¦ä¸ï¼\n\n * jdk åºååï¼æ§è½è¾å·®ï¼ä¸æå¾å¤ä½¿ç¨éå¶ï¼ä¸å»ºè®®ä½¿ç¨ã\n * thriftãprotobufï¼éç¨äºå¯¹æ§è½ææï¼å¯¹å¼åä½éªè¦æ±ä¸é«ã\n * hessianï¼éç¨äºå¯¹å¼åä½éªææï¼æ§è½æè¦æ±ã\n * jacksonãgsonãfastjsonï¼éç¨äºå¯¹åºåååçæ°æ®è¦æ±æè¯å¥½çå¯è¯»æ§ï¼è½¬ä¸º json ãxml å½¢å¼ï¼ã\n\n\n# åèèµæ\n\n * java ç¼ç¨ææ³\n * java æ ¸å¿ææ¯ï¼å· 1ï¼\n * ãjava æ§è½è°ä¼å®æã\n * jdk åºååçé«çº§è®¤è¯\n * http://www.hollischuang.com/archives/1140\n * http://www.codenuclear.com/serialization-deserialization-java/\n * http://www.blogjava.net/jiangshachina/archive/2012/02/13/369898.html\n * https://agapple.iteye.com/blog/859052',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java ç½ç»ç¼ç¨",frontmatter:{title:"Java ç½ç»ç¼ç¨",date:"2020-02-19T18:54:21.000Z",categories:["Java","JavaSE","IO"],tags:["Java","JavaSE","IO","ç½ç»"],permalink:"/pages/e4c818/"},regularPath:"/01.Java/01.JavaSE/04.IO/04.Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html",relativePath:"01.Java/01.JavaSE/04.IO/04.Javaç½ç»ç¼ç¨.md",key:"v-b99a190c",path:"/pages/e4c818/",headers:[{level:2,title:"Socket å ServerSocket",slug:"socket-å-serversocket",normalizedTitle:"socket å serversocket",charIndex:340},{level:3,title:"ServerSocket",slug:"serversocket",normalizedTitle:"serversocket",charIndex:26},{level:4,title:"ServerSocket æé æ¹æ³",slug:"serversocket-æé æ¹æ³",normalizedTitle:"serversocket æé æ¹æ³",charIndex:1119},{level:4,title:"ServerSocket å¸¸ç¨æ¹æ³",slug:"serversocket-å¸¸ç¨æ¹æ³",normalizedTitle:"serversocket å¸¸ç¨æ¹æ³",charIndex:1571},{level:3,title:"Socket",slug:"socket",normalizedTitle:"socket",charIndex:19},{level:4,title:"Socket æé æ¹æ³",slug:"socket-æé æ¹æ³",normalizedTitle:"socket æé æ¹æ³",charIndex:1125},{level:4,title:"Socket å¸¸ç¨æ¹æ³",slug:"socket-å¸¸ç¨æ¹æ³",normalizedTitle:"socket å¸¸ç¨æ¹æ³",charIndex:1577},{level:3,title:"Socket éä¿¡ç¤ºä¾",slug:"socket-éä¿¡ç¤ºä¾",normalizedTitle:"socket éä¿¡ç¤ºä¾",charIndex:3432},{level:2,title:"DatagramSocket å DatagramPacket",slug:"datagramsocket-å-datagrampacket",normalizedTitle:"datagramsocket å datagrampacket",charIndex:4520},{level:2,title:"InetAddress",slug:"inetaddress",normalizedTitle:"inetaddress",charIndex:1505},{level:2,title:"URL",slug:"url",normalizedTitle:"url",charIndex:5825},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6286}],headersStr:"Socket å ServerSocket ServerSocket ServerSocket æé æ¹æ³ ServerSocket å¸¸ç¨æ¹æ³ Socket Socket æé æ¹æ³ Socket å¸¸ç¨æ¹æ³ Socket éä¿¡ç¤ºä¾ DatagramSocket å DatagramPacket InetAddress URL åèèµæ",content:'# Java ç½ç»ç¼ç¨\n\n> å³é®è¯ï¼SocketãServerSocketãDatagramPacketãDatagramSocket\n> \n> ç½ç»ç¼ç¨æ¯æç¼åè¿è¡å¨å¤ä¸ªè®¾å¤ï¼è®¡ç®æºï¼çç¨åºï¼è¿äºè®¾å¤é½éè¿ç½ç»è¿æ¥èµ·æ¥ã\n> \n> java.net åä¸­æä¾äºä½å±æ¬¡çç½ç»éä¿¡ç»èãä½ å¯ä»¥ç´æ¥ä½¿ç¨è¿äºç±»åæ¥å£ï¼æ¥ä¸æ³¨äºè§£å³é®é¢ï¼èä¸ç¨å³æ³¨éä¿¡ç»èã\n> \n> java.net åä¸­æä¾äºä¸¤ç§å¸¸è§çç½ç»åè®®çæ¯æï¼\n> \n>  * TCP - TCP æ¯ä¼ è¾æ§å¶åè®®çç¼©åï¼å®ä¿éäºä¸¤ä¸ªåºç¨ç¨åºä¹é´çå¯é éä¿¡ãéå¸¸ç¨äºäºèç½åè®®ï¼è¢«ç§° TCP/ IPã\n>  * UDP - UDP æ¯ç¨æ·æ°æ®æ¥åè®®çç¼©åï¼ä¸ä¸ªæ è¿æ¥çåè®®ãæä¾äºåºç¨ç¨åºä¹é´è¦åéçæ°æ®çæ°æ®åã\n\n\n# Socket å ServerSocket\n\nå¥æ¥å­ï¼Socketï¼ä½¿ç¨ TCP æä¾äºä¸¤å°è®¡ç®æºä¹é´çéä¿¡æºå¶ã å®¢æ·ç«¯ç¨åºåå»ºä¸ä¸ªå¥æ¥å­ï¼å¹¶å°è¯è¿æ¥æå¡å¨çå¥æ¥å­ã\n\nJava éè¿ Socket å ServerSocket å®ç°å¯¹ TCP çæ¯æãJava ä¸­ç Socket éä¿¡å¯ä»¥ç®åçè§£ä¸ºï¼java.net.Socket ä»£è¡¨å®¢æ·ç«¯ï¼java.net.ServerSocket ä»£è¡¨æå¡ç«¯ï¼äºèå¯ä»¥å»ºç«è¿æ¥ï¼ç¶åéä¿¡ã\n\nä»¥ä¸ä¸º Socket éä¿¡ä¸­å»ºç«å»ºç«çåºæ¬æµç¨ï¼\n\n * æå¡å¨å®ä¾åä¸ä¸ª ServerSocket å¯¹è±¡ï¼è¡¨ç¤ºæå¡å¨ç»å®ä¸ä¸ªç«¯å£ã\n * æå¡å¨è°ç¨ ServerSocket ç accept() æ¹æ³ï¼è¯¥æ¹æ³å°ä¸ç´ç­å¾ï¼ç´å°å®¢æ·ç«¯è¿æ¥å°æå¡å¨çç»å®ç«¯å£ï¼å³çå¬ç«¯å£ï¼ã\n * æå¡å¨çå¬ç«¯å£æ¶ï¼å®¢æ·ç«¯å®ä¾åä¸ä¸ª Socket å¯¹è±¡ï¼æå®æå¡å¨åç§°åç«¯å£å·æ¥è¯·æ±è¿æ¥ã\n * Socket ç±»çæé å½æ°è¯å¾å°å®¢æ·ç«¯è¿æ¥å°æå®çæå¡å¨åç«¯å£å·ãå¦æéä¿¡è¢«å»ºç«ï¼åå¨å®¢æ·ç«¯åå»ºä¸ä¸ª Socket å¯¹è±¡è½å¤ä¸æå¡å¨è¿è¡éä¿¡ã\n * å¨æå¡å¨ç«¯ï¼accept() æ¹æ³è¿åæå¡å¨ä¸ä¸ä¸ªæ°ç Socket å¼ç¨ï¼è¯¥å¼ç¨è¿æ¥å°å®¢æ·ç«¯ç Socket ã\n\nè¿æ¥å»ºç«åï¼å¯ä»¥éè¿ä½¿ç¨ IO æµè¿è¡éä¿¡ãæ¯ä¸ä¸ª Socket é½æä¸ä¸ªè¾åºæµåä¸ä¸ªè¾å¥æµãå®¢æ·ç«¯çè¾åºæµè¿æ¥å°æå¡å¨ç«¯çè¾å¥æµï¼èå®¢æ·ç«¯çè¾å¥æµè¿æ¥å°æå¡å¨ç«¯çè¾åºæµã\n\nTCP æ¯ä¸ä¸ªååçéä¿¡åè®®ï¼å æ­¤æ°æ®å¯ä»¥éè¿ä¸¤ä¸ªæ°æ®æµå¨åä¸æ¶é´åéï¼ä»¥ä¸æ¯ä¸äºç±»æä¾çä¸å¥å®æ´çæç¨çæ¹æ³æ¥å®ç° socketsã\n\n\n# ServerSocket\n\næå¡å¨ç¨åºéè¿ä½¿ç¨ java.net.ServerSocket ç±»ä»¥è·åä¸ä¸ªç«¯å£ï¼å¹¶ä¸çå¬å®¢æ·ç«¯è¯·æ±è¿æ¥æ­¤ç«¯å£çè¯·æ±ã\n\n# ServerSocket æé æ¹æ³\n\nServerSocket æå¤ä¸ªæé æ¹æ³ï¼\n\næ¹æ³                                                         æè¿°\nServerSocket()                                             åå»ºéç»å®æå¡å¨å¥æ¥å­ã\nServerSocket(int port)                                     åå»ºç»å®å°ç¹å®ç«¯å£çæå¡å¨å¥æ¥å­ã\nServerSocket(int port, int backlog)                        å©ç¨æå®ç backlog åå»ºæå¡å¨å¥æ¥å­å¹¶å°å¶ç»å®å°æå®çæ¬å°ç«¯å£å·ã\nServerSocket(int port, int backlog, InetAddress address)   ä½¿ç¨æå®çç«¯å£ãçå¬ backlog åè¦ç»å®å°çæ¬å° IP å°ååå»ºæå¡å¨ã\n\n# ServerSocket å¸¸ç¨æ¹æ³\n\nåå»ºéç»å®æå¡å¨å¥æ¥å­ã å¦æ ServerSocket æé æ¹æ³æ²¡ææåºå¼å¸¸ï¼å°±æå³çä½ çåºç¨ç¨åºå·²ç»æåç»å®å°æå®çç«¯å£ï¼å¹¶ä¸ä¾¦å¬å®¢æ·ç«¯è¯·æ±ã\n\nè¿éæä¸äº ServerSocket ç±»çå¸¸ç¨æ¹æ³ï¼\n\næ¹æ³                                           æè¿°\nint getLocalPort()                           è¿åæ­¤å¥æ¥å­å¨å¶ä¸ä¾¦å¬çç«¯å£ã\nSocket accept()                              çå¬å¹¶æ¥åå°æ­¤å¥æ¥å­çè¿æ¥ã\nvoid setSoTimeout(int timeout)               éè¿æå®è¶æ¶å¼å¯ç¨/ç¦ç¨ SO_TIMEOUTï¼ä»¥æ¯«ç§ä¸ºåä½ã\nvoid bind(SocketAddress host, int backlog)   å° ServerSocket ç»å®å°ç¹å®å°åï¼IP å°ååç«¯å£å·ï¼ã\n\n\n# Socket\n\njava.net.Socket ç±»ä»£è¡¨å®¢æ·ç«¯åæå¡å¨é½ç¨æ¥äºç¸æ²éçå¥æ¥å­ãå®¢æ·ç«¯è¦è·åä¸ä¸ª Socket å¯¹è±¡éè¿å®ä¾å ï¼è æå¡å¨è·å¾ä¸ä¸ª Socket å¯¹è±¡åéè¿ accept() æ¹æ³ a çè¿åå¼ã\n\n# Socket æé æ¹æ³\n\nSocket ç±»æ 5 ä¸ªæé æ¹æ³ï¼\n\næ¹æ³                                                             æè¿°\nSocket()                                                       éè¿ç³»ç»é»è®¤ç±»åç SocketImpl åå»ºæªè¿æ¥å¥æ¥å­\nSocket(String host, int port)                                  åå»ºä¸ä¸ªæµå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå®ä¸»æºä¸çæå®ç«¯å£å·ã\nSocket(InetAddress host, int port)                             åå»ºä¸ä¸ªæµå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå® IP å°åçæå®ç«¯å£å·ã\nSocket(String host, int port, InetAddress localAddress, int    åå»ºä¸ä¸ªå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå®è¿ç¨ä¸»æºä¸çæå®è¿ç¨ç«¯å£ã\nlocalPort)\nSocket(InetAddress host, int port, InetAddress localAddress,   åå»ºä¸ä¸ªå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå®è¿ç¨å°åä¸çæå®è¿ç¨ç«¯å£ã\nint localPort)\n\nå½ Socket æé æ¹æ³è¿åï¼å¹¶æ²¡æç®åçå®ä¾åäºä¸ä¸ª Socket å¯¹è±¡ï¼å®å®éä¸ä¼å°è¯è¿æ¥å°æå®çæå¡å¨åç«¯å£ã\n\n# Socket å¸¸ç¨æ¹æ³\n\nä¸é¢ååºäºä¸äºæå´è¶£çæ¹æ³ï¼æ³¨æå®¢æ·ç«¯åæå¡å¨ç«¯é½æä¸ä¸ª Socket å¯¹è±¡ï¼æä»¥æ è®ºå®¢æ·ç«¯è¿æ¯æå¡ç«¯é½è½å¤è°ç¨è¿äºæ¹æ³ã\n\næ¹æ³                                              æè¿°\nvoid connect(SocketAddress host, int timeout)   å°æ­¤å¥æ¥å­è¿æ¥å°æå¡å¨ï¼å¹¶æå®ä¸ä¸ªè¶æ¶å¼ã\nInetAddress getInetAddress()                    è¿åå¥æ¥å­è¿æ¥çå°åã\nint getPort()                                   è¿åæ­¤å¥æ¥å­è¿æ¥å°çè¿ç¨ç«¯å£ã\nint getLocalPort()                              è¿åæ­¤å¥æ¥å­ç»å®å°çæ¬å°ç«¯å£ã\nSocketAddress getRemoteSocketAddress()          è¿åæ­¤å¥æ¥å­è¿æ¥çç«¯ç¹çå°åï¼å¦ææªè¿æ¥åè¿å nullã\nInputStream getInputStream()                    è¿åæ­¤å¥æ¥å­çè¾å¥æµã\nOutputStream getOutputStream()                  è¿åæ­¤å¥æ¥å­çè¾åºæµã\nvoid close()                                    å³é­æ­¤å¥æ¥å­ã\n\n\n# Socket éä¿¡ç¤ºä¾\n\næå¡ç«¯ç¤ºä¾ï¼\n\npublic class HelloServer {\n\n    public static void main(String[] args) throws Exception {\n        // Socket æå¡ç«¯\n        // æå¡å¨å¨8888ç«¯å£ä¸çå¬\n        ServerSocket server = new ServerSocket(8888);\n        System.out.println("æå¡å¨è¿è¡ä¸­ï¼ç­å¾å®¢æ·ç«¯è¿æ¥ã");\n        // å¾å°è¿æ¥ï¼ç¨åºè¿å¥å°é»å¡ç¶æ\n        Socket client = server.accept();\n        // æå°æµè¾åºææ¹ä¾¿\n        PrintStream out = new PrintStream(client.getOutputStream());\n        // åå®¢æ·ç«¯è¾åºä¿¡æ¯\n        out.println("hello world");\n        client.close();\n        server.close();\n        System.out.println("æå¡å¨å·²åå®¢æ·ç«¯åéæ¶æ¯ï¼éåºã");\n    }\n\n}\n\n\nå®¢æ·ç«¯ç¤ºä¾ï¼\n\npublic class HelloClient {\n\n    public static void main(String[] args) throws Exception {\n        // Socket å®¢æ·ç«¯\n        Socket client = new Socket("localhost", 8888);\n        InputStreamReader inputStreamReader = new InputStreamReader(client.getInputStream());\n        // ä¸æ¬¡æ§æ¥æ¶å®æ\n        BufferedReader buf = new BufferedReader(inputStreamReader);\n        String str = buf.readLine();\n        buf.close();\n        client.close();\n        System.out.println("å®¢æ·ç«¯æ¥æ¶å°æå¡å¨æ¶æ¯ï¼" + str + "ï¼éåº");\n    }\n\n}\n\n\n\n# DatagramSocket å DatagramPacket\n\nJava éè¿ DatagramSocket å DatagramPacket å®ç°å¯¹ UDP åè®®çæ¯æã\n\n * DatagramPacketï¼æ°æ®åç±»\n * DatagramSocketï¼éä¿¡ç±»\n\nUDP æå¡ç«¯ç¤ºä¾ï¼\n\npublic class UDPServer {\n\n    public static void main(String[] args) throws Exception { // ææå¼å¸¸æåº\n        String str = "hello World!!!";\n        DatagramSocket ds = new DatagramSocket(3000); // æå¡ç«¯å¨3000ç«¯å£ä¸ç­å¾æå¡å¨åéä¿¡æ¯\n        DatagramPacket dp =\n            new DatagramPacket(str.getBytes(), str.length(), InetAddress.getByName("localhost"), 9000); // ææçä¿¡æ¯ä½¿ç¨bufä¿å­\n        System.out.println("åéä¿¡æ¯ã");\n        ds.send(dp); // åéä¿¡æ¯åºå»\n        ds.close();\n    }\n\n}\n\n\nUDP å®¢æ·ç«¯ç¤ºä¾ï¼\n\npublic class UDPClient {\n\n    public static void main(String[] args) throws Exception { // ææå¼å¸¸æåº\n        byte[] buf = new byte[1024]; // å¼è¾ç©ºé´ï¼ä»¥æ¥æ¶æ°æ®\n        DatagramSocket ds = new DatagramSocket(9000); // å®¢æ·ç«¯å¨9000ç«¯å£ä¸ç­å¾æå¡å¨åéä¿¡æ¯\n        DatagramPacket dp = new DatagramPacket(buf, 1024); // ææçä¿¡æ¯ä½¿ç¨bufä¿å­\n        ds.receive(dp); // æ¥æ¶æ°æ®\n        String str = new String(dp.getData(), 0, dp.getLength()) + "from " + dp.getAddress().getHostAddress() + "ï¼"\n            + dp.getPort();\n        System.out.println(str); // è¾åºåå®¹\n    }\n\n}\n\n\n\n# InetAddress\n\nInetAddress ç±»è¡¨ç¤ºäºèç½åè®®(IP)å°åã\n\næ²¡æå¬æçæé å½æ°ï¼åªè½éè¿éææ¹æ³æ¥åå»ºå®ä¾ã\n\nInetAddress.getByName(String host);\nInetAddress.getByAddress(byte[] address);\n\n\n\n# URL\n\nå¯ä»¥ç´æ¥ä» URL ä¸­è¯»åå­èæµæ°æ®ã\n\npublic static void main(String[] args) throws IOException {\n\n    URL url = new URL("http://www.baidu.com");\n\n    /* å­èæµ */\n    InputStream is = url.openStream();\n\n    /* å­ç¬¦æµ */\n    InputStreamReader isr = new InputStreamReader(is, "utf-8");\n\n    /* æä¾ç¼å­åè½ */\n    BufferedReader br = new BufferedReader(isr);\n\n    String line;\n    while ((line = br.readLine()) != null) {\n        System.out.println(line);\n    }\n\n    br.close();\n}\n\n\n\n# åèèµæ\n\n * Java ç½ç»ç¼ç¨',normalizedContent:'# java ç½ç»ç¼ç¨\n\n> å³é®è¯ï¼socketãserversocketãdatagrampacketãdatagramsocket\n> \n> ç½ç»ç¼ç¨æ¯æç¼åè¿è¡å¨å¤ä¸ªè®¾å¤ï¼è®¡ç®æºï¼çç¨åºï¼è¿äºè®¾å¤é½éè¿ç½ç»è¿æ¥èµ·æ¥ã\n> \n> java.net åä¸­æä¾äºä½å±æ¬¡çç½ç»éä¿¡ç»èãä½ å¯ä»¥ç´æ¥ä½¿ç¨è¿äºç±»åæ¥å£ï¼æ¥ä¸æ³¨äºè§£å³é®é¢ï¼èä¸ç¨å³æ³¨éä¿¡ç»èã\n> \n> java.net åä¸­æä¾äºä¸¤ç§å¸¸è§çç½ç»åè®®çæ¯æï¼\n> \n>  * tcp - tcp æ¯ä¼ è¾æ§å¶åè®®çç¼©åï¼å®ä¿éäºä¸¤ä¸ªåºç¨ç¨åºä¹é´çå¯é éä¿¡ãéå¸¸ç¨äºäºèç½åè®®ï¼è¢«ç§° tcp/ ipã\n>  * udp - udp æ¯ç¨æ·æ°æ®æ¥åè®®çç¼©åï¼ä¸ä¸ªæ è¿æ¥çåè®®ãæä¾äºåºç¨ç¨åºä¹é´è¦åéçæ°æ®çæ°æ®åã\n\n\n# socket å serversocket\n\nå¥æ¥å­ï¼socketï¼ä½¿ç¨ tcp æä¾äºä¸¤å°è®¡ç®æºä¹é´çéä¿¡æºå¶ã å®¢æ·ç«¯ç¨åºåå»ºä¸ä¸ªå¥æ¥å­ï¼å¹¶å°è¯è¿æ¥æå¡å¨çå¥æ¥å­ã\n\njava éè¿ socket å serversocket å®ç°å¯¹ tcp çæ¯æãjava ä¸­ç socket éä¿¡å¯ä»¥ç®åçè§£ä¸ºï¼java.net.socket ä»£è¡¨å®¢æ·ç«¯ï¼java.net.serversocket ä»£è¡¨æå¡ç«¯ï¼äºèå¯ä»¥å»ºç«è¿æ¥ï¼ç¶åéä¿¡ã\n\nä»¥ä¸ä¸º socket éä¿¡ä¸­å»ºç«å»ºç«çåºæ¬æµç¨ï¼\n\n * æå¡å¨å®ä¾åä¸ä¸ª serversocket å¯¹è±¡ï¼è¡¨ç¤ºæå¡å¨ç»å®ä¸ä¸ªç«¯å£ã\n * æå¡å¨è°ç¨ serversocket ç accept() æ¹æ³ï¼è¯¥æ¹æ³å°ä¸ç´ç­å¾ï¼ç´å°å®¢æ·ç«¯è¿æ¥å°æå¡å¨çç»å®ç«¯å£ï¼å³çå¬ç«¯å£ï¼ã\n * æå¡å¨çå¬ç«¯å£æ¶ï¼å®¢æ·ç«¯å®ä¾åä¸ä¸ª socket å¯¹è±¡ï¼æå®æå¡å¨åç§°åç«¯å£å·æ¥è¯·æ±è¿æ¥ã\n * socket ç±»çæé å½æ°è¯å¾å°å®¢æ·ç«¯è¿æ¥å°æå®çæå¡å¨åç«¯å£å·ãå¦æéä¿¡è¢«å»ºç«ï¼åå¨å®¢æ·ç«¯åå»ºä¸ä¸ª socket å¯¹è±¡è½å¤ä¸æå¡å¨è¿è¡éä¿¡ã\n * å¨æå¡å¨ç«¯ï¼accept() æ¹æ³è¿åæå¡å¨ä¸ä¸ä¸ªæ°ç socket å¼ç¨ï¼è¯¥å¼ç¨è¿æ¥å°å®¢æ·ç«¯ç socket ã\n\nè¿æ¥å»ºç«åï¼å¯ä»¥éè¿ä½¿ç¨ io æµè¿è¡éä¿¡ãæ¯ä¸ä¸ª socket é½æä¸ä¸ªè¾åºæµåä¸ä¸ªè¾å¥æµãå®¢æ·ç«¯çè¾åºæµè¿æ¥å°æå¡å¨ç«¯çè¾å¥æµï¼èå®¢æ·ç«¯çè¾å¥æµè¿æ¥å°æå¡å¨ç«¯çè¾åºæµã\n\ntcp æ¯ä¸ä¸ªååçéä¿¡åè®®ï¼å æ­¤æ°æ®å¯ä»¥éè¿ä¸¤ä¸ªæ°æ®æµå¨åä¸æ¶é´åéï¼ä»¥ä¸æ¯ä¸äºç±»æä¾çä¸å¥å®æ´çæç¨çæ¹æ³æ¥å®ç° socketsã\n\n\n# serversocket\n\næå¡å¨ç¨åºéè¿ä½¿ç¨ java.net.serversocket ç±»ä»¥è·åä¸ä¸ªç«¯å£ï¼å¹¶ä¸çå¬å®¢æ·ç«¯è¯·æ±è¿æ¥æ­¤ç«¯å£çè¯·æ±ã\n\n# serversocket æé æ¹æ³\n\nserversocket æå¤ä¸ªæé æ¹æ³ï¼\n\næ¹æ³                                                         æè¿°\nserversocket()                                             åå»ºéç»å®æå¡å¨å¥æ¥å­ã\nserversocket(int port)                                     åå»ºç»å®å°ç¹å®ç«¯å£çæå¡å¨å¥æ¥å­ã\nserversocket(int port, int backlog)                        å©ç¨æå®ç backlog åå»ºæå¡å¨å¥æ¥å­å¹¶å°å¶ç»å®å°æå®çæ¬å°ç«¯å£å·ã\nserversocket(int port, int backlog, inetaddress address)   ä½¿ç¨æå®çç«¯å£ãçå¬ backlog åè¦ç»å®å°çæ¬å° ip å°ååå»ºæå¡å¨ã\n\n# serversocket å¸¸ç¨æ¹æ³\n\nåå»ºéç»å®æå¡å¨å¥æ¥å­ã å¦æ serversocket æé æ¹æ³æ²¡ææåºå¼å¸¸ï¼å°±æå³çä½ çåºç¨ç¨åºå·²ç»æåç»å®å°æå®çç«¯å£ï¼å¹¶ä¸ä¾¦å¬å®¢æ·ç«¯è¯·æ±ã\n\nè¿éæä¸äº serversocket ç±»çå¸¸ç¨æ¹æ³ï¼\n\næ¹æ³                                           æè¿°\nint getlocalport()                           è¿åæ­¤å¥æ¥å­å¨å¶ä¸ä¾¦å¬çç«¯å£ã\nsocket accept()                              çå¬å¹¶æ¥åå°æ­¤å¥æ¥å­çè¿æ¥ã\nvoid setsotimeout(int timeout)               éè¿æå®è¶æ¶å¼å¯ç¨/ç¦ç¨ so_timeoutï¼ä»¥æ¯«ç§ä¸ºåä½ã\nvoid bind(socketaddress host, int backlog)   å° serversocket ç»å®å°ç¹å®å°åï¼ip å°ååç«¯å£å·ï¼ã\n\n\n# socket\n\njava.net.socket ç±»ä»£è¡¨å®¢æ·ç«¯åæå¡å¨é½ç¨æ¥äºç¸æ²éçå¥æ¥å­ãå®¢æ·ç«¯è¦è·åä¸ä¸ª socket å¯¹è±¡éè¿å®ä¾å ï¼è æå¡å¨è·å¾ä¸ä¸ª socket å¯¹è±¡åéè¿ accept() æ¹æ³ a çè¿åå¼ã\n\n# socket æé æ¹æ³\n\nsocket ç±»æ 5 ä¸ªæé æ¹æ³ï¼\n\næ¹æ³                                                             æè¿°\nsocket()                                                       éè¿ç³»ç»é»è®¤ç±»åç socketimpl åå»ºæªè¿æ¥å¥æ¥å­\nsocket(string host, int port)                                  åå»ºä¸ä¸ªæµå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå®ä¸»æºä¸çæå®ç«¯å£å·ã\nsocket(inetaddress host, int port)                             åå»ºä¸ä¸ªæµå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå® ip å°åçæå®ç«¯å£å·ã\nsocket(string host, int port, inetaddress localaddress, int    åå»ºä¸ä¸ªå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå®è¿ç¨ä¸»æºä¸çæå®è¿ç¨ç«¯å£ã\nlocalport)\nsocket(inetaddress host, int port, inetaddress localaddress,   åå»ºä¸ä¸ªå¥æ¥å­å¹¶å°å¶è¿æ¥å°æå®è¿ç¨å°åä¸çæå®è¿ç¨ç«¯å£ã\nint localport)\n\nå½ socket æé æ¹æ³è¿åï¼å¹¶æ²¡æç®åçå®ä¾åäºä¸ä¸ª socket å¯¹è±¡ï¼å®å®éä¸ä¼å°è¯è¿æ¥å°æå®çæå¡å¨åç«¯å£ã\n\n# socket å¸¸ç¨æ¹æ³\n\nä¸é¢ååºäºä¸äºæå´è¶£çæ¹æ³ï¼æ³¨æå®¢æ·ç«¯åæå¡å¨ç«¯é½æä¸ä¸ª socket å¯¹è±¡ï¼æä»¥æ è®ºå®¢æ·ç«¯è¿æ¯æå¡ç«¯é½è½å¤è°ç¨è¿äºæ¹æ³ã\n\næ¹æ³                                              æè¿°\nvoid connect(socketaddress host, int timeout)   å°æ­¤å¥æ¥å­è¿æ¥å°æå¡å¨ï¼å¹¶æå®ä¸ä¸ªè¶æ¶å¼ã\ninetaddress getinetaddress()                    è¿åå¥æ¥å­è¿æ¥çå°åã\nint getport()                                   è¿åæ­¤å¥æ¥å­è¿æ¥å°çè¿ç¨ç«¯å£ã\nint getlocalport()                              è¿åæ­¤å¥æ¥å­ç»å®å°çæ¬å°ç«¯å£ã\nsocketaddress getremotesocketaddress()          è¿åæ­¤å¥æ¥å­è¿æ¥çç«¯ç¹çå°åï¼å¦ææªè¿æ¥åè¿å nullã\ninputstream getinputstream()                    è¿åæ­¤å¥æ¥å­çè¾å¥æµã\noutputstream getoutputstream()                  è¿åæ­¤å¥æ¥å­çè¾åºæµã\nvoid close()                                    å³é­æ­¤å¥æ¥å­ã\n\n\n# socket éä¿¡ç¤ºä¾\n\næå¡ç«¯ç¤ºä¾ï¼\n\npublic class helloserver {\n\n    public static void main(string[] args) throws exception {\n        // socket æå¡ç«¯\n        // æå¡å¨å¨8888ç«¯å£ä¸çå¬\n        serversocket server = new serversocket(8888);\n        system.out.println("æå¡å¨è¿è¡ä¸­ï¼ç­å¾å®¢æ·ç«¯è¿æ¥ã");\n        // å¾å°è¿æ¥ï¼ç¨åºè¿å¥å°é»å¡ç¶æ\n        socket client = server.accept();\n        // æå°æµè¾åºææ¹ä¾¿\n        printstream out = new printstream(client.getoutputstream());\n        // åå®¢æ·ç«¯è¾åºä¿¡æ¯\n        out.println("hello world");\n        client.close();\n        server.close();\n        system.out.println("æå¡å¨å·²åå®¢æ·ç«¯åéæ¶æ¯ï¼éåºã");\n    }\n\n}\n\n\nå®¢æ·ç«¯ç¤ºä¾ï¼\n\npublic class helloclient {\n\n    public static void main(string[] args) throws exception {\n        // socket å®¢æ·ç«¯\n        socket client = new socket("localhost", 8888);\n        inputstreamreader inputstreamreader = new inputstreamreader(client.getinputstream());\n        // ä¸æ¬¡æ§æ¥æ¶å®æ\n        bufferedreader buf = new bufferedreader(inputstreamreader);\n        string str = buf.readline();\n        buf.close();\n        client.close();\n        system.out.println("å®¢æ·ç«¯æ¥æ¶å°æå¡å¨æ¶æ¯ï¼" + str + "ï¼éåº");\n    }\n\n}\n\n\n\n# datagramsocket å datagrampacket\n\njava éè¿ datagramsocket å datagrampacket å®ç°å¯¹ udp åè®®çæ¯æã\n\n * datagrampacketï¼æ°æ®åç±»\n * datagramsocketï¼éä¿¡ç±»\n\nudp æå¡ç«¯ç¤ºä¾ï¼\n\npublic class udpserver {\n\n    public static void main(string[] args) throws exception { // ææå¼å¸¸æåº\n        string str = "hello world!!!";\n        datagramsocket ds = new datagramsocket(3000); // æå¡ç«¯å¨3000ç«¯å£ä¸ç­å¾æå¡å¨åéä¿¡æ¯\n        datagrampacket dp =\n            new datagrampacket(str.getbytes(), str.length(), inetaddress.getbyname("localhost"), 9000); // ææçä¿¡æ¯ä½¿ç¨bufä¿å­\n        system.out.println("åéä¿¡æ¯ã");\n        ds.send(dp); // åéä¿¡æ¯åºå»\n        ds.close();\n    }\n\n}\n\n\nudp å®¢æ·ç«¯ç¤ºä¾ï¼\n\npublic class udpclient {\n\n    public static void main(string[] args) throws exception { // ææå¼å¸¸æåº\n        byte[] buf = new byte[1024]; // å¼è¾ç©ºé´ï¼ä»¥æ¥æ¶æ°æ®\n        datagramsocket ds = new datagramsocket(9000); // å®¢æ·ç«¯å¨9000ç«¯å£ä¸ç­å¾æå¡å¨åéä¿¡æ¯\n        datagrampacket dp = new datagrampacket(buf, 1024); // ææçä¿¡æ¯ä½¿ç¨bufä¿å­\n        ds.receive(dp); // æ¥æ¶æ°æ®\n        string str = new string(dp.getdata(), 0, dp.getlength()) + "from " + dp.getaddress().gethostaddress() + "ï¼"\n            + dp.getport();\n        system.out.println(str); // è¾åºåå®¹\n    }\n\n}\n\n\n\n# inetaddress\n\ninetaddress ç±»è¡¨ç¤ºäºèç½åè®®(ip)å°åã\n\næ²¡æå¬æçæé å½æ°ï¼åªè½éè¿éææ¹æ³æ¥åå»ºå®ä¾ã\n\ninetaddress.getbyname(string host);\ninetaddress.getbyaddress(byte[] address);\n\n\n\n# url\n\nå¯ä»¥ç´æ¥ä» url ä¸­è¯»åå­èæµæ°æ®ã\n\npublic static void main(string[] args) throws ioexception {\n\n    url url = new url("http://www.baidu.com");\n\n    /* å­èæµ */\n    inputstream is = url.openstream();\n\n    /* å­ç¬¦æµ */\n    inputstreamreader isr = new inputstreamreader(is, "utf-8");\n\n    /* æä¾ç¼å­åè½ */\n    bufferedreader br = new bufferedreader(isr);\n\n    string line;\n    while ((line = br.readline()) != null) {\n        system.out.println(line);\n    }\n\n    br.close();\n}\n\n\n\n# åèèµæ\n\n * java ç½ç»ç¼ç¨',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java IO å·¥å·ç±»",frontmatter:{title:"Java IO å·¥å·ç±»",date:"2020-06-30T21:34:59.000Z",categories:["Java","JavaSE","IO"],tags:["Java","JavaSE","IO","å·¥å·ç±»"],permalink:"/pages/e25d81/"},regularPath:"/01.Java/01.JavaSE/04.IO/05.JavaIO%E5%B7%A5%E5%85%B7%E7%B1%BB.html",relativePath:"01.Java/01.JavaSE/04.IO/05.JavaIOå·¥å·ç±».md",key:"v-2bdc15e1",path:"/pages/e25d81/",headers:[{level:2,title:"File",slug:"file",normalizedTitle:"file",charIndex:21},{level:3,title:"createNewFille",slug:"createnewfille",normalizedTitle:"createnewfille",charIndex:156},{level:3,title:"mkdir",slug:"mkdir",normalizedTitle:"mkdir",charIndex:398},{level:3,title:"delete",slug:"delete",normalizedTitle:"delete",charIndex:571},{level:3,title:"list å listFiles",slug:"list-å-listfiles",normalizedTitle:"list å listfiles",charIndex:722},{level:2,title:"RandomAccessFile",slug:"randomaccessfile",normalizedTitle:"randomaccessfile",charIndex:26},{level:3,title:"RandomAccessFile åæä½",slug:"randomaccessfile-åæä½",normalizedTitle:"randomaccessfile åæä½",charIndex:1219},{level:3,title:"RandomAccessFile è¯»æä½",slug:"randomaccessfile-è¯»æä½",normalizedTitle:"randomaccessfile è¯»æä½",charIndex:2174},{level:2,title:"System",slug:"system",normalizedTitle:"system",charIndex:43},{level:2,title:"Scanner",slug:"scanner",normalizedTitle:"scanner",charIndex:50},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6811}],headersStr:"File createNewFille mkdir delete list å listFiles RandomAccessFile RandomAccessFile åæä½ RandomAccessFile è¯»æä½ System Scanner åèèµæ",content:'# Java IO å·¥å·ç±»\n\n> å³é®è¯ï¼FileãRandomAccessFileãSystemãScanner\n> \n> æ¬æä»ç» Java IO çä¸äºå¸¸è§å·¥å·ç±»çç¨æ³åç¹æ§ã\n\n\n# File\n\nFile ç±»æ¯ java.io åä¸­å¯ä¸å¯¹æä»¶æ¬èº«è¿è¡æä½çç±»ãå®å¯ä»¥å¯¹æä»¶ãç®å½è¿è¡å¢å æ¥æä½ã\n\n\n# createNewFille\n\nå¯ä»¥ä½¿ç¨ createNewFille() æ¹æ³åå»ºä¸ä¸ªæ°æä»¶ã\n\næ³¨ï¼\n\nWindows ä¸­ä½¿ç¨åææ è¡¨ç¤ºç®å½çåéç¬¦ \\ã~~~~~~~~\n\nLinux ä¸­ä½¿ç¨æ­£ææ è¡¨ç¤ºç®å½çåéç¬¦ /ã\n\næå¥½çåæ³æ¯ä½¿ç¨ File.separator éæå¸¸éï¼å¯ä»¥æ ¹æ®æå¨æä½ç³»ç»éåå¯¹åºçåéç¬¦ã\n\nãç¤ºä¾ãåå»ºæä»¶\n\nFile f = new File(filename);\nboolean flag = f.createNewFile();\n\n\n\n# mkdir\n\nå¯ä»¥ä½¿ç¨ mkdir() æ¥åå»ºæä»¶å¤¹ï¼ä½æ¯å¦æè¦åå»ºçç®å½çç¶è·¯å¾ä¸å­å¨ï¼åæ æ³åå»ºæåã\n\nå¦æè¦è§£å³è¿ä¸ªé®é¢ï¼å¯ä»¥ä½¿ç¨ mkdirs()ï¼å½ç¶è·¯å¾ä¸å­å¨æ¶ï¼ä¼è¿åä¸çº§ç®å½é½ä¸å¹¶åå»ºã\n\nãç¤ºä¾ãåå»ºç®å½\n\nFile f = new File(filename);\nboolean flag = f.mkdir();\n\n\n\n# delete\n\nå¯ä»¥ä½¿ç¨ delete() æ¥å é¤æä»¶æç®å½ã\n\néè¦æ³¨æçæ¯ï¼å¦æå é¤çæ¯ç®å½ï¼ä¸ç®å½ä¸ä¸ºç©ºï¼ç´æ¥ç¨ delete() å é¤ä¼å¤±è´¥ã\n\nãç¤ºä¾ãå é¤æä»¶æç®å½\n\nFile f = new File(filename);\nboolean flag = f.delete();\n\n\n\n# list å listFiles\n\nFile ä¸­ç»åºäºä¸¤ç§ååºæä»¶å¤¹åå®¹çæ¹æ³ï¼\n\n * list(): ååºå¨é¨åç§°ï¼è¿åä¸ä¸ªå­ç¬¦ä¸²æ°ç»ã\n * listFiles(): ååºå®æ´çè·¯å¾ï¼è¿åä¸ä¸ª File å¯¹è±¡æ°ç»ã\n\nlist() ç¤ºä¾ï¼\n\nFile f = new File(filename);\nString str[] = f.list();\n\n\nlistFiles() ç¤ºä¾ï¼\n\nFile f = new File(filename);\nFile files[] = f.listFiles();\n\n\n\n# RandomAccessFile\n\n> æ³¨ï¼RandomAccessFile ç±»è½ç¶å¯ä»¥å®ç°å¯¹æä»¶åå®¹çè¯»åæä½ï¼ä½æ¯æ¯è¾å¤æãæä»¥ä¸è¬æä½æä»¶åå®¹å¾å¾ä¼ä½¿ç¨å­èæµæå­ç¬¦æµæ¹å¼ã\n\nRandomAccessFile ç±»æ¯éæºè¯»åç±»ï¼å®æ¯ä¸ä¸ªå®å¨ç¬ç«çç±»ã\n\nå®éç¨äºç±å¤§å°å·²ç¥çè®°å½ç»æçæä»¶ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨ seek() å°è®°å½ä»ä¸å¤è½¬ç§»å°å¦ä¸å¤ï¼ç¶åè¯»åæèä¿®æ¹è®°å½ã\n\næä»¶ä¸­è®°å½çå¤§å°ä¸ä¸å®é½ç¸åï¼åªè¦è½å¤ç¡®å®åªäºè®°å½æå¤å¤§ä»¥åå®ä»¬å¨æä»¶ä¸­çä½ç½®å³å¯ã\n\n\n# RandomAccessFile åæä½\n\nå½ç¨ rw æ¹å¼å£°æ RandomAccessFile å¯¹è±¡æ¶ï¼å¦æè¦åå¥çæä»¶ä¸å­å¨ï¼ç³»ç»å°èªè¡åå»ºã\n\nr ä¸ºåªè¯»ï¼w ä¸ºåªåï¼rw ä¸ºè¯»åã\n\nãç¤ºä¾ãæä»¶éæºè¯»å\n\npublic class RandomAccessFileDemo01 {\n\n    public static void main(String args[]) throws IOException {\n        File f = new File("d:" + File.separator + "test.txt"); // æå®è¦æä½çæä»¶\n        RandomAccessFile rdf = null; // å£°æRandomAccessFileç±»çå¯¹è±¡\n        rdf = new RandomAccessFile(f, "rw");// è¯»åæ¨¡å¼ï¼å¦ææä»¶ä¸å­å¨ï¼ä¼èªå¨åå»º\n        String name = null;\n        int age = 0;\n        name = "zhangsan"; // å­ç¬¦ä¸²é¿åº¦ä¸º8\n        age = 30; // æ°å­çé¿åº¦ä¸º4\n        rdf.writeBytes(name); // å°å§ååå¥æä»¶ä¹ä¸­\n        rdf.writeInt(age); // å°å¹´é¾åå¥æä»¶ä¹ä¸­\n        name = "lisi    "; // å­ç¬¦ä¸²é¿åº¦ä¸º8\n        age = 31; // æ°å­çé¿åº¦ä¸º4\n        rdf.writeBytes(name); // å°å§ååå¥æä»¶ä¹ä¸­\n        rdf.writeInt(age); // å°å¹´é¾åå¥æä»¶ä¹ä¸­\n        name = "wangwu  "; // å­ç¬¦ä¸²é¿åº¦ä¸º8\n        age = 32; // æ°å­çé¿åº¦ä¸º4\n        rdf.writeBytes(name); // å°å§ååå¥æä»¶ä¹ä¸­\n        rdf.writeInt(age); // å°å¹´é¾åå¥æä»¶ä¹ä¸­\n        rdf.close(); // å³é­\n    }\n}\n\n\n\n# RandomAccessFile è¯»æä½\n\nè¯»åæ¯ç´æ¥ä½¿ç¨ r çæ¨¡å¼å³å¯ï¼ä»¥åªè¯»çæ¹å¼æå¼æä»¶ã\n\nè¯»åæ¶ææçå­ç¬¦ä¸²åªè½æç§ byte æ°ç»æ¹å¼è¯»ååºæ¥ï¼èä¸é¿åº¦å¿é¡»ååå¥æ¶çåºå®å¤§å°ç¸å¹éã\n\npublic class RandomAccessFileDemo02 {\n\n    public static void main(String args[]) throws IOException {\n        File f = new File("d:" + File.separator + "test.txt");    // æå®è¦æä½çæä»¶\n        RandomAccessFile rdf = null;        // å£°æRandomAccessFileç±»çå¯¹è±¡\n        rdf = new RandomAccessFile(f, "r");// ä»¥åªè¯»çæ¹å¼æå¼æä»¶\n        String name = null;\n        int age = 0;\n        byte b[] = new byte[8];    // å¼è¾byteæ°ç»\n        // è¯»åç¬¬äºä¸ªäººçä¿¡æ¯ï¼æå³çè¦ç©ºåºç¬¬ä¸ä¸ªäººçä¿¡æ¯\n        rdf.skipBytes(12);        // è·³è¿ç¬¬ä¸ä¸ªäººçä¿¡æ¯\n        for (int i = 0; i < b.length; i++) {\n            b[i] = rdf.readByte();    // è¯»åä¸ä¸ªå­è\n        }\n        name = new String(b);    // å°è¯»ååºæ¥çbyteæ°ç»åä¸ºå­ç¬¦ä¸²\n        age = rdf.readInt();    // è¯»åæ°å­\n        System.out.println("ç¬¬äºä¸ªäººçä¿¡æ¯ --\x3e å§åï¼" + name + "ï¼å¹´é¾ï¼" + age);\n        // è¯»åç¬¬ä¸ä¸ªäººçä¿¡æ¯\n        rdf.seek(0);    // æéåå°æä»¶çå¼å¤´\n        for (int i = 0; i < b.length; i++) {\n            b[i] = rdf.readByte();    // è¯»åä¸ä¸ªå­è\n        }\n        name = new String(b);    // å°è¯»ååºæ¥çbyteæ°ç»åä¸ºå­ç¬¦ä¸²\n        age = rdf.readInt();    // è¯»åæ°å­\n        System.out.println("ç¬¬ä¸ä¸ªäººçä¿¡æ¯ --\x3e å§åï¼" + name + "ï¼å¹´é¾ï¼" + age);\n        rdf.skipBytes(12);    // ç©ºåºç¬¬äºä¸ªäººçä¿¡æ¯\n        for (int i = 0; i < b.length; i++) {\n            b[i] = rdf.readByte();    // è¯»åä¸ä¸ªå­è\n        }\n        name = new String(b);    // å°è¯»ååºæ¥çbyteæ°ç»åä¸ºå­ç¬¦ä¸²\n        age = rdf.readInt();    // è¯»åæ°å­\n        System.out.println("ç¬¬ä¸ä¸ªäººçä¿¡æ¯ --\x3e å§åï¼" + name + "ï¼å¹´é¾ï¼" + age);\n        rdf.close();                // å³é­\n    }\n}\n\n\n\n# System\n\nSystem ç±»ä¸­æä¾äºå¤§éçéææ¹æ³ï¼å¯ä»¥è·åç³»ç»ç¸å³çä¿¡æ¯æç³»ç»çº§æä½ï¼å¶ä¸­æä¾äºä¸ä¸ªå¸¸ç¨äº IO çéææåï¼\n\n * System.out - ä¸ä¸ª PrintStream æµãSystem.out ä¸è¬ä¼æä½ åå°å¶ä¸­çæ°æ®è¾åºå°æ§å¶å°ä¸ãSystem.out éå¸¸ä»ç¨å¨ç±»ä¼¼å½ä»¤è¡å·¥å·çæ§å¶å°ç¨åºä¸ãSystem.out ä¹ç»å¸¸ç¨äºæå°ç¨åºçè°è¯ä¿¡æ¯(å°½ç®¡å®å¯è½å¹¶ä¸æ¯è·åç¨åºè°è¯ä¿¡æ¯çæä½³æ¹å¼)ã\n * System.err - ä¸ä¸ª PrintStream æµãSystem.err ä¸ System.out çè¿è¡æ¹å¼ç±»ä¼¼ï¼ä½å®æ´å¤çæ¯ç¨äºæå°éè¯¯ææ¬ãä¸äºç±»ä¼¼ Eclipse çç¨åºï¼ä¸ºäºè®©éè¯¯ä¿¡æ¯æ´å æ¾ç¼ï¼ä¼å°éè¯¯ä¿¡æ¯ä»¥çº¢è²ææ¬çå½¢å¼éè¿ System.err è¾åºå°æ§å¶å°ä¸ã\n * System.in - ä¸ä¸ªå¸åçè¿æ¥æ§å¶å°ç¨åºåé®çè¾å¥ç InputStream æµãéå¸¸å½æ°æ®éè¿å½ä»¤è¡åæ°æèéç½®æä»¶ä¼ éç»å½ä»¤è¡ Java ç¨åºçæ¶åï¼System.in å¹¶ä¸æ¯å¾å¸¸ç¨ãå¾å½¢çé¢ç¨åºéè¿çé¢ä¼ éåæ°ç»ç¨åºï¼è¿æ¯ä¸ååç¬ç Java IO è¾å¥æºå¶ã\n\nãç¤ºä¾ãéå®å System.out è¾åºæµ\n\nimport java.io.*;\npublic class SystemOutDemo {\n\n    public static void main(String args[]) throws Exception {\n        OutputStream out = new FileOutputStream("d:\\\\test.txt");\n        PrintStream ps = new PrintStream(out);\n        System.setOut(ps);\n        System.out.println("äººçè¥åªå¦åè§ï¼ä½äºç§é£æ²ç»æ");\n        ps.close();\n        out.close();\n    }\n}\n\n\nãç¤ºä¾ãéå®å System.err è¾åºæµ\n\npublic class SystemErrDemo {\n\n    public static void main(String args[]) throws IOException {\n        OutputStream bos = new ByteArrayOutputStream();        // å®ä¾å\n        PrintStream ps = new PrintStream(bos);        // å®ä¾å\n        System.setErr(ps);    // è¾åºéå®å\n        System.err.print("æ­¤å¤æè¯¯");\n        System.out.println(bos);    // è¾åºåå­ä¸­çæ°æ®\n    }\n}\n\n\nãç¤ºä¾ãSystem.in æ¥åæ§å¶å°è¾å¥ä¿¡æ¯\n\nimport java.io.*;\npublic class SystemInDemo {\n\n    public static void main(String args[]) throws IOException {\n        InputStream input = System.in;\n        StringBuffer buf = new StringBuffer();\n        System.out.print("è¯·è¾å¥åå®¹ï¼");\n        int temp = 0;\n        while ((temp = input.read()) != -1) {\n            char c = (char) temp;\n            if (c == \'\\n\') {\n                break;\n            }\n            buf.append(c);\n        }\n        System.out.println("è¾å¥çåå®¹ä¸ºï¼" + buf);\n        input.close();\n    }\n}\n\n\n\n# Scanner\n\nScanner å¯ä»¥è·åç¨æ·çè¾å¥ï¼å¹¶å¯¹æ°æ®è¿è¡æ ¡éªã\n\nãç¤ºä¾ãæ ¡éªè¾å¥æ°æ®æ¯å¦æ ¼å¼æ­£ç¡®\n\nimport java.io.*;\npublic class ScannerDemo {\n\n    public static void main(String args[]) {\n        Scanner scan = new Scanner(System.in);    // ä»é®çæ¥æ¶æ°æ®\n        int i = 0;\n        float f = 0.0f;\n        System.out.print("è¾å¥æ´æ°ï¼");\n        if (scan.hasNextInt()) {    // å¤æ­è¾å¥çæ¯å¦æ¯æ´æ°\n            i = scan.nextInt();    // æ¥æ¶æ´æ°\n            System.out.println("æ´æ°æ°æ®ï¼" + i);\n        } else {\n            System.out.println("è¾å¥çä¸æ¯æ´æ°ï¼");\n        }\n\n        System.out.print("è¾å¥å°æ°ï¼");\n        if (scan.hasNextFloat()) {    // å¤æ­è¾å¥çæ¯å¦æ¯å°æ°\n            f = scan.nextFloat();    // æ¥æ¶å°æ°\n            System.out.println("å°æ°æ°æ®ï¼" + f);\n        } else {\n            System.out.println("è¾å¥çä¸æ¯å°æ°ï¼");\n        }\n\n        Date date = null;\n        String str = null;\n        System.out.print("è¾å¥æ¥æï¼yyyy-MM-ddï¼ï¼");\n        if (scan.hasNext("^\\\\d{4}-\\\\d{2}-\\\\d{2}$")) {    // å¤æ­\n            str = scan.next("^\\\\d{4}-\\\\d{2}-\\\\d{2}$");    // æ¥æ¶\n            try {\n                date = new SimpleDateFormat("yyyy-MM-dd").parse(str);\n            } catch (Exception e) {}\n        } else {\n            System.out.println("è¾å¥çæ¥ææ ¼å¼éè¯¯ï¼");\n        }\n        System.out.println(date);\n    }\n}\n\n\nè¾åºï¼\n\nè¾å¥æ´æ°ï¼20\næ´æ°æ°æ®ï¼20\nè¾å¥å°æ°ï¼3.2\nå°æ°æ°æ®ï¼3.2\nè¾å¥æ¥æï¼yyyy-MM-ddï¼ï¼1988-13-1\nè¾å¥çæ¥ææ ¼å¼éè¯¯ï¼\nnull\n\n\n\n# åèèµæ\n\n * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n * System å®æ¹ API æå',normalizedContent:'# java io å·¥å·ç±»\n\n> å³é®è¯ï¼fileãrandomaccessfileãsystemãscanner\n> \n> æ¬æä»ç» java io çä¸äºå¸¸è§å·¥å·ç±»çç¨æ³åç¹æ§ã\n\n\n# file\n\nfile ç±»æ¯ java.io åä¸­å¯ä¸å¯¹æä»¶æ¬èº«è¿è¡æä½çç±»ãå®å¯ä»¥å¯¹æä»¶ãç®å½è¿è¡å¢å æ¥æä½ã\n\n\n# createnewfille\n\nå¯ä»¥ä½¿ç¨ createnewfille() æ¹æ³åå»ºä¸ä¸ªæ°æä»¶ã\n\næ³¨ï¼\n\nwindows ä¸­ä½¿ç¨åææ è¡¨ç¤ºç®å½çåéç¬¦ \\ã~~~~~~~~\n\nlinux ä¸­ä½¿ç¨æ­£ææ è¡¨ç¤ºç®å½çåéç¬¦ /ã\n\næå¥½çåæ³æ¯ä½¿ç¨ file.separator éæå¸¸éï¼å¯ä»¥æ ¹æ®æå¨æä½ç³»ç»éåå¯¹åºçåéç¬¦ã\n\nãç¤ºä¾ãåå»ºæä»¶\n\nfile f = new file(filename);\nboolean flag = f.createnewfile();\n\n\n\n# mkdir\n\nå¯ä»¥ä½¿ç¨ mkdir() æ¥åå»ºæä»¶å¤¹ï¼ä½æ¯å¦æè¦åå»ºçç®å½çç¶è·¯å¾ä¸å­å¨ï¼åæ æ³åå»ºæåã\n\nå¦æè¦è§£å³è¿ä¸ªé®é¢ï¼å¯ä»¥ä½¿ç¨ mkdirs()ï¼å½ç¶è·¯å¾ä¸å­å¨æ¶ï¼ä¼è¿åä¸çº§ç®å½é½ä¸å¹¶åå»ºã\n\nãç¤ºä¾ãåå»ºç®å½\n\nfile f = new file(filename);\nboolean flag = f.mkdir();\n\n\n\n# delete\n\nå¯ä»¥ä½¿ç¨ delete() æ¥å é¤æä»¶æç®å½ã\n\néè¦æ³¨æçæ¯ï¼å¦æå é¤çæ¯ç®å½ï¼ä¸ç®å½ä¸ä¸ºç©ºï¼ç´æ¥ç¨ delete() å é¤ä¼å¤±è´¥ã\n\nãç¤ºä¾ãå é¤æä»¶æç®å½\n\nfile f = new file(filename);\nboolean flag = f.delete();\n\n\n\n# list å listfiles\n\nfile ä¸­ç»åºäºä¸¤ç§ååºæä»¶å¤¹åå®¹çæ¹æ³ï¼\n\n * list(): ååºå¨é¨åç§°ï¼è¿åä¸ä¸ªå­ç¬¦ä¸²æ°ç»ã\n * listfiles(): ååºå®æ´çè·¯å¾ï¼è¿åä¸ä¸ª file å¯¹è±¡æ°ç»ã\n\nlist() ç¤ºä¾ï¼\n\nfile f = new file(filename);\nstring str[] = f.list();\n\n\nlistfiles() ç¤ºä¾ï¼\n\nfile f = new file(filename);\nfile files[] = f.listfiles();\n\n\n\n# randomaccessfile\n\n> æ³¨ï¼randomaccessfile ç±»è½ç¶å¯ä»¥å®ç°å¯¹æä»¶åå®¹çè¯»åæä½ï¼ä½æ¯æ¯è¾å¤æãæä»¥ä¸è¬æä½æä»¶åå®¹å¾å¾ä¼ä½¿ç¨å­èæµæå­ç¬¦æµæ¹å¼ã\n\nrandomaccessfile ç±»æ¯éæºè¯»åç±»ï¼å®æ¯ä¸ä¸ªå®å¨ç¬ç«çç±»ã\n\nå®éç¨äºç±å¤§å°å·²ç¥çè®°å½ç»æçæä»¶ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨ seek() å°è®°å½ä»ä¸å¤è½¬ç§»å°å¦ä¸å¤ï¼ç¶åè¯»åæèä¿®æ¹è®°å½ã\n\næä»¶ä¸­è®°å½çå¤§å°ä¸ä¸å®é½ç¸åï¼åªè¦è½å¤ç¡®å®åªäºè®°å½æå¤å¤§ä»¥åå®ä»¬å¨æä»¶ä¸­çä½ç½®å³å¯ã\n\n\n# randomaccessfile åæä½\n\nå½ç¨ rw æ¹å¼å£°æ randomaccessfile å¯¹è±¡æ¶ï¼å¦æè¦åå¥çæä»¶ä¸å­å¨ï¼ç³»ç»å°èªè¡åå»ºã\n\nr ä¸ºåªè¯»ï¼w ä¸ºåªåï¼rw ä¸ºè¯»åã\n\nãç¤ºä¾ãæä»¶éæºè¯»å\n\npublic class randomaccessfiledemo01 {\n\n    public static void main(string args[]) throws ioexception {\n        file f = new file("d:" + file.separator + "test.txt"); // æå®è¦æä½çæä»¶\n        randomaccessfile rdf = null; // å£°ærandomaccessfileç±»çå¯¹è±¡\n        rdf = new randomaccessfile(f, "rw");// è¯»åæ¨¡å¼ï¼å¦ææä»¶ä¸å­å¨ï¼ä¼èªå¨åå»º\n        string name = null;\n        int age = 0;\n        name = "zhangsan"; // å­ç¬¦ä¸²é¿åº¦ä¸º8\n        age = 30; // æ°å­çé¿åº¦ä¸º4\n        rdf.writebytes(name); // å°å§ååå¥æä»¶ä¹ä¸­\n        rdf.writeint(age); // å°å¹´é¾åå¥æä»¶ä¹ä¸­\n        name = "lisi    "; // å­ç¬¦ä¸²é¿åº¦ä¸º8\n        age = 31; // æ°å­çé¿åº¦ä¸º4\n        rdf.writebytes(name); // å°å§ååå¥æä»¶ä¹ä¸­\n        rdf.writeint(age); // å°å¹´é¾åå¥æä»¶ä¹ä¸­\n        name = "wangwu  "; // å­ç¬¦ä¸²é¿åº¦ä¸º8\n        age = 32; // æ°å­çé¿åº¦ä¸º4\n        rdf.writebytes(name); // å°å§ååå¥æä»¶ä¹ä¸­\n        rdf.writeint(age); // å°å¹´é¾åå¥æä»¶ä¹ä¸­\n        rdf.close(); // å³é­\n    }\n}\n\n\n\n# randomaccessfile è¯»æä½\n\nè¯»åæ¯ç´æ¥ä½¿ç¨ r çæ¨¡å¼å³å¯ï¼ä»¥åªè¯»çæ¹å¼æå¼æä»¶ã\n\nè¯»åæ¶ææçå­ç¬¦ä¸²åªè½æç§ byte æ°ç»æ¹å¼è¯»ååºæ¥ï¼èä¸é¿åº¦å¿é¡»ååå¥æ¶çåºå®å¤§å°ç¸å¹éã\n\npublic class randomaccessfiledemo02 {\n\n    public static void main(string args[]) throws ioexception {\n        file f = new file("d:" + file.separator + "test.txt");    // æå®è¦æä½çæä»¶\n        randomaccessfile rdf = null;        // å£°ærandomaccessfileç±»çå¯¹è±¡\n        rdf = new randomaccessfile(f, "r");// ä»¥åªè¯»çæ¹å¼æå¼æä»¶\n        string name = null;\n        int age = 0;\n        byte b[] = new byte[8];    // å¼è¾byteæ°ç»\n        // è¯»åç¬¬äºä¸ªäººçä¿¡æ¯ï¼æå³çè¦ç©ºåºç¬¬ä¸ä¸ªäººçä¿¡æ¯\n        rdf.skipbytes(12);        // è·³è¿ç¬¬ä¸ä¸ªäººçä¿¡æ¯\n        for (int i = 0; i < b.length; i++) {\n            b[i] = rdf.readbyte();    // è¯»åä¸ä¸ªå­è\n        }\n        name = new string(b);    // å°è¯»ååºæ¥çbyteæ°ç»åä¸ºå­ç¬¦ä¸²\n        age = rdf.readint();    // è¯»åæ°å­\n        system.out.println("ç¬¬äºä¸ªäººçä¿¡æ¯ --\x3e å§åï¼" + name + "ï¼å¹´é¾ï¼" + age);\n        // è¯»åç¬¬ä¸ä¸ªäººçä¿¡æ¯\n        rdf.seek(0);    // æéåå°æä»¶çå¼å¤´\n        for (int i = 0; i < b.length; i++) {\n            b[i] = rdf.readbyte();    // è¯»åä¸ä¸ªå­è\n        }\n        name = new string(b);    // å°è¯»ååºæ¥çbyteæ°ç»åä¸ºå­ç¬¦ä¸²\n        age = rdf.readint();    // è¯»åæ°å­\n        system.out.println("ç¬¬ä¸ä¸ªäººçä¿¡æ¯ --\x3e å§åï¼" + name + "ï¼å¹´é¾ï¼" + age);\n        rdf.skipbytes(12);    // ç©ºåºç¬¬äºä¸ªäººçä¿¡æ¯\n        for (int i = 0; i < b.length; i++) {\n            b[i] = rdf.readbyte();    // è¯»åä¸ä¸ªå­è\n        }\n        name = new string(b);    // å°è¯»ååºæ¥çbyteæ°ç»åä¸ºå­ç¬¦ä¸²\n        age = rdf.readint();    // è¯»åæ°å­\n        system.out.println("ç¬¬ä¸ä¸ªäººçä¿¡æ¯ --\x3e å§åï¼" + name + "ï¼å¹´é¾ï¼" + age);\n        rdf.close();                // å³é­\n    }\n}\n\n\n\n# system\n\nsystem ç±»ä¸­æä¾äºå¤§éçéææ¹æ³ï¼å¯ä»¥è·åç³»ç»ç¸å³çä¿¡æ¯æç³»ç»çº§æä½ï¼å¶ä¸­æä¾äºä¸ä¸ªå¸¸ç¨äº io çéææåï¼\n\n * system.out - ä¸ä¸ª printstream æµãsystem.out ä¸è¬ä¼æä½ åå°å¶ä¸­çæ°æ®è¾åºå°æ§å¶å°ä¸ãsystem.out éå¸¸ä»ç¨å¨ç±»ä¼¼å½ä»¤è¡å·¥å·çæ§å¶å°ç¨åºä¸ãsystem.out ä¹ç»å¸¸ç¨äºæå°ç¨åºçè°è¯ä¿¡æ¯(å°½ç®¡å®å¯è½å¹¶ä¸æ¯è·åç¨åºè°è¯ä¿¡æ¯çæä½³æ¹å¼)ã\n * system.err - ä¸ä¸ª printstream æµãsystem.err ä¸ system.out çè¿è¡æ¹å¼ç±»ä¼¼ï¼ä½å®æ´å¤çæ¯ç¨äºæå°éè¯¯ææ¬ãä¸äºç±»ä¼¼ eclipse çç¨åºï¼ä¸ºäºè®©éè¯¯ä¿¡æ¯æ´å æ¾ç¼ï¼ä¼å°éè¯¯ä¿¡æ¯ä»¥çº¢è²ææ¬çå½¢å¼éè¿ system.err è¾åºå°æ§å¶å°ä¸ã\n * system.in - ä¸ä¸ªå¸åçè¿æ¥æ§å¶å°ç¨åºåé®çè¾å¥ç inputstream æµãéå¸¸å½æ°æ®éè¿å½ä»¤è¡åæ°æèéç½®æä»¶ä¼ éç»å½ä»¤è¡ java ç¨åºçæ¶åï¼system.in å¹¶ä¸æ¯å¾å¸¸ç¨ãå¾å½¢çé¢ç¨åºéè¿çé¢ä¼ éåæ°ç»ç¨åºï¼è¿æ¯ä¸ååç¬ç java io è¾å¥æºå¶ã\n\nãç¤ºä¾ãéå®å system.out è¾åºæµ\n\nimport java.io.*;\npublic class systemoutdemo {\n\n    public static void main(string args[]) throws exception {\n        outputstream out = new fileoutputstream("d:\\\\test.txt");\n        printstream ps = new printstream(out);\n        system.setout(ps);\n        system.out.println("äººçè¥åªå¦åè§ï¼ä½äºç§é£æ²ç»æ");\n        ps.close();\n        out.close();\n    }\n}\n\n\nãç¤ºä¾ãéå®å system.err è¾åºæµ\n\npublic class systemerrdemo {\n\n    public static void main(string args[]) throws ioexception {\n        outputstream bos = new bytearrayoutputstream();        // å®ä¾å\n        printstream ps = new printstream(bos);        // å®ä¾å\n        system.seterr(ps);    // è¾åºéå®å\n        system.err.print("æ­¤å¤æè¯¯");\n        system.out.println(bos);    // è¾åºåå­ä¸­çæ°æ®\n    }\n}\n\n\nãç¤ºä¾ãsystem.in æ¥åæ§å¶å°è¾å¥ä¿¡æ¯\n\nimport java.io.*;\npublic class systemindemo {\n\n    public static void main(string args[]) throws ioexception {\n        inputstream input = system.in;\n        stringbuffer buf = new stringbuffer();\n        system.out.print("è¯·è¾å¥åå®¹ï¼");\n        int temp = 0;\n        while ((temp = input.read()) != -1) {\n            char c = (char) temp;\n            if (c == \'\\n\') {\n                break;\n            }\n            buf.append(c);\n        }\n        system.out.println("è¾å¥çåå®¹ä¸ºï¼" + buf);\n        input.close();\n    }\n}\n\n\n\n# scanner\n\nscanner å¯ä»¥è·åç¨æ·çè¾å¥ï¼å¹¶å¯¹æ°æ®è¿è¡æ ¡éªã\n\nãç¤ºä¾ãæ ¡éªè¾å¥æ°æ®æ¯å¦æ ¼å¼æ­£ç¡®\n\nimport java.io.*;\npublic class scannerdemo {\n\n    public static void main(string args[]) {\n        scanner scan = new scanner(system.in);    // ä»é®çæ¥æ¶æ°æ®\n        int i = 0;\n        float f = 0.0f;\n        system.out.print("è¾å¥æ´æ°ï¼");\n        if (scan.hasnextint()) {    // å¤æ­è¾å¥çæ¯å¦æ¯æ´æ°\n            i = scan.nextint();    // æ¥æ¶æ´æ°\n            system.out.println("æ´æ°æ°æ®ï¼" + i);\n        } else {\n            system.out.println("è¾å¥çä¸æ¯æ´æ°ï¼");\n        }\n\n        system.out.print("è¾å¥å°æ°ï¼");\n        if (scan.hasnextfloat()) {    // å¤æ­è¾å¥çæ¯å¦æ¯å°æ°\n            f = scan.nextfloat();    // æ¥æ¶å°æ°\n            system.out.println("å°æ°æ°æ®ï¼" + f);\n        } else {\n            system.out.println("è¾å¥çä¸æ¯å°æ°ï¼");\n        }\n\n        date date = null;\n        string str = null;\n        system.out.print("è¾å¥æ¥æï¼yyyy-mm-ddï¼ï¼");\n        if (scan.hasnext("^\\\\d{4}-\\\\d{2}-\\\\d{2}$")) {    // å¤æ­\n            str = scan.next("^\\\\d{4}-\\\\d{2}-\\\\d{2}$");    // æ¥æ¶\n            try {\n                date = new simpledateformat("yyyy-mm-dd").parse(str);\n            } catch (exception e) {}\n        } else {\n            system.out.println("è¾å¥çæ¥ææ ¼å¼éè¯¯ï¼");\n        }\n        system.out.println(date);\n    }\n}\n\n\nè¾åºï¼\n\nè¾å¥æ´æ°ï¼20\næ´æ°æ°æ®ï¼20\nè¾å¥å°æ°ï¼3.2\nå°æ°æ°æ®ï¼3.2\nè¾å¥æ¥æï¼yyyy-mm-ddï¼ï¼1988-13-1\nè¾å¥çæ¥ææ ¼å¼éè¯¯ï¼\nnull\n\n\n\n# åèèµæ\n\n * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n * system å®æ¹ api æå',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java IO",frontmatter:{title:"Java IO",date:"2020-06-04T13:51:01.000Z",categories:["Java","JavaSE","IO"],tags:["Java","JavaSE","IO"],permalink:"/pages/e285c8/",hidden:!0},regularPath:"/01.Java/01.JavaSE/04.IO/",relativePath:"01.Java/01.JavaSE/04.IO/README.md",key:"v-0657f720",path:"/pages/e285c8/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:14},{level:3,title:"Java IO æ¨¡å",slug:"java-io-æ¨¡å",normalizedTitle:"java io æ¨¡å",charIndex:24},{level:3,title:"Java NIO",slug:"java-nio",normalizedTitle:"java nio",charIndex:87},{level:3,title:"Java åºåå",slug:"java-åºåå",normalizedTitle:"java åºåå",charIndex:142},{level:3,title:"Java ç½ç»ç¼ç¨",slug:"java-ç½ç»ç¼ç¨",normalizedTitle:"java ç½ç»ç¼ç¨",charIndex:242},{level:3,title:"Java IO å·¥å·ç±»",slug:"java-io-å·¥å·ç±»",normalizedTitle:"java io å·¥å·ç±»",charIndex:313},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:373},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:441}],headersStr:"ð åå®¹ Java IO æ¨¡å Java NIO Java åºåå Java ç½ç»ç¼ç¨ Java IO å·¥å·ç±» ð èµæ ðª ä¼ é",content:"# Java IO\n\n\n# ð åå®¹\n\n\n# Java IO æ¨¡å\n\n> å³é®è¯ï¼InputStreamãOutputStreamãReaderãWriter\n\n\n\n\n# Java NIO\n\n> å³é®è¯ï¼ChannelãBufferãSelectorãéé»å¡ãå¤è·¯å¤ç¨\n\n\n\n\n# Java åºåå\n\n> å³é®è¯ï¼SerializableãserialVersionUIDãtransientãExternalizableãwriteObjectãreadObject\n\n\n\n\n# Java ç½ç»ç¼ç¨\n\n> å³é®è¯ï¼SocketãServerSocketãDatagramPacketãDatagramSocket\n\n\n# Java IO å·¥å·ç±»\n\n> å³é®è¯ï¼FileãRandomAccessFileãSystemãScanner\n\n\n# ð èµæ\n\n * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n\n\n# ðª ä¼ é\n\nâ¾ ð  JAVACORE é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# java io\n\n\n# ð åå®¹\n\n\n# java io æ¨¡å\n\n> å³é®è¯ï¼inputstreamãoutputstreamãreaderãwriter\n\n\n\n\n# java nio\n\n> å³é®è¯ï¼channelãbufferãselectorãéé»å¡ãå¤è·¯å¤ç¨\n\n\n\n\n# java åºåå\n\n> å³é®è¯ï¼serializableãserialversionuidãtransientãexternalizableãwriteobjectãreadobject\n\n\n\n\n# java ç½ç»ç¼ç¨\n\n> å³é®è¯ï¼socketãserversocketãdatagrampacketãdatagramsocket\n\n\n# java io å·¥å·ç±»\n\n> å³é®è¯ï¼fileãrandomaccessfileãsystemãscanner\n\n\n# ð èµæ\n\n * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n\n\n# ðª ä¼ é\n\nâ¾ ð  javacore é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaçº¿ç¨åºç¡",frontmatter:{title:"Javaçº¿ç¨åºç¡",date:"2019-12-24T23:52:25.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å","çº¿ç¨"],permalink:"/pages/fee2cc/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/02.Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/02.Javaçº¿ç¨åºç¡.md",key:"v-201723ff",path:"/pages/fee2cc/",headers:[{level:2,title:"çº¿ç¨ç®ä»",slug:"çº¿ç¨ç®ä»",normalizedTitle:"çº¿ç¨ç®ä»",charIndex:104},{level:3,title:"ä»ä¹æ¯è¿ç¨",slug:"ä»ä¹æ¯è¿ç¨",normalizedTitle:"ä»ä¹æ¯è¿ç¨",charIndex:113},{level:3,title:"ä»ä¹æ¯çº¿ç¨",slug:"ä»ä¹æ¯çº¿ç¨",normalizedTitle:"ä»ä¹æ¯çº¿ç¨",charIndex:217},{level:3,title:"è¿ç¨åçº¿ç¨çåºå«",slug:"è¿ç¨åçº¿ç¨çåºå«",normalizedTitle:"è¿ç¨åçº¿ç¨çåºå«",charIndex:332},{level:2,title:"åå»ºçº¿ç¨",slug:"åå»ºçº¿ç¨",normalizedTitle:"åå»ºçº¿ç¨",charIndex:443},{level:3,title:"Thread",slug:"thread",normalizedTitle:"thread",charIndex:19},{level:3,title:"Runnable",slug:"runnable",normalizedTitle:"runnable",charIndex:26},{level:3,title:"CallableãFutureãFutureTask",slug:"callableãfutureãfuturetask",normalizedTitle:"callableãfutureãfuturetask",charIndex:2284},{level:4,title:"Callable",slug:"callable",normalizedTitle:"callable",charIndex:35},{level:4,title:"Future",slug:"future",normalizedTitle:"future",charIndex:44},{level:4,title:"FutureTask",slug:"futuretask",normalizedTitle:"futuretask",charIndex:2300},{level:4,title:"Callable + Future + FutureTask ç¤ºä¾",slug:"callable-future-futuretask-ç¤ºä¾",normalizedTitle:"callable + future + futuretask ç¤ºä¾",charIndex:3865},{level:2,title:"çº¿ç¨åºæ¬ç¨æ³",slug:"çº¿ç¨åºæ¬ç¨æ³",normalizedTitle:"çº¿ç¨åºæ¬ç¨æ³",charIndex:5079},{level:3,title:"çº¿ç¨ä¼ç ",slug:"çº¿ç¨ä¼ç ",normalizedTitle:"çº¿ç¨ä¼ç ",charIndex:5776},{level:3,title:"çº¿ç¨ç¤¼è®©",slug:"çº¿ç¨ç¤¼è®©",normalizedTitle:"çº¿ç¨ç¤¼è®©",charIndex:6860},{level:3,title:"ç»æ­¢çº¿ç¨",slug:"ç»æ­¢çº¿ç¨",normalizedTitle:"ç»æ­¢çº¿ç¨",charIndex:7716},{level:3,title:"å®æ¤çº¿ç¨",slug:"å®æ¤çº¿ç¨",normalizedTitle:"å®æ¤çº¿ç¨",charIndex:5452},{level:2,title:"çº¿ç¨éä¿¡",slug:"çº¿ç¨éä¿¡",normalizedTitle:"çº¿ç¨éä¿¡",charIndex:95},{level:3,title:"wait/notify/notifyAll",slug:"wait-notify-notifyall",normalizedTitle:"wait/notify/notifyall",charIndex:12221},{level:3,title:"join",slug:"join",normalizedTitle:"join",charIndex:73},{level:3,title:"ç®¡é",slug:"ç®¡é",normalizedTitle:"ç®¡é",charIndex:16662},{level:2,title:"çº¿ç¨çå½å¨æ",slug:"çº¿ç¨çå½å¨æ",normalizedTitle:"çº¿ç¨çå½å¨æ",charIndex:17845},{level:2,title:"çº¿ç¨å¸¸è§é®é¢",slug:"çº¿ç¨å¸¸è§é®é¢",normalizedTitle:"çº¿ç¨å¸¸è§é®é¢",charIndex:19356},{level:3,title:"sleepãyieldãjoin æ¹æ³æä»ä¹åºå«",slug:"sleepãyieldãjoin-æ¹æ³æä»ä¹åºå«",normalizedTitle:"sleepãyieldãjoin æ¹æ³æä»ä¹åºå«",charIndex:19367},{level:3,title:"ä¸ºä»ä¹ sleep å yield æ¹æ³æ¯éæç",slug:"ä¸ºä»ä¹-sleep-å-yield-æ¹æ³æ¯éæç",normalizedTitle:"ä¸ºä»ä¹ sleep å yield æ¹æ³æ¯éæç",charIndex:19847},{level:3,title:"Java çº¿ç¨æ¯å¦æç§çº¿ç¨ä¼åçº§ä¸¥æ ¼æ§è¡",slug:"java-çº¿ç¨æ¯å¦æç§çº¿ç¨ä¼åçº§ä¸¥æ ¼æ§è¡",normalizedTitle:"java çº¿ç¨æ¯å¦æç§çº¿ç¨ä¼åçº§ä¸¥æ ¼æ§è¡",charIndex:20022},{level:3,title:"ä¸ä¸ªçº¿ç¨ä¸¤æ¬¡è°ç¨ start()æ¹æ³ä¼ææ ·",slug:"ä¸ä¸ªçº¿ç¨ä¸¤æ¬¡è°ç¨-start-æ¹æ³ä¼ææ ·",normalizedTitle:"ä¸ä¸ªçº¿ç¨ä¸¤æ¬¡è°ç¨ start()æ¹æ³ä¼ææ ·",charIndex:20147},{level:3,title:"start å run æ¹æ³æä»ä¹åºå«",slug:"start-å-run-æ¹æ³æä»ä¹åºå«",normalizedTitle:"start å run æ¹æ³æä»ä¹åºå«",charIndex:20262},{level:3,title:"å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run æ¹æ³ä¹",slug:"å¯ä»¥ç´æ¥è°ç¨-thread-ç±»ç-run-æ¹æ³ä¹",normalizedTitle:"å¯ä»¥ç´æ¥è°ç¨ thread ç±»ç run æ¹æ³ä¹",charIndex:20347},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:20467}],headersStr:"çº¿ç¨ç®ä» ä»ä¹æ¯è¿ç¨ ä»ä¹æ¯çº¿ç¨ è¿ç¨åçº¿ç¨çåºå« åå»ºçº¿ç¨ Thread Runnable CallableãFutureãFutureTask Callable Future FutureTask Callable + Future + FutureTask ç¤ºä¾ çº¿ç¨åºæ¬ç¨æ³ çº¿ç¨ä¼ç  çº¿ç¨ç¤¼è®© ç»æ­¢çº¿ç¨ å®æ¤çº¿ç¨ çº¿ç¨éä¿¡ wait/notify/notifyAll join ç®¡é çº¿ç¨çå½å¨æ çº¿ç¨å¸¸è§é®é¢ sleepãyieldãjoin æ¹æ³æä»ä¹åºå« ä¸ºä»ä¹ sleep å yield æ¹æ³æ¯éæç Java çº¿ç¨æ¯å¦æç§çº¿ç¨ä¼åçº§ä¸¥æ ¼æ§è¡ ä¸ä¸ªçº¿ç¨ä¸¤æ¬¡è°ç¨ start()æ¹æ³ä¼ææ · start å run æ¹æ³æä»ä¹åºå« å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run æ¹æ³ä¹ åèèµæ",content:'# Java çº¿ç¨åºç¡\n\n> å³é®è¯ï¼ThreadãRunnableãCallableãFutureãwaitãnotifyãnotifyAllãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n\n\n# çº¿ç¨ç®ä»\n\n\n# ä»ä¹æ¯è¿ç¨\n\nç®è¨ä¹ï¼è¿ç¨å¯è§ä¸ºä¸ä¸ªæ­£å¨è¿è¡çç¨åºãå®æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼å æ­¤è¿ç¨æ¯å¨æçãè¿ç¨æ¯å·æä¸å®ç¬ç«åè½çç¨åºå³äºæä¸ªæ°æ®éåä¸çä¸æ¬¡è¿è¡æ´»å¨ãè¿ç¨æ¯æä½ç³»ç»è¿è¡èµæºåéçåºæ¬åä½ã\n\n\n# ä»ä¹æ¯çº¿ç¨\n\nçº¿ç¨æ¯æä½ç³»ç»è¿è¡è°åº¦çåºæ¬åä½ãçº¿ç¨ä¹å«è½»éçº§è¿ç¨ï¼Light Weight Processï¼ï¼å¨ä¸ä¸ªè¿ç¨éå¯ä»¥åå»ºå¤ä¸ªçº¿ç¨ï¼è¿äºçº¿ç¨é½æ¥æåèªçè®¡æ°å¨ãå æ åå±é¨åéç­å±æ§ï¼å¹¶ä¸è½å¤è®¿é®å±äº«çåå­åéã\n\n\n# è¿ç¨åçº¿ç¨çåºå«\n\n * ä¸ä¸ªç¨åºè³å°æä¸ä¸ªè¿ç¨ï¼ä¸ä¸ªè¿ç¨è³å°æä¸ä¸ªçº¿ç¨ã\n * çº¿ç¨æ¯è¿ç¨ååæ´ç»ï¼æä»¥æ§è¡å¼éæ´å°ï¼å¹¶åæ§æ´é«ã\n * è¿ç¨æ¯ä¸ä¸ªå®ä½ï¼æ¥æç¬ç«çèµæºï¼èåä¸ä¸ªè¿ç¨ä¸­çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çèµæºã\n\n\n# åå»ºçº¿ç¨\n\nåå»ºçº¿ç¨æä¸ç§æ¹å¼ï¼\n\n * ç»§æ¿ Thread ç±»\n * å®ç° Runnable æ¥å£\n * å®ç° Callable æ¥å£\n\n\n# Thread\n\néè¿ç»§æ¿ Thread ç±»åå»ºçº¿ç¨çæ­¥éª¤ï¼\n\n 1. å®ä¹ Thread ç±»çå­ç±»ï¼å¹¶è¦åè¯¥ç±»ç run æ¹æ³ãrun æ¹æ³çæ¹æ³ä½å°±ä»£è¡¨äºçº¿ç¨è¦å®æçä»»å¡ï¼å æ­¤æ run æ¹æ³ç§°ä¸ºæ§è¡ä½ã\n 2. åå»º Thread å­ç±»çå®ä¾ï¼å³åå»ºäºçº¿ç¨å¯¹è±¡ã\n 3. è°ç¨çº¿ç¨å¯¹è±¡ç start æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\npublic class ThreadDemo {\n\n    public static void main(String[] args) {\n        // å®ä¾åå¯¹è±¡\n        MyThread tA = new MyThread("Thread çº¿ç¨-A");\n        MyThread tB = new MyThread("Thread çº¿ç¨-B");\n        // è°ç¨çº¿ç¨ä¸»ä½\n        tA.start();\n        tB.start();\n    }\n\n    static class MyThread extends Thread {\n\n        private int ticket = 5;\n\n        MyThread(String name) {\n            super(name);\n        }\n\n        @Override\n        public void run() {\n            while (ticket > 0) {\n                System.out.println(Thread.currentThread().getName() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n        }\n\n    }\n\n}\n\n\n\n# Runnable\n\nå®ç° Runnable æ¥å£ä¼äºç»§æ¿ Thread ç±»ï¼å ä¸ºï¼\n\n * Java ä¸æ¯æå¤éç»§æ¿ï¼ææçç±»é½åªåè®¸ç»§æ¿ä¸ä¸ªç¶ç±»ï¼ä½å¯ä»¥å®ç°å¤ä¸ªæ¥å£ãå¦æç»§æ¿äº Thread ç±»å°±æ æ³ç»§æ¿å¶å®ç±»ï¼è¿ä¸å©äºæ©å±ã\n * ç±»å¯è½åªè¦æ±å¯æ§è¡å°±è¡ï¼ç»§æ¿æ´ä¸ª Thread ç±»å¼éè¿å¤§ã\n\néè¿å®ç° Runnable æ¥å£åå»ºçº¿ç¨çæ­¥éª¤ï¼\n\n 1. å®ä¹ Runnable æ¥å£çå®ç°ç±»ï¼å¹¶è¦åè¯¥æ¥å£ç run æ¹æ³ãè¯¥ run æ¹æ³çæ¹æ³ä½åæ ·æ¯è¯¥çº¿ç¨ççº¿ç¨æ§è¡ä½ã\n 2. åå»º Runnable å®ç°ç±»çå®ä¾ï¼å¹¶ä»¥æ­¤å®ä¾ä½ä¸º Thread ç target æ¥åå»º Thread å¯¹è±¡ï¼è¯¥ Thread å¯¹è±¡ææ¯çæ­£ççº¿ç¨å¯¹è±¡ã\n 3. è°ç¨çº¿ç¨å¯¹è±¡ç start æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\npublic class RunnableDemo {\n\n    public static void main(String[] args) {\n        // å®ä¾åå¯¹è±¡\n        Thread tA = new Thread(new MyThread(), "Runnable çº¿ç¨-A");\n        Thread tB = new Thread(new MyThread(), "Runnable çº¿ç¨-B");\n        // è°ç¨çº¿ç¨ä¸»ä½\n        tA.start();\n        tB.start();\n    }\n\n    static class MyThread implements Runnable {\n\n        private int ticket = 5;\n\n        @Override\n        public void run() {\n            while (ticket > 0) {\n                System.out.println(Thread.currentThread().getName() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n        }\n\n    }\n\n}\n\n\n\n# CallableãFutureãFutureTask\n\nç»§æ¿ Thread ç±»åå®ç° Runnable æ¥å£è¿ä¸¤ç§åå»ºçº¿ç¨çæ¹å¼é½æ²¡æè¿åå¼ãæä»¥ï¼çº¿ç¨æ§è¡å®åï¼æ æ³å¾å°æ§è¡ç»æãä½å¦æææå¾å°æ§è¡ç»æè¯¥æä¹åï¼\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼Java 1.5 åï¼æä¾äº Callable æ¥å£å Future æ¥å£ï¼éè¿å®ä»¬ï¼å¯ä»¥å¨çº¿ç¨æ§è¡ç»æåï¼è¿åæ§è¡ç»æã\n\n# Callable\n\nCallable æ¥å£åªå£°æäºä¸ä¸ªæ¹æ³ï¼è¿ä¸ªæ¹æ³å«å call()ï¼\n\npublic interface Callable<V> {\n    /**\n     * Computes a result, or throws an exception if unable to do so.\n     *\n     * @return computed result\n     * @throws Exception if unable to compute a result\n     */\n    V call() throws Exception;\n}\n\n\né£ä¹æä¹ä½¿ç¨ Callable å¢ï¼ä¸è¬æåµä¸æ¯éå ExecutorService æ¥ä½¿ç¨çï¼å¨ ExecutorService æ¥å£ä¸­å£°æäºè¥å¹²ä¸ª submit æ¹æ³çéè½½çæ¬ï¼\n\n<T> Future<T> submit(Callable<T> task);\n<T> Future<T> submit(Runnable task, T result);\nFuture<?> submit(Runnable task);\n\n\nç¬¬ä¸ä¸ª submit æ¹æ³éé¢çåæ°ç±»åå°±æ¯ Callableã\n\n# Future\n\nFuture å°±æ¯å¯¹äºå·ä½ç Callable ä»»å¡çæ§è¡ç»æè¿è¡åæ¶ãæ¥è¯¢æ¯å¦å®æãè·åç»æãå¿è¦æ¶å¯ä»¥éè¿ get æ¹æ³è·åæ§è¡ç»æï¼è¯¥æ¹æ³ä¼é»å¡ç´å°ä»»å¡è¿åç»æã\n\npublic interface Future<V> {\n    boolean cancel(boolean mayInterruptIfRunning);\n    boolean isCancelled();\n    boolean isDone();\n    V get() throws InterruptedException, ExecutionException;\n    V get(long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n}\n\n\n# FutureTask\n\nFutureTask ç±»å®ç°äº RunnableFuture æ¥å£ï¼RunnableFuture ç»§æ¿äº Runnable æ¥å£å Future æ¥å£ã\n\næä»¥ï¼FutureTask æ¢å¯ä»¥ä½ä¸º Runnable è¢«çº¿ç¨æ§è¡ï¼åå¯ä»¥ä½ä¸º Future å¾å° Callable çè¿åå¼ã\n\npublic class FutureTask<V> implements RunnableFuture<V> {\n    // ...\n    public FutureTask(Callable<V> callable) {}\n    public FutureTask(Runnable runnable, V result) {}\n}\n\npublic interface RunnableFuture<V> extends Runnable, Future<V> {\n    void run();\n}\n\n\näºå®ä¸ï¼FutureTask æ¯ Future æ¥å£çä¸ä¸ªå¯ä¸å®ç°ç±»ã\n\n# Callable + Future + FutureTask ç¤ºä¾\n\néè¿å®ç° Callable æ¥å£åå»ºçº¿ç¨çæ­¥éª¤ï¼\n\n 1. åå»º Callable æ¥å£çå®ç°ç±»ï¼å¹¶å®ç° call æ¹æ³ãè¯¥ call æ¹æ³å°ä½ä¸ºçº¿ç¨æ§è¡ä½ï¼å¹¶ä¸æè¿åå¼ã\n 2. åå»º Callable å®ç°ç±»çå®ä¾ï¼ä½¿ç¨ FutureTask ç±»æ¥åè£ Callable å¯¹è±¡ï¼è¯¥ FutureTask å¯¹è±¡å°è£äºè¯¥ Callable å¯¹è±¡ç call æ¹æ³çè¿åå¼ã\n 3. ä½¿ç¨ FutureTask å¯¹è±¡ä½ä¸º Thread å¯¹è±¡ç target åå»ºå¹¶å¯å¨æ°çº¿ç¨ã\n 4. è°ç¨ FutureTask å¯¹è±¡ç get æ¹æ³æ¥è·å¾çº¿ç¨æ§è¡ç»æåçè¿åå¼ã\n\npublic class CallableDemo {\n\n    public static void main(String[] args) {\n        Callable<Long> callable = new MyThread();\n        FutureTask<Long> future = new FutureTask<>(callable);\n        new Thread(future, "Callable çº¿ç¨").start();\n        try {\n            System.out.println("ä»»å¡èæ¶ï¼" + (future.get() / 1000000) + "æ¯«ç§");\n        } catch (InterruptedException | ExecutionException e) {\n            e.printStackTrace();\n        }\n    }\n\n    static class MyThread implements Callable<Long> {\n\n        private int ticket = 10000;\n\n        @Override\n        public Long call() {\n            long begin = System.nanoTime();\n            while (ticket > 0) {\n                System.out.println(Thread.currentThread().getName() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n\n            long end = System.nanoTime();\n            return (end - begin);\n        }\n\n    }\n\n}\n\n\n\n# çº¿ç¨åºæ¬ç¨æ³\n\nçº¿ç¨ï¼Threadï¼åºæ¬æ¹æ³æ¸åï¼\n\næ¹æ³              æè¿°\nrun             çº¿ç¨çæ§è¡å®ä½ã\nstart           çº¿ç¨çå¯å¨æ¹æ³ã\ncurrentThread   è¿åå¯¹å½åæ­£å¨æ§è¡ççº¿ç¨å¯¹è±¡çå¼ç¨ã\nsetName         è®¾ç½®çº¿ç¨åç§°ã\ngetName         è·åçº¿ç¨åç§°ã\nsetPriority     è®¾ç½®çº¿ç¨ä¼åçº§ãJava ä¸­ççº¿ç¨ä¼åçº§çèå´æ¯ [1,10]ï¼ä¸è¬æ¥è¯´ï¼é«ä¼åçº§ççº¿ç¨å¨è¿è¡æ¶ä¼å·æä¼åæãå¯ä»¥éè¿\n                thread.setPriority(Thread.MAX_PRIORITY) çæ¹å¼è®¾ç½®ï¼é»è®¤ä¼åçº§ä¸º 5ã\ngetPriority     è·åçº¿ç¨ä¼åçº§ã\nsetDaemon       è®¾ç½®çº¿ç¨ä¸ºå®æ¤çº¿ç¨ã\nisDaemon        å¤æ­çº¿ç¨æ¯å¦ä¸ºå®æ¤çº¿ç¨ã\nisAlive         å¤æ­çº¿ç¨æ¯å¦å¯å¨ã\ninterrupt       ä¸­æ­å¦ä¸ä¸ªçº¿ç¨çè¿è¡ç¶æã\ninterrupted     æµè¯å½åçº¿ç¨æ¯å¦å·²è¢«ä¸­æ­ãéè¿æ­¤æ¹æ³å¯ä»¥æ¸é¤çº¿ç¨çä¸­æ­ç¶æãæ¢å¥è¯è¯´ï¼å¦æè¦è¿ç»­è°ç¨æ­¤æ¹æ³ä¸¤æ¬¡ï¼åç¬¬äºæ¬¡è°ç¨å°è¿å\n                falseï¼é¤éå½åçº¿ç¨å¨ç¬¬ä¸æ¬¡è°ç¨æ¸é¤å¶ä¸­æ­ç¶æä¹åä¸å¨ç¬¬äºæ¬¡è°ç¨æ£æ¥å¶ç¶æä¹ååæ¬¡ä¸­æ­ï¼ã\njoin            å¯ä»¥ä½¿ä¸ä¸ªçº¿ç¨å¼ºå¶è¿è¡ï¼çº¿ç¨å¼ºå¶è¿è¡æé´ï¼å¶ä»çº¿ç¨æ æ³è¿è¡ï¼å¿é¡»ç­å¾æ­¤çº¿ç¨å®æä¹åæå¯ä»¥ç»§ç»­æ§è¡ã\nThread.sleep    éææ¹æ³ãå°å½åæ­£å¨æ§è¡ççº¿ç¨ä¼ç ã\nThread.yield    éææ¹æ³ãå°å½åæ­£å¨æ§è¡ççº¿ç¨æåï¼è®©å¶ä»çº¿ç¨æ§è¡ã\n\n\n# çº¿ç¨ä¼ç \n\nä½¿ç¨ Thread.sleep æ¹æ³å¯ä»¥ä½¿å¾å½åæ­£å¨æ§è¡ççº¿ç¨è¿å¥ä¼ç ç¶æã\n\nä½¿ç¨ Thread.sleep éè¦åå¶ä¼ å¥ä¸ä¸ªæ´æ°å¼ï¼è¿ä¸ªå¼è¡¨ç¤ºçº¿ç¨å°è¦ä¼ç çæ¯«ç§æ°ã\n\nThread.sleep æ¹æ³å¯è½ä¼æåº InterruptedExceptionï¼å ä¸ºå¼å¸¸ä¸è½è·¨çº¿ç¨ä¼ æ­å main ä¸­ï¼å æ­¤å¿é¡»å¨æ¬å°è¿è¡å¤çãçº¿ç¨ä¸­æåºçå¶å®å¼å¸¸ä¹åæ ·éè¦å¨æ¬å°è¿è¡å¤çã\n\npublic class ThreadSleepDemo {\n\n    public static void main(String[] args) {\n        new Thread(new MyThread("çº¿ç¨A", 500)).start();\n        new Thread(new MyThread("çº¿ç¨B", 1000)).start();\n        new Thread(new MyThread("çº¿ç¨C", 1500)).start();\n    }\n\n    static class MyThread implements Runnable {\n\n        /** çº¿ç¨åç§° */\n        private String name;\n\n        /** ä¼ç æ¶é´ */\n        private int time;\n\n        private MyThread(String name, int time) {\n            this.name = name;\n            this.time = time;\n        }\n\n        @Override\n        public void run() {\n            try {\n                // ä¼ç æå®çæ¶é´\n                Thread.sleep(this.time);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(this.name + "ä¼ç " + this.time + "æ¯«ç§ã");\n        }\n\n    }\n\n}\n\n\n\n# çº¿ç¨ç¤¼è®©\n\nThread.yield æ¹æ³çè°ç¨å£°æäºå½åçº¿ç¨å·²ç»å®æäºçå½å¨æä¸­æéè¦çé¨åï¼å¯ä»¥åæ¢ç»å¶å®çº¿ç¨æ¥æ§è¡ ã\n\nè¯¥æ¹æ³åªæ¯å¯¹çº¿ç¨è°åº¦å¨çä¸ä¸ªå»ºè®®ï¼èä¸ä¹åªæ¯å»ºè®®å·æç¸åä¼åçº§çå¶å®çº¿ç¨å¯ä»¥è¿è¡ã\n\npublic class ThreadYieldDemo {\n\n    public static void main(String[] args) {\n        MyThread t = new MyThread();\n        new Thread(t, "çº¿ç¨A").start();\n        new Thread(t, "çº¿ç¨B").start();\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            for (int i = 0; i < 5; i++) {\n                try {\n                    Thread.sleep(1000);\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n                System.out.println(Thread.currentThread().getName() + "è¿è¡ï¼i = " + i);\n                if (i == 2) {\n                    System.out.print("çº¿ç¨ç¤¼è®©ï¼");\n                    Thread.yield();\n                }\n            }\n        }\n    }\n}\n\n\n\n# ç»æ­¢çº¿ç¨\n\n> Thread ä¸­ç stop æ¹æ³æç¼ºé·ï¼å·²åºå¼ã\n> \n> ä½¿ç¨ Thread.stop åæ­¢çº¿ç¨ä¼å¯¼è´å®è§£éææå·²éå®ççè§å¨ï¼ç±äºæªç»æ£æ¥ç ThreadDeath å¼å¸¸ä¼å¨å æ ä¸­ä¼ æ­ï¼è¿æ¯èªç¶çç»æï¼ã å¦æååç±è¿äºçè§å¨ä¿æ¤çä»»ä½å¯¹è±¡å¤äºä¸ä¸è´ç¶æï¼åæåçå¯¹è±¡å°å¯¹å¶ä»çº¿ç¨å¯è§ï¼ä»èå¯è½å¯¼è´ä»»æè¡ä¸ºã\n> \n> stop() æ¹æ³ä¼ççææ­»çº¿ç¨ï¼ä¸ç»çº¿ç¨åæ¯çæºä¼ï¼å¦æçº¿ç¨ææ ReentrantLock éï¼è¢« stop() ççº¿ç¨å¹¶ä¸ä¼èªå¨è°ç¨ ReentrantLock ç unlock() å»éæ¾éï¼é£å¶ä»çº¿ç¨å°±åä¹æ²¡æºä¼è·å¾ ReentrantLock éï¼è¿å®å¨æ¯å¤ªå±é©äºãæä»¥è¯¥æ¹æ³å°±ä¸å»ºè®®ä½¿ç¨äºï¼ç±»ä¼¼çæ¹æ³è¿æ suspend() å resume() æ¹æ³ï¼è¿ä¸¤ä¸ªæ¹æ³åæ ·ä¹é½ä¸å»ºè®®ä½¿ç¨äºï¼æä»¥è¿éä¹å°±ä¸å¤ä»ç»äºãThread.stop çè®¸å¤ç¨æ³åºç±ä»ä¿®æ¹æäºåéä»¥æç¤ºç®æ çº¿ç¨åºåæ­¢è¿è¡çä»£ç ä»£æ¿ã ç®æ çº¿ç¨åºå®ææ£æ¥æ­¤åéï¼å¦æè¯¥åéæç¤ºè¦åæ­¢è¿è¡ï¼ååºææåºæ¹å¼ä»å¶è¿è¡æ¹æ³è¿åãå¦æç®æ çº¿ç¨ç­å¾å¾é¿æ¶é´ï¼ä¾å¦ï¼å¨æ¡ä»¶åéä¸ï¼ï¼ååºä½¿ç¨ä¸­æ­æ¹æ³æ¥ä¸­æ­ç­å¾ã\n\nå½ä¸ä¸ªçº¿ç¨è¿è¡æ¶ï¼å¦ä¸ä¸ªçº¿ç¨å¯ä»¥ç´æ¥éè¿ interrupt æ¹æ³ä¸­æ­å¶è¿è¡ç¶æã\n\npublic class ThreadInterruptDemo {\n\n    public static void main(String[] args) {\n        MyThread mt = new MyThread(); // å®ä¾åRunnableå­ç±»å¯¹è±¡\n        Thread t = new Thread(mt, "çº¿ç¨"); // å®ä¾åThreadå¯¹è±¡\n        t.start(); // å¯å¨çº¿ç¨\n        try {\n            Thread.sleep(2000); // çº¿ç¨ä¼ç 2ç§\n        } catch (InterruptedException e) {\n            System.out.println("3ãmainçº¿ç¨ä¼ç è¢«ç»æ­¢");\n        }\n        t.interrupt(); // ä¸­æ­çº¿ç¨æ§è¡\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            System.out.println("1ãè¿å¥run()æ¹æ³");\n            try {\n                Thread.sleep(10000); // çº¿ç¨ä¼ç 10ç§\n                System.out.println("2ãå·²ç»å®æäºä¼ç ");\n            } catch (InterruptedException e) {\n                System.out.println("3ãMyThreadçº¿ç¨ä¼ç è¢«ç»æ­¢");\n                return; // è¿åè°ç¨å¤\n            }\n            System.out.println("4ãrun()æ¹æ³æ­£å¸¸ç»æ");\n        }\n    }\n}\n\n\nå¦æä¸ä¸ªçº¿ç¨ç run æ¹æ³æ§è¡ä¸ä¸ªæ éå¾ªç¯ï¼å¹¶ä¸æ²¡ææ§è¡ sleep ç­ä¼æåº InterruptedException çæä½ï¼é£ä¹è°ç¨çº¿ç¨ç interrupt æ¹æ³å°±æ æ³ä½¿çº¿ç¨æåç»æã\n\nä½æ¯è°ç¨ interrupt æ¹æ³ä¼è®¾ç½®çº¿ç¨çä¸­æ­æ è®°ï¼æ­¤æ¶è°ç¨ interrupted æ¹æ³ä¼è¿å trueãå æ­¤å¯ä»¥å¨å¾ªç¯ä½ä¸­ä½¿ç¨ interrupted æ¹æ³æ¥å¤æ­çº¿ç¨æ¯å¦å¤äºä¸­æ­ç¶æï¼ä»èæåç»æçº¿ç¨ã\n\nå®å¨å°ç»æ­¢çº¿ç¨æä¸¤ç§æ¹æ³ï¼\n\n * å®ä¹ volatile æ å¿ä½ï¼å¨ run æ¹æ³ä¸­ä½¿ç¨æ å¿ä½æ§å¶çº¿ç¨ç»æ­¢\n * ä½¿ç¨ interrupt æ¹æ³å Thread.interrupted æ¹æ³éåä½¿ç¨æ¥æ§å¶çº¿ç¨ç»æ­¢\n\nãç¤ºä¾ãä½¿ç¨ volatile æ å¿ä½æ§å¶çº¿ç¨ç»æ­¢\n\npublic class ThreadStopDemo2 {\n\n    public static void main(String[] args) throws Exception {\n        MyTask task = new MyTask();\n        Thread thread = new Thread(task, "MyTask");\n        thread.start();\n        TimeUnit.MILLISECONDS.sleep(50);\n        task.cancel();\n    }\n\n    private static class MyTask implements Runnable {\n\n        private volatile boolean flag = true;\n\n        private volatile long count = 0L;\n\n        @Override\n        public void run() {\n            System.out.println(Thread.currentThread().getName() + " çº¿ç¨å¯å¨");\n            while (flag) {\n                System.out.println(count++);\n            }\n            System.out.println(Thread.currentThread().getName() + " çº¿ç¨ç»æ­¢");\n        }\n\n        /**\n         * éè¿ volatile æ å¿ä½æ¥æ§å¶çº¿ç¨ç»æ­¢\n         */\n        public void cancel() {\n            flag = false;\n        }\n\n    }\n\n}\n\n\nãç¤ºä¾ãä½¿ç¨ interrupt æ¹æ³å Thread.interrupted æ¹æ³éåä½¿ç¨æ¥æ§å¶çº¿ç¨ç»æ­¢\n\npublic class ThreadStopDemo3 {\n\n    public static void main(String[] args) throws Exception {\n        MyTask task = new MyTask();\n        Thread thread = new Thread(task, "MyTask");\n        thread.start();\n        TimeUnit.MILLISECONDS.sleep(50);\n        thread.interrupt();\n    }\n\n    private static class MyTask implements Runnable {\n\n        private volatile long count = 0L;\n\n        @Override\n        public void run() {\n            System.out.println(Thread.currentThread().getName() + " çº¿ç¨å¯å¨");\n            // éè¿ Thread.interrupted å interrupt éåæ¥æ§å¶çº¿ç¨ç»æ­¢\n            while (!Thread.interrupted()) {\n                System.out.println(count++);\n            }\n            System.out.println(Thread.currentThread().getName() + " çº¿ç¨ç»æ­¢");\n        }\n    }\n}\n\n\n\n# å®æ¤çº¿ç¨\n\nä»ä¹æ¯å®æ¤çº¿ç¨ï¼\n\n * å®æ¤çº¿ç¨ï¼Daemon Threadï¼æ¯å¨åå°æ§è¡å¹¶ä¸ä¸ä¼é»æ­¢ JVM ç»æ­¢ççº¿ç¨ãå½ææéå®æ¤çº¿ç¨ç»ææ¶ï¼ç¨åºä¹å°±ç»æ­¢ï¼åæ¶ä¼ææ­»ææå®æ¤çº¿ç¨ã\n * ä¸å®æ¤çº¿ç¨ï¼Daemon Threadï¼ç¸åçï¼å«ç¨æ·çº¿ç¨ï¼User Threadï¼ï¼ä¹å°±æ¯éå®æ¤çº¿ç¨ã\n\nä¸ºä»ä¹éè¦å®æ¤çº¿ç¨ï¼\n\n * å®æ¤çº¿ç¨çä¼åçº§æ¯è¾ä½ï¼ç¨äºä¸ºç³»ç»ä¸­çå¶å®å¯¹è±¡åçº¿ç¨æä¾æå¡ãå¸åçåºç¨å°±æ¯åå¾åæ¶å¨ã\n\nå¦ä½ä½¿ç¨å®æ¤çº¿ç¨ï¼\n\n * å¯ä»¥ä½¿ç¨ isDaemon æ¹æ³å¤æ­çº¿ç¨æ¯å¦ä¸ºå®æ¤çº¿ç¨ã\n * å¯ä»¥ä½¿ç¨ setDaemon æ¹æ³è®¾ç½®çº¿ç¨ä¸ºå®æ¤çº¿ç¨ã\n   * æ­£å¨è¿è¡çç¨æ·çº¿ç¨æ æ³è®¾ç½®ä¸ºå®æ¤çº¿ç¨ï¼æä»¥ setDaemon å¿é¡»å¨ thread.start æ¹æ³ä¹åè®¾ç½®ï¼å¦åä¼æåº llegalThreadStateException å¼å¸¸ï¼\n   * ä¸ä¸ªå®æ¤çº¿ç¨åå»ºçå­çº¿ç¨ä¾ç¶æ¯å®æ¤çº¿ç¨ã\n   * ä¸è¦è®¤ä¸ºææçåºç¨é½å¯ä»¥åéç»å®æ¤çº¿ç¨æ¥è¿è¡æå¡ï¼æ¯å¦è¯»åæä½æèè®¡ç®é»è¾ã\n\npublic class ThreadDaemonDemo {\n\n    public static void main(String[] args) {\n        Thread t = new Thread(new MyThread(), "çº¿ç¨");\n        t.setDaemon(true); // æ­¤çº¿ç¨å¨åå°è¿è¡\n        System.out.println("çº¿ç¨ t æ¯å¦æ¯å®æ¤è¿ç¨ï¼" + t.isDaemon());\n        t.start(); // å¯å¨çº¿ç¨\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            while (true) {\n                System.out.println(Thread.currentThread().getName() + "å¨è¿è¡ã");\n            }\n        }\n    }\n}\n\n\n> åèéè¯»ï¼Java ä¸­å®æ¤çº¿ç¨çæ»ç»\n\n\n# çº¿ç¨éä¿¡\n\n> å½å¤ä¸ªçº¿ç¨å¯ä»¥ä¸èµ·å·¥ä½å»è§£å³æä¸ªé®é¢æ¶ï¼å¦ææäºé¨åå¿é¡»å¨å¶å®é¨åä¹åå®æï¼é£ä¹å°±éè¦å¯¹çº¿ç¨è¿è¡åè°ã\n\n\n# wait/notify/notifyAll\n\n * wait - wait ä¼èªå¨éæ¾å½åçº¿ç¨å æçå¯¹è±¡éï¼å¹¶è¯·æ±æä½ç³»ç»æèµ·å½åçº¿ç¨ï¼è®©çº¿ç¨ä» Running ç¶æè½¬å¥ Waiting ç¶æï¼ç­å¾ notify / notifyAll æ¥å¤éãå¦ææ²¡æéæ¾éï¼é£ä¹å¶å®çº¿ç¨å°±æ æ³è¿å¥å¯¹è±¡çåæ­¥æ¹æ³æèåæ­¥æ§å¶åä¸­ï¼é£ä¹å°±æ æ³æ§è¡ notify æè notifyAll æ¥å¤éæèµ·ççº¿ç¨ï¼é ææ­»éã\n * notify - å¤éä¸ä¸ªæ­£å¨ Waiting ç¶æççº¿ç¨ï¼å¹¶è®©å®æ¿å°å¯¹è±¡éï¼å·ä½å¤éåªä¸ä¸ªçº¿ç¨ç± JVM æ§å¶ ã\n * notifyAll - å¤éæææ­£å¨ Waiting ç¶æççº¿ç¨ï¼æ¥ä¸æ¥å®ä»¬éè¦ç«äºå¯¹è±¡éã\n\n> æ³¨æï¼\n> \n>  * waitãnotifyãnotifyAll é½æ¯ Object ç±»ä¸­çæ¹æ³ï¼èé Threadã\n>  * waitãnotifyãnotifyAll åªè½ç¨å¨ synchronized æ¹æ³æè synchronized ä»£ç åä¸­ä½¿ç¨ï¼å¦åä¼å¨è¿è¡æ¶æåº IllegalMonitorStateExceptionã\n> \n> ä¸ºä»ä¹ waitãnotifyãnotifyAll ä¸å®ä¹å¨ Thread ä¸­ï¼ä¸ºä»ä¹ waitãnotifyãnotifyAll è¦éå synchronized ä½¿ç¨ï¼\n> \n> é¦åï¼éè¦äºè§£å ä¸ªåºæ¬ç¥è¯ç¹ï¼\n> \n>  * æ¯ä¸ä¸ª Java å¯¹è±¡é½æä¸ä¸ªä¸ä¹å¯¹åºç çè§å¨ï¼monitorï¼\n>  * æ¯ä¸ä¸ªçè§å¨éé¢é½æä¸ä¸ª å¯¹è±¡é ãä¸ä¸ª ç­å¾éåãä¸ä¸ª åæ­¥éå\n> \n> äºè§£äºä»¥ä¸æ¦å¿µï¼æä»¬åè¿å¤´æ¥çè§£åé¢ä¸¤ä¸ªé®é¢ã\n> \n> ä¸ºä»ä¹è¿å ä¸ªæ¹æ³ä¸å®ä¹å¨ Thread ä¸­ï¼\n> \n> ç±äºæ¯ä¸ªå¯¹è±¡é½æ¥æå¯¹è±¡éï¼è®©å½åçº¿ç¨ç­å¾æä¸ªå¯¹è±¡éï¼èªç¶åºè¯¥åºäºè¿ä¸ªå¯¹è±¡ï¼Objectï¼æ¥æä½ï¼èéä½¿ç¨å½åçº¿ç¨ï¼Threadï¼æ¥æä½ãå ä¸ºå½åçº¿ç¨å¯è½ä¼ç­å¾å¤ä¸ªçº¿ç¨çéï¼å¦æåºäºçº¿ç¨ï¼Threadï¼æ¥æä½ï¼å°±éå¸¸å¤æäºã\n> \n> ä¸ºä»ä¹ waitãnotifyãnotifyAll è¦éå synchronized ä½¿ç¨ï¼\n> \n> å¦æè°ç¨æä¸ªå¯¹è±¡ç wait æ¹æ³ï¼å½åçº¿ç¨å¿é¡»æ¥æè¿ä¸ªå¯¹è±¡çå¯¹è±¡éï¼å æ­¤è°ç¨ wait æ¹æ³å¿é¡»å¨ synchronized æ¹æ³å synchronized ä»£ç åä¸­ã\n\nçäº§èãæ¶è´¹èæ¨¡å¼æ¯ waitãnotifyãnotifyAll çä¸ä¸ªç»å¸ä½¿ç¨æ¡ä¾ï¼\n\npublic class ThreadWaitNotifyDemo02 {\n\n    private static final int QUEUE_SIZE = 10;\n    private static final PriorityQueue<Integer> queue = new PriorityQueue<>(QUEUE_SIZE);\n\n    public static void main(String[] args) {\n        new Producer("çäº§èA").start();\n        new Producer("çäº§èB").start();\n        new Consumer("æ¶è´¹èA").start();\n        new Consumer("æ¶è´¹èB").start();\n    }\n\n    static class Consumer extends Thread {\n\n        Consumer(String name) {\n            super(name);\n        }\n\n        @Override\n        public void run() {\n            while (true) {\n                synchronized (queue) {\n                    while (queue.size() == 0) {\n                        try {\n                            System.out.println("éåç©ºï¼ç­å¾æ°æ®");\n                            queue.wait();\n                        } catch (InterruptedException e) {\n                            e.printStackTrace();\n                            queue.notifyAll();\n                        }\n                    }\n                    queue.poll(); // æ¯æ¬¡ç§»èµ°éé¦åç´ \n                    queue.notifyAll();\n                    try {\n                        Thread.sleep(500);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    System.out.println(Thread.currentThread().getName() + " ä»éååèµ°ä¸ä¸ªåç´ ï¼éåå½åæï¼" + queue.size() + "ä¸ªåç´ ");\n                }\n            }\n        }\n    }\n\n    static class Producer extends Thread {\n\n        Producer(String name) {\n            super(name);\n        }\n\n        @Override\n        public void run() {\n            while (true) {\n                synchronized (queue) {\n                    while (queue.size() == QUEUE_SIZE) {\n                        try {\n                            System.out.println("éåæ»¡ï¼ç­å¾æç©ºä½ç©ºé´");\n                            queue.wait();\n                        } catch (InterruptedException e) {\n                            e.printStackTrace();\n                            queue.notifyAll();\n                        }\n                    }\n                    queue.offer(1); // æ¯æ¬¡æå¥ä¸ä¸ªåç´ \n                    queue.notifyAll();\n                    try {\n                        Thread.sleep(500);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    System.out.println(Thread.currentThread().getName() + " åéååä¸­æå¥ä¸ä¸ªåç´ ï¼éåå½åæï¼" + queue.size() + "ä¸ªåç´ ");\n                }\n            }\n        }\n    }\n}\n\n\n\n# join\n\nå¨çº¿ç¨æä½ä¸­ï¼å¯ä»¥ä½¿ç¨ join æ¹æ³è®©ä¸ä¸ªçº¿ç¨å¼ºå¶è¿è¡ï¼çº¿ç¨å¼ºå¶è¿è¡æé´ï¼å¶ä»çº¿ç¨æ æ³è¿è¡ï¼å¿é¡»ç­å¾æ­¤çº¿ç¨å®æä¹åæå¯ä»¥ç»§ç»­æ§è¡ã\n\npublic class ThreadJoinDemo {\n\n    public static void main(String[] args) {\n        MyThread mt = new MyThread(); // å®ä¾åRunnableå­ç±»å¯¹è±¡\n        Thread t = new Thread(mt, "mythread"); // å®ä¾åThreadå¯¹è±¡\n        t.start(); // å¯å¨çº¿ç¨\n        for (int i = 0; i < 50; i++) {\n            if (i > 10) {\n                try {\n                    t.join(); // çº¿ç¨å¼ºå¶è¿è¡\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            System.out.println("Main çº¿ç¨è¿è¡ --\x3e " + i);\n        }\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            for (int i = 0; i < 50; i++) {\n                System.out.println(Thread.currentThread().getName() + " è¿è¡ï¼i = " + i); // åå¾å½åçº¿ç¨çåå­\n            }\n        }\n    }\n}\n\n\n\n# ç®¡é\n\nç®¡éè¾å¥/è¾åºæµåæ®éçæä»¶è¾å¥/è¾åºæµæèç½ç»è¾å¥/è¾åºæµä¸åä¹å¤å¨äºï¼å®ä¸»è¦ç¨äºçº¿ç¨ä¹é´çæ°æ®ä¼ è¾ï¼èä¼ è¾çåªä»ä¸ºåå­ã ç®¡éè¾å¥/è¾åºæµä¸»è¦åæ¬äºå¦ä¸ 4 ç§å·ä½å®ç°ï¼PipedOutputStreamãPipedInputStreamãPipedReader å PipedWriterï¼åä¸¤ç§é¢åå­èï¼èåä¸¤ç§é¢åå­ç¬¦ã\n\npublic class Piped {\n\n    public static void main(String[] args) throws Exception {\n        PipedWriter out = new PipedWriter();\n        PipedReader in = new PipedReader();\n        // å°è¾åºæµåè¾å¥æµè¿è¡è¿æ¥ï¼å¦åå¨ä½¿ç¨æ¶ä¼æåºIOException\n        out.connect(in);\n        Thread printThread = new Thread(new Print(in), "PrintThread");\n        printThread.start();\n        int receive = 0;\n        try {\n            while ((receive = System.in.read()) != -1) {\n                out.write(receive);\n            }\n        } finally {\n            out.close();\n        }\n    }\n\n    static class Print implements Runnable {\n\n        private PipedReader in;\n\n        Print(PipedReader in) {\n            this.in = in;\n        }\n\n        public void run() {\n            int receive = 0;\n            try {\n                while ((receive = in.read()) != -1) {\n                    System.out.print((char) receive);\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\n\n\n# çº¿ç¨çå½å¨æ\n\n\n\njava.lang.Thread.State ä¸­å®ä¹äº 6 ç§ä¸åççº¿ç¨ç¶æï¼å¨ç»å®çä¸ä¸ªæ¶å»ï¼çº¿ç¨åªè½å¤äºå¶ä¸­çä¸ä¸ªç¶æã\n\nä»¥ä¸æ¯åç¶æçè¯´æï¼ä»¥åç¶æé´çèç³»ï¼\n\n * æ°å»ºï¼Newï¼ - å°æªè°ç¨ start æ¹æ³ççº¿ç¨å¤äºæ­¤ç¶æãæ­¤ç¶ææå³çï¼åå»ºççº¿ç¨å°æªå¯å¨ã\n\n * å°±ç»ªï¼Runnableï¼ - å·²ç»è°ç¨äº start æ¹æ³ççº¿ç¨å¤äºæ­¤ç¶æãæ­¤ç¶ææå³çï¼çº¿ç¨å·²ç»å¨ JVM ä¸­è¿è¡ãä½æ¯å¨æä½ç³»ç»å±é¢ï¼å®å¯è½å¤äºè¿è¡ç¶æï¼ä¹å¯è½ç­å¾èµæºè°åº¦ï¼ä¾å¦å¤çå¨èµæºï¼ï¼èµæºè°åº¦å®æå°±è¿å¥è¿è¡ç¶æãæä»¥è¯¥ç¶æçå¯è¿è¡æ¯æå¯ä»¥è¢«è¿è¡ï¼å·ä½ææ²¡æè¿è¡è¦çåºå±æä½ç³»ç»çèµæºè°åº¦ã\n\n * é»å¡ï¼Blockedï¼ - æ­¤ç¶ææå³çï¼çº¿ç¨å¤äºè¢«é»å¡ç¶æãè¡¨ç¤ºçº¿ç¨å¨ç­å¾ synchronized çéå¼éï¼Monitor lockï¼ãsynchronized ä¿®é¥°çæ¹æ³ãä»£ç ååä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡ï¼å¶ä»çº¿ç¨åªè½ç­å¾ï¼å³å¤äºé»å¡ç¶æãå½å ç¨ synchronized éå¼éççº¿ç¨éæ¾éï¼å¹¶ä¸ç­å¾ççº¿ç¨è·å¾ synchronized éå¼éæ¶ï¼å°±åä¼ä» BLOCKED è½¬æ¢å° RUNNABLE ç¶æã\n\n * ç­å¾ï¼Waitingï¼ - æ­¤ç¶ææå³çï¼çº¿ç¨æ éæç­å¾ï¼ç´å°è¢«å¶ä»çº¿ç¨æ¾å¼å°å¤éã é»å¡åç­å¾çåºå«å¨äºï¼é»å¡æ¯è¢«å¨çï¼å®æ¯å¨ç­å¾è·å synchronized çéå¼éãèç­å¾æ¯ä¸»å¨çï¼éè¿è°ç¨ Object.wait ç­æ¹æ³è¿å¥ã\n   \n   è¿å¥æ¹æ³                                        éåºæ¹æ³\n   æ²¡æè®¾ç½® Timeout åæ°ç Object.wait æ¹æ³             Object.notify / Object.notifyAll\n   æ²¡æè®¾ç½® Timeout åæ°ç Thread.join æ¹æ³             è¢«è°ç¨ççº¿ç¨æ§è¡å®æ¯\n   LockSupport.park æ¹æ³ï¼Java å¹¶ååä¸­çéï¼é½æ¯åºäºå®å®ç°çï¼   LockSupport.unpark\n\n * å®æ¶ç­å¾ï¼Timed waitingï¼ - æ­¤ç¶ææå³çï¼æ éç­å¾å¶å®çº¿ç¨æ¾å¼å°å¤éï¼å¨ä¸å®æ¶é´ä¹åä¼è¢«ç³»ç»èªå¨å¤éã\n   \n   è¿å¥æ¹æ³                                                      éåºæ¹æ³\n   Thread.sleep æ¹æ³                                           æ¶é´ç»æ\n   è·å¾ synchronized éå¼éççº¿ç¨ï¼è°ç¨è®¾ç½®äº Timeout åæ°ç Object.wait æ¹æ³   æ¶é´ç»æ / Object.notify / Object.notifyAll\n   è®¾ç½®äº Timeout åæ°ç Thread.join æ¹æ³                            æ¶é´ç»æ / è¢«è°ç¨ççº¿ç¨æ§è¡å®æ¯\n   LockSupport.parkNanos æ¹æ³                                  LockSupport.unpark\n   LockSupport.parkUntil æ¹æ³                                  LockSupport.unpark\n\n * ç»æ­¢(Terminated) - çº¿ç¨æ§è¡å® run æ¹æ³ï¼æèå å¼å¸¸éåºäº run æ¹æ³ãæ­¤ç¶ææå³çï¼çº¿ç¨ç»æäºçå½å¨æã\n\n\n# çº¿ç¨å¸¸è§é®é¢\n\n\n# sleepãyieldãjoin æ¹æ³æä»ä¹åºå«\n\n * yield æ¹æ³\n   * yield æ¹æ³ä¼ è®©çº¿ç¨ä» Running ç¶æè½¬å¥ Runnable ç¶æã\n   * å½è°ç¨äº yield æ¹æ³åï¼åªæä¸å½åçº¿ç¨ç¸åææ´é«ä¼åçº§çRunnable ç¶æçº¿ç¨æä¼è·å¾æ§è¡çæºä¼ã\n * sleep æ¹æ³\n   * sleep æ¹æ³ä¼ è®©çº¿ç¨ä» Running ç¶æè½¬å¥ Waiting ç¶æã\n   * sleep æ¹æ³éè¦æå®ç­å¾çæ¶é´ï¼è¶è¿ç­å¾æ¶é´åï¼JVM ä¼å°çº¿ç¨ä» Waiting ç¶æè½¬å¥ Runnable ç¶æã\n   * å½è°ç¨äº sleep æ¹æ³åï¼æ è®ºä»ä¹ä¼åçº§ççº¿ç¨é½å¯ä»¥å¾å°æ§è¡æºä¼ã\n   * sleep æ¹æ³ä¸ä¼éæ¾âéæ å¿âï¼ä¹å°±æ¯è¯´å¦ææ synchronized åæ­¥åï¼å¶ä»çº¿ç¨ä»ç¶ä¸è½è®¿é®å±äº«æ°æ®ã\n * join\n   * join æ¹æ³ä¼ è®©çº¿ç¨ä» Running ç¶æè½¬å¥ Waiting ç¶æã\n   * å½è°ç¨äº join æ¹æ³åï¼å½åçº¿ç¨å¿é¡»ç­å¾è°ç¨ join æ¹æ³ççº¿ç¨ç»æåæè½ç»§ç»­æ§è¡ã\n\n\n# ä¸ºä»ä¹ sleep å yield æ¹æ³æ¯éæç\n\nThread ç±»ç sleep å yield æ¹æ³å°å¤ç Running ç¶æççº¿ç¨ã\n\næä»¥å¨å¶ä»å¤äºé Running ç¶æççº¿ç¨ä¸æ§è¡è¿ä¸¤ä¸ªæ¹æ³æ¯æ²¡ææä¹çãè¿å°±æ¯ä¸ºä»ä¹è¿äºæ¹æ³æ¯éæçãå®ä»¬å¯ä»¥å¨å½åæ­£å¨æ§è¡ççº¿ç¨ä¸­å·¥ä½ï¼å¹¶é¿åç¨åºåéè¯¯çè®¤ä¸ºå¯ä»¥å¨å¶ä»éè¿è¡çº¿ç¨è°ç¨è¿äºæ¹æ³ã\n\n\n# Java çº¿ç¨æ¯å¦æç§çº¿ç¨ä¼åçº§ä¸¥æ ¼æ§è¡\n\nå³ä½¿è®¾ç½®äºçº¿ç¨çä¼åçº§ï¼ä¹æ æ³ä¿è¯é«ä¼åçº§ççº¿ç¨ä¸å®åæ§è¡ã\n\nåå å¨äºçº¿ç¨ä¼åçº§ä¾èµäºæä½ç³»ç»çæ¯æï¼ç¶èï¼ä¸åçæä½ç³»ç»æ¯æççº¿ç¨ä¼åçº§å¹¶ä¸ç¸åï¼ä¸è½å¾å¥½çå Java ä¸­çº¿ç¨ä¼åçº§ä¸ä¸å¯¹åºã\n\n\n# ä¸ä¸ªçº¿ç¨ä¸¤æ¬¡è°ç¨ start()æ¹æ³ä¼ææ ·\n\nJava ççº¿ç¨æ¯ä¸åè®¸å¯å¨ä¸¤æ¬¡çï¼ç¬¬äºæ¬¡è°ç¨å¿ç¶ä¼æåº IllegalThreadStateExceptionï¼è¿æ¯ä¸ç§è¿è¡æ¶å¼å¸¸ï¼å¤æ¬¡è°ç¨ start è¢«è®¤ä¸ºæ¯ç¼ç¨éè¯¯ã\n\n\n# start å run æ¹æ³æä»ä¹åºå«\n\n * run æ¹æ³æ¯çº¿ç¨çæ§è¡ä½ã\n * start æ¹æ³ä¼å¯å¨çº¿ç¨ï¼ç¶å JVM ä¼è®©è¿ä¸ªçº¿ç¨å»æ§è¡ run æ¹æ³ã\n\n\n# å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run æ¹æ³ä¹\n\n * å¯ä»¥ãä½æ¯å¦æç´æ¥è°ç¨ Thread ç run æ¹æ³ï¼å®çè¡ä¸ºå°±ä¼åæ®éçæ¹æ³ä¸æ ·ã\n * ä¸ºäºå¨æ°ççº¿ç¨ä¸­æ§è¡æä»¬çä»£ç ï¼å¿é¡»ä½¿ç¨ Thread ç start æ¹æ³ã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * è¿ç¨åçº¿ç¨å³ç³»ååºå«\n * Java çº¿ç¨ä¸­ yield ä¸ join æ¹æ³çåºå«\n * sleep()ï¼wait()ï¼yield()å join()æ¹æ³çåºå«\n * Java å¹¶åç¼ç¨ï¼çº¿ç¨é´åä½çä¸¤ç§æ¹å¼ï¼waitãnotifyãnotifyAll å Condition\n * Java å¹¶åç¼ç¨ï¼CallableãFuture å FutureTask\n * StackOverflow VisualVM - Thread States\n * Java ä¸­å®æ¤çº¿ç¨çæ»ç»\n * Java å¹¶å\n * Why must wait() always be in synchronized block',normalizedContent:'# java çº¿ç¨åºç¡\n\n> å³é®è¯ï¼threadãrunnableãcallableãfutureãwaitãnotifyãnotifyallãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n\n\n# çº¿ç¨ç®ä»\n\n\n# ä»ä¹æ¯è¿ç¨\n\nç®è¨ä¹ï¼è¿ç¨å¯è§ä¸ºä¸ä¸ªæ­£å¨è¿è¡çç¨åºãå®æ¯ç³»ç»è¿è¡ç¨åºçåºæ¬åä½ï¼å æ­¤è¿ç¨æ¯å¨æçãè¿ç¨æ¯å·æä¸å®ç¬ç«åè½çç¨åºå³äºæä¸ªæ°æ®éåä¸çä¸æ¬¡è¿è¡æ´»å¨ãè¿ç¨æ¯æä½ç³»ç»è¿è¡èµæºåéçåºæ¬åä½ã\n\n\n# ä»ä¹æ¯çº¿ç¨\n\nçº¿ç¨æ¯æä½ç³»ç»è¿è¡è°åº¦çåºæ¬åä½ãçº¿ç¨ä¹å«è½»éçº§è¿ç¨ï¼light weight processï¼ï¼å¨ä¸ä¸ªè¿ç¨éå¯ä»¥åå»ºå¤ä¸ªçº¿ç¨ï¼è¿äºçº¿ç¨é½æ¥æåèªçè®¡æ°å¨ãå æ åå±é¨åéç­å±æ§ï¼å¹¶ä¸è½å¤è®¿é®å±äº«çåå­åéã\n\n\n# è¿ç¨åçº¿ç¨çåºå«\n\n * ä¸ä¸ªç¨åºè³å°æä¸ä¸ªè¿ç¨ï¼ä¸ä¸ªè¿ç¨è³å°æä¸ä¸ªçº¿ç¨ã\n * çº¿ç¨æ¯è¿ç¨ååæ´ç»ï¼æä»¥æ§è¡å¼éæ´å°ï¼å¹¶åæ§æ´é«ã\n * è¿ç¨æ¯ä¸ä¸ªå®ä½ï¼æ¥æç¬ç«çèµæºï¼èåä¸ä¸ªè¿ç¨ä¸­çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çèµæºã\n\n\n# åå»ºçº¿ç¨\n\nåå»ºçº¿ç¨æä¸ç§æ¹å¼ï¼\n\n * ç»§æ¿ thread ç±»\n * å®ç° runnable æ¥å£\n * å®ç° callable æ¥å£\n\n\n# thread\n\néè¿ç»§æ¿ thread ç±»åå»ºçº¿ç¨çæ­¥éª¤ï¼\n\n 1. å®ä¹ thread ç±»çå­ç±»ï¼å¹¶è¦åè¯¥ç±»ç run æ¹æ³ãrun æ¹æ³çæ¹æ³ä½å°±ä»£è¡¨äºçº¿ç¨è¦å®æçä»»å¡ï¼å æ­¤æ run æ¹æ³ç§°ä¸ºæ§è¡ä½ã\n 2. åå»º thread å­ç±»çå®ä¾ï¼å³åå»ºäºçº¿ç¨å¯¹è±¡ã\n 3. è°ç¨çº¿ç¨å¯¹è±¡ç start æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\npublic class threaddemo {\n\n    public static void main(string[] args) {\n        // å®ä¾åå¯¹è±¡\n        mythread ta = new mythread("thread çº¿ç¨-a");\n        mythread tb = new mythread("thread çº¿ç¨-b");\n        // è°ç¨çº¿ç¨ä¸»ä½\n        ta.start();\n        tb.start();\n    }\n\n    static class mythread extends thread {\n\n        private int ticket = 5;\n\n        mythread(string name) {\n            super(name);\n        }\n\n        @override\n        public void run() {\n            while (ticket > 0) {\n                system.out.println(thread.currentthread().getname() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n        }\n\n    }\n\n}\n\n\n\n# runnable\n\nå®ç° runnable æ¥å£ä¼äºç»§æ¿ thread ç±»ï¼å ä¸ºï¼\n\n * java ä¸æ¯æå¤éç»§æ¿ï¼ææçç±»é½åªåè®¸ç»§æ¿ä¸ä¸ªç¶ç±»ï¼ä½å¯ä»¥å®ç°å¤ä¸ªæ¥å£ãå¦æç»§æ¿äº thread ç±»å°±æ æ³ç»§æ¿å¶å®ç±»ï¼è¿ä¸å©äºæ©å±ã\n * ç±»å¯è½åªè¦æ±å¯æ§è¡å°±è¡ï¼ç»§æ¿æ´ä¸ª thread ç±»å¼éè¿å¤§ã\n\néè¿å®ç° runnable æ¥å£åå»ºçº¿ç¨çæ­¥éª¤ï¼\n\n 1. å®ä¹ runnable æ¥å£çå®ç°ç±»ï¼å¹¶è¦åè¯¥æ¥å£ç run æ¹æ³ãè¯¥ run æ¹æ³çæ¹æ³ä½åæ ·æ¯è¯¥çº¿ç¨ççº¿ç¨æ§è¡ä½ã\n 2. åå»º runnable å®ç°ç±»çå®ä¾ï¼å¹¶ä»¥æ­¤å®ä¾ä½ä¸º thread ç target æ¥åå»º thread å¯¹è±¡ï¼è¯¥ thread å¯¹è±¡ææ¯çæ­£ççº¿ç¨å¯¹è±¡ã\n 3. è°ç¨çº¿ç¨å¯¹è±¡ç start æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\npublic class runnabledemo {\n\n    public static void main(string[] args) {\n        // å®ä¾åå¯¹è±¡\n        thread ta = new thread(new mythread(), "runnable çº¿ç¨-a");\n        thread tb = new thread(new mythread(), "runnable çº¿ç¨-b");\n        // è°ç¨çº¿ç¨ä¸»ä½\n        ta.start();\n        tb.start();\n    }\n\n    static class mythread implements runnable {\n\n        private int ticket = 5;\n\n        @override\n        public void run() {\n            while (ticket > 0) {\n                system.out.println(thread.currentthread().getname() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n        }\n\n    }\n\n}\n\n\n\n# callableãfutureãfuturetask\n\nç»§æ¿ thread ç±»åå®ç° runnable æ¥å£è¿ä¸¤ç§åå»ºçº¿ç¨çæ¹å¼é½æ²¡æè¿åå¼ãæä»¥ï¼çº¿ç¨æ§è¡å®åï¼æ æ³å¾å°æ§è¡ç»æãä½å¦æææå¾å°æ§è¡ç»æè¯¥æä¹åï¼\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼java 1.5 åï¼æä¾äº callable æ¥å£å future æ¥å£ï¼éè¿å®ä»¬ï¼å¯ä»¥å¨çº¿ç¨æ§è¡ç»æåï¼è¿åæ§è¡ç»æã\n\n# callable\n\ncallable æ¥å£åªå£°æäºä¸ä¸ªæ¹æ³ï¼è¿ä¸ªæ¹æ³å«å call()ï¼\n\npublic interface callable<v> {\n    /**\n     * computes a result, or throws an exception if unable to do so.\n     *\n     * @return computed result\n     * @throws exception if unable to compute a result\n     */\n    v call() throws exception;\n}\n\n\né£ä¹æä¹ä½¿ç¨ callable å¢ï¼ä¸è¬æåµä¸æ¯éå executorservice æ¥ä½¿ç¨çï¼å¨ executorservice æ¥å£ä¸­å£°æäºè¥å¹²ä¸ª submit æ¹æ³çéè½½çæ¬ï¼\n\n<t> future<t> submit(callable<t> task);\n<t> future<t> submit(runnable task, t result);\nfuture<?> submit(runnable task);\n\n\nç¬¬ä¸ä¸ª submit æ¹æ³éé¢çåæ°ç±»åå°±æ¯ callableã\n\n# future\n\nfuture å°±æ¯å¯¹äºå·ä½ç callable ä»»å¡çæ§è¡ç»æè¿è¡åæ¶ãæ¥è¯¢æ¯å¦å®æãè·åç»æãå¿è¦æ¶å¯ä»¥éè¿ get æ¹æ³è·åæ§è¡ç»æï¼è¯¥æ¹æ³ä¼é»å¡ç´å°ä»»å¡è¿åç»æã\n\npublic interface future<v> {\n    boolean cancel(boolean mayinterruptifrunning);\n    boolean iscancelled();\n    boolean isdone();\n    v get() throws interruptedexception, executionexception;\n    v get(long timeout, timeunit unit)\n        throws interruptedexception, executionexception, timeoutexception;\n}\n\n\n# futuretask\n\nfuturetask ç±»å®ç°äº runnablefuture æ¥å£ï¼runnablefuture ç»§æ¿äº runnable æ¥å£å future æ¥å£ã\n\næä»¥ï¼futuretask æ¢å¯ä»¥ä½ä¸º runnable è¢«çº¿ç¨æ§è¡ï¼åå¯ä»¥ä½ä¸º future å¾å° callable çè¿åå¼ã\n\npublic class futuretask<v> implements runnablefuture<v> {\n    // ...\n    public futuretask(callable<v> callable) {}\n    public futuretask(runnable runnable, v result) {}\n}\n\npublic interface runnablefuture<v> extends runnable, future<v> {\n    void run();\n}\n\n\näºå®ä¸ï¼futuretask æ¯ future æ¥å£çä¸ä¸ªå¯ä¸å®ç°ç±»ã\n\n# callable + future + futuretask ç¤ºä¾\n\néè¿å®ç° callable æ¥å£åå»ºçº¿ç¨çæ­¥éª¤ï¼\n\n 1. åå»º callable æ¥å£çå®ç°ç±»ï¼å¹¶å®ç° call æ¹æ³ãè¯¥ call æ¹æ³å°ä½ä¸ºçº¿ç¨æ§è¡ä½ï¼å¹¶ä¸æè¿åå¼ã\n 2. åå»º callable å®ç°ç±»çå®ä¾ï¼ä½¿ç¨ futuretask ç±»æ¥åè£ callable å¯¹è±¡ï¼è¯¥ futuretask å¯¹è±¡å°è£äºè¯¥ callable å¯¹è±¡ç call æ¹æ³çè¿åå¼ã\n 3. ä½¿ç¨ futuretask å¯¹è±¡ä½ä¸º thread å¯¹è±¡ç target åå»ºå¹¶å¯å¨æ°çº¿ç¨ã\n 4. è°ç¨ futuretask å¯¹è±¡ç get æ¹æ³æ¥è·å¾çº¿ç¨æ§è¡ç»æåçè¿åå¼ã\n\npublic class callabledemo {\n\n    public static void main(string[] args) {\n        callable<long> callable = new mythread();\n        futuretask<long> future = new futuretask<>(callable);\n        new thread(future, "callable çº¿ç¨").start();\n        try {\n            system.out.println("ä»»å¡èæ¶ï¼" + (future.get() / 1000000) + "æ¯«ç§");\n        } catch (interruptedexception | executionexception e) {\n            e.printstacktrace();\n        }\n    }\n\n    static class mythread implements callable<long> {\n\n        private int ticket = 10000;\n\n        @override\n        public long call() {\n            long begin = system.nanotime();\n            while (ticket > 0) {\n                system.out.println(thread.currentthread().getname() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n\n            long end = system.nanotime();\n            return (end - begin);\n        }\n\n    }\n\n}\n\n\n\n# çº¿ç¨åºæ¬ç¨æ³\n\nçº¿ç¨ï¼threadï¼åºæ¬æ¹æ³æ¸åï¼\n\næ¹æ³              æè¿°\nrun             çº¿ç¨çæ§è¡å®ä½ã\nstart           çº¿ç¨çå¯å¨æ¹æ³ã\ncurrentthread   è¿åå¯¹å½åæ­£å¨æ§è¡ççº¿ç¨å¯¹è±¡çå¼ç¨ã\nsetname         è®¾ç½®çº¿ç¨åç§°ã\ngetname         è·åçº¿ç¨åç§°ã\nsetpriority     è®¾ç½®çº¿ç¨ä¼åçº§ãjava ä¸­ççº¿ç¨ä¼åçº§çèå´æ¯ [1,10]ï¼ä¸è¬æ¥è¯´ï¼é«ä¼åçº§ççº¿ç¨å¨è¿è¡æ¶ä¼å·æä¼åæãå¯ä»¥éè¿\n                thread.setpriority(thread.max_priority) çæ¹å¼è®¾ç½®ï¼é»è®¤ä¼åçº§ä¸º 5ã\ngetpriority     è·åçº¿ç¨ä¼åçº§ã\nsetdaemon       è®¾ç½®çº¿ç¨ä¸ºå®æ¤çº¿ç¨ã\nisdaemon        å¤æ­çº¿ç¨æ¯å¦ä¸ºå®æ¤çº¿ç¨ã\nisalive         å¤æ­çº¿ç¨æ¯å¦å¯å¨ã\ninterrupt       ä¸­æ­å¦ä¸ä¸ªçº¿ç¨çè¿è¡ç¶æã\ninterrupted     æµè¯å½åçº¿ç¨æ¯å¦å·²è¢«ä¸­æ­ãéè¿æ­¤æ¹æ³å¯ä»¥æ¸é¤çº¿ç¨çä¸­æ­ç¶æãæ¢å¥è¯è¯´ï¼å¦æè¦è¿ç»­è°ç¨æ­¤æ¹æ³ä¸¤æ¬¡ï¼åç¬¬äºæ¬¡è°ç¨å°è¿å\n                falseï¼é¤éå½åçº¿ç¨å¨ç¬¬ä¸æ¬¡è°ç¨æ¸é¤å¶ä¸­æ­ç¶æä¹åä¸å¨ç¬¬äºæ¬¡è°ç¨æ£æ¥å¶ç¶æä¹ååæ¬¡ä¸­æ­ï¼ã\njoin            å¯ä»¥ä½¿ä¸ä¸ªçº¿ç¨å¼ºå¶è¿è¡ï¼çº¿ç¨å¼ºå¶è¿è¡æé´ï¼å¶ä»çº¿ç¨æ æ³è¿è¡ï¼å¿é¡»ç­å¾æ­¤çº¿ç¨å®æä¹åæå¯ä»¥ç»§ç»­æ§è¡ã\nthread.sleep    éææ¹æ³ãå°å½åæ­£å¨æ§è¡ççº¿ç¨ä¼ç ã\nthread.yield    éææ¹æ³ãå°å½åæ­£å¨æ§è¡ççº¿ç¨æåï¼è®©å¶ä»çº¿ç¨æ§è¡ã\n\n\n# çº¿ç¨ä¼ç \n\nä½¿ç¨ thread.sleep æ¹æ³å¯ä»¥ä½¿å¾å½åæ­£å¨æ§è¡ççº¿ç¨è¿å¥ä¼ç ç¶æã\n\nä½¿ç¨ thread.sleep éè¦åå¶ä¼ å¥ä¸ä¸ªæ´æ°å¼ï¼è¿ä¸ªå¼è¡¨ç¤ºçº¿ç¨å°è¦ä¼ç çæ¯«ç§æ°ã\n\nthread.sleep æ¹æ³å¯è½ä¼æåº interruptedexceptionï¼å ä¸ºå¼å¸¸ä¸è½è·¨çº¿ç¨ä¼ æ­å main ä¸­ï¼å æ­¤å¿é¡»å¨æ¬å°è¿è¡å¤çãçº¿ç¨ä¸­æåºçå¶å®å¼å¸¸ä¹åæ ·éè¦å¨æ¬å°è¿è¡å¤çã\n\npublic class threadsleepdemo {\n\n    public static void main(string[] args) {\n        new thread(new mythread("çº¿ç¨a", 500)).start();\n        new thread(new mythread("çº¿ç¨b", 1000)).start();\n        new thread(new mythread("çº¿ç¨c", 1500)).start();\n    }\n\n    static class mythread implements runnable {\n\n        /** çº¿ç¨åç§° */\n        private string name;\n\n        /** ä¼ç æ¶é´ */\n        private int time;\n\n        private mythread(string name, int time) {\n            this.name = name;\n            this.time = time;\n        }\n\n        @override\n        public void run() {\n            try {\n                // ä¼ç æå®çæ¶é´\n                thread.sleep(this.time);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println(this.name + "ä¼ç " + this.time + "æ¯«ç§ã");\n        }\n\n    }\n\n}\n\n\n\n# çº¿ç¨ç¤¼è®©\n\nthread.yield æ¹æ³çè°ç¨å£°æäºå½åçº¿ç¨å·²ç»å®æäºçå½å¨æä¸­æéè¦çé¨åï¼å¯ä»¥åæ¢ç»å¶å®çº¿ç¨æ¥æ§è¡ ã\n\nè¯¥æ¹æ³åªæ¯å¯¹çº¿ç¨è°åº¦å¨çä¸ä¸ªå»ºè®®ï¼èä¸ä¹åªæ¯å»ºè®®å·æç¸åä¼åçº§çå¶å®çº¿ç¨å¯ä»¥è¿è¡ã\n\npublic class threadyielddemo {\n\n    public static void main(string[] args) {\n        mythread t = new mythread();\n        new thread(t, "çº¿ç¨a").start();\n        new thread(t, "çº¿ç¨b").start();\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            for (int i = 0; i < 5; i++) {\n                try {\n                    thread.sleep(1000);\n                } catch (exception e) {\n                    e.printstacktrace();\n                }\n                system.out.println(thread.currentthread().getname() + "è¿è¡ï¼i = " + i);\n                if (i == 2) {\n                    system.out.print("çº¿ç¨ç¤¼è®©ï¼");\n                    thread.yield();\n                }\n            }\n        }\n    }\n}\n\n\n\n# ç»æ­¢çº¿ç¨\n\n> thread ä¸­ç stop æ¹æ³æç¼ºé·ï¼å·²åºå¼ã\n> \n> ä½¿ç¨ thread.stop åæ­¢çº¿ç¨ä¼å¯¼è´å®è§£éææå·²éå®ççè§å¨ï¼ç±äºæªç»æ£æ¥ç threaddeath å¼å¸¸ä¼å¨å æ ä¸­ä¼ æ­ï¼è¿æ¯èªç¶çç»æï¼ã å¦æååç±è¿äºçè§å¨ä¿æ¤çä»»ä½å¯¹è±¡å¤äºä¸ä¸è´ç¶æï¼åæåçå¯¹è±¡å°å¯¹å¶ä»çº¿ç¨å¯è§ï¼ä»èå¯è½å¯¼è´ä»»æè¡ä¸ºã\n> \n> stop() æ¹æ³ä¼ççææ­»çº¿ç¨ï¼ä¸ç»çº¿ç¨åæ¯çæºä¼ï¼å¦æçº¿ç¨ææ reentrantlock éï¼è¢« stop() ççº¿ç¨å¹¶ä¸ä¼èªå¨è°ç¨ reentrantlock ç unlock() å»éæ¾éï¼é£å¶ä»çº¿ç¨å°±åä¹æ²¡æºä¼è·å¾ reentrantlock éï¼è¿å®å¨æ¯å¤ªå±é©äºãæä»¥è¯¥æ¹æ³å°±ä¸å»ºè®®ä½¿ç¨äºï¼ç±»ä¼¼çæ¹æ³è¿æ suspend() å resume() æ¹æ³ï¼è¿ä¸¤ä¸ªæ¹æ³åæ ·ä¹é½ä¸å»ºè®®ä½¿ç¨äºï¼æä»¥è¿éä¹å°±ä¸å¤ä»ç»äºãthread.stop çè®¸å¤ç¨æ³åºç±ä»ä¿®æ¹æäºåéä»¥æç¤ºç®æ çº¿ç¨åºåæ­¢è¿è¡çä»£ç ä»£æ¿ã ç®æ çº¿ç¨åºå®ææ£æ¥æ­¤åéï¼å¦æè¯¥åéæç¤ºè¦åæ­¢è¿è¡ï¼ååºææåºæ¹å¼ä»å¶è¿è¡æ¹æ³è¿åãå¦æç®æ çº¿ç¨ç­å¾å¾é¿æ¶é´ï¼ä¾å¦ï¼å¨æ¡ä»¶åéä¸ï¼ï¼ååºä½¿ç¨ä¸­æ­æ¹æ³æ¥ä¸­æ­ç­å¾ã\n\nå½ä¸ä¸ªçº¿ç¨è¿è¡æ¶ï¼å¦ä¸ä¸ªçº¿ç¨å¯ä»¥ç´æ¥éè¿ interrupt æ¹æ³ä¸­æ­å¶è¿è¡ç¶æã\n\npublic class threadinterruptdemo {\n\n    public static void main(string[] args) {\n        mythread mt = new mythread(); // å®ä¾årunnableå­ç±»å¯¹è±¡\n        thread t = new thread(mt, "çº¿ç¨"); // å®ä¾åthreadå¯¹è±¡\n        t.start(); // å¯å¨çº¿ç¨\n        try {\n            thread.sleep(2000); // çº¿ç¨ä¼ç 2ç§\n        } catch (interruptedexception e) {\n            system.out.println("3ãmainçº¿ç¨ä¼ç è¢«ç»æ­¢");\n        }\n        t.interrupt(); // ä¸­æ­çº¿ç¨æ§è¡\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            system.out.println("1ãè¿å¥run()æ¹æ³");\n            try {\n                thread.sleep(10000); // çº¿ç¨ä¼ç 10ç§\n                system.out.println("2ãå·²ç»å®æäºä¼ç ");\n            } catch (interruptedexception e) {\n                system.out.println("3ãmythreadçº¿ç¨ä¼ç è¢«ç»æ­¢");\n                return; // è¿åè°ç¨å¤\n            }\n            system.out.println("4ãrun()æ¹æ³æ­£å¸¸ç»æ");\n        }\n    }\n}\n\n\nå¦æä¸ä¸ªçº¿ç¨ç run æ¹æ³æ§è¡ä¸ä¸ªæ éå¾ªç¯ï¼å¹¶ä¸æ²¡ææ§è¡ sleep ç­ä¼æåº interruptedexception çæä½ï¼é£ä¹è°ç¨çº¿ç¨ç interrupt æ¹æ³å°±æ æ³ä½¿çº¿ç¨æåç»æã\n\nä½æ¯è°ç¨ interrupt æ¹æ³ä¼è®¾ç½®çº¿ç¨çä¸­æ­æ è®°ï¼æ­¤æ¶è°ç¨ interrupted æ¹æ³ä¼è¿å trueãå æ­¤å¯ä»¥å¨å¾ªç¯ä½ä¸­ä½¿ç¨ interrupted æ¹æ³æ¥å¤æ­çº¿ç¨æ¯å¦å¤äºä¸­æ­ç¶æï¼ä»èæåç»æçº¿ç¨ã\n\nå®å¨å°ç»æ­¢çº¿ç¨æä¸¤ç§æ¹æ³ï¼\n\n * å®ä¹ volatile æ å¿ä½ï¼å¨ run æ¹æ³ä¸­ä½¿ç¨æ å¿ä½æ§å¶çº¿ç¨ç»æ­¢\n * ä½¿ç¨ interrupt æ¹æ³å thread.interrupted æ¹æ³éåä½¿ç¨æ¥æ§å¶çº¿ç¨ç»æ­¢\n\nãç¤ºä¾ãä½¿ç¨ volatile æ å¿ä½æ§å¶çº¿ç¨ç»æ­¢\n\npublic class threadstopdemo2 {\n\n    public static void main(string[] args) throws exception {\n        mytask task = new mytask();\n        thread thread = new thread(task, "mytask");\n        thread.start();\n        timeunit.milliseconds.sleep(50);\n        task.cancel();\n    }\n\n    private static class mytask implements runnable {\n\n        private volatile boolean flag = true;\n\n        private volatile long count = 0l;\n\n        @override\n        public void run() {\n            system.out.println(thread.currentthread().getname() + " çº¿ç¨å¯å¨");\n            while (flag) {\n                system.out.println(count++);\n            }\n            system.out.println(thread.currentthread().getname() + " çº¿ç¨ç»æ­¢");\n        }\n\n        /**\n         * éè¿ volatile æ å¿ä½æ¥æ§å¶çº¿ç¨ç»æ­¢\n         */\n        public void cancel() {\n            flag = false;\n        }\n\n    }\n\n}\n\n\nãç¤ºä¾ãä½¿ç¨ interrupt æ¹æ³å thread.interrupted æ¹æ³éåä½¿ç¨æ¥æ§å¶çº¿ç¨ç»æ­¢\n\npublic class threadstopdemo3 {\n\n    public static void main(string[] args) throws exception {\n        mytask task = new mytask();\n        thread thread = new thread(task, "mytask");\n        thread.start();\n        timeunit.milliseconds.sleep(50);\n        thread.interrupt();\n    }\n\n    private static class mytask implements runnable {\n\n        private volatile long count = 0l;\n\n        @override\n        public void run() {\n            system.out.println(thread.currentthread().getname() + " çº¿ç¨å¯å¨");\n            // éè¿ thread.interrupted å interrupt éåæ¥æ§å¶çº¿ç¨ç»æ­¢\n            while (!thread.interrupted()) {\n                system.out.println(count++);\n            }\n            system.out.println(thread.currentthread().getname() + " çº¿ç¨ç»æ­¢");\n        }\n    }\n}\n\n\n\n# å®æ¤çº¿ç¨\n\nä»ä¹æ¯å®æ¤çº¿ç¨ï¼\n\n * å®æ¤çº¿ç¨ï¼daemon threadï¼æ¯å¨åå°æ§è¡å¹¶ä¸ä¸ä¼é»æ­¢ jvm ç»æ­¢ççº¿ç¨ãå½ææéå®æ¤çº¿ç¨ç»ææ¶ï¼ç¨åºä¹å°±ç»æ­¢ï¼åæ¶ä¼ææ­»ææå®æ¤çº¿ç¨ã\n * ä¸å®æ¤çº¿ç¨ï¼daemon threadï¼ç¸åçï¼å«ç¨æ·çº¿ç¨ï¼user threadï¼ï¼ä¹å°±æ¯éå®æ¤çº¿ç¨ã\n\nä¸ºä»ä¹éè¦å®æ¤çº¿ç¨ï¼\n\n * å®æ¤çº¿ç¨çä¼åçº§æ¯è¾ä½ï¼ç¨äºä¸ºç³»ç»ä¸­çå¶å®å¯¹è±¡åçº¿ç¨æä¾æå¡ãå¸åçåºç¨å°±æ¯åå¾åæ¶å¨ã\n\nå¦ä½ä½¿ç¨å®æ¤çº¿ç¨ï¼\n\n * å¯ä»¥ä½¿ç¨ isdaemon æ¹æ³å¤æ­çº¿ç¨æ¯å¦ä¸ºå®æ¤çº¿ç¨ã\n * å¯ä»¥ä½¿ç¨ setdaemon æ¹æ³è®¾ç½®çº¿ç¨ä¸ºå®æ¤çº¿ç¨ã\n   * æ­£å¨è¿è¡çç¨æ·çº¿ç¨æ æ³è®¾ç½®ä¸ºå®æ¤çº¿ç¨ï¼æä»¥ setdaemon å¿é¡»å¨ thread.start æ¹æ³ä¹åè®¾ç½®ï¼å¦åä¼æåº llegalthreadstateexception å¼å¸¸ï¼\n   * ä¸ä¸ªå®æ¤çº¿ç¨åå»ºçå­çº¿ç¨ä¾ç¶æ¯å®æ¤çº¿ç¨ã\n   * ä¸è¦è®¤ä¸ºææçåºç¨é½å¯ä»¥åéç»å®æ¤çº¿ç¨æ¥è¿è¡æå¡ï¼æ¯å¦è¯»åæä½æèè®¡ç®é»è¾ã\n\npublic class threaddaemondemo {\n\n    public static void main(string[] args) {\n        thread t = new thread(new mythread(), "çº¿ç¨");\n        t.setdaemon(true); // æ­¤çº¿ç¨å¨åå°è¿è¡\n        system.out.println("çº¿ç¨ t æ¯å¦æ¯å®æ¤è¿ç¨ï¼" + t.isdaemon());\n        t.start(); // å¯å¨çº¿ç¨\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            while (true) {\n                system.out.println(thread.currentthread().getname() + "å¨è¿è¡ã");\n            }\n        }\n    }\n}\n\n\n> åèéè¯»ï¼java ä¸­å®æ¤çº¿ç¨çæ»ç»\n\n\n# çº¿ç¨éä¿¡\n\n> å½å¤ä¸ªçº¿ç¨å¯ä»¥ä¸èµ·å·¥ä½å»è§£å³æä¸ªé®é¢æ¶ï¼å¦ææäºé¨åå¿é¡»å¨å¶å®é¨åä¹åå®æï¼é£ä¹å°±éè¦å¯¹çº¿ç¨è¿è¡åè°ã\n\n\n# wait/notify/notifyall\n\n * wait - wait ä¼èªå¨éæ¾å½åçº¿ç¨å æçå¯¹è±¡éï¼å¹¶è¯·æ±æä½ç³»ç»æèµ·å½åçº¿ç¨ï¼è®©çº¿ç¨ä» running ç¶æè½¬å¥ waiting ç¶æï¼ç­å¾ notify / notifyall æ¥å¤éãå¦ææ²¡æéæ¾éï¼é£ä¹å¶å®çº¿ç¨å°±æ æ³è¿å¥å¯¹è±¡çåæ­¥æ¹æ³æèåæ­¥æ§å¶åä¸­ï¼é£ä¹å°±æ æ³æ§è¡ notify æè notifyall æ¥å¤éæèµ·ççº¿ç¨ï¼é ææ­»éã\n * notify - å¤éä¸ä¸ªæ­£å¨ waiting ç¶æççº¿ç¨ï¼å¹¶è®©å®æ¿å°å¯¹è±¡éï¼å·ä½å¤éåªä¸ä¸ªçº¿ç¨ç± jvm æ§å¶ ã\n * notifyall - å¤éæææ­£å¨ waiting ç¶æççº¿ç¨ï¼æ¥ä¸æ¥å®ä»¬éè¦ç«äºå¯¹è±¡éã\n\n> æ³¨æï¼\n> \n>  * waitãnotifyãnotifyall é½æ¯ object ç±»ä¸­çæ¹æ³ï¼èé threadã\n>  * waitãnotifyãnotifyall åªè½ç¨å¨ synchronized æ¹æ³æè synchronized ä»£ç åä¸­ä½¿ç¨ï¼å¦åä¼å¨è¿è¡æ¶æåº illegalmonitorstateexceptionã\n> \n> ä¸ºä»ä¹ waitãnotifyãnotifyall ä¸å®ä¹å¨ thread ä¸­ï¼ä¸ºä»ä¹ waitãnotifyãnotifyall è¦éå synchronized ä½¿ç¨ï¼\n> \n> é¦åï¼éè¦äºè§£å ä¸ªåºæ¬ç¥è¯ç¹ï¼\n> \n>  * æ¯ä¸ä¸ª java å¯¹è±¡é½æä¸ä¸ªä¸ä¹å¯¹åºç çè§å¨ï¼monitorï¼\n>  * æ¯ä¸ä¸ªçè§å¨éé¢é½æä¸ä¸ª å¯¹è±¡é ãä¸ä¸ª ç­å¾éåãä¸ä¸ª åæ­¥éå\n> \n> äºè§£äºä»¥ä¸æ¦å¿µï¼æä»¬åè¿å¤´æ¥çè§£åé¢ä¸¤ä¸ªé®é¢ã\n> \n> ä¸ºä»ä¹è¿å ä¸ªæ¹æ³ä¸å®ä¹å¨ thread ä¸­ï¼\n> \n> ç±äºæ¯ä¸ªå¯¹è±¡é½æ¥æå¯¹è±¡éï¼è®©å½åçº¿ç¨ç­å¾æä¸ªå¯¹è±¡éï¼èªç¶åºè¯¥åºäºè¿ä¸ªå¯¹è±¡ï¼objectï¼æ¥æä½ï¼èéä½¿ç¨å½åçº¿ç¨ï¼threadï¼æ¥æä½ãå ä¸ºå½åçº¿ç¨å¯è½ä¼ç­å¾å¤ä¸ªçº¿ç¨çéï¼å¦æåºäºçº¿ç¨ï¼threadï¼æ¥æä½ï¼å°±éå¸¸å¤æäºã\n> \n> ä¸ºä»ä¹ waitãnotifyãnotifyall è¦éå synchronized ä½¿ç¨ï¼\n> \n> å¦æè°ç¨æä¸ªå¯¹è±¡ç wait æ¹æ³ï¼å½åçº¿ç¨å¿é¡»æ¥æè¿ä¸ªå¯¹è±¡çå¯¹è±¡éï¼å æ­¤è°ç¨ wait æ¹æ³å¿é¡»å¨ synchronized æ¹æ³å synchronized ä»£ç åä¸­ã\n\nçäº§èãæ¶è´¹èæ¨¡å¼æ¯ waitãnotifyãnotifyall çä¸ä¸ªç»å¸ä½¿ç¨æ¡ä¾ï¼\n\npublic class threadwaitnotifydemo02 {\n\n    private static final int queue_size = 10;\n    private static final priorityqueue<integer> queue = new priorityqueue<>(queue_size);\n\n    public static void main(string[] args) {\n        new producer("çäº§èa").start();\n        new producer("çäº§èb").start();\n        new consumer("æ¶è´¹èa").start();\n        new consumer("æ¶è´¹èb").start();\n    }\n\n    static class consumer extends thread {\n\n        consumer(string name) {\n            super(name);\n        }\n\n        @override\n        public void run() {\n            while (true) {\n                synchronized (queue) {\n                    while (queue.size() == 0) {\n                        try {\n                            system.out.println("éåç©ºï¼ç­å¾æ°æ®");\n                            queue.wait();\n                        } catch (interruptedexception e) {\n                            e.printstacktrace();\n                            queue.notifyall();\n                        }\n                    }\n                    queue.poll(); // æ¯æ¬¡ç§»èµ°éé¦åç´ \n                    queue.notifyall();\n                    try {\n                        thread.sleep(500);\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                    system.out.println(thread.currentthread().getname() + " ä»éååèµ°ä¸ä¸ªåç´ ï¼éåå½åæï¼" + queue.size() + "ä¸ªåç´ ");\n                }\n            }\n        }\n    }\n\n    static class producer extends thread {\n\n        producer(string name) {\n            super(name);\n        }\n\n        @override\n        public void run() {\n            while (true) {\n                synchronized (queue) {\n                    while (queue.size() == queue_size) {\n                        try {\n                            system.out.println("éåæ»¡ï¼ç­å¾æç©ºä½ç©ºé´");\n                            queue.wait();\n                        } catch (interruptedexception e) {\n                            e.printstacktrace();\n                            queue.notifyall();\n                        }\n                    }\n                    queue.offer(1); // æ¯æ¬¡æå¥ä¸ä¸ªåç´ \n                    queue.notifyall();\n                    try {\n                        thread.sleep(500);\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                    system.out.println(thread.currentthread().getname() + " åéååä¸­æå¥ä¸ä¸ªåç´ ï¼éåå½åæï¼" + queue.size() + "ä¸ªåç´ ");\n                }\n            }\n        }\n    }\n}\n\n\n\n# join\n\nå¨çº¿ç¨æä½ä¸­ï¼å¯ä»¥ä½¿ç¨ join æ¹æ³è®©ä¸ä¸ªçº¿ç¨å¼ºå¶è¿è¡ï¼çº¿ç¨å¼ºå¶è¿è¡æé´ï¼å¶ä»çº¿ç¨æ æ³è¿è¡ï¼å¿é¡»ç­å¾æ­¤çº¿ç¨å®æä¹åæå¯ä»¥ç»§ç»­æ§è¡ã\n\npublic class threadjoindemo {\n\n    public static void main(string[] args) {\n        mythread mt = new mythread(); // å®ä¾årunnableå­ç±»å¯¹è±¡\n        thread t = new thread(mt, "mythread"); // å®ä¾åthreadå¯¹è±¡\n        t.start(); // å¯å¨çº¿ç¨\n        for (int i = 0; i < 50; i++) {\n            if (i > 10) {\n                try {\n                    t.join(); // çº¿ç¨å¼ºå¶è¿è¡\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n            }\n            system.out.println("main çº¿ç¨è¿è¡ --\x3e " + i);\n        }\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            for (int i = 0; i < 50; i++) {\n                system.out.println(thread.currentthread().getname() + " è¿è¡ï¼i = " + i); // åå¾å½åçº¿ç¨çåå­\n            }\n        }\n    }\n}\n\n\n\n# ç®¡é\n\nç®¡éè¾å¥/è¾åºæµåæ®éçæä»¶è¾å¥/è¾åºæµæèç½ç»è¾å¥/è¾åºæµä¸åä¹å¤å¨äºï¼å®ä¸»è¦ç¨äºçº¿ç¨ä¹é´çæ°æ®ä¼ è¾ï¼èä¼ è¾çåªä»ä¸ºåå­ã ç®¡éè¾å¥/è¾åºæµä¸»è¦åæ¬äºå¦ä¸ 4 ç§å·ä½å®ç°ï¼pipedoutputstreamãpipedinputstreamãpipedreader å pipedwriterï¼åä¸¤ç§é¢åå­èï¼èåä¸¤ç§é¢åå­ç¬¦ã\n\npublic class piped {\n\n    public static void main(string[] args) throws exception {\n        pipedwriter out = new pipedwriter();\n        pipedreader in = new pipedreader();\n        // å°è¾åºæµåè¾å¥æµè¿è¡è¿æ¥ï¼å¦åå¨ä½¿ç¨æ¶ä¼æåºioexception\n        out.connect(in);\n        thread printthread = new thread(new print(in), "printthread");\n        printthread.start();\n        int receive = 0;\n        try {\n            while ((receive = system.in.read()) != -1) {\n                out.write(receive);\n            }\n        } finally {\n            out.close();\n        }\n    }\n\n    static class print implements runnable {\n\n        private pipedreader in;\n\n        print(pipedreader in) {\n            this.in = in;\n        }\n\n        public void run() {\n            int receive = 0;\n            try {\n                while ((receive = in.read()) != -1) {\n                    system.out.print((char) receive);\n                }\n            } catch (ioexception e) {\n                e.printstacktrace();\n            }\n        }\n    }\n}\n\n\n\n# çº¿ç¨çå½å¨æ\n\n\n\njava.lang.thread.state ä¸­å®ä¹äº 6 ç§ä¸åççº¿ç¨ç¶æï¼å¨ç»å®çä¸ä¸ªæ¶å»ï¼çº¿ç¨åªè½å¤äºå¶ä¸­çä¸ä¸ªç¶æã\n\nä»¥ä¸æ¯åç¶æçè¯´æï¼ä»¥åç¶æé´çèç³»ï¼\n\n * æ°å»ºï¼newï¼ - å°æªè°ç¨ start æ¹æ³ççº¿ç¨å¤äºæ­¤ç¶æãæ­¤ç¶ææå³çï¼åå»ºççº¿ç¨å°æªå¯å¨ã\n\n * å°±ç»ªï¼runnableï¼ - å·²ç»è°ç¨äº start æ¹æ³ççº¿ç¨å¤äºæ­¤ç¶æãæ­¤ç¶ææå³çï¼çº¿ç¨å·²ç»å¨ jvm ä¸­è¿è¡ãä½æ¯å¨æä½ç³»ç»å±é¢ï¼å®å¯è½å¤äºè¿è¡ç¶æï¼ä¹å¯è½ç­å¾èµæºè°åº¦ï¼ä¾å¦å¤çå¨èµæºï¼ï¼èµæºè°åº¦å®æå°±è¿å¥è¿è¡ç¶æãæä»¥è¯¥ç¶æçå¯è¿è¡æ¯æå¯ä»¥è¢«è¿è¡ï¼å·ä½ææ²¡æè¿è¡è¦çåºå±æä½ç³»ç»çèµæºè°åº¦ã\n\n * é»å¡ï¼blockedï¼ - æ­¤ç¶ææå³çï¼çº¿ç¨å¤äºè¢«é»å¡ç¶æãè¡¨ç¤ºçº¿ç¨å¨ç­å¾ synchronized çéå¼éï¼monitor lockï¼ãsynchronized ä¿®é¥°çæ¹æ³ãä»£ç ååä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡ï¼å¶ä»çº¿ç¨åªè½ç­å¾ï¼å³å¤äºé»å¡ç¶æãå½å ç¨ synchronized éå¼éççº¿ç¨éæ¾éï¼å¹¶ä¸ç­å¾ççº¿ç¨è·å¾ synchronized éå¼éæ¶ï¼å°±åä¼ä» blocked è½¬æ¢å° runnable ç¶æã\n\n * ç­å¾ï¼waitingï¼ - æ­¤ç¶ææå³çï¼çº¿ç¨æ éæç­å¾ï¼ç´å°è¢«å¶ä»çº¿ç¨æ¾å¼å°å¤éã é»å¡åç­å¾çåºå«å¨äºï¼é»å¡æ¯è¢«å¨çï¼å®æ¯å¨ç­å¾è·å synchronized çéå¼éãèç­å¾æ¯ä¸»å¨çï¼éè¿è°ç¨ object.wait ç­æ¹æ³è¿å¥ã\n   \n   è¿å¥æ¹æ³                                        éåºæ¹æ³\n   æ²¡æè®¾ç½® timeout åæ°ç object.wait æ¹æ³             object.notify / object.notifyall\n   æ²¡æè®¾ç½® timeout åæ°ç thread.join æ¹æ³             è¢«è°ç¨ççº¿ç¨æ§è¡å®æ¯\n   locksupport.park æ¹æ³ï¼java å¹¶ååä¸­çéï¼é½æ¯åºäºå®å®ç°çï¼   locksupport.unpark\n\n * å®æ¶ç­å¾ï¼timed waitingï¼ - æ­¤ç¶ææå³çï¼æ éç­å¾å¶å®çº¿ç¨æ¾å¼å°å¤éï¼å¨ä¸å®æ¶é´ä¹åä¼è¢«ç³»ç»èªå¨å¤éã\n   \n   è¿å¥æ¹æ³                                                      éåºæ¹æ³\n   thread.sleep æ¹æ³                                           æ¶é´ç»æ\n   è·å¾ synchronized éå¼éççº¿ç¨ï¼è°ç¨è®¾ç½®äº timeout åæ°ç object.wait æ¹æ³   æ¶é´ç»æ / object.notify / object.notifyall\n   è®¾ç½®äº timeout åæ°ç thread.join æ¹æ³                            æ¶é´ç»æ / è¢«è°ç¨ççº¿ç¨æ§è¡å®æ¯\n   locksupport.parknanos æ¹æ³                                  locksupport.unpark\n   locksupport.parkuntil æ¹æ³                                  locksupport.unpark\n\n * ç»æ­¢(terminated) - çº¿ç¨æ§è¡å® run æ¹æ³ï¼æèå å¼å¸¸éåºäº run æ¹æ³ãæ­¤ç¶ææå³çï¼çº¿ç¨ç»æäºçå½å¨æã\n\n\n# çº¿ç¨å¸¸è§é®é¢\n\n\n# sleepãyieldãjoin æ¹æ³æä»ä¹åºå«\n\n * yield æ¹æ³\n   * yield æ¹æ³ä¼ è®©çº¿ç¨ä» running ç¶æè½¬å¥ runnable ç¶æã\n   * å½è°ç¨äº yield æ¹æ³åï¼åªæä¸å½åçº¿ç¨ç¸åææ´é«ä¼åçº§çrunnable ç¶æçº¿ç¨æä¼è·å¾æ§è¡çæºä¼ã\n * sleep æ¹æ³\n   * sleep æ¹æ³ä¼ è®©çº¿ç¨ä» running ç¶æè½¬å¥ waiting ç¶æã\n   * sleep æ¹æ³éè¦æå®ç­å¾çæ¶é´ï¼è¶è¿ç­å¾æ¶é´åï¼jvm ä¼å°çº¿ç¨ä» waiting ç¶æè½¬å¥ runnable ç¶æã\n   * å½è°ç¨äº sleep æ¹æ³åï¼æ è®ºä»ä¹ä¼åçº§ççº¿ç¨é½å¯ä»¥å¾å°æ§è¡æºä¼ã\n   * sleep æ¹æ³ä¸ä¼éæ¾âéæ å¿âï¼ä¹å°±æ¯è¯´å¦ææ synchronized åæ­¥åï¼å¶ä»çº¿ç¨ä»ç¶ä¸è½è®¿é®å±äº«æ°æ®ã\n * join\n   * join æ¹æ³ä¼ è®©çº¿ç¨ä» running ç¶æè½¬å¥ waiting ç¶æã\n   * å½è°ç¨äº join æ¹æ³åï¼å½åçº¿ç¨å¿é¡»ç­å¾è°ç¨ join æ¹æ³ççº¿ç¨ç»æåæè½ç»§ç»­æ§è¡ã\n\n\n# ä¸ºä»ä¹ sleep å yield æ¹æ³æ¯éæç\n\nthread ç±»ç sleep å yield æ¹æ³å°å¤ç running ç¶æççº¿ç¨ã\n\næä»¥å¨å¶ä»å¤äºé running ç¶æççº¿ç¨ä¸æ§è¡è¿ä¸¤ä¸ªæ¹æ³æ¯æ²¡ææä¹çãè¿å°±æ¯ä¸ºä»ä¹è¿äºæ¹æ³æ¯éæçãå®ä»¬å¯ä»¥å¨å½åæ­£å¨æ§è¡ççº¿ç¨ä¸­å·¥ä½ï¼å¹¶é¿åç¨åºåéè¯¯çè®¤ä¸ºå¯ä»¥å¨å¶ä»éè¿è¡çº¿ç¨è°ç¨è¿äºæ¹æ³ã\n\n\n# java çº¿ç¨æ¯å¦æç§çº¿ç¨ä¼åçº§ä¸¥æ ¼æ§è¡\n\nå³ä½¿è®¾ç½®äºçº¿ç¨çä¼åçº§ï¼ä¹æ æ³ä¿è¯é«ä¼åçº§ççº¿ç¨ä¸å®åæ§è¡ã\n\nåå å¨äºçº¿ç¨ä¼åçº§ä¾èµäºæä½ç³»ç»çæ¯æï¼ç¶èï¼ä¸åçæä½ç³»ç»æ¯æççº¿ç¨ä¼åçº§å¹¶ä¸ç¸åï¼ä¸è½å¾å¥½çå java ä¸­çº¿ç¨ä¼åçº§ä¸ä¸å¯¹åºã\n\n\n# ä¸ä¸ªçº¿ç¨ä¸¤æ¬¡è°ç¨ start()æ¹æ³ä¼ææ ·\n\njava ççº¿ç¨æ¯ä¸åè®¸å¯å¨ä¸¤æ¬¡çï¼ç¬¬äºæ¬¡è°ç¨å¿ç¶ä¼æåº illegalthreadstateexceptionï¼è¿æ¯ä¸ç§è¿è¡æ¶å¼å¸¸ï¼å¤æ¬¡è°ç¨ start è¢«è®¤ä¸ºæ¯ç¼ç¨éè¯¯ã\n\n\n# start å run æ¹æ³æä»ä¹åºå«\n\n * run æ¹æ³æ¯çº¿ç¨çæ§è¡ä½ã\n * start æ¹æ³ä¼å¯å¨çº¿ç¨ï¼ç¶å jvm ä¼è®©è¿ä¸ªçº¿ç¨å»æ§è¡ run æ¹æ³ã\n\n\n# å¯ä»¥ç´æ¥è°ç¨ thread ç±»ç run æ¹æ³ä¹\n\n * å¯ä»¥ãä½æ¯å¦æç´æ¥è°ç¨ thread ç run æ¹æ³ï¼å®çè¡ä¸ºå°±ä¼åæ®éçæ¹æ³ä¸æ ·ã\n * ä¸ºäºå¨æ°ççº¿ç¨ä¸­æ§è¡æä»¬çä»£ç ï¼å¿é¡»ä½¿ç¨ thread ç start æ¹æ³ã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * è¿ç¨åçº¿ç¨å³ç³»ååºå«\n * java çº¿ç¨ä¸­ yield ä¸ join æ¹æ³çåºå«\n * sleep()ï¼wait()ï¼yield()å join()æ¹æ³çåºå«\n * java å¹¶åç¼ç¨ï¼çº¿ç¨é´åä½çä¸¤ç§æ¹å¼ï¼waitãnotifyãnotifyall å condition\n * java å¹¶åç¼ç¨ï¼callableãfuture å futuretask\n * stackoverflow visualvm - thread states\n * java ä¸­å®æ¤çº¿ç¨çæ»ç»\n * java å¹¶å\n * why must wait() always be in synchronized block',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaå¹¶åç®ä»",frontmatter:{title:"Javaå¹¶åç®ä»",date:"2019-05-06T15:33:13.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å"],permalink:"/pages/f6b642/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/01.Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/01.Javaå¹¶åç®ä».md",key:"v-3a567e4e",path:"/pages/f6b642/",headers:[{level:2,title:"å¹¶åæ¦å¿µ",slug:"å¹¶åæ¦å¿µ",normalizedTitle:"å¹¶åæ¦å¿µ",charIndex:247},{level:3,title:"å¹¶ååå¹¶è¡",slug:"å¹¶ååå¹¶è¡",normalizedTitle:"å¹¶ååå¹¶è¡",charIndex:308},{level:3,title:"åæ­¥åå¼æ­¥",slug:"åæ­¥åå¼æ­¥",normalizedTitle:"åæ­¥åå¼æ­¥",charIndex:588},{level:3,title:"é»å¡åéé»å¡",slug:"é»å¡åéé»å¡",normalizedTitle:"é»å¡åéé»å¡",charIndex:847},{level:3,title:"è¿ç¨åçº¿ç¨",slug:"è¿ç¨åçº¿ç¨",normalizedTitle:"è¿ç¨åçº¿ç¨",charIndex:1048},{level:3,title:"ç«ææ¡ä»¶åä¸´çåº",slug:"ç«ææ¡ä»¶åä¸´çåº",normalizedTitle:"ç«ææ¡ä»¶åä¸´çåº",charIndex:1392},{level:3,title:"ç®¡ç¨",slug:"ç®¡ç¨",normalizedTitle:"ç®¡ç¨",charIndex:1512},{level:2,title:"å¹¶åçç¹ç¹",slug:"å¹¶åçç¹ç¹",normalizedTitle:"å¹¶åçç¹ç¹",charIndex:1680},{level:3,title:"æåèµæºå©ç¨ç",slug:"æåèµæºå©ç¨ç",normalizedTitle:"æåèµæºå©ç¨ç",charIndex:2073},{level:3,title:"ç¨åºååºæ´å¿«",slug:"ç¨åºååºæ´å¿«",normalizedTitle:"ç¨åºååºæ´å¿«",charIndex:2084},{level:3,title:"å¹¶åçé®é¢",slug:"å¹¶åçé®é¢",normalizedTitle:"å¹¶åçé®é¢",charIndex:3311},{level:2,title:"å®å¨æ§é®é¢",slug:"å®å¨æ§é®é¢",normalizedTitle:"å®å¨æ§é®é¢",charIndex:3388},{level:3,title:"ç¼å­å¯¼è´çå¯è§æ§é®é¢",slug:"ç¼å­å¯¼è´çå¯è§æ§é®é¢",normalizedTitle:"ç¼å­å¯¼è´çå¯è§æ§é®é¢",charIndex:3675},{level:3,title:"çº¿ç¨åæ¢å¸¦æ¥çåå­æ§é®é¢",slug:"çº¿ç¨åæ¢å¸¦æ¥çåå­æ§é®é¢",normalizedTitle:"çº¿ç¨åæ¢å¸¦æ¥çåå­æ§é®é¢",charIndex:5196},{level:3,title:"ç¼è¯ä¼åå¸¦æ¥çæåºæ§é®é¢",slug:"ç¼è¯ä¼åå¸¦æ¥çæåºæ§é®é¢",normalizedTitle:"ç¼è¯ä¼åå¸¦æ¥çæåºæ§é®é¢",charIndex:6342},{level:3,title:"ä¿è¯å¹¶åå®å¨çæè·¯",slug:"ä¿è¯å¹¶åå®å¨çæè·¯",normalizedTitle:"ä¿è¯å¹¶åå®å¨çæè·¯",charIndex:7738},{level:4,title:"äºæ¥åæ­¥ï¼é»å¡åæ­¥ï¼",slug:"äºæ¥åæ­¥-é»å¡åæ­¥",normalizedTitle:"äºæ¥åæ­¥ï¼é»å¡åæ­¥ï¼",charIndex:7751},{level:4,title:"éé»å¡åæ­¥",slug:"éé»å¡åæ­¥",normalizedTitle:"éé»å¡åæ­¥",charIndex:8100},{level:4,title:"æ åæ­¥",slug:"æ åæ­¥",normalizedTitle:"æ åæ­¥",charIndex:8499},{level:2,title:"æ´»è·æ§é®é¢",slug:"æ´»è·æ§é®é¢",normalizedTitle:"æ´»è·æ§é®é¢",charIndex:3397},{level:3,title:"æ­»éï¼Deadlockï¼",slug:"æ­»é-deadlock",normalizedTitle:"æ­»éï¼deadlockï¼",charIndex:8765},{level:4,title:"ä»ä¹æ¯æ­»é",slug:"ä»ä¹æ¯æ­»é",normalizedTitle:"ä»ä¹æ¯æ­»é",charIndex:8781},{level:4,title:"é¿åæ­»é",slug:"é¿åæ­»é",normalizedTitle:"é¿åæ­»é",charIndex:8870},{level:3,title:"æ´»éï¼Livelockï¼",slug:"æ´»é-livelock",normalizedTitle:"æ´»éï¼livelockï¼",charIndex:9708},{level:4,title:"ä»ä¹æ¯æ´»é",slug:"ä»ä¹æ¯æ´»é",normalizedTitle:"ä»ä¹æ¯æ´»é",charIndex:9724},{level:4,title:"é¿åæ´»é",slug:"é¿åæ´»é",normalizedTitle:"é¿åæ´»é",charIndex:10017},{level:3,title:"é¥¥é¥¿ï¼Starvationï¼",slug:"é¥¥é¥¿-starvation",normalizedTitle:"é¥¥é¥¿ï¼starvationï¼",charIndex:10142},{level:4,title:"ä»ä¹æ¯é¥¥é¥¿",slug:"ä»ä¹æ¯é¥¥é¥¿",normalizedTitle:"ä»ä¹æ¯é¥¥é¥¿",charIndex:10160},{level:4,title:"è§£å³é¥¥é¥¿",slug:"è§£å³é¥¥é¥¿",normalizedTitle:"è§£å³é¥¥é¥¿",charIndex:10399},{level:2,title:"æ§è½é®é¢",slug:"æ§è½é®é¢",normalizedTitle:"æ§è½é®é¢",charIndex:3406},{level:3,title:"ä¸ä¸æåæ¢",slug:"ä¸ä¸æåæ¢",normalizedTitle:"ä¸ä¸æåæ¢",charIndex:42},{level:4,title:"ä»ä¹æ¯ä¸ä¸æåæ¢ï¼",slug:"ä»ä¹æ¯ä¸ä¸æåæ¢",normalizedTitle:"ä»ä¹æ¯ä¸ä¸æåæ¢ï¼",charIndex:10743},{level:4,title:"åå°ä¸ä¸æåæ¢çæ¹æ³",slug:"åå°ä¸ä¸æåæ¢çæ¹æ³",normalizedTitle:"åå°ä¸ä¸æåæ¢çæ¹æ³",charIndex:10848},{level:3,title:"èµæºéå¶",slug:"èµæºéå¶",normalizedTitle:"èµæºéå¶",charIndex:11110},{level:4,title:"ä»ä¹æ¯èµæºéå¶",slug:"ä»ä¹æ¯èµæºéå¶",normalizedTitle:"ä»ä¹æ¯èµæºéå¶",charIndex:11118},{level:4,title:"èµæºéå¶å¼åçé®é¢",slug:"èµæºéå¶å¼åçé®é¢",normalizedTitle:"èµæºéå¶å¼åçé®é¢",charIndex:11169},{level:4,title:"å¦ä½è§£å³èµæºéå¶çé®é¢",slug:"å¦ä½è§£å³èµæºéå¶çé®é¢",normalizedTitle:"å¦ä½è§£å³èµæºéå¶çé®é¢",charIndex:11294},{level:2,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:11402},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:11509}],headersStr:"å¹¶åæ¦å¿µ å¹¶ååå¹¶è¡ åæ­¥åå¼æ­¥ é»å¡åéé»å¡ è¿ç¨åçº¿ç¨ ç«ææ¡ä»¶åä¸´çåº ç®¡ç¨ å¹¶åçç¹ç¹ æåèµæºå©ç¨ç ç¨åºååºæ´å¿« å¹¶åçé®é¢ å®å¨æ§é®é¢ ç¼å­å¯¼è´çå¯è§æ§é®é¢ çº¿ç¨åæ¢å¸¦æ¥çåå­æ§é®é¢ ç¼è¯ä¼åå¸¦æ¥çæåºæ§é®é¢ ä¿è¯å¹¶åå®å¨çæè·¯ äºæ¥åæ­¥ï¼é»å¡åæ­¥ï¼ éé»å¡åæ­¥ æ åæ­¥ æ´»è·æ§é®é¢ æ­»éï¼Deadlockï¼ ä»ä¹æ¯æ­»é é¿åæ­»é æ´»éï¼Livelockï¼ ä»ä¹æ¯æ´»é é¿åæ´»é é¥¥é¥¿ï¼Starvationï¼ ä»ä¹æ¯é¥¥é¥¿ è§£å³é¥¥é¥¿ æ§è½é®é¢ ä¸ä¸æåæ¢ ä»ä¹æ¯ä¸ä¸æåæ¢ï¼ åå°ä¸ä¸æåæ¢çæ¹æ³ èµæºéå¶ ä»ä¹æ¯èµæºéå¶ èµæºéå¶å¼åçé®é¢ å¦ä½è§£å³èµæºéå¶çé®é¢ å°ç» åèèµæ",content:"# Java å¹¶åç®ä»\n\n> å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n> \n> æè¦ï¼å¹¶åç¼ç¨å¹¶é Java è¯­è¨æç¬æï¼èæ¯ä¸ç§æççç¼ç¨èå¼ï¼Java åªæ¯ç¨èªå·±çæ¹å¼å®ç°äºå¹¶åå·¥ä½æ¨¡åãå­¦ä¹  Java å¹¶åç¼ç¨ï¼åºè¯¥åçæå¹¶åçåºæ¬æ¦å¿µï¼ç¶åè¿ä¸æ­¥äºè§£å¹¶åçç¹æ§ä»¥åå¶ç¹æ§æé¢ä¸´çé®é¢ãææ¡äºè¿äºï¼å½å­¦ä¹  Java å¹¶åå·¥å·æ¶ï¼æä¼æç½å®ä»¬åèªæ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼ä¸ºä»ä¹è¦è¿æ ·è®¾è®¡ãéè¿è¿æ ·ç±ç¹å°é¢çå­¦ä¹ æ¹å¼ï¼æ´å®¹æèä¼è´¯éï¼å°å¹¶åç¥è¯å½¢æä½ç³»åã\n\n\n\n\n# å¹¶åæ¦å¿µ\n\nå¹¶åç¼ç¨ä¸­æå¾å¤æ¯è¯­æ¦å¿µç¸è¿ï¼å®¹æè®©äººæ··æ·ãæ¬èåå®¹éè¿å¯¹æ¯åæï¼åæ±è®©è¯»èæ¸æ°çè§£å¶æ¦å¿µä»¥åå·®å¼ã\n\n\n# å¹¶ååå¹¶è¡\n\nå¹¶ååå¹¶è¡æ¯æå®¹æè®©æ°æè´¹è§£çæ¦å¿µï¼é£ä¹å¦ä½çè§£äºèå¢ï¼å¶æå³é®çå·®å¼å¨äºï¼æ¯å¦æ¯åæ¶åçï¼\n\n * å¹¶åï¼æ¯æå·å¤å¤çå¤ä¸ªä»»å¡çè½åï¼ä½ä¸ä¸å®è¦åæ¶ã\n * å¹¶è¡ï¼æ¯æå·å¤åæ¶å¤çå¤ä¸ªä»»å¡çè½åã\n\nä¸é¢æ¯æè§è¿æçå¨çè¯´æï¼æèª å¹¶åä¸å¹¶è¡çåºå«æ¯ä»ä¹ï¼ââç¥ä¹çé«ç¥¨ç­æ¡ï¼\n\n * ä½ åé¥­åå°ä¸åï¼çµè¯æ¥äºï¼ä½ ä¸ç´å°åå®äºä»¥åæå»æ¥ï¼è¿å°±è¯´æä½ ä¸æ¯æå¹¶åä¹ä¸æ¯æå¹¶è¡ã\n * ä½ åé¥­åå°ä¸åï¼çµè¯æ¥äºï¼ä½ åäºä¸æ¥æ¥äºçµè¯ï¼æ¥å®åç»§ç»­åé¥­ï¼è¿è¯´æä½ æ¯æå¹¶åã\n * ä½ åé¥­åå°ä¸åï¼çµè¯æ¥äºï¼ä½ ä¸è¾¹æçµè¯ä¸è¾¹åé¥­ï¼è¿è¯´æä½ æ¯æå¹¶è¡ã\n\n\n# åæ­¥åå¼æ­¥\n\n * åæ­¥ï¼æ¯æå¨ååºä¸ä¸ªè°ç¨æ¶ï¼å¨æ²¡æå¾å°ç»æä¹åï¼è¯¥è°ç¨å°±ä¸è¿åãä½æ¯ä¸æ¦è°ç¨è¿åï¼å°±å¾å°è¿åå¼äºã\n * å¼æ­¥ï¼åæ¯ç¸åï¼è°ç¨å¨ååºä¹åï¼è¿ä¸ªè°ç¨å°±ç´æ¥è¿åäºï¼æä»¥æ²¡æè¿åç»æãæ¢å¥è¯è¯´ï¼å½ä¸ä¸ªå¼æ­¥è¿ç¨è°ç¨ååºåï¼è°ç¨èä¸ä¼ç«å»å¾å°ç»æãèæ¯å¨è°ç¨ååºåï¼è¢«è°ç¨èéè¿ç¶æãéç¥æ¥éç¥è°ç¨èï¼æéè¿åè°å½æ°å¤çè¿ä¸ªè°ç¨ã\n\nä¸¾ä¾æ¥è¯´æï¼\n\n * åæ­¥å°±åæ¯æçµè¯ï¼ä¸æçµè¯ï¼éè¯ä¸ä¼ç»æã\n * å¼æ­¥å°±åæ¯åç­ä¿¡ï¼åå®ç­ä¿¡åï¼å°±å¯ä»¥åå¶ä»äºï¼å½æ¶å°åå¤ç­ä¿¡æ¶ï¼ææºä¼éè¿éå£°ææ¯å¨æ¥æéã\n\n\n# é»å¡åéé»å¡\n\né»å¡åéé»å¡å³æ³¨çæ¯ç¨åºå¨ç­å¾è°ç¨ç»æï¼æ¶æ¯ï¼è¿åå¼ï¼æ¶çç¶æï¼\n\n * é»å¡ï¼æ¯æè°ç¨ç»æè¿åä¹åï¼å½åçº¿ç¨ä¼è¢«æèµ·ãè°ç¨çº¿ç¨åªæå¨å¾å°ç»æä¹åæä¼è¿åã\n * éé»å¡ï¼æ¯æå¨ä¸è½ç«å»å¾å°ç»æä¹åï¼è¯¥è°ç¨ä¸ä¼é»å¡å½åçº¿ç¨ã\n\nä¸¾ä¾æ¥è¯´æï¼\n\n * é»å¡è°ç¨å°±åæ¯æçµè¯ï¼éè¯ä¸ç»æï¼ä¸è½æ¾ä¸ã\n * éé»å¡è°ç¨å°±åæ¯åç­ä¿¡ï¼åå®ç­ä¿¡åï¼å°±å¯ä»¥åå¶ä»äºï¼ç­ä¿¡æ¥äºï¼ææºä¼æéã\n\n\n# è¿ç¨åçº¿ç¨\n\n * è¿ç¨ï¼è¿ç¨æ¯å·æä¸å®ç¬ç«åè½çç¨åºå³äºæä¸ªæ°æ®éåä¸çä¸æ¬¡è¿è¡æ´»å¨ãè¿ç¨æ¯æä½ç³»ç»è¿è¡èµæºåéçåºæ¬åä½ãè¿ç¨å¯è§ä¸ºä¸ä¸ªæ­£å¨è¿è¡çç¨åºã\n * çº¿ç¨ï¼çº¿ç¨æ¯æä½ç³»ç»è¿è¡è°åº¦çåºæ¬åä½ã\n\nè¿ç¨åçº¿ç¨çå·®å¼ï¼\n\n * ä¸ä¸ªç¨åºè³å°æä¸ä¸ªè¿ç¨ï¼ä¸ä¸ªè¿ç¨è³å°æä¸ä¸ªçº¿ç¨ã\n * çº¿ç¨æ¯è¿ç¨ååæ´ç»ï¼æä»¥æ§è¡å¼éæ´å°ï¼å¹¶åæ§æ´é«\n * è¿ç¨æ¯ä¸ä¸ªå®ä½ï¼æ¥æç¬ç«çèµæºï¼èåä¸ä¸ªè¿ç¨ä¸­çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çèµæºã\n\n\n\nJVM å¨åä¸ªè¿ç¨ä¸­è¿è¡ï¼JVM ä¸­ççº¿ç¨å±äº«å±äºè¯¥è¿ç¨çå ãè¿å°±æ¯ä¸ºä»ä¹å ä¸ªçº¿ç¨å¯ä»¥è®¿é®åä¸ä¸ªå¯¹è±¡ãçº¿ç¨å±äº«å å¹¶æ¥æèªå·±çå æ ç©ºé´ãè¿æ¯ä¸ä¸ªçº¿ç¨å¦ä½è°ç¨ä¸ä¸ªæ¹æ³ä»¥åå®çå±é¨åéæ¯å¦ä½ä¿æçº¿ç¨å®å¨çãä½æ¯å ä¸æ¯çº¿ç¨å®å¨çå¹¶ä¸ä¸ºäºçº¿ç¨å®å¨å¿é¡»è¿è¡åæ­¥ã\n\n\n# ç«ææ¡ä»¶åä¸´çåº\n\n * ç«ææ¡ä»¶ï¼Race Conditionï¼ï¼å½ä¸¤ä¸ªçº¿ç¨ç«äºåä¸èµæºæ¶ï¼å¦æå¯¹èµæºçè®¿é®é¡ºåºææï¼å°±ç§°å­å¨ç«ææ¡ä»¶ã\n\n * ä¸´çåºï¼Critical Sectionsï¼ï¼å¯¼è´ç«ææ¡ä»¶åççä»£ç åºç§°ä½ä¸´çåºã\n\n\n# ç®¡ç¨\n\nç®¡ç¨ï¼Monitorï¼ï¼æ¯æç®¡çå±äº«åéä»¥åå¯¹å±äº«åéçæä½è¿ç¨ï¼è®©ä»ä»¬æ¯æå¹¶åã\n\nJava éç¨çæ¯ç®¡ç¨ææ¯ï¼synchronized å³é®å­å wait()ãnotify()ãnotifyAll() è¿ä¸ä¸ªæ¹æ³é½æ¯ç®¡ç¨çç»æé¨åãèç®¡ç¨åä¿¡å·éæ¯ç­ä»·çï¼æè°ç­ä»·æçæ¯ç¨ç®¡ç¨è½å¤å®ç°ä¿¡å·éï¼ä¹è½ç¨ä¿¡å·éå®ç°ç®¡ç¨ã\n\n\n# å¹¶åçç¹ç¹\n\nææ¯å¨è¿æ­¥ï¼CPUãåå­ãI/O è®¾å¤çæ§è½ä¹å¨ä¸æ­æé«ãä½æ¯ï¼å§ç»å­å¨ä¸ä¸ªæ ¸å¿çç¾ï¼CPUãåå­ãI/O è®¾å¤å­å¨éåº¦å·®å¼ãCPU è¿å¿«äºåå­ï¼åå­è¿å¿«äº I/O è®¾å¤ã\n\næ¨æ¡¶ç­æ¿çè®ºåè¯æä»¬ï¼ä¸åªæ¨æ¡¶è½è£å¤å°æ°´ï¼åå³äºæç­çé£åæ¨æ¿ãåçï¼ç¨åºæ´ä½æ§è½åå³äºææ¢çæä½ï¼å³ I/O æä½ï¼ï¼æä»¥åæ¹é¢æé« CPUãåå­çæ§è½æ¯æ æçã\n\n\n\nä¸ºäºåçå©ç¨ CPU çé«æ§è½ï¼å¹³è¡¡è¿ä¸èçéåº¦å·®å¼ï¼è®¡ç®æºä½ç³»æºæãæä½ç³»ç»ãç¼è¯ç¨åºé½ååºäºè´¡ç®ï¼ä¸»è¦ä½ç°ä¸ºï¼\n\n * CPU å¢å äºç¼å­ï¼ä»¥åè¡¡ä¸åå­çéåº¦å·®å¼ï¼\n * æä½ç³»ç»å¢å äºè¿ç¨ãçº¿ç¨ï¼ä»¥åæ¶å¤ç¨ CPUï¼è¿èåè¡¡ CPU ä¸ I/O è®¾å¤çéåº¦å·®å¼ï¼\n * ç¼è¯ç¨åºä¼åæä»¤æ§è¡æ¬¡åºï¼ä½¿å¾ç¼å­è½å¤å¾å°æ´å åçå°å©ç¨ã\n\nå¶ä¸­ï¼è¿ç¨ãçº¿ç¨ä½¿å¾è®¡ç®æºãç¨åºæäºå¹¶åå¤çä»»å¡çè½åã\n\nå¹¶åçä¼ç¹å¨äºï¼\n\n * æåèµæºå©ç¨ç\n * ç¨åºååºæ´å¿«\n\n\n# æåèµæºå©ç¨ç\n\næ³è±¡ä¸ä¸ï¼ä¸ä¸ªåºç¨ç¨åºéè¦ä»æ¬å°æä»¶ç³»ç»ä¸­è¯»ååå¤çæä»¶çææ¯ãæ¯æ¹è¯´ï¼ä»ç£çè¯»åä¸ä¸ªæä»¶éè¦ 5 ç§ï¼å¤çä¸ä¸ªæä»¶éè¦ 2 ç§ãå¤çä¸¤ä¸ªæä»¶åéè¦ï¼\n\n5ç§è¯»åæä»¶A\n2ç§å¤çæä»¶A\n5ç§è¯»åæä»¶B\n2ç§å¤çæä»¶B\n---------------------\næ»å±éè¦14ç§\n\n\nä»ç£çä¸­è¯»åæä»¶çæ¶åï¼å¤§é¨åç CPU æ¶é´ç¨äºç­å¾ç£çå»è¯»åæ°æ®ãå¨è¿æ®µæ¶é´éï¼CPU éå¸¸çç©ºé²ãå®å¯ä»¥åä¸äºå«çäºæãéè¿æ¹åæä½çé¡ºåºï¼å°±è½å¤æ´å¥½çä½¿ç¨ CPU èµæºãçä¸é¢çé¡ºåºï¼\n\n5ç§è¯»åæä»¶A\n5ç§è¯»åæä»¶B + 2ç§å¤çæä»¶A\n2ç§å¤çæä»¶B\n---------------------\næ»å±éè¦12ç§\n\n\nCPU ç­å¾ç¬¬ä¸ä¸ªæä»¶è¢«è¯»åå®ãç¶åå¼å§è¯»åç¬¬äºä¸ªæä»¶ãå½ç¬¬äºæä»¶å¨è¢«è¯»åçæ¶åï¼CPU ä¼å»å¤çç¬¬ä¸ä¸ªæä»¶ãè®°ä½ï¼å¨ç­å¾ç£çè¯»åæä»¶çæ¶åï¼CPU å¤§ é¨åæ¶é´æ¯ç©ºé²çã\n\næ»çè¯´æ¥ï¼CPU è½å¤å¨ç­å¾ IO çæ¶ååä¸äºå¶ä»çäºæãè¿ä¸ªä¸ä¸å®å°±æ¯ç£ç IOãå®ä¹å¯ä»¥æ¯ç½ç»ç IOï¼æèç¨æ·è¾å¥ãéå¸¸æåµä¸ï¼ç½ç»åç£çç IO æ¯ CPU ååå­ç IO æ¢çå¤ã\n\n\n# ç¨åºååºæ´å¿«\n\nå°ä¸ä¸ªåçº¿ç¨åºç¨ç¨åºåæå¤çº¿ç¨åºç¨ç¨åºçå¦ä¸ä¸ªå¸¸è§çç®çæ¯å®ç°ä¸ä¸ªååºæ´å¿«çåºç¨ç¨åºãè®¾æ³ä¸ä¸ªæå¡å¨åºç¨ï¼å®å¨æä¸ä¸ªç«¯å£çå¬è¿æ¥çè¯·æ±ãå½ä¸ä¸ªè¯·æ±å°æ¥æ¶ï¼å®å»å¤çè¿ä¸ªè¯·æ±ï¼ç¶ååè¿åå»çå¬ã\n\næå¡å¨çæµç¨å¦ä¸æè¿°ï¼\n\nwhile(server is active) {\n    listen for request\n    process request\n}\n\n\nå¦æä¸ä¸ªè¯·æ±éè¦å ç¨å¤§éçæ¶é´æ¥å¤çï¼å¨è¿æ®µæ¶é´åæ°çå®¢æ·ç«¯å°±æ æ³åéè¯·æ±ç»æå¡ç«¯ãåªææå¡å¨å¨çå¬çæ¶åï¼è¯·æ±æè½è¢«æ¥æ¶ãå¦ä¸ç§è®¾è®¡æ¯ï¼çå¬çº¿ç¨æè¯·æ±ä¼ éç»å·¥ä½èçº¿ç¨(worker thread)ï¼ç¶åç«å»è¿åå»çå¬ãèå·¥ä½èçº¿ç¨åè½å¤å¤çè¿ä¸ªè¯·æ±å¹¶åéä¸ä¸ªåå¤ç»å®¢æ·ç«¯ãè¿ç§è®¾è®¡å¦ä¸æè¿°ï¼\n\nwhile(server is active) {\n    listen for request\n    hand request to worker thread\n}\n\n\nè¿ç§æ¹å¼ï¼æå¡ç«¯çº¿ç¨è¿éå°è¿åå»çå¬ãå æ­¤ï¼æ´å¤çå®¢æ·ç«¯è½å¤åéè¯·æ±ç»æå¡ç«¯ãè¿ä¸ªæå¡ä¹åå¾ååºæ´å¿«ã\n\næ¡é¢åºç¨ä¹æ¯åæ ·å¦æ­¤ãå¦æä½ ç¹å»ä¸ä¸ªæé®å¼å§è¿è¡ä¸ä¸ªèæ¶çä»»å¡ï¼è¿ä¸ªçº¿ç¨æ¢è¦æ§è¡ä»»å¡åè¦æ´æ°çªå£åæé®ï¼é£ä¹å¨ä»»å¡æ§è¡çè¿ç¨ä¸­ï¼è¿ä¸ªåºç¨ç¨åºçèµ·æ¥å¥½åæ²¡æååºä¸æ ·ãç¸åï¼ä»»å¡å¯ä»¥ä¼ éç»å·¥ä½èçº¿ç¨ï¼worker thread)ãå½å·¥ä½èçº¿ç¨å¨ç¹å¿å°å¤çä»»å¡çæ¶åï¼çªå£çº¿ç¨å¯ä»¥èªç±å°ååºå¶ä»ç¨æ·çè¯·æ±ãå½å·¥ä½èçº¿ç¨å®æä»»å¡çæ¶åï¼å®åéä¿¡å·ç»çªå£çº¿ç¨ãçªå£çº¿ç¨ä¾¿å¯ä»¥æ´æ°åºç¨ç¨åºçªå£ï¼å¹¶æ¾ç¤ºä»»å¡çç»æãå¯¹ç¨æ·èè¨ï¼è¿ç§å·æå·¥ä½èçº¿ç¨è®¾è®¡çç¨åºæ¾å¾ååºéåº¦æ´å¿«ã\n\n\n# å¹¶åçé®é¢\n\nä»»ä½äºç©é½æå©å¼ï¼å¹¶åä¹ä¸ä¾å¤ã\n\næä»¬ç¥éäºå¹¶åå¸¦æ¥çå¥½å¤ï¼æåèµæºå©ç¨çãç¨åºååºæ´å¿«ï¼åæ¶ä¹è¦è®¤è¯å°å¹¶åå¸¦æ¥çé®é¢ï¼ä¸»è¦æï¼\n\n * å®å¨æ§é®é¢\n * æ´»è·æ§é®é¢\n * æ§è½é®é¢\n\nä¸é¢ä¼ä¸ä¸è®²è§£ã\n\n\n# å®å¨æ§é®é¢\n\nå¹¶åæéè¦çé®é¢æ¯å¹¶åå®å¨é®é¢ã\n\nå¹¶åå®å¨ï¼æ¯æä¿è¯ç¨åºçæ­£ç¡®æ§ï¼ä½¿å¾å¹¶åå¤çç»æç¬¦åé¢æã\n\nå¹¶åå®å¨éè¦ä¿è¯å ä¸ªåºæ¬ç¹æ§ï¼\n\n * å¯è§æ§ - æ¯ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªå±äº«åéï¼å¶ç¶æè½å¤ç«å³è¢«å¶ä»çº¿ç¨ç¥æï¼éå¸¸è¢«è§£éä¸ºå°çº¿ç¨æ¬å°ç¶æåæ å°ä¸»åå­ä¸ï¼volatile å°±æ¯è´è´£ä¿è¯å¯è§æ§çã\n * åå­æ§ - ç®åè¯´å°±æ¯ç¸å³æä½ä¸ä¼ä¸­éè¢«å¶ä»çº¿ç¨å¹²æ°ï¼ä¸è¬éè¿åæ­¥æºå¶ï¼å éï¼sychronizedãLockï¼å®ç°ã\n * æåºæ§ - æ¯ä¿è¯çº¿ç¨åä¸²è¡è¯­ä¹ï¼é¿åæä»¤éæç­ã\n\n\n# ç¼å­å¯¼è´çå¯è§æ§é®é¢\n\n> ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçä¿®æ¹ï¼å¦å¤ä¸ä¸ªçº¿ç¨è½å¤ç«å»çå°ï¼ç§°ä¸º å¯è§æ§ã\n\nå¨åæ ¸æ¶ä»£ï¼ææççº¿ç¨é½æ¯å¨ä¸é¢ CPU ä¸æ§è¡ï¼CPU ç¼å­ä¸åå­çæ°æ®ä¸è´æ§å®¹æè§£å³ãå ä¸ºææçº¿ç¨é½æ¯æä½åä¸ä¸ª CPU çç¼å­ï¼ä¸ä¸ªçº¿ç¨å¯¹ç¼å­çåï¼å¯¹å¦å¤ä¸ä¸ªçº¿ç¨æ¥è¯´ä¸å®æ¯å¯è§çãä¾å¦å¨ä¸é¢çå¾ä¸­ï¼çº¿ç¨ A åçº¿ç¨ B é½æ¯æä½åä¸ä¸ª CPU éé¢çç¼å­ï¼æä»¥çº¿ç¨ A æ´æ°äºåé V çå¼ï¼é£ä¹çº¿ç¨ B ä¹ååè®¿é®åé Vï¼å¾å°çä¸å®æ¯ V çææ°å¼ï¼çº¿ç¨ A åè¿çå¼ï¼ã\n\n\n\nå¤æ ¸æ¶ä»£ï¼æ¯é¢ CPU é½æèªå·±çç¼å­ï¼è¿æ¶ CPU ç¼å­ä¸åå­çæ°æ®ä¸è´æ§å°±æ²¡é£ä¹å®¹æè§£å³äºï¼å½å¤ä¸ªçº¿ç¨å¨ä¸åç CPU ä¸æ§è¡æ¶ï¼è¿äºçº¿ç¨æä½çæ¯ä¸åç CPU ç¼å­ãæ¯å¦ä¸å¾ä¸­ï¼çº¿ç¨ A æä½çæ¯ CPU-1 ä¸çç¼å­ï¼èçº¿ç¨ B æä½çæ¯ CPU-2 ä¸çç¼å­ï¼å¾ææ¾ï¼è¿ä¸ªæ¶åçº¿ç¨ A å¯¹åé V çæä½å¯¹äºçº¿ç¨ B èè¨å°±ä¸å·å¤å¯è§æ§äºã\n\n\n\nãç¤ºä¾ãçº¿ç¨ä¸å®å¨çç¤ºä¾\n\nä¸é¢æä»¬åç¨ä¸æ®µä»£ç æ¥éªè¯ä¸ä¸å¤æ ¸åºæ¯ä¸çå¯è§æ§é®é¢ãä¸é¢çä»£ç ï¼æ¯æ§è¡ä¸æ¬¡ add10K() æ¹æ³ï¼é½ä¼å¾ªç¯ 10000 æ¬¡ count+=1 æä½ãå¨ calc() æ¹æ³ä¸­æä»¬åå»ºäºä¸¤ä¸ªçº¿ç¨ï¼æ¯ä¸ªçº¿ç¨è°ç¨ä¸æ¬¡ add10K() æ¹æ³ï¼æä»¬æ¥æ³ä¸æ³æ§è¡ calc() æ¹æ³å¾å°çç»æåºè¯¥æ¯å¤å°å¢ï¼\n\npublic class Test {\n  private long count = 0;\n  private void add10K() {\n    int idx = 0;\n    while(idx++ < 10000) {\n      count += 1;\n    }\n  }\n  public static long calc() {\n    final Test test = new Test();\n    // åå»ºä¸¤ä¸ªçº¿ç¨ï¼æ§è¡ add() æä½\n    Thread th1 = new Thread(()->{\n      test.add10K();\n    });\n    Thread th2 = new Thread(()->{\n      test.add10K();\n    });\n    // å¯å¨ä¸¤ä¸ªçº¿ç¨\n    th1.start();\n    th2.start();\n    // ç­å¾ä¸¤ä¸ªçº¿ç¨æ§è¡ç»æ\n    th1.join();\n    th2.join();\n    return count;\n  }\n}\n\n\nç´è§åè¯æä»¬åºè¯¥æ¯ 20000ï¼å ä¸ºå¨åçº¿ç¨éè°ç¨ä¸¤æ¬¡ add10K() æ¹æ³ï¼count çå¼å°±æ¯ 20000ï¼ä½å®éä¸ calc() çæ§è¡ç»ææ¯ä¸ª 10000 å° 20000 ä¹é´çéæºæ°ãä¸ºä»ä¹å¢ï¼\n\næä»¬åè®¾çº¿ç¨ A åçº¿ç¨ B åæ¶å¼å§æ§è¡ï¼é£ä¹ç¬¬ä¸æ¬¡é½ä¼å° count=0 è¯»å°åèªç CPU ç¼å­éï¼æ§è¡å® count+=1 ä¹åï¼åèª CPU ç¼å­éçå¼é½æ¯ 1ï¼åæ¶åå¥åå­åï¼æä»¬ä¼åç°åå­ä¸­æ¯ 1ï¼èä¸æ¯æä»¬ææç 2ãä¹åç±äºåèªç CPU ç¼å­éé½æäº count çå¼ï¼ä¸¤ä¸ªçº¿ç¨é½æ¯åºäº CPU ç¼å­éç count å¼æ¥è®¡ç®ï¼æä»¥å¯¼è´æç» count çå¼é½æ¯å°äº 20000 çãè¿å°±æ¯ç¼å­çå¯è§æ§é®é¢ã\n\nå¾ªç¯ 10000 æ¬¡ count+=1 æä½å¦ææ¹ä¸ºå¾ªç¯ 1 äº¿æ¬¡ï¼ä½ ä¼åç°æææ´ææ¾ï¼æç» count çå¼æ¥è¿ 1 äº¿ï¼èä¸æ¯ 2 äº¿ãå¦æå¾ªç¯ 10000 æ¬¡ï¼count çå¼æ¥è¿ 20000ï¼åå æ¯ä¸¤ä¸ªçº¿ç¨ä¸æ¯åæ¶å¯å¨çï¼æä¸ä¸ªæ¶å·®ã\n\n\n\n\n# çº¿ç¨åæ¢å¸¦æ¥çåå­æ§é®é¢\n\nç±äº IO å¤ªæ¢ï¼æ©æçæä½ç³»ç»å°±åæäºå¤è¿ç¨ï¼æä½ç³»ç»åè®¸æä¸ªè¿ç¨æ§è¡ä¸å°æ®µæ¶é´ï¼ç§°ä¸º æ¶é´çï¼ã\n\nå¨ä¸ä¸ªæ¶é´çåï¼å¦æä¸ä¸ªè¿ç¨è¿è¡ä¸ä¸ª IO æä½ï¼ä¾å¦è¯»ä¸ªæä»¶ï¼è¿ä¸ªæ¶åè¯¥è¿ç¨å¯ä»¥æèªå·±æ è®°ä¸ºâä¼ç ç¶æâå¹¶åºè®© CPU çä½¿ç¨æï¼å¾æä»¶è¯»è¿åå­ï¼æä½ç³»ç»ä¼æè¿ä¸ªä¼ç çè¿ç¨å¤éï¼å¤éåçè¿ç¨å°±ææºä¼éæ°è·å¾ CPU çä½¿ç¨æäºã\n\nè¿éçè¿ç¨å¨ç­å¾ IO æ¶ä¹æä»¥ä¼éæ¾ CPU ä½¿ç¨æï¼æ¯ä¸ºäºè®© CPU å¨è¿æ®µç­å¾æ¶é´éå¯ä»¥åå«çäºæï¼è¿æ ·ä¸æ¥ CPU çä½¿ç¨çå°±ä¸æ¥äºï¼æ­¤å¤ï¼å¦æè¿æ¶æå¦å¤ä¸ä¸ªè¿ç¨ä¹è¯»æä»¶ï¼è¯»æä»¶çæä½å°±ä¼æéï¼ç£çé©±å¨å¨å®æä¸ä¸ªè¿ç¨çè¯»æä½åï¼åç°ææéçä»»å¡ï¼å°±ä¼ç«å³å¯å¨ä¸ä¸ä¸ªè¯»æä½ï¼è¿æ · IO çä½¿ç¨çä¹ä¸æ¥äºã\n\næ©æçæä½ç³»ç»åºäºè¿ç¨æ¥è°åº¦ CPUï¼ä¸åè¿ç¨é´æ¯ä¸å±äº«åå­ç©ºé´çï¼æä»¥è¿ç¨è¦åä»»å¡åæ¢å°±è¦åæ¢åå­æ å°å°åï¼èä¸ä¸ªè¿ç¨åå»ºçææçº¿ç¨ï¼é½æ¯å±äº«ä¸ä¸ªåå­ç©ºé´çï¼æä»¥çº¿ç¨åä»»å¡åæ¢ææ¬å°±å¾ä½äºãç°ä»£çæä½ç³»ç»é½åºäºæ´è½»éççº¿ç¨æ¥è°åº¦ï¼ç°å¨æä»¬æå°çâä»»å¡åæ¢âé½æ¯æâçº¿ç¨åæ¢âã\n\nJava å¹¶åç¨åºé½æ¯åºäºå¤çº¿ç¨çï¼èªç¶ä¹ä¼æ¶åå°ä»»å¡åæ¢ï¼ä¹è®¸ä½ æ³ä¸å°ï¼ä»»å¡åæ¢ç«ç¶ä¹æ¯å¹¶åç¼ç¨éè¯¡å¼ Bug çæºå¤´ä¹ä¸ãä»»å¡åæ¢çæ¶æºå¤§å¤æ°æ¯å¨æ¶é´çç»æçæ¶åï¼æä»¬ç°å¨åºæ¬é½ä½¿ç¨é«çº§è¯­è¨ç¼ç¨ï¼é«çº§è¯­è¨éä¸æ¡è¯­å¥å¾å¾éè¦å¤æ¡ CPU æä»¤å®æï¼ä¾å¦ä¸é¢ä»£ç ä¸­ç count += 1ï¼è³å°éè¦ä¸æ¡ CPU æä»¤ã\n\n * æä»¤ 1ï¼é¦åï¼éè¦æåé count ä»åå­å è½½å° CPU çå¯å­å¨ï¼\n * æä»¤ 2ï¼ä¹åï¼å¨å¯å­å¨ä¸­æ§è¡ +1 æä½ï¼\n * æä»¤ 3ï¼æåï¼å°ç»æåå¥åå­ï¼ç¼å­æºå¶å¯¼è´å¯è½åå¥çæ¯ CPU ç¼å­èä¸æ¯åå­ï¼ã\n\næä½ç³»ç»åä»»å¡åæ¢ï¼å¯ä»¥åçå¨ä»»ä½ä¸æ¡CPU æä»¤æ§è¡å®ï¼æ¯çï¼æ¯ CPU æä»¤ï¼èä¸æ¯é«çº§è¯­è¨éçä¸æ¡è¯­å¥ãå¯¹äºä¸é¢çä¸æ¡æä»¤æ¥è¯´ï¼æä»¬åè®¾ count=0ï¼å¦æçº¿ç¨ A å¨æä»¤ 1 æ§è¡å®ååçº¿ç¨åæ¢ï¼çº¿ç¨ A åçº¿ç¨ B æç§ä¸å¾çåºåæ§è¡ï¼é£ä¹æä»¬ä¼åç°ä¸¤ä¸ªçº¿ç¨é½æ§è¡äº count+=1 çæä½ï¼ä½æ¯å¾å°çç»æä¸æ¯æä»¬ææç 2ï¼èæ¯ 1ã\n\n\n\næä»¬æ½æè¯éé¢è§å¾ count+=1 è¿ä¸ªæä½æ¯ä¸ä¸ªä¸å¯åå²çæ´ä½ï¼å°±åä¸ä¸ªåå­ä¸æ ·ï¼çº¿ç¨çåæ¢å¯ä»¥åçå¨ count+=1 ä¹åï¼ä¹å¯ä»¥åçå¨ count+=1 ä¹åï¼ä½å°±æ¯ä¸ä¼åçå¨ä¸­é´ãæä»¬æä¸ä¸ªæèå¤ä¸ªæä½å¨ CPU æ§è¡çè¿ç¨ä¸­ä¸è¢«ä¸­æ­çç¹æ§ç§°ä¸ºåå­æ§ãCPU è½ä¿è¯çåå­æä½æ¯ CPU æä»¤çº§å«çï¼èä¸æ¯é«çº§è¯­è¨çæä½ç¬¦ï¼è¿æ¯è¿èæä»¬ç´è§çå°æ¹ãå æ­¤ï¼å¾å¤æ¶åæä»¬éè¦å¨é«çº§è¯­è¨å±é¢ä¿è¯æä½çåå­æ§ã\n\n\n# ç¼è¯ä¼åå¸¦æ¥çæåºæ§é®é¢\n\né£å¹¶åç¼ç¨éè¿ææ²¡æå¶ä»æè¿ç´è§å®¹æå¯¼è´è¯¡å¼ Bug çææ¯å¢ï¼æçï¼å°±æ¯æåºæ§ãé¡¾åæä¹ï¼æåºæ§æçæ¯ç¨åºæç§ä»£ç çååé¡ºåºæ§è¡ãç¼è¯å¨ä¸ºäºä¼åæ§è½ï¼ææ¶åä¼æ¹åç¨åºä¸­è¯­å¥çååé¡ºåºï¼ä¾å¦ç¨åºä¸­ï¼âa=6ï¼b=7ï¼âç¼è¯å¨ä¼ååå¯è½åæâb=7ï¼a=6ï¼âï¼å¨è¿ä¸ªä¾å­ä¸­ï¼ç¼è¯å¨è°æ´äºè¯­å¥çé¡ºåºï¼ä½æ¯ä¸å½±åç¨åºçæç»ç»æãä¸è¿ææ¶åç¼è¯å¨åè§£éå¨çä¼åå¯è½å¯¼è´ææ³ä¸å°ç Bugã\n\nå¨ Java é¢åä¸ä¸ªç»å¸çæ¡ä¾å°±æ¯å©ç¨åéæ£æ¥åå»ºåä¾å¯¹è±¡ï¼ä¾å¦ä¸é¢çä»£ç ï¼å¨è·åå®ä¾ getInstance() çæ¹æ³ä¸­ï¼æä»¬é¦åå¤æ­ instance æ¯å¦ä¸ºç©ºï¼å¦æä¸ºç©ºï¼åéå® Singleton.class å¹¶åæ¬¡æ£æ¥ instance æ¯å¦ä¸ºç©ºï¼å¦æè¿ä¸ºç©ºååå»º Singleton çä¸ä¸ªå®ä¾ã\n\npublic class Singleton {\n  static Singleton instance;\n  static Singleton getInstance(){\n    if (instance == null) {\n      synchronized(Singleton.class) {\n        if (instance == null)\n          instance = new Singleton();\n        }\n    }\n    return instance;\n  }\n}\n\n\nåè®¾æä¸¤ä¸ªçº¿ç¨ AãB åæ¶è°ç¨ getInstance() æ¹æ³ï¼ä»ä»¬ä¼åæ¶åç° instance == null ï¼äºæ¯åæ¶å¯¹ Singleton.class å éï¼æ­¤æ¶ JVM ä¿è¯åªæä¸ä¸ªçº¿ç¨è½å¤å éæåï¼åè®¾æ¯çº¿ç¨ Aï¼ï¼å¦å¤ä¸ä¸ªçº¿ç¨åä¼å¤äºç­å¾ç¶æï¼åè®¾æ¯çº¿ç¨ Bï¼ï¼çº¿ç¨ A ä¼åå»ºä¸ä¸ª Singleton å®ä¾ï¼ä¹åéæ¾éï¼ééæ¾åï¼çº¿ç¨ B è¢«å¤éï¼çº¿ç¨ B åæ¬¡å°è¯å éï¼æ­¤æ¶æ¯å¯ä»¥å éæåçï¼å éæååï¼çº¿ç¨ B æ£æ¥ instance == null æ¶ä¼åç°ï¼å·²ç»åå»ºè¿ Singleton å®ä¾äºï¼æä»¥çº¿ç¨ B ä¸ä¼ååå»ºä¸ä¸ª Singleton å®ä¾ã\n\nè¿çä¸å»ä¸åé½å¾å®ç¾ï¼æ æå¯å»ï¼ä½å®éä¸è¿ä¸ª getInstance() æ¹æ³å¹¶ä¸å®ç¾ãé®é¢åºå¨åªéå¢ï¼åºå¨ new æä½ä¸ï¼æä»¬ä»¥ä¸ºç new æä½åºè¯¥æ¯ï¼\n\n 1. åéä¸ååå­ Mï¼\n 2. å¨åå­ M ä¸åå§å Singleton å¯¹è±¡ï¼\n 3. ç¶å M çå°åèµå¼ç» instance åéã\n\nä½æ¯å®éä¸ä¼ååçæ§è¡è·¯å¾å´æ¯è¿æ ·çï¼\n\n 1. åéä¸ååå­ Mï¼\n 2. å° M çå°åèµå¼ç» instance åéï¼\n 3. æåå¨åå­ M ä¸åå§å Singleton å¯¹è±¡ã\n\nä¼ååä¼å¯¼è´ä»ä¹é®é¢å¢ï¼æä»¬åè®¾çº¿ç¨ A åæ§è¡ getInstance() æ¹æ³ï¼å½æ§è¡å®æä»¤ 2 æ¶æ°å¥½åçäºçº¿ç¨åæ¢ï¼åæ¢å°äºçº¿ç¨ B ä¸ï¼å¦ææ­¤æ¶çº¿ç¨ B ä¹æ§è¡ getInstance() æ¹æ³ï¼é£ä¹çº¿ç¨ B å¨æ§è¡ç¬¬ä¸ä¸ªå¤æ­æ¶ä¼åç° instance != null ï¼æä»¥ç´æ¥è¿å instanceï¼èæ­¤æ¶ç instance æ¯æ²¡æåå§åè¿çï¼å¦ææä»¬è¿ä¸ªæ¶åè®¿é® instance çæååéå°±å¯è½è§¦åç©ºæéå¼å¸¸ã\n\n\n\n\n# ä¿è¯å¹¶åå®å¨çæè·¯\n\n# äºæ¥åæ­¥ï¼é»å¡åæ­¥ï¼\n\näºæ¥åæ­¥æ¯æå¸¸è§çå¹¶åæ­£ç¡®æ§ä¿éææ®µã\n\nåæ­¥æ¯æå¨å¤çº¿ç¨å¹¶åè®¿é®å±äº«æ°æ®æ¶ï¼ä¿è¯å±äº«æ°æ®å¨åä¸æ¶å»åªè½è¢«ä¸ä¸ªçº¿ç¨è®¿é®ã\n\näºæ¥æ¯å®ç°åæ­¥çä¸ç§ææ®µãä¸´çåºï¼Critical Sectionsï¼ãäºæ¥éï¼Mutexï¼åä¿¡å·éï¼Semaphoreï¼é½æ¯ä¸»è¦çäºæ¥å®ç°æ¹å¼ã\n\næå¸åçæ¡ä¾æ¯ä½¿ç¨ synchronized æ Lock ã\n\näºæ¥åæ­¥æä¸»è¦çé®é¢æ¯çº¿ç¨é»å¡åå¤éæå¸¦æ¥çæ§è½é®é¢ï¼äºæ¥åæ­¥å±äºä¸ç§æ²è§çå¹¶åç­ç¥ï¼æ»æ¯è®¤ä¸ºåªè¦ä¸å»åæ­£ç¡®çåæ­¥æªæ½ï¼é£å°±è¯å®ä¼åºç°é®é¢ãæ è®ºå±äº«æ°æ®æ¯å¦ççä¼åºç°ç«äºï¼å®é½è¦è¿è¡å éï¼è¿éè®¨è®ºçæ¯æ¦å¿µæ¨¡åï¼å®éä¸èææºä¼ä¼åæå¾å¤§ä¸é¨åä¸å¿è¦çå éï¼ãç¨æ·ææ ¸å¿æè½¬æ¢ãç»´æ¤éè®¡æ°å¨åæ£æ¥æ¯å¦æè¢«é»å¡ççº¿ç¨éè¦å¤éç­æä½ã\n\n# éé»å¡åæ­¥\n\néçç¡¬ä»¶æä»¤éçåå±ï¼æä»¬å¯ä»¥ä½¿ç¨åºäºå²çªæ£æµçä¹è§å¹¶åç­ç¥ï¼åè¿è¡æä½ï¼å¦ææ²¡æå¶å®çº¿ç¨äºç¨å±äº«æ°æ®ï¼é£æä½å°±æåäºï¼å¦åéåè¡¥å¿æªæ½ï¼ä¸æ­å°éè¯ï¼ç´å°æåä¸ºæ­¢ï¼ãè¿ç§ä¹è§çå¹¶åç­ç¥çè®¸å¤å®ç°é½ä¸éè¦å°çº¿ç¨é»å¡ï¼å æ­¤è¿ç§åæ­¥æä½ç§°ä¸ºéé»å¡åæ­¥ã\n\nä¸ºä»ä¹è¯´ä¹è§ééè¦ ç¡¬ä»¶æä»¤éçåå± æè½è¿è¡ï¼å ä¸ºéè¦æä½åå²çªæ£æµè¿ä¸¤ä¸ªæ­¥éª¤å·å¤åå­æ§ãèè¿ç¹æ¯ç±ç¡¬ä»¶æ¥å®æï¼å¦æåä½¿ç¨äºæ¥åæ­¥æ¥ä¿è¯å°±å¤±å»æä¹äºã\n\nè¿ç±»ä¹è§éæä»¤å¸¸è§çæï¼\n\n * æµè¯å¹¶è®¾ç½®ï¼Test-and-Setï¼\n * è·åå¹¶å¢å ï¼Fetch-and-Incrementï¼\n * äº¤æ¢ï¼Swapï¼\n * æ¯è¾å¹¶äº¤æ¢ï¼CASï¼\n * å è½½é¾æ¥ãæ¡ä»¶å­å¨ï¼Load-linked / Store-Conditionalï¼\n\nJava å¸ååºç¨åºæ¯ï¼J.U.C åä¸­çåå­ç±»ï¼åºäº Unsafe ç±»ç CAS æä½ï¼\n\n# æ åæ­¥\n\nè¦ä¿è¯çº¿ç¨å®å¨ï¼ä¸ä¸å®éè¦è¿è¡åæ­¥ãåæ­¥åªæ¯ä¿è¯å±äº«æ°æ®äºç¨æ¶çæ­£ç¡®æ§ï¼å¦æä¸ä¸ªæ¹æ³æ¬æ¥å°±ä¸æ¶åå±äº«æ°æ®ï¼é£ä¹èªç¶æ é¡»åæ­¥ã\n\nJava ä¸­ç æ åæ­¥æ¹æ¡ æï¼\n\n * å¯éå¥ä»£ç  - ä¹å«çº¯ä»£ç ãå¦æä¸ä¸ªæ¹æ³ï¼å®ç è¿åç»ææ¯å¯ä»¥é¢æµçï¼å³åªè¦è¾å¥äºç¸åçæ°æ®ï¼å°±è½è¿åç¸åçç»æï¼é£å®å°±æ»¡è¶³å¯éå¥æ§ï¼å½ç¶ä¹æ¯çº¿ç¨å®å¨çã\n * çº¿ç¨æ¬å°å­å¨ - ä½¿ç¨ ThreadLocal ä¸ºå±äº«åéå¨æ¯ä¸ªçº¿ç¨ä¸­é½åå»ºäºä¸ä¸ªæ¬å°å¯æ¬ï¼è¿ä¸ªå¯æ¬åªè½è¢«å½åçº¿ç¨è®¿é®ï¼å¶ä»çº¿ç¨æ æ³è®¿é®ï¼é£ä¹èªç¶æ¯çº¿ç¨å®å¨çã\n\n\n# æ´»è·æ§é®é¢\n\n\n# æ­»éï¼Deadlockï¼\n\n# ä»ä¹æ¯æ­»é\n\nå¤ä¸ªçº¿ç¨äºç¸ç­å¾å¯¹æ¹éæ¾éã\n\næ­»éæ¯å½çº¿ç¨è¿å¥æ éæç­å¾ç¶ææ¶åççæåµï¼å ä¸ºæè¯·æ±çéè¢«å¦ä¸ä¸ªçº¿ç¨ææï¼èå¦ä¸ä¸ªçº¿ç¨åç­å¾ç¬¬ä¸ä¸ªçº¿ç¨ææçå¦ä¸ä¸ªéã\n\n\n\n# é¿åæ­»é\n\nï¼1ï¼æåºå é\n\nå½å¤ä¸ªçº¿ç¨éè¦ç¸åçä¸äºéï¼ä½æ¯æç§ä¸åçé¡ºåºå éï¼æ­»éå°±å¾å®¹æåçã\n\nå¦æè½ç¡®ä¿ææççº¿ç¨é½æ¯æç§ç¸åçé¡ºåºè·å¾éï¼é£ä¹æ­»éå°±ä¸ä¼åçã\n\næç§é¡ºåºå éæ¯ä¸ç§ææçæ­»éé¢é²æºå¶ãä½æ¯ï¼è¿ç§æ¹å¼éè¦ä½ äºåç¥éææå¯è½ä¼ç¨å°çé(è¯èæ³¨ï¼å¹¶å¯¹è¿äºéåéå½çæåº)ï¼ä½æ»æäºæ¶åæ¯æ æ³é¢ç¥çã\n\nï¼2ï¼è¶æ¶éæ¾é\n\nå¦å¤ä¸ä¸ªå¯ä»¥é¿åæ­»éçæ¹æ³æ¯å¨å°è¯è·åéçæ¶åå ä¸ä¸ªè¶æ¶æ¶é´ï¼è¿ä¹å°±æå³çå¨å°è¯è·åéçè¿ç¨ä¸­è¥è¶è¿äºè¿ä¸ªæ¶éè¯¥çº¿ç¨åæ¾å¼å¯¹è¯¥éè¯·æ±ãè¥ä¸ä¸ªçº¿ç¨æ²¡æå¨ç»å®çæ¶éåæåè·å¾ææéè¦çéï¼åä¼è¿è¡åéå¹¶éæ¾ææå·²ç»è·å¾çéï¼ç¶åç­å¾ä¸æ®µéæºçæ¶é´åéè¯ãè¿æ®µéæºçç­å¾æ¶é´è®©å¶å®çº¿ç¨ææºä¼å°è¯è·åç¸åçè¿äºéï¼å¹¶ä¸è®©è¯¥åºç¨å¨æ²¡æè·å¾éçæ¶åå¯ä»¥ç»§ç»­è¿è¡(è¯èæ³¨ï¼å éè¶æ¶åå¯ä»¥åç»§ç»­è¿è¡å¹²ç¹å¶å®äºæï¼ååå¤´æ¥éå¤ä¹åå éçé»è¾)ã\n\nï¼3ï¼æ­»éæ£æµ\n\næ­»éæ£æµæ¯ä¸ä¸ªæ´å¥½çæ­»éé¢é²æºå¶ï¼å®ä¸»è¦æ¯éå¯¹é£äºä¸å¯è½å®ç°æåºå éå¹¶ä¸éè¶æ¶ä¹ä¸å¯è¡çåºæ¯ã\n\næ¯å½ä¸ä¸ªçº¿ç¨è·å¾äºéï¼ä¼å¨çº¿ç¨åéç¸å³çæ°æ®ç»æä¸­ï¼mapãgraph ç­ç­ï¼å°å¶è®°ä¸ãé¤æ­¤ä¹å¤ï¼æ¯å½æçº¿ç¨è¯·æ±éï¼ä¹éè¦è®°å½å¨è¿ä¸ªæ°æ®ç»æä¸­ã\n\nå½ä¸ä¸ªçº¿ç¨è¯·æ±éå¤±è´¥æ¶ï¼è¿ä¸ªçº¿ç¨å¯ä»¥éåéçå³ç³»å¾ççæ¯å¦ææ­»éåçã\n\nå¦ææ£æµåºæ­»éï¼æä¸¤ç§å¤çææ®µï¼\n\n * éæ¾ææéï¼åéï¼å¹¶ä¸ç­å¾ä¸æ®µéæºçæ¶é´åéè¯ãè¿ä¸ªåç®åçå éè¶æ¶ç±»ä¼¼ï¼ä¸ä¸æ ·çæ¯åªææ­»éå·²ç»åçäºæåéï¼èä¸ä¼æ¯å ä¸ºå éçè¯·æ±è¶æ¶äºãè½ç¶æåéåç­å¾ï¼ä½æ¯å¦ææå¤§éççº¿ç¨ç«äºåä¸æ¹éï¼å®ä»¬è¿æ¯ä¼éå¤å°æ­»éï¼ç¼èæ³¨ï¼åå åè¶æ¶ç±»ä¼¼ï¼ä¸è½ä»æ ¹æ¬ä¸åè½»ç«äºï¼ã\n * ä¸ä¸ªæ´å¥½çæ¹æ¡æ¯ç»è¿äºçº¿ç¨è®¾ç½®ä¼åçº§ï¼è®©ä¸ä¸ªï¼æå ä¸ªï¼çº¿ç¨åéï¼å©ä¸ççº¿ç¨å°±åæ²¡åçæ­»éä¸æ ·ç»§ç»­ä¿æçå®ä»¬éè¦çéãå¦æèµäºè¿äºçº¿ç¨çä¼åçº§æ¯åºå®ä¸åçï¼åä¸æ¹çº¿ç¨æ»æ¯ä¼æ¥ææ´é«çä¼åçº§ãä¸ºé¿åè¿ä¸ªé®é¢ï¼å¯ä»¥å¨æ­»éåççæ¶åè®¾ç½®éæºçä¼åçº§ã\n\n\n# æ´»éï¼Livelockï¼\n\n# ä»ä¹æ¯æ´»é\n\næ´»éæ¯ä¸ä¸ªéå½çæåµï¼ä¸¤ä¸ªææ´å¤ççº¿ç¨ä¼ä¸æ­éå¤ä¸ä¸ªç¹å®çä»£ç é»è¾ãé¢æçé»è¾éå¸¸ä¸ºå¶ä»çº¿ç¨æä¾æºä¼ç»§ç»­æ¯æ'this'çº¿ç¨ã\n\næ³è±¡è¿æ ·ä¸ä¸ªä¾å­ï¼ä¸¤ä¸ªäººå¨ç­çªçèµ°å»éç¸éï¼äºèé½å¾ç¤¼è²ï¼è¯å¾ç§»å°æè¾¹è®©å¯¹æ¹åéè¿ãä½æ¯ä»ä»¬æç»å¨æ²¡æåå¾ä»»ä½è¿å±çæåµä¸å·¦å³ææï¼å ä¸ºä»ä»¬é½å¨åä¸æ¶é´åç¸åçæ¹åç§»å¨ã\n\n\n\nå¦å¾æç¤ºï¼ä¸¤ä¸ªçº¿ç¨æ³è¦éè¿ä¸ä¸ª Worker å¯¹è±¡è®¿é®å±äº«å¬å±èµæºçæåµï¼ä½æ¯å½ä»ä»¬çå°å¦ä¸ä¸ª Workerï¼å¨å¦ä¸ä¸ªçº¿ç¨ä¸è°ç¨ï¼ä¹æ¯âæ´»å¨çâæ¶ï¼å®ä»¬ä¼å°è¯å°è¯¥èµæºäº¤ç»å¶ä»å·¥ä½èå¹¶ç­å¾ä¸ºå®å®æãå¦ææåæä»¬è®©ä¸¤åå·¥ä½äººåé½æ´»è·èµ·æ¥ï¼ä»ä»¬å°ä¼é¢ä¸´æ´»éé®é¢ã\n\n# é¿åæ´»é\n\nè§£å³âæ´»éâçæ¹æ¡å¾ç®åï¼è°¦è®©æ¶ï¼å°è¯ç­å¾ä¸ä¸ªéæºçæ¶é´å°±å¯ä»¥äºãç±äºç­å¾çæ¶é´æ¯éæºçï¼æä»¥åæ¶ç¸æååæ¬¡ç¸æçæ¦çå°±å¾ä½äºãâç­å¾ä¸ä¸ªéæºæ¶é´âçæ¹æ¡è½ç¶å¾ç®åï¼å´éå¸¸ææï¼Raft è¿æ ·ç¥åçåå¸å¼ä¸è´æ§ç®æ³ä¸­ä¹ç¨å°äºå®ã\n\n\n# é¥¥é¥¿ï¼Starvationï¼\n\n# ä»ä¹æ¯é¥¥é¥¿\n\n * é«ä¼åçº§çº¿ç¨åå¬ææçä½ä¼åçº§çº¿ç¨ç CPU æ¶é´ã\n * çº¿ç¨è¢«æ°¸ä¹å µå¡å¨ä¸ä¸ªç­å¾è¿å¥åæ­¥åçç¶æï¼å ä¸ºå¶ä»çº¿ç¨æ»æ¯è½å¨å®ä¹åæç»­å°å¯¹è¯¥åæ­¥åè¿è¡è®¿é®ã\n * çº¿ç¨å¨ç­å¾ä¸ä¸ªæ¬èº«(å¨å¶ä¸è°ç¨ wait())ä¹å¤äºæ°¸ä¹ç­å¾å®æçå¯¹è±¡ï¼å ä¸ºå¶ä»çº¿ç¨æ»æ¯è¢«æç»­å°è·å¾å¤éã\n\n\n\né¥¥é¥¿é®é¢æç»å¸çä¾å­å°±æ¯å²å­¦å®¶é®é¢ãå¦å¾æç¤ºï¼æäºä¸ªå²å­¦å®¶ç¨é¤ï¼æ¯ä¸ªäººè¦è·å¾ä¸¤æåå­æå¯ä»¥å°±é¤ãå½ 2ã4 å°±é¤æ¶ï¼1ã3ã5 æ°¸è¿æ æ³å°±é¤ï¼åªè½çççä¸­çç¾é£é¥¥é¥¿çç­å¾çã\n\n# è§£å³é¥¥é¥¿\n\nJava ä¸å¯è½å®ç° 100% çå¬å¹³æ§ï¼æä»¬ä¾ç¶å¯ä»¥éè¿åæ­¥ç»æå¨çº¿ç¨é´å®ç°å¬å¹³æ§çæé«ã\n\næä¸ç§æ¹æ¡ï¼\n\n * ä¿è¯èµæºåè¶³\n * å¬å¹³å°åéèµæº\n * é¿åææéççº¿ç¨é¿æ¶é´æ§è¡\n\nè¿ä¸ä¸ªæ¹æ¡ä¸­ï¼æ¹æ¡ä¸åæ¹æ¡ä¸çéç¨åºæ¯æ¯è¾æéï¼å ä¸ºå¾å¤åºæ¯ä¸ï¼èµæºçç¨ç¼ºæ§æ¯æ²¡åæ³è§£å³çï¼ææéççº¿ç¨æ§è¡çæ¶é´ä¹å¾é¾ç¼©ç­ãåæ¯æ¹æ¡äºçéç¨åºæ¯ç¸å¯¹æ¥è¯´æ´å¤ä¸äºã\n\né£å¦ä½å¬å¹³å°åéèµæºå¢ï¼å¨å¹¶åç¼ç¨éï¼ä¸»è¦æ¯ä½¿ç¨å¬å¹³éãæè°å¬å¹³éï¼æ¯ä¸ç§åæ¥åå°çæ¹æ¡ï¼çº¿ç¨çç­å¾æ¯æé¡ºåºçï¼æå¨ç­å¾éååé¢ççº¿ç¨ä¼ä¼åè·å¾èµæºã\n\n\n# æ§è½é®é¢\n\nå¹¶åæ§è¡ä¸å®æ¯ä¸²è¡æ§è¡å¿«åï¼çº¿ç¨è¶å¤æ§è¡è¶å¿«åï¼\n\nç­æ¡æ¯ï¼å¹¶åä¸ä¸å®æ¯ä¸²è¡å¿«ãå ä¸ºæåå»ºçº¿ç¨åçº¿ç¨ä¸ä¸æåæ¢çå¼éã\n\n\n# ä¸ä¸æåæ¢\n\n# ä»ä¹æ¯ä¸ä¸æåæ¢ï¼\n\nå½ CPU ä»æ§è¡ä¸ä¸ªçº¿ç¨åæ¢å°æ§è¡å¦ä¸ä¸ªçº¿ç¨æ¶ï¼CPU éè¦ä¿å­å½åçº¿ç¨çæ¬å°æ°æ®ï¼ç¨åºæéç­ç¶æï¼å¹¶å è½½ä¸ä¸ä¸ªè¦æ§è¡ççº¿ç¨çæ¬å°æ°æ®ï¼ç¨åºæéç­ãè¿ä¸ªå¼å³è¢«ç§°ä¸ºâä¸ä¸æåæ¢âã\n\n# åå°ä¸ä¸æåæ¢çæ¹æ³\n\n * æ éå¹¶åç¼ç¨ - å¤çº¿ç¨ç«äºéæ¶ï¼ä¼å¼èµ·ä¸ä¸æåæ¢ï¼æä»¥å¤çº¿ç¨å¤çæ°æ®æ¶ï¼å¯ä»¥ç¨ä¸äºåæ³æ¥é¿åä½¿ç¨éï¼å¦å°æ°æ®ç ID æç§ Hash ç®æ³åæ¨¡åæ®µï¼ä¸åççº¿ç¨å¤çä¸åæ®µçæ°æ®ã\n * CAS ç®æ³ - Java ç Atomic åä½¿ç¨ CAS ç®æ³æ¥æ´æ°æ°æ®ï¼èä¸éè¦å éã\n * ä½¿ç¨æå°çº¿ç¨ - é¿ååå»ºä¸éè¦ççº¿ç¨ï¼æ¯å¦ä»»å¡å¾å°ï¼ä½æ¯åå»ºäºå¾å¤çº¿ç¨æ¥å¤çï¼è¿æ ·ä¼é æå¤§éçº¿ç¨é½å¤äºç­å¾ç¶æã\n * ä½¿ç¨åç¨ - å¨åçº¿ç¨éå®ç°å¤ä»»å¡çè°åº¦ï¼å¹¶å¨åçº¿ç¨éç»´æå¤ä¸ªä»»å¡é´çåæ¢ã\n\n\n# èµæºéå¶\n\n# ä»ä¹æ¯èµæºéå¶\n\nèµæºéå¶æ¯æå¨è¿è¡å¹¶åç¼ç¨æ¶ï¼ç¨åºçæ§è¡éåº¦åéäºè®¡ç®æºç¡¬ä»¶èµæºæè½¯ä»¶èµæºã\n\n# èµæºéå¶å¼åçé®é¢\n\nå¨å¹¶åç¼ç¨ä¸­ï¼å°ä»£ç æ§è¡éåº¦å å¿«çååæ¯å°ä»£ç ä¸­ä¸²è¡æ§è¡çé¨ååæå¹¶åæ§è¡ï¼ä½æ¯å¦æå°ææ®µä¸²è¡çä»£ç å¹¶åæ§è¡ï¼å ä¸ºåéäºèµæºï¼ä»ç¶å¨ä¸²è¡æ§è¡ï¼è¿æ¶åç¨åºä¸ä»ä¸ä¼å å¿«æ§è¡ï¼åèä¼æ´æ¢ï¼å ä¸ºå¢å äºä¸ä¸æåæ¢åèµæºè°åº¦çæ¶é´ã\n\n# å¦ä½è§£å³èµæºéå¶çé®é¢\n\nå¨èµæºéå¶æåµä¸è¿è¡å¹¶åç¼ç¨ï¼æ ¹æ®ä¸åçèµæºéå¶è°æ´ç¨åºçå¹¶ååº¦ã\n\n * å¯¹äºç¡¬ä»¶èµæºéå¶ï¼å¯ä»¥èèä½¿ç¨éç¾¤å¹¶è¡æ§è¡ç¨åºã\n * å¯¹äºè½¯ä»¶èµæºéå¶ï¼å¯ä»¥èèä½¿ç¨èµæºæ± å°èµæºå¤ç¨ã\n\n\n# å°ç»\n\nå¹¶åç¼ç¨å¯ä»¥æ»ç»ä¸ºä¸ä¸ªæ ¸å¿é®é¢ï¼åå·¥ãåæ­¥ãäºæ¥ã\n\n * åå·¥ï¼æ¯æå¦ä½é«æå°æè§£ä»»å¡å¹¶åéç»çº¿ç¨ã\n * åæ­¥ï¼æ¯æçº¿ç¨ä¹é´å¦ä½åä½ã\n * äºæ¥ï¼æ¯æä¿è¯åä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®å±äº«èµæºã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava å¹¶åç¼ç¨å®æã\n * http://tutorials.jenkov.com/java-concurrency/benefits.html\n * https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/thread-deadlock.html\n * https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/thread-livelock.html\n * https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/thread-starvation.html\n * https://www.zhihu.com/question/33515481\n * https://blog.csdn.net/yaosiming2011/article/details/44280797",normalizedContent:"# java å¹¶åç®ä»\n\n> å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n> \n> æè¦ï¼å¹¶åç¼ç¨å¹¶é java è¯­è¨æç¬æï¼èæ¯ä¸ç§æççç¼ç¨èå¼ï¼java åªæ¯ç¨èªå·±çæ¹å¼å®ç°äºå¹¶åå·¥ä½æ¨¡åãå­¦ä¹  java å¹¶åç¼ç¨ï¼åºè¯¥åçæå¹¶åçåºæ¬æ¦å¿µï¼ç¶åè¿ä¸æ­¥äºè§£å¹¶åçç¹æ§ä»¥åå¶ç¹æ§æé¢ä¸´çé®é¢ãææ¡äºè¿äºï¼å½å­¦ä¹  java å¹¶åå·¥å·æ¶ï¼æä¼æç½å®ä»¬åèªæ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼ä¸ºä»ä¹è¦è¿æ ·è®¾è®¡ãéè¿è¿æ ·ç±ç¹å°é¢çå­¦ä¹ æ¹å¼ï¼æ´å®¹æèä¼è´¯éï¼å°å¹¶åç¥è¯å½¢æä½ç³»åã\n\n\n\n\n# å¹¶åæ¦å¿µ\n\nå¹¶åç¼ç¨ä¸­æå¾å¤æ¯è¯­æ¦å¿µç¸è¿ï¼å®¹æè®©äººæ··æ·ãæ¬èåå®¹éè¿å¯¹æ¯åæï¼åæ±è®©è¯»èæ¸æ°çè§£å¶æ¦å¿µä»¥åå·®å¼ã\n\n\n# å¹¶ååå¹¶è¡\n\nå¹¶ååå¹¶è¡æ¯æå®¹æè®©æ°æè´¹è§£çæ¦å¿µï¼é£ä¹å¦ä½çè§£äºèå¢ï¼å¶æå³é®çå·®å¼å¨äºï¼æ¯å¦æ¯åæ¶åçï¼\n\n * å¹¶åï¼æ¯æå·å¤å¤çå¤ä¸ªä»»å¡çè½åï¼ä½ä¸ä¸å®è¦åæ¶ã\n * å¹¶è¡ï¼æ¯æå·å¤åæ¶å¤çå¤ä¸ªä»»å¡çè½åã\n\nä¸é¢æ¯æè§è¿æçå¨çè¯´æï¼æèª å¹¶åä¸å¹¶è¡çåºå«æ¯ä»ä¹ï¼ââç¥ä¹çé«ç¥¨ç­æ¡ï¼\n\n * ä½ åé¥­åå°ä¸åï¼çµè¯æ¥äºï¼ä½ ä¸ç´å°åå®äºä»¥åæå»æ¥ï¼è¿å°±è¯´æä½ ä¸æ¯æå¹¶åä¹ä¸æ¯æå¹¶è¡ã\n * ä½ åé¥­åå°ä¸åï¼çµè¯æ¥äºï¼ä½ åäºä¸æ¥æ¥äºçµè¯ï¼æ¥å®åç»§ç»­åé¥­ï¼è¿è¯´æä½ æ¯æå¹¶åã\n * ä½ åé¥­åå°ä¸åï¼çµè¯æ¥äºï¼ä½ ä¸è¾¹æçµè¯ä¸è¾¹åé¥­ï¼è¿è¯´æä½ æ¯æå¹¶è¡ã\n\n\n# åæ­¥åå¼æ­¥\n\n * åæ­¥ï¼æ¯æå¨ååºä¸ä¸ªè°ç¨æ¶ï¼å¨æ²¡æå¾å°ç»æä¹åï¼è¯¥è°ç¨å°±ä¸è¿åãä½æ¯ä¸æ¦è°ç¨è¿åï¼å°±å¾å°è¿åå¼äºã\n * å¼æ­¥ï¼åæ¯ç¸åï¼è°ç¨å¨ååºä¹åï¼è¿ä¸ªè°ç¨å°±ç´æ¥è¿åäºï¼æä»¥æ²¡æè¿åç»æãæ¢å¥è¯è¯´ï¼å½ä¸ä¸ªå¼æ­¥è¿ç¨è°ç¨ååºåï¼è°ç¨èä¸ä¼ç«å»å¾å°ç»æãèæ¯å¨è°ç¨ååºåï¼è¢«è°ç¨èéè¿ç¶æãéç¥æ¥éç¥è°ç¨èï¼æéè¿åè°å½æ°å¤çè¿ä¸ªè°ç¨ã\n\nä¸¾ä¾æ¥è¯´æï¼\n\n * åæ­¥å°±åæ¯æçµè¯ï¼ä¸æçµè¯ï¼éè¯ä¸ä¼ç»æã\n * å¼æ­¥å°±åæ¯åç­ä¿¡ï¼åå®ç­ä¿¡åï¼å°±å¯ä»¥åå¶ä»äºï¼å½æ¶å°åå¤ç­ä¿¡æ¶ï¼ææºä¼éè¿éå£°ææ¯å¨æ¥æéã\n\n\n# é»å¡åéé»å¡\n\né»å¡åéé»å¡å³æ³¨çæ¯ç¨åºå¨ç­å¾è°ç¨ç»æï¼æ¶æ¯ï¼è¿åå¼ï¼æ¶çç¶æï¼\n\n * é»å¡ï¼æ¯æè°ç¨ç»æè¿åä¹åï¼å½åçº¿ç¨ä¼è¢«æèµ·ãè°ç¨çº¿ç¨åªæå¨å¾å°ç»æä¹åæä¼è¿åã\n * éé»å¡ï¼æ¯æå¨ä¸è½ç«å»å¾å°ç»æä¹åï¼è¯¥è°ç¨ä¸ä¼é»å¡å½åçº¿ç¨ã\n\nä¸¾ä¾æ¥è¯´æï¼\n\n * é»å¡è°ç¨å°±åæ¯æçµè¯ï¼éè¯ä¸ç»æï¼ä¸è½æ¾ä¸ã\n * éé»å¡è°ç¨å°±åæ¯åç­ä¿¡ï¼åå®ç­ä¿¡åï¼å°±å¯ä»¥åå¶ä»äºï¼ç­ä¿¡æ¥äºï¼ææºä¼æéã\n\n\n# è¿ç¨åçº¿ç¨\n\n * è¿ç¨ï¼è¿ç¨æ¯å·æä¸å®ç¬ç«åè½çç¨åºå³äºæä¸ªæ°æ®éåä¸çä¸æ¬¡è¿è¡æ´»å¨ãè¿ç¨æ¯æä½ç³»ç»è¿è¡èµæºåéçåºæ¬åä½ãè¿ç¨å¯è§ä¸ºä¸ä¸ªæ­£å¨è¿è¡çç¨åºã\n * çº¿ç¨ï¼çº¿ç¨æ¯æä½ç³»ç»è¿è¡è°åº¦çåºæ¬åä½ã\n\nè¿ç¨åçº¿ç¨çå·®å¼ï¼\n\n * ä¸ä¸ªç¨åºè³å°æä¸ä¸ªè¿ç¨ï¼ä¸ä¸ªè¿ç¨è³å°æä¸ä¸ªçº¿ç¨ã\n * çº¿ç¨æ¯è¿ç¨ååæ´ç»ï¼æä»¥æ§è¡å¼éæ´å°ï¼å¹¶åæ§æ´é«\n * è¿ç¨æ¯ä¸ä¸ªå®ä½ï¼æ¥æç¬ç«çèµæºï¼èåä¸ä¸ªè¿ç¨ä¸­çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çèµæºã\n\n\n\njvm å¨åä¸ªè¿ç¨ä¸­è¿è¡ï¼jvm ä¸­ççº¿ç¨å±äº«å±äºè¯¥è¿ç¨çå ãè¿å°±æ¯ä¸ºä»ä¹å ä¸ªçº¿ç¨å¯ä»¥è®¿é®åä¸ä¸ªå¯¹è±¡ãçº¿ç¨å±äº«å å¹¶æ¥æèªå·±çå æ ç©ºé´ãè¿æ¯ä¸ä¸ªçº¿ç¨å¦ä½è°ç¨ä¸ä¸ªæ¹æ³ä»¥åå®çå±é¨åéæ¯å¦ä½ä¿æçº¿ç¨å®å¨çãä½æ¯å ä¸æ¯çº¿ç¨å®å¨çå¹¶ä¸ä¸ºäºçº¿ç¨å®å¨å¿é¡»è¿è¡åæ­¥ã\n\n\n# ç«ææ¡ä»¶åä¸´çåº\n\n * ç«ææ¡ä»¶ï¼race conditionï¼ï¼å½ä¸¤ä¸ªçº¿ç¨ç«äºåä¸èµæºæ¶ï¼å¦æå¯¹èµæºçè®¿é®é¡ºåºææï¼å°±ç§°å­å¨ç«ææ¡ä»¶ã\n\n * ä¸´çåºï¼critical sectionsï¼ï¼å¯¼è´ç«ææ¡ä»¶åççä»£ç åºç§°ä½ä¸´çåºã\n\n\n# ç®¡ç¨\n\nç®¡ç¨ï¼monitorï¼ï¼æ¯æç®¡çå±äº«åéä»¥åå¯¹å±äº«åéçæä½è¿ç¨ï¼è®©ä»ä»¬æ¯æå¹¶åã\n\njava éç¨çæ¯ç®¡ç¨ææ¯ï¼synchronized å³é®å­å wait()ãnotify()ãnotifyall() è¿ä¸ä¸ªæ¹æ³é½æ¯ç®¡ç¨çç»æé¨åãèç®¡ç¨åä¿¡å·éæ¯ç­ä»·çï¼æè°ç­ä»·æçæ¯ç¨ç®¡ç¨è½å¤å®ç°ä¿¡å·éï¼ä¹è½ç¨ä¿¡å·éå®ç°ç®¡ç¨ã\n\n\n# å¹¶åçç¹ç¹\n\nææ¯å¨è¿æ­¥ï¼cpuãåå­ãi/o è®¾å¤çæ§è½ä¹å¨ä¸æ­æé«ãä½æ¯ï¼å§ç»å­å¨ä¸ä¸ªæ ¸å¿çç¾ï¼cpuãåå­ãi/o è®¾å¤å­å¨éåº¦å·®å¼ãcpu è¿å¿«äºåå­ï¼åå­è¿å¿«äº i/o è®¾å¤ã\n\næ¨æ¡¶ç­æ¿çè®ºåè¯æä»¬ï¼ä¸åªæ¨æ¡¶è½è£å¤å°æ°´ï¼åå³äºæç­çé£åæ¨æ¿ãåçï¼ç¨åºæ´ä½æ§è½åå³äºææ¢çæä½ï¼å³ i/o æä½ï¼ï¼æä»¥åæ¹é¢æé« cpuãåå­çæ§è½æ¯æ æçã\n\n\n\nä¸ºäºåçå©ç¨ cpu çé«æ§è½ï¼å¹³è¡¡è¿ä¸èçéåº¦å·®å¼ï¼è®¡ç®æºä½ç³»æºæãæä½ç³»ç»ãç¼è¯ç¨åºé½ååºäºè´¡ç®ï¼ä¸»è¦ä½ç°ä¸ºï¼\n\n * cpu å¢å äºç¼å­ï¼ä»¥åè¡¡ä¸åå­çéåº¦å·®å¼ï¼\n * æä½ç³»ç»å¢å äºè¿ç¨ãçº¿ç¨ï¼ä»¥åæ¶å¤ç¨ cpuï¼è¿èåè¡¡ cpu ä¸ i/o è®¾å¤çéåº¦å·®å¼ï¼\n * ç¼è¯ç¨åºä¼åæä»¤æ§è¡æ¬¡åºï¼ä½¿å¾ç¼å­è½å¤å¾å°æ´å åçå°å©ç¨ã\n\nå¶ä¸­ï¼è¿ç¨ãçº¿ç¨ä½¿å¾è®¡ç®æºãç¨åºæäºå¹¶åå¤çä»»å¡çè½åã\n\nå¹¶åçä¼ç¹å¨äºï¼\n\n * æåèµæºå©ç¨ç\n * ç¨åºååºæ´å¿«\n\n\n# æåèµæºå©ç¨ç\n\næ³è±¡ä¸ä¸ï¼ä¸ä¸ªåºç¨ç¨åºéè¦ä»æ¬å°æä»¶ç³»ç»ä¸­è¯»ååå¤çæä»¶çææ¯ãæ¯æ¹è¯´ï¼ä»ç£çè¯»åä¸ä¸ªæä»¶éè¦ 5 ç§ï¼å¤çä¸ä¸ªæä»¶éè¦ 2 ç§ãå¤çä¸¤ä¸ªæä»¶åéè¦ï¼\n\n5ç§è¯»åæä»¶a\n2ç§å¤çæä»¶a\n5ç§è¯»åæä»¶b\n2ç§å¤çæä»¶b\n---------------------\næ»å±éè¦14ç§\n\n\nä»ç£çä¸­è¯»åæä»¶çæ¶åï¼å¤§é¨åç cpu æ¶é´ç¨äºç­å¾ç£çå»è¯»åæ°æ®ãå¨è¿æ®µæ¶é´éï¼cpu éå¸¸çç©ºé²ãå®å¯ä»¥åä¸äºå«çäºæãéè¿æ¹åæä½çé¡ºåºï¼å°±è½å¤æ´å¥½çä½¿ç¨ cpu èµæºãçä¸é¢çé¡ºåºï¼\n\n5ç§è¯»åæä»¶a\n5ç§è¯»åæä»¶b + 2ç§å¤çæä»¶a\n2ç§å¤çæä»¶b\n---------------------\næ»å±éè¦12ç§\n\n\ncpu ç­å¾ç¬¬ä¸ä¸ªæä»¶è¢«è¯»åå®ãç¶åå¼å§è¯»åç¬¬äºä¸ªæä»¶ãå½ç¬¬äºæä»¶å¨è¢«è¯»åçæ¶åï¼cpu ä¼å»å¤çç¬¬ä¸ä¸ªæä»¶ãè®°ä½ï¼å¨ç­å¾ç£çè¯»åæä»¶çæ¶åï¼cpu å¤§ é¨åæ¶é´æ¯ç©ºé²çã\n\næ»çè¯´æ¥ï¼cpu è½å¤å¨ç­å¾ io çæ¶ååä¸äºå¶ä»çäºæãè¿ä¸ªä¸ä¸å®å°±æ¯ç£ç ioãå®ä¹å¯ä»¥æ¯ç½ç»ç ioï¼æèç¨æ·è¾å¥ãéå¸¸æåµä¸ï¼ç½ç»åç£çç io æ¯ cpu ååå­ç io æ¢çå¤ã\n\n\n# ç¨åºååºæ´å¿«\n\nå°ä¸ä¸ªåçº¿ç¨åºç¨ç¨åºåæå¤çº¿ç¨åºç¨ç¨åºçå¦ä¸ä¸ªå¸¸è§çç®çæ¯å®ç°ä¸ä¸ªååºæ´å¿«çåºç¨ç¨åºãè®¾æ³ä¸ä¸ªæå¡å¨åºç¨ï¼å®å¨æä¸ä¸ªç«¯å£çå¬è¿æ¥çè¯·æ±ãå½ä¸ä¸ªè¯·æ±å°æ¥æ¶ï¼å®å»å¤çè¿ä¸ªè¯·æ±ï¼ç¶ååè¿åå»çå¬ã\n\næå¡å¨çæµç¨å¦ä¸æè¿°ï¼\n\nwhile(server is active) {\n    listen for request\n    process request\n}\n\n\nå¦æä¸ä¸ªè¯·æ±éè¦å ç¨å¤§éçæ¶é´æ¥å¤çï¼å¨è¿æ®µæ¶é´åæ°çå®¢æ·ç«¯å°±æ æ³åéè¯·æ±ç»æå¡ç«¯ãåªææå¡å¨å¨çå¬çæ¶åï¼è¯·æ±æè½è¢«æ¥æ¶ãå¦ä¸ç§è®¾è®¡æ¯ï¼çå¬çº¿ç¨æè¯·æ±ä¼ éç»å·¥ä½èçº¿ç¨(worker thread)ï¼ç¶åç«å»è¿åå»çå¬ãèå·¥ä½èçº¿ç¨åè½å¤å¤çè¿ä¸ªè¯·æ±å¹¶åéä¸ä¸ªåå¤ç»å®¢æ·ç«¯ãè¿ç§è®¾è®¡å¦ä¸æè¿°ï¼\n\nwhile(server is active) {\n    listen for request\n    hand request to worker thread\n}\n\n\nè¿ç§æ¹å¼ï¼æå¡ç«¯çº¿ç¨è¿éå°è¿åå»çå¬ãå æ­¤ï¼æ´å¤çå®¢æ·ç«¯è½å¤åéè¯·æ±ç»æå¡ç«¯ãè¿ä¸ªæå¡ä¹åå¾ååºæ´å¿«ã\n\næ¡é¢åºç¨ä¹æ¯åæ ·å¦æ­¤ãå¦æä½ ç¹å»ä¸ä¸ªæé®å¼å§è¿è¡ä¸ä¸ªèæ¶çä»»å¡ï¼è¿ä¸ªçº¿ç¨æ¢è¦æ§è¡ä»»å¡åè¦æ´æ°çªå£åæé®ï¼é£ä¹å¨ä»»å¡æ§è¡çè¿ç¨ä¸­ï¼è¿ä¸ªåºç¨ç¨åºçèµ·æ¥å¥½åæ²¡æååºä¸æ ·ãç¸åï¼ä»»å¡å¯ä»¥ä¼ éç»å·¥ä½èçº¿ç¨ï¼worker thread)ãå½å·¥ä½èçº¿ç¨å¨ç¹å¿å°å¤çä»»å¡çæ¶åï¼çªå£çº¿ç¨å¯ä»¥èªç±å°ååºå¶ä»ç¨æ·çè¯·æ±ãå½å·¥ä½èçº¿ç¨å®æä»»å¡çæ¶åï¼å®åéä¿¡å·ç»çªå£çº¿ç¨ãçªå£çº¿ç¨ä¾¿å¯ä»¥æ´æ°åºç¨ç¨åºçªå£ï¼å¹¶æ¾ç¤ºä»»å¡çç»æãå¯¹ç¨æ·èè¨ï¼è¿ç§å·æå·¥ä½èçº¿ç¨è®¾è®¡çç¨åºæ¾å¾ååºéåº¦æ´å¿«ã\n\n\n# å¹¶åçé®é¢\n\nä»»ä½äºç©é½æå©å¼ï¼å¹¶åä¹ä¸ä¾å¤ã\n\næä»¬ç¥éäºå¹¶åå¸¦æ¥çå¥½å¤ï¼æåèµæºå©ç¨çãç¨åºååºæ´å¿«ï¼åæ¶ä¹è¦è®¤è¯å°å¹¶åå¸¦æ¥çé®é¢ï¼ä¸»è¦æï¼\n\n * å®å¨æ§é®é¢\n * æ´»è·æ§é®é¢\n * æ§è½é®é¢\n\nä¸é¢ä¼ä¸ä¸è®²è§£ã\n\n\n# å®å¨æ§é®é¢\n\nå¹¶åæéè¦çé®é¢æ¯å¹¶åå®å¨é®é¢ã\n\nå¹¶åå®å¨ï¼æ¯æä¿è¯ç¨åºçæ­£ç¡®æ§ï¼ä½¿å¾å¹¶åå¤çç»æç¬¦åé¢æã\n\nå¹¶åå®å¨éè¦ä¿è¯å ä¸ªåºæ¬ç¹æ§ï¼\n\n * å¯è§æ§ - æ¯ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªå±äº«åéï¼å¶ç¶æè½å¤ç«å³è¢«å¶ä»çº¿ç¨ç¥æï¼éå¸¸è¢«è§£éä¸ºå°çº¿ç¨æ¬å°ç¶æåæ å°ä¸»åå­ä¸ï¼volatile å°±æ¯è´è´£ä¿è¯å¯è§æ§çã\n * åå­æ§ - ç®åè¯´å°±æ¯ç¸å³æä½ä¸ä¼ä¸­éè¢«å¶ä»çº¿ç¨å¹²æ°ï¼ä¸è¬éè¿åæ­¥æºå¶ï¼å éï¼sychronizedãlockï¼å®ç°ã\n * æåºæ§ - æ¯ä¿è¯çº¿ç¨åä¸²è¡è¯­ä¹ï¼é¿åæä»¤éæç­ã\n\n\n# ç¼å­å¯¼è´çå¯è§æ§é®é¢\n\n> ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçä¿®æ¹ï¼å¦å¤ä¸ä¸ªçº¿ç¨è½å¤ç«å»çå°ï¼ç§°ä¸º å¯è§æ§ã\n\nå¨åæ ¸æ¶ä»£ï¼ææççº¿ç¨é½æ¯å¨ä¸é¢ cpu ä¸æ§è¡ï¼cpu ç¼å­ä¸åå­çæ°æ®ä¸è´æ§å®¹æè§£å³ãå ä¸ºææçº¿ç¨é½æ¯æä½åä¸ä¸ª cpu çç¼å­ï¼ä¸ä¸ªçº¿ç¨å¯¹ç¼å­çåï¼å¯¹å¦å¤ä¸ä¸ªçº¿ç¨æ¥è¯´ä¸å®æ¯å¯è§çãä¾å¦å¨ä¸é¢çå¾ä¸­ï¼çº¿ç¨ a åçº¿ç¨ b é½æ¯æä½åä¸ä¸ª cpu éé¢çç¼å­ï¼æä»¥çº¿ç¨ a æ´æ°äºåé v çå¼ï¼é£ä¹çº¿ç¨ b ä¹ååè®¿é®åé vï¼å¾å°çä¸å®æ¯ v çææ°å¼ï¼çº¿ç¨ a åè¿çå¼ï¼ã\n\n\n\nå¤æ ¸æ¶ä»£ï¼æ¯é¢ cpu é½æèªå·±çç¼å­ï¼è¿æ¶ cpu ç¼å­ä¸åå­çæ°æ®ä¸è´æ§å°±æ²¡é£ä¹å®¹æè§£å³äºï¼å½å¤ä¸ªçº¿ç¨å¨ä¸åç cpu ä¸æ§è¡æ¶ï¼è¿äºçº¿ç¨æä½çæ¯ä¸åç cpu ç¼å­ãæ¯å¦ä¸å¾ä¸­ï¼çº¿ç¨ a æä½çæ¯ cpu-1 ä¸çç¼å­ï¼èçº¿ç¨ b æä½çæ¯ cpu-2 ä¸çç¼å­ï¼å¾ææ¾ï¼è¿ä¸ªæ¶åçº¿ç¨ a å¯¹åé v çæä½å¯¹äºçº¿ç¨ b èè¨å°±ä¸å·å¤å¯è§æ§äºã\n\n\n\nãç¤ºä¾ãçº¿ç¨ä¸å®å¨çç¤ºä¾\n\nä¸é¢æä»¬åç¨ä¸æ®µä»£ç æ¥éªè¯ä¸ä¸å¤æ ¸åºæ¯ä¸çå¯è§æ§é®é¢ãä¸é¢çä»£ç ï¼æ¯æ§è¡ä¸æ¬¡ add10k() æ¹æ³ï¼é½ä¼å¾ªç¯ 10000 æ¬¡ count+=1 æä½ãå¨ calc() æ¹æ³ä¸­æä»¬åå»ºäºä¸¤ä¸ªçº¿ç¨ï¼æ¯ä¸ªçº¿ç¨è°ç¨ä¸æ¬¡ add10k() æ¹æ³ï¼æä»¬æ¥æ³ä¸æ³æ§è¡ calc() æ¹æ³å¾å°çç»æåºè¯¥æ¯å¤å°å¢ï¼\n\npublic class test {\n  private long count = 0;\n  private void add10k() {\n    int idx = 0;\n    while(idx++ < 10000) {\n      count += 1;\n    }\n  }\n  public static long calc() {\n    final test test = new test();\n    // åå»ºä¸¤ä¸ªçº¿ç¨ï¼æ§è¡ add() æä½\n    thread th1 = new thread(()->{\n      test.add10k();\n    });\n    thread th2 = new thread(()->{\n      test.add10k();\n    });\n    // å¯å¨ä¸¤ä¸ªçº¿ç¨\n    th1.start();\n    th2.start();\n    // ç­å¾ä¸¤ä¸ªçº¿ç¨æ§è¡ç»æ\n    th1.join();\n    th2.join();\n    return count;\n  }\n}\n\n\nç´è§åè¯æä»¬åºè¯¥æ¯ 20000ï¼å ä¸ºå¨åçº¿ç¨éè°ç¨ä¸¤æ¬¡ add10k() æ¹æ³ï¼count çå¼å°±æ¯ 20000ï¼ä½å®éä¸ calc() çæ§è¡ç»ææ¯ä¸ª 10000 å° 20000 ä¹é´çéæºæ°ãä¸ºä»ä¹å¢ï¼\n\næä»¬åè®¾çº¿ç¨ a åçº¿ç¨ b åæ¶å¼å§æ§è¡ï¼é£ä¹ç¬¬ä¸æ¬¡é½ä¼å° count=0 è¯»å°åèªç cpu ç¼å­éï¼æ§è¡å® count+=1 ä¹åï¼åèª cpu ç¼å­éçå¼é½æ¯ 1ï¼åæ¶åå¥åå­åï¼æä»¬ä¼åç°åå­ä¸­æ¯ 1ï¼èä¸æ¯æä»¬ææç 2ãä¹åç±äºåèªç cpu ç¼å­éé½æäº count çå¼ï¼ä¸¤ä¸ªçº¿ç¨é½æ¯åºäº cpu ç¼å­éç count å¼æ¥è®¡ç®ï¼æä»¥å¯¼è´æç» count çå¼é½æ¯å°äº 20000 çãè¿å°±æ¯ç¼å­çå¯è§æ§é®é¢ã\n\nå¾ªç¯ 10000 æ¬¡ count+=1 æä½å¦ææ¹ä¸ºå¾ªç¯ 1 äº¿æ¬¡ï¼ä½ ä¼åç°æææ´ææ¾ï¼æç» count çå¼æ¥è¿ 1 äº¿ï¼èä¸æ¯ 2 äº¿ãå¦æå¾ªç¯ 10000 æ¬¡ï¼count çå¼æ¥è¿ 20000ï¼åå æ¯ä¸¤ä¸ªçº¿ç¨ä¸æ¯åæ¶å¯å¨çï¼æä¸ä¸ªæ¶å·®ã\n\n\n\n\n# çº¿ç¨åæ¢å¸¦æ¥çåå­æ§é®é¢\n\nç±äº io å¤ªæ¢ï¼æ©æçæä½ç³»ç»å°±åæäºå¤è¿ç¨ï¼æä½ç³»ç»åè®¸æä¸ªè¿ç¨æ§è¡ä¸å°æ®µæ¶é´ï¼ç§°ä¸º æ¶é´çï¼ã\n\nå¨ä¸ä¸ªæ¶é´çåï¼å¦æä¸ä¸ªè¿ç¨è¿è¡ä¸ä¸ª io æä½ï¼ä¾å¦è¯»ä¸ªæä»¶ï¼è¿ä¸ªæ¶åè¯¥è¿ç¨å¯ä»¥æèªå·±æ è®°ä¸ºâä¼ç ç¶æâå¹¶åºè®© cpu çä½¿ç¨æï¼å¾æä»¶è¯»è¿åå­ï¼æä½ç³»ç»ä¼æè¿ä¸ªä¼ç çè¿ç¨å¤éï¼å¤éåçè¿ç¨å°±ææºä¼éæ°è·å¾ cpu çä½¿ç¨æäºã\n\nè¿éçè¿ç¨å¨ç­å¾ io æ¶ä¹æä»¥ä¼éæ¾ cpu ä½¿ç¨æï¼æ¯ä¸ºäºè®© cpu å¨è¿æ®µç­å¾æ¶é´éå¯ä»¥åå«çäºæï¼è¿æ ·ä¸æ¥ cpu çä½¿ç¨çå°±ä¸æ¥äºï¼æ­¤å¤ï¼å¦æè¿æ¶æå¦å¤ä¸ä¸ªè¿ç¨ä¹è¯»æä»¶ï¼è¯»æä»¶çæä½å°±ä¼æéï¼ç£çé©±å¨å¨å®æä¸ä¸ªè¿ç¨çè¯»æä½åï¼åç°ææéçä»»å¡ï¼å°±ä¼ç«å³å¯å¨ä¸ä¸ä¸ªè¯»æä½ï¼è¿æ · io çä½¿ç¨çä¹ä¸æ¥äºã\n\næ©æçæä½ç³»ç»åºäºè¿ç¨æ¥è°åº¦ cpuï¼ä¸åè¿ç¨é´æ¯ä¸å±äº«åå­ç©ºé´çï¼æä»¥è¿ç¨è¦åä»»å¡åæ¢å°±è¦åæ¢åå­æ å°å°åï¼èä¸ä¸ªè¿ç¨åå»ºçææçº¿ç¨ï¼é½æ¯å±äº«ä¸ä¸ªåå­ç©ºé´çï¼æä»¥çº¿ç¨åä»»å¡åæ¢ææ¬å°±å¾ä½äºãç°ä»£çæä½ç³»ç»é½åºäºæ´è½»éççº¿ç¨æ¥è°åº¦ï¼ç°å¨æä»¬æå°çâä»»å¡åæ¢âé½æ¯æâçº¿ç¨åæ¢âã\n\njava å¹¶åç¨åºé½æ¯åºäºå¤çº¿ç¨çï¼èªç¶ä¹ä¼æ¶åå°ä»»å¡åæ¢ï¼ä¹è®¸ä½ æ³ä¸å°ï¼ä»»å¡åæ¢ç«ç¶ä¹æ¯å¹¶åç¼ç¨éè¯¡å¼ bug çæºå¤´ä¹ä¸ãä»»å¡åæ¢çæ¶æºå¤§å¤æ°æ¯å¨æ¶é´çç»æçæ¶åï¼æä»¬ç°å¨åºæ¬é½ä½¿ç¨é«çº§è¯­è¨ç¼ç¨ï¼é«çº§è¯­è¨éä¸æ¡è¯­å¥å¾å¾éè¦å¤æ¡ cpu æä»¤å®æï¼ä¾å¦ä¸é¢ä»£ç ä¸­ç count += 1ï¼è³å°éè¦ä¸æ¡ cpu æä»¤ã\n\n * æä»¤ 1ï¼é¦åï¼éè¦æåé count ä»åå­å è½½å° cpu çå¯å­å¨ï¼\n * æä»¤ 2ï¼ä¹åï¼å¨å¯å­å¨ä¸­æ§è¡ +1 æä½ï¼\n * æä»¤ 3ï¼æåï¼å°ç»æåå¥åå­ï¼ç¼å­æºå¶å¯¼è´å¯è½åå¥çæ¯ cpu ç¼å­èä¸æ¯åå­ï¼ã\n\næä½ç³»ç»åä»»å¡åæ¢ï¼å¯ä»¥åçå¨ä»»ä½ä¸æ¡cpu æä»¤æ§è¡å®ï¼æ¯çï¼æ¯ cpu æä»¤ï¼èä¸æ¯é«çº§è¯­è¨éçä¸æ¡è¯­å¥ãå¯¹äºä¸é¢çä¸æ¡æä»¤æ¥è¯´ï¼æä»¬åè®¾ count=0ï¼å¦æçº¿ç¨ a å¨æä»¤ 1 æ§è¡å®ååçº¿ç¨åæ¢ï¼çº¿ç¨ a åçº¿ç¨ b æç§ä¸å¾çåºåæ§è¡ï¼é£ä¹æä»¬ä¼åç°ä¸¤ä¸ªçº¿ç¨é½æ§è¡äº count+=1 çæä½ï¼ä½æ¯å¾å°çç»æä¸æ¯æä»¬ææç 2ï¼èæ¯ 1ã\n\n\n\næä»¬æ½æè¯éé¢è§å¾ count+=1 è¿ä¸ªæä½æ¯ä¸ä¸ªä¸å¯åå²çæ´ä½ï¼å°±åä¸ä¸ªåå­ä¸æ ·ï¼çº¿ç¨çåæ¢å¯ä»¥åçå¨ count+=1 ä¹åï¼ä¹å¯ä»¥åçå¨ count+=1 ä¹åï¼ä½å°±æ¯ä¸ä¼åçå¨ä¸­é´ãæä»¬æä¸ä¸ªæèå¤ä¸ªæä½å¨ cpu æ§è¡çè¿ç¨ä¸­ä¸è¢«ä¸­æ­çç¹æ§ç§°ä¸ºåå­æ§ãcpu è½ä¿è¯çåå­æä½æ¯ cpu æä»¤çº§å«çï¼èä¸æ¯é«çº§è¯­è¨çæä½ç¬¦ï¼è¿æ¯è¿èæä»¬ç´è§çå°æ¹ãå æ­¤ï¼å¾å¤æ¶åæä»¬éè¦å¨é«çº§è¯­è¨å±é¢ä¿è¯æä½çåå­æ§ã\n\n\n# ç¼è¯ä¼åå¸¦æ¥çæåºæ§é®é¢\n\né£å¹¶åç¼ç¨éè¿ææ²¡æå¶ä»æè¿ç´è§å®¹æå¯¼è´è¯¡å¼ bug çææ¯å¢ï¼æçï¼å°±æ¯æåºæ§ãé¡¾åæä¹ï¼æåºæ§æçæ¯ç¨åºæç§ä»£ç çååé¡ºåºæ§è¡ãç¼è¯å¨ä¸ºäºä¼åæ§è½ï¼ææ¶åä¼æ¹åç¨åºä¸­è¯­å¥çååé¡ºåºï¼ä¾å¦ç¨åºä¸­ï¼âa=6ï¼b=7ï¼âç¼è¯å¨ä¼ååå¯è½åæâb=7ï¼a=6ï¼âï¼å¨è¿ä¸ªä¾å­ä¸­ï¼ç¼è¯å¨è°æ´äºè¯­å¥çé¡ºåºï¼ä½æ¯ä¸å½±åç¨åºçæç»ç»æãä¸è¿ææ¶åç¼è¯å¨åè§£éå¨çä¼åå¯è½å¯¼è´ææ³ä¸å°ç bugã\n\nå¨ java é¢åä¸ä¸ªç»å¸çæ¡ä¾å°±æ¯å©ç¨åéæ£æ¥åå»ºåä¾å¯¹è±¡ï¼ä¾å¦ä¸é¢çä»£ç ï¼å¨è·åå®ä¾ getinstance() çæ¹æ³ä¸­ï¼æä»¬é¦åå¤æ­ instance æ¯å¦ä¸ºç©ºï¼å¦æä¸ºç©ºï¼åéå® singleton.class å¹¶åæ¬¡æ£æ¥ instance æ¯å¦ä¸ºç©ºï¼å¦æè¿ä¸ºç©ºååå»º singleton çä¸ä¸ªå®ä¾ã\n\npublic class singleton {\n  static singleton instance;\n  static singleton getinstance(){\n    if (instance == null) {\n      synchronized(singleton.class) {\n        if (instance == null)\n          instance = new singleton();\n        }\n    }\n    return instance;\n  }\n}\n\n\nåè®¾æä¸¤ä¸ªçº¿ç¨ aãb åæ¶è°ç¨ getinstance() æ¹æ³ï¼ä»ä»¬ä¼åæ¶åç° instance == null ï¼äºæ¯åæ¶å¯¹ singleton.class å éï¼æ­¤æ¶ jvm ä¿è¯åªæä¸ä¸ªçº¿ç¨è½å¤å éæåï¼åè®¾æ¯çº¿ç¨ aï¼ï¼å¦å¤ä¸ä¸ªçº¿ç¨åä¼å¤äºç­å¾ç¶æï¼åè®¾æ¯çº¿ç¨ bï¼ï¼çº¿ç¨ a ä¼åå»ºä¸ä¸ª singleton å®ä¾ï¼ä¹åéæ¾éï¼ééæ¾åï¼çº¿ç¨ b è¢«å¤éï¼çº¿ç¨ b åæ¬¡å°è¯å éï¼æ­¤æ¶æ¯å¯ä»¥å éæåçï¼å éæååï¼çº¿ç¨ b æ£æ¥ instance == null æ¶ä¼åç°ï¼å·²ç»åå»ºè¿ singleton å®ä¾äºï¼æä»¥çº¿ç¨ b ä¸ä¼ååå»ºä¸ä¸ª singleton å®ä¾ã\n\nè¿çä¸å»ä¸åé½å¾å®ç¾ï¼æ æå¯å»ï¼ä½å®éä¸è¿ä¸ª getinstance() æ¹æ³å¹¶ä¸å®ç¾ãé®é¢åºå¨åªéå¢ï¼åºå¨ new æä½ä¸ï¼æä»¬ä»¥ä¸ºç new æä½åºè¯¥æ¯ï¼\n\n 1. åéä¸ååå­ mï¼\n 2. å¨åå­ m ä¸åå§å singleton å¯¹è±¡ï¼\n 3. ç¶å m çå°åèµå¼ç» instance åéã\n\nä½æ¯å®éä¸ä¼ååçæ§è¡è·¯å¾å´æ¯è¿æ ·çï¼\n\n 1. åéä¸ååå­ mï¼\n 2. å° m çå°åèµå¼ç» instance åéï¼\n 3. æåå¨åå­ m ä¸åå§å singleton å¯¹è±¡ã\n\nä¼ååä¼å¯¼è´ä»ä¹é®é¢å¢ï¼æä»¬åè®¾çº¿ç¨ a åæ§è¡ getinstance() æ¹æ³ï¼å½æ§è¡å®æä»¤ 2 æ¶æ°å¥½åçäºçº¿ç¨åæ¢ï¼åæ¢å°äºçº¿ç¨ b ä¸ï¼å¦ææ­¤æ¶çº¿ç¨ b ä¹æ§è¡ getinstance() æ¹æ³ï¼é£ä¹çº¿ç¨ b å¨æ§è¡ç¬¬ä¸ä¸ªå¤æ­æ¶ä¼åç° instance != null ï¼æä»¥ç´æ¥è¿å instanceï¼èæ­¤æ¶ç instance æ¯æ²¡æåå§åè¿çï¼å¦ææä»¬è¿ä¸ªæ¶åè®¿é® instance çæååéå°±å¯è½è§¦åç©ºæéå¼å¸¸ã\n\n\n\n\n# ä¿è¯å¹¶åå®å¨çæè·¯\n\n# äºæ¥åæ­¥ï¼é»å¡åæ­¥ï¼\n\näºæ¥åæ­¥æ¯æå¸¸è§çå¹¶åæ­£ç¡®æ§ä¿éææ®µã\n\nåæ­¥æ¯æå¨å¤çº¿ç¨å¹¶åè®¿é®å±äº«æ°æ®æ¶ï¼ä¿è¯å±äº«æ°æ®å¨åä¸æ¶å»åªè½è¢«ä¸ä¸ªçº¿ç¨è®¿é®ã\n\näºæ¥æ¯å®ç°åæ­¥çä¸ç§ææ®µãä¸´çåºï¼critical sectionsï¼ãäºæ¥éï¼mutexï¼åä¿¡å·éï¼semaphoreï¼é½æ¯ä¸»è¦çäºæ¥å®ç°æ¹å¼ã\n\næå¸åçæ¡ä¾æ¯ä½¿ç¨ synchronized æ lock ã\n\näºæ¥åæ­¥æä¸»è¦çé®é¢æ¯çº¿ç¨é»å¡åå¤éæå¸¦æ¥çæ§è½é®é¢ï¼äºæ¥åæ­¥å±äºä¸ç§æ²è§çå¹¶åç­ç¥ï¼æ»æ¯è®¤ä¸ºåªè¦ä¸å»åæ­£ç¡®çåæ­¥æªæ½ï¼é£å°±è¯å®ä¼åºç°é®é¢ãæ è®ºå±äº«æ°æ®æ¯å¦ççä¼åºç°ç«äºï¼å®é½è¦è¿è¡å éï¼è¿éè®¨è®ºçæ¯æ¦å¿µæ¨¡åï¼å®éä¸èææºä¼ä¼åæå¾å¤§ä¸é¨åä¸å¿è¦çå éï¼ãç¨æ·ææ ¸å¿æè½¬æ¢ãç»´æ¤éè®¡æ°å¨åæ£æ¥æ¯å¦æè¢«é»å¡ççº¿ç¨éè¦å¤éç­æä½ã\n\n# éé»å¡åæ­¥\n\néçç¡¬ä»¶æä»¤éçåå±ï¼æä»¬å¯ä»¥ä½¿ç¨åºäºå²çªæ£æµçä¹è§å¹¶åç­ç¥ï¼åè¿è¡æä½ï¼å¦ææ²¡æå¶å®çº¿ç¨äºç¨å±äº«æ°æ®ï¼é£æä½å°±æåäºï¼å¦åéåè¡¥å¿æªæ½ï¼ä¸æ­å°éè¯ï¼ç´å°æåä¸ºæ­¢ï¼ãè¿ç§ä¹è§çå¹¶åç­ç¥çè®¸å¤å®ç°é½ä¸éè¦å°çº¿ç¨é»å¡ï¼å æ­¤è¿ç§åæ­¥æä½ç§°ä¸ºéé»å¡åæ­¥ã\n\nä¸ºä»ä¹è¯´ä¹è§ééè¦ ç¡¬ä»¶æä»¤éçåå± æè½è¿è¡ï¼å ä¸ºéè¦æä½åå²çªæ£æµè¿ä¸¤ä¸ªæ­¥éª¤å·å¤åå­æ§ãèè¿ç¹æ¯ç±ç¡¬ä»¶æ¥å®æï¼å¦æåä½¿ç¨äºæ¥åæ­¥æ¥ä¿è¯å°±å¤±å»æä¹äºã\n\nè¿ç±»ä¹è§éæä»¤å¸¸è§çæï¼\n\n * æµè¯å¹¶è®¾ç½®ï¼test-and-setï¼\n * è·åå¹¶å¢å ï¼fetch-and-incrementï¼\n * äº¤æ¢ï¼swapï¼\n * æ¯è¾å¹¶äº¤æ¢ï¼casï¼\n * å è½½é¾æ¥ãæ¡ä»¶å­å¨ï¼load-linked / store-conditionalï¼\n\njava å¸ååºç¨åºæ¯ï¼j.u.c åä¸­çåå­ç±»ï¼åºäº unsafe ç±»ç cas æä½ï¼\n\n# æ åæ­¥\n\nè¦ä¿è¯çº¿ç¨å®å¨ï¼ä¸ä¸å®éè¦è¿è¡åæ­¥ãåæ­¥åªæ¯ä¿è¯å±äº«æ°æ®äºç¨æ¶çæ­£ç¡®æ§ï¼å¦æä¸ä¸ªæ¹æ³æ¬æ¥å°±ä¸æ¶åå±äº«æ°æ®ï¼é£ä¹èªç¶æ é¡»åæ­¥ã\n\njava ä¸­ç æ åæ­¥æ¹æ¡ æï¼\n\n * å¯éå¥ä»£ç  - ä¹å«çº¯ä»£ç ãå¦æä¸ä¸ªæ¹æ³ï¼å®ç è¿åç»ææ¯å¯ä»¥é¢æµçï¼å³åªè¦è¾å¥äºç¸åçæ°æ®ï¼å°±è½è¿åç¸åçç»æï¼é£å®å°±æ»¡è¶³å¯éå¥æ§ï¼å½ç¶ä¹æ¯çº¿ç¨å®å¨çã\n * çº¿ç¨æ¬å°å­å¨ - ä½¿ç¨ threadlocal ä¸ºå±äº«åéå¨æ¯ä¸ªçº¿ç¨ä¸­é½åå»ºäºä¸ä¸ªæ¬å°å¯æ¬ï¼è¿ä¸ªå¯æ¬åªè½è¢«å½åçº¿ç¨è®¿é®ï¼å¶ä»çº¿ç¨æ æ³è®¿é®ï¼é£ä¹èªç¶æ¯çº¿ç¨å®å¨çã\n\n\n# æ´»è·æ§é®é¢\n\n\n# æ­»éï¼deadlockï¼\n\n# ä»ä¹æ¯æ­»é\n\nå¤ä¸ªçº¿ç¨äºç¸ç­å¾å¯¹æ¹éæ¾éã\n\næ­»éæ¯å½çº¿ç¨è¿å¥æ éæç­å¾ç¶ææ¶åççæåµï¼å ä¸ºæè¯·æ±çéè¢«å¦ä¸ä¸ªçº¿ç¨ææï¼èå¦ä¸ä¸ªçº¿ç¨åç­å¾ç¬¬ä¸ä¸ªçº¿ç¨ææçå¦ä¸ä¸ªéã\n\n\n\n# é¿åæ­»é\n\nï¼1ï¼æåºå é\n\nå½å¤ä¸ªçº¿ç¨éè¦ç¸åçä¸äºéï¼ä½æ¯æç§ä¸åçé¡ºåºå éï¼æ­»éå°±å¾å®¹æåçã\n\nå¦æè½ç¡®ä¿ææççº¿ç¨é½æ¯æç§ç¸åçé¡ºåºè·å¾éï¼é£ä¹æ­»éå°±ä¸ä¼åçã\n\næç§é¡ºåºå éæ¯ä¸ç§ææçæ­»éé¢é²æºå¶ãä½æ¯ï¼è¿ç§æ¹å¼éè¦ä½ äºåç¥éææå¯è½ä¼ç¨å°çé(è¯èæ³¨ï¼å¹¶å¯¹è¿äºéåéå½çæåº)ï¼ä½æ»æäºæ¶åæ¯æ æ³é¢ç¥çã\n\nï¼2ï¼è¶æ¶éæ¾é\n\nå¦å¤ä¸ä¸ªå¯ä»¥é¿åæ­»éçæ¹æ³æ¯å¨å°è¯è·åéçæ¶åå ä¸ä¸ªè¶æ¶æ¶é´ï¼è¿ä¹å°±æå³çå¨å°è¯è·åéçè¿ç¨ä¸­è¥è¶è¿äºè¿ä¸ªæ¶éè¯¥çº¿ç¨åæ¾å¼å¯¹è¯¥éè¯·æ±ãè¥ä¸ä¸ªçº¿ç¨æ²¡æå¨ç»å®çæ¶éåæåè·å¾ææéè¦çéï¼åä¼è¿è¡åéå¹¶éæ¾ææå·²ç»è·å¾çéï¼ç¶åç­å¾ä¸æ®µéæºçæ¶é´åéè¯ãè¿æ®µéæºçç­å¾æ¶é´è®©å¶å®çº¿ç¨ææºä¼å°è¯è·åç¸åçè¿äºéï¼å¹¶ä¸è®©è¯¥åºç¨å¨æ²¡æè·å¾éçæ¶åå¯ä»¥ç»§ç»­è¿è¡(è¯èæ³¨ï¼å éè¶æ¶åå¯ä»¥åç»§ç»­è¿è¡å¹²ç¹å¶å®äºæï¼ååå¤´æ¥éå¤ä¹åå éçé»è¾)ã\n\nï¼3ï¼æ­»éæ£æµ\n\næ­»éæ£æµæ¯ä¸ä¸ªæ´å¥½çæ­»éé¢é²æºå¶ï¼å®ä¸»è¦æ¯éå¯¹é£äºä¸å¯è½å®ç°æåºå éå¹¶ä¸éè¶æ¶ä¹ä¸å¯è¡çåºæ¯ã\n\næ¯å½ä¸ä¸ªçº¿ç¨è·å¾äºéï¼ä¼å¨çº¿ç¨åéç¸å³çæ°æ®ç»æä¸­ï¼mapãgraph ç­ç­ï¼å°å¶è®°ä¸ãé¤æ­¤ä¹å¤ï¼æ¯å½æçº¿ç¨è¯·æ±éï¼ä¹éè¦è®°å½å¨è¿ä¸ªæ°æ®ç»æä¸­ã\n\nå½ä¸ä¸ªçº¿ç¨è¯·æ±éå¤±è´¥æ¶ï¼è¿ä¸ªçº¿ç¨å¯ä»¥éåéçå³ç³»å¾ççæ¯å¦ææ­»éåçã\n\nå¦ææ£æµåºæ­»éï¼æä¸¤ç§å¤çææ®µï¼\n\n * éæ¾ææéï¼åéï¼å¹¶ä¸ç­å¾ä¸æ®µéæºçæ¶é´åéè¯ãè¿ä¸ªåç®åçå éè¶æ¶ç±»ä¼¼ï¼ä¸ä¸æ ·çæ¯åªææ­»éå·²ç»åçäºæåéï¼èä¸ä¼æ¯å ä¸ºå éçè¯·æ±è¶æ¶äºãè½ç¶æåéåç­å¾ï¼ä½æ¯å¦ææå¤§éççº¿ç¨ç«äºåä¸æ¹éï¼å®ä»¬è¿æ¯ä¼éå¤å°æ­»éï¼ç¼èæ³¨ï¼åå åè¶æ¶ç±»ä¼¼ï¼ä¸è½ä»æ ¹æ¬ä¸åè½»ç«äºï¼ã\n * ä¸ä¸ªæ´å¥½çæ¹æ¡æ¯ç»è¿äºçº¿ç¨è®¾ç½®ä¼åçº§ï¼è®©ä¸ä¸ªï¼æå ä¸ªï¼çº¿ç¨åéï¼å©ä¸ççº¿ç¨å°±åæ²¡åçæ­»éä¸æ ·ç»§ç»­ä¿æçå®ä»¬éè¦çéãå¦æèµäºè¿äºçº¿ç¨çä¼åçº§æ¯åºå®ä¸åçï¼åä¸æ¹çº¿ç¨æ»æ¯ä¼æ¥ææ´é«çä¼åçº§ãä¸ºé¿åè¿ä¸ªé®é¢ï¼å¯ä»¥å¨æ­»éåççæ¶åè®¾ç½®éæºçä¼åçº§ã\n\n\n# æ´»éï¼livelockï¼\n\n# ä»ä¹æ¯æ´»é\n\næ´»éæ¯ä¸ä¸ªéå½çæåµï¼ä¸¤ä¸ªææ´å¤ççº¿ç¨ä¼ä¸æ­éå¤ä¸ä¸ªç¹å®çä»£ç é»è¾ãé¢æçé»è¾éå¸¸ä¸ºå¶ä»çº¿ç¨æä¾æºä¼ç»§ç»­æ¯æ'this'çº¿ç¨ã\n\næ³è±¡è¿æ ·ä¸ä¸ªä¾å­ï¼ä¸¤ä¸ªäººå¨ç­çªçèµ°å»éç¸éï¼äºèé½å¾ç¤¼è²ï¼è¯å¾ç§»å°æè¾¹è®©å¯¹æ¹åéè¿ãä½æ¯ä»ä»¬æç»å¨æ²¡æåå¾ä»»ä½è¿å±çæåµä¸å·¦å³ææï¼å ä¸ºä»ä»¬é½å¨åä¸æ¶é´åç¸åçæ¹åç§»å¨ã\n\n\n\nå¦å¾æç¤ºï¼ä¸¤ä¸ªçº¿ç¨æ³è¦éè¿ä¸ä¸ª worker å¯¹è±¡è®¿é®å±äº«å¬å±èµæºçæåµï¼ä½æ¯å½ä»ä»¬çå°å¦ä¸ä¸ª workerï¼å¨å¦ä¸ä¸ªçº¿ç¨ä¸è°ç¨ï¼ä¹æ¯âæ´»å¨çâæ¶ï¼å®ä»¬ä¼å°è¯å°è¯¥èµæºäº¤ç»å¶ä»å·¥ä½èå¹¶ç­å¾ä¸ºå®å®æãå¦ææåæä»¬è®©ä¸¤åå·¥ä½äººåé½æ´»è·èµ·æ¥ï¼ä»ä»¬å°ä¼é¢ä¸´æ´»éé®é¢ã\n\n# é¿åæ´»é\n\nè§£å³âæ´»éâçæ¹æ¡å¾ç®åï¼è°¦è®©æ¶ï¼å°è¯ç­å¾ä¸ä¸ªéæºçæ¶é´å°±å¯ä»¥äºãç±äºç­å¾çæ¶é´æ¯éæºçï¼æä»¥åæ¶ç¸æååæ¬¡ç¸æçæ¦çå°±å¾ä½äºãâç­å¾ä¸ä¸ªéæºæ¶é´âçæ¹æ¡è½ç¶å¾ç®åï¼å´éå¸¸ææï¼raft è¿æ ·ç¥åçåå¸å¼ä¸è´æ§ç®æ³ä¸­ä¹ç¨å°äºå®ã\n\n\n# é¥¥é¥¿ï¼starvationï¼\n\n# ä»ä¹æ¯é¥¥é¥¿\n\n * é«ä¼åçº§çº¿ç¨åå¬ææçä½ä¼åçº§çº¿ç¨ç cpu æ¶é´ã\n * çº¿ç¨è¢«æ°¸ä¹å µå¡å¨ä¸ä¸ªç­å¾è¿å¥åæ­¥åçç¶æï¼å ä¸ºå¶ä»çº¿ç¨æ»æ¯è½å¨å®ä¹åæç»­å°å¯¹è¯¥åæ­¥åè¿è¡è®¿é®ã\n * çº¿ç¨å¨ç­å¾ä¸ä¸ªæ¬èº«(å¨å¶ä¸è°ç¨ wait())ä¹å¤äºæ°¸ä¹ç­å¾å®æçå¯¹è±¡ï¼å ä¸ºå¶ä»çº¿ç¨æ»æ¯è¢«æç»­å°è·å¾å¤éã\n\n\n\né¥¥é¥¿é®é¢æç»å¸çä¾å­å°±æ¯å²å­¦å®¶é®é¢ãå¦å¾æç¤ºï¼æäºä¸ªå²å­¦å®¶ç¨é¤ï¼æ¯ä¸ªäººè¦è·å¾ä¸¤æåå­æå¯ä»¥å°±é¤ãå½ 2ã4 å°±é¤æ¶ï¼1ã3ã5 æ°¸è¿æ æ³å°±é¤ï¼åªè½çççä¸­çç¾é£é¥¥é¥¿çç­å¾çã\n\n# è§£å³é¥¥é¥¿\n\njava ä¸å¯è½å®ç° 100% çå¬å¹³æ§ï¼æä»¬ä¾ç¶å¯ä»¥éè¿åæ­¥ç»æå¨çº¿ç¨é´å®ç°å¬å¹³æ§çæé«ã\n\næä¸ç§æ¹æ¡ï¼\n\n * ä¿è¯èµæºåè¶³\n * å¬å¹³å°åéèµæº\n * é¿åææéççº¿ç¨é¿æ¶é´æ§è¡\n\nè¿ä¸ä¸ªæ¹æ¡ä¸­ï¼æ¹æ¡ä¸åæ¹æ¡ä¸çéç¨åºæ¯æ¯è¾æéï¼å ä¸ºå¾å¤åºæ¯ä¸ï¼èµæºçç¨ç¼ºæ§æ¯æ²¡åæ³è§£å³çï¼ææéççº¿ç¨æ§è¡çæ¶é´ä¹å¾é¾ç¼©ç­ãåæ¯æ¹æ¡äºçéç¨åºæ¯ç¸å¯¹æ¥è¯´æ´å¤ä¸äºã\n\né£å¦ä½å¬å¹³å°åéèµæºå¢ï¼å¨å¹¶åç¼ç¨éï¼ä¸»è¦æ¯ä½¿ç¨å¬å¹³éãæè°å¬å¹³éï¼æ¯ä¸ç§åæ¥åå°çæ¹æ¡ï¼çº¿ç¨çç­å¾æ¯æé¡ºåºçï¼æå¨ç­å¾éååé¢ççº¿ç¨ä¼ä¼åè·å¾èµæºã\n\n\n# æ§è½é®é¢\n\nå¹¶åæ§è¡ä¸å®æ¯ä¸²è¡æ§è¡å¿«åï¼çº¿ç¨è¶å¤æ§è¡è¶å¿«åï¼\n\nç­æ¡æ¯ï¼å¹¶åä¸ä¸å®æ¯ä¸²è¡å¿«ãå ä¸ºæåå»ºçº¿ç¨åçº¿ç¨ä¸ä¸æåæ¢çå¼éã\n\n\n# ä¸ä¸æåæ¢\n\n# ä»ä¹æ¯ä¸ä¸æåæ¢ï¼\n\nå½ cpu ä»æ§è¡ä¸ä¸ªçº¿ç¨åæ¢å°æ§è¡å¦ä¸ä¸ªçº¿ç¨æ¶ï¼cpu éè¦ä¿å­å½åçº¿ç¨çæ¬å°æ°æ®ï¼ç¨åºæéç­ç¶æï¼å¹¶å è½½ä¸ä¸ä¸ªè¦æ§è¡ççº¿ç¨çæ¬å°æ°æ®ï¼ç¨åºæéç­ãè¿ä¸ªå¼å³è¢«ç§°ä¸ºâä¸ä¸æåæ¢âã\n\n# åå°ä¸ä¸æåæ¢çæ¹æ³\n\n * æ éå¹¶åç¼ç¨ - å¤çº¿ç¨ç«äºéæ¶ï¼ä¼å¼èµ·ä¸ä¸æåæ¢ï¼æä»¥å¤çº¿ç¨å¤çæ°æ®æ¶ï¼å¯ä»¥ç¨ä¸äºåæ³æ¥é¿åä½¿ç¨éï¼å¦å°æ°æ®ç id æç§ hash ç®æ³åæ¨¡åæ®µï¼ä¸åççº¿ç¨å¤çä¸åæ®µçæ°æ®ã\n * cas ç®æ³ - java ç atomic åä½¿ç¨ cas ç®æ³æ¥æ´æ°æ°æ®ï¼èä¸éè¦å éã\n * ä½¿ç¨æå°çº¿ç¨ - é¿ååå»ºä¸éè¦ççº¿ç¨ï¼æ¯å¦ä»»å¡å¾å°ï¼ä½æ¯åå»ºäºå¾å¤çº¿ç¨æ¥å¤çï¼è¿æ ·ä¼é æå¤§éçº¿ç¨é½å¤äºç­å¾ç¶æã\n * ä½¿ç¨åç¨ - å¨åçº¿ç¨éå®ç°å¤ä»»å¡çè°åº¦ï¼å¹¶å¨åçº¿ç¨éç»´æå¤ä¸ªä»»å¡é´çåæ¢ã\n\n\n# èµæºéå¶\n\n# ä»ä¹æ¯èµæºéå¶\n\nèµæºéå¶æ¯æå¨è¿è¡å¹¶åç¼ç¨æ¶ï¼ç¨åºçæ§è¡éåº¦åéäºè®¡ç®æºç¡¬ä»¶èµæºæè½¯ä»¶èµæºã\n\n# èµæºéå¶å¼åçé®é¢\n\nå¨å¹¶åç¼ç¨ä¸­ï¼å°ä»£ç æ§è¡éåº¦å å¿«çååæ¯å°ä»£ç ä¸­ä¸²è¡æ§è¡çé¨ååæå¹¶åæ§è¡ï¼ä½æ¯å¦æå°ææ®µä¸²è¡çä»£ç å¹¶åæ§è¡ï¼å ä¸ºåéäºèµæºï¼ä»ç¶å¨ä¸²è¡æ§è¡ï¼è¿æ¶åç¨åºä¸ä»ä¸ä¼å å¿«æ§è¡ï¼åèä¼æ´æ¢ï¼å ä¸ºå¢å äºä¸ä¸æåæ¢åèµæºè°åº¦çæ¶é´ã\n\n# å¦ä½è§£å³èµæºéå¶çé®é¢\n\nå¨èµæºéå¶æåµä¸è¿è¡å¹¶åç¼ç¨ï¼æ ¹æ®ä¸åçèµæºéå¶è°æ´ç¨åºçå¹¶ååº¦ã\n\n * å¯¹äºç¡¬ä»¶èµæºéå¶ï¼å¯ä»¥èèä½¿ç¨éç¾¤å¹¶è¡æ§è¡ç¨åºã\n * å¯¹äºè½¯ä»¶èµæºéå¶ï¼å¯ä»¥èèä½¿ç¨èµæºæ± å°èµæºå¤ç¨ã\n\n\n# å°ç»\n\nå¹¶åç¼ç¨å¯ä»¥æ»ç»ä¸ºä¸ä¸ªæ ¸å¿é®é¢ï¼åå·¥ãåæ­¥ãäºæ¥ã\n\n * åå·¥ï¼æ¯æå¦ä½é«æå°æè§£ä»»å¡å¹¶åéç»çº¿ç¨ã\n * åæ­¥ï¼æ¯æçº¿ç¨ä¹é´å¦ä½åä½ã\n * äºæ¥ï¼æ¯æä¿è¯åä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®å±äº«èµæºã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ java èææºã\n * ãjava å¹¶åç¼ç¨å®æã\n * http://tutorials.jenkov.com/java-concurrency/benefits.html\n * https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/thread-deadlock.html\n * https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/thread-livelock.html\n * https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/thread-starvation.html\n * https://www.zhihu.com/question/33515481\n * https://blog.csdn.net/yaosiming2011/article/details/44280797",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaåå­ç±»",frontmatter:{title:"Javaåå­ç±»",date:"2019-12-26T23:11:52.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å","åå­ç±»"],permalink:"/pages/25f78a/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/05.Java%E5%8E%9F%E5%AD%90%E7%B1%BB.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/05.Javaåå­ç±».md",key:"v-d3fa156e",path:"/pages/25f78a/",headers:[{level:2,title:"åå­åéç±»ç®ä»",slug:"åå­åéç±»ç®ä»",normalizedTitle:"åå­åéç±»ç®ä»",charIndex:17},{level:3,title:"ä¸ºä½éè¦åå­åéç±»",slug:"ä¸ºä½éè¦åå­åéç±»",normalizedTitle:"ä¸ºä½éè¦åå­åéç±»",charIndex:29},{level:3,title:"åå­åéç±»çä½ç¨",slug:"åå­åéç±»çä½ç¨",normalizedTitle:"åå­åéç±»çä½ç¨",charIndex:402},{level:2,title:"åºæ¬ç±»å",slug:"åºæ¬ç±»å",normalizedTitle:"åºæ¬ç±»å",charIndex:595},{level:3,title:"`AtomicInteger` ç¨æ³",slug:"atomicinteger-ç¨æ³",normalizedTitle:"<code>atomicinteger</code> ç¨æ³",charIndex:null},{level:3,title:"`AtomicInteger` å®ç°",slug:"atomicinteger-å®ç°",normalizedTitle:"<code>atomicinteger</code> å®ç°",charIndex:null},{level:2,title:"å¼ç¨ç±»å",slug:"å¼ç¨ç±»å",normalizedTitle:"å¼ç¨ç±»å",charIndex:684},{level:2,title:"æ°ç»ç±»å",slug:"æ°ç»ç±»å",normalizedTitle:"æ°ç»ç±»å",charIndex:812},{level:2,title:"å±æ§æ´æ°å¨ç±»å",slug:"å±æ§æ´æ°å¨ç±»å",normalizedTitle:"å±æ§æ´æ°å¨ç±»å",charIndex:924},{level:2,title:"åå­åçç´¯å å¨",slug:"åå­åçç´¯å å¨",normalizedTitle:"åå­åçç´¯å å¨",charIndex:11748},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:12230}],headersStr:"åå­åéç±»ç®ä» ä¸ºä½éè¦åå­åéç±» åå­åéç±»çä½ç¨ åºæ¬ç±»å `AtomicInteger` ç¨æ³ `AtomicInteger` å®ç° å¼ç¨ç±»å æ°ç»ç±»å å±æ§æ´æ°å¨ç±»å åå­åçç´¯å å¨ åèèµæ",content:'# Java åå­åéç±»\n\n\n# åå­åéç±»ç®ä»\n\n\n# ä¸ºä½éè¦åå­åéç±»\n\nä¿è¯çº¿ç¨å®å¨æ¯ Java å¹¶åç¼ç¨å¿é¡»è¦è§£å³çéè¦é®é¢ãJava ä»åå­æ§ãå¯è§æ§ãæåºæ§è¿ä¸å¤§ç¹æ§å¥æï¼ç¡®ä¿å¤çº¿ç¨çæ°æ®ä¸è´æ§ã\n\n * ç¡®ä¿çº¿ç¨å®å¨æå¸¸è§çåæ³æ¯å©ç¨éæºå¶ï¼Lockãsychronizedï¼æ¥å¯¹å±äº«æ°æ®åäºæ¥åæ­¥ï¼è¿æ ·å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åï¼é£ä¹æä½å¿ç¶æ¯åå­æ§çï¼çº¿ç¨å®å¨çãäºæ¥åæ­¥æä¸»è¦çé®é¢æ¯çº¿ç¨é»å¡åå¤éæå¸¦æ¥çæ§è½é®é¢ã\n * volatile æ¯è½»éçº§çéï¼èªç¶æ¯æ®ééæ§è½è¦å¥½ï¼ï¼å®ä¿è¯äºå±äº«åéå¨å¤çº¿ç¨ä¸­çå¯è§æ§ï¼ä½æ æ³ä¿è¯åå­æ§ãæä»¥ï¼å®åªè½å¨ä¸äºç¹å®åºæ¯ä¸ä½¿ç¨ã\n * ä¸ºäºå¼é¡¾åå­æ§ä»¥åéå¸¦æ¥çæ§è½é®é¢ï¼Java å¼å¥äº CAS ï¼ä¸»è¦ä½ç°å¨ Unsafe ç±»ï¼æ¥å®ç°éé»å¡åæ­¥ï¼ä¹å«ä¹è§éï¼ãå¹¶åºäº CAS ï¼æä¾äºä¸å¥åå­å·¥å·ç±»ã\n\n\n# åå­åéç±»çä½ç¨\n\nåå­åéç±» æ¯éçç²åº¦æ´ç»ï¼æ´è½»éçº§ï¼å¹¶ä¸å¯¹äºå¨å¤å¤çå¨ç³»ç»ä¸å®ç°é«æ§è½çå¹¶åä»£ç æ¥è¯´æ¯éå¸¸å³é®çãåå­åéå°åçç«äºçèå´ç¼©å°å°åä¸ªåéä¸ã\n\nåå­åéç±»ç¸å½äºä¸ç§æ³åç volatile åéï¼è½å¤æ¯æåå­çãææ¡ä»¶çè¯»/æ¹/åæä½ã\n\nåå­ç±»å¨åé¨ä½¿ç¨ CAS æä»¤ï¼åºäºç¡¬ä»¶çæ¯æï¼æ¥å®ç°åæ­¥ãè¿äºæä»¤éå¸¸æ¯éæ´å¿«ã\n\nåå­åéç±»å¯ä»¥åä¸º 4 ç»ï¼\n\n * åºæ¬ç±»å\n   * AtomicBoolean - å¸å°ç±»ååå­ç±»\n   * AtomicInteger - æ´ååå­ç±»\n   * AtomicLong - é¿æ´ååå­ç±»\n * å¼ç¨ç±»å\n   * AtomicReference - å¼ç¨ç±»ååå­ç±»\n   * AtomicMarkableReference - å¸¦ææ è®°ä½çå¼ç¨ç±»ååå­ç±»\n   * AtomicStampedReference - å¸¦æçæ¬å·çå¼ç¨ç±»ååå­ç±»\n * æ°ç»ç±»å\n   * AtomicIntegerArray - æ´å½¢æ°ç»åå­ç±»\n   * AtomicLongArray - é¿æ´åæ°ç»åå­ç±»\n   * AtomicReferenceArray - å¼ç¨ç±»åæ°ç»åå­ç±»\n * å±æ§æ´æ°å¨ç±»å\n   * AtomicIntegerFieldUpdater - æ´åå­æ®µçåå­æ´æ°å¨ã\n   * AtomicLongFieldUpdater - é¿æ´åå­æ®µçåå­æ´æ°å¨ã\n   * AtomicReferenceFieldUpdater - åå­æ´æ°å¼ç¨ç±»åéçå­æ®µã\n\n> è¿éä¸å¯¹ CASãvolatileãäºæ¥åæ­¥åæ·±å¥æ¢è®¨ãå¦ææ³äºè§£æ´å¤ç»èï¼ä¸å¦¨åèï¼Java å¹¶åæ ¸å¿æºå¶\n\n\n# åºæ¬ç±»å\n\nè¿ä¸ç±»åçåå­ç±»æ¯éå¯¹ Java åºæ¬ç±»åè¿è¡æä½ã\n\n * AtomicBoolean - å¸å°ç±»ååå­ç±»\n * AtomicInteger - æ´ååå­ç±»\n * AtomicLong - é¿æ´ååå­ç±»\n\nä»¥ä¸ç±»é½æ¯æ CASï¼compare-and-swapï¼ææ¯ï¼æ­¤å¤ï¼AtomicIntegerãAtomicLong è¿æ¯æç®æ¯è¿ç®ã\n\n> ð¡ æç¤ºï¼\n> \n> è½ç¶ Java åªæä¾äº AtomicBoolean ãAtomicIntegerãAtomicLongï¼ä½æ¯å¯ä»¥æ¨¡æå¶ä»åºæ¬ç±»åçåå­åéãè¦æ³æ¨¡æå¶ä»åºæ¬ç±»åçåå­åéï¼å¯ä»¥å° short æ byte ç­ç±»åä¸ int ç±»åè¿è¡è½¬æ¢ï¼ä»¥åä½¿ç¨ Float.floatToIntBits ãDouble.doubleToLongBits æ¥è½¬æ¢æµ®ç¹æ°ã\n> \n> ç±äº AtomicBooleanãAtomicIntegerãAtomicLong å®ç°æ¹å¼ãä½¿ç¨æ¹å¼é½ç¸è¿ï¼æä»¥æ¬æä»éå¯¹ AtomicInteger è¿è¡ä»ç»ã\n\n\n# AtomicInteger ç¨æ³\n\npublic final int get() // è·åå½åå¼\npublic final int getAndSet(int newValue) // è·åå½åå¼ï¼å¹¶è®¾ç½®æ°å¼\npublic final int getAndIncrement()// è·åå½åå¼ï¼å¹¶èªå¢\npublic final int getAndDecrement() // è·åå½åå¼ï¼å¹¶èªå\npublic final int getAndAdd(int delta) // è·åå½åå¼ï¼å¹¶å ä¸é¢æå¼\nboolean compareAndSet(int expect, int update) // å¦æè¾å¥å¼ï¼updateï¼ç­äºé¢æå¼ï¼å°è¯¥å¼è®¾ç½®ä¸ºè¾å¥å¼\npublic final void lazySet(int newValue) // æç»è®¾ç½®ä¸º newValueï¼ä½¿ç¨ lazySet è®¾ç½®ä¹åå¯è½å¯¼è´å¶ä»çº¿ç¨å¨ä¹åçä¸å°æ®µæ¶é´åè¿æ¯å¯ä»¥è¯»å°æ§çå¼ã\n\n\nAtomicInteger ä½¿ç¨ç¤ºä¾ï¼\n\npublic class AtomicIntegerDemo {\n\n    public static void main(String[] args) throws InterruptedException {\n        ExecutorService executorService = Executors.newFixedThreadPool(5);\n        AtomicInteger count = new AtomicInteger(0);\n        for (int i = 0; i < 1000; i++) {\n            executorService.submit((Runnable) () -> {\n                System.out.println(Thread.currentThread().getName() + " count=" + count.get());\n                count.incrementAndGet();\n            });\n        }\n\n        executorService.shutdown();\n        executorService.awaitTermination(30, TimeUnit.SECONDS);\n        System.out.println("Final Count is : " + count.get());\n    }\n}\n\n\n\n# AtomicInteger å®ç°\n\néè¯» AtomicInteger æºç ï¼å¯ä»¥çå°å¦ä¸å®ä¹ï¼\n\nprivate static final Unsafe unsafe = Unsafe.getUnsafe();\nprivate static final long valueOffset;\n\nstatic {\n\ttry {\n\t\tvalueOffset = unsafe.objectFieldOffset\n\t\t\t(AtomicInteger.class.getDeclaredField("value"));\n\t} catch (Exception ex) { throw new Error(ex); }\n}\n\nprivate volatile int value;\n\n\n> è¯´æï¼\n> \n>  * value - value å±æ§ä½¿ç¨ volatile ä¿®é¥°ï¼ä½¿å¾å¯¹ value çä¿®æ¹å¨å¹¶åç¯å¢ä¸å¯¹ææçº¿ç¨å¯è§ã\n>  * valueOffset - value å±æ§çåç§»éï¼éè¿è¿ä¸ªåç§»éå¯ä»¥å¿«éå®ä½å° value å­æ®µï¼è¿ä¸ªæ¯å®ç° AtomicInteger çå³é®ã\n>  * unsafe - Unsafe ç±»åçå±æ§ï¼å®ä¸º AtomicInteger æä¾äº CAS æä½ã\n\n\n# å¼ç¨ç±»å\n\nJava æ°æ®ç±»ååä¸º åºæ¬æ°æ®ç±»å å å¼ç¨æ°æ®ç±»å ä¸¤å¤§ç±»ï¼ä¸äºè§£ Java æ°æ®ç±»åååå¯ä»¥åèï¼ Java åºæ¬æ°æ®ç±»å ï¼ã\n\nä¸ä¸èä¸­æå°äºéå¯¹åºæ¬æ°æ®ç±»åçåå­ç±»ï¼é£ä¹å¦ææ³éå¯¹å¼ç¨ç±»åååå­æä½æä¹åï¼Java ä¹æä¾äºç¸å³çåå­ç±»ï¼\n\n * AtomicReference - å¼ç¨ç±»ååå­ç±»\n * AtomicMarkableReference - å¸¦ææ è®°ä½çå¼ç¨ç±»ååå­ç±»\n * AtomicStampedReference - å¸¦æçæ¬å·çå¼ç¨ç±»ååå­ç±»\n\n> AtomicStampedReference ç±»å¨å¼ç¨ç±»ååå­ç±»ä¸­ï¼å½»åºå°è§£å³äº ABA é®é¢ï¼å¶å®ç CAS è½åä¸å¦å¤ä¸¤ä¸ªç±»ç¸è¿ï¼æä»¥æå·ä»£è¡¨æ§ãå æ­¤ï¼æ¬èåªéå¯¹ AtomicStampedReference è¿è¡è¯´æã\n\nç¤ºä¾ï¼åºäº AtomicReference å®ç°ä¸ä¸ªç®åçèªæé\n\npublic class AtomicReferenceDemo2 {\n\n    private static int ticket = 10;\n\n    public static void main(String[] args) {\n        threadSafeDemo();\n    }\n\n    private static void threadSafeDemo() {\n        SpinLock lock = new SpinLock();\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        for (int i = 0; i < 5; i++) {\n            executorService.execute(new MyThread(lock));\n        }\n        executorService.shutdown();\n    }\n\n    /**\n     * åºäº {@link AtomicReference} å®ç°çç®åèªæé\n     */\n    static class SpinLock {\n\n        private AtomicReference<Thread> atomicReference = new AtomicReference<>();\n\n        public void lock() {\n            Thread current = Thread.currentThread();\n            while (!atomicReference.compareAndSet(null, current)) {}\n        }\n\n        public void unlock() {\n            Thread current = Thread.currentThread();\n            atomicReference.compareAndSet(current, null);\n        }\n\n    }\n\n    /**\n     * å©ç¨èªæé {@link SpinLock} å¹¶åå¤çæ°æ®\n     */\n    static class MyThread implements Runnable {\n\n        private SpinLock lock;\n\n        public MyThread(SpinLock lock) {\n            this.lock = lock;\n        }\n\n        @Override\n        public void run() {\n            while (ticket > 0) {\n                lock.lock();\n                if (ticket > 0) {\n                    System.out.println(Thread.currentThread().getName() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                    ticket--;\n                }\n                lock.unlock();\n            }\n        }\n\n    }\n\n}\n\n\nåå­ç±»çå®ç°åºäº CAS æºå¶ï¼è CAS å­å¨ ABA é®é¢ï¼ä¸äºè§£ ABA é®é¢ï¼å¯ä»¥åèï¼Java å¹¶ååºç¡æºå¶ - CAS çé®é¢ï¼ãæ­£æ¯ä¸ºäºè§£å³ ABA é®é¢ï¼ææäº AtomicMarkableReference å AtomicStampedReferenceã\n\nAtomicMarkableReference ä½¿ç¨ä¸ä¸ªå¸å°å¼ä½ä¸ºæ è®°ï¼ä¿®æ¹æ¶å¨ true / false ä¹é´åæ¢ãè¿ç§ç­ç¥ä¸è½æ ¹æ¬ä¸è§£å³ ABA é®é¢ï¼ä½æ¯å¯ä»¥éä½ ABA åççå çãå¸¸ç¨äºç¼å­æèç¶ææè¿°è¿æ ·çåºæ¯ã\n\npublic class AtomicMarkableReferenceDemo {\n\n    private final static String INIT_TEXT = "abc";\n\n    public static void main(String[] args) throws InterruptedException {\n\n        final AtomicMarkableReference<String> amr = new AtomicMarkableReference<>(INIT_TEXT, false);\n\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        for (int i = 0; i < 10; i++) {\n            executorService.submit(new Runnable() {\n                @Override\n                public void run() {\n                    try {\n                        Thread.sleep(Math.abs((int) (Math.random() * 100)));\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n\n                    String name = Thread.currentThread().getName();\n                    if (amr.compareAndSet(INIT_TEXT, name, amr.isMarked(), !amr.isMarked())) {\n                        System.out.println(Thread.currentThread().getName() + " ä¿®æ¹äºå¯¹è±¡ï¼");\n                        System.out.println("æ°çå¯¹è±¡ä¸ºï¼" + amr.getReference());\n                    }\n                }\n            });\n        }\n\n        executorService.shutdown();\n        executorService.awaitTermination(3, TimeUnit.SECONDS);\n    }\n\n}\n\n\nAtomicStampedReference ä½¿ç¨ä¸ä¸ªæ´åå¼åä¸ºçæ¬å·ï¼æ¯æ¬¡æ´æ°ååæ¯è¾çæ¬å·ï¼å¦æä¸è´ï¼æè¿è¡ä¿®æ¹ãéè¿è¿ç§ç­ç¥ï¼å¯ä»¥æ ¹æ¬ä¸è§£å³ ABA é®é¢ã\n\npublic class AtomicStampedReferenceDemo {\n\n    private final static String INIT_REF = "pool-1-thread-3";\n\n    private final static AtomicStampedReference<String> asr = new AtomicStampedReference<>(INIT_REF, 0);\n\n    public static void main(String[] args) throws InterruptedException {\n\n        System.out.println("åå§å¯¹è±¡ä¸ºï¼" + asr.getReference());\n\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        for (int i = 0; i < 3; i++) {\n            executorService.execute(new MyThread());\n        }\n\n        executorService.shutdown();\n        executorService.awaitTermination(3, TimeUnit.SECONDS);\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            try {\n                Thread.sleep(Math.abs((int) (Math.random() * 100)));\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n\n            final int stamp = asr.getStamp();\n            if (asr.compareAndSet(INIT_REF, Thread.currentThread().getName(), stamp, stamp + 1)) {\n                System.out.println(Thread.currentThread().getName() + " ä¿®æ¹äºå¯¹è±¡ï¼");\n                System.out.println("æ°çå¯¹è±¡ä¸ºï¼" + asr.getReference());\n            }\n        }\n\n    }\n\n}\n\n\n\n# æ°ç»ç±»å\n\nJava æä¾äºä»¥ä¸éå¯¹æ°ç»çåå­ç±»ï¼\n\n * AtomicIntegerArray - æ´å½¢æ°ç»åå­ç±»\n * AtomicLongArray - é¿æ´åæ°ç»åå­ç±»\n * AtomicReferenceArray - å¼ç¨ç±»åæ°ç»åå­ç±»\n\nå·²ç»æäºéå¯¹åºæ¬ç±»ååå¼ç¨ç±»åçåå­ç±»ï¼ä¸ºä»ä¹è¿è¦æä¾éå¯¹æ°ç»çåå­ç±»å¢ï¼\n\næ°ç»ç±»åçåå­ç±»ä¸º æ°ç»åç´  æä¾äº volatile ç±»åçè®¿é®è¯­ä¹ï¼è¿æ¯æ®éæ°ç»æä¸å·å¤çç¹æ§ââvolatile ç±»åçæ°ç»ä»å¨æ°ç»å¼ç¨ä¸å·æ volatile è¯­ä¹ã\n\nç¤ºä¾ï¼AtomicIntegerArray ä½¿ç¨ç¤ºä¾ï¼AtomicLongArray ãAtomicReferenceArray ä½¿ç¨æ¹å¼ä¹ç±»ä¼¼ï¼\n\npublic class AtomicIntegerArrayDemo {\n\n    private static AtomicIntegerArray atomicIntegerArray = new AtomicIntegerArray(10);\n\n    public static void main(final String[] arguments) throws InterruptedException {\n\n        System.out.println("Init Values: ");\n        for (int i = 0; i < atomicIntegerArray.length(); i++) {\n            atomicIntegerArray.set(i, i);\n            System.out.print(atomicIntegerArray.get(i) + " ");\n        }\n        System.out.println();\n\n        Thread t1 = new Thread(new Increment());\n        Thread t2 = new Thread(new Compare());\n        t1.start();\n        t2.start();\n\n        t1.join();\n        t2.join();\n\n        System.out.println("Final Values: ");\n        for (int i = 0; i < atomicIntegerArray.length(); i++) {\n            System.out.print(atomicIntegerArray.get(i) + " ");\n        }\n        System.out.println();\n    }\n\n    static class Increment implements Runnable {\n\n        @Override\n        public void run() {\n\n            for (int i = 0; i < atomicIntegerArray.length(); i++) {\n                int value = atomicIntegerArray.incrementAndGet(i);\n                System.out.println(Thread.currentThread().getName() + ", index = " + i + ", value = " + value);\n            }\n        }\n\n    }\n\n    static class Compare implements Runnable {\n\n        @Override\n        public void run() {\n            for (int i = 0; i < atomicIntegerArray.length(); i++) {\n                boolean swapped = atomicIntegerArray.compareAndSet(i, 2, 3);\n                if (swapped) {\n                    System.out.println(Thread.currentThread().getName() + " swapped, index = " + i + ", value = 3");\n                }\n            }\n        }\n\n    }\n\n}\n\n\n\n# å±æ§æ´æ°å¨ç±»å\n\næ´æ°å¨ç±»æ¯æåºäºåå°æºå¶çæ´æ°å­æ®µå¼çåå­æä½ã\n\n * AtomicIntegerFieldUpdater - æ´åå­æ®µçåå­æ´æ°å¨ã\n * AtomicLongFieldUpdater - é¿æ´åå­æ®µçåå­æ´æ°å¨ã\n * AtomicReferenceFieldUpdater - åå­æ´æ°å¼ç¨ç±»åéçå­æ®µã\n\nè¿äºç±»çä½¿ç¨æä¸å®éå¶ï¼\n\n * å ä¸ºå¯¹è±¡çå±æ§ä¿®æ¹ç±»ååå­ç±»é½æ¯æ½è±¡ç±»ï¼æä»¥æ¯æ¬¡ä½¿ç¨é½å¿é¡»ä½¿ç¨éææ¹æ³ newUpdater() åå»ºä¸ä¸ªæ´æ°å¨ï¼å¹¶ä¸éè¦è®¾ç½®æ³è¦æ´æ°çç±»åå±æ§ã\n * å­æ®µå¿é¡»æ¯ volatile ç±»åçï¼\n * ä¸è½ä½ç¨äºéæåéï¼staticï¼ï¼\n * ä¸è½ä½ç¨äºå¸¸éï¼finalï¼ï¼\n\npublic class AtomicReferenceFieldUpdaterDemo {\n\n    static User user = new User("begin");\n\n    static AtomicReferenceFieldUpdater<User, String> updater =\n        AtomicReferenceFieldUpdater.newUpdater(User.class, String.class, "name");\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        for (int i = 0; i < 5; i++) {\n            executorService.execute(new MyThread());\n        }\n        executorService.shutdown();\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            if (updater.compareAndSet(user, "begin", "end")) {\n                try {\n                    TimeUnit.SECONDS.sleep(1);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(Thread.currentThread().getName() + " å·²ä¿®æ¹ name = " + user.getName());\n            } else {\n                System.out.println(Thread.currentThread().getName() + " å·²è¢«å¶ä»çº¿ç¨ä¿®æ¹");\n            }\n        }\n\n    }\n\n    static class User {\n\n        volatile String name;\n\n        public User(String name) {\n            this.name = name;\n        }\n\n        public String getName() {\n            return name;\n        }\n\n        public User setName(String name) {\n            this.name = name;\n            return this;\n        }\n\n    }\n\n}\n\n\n\n# åå­åçç´¯å å¨\n\nDoubleAccumulatorãDoubleAdderãLongAccumulator å LongAdderï¼è¿åä¸ªç±»ä»ä»ç¨æ¥æ§è¡ç´¯å æä½ï¼ç¸æ¯åå­åçåºæ¬æ°æ®ç±»åï¼éåº¦æ´å¿«ï¼ä½æ¯ä¸æ¯æ compareAndSet() æ¹æ³ãå¦æä½ ä»ä»éè¦ç´¯å æä½ï¼ä½¿ç¨åå­åçç´¯å å¨æ§è½ä¼æ´å¥½ï¼ä»£ä»·å°±æ¯ä¼æ¶èæ´å¤çåå­ç©ºé´ã\n\nLongAdder åé¨ç±ä¸ä¸ª base åéåä¸ä¸ª cell[] æ°ç»ç»æã\n\n * å½åªæä¸ä¸ªåçº¿ç¨ï¼æ²¡æç«äºçæåµä¸ï¼LongAdder ä¼ç´æ¥ä½¿ç¨ base åéä½ä¸ºåå­æä½åéï¼éè¿ CAS æä½ä¿®æ¹åéï¼\n * å½æå¤ä¸ªåçº¿ç¨ç«äºçæåµä¸ï¼é¤äºå ç¨ base åéçä¸ä¸ªåçº¿ç¨ä¹å¤ï¼å¶å®åä¸ªçº¿ç¨ä¼å°ä¿®æ¹çåéåå¥å°èªå·±çæ§½ cell[] æ°ç»ä¸­ã\n\næä»¬å¯ä»¥åç°ï¼LongAdder å¨æä½åçè¿åå¼åªæ¯ä¸ä¸ªè¿ä¼¼åç¡®çæ°å¼ï¼ä½æ¯ LongAdder æç»è¿åçæ¯ä¸ä¸ªåç¡®çæ°å¼ï¼ æä»¥å¨ä¸äºå¯¹å®æ¶æ§è¦æ±æ¯è¾é«çåºæ¯ä¸ï¼LongAdder å¹¶ä¸è½åä»£ AtomicInteger æ AtomicLongã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * JUC ä¸­çåå­ç±»\n * http://tutorials.jenkov.com/java-util-concurrent/atomicinteger.html\n * http://tutorials.jenkov.com/java-util-concurrent/atomicintegerarray.html\n * http://tutorials.jenkov.com/java-util-concurrent/atomicreference.html\n * http://tutorials.jenkov.com/java-util-concurrent/atomicstampedreference.htm',normalizedContent:'# java åå­åéç±»\n\n\n# åå­åéç±»ç®ä»\n\n\n# ä¸ºä½éè¦åå­åéç±»\n\nä¿è¯çº¿ç¨å®å¨æ¯ java å¹¶åç¼ç¨å¿é¡»è¦è§£å³çéè¦é®é¢ãjava ä»åå­æ§ãå¯è§æ§ãæåºæ§è¿ä¸å¤§ç¹æ§å¥æï¼ç¡®ä¿å¤çº¿ç¨çæ°æ®ä¸è´æ§ã\n\n * ç¡®ä¿çº¿ç¨å®å¨æå¸¸è§çåæ³æ¯å©ç¨éæºå¶ï¼lockãsychronizedï¼æ¥å¯¹å±äº«æ°æ®åäºæ¥åæ­¥ï¼è¿æ ·å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åï¼é£ä¹æä½å¿ç¶æ¯åå­æ§çï¼çº¿ç¨å®å¨çãäºæ¥åæ­¥æä¸»è¦çé®é¢æ¯çº¿ç¨é»å¡åå¤éæå¸¦æ¥çæ§è½é®é¢ã\n * volatile æ¯è½»éçº§çéï¼èªç¶æ¯æ®ééæ§è½è¦å¥½ï¼ï¼å®ä¿è¯äºå±äº«åéå¨å¤çº¿ç¨ä¸­çå¯è§æ§ï¼ä½æ æ³ä¿è¯åå­æ§ãæä»¥ï¼å®åªè½å¨ä¸äºç¹å®åºæ¯ä¸ä½¿ç¨ã\n * ä¸ºäºå¼é¡¾åå­æ§ä»¥åéå¸¦æ¥çæ§è½é®é¢ï¼java å¼å¥äº cas ï¼ä¸»è¦ä½ç°å¨ unsafe ç±»ï¼æ¥å®ç°éé»å¡åæ­¥ï¼ä¹å«ä¹è§éï¼ãå¹¶åºäº cas ï¼æä¾äºä¸å¥åå­å·¥å·ç±»ã\n\n\n# åå­åéç±»çä½ç¨\n\nåå­åéç±» æ¯éçç²åº¦æ´ç»ï¼æ´è½»éçº§ï¼å¹¶ä¸å¯¹äºå¨å¤å¤çå¨ç³»ç»ä¸å®ç°é«æ§è½çå¹¶åä»£ç æ¥è¯´æ¯éå¸¸å³é®çãåå­åéå°åçç«äºçèå´ç¼©å°å°åä¸ªåéä¸ã\n\nåå­åéç±»ç¸å½äºä¸ç§æ³åç volatile åéï¼è½å¤æ¯æåå­çãææ¡ä»¶çè¯»/æ¹/åæä½ã\n\nåå­ç±»å¨åé¨ä½¿ç¨ cas æä»¤ï¼åºäºç¡¬ä»¶çæ¯æï¼æ¥å®ç°åæ­¥ãè¿äºæä»¤éå¸¸æ¯éæ´å¿«ã\n\nåå­åéç±»å¯ä»¥åä¸º 4 ç»ï¼\n\n * åºæ¬ç±»å\n   * atomicboolean - å¸å°ç±»ååå­ç±»\n   * atomicinteger - æ´ååå­ç±»\n   * atomiclong - é¿æ´ååå­ç±»\n * å¼ç¨ç±»å\n   * atomicreference - å¼ç¨ç±»ååå­ç±»\n   * atomicmarkablereference - å¸¦ææ è®°ä½çå¼ç¨ç±»ååå­ç±»\n   * atomicstampedreference - å¸¦æçæ¬å·çå¼ç¨ç±»ååå­ç±»\n * æ°ç»ç±»å\n   * atomicintegerarray - æ´å½¢æ°ç»åå­ç±»\n   * atomiclongarray - é¿æ´åæ°ç»åå­ç±»\n   * atomicreferencearray - å¼ç¨ç±»åæ°ç»åå­ç±»\n * å±æ§æ´æ°å¨ç±»å\n   * atomicintegerfieldupdater - æ´åå­æ®µçåå­æ´æ°å¨ã\n   * atomiclongfieldupdater - é¿æ´åå­æ®µçåå­æ´æ°å¨ã\n   * atomicreferencefieldupdater - åå­æ´æ°å¼ç¨ç±»åéçå­æ®µã\n\n> è¿éä¸å¯¹ casãvolatileãäºæ¥åæ­¥åæ·±å¥æ¢è®¨ãå¦ææ³äºè§£æ´å¤ç»èï¼ä¸å¦¨åèï¼java å¹¶åæ ¸å¿æºå¶\n\n\n# åºæ¬ç±»å\n\nè¿ä¸ç±»åçåå­ç±»æ¯éå¯¹ java åºæ¬ç±»åè¿è¡æä½ã\n\n * atomicboolean - å¸å°ç±»ååå­ç±»\n * atomicinteger - æ´ååå­ç±»\n * atomiclong - é¿æ´ååå­ç±»\n\nä»¥ä¸ç±»é½æ¯æ casï¼compare-and-swapï¼ææ¯ï¼æ­¤å¤ï¼atomicintegerãatomiclong è¿æ¯æç®æ¯è¿ç®ã\n\n> ð¡ æç¤ºï¼\n> \n> è½ç¶ java åªæä¾äº atomicboolean ãatomicintegerãatomiclongï¼ä½æ¯å¯ä»¥æ¨¡æå¶ä»åºæ¬ç±»åçåå­åéãè¦æ³æ¨¡æå¶ä»åºæ¬ç±»åçåå­åéï¼å¯ä»¥å° short æ byte ç­ç±»åä¸ int ç±»åè¿è¡è½¬æ¢ï¼ä»¥åä½¿ç¨ float.floattointbits ãdouble.doubletolongbits æ¥è½¬æ¢æµ®ç¹æ°ã\n> \n> ç±äº atomicbooleanãatomicintegerãatomiclong å®ç°æ¹å¼ãä½¿ç¨æ¹å¼é½ç¸è¿ï¼æä»¥æ¬æä»éå¯¹ atomicinteger è¿è¡ä»ç»ã\n\n\n# atomicinteger ç¨æ³\n\npublic final int get() // è·åå½åå¼\npublic final int getandset(int newvalue) // è·åå½åå¼ï¼å¹¶è®¾ç½®æ°å¼\npublic final int getandincrement()// è·åå½åå¼ï¼å¹¶èªå¢\npublic final int getanddecrement() // è·åå½åå¼ï¼å¹¶èªå\npublic final int getandadd(int delta) // è·åå½åå¼ï¼å¹¶å ä¸é¢æå¼\nboolean compareandset(int expect, int update) // å¦æè¾å¥å¼ï¼updateï¼ç­äºé¢æå¼ï¼å°è¯¥å¼è®¾ç½®ä¸ºè¾å¥å¼\npublic final void lazyset(int newvalue) // æç»è®¾ç½®ä¸º newvalueï¼ä½¿ç¨ lazyset è®¾ç½®ä¹åå¯è½å¯¼è´å¶ä»çº¿ç¨å¨ä¹åçä¸å°æ®µæ¶é´åè¿æ¯å¯ä»¥è¯»å°æ§çå¼ã\n\n\natomicinteger ä½¿ç¨ç¤ºä¾ï¼\n\npublic class atomicintegerdemo {\n\n    public static void main(string[] args) throws interruptedexception {\n        executorservice executorservice = executors.newfixedthreadpool(5);\n        atomicinteger count = new atomicinteger(0);\n        for (int i = 0; i < 1000; i++) {\n            executorservice.submit((runnable) () -> {\n                system.out.println(thread.currentthread().getname() + " count=" + count.get());\n                count.incrementandget();\n            });\n        }\n\n        executorservice.shutdown();\n        executorservice.awaittermination(30, timeunit.seconds);\n        system.out.println("final count is : " + count.get());\n    }\n}\n\n\n\n# atomicinteger å®ç°\n\néè¯» atomicinteger æºç ï¼å¯ä»¥çå°å¦ä¸å®ä¹ï¼\n\nprivate static final unsafe unsafe = unsafe.getunsafe();\nprivate static final long valueoffset;\n\nstatic {\n\ttry {\n\t\tvalueoffset = unsafe.objectfieldoffset\n\t\t\t(atomicinteger.class.getdeclaredfield("value"));\n\t} catch (exception ex) { throw new error(ex); }\n}\n\nprivate volatile int value;\n\n\n> è¯´æï¼\n> \n>  * value - value å±æ§ä½¿ç¨ volatile ä¿®é¥°ï¼ä½¿å¾å¯¹ value çä¿®æ¹å¨å¹¶åç¯å¢ä¸å¯¹ææçº¿ç¨å¯è§ã\n>  * valueoffset - value å±æ§çåç§»éï¼éè¿è¿ä¸ªåç§»éå¯ä»¥å¿«éå®ä½å° value å­æ®µï¼è¿ä¸ªæ¯å®ç° atomicinteger çå³é®ã\n>  * unsafe - unsafe ç±»åçå±æ§ï¼å®ä¸º atomicinteger æä¾äº cas æä½ã\n\n\n# å¼ç¨ç±»å\n\njava æ°æ®ç±»ååä¸º åºæ¬æ°æ®ç±»å å å¼ç¨æ°æ®ç±»å ä¸¤å¤§ç±»ï¼ä¸äºè§£ java æ°æ®ç±»åååå¯ä»¥åèï¼ java åºæ¬æ°æ®ç±»å ï¼ã\n\nä¸ä¸èä¸­æå°äºéå¯¹åºæ¬æ°æ®ç±»åçåå­ç±»ï¼é£ä¹å¦ææ³éå¯¹å¼ç¨ç±»åååå­æä½æä¹åï¼java ä¹æä¾äºç¸å³çåå­ç±»ï¼\n\n * atomicreference - å¼ç¨ç±»ååå­ç±»\n * atomicmarkablereference - å¸¦ææ è®°ä½çå¼ç¨ç±»ååå­ç±»\n * atomicstampedreference - å¸¦æçæ¬å·çå¼ç¨ç±»ååå­ç±»\n\n> atomicstampedreference ç±»å¨å¼ç¨ç±»ååå­ç±»ä¸­ï¼å½»åºå°è§£å³äº aba é®é¢ï¼å¶å®ç cas è½åä¸å¦å¤ä¸¤ä¸ªç±»ç¸è¿ï¼æä»¥æå·ä»£è¡¨æ§ãå æ­¤ï¼æ¬èåªéå¯¹ atomicstampedreference è¿è¡è¯´æã\n\nç¤ºä¾ï¼åºäº atomicreference å®ç°ä¸ä¸ªç®åçèªæé\n\npublic class atomicreferencedemo2 {\n\n    private static int ticket = 10;\n\n    public static void main(string[] args) {\n        threadsafedemo();\n    }\n\n    private static void threadsafedemo() {\n        spinlock lock = new spinlock();\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        for (int i = 0; i < 5; i++) {\n            executorservice.execute(new mythread(lock));\n        }\n        executorservice.shutdown();\n    }\n\n    /**\n     * åºäº {@link atomicreference} å®ç°çç®åèªæé\n     */\n    static class spinlock {\n\n        private atomicreference<thread> atomicreference = new atomicreference<>();\n\n        public void lock() {\n            thread current = thread.currentthread();\n            while (!atomicreference.compareandset(null, current)) {}\n        }\n\n        public void unlock() {\n            thread current = thread.currentthread();\n            atomicreference.compareandset(current, null);\n        }\n\n    }\n\n    /**\n     * å©ç¨èªæé {@link spinlock} å¹¶åå¤çæ°æ®\n     */\n    static class mythread implements runnable {\n\n        private spinlock lock;\n\n        public mythread(spinlock lock) {\n            this.lock = lock;\n        }\n\n        @override\n        public void run() {\n            while (ticket > 0) {\n                lock.lock();\n                if (ticket > 0) {\n                    system.out.println(thread.currentthread().getname() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                    ticket--;\n                }\n                lock.unlock();\n            }\n        }\n\n    }\n\n}\n\n\nåå­ç±»çå®ç°åºäº cas æºå¶ï¼è cas å­å¨ aba é®é¢ï¼ä¸äºè§£ aba é®é¢ï¼å¯ä»¥åèï¼java å¹¶ååºç¡æºå¶ - cas çé®é¢ï¼ãæ­£æ¯ä¸ºäºè§£å³ aba é®é¢ï¼ææäº atomicmarkablereference å atomicstampedreferenceã\n\natomicmarkablereference ä½¿ç¨ä¸ä¸ªå¸å°å¼ä½ä¸ºæ è®°ï¼ä¿®æ¹æ¶å¨ true / false ä¹é´åæ¢ãè¿ç§ç­ç¥ä¸è½æ ¹æ¬ä¸è§£å³ aba é®é¢ï¼ä½æ¯å¯ä»¥éä½ aba åççå çãå¸¸ç¨äºç¼å­æèç¶ææè¿°è¿æ ·çåºæ¯ã\n\npublic class atomicmarkablereferencedemo {\n\n    private final static string init_text = "abc";\n\n    public static void main(string[] args) throws interruptedexception {\n\n        final atomicmarkablereference<string> amr = new atomicmarkablereference<>(init_text, false);\n\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        for (int i = 0; i < 10; i++) {\n            executorservice.submit(new runnable() {\n                @override\n                public void run() {\n                    try {\n                        thread.sleep(math.abs((int) (math.random() * 100)));\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n\n                    string name = thread.currentthread().getname();\n                    if (amr.compareandset(init_text, name, amr.ismarked(), !amr.ismarked())) {\n                        system.out.println(thread.currentthread().getname() + " ä¿®æ¹äºå¯¹è±¡ï¼");\n                        system.out.println("æ°çå¯¹è±¡ä¸ºï¼" + amr.getreference());\n                    }\n                }\n            });\n        }\n\n        executorservice.shutdown();\n        executorservice.awaittermination(3, timeunit.seconds);\n    }\n\n}\n\n\natomicstampedreference ä½¿ç¨ä¸ä¸ªæ´åå¼åä¸ºçæ¬å·ï¼æ¯æ¬¡æ´æ°ååæ¯è¾çæ¬å·ï¼å¦æä¸è´ï¼æè¿è¡ä¿®æ¹ãéè¿è¿ç§ç­ç¥ï¼å¯ä»¥æ ¹æ¬ä¸è§£å³ aba é®é¢ã\n\npublic class atomicstampedreferencedemo {\n\n    private final static string init_ref = "pool-1-thread-3";\n\n    private final static atomicstampedreference<string> asr = new atomicstampedreference<>(init_ref, 0);\n\n    public static void main(string[] args) throws interruptedexception {\n\n        system.out.println("åå§å¯¹è±¡ä¸ºï¼" + asr.getreference());\n\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        for (int i = 0; i < 3; i++) {\n            executorservice.execute(new mythread());\n        }\n\n        executorservice.shutdown();\n        executorservice.awaittermination(3, timeunit.seconds);\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            try {\n                thread.sleep(math.abs((int) (math.random() * 100)));\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n\n            final int stamp = asr.getstamp();\n            if (asr.compareandset(init_ref, thread.currentthread().getname(), stamp, stamp + 1)) {\n                system.out.println(thread.currentthread().getname() + " ä¿®æ¹äºå¯¹è±¡ï¼");\n                system.out.println("æ°çå¯¹è±¡ä¸ºï¼" + asr.getreference());\n            }\n        }\n\n    }\n\n}\n\n\n\n# æ°ç»ç±»å\n\njava æä¾äºä»¥ä¸éå¯¹æ°ç»çåå­ç±»ï¼\n\n * atomicintegerarray - æ´å½¢æ°ç»åå­ç±»\n * atomiclongarray - é¿æ´åæ°ç»åå­ç±»\n * atomicreferencearray - å¼ç¨ç±»åæ°ç»åå­ç±»\n\nå·²ç»æäºéå¯¹åºæ¬ç±»ååå¼ç¨ç±»åçåå­ç±»ï¼ä¸ºä»ä¹è¿è¦æä¾éå¯¹æ°ç»çåå­ç±»å¢ï¼\n\næ°ç»ç±»åçåå­ç±»ä¸º æ°ç»åç´  æä¾äº volatile ç±»åçè®¿é®è¯­ä¹ï¼è¿æ¯æ®éæ°ç»æä¸å·å¤çç¹æ§ââvolatile ç±»åçæ°ç»ä»å¨æ°ç»å¼ç¨ä¸å·æ volatile è¯­ä¹ã\n\nç¤ºä¾ï¼atomicintegerarray ä½¿ç¨ç¤ºä¾ï¼atomiclongarray ãatomicreferencearray ä½¿ç¨æ¹å¼ä¹ç±»ä¼¼ï¼\n\npublic class atomicintegerarraydemo {\n\n    private static atomicintegerarray atomicintegerarray = new atomicintegerarray(10);\n\n    public static void main(final string[] arguments) throws interruptedexception {\n\n        system.out.println("init values: ");\n        for (int i = 0; i < atomicintegerarray.length(); i++) {\n            atomicintegerarray.set(i, i);\n            system.out.print(atomicintegerarray.get(i) + " ");\n        }\n        system.out.println();\n\n        thread t1 = new thread(new increment());\n        thread t2 = new thread(new compare());\n        t1.start();\n        t2.start();\n\n        t1.join();\n        t2.join();\n\n        system.out.println("final values: ");\n        for (int i = 0; i < atomicintegerarray.length(); i++) {\n            system.out.print(atomicintegerarray.get(i) + " ");\n        }\n        system.out.println();\n    }\n\n    static class increment implements runnable {\n\n        @override\n        public void run() {\n\n            for (int i = 0; i < atomicintegerarray.length(); i++) {\n                int value = atomicintegerarray.incrementandget(i);\n                system.out.println(thread.currentthread().getname() + ", index = " + i + ", value = " + value);\n            }\n        }\n\n    }\n\n    static class compare implements runnable {\n\n        @override\n        public void run() {\n            for (int i = 0; i < atomicintegerarray.length(); i++) {\n                boolean swapped = atomicintegerarray.compareandset(i, 2, 3);\n                if (swapped) {\n                    system.out.println(thread.currentthread().getname() + " swapped, index = " + i + ", value = 3");\n                }\n            }\n        }\n\n    }\n\n}\n\n\n\n# å±æ§æ´æ°å¨ç±»å\n\næ´æ°å¨ç±»æ¯æåºäºåå°æºå¶çæ´æ°å­æ®µå¼çåå­æä½ã\n\n * atomicintegerfieldupdater - æ´åå­æ®µçåå­æ´æ°å¨ã\n * atomiclongfieldupdater - é¿æ´åå­æ®µçåå­æ´æ°å¨ã\n * atomicreferencefieldupdater - åå­æ´æ°å¼ç¨ç±»åéçå­æ®µã\n\nè¿äºç±»çä½¿ç¨æä¸å®éå¶ï¼\n\n * å ä¸ºå¯¹è±¡çå±æ§ä¿®æ¹ç±»ååå­ç±»é½æ¯æ½è±¡ç±»ï¼æä»¥æ¯æ¬¡ä½¿ç¨é½å¿é¡»ä½¿ç¨éææ¹æ³ newupdater() åå»ºä¸ä¸ªæ´æ°å¨ï¼å¹¶ä¸éè¦è®¾ç½®æ³è¦æ´æ°çç±»åå±æ§ã\n * å­æ®µå¿é¡»æ¯ volatile ç±»åçï¼\n * ä¸è½ä½ç¨äºéæåéï¼staticï¼ï¼\n * ä¸è½ä½ç¨äºå¸¸éï¼finalï¼ï¼\n\npublic class atomicreferencefieldupdaterdemo {\n\n    static user user = new user("begin");\n\n    static atomicreferencefieldupdater<user, string> updater =\n        atomicreferencefieldupdater.newupdater(user.class, string.class, "name");\n\n    public static void main(string[] args) {\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        for (int i = 0; i < 5; i++) {\n            executorservice.execute(new mythread());\n        }\n        executorservice.shutdown();\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            if (updater.compareandset(user, "begin", "end")) {\n                try {\n                    timeunit.seconds.sleep(1);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n                system.out.println(thread.currentthread().getname() + " å·²ä¿®æ¹ name = " + user.getname());\n            } else {\n                system.out.println(thread.currentthread().getname() + " å·²è¢«å¶ä»çº¿ç¨ä¿®æ¹");\n            }\n        }\n\n    }\n\n    static class user {\n\n        volatile string name;\n\n        public user(string name) {\n            this.name = name;\n        }\n\n        public string getname() {\n            return name;\n        }\n\n        public user setname(string name) {\n            this.name = name;\n            return this;\n        }\n\n    }\n\n}\n\n\n\n# åå­åçç´¯å å¨\n\ndoubleaccumulatorãdoubleadderãlongaccumulator å longadderï¼è¿åä¸ªç±»ä»ä»ç¨æ¥æ§è¡ç´¯å æä½ï¼ç¸æ¯åå­åçåºæ¬æ°æ®ç±»åï¼éåº¦æ´å¿«ï¼ä½æ¯ä¸æ¯æ compareandset() æ¹æ³ãå¦æä½ ä»ä»éè¦ç´¯å æä½ï¼ä½¿ç¨åå­åçç´¯å å¨æ§è½ä¼æ´å¥½ï¼ä»£ä»·å°±æ¯ä¼æ¶èæ´å¤çåå­ç©ºé´ã\n\nlongadder åé¨ç±ä¸ä¸ª base åéåä¸ä¸ª cell[] æ°ç»ç»æã\n\n * å½åªæä¸ä¸ªåçº¿ç¨ï¼æ²¡æç«äºçæåµä¸ï¼longadder ä¼ç´æ¥ä½¿ç¨ base åéä½ä¸ºåå­æä½åéï¼éè¿ cas æä½ä¿®æ¹åéï¼\n * å½æå¤ä¸ªåçº¿ç¨ç«äºçæåµä¸ï¼é¤äºå ç¨ base åéçä¸ä¸ªåçº¿ç¨ä¹å¤ï¼å¶å®åä¸ªçº¿ç¨ä¼å°ä¿®æ¹çåéåå¥å°èªå·±çæ§½ cell[] æ°ç»ä¸­ã\n\næä»¬å¯ä»¥åç°ï¼longadder å¨æä½åçè¿åå¼åªæ¯ä¸ä¸ªè¿ä¼¼åç¡®çæ°å¼ï¼ä½æ¯ longadder æç»è¿åçæ¯ä¸ä¸ªåç¡®çæ°å¼ï¼ æä»¥å¨ä¸äºå¯¹å®æ¶æ§è¦æ±æ¯è¾é«çåºæ¯ä¸ï¼longadder å¹¶ä¸è½åä»£ atomicinteger æ atomiclongã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * juc ä¸­çåå­ç±»\n * http://tutorials.jenkov.com/java-util-concurrent/atomicinteger.html\n * http://tutorials.jenkov.com/java-util-concurrent/atomicintegerarray.html\n * http://tutorials.jenkov.com/java-util-concurrent/atomicreference.html\n * http://tutorials.jenkov.com/java-util-concurrent/atomicstampedreference.htm',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaå¹¶åæ ¸å¿æºå¶",frontmatter:{title:"Javaå¹¶åæ ¸å¿æºå¶",date:"2019-12-25T22:19:09.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å"],permalink:"/pages/2c6488/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/03.Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/03.Javaå¹¶åæ ¸å¿æºå¶.md",key:"v-06ff1f1b",path:"/pages/2c6488/",headers:[{level:2,title:"J.U.C ç®ä»",slug:"j-u-c-ç®ä»",normalizedTitle:"j.u.c ç®ä»",charIndex:86},{level:2,title:"synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:643},{level:3,title:"synchronized çåºç¨",slug:"synchronized-çåºç¨",normalizedTitle:"synchronized çåºç¨",charIndex:1162},{level:4,title:"åæ­¥å®ä¾æ¹æ³",slug:"åæ­¥å®ä¾æ¹æ³",normalizedTitle:"åæ­¥å®ä¾æ¹æ³",charIndex:1208},{level:4,title:"åæ­¥éææ¹æ³",slug:"åæ­¥éææ¹æ³",normalizedTitle:"åæ­¥éææ¹æ³",charIndex:1238},{level:4,title:"åæ­¥ä»£ç å",slug:"åæ­¥ä»£ç å",normalizedTitle:"åæ­¥ä»£ç å",charIndex:1275},{level:3,title:"synchronized çåç",slug:"synchronized-çåç",normalizedTitle:"synchronized çåç",charIndex:7147},{level:4,title:"åæ­¥ä»£ç å",slug:"åæ­¥ä»£ç å-2",normalizedTitle:"åæ­¥ä»£ç å",charIndex:1275},{level:4,title:"åæ­¥æ¹æ³",slug:"åæ­¥æ¹æ³",normalizedTitle:"åæ­¥æ¹æ³",charIndex:1221},{level:4,title:"Monitor",slug:"monitor",normalizedTitle:"monitor",charIndex:7219},{level:3,title:"synchronized çä¼å",slug:"synchronized-çä¼å",normalizedTitle:"synchronized çä¼å",charIndex:8878},{level:4,title:"Java å¯¹è±¡å¤´",slug:"java-å¯¹è±¡å¤´",normalizedTitle:"java å¯¹è±¡å¤´",charIndex:8968},{level:4,title:"ååé",slug:"ååé",normalizedTitle:"ååé",charIndex:9193},{level:4,title:"è½»éçº§é",slug:"è½»éçº§é",normalizedTitle:"è½»éçº§é",charIndex:9242},{level:4,title:"éæ¶é¤ / éç²å",slug:"éæ¶é¤-éç²å",normalizedTitle:"éæ¶é¤ / éç²å",charIndex:10118},{level:4,title:"èªæé",slug:"èªæé",normalizedTitle:"èªæé",charIndex:11260},{level:3,title:"synchronized çè¯¯åº",slug:"synchronized-çè¯¯åº",normalizedTitle:"synchronized çè¯¯åº",charIndex:11522},{level:4,title:"synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯",slug:"synchronized-ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯",normalizedTitle:"synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯",charIndex:11572},{level:4,title:"synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯",slug:"synchronized-ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯",normalizedTitle:"synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯",charIndex:13155},{level:4,title:"éç²åº¦å¯¼è´çé®é¢",slug:"éç²åº¦å¯¼è´çé®é¢",normalizedTitle:"éç²åº¦å¯¼è´çé®é¢",charIndex:14365},{level:2,title:"volatile",slug:"volatile",normalizedTitle:"volatile",charIndex:656},{level:3,title:"volatile çè¦ç¹",slug:"volatile-çè¦ç¹",normalizedTitle:"volatile çè¦ç¹",charIndex:15720},{level:3,title:"volatile çåºç¨",slug:"volatile-çåºç¨",normalizedTitle:"volatile çåºç¨",charIndex:15965},{level:3,title:"volatile çåç",slug:"volatile-çåç",normalizedTitle:"volatile çåç",charIndex:16689},{level:3,title:"volatile çé®é¢",slug:"volatile-çé®é¢",normalizedTitle:"volatile çé®é¢",charIndex:16971},{level:2,title:"CAS",slug:"cas",normalizedTitle:"cas",charIndex:665},{level:3,title:"CAS çè¦ç¹",slug:"cas-çè¦ç¹",normalizedTitle:"cas çè¦ç¹",charIndex:17150},{level:3,title:"CAS çåºç¨",slug:"cas-çåºç¨",normalizedTitle:"cas çåºç¨",charIndex:17698},{level:4,title:"åå­ç±»",slug:"åå­ç±»",normalizedTitle:"åå­ç±»",charIndex:206},{level:4,title:"èªæé",slug:"èªæé-2",normalizedTitle:"èªæé",charIndex:11260},{level:3,title:"CAS çåç",slug:"cas-çåç",normalizedTitle:"cas çåç",charIndex:21567},{level:3,title:"CAS çé®é¢",slug:"cas-çé®é¢",normalizedTitle:"cas çé®é¢",charIndex:21726},{level:4,title:"ABA é®é¢",slug:"aba-é®é¢",normalizedTitle:"aba é®é¢",charIndex:21818},{level:4,title:"å¾ªç¯æ¶é´é¿å¼éå¤§",slug:"å¾ªç¯æ¶é´é¿å¼éå¤§",normalizedTitle:"å¾ªç¯æ¶é´é¿å¼éå¤§",charIndex:21828},{level:4,title:"åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§",slug:"åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§",normalizedTitle:"åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§",charIndex:21840},{level:2,title:"ThreadLocal",slug:"threadlocal",normalizedTitle:"threadlocal",charIndex:669},{level:3,title:"ThreadLocal çåºç¨",slug:"threadlocal-çåºç¨",normalizedTitle:"threadlocal çåºç¨",charIndex:22969},{level:3,title:"ThreadLocal çåç",slug:"threadlocal-çåç",normalizedTitle:"threadlocal çåç",charIndex:25355},{level:4,title:"å­å¨ç»æ",slug:"å­å¨ç»æ",normalizedTitle:"å­å¨ç»æ",charIndex:9143},{level:4,title:"å¦ä½è§£å³ Hash å²çª",slug:"å¦ä½è§£å³-hash-å²çª",normalizedTitle:"å¦ä½è§£å³ hash å²çª",charIndex:26045},{level:4,title:"åå­æ³æ¼é®é¢",slug:"åå­æ³æ¼é®é¢",normalizedTitle:"åå­æ³æ¼é®é¢",charIndex:26329},{level:3,title:"ThreadLocal çè¯¯åº",slug:"threadlocal-çè¯¯åº",normalizedTitle:"threadlocal çè¯¯åº",charIndex:26802},{level:4,title:"ThreadLocal éè¯¯æ¡ä¾",slug:"threadlocal-éè¯¯æ¡ä¾",normalizedTitle:"threadlocal éè¯¯æ¡ä¾",charIndex:26945},{level:4,title:"ThreadLocal éè¯¯æ¡ä¾ä¿®æ­£",slug:"threadlocal-éè¯¯æ¡ä¾ä¿®æ­£",normalizedTitle:"threadlocal éè¯¯æ¡ä¾ä¿®æ­£",charIndex:28162},{level:3,title:"InheritableThreadLocal",slug:"inheritablethreadlocal",normalizedTitle:"inheritablethreadlocal",charIndex:28793},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:29013}],headersStr:"J.U.C ç®ä» synchronized synchronized çåºç¨ åæ­¥å®ä¾æ¹æ³ åæ­¥éææ¹æ³ åæ­¥ä»£ç å synchronized çåç åæ­¥ä»£ç å åæ­¥æ¹æ³ Monitor synchronized çä¼å Java å¯¹è±¡å¤´ ååé è½»éçº§é éæ¶é¤ / éç²å èªæé synchronized çè¯¯åº synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯ synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯ éç²åº¦å¯¼è´çé®é¢ volatile volatile çè¦ç¹ volatile çåºç¨ volatile çåç volatile çé®é¢ CAS CAS çè¦ç¹ CAS çåºç¨ åå­ç±» èªæé CAS çåç CAS çé®é¢ ABA é®é¢ å¾ªç¯æ¶é´é¿å¼éå¤§ åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§ ThreadLocal ThreadLocal çåºç¨ ThreadLocal çåç å­å¨ç»æ å¦ä½è§£å³ Hash å²çª åå­æ³æ¼é®é¢ ThreadLocal çè¯¯åº ThreadLocal éè¯¯æ¡ä¾ ThreadLocal éè¯¯æ¡ä¾ä¿®æ­£ InheritableThreadLocal åèèµæ",content:'# Java å¹¶åæ ¸å¿æºå¶\n\n> Java å¯¹äºå¹¶åçæ¯æä¸»è¦æ±èå¨ java.util.concurrentï¼å³ J.U.Cãè J.U.C çæ ¸å¿æ¯ AQSã\n\n\n# J.U.C ç®ä»\n\nJava ç java.util.concurrent åï¼ç®ç§° J.U.Cï¼ä¸­æä¾äºå¤§éå¹¶åå·¥å·ç±»ï¼æ¯ Java å¹¶åè½åçä¸»è¦ä½ç°ï¼æ³¨æï¼ä¸æ¯å¨é¨ï¼æé¨åå¹¶åè½åçæ¯æå¨å¶ä»åä¸­ï¼ãä»åè½ä¸ï¼å¤§è´å¯ä»¥åä¸ºï¼\n\n * åå­ç±» - å¦ï¼AtomicIntegerãAtomicIntegerArrayãAtomicReferenceãAtomicStampedReference ç­ã\n * é - å¦ï¼ReentrantLockãReentrantReadWriteLock ç­ã\n * å¹¶åå®¹å¨ - å¦ï¼ConcurrentHashMapãCopyOnWriteArrayListãCopyOnWriteArraySet ç­ã\n * é»å¡éå - å¦ï¼ArrayBlockingQueueãLinkedBlockingQueue ç­ã\n * éé»å¡éå - å¦ï¼ ConcurrentLinkedQueue ãLinkedTransferQueue ç­ã\n * Executor æ¡æ¶ï¼çº¿ç¨æ± ï¼- å¦ï¼ThreadPoolExecutorãExecutors ç­ã\n\næä¸ªäººçè§£ï¼Java å¹¶åæ¡æ¶å¯ä»¥åä¸ºä»¥ä¸å±æ¬¡ã\n\n\n\nç± Java å¹¶åæ¡æ¶å¾ä¸é¾çåºï¼J.U.C åä¸­çå·¥å·ç±»æ¯åºäº synchronizedãvolatileãCASãThreadLocal è¿æ ·çå¹¶åæ ¸å¿æºå¶æé çãæä»¥ï¼è¦æ³æ·±å¥çè§£ J.U.C å·¥å·ç±»çç¹æ§ãä¸ºä»ä¹å·æè¿æ ·é£æ ·çç¹æ§ï¼å°±å¿é¡»åçè§£è¿äºæ ¸å¿æºå¶ã\n\n\n# synchronized\n\n> synchronized æ¯ Java ä¸­çå³é®å­ï¼æ¯ å©ç¨éçæºå¶æ¥å®ç°äºæ¥åæ­¥çã\n> \n> synchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n> \n> å¦æä¸éè¦ Lock ãReadWriteLock ææä¾çé«çº§åæ­¥ç¹æ§ï¼åºè¯¥ä¼åèèä½¿ç¨ synchronized ï¼çç±å¦ä¸ï¼\n> \n>  * Java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ Lock ãReadWriteLock åºæ¬ä¸æå¹³ãä»è¶å¿æ¥çï¼Java æªæ¥ä»å°ç»§ç»­ä¼å synchronized ï¼èä¸æ¯ ReentrantLock ã\n>  * ReentrantLock æ¯ Oracle JDK ç APIï¼å¨å¶ä»çæ¬ç JDK ä¸­ä¸ä¸å®æ¯æï¼è synchronized æ¯ JVM çåç½®ç¹æ§ï¼ææ JDK çæ¬é½æä¾æ¯æã\n\n\n# synchronized çåºç¨\n\nsynchronized æ 3 ç§åºç¨æ¹å¼ï¼\n\n * åæ­¥å®ä¾æ¹æ³ - å¯¹äºæ®éåæ­¥æ¹æ³ï¼éæ¯å½åå®ä¾å¯¹è±¡\n * åæ­¥éææ¹æ³ - å¯¹äºéæåæ­¥æ¹æ³ï¼éæ¯å½åç±»ç Class å¯¹è±¡\n * åæ­¥ä»£ç å - å¯¹äºåæ­¥æ¹æ³åï¼éæ¯ synchonized æ¬å·ééç½®çå¯¹è±¡\n\n> è¯´æï¼\n> \n> ç±»ä¼¼ VectorãHashtable è¿ç±»åæ­¥ç±»ï¼å°±æ¯ä½¿ç¨ synchonized ä¿®é¥°å¶éè¦æ¹æ³ï¼æ¥ä¿è¯å¶çº¿ç¨å®å¨ã\n> \n> äºå®ä¸ï¼è¿ç±»åæ­¥å®¹å¨ä¹éç»å¯¹ççº¿ç¨å®å¨ï¼å½æ§è¡è¿­ä»£å¨éåï¼æ ¹æ®æ¡ä»¶å é¤åç´ è¿ç§åºæ¯ä¸ï¼å°±å¯è½åºç°çº¿ç¨ä¸å®å¨çæåµãæ­¤å¤ï¼Java 1.6 éå¯¹ synchonized è¿è¡ä¼ååï¼ç±äºé»å¡ï¼å¶æ§è½ä¸é«ã\n> \n> ç»¼ä¸ï¼è¿ç±»åæ­¥å®¹å¨ï¼å¨ç°ä»£ Java ç¨åºä¸­ï¼å·²ç»æ¸æ¸ä¸ç¨äºã\n\n# åæ­¥å®ä¾æ¹æ³\n\nâ éè¯¯ç¤ºä¾ - æªåæ­¥çç¤ºä¾\n\npublic class NoSynchronizedDemo implements Runnable {\n\n    public static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        NoSynchronizedDemo instance = new NoSynchronizedDemo();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    public void increase() {\n        count++;\n    }\n\n}\n// è¾åºç»æ: å°äº 200000 çéæºæ°å­\n\n\nJava å®ä¾æ¹æ³åæ­¥æ¯åæ­¥å¨æ¥æè¯¥æ¹æ³çå¯¹è±¡ä¸ãè¿æ ·ï¼æ¯ä¸ªå®ä¾å¶æ¹æ³åæ­¥é½åæ­¥å¨ä¸åçå¯¹è±¡ä¸ï¼å³è¯¥æ¹æ³æå±çå®ä¾ãåªæä¸ä¸ªçº¿ç¨è½å¤å¨å®ä¾æ¹æ³åæ­¥åä¸­è¿è¡ãå¦ææå¤ä¸ªå®ä¾å­å¨ï¼é£ä¹ä¸ä¸ªçº¿ç¨ä¸æ¬¡å¯ä»¥å¨ä¸ä¸ªå®ä¾åæ­¥åä¸­æ§è¡æä½ãä¸ä¸ªå®ä¾ä¸ä¸ªçº¿ç¨ã\n\npublic class SynchronizedDemo implements Runnable {\n\n    private static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedDemo instance = new SynchronizedDemo();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°æ®éæ¹æ³\n     */\n    public synchronized void increase() {\n        count++;\n    }\n\n}\n\n\nãç¤ºä¾ãéè¯¯ç¤ºä¾\n\nclass Account {\n  private int balance;\n  // è½¬è´¦\n  synchronized void transfer(\n      Account target, int amt){\n    if (this.balance > amt) {\n      this.balance -= amt;\n      target.balance += amt;\n    }\n  }\n}\n\n\nå¨è¿æ®µä»£ç ä¸­ï¼ä¸´çåºåæä¸¤ä¸ªèµæºï¼åå«æ¯è½¬åºè´¦æ·çä½é¢ this.balance åè½¬å¥è´¦æ·çä½é¢ target.balanceï¼å¹¶ä¸ç¨çæ¯ä¸æé thisï¼ç¬¦åæä»¬åé¢æå°çï¼å¤ä¸ªèµæºå¯ä»¥ç¨ä¸æéæ¥ä¿æ¤ï¼è¿çä¸å»å®å¨æ­£ç¡®åãççæ¯è¿æ ·åï¼å¯æï¼è¿ä¸ªæ¹æ¡ä»ä»æ¯çä¼¼æ­£ç¡®ï¼ä¸ºä»ä¹å¢ï¼\n\né®é¢å°±åºå¨ this è¿æéä¸ï¼this è¿æéå¯ä»¥ä¿æ¤èªå·±çä½é¢ this.balanceï¼å´ä¿æ¤ä¸äºå«äººçä½é¢ target.balanceï¼å°±åä½ ä¸è½ç¨èªå®¶çéæ¥ä¿æ¤å«äººå®¶çèµäº§ï¼ä¹ä¸è½ç¨èªå·±çç¥¨æ¥ä¿æ¤å«äººçåº§ä½ä¸æ ·ã\n\n\n\nåºè¯¥ä¿è¯ä½¿ç¨çéè½è¦çææåä¿æ¤èµæºã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass Account {\n  private Object lockï¼\n  private int balance;\n  private Account();\n  // åå»º Account æ¶ä¼ å¥åä¸ä¸ª lock å¯¹è±¡\n  public Account(Object lock) {\n    this.lock = lock;\n  }\n  // è½¬è´¦\n  void transfer(Account target, int amt){\n    // æ­¤å¤æ£æ¥ææå¯¹è±¡å±äº«çé\n    synchronized(lock) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\nè¿ä¸ªåæ³ç¡®å®è½è§£å³é®é¢ï¼ä½æ¯æç¹å°ççµï¼å®è¦æ±å¨åå»º Account å¯¹è±¡çæ¶åå¿é¡»ä¼ å¥åä¸ä¸ªå¯¹è±¡ï¼å¦æåå»º Account å¯¹è±¡æ¶ï¼ä¼ å¥ç lock ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼é£å¯å°±æ¨äºï¼ä¼åºç°éèªå®¶é¨æ¥ä¿æ¤ä»å®¶èµäº§çèåäºãå¨çå®çé¡¹ç®åºæ¯ä¸­ï¼åå»º Account å¯¹è±¡çä»£ç å¾å¯è½åæ£å¨å¤ä¸ªå·¥ç¨ä¸­ï¼ä¼ å¥å±äº«ç lock ççå¾é¾ã\n\nä¸é¢çæ¹æ¡ç¼ºä¹å®è·µçå¯è¡æ§ï¼æä»¬éè¦æ´å¥½çæ¹æ¡ãè¿çæï¼å°±æ¯ç¨ Account.class ä½ä¸ºå±äº«çéãAccount.class æ¯ææ Account å¯¹è±¡å±äº«çï¼èä¸è¿ä¸ªå¯¹è±¡æ¯ Java èææºå¨å è½½ Account ç±»çæ¶ååå»ºçï¼æä»¥æä»¬ä¸ç¨æå¿å®çå¯ä¸æ§ãä½¿ç¨ Account.class ä½ä¸ºå±äº«çéï¼æä»¬å°±æ éå¨åå»º Account å¯¹è±¡æ¶ä¼ å¥äºï¼ä»£ç æ´ç®åã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass Account {\n  private int balance;\n  // è½¬è´¦\n  void transfer(Account target, int amt){\n    synchronized(Account.class) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\n# åæ­¥éææ¹æ³\n\néææ¹æ³çåæ­¥æ¯æåæ­¥å¨è¯¥æ¹æ³æå¨çç±»å¯¹è±¡ä¸ãå ä¸ºå¨ JVM ä¸­ä¸ä¸ªç±»åªè½å¯¹åºä¸ä¸ªç±»å¯¹è±¡ï¼æä»¥åæ¶åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡åä¸ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³ã\n\nå¯¹äºä¸åç±»ä¸­çéæåæ­¥æ¹æ³ï¼ä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æ¯ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³èæ éç­å¾ãä¸ç®¡ç±»ä¸­çåªä¸ªéæåæ­¥æ¹æ³è¢«è°ç¨ï¼ä¸ä¸ªç±»åªè½ç±ä¸ä¸ªçº¿ç¨åæ¶æ§è¡ã\n\npublic class SynchronizedDemo2 implements Runnable {\n\n    private static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedDemo2 instance = new SynchronizedDemo2();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°éææ¹æ³\n     */\n    public synchronized static void increase() {\n        count++;\n    }\n\n}\n\n\n# åæ­¥ä»£ç å\n\nææ¶ä½ ä¸éè¦åæ­¥æ´ä¸ªæ¹æ³ï¼èæ¯åæ­¥æ¹æ³ä¸­çä¸é¨åãJava å¯ä»¥å¯¹æ¹æ³çä¸é¨åè¿è¡åæ­¥ã\n\n@ThreadSafe\npublic class SynchronizedDemo05 implements Runnable {\n\n    private static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedDemo05 instance = new SynchronizedDemo05();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°ä»£ç å\n     */\n    public void increase() {\n        synchronized (this) {\n            count++;\n        }\n    }\n\n}\n\n\næ³¨æ Java åæ­¥åæé å¨ç¨æ¬å·å°å¯¹è±¡æ¬èµ·æ¥ãå¨ä¸ä¾ä¸­ï¼ä½¿ç¨äº thisï¼å³ä¸ºè°ç¨ increase æ¹æ³çå®ä¾æ¬èº«ãç¨æ¬å·æ¬èµ·æ¥çå¯¹è±¡å«åçè§å¨å¯¹è±¡ãä¸æ¬¡åªæä¸ä¸ªçº¿ç¨è½å¤å¨åæ­¥äºåä¸ä¸ªçè§å¨å¯¹è±¡ç Java æ¹æ³åæ§è¡ã\n\nå¦ææ¯éææ¹æ³ï¼å°±ä¸è½ç¨ this å¯¹è±¡ä½ä¸ºçè§å¨å¯¹è±¡äºï¼èæ¯ä½¿ç¨ Class å¯¹è±¡ï¼å¦ä¸ï¼\n\npublic class SynchronizedDemo3 implements Runnable {\n\n    private static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedDemo3 instance = new SynchronizedDemo3();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°ä»£ç å\n     */\n    public static void increase() {\n        synchronized (SynchronizedDemo3.class) {\n            count++;\n        }\n    }\n\n}\n\n\n\n# synchronized çåç\n\nsynchronized ä»£ç åæ¯ç±ä¸å¯¹ monitorenter å monitorexit æä»¤å®ç°çï¼Monitor å¯¹è±¡æ¯åæ­¥çåºæ¬å®ç°ååãå¨ Java 6 ä¹åï¼Monitor çå®ç°å®å¨æ¯ä¾é æä½ç³»ç»åé¨çäºæ¥éï¼å ä¸ºéè¦è¿è¡ç¨æ·æå°åæ ¸æçåæ¢ï¼æä»¥åæ­¥æä½æ¯ä¸ä¸ªæ å·®å«çééçº§æä½ã\n\nå¦æ synchronized æç¡®å¶å®äºå¯¹è±¡åæ°ï¼é£å°±æ¯è¿ä¸ªå¯¹è±¡çå¼ç¨ï¼å¦ææ²¡ææç¡®æå®ï¼é£å°±æ ¹æ® synchronized ä¿®é¥°çæ¯å®ä¾æ¹æ³è¿æ¯éææ¹æ³ï¼å»å¯¹å¯¹åºçå¯¹è±¡å®ä¾æ Class å¯¹è±¡æ¥ä½ä¸ºéå¯¹è±¡ã\n\nsynchronized åæ­¥åå¯¹åä¸çº¿ç¨æ¥è¯´æ¯å¯éå¥çï¼ä¸ä¼åºç°éæ­»é®é¢ã\n\nsynchronized åæ­¥åæ¯äºæ¥çï¼å³å·²è¿å¥ççº¿ç¨æ§è¡å®æåï¼ä¼é»å¡å¶ä»è¯å¾è¿å¥ççº¿ç¨ã\n\nãç¤ºä¾ã\n\npublic void foo(Object lock) {\n    synchronized (lock) {\n      lock.hashCode();\n    }\n  }\n  // ä¸é¢ç Java ä»£ç å°ç¼è¯ä¸ºä¸é¢çå­èç \n  public void foo(java.lang.Object);\n    Code:\n       0: aload_1\n       1: dup\n       2: astore_2\n       3: monitorenter\n       4: aload_1\n       5: invokevirtual java/lang/Object.hashCode:()I\n       8: pop\n       9: aload_2\n      10: monitorexit\n      11: goto          19\n      14: astore_3\n      15: aload_2\n      16: monitorexit\n      17: aload_3\n      18: athrow\n      19: return\n    Exception table:\n       from    to  target type\n           4    11    14   any\n          14    17    14   any\n\n\n\n# åæ­¥ä»£ç å\n\nsynchronized å¨ä¿®é¥°åæ­¥ä»£ç åæ¶ï¼æ¯ç± monitorenter å monitorexit æä»¤æ¥å®ç°åæ­¥çãè¿å¥ monitorenter æä»¤åï¼çº¿ç¨å°ææ Monitor å¯¹è±¡ï¼éåº monitorenter æä»¤åï¼çº¿ç¨å°éæ¾è¯¥ Monitor å¯¹è±¡ã\n\n# åæ­¥æ¹æ³\n\nsynchronized ä¿®é¥°åæ­¥æ¹æ³æ¶ï¼ä¼è®¾ç½®ä¸ä¸ª ACC_SYNCHRONIZED æ å¿ãå½æ¹æ³è°ç¨æ¶ï¼è°ç¨æä»¤å°ä¼æ£æ¥è¯¥æ¹æ³æ¯å¦è¢«è®¾ç½® ACC_SYNCHRONIZED è®¿é®æ å¿ãå¦æè®¾ç½®äºè¯¥æ å¿ï¼æ§è¡çº¿ç¨å°åææ Monitor å¯¹è±¡ï¼ç¶ååæ§è¡æ¹æ³ãå¨è¯¥æ¹æ³è¿è¡æé´ï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ Mointor å¯¹è±¡ï¼å½æ¹æ³æ§è¡å®æåï¼åéæ¾è¯¥ Monitor å¯¹è±¡ã\n\n# Monitor\n\næ¯ä¸ªå¯¹è±¡å®ä¾é½ä¼æä¸ä¸ª Monitorï¼Monitor å¯ä»¥åå¯¹è±¡ä¸èµ·åå»ºãéæ¯ãMonitor æ¯ç± ObjectMonitor å®ç°ï¼è ObjectMonitor æ¯ç± C++ ç ObjectMonitor.hpp æä»¶å®ç°ã\n\nå½å¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸æ®µåæ­¥ä»£ç æ¶ï¼å¤ä¸ªçº¿ç¨ä¼åè¢«å­æ¾å¨ EntryList éåä¸­ï¼å¤äº block ç¶æççº¿ç¨ï¼é½ä¼è¢«å å¥å°è¯¥åè¡¨ãæ¥ä¸æ¥å½çº¿ç¨è·åå°å¯¹è±¡ç Monitor æ¶ï¼Monitor æ¯ä¾é åºå±æä½ç³»ç»ç Mutex Lock æ¥å®ç°äºæ¥çï¼çº¿ç¨ç³è¯· Mutex æåï¼åææè¯¥ Mutexï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ Mutexã\n\nå¦æçº¿ç¨è°ç¨ wait() æ¹æ³ï¼å°±ä¼éæ¾å½åææç Mutexï¼å¹¶ä¸è¯¥çº¿ç¨ä¼è¿å¥ WaitSet éåä¸­ï¼ç­å¾ä¸ä¸æ¬¡è¢«å¤éãå¦æå½åçº¿ç¨é¡ºå©æ§è¡å®æ¹æ³ï¼ä¹å°éæ¾ Mutexã\n\n\n# synchronized çä¼å\n\n> Java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ Lock ãReadWriteLock åºæ¬ä¸æå¹³ã\n\n# Java å¯¹è±¡å¤´\n\nå¨ JDK1.6 JVM ä¸­ï¼å¯¹è±¡å®ä¾å¨å åå­ä¸­è¢«åä¸ºäºä¸ä¸ªé¨åï¼å¯¹è±¡å¤´ãå®ä¾æ°æ®åå¯¹é½å¡«åãå¶ä¸­ Java å¯¹è±¡å¤´ç± Mark Wordãæåç±»çæéä»¥åæ°ç»é¿åº¦ä¸é¨åç»æã\n\nMark Word è®°å½äºå¯¹è±¡åéæå³çä¿¡æ¯ãMark Word å¨ 64 ä½ JVM ä¸­çé¿åº¦æ¯ 64bitï¼æä»¬å¯ä»¥ä¸èµ·çä¸ 64 ä½ JVM çå­å¨ç»ææ¯æä¹æ ·çãå¦ä¸å¾æç¤ºï¼\n\n\n\néåçº§åè½ä¸»è¦ä¾èµäº Mark Word ä¸­çéæ å¿ä½åæ¯å¦ååéæ å¿ä½ï¼synchronized åæ­¥éå°±æ¯ä»ååéå¼å§çï¼éçç«äºè¶æ¥è¶æ¿çï¼ååéåçº§å°è½»éçº§éï¼æç»åçº§å°ééçº§éã\n\nJava 1.6 å¼å¥äºååéåè½»éçº§éï¼ä»èè®© synchronized æ¥æäºåä¸ªç¶æï¼\n\n * æ éç¶æï¼unlockedï¼\n * ååéç¶æï¼biasbleï¼\n * è½»éçº§éç¶æï¼lightweight lockedï¼\n * ééçº§éç¶æï¼inflatedï¼\n\nå½ JVM æ£æµå°ä¸åçç«äºç¶åµæ¶ï¼ä¼èªå¨åæ¢å°éåçéå®ç°ã\n\nå½æ²¡æç«äºåºç°æ¶ï¼é»è®¤ä¼ä½¿ç¨ååéãJVM ä¼å©ç¨ CAS æä½ï¼compare and swapï¼ï¼å¨å¯¹è±¡å¤´ä¸ç Mark Word é¨åè®¾ç½®çº¿ç¨ IDï¼ä»¥è¡¨ç¤ºè¿ä¸ªå¯¹è±¡ååäºå½åçº¿ç¨ï¼æä»¥å¹¶ä¸æ¶åçæ­£çäºæ¥éãè¿æ ·åçåè®¾æ¯åºäºå¨å¾å¤åºç¨åºæ¯ä¸­ï¼å¤§é¨åå¯¹è±¡çå½å¨æä¸­æå¤ä¼è¢«ä¸ä¸ªçº¿ç¨éå®ï¼ä½¿ç¨åæéå¯ä»¥éä½æ ç«äºå¼éã\n\nå¦ææå¦å¤ççº¿ç¨è¯å¾éå®æä¸ªå·²ç»è¢«åæè¿çå¯¹è±¡ï¼JVM å°±éè¦æ¤éï¼revokeï¼ååéï¼å¹¶åæ¢å°è½»éçº§éå®ç°ãè½»éçº§éä¾èµ CAS æä½ Mark Word æ¥è¯å¾è·åéï¼å¦æéè¯æåï¼å°±ä½¿ç¨æ®éçè½»éçº§éï¼å¦åï¼è¿ä¸æ­¥åçº§ä¸ºééçº§éã\n\n# ååé\n\nååéçææ³æ¯ååäºç¬¬ä¸ä¸ªè·åéå¯¹è±¡ççº¿ç¨ï¼è¿ä¸ªçº¿ç¨å¨ä¹åè·åè¯¥éå°±ä¸åéè¦è¿è¡åæ­¥æä½ï¼çè³è¿ CAS æä½ä¹ä¸åéè¦ã\n\n\n\n# è½»éçº§é\n\nè½»éçº§éæ¯ç¸å¯¹äºä¼ ç»çééçº§éèè¨ï¼å® ä½¿ç¨ CAS æä½æ¥é¿åééçº§éä½¿ç¨äºæ¥éçå¼éãå¯¹äºç»å¤§é¨åçéï¼å¨æ´ä¸ªåæ­¥å¨æåé½æ¯ä¸å­å¨ç«äºçï¼å æ­¤ä¹å°±ä¸éè¦é½ä½¿ç¨äºæ¥éè¿è¡åæ­¥ï¼å¯ä»¥åéç¨ CAS æä½è¿è¡åæ­¥ï¼å¦æ CAS å¤±è´¥äºåæ¹ç¨äºæ¥éè¿è¡åæ­¥ã\n\nå½å°è¯è·åä¸ä¸ªéå¯¹è±¡æ¶ï¼å¦æéå¯¹è±¡æ è®°ä¸º 0|01ï¼è¯´æéå¯¹è±¡çéæªéå®ï¼unlockedï¼ç¶æãæ­¤æ¶èææºå¨å½åçº¿ç¨çèææºæ ä¸­åå»º Lock Recordï¼ç¶åä½¿ç¨ CAS æä½å°å¯¹è±¡ç Mark Word æ´æ°ä¸º Lock Record æéãå¦æ CAS æä½æåäºï¼é£ä¹çº¿ç¨å°±è·åäºè¯¥å¯¹è±¡ä¸çéï¼å¹¶ä¸å¯¹è±¡ç Mark Word çéæ è®°åä¸º 00ï¼è¡¨ç¤ºè¯¥å¯¹è±¡å¤äºè½»éçº§éç¶æã\n\n\n\n# éæ¶é¤ / éç²å\n\né¤äºéåçº§ä¼åï¼Java è¿ä½¿ç¨äºç¼è¯å¨å¯¹éè¿è¡ä¼åã\n\nï¼1ï¼éæ¶é¤\n\néæ¶é¤æ¯æå¯¹äºè¢«æ£æµåºä¸å¯è½å­å¨ç«äºçå±äº«æ°æ®çéè¿è¡æ¶é¤ã\n\nJIT ç¼è¯å¨å¨å¨æç¼è¯åæ­¥åçæ¶åï¼åå©äºä¸ç§è¢«ç§°ä¸ºéé¸åæçææ¯ï¼æ¥å¤æ­åæ­¥åä½¿ç¨çéå¯¹è±¡æ¯å¦åªè½å¤è¢«ä¸ä¸ªçº¿ç¨è®¿é®ï¼èæ²¡æè¢«åå¸å°å¶å®çº¿ç¨ã\n\nç¡®è®¤æ¯çè¯ï¼é£ä¹ JIT ç¼è¯å¨å¨ç¼è¯è¿ä¸ªåæ­¥åçæ¶åä¸ä¼çæ synchronized æè¡¨ç¤ºçéçç³è¯·ä¸éæ¾çæºå¨ç ï¼å³æ¶é¤äºéçä½¿ç¨ãå¨ Java7 ä¹åççæ¬å°±ä¸éè¦æå¨éç½®äºï¼è¯¥æä½å¯ä»¥èªå¨å®ç°ã\n\nå¯¹äºä¸äºçèµ·æ¥æ²¡æå éçä»£ç ï¼å¶å®éå¼çå äºå¾å¤éãä¾å¦ä¸é¢çå­ç¬¦ä¸²æ¼æ¥ä»£ç å°±éå¼å äºéï¼\n\npublic static String concatString(String s1, String s2, String s3) {\n    return s1 + s2 + s3;\n}\n\n\nString æ¯ä¸ä¸ªä¸å¯åçç±»ï¼ç¼è¯å¨ä¼å¯¹ String çæ¼æ¥èªå¨ä¼åãå¨ Java 1.5 ä¹åï¼ä¼è½¬åä¸º StringBuffer å¯¹è±¡çè¿ç»­ append() æä½ï¼\n\npublic static String concatString(String s1, String s2, String s3) {\n    StringBuffer sb = new StringBuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.toString();\n}\n\n\næ¯ä¸ª append() æ¹æ³ä¸­é½æä¸ä¸ªåæ­¥åãèææºè§å¯åé sbï¼å¾å¿«å°±ä¼åç°å®çå¨æä½ç¨åè¢«éå¶å¨ concatString() æ¹æ³åé¨ãä¹å°±æ¯è¯´ï¼sb çææå¼ç¨æ°¸è¿ä¸ä¼éé¸å° concatString() æ¹æ³ä¹å¤ï¼å¶ä»çº¿ç¨æ æ³è®¿é®å°å®ï¼å æ­¤å¯ä»¥è¿è¡æ¶é¤ã\n\nï¼2ï¼éç²å\n\néç²ååçï¼å°±æ¯å¨ JIT ç¼è¯å¨å¨æç¼è¯æ¶ï¼å¦æåç°å ä¸ªç¸é»çåæ­¥åä½¿ç¨çæ¯åä¸ä¸ªéå®ä¾ï¼é£ä¹ JIT ç¼è¯å¨å°ä¼æè¿å ä¸ªåæ­¥ååå¹¶ä¸ºä¸ä¸ªå¤§çåæ­¥åï¼ä»èé¿åä¸ä¸ªçº¿ç¨âåå¤ç³è¯·ãéæ¾åä¸ä¸ªéâæå¸¦æ¥çæ§è½å¼éã\n\nå¦æä¸ç³»åçè¿ç»­æä½é½å¯¹åä¸ä¸ªå¯¹è±¡åå¤å éåè§£éï¼é¢ç¹çå éæä½å°±ä¼å¯¼è´æ§è½æèã\n\nä¸ä¸èçç¤ºä¾ä»£ç ä¸­è¿ç»­ç append() æ¹æ³å°±å±äºè¿ç±»æåµãå¦æèææºæ¢æµå°ç±è¿æ ·çä¸ä¸²é¶ç¢çæä½é½å¯¹åä¸ä¸ªå¯¹è±¡å éï¼å°ä¼æå éçèå´æ©å±ï¼ç²åï¼å°æ´ä¸ªæä½åºåçå¤é¨ãå¯¹äºä¸ä¸èçç¤ºä¾ä»£ç å°±æ¯æ©å±å°ç¬¬ä¸ä¸ª append() æä½ä¹åç´è³æåä¸ä¸ª append() æä½ä¹åï¼è¿æ ·åªéè¦å éä¸æ¬¡å°±å¯ä»¥äºã\n\n# èªæé\n\näºæ¥åæ­¥è¿å¥é»å¡ç¶æçå¼éé½å¾å¤§ï¼åºè¯¥å°½éé¿åãå¨è®¸å¤åºç¨ä¸­ï¼å±äº«æ°æ®çéå®ç¶æåªä¼æç»­å¾ç­çä¸æ®µæ¶é´ãèªæéçææ³æ¯è®©ä¸ä¸ªçº¿ç¨å¨è¯·æ±ä¸ä¸ªå±äº«æ°æ®çéæ¶æ§è¡å¿å¾ªç¯ï¼èªæï¼ä¸æ®µæ¶é´ï¼å¦æå¨è¿æ®µæ¶é´åè½è·å¾éï¼å°±å¯ä»¥é¿åè¿å¥é»å¡ç¶æã\n\nèªæéè½ç¶è½é¿åè¿å¥é»å¡ç¶æä»èåå°å¼éï¼ä½æ¯å®éè¦è¿è¡å¿å¾ªç¯æä½å ç¨ CPU æ¶é´ï¼å®åªéç¨äºå±äº«æ°æ®çéå®ç¶æå¾ç­çåºæ¯ã\n\nå¨ Java 1.6 ä¸­å¼å¥äºèªéåºçèªæéãèªéåºæå³çèªæçæ¬¡æ°ä¸ååºå®äºï¼èæ¯ç±åä¸æ¬¡å¨åä¸ä¸ªéä¸çèªææ¬¡æ°åéçæ¥æèçç¶ææ¥å³å®ã\n\n\n# synchronized çè¯¯åº\n\n> ç¤ºä¾æèªï¼ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\n# synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯\n\npublic class Interesting {\n\n    volatile int a = 1;\n    volatile int b = 1;\n\n    public static void main(String[] args) {\n        Interesting interesting = new Interesting();\n        new Thread(() -> interesting.add()).start();\n        new Thread(() -> interesting.compare()).start();\n    }\n\n    public synchronized void add() {\n        log.info("add start");\n        for (int i = 0; i < 10000; i++) {\n            a++;\n            b++;\n        }\n        log.info("add done");\n    }\n\n    public void compare() {\n        log.info("compare start");\n        for (int i = 0; i < 10000; i++) {\n            //aå§ç»ç­äºbåï¼\n            if (a < b) {\n                log.info("a:{},b:{},{}", a, b, a > b);\n                //æåça>båºè¯¥å§ç»æ¯falseåï¼\n            }\n        }\n        log.info("compare done");\n    }\n\n}\n\n\nãè¾åºã\n\n16:05:25.541 [Thread-0] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add start\n16:05:25.544 [Thread-0] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add done\n16:05:25.544 [Thread-1] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare start\n16:05:25.544 [Thread-1] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare done\n\n\nä¹æä»¥åºç°è¿ç§éä¹±ï¼æ¯å ä¸ºä¸¤ä¸ªçº¿ç¨æ¯äº¤éæ§è¡ add å compare æ¹æ³ä¸­çä¸å¡é»è¾ï¼èä¸è¿äºä¸å¡é»è¾ä¸æ¯åå­æ§çï¼a++ å b++ æä½ä¸­å¯ä»¥ç©¿æå¨ compare æ¹æ³çæ¯è¾ä»£ç ä¸­ï¼æ´éè¦æ³¨æçæ¯ï¼a<b è¿ç§æ¯è¾æä½å¨å­èç å±é¢æ¯å è½½ aãå è½½ b åæ¯è¾ä¸æ­¥ï¼ä»£ç è½ç¶æ¯ä¸è¡ä½ä¹ä¸æ¯åå­æ§çã\n\næä»¥ï¼æ­£ç¡®çåæ³åºè¯¥æ¯ï¼ä¸º add å compare é½å ä¸æ¹æ³éï¼ç¡®ä¿ add æ¹æ³æ§è¡æ¶ï¼compare æ æ³è¯»å a å bï¼\n\npublic synchronized void add()\npublic synchronized void compare()\n\n\næä»¥ï¼ä½¿ç¨éè§£å³é®é¢ä¹åä¸å®è¦çæ¸æ¥ï¼æä»¬è¦ä¿æ¤çæ¯ä»ä¹é»è¾ï¼å¤çº¿ç¨æ§è¡çæåµåæ¯ææ ·çã\n\n# synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯\n\nå éåè¦æ¸æ¥éåè¢«ä¿æ¤çå¯¹è±¡æ¯ä¸æ¯ä¸ä¸ªå±é¢çã\n\néæå­æ®µå±äºç±»ï¼ç±»çº§å«çéæè½ä¿æ¤ï¼èééæå­æ®µå±äºç±»å®ä¾ï¼å®ä¾çº§å«çéå°±å¯ä»¥ä¿æ¤ã\n\npublic class synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 {\n\n    public static void main(String[] args) {\n        synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 demo = new synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2();\n        System.out.println(demo.wrong(1000000));\n        System.out.println(demo.right(1000000));\n    }\n\n    public int wrong(int count) {\n        Data.reset();\n        IntStream.rangeClosed(1, count).parallel().forEach(i -> new Data().wrong());\n        return Data.getCounter();\n    }\n\n    public int right(int count) {\n        Data.reset();\n        IntStream.rangeClosed(1, count).parallel().forEach(i -> new Data().right());\n        return Data.getCounter();\n    }\n\n    private static class Data {\n\n        @Getter\n        private static int counter = 0;\n        private static Object locker = new Object();\n\n        public static int reset() {\n            counter = 0;\n            return counter;\n        }\n\n        public synchronized void wrong() {\n            counter++;\n        }\n\n        public void right() {\n            synchronized (locker) {\n                counter++;\n            }\n        }\n\n    }\n\n}\n\n\nwrong æ¹æ³ä¸­è¯å¾å¯¹ä¸ä¸ªéæå¯¹è±¡å å¯¹è±¡çº§å«ç synchronized éï¼å¹¶ä¸è½ä¿è¯çº¿ç¨å®å¨ã\n\n# éç²åº¦å¯¼è´çé®é¢\n\nè¦å°½å¯è½çç¼©å°å éçèå´ï¼è¿å¯ä»¥æé«å¹¶åååã\n\nå¦æç²¾ç»åèèäºéåºç¨èå´åï¼æ§è½è¿æ æ³æ»¡è¶³éæ±çè¯ï¼æä»¬å°±è¦èèå¦ä¸ä¸ªç»´åº¦çç²åº¦é®é¢äºï¼å³ï¼åºåè¯»ååºæ¯ä»¥åèµæºçè®¿é®å²çªï¼èèä½¿ç¨æ²è§æ¹å¼çéè¿æ¯ä¹è§æ¹å¼çéã\n\npublic class synchronizedéç²åº¦ä¸å½ {\n\n    public static void main(String[] args) {\n        Demo demo = new Demo();\n        demo.wrong();\n        demo.right();\n    }\n\n    private static class Demo {\n\n        private List<Integer> data = new ArrayList<>();\n\n        private void slow() {\n            try {\n                TimeUnit.MILLISECONDS.sleep(10);\n            } catch (InterruptedException e) {\n            }\n        }\n\n        public int wrong() {\n            long begin = System.currentTimeMillis();\n            IntStream.rangeClosed(1, 1000).parallel().forEach(i -> {\n                synchronized (this) {\n                    slow();\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", System.currentTimeMillis() - begin);\n            return data.size();\n        }\n\n        public int right() {\n            long begin = System.currentTimeMillis();\n            IntStream.rangeClosed(1, 1000).parallel().forEach(i -> {\n                slow();\n                synchronized (data) {\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", System.currentTimeMillis() - begin);\n            return data.size();\n        }\n\n    }\n\n}\n\n\n\n# volatile\n\n\n# volatile çè¦ç¹\n\nvolatile æ¯è½»éçº§ç synchronizedï¼å®å¨å¤å¤çå¨å¼åä¸­ä¿è¯äºå±äº«åéçâå¯è§æ§âã\n\nè¢« volatile ä¿®é¥°çåéï¼å·å¤ä»¥ä¸ç¹æ§ï¼\n\n * çº¿ç¨å¯è§æ§ - ä¿è¯äºä¸åçº¿ç¨å¯¹è¿ä¸ªåéè¿è¡æä½æ¶çå¯è§æ§ï¼å³ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªå±äº«åéï¼å¦å¤ä¸ä¸ªçº¿ç¨è½è¯»å°è¿ä¸ªä¿®æ¹çå¼ã\n * ç¦æ­¢æä»¤éæåº\n * ä¸ä¿è¯åå­æ§\n\næä»¬ç¥éï¼çº¿ç¨å®å¨éè¦å·å¤ï¼å¯è§æ§ãåå­æ§ãé¡ºåºæ§ãvolatile ä¸ä¿è¯åå­æ§ï¼æä»¥å³å®äºå®ä¸è½å½»åºå°ä¿è¯çº¿ç¨å®å¨ã\n\n\n# volatile çåºç¨\n\nå¦æ volatile åéä¿®é¥°ç¬¦ä½¿ç¨æ°å½çè¯ï¼å®æ¯ synchronized çä½¿ç¨åæ§è¡ææ¬æ´ä½ï¼å ä¸ºå®ä¸ä¼å¼èµ·çº¿ç¨ä¸ä¸æçåæ¢åè°åº¦ãä½æ¯ï¼volatile æ æ³æ¿ä»£ synchronized ï¼å ä¸º volatile æ æ³ä¿è¯æä½çåå­æ§ã\n\néå¸¸æ¥è¯´ï¼ä½¿ç¨ volatile å¿é¡»å·å¤ä»¥ä¸ 2 ä¸ªæ¡ä»¶ï¼\n\n * å¯¹åéçåæä½ä¸ä¾èµäºå½åå¼\n * è¯¥åéæ²¡æåå«å¨å·æå¶ä»åéçè¡¨è¾¾å¼ä¸­\n\nãç¤ºä¾ãç¶ææ è®°é\n\nvolatile boolean flag = false;\n\nwhile(!flag) {\n    doSomething();\n}\n\npublic void setFlag() {\n    flag = true;\n}\n\n\nãç¤ºä¾ãåééå®ç°çº¿ç¨å®å¨çåä¾æ¨¡å¼\n\nclass Singleton {\n    private volatile static Singleton instance = null;\n\n    private Singleton() {}\n\n    public static Singleton getInstance() {\n        if(instance==null) {\n            synchronized (Singleton.class) {\n                if(instance==null)\n                    instance = new Singleton();\n            }\n        }\n        return instance;\n    }\n}\n\n\n\n# volatile çåç\n\nè§å¯å å¥ volatile å³é®å­åæ²¡æå å¥ volatile å³é®å­æ¶æçæçæ±ç¼ä»£ç åç°ï¼å å¥ volatile å³é®å­æ¶ï¼ä¼å¤åºä¸ä¸ª lock åç¼æä»¤ãlock åç¼æä»¤å®éä¸ç¸å½äºä¸ä¸ªåå­å±éï¼ä¹æåå­æ æ ï¼ï¼åå­å±éä¼æä¾ 3 ä¸ªåè½ï¼\n\n * å®ç¡®ä¿æä»¤éæåºæ¶ä¸ä¼æå¶åé¢çæä»¤æå°åå­å±éä¹åçä½ç½®ï¼ä¹ä¸ä¼æåé¢çæä»¤æå°åå­å±éçåé¢ï¼å³å¨æ§è¡å°åå­å±éè¿å¥æä»¤æ¶ï¼å¨å®åé¢çæä½å·²ç»å¨é¨å®æï¼\n * å®ä¼å¼ºå¶å°å¯¹ç¼å­çä¿®æ¹æä½ç«å³åå¥ä¸»å­ï¼\n * å¦ææ¯åæä½ï¼å®ä¼å¯¼è´å¶ä» CPU ä¸­å¯¹åºçç¼å­è¡æ æã\n\n\n# volatile çé®é¢\n\nvolatile çè¦ç¹ä¸­ï¼å·²ç»æå°ï¼volatile ä¸ä¿è¯åå­æ§ï¼æä»¥ volatile å¹¶ä¸è½ä¿è¯çº¿ç¨å®å¨ã\n\né£ä¹ï¼å¦ä½åå°çº¿ç¨å®å¨å¢ï¼æä¸¤ç§æ¹æ¡ï¼\n\n * volatile + synchronized - å¯ä»¥åèï¼ãç¤ºä¾ãåééå®ç°çº¿ç¨å®å¨çåä¾æ¨¡å¼\n * ä½¿ç¨åå­ç±»æ¿ä»£ volatile\n\n\n# CAS\n\n\n# CAS çè¦ç¹\n\näºæ¥åæ­¥æ¯æå¸¸è§çå¹¶åæ­£ç¡®æ§ä¿éææ®µã\n\näºæ¥åæ­¥æä¸»è¦çé®é¢æ¯çº¿ç¨é»å¡åå¤éæå¸¦æ¥çæ§è½é®é¢ï¼å æ­¤äºæ¥åæ­¥ä¹è¢«ç§°ä¸ºé»å¡åæ­¥ãäºæ¥åæ­¥å±äºä¸ç§æ²è§çå¹¶åç­ç¥ï¼æ»æ¯è®¤ä¸ºåªè¦ä¸å»åæ­£ç¡®çåæ­¥æªæ½ï¼é£å°±è¯å®ä¼åºç°é®é¢ãæ è®ºå±äº«æ°æ®æ¯å¦ççä¼åºç°ç«äºï¼å®é½è¦è¿è¡å éï¼è¿éè®¨è®ºçæ¯æ¦å¿µæ¨¡åï¼å®éä¸èææºä¼ä¼åæå¾å¤§ä¸é¨åä¸å¿è¦çå éï¼ãç¨æ·ææ ¸å¿æè½¬æ¢ãç»´æ¤éè®¡æ°å¨åæ£æ¥æ¯å¦æè¢«é»å¡ççº¿ç¨éè¦å¤éç­æä½ã\n\néçç¡¬ä»¶æä»¤éçåå±ï¼æä»¬å¯ä»¥ä½¿ç¨åºäºå²çªæ£æµçä¹è§å¹¶åç­ç¥ï¼åè¿è¡æä½ï¼å¦ææ²¡æå¶å®çº¿ç¨äºç¨å±äº«æ°æ®ï¼é£æä½å°±æåäºï¼å¦åéåè¡¥å¿æªæ½ï¼ä¸æ­å°éè¯ï¼ç´å°æåä¸ºæ­¢ï¼ãè¿ç§ä¹è§çå¹¶åç­ç¥çè®¸å¤å®ç°é½ä¸éè¦å°çº¿ç¨é»å¡ï¼å æ­¤è¿ç§åæ­¥æä½ç§°ä¸ºéé»å¡åæ­¥ã\n\nä¸ºä»ä¹è¯´ä¹è§ééè¦ ç¡¬ä»¶æä»¤éçåå± æè½è¿è¡ï¼å ä¸ºéè¦æä½åå²çªæ£æµè¿ä¸¤ä¸ªæ­¥éª¤å·å¤åå­æ§ãèè¿ç¹æ¯ç±ç¡¬ä»¶æ¥å®æï¼å¦æåä½¿ç¨äºæ¥åæ­¥æ¥ä¿è¯å°±å¤±å»æä¹äºãç¡¬ä»¶æ¯æçåå­æ§æä½æå¸åçæ¯ï¼CASã\n\nCASï¼Compare and Swapï¼ï¼å­é¢ææä¸ºæ¯è¾å¹¶äº¤æ¢ãCAS æ 3 ä¸ªæä½æ°ï¼åå«æ¯ï¼åå­å¼ Mï¼ææå¼ Eï¼æ´æ°å¼ Uãå½ä¸ä»å½åå­å¼ M åææå¼ E ç¸ç­æ¶ï¼å°åå­å¼ M ä¿®æ¹ä¸º Uï¼å¦åä»ä¹é½ä¸åã\n\n\n# CAS çåºç¨\n\nCAS åªéç¨äºçº¿ç¨å²çªè¾å°çæåµã\n\nCAS çå¸ååºç¨åºæ¯æ¯ï¼\n\n * åå­ç±»\n * èªæé\n\n# åå­ç±»\n\n> åå­ç±»æ¯ CAS å¨ Java ä¸­æå¸åçåºç¨ã\n\næä»¬åæ¥çä¸ä¸ªå¸¸è§çä»£ç çæ®µã\n\nif(a==b) {\n    a++;\n}\n\n\nå¦æ a++ æ§è¡åï¼ a çå¼è¢«ä¿®æ¹äºæä¹åï¼è¿è½å¾å°é¢æå¼åï¼åºç°è¯¥é®é¢çåå æ¯å¨å¹¶åç¯å¢ä¸ï¼ä»¥ä¸ä»£ç çæ®µä¸æ¯åå­æä½ï¼éæ¶å¯è½è¢«å¶ä»çº¿ç¨æç¯¡æ¹ã\n\nè§£å³è¿ç§é®é¢çæç»å¸æ¹å¼æ¯åºç¨åå­ç±»ç incrementAndGet æ¹æ³ã\n\npublic class AtomicIntegerDemo {\n\n    public static void main(String[] args) throws InterruptedException {\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        final AtomicInteger count = new AtomicInteger(0);\n        for (int i = 0; i < 10; i++) {\n            executorService.execute(new Runnable() {\n                @Override\n                public void run() {\n                    count.incrementAndGet();\n                }\n            });\n        }\n\n        executorService.shutdown();\n        executorService.awaitTermination(3, TimeUnit.SECONDS);\n        System.out.println("Final Count is : " + count.get());\n    }\n\n}\n\n\nJ.U.C åä¸­æä¾äº AtomicBooleanãAtomicIntegerãAtomicLong åå«éå¯¹ BooleanãIntegerãLong æ§è¡åå­æä½ï¼æä½åä¸é¢çç¤ºä¾å¤§ä½ç¸ä¼¼ï¼ä¸åèµè¿°ã\n\n# èªæé\n\nå©ç¨åå­ç±»ï¼æ¬è´¨ä¸æ¯ CASï¼ï¼å¯ä»¥å®ç°èªæéã\n\næè°èªæéï¼æ¯æçº¿ç¨åå¤æ£æ¥éåéæ¯å¦å¯ç¨ï¼ç´å°æåä¸ºæ­¢ãç±äºçº¿ç¨å¨è¿ä¸è¿ç¨ä¸­ä¿ææ§è¡ï¼å æ­¤æ¯ä¸ç§å¿ç­å¾ãä¸æ¦è·åäºèªæéï¼çº¿ç¨ä¼ä¸ç´ä¿æè¯¥éï¼ç´è³æ¾å¼éæ¾èªæéã\n\nç¤ºä¾ï¼éçº¿ç¨å®å¨ç¤ºä¾\n\npublic class AtomicReferenceDemo {\n\n    private static int ticket = 10;\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        for (int i = 0; i < 5; i++) {\n            executorService.execute(new MyThread());\n        }\n        executorService.shutdown();\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            while (ticket > 0) {\n                System.out.println(Thread.currentThread().getName() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n        }\n\n    }\n\n}\n\n\nè¾åºç»æï¼\n\npool-1-thread-2 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 8 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 9 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 6 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 7 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 4 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 5 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 2 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 3 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 1 å¼ ç¥¨\n\n\nå¾ææ¾ï¼åºç°äºéå¤å®ç¥¨çæåµã\n\nãç¤ºä¾ãä½¿ç¨èªæéæ¥ä¿è¯çº¿ç¨å®å¨\n\nå¯ä»¥éè¿èªæéè¿ç§éé»å¡åæ­¥æ¥ä¿è¯çº¿ç¨å®å¨ï¼ä¸é¢ä½¿ç¨ AtomicReference æ¥å®ç°ä¸ä¸ªèªæéã\n\npublic class AtomicReferenceDemo2 {\n\n    private static int ticket = 10;\n\n    public static void main(String[] args) {\n        threadSafeDemo();\n    }\n\n    private static void threadSafeDemo() {\n        SpinLock lock = new SpinLock();\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        for (int i = 0; i < 5; i++) {\n            executorService.execute(new MyThread(lock));\n        }\n        executorService.shutdown();\n    }\n\n    static class SpinLock {\n\n        private AtomicReference<Thread> atomicReference = new AtomicReference<>();\n\n        public void lock() {\n            Thread current = Thread.currentThread();\n            while (!atomicReference.compareAndSet(null, current)) {}\n        }\n\n        public void unlock() {\n            Thread current = Thread.currentThread();\n            atomicReference.compareAndSet(current, null);\n        }\n\n    }\n\n    static class MyThread implements Runnable {\n\n        private SpinLock lock;\n\n        public MyThread(SpinLock lock) {\n            this.lock = lock;\n        }\n\n        @Override\n        public void run() {\n            while (ticket > 0) {\n                lock.lock();\n                if (ticket > 0) {\n                    System.out.println(Thread.currentThread().getName() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                    ticket--;\n                }\n                lock.unlock();\n            }\n        }\n\n    }\n\n}\n\n\nè¾åºç»æï¼\n\npool-1-thread-2 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 9 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 8 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 7 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 6 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 5 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 4 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 3 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 2 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 1 å¼ ç¥¨\n\n\n\n# CAS çåç\n\nJava ä¸»è¦å©ç¨ Unsafe è¿ä¸ªç±»æä¾ç CAS æä½ãUnsafe ç CAS ä¾èµçæ¯ JVM éå¯¹ä¸åçæä½ç³»ç»å®ç°çç¡¬ä»¶æä»¤ Atomic::cmpxchgãAtomic::cmpxchg çå®ç°ä½¿ç¨äºæ±ç¼ç CAS æä½ï¼å¹¶ä½¿ç¨ CPU æä¾ç lock ä¿¡å·ä¿è¯å¶åå­æ§ã\n\n\n# CAS çé®é¢\n\nä¸è¬æåµä¸ï¼CAS æ¯éæ§è½æ´é«ãå ä¸º CAS æ¯ä¸ç§éé»å¡ç®æ³ï¼æä»¥å¶é¿åäºçº¿ç¨é»å¡åå¤éçç­å¾æ¶é´ã\n\nä½æ¯ï¼äºç©æ»ä¼æå©æå¼ï¼CAS ä¹å­å¨ä¸å¤§é®é¢ï¼\n\n * ABA é®é¢\n * å¾ªç¯æ¶é´é¿å¼éå¤§\n * åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§\n\n# ABA é®é¢\n\nå¦æä¸ä¸ªåéåæ¬¡è¯»åçæ¶åæ¯ A å¼ï¼å®çå¼è¢«æ¹æäº Bï¼åæ¥åè¢«æ¹åä¸º Aï¼é£ CAS æä½å°±ä¼è¯¯è®¤ä¸ºå®ä»æ¥æ²¡æè¢«æ¹åè¿ã\n\nJ.U.C åæä¾äºä¸ä¸ªå¸¦ææ è®°çåå­å¼ç¨ç±» AtomicStampedReference æ¥è§£å³è¿ä¸ªé®é¢ï¼å®å¯ä»¥éè¿æ§å¶åéå¼ççæ¬æ¥ä¿è¯ CAS çæ­£ç¡®æ§ãå¤§é¨åæåµä¸ ABA é®é¢ä¸ä¼å½±åç¨åºå¹¶åçæ­£ç¡®æ§ï¼å¦æéè¦è§£å³ ABA é®é¢ï¼æ¹ç¨ä¼ ç»çäºæ¥åæ­¥å¯è½ä¼æ¯åå­ç±»æ´é«æã\n\n# å¾ªç¯æ¶é´é¿å¼éå¤§\n\nèªæ CAS ï¼ä¸æ­å°è¯ï¼ç´å°æåä¸ºæ­¢ï¼å¦æé¿æ¶é´ä¸æåï¼ä¼ç» CPU å¸¦æ¥éå¸¸å¤§çæ§è¡å¼éã\n\nå¦æ JVM è½æ¯æå¤çå¨æä¾ç pause æä»¤é£ä¹æçä¼æä¸å®çæåï¼pause æä»¤æä¸¤ä¸ªä½ç¨ï¼\n\n * å®å¯ä»¥å»¶è¿æµæ°´çº¿æ§è¡æä»¤ï¼de-pipelineï¼,ä½¿ CPU ä¸ä¼æ¶èè¿å¤çæ§è¡èµæºï¼å»¶è¿çæ¶é´åå³äºå·ä½å®ç°ççæ¬ï¼å¨ä¸äºå¤çå¨ä¸å»¶è¿æ¶é´æ¯é¶ã\n * å®å¯ä»¥é¿åå¨éåºå¾ªç¯çæ¶åå åå­é¡ºåºå²çªï¼memory order violationï¼èå¼èµ· CPU æµæ°´çº¿è¢«æ¸ç©ºï¼CPU pipeline flushï¼ï¼ä»èæé« CPU çæ§è¡æçã\n\næ¯è¾è±è´¹ CPU èµæºï¼å³ä½¿æ²¡æä»»ä½ç¨ä¹ä¼åä¸äºæ ç¨åã\n\n# åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§\n\nå½å¯¹ä¸ä¸ªå±äº«åéæ§è¡æä½æ¶ï¼æä»¬å¯ä»¥ä½¿ç¨å¾ªç¯ CAS çæ¹å¼æ¥ä¿è¯åå­æä½ï¼ä½æ¯å¯¹å¤ä¸ªå±äº«åéæä½æ¶ï¼å¾ªç¯ CAS å°±æ æ³ä¿è¯æä½çåå­æ§ï¼è¿ä¸ªæ¶åå°±å¯ä»¥ç¨éã\n\næèæä¸ä¸ªåå·§çåæ³ï¼å°±æ¯æå¤ä¸ªå±äº«åéåå¹¶æä¸ä¸ªå±äº«åéæ¥æä½ãæ¯å¦æä¸¤ä¸ªå±äº«åé i ï¼ 2, j = aï¼åå¹¶ä¸ä¸ ij=2aï¼ç¶åç¨ CAS æ¥æä½ ijãä» Java 1.5 å¼å§ JDK æä¾äº AtomicReference ç±»æ¥ä¿è¯å¼ç¨å¯¹è±¡ä¹é´çåå­æ§ï¼ä½ å¯ä»¥æå¤ä¸ªåéæ¾å¨ä¸ä¸ªå¯¹è±¡éæ¥è¿è¡ CAS æä½ã\n\n\n# ThreadLocal\n\n> ThreadLocal æ¯ä¸ä¸ªå­å¨çº¿ç¨æ¬å°å¯æ¬çå·¥å·ç±»ã\n> \n> è¦ä¿è¯çº¿ç¨å®å¨ï¼ä¸ä¸å®éè¦è¿è¡åæ­¥ãåæ­¥åªæ¯ä¿è¯å±äº«æ°æ®äºç¨æ¶çæ­£ç¡®æ§ï¼å¦æä¸ä¸ªæ¹æ³æ¬æ¥å°±ä¸æ¶åå±äº«æ°æ®ï¼é£ä¹èªç¶æ é¡»åæ­¥ã\n> \n> Java ä¸­ç æ åæ­¥æ¹æ¡ æï¼\n> \n>  * å¯éå¥ä»£ç  - ä¹å«çº¯ä»£ç ãå¦æä¸ä¸ªæ¹æ³ï¼å®ç è¿åç»ææ¯å¯ä»¥é¢æµçï¼å³åªè¦è¾å¥äºç¸åçæ°æ®ï¼å°±è½è¿åç¸åçç»æï¼é£å®å°±æ»¡è¶³å¯éå¥æ§ï¼å½ç¶ä¹æ¯çº¿ç¨å®å¨çã\n>  * çº¿ç¨æ¬å°å­å¨ - ä½¿ç¨ ThreadLocal ä¸ºå±äº«åéå¨æ¯ä¸ªçº¿ç¨ä¸­é½åå»ºäºä¸ä¸ªæ¬å°å¯æ¬ï¼è¿ä¸ªå¯æ¬åªè½è¢«å½åçº¿ç¨è®¿é®ï¼å¶ä»çº¿ç¨æ æ³è®¿é®ï¼é£ä¹èªç¶æ¯çº¿ç¨å®å¨çã\n\n\n# ThreadLocal çåºç¨\n\nThreadLocal çæ¹æ³ï¼\n\npublic class ThreadLocal<T> {\n    public T get() {}\n    public void set(T value) {}\n    public void remove() {}\n    public static <S> ThreadLocal<S> withInitial(Supplier<? extends S> supplier) {}\n}\n\n\n> è¯´æï¼\n> \n>  * get - ç¨äºè·å ThreadLocal å¨å½åçº¿ç¨ä¸­ä¿å­çåéå¯æ¬ã\n>  * set - ç¨äºè®¾ç½®å½åçº¿ç¨ä¸­åéçå¯æ¬ã\n>  * remove - ç¨äºå é¤å½åçº¿ç¨ä¸­åéçå¯æ¬ãå¦ææ­¤çº¿ç¨å±é¨åééåè¢«å½åçº¿ç¨è¯»åï¼åå¶å¼å°éè¿è°ç¨å¶ initialValue æ¹æ³éæ°åå§åï¼é¤éå¶å¼ç±ä¸­é´çº¿ç¨ä¸­çå½åçº¿ç¨è®¾ç½®ã è¿å¯è½ä¼å¯¼è´å½åçº¿ç¨ä¸­å¤æ¬¡è°ç¨ initialValue æ¹æ³ã\n>  * initialValue - ä¸º ThreadLocal è®¾ç½®é»è®¤ç get åå§å¼ï¼éè¦éå initialValue æ¹æ³ ã\n\nThreadLocal å¸¸ç¨äºé²æ­¢å¯¹å¯åçåä¾ï¼Singletonï¼åéæå¨å±åéè¿è¡å±äº«ãå¸ååºç¨åºæ¯æï¼ç®¡çæ°æ®åºè¿æ¥ãSessionã\n\nãç¤ºä¾ãæ°æ®åºè¿æ¥\n\nprivate static ThreadLocal<Connection> connectionHolder = new ThreadLocal<Connection>() {\n    @Override\n    public Connection initialValue() {\n        return DriverManager.getConnection(DB_URL);\n    }\n};\n\npublic static Connection getConnection() {\n    return connectionHolder.get();\n}\n\n\nãç¤ºä¾ãSession ç®¡ç\n\nprivate static final ThreadLocal<Session> sessionHolder = new ThreadLocal<>();\n\npublic static Session getSession() {\n    Session session = (Session) sessionHolder.get();\n    try {\n        if (session == null) {\n            session = createSession();\n            sessionHolder.set(session);\n        }\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n    return session;\n}\n\n\nãç¤ºä¾ãå®æ´ä½¿ç¨ ThreadLocal ç¤ºä¾\n\npublic class ThreadLocalDemo {\n\n    private static ThreadLocal<Integer> threadLocal = new ThreadLocal<Integer>() {\n        @Override\n        protected Integer initialValue() {\n            return 0;\n        }\n    };\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newFixedThreadPool(10);\n        for (int i = 0; i < 10; i++) {\n            executorService.execute(new MyThread());\n        }\n        executorService.shutdown();\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            int count = threadLocal.get();\n            for (int i = 0; i < 10; i++) {\n                try {\n                    count++;\n                    Thread.sleep(100);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            threadLocal.set(count);\n            threadLocal.remove();\n            System.out.println(Thread.currentThread().getName() + " : " + count);\n        }\n\n    }\n\n}\n\n\nå¨é¨è¾åº count = 10\n\n\n# ThreadLocal çåç\n\n# å­å¨ç»æ\n\nThread ç±»ä¸­ç»´æ¤çä¸ä¸ª ThreadLocal.ThreadLocalMap ç±»åçæå threadLocalsãè¿ä¸ªæåå°±æ¯ç¨æ¥å­å¨å½åçº¿ç¨ç¬å çåéå¯æ¬ã\n\nThreadLocalMap æ¯ ThreadLocal çåé¨ç±»ï¼å®ç»´æ¤çä¸ä¸ª Entry æ°ç»ï¼Entry ç»§æ¿äº WeakReference ï¼æä»¥æ¯å¼±å¼ç¨ã Entry ç¨äºä¿å­é®å¼å¯¹ï¼å¶ä¸­ï¼\n\n * key æ¯ ThreadLocal å¯¹è±¡ï¼\n * value æ¯ä¼ éè¿æ¥çå¯¹è±¡ï¼åéå¯æ¬ï¼ã\n\npublic class Thread implements Runnable {\n    // ...\n    ThreadLocal.ThreadLocalMap threadLocals = null;\n    // ...\n}\n\nstatic class ThreadLocalMap {\n    // ...\n    static class Entry extends WeakReference<ThreadLocal<?>> {\n        /** The value associated with this ThreadLocal. */\n        Object value;\n\n        Entry(ThreadLocal<?> k, Object v) {\n            super(k);\n            value = v;\n        }\n    }\n    // ...\n}\n\n\n# å¦ä½è§£å³ Hash å²çª\n\nThreadLocalMap è½ç¶æ¯ç±»ä¼¼ Map ç»æçæ°æ®ç»æï¼ä½å®å¹¶æ²¡æå®ç° Map æ¥å£ãå®ä¸æ¯æ Map æ¥å£ä¸­ç next æ¹æ³ï¼è¿æå³ç ThreadLocalMap ä¸­è§£å³ Hash å²çªçæ¹å¼å¹¶é æé¾è¡¨ æ¹å¼ã\n\nå®éä¸ï¼ThreadLocalMap éç¨çº¿æ§æ¢æµçæ¹å¼æ¥è§£å³ Hash å²çªãæè°çº¿æ§æ¢æµï¼å°±æ¯æ ¹æ®åå§ key ç hashcode å¼ç¡®å®åç´ å¨ table æ°ç»ä¸­çä½ç½®ï¼å¦æåç°è¿ä¸ªä½ç½®ä¸å·²ç»è¢«å¶ä»ç key å¼å ç¨ï¼åå©ç¨åºå®çç®æ³å¯»æ¾ä¸å®æ­¥é¿çä¸ä¸ªä½ç½®ï¼ä¾æ¬¡å¤æ­ï¼ç´è³æ¾å°è½å¤å­æ¾çä½ç½®ã\n\n# åå­æ³æ¼é®é¢\n\nThreadLocalMap ç Entry ç»§æ¿äº WeakReferenceï¼æä»¥å®ç key ï¼ThreadLocal å¯¹è±¡ï¼æ¯å¼±å¼ç¨ï¼è value ï¼åéå¯æ¬ï¼æ¯å¼ºå¼ç¨ã\n\n * å¦æ ThreadLocal å¯¹è±¡æ²¡æå¤é¨å¼ºå¼ç¨æ¥å¼ç¨å®ï¼é£ä¹ ThreadLocal å¯¹è±¡ä¼å¨ä¸æ¬¡ GC æ¶è¢«åæ¶ã\n * æ­¤æ¶ï¼Entry ä¸­ç key å·²ç»è¢«åæ¶ï¼ä½æ¯ value ç±äºæ¯å¼ºå¼ç¨ä¸ä¼è¢«åå¾æ¶éå¨åæ¶ãå¦æåå»º ThreadLocal ççº¿ç¨ä¸ç´æç»­è¿è¡ï¼é£ä¹ value å°±ä¼ä¸ç´å¾ä¸å°åæ¶ï¼äº§çåå­æ³é²ã\n\né£ä¹å¦ä½é¿ååå­æ³æ¼å¢ï¼æ¹æ³å°±æ¯ï¼ä½¿ç¨ ThreadLocal ç set æ¹æ³åï¼æ¾ç¤ºçè°ç¨ remove æ¹æ³ ã\n\nThreadLocal<String> threadLocal = new ThreadLocal();\ntry {\n    threadLocal.set("xxx");\n    // ...\n} finally {\n    threadLocal.remove();\n}\n\n\n\n# ThreadLocal çè¯¯åº\n\n> ç¤ºä¾æèªï¼ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\nThreadLocal éç¨äºåéå¨çº¿ç¨é´éç¦»ï¼èå¨æ¹æ³æç±»é´å±äº«çåºæ¯ã\n\nåææå°ï¼ThreadLocal æ¯çº¿ç¨éç¦»çï¼é£ä¹æ¯ä¸æ¯ä½¿ç¨ ThreadLocal å°±ä¸å®é«ææ å¿§å¢ï¼\n\n# ThreadLocal éè¯¯æ¡ä¾\n\nä½¿ç¨ Spring Boot åå»ºä¸ä¸ª Web åºç¨ç¨åºï¼ä½¿ç¨ ThreadLocal å­æ¾ä¸ä¸ª Integer çå¼ï¼æ¥æä¸ä»£è¡¨éè¦å¨çº¿ç¨ä¸­ä¿å­çç¨æ·ä¿¡æ¯ï¼è¿ä¸ªå¼åå§æ¯ nullã\n\n    private ThreadLocal<Integer> currentUser = ThreadLocal.withInitial(() -> null);\n\n    @GetMapping("wrong")\n    public Map<String, String> wrong(@RequestParam("id") Integer userId) {\n        //è®¾ç½®ç¨æ·ä¿¡æ¯ä¹ååæ¥è¯¢ä¸æ¬¡ThreadLocalä¸­çç¨æ·ä¿¡æ¯\n        String before = Thread.currentThread().getName() + ":" + currentUser.get();\n        //è®¾ç½®ç¨æ·ä¿¡æ¯å°ThreadLocal\n        currentUser.set(userId);\n        //è®¾ç½®ç¨æ·ä¿¡æ¯ä¹ååæ¥è¯¢ä¸æ¬¡ThreadLocalä¸­çç¨æ·ä¿¡æ¯\n        String after = Thread.currentThread().getName() + ":" + currentUser.get();\n        //æ±æ»è¾åºä¸¤æ¬¡æ¥è¯¢ç»æ\n        Map<String, String> result = new HashMap<>();\n        result.put("before", before);\n        result.put("after", after);\n        return result;\n    }\n\n\nãé¢æãä»ä»£ç é»è¾æ¥çï¼æä»¬é¢æç¬¬ä¸æ¬¡è·åçå¼å§ç»åºè¯¥æ¯ nullã\n\nãå®éã\n\nä¸ºäºæ¹ä¾¿å¤ç°ï¼å° Tomcat å·¥ä½çº¿ç¨è®¾ä¸º 1ï¼\n\nserver.tomcat.max-threads=1\n\n\nå½è®¿é® id = 1 æ¶ï¼ç¬¦åé¢æ\n\n\n\nå½è®¿é® id = 2 æ¶ï¼before çåºç­ä¸æ¯ nullï¼èæ¯ 1ï¼ä¸ç¬¦åé¢æã\n\n\n\nãåæãå®éæåµåé¢æå­å¨åå·®ãSpring Boot ç¨åºè¿è¡å¨ Tomcat ä¸­ï¼æ§è¡ç¨åºççº¿ç¨æ¯ Tomcat çå·¥ä½çº¿ç¨ï¼è Tomcat çå·¥ä½çº¿ç¨æ¯åºäºçº¿ç¨æ± çãçº¿ç¨æ± ä¼éç¨åºå®çå ä¸ªçº¿ç¨ï¼ä¸æ¦çº¿ç¨éç¨ï¼é£ä¹å¾å¯è½é¦æ¬¡ä» ThreadLocal è·åçå¼æ¯ä¹åå¶ä»ç¨æ·çè¯·æ±éççå¼ãè¿æ¶ï¼ThreadLocal ä¸­çç¨æ·ä¿¡æ¯å°±æ¯å¶ä»ç¨æ·çä¿¡æ¯ã\n\nå¹¶ä¸è½è®¤ä¸ºæ²¡ææ¾å¼å¼å¯å¤çº¿ç¨å°±ä¸ä¼æçº¿ç¨å®å¨é®é¢ãä½¿ç¨ç±»ä¼¼ ThreadLocal å·¥å·æ¥å­æ¾ä¸äºæ°æ®æ¶ï¼éè¦ç¹å«æ³¨æå¨ä»£ç è¿è¡å®åï¼æ¾å¼å°å»æ¸ç©ºè®¾ç½®çæ°æ®ã\n\n# ThreadLocal éè¯¯æ¡ä¾ä¿®æ­£\n\n    @GetMapping("right")\n    public Map<String, String> right(@RequestParam("id") Integer userId) {\n        String before = Thread.currentThread().getName() + ":" + currentUser.get();\n        currentUser.set(userId);\n        try {\n            String after = Thread.currentThread().getName() + ":" + currentUser.get();\n            Map<String, String> result = new HashMap<>();\n            result.put("before", before);\n            result.put("after", after);\n            return result;\n        } finally {\n            //å¨finallyä»£ç åä¸­å é¤ThreadLocalä¸­çæ°æ®ï¼ç¡®ä¿æ°æ®ä¸ä¸²\n            currentUser.remove();\n        }\n    }\n\n\n\n# InheritableThreadLocal\n\nInheritableThreadLocal ç±»æ¯ ThreadLocal ç±»çå­ç±»ã\n\nThreadLocal ä¸­æ¯ä¸ªçº¿ç¨æ¥æå®èªå·±ç¬å çæ°æ®ãä¸ ThreadLocal ä¸åçæ¯ï¼InheritableThreadLocal åè®¸ä¸ä¸ªçº¿ç¨ä»¥åè¯¥çº¿ç¨åå»ºçææå­çº¿ç¨é½å¯ä»¥è®¿é®å®ä¿å­çæ°æ®ã\n\n> åçåèï¼Java å¤çº¿ç¨ï¼InheritableThreadLocal å®ç°åç\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * Java å¹¶åç¼ç¨ï¼volatile å³é®å­è§£æ\n * Java å¹¶åç¼ç¨ï¼synchronized\n * æ·±å¥çè§£ Java å¹¶åä¹ synchronized å®ç°åç\n * Java CAS å®å¨è§£è¯»\n * Java ä¸­ CAS è¯¦è§£\n * ThreadLocal ç»æç¯\n * synchronized å®ç°åçåéä¼å\n * Non-blocking Algorithms',normalizedContent:'# java å¹¶åæ ¸å¿æºå¶\n\n> java å¯¹äºå¹¶åçæ¯æä¸»è¦æ±èå¨ java.util.concurrentï¼å³ j.u.cãè j.u.c çæ ¸å¿æ¯ aqsã\n\n\n# j.u.c ç®ä»\n\njava ç java.util.concurrent åï¼ç®ç§° j.u.cï¼ä¸­æä¾äºå¤§éå¹¶åå·¥å·ç±»ï¼æ¯ java å¹¶åè½åçä¸»è¦ä½ç°ï¼æ³¨æï¼ä¸æ¯å¨é¨ï¼æé¨åå¹¶åè½åçæ¯æå¨å¶ä»åä¸­ï¼ãä»åè½ä¸ï¼å¤§è´å¯ä»¥åä¸ºï¼\n\n * åå­ç±» - å¦ï¼atomicintegerãatomicintegerarrayãatomicreferenceãatomicstampedreference ç­ã\n * é - å¦ï¼reentrantlockãreentrantreadwritelock ç­ã\n * å¹¶åå®¹å¨ - å¦ï¼concurrenthashmapãcopyonwritearraylistãcopyonwritearrayset ç­ã\n * é»å¡éå - å¦ï¼arrayblockingqueueãlinkedblockingqueue ç­ã\n * éé»å¡éå - å¦ï¼ concurrentlinkedqueue ãlinkedtransferqueue ç­ã\n * executor æ¡æ¶ï¼çº¿ç¨æ± ï¼- å¦ï¼threadpoolexecutorãexecutors ç­ã\n\næä¸ªäººçè§£ï¼java å¹¶åæ¡æ¶å¯ä»¥åä¸ºä»¥ä¸å±æ¬¡ã\n\n\n\nç± java å¹¶åæ¡æ¶å¾ä¸é¾çåºï¼j.u.c åä¸­çå·¥å·ç±»æ¯åºäº synchronizedãvolatileãcasãthreadlocal è¿æ ·çå¹¶åæ ¸å¿æºå¶æé çãæä»¥ï¼è¦æ³æ·±å¥çè§£ j.u.c å·¥å·ç±»çç¹æ§ãä¸ºä»ä¹å·æè¿æ ·é£æ ·çç¹æ§ï¼å°±å¿é¡»åçè§£è¿äºæ ¸å¿æºå¶ã\n\n\n# synchronized\n\n> synchronized æ¯ java ä¸­çå³é®å­ï¼æ¯ å©ç¨éçæºå¶æ¥å®ç°äºæ¥åæ­¥çã\n> \n> synchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n> \n> å¦æä¸éè¦ lock ãreadwritelock ææä¾çé«çº§åæ­¥ç¹æ§ï¼åºè¯¥ä¼åèèä½¿ç¨ synchronized ï¼çç±å¦ä¸ï¼\n> \n>  * java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ lock ãreadwritelock åºæ¬ä¸æå¹³ãä»è¶å¿æ¥çï¼java æªæ¥ä»å°ç»§ç»­ä¼å synchronized ï¼èä¸æ¯ reentrantlock ã\n>  * reentrantlock æ¯ oracle jdk ç apiï¼å¨å¶ä»çæ¬ç jdk ä¸­ä¸ä¸å®æ¯æï¼è synchronized æ¯ jvm çåç½®ç¹æ§ï¼ææ jdk çæ¬é½æä¾æ¯æã\n\n\n# synchronized çåºç¨\n\nsynchronized æ 3 ç§åºç¨æ¹å¼ï¼\n\n * åæ­¥å®ä¾æ¹æ³ - å¯¹äºæ®éåæ­¥æ¹æ³ï¼éæ¯å½åå®ä¾å¯¹è±¡\n * åæ­¥éææ¹æ³ - å¯¹äºéæåæ­¥æ¹æ³ï¼éæ¯å½åç±»ç class å¯¹è±¡\n * åæ­¥ä»£ç å - å¯¹äºåæ­¥æ¹æ³åï¼éæ¯ synchonized æ¬å·ééç½®çå¯¹è±¡\n\n> è¯´æï¼\n> \n> ç±»ä¼¼ vectorãhashtable è¿ç±»åæ­¥ç±»ï¼å°±æ¯ä½¿ç¨ synchonized ä¿®é¥°å¶éè¦æ¹æ³ï¼æ¥ä¿è¯å¶çº¿ç¨å®å¨ã\n> \n> äºå®ä¸ï¼è¿ç±»åæ­¥å®¹å¨ä¹éç»å¯¹ççº¿ç¨å®å¨ï¼å½æ§è¡è¿­ä»£å¨éåï¼æ ¹æ®æ¡ä»¶å é¤åç´ è¿ç§åºæ¯ä¸ï¼å°±å¯è½åºç°çº¿ç¨ä¸å®å¨çæåµãæ­¤å¤ï¼java 1.6 éå¯¹ synchonized è¿è¡ä¼ååï¼ç±äºé»å¡ï¼å¶æ§è½ä¸é«ã\n> \n> ç»¼ä¸ï¼è¿ç±»åæ­¥å®¹å¨ï¼å¨ç°ä»£ java ç¨åºä¸­ï¼å·²ç»æ¸æ¸ä¸ç¨äºã\n\n# åæ­¥å®ä¾æ¹æ³\n\nâ éè¯¯ç¤ºä¾ - æªåæ­¥çç¤ºä¾\n\npublic class nosynchronizeddemo implements runnable {\n\n    public static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        nosynchronizeddemo instance = new nosynchronizeddemo();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    public void increase() {\n        count++;\n    }\n\n}\n// è¾åºç»æ: å°äº 200000 çéæºæ°å­\n\n\njava å®ä¾æ¹æ³åæ­¥æ¯åæ­¥å¨æ¥æè¯¥æ¹æ³çå¯¹è±¡ä¸ãè¿æ ·ï¼æ¯ä¸ªå®ä¾å¶æ¹æ³åæ­¥é½åæ­¥å¨ä¸åçå¯¹è±¡ä¸ï¼å³è¯¥æ¹æ³æå±çå®ä¾ãåªæä¸ä¸ªçº¿ç¨è½å¤å¨å®ä¾æ¹æ³åæ­¥åä¸­è¿è¡ãå¦ææå¤ä¸ªå®ä¾å­å¨ï¼é£ä¹ä¸ä¸ªçº¿ç¨ä¸æ¬¡å¯ä»¥å¨ä¸ä¸ªå®ä¾åæ­¥åä¸­æ§è¡æä½ãä¸ä¸ªå®ä¾ä¸ä¸ªçº¿ç¨ã\n\npublic class synchronizeddemo implements runnable {\n\n    private static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        synchronizeddemo instance = new synchronizeddemo();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°æ®éæ¹æ³\n     */\n    public synchronized void increase() {\n        count++;\n    }\n\n}\n\n\nãç¤ºä¾ãéè¯¯ç¤ºä¾\n\nclass account {\n  private int balance;\n  // è½¬è´¦\n  synchronized void transfer(\n      account target, int amt){\n    if (this.balance > amt) {\n      this.balance -= amt;\n      target.balance += amt;\n    }\n  }\n}\n\n\nå¨è¿æ®µä»£ç ä¸­ï¼ä¸´çåºåæä¸¤ä¸ªèµæºï¼åå«æ¯è½¬åºè´¦æ·çä½é¢ this.balance åè½¬å¥è´¦æ·çä½é¢ target.balanceï¼å¹¶ä¸ç¨çæ¯ä¸æé thisï¼ç¬¦åæä»¬åé¢æå°çï¼å¤ä¸ªèµæºå¯ä»¥ç¨ä¸æéæ¥ä¿æ¤ï¼è¿çä¸å»å®å¨æ­£ç¡®åãççæ¯è¿æ ·åï¼å¯æï¼è¿ä¸ªæ¹æ¡ä»ä»æ¯çä¼¼æ­£ç¡®ï¼ä¸ºä»ä¹å¢ï¼\n\né®é¢å°±åºå¨ this è¿æéä¸ï¼this è¿æéå¯ä»¥ä¿æ¤èªå·±çä½é¢ this.balanceï¼å´ä¿æ¤ä¸äºå«äººçä½é¢ target.balanceï¼å°±åä½ ä¸è½ç¨èªå®¶çéæ¥ä¿æ¤å«äººå®¶çèµäº§ï¼ä¹ä¸è½ç¨èªå·±çç¥¨æ¥ä¿æ¤å«äººçåº§ä½ä¸æ ·ã\n\n\n\nåºè¯¥ä¿è¯ä½¿ç¨çéè½è¦çææåä¿æ¤èµæºã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass account {\n  private object lockï¼\n  private int balance;\n  private account();\n  // åå»º account æ¶ä¼ å¥åä¸ä¸ª lock å¯¹è±¡\n  public account(object lock) {\n    this.lock = lock;\n  }\n  // è½¬è´¦\n  void transfer(account target, int amt){\n    // æ­¤å¤æ£æ¥ææå¯¹è±¡å±äº«çé\n    synchronized(lock) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\nè¿ä¸ªåæ³ç¡®å®è½è§£å³é®é¢ï¼ä½æ¯æç¹å°ççµï¼å®è¦æ±å¨åå»º account å¯¹è±¡çæ¶åå¿é¡»ä¼ å¥åä¸ä¸ªå¯¹è±¡ï¼å¦æåå»º account å¯¹è±¡æ¶ï¼ä¼ å¥ç lock ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼é£å¯å°±æ¨äºï¼ä¼åºç°éèªå®¶é¨æ¥ä¿æ¤ä»å®¶èµäº§çèåäºãå¨çå®çé¡¹ç®åºæ¯ä¸­ï¼åå»º account å¯¹è±¡çä»£ç å¾å¯è½åæ£å¨å¤ä¸ªå·¥ç¨ä¸­ï¼ä¼ å¥å±äº«ç lock ççå¾é¾ã\n\nä¸é¢çæ¹æ¡ç¼ºä¹å®è·µçå¯è¡æ§ï¼æä»¬éè¦æ´å¥½çæ¹æ¡ãè¿çæï¼å°±æ¯ç¨ account.class ä½ä¸ºå±äº«çéãaccount.class æ¯ææ account å¯¹è±¡å±äº«çï¼èä¸è¿ä¸ªå¯¹è±¡æ¯ java èææºå¨å è½½ account ç±»çæ¶ååå»ºçï¼æä»¥æä»¬ä¸ç¨æå¿å®çå¯ä¸æ§ãä½¿ç¨ account.class ä½ä¸ºå±äº«çéï¼æä»¬å°±æ éå¨åå»º account å¯¹è±¡æ¶ä¼ å¥äºï¼ä»£ç æ´ç®åã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass account {\n  private int balance;\n  // è½¬è´¦\n  void transfer(account target, int amt){\n    synchronized(account.class) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\n# åæ­¥éææ¹æ³\n\néææ¹æ³çåæ­¥æ¯æåæ­¥å¨è¯¥æ¹æ³æå¨çç±»å¯¹è±¡ä¸ãå ä¸ºå¨ jvm ä¸­ä¸ä¸ªç±»åªè½å¯¹åºä¸ä¸ªç±»å¯¹è±¡ï¼æä»¥åæ¶åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡åä¸ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³ã\n\nå¯¹äºä¸åç±»ä¸­çéæåæ­¥æ¹æ³ï¼ä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æ¯ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³èæ éç­å¾ãä¸ç®¡ç±»ä¸­çåªä¸ªéæåæ­¥æ¹æ³è¢«è°ç¨ï¼ä¸ä¸ªç±»åªè½ç±ä¸ä¸ªçº¿ç¨åæ¶æ§è¡ã\n\npublic class synchronizeddemo2 implements runnable {\n\n    private static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        synchronizeddemo2 instance = new synchronizeddemo2();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°éææ¹æ³\n     */\n    public synchronized static void increase() {\n        count++;\n    }\n\n}\n\n\n# åæ­¥ä»£ç å\n\nææ¶ä½ ä¸éè¦åæ­¥æ´ä¸ªæ¹æ³ï¼èæ¯åæ­¥æ¹æ³ä¸­çä¸é¨åãjava å¯ä»¥å¯¹æ¹æ³çä¸é¨åè¿è¡åæ­¥ã\n\n@threadsafe\npublic class synchronizeddemo05 implements runnable {\n\n    private static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        synchronizeddemo05 instance = new synchronizeddemo05();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°ä»£ç å\n     */\n    public void increase() {\n        synchronized (this) {\n            count++;\n        }\n    }\n\n}\n\n\næ³¨æ java åæ­¥åæé å¨ç¨æ¬å·å°å¯¹è±¡æ¬èµ·æ¥ãå¨ä¸ä¾ä¸­ï¼ä½¿ç¨äº thisï¼å³ä¸ºè°ç¨ increase æ¹æ³çå®ä¾æ¬èº«ãç¨æ¬å·æ¬èµ·æ¥çå¯¹è±¡å«åçè§å¨å¯¹è±¡ãä¸æ¬¡åªæä¸ä¸ªçº¿ç¨è½å¤å¨åæ­¥äºåä¸ä¸ªçè§å¨å¯¹è±¡ç java æ¹æ³åæ§è¡ã\n\nå¦ææ¯éææ¹æ³ï¼å°±ä¸è½ç¨ this å¯¹è±¡ä½ä¸ºçè§å¨å¯¹è±¡äºï¼èæ¯ä½¿ç¨ class å¯¹è±¡ï¼å¦ä¸ï¼\n\npublic class synchronizeddemo3 implements runnable {\n\n    private static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        synchronizeddemo3 instance = new synchronizeddemo3();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°ä»£ç å\n     */\n    public static void increase() {\n        synchronized (synchronizeddemo3.class) {\n            count++;\n        }\n    }\n\n}\n\n\n\n# synchronized çåç\n\nsynchronized ä»£ç åæ¯ç±ä¸å¯¹ monitorenter å monitorexit æä»¤å®ç°çï¼monitor å¯¹è±¡æ¯åæ­¥çåºæ¬å®ç°ååãå¨ java 6 ä¹åï¼monitor çå®ç°å®å¨æ¯ä¾é æä½ç³»ç»åé¨çäºæ¥éï¼å ä¸ºéè¦è¿è¡ç¨æ·æå°åæ ¸æçåæ¢ï¼æä»¥åæ­¥æä½æ¯ä¸ä¸ªæ å·®å«çééçº§æä½ã\n\nå¦æ synchronized æç¡®å¶å®äºå¯¹è±¡åæ°ï¼é£å°±æ¯è¿ä¸ªå¯¹è±¡çå¼ç¨ï¼å¦ææ²¡ææç¡®æå®ï¼é£å°±æ ¹æ® synchronized ä¿®é¥°çæ¯å®ä¾æ¹æ³è¿æ¯éææ¹æ³ï¼å»å¯¹å¯¹åºçå¯¹è±¡å®ä¾æ class å¯¹è±¡æ¥ä½ä¸ºéå¯¹è±¡ã\n\nsynchronized åæ­¥åå¯¹åä¸çº¿ç¨æ¥è¯´æ¯å¯éå¥çï¼ä¸ä¼åºç°éæ­»é®é¢ã\n\nsynchronized åæ­¥åæ¯äºæ¥çï¼å³å·²è¿å¥ççº¿ç¨æ§è¡å®æåï¼ä¼é»å¡å¶ä»è¯å¾è¿å¥ççº¿ç¨ã\n\nãç¤ºä¾ã\n\npublic void foo(object lock) {\n    synchronized (lock) {\n      lock.hashcode();\n    }\n  }\n  // ä¸é¢ç java ä»£ç å°ç¼è¯ä¸ºä¸é¢çå­èç \n  public void foo(java.lang.object);\n    code:\n       0: aload_1\n       1: dup\n       2: astore_2\n       3: monitorenter\n       4: aload_1\n       5: invokevirtual java/lang/object.hashcode:()i\n       8: pop\n       9: aload_2\n      10: monitorexit\n      11: goto          19\n      14: astore_3\n      15: aload_2\n      16: monitorexit\n      17: aload_3\n      18: athrow\n      19: return\n    exception table:\n       from    to  target type\n           4    11    14   any\n          14    17    14   any\n\n\n\n# åæ­¥ä»£ç å\n\nsynchronized å¨ä¿®é¥°åæ­¥ä»£ç åæ¶ï¼æ¯ç± monitorenter å monitorexit æä»¤æ¥å®ç°åæ­¥çãè¿å¥ monitorenter æä»¤åï¼çº¿ç¨å°ææ monitor å¯¹è±¡ï¼éåº monitorenter æä»¤åï¼çº¿ç¨å°éæ¾è¯¥ monitor å¯¹è±¡ã\n\n# åæ­¥æ¹æ³\n\nsynchronized ä¿®é¥°åæ­¥æ¹æ³æ¶ï¼ä¼è®¾ç½®ä¸ä¸ª acc_synchronized æ å¿ãå½æ¹æ³è°ç¨æ¶ï¼è°ç¨æä»¤å°ä¼æ£æ¥è¯¥æ¹æ³æ¯å¦è¢«è®¾ç½® acc_synchronized è®¿é®æ å¿ãå¦æè®¾ç½®äºè¯¥æ å¿ï¼æ§è¡çº¿ç¨å°åææ monitor å¯¹è±¡ï¼ç¶ååæ§è¡æ¹æ³ãå¨è¯¥æ¹æ³è¿è¡æé´ï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ mointor å¯¹è±¡ï¼å½æ¹æ³æ§è¡å®æåï¼åéæ¾è¯¥ monitor å¯¹è±¡ã\n\n# monitor\n\næ¯ä¸ªå¯¹è±¡å®ä¾é½ä¼æä¸ä¸ª monitorï¼monitor å¯ä»¥åå¯¹è±¡ä¸èµ·åå»ºãéæ¯ãmonitor æ¯ç± objectmonitor å®ç°ï¼è objectmonitor æ¯ç± c++ ç objectmonitor.hpp æä»¶å®ç°ã\n\nå½å¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸æ®µåæ­¥ä»£ç æ¶ï¼å¤ä¸ªçº¿ç¨ä¼åè¢«å­æ¾å¨ entrylist éåä¸­ï¼å¤äº block ç¶æççº¿ç¨ï¼é½ä¼è¢«å å¥å°è¯¥åè¡¨ãæ¥ä¸æ¥å½çº¿ç¨è·åå°å¯¹è±¡ç monitor æ¶ï¼monitor æ¯ä¾é åºå±æä½ç³»ç»ç mutex lock æ¥å®ç°äºæ¥çï¼çº¿ç¨ç³è¯· mutex æåï¼åææè¯¥ mutexï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ mutexã\n\nå¦æçº¿ç¨è°ç¨ wait() æ¹æ³ï¼å°±ä¼éæ¾å½åææç mutexï¼å¹¶ä¸è¯¥çº¿ç¨ä¼è¿å¥ waitset éåä¸­ï¼ç­å¾ä¸ä¸æ¬¡è¢«å¤éãå¦æå½åçº¿ç¨é¡ºå©æ§è¡å®æ¹æ³ï¼ä¹å°éæ¾ mutexã\n\n\n# synchronized çä¼å\n\n> java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ lock ãreadwritelock åºæ¬ä¸æå¹³ã\n\n# java å¯¹è±¡å¤´\n\nå¨ jdk1.6 jvm ä¸­ï¼å¯¹è±¡å®ä¾å¨å åå­ä¸­è¢«åä¸ºäºä¸ä¸ªé¨åï¼å¯¹è±¡å¤´ãå®ä¾æ°æ®åå¯¹é½å¡«åãå¶ä¸­ java å¯¹è±¡å¤´ç± mark wordãæåç±»çæéä»¥åæ°ç»é¿åº¦ä¸é¨åç»æã\n\nmark word è®°å½äºå¯¹è±¡åéæå³çä¿¡æ¯ãmark word å¨ 64 ä½ jvm ä¸­çé¿åº¦æ¯ 64bitï¼æä»¬å¯ä»¥ä¸èµ·çä¸ 64 ä½ jvm çå­å¨ç»ææ¯æä¹æ ·çãå¦ä¸å¾æç¤ºï¼\n\n\n\néåçº§åè½ä¸»è¦ä¾èµäº mark word ä¸­çéæ å¿ä½åæ¯å¦ååéæ å¿ä½ï¼synchronized åæ­¥éå°±æ¯ä»ååéå¼å§çï¼éçç«äºè¶æ¥è¶æ¿çï¼ååéåçº§å°è½»éçº§éï¼æç»åçº§å°ééçº§éã\n\njava 1.6 å¼å¥äºååéåè½»éçº§éï¼ä»èè®© synchronized æ¥æäºåä¸ªç¶æï¼\n\n * æ éç¶æï¼unlockedï¼\n * ååéç¶æï¼biasbleï¼\n * è½»éçº§éç¶æï¼lightweight lockedï¼\n * ééçº§éç¶æï¼inflatedï¼\n\nå½ jvm æ£æµå°ä¸åçç«äºç¶åµæ¶ï¼ä¼èªå¨åæ¢å°éåçéå®ç°ã\n\nå½æ²¡æç«äºåºç°æ¶ï¼é»è®¤ä¼ä½¿ç¨ååéãjvm ä¼å©ç¨ cas æä½ï¼compare and swapï¼ï¼å¨å¯¹è±¡å¤´ä¸ç mark word é¨åè®¾ç½®çº¿ç¨ idï¼ä»¥è¡¨ç¤ºè¿ä¸ªå¯¹è±¡ååäºå½åçº¿ç¨ï¼æä»¥å¹¶ä¸æ¶åçæ­£çäºæ¥éãè¿æ ·åçåè®¾æ¯åºäºå¨å¾å¤åºç¨åºæ¯ä¸­ï¼å¤§é¨åå¯¹è±¡çå½å¨æä¸­æå¤ä¼è¢«ä¸ä¸ªçº¿ç¨éå®ï¼ä½¿ç¨åæéå¯ä»¥éä½æ ç«äºå¼éã\n\nå¦ææå¦å¤ççº¿ç¨è¯å¾éå®æä¸ªå·²ç»è¢«åæè¿çå¯¹è±¡ï¼jvm å°±éè¦æ¤éï¼revokeï¼ååéï¼å¹¶åæ¢å°è½»éçº§éå®ç°ãè½»éçº§éä¾èµ cas æä½ mark word æ¥è¯å¾è·åéï¼å¦æéè¯æåï¼å°±ä½¿ç¨æ®éçè½»éçº§éï¼å¦åï¼è¿ä¸æ­¥åçº§ä¸ºééçº§éã\n\n# ååé\n\nååéçææ³æ¯ååäºç¬¬ä¸ä¸ªè·åéå¯¹è±¡ççº¿ç¨ï¼è¿ä¸ªçº¿ç¨å¨ä¹åè·åè¯¥éå°±ä¸åéè¦è¿è¡åæ­¥æä½ï¼çè³è¿ cas æä½ä¹ä¸åéè¦ã\n\n\n\n# è½»éçº§é\n\nè½»éçº§éæ¯ç¸å¯¹äºä¼ ç»çééçº§éèè¨ï¼å® ä½¿ç¨ cas æä½æ¥é¿åééçº§éä½¿ç¨äºæ¥éçå¼éãå¯¹äºç»å¤§é¨åçéï¼å¨æ´ä¸ªåæ­¥å¨æåé½æ¯ä¸å­å¨ç«äºçï¼å æ­¤ä¹å°±ä¸éè¦é½ä½¿ç¨äºæ¥éè¿è¡åæ­¥ï¼å¯ä»¥åéç¨ cas æä½è¿è¡åæ­¥ï¼å¦æ cas å¤±è´¥äºåæ¹ç¨äºæ¥éè¿è¡åæ­¥ã\n\nå½å°è¯è·åä¸ä¸ªéå¯¹è±¡æ¶ï¼å¦æéå¯¹è±¡æ è®°ä¸º 0|01ï¼è¯´æéå¯¹è±¡çéæªéå®ï¼unlockedï¼ç¶æãæ­¤æ¶èææºå¨å½åçº¿ç¨çèææºæ ä¸­åå»º lock recordï¼ç¶åä½¿ç¨ cas æä½å°å¯¹è±¡ç mark word æ´æ°ä¸º lock record æéãå¦æ cas æä½æåäºï¼é£ä¹çº¿ç¨å°±è·åäºè¯¥å¯¹è±¡ä¸çéï¼å¹¶ä¸å¯¹è±¡ç mark word çéæ è®°åä¸º 00ï¼è¡¨ç¤ºè¯¥å¯¹è±¡å¤äºè½»éçº§éç¶æã\n\n\n\n# éæ¶é¤ / éç²å\n\né¤äºéåçº§ä¼åï¼java è¿ä½¿ç¨äºç¼è¯å¨å¯¹éè¿è¡ä¼åã\n\nï¼1ï¼éæ¶é¤\n\néæ¶é¤æ¯æå¯¹äºè¢«æ£æµåºä¸å¯è½å­å¨ç«äºçå±äº«æ°æ®çéè¿è¡æ¶é¤ã\n\njit ç¼è¯å¨å¨å¨æç¼è¯åæ­¥åçæ¶åï¼åå©äºä¸ç§è¢«ç§°ä¸ºéé¸åæçææ¯ï¼æ¥å¤æ­åæ­¥åä½¿ç¨çéå¯¹è±¡æ¯å¦åªè½å¤è¢«ä¸ä¸ªçº¿ç¨è®¿é®ï¼èæ²¡æè¢«åå¸å°å¶å®çº¿ç¨ã\n\nç¡®è®¤æ¯çè¯ï¼é£ä¹ jit ç¼è¯å¨å¨ç¼è¯è¿ä¸ªåæ­¥åçæ¶åä¸ä¼çæ synchronized æè¡¨ç¤ºçéçç³è¯·ä¸éæ¾çæºå¨ç ï¼å³æ¶é¤äºéçä½¿ç¨ãå¨ java7 ä¹åççæ¬å°±ä¸éè¦æå¨éç½®äºï¼è¯¥æä½å¯ä»¥èªå¨å®ç°ã\n\nå¯¹äºä¸äºçèµ·æ¥æ²¡æå éçä»£ç ï¼å¶å®éå¼çå äºå¾å¤éãä¾å¦ä¸é¢çå­ç¬¦ä¸²æ¼æ¥ä»£ç å°±éå¼å äºéï¼\n\npublic static string concatstring(string s1, string s2, string s3) {\n    return s1 + s2 + s3;\n}\n\n\nstring æ¯ä¸ä¸ªä¸å¯åçç±»ï¼ç¼è¯å¨ä¼å¯¹ string çæ¼æ¥èªå¨ä¼åãå¨ java 1.5 ä¹åï¼ä¼è½¬åä¸º stringbuffer å¯¹è±¡çè¿ç»­ append() æä½ï¼\n\npublic static string concatstring(string s1, string s2, string s3) {\n    stringbuffer sb = new stringbuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.tostring();\n}\n\n\næ¯ä¸ª append() æ¹æ³ä¸­é½æä¸ä¸ªåæ­¥åãèææºè§å¯åé sbï¼å¾å¿«å°±ä¼åç°å®çå¨æä½ç¨åè¢«éå¶å¨ concatstring() æ¹æ³åé¨ãä¹å°±æ¯è¯´ï¼sb çææå¼ç¨æ°¸è¿ä¸ä¼éé¸å° concatstring() æ¹æ³ä¹å¤ï¼å¶ä»çº¿ç¨æ æ³è®¿é®å°å®ï¼å æ­¤å¯ä»¥è¿è¡æ¶é¤ã\n\nï¼2ï¼éç²å\n\néç²ååçï¼å°±æ¯å¨ jit ç¼è¯å¨å¨æç¼è¯æ¶ï¼å¦æåç°å ä¸ªç¸é»çåæ­¥åä½¿ç¨çæ¯åä¸ä¸ªéå®ä¾ï¼é£ä¹ jit ç¼è¯å¨å°ä¼æè¿å ä¸ªåæ­¥ååå¹¶ä¸ºä¸ä¸ªå¤§çåæ­¥åï¼ä»èé¿åä¸ä¸ªçº¿ç¨âåå¤ç³è¯·ãéæ¾åä¸ä¸ªéâæå¸¦æ¥çæ§è½å¼éã\n\nå¦æä¸ç³»åçè¿ç»­æä½é½å¯¹åä¸ä¸ªå¯¹è±¡åå¤å éåè§£éï¼é¢ç¹çå éæä½å°±ä¼å¯¼è´æ§è½æèã\n\nä¸ä¸èçç¤ºä¾ä»£ç ä¸­è¿ç»­ç append() æ¹æ³å°±å±äºè¿ç±»æåµãå¦æèææºæ¢æµå°ç±è¿æ ·çä¸ä¸²é¶ç¢çæä½é½å¯¹åä¸ä¸ªå¯¹è±¡å éï¼å°ä¼æå éçèå´æ©å±ï¼ç²åï¼å°æ´ä¸ªæä½åºåçå¤é¨ãå¯¹äºä¸ä¸èçç¤ºä¾ä»£ç å°±æ¯æ©å±å°ç¬¬ä¸ä¸ª append() æä½ä¹åç´è³æåä¸ä¸ª append() æä½ä¹åï¼è¿æ ·åªéè¦å éä¸æ¬¡å°±å¯ä»¥äºã\n\n# èªæé\n\näºæ¥åæ­¥è¿å¥é»å¡ç¶æçå¼éé½å¾å¤§ï¼åºè¯¥å°½éé¿åãå¨è®¸å¤åºç¨ä¸­ï¼å±äº«æ°æ®çéå®ç¶æåªä¼æç»­å¾ç­çä¸æ®µæ¶é´ãèªæéçææ³æ¯è®©ä¸ä¸ªçº¿ç¨å¨è¯·æ±ä¸ä¸ªå±äº«æ°æ®çéæ¶æ§è¡å¿å¾ªç¯ï¼èªæï¼ä¸æ®µæ¶é´ï¼å¦æå¨è¿æ®µæ¶é´åè½è·å¾éï¼å°±å¯ä»¥é¿åè¿å¥é»å¡ç¶æã\n\nèªæéè½ç¶è½é¿åè¿å¥é»å¡ç¶æä»èåå°å¼éï¼ä½æ¯å®éè¦è¿è¡å¿å¾ªç¯æä½å ç¨ cpu æ¶é´ï¼å®åªéç¨äºå±äº«æ°æ®çéå®ç¶æå¾ç­çåºæ¯ã\n\nå¨ java 1.6 ä¸­å¼å¥äºèªéåºçèªæéãèªéåºæå³çèªæçæ¬¡æ°ä¸ååºå®äºï¼èæ¯ç±åä¸æ¬¡å¨åä¸ä¸ªéä¸çèªææ¬¡æ°åéçæ¥æèçç¶ææ¥å³å®ã\n\n\n# synchronized çè¯¯åº\n\n> ç¤ºä¾æèªï¼ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\n# synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯\n\npublic class interesting {\n\n    volatile int a = 1;\n    volatile int b = 1;\n\n    public static void main(string[] args) {\n        interesting interesting = new interesting();\n        new thread(() -> interesting.add()).start();\n        new thread(() -> interesting.compare()).start();\n    }\n\n    public synchronized void add() {\n        log.info("add start");\n        for (int i = 0; i < 10000; i++) {\n            a++;\n            b++;\n        }\n        log.info("add done");\n    }\n\n    public void compare() {\n        log.info("compare start");\n        for (int i = 0; i < 10000; i++) {\n            //aå§ç»ç­äºbåï¼\n            if (a < b) {\n                log.info("a:{},b:{},{}", a, b, a > b);\n                //æåça>båºè¯¥å§ç»æ¯falseåï¼\n            }\n        }\n        log.info("compare done");\n    }\n\n}\n\n\nãè¾åºã\n\n16:05:25.541 [thread-0] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add start\n16:05:25.544 [thread-0] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add done\n16:05:25.544 [thread-1] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare start\n16:05:25.544 [thread-1] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare done\n\n\nä¹æä»¥åºç°è¿ç§éä¹±ï¼æ¯å ä¸ºä¸¤ä¸ªçº¿ç¨æ¯äº¤éæ§è¡ add å compare æ¹æ³ä¸­çä¸å¡é»è¾ï¼èä¸è¿äºä¸å¡é»è¾ä¸æ¯åå­æ§çï¼a++ å b++ æä½ä¸­å¯ä»¥ç©¿æå¨ compare æ¹æ³çæ¯è¾ä»£ç ä¸­ï¼æ´éè¦æ³¨æçæ¯ï¼a<b è¿ç§æ¯è¾æä½å¨å­èç å±é¢æ¯å è½½ aãå è½½ b åæ¯è¾ä¸æ­¥ï¼ä»£ç è½ç¶æ¯ä¸è¡ä½ä¹ä¸æ¯åå­æ§çã\n\næä»¥ï¼æ­£ç¡®çåæ³åºè¯¥æ¯ï¼ä¸º add å compare é½å ä¸æ¹æ³éï¼ç¡®ä¿ add æ¹æ³æ§è¡æ¶ï¼compare æ æ³è¯»å a å bï¼\n\npublic synchronized void add()\npublic synchronized void compare()\n\n\næä»¥ï¼ä½¿ç¨éè§£å³é®é¢ä¹åä¸å®è¦çæ¸æ¥ï¼æä»¬è¦ä¿æ¤çæ¯ä»ä¹é»è¾ï¼å¤çº¿ç¨æ§è¡çæåµåæ¯ææ ·çã\n\n# synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯\n\nå éåè¦æ¸æ¥éåè¢«ä¿æ¤çå¯¹è±¡æ¯ä¸æ¯ä¸ä¸ªå±é¢çã\n\néæå­æ®µå±äºç±»ï¼ç±»çº§å«çéæè½ä¿æ¤ï¼èééæå­æ®µå±äºç±»å®ä¾ï¼å®ä¾çº§å«çéå°±å¯ä»¥ä¿æ¤ã\n\npublic class synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 {\n\n    public static void main(string[] args) {\n        synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 demo = new synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2();\n        system.out.println(demo.wrong(1000000));\n        system.out.println(demo.right(1000000));\n    }\n\n    public int wrong(int count) {\n        data.reset();\n        intstream.rangeclosed(1, count).parallel().foreach(i -> new data().wrong());\n        return data.getcounter();\n    }\n\n    public int right(int count) {\n        data.reset();\n        intstream.rangeclosed(1, count).parallel().foreach(i -> new data().right());\n        return data.getcounter();\n    }\n\n    private static class data {\n\n        @getter\n        private static int counter = 0;\n        private static object locker = new object();\n\n        public static int reset() {\n            counter = 0;\n            return counter;\n        }\n\n        public synchronized void wrong() {\n            counter++;\n        }\n\n        public void right() {\n            synchronized (locker) {\n                counter++;\n            }\n        }\n\n    }\n\n}\n\n\nwrong æ¹æ³ä¸­è¯å¾å¯¹ä¸ä¸ªéæå¯¹è±¡å å¯¹è±¡çº§å«ç synchronized éï¼å¹¶ä¸è½ä¿è¯çº¿ç¨å®å¨ã\n\n# éç²åº¦å¯¼è´çé®é¢\n\nè¦å°½å¯è½çç¼©å°å éçèå´ï¼è¿å¯ä»¥æé«å¹¶åååã\n\nå¦æç²¾ç»åèèäºéåºç¨èå´åï¼æ§è½è¿æ æ³æ»¡è¶³éæ±çè¯ï¼æä»¬å°±è¦èèå¦ä¸ä¸ªç»´åº¦çç²åº¦é®é¢äºï¼å³ï¼åºåè¯»ååºæ¯ä»¥åèµæºçè®¿é®å²çªï¼èèä½¿ç¨æ²è§æ¹å¼çéè¿æ¯ä¹è§æ¹å¼çéã\n\npublic class synchronizedéç²åº¦ä¸å½ {\n\n    public static void main(string[] args) {\n        demo demo = new demo();\n        demo.wrong();\n        demo.right();\n    }\n\n    private static class demo {\n\n        private list<integer> data = new arraylist<>();\n\n        private void slow() {\n            try {\n                timeunit.milliseconds.sleep(10);\n            } catch (interruptedexception e) {\n            }\n        }\n\n        public int wrong() {\n            long begin = system.currenttimemillis();\n            intstream.rangeclosed(1, 1000).parallel().foreach(i -> {\n                synchronized (this) {\n                    slow();\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", system.currenttimemillis() - begin);\n            return data.size();\n        }\n\n        public int right() {\n            long begin = system.currenttimemillis();\n            intstream.rangeclosed(1, 1000).parallel().foreach(i -> {\n                slow();\n                synchronized (data) {\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", system.currenttimemillis() - begin);\n            return data.size();\n        }\n\n    }\n\n}\n\n\n\n# volatile\n\n\n# volatile çè¦ç¹\n\nvolatile æ¯è½»éçº§ç synchronizedï¼å®å¨å¤å¤çå¨å¼åä¸­ä¿è¯äºå±äº«åéçâå¯è§æ§âã\n\nè¢« volatile ä¿®é¥°çåéï¼å·å¤ä»¥ä¸ç¹æ§ï¼\n\n * çº¿ç¨å¯è§æ§ - ä¿è¯äºä¸åçº¿ç¨å¯¹è¿ä¸ªåéè¿è¡æä½æ¶çå¯è§æ§ï¼å³ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªå±äº«åéï¼å¦å¤ä¸ä¸ªçº¿ç¨è½è¯»å°è¿ä¸ªä¿®æ¹çå¼ã\n * ç¦æ­¢æä»¤éæåº\n * ä¸ä¿è¯åå­æ§\n\næä»¬ç¥éï¼çº¿ç¨å®å¨éè¦å·å¤ï¼å¯è§æ§ãåå­æ§ãé¡ºåºæ§ãvolatile ä¸ä¿è¯åå­æ§ï¼æä»¥å³å®äºå®ä¸è½å½»åºå°ä¿è¯çº¿ç¨å®å¨ã\n\n\n# volatile çåºç¨\n\nå¦æ volatile åéä¿®é¥°ç¬¦ä½¿ç¨æ°å½çè¯ï¼å®æ¯ synchronized çä½¿ç¨åæ§è¡ææ¬æ´ä½ï¼å ä¸ºå®ä¸ä¼å¼èµ·çº¿ç¨ä¸ä¸æçåæ¢åè°åº¦ãä½æ¯ï¼volatile æ æ³æ¿ä»£ synchronized ï¼å ä¸º volatile æ æ³ä¿è¯æä½çåå­æ§ã\n\néå¸¸æ¥è¯´ï¼ä½¿ç¨ volatile å¿é¡»å·å¤ä»¥ä¸ 2 ä¸ªæ¡ä»¶ï¼\n\n * å¯¹åéçåæä½ä¸ä¾èµäºå½åå¼\n * è¯¥åéæ²¡æåå«å¨å·æå¶ä»åéçè¡¨è¾¾å¼ä¸­\n\nãç¤ºä¾ãç¶ææ è®°é\n\nvolatile boolean flag = false;\n\nwhile(!flag) {\n    dosomething();\n}\n\npublic void setflag() {\n    flag = true;\n}\n\n\nãç¤ºä¾ãåééå®ç°çº¿ç¨å®å¨çåä¾æ¨¡å¼\n\nclass singleton {\n    private volatile static singleton instance = null;\n\n    private singleton() {}\n\n    public static singleton getinstance() {\n        if(instance==null) {\n            synchronized (singleton.class) {\n                if(instance==null)\n                    instance = new singleton();\n            }\n        }\n        return instance;\n    }\n}\n\n\n\n# volatile çåç\n\nè§å¯å å¥ volatile å³é®å­åæ²¡æå å¥ volatile å³é®å­æ¶æçæçæ±ç¼ä»£ç åç°ï¼å å¥ volatile å³é®å­æ¶ï¼ä¼å¤åºä¸ä¸ª lock åç¼æä»¤ãlock åç¼æä»¤å®éä¸ç¸å½äºä¸ä¸ªåå­å±éï¼ä¹æåå­æ æ ï¼ï¼åå­å±éä¼æä¾ 3 ä¸ªåè½ï¼\n\n * å®ç¡®ä¿æä»¤éæåºæ¶ä¸ä¼æå¶åé¢çæä»¤æå°åå­å±éä¹åçä½ç½®ï¼ä¹ä¸ä¼æåé¢çæä»¤æå°åå­å±éçåé¢ï¼å³å¨æ§è¡å°åå­å±éè¿å¥æä»¤æ¶ï¼å¨å®åé¢çæä½å·²ç»å¨é¨å®æï¼\n * å®ä¼å¼ºå¶å°å¯¹ç¼å­çä¿®æ¹æä½ç«å³åå¥ä¸»å­ï¼\n * å¦ææ¯åæä½ï¼å®ä¼å¯¼è´å¶ä» cpu ä¸­å¯¹åºçç¼å­è¡æ æã\n\n\n# volatile çé®é¢\n\nvolatile çè¦ç¹ä¸­ï¼å·²ç»æå°ï¼volatile ä¸ä¿è¯åå­æ§ï¼æä»¥ volatile å¹¶ä¸è½ä¿è¯çº¿ç¨å®å¨ã\n\né£ä¹ï¼å¦ä½åå°çº¿ç¨å®å¨å¢ï¼æä¸¤ç§æ¹æ¡ï¼\n\n * volatile + synchronized - å¯ä»¥åèï¼ãç¤ºä¾ãåééå®ç°çº¿ç¨å®å¨çåä¾æ¨¡å¼\n * ä½¿ç¨åå­ç±»æ¿ä»£ volatile\n\n\n# cas\n\n\n# cas çè¦ç¹\n\näºæ¥åæ­¥æ¯æå¸¸è§çå¹¶åæ­£ç¡®æ§ä¿éææ®µã\n\näºæ¥åæ­¥æä¸»è¦çé®é¢æ¯çº¿ç¨é»å¡åå¤éæå¸¦æ¥çæ§è½é®é¢ï¼å æ­¤äºæ¥åæ­¥ä¹è¢«ç§°ä¸ºé»å¡åæ­¥ãäºæ¥åæ­¥å±äºä¸ç§æ²è§çå¹¶åç­ç¥ï¼æ»æ¯è®¤ä¸ºåªè¦ä¸å»åæ­£ç¡®çåæ­¥æªæ½ï¼é£å°±è¯å®ä¼åºç°é®é¢ãæ è®ºå±äº«æ°æ®æ¯å¦ççä¼åºç°ç«äºï¼å®é½è¦è¿è¡å éï¼è¿éè®¨è®ºçæ¯æ¦å¿µæ¨¡åï¼å®éä¸èææºä¼ä¼åæå¾å¤§ä¸é¨åä¸å¿è¦çå éï¼ãç¨æ·ææ ¸å¿æè½¬æ¢ãç»´æ¤éè®¡æ°å¨åæ£æ¥æ¯å¦æè¢«é»å¡ççº¿ç¨éè¦å¤éç­æä½ã\n\néçç¡¬ä»¶æä»¤éçåå±ï¼æä»¬å¯ä»¥ä½¿ç¨åºäºå²çªæ£æµçä¹è§å¹¶åç­ç¥ï¼åè¿è¡æä½ï¼å¦ææ²¡æå¶å®çº¿ç¨äºç¨å±äº«æ°æ®ï¼é£æä½å°±æåäºï¼å¦åéåè¡¥å¿æªæ½ï¼ä¸æ­å°éè¯ï¼ç´å°æåä¸ºæ­¢ï¼ãè¿ç§ä¹è§çå¹¶åç­ç¥çè®¸å¤å®ç°é½ä¸éè¦å°çº¿ç¨é»å¡ï¼å æ­¤è¿ç§åæ­¥æä½ç§°ä¸ºéé»å¡åæ­¥ã\n\nä¸ºä»ä¹è¯´ä¹è§ééè¦ ç¡¬ä»¶æä»¤éçåå± æè½è¿è¡ï¼å ä¸ºéè¦æä½åå²çªæ£æµè¿ä¸¤ä¸ªæ­¥éª¤å·å¤åå­æ§ãèè¿ç¹æ¯ç±ç¡¬ä»¶æ¥å®æï¼å¦æåä½¿ç¨äºæ¥åæ­¥æ¥ä¿è¯å°±å¤±å»æä¹äºãç¡¬ä»¶æ¯æçåå­æ§æä½æå¸åçæ¯ï¼casã\n\ncasï¼compare and swapï¼ï¼å­é¢ææä¸ºæ¯è¾å¹¶äº¤æ¢ãcas æ 3 ä¸ªæä½æ°ï¼åå«æ¯ï¼åå­å¼ mï¼ææå¼ eï¼æ´æ°å¼ uãå½ä¸ä»å½åå­å¼ m åææå¼ e ç¸ç­æ¶ï¼å°åå­å¼ m ä¿®æ¹ä¸º uï¼å¦åä»ä¹é½ä¸åã\n\n\n# cas çåºç¨\n\ncas åªéç¨äºçº¿ç¨å²çªè¾å°çæåµã\n\ncas çå¸ååºç¨åºæ¯æ¯ï¼\n\n * åå­ç±»\n * èªæé\n\n# åå­ç±»\n\n> åå­ç±»æ¯ cas å¨ java ä¸­æå¸åçåºç¨ã\n\næä»¬åæ¥çä¸ä¸ªå¸¸è§çä»£ç çæ®µã\n\nif(a==b) {\n    a++;\n}\n\n\nå¦æ a++ æ§è¡åï¼ a çå¼è¢«ä¿®æ¹äºæä¹åï¼è¿è½å¾å°é¢æå¼åï¼åºç°è¯¥é®é¢çåå æ¯å¨å¹¶åç¯å¢ä¸ï¼ä»¥ä¸ä»£ç çæ®µä¸æ¯åå­æä½ï¼éæ¶å¯è½è¢«å¶ä»çº¿ç¨æç¯¡æ¹ã\n\nè§£å³è¿ç§é®é¢çæç»å¸æ¹å¼æ¯åºç¨åå­ç±»ç incrementandget æ¹æ³ã\n\npublic class atomicintegerdemo {\n\n    public static void main(string[] args) throws interruptedexception {\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        final atomicinteger count = new atomicinteger(0);\n        for (int i = 0; i < 10; i++) {\n            executorservice.execute(new runnable() {\n                @override\n                public void run() {\n                    count.incrementandget();\n                }\n            });\n        }\n\n        executorservice.shutdown();\n        executorservice.awaittermination(3, timeunit.seconds);\n        system.out.println("final count is : " + count.get());\n    }\n\n}\n\n\nj.u.c åä¸­æä¾äº atomicbooleanãatomicintegerãatomiclong åå«éå¯¹ booleanãintegerãlong æ§è¡åå­æä½ï¼æä½åä¸é¢çç¤ºä¾å¤§ä½ç¸ä¼¼ï¼ä¸åèµè¿°ã\n\n# èªæé\n\nå©ç¨åå­ç±»ï¼æ¬è´¨ä¸æ¯ casï¼ï¼å¯ä»¥å®ç°èªæéã\n\næè°èªæéï¼æ¯æçº¿ç¨åå¤æ£æ¥éåéæ¯å¦å¯ç¨ï¼ç´å°æåä¸ºæ­¢ãç±äºçº¿ç¨å¨è¿ä¸è¿ç¨ä¸­ä¿ææ§è¡ï¼å æ­¤æ¯ä¸ç§å¿ç­å¾ãä¸æ¦è·åäºèªæéï¼çº¿ç¨ä¼ä¸ç´ä¿æè¯¥éï¼ç´è³æ¾å¼éæ¾èªæéã\n\nç¤ºä¾ï¼éçº¿ç¨å®å¨ç¤ºä¾\n\npublic class atomicreferencedemo {\n\n    private static int ticket = 10;\n\n    public static void main(string[] args) {\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        for (int i = 0; i < 5; i++) {\n            executorservice.execute(new mythread());\n        }\n        executorservice.shutdown();\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            while (ticket > 0) {\n                system.out.println(thread.currentthread().getname() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                ticket--;\n            }\n        }\n\n    }\n\n}\n\n\nè¾åºç»æï¼\n\npool-1-thread-2 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 8 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 9 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 6 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 7 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 4 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 5 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 2 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 3 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 1 å¼ ç¥¨\n\n\nå¾ææ¾ï¼åºç°äºéå¤å®ç¥¨çæåµã\n\nãç¤ºä¾ãä½¿ç¨èªæéæ¥ä¿è¯çº¿ç¨å®å¨\n\nå¯ä»¥éè¿èªæéè¿ç§éé»å¡åæ­¥æ¥ä¿è¯çº¿ç¨å®å¨ï¼ä¸é¢ä½¿ç¨ atomicreference æ¥å®ç°ä¸ä¸ªèªæéã\n\npublic class atomicreferencedemo2 {\n\n    private static int ticket = 10;\n\n    public static void main(string[] args) {\n        threadsafedemo();\n    }\n\n    private static void threadsafedemo() {\n        spinlock lock = new spinlock();\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        for (int i = 0; i < 5; i++) {\n            executorservice.execute(new mythread(lock));\n        }\n        executorservice.shutdown();\n    }\n\n    static class spinlock {\n\n        private atomicreference<thread> atomicreference = new atomicreference<>();\n\n        public void lock() {\n            thread current = thread.currentthread();\n            while (!atomicreference.compareandset(null, current)) {}\n        }\n\n        public void unlock() {\n            thread current = thread.currentthread();\n            atomicreference.compareandset(current, null);\n        }\n\n    }\n\n    static class mythread implements runnable {\n\n        private spinlock lock;\n\n        public mythread(spinlock lock) {\n            this.lock = lock;\n        }\n\n        @override\n        public void run() {\n            while (ticket > 0) {\n                lock.lock();\n                if (ticket > 0) {\n                    system.out.println(thread.currentthread().getname() + " ååºäºç¬¬ " + ticket + " å¼ ç¥¨");\n                    ticket--;\n                }\n                lock.unlock();\n            }\n        }\n\n    }\n\n}\n\n\nè¾åºç»æï¼\n\npool-1-thread-2 ååºäºç¬¬ 10 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 9 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 8 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 7 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 6 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 5 å¼ ç¥¨\npool-1-thread-2 ååºäºç¬¬ 4 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 3 å¼ ç¥¨\npool-1-thread-3 ååºäºç¬¬ 2 å¼ ç¥¨\npool-1-thread-1 ååºäºç¬¬ 1 å¼ ç¥¨\n\n\n\n# cas çåç\n\njava ä¸»è¦å©ç¨ unsafe è¿ä¸ªç±»æä¾ç cas æä½ãunsafe ç cas ä¾èµçæ¯ jvm éå¯¹ä¸åçæä½ç³»ç»å®ç°çç¡¬ä»¶æä»¤ atomic::cmpxchgãatomic::cmpxchg çå®ç°ä½¿ç¨äºæ±ç¼ç cas æä½ï¼å¹¶ä½¿ç¨ cpu æä¾ç lock ä¿¡å·ä¿è¯å¶åå­æ§ã\n\n\n# cas çé®é¢\n\nä¸è¬æåµä¸ï¼cas æ¯éæ§è½æ´é«ãå ä¸º cas æ¯ä¸ç§éé»å¡ç®æ³ï¼æä»¥å¶é¿åäºçº¿ç¨é»å¡åå¤éçç­å¾æ¶é´ã\n\nä½æ¯ï¼äºç©æ»ä¼æå©æå¼ï¼cas ä¹å­å¨ä¸å¤§é®é¢ï¼\n\n * aba é®é¢\n * å¾ªç¯æ¶é´é¿å¼éå¤§\n * åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§\n\n# aba é®é¢\n\nå¦æä¸ä¸ªåéåæ¬¡è¯»åçæ¶åæ¯ a å¼ï¼å®çå¼è¢«æ¹æäº bï¼åæ¥åè¢«æ¹åä¸º aï¼é£ cas æä½å°±ä¼è¯¯è®¤ä¸ºå®ä»æ¥æ²¡æè¢«æ¹åè¿ã\n\nj.u.c åæä¾äºä¸ä¸ªå¸¦ææ è®°çåå­å¼ç¨ç±» atomicstampedreference æ¥è§£å³è¿ä¸ªé®é¢ï¼å®å¯ä»¥éè¿æ§å¶åéå¼ççæ¬æ¥ä¿è¯ cas çæ­£ç¡®æ§ãå¤§é¨åæåµä¸ aba é®é¢ä¸ä¼å½±åç¨åºå¹¶åçæ­£ç¡®æ§ï¼å¦æéè¦è§£å³ aba é®é¢ï¼æ¹ç¨ä¼ ç»çäºæ¥åæ­¥å¯è½ä¼æ¯åå­ç±»æ´é«æã\n\n# å¾ªç¯æ¶é´é¿å¼éå¤§\n\nèªæ cas ï¼ä¸æ­å°è¯ï¼ç´å°æåä¸ºæ­¢ï¼å¦æé¿æ¶é´ä¸æåï¼ä¼ç» cpu å¸¦æ¥éå¸¸å¤§çæ§è¡å¼éã\n\nå¦æ jvm è½æ¯æå¤çå¨æä¾ç pause æä»¤é£ä¹æçä¼æä¸å®çæåï¼pause æä»¤æä¸¤ä¸ªä½ç¨ï¼\n\n * å®å¯ä»¥å»¶è¿æµæ°´çº¿æ§è¡æä»¤ï¼de-pipelineï¼,ä½¿ cpu ä¸ä¼æ¶èè¿å¤çæ§è¡èµæºï¼å»¶è¿çæ¶é´åå³äºå·ä½å®ç°ççæ¬ï¼å¨ä¸äºå¤çå¨ä¸å»¶è¿æ¶é´æ¯é¶ã\n * å®å¯ä»¥é¿åå¨éåºå¾ªç¯çæ¶åå åå­é¡ºåºå²çªï¼memory order violationï¼èå¼èµ· cpu æµæ°´çº¿è¢«æ¸ç©ºï¼cpu pipeline flushï¼ï¼ä»èæé« cpu çæ§è¡æçã\n\næ¯è¾è±è´¹ cpu èµæºï¼å³ä½¿æ²¡æä»»ä½ç¨ä¹ä¼åä¸äºæ ç¨åã\n\n# åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æ§\n\nå½å¯¹ä¸ä¸ªå±äº«åéæ§è¡æä½æ¶ï¼æä»¬å¯ä»¥ä½¿ç¨å¾ªç¯ cas çæ¹å¼æ¥ä¿è¯åå­æä½ï¼ä½æ¯å¯¹å¤ä¸ªå±äº«åéæä½æ¶ï¼å¾ªç¯ cas å°±æ æ³ä¿è¯æä½çåå­æ§ï¼è¿ä¸ªæ¶åå°±å¯ä»¥ç¨éã\n\næèæä¸ä¸ªåå·§çåæ³ï¼å°±æ¯æå¤ä¸ªå±äº«åéåå¹¶æä¸ä¸ªå±äº«åéæ¥æä½ãæ¯å¦æä¸¤ä¸ªå±äº«åé i ï¼ 2, j = aï¼åå¹¶ä¸ä¸ ij=2aï¼ç¶åç¨ cas æ¥æä½ ijãä» java 1.5 å¼å§ jdk æä¾äº atomicreference ç±»æ¥ä¿è¯å¼ç¨å¯¹è±¡ä¹é´çåå­æ§ï¼ä½ å¯ä»¥æå¤ä¸ªåéæ¾å¨ä¸ä¸ªå¯¹è±¡éæ¥è¿è¡ cas æä½ã\n\n\n# threadlocal\n\n> threadlocal æ¯ä¸ä¸ªå­å¨çº¿ç¨æ¬å°å¯æ¬çå·¥å·ç±»ã\n> \n> è¦ä¿è¯çº¿ç¨å®å¨ï¼ä¸ä¸å®éè¦è¿è¡åæ­¥ãåæ­¥åªæ¯ä¿è¯å±äº«æ°æ®äºç¨æ¶çæ­£ç¡®æ§ï¼å¦æä¸ä¸ªæ¹æ³æ¬æ¥å°±ä¸æ¶åå±äº«æ°æ®ï¼é£ä¹èªç¶æ é¡»åæ­¥ã\n> \n> java ä¸­ç æ åæ­¥æ¹æ¡ æï¼\n> \n>  * å¯éå¥ä»£ç  - ä¹å«çº¯ä»£ç ãå¦æä¸ä¸ªæ¹æ³ï¼å®ç è¿åç»ææ¯å¯ä»¥é¢æµçï¼å³åªè¦è¾å¥äºç¸åçæ°æ®ï¼å°±è½è¿åç¸åçç»æï¼é£å®å°±æ»¡è¶³å¯éå¥æ§ï¼å½ç¶ä¹æ¯çº¿ç¨å®å¨çã\n>  * çº¿ç¨æ¬å°å­å¨ - ä½¿ç¨ threadlocal ä¸ºå±äº«åéå¨æ¯ä¸ªçº¿ç¨ä¸­é½åå»ºäºä¸ä¸ªæ¬å°å¯æ¬ï¼è¿ä¸ªå¯æ¬åªè½è¢«å½åçº¿ç¨è®¿é®ï¼å¶ä»çº¿ç¨æ æ³è®¿é®ï¼é£ä¹èªç¶æ¯çº¿ç¨å®å¨çã\n\n\n# threadlocal çåºç¨\n\nthreadlocal çæ¹æ³ï¼\n\npublic class threadlocal<t> {\n    public t get() {}\n    public void set(t value) {}\n    public void remove() {}\n    public static <s> threadlocal<s> withinitial(supplier<? extends s> supplier) {}\n}\n\n\n> è¯´æï¼\n> \n>  * get - ç¨äºè·å threadlocal å¨å½åçº¿ç¨ä¸­ä¿å­çåéå¯æ¬ã\n>  * set - ç¨äºè®¾ç½®å½åçº¿ç¨ä¸­åéçå¯æ¬ã\n>  * remove - ç¨äºå é¤å½åçº¿ç¨ä¸­åéçå¯æ¬ãå¦ææ­¤çº¿ç¨å±é¨åééåè¢«å½åçº¿ç¨è¯»åï¼åå¶å¼å°éè¿è°ç¨å¶ initialvalue æ¹æ³éæ°åå§åï¼é¤éå¶å¼ç±ä¸­é´çº¿ç¨ä¸­çå½åçº¿ç¨è®¾ç½®ã è¿å¯è½ä¼å¯¼è´å½åçº¿ç¨ä¸­å¤æ¬¡è°ç¨ initialvalue æ¹æ³ã\n>  * initialvalue - ä¸º threadlocal è®¾ç½®é»è®¤ç get åå§å¼ï¼éè¦éå initialvalue æ¹æ³ ã\n\nthreadlocal å¸¸ç¨äºé²æ­¢å¯¹å¯åçåä¾ï¼singletonï¼åéæå¨å±åéè¿è¡å±äº«ãå¸ååºç¨åºæ¯æï¼ç®¡çæ°æ®åºè¿æ¥ãsessionã\n\nãç¤ºä¾ãæ°æ®åºè¿æ¥\n\nprivate static threadlocal<connection> connectionholder = new threadlocal<connection>() {\n    @override\n    public connection initialvalue() {\n        return drivermanager.getconnection(db_url);\n    }\n};\n\npublic static connection getconnection() {\n    return connectionholder.get();\n}\n\n\nãç¤ºä¾ãsession ç®¡ç\n\nprivate static final threadlocal<session> sessionholder = new threadlocal<>();\n\npublic static session getsession() {\n    session session = (session) sessionholder.get();\n    try {\n        if (session == null) {\n            session = createsession();\n            sessionholder.set(session);\n        }\n    } catch (exception e) {\n        e.printstacktrace();\n    }\n    return session;\n}\n\n\nãç¤ºä¾ãå®æ´ä½¿ç¨ threadlocal ç¤ºä¾\n\npublic class threadlocaldemo {\n\n    private static threadlocal<integer> threadlocal = new threadlocal<integer>() {\n        @override\n        protected integer initialvalue() {\n            return 0;\n        }\n    };\n\n    public static void main(string[] args) {\n        executorservice executorservice = executors.newfixedthreadpool(10);\n        for (int i = 0; i < 10; i++) {\n            executorservice.execute(new mythread());\n        }\n        executorservice.shutdown();\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            int count = threadlocal.get();\n            for (int i = 0; i < 10; i++) {\n                try {\n                    count++;\n                    thread.sleep(100);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n            }\n            threadlocal.set(count);\n            threadlocal.remove();\n            system.out.println(thread.currentthread().getname() + " : " + count);\n        }\n\n    }\n\n}\n\n\nå¨é¨è¾åº count = 10\n\n\n# threadlocal çåç\n\n# å­å¨ç»æ\n\nthread ç±»ä¸­ç»´æ¤çä¸ä¸ª threadlocal.threadlocalmap ç±»åçæå threadlocalsãè¿ä¸ªæåå°±æ¯ç¨æ¥å­å¨å½åçº¿ç¨ç¬å çåéå¯æ¬ã\n\nthreadlocalmap æ¯ threadlocal çåé¨ç±»ï¼å®ç»´æ¤çä¸ä¸ª entry æ°ç»ï¼entry ç»§æ¿äº weakreference ï¼æä»¥æ¯å¼±å¼ç¨ã entry ç¨äºä¿å­é®å¼å¯¹ï¼å¶ä¸­ï¼\n\n * key æ¯ threadlocal å¯¹è±¡ï¼\n * value æ¯ä¼ éè¿æ¥çå¯¹è±¡ï¼åéå¯æ¬ï¼ã\n\npublic class thread implements runnable {\n    // ...\n    threadlocal.threadlocalmap threadlocals = null;\n    // ...\n}\n\nstatic class threadlocalmap {\n    // ...\n    static class entry extends weakreference<threadlocal<?>> {\n        /** the value associated with this threadlocal. */\n        object value;\n\n        entry(threadlocal<?> k, object v) {\n            super(k);\n            value = v;\n        }\n    }\n    // ...\n}\n\n\n# å¦ä½è§£å³ hash å²çª\n\nthreadlocalmap è½ç¶æ¯ç±»ä¼¼ map ç»æçæ°æ®ç»æï¼ä½å®å¹¶æ²¡æå®ç° map æ¥å£ãå®ä¸æ¯æ map æ¥å£ä¸­ç next æ¹æ³ï¼è¿æå³ç threadlocalmap ä¸­è§£å³ hash å²çªçæ¹å¼å¹¶é æé¾è¡¨ æ¹å¼ã\n\nå®éä¸ï¼threadlocalmap éç¨çº¿æ§æ¢æµçæ¹å¼æ¥è§£å³ hash å²çªãæè°çº¿æ§æ¢æµï¼å°±æ¯æ ¹æ®åå§ key ç hashcode å¼ç¡®å®åç´ å¨ table æ°ç»ä¸­çä½ç½®ï¼å¦æåç°è¿ä¸ªä½ç½®ä¸å·²ç»è¢«å¶ä»ç key å¼å ç¨ï¼åå©ç¨åºå®çç®æ³å¯»æ¾ä¸å®æ­¥é¿çä¸ä¸ªä½ç½®ï¼ä¾æ¬¡å¤æ­ï¼ç´è³æ¾å°è½å¤å­æ¾çä½ç½®ã\n\n# åå­æ³æ¼é®é¢\n\nthreadlocalmap ç entry ç»§æ¿äº weakreferenceï¼æä»¥å®ç key ï¼threadlocal å¯¹è±¡ï¼æ¯å¼±å¼ç¨ï¼è value ï¼åéå¯æ¬ï¼æ¯å¼ºå¼ç¨ã\n\n * å¦æ threadlocal å¯¹è±¡æ²¡æå¤é¨å¼ºå¼ç¨æ¥å¼ç¨å®ï¼é£ä¹ threadlocal å¯¹è±¡ä¼å¨ä¸æ¬¡ gc æ¶è¢«åæ¶ã\n * æ­¤æ¶ï¼entry ä¸­ç key å·²ç»è¢«åæ¶ï¼ä½æ¯ value ç±äºæ¯å¼ºå¼ç¨ä¸ä¼è¢«åå¾æ¶éå¨åæ¶ãå¦æåå»º threadlocal ççº¿ç¨ä¸ç´æç»­è¿è¡ï¼é£ä¹ value å°±ä¼ä¸ç´å¾ä¸å°åæ¶ï¼äº§çåå­æ³é²ã\n\né£ä¹å¦ä½é¿ååå­æ³æ¼å¢ï¼æ¹æ³å°±æ¯ï¼ä½¿ç¨ threadlocal ç set æ¹æ³åï¼æ¾ç¤ºçè°ç¨ remove æ¹æ³ ã\n\nthreadlocal<string> threadlocal = new threadlocal();\ntry {\n    threadlocal.set("xxx");\n    // ...\n} finally {\n    threadlocal.remove();\n}\n\n\n\n# threadlocal çè¯¯åº\n\n> ç¤ºä¾æèªï¼ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\nthreadlocal éç¨äºåéå¨çº¿ç¨é´éç¦»ï¼èå¨æ¹æ³æç±»é´å±äº«çåºæ¯ã\n\nåææå°ï¼threadlocal æ¯çº¿ç¨éç¦»çï¼é£ä¹æ¯ä¸æ¯ä½¿ç¨ threadlocal å°±ä¸å®é«ææ å¿§å¢ï¼\n\n# threadlocal éè¯¯æ¡ä¾\n\nä½¿ç¨ spring boot åå»ºä¸ä¸ª web åºç¨ç¨åºï¼ä½¿ç¨ threadlocal å­æ¾ä¸ä¸ª integer çå¼ï¼æ¥æä¸ä»£è¡¨éè¦å¨çº¿ç¨ä¸­ä¿å­çç¨æ·ä¿¡æ¯ï¼è¿ä¸ªå¼åå§æ¯ nullã\n\n    private threadlocal<integer> currentuser = threadlocal.withinitial(() -> null);\n\n    @getmapping("wrong")\n    public map<string, string> wrong(@requestparam("id") integer userid) {\n        //è®¾ç½®ç¨æ·ä¿¡æ¯ä¹ååæ¥è¯¢ä¸æ¬¡threadlocalä¸­çç¨æ·ä¿¡æ¯\n        string before = thread.currentthread().getname() + ":" + currentuser.get();\n        //è®¾ç½®ç¨æ·ä¿¡æ¯å°threadlocal\n        currentuser.set(userid);\n        //è®¾ç½®ç¨æ·ä¿¡æ¯ä¹ååæ¥è¯¢ä¸æ¬¡threadlocalä¸­çç¨æ·ä¿¡æ¯\n        string after = thread.currentthread().getname() + ":" + currentuser.get();\n        //æ±æ»è¾åºä¸¤æ¬¡æ¥è¯¢ç»æ\n        map<string, string> result = new hashmap<>();\n        result.put("before", before);\n        result.put("after", after);\n        return result;\n    }\n\n\nãé¢æãä»ä»£ç é»è¾æ¥çï¼æä»¬é¢æç¬¬ä¸æ¬¡è·åçå¼å§ç»åºè¯¥æ¯ nullã\n\nãå®éã\n\nä¸ºäºæ¹ä¾¿å¤ç°ï¼å° tomcat å·¥ä½çº¿ç¨è®¾ä¸º 1ï¼\n\nserver.tomcat.max-threads=1\n\n\nå½è®¿é® id = 1 æ¶ï¼ç¬¦åé¢æ\n\n\n\nå½è®¿é® id = 2 æ¶ï¼before çåºç­ä¸æ¯ nullï¼èæ¯ 1ï¼ä¸ç¬¦åé¢æã\n\n\n\nãåæãå®éæåµåé¢æå­å¨åå·®ãspring boot ç¨åºè¿è¡å¨ tomcat ä¸­ï¼æ§è¡ç¨åºççº¿ç¨æ¯ tomcat çå·¥ä½çº¿ç¨ï¼è tomcat çå·¥ä½çº¿ç¨æ¯åºäºçº¿ç¨æ± çãçº¿ç¨æ± ä¼éç¨åºå®çå ä¸ªçº¿ç¨ï¼ä¸æ¦çº¿ç¨éç¨ï¼é£ä¹å¾å¯è½é¦æ¬¡ä» threadlocal è·åçå¼æ¯ä¹åå¶ä»ç¨æ·çè¯·æ±éççå¼ãè¿æ¶ï¼threadlocal ä¸­çç¨æ·ä¿¡æ¯å°±æ¯å¶ä»ç¨æ·çä¿¡æ¯ã\n\nå¹¶ä¸è½è®¤ä¸ºæ²¡ææ¾å¼å¼å¯å¤çº¿ç¨å°±ä¸ä¼æçº¿ç¨å®å¨é®é¢ãä½¿ç¨ç±»ä¼¼ threadlocal å·¥å·æ¥å­æ¾ä¸äºæ°æ®æ¶ï¼éè¦ç¹å«æ³¨æå¨ä»£ç è¿è¡å®åï¼æ¾å¼å°å»æ¸ç©ºè®¾ç½®çæ°æ®ã\n\n# threadlocal éè¯¯æ¡ä¾ä¿®æ­£\n\n    @getmapping("right")\n    public map<string, string> right(@requestparam("id") integer userid) {\n        string before = thread.currentthread().getname() + ":" + currentuser.get();\n        currentuser.set(userid);\n        try {\n            string after = thread.currentthread().getname() + ":" + currentuser.get();\n            map<string, string> result = new hashmap<>();\n            result.put("before", before);\n            result.put("after", after);\n            return result;\n        } finally {\n            //å¨finallyä»£ç åä¸­å é¤threadlocalä¸­çæ°æ®ï¼ç¡®ä¿æ°æ®ä¸ä¸²\n            currentuser.remove();\n        }\n    }\n\n\n\n# inheritablethreadlocal\n\ninheritablethreadlocal ç±»æ¯ threadlocal ç±»çå­ç±»ã\n\nthreadlocal ä¸­æ¯ä¸ªçº¿ç¨æ¥æå®èªå·±ç¬å çæ°æ®ãä¸ threadlocal ä¸åçæ¯ï¼inheritablethreadlocal åè®¸ä¸ä¸ªçº¿ç¨ä»¥åè¯¥çº¿ç¨åå»ºçææå­çº¿ç¨é½å¯ä»¥è®¿é®å®ä¿å­çæ°æ®ã\n\n> åçåèï¼java å¤çº¿ç¨ï¼inheritablethreadlocal å®ç°åç\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ java èææºã\n * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * java å¹¶åç¼ç¨ï¼volatile å³é®å­è§£æ\n * java å¹¶åç¼ç¨ï¼synchronized\n * æ·±å¥çè§£ java å¹¶åä¹ synchronized å®ç°åç\n * java cas å®å¨è§£è¯»\n * java ä¸­ cas è¯¦è§£\n * threadlocal ç»æç¯\n * synchronized å®ç°åçåéä¼å\n * non-blocking algorithms',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaé",frontmatter:{title:"Javaé",date:"2019-12-26T23:11:52.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å","é"],permalink:"/pages/e2e047/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/04.Java%E9%94%81.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/04.Javaé.md",key:"v-5fcbebd1",path:"/pages/e2e047/",headers:[{level:2,title:"å¹¶åéç®ä»",slug:"å¹¶åéç®ä»",normalizedTitle:"å¹¶åéç®ä»",charIndex:283},{level:3,title:"å¯éå¥é",slug:"å¯éå¥é",normalizedTitle:"å¯éå¥é",charIndex:462},{level:3,title:"å¬å¹³éä¸éå¬å¹³é",slug:"å¬å¹³éä¸éå¬å¹³é",normalizedTitle:"å¬å¹³éä¸éå¬å¹³é",charIndex:1496},{level:3,title:"ç¬äº«éä¸å±äº«é",slug:"ç¬äº«éä¸å±äº«é",normalizedTitle:"ç¬äº«éä¸å±äº«é",charIndex:1779},{level:3,title:"æ²è§éä¸ä¹è§é",slug:"æ²è§éä¸ä¹è§é",normalizedTitle:"æ²è§éä¸ä¹è§é",charIndex:2031},{level:3,title:"ååéãè½»éçº§éãééçº§é",slug:"ååéãè½»éçº§éãééçº§é",normalizedTitle:"ååéãè½»éçº§éãééçº§é",charIndex:2412},{level:3,title:"åæ®µé",slug:"åæ®µé",normalizedTitle:"åæ®µé",charIndex:2873},{level:3,title:"æ¾ç¤ºéååç½®é",slug:"æ¾ç¤ºéååç½®é",normalizedTitle:"æ¾ç¤ºéååç½®é",charIndex:3334},{level:2,title:"Lock å Condition",slug:"lock-å-condition",normalizedTitle:"lock å condition",charIndex:74},{level:3,title:"ä¸ºä½å¼å¥ Lock å Condition",slug:"ä¸ºä½å¼å¥-lock-å-condition",normalizedTitle:"ä¸ºä½å¼å¥ lock å condition",charIndex:4560},{level:3,title:"Lock æ¥å£",slug:"lock-æ¥å£",normalizedTitle:"lock æ¥å£",charIndex:5389},{level:3,title:"Condition",slug:"condition",normalizedTitle:"condition",charIndex:81},{level:4,title:"Condition çç¹æ§",slug:"condition-çç¹æ§",normalizedTitle:"condition çç¹æ§",charIndex:6559},{level:4,title:"Condition çç¨æ³",slug:"condition-çç¨æ³",normalizedTitle:"condition çç¨æ³",charIndex:7264},{level:2,title:"ReentrantLock",slug:"reentrantlock",normalizedTitle:"reentrantlock",charIndex:548},{level:3,title:"ReentrantLock çç¹æ§",slug:"reentrantlock-çç¹æ§",normalizedTitle:"reentrantlock çç¹æ§",charIndex:10255},{level:3,title:"ReentrantLock çç¨æ³",slug:"reentrantlock-çç¨æ³",normalizedTitle:"reentrantlock çç¨æ³",charIndex:10518},{level:4,title:"ReentrantLock çæé æ¹æ³",slug:"reentrantlock-çæé æ¹æ³",normalizedTitle:"reentrantlock çæé æ¹æ³",charIndex:10580},{level:4,title:"lock å unlock æ¹æ³",slug:"lock-å-unlock-æ¹æ³",normalizedTitle:"lock å unlock æ¹æ³",charIndex:10819},{level:4,title:"tryLock æ¹æ³",slug:"trylock-æ¹æ³",normalizedTitle:"trylock æ¹æ³",charIndex:13217},{level:4,title:"lockInterruptibly æ¹æ³",slug:"lockinterruptibly-æ¹æ³",normalizedTitle:"lockinterruptibly æ¹æ³",charIndex:14432},{level:4,title:"newCondition æ¹æ³",slug:"newcondition-æ¹æ³",normalizedTitle:"newcondition æ¹æ³",charIndex:15415},{level:3,title:"ReentrantLock çåç",slug:"reentrantlock-çåç",normalizedTitle:"reentrantlock çåç",charIndex:15519},{level:4,title:"ReentrantLock çå¯è§æ§",slug:"reentrantlock-çå¯è§æ§",normalizedTitle:"reentrantlock çå¯è§æ§",charIndex:15540},{level:4,title:"ReentrantLock çæ°æ®ç»æ",slug:"reentrantlock-çæ°æ®ç»æ",normalizedTitle:"reentrantlock çæ°æ®ç»æ",charIndex:16208},{level:4,title:"ReentrantLock çè·åéåéæ¾é",slug:"reentrantlock-çè·åéåéæ¾é",normalizedTitle:"reentrantlock çè·åéåéæ¾é",charIndex:16531},{level:4,title:"å¬å¹³éåéå¬å¹³é",slug:"å¬å¹³éåéå¬å¹³é",normalizedTitle:"å¬å¹³éåéå¬å¹³é",charIndex:10369},{level:2,title:"ReentrantReadWriteLock",slug:"reentrantreadwritelock",normalizedTitle:"reentrantreadwritelock",charIndex:563},{level:3,title:"ReentrantReadWriteLock çç¹æ§",slug:"reentrantreadwritelock-çç¹æ§",normalizedTitle:"reentrantreadwritelock çç¹æ§",charIndex:18942},{level:3,title:"ReentrantReadWriteLock çç¨æ³",slug:"reentrantreadwritelock-çç¨æ³",normalizedTitle:"reentrantreadwritelock çç¨æ³",charIndex:20092},{level:4,title:"ReentrantReadWriteLock çæé æ¹æ³",slug:"reentrantreadwritelock-çæé æ¹æ³",normalizedTitle:"reentrantreadwritelock çæé æ¹æ³",charIndex:20172},{level:4,title:"ReentrantReadWriteLock çä½¿ç¨å®ä¾",slug:"reentrantreadwritelock-çä½¿ç¨å®ä¾",normalizedTitle:"reentrantreadwritelock çä½¿ç¨å®ä¾",charIndex:20622},{level:3,title:"ReentrantReadWriteLock çåç",slug:"reentrantreadwritelock-çåç",normalizedTitle:"reentrantreadwritelock çåç",charIndex:23667},{level:4,title:"ReentrantReadWriteLock çæ°æ®ç»æ",slug:"reentrantreadwritelock-çæ°æ®ç»æ",normalizedTitle:"reentrantreadwritelock çæ°æ®ç»æ",charIndex:23755},{level:4,title:"ReentrantReadWriteLock çè·åéåéæ¾é",slug:"reentrantreadwritelock-çè·åéåéæ¾é",normalizedTitle:"reentrantreadwritelock çè·åéåéæ¾é",charIndex:24528},{level:2,title:"StampedLock",slug:"stampedlock",normalizedTitle:"stampedlock",charIndex:25042},{level:2,title:"AQS",slug:"aqs",normalizedTitle:"aqs",charIndex:56},{level:3,title:"AQS çè¦ç¹",slug:"aqs-çè¦ç¹",normalizedTitle:"aqs çè¦ç¹",charIndex:26932},{level:3,title:"AQS çåºç¨",slug:"aqs-çåºç¨",normalizedTitle:"aqs çåºç¨",charIndex:27163},{level:4,title:"ç¬äº«é API",slug:"ç¬äº«é-api",normalizedTitle:"ç¬äº«é api",charIndex:27195},{level:4,title:"å±äº«é API",slug:"å±äº«é-api",normalizedTitle:"å±äº«é api",charIndex:27616},{level:3,title:"AQS çåç",slug:"aqs-çåç",normalizedTitle:"aqs çåç",charIndex:17047},{level:4,title:"AQS çæ°æ®ç»æ",slug:"aqs-çæ°æ®ç»æ",normalizedTitle:"aqs çæ°æ®ç»æ",charIndex:28318},{level:4,title:"ç¬å éçè·ååéæ¾",slug:"ç¬å éçè·ååéæ¾",normalizedTitle:"ç¬å éçè·ååéæ¾",charIndex:29972},{level:5,title:"è·åç¬å é",slug:"è·åç¬å é",normalizedTitle:"è·åç¬å é",charIndex:18223},{level:5,title:"éæ¾ç¬å é",slug:"éæ¾ç¬å é",normalizedTitle:"éæ¾ç¬å é",charIndex:16991},{level:5,title:"è·åå¯ä¸­æ­çç¬å é",slug:"è·åå¯ä¸­æ­çç¬å é",normalizedTitle:"è·åå¯ä¸­æ­çç¬å é",charIndex:16757},{level:5,title:"è·åè¶æ¶ç­å¾å¼çç¬å é",slug:"è·åè¶æ¶ç­å¾å¼çç¬å é",normalizedTitle:"è·åè¶æ¶ç­å¾å¼çç¬å é",charIndex:16902},{level:4,title:"å±äº«éçè·ååéæ¾",slug:"å±äº«éçè·ååéæ¾",normalizedTitle:"å±äº«éçè·ååéæ¾",charIndex:30746},{level:5,title:"è·åå±äº«é",slug:"è·åå±äº«é",normalizedTitle:"è·åå±äº«é",charIndex:24645},{level:5,title:"éæ¾å±äº«é",slug:"éæ¾å±äº«é",normalizedTitle:"éæ¾å±äº«é",charIndex:24730},{level:5,title:"è·åå¯ä¸­æ­çå±äº«é",slug:"è·åå¯ä¸­æ­çå±äº«é",normalizedTitle:"è·åå¯ä¸­æ­çå±äº«é",charIndex:27916},{level:5,title:"è·åè¶æ¶ç­å¾å¼çå±äº«é",slug:"è·åè¶æ¶ç­å¾å¼çå±äº«é",normalizedTitle:"è·åè¶æ¶ç­å¾å¼çå±äº«é",charIndex:31270},{level:2,title:"æ­»é",slug:"æ­»é",normalizedTitle:"æ­»é",charIndex:540},{level:3,title:"ä»ä¹æ¯æ­»é",slug:"ä»ä¹æ¯æ­»é",normalizedTitle:"ä»ä¹æ¯æ­»é",charIndex:31402},{level:3,title:"å¦ä½å®ä½æ­»é",slug:"å¦ä½å®ä½æ­»é",normalizedTitle:"å¦ä½å®ä½æ­»é",charIndex:31560},{level:3,title:"å¦ä½é¿åæ­»é",slug:"å¦ä½é¿åæ­»é",normalizedTitle:"å¦ä½é¿åæ­»é",charIndex:31801},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:32088}],headersStr:"å¹¶åéç®ä» å¯éå¥é å¬å¹³éä¸éå¬å¹³é ç¬äº«éä¸å±äº«é æ²è§éä¸ä¹è§é ååéãè½»éçº§éãééçº§é åæ®µé æ¾ç¤ºéååç½®é Lock å Condition ä¸ºä½å¼å¥ Lock å Condition Lock æ¥å£ Condition Condition çç¹æ§ Condition çç¨æ³ ReentrantLock ReentrantLock çç¹æ§ ReentrantLock çç¨æ³ ReentrantLock çæé æ¹æ³ lock å unlock æ¹æ³ tryLock æ¹æ³ lockInterruptibly æ¹æ³ newCondition æ¹æ³ ReentrantLock çåç ReentrantLock çå¯è§æ§ ReentrantLock çæ°æ®ç»æ ReentrantLock çè·åéåéæ¾é å¬å¹³éåéå¬å¹³é ReentrantReadWriteLock ReentrantReadWriteLock çç¹æ§ ReentrantReadWriteLock çç¨æ³ ReentrantReadWriteLock çæé æ¹æ³ ReentrantReadWriteLock çä½¿ç¨å®ä¾ ReentrantReadWriteLock çåç ReentrantReadWriteLock çæ°æ®ç»æ ReentrantReadWriteLock çè·åéåéæ¾é StampedLock AQS AQS çè¦ç¹ AQS çåºç¨ ç¬äº«é API å±äº«é API AQS çåç AQS çæ°æ®ç»æ ç¬å éçè·ååéæ¾ è·åç¬å é éæ¾ç¬å é è·åå¯ä¸­æ­çç¬å é è·åè¶æ¶ç­å¾å¼çç¬å é å±äº«éçè·ååéæ¾ è·åå±äº«é éæ¾å±äº«é è·åå¯ä¸­æ­çå±äº«é è·åè¶æ¶ç­å¾å¼çå±äº«é æ­»é ä»ä¹æ¯æ­»é å¦ä½å®ä½æ­»é å¦ä½é¿åæ­»é åèèµæ",content:'# æ·±å¥çè§£ Java å¹¶åé\n\n> æ¬æåéè¿° Java ä¸­åç§éçæ¦å¿µã\n> \n> ç¶åï¼ä»ç»éçæ ¸å¿å®ç° AQSã\n> \n> ç¶åï¼éç¹ä»ç» Lock å Condition ä¸¤ä¸ªæ¥å£åå¶å®ç°ãå¹¶åç¼ç¨æä¸¤ä¸ªæ ¸å¿é®é¢ï¼åæ­¥åäºæ¥ã\n> \n> äºæ¥ï¼å³åä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®å±äº«èµæºï¼\n> \n> åæ­¥ï¼å³çº¿ç¨ä¹é´å¦ä½éä¿¡ãåä½ã\n> \n> è¿ä¸¤å¤§é®é¢ï¼ç®¡ç¨ï¼sychronizedï¼é½æ¯è½å¤è§£å³çãJ.U.C åè¿æä¾äº Lock å Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨ï¼å¶ä¸­ Lock ç¨äºè§£å³äºæ¥é®é¢ï¼Condition ç¨äºè§£å³åæ­¥é®é¢ã\n\n\n# å¹¶åéç®ä»\n\nç¡®ä¿çº¿ç¨å®å¨æå¸¸è§çåæ³æ¯å©ç¨éæºå¶ï¼Lockãsychronizedï¼æ¥å¯¹å±äº«æ°æ®åäºæ¥åæ­¥ï¼è¿æ ·å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åï¼é£ä¹æä½å¿ç¶æ¯åå­æ§çï¼çº¿ç¨å®å¨çã\n\nå¨å·¥ä½ãé¢è¯ä¸­ï¼ç»å¸¸ä¼å¬å°åç§äºè±å«é¨çéï¼å¬çäººäºéé¾éãéçæ¦å¿µæ¯è¯­å¾å¤ï¼å®ä»¬æ¯éå¯¹ä¸åçé®é¢ææåºçï¼éè¿ç®åçæ¢³çï¼ä¹ä¸é¾çè§£ã\n\n\n# å¯éå¥é\n\nå¯éå¥éï¼é¡¾åæä¹ï¼æçæ¯çº¿ç¨å¯ä»¥éå¤è·ååä¸æéãå³åä¸ä¸ªçº¿ç¨å¨å¤å±æ¹æ³è·åäºéï¼å¨è¿å¥åå±æ¹æ³ä¼èªå¨è·åéã\n\nå¯éå¥éå¯ä»¥å¨ä¸å®ç¨åº¦ä¸é¿åæ­»éã\n\n * ReentrantLock ãReentrantReadWriteLock æ¯å¯éå¥éãè¿ç¹ï¼ä»å¶å½åä¹ä¸é¾çåºã\n * synchronized ä¹æ¯ä¸ä¸ªå¯éå¥éã\n\nãç¤ºä¾ãsynchronized çå¯éå¥ç¤ºä¾\n\nsynchronized void setA() throws Exception{\n    Thread.sleep(1000);\n    setB();\n}\n\nsynchronized void setB() throws Exception{\n    Thread.sleep(1000);\n}\n\n\nä¸é¢çä»£ç å°±æ¯ä¸ä¸ªå¸ååºæ¯ï¼å¦æä½¿ç¨çéä¸æ¯å¯éå¥éçè¯ï¼setB å¯è½ä¸ä¼è¢«å½åçº¿ç¨æ§è¡ï¼ä»èé ææ­»éã\n\nãç¤ºä¾ãReentrantLock çå¯éå¥ç¤ºä¾\n\nclass Task {\n\n    private int value;\n    private final Lock lock = new ReentrantLock();\n\n    public Task() {\n        this.value = 0;\n    }\n\n    public int get() {\n        // è·åé\n        lock.lock();\n        try {\n            return value;\n        } finally {\n            // ä¿è¯éè½éæ¾\n            lock.unlock();\n        }\n    }\n\n    public void addOne() {\n        // è·åé\n        lock.lock();\n        try {\n            // æ³¨æï¼æ­¤å¤å·²ç»æåè·åéï¼è¿å¥ get æ¹æ³åï¼åå°è¯è·åéï¼\n            // å¦æéä¸æ¯å¯éå¥çï¼ä¼å¯¼è´æ­»é\n            value = 1 + get();\n        } finally {\n            // ä¿è¯éè½éæ¾\n            lock.unlock();\n        }\n    }\n\n}\n\n\n\n# å¬å¹³éä¸éå¬å¹³é\n\n * å¬å¹³é - å¬å¹³éæ¯æ å¤çº¿ç¨æç§ç³è¯·éçé¡ºåºæ¥è·åéã\n * éå¬å¹³é - éå¬å¹³éæ¯æ å¤çº¿ç¨ä¸æç§ç³è¯·éçé¡ºåºæ¥è·åé ãè¿å°±å¯è½ä¼åºç°ä¼åçº§åè½¬ï¼åæ¥èå±ä¸ï¼æèé¥¥é¥¿ç°è±¡ï¼æçº¿ç¨æ»æ¯æ¢ä¸è¿å«ççº¿ç¨ï¼å¯¼è´å§ç»æ æ³æ§è¡ï¼ã\n\nå¬å¹³éä¸ºäºä¿è¯çº¿ç¨ç³è¯·é¡ºåºï¼å¿å¿è¦ä»åºä¸å®çæ§è½ä»£ä»·ï¼å æ­¤å¶ååéä¸è¬ä½äºéå¬å¹³éã\n\nå¬å¹³éä¸éå¬å¹³é å¨ Java ä¸­çå¸åå®ç°ï¼\n\n * synchronized åªæ¯æéå¬å¹³éã\n * ReentrantLock ãReentrantReadWriteLockï¼é»è®¤æ¯éå¬å¹³éï¼ä½æ¯æå¬å¹³éã\n\n\n# ç¬äº«éä¸å±äº«é\n\nç¬äº«éä¸å±äº«éæ¯ä¸ç§å¹¿ä¹ä¸çè¯´æ³ï¼ä»å®éç¨éä¸æ¥çï¼ä¹å¸¸è¢«ç§°ä¸ºäºæ¥éä¸è¯»åéã\n\n * ç¬äº«é - ç¬äº«éæ¯æ éä¸æ¬¡åªè½è¢«ä¸ä¸ªçº¿ç¨æææã\n * å±äº«é - å±äº«éæ¯æ éå¯è¢«å¤ä¸ªçº¿ç¨æææã\n\nç¬äº«éä¸å±äº«éå¨ Java ä¸­çå¸åå®ç°ï¼\n\n * synchronized ãReentrantLock åªæ¯æç¬äº«éã\n * ReentrantReadWriteLock å¶åéæ¯ç¬äº«éï¼å¶è¯»éæ¯å±äº«éãè¯»éæ¯å±äº«éä½¿å¾å¹¶åè¯»æ¯éå¸¸é«æçï¼è¯»åï¼åè¯» ï¼ååçè¿ç¨æ¯äºæ¥çã\n\n\n# æ²è§éä¸ä¹è§é\n\nä¹è§éä¸æ²è§éä¸æ¯æå·ä½çä»ä¹ç±»åçéï¼èæ¯å¤çå¹¶ååæ­¥çç­ç¥ã\n\n * æ²è§é - æ²è§éå¯¹äºå¹¶åéåæ²è§çæåº¦ï¼è®¤ä¸ºï¼ä¸å éçå¹¶åæä½ä¸å®ä¼åºé®é¢ãæ²è§ééååæä½é¢ç¹çåºæ¯ã\n * ä¹è§é - ä¹è§éå¯¹äºå¹¶åéåä¹è§çæåº¦ï¼è®¤ä¸ºï¼ä¸å éçå¹¶åæä½ä¹æ²¡ä»ä¹é®é¢ãå¯¹äºåä¸ä¸ªæ°æ®çå¹¶åæä½ï¼æ¯ä¸ä¼åçä¿®æ¹çãå¨æ´æ°æ°æ®çæ¶åï¼ä¼éç¨ä¸æ­å°è¯æ´æ°çæ¹å¼æ´æ°æ°æ®ãä¹è§ééåè¯»å¤åå°çåºæ¯ã\n\næ²è§éä¸ä¹è§éå¨ Java ä¸­çå¸åå®ç°ï¼\n\n * æ²è§éå¨ Java ä¸­çåºç¨å°±æ¯éè¿ä½¿ç¨ synchronized å Lock æ¾ç¤ºå éæ¥è¿è¡äºæ¥åæ­¥ï¼è¿æ¯ä¸ç§é»å¡åæ­¥ã\n\n * ä¹è§éå¨ Java ä¸­çåºç¨å°±æ¯éç¨ CAS æºå¶ï¼CAS æä½éè¿ Unsafe ç±»æä¾ï¼ä½è¿ä¸ªç±»ä¸ç´æ¥æ´é²ä¸º APIï¼æä»¥é½æ¯é´æ¥ä½¿ç¨ï¼å¦åç§åå­ç±»ï¼ã\n\n\n# ååéãè½»éçº§éãééçº§é\n\næè°è½»éçº§éä¸ééçº§éï¼æçæ¯éæ§å¶ç²åº¦çç²ç»ãæ¾ç¶ï¼æ§å¶ç²åº¦è¶ç»ï¼é»å¡å¼éè¶å°ï¼å¹¶åæ§ä¹å°±è¶é«ã\n\nJava 1.6 ä»¥åï¼ééçº§éä¸è¬æçæ¯ synchronized ï¼èè½»éçº§éæçæ¯ volatileã\n\nJava 1.6 ä»¥åï¼éå¯¹ synchronized åäºå¤§éä¼åï¼å¼å¥ 4 ç§éç¶æï¼ æ éç¶æãååéãè½»éçº§éåééçº§éãéå¯ä»¥ååçä»ååéåçº§å°è½»éçº§éï¼åä»è½»éçº§éåçº§å°ééçº§é ã\n\n * ååé - ååéæ¯æä¸æ®µåæ­¥ä»£ç ä¸ç´è¢«ä¸ä¸ªçº¿ç¨æè®¿é®ï¼é£ä¹è¯¥çº¿ç¨ä¼èªå¨è·åéãéä½è·åéçä»£ä»·ã\n\n * è½»éçº§é - æ¯æå½éæ¯ååéçæ¶åï¼è¢«å¦ä¸ä¸ªçº¿ç¨æè®¿é®ï¼ååéå°±ä¼åçº§ä¸ºè½»éçº§éï¼å¶ä»çº¿ç¨ä¼éè¿èªæçå½¢å¼å°è¯è·åéï¼ä¸ä¼é»å¡ï¼æé«æ§è½ã\n\n * ééçº§é - æ¯æå½éä¸ºè½»éçº§éçæ¶åï¼å¦ä¸ä¸ªçº¿ç¨è½ç¶æ¯èªæï¼ä½èªæä¸ä¼ä¸ç´æç»­ä¸å»ï¼å½èªæä¸å®æ¬¡æ°çæ¶åï¼è¿æ²¡æè·åå°éï¼å°±ä¼è¿å¥é»å¡ï¼è¯¥éè¨èä¸ºééçº§éãééçº§éä¼è®©å¶ä»ç³è¯·ççº¿ç¨è¿å¥é»å¡ï¼æ§è½éä½ã\n\n\n# åæ®µé\n\nåæ®µéå¶å®æ¯ä¸ç§éçè®¾è®¡ï¼å¹¶ä¸æ¯å·ä½çä¸ç§éãæè°åæ®µéï¼å°±æ¯æéçå¯¹è±¡åæå¤æ®µï¼æ¯æ®µç¬ç«æ§å¶ï¼ä½¿å¾éç²åº¦æ´ç»ï¼åå°é»å¡å¼éï¼ä»èæé«å¹¶åæ§ãè¿å¶å®å¾å¥½çè§£ï¼å°±åé«éå¬è·¯ä¸çæ¶è´¹ç«ï¼å¦æåªæä¸ä¸ªæ¶è´¹å£ï¼é£ææçè½¦åªè½ææä¸æ¡éç¼´è´¹ï¼å¦ææå¤ä¸ªæ¶è´¹å£ï¼å°±å¯ä»¥åæµäºã\n\nHashtable ä½¿ç¨ synchronized ä¿®é¥°æ¹æ³æ¥ä¿è¯çº¿ç¨å®å¨æ§ï¼é£ä¹é¢å¯¹çº¿ç¨çè®¿é®ï¼Hashtable å°±ä¼éä½æ´ä¸ªå¯¹è±¡ï¼ææçå¶å®çº¿ç¨åªè½ç­å¾ï¼è¿ç§é»å¡æ¹å¼çååéæ¾ç¶å¾ä½ã\n\nJava 1.7 ä»¥åç ConcurrentHashMap å°±æ¯åæ®µéçå¸åæ¡ä¾ãConcurrentHashMap ç»´æ¤äºä¸ä¸ª Segment æ°ç»ï¼ä¸è¬ç§°ä¸ºåæ®µæ¡¶ã\n\nfinal Segment<K,V>[] segments;\n\n\nå½æçº¿ç¨è®¿é® ConcurrentHashMap çæ°æ®æ¶ï¼ConcurrentHashMap ä¼åæ ¹æ® hashCode è®¡ç®åºæ°æ®å¨åªä¸ªæ¡¶ï¼å³åªä¸ª Segmentï¼ï¼ç¶åéä½è¿ä¸ª Segmentã\n\n\n# æ¾ç¤ºéååç½®é\n\nJava 1.5 ä¹åï¼åè°å¯¹å±äº«å¯¹è±¡çè®¿é®æ¶å¯ä»¥ä½¿ç¨çæºå¶åªæ synchronized å volatileãè¿ä¸¤ä¸ªé½å±äºåç½®éï¼å³éçç³è¯·åéæ¾é½æ¯ç± JVM ææ§å¶ã\n\nJava 1.5 ä¹åï¼å¢å äºæ°çæºå¶ï¼ReentrantLockãReentrantReadWriteLock ï¼è¿ç±»éçç³è¯·åéæ¾é½å¯ä»¥ç±ç¨åºææ§å¶ï¼æä»¥å¸¸è¢«ç§°ä¸ºæ¾ç¤ºéã\n\n> ð¡ synchronized çç¨æ³ååçå¯ä»¥åèï¼Java å¹¶ååºç¡æºå¶ - synchronized ã\n> \n> ð æ³¨æï¼å¦æä¸éè¦ ReentrantLockãReentrantReadWriteLock ææä¾çé«çº§åæ­¥ç¹æ§ï¼åºè¯¥ä¼åèèä½¿ç¨ synchronized ãçç±å¦ä¸ï¼\n> \n>  * Java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ ReentrantLockãReentrantReadWriteLock åºæ¬ä¸æå¹³ã\n>  * ä»è¶å¿æ¥çï¼Java æªæ¥æ´å¯è½ä¼ä¼å synchronized ï¼èä¸æ¯ ReentrantLockãReentrantReadWriteLock ï¼å ä¸º synchronized æ¯ JVM åç½®å±æ§ï¼å®è½æ§è¡ä¸äºä¼åã\n>  * ReentrantLockãReentrantReadWriteLock ç³è¯·åéæ¾éé½æ¯ç±ç¨åºæ§å¶ï¼å¦æä½¿ç¨ä¸å½ï¼å¯è½é ææ­»éï¼è¿æ¯å¾å±é©çã\n\nä»¥ä¸å¯¹æ¯ä¸ä¸æ¾ç¤ºéååç½®éçå·®å¼ï¼\n\n * ä¸»å¨è·åéåéæ¾é\n   * synchronized ä¸è½ä¸»å¨è·åéåéæ¾éãè·åéåéæ¾éé½æ¯ JVM æ§å¶çã\n   * ReentrantLock å¯ä»¥ä¸»å¨è·åéåéæ¾éãï¼å¦æå¿è®°éæ¾éï¼å°±å¯è½äº§çæ­»éï¼ã\n * ååºä¸­æ­\n   * synchronized ä¸è½ååºä¸­æ­ã\n   * ReentrantLock å¯ä»¥ååºä¸­æ­ã\n * è¶æ¶æºå¶\n   * synchronized æ²¡æè¶æ¶æºå¶ã\n   * ReentrantLock æè¶æ¶æºå¶ãReentrantLock å¯ä»¥è®¾ç½®è¶æ¶æ¶é´ï¼è¶æ¶åèªå¨éæ¾éï¼é¿åä¸ç´ç­å¾ã\n * æ¯æå¬å¹³é\n   * synchronized åªæ¯æéå¬å¹³éã\n   * ReentrantLock æ¯æéå¬å¹³éåå¬å¹³éã\n * æ¯å¦æ¯æå±äº«\n   * è¢« synchronized ä¿®é¥°çæ¹æ³æä»£ç åï¼åªè½è¢«ä¸ä¸ªçº¿ç¨è®¿é®ï¼ç¬äº«ï¼ãå¦æè¿ä¸ªçº¿ç¨è¢«é»å¡ï¼å¶ä»çº¿ç¨ä¹åªè½ç­å¾\n   * ReentrantLock å¯ä»¥åºäº Condition çµæ´»çæ§å¶åæ­¥æ¡ä»¶ã\n * æ¯å¦æ¯æè¯»ååç¦»\n   * synchronized ä¸æ¯æè¯»åéåç¦»ï¼\n   * ReentrantReadWriteLock æ¯æè¯»åéï¼ä»èä½¿é»å¡è¯»åçæä½åå¼ï¼æææé«å¹¶åæ§ã\n\n\n# Lock å Condition\n\n\n# ä¸ºä½å¼å¥ Lock å Condition\n\nå¹¶åç¼ç¨é¢åï¼æä¸¤å¤§æ ¸å¿é®é¢ï¼ä¸ä¸ªæ¯äºæ¥ï¼å³åä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®å±äº«èµæºï¼å¦ä¸ä¸ªæ¯åæ­¥ï¼å³çº¿ç¨ä¹é´å¦ä½éä¿¡ãåä½ãè¿ä¸¤å¤§é®é¢ï¼ç®¡ç¨é½æ¯è½å¤è§£å³çãJava SDK å¹¶ååéè¿ Lock å Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨ï¼å¶ä¸­ Lock ç¨äºè§£å³äºæ¥é®é¢ï¼Condition ç¨äºè§£å³åæ­¥é®é¢ã\n\nsynchronized æ¯ç®¡ç¨çä¸ç§å®ç°ï¼æ¢ç¶å¦æ­¤ï¼ä½å¿åæä¾ Lock å Conditionã\n\nJDK 1.6 ä»¥åï¼synchronized è¿æ²¡æåä¼åï¼æ§è½è¿ä½äº Lockãä½æ¯ï¼æ§è½ä¸æ¯å¼å¥ Lock çæéè¦å ç´ ãçæ­£å³é®å¨äºï¼synchronized ä½¿ç¨ä¸å½ï¼å¯è½ä¼åºç°æ­»éã\n\nsynchronized æ æ³éè¿ç ´åä¸å¯æ¢å æ¡ä»¶æ¥é¿åæ­»éãåå æ¯ synchronized ç³è¯·èµæºçæ¶åï¼å¦æç³è¯·ä¸å°ï¼çº¿ç¨ç´æ¥è¿å¥é»å¡ç¶æäºï¼èçº¿ç¨è¿å¥é»å¡ç¶æï¼å¥é½å¹²ä¸äºï¼ä¹éæ¾ä¸äºçº¿ç¨å·²ç»å æçèµæºã\n\nä¸åç½®é synchronized ä¸åçæ¯ï¼Lock æä¾äºä¸ç»æ æ¡ä»¶çãå¯è½®è¯¢çãå®æ¶çä»¥åå¯ä¸­æ­çéæä½ï¼ææè·åéãéæ¾éçæä½é½æ¯æ¾å¼çæä½ã\n\n * è½å¤ååºä¸­æ­ãsynchronized çé®é¢æ¯ï¼ææé A åï¼å¦æå°è¯è·åé B å¤±è´¥ï¼é£ä¹çº¿ç¨å°±è¿å¥é»å¡ç¶æï¼ä¸æ¦åçæ­»éï¼å°±æ²¡æä»»ä½æºä¼æ¥å¤éé»å¡ççº¿ç¨ãä½å¦æé»å¡ç¶æççº¿ç¨è½å¤ååºä¸­æ­ä¿¡å·ï¼ä¹å°±æ¯è¯´å½æä»¬ç»é»å¡ççº¿ç¨åéä¸­æ­ä¿¡å·çæ¶åï¼è½å¤å¤éå®ï¼é£å®å°±ææºä¼éæ¾æ¾ç»ææçé Aãè¿æ ·å°±ç ´åäºä¸å¯æ¢å æ¡ä»¶äºã\n * æ¯æè¶æ¶ãå¦æçº¿ç¨å¨ä¸æ®µæ¶é´ä¹åæ²¡æè·åå°éï¼ä¸æ¯è¿å¥é»å¡ç¶æï¼èæ¯è¿åä¸ä¸ªéè¯¯ï¼é£è¿ä¸ªçº¿ç¨ä¹ææºä¼éæ¾æ¾ç»ææçéãè¿æ ·ä¹è½ç ´åä¸å¯æ¢å æ¡ä»¶ã\n * éé»å¡å°è·åéãå¦æå°è¯è·åéå¤±è´¥ï¼å¹¶ä¸è¿å¥é»å¡ç¶æï¼èæ¯ç´æ¥è¿åï¼é£è¿ä¸ªçº¿ç¨ä¹ææºä¼éæ¾æ¾ç»ææçéãè¿æ ·ä¹è½ç ´åä¸å¯æ¢å æ¡ä»¶ã\n\n\n# Lock æ¥å£\n\nLock çæ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface Lock {\n    void lock();\n    void lockInterruptibly() throws InterruptedException;\n    boolean tryLock();\n    boolean tryLock(long time, TimeUnit unit) throws InterruptedException;\n    void unlock();\n    Condition newCondition();\n}\n\n\n * lock() - è·åéã\n * unlock() - éæ¾éã\n * tryLock() - å°è¯è·åéï¼ä»å¨è°ç¨æ¶éæªè¢«å¦ä¸ä¸ªçº¿ç¨ææçæåµä¸ï¼æè·åè¯¥éã\n * tryLock(long time, TimeUnit unit) - å tryLock() ç±»ä¼¼ï¼åºå«ä»å¨äºéå®æ¶é´ï¼å¦æéå®æ¶é´åæªè·åå°éï¼è§ä¸ºå¤±è´¥ã\n * lockInterruptibly() - éæªè¢«å¦ä¸ä¸ªçº¿ç¨ææï¼ä¸çº¿ç¨æ²¡æè¢«ä¸­æ­çæåµä¸ï¼æè½è·åéã\n * newCondition() - è¿åä¸ä¸ªç»å®å° Lock å¯¹è±¡ä¸ç Condition å®ä¾ã\n\n\n# Condition\n\nCondition å®ç°äºç®¡ç¨æ¨¡åéé¢çæ¡ä»¶åéã\n\nåæä¸­æè¿ Lock æ¥å£ä¸­ æä¸ä¸ª newCondition() æ¹æ³ç¨äºè¿åä¸ä¸ªç»å®å° Lock å¯¹è±¡ä¸ç Condition å®ä¾ãCondition æ¯ä»ä¹ï¼æä»ä¹ä½ç¨ï¼æ¬èå°ä¸ä¸è®²è§£ã\n\nå¨åçº¿ç¨ä¸­ï¼ä¸æ®µä»£ç çæ§è¡å¯è½ä¾èµäºæä¸ªç¶æï¼å¦æä¸æ»¡è¶³ç¶ææ¡ä»¶ï¼ä»£ç å°±ä¸ä¼è¢«æ§è¡ï¼å¸åçåºæ¯ï¼å¦ï¼if ... else ...ï¼ãå¨å¹¶åç¯å¢ä¸­ï¼å½ä¸ä¸ªçº¿ç¨å¤æ­æä¸ªç¶ææ¡ä»¶æ¶ï¼å¶ç¶æå¯è½æ¯ç±äºå¶ä»çº¿ç¨çæä½èæ¹åï¼è¿æ¶å°±éè¦æä¸å®çåè°æºå¶æ¥ç¡®ä¿å¨åä¸æ¶å»ï¼æ°æ®åªè½è¢«ä¸ä¸ªçº¿ç¨éä¿®æ¹ï¼ä¸ä¿®æ¹çæ°æ®ç¶æè¢«ææçº¿ç¨ææç¥ã\n\nJava 1.5 ä¹åï¼ä¸»è¦æ¯å©ç¨ Object ç±»ä¸­ç waitãnotifyãnotifyAll éå synchronized æ¥è¿è¡çº¿ç¨é´éä¿¡ï¼å¦æä¸äºè§£å¶ç¹æ§ï¼å¯ä»¥åèï¼Java çº¿ç¨åºç¡ - wait/notify/notifyAllï¼ã\n\nwaitãnotifyãnotifyAll éè¦éå synchronized ä½¿ç¨ï¼ä¸éç¨äº Lockãèä½¿ç¨ Lock ççº¿ç¨ï¼å½¼æ­¤é´éä¿¡åºè¯¥ä½¿ç¨ Condition ãè¿å¯ä»¥çè§£ä¸ºï¼ä»ä¹æ ·çééä»ä¹æ ·çé¥åãåç½®éï¼synchronizedï¼éååç½®æ¡ä»¶éåï¼waitãnotifyãnotifyAll ï¼ï¼æ¾å¼éï¼Lockï¼éåæ¾å¼æ¡ä»¶éåï¼Condition ï¼ã\n\n# Condition çç¹æ§\n\nCondition æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface Condition {\n    void await() throws InterruptedException;\n    void awaitUninterruptibly();\n    long awaitNanos(long nanosTimeout) throws InterruptedException;\n    boolean await(long time, TimeUnit unit) throws InterruptedException;\n    boolean awaitUntil(Date deadline) throws InterruptedException;\n    void signal();\n    void signalAll();\n}\n\n\nå¶ä¸­ï¼awaitãsignalãsignalAll ä¸ waitãnotifyãnotifyAll ç¸å¯¹åºï¼åè½ä¹ç¸ä¼¼ãé¤æ­¤ä»¥å¤ï¼Condition ç¸æ¯åç½®æ¡ä»¶éåï¼ waitãnotifyãnotifyAll ï¼ï¼æä¾äºæ´ä¸ºä¸°å¯çåè½ï¼\n\n * æ¯ä¸ªéï¼Lockï¼ä¸å¯ä»¥å­å¨å¤ä¸ª Conditionï¼è¿æå³çéçç¶ææ¡ä»¶å¯ä»¥æå¤ä¸ªã\n * æ¯æå¬å¹³çæéå¬å¹³çéåæä½ã\n * æ¯æå¯ä¸­æ­çæ¡ä»¶ç­å¾ï¼ç¸å³æ¹æ³ï¼awaitUninterruptibly() ã\n * æ¯æå¯å®æ¶çç­å¾ï¼ç¸å³æ¹æ³ï¼awaitNanos(long) ãawait(long, TimeUnit)ãawaitUntil(Date)ã\n\n# Condition çç¨æ³\n\nè¿éä»¥ Condition æ¥å®ç°ä¸ä¸ªæ¶è´¹èãçäº§èæ¨¡å¼ã\n\n> ð æ³¨æï¼äºå®ä¸ï¼è§£å³æ­¤ç±»é®é¢ä½¿ç¨ CountDownLatchãSemaphore ç­å·¥å·æ´ä¸ºä¾¿æ·ãå®å¨ãæ³äºè§£è¯¦æï¼å¯ä»¥åè Java å¹¶åå·¥å·ç±» ã\n\näº§åç±»\n\nclass Message {\n\n    private final Lock lock = new ReentrantLock();\n\n    private final Condition producedMsg = lock.newCondition();\n\n    private final Condition consumedMsg = lock.newCondition();\n\n    private String message;\n\n    private boolean state;\n\n    private boolean end;\n\n    public void consume() {\n        //lock\n        lock.lock();\n        try {\n            // no new message wait for new message\n            while (!state) { producedMsg.await(); }\n\n            System.out.println("consume message : " + message);\n            state = false;\n            // message consumed, notify waiting thread\n            consumedMsg.signal();\n        } catch (InterruptedException ie) {\n            System.out.println("Thread interrupted - viewMessage");\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void produce(String message) {\n        lock.lock();\n        try {\n            // last message not consumed, wait for it be consumed\n            while (state) { consumedMsg.await(); }\n\n            System.out.println("produce msg: " + message);\n            this.message = message;\n            state = true;\n            // new message added, notify waiting thread\n            producedMsg.signal();\n        } catch (InterruptedException ie) {\n            System.out.println("Thread interrupted - publishMessage");\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public boolean isEnd() {\n        return end;\n    }\n\n    public void setEnd(boolean end) {\n        this.end = end;\n    }\n\n}\n\n\næ¶è´¹è\n\nclass MessageConsumer implements Runnable {\n\n    private Message message;\n\n    public MessageConsumer(Message msg) {\n        message = msg;\n    }\n\n    @Override\n    public void run() {\n        while (!message.isEnd()) { message.consume(); }\n    }\n\n}\n\n\nçäº§è\n\nclass MessageProducer implements Runnable {\n\n    private Message message;\n\n    public MessageProducer(Message msg) {\n        message = msg;\n    }\n\n    @Override\n    public void run() {\n        produce();\n    }\n\n    public void produce() {\n        List<String> msgs = new ArrayList<>();\n        msgs.add("Begin");\n        msgs.add("Msg1");\n        msgs.add("Msg2");\n\n        for (String msg : msgs) {\n            message.produce(msg);\n            try {\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        message.produce("End");\n        message.setEnd(true);\n    }\n\n}\n\n\næµè¯\n\npublic class LockConditionDemo {\n\n    public static void main(String[] args) {\n        Message msg = new Message();\n        Thread producer = new Thread(new MessageProducer(msg));\n        Thread consumer = new Thread(new MessageConsumer(msg));\n        producer.start();\n        consumer.start();\n    }\n}\n\n\n\n# ReentrantLock\n\nReentrantLock ç±»æ¯ Lock æ¥å£çå·ä½å®ç°ï¼ä¸åç½®é synchronized ç¸åçæ¯ï¼å®æ¯ä¸ä¸ªå¯éå¥éã\n\n\n# ReentrantLock çç¹æ§\n\nReentrantLock çç¹æ§å¦ä¸ï¼\n\n * ReentrantLock æä¾äºä¸ synchronized ç¸åçäºæ¥æ§ãåå­å¯è§æ§åå¯éå¥æ§ã\n * ReentrantLock æ¯æå¬å¹³éåéå¬å¹³éï¼é»è®¤ï¼ä¸¤ç§æ¨¡å¼ã\n * ReentrantLock å®ç°äº Lock æ¥å£ï¼æ¯æäº synchronized æä¸å·å¤ççµæ´»æ§ã\n   * synchronized æ æ³ä¸­æ­ä¸ä¸ªæ­£å¨ç­å¾è·åéççº¿ç¨\n   * synchronized æ æ³å¨è¯·æ±è·åä¸ä¸ªéæ¶æ ä¼æ­¢å°ç­å¾\n\n\n# ReentrantLock çç¨æ³\n\nåæäºè§£äº ReentrantLock çç¹æ§ï¼æ¥ä¸æ¥ï¼æä»¬è¦è®²è¿°å¶å·ä½ç¨æ³ã\n\n# ReentrantLock çæé æ¹æ³\n\nReentrantLock æä¸¤ä¸ªæé æ¹æ³ï¼\n\npublic ReentrantLock() {}\npublic ReentrantLock(boolean fair) {}\n\n\n * ReentrantLock() - é»è®¤æé æ¹æ³ä¼åå§åä¸ä¸ªéå¬å¹³éï¼NonfairSyncï¼ï¼\n * ReentrantLock(boolean) - new ReentrantLock(true) ä¼åå§åä¸ä¸ªå¬å¹³éï¼FairSyncï¼ã\n\n# lock å unlock æ¹æ³\n\n * lock() - æ æ¡ä»¶è·åéãå¦æå½åçº¿ç¨æ æ³è·åéï¼åå½åçº¿ç¨è¿å¥ä¼ç ç¶æä¸å¯ç¨ï¼ç´è³å½åçº¿ç¨è·åå°éãå¦æè¯¥éæ²¡æè¢«å¦ä¸ä¸ªçº¿ç¨ææï¼åè·åè¯¥éå¹¶ç«å³è¿åï¼å°éçææè®¡æ°è®¾ç½®ä¸º 1ã\n * unlock() - ç¨äºéæ¾éã\n\n> ð æ³¨æï¼è¯·å¡å¿ç¢è®°ï¼è·åéæä½ lock() å¿é¡»å¨ try catch åä¸­è¿è¡ï¼å¹¶ä¸å°éæ¾éæä½ unlock() æ¾å¨ finally åä¸­è¿è¡ï¼ä»¥ä¿è¯éä¸å®è¢«è¢«éæ¾ï¼é²æ­¢æ­»éçåçã\n\nç¤ºä¾ï¼ReentrantLock çåºæ¬æä½\n\npublic class ReentrantLockDemo {\n\n    public static void main(String[] args) {\n        Task task = new Task();\n        MyThread tA = new MyThread("Thread-A", task);\n        MyThread tB = new MyThread("Thread-B", task);\n        MyThread tC = new MyThread("Thread-C", task);\n        tA.start();\n        tB.start();\n        tC.start();\n    }\n\n    static class MyThread extends Thread {\n\n        private Task task;\n\n        public MyThread(String name, Task task) {\n            super(name);\n            this.task = task;\n        }\n\n        @Override\n        public void run() {\n            task.execute();\n        }\n\n    }\n\n    static class Task {\n\n        private ReentrantLock lock = new ReentrantLock();\n\n        public void execute() {\n            lock.lock();\n            try {\n                for (int i = 0; i < 3; i++) {\n                    System.out.println(lock.toString());\n\n                    // æ¥è¯¢å½åçº¿ç¨ hold ä½æ­¤éçæ¬¡æ°\n                    System.out.println("\\t holdCount: " + lock.getHoldCount());\n\n                    // æ¥è¯¢æ­£ç­å¾è·åæ­¤éççº¿ç¨æ°\n                    System.out.println("\\t queuedLength: " + lock.getQueueLength());\n\n                    // æ¯å¦ä¸ºå¬å¹³é\n                    System.out.println("\\t isFair: " + lock.isFair());\n\n                    // æ¯å¦è¢«éä½\n                    System.out.println("\\t isLocked: " + lock.isLocked());\n\n                    // æ¯å¦è¢«å½åçº¿ç¨ææé\n                    System.out.println("\\t isHeldByCurrentThread: " + lock.isHeldByCurrentThread());\n\n                    try {\n                        Thread.sleep(500);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            } finally {\n                lock.unlock();\n            }\n        }\n\n    }\n\n}\n\n\nè¾åºç»æï¼\n\njava.util.concurrent.locks.ReentrantLock@64fcd88a[Locked by thread Thread-A]\n\t holdCount: 1\n\t queuedLength: 2\n\t isFair: false\n\t isLocked: true\n\t isHeldByCurrentThread: true\njava.util.concurrent.locks.ReentrantLock@64fcd88a[Locked by thread Thread-C]\n\t holdCount: 1\n\t queuedLength: 1\n\t isFair: false\n\t isLocked: true\n\t isHeldByCurrentThread: true\n// ...\n\n\n# tryLock æ¹æ³\n\nä¸æ æ¡ä»¶è·åéç¸æ¯ï¼tryLock ææ´å®åçå®¹éæºå¶ã\n\n * tryLock() - å¯è½®è¯¢è·åéãå¦ææåï¼åè¿å trueï¼å¦æå¤±è´¥ï¼åè¿å falseãä¹å°±æ¯è¯´ï¼è¿ä¸ªæ¹æ³æ è®ºæè´¥é½ä¼ç«å³è¿åï¼è·åä¸å°éï¼éå·²è¢«å¶ä»çº¿ç¨è·åï¼æ¶ä¸ä¼ä¸ç´ç­å¾ã\n * tryLock(long, TimeUnit) - å¯å®æ¶è·åéãå tryLock() ç±»ä¼¼ï¼åºå«ä»å¨äºè¿ä¸ªæ¹æ³å¨è·åä¸å°éæ¶ä¼ç­å¾ä¸å®çæ¶é´ï¼å¨æ¶é´æéä¹åå¦æè¿è·åä¸å°éï¼å°±è¿å falseãå¦æå¦æä¸å¼å§æ¿å°éæèå¨ç­å¾æé´åæ¿å°äºéï¼åè¿å trueã\n\nç¤ºä¾ï¼ReentrantLock ç tryLock() æä½\n\nä¿®æ¹ä¸ä¸ªç¤ºä¾ä¸­ç execute() æ¹æ³\n\npublic void execute() {\n    if (lock.tryLock()) {\n        try {\n            for (int i = 0; i < 3; i++) {\n               // ç¥...\n            }\n        } finally {\n            lock.unlock();\n        }\n    } else {\n        System.out.println(Thread.currentThread().getName() + " è·åéå¤±è´¥");\n    }\n}\n\n\nç¤ºä¾ï¼ReentrantLock ç tryLock(long, TimeUnit) æä½\n\nä¿®æ¹ä¸ä¸ªç¤ºä¾ä¸­ç execute() æ¹æ³\n\npublic void execute() {\n    try {\n        if (lock.tryLock(2, TimeUnit.SECONDS)) {\n            try {\n                for (int i = 0; i < 3; i++) {\n                    // ç¥...\n                }\n            } finally {\n                lock.unlock();\n            }\n        } else {\n            System.out.println(Thread.currentThread().getName() + " è·åéå¤±è´¥");\n        }\n    } catch (InterruptedException e) {\n        System.out.println(Thread.currentThread().getName() + " è·åéè¶æ¶");\n        e.printStackTrace();\n    }\n}\n\n\n# lockInterruptibly æ¹æ³\n\n * lockInterruptibly() - å¯ä¸­æ­è·åéãå¯ä¸­æ­è·åéå¯ä»¥å¨è·å¾éçåæ¶ä¿æå¯¹ä¸­æ­çååºãå¯ä¸­æ­è·åéæ¯å¶å®è·åéçæ¹å¼ç¨å¾®å¤æä¸äºï¼éè¦ä¸¤ä¸ª try-catch åï¼å¦æå¨è·åéçæä½ä¸­æåºäº InterruptedException ï¼é£ä¹å¯ä»¥ä½¿ç¨æ åç try-finally å éæ¨¡å¼ï¼ã\n   * ä¸¾ä¾æ¥è¯´ï¼åè®¾æä¸¤ä¸ªçº¿ç¨åæ¶éè¿ lock.lockInterruptibly() è·åæä¸ªéæ¶ï¼è¥çº¿ç¨ A è·åå°äºéï¼åçº¿ç¨ B åªè½ç­å¾ãè¥æ­¤æ¶å¯¹çº¿ç¨ B è°ç¨ threadB.interrupt() æ¹æ³è½å¤ä¸­æ­çº¿ç¨ B çç­å¾è¿ç¨ãç±äº lockInterruptibly() çå£°æä¸­æåºäºå¼å¸¸ï¼æä»¥ lock.lockInterruptibly() å¿é¡»æ¾å¨ try åä¸­æèå¨è°ç¨ lockInterruptibly() çæ¹æ³å¤å£°ææåº InterruptedExceptionã\n\n> ð æ³¨æï¼å½ä¸ä¸ªçº¿ç¨è·åäºéä¹åï¼æ¯ä¸ä¼è¢« interrupt() æ¹æ³ä¸­æ­çãåç¬è°ç¨ interrupt() æ¹æ³ä¸è½ä¸­æ­æ­£å¨è¿è¡ç¶æä¸­ççº¿ç¨ï¼åªè½ä¸­æ­é»å¡ç¶æä¸­ççº¿ç¨ãå æ­¤å½éè¿ lockInterruptibly() æ¹æ³è·åæä¸ªéæ¶ï¼å¦ææªè·åå°éï¼åªæå¨ç­å¾çç¶æä¸ï¼æå¯ä»¥ååºä¸­æ­ã\n\nç¤ºä¾ï¼ReentrantLock ç lockInterruptibly() æä½\n\nä¿®æ¹ä¸ä¸ªç¤ºä¾ä¸­ç execute() æ¹æ³\n\npublic void execute() {\n    try {\n        lock.lockInterruptibly();\n\n        for (int i = 0; i < 3; i++) {\n            // ç¥...\n        }\n    } catch (InterruptedException e) {\n        System.out.println(Thread.currentThread().getName() + "è¢«ä¸­æ­");\n        e.printStackTrace();\n    } finally {\n        lock.unlock();\n    }\n}\n\n\n# newCondition æ¹æ³\n\nnewCondition() - è¿åä¸ä¸ªç»å®å° Lock å¯¹è±¡ä¸ç Condition å®ä¾ãCondition çç¹æ§åå·ä½æ¹æ³è¯·éè¯»ä¸æ Conditionã\n\n\n# ReentrantLock çåç\n\n# ReentrantLock çå¯è§æ§\n\nclass X {\n  private final Lock rtl =\n  new ReentrantLock();\n  int value;\n  public void addOne() {\n    // è·åé\n    rtl.lock();\n    try {\n      value+=1;\n    } finally {\n      // ä¿è¯éè½éæ¾\n      rtl.unlock();\n    }\n  }\n}\n\n\nReentrantLockï¼åé¨ææä¸ä¸ª volatile çæååé stateï¼è·åéçæ¶åï¼ä¼è¯»å state çå¼ï¼è§£éçæ¶åï¼ä¹ä¼è¯»å state çå¼ï¼ç®ååçä»£ç å¦ä¸é¢æç¤ºï¼ãä¹å°±æ¯è¯´ï¼å¨æ§è¡ value+=1 ä¹åï¼ç¨åºåè¯»åäºä¸æ¬¡ volatile åé stateï¼å¨æ§è¡ value+=1 ä¹åï¼åè¯»åäºä¸æ¬¡ volatile åé stateãæ ¹æ®ç¸å³ç Happens-Before è§åï¼\n\n 1. é¡ºåºæ§è§åï¼å¯¹äºçº¿ç¨ T1ï¼value+=1 Happens-Before éæ¾éçæä½ unlock()ï¼\n 2. volatile åéè§åï¼ç±äº state = 1 ä¼åè¯»å stateï¼æä»¥çº¿ç¨ T1 ç unlock() æä½ Happens-Before çº¿ç¨ T2 ç lock() æä½ï¼\n 3. ä¼ éæ§è§åï¼çº¿ç¨ T1 ç value+=1 Happens-Before çº¿ç¨ T2 ç lock() æä½ã\n\n# ReentrantLock çæ°æ®ç»æ\n\néè¯» ReentrantLock çæºç ï¼å¯ä»¥åç°å®æä¸ä¸ªæ ¸å¿å­æ®µï¼\n\nprivate final Sync sync;\n\n\n * sync - åé¨æ½è±¡ç±» ReentrantLock.Sync å¯¹è±¡ï¼Sync ç»§æ¿èª AQSãå®æä¸¤ä¸ªå­ç±»ï¼\n * ReentrantLock.FairSync - å¬å¹³éã\n * ReentrantLock.NonfairSync - éå¬å¹³éã\n\næ¥çæºç å¯ä»¥åç°ï¼ReentrantLock å®ç° Lock æ¥å£å¶å®æ¯è°ç¨ ReentrantLock.FairSync æ ReentrantLock.NonfairSync ä¸­åèªçå®ç°ï¼è¿éä¸ä¸ä¸åä¸¾ã\n\n# ReentrantLock çè·åéåéæ¾é\n\nReentrantLock è·åéåéæ¾éçæ¥å£ï¼ä»è¡¨è±¡çï¼æ¯è°ç¨ ReentrantLock.FairSync æ ReentrantLock.NonfairSync ä¸­åèªçå®ç°ï¼ä»æ¬è´¨ä¸çï¼æ¯åºäº AQS çå®ç°ã\n\nä»ç»éè¯»æºç å¾å®¹æåç°ï¼\n\n * void lock() è°ç¨ Sync ç lock() æ¹æ³ã\n\n * void lockInterruptibly() ç´æ¥è°ç¨ AQS ç è·åå¯ä¸­æ­çç¬å é æ¹æ³ lockInterruptibly()ã\n\n * boolean tryLock() è°ç¨ Sync ç nonfairTryAcquire() ã\n\n * boolean tryLock(long time, TimeUnit unit) ç´æ¥è°ç¨ AQS ç è·åè¶æ¶ç­å¾å¼çç¬å é æ¹æ³ tryAcquireNanos(int arg, long nanosTimeout)ã\n\n * void unlock() ç´æ¥è°ç¨ AQS ç éæ¾ç¬å é æ¹æ³ release(int arg) ã\n\nç´æ¥è°ç¨ AQS æ¥å£çæ¹æ³å°±ä¸åèµè¿°äºï¼å¶åçå¨ [AQS çåç](#AQS çåç) ä¸­å·²ç»ç¨å¾å¤§ç¯å¹è¿è¡è¿è®²è§£ã\n\nnonfairTryAcquire æ¹æ³æºç å¦ä¸ï¼\n\n// å¬å¹³éåéå¬å¹³éé½ä¼ç¨è¿ä¸ªæ¹æ³åºå°è¯è·åé\nfinal boolean nonfairTryAcquire(int acquires) {\n    final Thread current = Thread.currentThread();\n    int c = getState();\n    if (c == 0) {\n        if (compareAndSetState(0, acquires)) {\n         // å¦æåæ­¥ç¶æä¸º0ï¼å°å¶è®¾ä¸º acquiresï¼å¹¶è®¾ç½®å½åçº¿ç¨ä¸ºæå®çº¿ç¨\n            setExclusiveOwnerThread(current);\n            return true;\n        }\n    }\n    else if (current == getExclusiveOwnerThread()) {\n        int nextc = c + acquires;\n        if (nextc < 0) // overflow\n            throw new Error("Maximum lock count exceeded");\n        setState(nextc);\n        return true;\n    }\n    return false;\n}\n\n\nå¤çæµç¨å¾ç®åï¼\n\n * å¦æåæ­¥ç¶æä¸º 0ï¼è®¾ç½®åæ­¥ç¶æè®¾ä¸º acquiresï¼å¹¶è®¾ç½®å½åçº¿ç¨ä¸ºæå®çº¿ç¨ï¼ç¶åè¿å trueï¼è·åéæåã\n * å¦æåæ­¥ç¶æä¸ä¸º 0 ä¸å½åçº¿ç¨ä¸ºæå®çº¿ç¨ï¼è®¾ç½®åæ­¥ç¶æä¸ºå½åç¶æå¼+acquires å¼ï¼ç¶åè¿å trueï¼è·åéæåã\n * å¦åï¼è¿å falseï¼è·åéå¤±è´¥ã\n\n# å¬å¹³éåéå¬å¹³é\n\nReentrantLock è¿ä¸ªç±»æä¸¤ä¸ªæé å½æ°ï¼ä¸ä¸ªæ¯æ åæé å½æ°ï¼ä¸ä¸ªæ¯ä¼ å¥ fair åæ°çæé å½æ°ãfair åæ°ä»£è¡¨çæ¯éçå¬å¹³ç­ç¥ï¼å¦æä¼ å¥ true å°±è¡¨ç¤ºéè¦æé ä¸ä¸ªå¬å¹³éï¼åä¹åè¡¨ç¤ºè¦æé ä¸ä¸ªéå¬å¹³éã\n\néé½å¯¹åºçä¸ä¸ªç­å¾éåï¼å¦æä¸ä¸ªçº¿ç¨æ²¡æè·å¾éï¼å°±ä¼è¿å¥ç­å¾éåï¼å½æçº¿ç¨éæ¾éçæ¶åï¼å°±éè¦ä»ç­å¾éåä¸­å¤éä¸ä¸ªç­å¾ççº¿ç¨ãå¦ææ¯å¬å¹³éï¼å¤éçç­ç¥å°±æ¯è°ç­å¾çæ¶é´é¿ï¼å°±å¤éè°ï¼å¾å¬å¹³ï¼å¦ææ¯éå¬å¹³éï¼åä¸æä¾è¿ä¸ªå¬å¹³ä¿è¯ï¼æå¯è½ç­å¾æ¶é´ç­ççº¿ç¨åèåè¢«å¤éã\n\nlock æ¹æ³å¨å¬å¹³éåéå¬å¹³éä¸­çå®ç°ï¼\n\näºèçåºå«ä»å¨äºç³è¯·éå¬å¹³éæ¶ï¼å¦æåæ­¥ç¶æä¸º 0ï¼å°è¯å°å¶è®¾ä¸º 1ï¼å¦ææåï¼ç´æ¥å°å½åçº¿ç¨ç½®ä¸ºæå®çº¿ç¨ï¼å¦ååå¬å¹³éä¸æ ·ï¼è°ç¨ AQS è·åç¬å éæ¹æ³ acquireã\n\n// éå¬å¹³éå®ç°\nfinal void lock() {\n    if (compareAndSetState(0, 1))\n    // å¦æåæ­¥ç¶æä¸º0ï¼å°å¶è®¾ä¸º1ï¼å¹¶è®¾ç½®å½åçº¿ç¨ä¸ºæå®çº¿ç¨\n        setExclusiveOwnerThread(Thread.currentThread());\n    else\n    // è°ç¨ AQS è·åç¬å éæ¹æ³ acquire\n        acquire(1);\n}\n\n// å¬å¹³éå®ç°\nfinal void lock() {\n    // è°ç¨ AQS è·åç¬å éæ¹æ³ acquire\n    acquire(1);\n}\n\n\n\n# ReentrantReadWriteLock\n\nReadWriteLock éç¨äºè¯»å¤åå°çåºæ¯ã\n\nReentrantReadWriteLock ç±»æ¯ ReadWriteLock æ¥å£çå·ä½å®ç°ï¼å®æ¯ä¸ä¸ªå¯éå¥çè¯»åéãReentrantReadWriteLock ç»´æ¤äºä¸å¯¹è¯»åéï¼å°è¯»åéåå¼ï¼æå©äºæé«å¹¶åæçã\n\nè¯»åéï¼å¹¶ä¸æ¯ Java è¯­è¨ç¹æçï¼èæ¯ä¸ä¸ªå¹¿ä¸ºä½¿ç¨çéç¨ææ¯ï¼ææçè¯»åéé½éµå®ä»¥ä¸ä¸æ¡åºæ¬ååï¼\n\n * åè®¸å¤ä¸ªçº¿ç¨åæ¶è¯»å±äº«åéï¼\n * åªåè®¸ä¸ä¸ªçº¿ç¨åå±äº«åéï¼\n * å¦æä¸ä¸ªåçº¿ç¨æ­£å¨æ§è¡åæä½ï¼æ­¤æ¶ç¦æ­¢è¯»çº¿ç¨è¯»å±äº«åéã\n\nè¯»åéä¸äºæ¥éçä¸ä¸ªéè¦åºå«å°±æ¯è¯»åéåè®¸å¤ä¸ªçº¿ç¨åæ¶è¯»å±äº«åéï¼èäºæ¥éæ¯ä¸åè®¸çï¼è¿æ¯è¯»åéå¨è¯»å¤åå°åºæ¯ä¸æ§è½ä¼äºäºæ¥éçå³é®ãä½è¯»åéçåæä½æ¯äºæ¥çï¼å½ä¸ä¸ªçº¿ç¨å¨åå±äº«åéçæ¶åï¼æ¯ä¸åè®¸å¶ä»çº¿ç¨æ§è¡åæä½åè¯»æä½ã\n\n\n# ReentrantReadWriteLock çç¹æ§\n\nReentrantReadWriteLock çç¹æ§å¦ä¸ï¼\n\n * ReentrantReadWriteLock éç¨äºè¯»å¤åå°çåºæ¯ãå¦ææ¯åå¤è¯»å°çåºæ¯ï¼ç±äº ReentrantReadWriteLock å¶åé¨å®ç°æ¯ ReentrantLock å¤æï¼æ§è½å¯è½åèè¦å·®ä¸äºãå¦æå­å¨è¿æ ·çé®é¢ï¼éè¦å·ä½é®é¢å·ä½åæãç±äº ReentrantReadWriteLock çè¯»åéï¼ReadLockãWriteLockï¼é½å®ç°äº Lock æ¥å£ï¼æä»¥è¦æ¿æ¢ä¸º ReentrantLock ä¹è¾ä¸ºå®¹æã\n * ReentrantReadWriteLock å®ç°äº ReadWriteLock æ¥å£ï¼æ¯æäº ReentrantLock æä¸å·å¤çè¯»åéåç¦»ãReentrantReadWriteLock ç»´æ¤äºä¸å¯¹è¯»åéï¼ReadLockãWriteLockï¼ãå°è¯»åéåå¼ï¼æå©äºæé«å¹¶åæçãReentrantReadWriteLock çå éç­ç¥æ¯ï¼åè®¸å¤ä¸ªè¯»æä½å¹¶åæ§è¡ï¼ä½æ¯æ¬¡åªåè®¸ä¸ä¸ªåæä½ã\n * ReentrantReadWriteLock ä¸ºè¯»åéé½æä¾äºå¯éå¥çå éè¯­ä¹ã\n * ReentrantReadWriteLock æ¯æå¬å¹³éåéå¬å¹³éï¼é»è®¤ï¼ä¸¤ç§æ¨¡å¼ã\n\nReadWriteLock æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface ReadWriteLock {\n    Lock readLock();\n    Lock writeLock();\n}\n\n\n * readLock - è¿åç¨äºè¯»æä½çéï¼ReadLockï¼ã\n * writeLock - è¿åç¨äºåæä½çéï¼WriteLockï¼ã\n\nå¨è¯»åéååå¥éä¹é´çäº¤äºå¯ä»¥éç¨å¤ç§å®ç°æ¹å¼ï¼ReadWriteLock çä¸äºå¯éå®ç°åæ¬ï¼\n\n * éæ¾ä¼å - å½ä¸ä¸ªåå¥æä½éæ¾åéï¼å¹¶ä¸éåä¸­åæ¶å­å¨è¯»çº¿ç¨ååçº¿ç¨ï¼é£ä¹åºè¯¥ä¼åéæ©è¯»çº¿ç¨ãåçº¿ç¨ï¼è¿æ¯æåååºè¯·æ±ççº¿ç¨ï¼\n * è¯»çº¿ç¨æé - å¦æéæ¯ç±è¯»çº¿ç¨ææï¼ä½æåçº¿ç¨æ­£å¨ç­å¾ï¼é£ä¹æ°å°è¾¾çè¯»çº¿ç¨è½å¦ç«å³è·å¾è®¿é®æï¼è¿æ¯åºè¯¥å¨åçº¿ç¨åé¢ç­å¾ï¼å¦æåè®¸è¯»çº¿ç¨æéå°åçº¿ç¨ä¹åï¼é£ä¹å°æé«å¹¶åæ§ï¼ä½å¯è½é æçº¿ç¨é¥¥é¥¿é®é¢ã\n * éå¥æ§ - è¯»éååéæ¯å¦æ¯å¯éå¥çï¼\n * éçº§ - å¦æä¸ä¸ªçº¿ç¨ææåå¥éï¼é£ä¹å®è½å¦å¨ä¸éæ¾è¯¥éçæåµä¸è·å¾è¯»éï¼è¿å¯è½ä¼ä½¿å¾åéè¢«éçº§ä¸ºè¯»éï¼åæ¶ä¸åè®¸å¶ä»åçº¿ç¨ä¿®æ¹è¢«ä¿æ¤çèµæºã\n * åçº§ - è¯»éè½å¦ä¼åäºå¶ä»æ­£å¨ç­å¾çè¯»çº¿ç¨ååçº¿ç¨èåçº§ä¸ºä¸ä¸ªåéï¼å¨å¤§å¤æ°çè¯»åéå®ç°ä¸­å¹¶ä¸æ¯æåçº§ï¼å ä¸ºå¦ææ²¡ææ¾å¼çåçº§æä½ï¼é£ä¹å¾å®¹æé ææ­»éã\n\n\n# ReentrantReadWriteLock çç¨æ³\n\nåæäºè§£äº ReentrantReadWriteLock çç¹æ§ï¼æ¥ä¸æ¥ï¼æä»¬è¦è®²è¿°å¶å·ä½ç¨æ³ã\n\n# ReentrantReadWriteLock çæé æ¹æ³\n\nReentrantReadWriteLock å ReentrantLock ä¸æ ·ï¼ä¹æä¸¤ä¸ªæé æ¹æ³ï¼ä¸ç¨æ³ç¸ä¼¼ã\n\npublic ReentrantReadWriteLock() {}\npublic ReentrantReadWriteLock(boolean fair) {}\n\n\n * ReentrantReadWriteLock() - é»è®¤æé æ¹æ³ä¼åå§åä¸ä¸ªéå¬å¹³éï¼NonfairSyncï¼ãå¨éå¬å¹³çéä¸­ï¼çº¿ç¨è·å¾éçé¡ºåºæ¯ä¸ç¡®å®çãåçº¿ç¨éçº§ä¸ºè¯»çº¿ç¨æ¯å¯ä»¥çï¼ä½è¯»çº¿ç¨åçº§ä¸ºåçº¿ç¨æ¯ä¸å¯ä»¥çï¼è¿æ ·ä¼å¯¼è´æ­»éï¼ã\n * ReentrantReadWriteLock(boolean) - new ReentrantLock(true) ä¼åå§åä¸ä¸ªå¬å¹³éï¼FairSyncï¼ãå¯¹äºå¬å¹³éï¼ç­å¾æ¶é´æé¿ççº¿ç¨å°ä¼åè·å¾éãå¦æè¿ä¸ªéæ¯è¯»çº¿ç¨ææï¼åå¦ä¸ä¸ªçº¿ç¨è¯·æ±åéï¼é£ä¹å¶ä»è¯»çº¿ç¨é½ä¸è½è·å¾è¯»éï¼ç´å°åçº¿ç¨éæ¾åéã\n\n# ReentrantReadWriteLock çä½¿ç¨å®ä¾\n\nå¨ ReentrantReadWriteLock çç¹æ§ ä¸­å·²ç»ä»ç»è¿ï¼ReentrantReadWriteLock çè¯»åéï¼ReadLockãWriteLockï¼é½å®ç°äº Lock æ¥å£ï¼æä»¥å¶åèªç¬ç«çä½¿ç¨æ¹å¼ä¸ ReentrantLock ä¸æ ·ï¼è¿éä¸åèµè¿°ã\n\nReentrantReadWriteLock ä¸ ReentrantLock ç¨æ³ä¸çå·®å¼ï¼ä¸»è¦å¨äºè¯»åéçéåä½¿ç¨ãæ¬æä»¥ä¸ä¸ªå¸åä½¿ç¨åºæ¯æ¥è¿è¡è®²è§£ã\n\nãç¤ºä¾ãåºäº ReadWriteLock å®ç°ä¸ä¸ªç®åçæ³åæ çç¼å­\n\n/**\n * ç®åçæ çç¼å­å®ç°\n * <p>\n * ä½¿ç¨ WeakHashMap å­å¨é®å¼å¯¹ãWeakHashMap ä¸­å­å¨çå¯¹è±¡æ¯å¼±å¼ç¨ï¼JVM GC æ¶ä¼èªå¨æ¸é¤æ²¡æè¢«å¼ç¨çå¼±å¼ç¨å¯¹è±¡ã\n */\nstatic class UnboundedCache<K, V> {\n\n    private final Map<K, V> cacheMap = new WeakHashMap<>();\n\n    private final ReadWriteLock cacheLock = new ReentrantReadWriteLock();\n\n    public V get(K key) {\n        cacheLock.readLock().lock();\n        V value;\n        try {\n            value = cacheMap.get(key);\n            String log = String.format("%s è¯»æ°æ® %s:%s", Thread.currentThread().getName(), key, value);\n            System.out.println(log);\n        } finally {\n            cacheLock.readLock().unlock();\n        }\n        return value;\n    }\n\n    public V put(K key, V value) {\n        cacheLock.writeLock().lock();\n        try {\n            cacheMap.put(key, value);\n            String log = String.format("%s åå¥æ°æ® %s:%s", Thread.currentThread().getName(), key, value);\n            System.out.println(log);\n        } finally {\n            cacheLock.writeLock().unlock();\n        }\n        return value;\n    }\n\n    public V remove(K key) {\n        cacheLock.writeLock().lock();\n        try {\n            return cacheMap.remove(key);\n        } finally {\n            cacheLock.writeLock().unlock();\n        }\n    }\n\n    public void clear() {\n        cacheLock.writeLock().lock();\n        try {\n            this.cacheMap.clear();\n        } finally {\n            cacheLock.writeLock().unlock();\n        }\n    }\n\n}\n\n\nè¯´æï¼\n\n * ä½¿ç¨ WeakHashMap èä¸æ¯ HashMap æ¥å­å¨é®å¼å¯¹ãWeakHashMap ä¸­å­å¨çå¯¹è±¡æ¯å¼±å¼ç¨ï¼JVM GC æ¶ä¼èªå¨æ¸é¤æ²¡æè¢«å¼ç¨çå¼±å¼ç¨å¯¹è±¡ã\n * å Map åæ°æ®åå åéï¼åå®åï¼éæ¾åéã\n * å Map è¯»æ°æ®åå è¯»éï¼è¯»å®åï¼éæ¾è¯»éã\n\næµè¯å¶çº¿ç¨å®å¨æ§ï¼\n\n/**\n * @author <a href="mailto:forbreak@163.com">Zhang Peng</a>\n * @since 2020-01-01\n */\npublic class ReentrantReadWriteLockDemo {\n\n    static UnboundedCache<Integer, Integer> cache = new UnboundedCache<>();\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newCachedThreadPool();\n        for (int i = 0; i < 20; i++) {\n            executorService.execute(new MyThread());\n            cache.get(0);\n        }\n        executorService.shutdown();\n    }\n\n    /** çº¿ç¨ä»»å¡æ¯æ¬¡åç¼å­ä¸­åå¥ 3 ä¸ªéæºå¼ï¼key åºå® */\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            Random random = new Random();\n            for (int i = 0; i < 3; i++) {\n                cache.put(i, random.nextInt(100));\n            }\n        }\n\n    }\n\n}\n\n\nè¯´æï¼ç¤ºä¾ä¸­ï¼éè¿çº¿ç¨æ± å¯å¨ 20 ä¸ªå¹¶åä»»å¡ãä»»å¡æ¯æ¬¡åç¼å­ä¸­åå¥ 3 ä¸ªéæºå¼ï¼key åºå®ï¼ç¶åä¸»çº¿ç¨æ¯æ¬¡åºå®è¯»åç¼å­ä¸­ç¬¬ä¸ä¸ª key çå¼ã\n\nè¾åºç»æï¼\n\nmain è¯»æ°æ® 0:null\npool-1-thread-1 åå¥æ°æ® 0:16\npool-1-thread-1 åå¥æ°æ® 1:58\npool-1-thread-1 åå¥æ°æ® 2:50\nmain è¯»æ°æ® 0:16\npool-1-thread-1 åå¥æ°æ® 0:85\npool-1-thread-1 åå¥æ°æ® 1:76\npool-1-thread-1 åå¥æ°æ® 2:46\npool-1-thread-2 åå¥æ°æ® 0:21\npool-1-thread-2 åå¥æ°æ® 1:41\npool-1-thread-2 åå¥æ°æ® 2:63\nmain è¯»æ°æ® 0:21\nmain è¯»æ°æ® 0:21\n// ...\n\n\n\n# ReentrantReadWriteLock çåç\n\nåé¢äºè§£äº ReentrantLock çåçï¼çè§£ ReentrantReadWriteLock å°±å®¹æå¤äºã\n\n# ReentrantReadWriteLock çæ°æ®ç»æ\n\néè¯» ReentrantReadWriteLock çæºç ï¼å¯ä»¥åç°å®æä¸ä¸ªæ ¸å¿å­æ®µï¼\n\n/** Inner class providing readlock */\nprivate final ReentrantReadWriteLock.ReadLock readerLock;\n/** Inner class providing writelock */\nprivate final ReentrantReadWriteLock.WriteLock writerLock;\n/** Performs all synchronization mechanics */\nfinal Sync sync;\n\npublic ReentrantReadWriteLock.WriteLock writeLock() { return writerLock; }\npublic ReentrantReadWriteLock.ReadLock  readLock()  { return readerLock; }\n\n\n * sync - åé¨ç±» ReentrantReadWriteLock.Sync å¯¹è±¡ãä¸ ReentrantLock ç±»ä¼¼ï¼å®æä¸¤ä¸ªå­ç±»ï¼ReentrantReadWriteLock.FairSync å ReentrantReadWriteLock.NonfairSync ï¼åå«è¡¨ç¤ºå¬å¹³éåéå¬å¹³éçå®ç°ã\n * readerLock - åé¨ç±» ReentrantReadWriteLock.ReadLock å¯¹è±¡ï¼è¿æ¯ä¸æè¯»éã\n * writerLock - åé¨ç±» ReentrantReadWriteLock.WriteLock å¯¹è±¡ï¼è¿æ¯ä¸æåéã\n\n# ReentrantReadWriteLock çè·åéåéæ¾é\n\npublic static class ReadLock implements Lock, java.io.Serializable {\n\n    // è°ç¨ AQS è·åå±äº«éæ¹æ³\n    public void lock() {\n        sync.acquireShared(1);\n    }\n\n    // è°ç¨ AQS éæ¾å±äº«éæ¹æ³\n    public void unlock() {\n        sync.releaseShared(1);\n    }\n}\n\npublic static class WriteLock implements Lock, java.io.Serializable {\n\n    // è°ç¨ AQS è·åç¬å éæ¹æ³\n    public void lock() {\n        sync.acquire(1);\n    }\n\n    // è°ç¨ AQS éæ¾ç¬å éæ¹æ³\n    public void unlock() {\n        sync.release(1);\n    }\n}\n\n\n\n# StampedLock\n\nReadWriteLock æ¯æä¸¤ç§æ¨¡å¼ï¼ä¸ç§æ¯è¯»éï¼ä¸ç§æ¯åéãè StampedLock æ¯æä¸ç§æ¨¡å¼ï¼åå«æ¯ï¼åéãæ²è§è¯»éåä¹è§è¯»ãå¶ä¸­ï¼åéãæ²è§è¯»éçè¯­ä¹å ReadWriteLock çåéãè¯»éçè¯­ä¹éå¸¸ç±»ä¼¼ï¼åè®¸å¤ä¸ªçº¿ç¨åæ¶è·åæ²è§è¯»éï¼ä½æ¯åªåè®¸ä¸ä¸ªçº¿ç¨è·ååéï¼åéåæ²è§è¯»éæ¯äºæ¥çãä¸åçæ¯ï¼StampedLock éçåéåæ²è§è¯»éå éæåä¹åï¼é½ä¼è¿åä¸ä¸ª stampï¼ç¶åè§£éçæ¶åï¼éè¦ä¼ å¥è¿ä¸ª stampã\n\n> æ³¨æè¿éï¼ç¨çæ¯âä¹è§è¯»âè¿ä¸ªè¯ï¼èä¸æ¯âä¹è§è¯»éâï¼æ¯è¦æéä½ ï¼ä¹è§è¯»è¿ä¸ªæä½æ¯æ éçï¼æä»¥ç¸æ¯è¾ ReadWriteLock çè¯»éï¼ä¹è§è¯»çæ§è½æ´å¥½ä¸äºã\n\nStampedLock çæ§è½ä¹æä»¥æ¯ ReadWriteLock è¿è¦å¥½ï¼å¶å³é®æ¯ StampedLock æ¯æä¹è§è¯»çæ¹å¼ã\n\n * ReadWriteLock æ¯æå¤ä¸ªçº¿ç¨åæ¶è¯»ï¼ä½æ¯å½å¤ä¸ªçº¿ç¨åæ¶è¯»çæ¶åï¼ææçåæä½ä¼è¢«é»å¡ï¼\n * è StampedLock æä¾çä¹è§è¯»ï¼æ¯åè®¸ä¸ä¸ªçº¿ç¨è·ååéçï¼ä¹å°±æ¯è¯´ä¸æ¯ææçåæä½é½è¢«é»å¡ã\n\nå¯¹äºè¯»å¤åå°çåºæ¯ StampedLock æ§è½å¾å¥½ï¼ç®åçåºç¨åºæ¯åºæ¬ä¸å¯ä»¥æ¿ä»£ ReadWriteLockï¼ä½æ¯StampedLock çåè½ä»ä»æ¯ ReadWriteLock çå­éï¼å¨ä½¿ç¨çæ¶åï¼è¿æ¯æå ä¸ªå°æ¹éè¦æ³¨æä¸ä¸ã\n\n * StampedLock ä¸æ¯æéå¥\n * StampedLock çæ²è§è¯»éãåéé½ä¸æ¯ææ¡ä»¶åéã\n * å¦æçº¿ç¨é»å¡å¨ StampedLock ç readLock() æè writeLock() ä¸æ¶ï¼æ­¤æ¶è°ç¨è¯¥é»å¡çº¿ç¨ç interrupt() æ¹æ³ï¼ä¼å¯¼è´ CPU é£åãä½¿ç¨ StampedLock ä¸å®ä¸è¦è°ç¨ä¸­æ­æä½ï¼å¦æéè¦æ¯æä¸­æ­åè½ï¼ä¸å®ä½¿ç¨å¯ä¸­æ­çæ²è§è¯»é readLockInterruptibly() ååé writeLockInterruptibly()ã\n\nãç¤ºä¾ãStampedLock é»å¡æ¶ï¼è°ç¨ interrupt() å¯¼è´ CPU é£å\n\nfinal StampedLock lock\n  = new StampedLock();\nThread T1 = new Thread(()->{\n  // è·ååé\n  lock.writeLock();\n  // æ°¸è¿é»å¡å¨æ­¤å¤ï¼ä¸éæ¾åé\n  LockSupport.park();\n});\nT1.start();\n// ä¿è¯ T1 è·ååé\nThread.sleep(100);\nThread T2 = new Thread(()->\n  // é»å¡å¨æ²è§è¯»é\n  lock.readLock()\n);\nT2.start();\n// ä¿è¯ T2 é»å¡å¨è¯»é\nThread.sleep(100);\n// ä¸­æ­çº¿ç¨ T2\n// ä¼å¯¼è´çº¿ç¨ T2 æå¨ CPU é£å\nT2.interrupt();\nT2.join();\n\n\nãç¤ºä¾ãStampedLock è¯»æ¨¡æ¿ï¼\n\nfinal StampedLock sl =\n  new StampedLock();\n\n// ä¹è§è¯»\nlong stamp =\n  sl.tryOptimisticRead();\n// è¯»å¥æ¹æ³å±é¨åé\n......\n// æ ¡éª stamp\nif (!sl.validate(stamp)){\n  // åçº§ä¸ºæ²è§è¯»é\n  stamp = sl.readLock();\n  try {\n    // è¯»å¥æ¹æ³å±é¨åé\n    .....\n  } finally {\n    // éæ¾æ²è§è¯»é\n    sl.unlockRead(stamp);\n  }\n}\n// ä½¿ç¨æ¹æ³å±é¨åéæ§è¡ä¸å¡æä½\n......\n\n\nãç¤ºä¾ãStampedLock åæ¨¡æ¿ï¼\n\nlong stamp = sl.writeLock();\ntry {\n  // åå±äº«åé\n  ......\n} finally {\n  sl.unlockWrite(stamp);\n}\n\n\n\n# AQS\n\n> AbstractQueuedSynchronizerï¼ç®ç§° AQSï¼æ¯éååæ­¥å¨ï¼é¡¾åæä¹ï¼å¶ä¸»è¦ä½ç¨æ¯å¤çåæ­¥ãå®æ¯å¹¶åéåå¾å¤åæ­¥å·¥å·ç±»çå®ç°åºç³ï¼å¦ ReentrantLockãReentrantReadWriteLockãCountDownLatchãSemaphoreãFutureTask ç­ï¼ã\n\n\n# AQS çè¦ç¹\n\nAQS æä¾äºå¯¹ç¬äº«éä¸å±äº«éçæ¯æã\n\nå¨ java.util.concurrent.locks åä¸­çç¸å³éï¼å¸¸ç¨çæ ReentrantLockã ReadWriteLockï¼é½æ¯åºäº AQS æ¥å®ç°ãè¿äºéé½æ²¡æç´æ¥ç»§æ¿ AQSï¼èæ¯å®ä¹äºä¸ä¸ª Sync ç±»å»ç»§æ¿ AQSãä¸ºä»ä¹è¦è¿æ ·å¢ï¼å ä¸ºéé¢åçæ¯ä½¿ç¨ç¨æ·ï¼èåæ­¥å¨é¢åçåæ¯çº¿ç¨æ§å¶ï¼é£ä¹å¨éçå®ç°ä¸­èååæ­¥å¨èä¸æ¯ç´æ¥ç»§æ¿ AQS å°±å¯ä»¥å¾å¥½çéç¦»äºèæå³æ³¨çäºæã\n\n\n# AQS çåºç¨\n\nAQS æä¾äºå¯¹ç¬äº«éä¸å±äº«éçæ¯æã\n\n# ç¬äº«é API\n\nè·åãéæ¾ç¬äº«éçä¸»è¦ API å¦ä¸ï¼\n\npublic final void acquire(int arg)\npublic final void acquireInterruptibly(int arg)\npublic final boolean tryAcquireNanos(int arg, long nanosTimeout)\npublic final boolean release(int arg)\n\n\n * acquire - è·åç¬å éã\n * acquireInterruptibly - è·åå¯ä¸­æ­çç¬å éã\n * tryAcquireNanos - å°è¯å¨æå®æ¶é´åè·åå¯ä¸­æ­çç¬å éãå¨ä»¥ä¸ä¸ç§æåµä¸åè¿åï¼\n   * å¨è¶æ¶æ¶é´åï¼å½åçº¿ç¨æåè·åäºéï¼\n   * å½åçº¿ç¨å¨è¶æ¶æ¶é´åè¢«ä¸­æ­ï¼\n   * è¶æ¶æ¶é´ç»æï¼ä»æªè·å¾éè¿å falseã\n * release - éæ¾ç¬å éã\n\n# å±äº«é API\n\nè·åãéæ¾å±äº«éçä¸»è¦ API å¦ä¸ï¼\n\npublic final void acquireShared(int arg)\npublic final void acquireSharedInterruptibly(int arg)\npublic final boolean tryAcquireSharedNanos(int arg, long nanosTimeout)\npublic final boolean releaseShared(int arg)\n\n\n * acquireShared - è·åå±äº«éã\n * acquireSharedInterruptibly - è·åå¯ä¸­æ­çå±äº«éã\n * tryAcquireSharedNanos - å°è¯å¨æå®æ¶é´åè·åå¯ä¸­æ­çå±äº«éã\n * release - éæ¾å±äº«éã\n\n\n# AQS çåç\n\n> ASQ åçè¦ç¹ï¼\n> \n>  * AQS ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤åæ­¥ç¶æãç¶æçæä¹ç±å­ç±»èµäºã\n>  * AQS ç»´æ¤äºä¸ä¸ª FIFO çåé¾è¡¨ï¼ç¨æ¥å­å¨è·åéå¤±è´¥ççº¿ç¨ã\n> \n> AQS å´ç»åæ­¥ç¶ææä¾ä¸¤ç§åºæ¬æä½âè·åâåâéæ¾âï¼å¹¶æä¾ä¸ç³»åå¤æ­åå¤çæ¹æ³ï¼ç®åè¯´å ç¹ï¼\n> \n>  * state æ¯ç¬å çï¼è¿æ¯å±äº«çï¼\n>  * state è¢«è·ååï¼å¶ä»çº¿ç¨éè¦ç­å¾ï¼\n>  * state è¢«éæ¾åï¼å¤éç­å¾çº¿ç¨ï¼\n>  * çº¿ç¨ç­ä¸åæ¶ï¼å¦ä½éåºç­å¾ã\n> \n> è³äºçº¿ç¨æ¯å¦å¯ä»¥è·å¾ stateï¼å¦ä½éæ¾ stateï¼å°±ä¸æ¯ AQS å³å¿çäºï¼è¦ç±å­ç±»å·ä½å®ç°ã\n\n# AQS çæ°æ®ç»æ\n\néè¯» AQS çæºç ï¼å¯ä»¥åç°ï¼AQS ç»§æ¿èª AbstractOwnableSynchronizeã\n\npublic abstract class AbstractQueuedSynchronizer\n    extends AbstractOwnableSynchronizer\n    implements java.io.Serializable {\n\n    /** ç­å¾éåçéå¤´ï¼æå è½½ãåªè½éè¿ setHead æ¹æ³ä¿®æ¹ã */\n    private transient volatile Node head;\n    /** ç­å¾éåçéå°¾ï¼æå è½½ãåªè½éè¿ enq æ¹æ³æ·»å æ°çç­å¾èç¹ã*/\n    private transient volatile Node tail;\n    /** åæ­¥ç¶æ */\n    private volatile int state;\n}\n\n\n * state - AQS ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤åæ­¥ç¶æã\n   * è¿ä¸ªæ´æ°ç¶æçæä¹ç±å­ç±»æ¥èµäºï¼å¦ReentrantLock ä¸­è¯¥ç¶æå¼è¡¨ç¤ºææèçº¿ç¨å·²ç»éå¤è·åè¯¥éçæ¬¡æ°ï¼Semaphore ä¸­è¯¥ç¶æå¼è¡¨ç¤ºå©ä½çè®¸å¯æ°éã\n * head å tail - AQS ç»´æ¤äºä¸ä¸ª Node ç±»åï¼AQS çåé¨ç±»ï¼çåé¾è¡¨æ¥å®æåæ­¥ç¶æçç®¡çãè¿ä¸ªåé¾è¡¨æ¯ä¸ä¸ªååç FIFO éåï¼éè¿ head å tail æéè¿è¡è®¿é®ãå½ æçº¿ç¨è·åéå¤±è´¥åï¼å°±è¢«æ·»å å°éåæ«å°¾ã\n\n\n\nåæ¥çä¸ä¸ Node çæºç \n\nstatic final class Node {\n    /** è¯¥ç­å¾åæ­¥çèç¹å¤äºå±äº«æ¨¡å¼ */\n    static final Node SHARED = new Node();\n    /** è¯¥ç­å¾åæ­¥çèç¹å¤äºç¬å æ¨¡å¼ */\n    static final Node EXCLUSIVE = null;\n\n    /** çº¿ç¨ç­å¾ç¶æï¼ç¶æå¼æ: 0ã1ã-1ã-2ã-3 */\n    volatile int waitStatus;\n    static final int CANCELLED =  1;\n    static final int SIGNAL    = -1;\n    static final int CONDITION = -2;\n    static final int PROPAGATE = -3;\n\n    /** åé©±èç¹ */\n    volatile Node prev;\n    /** åç»§èç¹ */\n    volatile Node next;\n    /** ç­å¾éççº¿ç¨ */\n    volatile Thread thread;\n\n  \t/** åèç¹æ¯å¦å±äº«æå³ */\n    Node nextWaiter;\n}\n\n\nå¾æ¾ç¶ï¼Node æ¯ä¸ä¸ªåé¾è¡¨ç»æã\n\n * waitStatus - Node ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤ AQS åæ­¥éåä¸­çº¿ç¨èç¹çç¶æãwaitStatus æäºä¸ªç¶æå¼ï¼\n   * CANCELLED(1) - æ­¤ç¶æè¡¨ç¤ºï¼è¯¥èç¹ççº¿ç¨å¯è½ç±äºè¶æ¶æè¢«ä¸­æ­è å¤äºè¢«åæ¶(ä½åº)ç¶æï¼ä¸æ¦å¤äºè¿ä¸ªç¶æï¼è¡¨ç¤ºè¿ä¸ªèç¹åºè¯¥ä»ç­å¾éåä¸­ç§»é¤ã\n   * SIGNAL(-1) - æ­¤ç¶æè¡¨ç¤ºï¼åç»§èç¹ä¼è¢«æèµ·ï¼å æ­¤å¨å½åèç¹éæ¾éæè¢«åæ¶ä¹åï¼å¿é¡»å¤é(unparking)å¶åç»§ç»ç¹ã\n   * CONDITION(-2) - æ­¤ç¶æè¡¨ç¤ºï¼è¯¥èç¹ççº¿ç¨ å¤äºç­å¾æ¡ä»¶ç¶æï¼ä¸ä¼è¢«å½ä½æ¯åæ­¥éåä¸çèç¹ï¼ç´å°è¢«å¤é(signal)ï¼è®¾ç½®å¶å¼ä¸º 0ï¼åéæ°è¿å¥é»å¡ç¶æã\n   * PROPAGATE(-3) - æ­¤ç¶æè¡¨ç¤ºï¼ä¸ä¸ä¸ª acquireShared åºæ æ¡ä»¶ä¼ æ­ã\n   * 0 - éä»¥ä¸ç¶æã\n\n# ç¬å éçè·ååéæ¾\n\n# è·åç¬å é\n\nAQS ä¸­ä½¿ç¨ acquire(int arg) æ¹æ³è·åç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·ååæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶ææåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶æä¸æåï¼AQS ä¼ä¸æ­å°è¯å©ç¨ CAS æä½å°å½åçº¿ç¨æå¥ç­å¾åæ­¥éåçéå°¾ï¼ç´å°æåä¸ºæ­¢ã\n 3. æ¥çï¼ä¸æ­å°è¯ä¸ºç­å¾éåä¸­ççº¿ç¨èç¹è·åç¬å éã\n\n\n\n\n\nè¯¦ç»æµç¨å¯ä»¥ç¨ä¸å¾æ¥è¡¨ç¤ºï¼è¯·ç»åæºç æ¥çè§£ï¼ä¸å¾èåè¨ï¼ï¼\n\n\n\n# éæ¾ç¬å é\n\nAQS ä¸­ä½¿ç¨ release(int arg) æ¹æ³éæ¾ç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·åè§£éçº¿ç¨çåæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶æä¸æåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶ææåï¼AQS ä¼å°è¯å¤éå½åçº¿ç¨èç¹çåç»§èç¹ã\n\n# è·åå¯ä¸­æ­çç¬å é\n\nAQS ä¸­ä½¿ç¨ acquireInterruptibly(int arg) æ¹æ³è·åå¯ä¸­æ­çç¬å éã\n\nacquireInterruptibly(int arg) å®ç°æ¹å¼ç¸è¾äºè·åç¬å éæ¹æ³ï¼ acquireï¼éå¸¸ç¸ä¼¼ï¼åºå«ä»å¨äºå®ä¼éè¿ Thread.interrupted æ£æµå½åçº¿ç¨æ¯å¦è¢«ä¸­æ­ï¼å¦ææ¯ï¼åç«å³æåºä¸­æ­å¼å¸¸ï¼InterruptedExceptionï¼ã\n\n# è·åè¶æ¶ç­å¾å¼çç¬å é\n\nAQS ä¸­ä½¿ç¨ tryAcquireNanos(int arg) æ¹æ³è·åè¶æ¶ç­å¾çç¬å éã\n\ndoAcquireNanos çå®ç°æ¹å¼ ç¸è¾äºè·åç¬å éæ¹æ³ï¼ acquireï¼éå¸¸ç¸ä¼¼ï¼åºå«å¨äºå®ä¼æ ¹æ®è¶æ¶æ¶é´åå½åæ¶é´è®¡ç®åºæªæ­¢æ¶é´ãå¨è·åéçæµç¨ä¸­ï¼ä¼ä¸æ­å¤æ­æ¯å¦è¶æ¶ï¼å¦æè¶æ¶ï¼ç´æ¥è¿å falseï¼å¦ææ²¡è¶æ¶ï¼åç¨ LockSupport.parkNanos æ¥é»å¡å½åçº¿ç¨ã\n\n# å±äº«éçè·ååéæ¾\n\n# è·åå±äº«é\n\nAQS ä¸­ä½¿ç¨ acquireShared(int arg) æ¹æ³è·åå±äº«éã\n\nacquireShared æ¹æ³å acquire æ¹æ³çé»è¾å¾ç¸ä¼¼ï¼åºå«ä»å¨äºèªæçæ¡ä»¶ä»¥åèç¹åºéçæä½ææä¸åã\n\næåè·å¾å±äº«éçæ¡ä»¶å¦ä¸ï¼\n\n * tryAcquireShared(arg) è¿åå¼å¤§äºç­äº 0 ï¼è¿æå³çå±äº«éç permit è¿æ²¡æç¨å®ï¼ã\n * å½åèç¹çåé©±èç¹æ¯å¤´ç»ç¹ã\n\n# éæ¾å±äº«é\n\nAQS ä¸­ä½¿ç¨ releaseShared(int arg) æ¹æ³éæ¾å±äº«éã\n\nreleaseShared é¦åä¼å°è¯éæ¾åæ­¥ç¶æï¼å¦ææåï¼åè§£éä¸ä¸ªæå¤ä¸ªåç»§çº¿ç¨èç¹ãéæ¾å±äº«éåéæ¾ç¬äº«éæµç¨å¤§ä½ç¸ä¼¼ï¼åºå«å¨äºï¼\n\nå¯¹äºç¬äº«æ¨¡å¼ï¼å¦æéè¦ SIGNALï¼éæ¾ä»ç¸å½äºè°ç¨å¤´èç¹ç unparkSuccessorã\n\n# è·åå¯ä¸­æ­çå±äº«é\n\nAQS ä¸­ä½¿ç¨ acquireSharedInterruptibly(int arg) æ¹æ³è·åå¯ä¸­æ­çå±äº«éã\n\nacquireSharedInterruptibly æ¹æ³ä¸ acquireInterruptibly å ä¹ä¸è´ï¼ä¸åèµè¿°ã\n\n# è·åè¶æ¶ç­å¾å¼çå±äº«é\n\nAQS ä¸­ä½¿ç¨ tryAcquireSharedNanos(int arg) æ¹æ³è·åè¶æ¶ç­å¾å¼çå±äº«éã\n\ntryAcquireSharedNanos æ¹æ³ä¸ tryAcquireNanos å ä¹ä¸è´ï¼ä¸åèµè¿°ã\n\n\n# æ­»é\n\n\n# ä»ä¹æ¯æ­»é\n\næ­»éæ¯ä¸ç§ç¹å®çç¨åºç¶æï¼å¨å®ä½ä¹é´ï¼ç±äºå¾ªç¯ä¾èµå¯¼è´å½¼æ­¤ä¸ç´å¤äºç­å¾ä¹ä¸­ï¼æ²¡æä»»ä½ä¸ªä½å¯ä»¥ç»§ç»­åè¿ãæ­»éä¸ä»ä»æ¯å¨çº¿ç¨ä¹é´ä¼åçï¼å­å¨èµæºç¬å çè¿ç¨ä¹é´åæ ·ä¹ å¯è½åºç°æ­»éãéå¸¸æ¥è¯´ï¼æä»¬å¤§å¤æ¯èç¦å¨å¤çº¿ç¨åºæ¯ä¸­çæ­»éï¼æä¸¤ä¸ªæå¤ä¸ªçº¿ç¨ä¹é´ï¼ç±äºäºç¸ææå¯¹æ¹éè¦çéï¼èæ°¸ä¹å¤äºé»å¡çç¶æã\n\n\n# å¦ä½å®ä½æ­»é\n\nå®ä½æ­»éæå¸¸è§çæ¹å¼å°±æ¯å©ç¨ jstack ç­å·¥å·è·åçº¿ç¨æ ï¼ç¶åå®ä½äºç¸ä¹é´çä¾èµå³ç³»ï¼è¿èæ¾å°æ­»éãå¦ææ¯æ¯è¾ææ¾çæ­»éï¼å¾å¾ jstack ç­å°±è½ç´æ¥å®ä½ï¼ç±»ä¼¼ JConsole çè³å¯ä»¥å¨å¾å½¢çé¢è¿è¡æéçæ­»éæ£æµã\n\nå¦ææä»¬æ¯å¼åèªå·±çç®¡çå·¥å·ï¼éè¦ç¨æ´å ç¨åºåçæ¹å¼æ«ææå¡è¿ç¨ãå®ä½æ­»éï¼å¯ä»¥èèä½¿ç¨ Java æä¾çæ åç®¡ç APIï¼ThreadMXBeanï¼å¶ç´æ¥å°±æä¾äº findDeadlockedThreads() æ¹æ³ç¨äºå®ä½ã\n\n\n# å¦ä½é¿åæ­»é\n\nåºæ¬ä¸æ­»éçåçæ¯å ä¸ºï¼\n\n * äºæ¥ï¼ç±»ä¼¼ Java ä¸­ Monitor é½æ¯ç¬å çã\n * é¿æä¿æäºæ¥ï¼å¨ä½¿ç¨ç»æä¹åï¼ä¸ä¼éæ¾ï¼ä¹ä¸è½è¢«å¶ä»çº¿ç¨æ¢å ã\n * å¾ªç¯ä¾èµï¼å¤ä¸ªä¸ªä½ä¹é´åºç°äºéçå¾ªç¯ä¾èµï¼å½¼æ­¤ä¾èµä¸ä¸ç¯éæ¾éã\n\nç±æ­¤ï¼æä»¬å¯ä»¥åæåºé¿åæ­»éçæè·¯åæ¹æ³ã\n\nï¼1ï¼é¿åä¸ä¸ªçº¿ç¨åæ¶è·åå¤ä¸ªéã\n\né¿åä¸ä¸ªçº¿ç¨å¨éååæ¶å ç¨å¤ä¸ªèµæºï¼å°½éä¿è¯æ¯ä¸ªéåªå ç¨ä¸ä¸ªèµæºã\n\nå°è¯ä½¿ç¨å®æ¶é lock.tryLock(timeout)ï¼é¿åéä¸ç´ä¸è½éæ¾ã\n\nå¯¹äºæ°æ®åºéï¼å éåè§£éå¿é¡»å¨ä¸ä¸ªæ°æ®åºè¿æ¥ä¸­éï¼å¦åä¼åºç°è§£éå¤±è´¥çæåµã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * Java å¹¶åç¼ç¨ï¼Lock\n * æ·±å¥å­¦ä¹  java åæ­¥å¨ AQS\n * AbstractQueuedSynchronizer æ¡æ¶\n * Java ä¸­çéåç±»',normalizedContent:'# æ·±å¥çè§£ java å¹¶åé\n\n> æ¬æåéè¿° java ä¸­åç§éçæ¦å¿µã\n> \n> ç¶åï¼ä»ç»éçæ ¸å¿å®ç° aqsã\n> \n> ç¶åï¼éç¹ä»ç» lock å condition ä¸¤ä¸ªæ¥å£åå¶å®ç°ãå¹¶åç¼ç¨æä¸¤ä¸ªæ ¸å¿é®é¢ï¼åæ­¥åäºæ¥ã\n> \n> äºæ¥ï¼å³åä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®å±äº«èµæºï¼\n> \n> åæ­¥ï¼å³çº¿ç¨ä¹é´å¦ä½éä¿¡ãåä½ã\n> \n> è¿ä¸¤å¤§é®é¢ï¼ç®¡ç¨ï¼sychronizedï¼é½æ¯è½å¤è§£å³çãj.u.c åè¿æä¾äº lock å condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨ï¼å¶ä¸­ lock ç¨äºè§£å³äºæ¥é®é¢ï¼condition ç¨äºè§£å³åæ­¥é®é¢ã\n\n\n# å¹¶åéç®ä»\n\nç¡®ä¿çº¿ç¨å®å¨æå¸¸è§çåæ³æ¯å©ç¨éæºå¶ï¼lockãsychronizedï¼æ¥å¯¹å±äº«æ°æ®åäºæ¥åæ­¥ï¼è¿æ ·å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åï¼é£ä¹æä½å¿ç¶æ¯åå­æ§çï¼çº¿ç¨å®å¨çã\n\nå¨å·¥ä½ãé¢è¯ä¸­ï¼ç»å¸¸ä¼å¬å°åç§äºè±å«é¨çéï¼å¬çäººäºéé¾éãéçæ¦å¿µæ¯è¯­å¾å¤ï¼å®ä»¬æ¯éå¯¹ä¸åçé®é¢ææåºçï¼éè¿ç®åçæ¢³çï¼ä¹ä¸é¾çè§£ã\n\n\n# å¯éå¥é\n\nå¯éå¥éï¼é¡¾åæä¹ï¼æçæ¯çº¿ç¨å¯ä»¥éå¤è·ååä¸æéãå³åä¸ä¸ªçº¿ç¨å¨å¤å±æ¹æ³è·åäºéï¼å¨è¿å¥åå±æ¹æ³ä¼èªå¨è·åéã\n\nå¯éå¥éå¯ä»¥å¨ä¸å®ç¨åº¦ä¸é¿åæ­»éã\n\n * reentrantlock ãreentrantreadwritelock æ¯å¯éå¥éãè¿ç¹ï¼ä»å¶å½åä¹ä¸é¾çåºã\n * synchronized ä¹æ¯ä¸ä¸ªå¯éå¥éã\n\nãç¤ºä¾ãsynchronized çå¯éå¥ç¤ºä¾\n\nsynchronized void seta() throws exception{\n    thread.sleep(1000);\n    setb();\n}\n\nsynchronized void setb() throws exception{\n    thread.sleep(1000);\n}\n\n\nä¸é¢çä»£ç å°±æ¯ä¸ä¸ªå¸ååºæ¯ï¼å¦æä½¿ç¨çéä¸æ¯å¯éå¥éçè¯ï¼setb å¯è½ä¸ä¼è¢«å½åçº¿ç¨æ§è¡ï¼ä»èé ææ­»éã\n\nãç¤ºä¾ãreentrantlock çå¯éå¥ç¤ºä¾\n\nclass task {\n\n    private int value;\n    private final lock lock = new reentrantlock();\n\n    public task() {\n        this.value = 0;\n    }\n\n    public int get() {\n        // è·åé\n        lock.lock();\n        try {\n            return value;\n        } finally {\n            // ä¿è¯éè½éæ¾\n            lock.unlock();\n        }\n    }\n\n    public void addone() {\n        // è·åé\n        lock.lock();\n        try {\n            // æ³¨æï¼æ­¤å¤å·²ç»æåè·åéï¼è¿å¥ get æ¹æ³åï¼åå°è¯è·åéï¼\n            // å¦æéä¸æ¯å¯éå¥çï¼ä¼å¯¼è´æ­»é\n            value = 1 + get();\n        } finally {\n            // ä¿è¯éè½éæ¾\n            lock.unlock();\n        }\n    }\n\n}\n\n\n\n# å¬å¹³éä¸éå¬å¹³é\n\n * å¬å¹³é - å¬å¹³éæ¯æ å¤çº¿ç¨æç§ç³è¯·éçé¡ºåºæ¥è·åéã\n * éå¬å¹³é - éå¬å¹³éæ¯æ å¤çº¿ç¨ä¸æç§ç³è¯·éçé¡ºåºæ¥è·åé ãè¿å°±å¯è½ä¼åºç°ä¼åçº§åè½¬ï¼åæ¥èå±ä¸ï¼æèé¥¥é¥¿ç°è±¡ï¼æçº¿ç¨æ»æ¯æ¢ä¸è¿å«ççº¿ç¨ï¼å¯¼è´å§ç»æ æ³æ§è¡ï¼ã\n\nå¬å¹³éä¸ºäºä¿è¯çº¿ç¨ç³è¯·é¡ºåºï¼å¿å¿è¦ä»åºä¸å®çæ§è½ä»£ä»·ï¼å æ­¤å¶ååéä¸è¬ä½äºéå¬å¹³éã\n\nå¬å¹³éä¸éå¬å¹³é å¨ java ä¸­çå¸åå®ç°ï¼\n\n * synchronized åªæ¯æéå¬å¹³éã\n * reentrantlock ãreentrantreadwritelockï¼é»è®¤æ¯éå¬å¹³éï¼ä½æ¯æå¬å¹³éã\n\n\n# ç¬äº«éä¸å±äº«é\n\nç¬äº«éä¸å±äº«éæ¯ä¸ç§å¹¿ä¹ä¸çè¯´æ³ï¼ä»å®éç¨éä¸æ¥çï¼ä¹å¸¸è¢«ç§°ä¸ºäºæ¥éä¸è¯»åéã\n\n * ç¬äº«é - ç¬äº«éæ¯æ éä¸æ¬¡åªè½è¢«ä¸ä¸ªçº¿ç¨æææã\n * å±äº«é - å±äº«éæ¯æ éå¯è¢«å¤ä¸ªçº¿ç¨æææã\n\nç¬äº«éä¸å±äº«éå¨ java ä¸­çå¸åå®ç°ï¼\n\n * synchronized ãreentrantlock åªæ¯æç¬äº«éã\n * reentrantreadwritelock å¶åéæ¯ç¬äº«éï¼å¶è¯»éæ¯å±äº«éãè¯»éæ¯å±äº«éä½¿å¾å¹¶åè¯»æ¯éå¸¸é«æçï¼è¯»åï¼åè¯» ï¼ååçè¿ç¨æ¯äºæ¥çã\n\n\n# æ²è§éä¸ä¹è§é\n\nä¹è§éä¸æ²è§éä¸æ¯æå·ä½çä»ä¹ç±»åçéï¼èæ¯å¤çå¹¶ååæ­¥çç­ç¥ã\n\n * æ²è§é - æ²è§éå¯¹äºå¹¶åéåæ²è§çæåº¦ï¼è®¤ä¸ºï¼ä¸å éçå¹¶åæä½ä¸å®ä¼åºé®é¢ãæ²è§ééååæä½é¢ç¹çåºæ¯ã\n * ä¹è§é - ä¹è§éå¯¹äºå¹¶åéåä¹è§çæåº¦ï¼è®¤ä¸ºï¼ä¸å éçå¹¶åæä½ä¹æ²¡ä»ä¹é®é¢ãå¯¹äºåä¸ä¸ªæ°æ®çå¹¶åæä½ï¼æ¯ä¸ä¼åçä¿®æ¹çãå¨æ´æ°æ°æ®çæ¶åï¼ä¼éç¨ä¸æ­å°è¯æ´æ°çæ¹å¼æ´æ°æ°æ®ãä¹è§ééåè¯»å¤åå°çåºæ¯ã\n\næ²è§éä¸ä¹è§éå¨ java ä¸­çå¸åå®ç°ï¼\n\n * æ²è§éå¨ java ä¸­çåºç¨å°±æ¯éè¿ä½¿ç¨ synchronized å lock æ¾ç¤ºå éæ¥è¿è¡äºæ¥åæ­¥ï¼è¿æ¯ä¸ç§é»å¡åæ­¥ã\n\n * ä¹è§éå¨ java ä¸­çåºç¨å°±æ¯éç¨ cas æºå¶ï¼cas æä½éè¿ unsafe ç±»æä¾ï¼ä½è¿ä¸ªç±»ä¸ç´æ¥æ´é²ä¸º apiï¼æä»¥é½æ¯é´æ¥ä½¿ç¨ï¼å¦åç§åå­ç±»ï¼ã\n\n\n# ååéãè½»éçº§éãééçº§é\n\næè°è½»éçº§éä¸ééçº§éï¼æçæ¯éæ§å¶ç²åº¦çç²ç»ãæ¾ç¶ï¼æ§å¶ç²åº¦è¶ç»ï¼é»å¡å¼éè¶å°ï¼å¹¶åæ§ä¹å°±è¶é«ã\n\njava 1.6 ä»¥åï¼ééçº§éä¸è¬æçæ¯ synchronized ï¼èè½»éçº§éæçæ¯ volatileã\n\njava 1.6 ä»¥åï¼éå¯¹ synchronized åäºå¤§éä¼åï¼å¼å¥ 4 ç§éç¶æï¼ æ éç¶æãååéãè½»éçº§éåééçº§éãéå¯ä»¥ååçä»ååéåçº§å°è½»éçº§éï¼åä»è½»éçº§éåçº§å°ééçº§é ã\n\n * ååé - ååéæ¯æä¸æ®µåæ­¥ä»£ç ä¸ç´è¢«ä¸ä¸ªçº¿ç¨æè®¿é®ï¼é£ä¹è¯¥çº¿ç¨ä¼èªå¨è·åéãéä½è·åéçä»£ä»·ã\n\n * è½»éçº§é - æ¯æå½éæ¯ååéçæ¶åï¼è¢«å¦ä¸ä¸ªçº¿ç¨æè®¿é®ï¼ååéå°±ä¼åçº§ä¸ºè½»éçº§éï¼å¶ä»çº¿ç¨ä¼éè¿èªæçå½¢å¼å°è¯è·åéï¼ä¸ä¼é»å¡ï¼æé«æ§è½ã\n\n * ééçº§é - æ¯æå½éä¸ºè½»éçº§éçæ¶åï¼å¦ä¸ä¸ªçº¿ç¨è½ç¶æ¯èªæï¼ä½èªæä¸ä¼ä¸ç´æç»­ä¸å»ï¼å½èªæä¸å®æ¬¡æ°çæ¶åï¼è¿æ²¡æè·åå°éï¼å°±ä¼è¿å¥é»å¡ï¼è¯¥éè¨èä¸ºééçº§éãééçº§éä¼è®©å¶ä»ç³è¯·ççº¿ç¨è¿å¥é»å¡ï¼æ§è½éä½ã\n\n\n# åæ®µé\n\nåæ®µéå¶å®æ¯ä¸ç§éçè®¾è®¡ï¼å¹¶ä¸æ¯å·ä½çä¸ç§éãæè°åæ®µéï¼å°±æ¯æéçå¯¹è±¡åæå¤æ®µï¼æ¯æ®µç¬ç«æ§å¶ï¼ä½¿å¾éç²åº¦æ´ç»ï¼åå°é»å¡å¼éï¼ä»èæé«å¹¶åæ§ãè¿å¶å®å¾å¥½çè§£ï¼å°±åé«éå¬è·¯ä¸çæ¶è´¹ç«ï¼å¦æåªæä¸ä¸ªæ¶è´¹å£ï¼é£ææçè½¦åªè½ææä¸æ¡éç¼´è´¹ï¼å¦ææå¤ä¸ªæ¶è´¹å£ï¼å°±å¯ä»¥åæµäºã\n\nhashtable ä½¿ç¨ synchronized ä¿®é¥°æ¹æ³æ¥ä¿è¯çº¿ç¨å®å¨æ§ï¼é£ä¹é¢å¯¹çº¿ç¨çè®¿é®ï¼hashtable å°±ä¼éä½æ´ä¸ªå¯¹è±¡ï¼ææçå¶å®çº¿ç¨åªè½ç­å¾ï¼è¿ç§é»å¡æ¹å¼çååéæ¾ç¶å¾ä½ã\n\njava 1.7 ä»¥åç concurrenthashmap å°±æ¯åæ®µéçå¸åæ¡ä¾ãconcurrenthashmap ç»´æ¤äºä¸ä¸ª segment æ°ç»ï¼ä¸è¬ç§°ä¸ºåæ®µæ¡¶ã\n\nfinal segment<k,v>[] segments;\n\n\nå½æçº¿ç¨è®¿é® concurrenthashmap çæ°æ®æ¶ï¼concurrenthashmap ä¼åæ ¹æ® hashcode è®¡ç®åºæ°æ®å¨åªä¸ªæ¡¶ï¼å³åªä¸ª segmentï¼ï¼ç¶åéä½è¿ä¸ª segmentã\n\n\n# æ¾ç¤ºéååç½®é\n\njava 1.5 ä¹åï¼åè°å¯¹å±äº«å¯¹è±¡çè®¿é®æ¶å¯ä»¥ä½¿ç¨çæºå¶åªæ synchronized å volatileãè¿ä¸¤ä¸ªé½å±äºåç½®éï¼å³éçç³è¯·åéæ¾é½æ¯ç± jvm ææ§å¶ã\n\njava 1.5 ä¹åï¼å¢å äºæ°çæºå¶ï¼reentrantlockãreentrantreadwritelock ï¼è¿ç±»éçç³è¯·åéæ¾é½å¯ä»¥ç±ç¨åºææ§å¶ï¼æä»¥å¸¸è¢«ç§°ä¸ºæ¾ç¤ºéã\n\n> ð¡ synchronized çç¨æ³ååçå¯ä»¥åèï¼java å¹¶ååºç¡æºå¶ - synchronized ã\n> \n> ð æ³¨æï¼å¦æä¸éè¦ reentrantlockãreentrantreadwritelock ææä¾çé«çº§åæ­¥ç¹æ§ï¼åºè¯¥ä¼åèèä½¿ç¨ synchronized ãçç±å¦ä¸ï¼\n> \n>  * java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ reentrantlockãreentrantreadwritelock åºæ¬ä¸æå¹³ã\n>  * ä»è¶å¿æ¥çï¼java æªæ¥æ´å¯è½ä¼ä¼å synchronized ï¼èä¸æ¯ reentrantlockãreentrantreadwritelock ï¼å ä¸º synchronized æ¯ jvm åç½®å±æ§ï¼å®è½æ§è¡ä¸äºä¼åã\n>  * reentrantlockãreentrantreadwritelock ç³è¯·åéæ¾éé½æ¯ç±ç¨åºæ§å¶ï¼å¦æä½¿ç¨ä¸å½ï¼å¯è½é ææ­»éï¼è¿æ¯å¾å±é©çã\n\nä»¥ä¸å¯¹æ¯ä¸ä¸æ¾ç¤ºéååç½®éçå·®å¼ï¼\n\n * ä¸»å¨è·åéåéæ¾é\n   * synchronized ä¸è½ä¸»å¨è·åéåéæ¾éãè·åéåéæ¾éé½æ¯ jvm æ§å¶çã\n   * reentrantlock å¯ä»¥ä¸»å¨è·åéåéæ¾éãï¼å¦æå¿è®°éæ¾éï¼å°±å¯è½äº§çæ­»éï¼ã\n * ååºä¸­æ­\n   * synchronized ä¸è½ååºä¸­æ­ã\n   * reentrantlock å¯ä»¥ååºä¸­æ­ã\n * è¶æ¶æºå¶\n   * synchronized æ²¡æè¶æ¶æºå¶ã\n   * reentrantlock æè¶æ¶æºå¶ãreentrantlock å¯ä»¥è®¾ç½®è¶æ¶æ¶é´ï¼è¶æ¶åèªå¨éæ¾éï¼é¿åä¸ç´ç­å¾ã\n * æ¯æå¬å¹³é\n   * synchronized åªæ¯æéå¬å¹³éã\n   * reentrantlock æ¯æéå¬å¹³éåå¬å¹³éã\n * æ¯å¦æ¯æå±äº«\n   * è¢« synchronized ä¿®é¥°çæ¹æ³æä»£ç åï¼åªè½è¢«ä¸ä¸ªçº¿ç¨è®¿é®ï¼ç¬äº«ï¼ãå¦æè¿ä¸ªçº¿ç¨è¢«é»å¡ï¼å¶ä»çº¿ç¨ä¹åªè½ç­å¾\n   * reentrantlock å¯ä»¥åºäº condition çµæ´»çæ§å¶åæ­¥æ¡ä»¶ã\n * æ¯å¦æ¯æè¯»ååç¦»\n   * synchronized ä¸æ¯æè¯»åéåç¦»ï¼\n   * reentrantreadwritelock æ¯æè¯»åéï¼ä»èä½¿é»å¡è¯»åçæä½åå¼ï¼æææé«å¹¶åæ§ã\n\n\n# lock å condition\n\n\n# ä¸ºä½å¼å¥ lock å condition\n\nå¹¶åç¼ç¨é¢åï¼æä¸¤å¤§æ ¸å¿é®é¢ï¼ä¸ä¸ªæ¯äºæ¥ï¼å³åä¸æ¶å»åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®å±äº«èµæºï¼å¦ä¸ä¸ªæ¯åæ­¥ï¼å³çº¿ç¨ä¹é´å¦ä½éä¿¡ãåä½ãè¿ä¸¤å¤§é®é¢ï¼ç®¡ç¨é½æ¯è½å¤è§£å³çãjava sdk å¹¶ååéè¿ lock å condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨ï¼å¶ä¸­ lock ç¨äºè§£å³äºæ¥é®é¢ï¼condition ç¨äºè§£å³åæ­¥é®é¢ã\n\nsynchronized æ¯ç®¡ç¨çä¸ç§å®ç°ï¼æ¢ç¶å¦æ­¤ï¼ä½å¿åæä¾ lock å conditionã\n\njdk 1.6 ä»¥åï¼synchronized è¿æ²¡æåä¼åï¼æ§è½è¿ä½äº lockãä½æ¯ï¼æ§è½ä¸æ¯å¼å¥ lock çæéè¦å ç´ ãçæ­£å³é®å¨äºï¼synchronized ä½¿ç¨ä¸å½ï¼å¯è½ä¼åºç°æ­»éã\n\nsynchronized æ æ³éè¿ç ´åä¸å¯æ¢å æ¡ä»¶æ¥é¿åæ­»éãåå æ¯ synchronized ç³è¯·èµæºçæ¶åï¼å¦æç³è¯·ä¸å°ï¼çº¿ç¨ç´æ¥è¿å¥é»å¡ç¶æäºï¼èçº¿ç¨è¿å¥é»å¡ç¶æï¼å¥é½å¹²ä¸äºï¼ä¹éæ¾ä¸äºçº¿ç¨å·²ç»å æçèµæºã\n\nä¸åç½®é synchronized ä¸åçæ¯ï¼lock æä¾äºä¸ç»æ æ¡ä»¶çãå¯è½®è¯¢çãå®æ¶çä»¥åå¯ä¸­æ­çéæä½ï¼ææè·åéãéæ¾éçæä½é½æ¯æ¾å¼çæä½ã\n\n * è½å¤ååºä¸­æ­ãsynchronized çé®é¢æ¯ï¼ææé a åï¼å¦æå°è¯è·åé b å¤±è´¥ï¼é£ä¹çº¿ç¨å°±è¿å¥é»å¡ç¶æï¼ä¸æ¦åçæ­»éï¼å°±æ²¡æä»»ä½æºä¼æ¥å¤éé»å¡ççº¿ç¨ãä½å¦æé»å¡ç¶æççº¿ç¨è½å¤ååºä¸­æ­ä¿¡å·ï¼ä¹å°±æ¯è¯´å½æä»¬ç»é»å¡ççº¿ç¨åéä¸­æ­ä¿¡å·çæ¶åï¼è½å¤å¤éå®ï¼é£å®å°±ææºä¼éæ¾æ¾ç»ææçé aãè¿æ ·å°±ç ´åäºä¸å¯æ¢å æ¡ä»¶äºã\n * æ¯æè¶æ¶ãå¦æçº¿ç¨å¨ä¸æ®µæ¶é´ä¹åæ²¡æè·åå°éï¼ä¸æ¯è¿å¥é»å¡ç¶æï¼èæ¯è¿åä¸ä¸ªéè¯¯ï¼é£è¿ä¸ªçº¿ç¨ä¹ææºä¼éæ¾æ¾ç»ææçéãè¿æ ·ä¹è½ç ´åä¸å¯æ¢å æ¡ä»¶ã\n * éé»å¡å°è·åéãå¦æå°è¯è·åéå¤±è´¥ï¼å¹¶ä¸è¿å¥é»å¡ç¶æï¼èæ¯ç´æ¥è¿åï¼é£è¿ä¸ªçº¿ç¨ä¹ææºä¼éæ¾æ¾ç»ææçéãè¿æ ·ä¹è½ç ´åä¸å¯æ¢å æ¡ä»¶ã\n\n\n# lock æ¥å£\n\nlock çæ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface lock {\n    void lock();\n    void lockinterruptibly() throws interruptedexception;\n    boolean trylock();\n    boolean trylock(long time, timeunit unit) throws interruptedexception;\n    void unlock();\n    condition newcondition();\n}\n\n\n * lock() - è·åéã\n * unlock() - éæ¾éã\n * trylock() - å°è¯è·åéï¼ä»å¨è°ç¨æ¶éæªè¢«å¦ä¸ä¸ªçº¿ç¨ææçæåµä¸ï¼æè·åè¯¥éã\n * trylock(long time, timeunit unit) - å trylock() ç±»ä¼¼ï¼åºå«ä»å¨äºéå®æ¶é´ï¼å¦æéå®æ¶é´åæªè·åå°éï¼è§ä¸ºå¤±è´¥ã\n * lockinterruptibly() - éæªè¢«å¦ä¸ä¸ªçº¿ç¨ææï¼ä¸çº¿ç¨æ²¡æè¢«ä¸­æ­çæåµä¸ï¼æè½è·åéã\n * newcondition() - è¿åä¸ä¸ªç»å®å° lock å¯¹è±¡ä¸ç condition å®ä¾ã\n\n\n# condition\n\ncondition å®ç°äºç®¡ç¨æ¨¡åéé¢çæ¡ä»¶åéã\n\nåæä¸­æè¿ lock æ¥å£ä¸­ æä¸ä¸ª newcondition() æ¹æ³ç¨äºè¿åä¸ä¸ªç»å®å° lock å¯¹è±¡ä¸ç condition å®ä¾ãcondition æ¯ä»ä¹ï¼æä»ä¹ä½ç¨ï¼æ¬èå°ä¸ä¸è®²è§£ã\n\nå¨åçº¿ç¨ä¸­ï¼ä¸æ®µä»£ç çæ§è¡å¯è½ä¾èµäºæä¸ªç¶æï¼å¦æä¸æ»¡è¶³ç¶ææ¡ä»¶ï¼ä»£ç å°±ä¸ä¼è¢«æ§è¡ï¼å¸åçåºæ¯ï¼å¦ï¼if ... else ...ï¼ãå¨å¹¶åç¯å¢ä¸­ï¼å½ä¸ä¸ªçº¿ç¨å¤æ­æä¸ªç¶ææ¡ä»¶æ¶ï¼å¶ç¶æå¯è½æ¯ç±äºå¶ä»çº¿ç¨çæä½èæ¹åï¼è¿æ¶å°±éè¦æä¸å®çåè°æºå¶æ¥ç¡®ä¿å¨åä¸æ¶å»ï¼æ°æ®åªè½è¢«ä¸ä¸ªçº¿ç¨éä¿®æ¹ï¼ä¸ä¿®æ¹çæ°æ®ç¶æè¢«ææçº¿ç¨ææç¥ã\n\njava 1.5 ä¹åï¼ä¸»è¦æ¯å©ç¨ object ç±»ä¸­ç waitãnotifyãnotifyall éå synchronized æ¥è¿è¡çº¿ç¨é´éä¿¡ï¼å¦æä¸äºè§£å¶ç¹æ§ï¼å¯ä»¥åèï¼java çº¿ç¨åºç¡ - wait/notify/notifyallï¼ã\n\nwaitãnotifyãnotifyall éè¦éå synchronized ä½¿ç¨ï¼ä¸éç¨äº lockãèä½¿ç¨ lock ççº¿ç¨ï¼å½¼æ­¤é´éä¿¡åºè¯¥ä½¿ç¨ condition ãè¿å¯ä»¥çè§£ä¸ºï¼ä»ä¹æ ·çééä»ä¹æ ·çé¥åãåç½®éï¼synchronizedï¼éååç½®æ¡ä»¶éåï¼waitãnotifyãnotifyall ï¼ï¼æ¾å¼éï¼lockï¼éåæ¾å¼æ¡ä»¶éåï¼condition ï¼ã\n\n# condition çç¹æ§\n\ncondition æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface condition {\n    void await() throws interruptedexception;\n    void awaituninterruptibly();\n    long awaitnanos(long nanostimeout) throws interruptedexception;\n    boolean await(long time, timeunit unit) throws interruptedexception;\n    boolean awaituntil(date deadline) throws interruptedexception;\n    void signal();\n    void signalall();\n}\n\n\nå¶ä¸­ï¼awaitãsignalãsignalall ä¸ waitãnotifyãnotifyall ç¸å¯¹åºï¼åè½ä¹ç¸ä¼¼ãé¤æ­¤ä»¥å¤ï¼condition ç¸æ¯åç½®æ¡ä»¶éåï¼ waitãnotifyãnotifyall ï¼ï¼æä¾äºæ´ä¸ºä¸°å¯çåè½ï¼\n\n * æ¯ä¸ªéï¼lockï¼ä¸å¯ä»¥å­å¨å¤ä¸ª conditionï¼è¿æå³çéçç¶ææ¡ä»¶å¯ä»¥æå¤ä¸ªã\n * æ¯æå¬å¹³çæéå¬å¹³çéåæä½ã\n * æ¯æå¯ä¸­æ­çæ¡ä»¶ç­å¾ï¼ç¸å³æ¹æ³ï¼awaituninterruptibly() ã\n * æ¯æå¯å®æ¶çç­å¾ï¼ç¸å³æ¹æ³ï¼awaitnanos(long) ãawait(long, timeunit)ãawaituntil(date)ã\n\n# condition çç¨æ³\n\nè¿éä»¥ condition æ¥å®ç°ä¸ä¸ªæ¶è´¹èãçäº§èæ¨¡å¼ã\n\n> ð æ³¨æï¼äºå®ä¸ï¼è§£å³æ­¤ç±»é®é¢ä½¿ç¨ countdownlatchãsemaphore ç­å·¥å·æ´ä¸ºä¾¿æ·ãå®å¨ãæ³äºè§£è¯¦æï¼å¯ä»¥åè java å¹¶åå·¥å·ç±» ã\n\näº§åç±»\n\nclass message {\n\n    private final lock lock = new reentrantlock();\n\n    private final condition producedmsg = lock.newcondition();\n\n    private final condition consumedmsg = lock.newcondition();\n\n    private string message;\n\n    private boolean state;\n\n    private boolean end;\n\n    public void consume() {\n        //lock\n        lock.lock();\n        try {\n            // no new message wait for new message\n            while (!state) { producedmsg.await(); }\n\n            system.out.println("consume message : " + message);\n            state = false;\n            // message consumed, notify waiting thread\n            consumedmsg.signal();\n        } catch (interruptedexception ie) {\n            system.out.println("thread interrupted - viewmessage");\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void produce(string message) {\n        lock.lock();\n        try {\n            // last message not consumed, wait for it be consumed\n            while (state) { consumedmsg.await(); }\n\n            system.out.println("produce msg: " + message);\n            this.message = message;\n            state = true;\n            // new message added, notify waiting thread\n            producedmsg.signal();\n        } catch (interruptedexception ie) {\n            system.out.println("thread interrupted - publishmessage");\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public boolean isend() {\n        return end;\n    }\n\n    public void setend(boolean end) {\n        this.end = end;\n    }\n\n}\n\n\næ¶è´¹è\n\nclass messageconsumer implements runnable {\n\n    private message message;\n\n    public messageconsumer(message msg) {\n        message = msg;\n    }\n\n    @override\n    public void run() {\n        while (!message.isend()) { message.consume(); }\n    }\n\n}\n\n\nçäº§è\n\nclass messageproducer implements runnable {\n\n    private message message;\n\n    public messageproducer(message msg) {\n        message = msg;\n    }\n\n    @override\n    public void run() {\n        produce();\n    }\n\n    public void produce() {\n        list<string> msgs = new arraylist<>();\n        msgs.add("begin");\n        msgs.add("msg1");\n        msgs.add("msg2");\n\n        for (string msg : msgs) {\n            message.produce(msg);\n            try {\n                thread.sleep(100);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n        }\n\n        message.produce("end");\n        message.setend(true);\n    }\n\n}\n\n\næµè¯\n\npublic class lockconditiondemo {\n\n    public static void main(string[] args) {\n        message msg = new message();\n        thread producer = new thread(new messageproducer(msg));\n        thread consumer = new thread(new messageconsumer(msg));\n        producer.start();\n        consumer.start();\n    }\n}\n\n\n\n# reentrantlock\n\nreentrantlock ç±»æ¯ lock æ¥å£çå·ä½å®ç°ï¼ä¸åç½®é synchronized ç¸åçæ¯ï¼å®æ¯ä¸ä¸ªå¯éå¥éã\n\n\n# reentrantlock çç¹æ§\n\nreentrantlock çç¹æ§å¦ä¸ï¼\n\n * reentrantlock æä¾äºä¸ synchronized ç¸åçäºæ¥æ§ãåå­å¯è§æ§åå¯éå¥æ§ã\n * reentrantlock æ¯æå¬å¹³éåéå¬å¹³éï¼é»è®¤ï¼ä¸¤ç§æ¨¡å¼ã\n * reentrantlock å®ç°äº lock æ¥å£ï¼æ¯æäº synchronized æä¸å·å¤ççµæ´»æ§ã\n   * synchronized æ æ³ä¸­æ­ä¸ä¸ªæ­£å¨ç­å¾è·åéççº¿ç¨\n   * synchronized æ æ³å¨è¯·æ±è·åä¸ä¸ªéæ¶æ ä¼æ­¢å°ç­å¾\n\n\n# reentrantlock çç¨æ³\n\nåæäºè§£äº reentrantlock çç¹æ§ï¼æ¥ä¸æ¥ï¼æä»¬è¦è®²è¿°å¶å·ä½ç¨æ³ã\n\n# reentrantlock çæé æ¹æ³\n\nreentrantlock æä¸¤ä¸ªæé æ¹æ³ï¼\n\npublic reentrantlock() {}\npublic reentrantlock(boolean fair) {}\n\n\n * reentrantlock() - é»è®¤æé æ¹æ³ä¼åå§åä¸ä¸ªéå¬å¹³éï¼nonfairsyncï¼ï¼\n * reentrantlock(boolean) - new reentrantlock(true) ä¼åå§åä¸ä¸ªå¬å¹³éï¼fairsyncï¼ã\n\n# lock å unlock æ¹æ³\n\n * lock() - æ æ¡ä»¶è·åéãå¦æå½åçº¿ç¨æ æ³è·åéï¼åå½åçº¿ç¨è¿å¥ä¼ç ç¶æä¸å¯ç¨ï¼ç´è³å½åçº¿ç¨è·åå°éãå¦æè¯¥éæ²¡æè¢«å¦ä¸ä¸ªçº¿ç¨ææï¼åè·åè¯¥éå¹¶ç«å³è¿åï¼å°éçææè®¡æ°è®¾ç½®ä¸º 1ã\n * unlock() - ç¨äºéæ¾éã\n\n> ð æ³¨æï¼è¯·å¡å¿ç¢è®°ï¼è·åéæä½ lock() å¿é¡»å¨ try catch åä¸­è¿è¡ï¼å¹¶ä¸å°éæ¾éæä½ unlock() æ¾å¨ finally åä¸­è¿è¡ï¼ä»¥ä¿è¯éä¸å®è¢«è¢«éæ¾ï¼é²æ­¢æ­»éçåçã\n\nç¤ºä¾ï¼reentrantlock çåºæ¬æä½\n\npublic class reentrantlockdemo {\n\n    public static void main(string[] args) {\n        task task = new task();\n        mythread ta = new mythread("thread-a", task);\n        mythread tb = new mythread("thread-b", task);\n        mythread tc = new mythread("thread-c", task);\n        ta.start();\n        tb.start();\n        tc.start();\n    }\n\n    static class mythread extends thread {\n\n        private task task;\n\n        public mythread(string name, task task) {\n            super(name);\n            this.task = task;\n        }\n\n        @override\n        public void run() {\n            task.execute();\n        }\n\n    }\n\n    static class task {\n\n        private reentrantlock lock = new reentrantlock();\n\n        public void execute() {\n            lock.lock();\n            try {\n                for (int i = 0; i < 3; i++) {\n                    system.out.println(lock.tostring());\n\n                    // æ¥è¯¢å½åçº¿ç¨ hold ä½æ­¤éçæ¬¡æ°\n                    system.out.println("\\t holdcount: " + lock.getholdcount());\n\n                    // æ¥è¯¢æ­£ç­å¾è·åæ­¤éççº¿ç¨æ°\n                    system.out.println("\\t queuedlength: " + lock.getqueuelength());\n\n                    // æ¯å¦ä¸ºå¬å¹³é\n                    system.out.println("\\t isfair: " + lock.isfair());\n\n                    // æ¯å¦è¢«éä½\n                    system.out.println("\\t islocked: " + lock.islocked());\n\n                    // æ¯å¦è¢«å½åçº¿ç¨ææé\n                    system.out.println("\\t isheldbycurrentthread: " + lock.isheldbycurrentthread());\n\n                    try {\n                        thread.sleep(500);\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                }\n            } finally {\n                lock.unlock();\n            }\n        }\n\n    }\n\n}\n\n\nè¾åºç»æï¼\n\njava.util.concurrent.locks.reentrantlock@64fcd88a[locked by thread thread-a]\n\t holdcount: 1\n\t queuedlength: 2\n\t isfair: false\n\t islocked: true\n\t isheldbycurrentthread: true\njava.util.concurrent.locks.reentrantlock@64fcd88a[locked by thread thread-c]\n\t holdcount: 1\n\t queuedlength: 1\n\t isfair: false\n\t islocked: true\n\t isheldbycurrentthread: true\n// ...\n\n\n# trylock æ¹æ³\n\nä¸æ æ¡ä»¶è·åéç¸æ¯ï¼trylock ææ´å®åçå®¹éæºå¶ã\n\n * trylock() - å¯è½®è¯¢è·åéãå¦ææåï¼åè¿å trueï¼å¦æå¤±è´¥ï¼åè¿å falseãä¹å°±æ¯è¯´ï¼è¿ä¸ªæ¹æ³æ è®ºæè´¥é½ä¼ç«å³è¿åï¼è·åä¸å°éï¼éå·²è¢«å¶ä»çº¿ç¨è·åï¼æ¶ä¸ä¼ä¸ç´ç­å¾ã\n * trylock(long, timeunit) - å¯å®æ¶è·åéãå trylock() ç±»ä¼¼ï¼åºå«ä»å¨äºè¿ä¸ªæ¹æ³å¨è·åä¸å°éæ¶ä¼ç­å¾ä¸å®çæ¶é´ï¼å¨æ¶é´æéä¹åå¦æè¿è·åä¸å°éï¼å°±è¿å falseãå¦æå¦æä¸å¼å§æ¿å°éæèå¨ç­å¾æé´åæ¿å°äºéï¼åè¿å trueã\n\nç¤ºä¾ï¼reentrantlock ç trylock() æä½\n\nä¿®æ¹ä¸ä¸ªç¤ºä¾ä¸­ç execute() æ¹æ³\n\npublic void execute() {\n    if (lock.trylock()) {\n        try {\n            for (int i = 0; i < 3; i++) {\n               // ç¥...\n            }\n        } finally {\n            lock.unlock();\n        }\n    } else {\n        system.out.println(thread.currentthread().getname() + " è·åéå¤±è´¥");\n    }\n}\n\n\nç¤ºä¾ï¼reentrantlock ç trylock(long, timeunit) æä½\n\nä¿®æ¹ä¸ä¸ªç¤ºä¾ä¸­ç execute() æ¹æ³\n\npublic void execute() {\n    try {\n        if (lock.trylock(2, timeunit.seconds)) {\n            try {\n                for (int i = 0; i < 3; i++) {\n                    // ç¥...\n                }\n            } finally {\n                lock.unlock();\n            }\n        } else {\n            system.out.println(thread.currentthread().getname() + " è·åéå¤±è´¥");\n        }\n    } catch (interruptedexception e) {\n        system.out.println(thread.currentthread().getname() + " è·åéè¶æ¶");\n        e.printstacktrace();\n    }\n}\n\n\n# lockinterruptibly æ¹æ³\n\n * lockinterruptibly() - å¯ä¸­æ­è·åéãå¯ä¸­æ­è·åéå¯ä»¥å¨è·å¾éçåæ¶ä¿æå¯¹ä¸­æ­çååºãå¯ä¸­æ­è·åéæ¯å¶å®è·åéçæ¹å¼ç¨å¾®å¤æä¸äºï¼éè¦ä¸¤ä¸ª try-catch åï¼å¦æå¨è·åéçæä½ä¸­æåºäº interruptedexception ï¼é£ä¹å¯ä»¥ä½¿ç¨æ åç try-finally å éæ¨¡å¼ï¼ã\n   * ä¸¾ä¾æ¥è¯´ï¼åè®¾æä¸¤ä¸ªçº¿ç¨åæ¶éè¿ lock.lockinterruptibly() è·åæä¸ªéæ¶ï¼è¥çº¿ç¨ a è·åå°äºéï¼åçº¿ç¨ b åªè½ç­å¾ãè¥æ­¤æ¶å¯¹çº¿ç¨ b è°ç¨ threadb.interrupt() æ¹æ³è½å¤ä¸­æ­çº¿ç¨ b çç­å¾è¿ç¨ãç±äº lockinterruptibly() çå£°æä¸­æåºäºå¼å¸¸ï¼æä»¥ lock.lockinterruptibly() å¿é¡»æ¾å¨ try åä¸­æèå¨è°ç¨ lockinterruptibly() çæ¹æ³å¤å£°ææåº interruptedexceptionã\n\n> ð æ³¨æï¼å½ä¸ä¸ªçº¿ç¨è·åäºéä¹åï¼æ¯ä¸ä¼è¢« interrupt() æ¹æ³ä¸­æ­çãåç¬è°ç¨ interrupt() æ¹æ³ä¸è½ä¸­æ­æ­£å¨è¿è¡ç¶æä¸­ççº¿ç¨ï¼åªè½ä¸­æ­é»å¡ç¶æä¸­ççº¿ç¨ãå æ­¤å½éè¿ lockinterruptibly() æ¹æ³è·åæä¸ªéæ¶ï¼å¦ææªè·åå°éï¼åªæå¨ç­å¾çç¶æä¸ï¼æå¯ä»¥ååºä¸­æ­ã\n\nç¤ºä¾ï¼reentrantlock ç lockinterruptibly() æä½\n\nä¿®æ¹ä¸ä¸ªç¤ºä¾ä¸­ç execute() æ¹æ³\n\npublic void execute() {\n    try {\n        lock.lockinterruptibly();\n\n        for (int i = 0; i < 3; i++) {\n            // ç¥...\n        }\n    } catch (interruptedexception e) {\n        system.out.println(thread.currentthread().getname() + "è¢«ä¸­æ­");\n        e.printstacktrace();\n    } finally {\n        lock.unlock();\n    }\n}\n\n\n# newcondition æ¹æ³\n\nnewcondition() - è¿åä¸ä¸ªç»å®å° lock å¯¹è±¡ä¸ç condition å®ä¾ãcondition çç¹æ§åå·ä½æ¹æ³è¯·éè¯»ä¸æ conditionã\n\n\n# reentrantlock çåç\n\n# reentrantlock çå¯è§æ§\n\nclass x {\n  private final lock rtl =\n  new reentrantlock();\n  int value;\n  public void addone() {\n    // è·åé\n    rtl.lock();\n    try {\n      value+=1;\n    } finally {\n      // ä¿è¯éè½éæ¾\n      rtl.unlock();\n    }\n  }\n}\n\n\nreentrantlockï¼åé¨ææä¸ä¸ª volatile çæååé stateï¼è·åéçæ¶åï¼ä¼è¯»å state çå¼ï¼è§£éçæ¶åï¼ä¹ä¼è¯»å state çå¼ï¼ç®ååçä»£ç å¦ä¸é¢æç¤ºï¼ãä¹å°±æ¯è¯´ï¼å¨æ§è¡ value+=1 ä¹åï¼ç¨åºåè¯»åäºä¸æ¬¡ volatile åé stateï¼å¨æ§è¡ value+=1 ä¹åï¼åè¯»åäºä¸æ¬¡ volatile åé stateãæ ¹æ®ç¸å³ç happens-before è§åï¼\n\n 1. é¡ºåºæ§è§åï¼å¯¹äºçº¿ç¨ t1ï¼value+=1 happens-before éæ¾éçæä½ unlock()ï¼\n 2. volatile åéè§åï¼ç±äº state = 1 ä¼åè¯»å stateï¼æä»¥çº¿ç¨ t1 ç unlock() æä½ happens-before çº¿ç¨ t2 ç lock() æä½ï¼\n 3. ä¼ éæ§è§åï¼çº¿ç¨ t1 ç value+=1 happens-before çº¿ç¨ t2 ç lock() æä½ã\n\n# reentrantlock çæ°æ®ç»æ\n\néè¯» reentrantlock çæºç ï¼å¯ä»¥åç°å®æä¸ä¸ªæ ¸å¿å­æ®µï¼\n\nprivate final sync sync;\n\n\n * sync - åé¨æ½è±¡ç±» reentrantlock.sync å¯¹è±¡ï¼sync ç»§æ¿èª aqsãå®æä¸¤ä¸ªå­ç±»ï¼\n * reentrantlock.fairsync - å¬å¹³éã\n * reentrantlock.nonfairsync - éå¬å¹³éã\n\næ¥çæºç å¯ä»¥åç°ï¼reentrantlock å®ç° lock æ¥å£å¶å®æ¯è°ç¨ reentrantlock.fairsync æ reentrantlock.nonfairsync ä¸­åèªçå®ç°ï¼è¿éä¸ä¸ä¸åä¸¾ã\n\n# reentrantlock çè·åéåéæ¾é\n\nreentrantlock è·åéåéæ¾éçæ¥å£ï¼ä»è¡¨è±¡çï¼æ¯è°ç¨ reentrantlock.fairsync æ reentrantlock.nonfairsync ä¸­åèªçå®ç°ï¼ä»æ¬è´¨ä¸çï¼æ¯åºäº aqs çå®ç°ã\n\nä»ç»éè¯»æºç å¾å®¹æåç°ï¼\n\n * void lock() è°ç¨ sync ç lock() æ¹æ³ã\n\n * void lockinterruptibly() ç´æ¥è°ç¨ aqs ç è·åå¯ä¸­æ­çç¬å é æ¹æ³ lockinterruptibly()ã\n\n * boolean trylock() è°ç¨ sync ç nonfairtryacquire() ã\n\n * boolean trylock(long time, timeunit unit) ç´æ¥è°ç¨ aqs ç è·åè¶æ¶ç­å¾å¼çç¬å é æ¹æ³ tryacquirenanos(int arg, long nanostimeout)ã\n\n * void unlock() ç´æ¥è°ç¨ aqs ç éæ¾ç¬å é æ¹æ³ release(int arg) ã\n\nç´æ¥è°ç¨ aqs æ¥å£çæ¹æ³å°±ä¸åèµè¿°äºï¼å¶åçå¨ [aqs çåç](#aqs çåç) ä¸­å·²ç»ç¨å¾å¤§ç¯å¹è¿è¡è¿è®²è§£ã\n\nnonfairtryacquire æ¹æ³æºç å¦ä¸ï¼\n\n// å¬å¹³éåéå¬å¹³éé½ä¼ç¨è¿ä¸ªæ¹æ³åºå°è¯è·åé\nfinal boolean nonfairtryacquire(int acquires) {\n    final thread current = thread.currentthread();\n    int c = getstate();\n    if (c == 0) {\n        if (compareandsetstate(0, acquires)) {\n         // å¦æåæ­¥ç¶æä¸º0ï¼å°å¶è®¾ä¸º acquiresï¼å¹¶è®¾ç½®å½åçº¿ç¨ä¸ºæå®çº¿ç¨\n            setexclusiveownerthread(current);\n            return true;\n        }\n    }\n    else if (current == getexclusiveownerthread()) {\n        int nextc = c + acquires;\n        if (nextc < 0) // overflow\n            throw new error("maximum lock count exceeded");\n        setstate(nextc);\n        return true;\n    }\n    return false;\n}\n\n\nå¤çæµç¨å¾ç®åï¼\n\n * å¦æåæ­¥ç¶æä¸º 0ï¼è®¾ç½®åæ­¥ç¶æè®¾ä¸º acquiresï¼å¹¶è®¾ç½®å½åçº¿ç¨ä¸ºæå®çº¿ç¨ï¼ç¶åè¿å trueï¼è·åéæåã\n * å¦æåæ­¥ç¶æä¸ä¸º 0 ä¸å½åçº¿ç¨ä¸ºæå®çº¿ç¨ï¼è®¾ç½®åæ­¥ç¶æä¸ºå½åç¶æå¼+acquires å¼ï¼ç¶åè¿å trueï¼è·åéæåã\n * å¦åï¼è¿å falseï¼è·åéå¤±è´¥ã\n\n# å¬å¹³éåéå¬å¹³é\n\nreentrantlock è¿ä¸ªç±»æä¸¤ä¸ªæé å½æ°ï¼ä¸ä¸ªæ¯æ åæé å½æ°ï¼ä¸ä¸ªæ¯ä¼ å¥ fair åæ°çæé å½æ°ãfair åæ°ä»£è¡¨çæ¯éçå¬å¹³ç­ç¥ï¼å¦æä¼ å¥ true å°±è¡¨ç¤ºéè¦æé ä¸ä¸ªå¬å¹³éï¼åä¹åè¡¨ç¤ºè¦æé ä¸ä¸ªéå¬å¹³éã\n\néé½å¯¹åºçä¸ä¸ªç­å¾éåï¼å¦æä¸ä¸ªçº¿ç¨æ²¡æè·å¾éï¼å°±ä¼è¿å¥ç­å¾éåï¼å½æçº¿ç¨éæ¾éçæ¶åï¼å°±éè¦ä»ç­å¾éåä¸­å¤éä¸ä¸ªç­å¾ççº¿ç¨ãå¦ææ¯å¬å¹³éï¼å¤éçç­ç¥å°±æ¯è°ç­å¾çæ¶é´é¿ï¼å°±å¤éè°ï¼å¾å¬å¹³ï¼å¦ææ¯éå¬å¹³éï¼åä¸æä¾è¿ä¸ªå¬å¹³ä¿è¯ï¼æå¯è½ç­å¾æ¶é´ç­ççº¿ç¨åèåè¢«å¤éã\n\nlock æ¹æ³å¨å¬å¹³éåéå¬å¹³éä¸­çå®ç°ï¼\n\näºèçåºå«ä»å¨äºç³è¯·éå¬å¹³éæ¶ï¼å¦æåæ­¥ç¶æä¸º 0ï¼å°è¯å°å¶è®¾ä¸º 1ï¼å¦ææåï¼ç´æ¥å°å½åçº¿ç¨ç½®ä¸ºæå®çº¿ç¨ï¼å¦ååå¬å¹³éä¸æ ·ï¼è°ç¨ aqs è·åç¬å éæ¹æ³ acquireã\n\n// éå¬å¹³éå®ç°\nfinal void lock() {\n    if (compareandsetstate(0, 1))\n    // å¦æåæ­¥ç¶æä¸º0ï¼å°å¶è®¾ä¸º1ï¼å¹¶è®¾ç½®å½åçº¿ç¨ä¸ºæå®çº¿ç¨\n        setexclusiveownerthread(thread.currentthread());\n    else\n    // è°ç¨ aqs è·åç¬å éæ¹æ³ acquire\n        acquire(1);\n}\n\n// å¬å¹³éå®ç°\nfinal void lock() {\n    // è°ç¨ aqs è·åç¬å éæ¹æ³ acquire\n    acquire(1);\n}\n\n\n\n# reentrantreadwritelock\n\nreadwritelock éç¨äºè¯»å¤åå°çåºæ¯ã\n\nreentrantreadwritelock ç±»æ¯ readwritelock æ¥å£çå·ä½å®ç°ï¼å®æ¯ä¸ä¸ªå¯éå¥çè¯»åéãreentrantreadwritelock ç»´æ¤äºä¸å¯¹è¯»åéï¼å°è¯»åéåå¼ï¼æå©äºæé«å¹¶åæçã\n\nè¯»åéï¼å¹¶ä¸æ¯ java è¯­è¨ç¹æçï¼èæ¯ä¸ä¸ªå¹¿ä¸ºä½¿ç¨çéç¨ææ¯ï¼ææçè¯»åéé½éµå®ä»¥ä¸ä¸æ¡åºæ¬ååï¼\n\n * åè®¸å¤ä¸ªçº¿ç¨åæ¶è¯»å±äº«åéï¼\n * åªåè®¸ä¸ä¸ªçº¿ç¨åå±äº«åéï¼\n * å¦æä¸ä¸ªåçº¿ç¨æ­£å¨æ§è¡åæä½ï¼æ­¤æ¶ç¦æ­¢è¯»çº¿ç¨è¯»å±äº«åéã\n\nè¯»åéä¸äºæ¥éçä¸ä¸ªéè¦åºå«å°±æ¯è¯»åéåè®¸å¤ä¸ªçº¿ç¨åæ¶è¯»å±äº«åéï¼èäºæ¥éæ¯ä¸åè®¸çï¼è¿æ¯è¯»åéå¨è¯»å¤åå°åºæ¯ä¸æ§è½ä¼äºäºæ¥éçå³é®ãä½è¯»åéçåæä½æ¯äºæ¥çï¼å½ä¸ä¸ªçº¿ç¨å¨åå±äº«åéçæ¶åï¼æ¯ä¸åè®¸å¶ä»çº¿ç¨æ§è¡åæä½åè¯»æä½ã\n\n\n# reentrantreadwritelock çç¹æ§\n\nreentrantreadwritelock çç¹æ§å¦ä¸ï¼\n\n * reentrantreadwritelock éç¨äºè¯»å¤åå°çåºæ¯ãå¦ææ¯åå¤è¯»å°çåºæ¯ï¼ç±äº reentrantreadwritelock å¶åé¨å®ç°æ¯ reentrantlock å¤æï¼æ§è½å¯è½åèè¦å·®ä¸äºãå¦æå­å¨è¿æ ·çé®é¢ï¼éè¦å·ä½é®é¢å·ä½åæãç±äº reentrantreadwritelock çè¯»åéï¼readlockãwritelockï¼é½å®ç°äº lock æ¥å£ï¼æä»¥è¦æ¿æ¢ä¸º reentrantlock ä¹è¾ä¸ºå®¹æã\n * reentrantreadwritelock å®ç°äº readwritelock æ¥å£ï¼æ¯æäº reentrantlock æä¸å·å¤çè¯»åéåç¦»ãreentrantreadwritelock ç»´æ¤äºä¸å¯¹è¯»åéï¼readlockãwritelockï¼ãå°è¯»åéåå¼ï¼æå©äºæé«å¹¶åæçãreentrantreadwritelock çå éç­ç¥æ¯ï¼åè®¸å¤ä¸ªè¯»æä½å¹¶åæ§è¡ï¼ä½æ¯æ¬¡åªåè®¸ä¸ä¸ªåæä½ã\n * reentrantreadwritelock ä¸ºè¯»åéé½æä¾äºå¯éå¥çå éè¯­ä¹ã\n * reentrantreadwritelock æ¯æå¬å¹³éåéå¬å¹³éï¼é»è®¤ï¼ä¸¤ç§æ¨¡å¼ã\n\nreadwritelock æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface readwritelock {\n    lock readlock();\n    lock writelock();\n}\n\n\n * readlock - è¿åç¨äºè¯»æä½çéï¼readlockï¼ã\n * writelock - è¿åç¨äºåæä½çéï¼writelockï¼ã\n\nå¨è¯»åéååå¥éä¹é´çäº¤äºå¯ä»¥éç¨å¤ç§å®ç°æ¹å¼ï¼readwritelock çä¸äºå¯éå®ç°åæ¬ï¼\n\n * éæ¾ä¼å - å½ä¸ä¸ªåå¥æä½éæ¾åéï¼å¹¶ä¸éåä¸­åæ¶å­å¨è¯»çº¿ç¨ååçº¿ç¨ï¼é£ä¹åºè¯¥ä¼åéæ©è¯»çº¿ç¨ãåçº¿ç¨ï¼è¿æ¯æåååºè¯·æ±ççº¿ç¨ï¼\n * è¯»çº¿ç¨æé - å¦æéæ¯ç±è¯»çº¿ç¨ææï¼ä½æåçº¿ç¨æ­£å¨ç­å¾ï¼é£ä¹æ°å°è¾¾çè¯»çº¿ç¨è½å¦ç«å³è·å¾è®¿é®æï¼è¿æ¯åºè¯¥å¨åçº¿ç¨åé¢ç­å¾ï¼å¦æåè®¸è¯»çº¿ç¨æéå°åçº¿ç¨ä¹åï¼é£ä¹å°æé«å¹¶åæ§ï¼ä½å¯è½é æçº¿ç¨é¥¥é¥¿é®é¢ã\n * éå¥æ§ - è¯»éååéæ¯å¦æ¯å¯éå¥çï¼\n * éçº§ - å¦æä¸ä¸ªçº¿ç¨ææåå¥éï¼é£ä¹å®è½å¦å¨ä¸éæ¾è¯¥éçæåµä¸è·å¾è¯»éï¼è¿å¯è½ä¼ä½¿å¾åéè¢«éçº§ä¸ºè¯»éï¼åæ¶ä¸åè®¸å¶ä»åçº¿ç¨ä¿®æ¹è¢«ä¿æ¤çèµæºã\n * åçº§ - è¯»éè½å¦ä¼åäºå¶ä»æ­£å¨ç­å¾çè¯»çº¿ç¨ååçº¿ç¨èåçº§ä¸ºä¸ä¸ªåéï¼å¨å¤§å¤æ°çè¯»åéå®ç°ä¸­å¹¶ä¸æ¯æåçº§ï¼å ä¸ºå¦ææ²¡ææ¾å¼çåçº§æä½ï¼é£ä¹å¾å®¹æé ææ­»éã\n\n\n# reentrantreadwritelock çç¨æ³\n\nåæäºè§£äº reentrantreadwritelock çç¹æ§ï¼æ¥ä¸æ¥ï¼æä»¬è¦è®²è¿°å¶å·ä½ç¨æ³ã\n\n# reentrantreadwritelock çæé æ¹æ³\n\nreentrantreadwritelock å reentrantlock ä¸æ ·ï¼ä¹æä¸¤ä¸ªæé æ¹æ³ï¼ä¸ç¨æ³ç¸ä¼¼ã\n\npublic reentrantreadwritelock() {}\npublic reentrantreadwritelock(boolean fair) {}\n\n\n * reentrantreadwritelock() - é»è®¤æé æ¹æ³ä¼åå§åä¸ä¸ªéå¬å¹³éï¼nonfairsyncï¼ãå¨éå¬å¹³çéä¸­ï¼çº¿ç¨è·å¾éçé¡ºåºæ¯ä¸ç¡®å®çãåçº¿ç¨éçº§ä¸ºè¯»çº¿ç¨æ¯å¯ä»¥çï¼ä½è¯»çº¿ç¨åçº§ä¸ºåçº¿ç¨æ¯ä¸å¯ä»¥çï¼è¿æ ·ä¼å¯¼è´æ­»éï¼ã\n * reentrantreadwritelock(boolean) - new reentrantlock(true) ä¼åå§åä¸ä¸ªå¬å¹³éï¼fairsyncï¼ãå¯¹äºå¬å¹³éï¼ç­å¾æ¶é´æé¿ççº¿ç¨å°ä¼åè·å¾éãå¦æè¿ä¸ªéæ¯è¯»çº¿ç¨ææï¼åå¦ä¸ä¸ªçº¿ç¨è¯·æ±åéï¼é£ä¹å¶ä»è¯»çº¿ç¨é½ä¸è½è·å¾è¯»éï¼ç´å°åçº¿ç¨éæ¾åéã\n\n# reentrantreadwritelock çä½¿ç¨å®ä¾\n\nå¨ reentrantreadwritelock çç¹æ§ ä¸­å·²ç»ä»ç»è¿ï¼reentrantreadwritelock çè¯»åéï¼readlockãwritelockï¼é½å®ç°äº lock æ¥å£ï¼æä»¥å¶åèªç¬ç«çä½¿ç¨æ¹å¼ä¸ reentrantlock ä¸æ ·ï¼è¿éä¸åèµè¿°ã\n\nreentrantreadwritelock ä¸ reentrantlock ç¨æ³ä¸çå·®å¼ï¼ä¸»è¦å¨äºè¯»åéçéåä½¿ç¨ãæ¬æä»¥ä¸ä¸ªå¸åä½¿ç¨åºæ¯æ¥è¿è¡è®²è§£ã\n\nãç¤ºä¾ãåºäº readwritelock å®ç°ä¸ä¸ªç®åçæ³åæ çç¼å­\n\n/**\n * ç®åçæ çç¼å­å®ç°\n * <p>\n * ä½¿ç¨ weakhashmap å­å¨é®å¼å¯¹ãweakhashmap ä¸­å­å¨çå¯¹è±¡æ¯å¼±å¼ç¨ï¼jvm gc æ¶ä¼èªå¨æ¸é¤æ²¡æè¢«å¼ç¨çå¼±å¼ç¨å¯¹è±¡ã\n */\nstatic class unboundedcache<k, v> {\n\n    private final map<k, v> cachemap = new weakhashmap<>();\n\n    private final readwritelock cachelock = new reentrantreadwritelock();\n\n    public v get(k key) {\n        cachelock.readlock().lock();\n        v value;\n        try {\n            value = cachemap.get(key);\n            string log = string.format("%s è¯»æ°æ® %s:%s", thread.currentthread().getname(), key, value);\n            system.out.println(log);\n        } finally {\n            cachelock.readlock().unlock();\n        }\n        return value;\n    }\n\n    public v put(k key, v value) {\n        cachelock.writelock().lock();\n        try {\n            cachemap.put(key, value);\n            string log = string.format("%s åå¥æ°æ® %s:%s", thread.currentthread().getname(), key, value);\n            system.out.println(log);\n        } finally {\n            cachelock.writelock().unlock();\n        }\n        return value;\n    }\n\n    public v remove(k key) {\n        cachelock.writelock().lock();\n        try {\n            return cachemap.remove(key);\n        } finally {\n            cachelock.writelock().unlock();\n        }\n    }\n\n    public void clear() {\n        cachelock.writelock().lock();\n        try {\n            this.cachemap.clear();\n        } finally {\n            cachelock.writelock().unlock();\n        }\n    }\n\n}\n\n\nè¯´æï¼\n\n * ä½¿ç¨ weakhashmap èä¸æ¯ hashmap æ¥å­å¨é®å¼å¯¹ãweakhashmap ä¸­å­å¨çå¯¹è±¡æ¯å¼±å¼ç¨ï¼jvm gc æ¶ä¼èªå¨æ¸é¤æ²¡æè¢«å¼ç¨çå¼±å¼ç¨å¯¹è±¡ã\n * å map åæ°æ®åå åéï¼åå®åï¼éæ¾åéã\n * å map è¯»æ°æ®åå è¯»éï¼è¯»å®åï¼éæ¾è¯»éã\n\næµè¯å¶çº¿ç¨å®å¨æ§ï¼\n\n/**\n * @author <a href="mailto:forbreak@163.com">zhang peng</a>\n * @since 2020-01-01\n */\npublic class reentrantreadwritelockdemo {\n\n    static unboundedcache<integer, integer> cache = new unboundedcache<>();\n\n    public static void main(string[] args) {\n        executorservice executorservice = executors.newcachedthreadpool();\n        for (int i = 0; i < 20; i++) {\n            executorservice.execute(new mythread());\n            cache.get(0);\n        }\n        executorservice.shutdown();\n    }\n\n    /** çº¿ç¨ä»»å¡æ¯æ¬¡åç¼å­ä¸­åå¥ 3 ä¸ªéæºå¼ï¼key åºå® */\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            random random = new random();\n            for (int i = 0; i < 3; i++) {\n                cache.put(i, random.nextint(100));\n            }\n        }\n\n    }\n\n}\n\n\nè¯´æï¼ç¤ºä¾ä¸­ï¼éè¿çº¿ç¨æ± å¯å¨ 20 ä¸ªå¹¶åä»»å¡ãä»»å¡æ¯æ¬¡åç¼å­ä¸­åå¥ 3 ä¸ªéæºå¼ï¼key åºå®ï¼ç¶åä¸»çº¿ç¨æ¯æ¬¡åºå®è¯»åç¼å­ä¸­ç¬¬ä¸ä¸ª key çå¼ã\n\nè¾åºç»æï¼\n\nmain è¯»æ°æ® 0:null\npool-1-thread-1 åå¥æ°æ® 0:16\npool-1-thread-1 åå¥æ°æ® 1:58\npool-1-thread-1 åå¥æ°æ® 2:50\nmain è¯»æ°æ® 0:16\npool-1-thread-1 åå¥æ°æ® 0:85\npool-1-thread-1 åå¥æ°æ® 1:76\npool-1-thread-1 åå¥æ°æ® 2:46\npool-1-thread-2 åå¥æ°æ® 0:21\npool-1-thread-2 åå¥æ°æ® 1:41\npool-1-thread-2 åå¥æ°æ® 2:63\nmain è¯»æ°æ® 0:21\nmain è¯»æ°æ® 0:21\n// ...\n\n\n\n# reentrantreadwritelock çåç\n\nåé¢äºè§£äº reentrantlock çåçï¼çè§£ reentrantreadwritelock å°±å®¹æå¤äºã\n\n# reentrantreadwritelock çæ°æ®ç»æ\n\néè¯» reentrantreadwritelock çæºç ï¼å¯ä»¥åç°å®æä¸ä¸ªæ ¸å¿å­æ®µï¼\n\n/** inner class providing readlock */\nprivate final reentrantreadwritelock.readlock readerlock;\n/** inner class providing writelock */\nprivate final reentrantreadwritelock.writelock writerlock;\n/** performs all synchronization mechanics */\nfinal sync sync;\n\npublic reentrantreadwritelock.writelock writelock() { return writerlock; }\npublic reentrantreadwritelock.readlock  readlock()  { return readerlock; }\n\n\n * sync - åé¨ç±» reentrantreadwritelock.sync å¯¹è±¡ãä¸ reentrantlock ç±»ä¼¼ï¼å®æä¸¤ä¸ªå­ç±»ï¼reentrantreadwritelock.fairsync å reentrantreadwritelock.nonfairsync ï¼åå«è¡¨ç¤ºå¬å¹³éåéå¬å¹³éçå®ç°ã\n * readerlock - åé¨ç±» reentrantreadwritelock.readlock å¯¹è±¡ï¼è¿æ¯ä¸æè¯»éã\n * writerlock - åé¨ç±» reentrantreadwritelock.writelock å¯¹è±¡ï¼è¿æ¯ä¸æåéã\n\n# reentrantreadwritelock çè·åéåéæ¾é\n\npublic static class readlock implements lock, java.io.serializable {\n\n    // è°ç¨ aqs è·åå±äº«éæ¹æ³\n    public void lock() {\n        sync.acquireshared(1);\n    }\n\n    // è°ç¨ aqs éæ¾å±äº«éæ¹æ³\n    public void unlock() {\n        sync.releaseshared(1);\n    }\n}\n\npublic static class writelock implements lock, java.io.serializable {\n\n    // è°ç¨ aqs è·åç¬å éæ¹æ³\n    public void lock() {\n        sync.acquire(1);\n    }\n\n    // è°ç¨ aqs éæ¾ç¬å éæ¹æ³\n    public void unlock() {\n        sync.release(1);\n    }\n}\n\n\n\n# stampedlock\n\nreadwritelock æ¯æä¸¤ç§æ¨¡å¼ï¼ä¸ç§æ¯è¯»éï¼ä¸ç§æ¯åéãè stampedlock æ¯æä¸ç§æ¨¡å¼ï¼åå«æ¯ï¼åéãæ²è§è¯»éåä¹è§è¯»ãå¶ä¸­ï¼åéãæ²è§è¯»éçè¯­ä¹å readwritelock çåéãè¯»éçè¯­ä¹éå¸¸ç±»ä¼¼ï¼åè®¸å¤ä¸ªçº¿ç¨åæ¶è·åæ²è§è¯»éï¼ä½æ¯åªåè®¸ä¸ä¸ªçº¿ç¨è·ååéï¼åéåæ²è§è¯»éæ¯äºæ¥çãä¸åçæ¯ï¼stampedlock éçåéåæ²è§è¯»éå éæåä¹åï¼é½ä¼è¿åä¸ä¸ª stampï¼ç¶åè§£éçæ¶åï¼éè¦ä¼ å¥è¿ä¸ª stampã\n\n> æ³¨æè¿éï¼ç¨çæ¯âä¹è§è¯»âè¿ä¸ªè¯ï¼èä¸æ¯âä¹è§è¯»éâï¼æ¯è¦æéä½ ï¼ä¹è§è¯»è¿ä¸ªæä½æ¯æ éçï¼æä»¥ç¸æ¯è¾ readwritelock çè¯»éï¼ä¹è§è¯»çæ§è½æ´å¥½ä¸äºã\n\nstampedlock çæ§è½ä¹æä»¥æ¯ readwritelock è¿è¦å¥½ï¼å¶å³é®æ¯ stampedlock æ¯æä¹è§è¯»çæ¹å¼ã\n\n * readwritelock æ¯æå¤ä¸ªçº¿ç¨åæ¶è¯»ï¼ä½æ¯å½å¤ä¸ªçº¿ç¨åæ¶è¯»çæ¶åï¼ææçåæä½ä¼è¢«é»å¡ï¼\n * è stampedlock æä¾çä¹è§è¯»ï¼æ¯åè®¸ä¸ä¸ªçº¿ç¨è·ååéçï¼ä¹å°±æ¯è¯´ä¸æ¯ææçåæä½é½è¢«é»å¡ã\n\nå¯¹äºè¯»å¤åå°çåºæ¯ stampedlock æ§è½å¾å¥½ï¼ç®åçåºç¨åºæ¯åºæ¬ä¸å¯ä»¥æ¿ä»£ readwritelockï¼ä½æ¯stampedlock çåè½ä»ä»æ¯ readwritelock çå­éï¼å¨ä½¿ç¨çæ¶åï¼è¿æ¯æå ä¸ªå°æ¹éè¦æ³¨æä¸ä¸ã\n\n * stampedlock ä¸æ¯æéå¥\n * stampedlock çæ²è§è¯»éãåéé½ä¸æ¯ææ¡ä»¶åéã\n * å¦æçº¿ç¨é»å¡å¨ stampedlock ç readlock() æè writelock() ä¸æ¶ï¼æ­¤æ¶è°ç¨è¯¥é»å¡çº¿ç¨ç interrupt() æ¹æ³ï¼ä¼å¯¼è´ cpu é£åãä½¿ç¨ stampedlock ä¸å®ä¸è¦è°ç¨ä¸­æ­æä½ï¼å¦æéè¦æ¯æä¸­æ­åè½ï¼ä¸å®ä½¿ç¨å¯ä¸­æ­çæ²è§è¯»é readlockinterruptibly() ååé writelockinterruptibly()ã\n\nãç¤ºä¾ãstampedlock é»å¡æ¶ï¼è°ç¨ interrupt() å¯¼è´ cpu é£å\n\nfinal stampedlock lock\n  = new stampedlock();\nthread t1 = new thread(()->{\n  // è·ååé\n  lock.writelock();\n  // æ°¸è¿é»å¡å¨æ­¤å¤ï¼ä¸éæ¾åé\n  locksupport.park();\n});\nt1.start();\n// ä¿è¯ t1 è·ååé\nthread.sleep(100);\nthread t2 = new thread(()->\n  // é»å¡å¨æ²è§è¯»é\n  lock.readlock()\n);\nt2.start();\n// ä¿è¯ t2 é»å¡å¨è¯»é\nthread.sleep(100);\n// ä¸­æ­çº¿ç¨ t2\n// ä¼å¯¼è´çº¿ç¨ t2 æå¨ cpu é£å\nt2.interrupt();\nt2.join();\n\n\nãç¤ºä¾ãstampedlock è¯»æ¨¡æ¿ï¼\n\nfinal stampedlock sl =\n  new stampedlock();\n\n// ä¹è§è¯»\nlong stamp =\n  sl.tryoptimisticread();\n// è¯»å¥æ¹æ³å±é¨åé\n......\n// æ ¡éª stamp\nif (!sl.validate(stamp)){\n  // åçº§ä¸ºæ²è§è¯»é\n  stamp = sl.readlock();\n  try {\n    // è¯»å¥æ¹æ³å±é¨åé\n    .....\n  } finally {\n    // éæ¾æ²è§è¯»é\n    sl.unlockread(stamp);\n  }\n}\n// ä½¿ç¨æ¹æ³å±é¨åéæ§è¡ä¸å¡æä½\n......\n\n\nãç¤ºä¾ãstampedlock åæ¨¡æ¿ï¼\n\nlong stamp = sl.writelock();\ntry {\n  // åå±äº«åé\n  ......\n} finally {\n  sl.unlockwrite(stamp);\n}\n\n\n\n# aqs\n\n> abstractqueuedsynchronizerï¼ç®ç§° aqsï¼æ¯éååæ­¥å¨ï¼é¡¾åæä¹ï¼å¶ä¸»è¦ä½ç¨æ¯å¤çåæ­¥ãå®æ¯å¹¶åéåå¾å¤åæ­¥å·¥å·ç±»çå®ç°åºç³ï¼å¦ reentrantlockãreentrantreadwritelockãcountdownlatchãsemaphoreãfuturetask ç­ï¼ã\n\n\n# aqs çè¦ç¹\n\naqs æä¾äºå¯¹ç¬äº«éä¸å±äº«éçæ¯æã\n\nå¨ java.util.concurrent.locks åä¸­çç¸å³éï¼å¸¸ç¨çæ reentrantlockã readwritelockï¼é½æ¯åºäº aqs æ¥å®ç°ãè¿äºéé½æ²¡æç´æ¥ç»§æ¿ aqsï¼èæ¯å®ä¹äºä¸ä¸ª sync ç±»å»ç»§æ¿ aqsãä¸ºä»ä¹è¦è¿æ ·å¢ï¼å ä¸ºéé¢åçæ¯ä½¿ç¨ç¨æ·ï¼èåæ­¥å¨é¢åçåæ¯çº¿ç¨æ§å¶ï¼é£ä¹å¨éçå®ç°ä¸­èååæ­¥å¨èä¸æ¯ç´æ¥ç»§æ¿ aqs å°±å¯ä»¥å¾å¥½çéç¦»äºèæå³æ³¨çäºæã\n\n\n# aqs çåºç¨\n\naqs æä¾äºå¯¹ç¬äº«éä¸å±äº«éçæ¯æã\n\n# ç¬äº«é api\n\nè·åãéæ¾ç¬äº«éçä¸»è¦ api å¦ä¸ï¼\n\npublic final void acquire(int arg)\npublic final void acquireinterruptibly(int arg)\npublic final boolean tryacquirenanos(int arg, long nanostimeout)\npublic final boolean release(int arg)\n\n\n * acquire - è·åç¬å éã\n * acquireinterruptibly - è·åå¯ä¸­æ­çç¬å éã\n * tryacquirenanos - å°è¯å¨æå®æ¶é´åè·åå¯ä¸­æ­çç¬å éãå¨ä»¥ä¸ä¸ç§æåµä¸åè¿åï¼\n   * å¨è¶æ¶æ¶é´åï¼å½åçº¿ç¨æåè·åäºéï¼\n   * å½åçº¿ç¨å¨è¶æ¶æ¶é´åè¢«ä¸­æ­ï¼\n   * è¶æ¶æ¶é´ç»æï¼ä»æªè·å¾éè¿å falseã\n * release - éæ¾ç¬å éã\n\n# å±äº«é api\n\nè·åãéæ¾å±äº«éçä¸»è¦ api å¦ä¸ï¼\n\npublic final void acquireshared(int arg)\npublic final void acquiresharedinterruptibly(int arg)\npublic final boolean tryacquiresharednanos(int arg, long nanostimeout)\npublic final boolean releaseshared(int arg)\n\n\n * acquireshared - è·åå±äº«éã\n * acquiresharedinterruptibly - è·åå¯ä¸­æ­çå±äº«éã\n * tryacquiresharednanos - å°è¯å¨æå®æ¶é´åè·åå¯ä¸­æ­çå±äº«éã\n * release - éæ¾å±äº«éã\n\n\n# aqs çåç\n\n> asq åçè¦ç¹ï¼\n> \n>  * aqs ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤åæ­¥ç¶æãç¶æçæä¹ç±å­ç±»èµäºã\n>  * aqs ç»´æ¤äºä¸ä¸ª fifo çåé¾è¡¨ï¼ç¨æ¥å­å¨è·åéå¤±è´¥ççº¿ç¨ã\n> \n> aqs å´ç»åæ­¥ç¶ææä¾ä¸¤ç§åºæ¬æä½âè·åâåâéæ¾âï¼å¹¶æä¾ä¸ç³»åå¤æ­åå¤çæ¹æ³ï¼ç®åè¯´å ç¹ï¼\n> \n>  * state æ¯ç¬å çï¼è¿æ¯å±äº«çï¼\n>  * state è¢«è·ååï¼å¶ä»çº¿ç¨éè¦ç­å¾ï¼\n>  * state è¢«éæ¾åï¼å¤éç­å¾çº¿ç¨ï¼\n>  * çº¿ç¨ç­ä¸åæ¶ï¼å¦ä½éåºç­å¾ã\n> \n> è³äºçº¿ç¨æ¯å¦å¯ä»¥è·å¾ stateï¼å¦ä½éæ¾ stateï¼å°±ä¸æ¯ aqs å³å¿çäºï¼è¦ç±å­ç±»å·ä½å®ç°ã\n\n# aqs çæ°æ®ç»æ\n\néè¯» aqs çæºç ï¼å¯ä»¥åç°ï¼aqs ç»§æ¿èª abstractownablesynchronizeã\n\npublic abstract class abstractqueuedsynchronizer\n    extends abstractownablesynchronizer\n    implements java.io.serializable {\n\n    /** ç­å¾éåçéå¤´ï¼æå è½½ãåªè½éè¿ sethead æ¹æ³ä¿®æ¹ã */\n    private transient volatile node head;\n    /** ç­å¾éåçéå°¾ï¼æå è½½ãåªè½éè¿ enq æ¹æ³æ·»å æ°çç­å¾èç¹ã*/\n    private transient volatile node tail;\n    /** åæ­¥ç¶æ */\n    private volatile int state;\n}\n\n\n * state - aqs ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤åæ­¥ç¶æã\n   * è¿ä¸ªæ´æ°ç¶æçæä¹ç±å­ç±»æ¥èµäºï¼å¦reentrantlock ä¸­è¯¥ç¶æå¼è¡¨ç¤ºææèçº¿ç¨å·²ç»éå¤è·åè¯¥éçæ¬¡æ°ï¼semaphore ä¸­è¯¥ç¶æå¼è¡¨ç¤ºå©ä½çè®¸å¯æ°éã\n * head å tail - aqs ç»´æ¤äºä¸ä¸ª node ç±»åï¼aqs çåé¨ç±»ï¼çåé¾è¡¨æ¥å®æåæ­¥ç¶æçç®¡çãè¿ä¸ªåé¾è¡¨æ¯ä¸ä¸ªååç fifo éåï¼éè¿ head å tail æéè¿è¡è®¿é®ãå½ æçº¿ç¨è·åéå¤±è´¥åï¼å°±è¢«æ·»å å°éåæ«å°¾ã\n\n\n\nåæ¥çä¸ä¸ node çæºç \n\nstatic final class node {\n    /** è¯¥ç­å¾åæ­¥çèç¹å¤äºå±äº«æ¨¡å¼ */\n    static final node shared = new node();\n    /** è¯¥ç­å¾åæ­¥çèç¹å¤äºç¬å æ¨¡å¼ */\n    static final node exclusive = null;\n\n    /** çº¿ç¨ç­å¾ç¶æï¼ç¶æå¼æ: 0ã1ã-1ã-2ã-3 */\n    volatile int waitstatus;\n    static final int cancelled =  1;\n    static final int signal    = -1;\n    static final int condition = -2;\n    static final int propagate = -3;\n\n    /** åé©±èç¹ */\n    volatile node prev;\n    /** åç»§èç¹ */\n    volatile node next;\n    /** ç­å¾éççº¿ç¨ */\n    volatile thread thread;\n\n  \t/** åèç¹æ¯å¦å±äº«æå³ */\n    node nextwaiter;\n}\n\n\nå¾æ¾ç¶ï¼node æ¯ä¸ä¸ªåé¾è¡¨ç»æã\n\n * waitstatus - node ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤ aqs åæ­¥éåä¸­çº¿ç¨èç¹çç¶æãwaitstatus æäºä¸ªç¶æå¼ï¼\n   * cancelled(1) - æ­¤ç¶æè¡¨ç¤ºï¼è¯¥èç¹ççº¿ç¨å¯è½ç±äºè¶æ¶æè¢«ä¸­æ­è å¤äºè¢«åæ¶(ä½åº)ç¶æï¼ä¸æ¦å¤äºè¿ä¸ªç¶æï¼è¡¨ç¤ºè¿ä¸ªèç¹åºè¯¥ä»ç­å¾éåä¸­ç§»é¤ã\n   * signal(-1) - æ­¤ç¶æè¡¨ç¤ºï¼åç»§èç¹ä¼è¢«æèµ·ï¼å æ­¤å¨å½åèç¹éæ¾éæè¢«åæ¶ä¹åï¼å¿é¡»å¤é(unparking)å¶åç»§ç»ç¹ã\n   * condition(-2) - æ­¤ç¶æè¡¨ç¤ºï¼è¯¥èç¹ççº¿ç¨ å¤äºç­å¾æ¡ä»¶ç¶æï¼ä¸ä¼è¢«å½ä½æ¯åæ­¥éåä¸çèç¹ï¼ç´å°è¢«å¤é(signal)ï¼è®¾ç½®å¶å¼ä¸º 0ï¼åéæ°è¿å¥é»å¡ç¶æã\n   * propagate(-3) - æ­¤ç¶æè¡¨ç¤ºï¼ä¸ä¸ä¸ª acquireshared åºæ æ¡ä»¶ä¼ æ­ã\n   * 0 - éä»¥ä¸ç¶æã\n\n# ç¬å éçè·ååéæ¾\n\n# è·åç¬å é\n\naqs ä¸­ä½¿ç¨ acquire(int arg) æ¹æ³è·åç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·ååæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶ææåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶æä¸æåï¼aqs ä¼ä¸æ­å°è¯å©ç¨ cas æä½å°å½åçº¿ç¨æå¥ç­å¾åæ­¥éåçéå°¾ï¼ç´å°æåä¸ºæ­¢ã\n 3. æ¥çï¼ä¸æ­å°è¯ä¸ºç­å¾éåä¸­ççº¿ç¨èç¹è·åç¬å éã\n\n\n\n\n\nè¯¦ç»æµç¨å¯ä»¥ç¨ä¸å¾æ¥è¡¨ç¤ºï¼è¯·ç»åæºç æ¥çè§£ï¼ä¸å¾èåè¨ï¼ï¼\n\n\n\n# éæ¾ç¬å é\n\naqs ä¸­ä½¿ç¨ release(int arg) æ¹æ³éæ¾ç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·åè§£éçº¿ç¨çåæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶æä¸æåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶ææåï¼aqs ä¼å°è¯å¤éå½åçº¿ç¨èç¹çåç»§èç¹ã\n\n# è·åå¯ä¸­æ­çç¬å é\n\naqs ä¸­ä½¿ç¨ acquireinterruptibly(int arg) æ¹æ³è·åå¯ä¸­æ­çç¬å éã\n\nacquireinterruptibly(int arg) å®ç°æ¹å¼ç¸è¾äºè·åç¬å éæ¹æ³ï¼ acquireï¼éå¸¸ç¸ä¼¼ï¼åºå«ä»å¨äºå®ä¼éè¿ thread.interrupted æ£æµå½åçº¿ç¨æ¯å¦è¢«ä¸­æ­ï¼å¦ææ¯ï¼åç«å³æåºä¸­æ­å¼å¸¸ï¼interruptedexceptionï¼ã\n\n# è·åè¶æ¶ç­å¾å¼çç¬å é\n\naqs ä¸­ä½¿ç¨ tryacquirenanos(int arg) æ¹æ³è·åè¶æ¶ç­å¾çç¬å éã\n\ndoacquirenanos çå®ç°æ¹å¼ ç¸è¾äºè·åç¬å éæ¹æ³ï¼ acquireï¼éå¸¸ç¸ä¼¼ï¼åºå«å¨äºå®ä¼æ ¹æ®è¶æ¶æ¶é´åå½åæ¶é´è®¡ç®åºæªæ­¢æ¶é´ãå¨è·åéçæµç¨ä¸­ï¼ä¼ä¸æ­å¤æ­æ¯å¦è¶æ¶ï¼å¦æè¶æ¶ï¼ç´æ¥è¿å falseï¼å¦ææ²¡è¶æ¶ï¼åç¨ locksupport.parknanos æ¥é»å¡å½åçº¿ç¨ã\n\n# å±äº«éçè·ååéæ¾\n\n# è·åå±äº«é\n\naqs ä¸­ä½¿ç¨ acquireshared(int arg) æ¹æ³è·åå±äº«éã\n\nacquireshared æ¹æ³å acquire æ¹æ³çé»è¾å¾ç¸ä¼¼ï¼åºå«ä»å¨äºèªæçæ¡ä»¶ä»¥åèç¹åºéçæä½ææä¸åã\n\næåè·å¾å±äº«éçæ¡ä»¶å¦ä¸ï¼\n\n * tryacquireshared(arg) è¿åå¼å¤§äºç­äº 0 ï¼è¿æå³çå±äº«éç permit è¿æ²¡æç¨å®ï¼ã\n * å½åèç¹çåé©±èç¹æ¯å¤´ç»ç¹ã\n\n# éæ¾å±äº«é\n\naqs ä¸­ä½¿ç¨ releaseshared(int arg) æ¹æ³éæ¾å±äº«éã\n\nreleaseshared é¦åä¼å°è¯éæ¾åæ­¥ç¶æï¼å¦ææåï¼åè§£éä¸ä¸ªæå¤ä¸ªåç»§çº¿ç¨èç¹ãéæ¾å±äº«éåéæ¾ç¬äº«éæµç¨å¤§ä½ç¸ä¼¼ï¼åºå«å¨äºï¼\n\nå¯¹äºç¬äº«æ¨¡å¼ï¼å¦æéè¦ signalï¼éæ¾ä»ç¸å½äºè°ç¨å¤´èç¹ç unparksuccessorã\n\n# è·åå¯ä¸­æ­çå±äº«é\n\naqs ä¸­ä½¿ç¨ acquiresharedinterruptibly(int arg) æ¹æ³è·åå¯ä¸­æ­çå±äº«éã\n\nacquiresharedinterruptibly æ¹æ³ä¸ acquireinterruptibly å ä¹ä¸è´ï¼ä¸åèµè¿°ã\n\n# è·åè¶æ¶ç­å¾å¼çå±äº«é\n\naqs ä¸­ä½¿ç¨ tryacquiresharednanos(int arg) æ¹æ³è·åè¶æ¶ç­å¾å¼çå±äº«éã\n\ntryacquiresharednanos æ¹æ³ä¸ tryacquirenanos å ä¹ä¸è´ï¼ä¸åèµè¿°ã\n\n\n# æ­»é\n\n\n# ä»ä¹æ¯æ­»é\n\næ­»éæ¯ä¸ç§ç¹å®çç¨åºç¶æï¼å¨å®ä½ä¹é´ï¼ç±äºå¾ªç¯ä¾èµå¯¼è´å½¼æ­¤ä¸ç´å¤äºç­å¾ä¹ä¸­ï¼æ²¡æä»»ä½ä¸ªä½å¯ä»¥ç»§ç»­åè¿ãæ­»éä¸ä»ä»æ¯å¨çº¿ç¨ä¹é´ä¼åçï¼å­å¨èµæºç¬å çè¿ç¨ä¹é´åæ ·ä¹ å¯è½åºç°æ­»éãéå¸¸æ¥è¯´ï¼æä»¬å¤§å¤æ¯èç¦å¨å¤çº¿ç¨åºæ¯ä¸­çæ­»éï¼æä¸¤ä¸ªæå¤ä¸ªçº¿ç¨ä¹é´ï¼ç±äºäºç¸ææå¯¹æ¹éè¦çéï¼èæ°¸ä¹å¤äºé»å¡çç¶æã\n\n\n# å¦ä½å®ä½æ­»é\n\nå®ä½æ­»éæå¸¸è§çæ¹å¼å°±æ¯å©ç¨ jstack ç­å·¥å·è·åçº¿ç¨æ ï¼ç¶åå®ä½äºç¸ä¹é´çä¾èµå³ç³»ï¼è¿èæ¾å°æ­»éãå¦ææ¯æ¯è¾ææ¾çæ­»éï¼å¾å¾ jstack ç­å°±è½ç´æ¥å®ä½ï¼ç±»ä¼¼ jconsole çè³å¯ä»¥å¨å¾å½¢çé¢è¿è¡æéçæ­»éæ£æµã\n\nå¦ææä»¬æ¯å¼åèªå·±çç®¡çå·¥å·ï¼éè¦ç¨æ´å ç¨åºåçæ¹å¼æ«ææå¡è¿ç¨ãå®ä½æ­»éï¼å¯ä»¥èèä½¿ç¨ java æä¾çæ åç®¡ç apiï¼threadmxbeanï¼å¶ç´æ¥å°±æä¾äº finddeadlockedthreads() æ¹æ³ç¨äºå®ä½ã\n\n\n# å¦ä½é¿åæ­»é\n\nåºæ¬ä¸æ­»éçåçæ¯å ä¸ºï¼\n\n * äºæ¥ï¼ç±»ä¼¼ java ä¸­ monitor é½æ¯ç¬å çã\n * é¿æä¿æäºæ¥ï¼å¨ä½¿ç¨ç»æä¹åï¼ä¸ä¼éæ¾ï¼ä¹ä¸è½è¢«å¶ä»çº¿ç¨æ¢å ã\n * å¾ªç¯ä¾èµï¼å¤ä¸ªä¸ªä½ä¹é´åºç°äºéçå¾ªç¯ä¾èµï¼å½¼æ­¤ä¾èµä¸ä¸ç¯éæ¾éã\n\nç±æ­¤ï¼æä»¬å¯ä»¥åæåºé¿åæ­»éçæè·¯åæ¹æ³ã\n\nï¼1ï¼é¿åä¸ä¸ªçº¿ç¨åæ¶è·åå¤ä¸ªéã\n\né¿åä¸ä¸ªçº¿ç¨å¨éååæ¶å ç¨å¤ä¸ªèµæºï¼å°½éä¿è¯æ¯ä¸ªéåªå ç¨ä¸ä¸ªèµæºã\n\nå°è¯ä½¿ç¨å®æ¶é lock.trylock(timeout)ï¼é¿åéä¸ç´ä¸è½éæ¾ã\n\nå¯¹äºæ°æ®åºéï¼å éåè§£éå¿é¡»å¨ä¸ä¸ªæ°æ®åºè¿æ¥ä¸­éï¼å¦åä¼åºç°è§£éå¤±è´¥çæåµã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * java å¹¶åç¼ç¨ï¼lock\n * æ·±å¥å­¦ä¹  java åæ­¥å¨ aqs\n * abstractqueuedsynchronizer æ¡æ¶\n * java ä¸­çéåç±»',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaå¹¶ååå®¹å¨",frontmatter:{title:"Javaå¹¶ååå®¹å¨",date:"2020-02-02T17:54:36.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å","å®¹å¨"],permalink:"/pages/b067d6/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/06.Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/06.Javaå¹¶ååå®¹å¨.md",key:"v-b1d46672",path:"/pages/b067d6/",headers:[{level:2,title:"åæ­¥å®¹å¨",slug:"åæ­¥å®¹å¨",normalizedTitle:"åæ­¥å®¹å¨",charIndex:17},{level:3,title:"åæ­¥å®¹å¨ç®ä»",slug:"åæ­¥å®¹å¨ç®ä»",normalizedTitle:"åæ­¥å®¹å¨ç®ä»",charIndex:26},{level:3,title:"åæ­¥å®¹å¨çé®é¢",slug:"åæ­¥å®¹å¨çé®é¢",normalizedTitle:"åæ­¥å®¹å¨çé®é¢",charIndex:422},{level:4,title:"æ§è½é®é¢",slug:"æ§è½é®é¢",normalizedTitle:"æ§è½é®é¢",charIndex:577},{level:4,title:"å®å¨é®é¢",slug:"å®å¨é®é¢",normalizedTitle:"å®å¨é®é¢",charIndex:705},{level:2,title:"å¹¶åå®¹å¨ç®ä»",slug:"å¹¶åå®¹å¨ç®ä»",normalizedTitle:"å¹¶åå®¹å¨ç®ä»",charIndex:3568},{level:3,title:"å¹¶ååºæ¯ä¸ç Map",slug:"å¹¶ååºæ¯ä¸ç-map",normalizedTitle:"å¹¶ååºæ¯ä¸ç map",charIndex:5134},{level:3,title:"å¹¶ååºæ¯ä¸ç List",slug:"å¹¶ååºæ¯ä¸ç-list",normalizedTitle:"å¹¶ååºæ¯ä¸ç list",charIndex:5273},{level:2,title:"Map",slug:"map",normalizedTitle:"map",charIndex:295},{level:3,title:"ConcurrentHashMap",slug:"concurrenthashmap",normalizedTitle:"concurrenthashmap",charIndex:3745},{level:4,title:"ConcurrentHashMap çç¹æ§",slug:"concurrenthashmap-çç¹æ§",normalizedTitle:"concurrenthashmap çç¹æ§",charIndex:5753},{level:4,title:"ConcurrentHashMap çç¨æ³",slug:"concurrenthashmap-çç¨æ³",normalizedTitle:"concurrenthashmap çç¨æ³",charIndex:6817},{level:4,title:"ConcurrentHashMap çåç",slug:"concurrenthashmap-çåç",normalizedTitle:"concurrenthashmap çåç",charIndex:7846},{level:5,title:"Java 1.7 çå®ç°",slug:"java-1-7-çå®ç°",normalizedTitle:"java 1.7 çå®ç°",charIndex:8084},{level:5,title:"Java 1.8 çå®ç°",slug:"java-1-8-çå®ç°",normalizedTitle:"java 1.8 çå®ç°",charIndex:9128},{level:4,title:"ConcurrentHashMap çå®æ",slug:"concurrenthashmap-çå®æ",normalizedTitle:"concurrenthashmap çå®æ",charIndex:12578},{level:5,title:"ConcurrentHashMap éè¯¯ç¤ºä¾",slug:"concurrenthashmap-éè¯¯ç¤ºä¾",normalizedTitle:"concurrenthashmap éè¯¯ç¤ºä¾",charIndex:12633},{level:5,title:"ConcurrentHashMap éè¯¯ç¤ºä¾ä¿®æ­£ 1.0 ç",slug:"concurrenthashmap-éè¯¯ç¤ºä¾ä¿®æ­£-1-0-ç",normalizedTitle:"concurrenthashmap éè¯¯ç¤ºä¾ä¿®æ­£ 1.0 ç",charIndex:14383},{level:5,title:"ConcurrentHashMap éè¯¯ç¤ºä¾ä¿®æ­£ 2.0 ç",slug:"concurrenthashmap-éè¯¯ç¤ºä¾ä¿®æ­£-2-0-ç",normalizedTitle:"concurrenthashmap éè¯¯ç¤ºä¾ä¿®æ­£ 2.0 ç",charIndex:15938},{level:2,title:"List",slug:"list",normalizedTitle:"list",charIndex:109},{level:3,title:"CopyOnWriteArrayList",slug:"copyonwritearraylist",normalizedTitle:"copyonwritearraylist",charIndex:3884},{level:4,title:"CopyOnWriteArrayList åç",slug:"copyonwritearraylist-åç",normalizedTitle:"copyonwritearraylist åç",charIndex:18896},{level:4,title:"CopyOnWriteArrayList ç¤ºä¾",slug:"copyonwritearraylist-ç¤ºä¾",normalizedTitle:"copyonwritearraylist ç¤ºä¾",charIndex:21225},{level:4,title:"CopyOnWriteArrayList å®æ",slug:"copyonwritearraylist-å®æ",normalizedTitle:"copyonwritearraylist å®æ",charIndex:22649},{level:2,title:"Set",slug:"set",normalizedTitle:"set",charIndex:3937},{level:2,title:"Queue",slug:"queue",normalizedTitle:"queue",charIndex:4066},{level:3,title:"BlockingQueue",slug:"blockingqueue",normalizedTitle:"blockingqueue",charIndex:4191},{level:3,title:"PriorityBlockingQueue ç±»",slug:"priorityblockingqueue-ç±»",normalizedTitle:"priorityblockingqueue ç±»",charIndex:26648},{level:4,title:"PriorityBlockingQueue è¦ç¹",slug:"priorityblockingqueue-è¦ç¹",normalizedTitle:"priorityblockingqueue è¦ç¹",charIndex:26827},{level:4,title:"PriorityBlockingQueue åç",slug:"priorityblockingqueue-åç",normalizedTitle:"priorityblockingqueue åç",charIndex:27126},{level:3,title:"ArrayBlockingQueue ç±»",slug:"arrayblockingqueue-ç±»",normalizedTitle:"arrayblockingqueue ç±»",charIndex:27434},{level:4,title:"ArrayBlockingQueue è¦ç¹",slug:"arrayblockingqueue-è¦ç¹",normalizedTitle:"arrayblockingqueue è¦ç¹",charIndex:27495},{level:4,title:"ArrayBlockingQueue åç",slug:"arrayblockingqueue-åç",normalizedTitle:"arrayblockingqueue åç",charIndex:28076},{level:3,title:"LinkedBlockingQueue ç±»",slug:"linkedblockingqueue-ç±»",normalizedTitle:"linkedblockingqueue ç±»",charIndex:28769},{level:4,title:"LinkedBlockingQueue è¦ç¹",slug:"linkedblockingqueue-è¦ç¹",normalizedTitle:"linkedblockingqueue è¦ç¹",charIndex:28928},{level:4,title:"LinkedBlockingQueue åç",slug:"linkedblockingqueue-åç",normalizedTitle:"linkedblockingqueue åç",charIndex:29306},{level:3,title:"SynchronousQueue ç±»",slug:"synchronousqueue-ç±»",normalizedTitle:"synchronousqueue ç±»",charIndex:30175},{level:3,title:"ConcurrentLinkedDeque ç±»",slug:"concurrentlinkeddeque-ç±»",normalizedTitle:"concurrentlinkeddeque ç±»",charIndex:30899},{level:3,title:"Queue çå¹¶ååºç¨",slug:"queue-çå¹¶ååºç¨",normalizedTitle:"queue çå¹¶ååºç¨",charIndex:31044},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:31566}],headersStr:"åæ­¥å®¹å¨ åæ­¥å®¹å¨ç®ä» åæ­¥å®¹å¨çé®é¢ æ§è½é®é¢ å®å¨é®é¢ å¹¶åå®¹å¨ç®ä» å¹¶ååºæ¯ä¸ç Map å¹¶ååºæ¯ä¸ç List Map ConcurrentHashMap ConcurrentHashMap çç¹æ§ ConcurrentHashMap çç¨æ³ ConcurrentHashMap çåç Java 1.7 çå®ç° Java 1.8 çå®ç° ConcurrentHashMap çå®æ ConcurrentHashMap éè¯¯ç¤ºä¾ ConcurrentHashMap éè¯¯ç¤ºä¾ä¿®æ­£ 1.0 ç ConcurrentHashMap éè¯¯ç¤ºä¾ä¿®æ­£ 2.0 ç List CopyOnWriteArrayList CopyOnWriteArrayList åç CopyOnWriteArrayList ç¤ºä¾ CopyOnWriteArrayList å®æ Set Queue BlockingQueue PriorityBlockingQueue ç±» PriorityBlockingQueue è¦ç¹ PriorityBlockingQueue åç ArrayBlockingQueue ç±» ArrayBlockingQueue è¦ç¹ ArrayBlockingQueue åç LinkedBlockingQueue ç±» LinkedBlockingQueue è¦ç¹ LinkedBlockingQueue åç SynchronousQueue ç±» ConcurrentLinkedDeque ç±» Queue çå¹¶ååºç¨ åèèµæ",content:'# Java å¹¶ååå®¹å¨\n\n\n# åæ­¥å®¹å¨\n\n\n# åæ­¥å®¹å¨ç®ä»\n\nå¨ Java ä¸­ï¼åæ­¥å®¹å¨ä¸»è¦åæ¬ 2 ç±»ï¼\n\n * VectorãStackãHashtable\n   * Vector - Vector å®ç°äº List æ¥å£ãVector å®éä¸å°±æ¯ä¸ä¸ªæ°ç»ï¼å ArrayList ç±»ä¼¼ãä½æ¯ Vector ä¸­çæ¹æ³é½æ¯ synchronized æ¹æ³ï¼å³è¿è¡äºåæ­¥æªæ½ã\n   * Stack - Stack ä¹æ¯ä¸ä¸ªåæ­¥å®¹å¨ï¼å®çæ¹æ³ä¹ç¨ synchronized è¿è¡äºåæ­¥ï¼å®å®éä¸æ¯ç»§æ¿äº Vector ç±»ã\n   * Hashtable- Hashtable å®ç°äº Map æ¥å£ï¼å®å HashMap å¾ç¸ä¼¼ï¼ä½æ¯ Hashtable è¿è¡äºåæ­¥å¤çï¼è HashMap æ²¡æã\n * Collections ç±»ä¸­æä¾çéæå·¥åæ¹æ³åå»ºçç±»ï¼ç± Collections.synchronizedXXX ç­æ¹æ³ï¼\n\n\n# åæ­¥å®¹å¨çé®é¢\n\nåæ­¥å®¹å¨çåæ­¥åçå°±æ¯å¨å¶ getãsetãsize ç­ä¸»è¦æ¹æ³ä¸ç¨ synchronized ä¿®é¥°ã synchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\n> æ³è¯¦ç»äºè§£ synchronized ç¨æ³ååçå¯ä»¥åèï¼Java å¹¶åæ ¸å¿æºå¶\n\n# æ§è½é®é¢\n\nsynchronized çäºæ¥åæ­¥ä¼äº§çé»å¡åå¤éçº¿ç¨çå¼éãæ¾ç¶ï¼è¿ç§æ¹å¼æ¯æ²¡æä½¿ç¨ synchronized çå®¹å¨æ§è½è¦å·®å¾å¤ã\n\n> æ³¨ï¼å°¤å¶æ¯å¨ Java 1.6 æ²¡æå¯¹ synchronized è¿è¡ä¼ååï¼é»å¡å¼éå¾é«ã\n\n# å®å¨é®é¢\n\nåæ­¥å®¹å¨ççç»å¯¹å®å¨åï¼\n\nå¶å®ä¹æªå¿ãå¨åå¤åæä½ï¼éåå­æä½ï¼æ¶ï¼ä»ç¶éè¦å éæ¥ä¿æ¤ãå¸¸è§å¤åæä½å¦ä¸ï¼\n\n * è¿­ä»£ï¼åå¤è®¿é®åç´ ï¼ç´å°éåå®å¨é¨åç´ ï¼\n * è·³è½¬ï¼æ ¹æ®æå®é¡ºåºå¯»æ¾å½ååç´ çä¸ä¸ä¸ªï¼ä¸ n ä¸ªï¼åç´ ï¼\n * æ¡ä»¶è¿ç®ï¼ä¾å¦è¥æ²¡æåæ·»å ç­ï¼\n\nâ ä¸å®å¨çç¤ºä¾\n\npublic class VectorDemo {\n\n    static Vector<Integer> vector = new Vector<>();\n\n    public static void main(String[] args) {\n        while (true) {\n            vector.clear();\n\n            for (int i = 0; i < 10; i++) {\n                vector.add(i);\n            }\n\n            Thread thread1 = new Thread() {\n                @Override\n                public void run() {\n                    for (int i = 0; i < vector.size(); i++) {\n                        vector.remove(i);\n                    }\n                }\n            };\n\n            Thread thread2 = new Thread() {\n                @Override\n                public void run() {\n                    for (int i = 0; i < vector.size(); i++) {\n                        vector.get(i);\n                    }\n                }\n            };\n\n            thread1.start();\n            thread2.start();\n\n            while (Thread.activeCount() > 10) {\n                System.out.println("åæ¶å­å¨ 10 ä¸ªä»¥ä¸çº¿ç¨ï¼éåº");\n                return;\n            }\n        }\n    }\n\n}\n\n\nä»¥ä¸ç¨åºæ§è¡æ¶å¯è½ä¼åºç°æ°ç»è¶çéè¯¯ã\n\nVector æ¯çº¿ç¨å®å¨çï¼é£ä¸ºä»ä¹è¿ä¼æ¥è¿ä¸ªéï¼\n\nè¿æ¯å ä¸ºï¼å¯¹äº Vectorï¼è½ç¶è½ä¿è¯æ¯ä¸ä¸ªæ¶å»åªè½æä¸ä¸ªçº¿ç¨è®¿é®å®ï¼ä½æ¯ä¸æé¤è¿ç§å¯è½ï¼\n\nå½æä¸ªçº¿ç¨å¨æä¸ªæ¶å»æ§è¡è¿å¥æ¶ï¼\n\nfor(int i=0;i<vector.size();i++)\n    vector.get(i);\n\n\nåè¥æ­¤æ¶ vector ç size æ¹æ³è¿åçæ¯ 10ï¼i çå¼ä¸º 9\n\nç¶åå¦å¤ä¸ä¸ªçº¿ç¨æ§è¡äºè¿å¥ï¼\n\nfor(int i=0;i<vector.size();i++)\n    vector.remove(i);\n\n\nå°ä¸æ ä¸º 9 çåç´ å é¤äºã\n\né£ä¹éè¿ get æ¹æ³è®¿é®ä¸æ ä¸º 9 çåç´ è¯å®å°±ä¼åºé®é¢äºã\n\nâ å®å¨ç¤ºä¾\n\nå æ­¤ä¸ºäºä¿è¯çº¿ç¨å®å¨ï¼å¿é¡»å¨æ¹æ³è°ç¨ç«¯åé¢å¤çåæ­¥æªæ½ï¼å¦ä¸é¢æç¤ºï¼\n\npublic class VectorDemo2 {\n\n    static Vector<Integer> vector = new Vector<Integer>();\n\n    public static void main(String[] args) {\n        while (true) {\n            for (int i = 0; i < 10; i++) {\n                vector.add(i);\n            }\n\n            Thread thread1 = new Thread() {\n                @Override\n                public void run() {\n                    synchronized (VectorDemo2.class) {   //è¿è¡é¢å¤çåæ­¥\n                        for (int i = 0; i < vector.size(); i++) {\n                            vector.remove(i);\n                        }\n                    }\n                }\n            };\n\n            Thread thread2 = new Thread() {\n                @Override\n                public void run() {\n                    synchronized (VectorDemo2.class) {\n                        for (int i = 0; i < vector.size(); i++) {\n                            vector.get(i);\n                        }\n                    }\n                }\n            };\n\n            thread1.start();\n            thread2.start();\n\n            while (Thread.activeCount() > 10) {\n                System.out.println("åæ¶å­å¨ 10 ä¸ªä»¥ä¸çº¿ç¨ï¼éåº");\n                return;\n            }\n        }\n    }\n\n}\n\n\nConcurrentModificationException å¼å¸¸\n\nå¨å¯¹ Vector ç­å®¹å¨å¹¶åå°è¿è¡è¿­ä»£ä¿®æ¹æ¶ï¼ä¼æ¥ ConcurrentModificationException å¼å¸¸ï¼å³äºè¿ä¸ªå¼å¸¸å°ä¼å¨åç»­æç« ä¸­è®²è¿°ã\n\nä½æ¯å¨å¹¶åå®¹å¨ä¸­ä¸ä¼åºç°è¿ä¸ªé®é¢ã\n\n\n# å¹¶åå®¹å¨ç®ä»\n\nåæ­¥å®¹å¨å°ææå¯¹å®¹å¨ç¶æçè®¿é®é½ä¸²è¡åï¼ä»¥ä¿è¯çº¿ç¨å®å¨æ§ï¼è¿ç§ç­ç¥ä¼ä¸¥ééä½å¹¶åæ§ã\n\nJava 1.5 åæä¾äºå¤ç§å¹¶åå®¹å¨ï¼ä½¿ç¨å¹¶åå®¹å¨æ¥æ¿ä»£åæ­¥å®¹å¨ï¼å¯ä»¥æå¤§å°æé«ä¼¸ç¼©æ§å¹¶éä½é£é©ã\n\nJ.U.C åä¸­æä¾äºå ä¸ªéå¸¸æç¨çå¹¶åå®¹å¨ä½ä¸ºçº¿ç¨å®å¨çå®¹å¨ï¼\n\nå¹¶åå®¹å¨                    å¯¹åºçæ®éå®¹å¨     æè¿°\nConcurrentHashMap       HashMap     Java 1.8 ä¹åéç¨åæ®µéæºå¶ç»åéç²åº¦ï¼éä½é»å¡ï¼ä»èæé«å¹¶åæ§ï¼Java 1.8 ä¹ååºäº CAS å®ç°ã\nConcurrentSkipListMap   SortedMap   åºäºè·³è¡¨å®ç°ç\nCopyOnWriteArrayList    ArrayList   \nCopyOnWriteArraySet     Set         åºäº CopyOnWriteArrayList å®ç°ã\nConcurrentSkipListSet   SortedSet   åºäº ConcurrentSkipListMap å®ç°ã\nConcurrentLinkedQueue   Queue       çº¿ç¨å®å¨çæ çéåãåºå±éç¨åé¾è¡¨ãæ¯æ FIFOã\nConcurrentLinkedDeque   Deque       çº¿ç¨å®å¨çæ çåç«¯éåãåºå±éç¨ååé¾è¡¨ãæ¯æ FIFO å FILOã\nArrayBlockingQueue      Queue       æ°ç»å®ç°çé»å¡éåã\nLinkedBlockingQueue     Queue       é¾è¡¨å®ç°çé»å¡éåã\nLinkedBlockingDeque     Deque       ååé¾è¡¨å®ç°çåç«¯é»å¡éåã\n\nJ.U.C åä¸­æä¾çå¹¶åå®¹å¨å½åä¸è¬åä¸ºä¸ç±»ï¼\n\n * Concurrent\n   * è¿ç±»åçéç«äºç¸å¯¹äº CopyOnWrite è¦é«ä¸äºï¼ä½åæä½ä»£ä»·è¦å°ä¸äºã\n   * æ­¤å¤ï¼Concurrent å¾å¾æä¾äºè¾ä½çéåä¸è´æ§ï¼å³ï¼å½å©ç¨è¿­ä»£å¨éåæ¶ï¼å¦æå®¹å¨åçä¿®æ¹ï¼è¿­ä»£å¨ä»ç¶å¯ä»¥ç»§ç»­è¿è¡éåãä»£ä»·å°±æ¯ï¼å¨è·åå®¹å¨å¤§å° size() ï¼å®¹å¨æ¯å¦ä¸ºç©ºç­æ¹æ³ï¼ä¸ä¸å®å®å¨ç²¾ç¡®ï¼ä½è¿æ¯ä¸ºäºè·åå¹¶åååéçè®¾è®¡åèï¼å¯ä»¥çè§£ãä¸ä¹ç¸æ¯ï¼å¦ææ¯ä½¿ç¨åæ­¥å®¹å¨ï¼å°±ä¼åºç° fail-fast é®é¢ï¼å³ï¼æ£æµå°å®¹å¨å¨éåè¿ç¨ä¸­åçäºä¿®æ¹ï¼åæåº ConcurrentModificationExceptionï¼ä¸åç»§ç»­éåã\n * CopyOnWrite - ä¸ä¸ªçº¿ç¨åï¼å¤ä¸ªçº¿ç¨è¯»ãè¯»æä½æ¶ä¸å éï¼åæä½æ¶éè¿å¨å¯æ¬ä¸å éä¿è¯å¹¶åå®å¨ï¼ç©ºé´å¼éè¾å¤§ã\n * Blocking - åé¨å®ç°ä¸è¬æ¯åºäºéï¼æä¾é»å¡éåçè½åã\n\nâ éè¯¯ç¤ºä¾ï¼äº§ç ConcurrentModificationException å¼å¸¸ï¼\n\npublic void removeKeys(Map<String, Object> map, final String... keys) {\n    map.keySet().removeIf(key -> ArrayUtil.contains(keys, key));\n}\n\n\nâ éè¯¯ç¤ºä¾ï¼äº§ç ConcurrentModificationException å¼å¸¸ï¼\n\npublic static <K, V> Map<K, V> removeKeys(Map<String, Object> map, final String... keys) {\n\tfor (K key : keys) {\n\t\tmap.remove(key);\n\t}\n\treturn map;\n}\n\n\n\n# å¹¶ååºæ¯ä¸ç Map\n\nå¦æå¯¹æ°æ®æå¼ºä¸è´è¦æ±ï¼åéä½¿ç¨ Hashtableï¼å¨å¤§é¨ååºæ¯éå¸¸é½æ¯å¼±ä¸è´æ§çæåµä¸ï¼ä½¿ç¨ ConcurrentHashMap å³å¯ï¼å¦ææ°æ®éå¨åä¸çº§å«ï¼ä¸å­å¨å¤§éå¢å æ¹æä½ï¼åå¯ä»¥èèä½¿ç¨ ConcurrentSkipListMapã\n\n\n# å¹¶ååºæ¯ä¸ç List\n\nè¯»å¤åå°ç¨ CopyOnWriteArrayListã\n\nåå¤è¯»å°ç¨ ConcurrentLinkedQueue ï¼ä½ç±äºæ¯æ ççï¼è¦æå®¹ééå¶ï¼é¿åæ éè¨èï¼å¯¼è´åå­æº¢åºã\n\n\n# Map\n\nMap æ¥å£çä¸¤ä¸ªå®ç°æ¯ ConcurrentHashMap å ConcurrentSkipListMapï¼å®ä»¬ä»åºç¨çè§åº¦æ¥çï¼ä¸»è¦åºå«å¨äºConcurrentHashMap ç key æ¯æ åºçï¼è ConcurrentSkipListMap ç key æ¯æåºçãæä»¥å¦æä½ éè¦ä¿è¯ key çé¡ºåºï¼å°±åªè½ä½¿ç¨ ConcurrentSkipListMapã\n\nä½¿ç¨ ConcurrentHashMap å ConcurrentSkipListMap éè¦æ³¨æçå°æ¹æ¯ï¼å®ä»¬ç key å value é½ä¸è½ä¸ºç©ºï¼å¦åä¼æåºNullPointerExceptionè¿ä¸ªè¿è¡æ¶å¼å¸¸ã\n\n\n# ConcurrentHashMap\n\nConcurrentHashMap æ¯çº¿ç¨å®å¨ç HashMap ï¼ç¨äºæ¿ä»£ Hashtableã\n\n# ConcurrentHashMap çç¹æ§\n\nConcurrentHashMap å®ç°äº ConcurrentMap æ¥å£ï¼è ConcurrentMap æ¥å£æ©å±äº Map æ¥å£ã\n\npublic class ConcurrentHashMap<K,V> extends AbstractMap<K,V>\n    implements ConcurrentMap<K,V>, Serializable {\n    // ...\n}\n\n\nConcurrentHashMap çå®ç°åå«äº HashMap ææçåºæ¬ç¹æ§ï¼å¦ï¼æ°æ®ç»æãè¯»åç­ç¥ç­ã\n\nConcurrentHashMap æ²¡æå®ç°å¯¹ Map å éä»¥æä¾ç¬å è®¿é®ãå æ­¤æ æ³éè¿å¨å®¢æ·ç«¯å éçæ¹å¼æ¥åå»ºæ°çåå­æä½ãä½æ¯ï¼ä¸äºå¸¸è§çå¤åæä½ï¼å¦ï¼âè¥æ²¡æåæ·»å âãâè¥ç¸ç­åç§»é¤âãâè¥ç¸ç­åæ¿æ¢âï¼é½å·²ç»å®ç°ä¸ºåå­æä½ï¼å¹¶ä¸æ¯å´ç» ConcurrentMap çæ©å±æ¥å£èå®ç°ã\n\npublic interface ConcurrentMap<K, V> extends Map<K, V> {\n\n    // ä»å½ K æ²¡æç¸åºçæ å°å¼ææå¥\n    V putIfAbsent(K key, V value);\n\n    // ä»å½ K è¢«æ å°å° V æ¶æç§»é¤\n    boolean remove(Object key, Object value);\n\n    // ä»å½ K è¢«æ å°å° oldValue æ¶ææ¿æ¢ä¸º newValue\n    boolean replace(K key, V oldValue, V newValue);\n\n    // ä»å½ K è¢«æ å°å°æä¸ªå¼æ¶ææ¿æ¢ä¸º newValue\n    V replace(K key, V value);\n}\n\n\nä¸åäº Hashtableï¼ConcurrentHashMap æä¾çè¿­ä»£å¨ä¸ä¼æåº ConcurrentModificationExceptionï¼å æ­¤ä¸éè¦å¨è¿­ä»£è¿ç¨ä¸­å¯¹å®¹å¨å éã\n\n> ð æ³¨æï¼ä¸äºéè¦å¯¹æ´ä¸ª Map è¿è¡è®¡ç®çæ¹æ³ï¼å¦ size å isEmpty ï¼ç±äºè¿åçç»æå¨è®¡ç®æ¶å¯è½å·²ç»è¿æï¼æä»¥å¹¶éå®æ¶çç²¾ç¡®å¼ãè¿æ¯ä¸ç§ç­ç¥ä¸çæè¡¡ï¼å¨å¹¶åç¯å¢ä¸ï¼è¿ç±»æ¹æ³ç±äºæ»å¨ä¸æ­ååï¼æä»¥è·åå¶å®æ¶ç²¾ç¡®å¼çæä¹ä¸å¤§ãConcurrentHashMap å¼±åè¿ç±»æ¹æ³ï¼ä»¥æ¢åæ´éè¦æä½ï¼å¦ï¼getãputãcontainesKeyãremove ç­ï¼çæ§è½ã\n\n# ConcurrentHashMap çç¨æ³\n\nç¤ºä¾ï¼ä¸ä¼åºç° ConcurrentModificationException\n\nConcurrentHashMap çåºæ¬æä½ä¸ HashMap çç¨æ³åºæ¬ä¸æ ·ãä¸åäº HashMapãHashtableï¼ConcurrentHashMap æä¾çè¿­ä»£å¨ä¸ä¼æåº ConcurrentModificationExceptionï¼å æ­¤ä¸éè¦å¨è¿­ä»£è¿ç¨ä¸­å¯¹å®¹å¨å éã\n\npublic class ConcurrentHashMapDemo {\n\n    public static void main(String[] args) throws InterruptedException {\n\n        // HashMap å¨å¹¶åè¿­ä»£è®¿é®æ¶ä¼æåº ConcurrentModificationException å¼å¸¸\n        // Map<Integer, Character> map = new HashMap<>();\n        Map<Integer, Character> map = new ConcurrentHashMap<>();\n\n        Thread wthread = new Thread(() -> {\n            System.out.println("åæä½çº¿ç¨å¼å§æ§è¡");\n            for (int i = 0; i < 26; i++) {\n                map.put(i, (char) (\'a\' + i));\n            }\n        });\n        Thread rthread = new Thread(() -> {\n            System.out.println("è¯»æä½çº¿ç¨å¼å§æ§è¡");\n            for (Integer key : map.keySet()) {\n                System.out.println(key + " - " + map.get(key));\n            }\n        });\n        wthread.start();\n        rthread.start();\n        Thread.sleep(1000);\n    }\n}\n\n\n# ConcurrentHashMap çåç\n\n> ConcurrentHashMap ä¸ç´å¨æ¼è¿ï¼å°¤å¶å¨ Java 1.7 å Java 1.8ï¼å¶æ°æ®ç»æåå¹¶åæºå¶æå¾å¤§çå·®å¼ã\n\n * Java 1.7\n   * æ°æ®ç»æï¼æ°ç»ï¼åé¾è¡¨\n   * å¹¶åæºå¶ï¼éç¨åæ®µéæºå¶ç»åéç²åº¦ï¼éä½é»å¡ï¼ä»èæé«å¹¶åæ§ã\n * Java 1.8\n   * æ°æ®ç»æï¼æ°ç»ï¼åé¾è¡¨ï¼çº¢é»æ \n   * å¹¶åæºå¶ï¼åæ¶åæ®µéï¼ä¹ååºäº CAS + synchronized å®ç°ã\n\n# Java 1.7 çå®ç°\n\nåæ®µéï¼æ¯å°åé¨è¿è¡åæ®µï¼Segmentï¼ï¼éé¢æ¯ HashEntry æ°ç»ï¼å HashMap ç±»ä¼¼ï¼åå¸ç¸åçæ¡ç®ä¹æ¯ä»¥é¾è¡¨å½¢å¼å­æ¾ã HashEntry åé¨ä½¿ç¨ volatile ç value å­æ®µæ¥ä¿è¯å¯è§æ§ï¼ä¹å©ç¨äºä¸å¯åå¯¹è±¡çæºå¶ï¼ä»¥æ¹è¿å©ç¨ Unsafe æä¾çåºå±è½åï¼æ¯å¦ volatile accessï¼å»ç´æ¥å®æé¨åæä½ï¼ä»¥æä¼åæ§è½ï¼æ¯ç« Unsafe ä¸­çå¾å¤æä½é½æ¯ JVM intrinsic ä¼åè¿çã\n\n\n\nå¨è¿è¡å¹¶ååæä½æ¶ï¼ConcurrentHashMap ä¼è·åå¯éå¥éï¼ReentrantLockï¼ï¼ä»¥ä¿è¯æ°æ®ä¸è´æ§ãæä»¥ï¼å¨å¹¶åä¿®æ¹æé´ï¼ç¸åº Segment æ¯è¢«éå®çã\n\npublic class ConcurrentHashMap<K, V> extends AbstractMap<K, V>\n        implements ConcurrentMap<K, V>, Serializable {\n\n    // å°æ´ä¸ªhashmapåæå ä¸ªå°çmapï¼æ¯ä¸ªsegmenté½æ¯ä¸ä¸ªéï¼ä¸hashtableç¸æ¯ï¼è¿ä¹è®¾è®¡çç®çæ¯å¯¹äºput, removeç­æä½ï¼å¯ä»¥åå°å¹¶åå²çªï¼å¯¹\n    // ä¸å±äºåä¸ä¸ªçæ®µçèç¹å¯ä»¥å¹¶åæä½ï¼å¤§å¤§æé«äºæ§è½\n    final Segment<K,V>[] segments;\n\n    // æ¬è´¨ä¸Segmentç±»å°±æ¯ä¸ä¸ªå°çhashmapï¼éé¢tableæ°ç»å­å¨äºåä¸ªèç¹çæ°æ®ï¼ç»§æ¿äºReentrantLock, å¯ä»¥ä½ä¸ºäºæéä½¿ç¨\n    static final class Segment<K,V> extends ReentrantLock implements Serializable {\n        transient volatile HashEntry<K,V>[] table;\n        transient int count;\n    }\n\n    // åºæ¬èç¹ï¼å­å¨Keyï¼ Valueå¼\n    static final class HashEntry<K,V> {\n        final int hash;\n        final K key;\n        volatile V value;\n        volatile HashEntry<K,V> next;\n    }\n}\n\n\n# Java 1.8 çå®ç°\n\n * æ°æ®ç»ææ¹è¿ï¼ä¸ HashMap ä¸æ ·ï¼å°åå æ°ç»ï¼åé¾è¡¨ çæ°æ®ç»æï¼åæ´ä¸º æ°ç»ï¼åé¾è¡¨ï¼çº¢é»æ  çç»æãå½åºç°åå¸å²çªæ¶ï¼æ°æ®ä¼å­å¥æ°ç»æå®æ¡¶çåé¾è¡¨ï¼å½é¾è¡¨é¿åº¦è¾¾å° 8ï¼åå°å¶è½¬æ¢ä¸ºçº¢é»æ ç»æï¼è¿æ ·å¶æ¥è¯¢çæ¶é´å¤æåº¦å¯ä»¥éä½å° $$O(logN)$$ï¼ä»¥æ¹è¿æ§è½ã\n * å¹¶åæºå¶æ¹è¿ï¼\n   * åæ¶ segments å­æ®µï¼ç´æ¥éç¨ transient volatile HashEntry<K,V>[] table ä¿å­æ°æ®ï¼éç¨ table æ°ç»åç´ ä½ä¸ºéï¼ä»èå®ç°äºå¯¹æ¯ä¸è¡æ°æ®è¿è¡å éï¼è¿ä¸æ­¥åå°å¹¶åå²çªçæ¦çã\n   * ä½¿ç¨ CAS + sychronized æä½ï¼å¨ç¹å®åºæ¯è¿è¡æ éå¹¶åæä½ãä½¿ç¨ UnsafeãLongAdder ä¹ç±»åºå±ææ®µï¼è¿è¡æç«¯æåµçä¼åãç°ä»£ JDK ä¸­ï¼synchronized å·²ç»è¢«ä¸æ­ä¼åï¼å¯ä»¥ä¸åè¿åæå¿æ§è½å·®å¼ï¼å¦å¤ï¼ç¸æ¯äº ReentrantLockï¼å®å¯ä»¥åå°åå­æ¶èï¼è¿æ¯ä¸ªéå¸¸å¤§çä¼å¿ã\n\nfinal V putVal(K key, V value, boolean onlyIfAbsent) {\n    if (key == null || value == null) throw new NullPointerException();\n    int hash = spread(key.hashCode());\n    int binCount = 0;\n    for (Node<K,V>[] tab = table;;) {\n        Node<K,V> f; int n, i, fh;\n        // å¦ætableä¸ºç©ºï¼åå§åï¼å¦åï¼æ ¹æ®hashå¼è®¡ç®å¾å°æ°ç»ç´¢å¼iï¼å¦ætab[i]ä¸ºç©ºï¼ç´æ¥æ°å»ºèç¹Nodeå³å¯ãæ³¨ï¼tab[i]å®è´¨ä¸ºé¾è¡¨æèçº¢é»æ çé¦èç¹ã\n        if (tab == null || (n = tab.length) == 0)\n            tab = initTable();\n        else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {\n            if (casTabAt(tab, i, null,\n                         new Node<K,V>(hash, key, value, null)))\n                break;                   // no lock when adding to empty bin\n        }\n        // å¦ætab[i]ä¸ä¸ºç©ºå¹¶ä¸hashå¼ä¸ºMOVEDï¼è¯´æè¯¥é¾è¡¨æ­£å¨è¿è¡transferæä½ï¼è¿åæ©å®¹å®æåçtableã\n        else if ((fh = f.hash) == MOVED)\n            tab = helpTransfer(tab, f);\n        else {\n            V oldVal = null;\n            // éå¯¹é¦ä¸ªèç¹è¿è¡å éæä½ï¼èä¸æ¯segmentï¼è¿ä¸æ­¥åå°çº¿ç¨å²çª\n            synchronized (f) {\n                if (tabAt(tab, i) == f) {\n                    if (fh >= 0) {\n                        binCount = 1;\n                        for (Node<K,V> e = f;; ++binCount) {\n                            K ek;\n                            // å¦æå¨é¾è¡¨ä¸­æ¾å°å¼ä¸ºkeyçèç¹eï¼ç´æ¥è®¾ç½®e.val = valueå³å¯ã\n                            if (e.hash == hash &&\n                                ((ek = e.key) == key ||\n                                 (ek != null && key.equals(ek)))) {\n                                oldVal = e.val;\n                                if (!onlyIfAbsent)\n                                    e.val = value;\n                                break;\n                            }\n                            // å¦ææ²¡ææ¾å°å¼ä¸ºkeyçèç¹ï¼ç´æ¥æ°å»ºNodeå¹¶å å¥é¾è¡¨å³å¯ã\n                            Node<K,V> pred = e;\n                            if ((e = e.next) == null) {\n                                pred.next = new Node<K,V>(hash, key,\n                                                          value, null);\n                                break;\n                            }\n                        }\n                    }\n                    // å¦æé¦èç¹ä¸ºTreeBinç±»åï¼è¯´æä¸ºçº¢é»æ ç»æï¼æ§è¡putTreeValæä½ã\n                    else if (f instanceof TreeBin) {\n                        Node<K,V> p;\n                        binCount = 2;\n                        if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key,\n                                                       value)) != null) {\n                            oldVal = p.val;\n                            if (!onlyIfAbsent)\n                                p.val = value;\n                        }\n                    }\n                }\n            }\n            if (binCount != 0) {\n                // å¦æèç¹æ°>ï¼8ï¼é£ä¹è½¬æ¢é¾è¡¨ç»æä¸ºçº¢é»æ ç»æã\n                if (binCount >= TREEIFY_THRESHOLD)\n                    treeifyBin(tab, i);\n                if (oldVal != null)\n                    return oldVal;\n                break;\n            }\n        }\n    }\n    // è®¡æ°å¢å 1ï¼æå¯è½è§¦åtransferæä½(æ©å®¹)ã\n    addCount(1L, binCount);\n    return null;\n}\n\n\n# ConcurrentHashMap çå®æ\n\n> ç¤ºä¾æèªï¼ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\n# ConcurrentHashMap éè¯¯ç¤ºä¾\n\n    //çº¿ç¨ä¸ªæ°\n    private static int THREAD_COUNT = 10;\n    //æ»åç´ æ°é\n    private static int ITEM_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException {\n        ConcurrentHashMap<String, Long> concurrentHashMap = getData(ITEM_COUNT - 100);\n        //åå§900ä¸ªåç´ \n        System.out.println("init size:" + concurrentHashMap.size());\n        ForkJoinPool forkJoinPool = new ForkJoinPool(THREAD_COUNT);\n        //ä½¿ç¨çº¿ç¨æ± å¹¶åå¤çé»è¾\n        forkJoinPool.execute(() -> IntStream.rangeClosed(1, 10).parallel().forEach(i -> {\n            //æ¥è¯¢è¿éè¦è¡¥åå¤å°ä¸ªåç´ \n            int gap = ITEM_COUNT - concurrentHashMap.size();\n            System.out.println("gap size:" + gap);\n            //è¡¥ååç´ \n            concurrentHashMap.putAll(getData(gap));\n        }));\n        //ç­å¾ææä»»å¡å®æ\n        forkJoinPool.shutdown();\n        forkJoinPool.awaitTermination(1, TimeUnit.HOURS);\n        //æååç´ ä¸ªæ°ä¼æ¯1000åï¼\n        System.out.println("finish size:" + concurrentHashMap.size());\n    }\n\n    private static ConcurrentHashMap<String, Long> getData(int count) {\n        return LongStream.rangeClosed(1, count)\n            .boxed()\n            .collect(\n                Collectors.toConcurrentMap(\n                    i -> UUID.randomUUID().toString(),\n                    i -> i,\n                    (o1, o2) -> o1,\n                    ConcurrentHashMap::new));\n    }\n\n\nåå§å¤§å° 900 ç¬¦åé¢æï¼è¿éè¦å¡«å 100 ä¸ªåç´ ã\n\né¢æç»æä¸º 1000 ä¸ªåç´ ï¼å®éå¤§äº 1000 ä¸ªåç´ ã\n\nãåæã\n\nConcurrentHashMap å¯¹å¤æä¾çæ¹æ³æè½åçéå¶ï¼\n\n * ä½¿ç¨äº ConcurrentHashMapï¼ä¸ä»£è¡¨å¯¹å®çå¤ä¸ªæä½ä¹é´çç¶ææ¯ä¸è´çï¼æ¯æ²¡æå¶ä»çº¿ç¨å¨æä½å®çï¼å¦æéè¦ç¡®ä¿éè¦æå¨å éã\n * è¯¸å¦ sizeãisEmpty å containsValue ç­èåæ¹æ³ï¼å¨å¹¶åæåµä¸å¯è½ä¼åæ  ConcurrentHashMap çä¸­é´ç¶æãå æ­¤å¨å¹¶åæåµä¸ï¼è¿äºæ¹æ³çè¿åå¼åªè½ç¨ä½åèï¼èä¸è½ç¨äºæµç¨æ§å¶ãæ¾ç¶ï¼å©ç¨ size æ¹æ³è®¡ç®å·®å¼å¼ï¼æ¯ä¸ä¸ªæµç¨æ§å¶ã\n * è¯¸å¦ putAll è¿æ ·çèåæ¹æ³ä¹ä¸è½ç¡®ä¿åå­æ§ï¼å¨ putAll çè¿ç¨ä¸­å»è·åæ°æ®å¯è½ä¼è·åå°é¨åæ°æ®ã\n\n# ConcurrentHashMap éè¯¯ç¤ºä¾ä¿®æ­£ 1.0 ç\n\néè¿ synchronized å éï¼å½ç¶å¯ä»¥ä¿è¯æ°æ®ä¸è´æ§ï¼ä½æ¯çºç²äº ConcurrentHashMap çæ§è½ï¼æ²¡åçæ­£åæ¥åº ConcurrentHashMap çç¹æ§ã\n\n\n    //çº¿ç¨ä¸ªæ°\n    private static int THREAD_COUNT = 10;\n    //æ»åç´ æ°é\n    private static int ITEM_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException {\n        ConcurrentHashMap<String, Long> concurrentHashMap = getData(ITEM_COUNT - 100);\n        //åå§900ä¸ªåç´ \n        System.out.println("init size:" + concurrentHashMap.size());\n        ForkJoinPool forkJoinPool = new ForkJoinPool(THREAD_COUNT);\n        //ä½¿ç¨çº¿ç¨æ± å¹¶åå¤çé»è¾\n        forkJoinPool.execute(() -> IntStream.rangeClosed(1, 10).parallel().forEach(i -> {\n            //æ¥è¯¢è¿éè¦è¡¥åå¤å°ä¸ªåç´ \n            synchronized (concurrentHashMap) {\n                int gap = ITEM_COUNT - concurrentHashMap.size();\n                System.out.println("gap size:" + gap);\n                //è¡¥ååç´ \n                concurrentHashMap.putAll(getData(gap));\n            }\n        }));\n        //ç­å¾ææä»»å¡å®æ\n        forkJoinPool.shutdown();\n        forkJoinPool.awaitTermination(1, TimeUnit.HOURS);\n        //æååç´ ä¸ªæ°ä¼æ¯1000åï¼\n        System.out.println("finish size:" + concurrentHashMap.size());\n    }\n\n    private static ConcurrentHashMap<String, Long> getData(int count) {\n        return LongStream.rangeClosed(1, count)\n            .boxed()\n            .collect(\n                Collectors.toConcurrentMap(\n                    i -> UUID.randomUUID().toString(),\n                    i -> i,\n                    (o1, o2) -> o1,\n                    ConcurrentHashMap::new));\n    }\n\n\n# ConcurrentHashMap éè¯¯ç¤ºä¾ä¿®æ­£ 2.0 ç\n\n\n    //å¾ªç¯æ¬¡æ°\n    private static int LOOP_COUNT = 10000000;\n    //çº¿ç¨ä¸ªæ°\n    private static int THREAD_COUNT = 10;\n    //æ»åç´ æ°é\n    private static int ITEM_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException {\n        StopWatch stopWatch = new StopWatch();\n        stopWatch.start("normaluse");\n        Map<String, Long> normaluse = normaluse();\n        stopWatch.stop();\n        Assert.isTrue(normaluse.size() == ITEM_COUNT, "normaluse size error");\n        Assert.isTrue(normaluse.values().stream()\n                .mapToLong(aLong -> aLong).reduce(0, Long::sum) == LOOP_COUNT\n            , "normaluse count error");\n        stopWatch.start("gooduse");\n        Map<String, Long> gooduse = gooduse();\n        stopWatch.stop();\n        Assert.isTrue(gooduse.size() == ITEM_COUNT, "gooduse size error");\n        Assert.isTrue(gooduse.values().stream()\n                .mapToLong(l -> l)\n                .reduce(0, Long::sum) == LOOP_COUNT\n            , "gooduse count error");\n        System.out.println(stopWatch.prettyPrint());\n    }\n\n    private static Map<String, Long> normaluse() throws InterruptedException {\n        ConcurrentHashMap<String, Long> freqs = new ConcurrentHashMap<>(ITEM_COUNT);\n        ForkJoinPool forkJoinPool = new ForkJoinPool(THREAD_COUNT);\n        forkJoinPool.execute(() -> IntStream.rangeClosed(1, LOOP_COUNT).parallel().forEach(i -> {\n                String key = "item" + ThreadLocalRandom.current().nextInt(ITEM_COUNT);\n                synchronized (freqs) {\n                    if (freqs.containsKey(key)) {\n                        freqs.put(key, freqs.get(key) + 1);\n                    } else {\n                        freqs.put(key, 1L);\n                    }\n                }\n            }\n        ));\n        forkJoinPool.shutdown();\n        forkJoinPool.awaitTermination(1, TimeUnit.HOURS);\n        return freqs;\n    }\n\n    private static Map<String, Long> gooduse() throws InterruptedException {\n        ConcurrentHashMap<String, LongAdder> freqs = new ConcurrentHashMap<>(ITEM_COUNT);\n        ForkJoinPool forkJoinPool = new ForkJoinPool(THREAD_COUNT);\n        forkJoinPool.execute(() -> IntStream.rangeClosed(1, LOOP_COUNT).parallel().forEach(i -> {\n                String key = "item" + ThreadLocalRandom.current().nextInt(ITEM_COUNT);\n                freqs.computeIfAbsent(key, k -> new LongAdder()).increment();\n            }\n        ));\n        forkJoinPool.shutdown();\n        forkJoinPool.awaitTermination(1, TimeUnit.HOURS);\n        return freqs.entrySet().stream()\n            .collect(Collectors.toMap(\n                e -> e.getKey(),\n                e -> e.getValue().longValue())\n            );\n    }\n\n\n\n# List\n\n\n# CopyOnWriteArrayList\n\nCopyOnWriteArrayList æ¯çº¿ç¨å®å¨ç ArrayListãCopyOnWrite å­é¢ææä¸ºåçæ¶åä¼å°å±äº«åéæ°å¤å¶ä¸ä»½åºæ¥ãå¤å¶çå¥½å¤å¨äºè¯»æä½æ¯æ éçï¼ä¹å°±æ¯æ é»å¡ï¼ã\n\nCopyOnWriteArrayList ä»éç¨äºåæä½éå¸¸å°çåºæ¯ï¼èä¸è½å¤å®¹å¿è¯»åçç­æä¸ä¸è´ãå¦æè¯»åæ¯ä¾åè¡¡æèæå¤§éåæä½çè¯ï¼ä½¿ç¨ CopyOnWriteArrayList çæ§è½ä¼éå¸¸ç³ç³ã\n\n# CopyOnWriteArrayList åç\n\nCopyOnWriteArrayList åé¨ç»´æ¤äºä¸ä¸ªæ°ç»ï¼æååé array å°±æåè¿ä¸ªåé¨æ°ç»ï¼ææçè¯»æä½é½æ¯åºäº array è¿è¡çï¼å¦ä¸å¾æç¤ºï¼è¿­ä»£å¨ Iterator éåçå°±æ¯ array æ°ç»ã\n\n\n\n * lock - æ§è¡åæ¶å¤å¶æä½ï¼éè¦ä½¿ç¨å¯éå¥éå é\n * array - å¯¹è±¡æ°ç»ï¼ç¨äºå­æ¾åç´ \n\n    /** The lock protecting all mutators */\n    final transient ReentrantLock lock = new ReentrantLock();\n\n    /** The array, accessed only via getArray/setArray. */\n    private transient volatile Object[] array;\n\n\n\n\nï¼1ï¼è¯»æä½\n\nå¨ CopyOnWriteAarrayList ä¸­ï¼è¯»æä½ä¸åæ­¥ï¼å ä¸ºå®ä»¬å¨åé¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼æä»¥å¤ä¸ªè¿­ä»£å¨å¯ä»¥åæ¶éåèä¸ä¼ç¸äºé»å¡ï¼å¾ 1,2,4ï¼ã\n\nCopyOnWriteArrayList çè¯»æä½æ¯ä¸ç¨å éçï¼æ§è½å¾é«ã\n\npublic E get(int index) {\n    return get(getArray(), index);\n}\nprivate E get(Object[] a, int index) {\n    return (E) a[index];\n}\n\n\nï¼2ï¼åæä½\n\nææçåæä½é½æ¯åæ­¥çãä»ä»¬å¨å¤ä»½æ°ç»ï¼å¾ 3ï¼çå¯æ¬ä¸å·¥ä½ãåæä½å®æåï¼åå¤éµåå°è¢«æ¿æ¢ä¸ºå¤å¶çéµåï¼å¹¶éæ¾éå®ãæ¯ææ°ç»åå¾æåï¼æä»¥æ¿æ¢æ°ç»çè°ç¨æ¯åå­ï¼å¾ 5ï¼ã\n\nåæä½ååå»ºçè¿­ä»£å¨å°è½å¤çå°ä¿®æ¹çç»æï¼å¾ 6,7ï¼ã\n\nåæ¶å¤å¶éåè¿åçè¿­ä»£å¨ä¸ä¼æåº ConcurrentModificationExceptionï¼å ä¸ºå®ä»¬å¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼å¹¶ä¸æ è®ºåç»­çä¿®æ¹ï¼2,4ï¼å¦ä½ï¼é½ä¼åè¿­ä»£å¨åå»ºæ¶é£æ ·å®å¨è¿ååç´ ã\n\næ·»å æä½ - æ·»å çé»è¾å¾ç®åï¼åå°åå®¹å¨ copy ä¸ä»½ï¼ç¶åå¨æ°å¯æ¬ä¸æ§è¡åæä½ï¼ä¹åååæ¢å¼ç¨ãå½ç¶æ­¤è¿ç¨æ¯è¦å éçã\n\npublic boolean add(E e) {\n    //ReentrantLockå éï¼ä¿è¯çº¿ç¨å®å¨\n    final ReentrantLock lock = this.lock;\n    lock.lock();\n    try {\n        Object[] elements = getArray();\n        int len = elements.length;\n        //æ·è´åå®¹å¨ï¼é¿åº¦ä¸ºåå®¹å¨é¿åº¦å ä¸\n        Object[] newElements = Arrays.copyOf(elements, len + 1);\n        //å¨æ°å¯æ¬ä¸æ§è¡æ·»å æä½\n        newElements[len] = e;\n        //å°åå®¹å¨å¼ç¨æåæ°å¯æ¬\n        setArray(newElements);\n        return true;\n    } finally {\n        //è§£é\n        lock.unlock();\n    }\n}\n\n\nå é¤æä½ - å é¤æä½åçï¼å°é¤è¦å é¤åç´ ä¹å¤çå¶ä»åç´ æ·è´å°æ°å¯æ¬ä¸­ï¼ç¶ååæ¢å¼ç¨ï¼å°åå®¹å¨å¼ç¨æåæ°å¯æ¬ãåå±åæä½ï¼éè¦å éã\n\npublic E remove(int index) {\n    //å é\n    final ReentrantLock lock = this.lock;\n    lock.lock();\n    try {\n        Object[] elements = getArray();\n        int len = elements.length;\n        E oldValue = get(elements, index);\n        int numMoved = len - index - 1;\n        if (numMoved == 0)\n            //å¦æè¦å é¤çæ¯åè¡¨æ«ç«¯æ°æ®ï¼æ·è´ålen-1ä¸ªæ°æ®å°æ°å¯æ¬ä¸ï¼ååæ¢å¼ç¨\n            setArray(Arrays.copyOf(elements, len - 1));\n        else {\n            //å¦åï¼å°é¤è¦å é¤åç´ ä¹å¤çå¶ä»åç´ æ·è´å°æ°å¯æ¬ä¸­ï¼å¹¶åæ¢å¼ç¨\n            Object[] newElements = new Object[len - 1];\n            System.arraycopy(elements, 0, newElements, 0, index);\n            System.arraycopy(elements, index + 1, newElements, index,\n                              numMoved);\n            setArray(newElements);\n        }\n        return oldValue;\n    } finally {\n        //è§£é\n        lock.unlock();\n    }\n}\n\n\n# CopyOnWriteArrayList ç¤ºä¾\n\npublic class CopyOnWriteArrayListDemo {\n\n    static class ReadTask implements Runnable {\n\n        List<String> list;\n\n        ReadTask(List<String> list) {\n            this.list = list;\n        }\n\n        public void run() {\n            for (String str : list) {\n                System.out.println(str);\n            }\n        }\n    }\n\n    static class WriteTask implements Runnable {\n\n        List<String> list;\n        int index;\n\n        WriteTask(List<String> list, int index) {\n            this.list = list;\n            this.index = index;\n        }\n\n        public void run() {\n            list.remove(index);\n            list.add(index, "write_" + index);\n        }\n    }\n\n    public void run() {\n        final int NUM = 10;\n        // ArrayList å¨å¹¶åè¿­ä»£è®¿é®æ¶ä¼æåº ConcurrentModificationException å¼å¸¸\n        // List<String> list = new ArrayList<>();\n        CopyOnWriteArrayList<String> list = new CopyOnWriteArrayList<>();\n        for (int i = 0; i < NUM; i++) {\n            list.add("main_" + i);\n        }\n        ExecutorService executorService = Executors.newFixedThreadPool(NUM);\n        for (int i = 0; i < NUM; i++) {\n            executorService.execute(new ReadTask(list));\n            executorService.execute(new WriteTask(list, i));\n        }\n        executorService.shutdown();\n    }\n\n    public static void main(String[] args) {\n        new CopyOnWriteArrayListDemo().run();\n    }\n}\n\n\n# CopyOnWriteArrayList å®æ\n\n@Slf4j\npublic class WrongCopyOnWriteList {\n\n    public static void main(String[] args) {\n        testRead();\n        testWrite();\n    }\n\n    public static Map testWrite() {\n        List<Integer> copyOnWriteArrayList = new CopyOnWriteArrayList<>();\n        List<Integer> synchronizedList = Collections.synchronizedList(new ArrayList<>());\n        StopWatch stopWatch = new StopWatch();\n        int loopCount = 100000;\n        stopWatch.start("Write:copyOnWriteArrayList");\n        IntStream.rangeClosed(1, loopCount)\n            .parallel()\n            .forEach(__ -> copyOnWriteArrayList.add(ThreadLocalRandom.current().nextInt(loopCount)));\n        stopWatch.stop();\n        stopWatch.start("Write:synchronizedList");\n        IntStream.rangeClosed(1, loopCount)\n            .parallel()\n            .forEach(__ -> synchronizedList.add(ThreadLocalRandom.current().nextInt(loopCount)));\n        stopWatch.stop();\n        log.info(stopWatch.prettyPrint());\n        Map result = new HashMap();\n        result.put("copyOnWriteArrayList", copyOnWriteArrayList.size());\n        result.put("synchronizedList", synchronizedList.size());\n        return result;\n    }\n\n    private static void addAll(List<Integer> list) {\n        list.addAll(IntStream.rangeClosed(1, 1000000).boxed().collect(Collectors.toList()));\n    }\n\n    public static Map testRead() {\n        List<Integer> copyOnWriteArrayList = new CopyOnWriteArrayList<>();\n        List<Integer> synchronizedList = Collections.synchronizedList(new ArrayList<>());\n        addAll(copyOnWriteArrayList);\n        addAll(synchronizedList);\n        StopWatch stopWatch = new StopWatch();\n        int loopCount = 1000000;\n        int count = copyOnWriteArrayList.size();\n        stopWatch.start("Read:copyOnWriteArrayList");\n        IntStream.rangeClosed(1, loopCount)\n            .parallel()\n            .forEach(__ -> copyOnWriteArrayList.get(ThreadLocalRandom.current().nextInt(count)));\n        stopWatch.stop();\n        stopWatch.start("Read:synchronizedList");\n        IntStream.range(0, loopCount)\n            .parallel()\n            .forEach(__ -> synchronizedList.get(ThreadLocalRandom.current().nextInt(count)));\n        stopWatch.stop();\n        log.info(stopWatch.prettyPrint());\n        Map result = new HashMap();\n        result.put("copyOnWriteArrayList", copyOnWriteArrayList.size());\n        result.put("synchronizedList", synchronizedList.size());\n        return result;\n    }\n\n}\n\n\nè¯»æ§è½å·®ä¸å¤æ¯åæ§è½çä¸ç¾åã\n\n\n# Set\n\nSet æ¥å£çä¸¤ä¸ªå®ç°æ¯ CopyOnWriteArraySet å ConcurrentSkipListSetï¼ä½¿ç¨åºæ¯å¯ä»¥åèåé¢è®²è¿°ç CopyOnWriteArrayList å ConcurrentSkipListMapï¼å®ä»¬çåçé½æ¯ä¸æ ·çã\n\n\n# Queue\n\nJava å¹¶ååéé¢ Queue è¿ç±»å¹¶åå®¹å¨æ¯æå¤æçï¼ä½ å¯ä»¥ä»ä»¥ä¸ä¸¤ä¸ªç»´åº¦æ¥åç±»ãä¸ä¸ªç»´åº¦æ¯é»å¡ä¸éé»å¡ï¼æè°é»å¡æçæ¯ï¼å½éåå·²æ»¡æ¶ï¼å¥éæä½é»å¡ï¼å½éåå·²ç©ºæ¶ï¼åºéæä½é»å¡ãå¦ä¸ä¸ªç»´åº¦æ¯åç«¯ä¸åç«¯ï¼åç«¯æçæ¯åªè½éå°¾å¥éï¼éé¦åºéï¼èåç«¯æçæ¯éé¦éå°¾çå¯å¥éåºéãJava å¹¶ååéé»å¡éåé½ç¨ Blocking å³é®å­æ è¯ï¼åç«¯éåä½¿ç¨ Queue æ è¯ï¼åç«¯éåä½¿ç¨ Deque æ è¯ã\n\n\n# BlockingQueue\n\nBlockingQueue é¡¾åæä¹ï¼æ¯ä¸ä¸ªé»å¡éåãBlockingQueue åºæ¬é½æ¯åºäºéå®ç°ãå¨ BlockingQueue ä¸­ï¼å½éåå·²æ»¡æ¶ï¼å¥éæä½é»å¡ï¼å½éåå·²ç©ºæ¶ï¼åºéæä½é»å¡ã\n\nBlockingQueue æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface BlockingQueue<E> extends Queue<E> {}\n\n\næ ¸å¿ APIï¼\n\n// è·åå¹¶ç§»é¤éåå¤´ç»ç¹ï¼å¦æå¿è¦ï¼å¶ä¼ç­å¾ç´å°éååºç°åç´ \nE take() throws InterruptedException;\n// æå¥åç´ ï¼å¦æéåå·²æ»¡ï¼åç­å¾ç´å°éååºç°ç©ºé²ç©ºé´\nvoid put(E e) throws InterruptedException;\n\n\nBlockingQueue å¯¹æå¥æä½ãç§»é¤æä½ãè·ååç´ æä½æä¾äºåç§ä¸åçæ¹æ³ç¨äºä¸åçåºæ¯ä¸­ä½¿ç¨ï¼\n\n * æåºå¼å¸¸ï¼\n * è¿åç¹æ®å¼ï¼null æ true/falseï¼åå³äºå·ä½çæä½ï¼ï¼\n * é»å¡ç­å¾æ­¤æä½ï¼ç´å°è¿ä¸ªæä½æåï¼\n * é»å¡ç­å¾æ­¤æä½ï¼ç´å°æåæèè¶æ¶æå®æ¶é´ã\n\næ»ç»å¦ä¸ï¼\n\n          THROWS EXCEPTION   SPECIAL VALUE   BLOCKS           TIMES OUT\nInsert    add(e)             offer(e)        put(e)           offer(e, time, unit)\nRemove    remove()           poll()          take()           poll(time, unit)\nExamine   element()          peek()          not applicable   not applicable\n\nBlockingQueue çåä¸ªå®ç°ç±»é½éµå¾ªäºè¿äºè§åã\n\nBlockingQueue ä¸æ¥å null å¼åç´ ã\n\nJDK æä¾äºä»¥ä¸é»å¡éåï¼\n\n * ArrayBlockingQueue - ä¸ä¸ªç±æ°ç»ç»æç»æçæçé»å¡éåã\n * LinkedBlockingQueue - ä¸ä¸ªç±é¾è¡¨ç»æç»æçæçé»å¡éåã\n * PriorityBlockingQueue - ä¸ä¸ªæ¯æä¼åçº§æåºçæ çé»å¡éåã\n * SynchronousQueue - ä¸ä¸ªä¸å­å¨åç´ çé»å¡éåã\n * DelayQueue - ä¸ä¸ªä½¿ç¨ä¼åçº§éåå®ç°çæ çé»å¡éåã\n * LinkedTransferQueue - ä¸ä¸ªç±é¾è¡¨ç»æç»æçæ çé»å¡éåã\n\nBlockingQueue åºæ¬é½æ¯åºäºéå®ç°ã\n\n\n# PriorityBlockingQueue ç±»\n\nPriorityBlockingQueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class PriorityBlockingQueue<E> extends AbstractQueue<E>\n    implements BlockingQueue<E>, java.io.Serializable {}\n\n\n# PriorityBlockingQueue è¦ç¹\n\n * PriorityBlockingQueue å¯ä»¥è§ä¸º PriorityQueue ççº¿ç¨å®å¨çæ¬ã\n * PriorityBlockingQueue å®ç°äº BlockingQueueï¼ä¹æ¯ä¸ä¸ªé»å¡éåã\n * PriorityBlockingQueue å®ç°äº Serializableï¼æ¯æåºååã\n * PriorityBlockingQueue ä¸æ¥å null å¼åç´ ã\n * PriorityBlockingQueue çæå¥æä½ put æ¹æ³ä¸ä¼ blockï¼å ä¸ºå®æ¯æ çéåï¼take æ¹æ³å¨éåä¸ºç©ºçæ¶åä¼é»å¡ï¼ã\n\n# PriorityBlockingQueue åç\n\nPriorityBlockingQueue æä¸¤ä¸ªéè¦æåï¼\n\nprivate transient Object[] queue;\nprivate final ReentrantLock lock;\n\n\n * queue æ¯ä¸ä¸ª Object æ°ç»ï¼ç¨äºä¿å­ PriorityBlockingQueue çåç´ ã\n * èå¯éå¥é lock åç¨äºå¨æ§è¡æå¥ãå é¤æä½æ¶ï¼ä¿è¯è¿ä¸ªæ¹æ³å¨å½åçº¿ç¨éæ¾éä¹åï¼å¶ä»çº¿ç¨ä¸è½è®¿é®ã\n\nPriorityBlockingQueue çå®¹éè½ç¶æåå§åå¤§å°ï¼ä½æ¯ä¸éå¶å¤§å°ï¼å¦æå½åå®¹éå·²æ»¡ï¼æå¥æ°åç´ æ¶ä¼èªå¨æ©å®¹ã\n\n\n# ArrayBlockingQueue ç±»\n\nArrayBlockingQueue æ¯ç±æ°ç»ç»æç»æçæçé»å¡éåã\n\n# ArrayBlockingQueue è¦ç¹\n\nArrayBlockingQueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class ArrayBlockingQueue<E> extends AbstractQueue<E>\n        implements BlockingQueue<E>, java.io.Serializable {\n    // æ°ç»çå¤§å°å°±å³å®äºéåçè¾¹çï¼æä»¥åå§åæ¶å¿é¡»æå®å®¹é\n    public ArrayBlockingQueue(int capacity) { //... }\n    public ArrayBlockingQueue(int capacity, boolean fair) { //... }\n    public ArrayBlockingQueue(int capacity, boolean fair, Collection<? extends E> c) { //... }\n}\n\n\nè¯´æï¼\n\n * ArrayBlockingQueue å®ç°äº BlockingQueueï¼ä¹æ¯ä¸ä¸ªé»å¡éåã\n * ArrayBlockingQueue å®ç°äº Serializableï¼æ¯æåºååã\n * ArrayBlockingQueue æ¯åºäºæ°ç»å®ç°çæçé»å¡éåãæä»¥åå§åæ¶å¿é¡»æå®å®¹éã\n\n# ArrayBlockingQueue åç\n\nArrayBlockingQueue çéè¦æåå¦ä¸ï¼\n\n// ç¨äºå­æ¾åç´ çæ°ç»\nfinal Object[] items;\n// ä¸ä¸æ¬¡è¯»åæä½çä½ç½®\nint takeIndex;\n// ä¸ä¸æ¬¡åå¥æä½çä½ç½®\nint putIndex;\n// éåä¸­çåç´ æ°é\nint count;\n\n// ä»¥ä¸å ä¸ªå°±æ¯æ§å¶å¹¶åç¨çåæ­¥å¨\nfinal ReentrantLock lock;\nprivate final Condition notEmpty;\nprivate final Condition notFull;\n\n\nArrayBlockingQueue åé¨ä»¥ final çæ°ç»ä¿å­æ°æ®ï¼æ°ç»çå¤§å°å°±å³å®äºéåçè¾¹çã\n\nArrayBlockingQueue å®ç°å¹¶ååæ­¥çåçå°±æ¯ï¼è¯»æä½ååæä½é½éè¦è·åå° AQS ç¬å éæè½è¿è¡æä½ã\n\n * å¦æéåä¸ºç©ºï¼è¿ä¸ªæ¶åè¯»æä½ççº¿ç¨è¿å¥å°è¯»çº¿ç¨éåæéï¼ç­å¾åçº¿ç¨åå¥æ°çåç´ ï¼ç¶åå¤éè¯»çº¿ç¨éåçç¬¬ä¸ä¸ªç­å¾çº¿ç¨ã\n * å¦æéåå·²æ»¡ï¼è¿ä¸ªæ¶ååæä½ççº¿ç¨è¿å¥å°åçº¿ç¨éåæéï¼ç­å¾è¯»çº¿ç¨å°éååç´ ç§»é¤ï¼ç¶åå¤éåçº¿ç¨éåçç¬¬ä¸ä¸ªç­å¾çº¿ç¨ã\n\nå¯¹äº ArrayBlockingQueueï¼æä»¬å¯ä»¥å¨æé çæ¶åæå®ä»¥ä¸ä¸ä¸ªåæ°ï¼\n\n * éåå®¹éï¼å¶éå¶äºéåä¸­æå¤åè®¸çåç´ ä¸ªæ°ï¼\n * æå®ç¬å éæ¯å¬å¹³éè¿æ¯éå¬å¹³éãéå¬å¹³éçååéæ¯è¾é«ï¼å¬å¹³éå¯ä»¥ä¿è¯æ¯æ¬¡é½æ¯ç­å¾æä¹ççº¿ç¨è·åå°éï¼\n * å¯ä»¥æå®ç¨ä¸ä¸ªéåæ¥åå§åï¼å°æ­¤éåä¸­çåç´ å¨æé æ¹æ³æé´å°±åæ·»å å°éåä¸­ã\n\n\n# LinkedBlockingQueue ç±»\n\nLinkedBlockingQueue æ¯ç±é¾è¡¨ç»æç»æçæçé»å¡éåãå®¹æè¢«è¯¯è§£ä¸ºæ è¾¹çï¼ä½å¶å®å¶è¡ä¸ºååé¨ä»£ç é½æ¯åºäºæççé»è¾å®ç°çï¼åªä¸è¿å¦ææä»¬æ²¡æå¨åå»ºéåæ¶å°±æå®å®¹éï¼é£ä¹å¶å®¹ééå¶å°±èªå¨è¢«è®¾ç½®ä¸º Integer.MAX_VALUEï¼æä¸ºäºæ çéåã\n\n# LinkedBlockingQueue è¦ç¹\n\nLinkedBlockingQueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class LinkedBlockingQueue<E> extends AbstractQueue<E>\n        implements BlockingQueue<E>, java.io.Serializable {}\n\n\n * LinkedBlockingQueue å®ç°äº BlockingQueueï¼ä¹æ¯ä¸ä¸ªé»å¡éåã\n * LinkedBlockingQueue å®ç°äº Serializableï¼æ¯æåºååã\n * LinkedBlockingQueue æ¯åºäºåé¾è¡¨å®ç°çé»å¡éåï¼å¯ä»¥å½åæ çéåä¹å¯ä»¥å½åæçéåæ¥ä½¿ç¨ã\n * LinkedBlockingQueue ä¸­åç´ æç§æå¥é¡ºåºä¿å­ï¼FIFOï¼ã\n\n# LinkedBlockingQueue åç\n\nLinkedBlockingQueue ä¸­çéè¦æ°æ®ç»æï¼\n\n// éåå®¹é\nprivate final int capacity;\n// éåä¸­çåç´ æ°é\nprivate final AtomicInteger count = new AtomicInteger(0);\n// éå¤´\nprivate transient Node<E> head;\n// éå°¾\nprivate transient Node<E> last;\n\n// take, poll, peek ç­è¯»æä½çæ¹æ³éè¦è·åå°è¿ä¸ªé\nprivate final ReentrantLock takeLock = new ReentrantLock();\n// å¦æè¯»æä½çæ¶åéåæ¯ç©ºçï¼é£ä¹ç­å¾ notEmpty æ¡ä»¶\nprivate final Condition notEmpty = takeLock.newCondition();\n// put, offer ç­åæä½çæ¹æ³éè¦è·åå°è¿ä¸ªé\nprivate final ReentrantLock putLock = new ReentrantLock();\n// å¦æåæä½çæ¶åéåæ¯æ»¡çï¼é£ä¹ç­å¾ notFull æ¡ä»¶\nprivate final Condition notFull = putLock.newCondition();\n\n\nè¿éç¨äºä¸¤å¯¹ Lock å Conditionï¼ç®åä»ç»å¦ä¸ï¼\n\n * takeLock å notEmpty æ­éï¼å¦æè¦è·åï¼takeï¼ä¸ä¸ªåç´ ï¼éè¦è·å takeLock éï¼ä½æ¯è·åäºéè¿ä¸å¤ï¼å¦æéåæ­¤æ¶ä¸ºç©ºï¼è¿éè¦éåä¸ä¸ºç©ºï¼notEmptyï¼è¿ä¸ªæ¡ä»¶ï¼Conditionï¼ã\n * putLock éè¦å notFull æ­éï¼å¦æè¦æå¥ï¼putï¼ä¸ä¸ªåç´ ï¼éè¦è·å putLock éï¼ä½æ¯è·åäºéè¿ä¸å¤ï¼å¦æéåæ­¤æ¶å·²æ»¡ï¼è¿éè¦éåä¸æ¯æ»¡çï¼notFullï¼è¿ä¸ªæ¡ä»¶ï¼Conditionï¼ã\n\n\n# SynchronousQueue ç±»\n\nSynchronousQueue æ¯ä¸å­å¨åç´ çé»å¡éåãæ¯ä¸ªå é¤æä½é½è¦ç­å¾æå¥æä½ï¼åä¹æ¯ä¸ªæå¥æä½ä¹é½è¦ç­å¾å é¤å¨ä½ãé£ä¹è¿ä¸ªéåçå®¹éæ¯å¤å°å¢ï¼æ¯ 1 åï¼å¶å®ä¸æ¯çï¼å¶åé¨å®¹éæ¯ 0ã\n\nSynchronousQueue å®ä¹å¦ä¸ï¼\n\npublic class SynchronousQueue<E> extends AbstractQueue<E>\n    implements BlockingQueue<E>, java.io.Serializable {}\n\n\nSynchronousQueue è¿ä¸ªç±»ï¼å¨çº¿ç¨æ± çå®ç°ç±» ScheduledThreadPoolExecutor ä¸­å¾å°äºåºç¨ã\n\nSynchronousQueue çéåå¶å®æ¯èçï¼å³éåå®¹éä¸º 0ãæ°æ®å¿é¡»ä»æä¸ªåçº¿ç¨äº¤ç»æä¸ªè¯»çº¿ç¨ï¼èä¸æ¯åå°æä¸ªéåä¸­ç­å¾è¢«æ¶è´¹ã\n\nSynchronousQueue ä¸­ä¸è½ä½¿ç¨ peek æ¹æ³ï¼å¨è¿éè¿ä¸ªæ¹æ³ç´æ¥è¿å nullï¼ï¼peek æ¹æ³çè¯­ä¹æ¯åªè¯»åä¸ç§»é¤ï¼æ¾ç¶ï¼è¿ä¸ªæ¹æ³çè¯­ä¹æ¯ä¸ç¬¦å SynchronousQueue çç¹å¾çã\n\nSynchronousQueue ä¹ä¸è½è¢«è¿­ä»£ï¼å ä¸ºæ ¹æ¬å°±æ²¡æåç´ å¯ä»¥æ¿æ¥è¿­ä»£çã\n\nè½ç¶ SynchronousQueue é´æ¥å°å®ç°äº Collection æ¥å£ï¼ä½æ¯å¦æä½ å°å¶å½å Collection æ¥ç¨çè¯ï¼é£ä¹éåæ¯ç©ºçã\n\nå½ç¶ï¼SynchronousQueue ä¹ä¸åè®¸ä¼ é null å¼çï¼å¹¶ååä¸­çå®¹å¨ç±»å¥½åé½ä¸æ¯ææå¥ null å¼ï¼å ä¸º null å¼å¾å¾ç¨ä½å¶ä»ç¨éï¼æ¯å¦ç¨äºæ¹æ³çè¿åå¼ä»£è¡¨æä½å¤±è´¥ï¼ã\n\n\n# ConcurrentLinkedDeque ç±»\n\nDeque çä¾§éç¹æ¯æ¯æå¯¹éåå¤´å°¾é½è¿è¡æå¥åå é¤ï¼æä»¥æä¾äºç¹å®çæ¹æ³ï¼å¦:\n\n * å°¾é¨æå¥æ¶éè¦ç addLast(e)ãofferLast(e)ã\n * å°¾é¨å é¤æéè¦ç removeLast()ãpollLast()ã\n\n\n# Queue çå¹¶ååºç¨\n\nQueue è¢«å¹¿æ³ä½¿ç¨å¨çäº§è - æ¶è´¹èåºæ¯ãèå¨å¹¶ååºæ¯ï¼å©ç¨ BlockingQueue çé»å¡æºå¶ï¼å¯ä»¥åå°å¾å¤å¹¶ååè°å·¥ä½ã\n\nè¿ä¹å¤å¹¶å Queue çå®ç°ï¼å¦ä½éæ©å¢ï¼\n\n * èèåºç¨åºæ¯ä¸­å¯¹éåè¾¹ççè¦æ±ãArrayBlockingQueue æ¯ææç¡®çå®¹ééå¶çï¼è LinkedBlockingQueue ååå³äºæä»¬æ¯å¦å¨åå»ºæ¶æå®ï¼SynchronousQueue åå¹²èä¸è½ç¼å­ä»»ä½åç´ ã\n * ä»ç©ºé´å©ç¨è§åº¦ï¼æ°ç»ç»æç ArrayBlockingQueue è¦æ¯ LinkedBlockingQueue ç´§åï¼å ä¸ºå¶ä¸éè¦åå»ºæè°èç¹ï¼ä½æ¯å¶åå§åéé¶æ®µå°±éè¦ä¸æ®µè¿ç»­çç©ºé´ï¼æä»¥åå§åå­éæ±æ´å¤§ã\n * éç¨åºæ¯ä¸­ï¼LinkedBlockingQueue çååéä¸è¬ä¼äº ArrayBlockingQueueï¼å ä¸ºå®å®ç°äºæ´å ç»ç²åº¦çéæä½ã\n * ArrayBlockingQueue å®ç°æ¯è¾ç®åï¼æ§è½æ´å¥½é¢æµï¼å±äºè¡¨ç°ç¨³å®çâéæâã\n * å¯è½ä»¤äººæå¤çæ¯ï¼å¾å¤æ¶å SynchronousQueue çæ§è½è¡¨ç°ï¼å¾å¾å¤§å¤§è¶è¿å¶ä»å®ç°ï¼å°¤å¶æ¯å¨éååç´ è¾å°çåºæ¯ã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * https://blog.csdn.net/u010425776/article/details/54890215\n * https://blog.csdn.net/wangxiaotongfan/article/details/52074160\n * https://my.oschina.net/hosee/blog/675884\n * https://www.jianshu.com/p/c0642afe03e0\n * https://www.jianshu.com/p/f6730d5784ad\n * http://www.javarticles.com/2012/06/copyonwritearraylist.html\n * https://www.cnblogs.com/xrq730/p/5020760.html\n * https://www.cnblogs.com/leesf456/p/5547853.html\n * http://www.cnblogs.com/chengxiao/p/6881974.html\n * http://www.cnblogs.com/dolphin0520/p/3933404.html\n * HashMap? ConcurrentHashMap? ç¸ä¿¡çå®è¿ç¯æ²¡äººè½é¾ä½ä½ ï¼',normalizedContent:'# java å¹¶ååå®¹å¨\n\n\n# åæ­¥å®¹å¨\n\n\n# åæ­¥å®¹å¨ç®ä»\n\nå¨ java ä¸­ï¼åæ­¥å®¹å¨ä¸»è¦åæ¬ 2 ç±»ï¼\n\n * vectorãstackãhashtable\n   * vector - vector å®ç°äº list æ¥å£ãvector å®éä¸å°±æ¯ä¸ä¸ªæ°ç»ï¼å arraylist ç±»ä¼¼ãä½æ¯ vector ä¸­çæ¹æ³é½æ¯ synchronized æ¹æ³ï¼å³è¿è¡äºåæ­¥æªæ½ã\n   * stack - stack ä¹æ¯ä¸ä¸ªåæ­¥å®¹å¨ï¼å®çæ¹æ³ä¹ç¨ synchronized è¿è¡äºåæ­¥ï¼å®å®éä¸æ¯ç»§æ¿äº vector ç±»ã\n   * hashtable- hashtable å®ç°äº map æ¥å£ï¼å®å hashmap å¾ç¸ä¼¼ï¼ä½æ¯ hashtable è¿è¡äºåæ­¥å¤çï¼è hashmap æ²¡æã\n * collections ç±»ä¸­æä¾çéæå·¥åæ¹æ³åå»ºçç±»ï¼ç± collections.synchronizedxxx ç­æ¹æ³ï¼\n\n\n# åæ­¥å®¹å¨çé®é¢\n\nåæ­¥å®¹å¨çåæ­¥åçå°±æ¯å¨å¶ getãsetãsize ç­ä¸»è¦æ¹æ³ä¸ç¨ synchronized ä¿®é¥°ã synchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\n> æ³è¯¦ç»äºè§£ synchronized ç¨æ³ååçå¯ä»¥åèï¼java å¹¶åæ ¸å¿æºå¶\n\n# æ§è½é®é¢\n\nsynchronized çäºæ¥åæ­¥ä¼äº§çé»å¡åå¤éçº¿ç¨çå¼éãæ¾ç¶ï¼è¿ç§æ¹å¼æ¯æ²¡æä½¿ç¨ synchronized çå®¹å¨æ§è½è¦å·®å¾å¤ã\n\n> æ³¨ï¼å°¤å¶æ¯å¨ java 1.6 æ²¡æå¯¹ synchronized è¿è¡ä¼ååï¼é»å¡å¼éå¾é«ã\n\n# å®å¨é®é¢\n\nåæ­¥å®¹å¨ççç»å¯¹å®å¨åï¼\n\nå¶å®ä¹æªå¿ãå¨åå¤åæä½ï¼éåå­æä½ï¼æ¶ï¼ä»ç¶éè¦å éæ¥ä¿æ¤ãå¸¸è§å¤åæä½å¦ä¸ï¼\n\n * è¿­ä»£ï¼åå¤è®¿é®åç´ ï¼ç´å°éåå®å¨é¨åç´ ï¼\n * è·³è½¬ï¼æ ¹æ®æå®é¡ºåºå¯»æ¾å½ååç´ çä¸ä¸ä¸ªï¼ä¸ n ä¸ªï¼åç´ ï¼\n * æ¡ä»¶è¿ç®ï¼ä¾å¦è¥æ²¡æåæ·»å ç­ï¼\n\nâ ä¸å®å¨çç¤ºä¾\n\npublic class vectordemo {\n\n    static vector<integer> vector = new vector<>();\n\n    public static void main(string[] args) {\n        while (true) {\n            vector.clear();\n\n            for (int i = 0; i < 10; i++) {\n                vector.add(i);\n            }\n\n            thread thread1 = new thread() {\n                @override\n                public void run() {\n                    for (int i = 0; i < vector.size(); i++) {\n                        vector.remove(i);\n                    }\n                }\n            };\n\n            thread thread2 = new thread() {\n                @override\n                public void run() {\n                    for (int i = 0; i < vector.size(); i++) {\n                        vector.get(i);\n                    }\n                }\n            };\n\n            thread1.start();\n            thread2.start();\n\n            while (thread.activecount() > 10) {\n                system.out.println("åæ¶å­å¨ 10 ä¸ªä»¥ä¸çº¿ç¨ï¼éåº");\n                return;\n            }\n        }\n    }\n\n}\n\n\nä»¥ä¸ç¨åºæ§è¡æ¶å¯è½ä¼åºç°æ°ç»è¶çéè¯¯ã\n\nvector æ¯çº¿ç¨å®å¨çï¼é£ä¸ºä»ä¹è¿ä¼æ¥è¿ä¸ªéï¼\n\nè¿æ¯å ä¸ºï¼å¯¹äº vectorï¼è½ç¶è½ä¿è¯æ¯ä¸ä¸ªæ¶å»åªè½æä¸ä¸ªçº¿ç¨è®¿é®å®ï¼ä½æ¯ä¸æé¤è¿ç§å¯è½ï¼\n\nå½æä¸ªçº¿ç¨å¨æä¸ªæ¶å»æ§è¡è¿å¥æ¶ï¼\n\nfor(int i=0;i<vector.size();i++)\n    vector.get(i);\n\n\nåè¥æ­¤æ¶ vector ç size æ¹æ³è¿åçæ¯ 10ï¼i çå¼ä¸º 9\n\nç¶åå¦å¤ä¸ä¸ªçº¿ç¨æ§è¡äºè¿å¥ï¼\n\nfor(int i=0;i<vector.size();i++)\n    vector.remove(i);\n\n\nå°ä¸æ ä¸º 9 çåç´ å é¤äºã\n\né£ä¹éè¿ get æ¹æ³è®¿é®ä¸æ ä¸º 9 çåç´ è¯å®å°±ä¼åºé®é¢äºã\n\nâ å®å¨ç¤ºä¾\n\nå æ­¤ä¸ºäºä¿è¯çº¿ç¨å®å¨ï¼å¿é¡»å¨æ¹æ³è°ç¨ç«¯åé¢å¤çåæ­¥æªæ½ï¼å¦ä¸é¢æç¤ºï¼\n\npublic class vectordemo2 {\n\n    static vector<integer> vector = new vector<integer>();\n\n    public static void main(string[] args) {\n        while (true) {\n            for (int i = 0; i < 10; i++) {\n                vector.add(i);\n            }\n\n            thread thread1 = new thread() {\n                @override\n                public void run() {\n                    synchronized (vectordemo2.class) {   //è¿è¡é¢å¤çåæ­¥\n                        for (int i = 0; i < vector.size(); i++) {\n                            vector.remove(i);\n                        }\n                    }\n                }\n            };\n\n            thread thread2 = new thread() {\n                @override\n                public void run() {\n                    synchronized (vectordemo2.class) {\n                        for (int i = 0; i < vector.size(); i++) {\n                            vector.get(i);\n                        }\n                    }\n                }\n            };\n\n            thread1.start();\n            thread2.start();\n\n            while (thread.activecount() > 10) {\n                system.out.println("åæ¶å­å¨ 10 ä¸ªä»¥ä¸çº¿ç¨ï¼éåº");\n                return;\n            }\n        }\n    }\n\n}\n\n\nconcurrentmodificationexception å¼å¸¸\n\nå¨å¯¹ vector ç­å®¹å¨å¹¶åå°è¿è¡è¿­ä»£ä¿®æ¹æ¶ï¼ä¼æ¥ concurrentmodificationexception å¼å¸¸ï¼å³äºè¿ä¸ªå¼å¸¸å°ä¼å¨åç»­æç« ä¸­è®²è¿°ã\n\nä½æ¯å¨å¹¶åå®¹å¨ä¸­ä¸ä¼åºç°è¿ä¸ªé®é¢ã\n\n\n# å¹¶åå®¹å¨ç®ä»\n\nåæ­¥å®¹å¨å°ææå¯¹å®¹å¨ç¶æçè®¿é®é½ä¸²è¡åï¼ä»¥ä¿è¯çº¿ç¨å®å¨æ§ï¼è¿ç§ç­ç¥ä¼ä¸¥ééä½å¹¶åæ§ã\n\njava 1.5 åæä¾äºå¤ç§å¹¶åå®¹å¨ï¼ä½¿ç¨å¹¶åå®¹å¨æ¥æ¿ä»£åæ­¥å®¹å¨ï¼å¯ä»¥æå¤§å°æé«ä¼¸ç¼©æ§å¹¶éä½é£é©ã\n\nj.u.c åä¸­æä¾äºå ä¸ªéå¸¸æç¨çå¹¶åå®¹å¨ä½ä¸ºçº¿ç¨å®å¨çå®¹å¨ï¼\n\nå¹¶åå®¹å¨                    å¯¹åºçæ®éå®¹å¨     æè¿°\nconcurrenthashmap       hashmap     java 1.8 ä¹åéç¨åæ®µéæºå¶ç»åéç²åº¦ï¼éä½é»å¡ï¼ä»èæé«å¹¶åæ§ï¼java 1.8 ä¹ååºäº cas å®ç°ã\nconcurrentskiplistmap   sortedmap   åºäºè·³è¡¨å®ç°ç\ncopyonwritearraylist    arraylist   \ncopyonwritearrayset     set         åºäº copyonwritearraylist å®ç°ã\nconcurrentskiplistset   sortedset   åºäº concurrentskiplistmap å®ç°ã\nconcurrentlinkedqueue   queue       çº¿ç¨å®å¨çæ çéåãåºå±éç¨åé¾è¡¨ãæ¯æ fifoã\nconcurrentlinkeddeque   deque       çº¿ç¨å®å¨çæ çåç«¯éåãåºå±éç¨ååé¾è¡¨ãæ¯æ fifo å filoã\narrayblockingqueue      queue       æ°ç»å®ç°çé»å¡éåã\nlinkedblockingqueue     queue       é¾è¡¨å®ç°çé»å¡éåã\nlinkedblockingdeque     deque       ååé¾è¡¨å®ç°çåç«¯é»å¡éåã\n\nj.u.c åä¸­æä¾çå¹¶åå®¹å¨å½åä¸è¬åä¸ºä¸ç±»ï¼\n\n * concurrent\n   * è¿ç±»åçéç«äºç¸å¯¹äº copyonwrite è¦é«ä¸äºï¼ä½åæä½ä»£ä»·è¦å°ä¸äºã\n   * æ­¤å¤ï¼concurrent å¾å¾æä¾äºè¾ä½çéåä¸è´æ§ï¼å³ï¼å½å©ç¨è¿­ä»£å¨éåæ¶ï¼å¦æå®¹å¨åçä¿®æ¹ï¼è¿­ä»£å¨ä»ç¶å¯ä»¥ç»§ç»­è¿è¡éåãä»£ä»·å°±æ¯ï¼å¨è·åå®¹å¨å¤§å° size() ï¼å®¹å¨æ¯å¦ä¸ºç©ºç­æ¹æ³ï¼ä¸ä¸å®å®å¨ç²¾ç¡®ï¼ä½è¿æ¯ä¸ºäºè·åå¹¶åååéçè®¾è®¡åèï¼å¯ä»¥çè§£ãä¸ä¹ç¸æ¯ï¼å¦ææ¯ä½¿ç¨åæ­¥å®¹å¨ï¼å°±ä¼åºç° fail-fast é®é¢ï¼å³ï¼æ£æµå°å®¹å¨å¨éåè¿ç¨ä¸­åçäºä¿®æ¹ï¼åæåº concurrentmodificationexceptionï¼ä¸åç»§ç»­éåã\n * copyonwrite - ä¸ä¸ªçº¿ç¨åï¼å¤ä¸ªçº¿ç¨è¯»ãè¯»æä½æ¶ä¸å éï¼åæä½æ¶éè¿å¨å¯æ¬ä¸å éä¿è¯å¹¶åå®å¨ï¼ç©ºé´å¼éè¾å¤§ã\n * blocking - åé¨å®ç°ä¸è¬æ¯åºäºéï¼æä¾é»å¡éåçè½åã\n\nâ éè¯¯ç¤ºä¾ï¼äº§ç concurrentmodificationexception å¼å¸¸ï¼\n\npublic void removekeys(map<string, object> map, final string... keys) {\n    map.keyset().removeif(key -> arrayutil.contains(keys, key));\n}\n\n\nâ éè¯¯ç¤ºä¾ï¼äº§ç concurrentmodificationexception å¼å¸¸ï¼\n\npublic static <k, v> map<k, v> removekeys(map<string, object> map, final string... keys) {\n\tfor (k key : keys) {\n\t\tmap.remove(key);\n\t}\n\treturn map;\n}\n\n\n\n# å¹¶ååºæ¯ä¸ç map\n\nå¦æå¯¹æ°æ®æå¼ºä¸è´è¦æ±ï¼åéä½¿ç¨ hashtableï¼å¨å¤§é¨ååºæ¯éå¸¸é½æ¯å¼±ä¸è´æ§çæåµä¸ï¼ä½¿ç¨ concurrenthashmap å³å¯ï¼å¦ææ°æ®éå¨åä¸çº§å«ï¼ä¸å­å¨å¤§éå¢å æ¹æä½ï¼åå¯ä»¥èèä½¿ç¨ concurrentskiplistmapã\n\n\n# å¹¶ååºæ¯ä¸ç list\n\nè¯»å¤åå°ç¨ copyonwritearraylistã\n\nåå¤è¯»å°ç¨ concurrentlinkedqueue ï¼ä½ç±äºæ¯æ ççï¼è¦æå®¹ééå¶ï¼é¿åæ éè¨èï¼å¯¼è´åå­æº¢åºã\n\n\n# map\n\nmap æ¥å£çä¸¤ä¸ªå®ç°æ¯ concurrenthashmap å concurrentskiplistmapï¼å®ä»¬ä»åºç¨çè§åº¦æ¥çï¼ä¸»è¦åºå«å¨äºconcurrenthashmap ç key æ¯æ åºçï¼è concurrentskiplistmap ç key æ¯æåºçãæä»¥å¦æä½ éè¦ä¿è¯ key çé¡ºåºï¼å°±åªè½ä½¿ç¨ concurrentskiplistmapã\n\nä½¿ç¨ concurrenthashmap å concurrentskiplistmap éè¦æ³¨æçå°æ¹æ¯ï¼å®ä»¬ç key å value é½ä¸è½ä¸ºç©ºï¼å¦åä¼æåºnullpointerexceptionè¿ä¸ªè¿è¡æ¶å¼å¸¸ã\n\n\n# concurrenthashmap\n\nconcurrenthashmap æ¯çº¿ç¨å®å¨ç hashmap ï¼ç¨äºæ¿ä»£ hashtableã\n\n# concurrenthashmap çç¹æ§\n\nconcurrenthashmap å®ç°äº concurrentmap æ¥å£ï¼è concurrentmap æ¥å£æ©å±äº map æ¥å£ã\n\npublic class concurrenthashmap<k,v> extends abstractmap<k,v>\n    implements concurrentmap<k,v>, serializable {\n    // ...\n}\n\n\nconcurrenthashmap çå®ç°åå«äº hashmap ææçåºæ¬ç¹æ§ï¼å¦ï¼æ°æ®ç»æãè¯»åç­ç¥ç­ã\n\nconcurrenthashmap æ²¡æå®ç°å¯¹ map å éä»¥æä¾ç¬å è®¿é®ãå æ­¤æ æ³éè¿å¨å®¢æ·ç«¯å éçæ¹å¼æ¥åå»ºæ°çåå­æä½ãä½æ¯ï¼ä¸äºå¸¸è§çå¤åæä½ï¼å¦ï¼âè¥æ²¡æåæ·»å âãâè¥ç¸ç­åç§»é¤âãâè¥ç¸ç­åæ¿æ¢âï¼é½å·²ç»å®ç°ä¸ºåå­æä½ï¼å¹¶ä¸æ¯å´ç» concurrentmap çæ©å±æ¥å£èå®ç°ã\n\npublic interface concurrentmap<k, v> extends map<k, v> {\n\n    // ä»å½ k æ²¡æç¸åºçæ å°å¼ææå¥\n    v putifabsent(k key, v value);\n\n    // ä»å½ k è¢«æ å°å° v æ¶æç§»é¤\n    boolean remove(object key, object value);\n\n    // ä»å½ k è¢«æ å°å° oldvalue æ¶ææ¿æ¢ä¸º newvalue\n    boolean replace(k key, v oldvalue, v newvalue);\n\n    // ä»å½ k è¢«æ å°å°æä¸ªå¼æ¶ææ¿æ¢ä¸º newvalue\n    v replace(k key, v value);\n}\n\n\nä¸åäº hashtableï¼concurrenthashmap æä¾çè¿­ä»£å¨ä¸ä¼æåº concurrentmodificationexceptionï¼å æ­¤ä¸éè¦å¨è¿­ä»£è¿ç¨ä¸­å¯¹å®¹å¨å éã\n\n> ð æ³¨æï¼ä¸äºéè¦å¯¹æ´ä¸ª map è¿è¡è®¡ç®çæ¹æ³ï¼å¦ size å isempty ï¼ç±äºè¿åçç»æå¨è®¡ç®æ¶å¯è½å·²ç»è¿æï¼æä»¥å¹¶éå®æ¶çç²¾ç¡®å¼ãè¿æ¯ä¸ç§ç­ç¥ä¸çæè¡¡ï¼å¨å¹¶åç¯å¢ä¸ï¼è¿ç±»æ¹æ³ç±äºæ»å¨ä¸æ­ååï¼æä»¥è·åå¶å®æ¶ç²¾ç¡®å¼çæä¹ä¸å¤§ãconcurrenthashmap å¼±åè¿ç±»æ¹æ³ï¼ä»¥æ¢åæ´éè¦æä½ï¼å¦ï¼getãputãcontaineskeyãremove ç­ï¼çæ§è½ã\n\n# concurrenthashmap çç¨æ³\n\nç¤ºä¾ï¼ä¸ä¼åºç° concurrentmodificationexception\n\nconcurrenthashmap çåºæ¬æä½ä¸ hashmap çç¨æ³åºæ¬ä¸æ ·ãä¸åäº hashmapãhashtableï¼concurrenthashmap æä¾çè¿­ä»£å¨ä¸ä¼æåº concurrentmodificationexceptionï¼å æ­¤ä¸éè¦å¨è¿­ä»£è¿ç¨ä¸­å¯¹å®¹å¨å éã\n\npublic class concurrenthashmapdemo {\n\n    public static void main(string[] args) throws interruptedexception {\n\n        // hashmap å¨å¹¶åè¿­ä»£è®¿é®æ¶ä¼æåº concurrentmodificationexception å¼å¸¸\n        // map<integer, character> map = new hashmap<>();\n        map<integer, character> map = new concurrenthashmap<>();\n\n        thread wthread = new thread(() -> {\n            system.out.println("åæä½çº¿ç¨å¼å§æ§è¡");\n            for (int i = 0; i < 26; i++) {\n                map.put(i, (char) (\'a\' + i));\n            }\n        });\n        thread rthread = new thread(() -> {\n            system.out.println("è¯»æä½çº¿ç¨å¼å§æ§è¡");\n            for (integer key : map.keyset()) {\n                system.out.println(key + " - " + map.get(key));\n            }\n        });\n        wthread.start();\n        rthread.start();\n        thread.sleep(1000);\n    }\n}\n\n\n# concurrenthashmap çåç\n\n> concurrenthashmap ä¸ç´å¨æ¼è¿ï¼å°¤å¶å¨ java 1.7 å java 1.8ï¼å¶æ°æ®ç»æåå¹¶åæºå¶æå¾å¤§çå·®å¼ã\n\n * java 1.7\n   * æ°æ®ç»æï¼æ°ç»ï¼åé¾è¡¨\n   * å¹¶åæºå¶ï¼éç¨åæ®µéæºå¶ç»åéç²åº¦ï¼éä½é»å¡ï¼ä»èæé«å¹¶åæ§ã\n * java 1.8\n   * æ°æ®ç»æï¼æ°ç»ï¼åé¾è¡¨ï¼çº¢é»æ \n   * å¹¶åæºå¶ï¼åæ¶åæ®µéï¼ä¹ååºäº cas + synchronized å®ç°ã\n\n# java 1.7 çå®ç°\n\nåæ®µéï¼æ¯å°åé¨è¿è¡åæ®µï¼segmentï¼ï¼éé¢æ¯ hashentry æ°ç»ï¼å hashmap ç±»ä¼¼ï¼åå¸ç¸åçæ¡ç®ä¹æ¯ä»¥é¾è¡¨å½¢å¼å­æ¾ã hashentry åé¨ä½¿ç¨ volatile ç value å­æ®µæ¥ä¿è¯å¯è§æ§ï¼ä¹å©ç¨äºä¸å¯åå¯¹è±¡çæºå¶ï¼ä»¥æ¹è¿å©ç¨ unsafe æä¾çåºå±è½åï¼æ¯å¦ volatile accessï¼å»ç´æ¥å®æé¨åæä½ï¼ä»¥æä¼åæ§è½ï¼æ¯ç« unsafe ä¸­çå¾å¤æä½é½æ¯ jvm intrinsic ä¼åè¿çã\n\n\n\nå¨è¿è¡å¹¶ååæä½æ¶ï¼concurrenthashmap ä¼è·åå¯éå¥éï¼reentrantlockï¼ï¼ä»¥ä¿è¯æ°æ®ä¸è´æ§ãæä»¥ï¼å¨å¹¶åä¿®æ¹æé´ï¼ç¸åº segment æ¯è¢«éå®çã\n\npublic class concurrenthashmap<k, v> extends abstractmap<k, v>\n        implements concurrentmap<k, v>, serializable {\n\n    // å°æ´ä¸ªhashmapåæå ä¸ªå°çmapï¼æ¯ä¸ªsegmenté½æ¯ä¸ä¸ªéï¼ä¸hashtableç¸æ¯ï¼è¿ä¹è®¾è®¡çç®çæ¯å¯¹äºput, removeç­æä½ï¼å¯ä»¥åå°å¹¶åå²çªï¼å¯¹\n    // ä¸å±äºåä¸ä¸ªçæ®µçèç¹å¯ä»¥å¹¶åæä½ï¼å¤§å¤§æé«äºæ§è½\n    final segment<k,v>[] segments;\n\n    // æ¬è´¨ä¸segmentç±»å°±æ¯ä¸ä¸ªå°çhashmapï¼éé¢tableæ°ç»å­å¨äºåä¸ªèç¹çæ°æ®ï¼ç»§æ¿äºreentrantlock, å¯ä»¥ä½ä¸ºäºæéä½¿ç¨\n    static final class segment<k,v> extends reentrantlock implements serializable {\n        transient volatile hashentry<k,v>[] table;\n        transient int count;\n    }\n\n    // åºæ¬èç¹ï¼å­å¨keyï¼ valueå¼\n    static final class hashentry<k,v> {\n        final int hash;\n        final k key;\n        volatile v value;\n        volatile hashentry<k,v> next;\n    }\n}\n\n\n# java 1.8 çå®ç°\n\n * æ°æ®ç»ææ¹è¿ï¼ä¸ hashmap ä¸æ ·ï¼å°åå æ°ç»ï¼åé¾è¡¨ çæ°æ®ç»æï¼åæ´ä¸º æ°ç»ï¼åé¾è¡¨ï¼çº¢é»æ  çç»æãå½åºç°åå¸å²çªæ¶ï¼æ°æ®ä¼å­å¥æ°ç»æå®æ¡¶çåé¾è¡¨ï¼å½é¾è¡¨é¿åº¦è¾¾å° 8ï¼åå°å¶è½¬æ¢ä¸ºçº¢é»æ ç»æï¼è¿æ ·å¶æ¥è¯¢çæ¶é´å¤æåº¦å¯ä»¥éä½å° $$o(logn)$$ï¼ä»¥æ¹è¿æ§è½ã\n * å¹¶åæºå¶æ¹è¿ï¼\n   * åæ¶ segments å­æ®µï¼ç´æ¥éç¨ transient volatile hashentry<k,v>[] table ä¿å­æ°æ®ï¼éç¨ table æ°ç»åç´ ä½ä¸ºéï¼ä»èå®ç°äºå¯¹æ¯ä¸è¡æ°æ®è¿è¡å éï¼è¿ä¸æ­¥åå°å¹¶åå²çªçæ¦çã\n   * ä½¿ç¨ cas + sychronized æä½ï¼å¨ç¹å®åºæ¯è¿è¡æ éå¹¶åæä½ãä½¿ç¨ unsafeãlongadder ä¹ç±»åºå±ææ®µï¼è¿è¡æç«¯æåµçä¼åãç°ä»£ jdk ä¸­ï¼synchronized å·²ç»è¢«ä¸æ­ä¼åï¼å¯ä»¥ä¸åè¿åæå¿æ§è½å·®å¼ï¼å¦å¤ï¼ç¸æ¯äº reentrantlockï¼å®å¯ä»¥åå°åå­æ¶èï¼è¿æ¯ä¸ªéå¸¸å¤§çä¼å¿ã\n\nfinal v putval(k key, v value, boolean onlyifabsent) {\n    if (key == null || value == null) throw new nullpointerexception();\n    int hash = spread(key.hashcode());\n    int bincount = 0;\n    for (node<k,v>[] tab = table;;) {\n        node<k,v> f; int n, i, fh;\n        // å¦ætableä¸ºç©ºï¼åå§åï¼å¦åï¼æ ¹æ®hashå¼è®¡ç®å¾å°æ°ç»ç´¢å¼iï¼å¦ætab[i]ä¸ºç©ºï¼ç´æ¥æ°å»ºèç¹nodeå³å¯ãæ³¨ï¼tab[i]å®è´¨ä¸ºé¾è¡¨æèçº¢é»æ çé¦èç¹ã\n        if (tab == null || (n = tab.length) == 0)\n            tab = inittable();\n        else if ((f = tabat(tab, i = (n - 1) & hash)) == null) {\n            if (castabat(tab, i, null,\n                         new node<k,v>(hash, key, value, null)))\n                break;                   // no lock when adding to empty bin\n        }\n        // å¦ætab[i]ä¸ä¸ºç©ºå¹¶ä¸hashå¼ä¸ºmovedï¼è¯´æè¯¥é¾è¡¨æ­£å¨è¿è¡transferæä½ï¼è¿åæ©å®¹å®æåçtableã\n        else if ((fh = f.hash) == moved)\n            tab = helptransfer(tab, f);\n        else {\n            v oldval = null;\n            // éå¯¹é¦ä¸ªèç¹è¿è¡å éæä½ï¼èä¸æ¯segmentï¼è¿ä¸æ­¥åå°çº¿ç¨å²çª\n            synchronized (f) {\n                if (tabat(tab, i) == f) {\n                    if (fh >= 0) {\n                        bincount = 1;\n                        for (node<k,v> e = f;; ++bincount) {\n                            k ek;\n                            // å¦æå¨é¾è¡¨ä¸­æ¾å°å¼ä¸ºkeyçèç¹eï¼ç´æ¥è®¾ç½®e.val = valueå³å¯ã\n                            if (e.hash == hash &&\n                                ((ek = e.key) == key ||\n                                 (ek != null && key.equals(ek)))) {\n                                oldval = e.val;\n                                if (!onlyifabsent)\n                                    e.val = value;\n                                break;\n                            }\n                            // å¦ææ²¡ææ¾å°å¼ä¸ºkeyçèç¹ï¼ç´æ¥æ°å»ºnodeå¹¶å å¥é¾è¡¨å³å¯ã\n                            node<k,v> pred = e;\n                            if ((e = e.next) == null) {\n                                pred.next = new node<k,v>(hash, key,\n                                                          value, null);\n                                break;\n                            }\n                        }\n                    }\n                    // å¦æé¦èç¹ä¸ºtreebinç±»åï¼è¯´æä¸ºçº¢é»æ ç»æï¼æ§è¡puttreevalæä½ã\n                    else if (f instanceof treebin) {\n                        node<k,v> p;\n                        bincount = 2;\n                        if ((p = ((treebin<k,v>)f).puttreeval(hash, key,\n                                                       value)) != null) {\n                            oldval = p.val;\n                            if (!onlyifabsent)\n                                p.val = value;\n                        }\n                    }\n                }\n            }\n            if (bincount != 0) {\n                // å¦æèç¹æ°>ï¼8ï¼é£ä¹è½¬æ¢é¾è¡¨ç»æä¸ºçº¢é»æ ç»æã\n                if (bincount >= treeify_threshold)\n                    treeifybin(tab, i);\n                if (oldval != null)\n                    return oldval;\n                break;\n            }\n        }\n    }\n    // è®¡æ°å¢å 1ï¼æå¯è½è§¦åtransferæä½(æ©å®¹)ã\n    addcount(1l, bincount);\n    return null;\n}\n\n\n# concurrenthashmap çå®æ\n\n> ç¤ºä¾æèªï¼ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\n# concurrenthashmap éè¯¯ç¤ºä¾\n\n    //çº¿ç¨ä¸ªæ°\n    private static int thread_count = 10;\n    //æ»åç´ æ°é\n    private static int item_count = 1000;\n\n    public static void main(string[] args) throws interruptedexception {\n        concurrenthashmap<string, long> concurrenthashmap = getdata(item_count - 100);\n        //åå§900ä¸ªåç´ \n        system.out.println("init size:" + concurrenthashmap.size());\n        forkjoinpool forkjoinpool = new forkjoinpool(thread_count);\n        //ä½¿ç¨çº¿ç¨æ± å¹¶åå¤çé»è¾\n        forkjoinpool.execute(() -> intstream.rangeclosed(1, 10).parallel().foreach(i -> {\n            //æ¥è¯¢è¿éè¦è¡¥åå¤å°ä¸ªåç´ \n            int gap = item_count - concurrenthashmap.size();\n            system.out.println("gap size:" + gap);\n            //è¡¥ååç´ \n            concurrenthashmap.putall(getdata(gap));\n        }));\n        //ç­å¾ææä»»å¡å®æ\n        forkjoinpool.shutdown();\n        forkjoinpool.awaittermination(1, timeunit.hours);\n        //æååç´ ä¸ªæ°ä¼æ¯1000åï¼\n        system.out.println("finish size:" + concurrenthashmap.size());\n    }\n\n    private static concurrenthashmap<string, long> getdata(int count) {\n        return longstream.rangeclosed(1, count)\n            .boxed()\n            .collect(\n                collectors.toconcurrentmap(\n                    i -> uuid.randomuuid().tostring(),\n                    i -> i,\n                    (o1, o2) -> o1,\n                    concurrenthashmap::new));\n    }\n\n\nåå§å¤§å° 900 ç¬¦åé¢æï¼è¿éè¦å¡«å 100 ä¸ªåç´ ã\n\né¢æç»æä¸º 1000 ä¸ªåç´ ï¼å®éå¤§äº 1000 ä¸ªåç´ ã\n\nãåæã\n\nconcurrenthashmap å¯¹å¤æä¾çæ¹æ³æè½åçéå¶ï¼\n\n * ä½¿ç¨äº concurrenthashmapï¼ä¸ä»£è¡¨å¯¹å®çå¤ä¸ªæä½ä¹é´çç¶ææ¯ä¸è´çï¼æ¯æ²¡æå¶ä»çº¿ç¨å¨æä½å®çï¼å¦æéè¦ç¡®ä¿éè¦æå¨å éã\n * è¯¸å¦ sizeãisempty å containsvalue ç­èåæ¹æ³ï¼å¨å¹¶åæåµä¸å¯è½ä¼åæ  concurrenthashmap çä¸­é´ç¶æãå æ­¤å¨å¹¶åæåµä¸ï¼è¿äºæ¹æ³çè¿åå¼åªè½ç¨ä½åèï¼èä¸è½ç¨äºæµç¨æ§å¶ãæ¾ç¶ï¼å©ç¨ size æ¹æ³è®¡ç®å·®å¼å¼ï¼æ¯ä¸ä¸ªæµç¨æ§å¶ã\n * è¯¸å¦ putall è¿æ ·çèåæ¹æ³ä¹ä¸è½ç¡®ä¿åå­æ§ï¼å¨ putall çè¿ç¨ä¸­å»è·åæ°æ®å¯è½ä¼è·åå°é¨åæ°æ®ã\n\n# concurrenthashmap éè¯¯ç¤ºä¾ä¿®æ­£ 1.0 ç\n\néè¿ synchronized å éï¼å½ç¶å¯ä»¥ä¿è¯æ°æ®ä¸è´æ§ï¼ä½æ¯çºç²äº concurrenthashmap çæ§è½ï¼æ²¡åçæ­£åæ¥åº concurrenthashmap çç¹æ§ã\n\n\n    //çº¿ç¨ä¸ªæ°\n    private static int thread_count = 10;\n    //æ»åç´ æ°é\n    private static int item_count = 1000;\n\n    public static void main(string[] args) throws interruptedexception {\n        concurrenthashmap<string, long> concurrenthashmap = getdata(item_count - 100);\n        //åå§900ä¸ªåç´ \n        system.out.println("init size:" + concurrenthashmap.size());\n        forkjoinpool forkjoinpool = new forkjoinpool(thread_count);\n        //ä½¿ç¨çº¿ç¨æ± å¹¶åå¤çé»è¾\n        forkjoinpool.execute(() -> intstream.rangeclosed(1, 10).parallel().foreach(i -> {\n            //æ¥è¯¢è¿éè¦è¡¥åå¤å°ä¸ªåç´ \n            synchronized (concurrenthashmap) {\n                int gap = item_count - concurrenthashmap.size();\n                system.out.println("gap size:" + gap);\n                //è¡¥ååç´ \n                concurrenthashmap.putall(getdata(gap));\n            }\n        }));\n        //ç­å¾ææä»»å¡å®æ\n        forkjoinpool.shutdown();\n        forkjoinpool.awaittermination(1, timeunit.hours);\n        //æååç´ ä¸ªæ°ä¼æ¯1000åï¼\n        system.out.println("finish size:" + concurrenthashmap.size());\n    }\n\n    private static concurrenthashmap<string, long> getdata(int count) {\n        return longstream.rangeclosed(1, count)\n            .boxed()\n            .collect(\n                collectors.toconcurrentmap(\n                    i -> uuid.randomuuid().tostring(),\n                    i -> i,\n                    (o1, o2) -> o1,\n                    concurrenthashmap::new));\n    }\n\n\n# concurrenthashmap éè¯¯ç¤ºä¾ä¿®æ­£ 2.0 ç\n\n\n    //å¾ªç¯æ¬¡æ°\n    private static int loop_count = 10000000;\n    //çº¿ç¨ä¸ªæ°\n    private static int thread_count = 10;\n    //æ»åç´ æ°é\n    private static int item_count = 1000;\n\n    public static void main(string[] args) throws interruptedexception {\n        stopwatch stopwatch = new stopwatch();\n        stopwatch.start("normaluse");\n        map<string, long> normaluse = normaluse();\n        stopwatch.stop();\n        assert.istrue(normaluse.size() == item_count, "normaluse size error");\n        assert.istrue(normaluse.values().stream()\n                .maptolong(along -> along).reduce(0, long::sum) == loop_count\n            , "normaluse count error");\n        stopwatch.start("gooduse");\n        map<string, long> gooduse = gooduse();\n        stopwatch.stop();\n        assert.istrue(gooduse.size() == item_count, "gooduse size error");\n        assert.istrue(gooduse.values().stream()\n                .maptolong(l -> l)\n                .reduce(0, long::sum) == loop_count\n            , "gooduse count error");\n        system.out.println(stopwatch.prettyprint());\n    }\n\n    private static map<string, long> normaluse() throws interruptedexception {\n        concurrenthashmap<string, long> freqs = new concurrenthashmap<>(item_count);\n        forkjoinpool forkjoinpool = new forkjoinpool(thread_count);\n        forkjoinpool.execute(() -> intstream.rangeclosed(1, loop_count).parallel().foreach(i -> {\n                string key = "item" + threadlocalrandom.current().nextint(item_count);\n                synchronized (freqs) {\n                    if (freqs.containskey(key)) {\n                        freqs.put(key, freqs.get(key) + 1);\n                    } else {\n                        freqs.put(key, 1l);\n                    }\n                }\n            }\n        ));\n        forkjoinpool.shutdown();\n        forkjoinpool.awaittermination(1, timeunit.hours);\n        return freqs;\n    }\n\n    private static map<string, long> gooduse() throws interruptedexception {\n        concurrenthashmap<string, longadder> freqs = new concurrenthashmap<>(item_count);\n        forkjoinpool forkjoinpool = new forkjoinpool(thread_count);\n        forkjoinpool.execute(() -> intstream.rangeclosed(1, loop_count).parallel().foreach(i -> {\n                string key = "item" + threadlocalrandom.current().nextint(item_count);\n                freqs.computeifabsent(key, k -> new longadder()).increment();\n            }\n        ));\n        forkjoinpool.shutdown();\n        forkjoinpool.awaittermination(1, timeunit.hours);\n        return freqs.entryset().stream()\n            .collect(collectors.tomap(\n                e -> e.getkey(),\n                e -> e.getvalue().longvalue())\n            );\n    }\n\n\n\n# list\n\n\n# copyonwritearraylist\n\ncopyonwritearraylist æ¯çº¿ç¨å®å¨ç arraylistãcopyonwrite å­é¢ææä¸ºåçæ¶åä¼å°å±äº«åéæ°å¤å¶ä¸ä»½åºæ¥ãå¤å¶çå¥½å¤å¨äºè¯»æä½æ¯æ éçï¼ä¹å°±æ¯æ é»å¡ï¼ã\n\ncopyonwritearraylist ä»éç¨äºåæä½éå¸¸å°çåºæ¯ï¼èä¸è½å¤å®¹å¿è¯»åçç­æä¸ä¸è´ãå¦æè¯»åæ¯ä¾åè¡¡æèæå¤§éåæä½çè¯ï¼ä½¿ç¨ copyonwritearraylist çæ§è½ä¼éå¸¸ç³ç³ã\n\n# copyonwritearraylist åç\n\ncopyonwritearraylist åé¨ç»´æ¤äºä¸ä¸ªæ°ç»ï¼æååé array å°±æåè¿ä¸ªåé¨æ°ç»ï¼ææçè¯»æä½é½æ¯åºäº array è¿è¡çï¼å¦ä¸å¾æç¤ºï¼è¿­ä»£å¨ iterator éåçå°±æ¯ array æ°ç»ã\n\n\n\n * lock - æ§è¡åæ¶å¤å¶æä½ï¼éè¦ä½¿ç¨å¯éå¥éå é\n * array - å¯¹è±¡æ°ç»ï¼ç¨äºå­æ¾åç´ \n\n    /** the lock protecting all mutators */\n    final transient reentrantlock lock = new reentrantlock();\n\n    /** the array, accessed only via getarray/setarray. */\n    private transient volatile object[] array;\n\n\n\n\nï¼1ï¼è¯»æä½\n\nå¨ copyonwriteaarraylist ä¸­ï¼è¯»æä½ä¸åæ­¥ï¼å ä¸ºå®ä»¬å¨åé¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼æä»¥å¤ä¸ªè¿­ä»£å¨å¯ä»¥åæ¶éåèä¸ä¼ç¸äºé»å¡ï¼å¾ 1,2,4ï¼ã\n\ncopyonwritearraylist çè¯»æä½æ¯ä¸ç¨å éçï¼æ§è½å¾é«ã\n\npublic e get(int index) {\n    return get(getarray(), index);\n}\nprivate e get(object[] a, int index) {\n    return (e) a[index];\n}\n\n\nï¼2ï¼åæä½\n\nææçåæä½é½æ¯åæ­¥çãä»ä»¬å¨å¤ä»½æ°ç»ï¼å¾ 3ï¼çå¯æ¬ä¸å·¥ä½ãåæä½å®æåï¼åå¤éµåå°è¢«æ¿æ¢ä¸ºå¤å¶çéµåï¼å¹¶éæ¾éå®ãæ¯ææ°ç»åå¾æåï¼æä»¥æ¿æ¢æ°ç»çè°ç¨æ¯åå­ï¼å¾ 5ï¼ã\n\nåæä½ååå»ºçè¿­ä»£å¨å°è½å¤çå°ä¿®æ¹çç»æï¼å¾ 6,7ï¼ã\n\nåæ¶å¤å¶éåè¿åçè¿­ä»£å¨ä¸ä¼æåº concurrentmodificationexceptionï¼å ä¸ºå®ä»¬å¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼å¹¶ä¸æ è®ºåç»­çä¿®æ¹ï¼2,4ï¼å¦ä½ï¼é½ä¼åè¿­ä»£å¨åå»ºæ¶é£æ ·å®å¨è¿ååç´ ã\n\næ·»å æä½ - æ·»å çé»è¾å¾ç®åï¼åå°åå®¹å¨ copy ä¸ä»½ï¼ç¶åå¨æ°å¯æ¬ä¸æ§è¡åæä½ï¼ä¹åååæ¢å¼ç¨ãå½ç¶æ­¤è¿ç¨æ¯è¦å éçã\n\npublic boolean add(e e) {\n    //reentrantlockå éï¼ä¿è¯çº¿ç¨å®å¨\n    final reentrantlock lock = this.lock;\n    lock.lock();\n    try {\n        object[] elements = getarray();\n        int len = elements.length;\n        //æ·è´åå®¹å¨ï¼é¿åº¦ä¸ºåå®¹å¨é¿åº¦å ä¸\n        object[] newelements = arrays.copyof(elements, len + 1);\n        //å¨æ°å¯æ¬ä¸æ§è¡æ·»å æä½\n        newelements[len] = e;\n        //å°åå®¹å¨å¼ç¨æåæ°å¯æ¬\n        setarray(newelements);\n        return true;\n    } finally {\n        //è§£é\n        lock.unlock();\n    }\n}\n\n\nå é¤æä½ - å é¤æä½åçï¼å°é¤è¦å é¤åç´ ä¹å¤çå¶ä»åç´ æ·è´å°æ°å¯æ¬ä¸­ï¼ç¶ååæ¢å¼ç¨ï¼å°åå®¹å¨å¼ç¨æåæ°å¯æ¬ãåå±åæä½ï¼éè¦å éã\n\npublic e remove(int index) {\n    //å é\n    final reentrantlock lock = this.lock;\n    lock.lock();\n    try {\n        object[] elements = getarray();\n        int len = elements.length;\n        e oldvalue = get(elements, index);\n        int nummoved = len - index - 1;\n        if (nummoved == 0)\n            //å¦æè¦å é¤çæ¯åè¡¨æ«ç«¯æ°æ®ï¼æ·è´ålen-1ä¸ªæ°æ®å°æ°å¯æ¬ä¸ï¼ååæ¢å¼ç¨\n            setarray(arrays.copyof(elements, len - 1));\n        else {\n            //å¦åï¼å°é¤è¦å é¤åç´ ä¹å¤çå¶ä»åç´ æ·è´å°æ°å¯æ¬ä¸­ï¼å¹¶åæ¢å¼ç¨\n            object[] newelements = new object[len - 1];\n            system.arraycopy(elements, 0, newelements, 0, index);\n            system.arraycopy(elements, index + 1, newelements, index,\n                              nummoved);\n            setarray(newelements);\n        }\n        return oldvalue;\n    } finally {\n        //è§£é\n        lock.unlock();\n    }\n}\n\n\n# copyonwritearraylist ç¤ºä¾\n\npublic class copyonwritearraylistdemo {\n\n    static class readtask implements runnable {\n\n        list<string> list;\n\n        readtask(list<string> list) {\n            this.list = list;\n        }\n\n        public void run() {\n            for (string str : list) {\n                system.out.println(str);\n            }\n        }\n    }\n\n    static class writetask implements runnable {\n\n        list<string> list;\n        int index;\n\n        writetask(list<string> list, int index) {\n            this.list = list;\n            this.index = index;\n        }\n\n        public void run() {\n            list.remove(index);\n            list.add(index, "write_" + index);\n        }\n    }\n\n    public void run() {\n        final int num = 10;\n        // arraylist å¨å¹¶åè¿­ä»£è®¿é®æ¶ä¼æåº concurrentmodificationexception å¼å¸¸\n        // list<string> list = new arraylist<>();\n        copyonwritearraylist<string> list = new copyonwritearraylist<>();\n        for (int i = 0; i < num; i++) {\n            list.add("main_" + i);\n        }\n        executorservice executorservice = executors.newfixedthreadpool(num);\n        for (int i = 0; i < num; i++) {\n            executorservice.execute(new readtask(list));\n            executorservice.execute(new writetask(list, i));\n        }\n        executorservice.shutdown();\n    }\n\n    public static void main(string[] args) {\n        new copyonwritearraylistdemo().run();\n    }\n}\n\n\n# copyonwritearraylist å®æ\n\n@slf4j\npublic class wrongcopyonwritelist {\n\n    public static void main(string[] args) {\n        testread();\n        testwrite();\n    }\n\n    public static map testwrite() {\n        list<integer> copyonwritearraylist = new copyonwritearraylist<>();\n        list<integer> synchronizedlist = collections.synchronizedlist(new arraylist<>());\n        stopwatch stopwatch = new stopwatch();\n        int loopcount = 100000;\n        stopwatch.start("write:copyonwritearraylist");\n        intstream.rangeclosed(1, loopcount)\n            .parallel()\n            .foreach(__ -> copyonwritearraylist.add(threadlocalrandom.current().nextint(loopcount)));\n        stopwatch.stop();\n        stopwatch.start("write:synchronizedlist");\n        intstream.rangeclosed(1, loopcount)\n            .parallel()\n            .foreach(__ -> synchronizedlist.add(threadlocalrandom.current().nextint(loopcount)));\n        stopwatch.stop();\n        log.info(stopwatch.prettyprint());\n        map result = new hashmap();\n        result.put("copyonwritearraylist", copyonwritearraylist.size());\n        result.put("synchronizedlist", synchronizedlist.size());\n        return result;\n    }\n\n    private static void addall(list<integer> list) {\n        list.addall(intstream.rangeclosed(1, 1000000).boxed().collect(collectors.tolist()));\n    }\n\n    public static map testread() {\n        list<integer> copyonwritearraylist = new copyonwritearraylist<>();\n        list<integer> synchronizedlist = collections.synchronizedlist(new arraylist<>());\n        addall(copyonwritearraylist);\n        addall(synchronizedlist);\n        stopwatch stopwatch = new stopwatch();\n        int loopcount = 1000000;\n        int count = copyonwritearraylist.size();\n        stopwatch.start("read:copyonwritearraylist");\n        intstream.rangeclosed(1, loopcount)\n            .parallel()\n            .foreach(__ -> copyonwritearraylist.get(threadlocalrandom.current().nextint(count)));\n        stopwatch.stop();\n        stopwatch.start("read:synchronizedlist");\n        intstream.range(0, loopcount)\n            .parallel()\n            .foreach(__ -> synchronizedlist.get(threadlocalrandom.current().nextint(count)));\n        stopwatch.stop();\n        log.info(stopwatch.prettyprint());\n        map result = new hashmap();\n        result.put("copyonwritearraylist", copyonwritearraylist.size());\n        result.put("synchronizedlist", synchronizedlist.size());\n        return result;\n    }\n\n}\n\n\nè¯»æ§è½å·®ä¸å¤æ¯åæ§è½çä¸ç¾åã\n\n\n# set\n\nset æ¥å£çä¸¤ä¸ªå®ç°æ¯ copyonwritearrayset å concurrentskiplistsetï¼ä½¿ç¨åºæ¯å¯ä»¥åèåé¢è®²è¿°ç copyonwritearraylist å concurrentskiplistmapï¼å®ä»¬çåçé½æ¯ä¸æ ·çã\n\n\n# queue\n\njava å¹¶ååéé¢ queue è¿ç±»å¹¶åå®¹å¨æ¯æå¤æçï¼ä½ å¯ä»¥ä»ä»¥ä¸ä¸¤ä¸ªç»´åº¦æ¥åç±»ãä¸ä¸ªç»´åº¦æ¯é»å¡ä¸éé»å¡ï¼æè°é»å¡æçæ¯ï¼å½éåå·²æ»¡æ¶ï¼å¥éæä½é»å¡ï¼å½éåå·²ç©ºæ¶ï¼åºéæä½é»å¡ãå¦ä¸ä¸ªç»´åº¦æ¯åç«¯ä¸åç«¯ï¼åç«¯æçæ¯åªè½éå°¾å¥éï¼éé¦åºéï¼èåç«¯æçæ¯éé¦éå°¾çå¯å¥éåºéãjava å¹¶ååéé»å¡éåé½ç¨ blocking å³é®å­æ è¯ï¼åç«¯éåä½¿ç¨ queue æ è¯ï¼åç«¯éåä½¿ç¨ deque æ è¯ã\n\n\n# blockingqueue\n\nblockingqueue é¡¾åæä¹ï¼æ¯ä¸ä¸ªé»å¡éåãblockingqueue åºæ¬é½æ¯åºäºéå®ç°ãå¨ blockingqueue ä¸­ï¼å½éåå·²æ»¡æ¶ï¼å¥éæä½é»å¡ï¼å½éåå·²ç©ºæ¶ï¼åºéæä½é»å¡ã\n\nblockingqueue æ¥å£å®ä¹å¦ä¸ï¼\n\npublic interface blockingqueue<e> extends queue<e> {}\n\n\næ ¸å¿ apiï¼\n\n// è·åå¹¶ç§»é¤éåå¤´ç»ç¹ï¼å¦æå¿è¦ï¼å¶ä¼ç­å¾ç´å°éååºç°åç´ \ne take() throws interruptedexception;\n// æå¥åç´ ï¼å¦æéåå·²æ»¡ï¼åç­å¾ç´å°éååºç°ç©ºé²ç©ºé´\nvoid put(e e) throws interruptedexception;\n\n\nblockingqueue å¯¹æå¥æä½ãç§»é¤æä½ãè·ååç´ æä½æä¾äºåç§ä¸åçæ¹æ³ç¨äºä¸åçåºæ¯ä¸­ä½¿ç¨ï¼\n\n * æåºå¼å¸¸ï¼\n * è¿åç¹æ®å¼ï¼null æ true/falseï¼åå³äºå·ä½çæä½ï¼ï¼\n * é»å¡ç­å¾æ­¤æä½ï¼ç´å°è¿ä¸ªæä½æåï¼\n * é»å¡ç­å¾æ­¤æä½ï¼ç´å°æåæèè¶æ¶æå®æ¶é´ã\n\næ»ç»å¦ä¸ï¼\n\n          throws exception   special value   blocks           times out\ninsert    add(e)             offer(e)        put(e)           offer(e, time, unit)\nremove    remove()           poll()          take()           poll(time, unit)\nexamine   element()          peek()          not applicable   not applicable\n\nblockingqueue çåä¸ªå®ç°ç±»é½éµå¾ªäºè¿äºè§åã\n\nblockingqueue ä¸æ¥å null å¼åç´ ã\n\njdk æä¾äºä»¥ä¸é»å¡éåï¼\n\n * arrayblockingqueue - ä¸ä¸ªç±æ°ç»ç»æç»æçæçé»å¡éåã\n * linkedblockingqueue - ä¸ä¸ªç±é¾è¡¨ç»æç»æçæçé»å¡éåã\n * priorityblockingqueue - ä¸ä¸ªæ¯æä¼åçº§æåºçæ çé»å¡éåã\n * synchronousqueue - ä¸ä¸ªä¸å­å¨åç´ çé»å¡éåã\n * delayqueue - ä¸ä¸ªä½¿ç¨ä¼åçº§éåå®ç°çæ çé»å¡éåã\n * linkedtransferqueue - ä¸ä¸ªç±é¾è¡¨ç»æç»æçæ çé»å¡éåã\n\nblockingqueue åºæ¬é½æ¯åºäºéå®ç°ã\n\n\n# priorityblockingqueue ç±»\n\npriorityblockingqueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class priorityblockingqueue<e> extends abstractqueue<e>\n    implements blockingqueue<e>, java.io.serializable {}\n\n\n# priorityblockingqueue è¦ç¹\n\n * priorityblockingqueue å¯ä»¥è§ä¸º priorityqueue ççº¿ç¨å®å¨çæ¬ã\n * priorityblockingqueue å®ç°äº blockingqueueï¼ä¹æ¯ä¸ä¸ªé»å¡éåã\n * priorityblockingqueue å®ç°äº serializableï¼æ¯æåºååã\n * priorityblockingqueue ä¸æ¥å null å¼åç´ ã\n * priorityblockingqueue çæå¥æä½ put æ¹æ³ä¸ä¼ blockï¼å ä¸ºå®æ¯æ çéåï¼take æ¹æ³å¨éåä¸ºç©ºçæ¶åä¼é»å¡ï¼ã\n\n# priorityblockingqueue åç\n\npriorityblockingqueue æä¸¤ä¸ªéè¦æåï¼\n\nprivate transient object[] queue;\nprivate final reentrantlock lock;\n\n\n * queue æ¯ä¸ä¸ª object æ°ç»ï¼ç¨äºä¿å­ priorityblockingqueue çåç´ ã\n * èå¯éå¥é lock åç¨äºå¨æ§è¡æå¥ãå é¤æä½æ¶ï¼ä¿è¯è¿ä¸ªæ¹æ³å¨å½åçº¿ç¨éæ¾éä¹åï¼å¶ä»çº¿ç¨ä¸è½è®¿é®ã\n\npriorityblockingqueue çå®¹éè½ç¶æåå§åå¤§å°ï¼ä½æ¯ä¸éå¶å¤§å°ï¼å¦æå½åå®¹éå·²æ»¡ï¼æå¥æ°åç´ æ¶ä¼èªå¨æ©å®¹ã\n\n\n# arrayblockingqueue ç±»\n\narrayblockingqueue æ¯ç±æ°ç»ç»æç»æçæçé»å¡éåã\n\n# arrayblockingqueue è¦ç¹\n\narrayblockingqueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class arrayblockingqueue<e> extends abstractqueue<e>\n        implements blockingqueue<e>, java.io.serializable {\n    // æ°ç»çå¤§å°å°±å³å®äºéåçè¾¹çï¼æä»¥åå§åæ¶å¿é¡»æå®å®¹é\n    public arrayblockingqueue(int capacity) { //... }\n    public arrayblockingqueue(int capacity, boolean fair) { //... }\n    public arrayblockingqueue(int capacity, boolean fair, collection<? extends e> c) { //... }\n}\n\n\nè¯´æï¼\n\n * arrayblockingqueue å®ç°äº blockingqueueï¼ä¹æ¯ä¸ä¸ªé»å¡éåã\n * arrayblockingqueue å®ç°äº serializableï¼æ¯æåºååã\n * arrayblockingqueue æ¯åºäºæ°ç»å®ç°çæçé»å¡éåãæä»¥åå§åæ¶å¿é¡»æå®å®¹éã\n\n# arrayblockingqueue åç\n\narrayblockingqueue çéè¦æåå¦ä¸ï¼\n\n// ç¨äºå­æ¾åç´ çæ°ç»\nfinal object[] items;\n// ä¸ä¸æ¬¡è¯»åæä½çä½ç½®\nint takeindex;\n// ä¸ä¸æ¬¡åå¥æä½çä½ç½®\nint putindex;\n// éåä¸­çåç´ æ°é\nint count;\n\n// ä»¥ä¸å ä¸ªå°±æ¯æ§å¶å¹¶åç¨çåæ­¥å¨\nfinal reentrantlock lock;\nprivate final condition notempty;\nprivate final condition notfull;\n\n\narrayblockingqueue åé¨ä»¥ final çæ°ç»ä¿å­æ°æ®ï¼æ°ç»çå¤§å°å°±å³å®äºéåçè¾¹çã\n\narrayblockingqueue å®ç°å¹¶ååæ­¥çåçå°±æ¯ï¼è¯»æä½ååæä½é½éè¦è·åå° aqs ç¬å éæè½è¿è¡æä½ã\n\n * å¦æéåä¸ºç©ºï¼è¿ä¸ªæ¶åè¯»æä½ççº¿ç¨è¿å¥å°è¯»çº¿ç¨éåæéï¼ç­å¾åçº¿ç¨åå¥æ°çåç´ ï¼ç¶åå¤éè¯»çº¿ç¨éåçç¬¬ä¸ä¸ªç­å¾çº¿ç¨ã\n * å¦æéåå·²æ»¡ï¼è¿ä¸ªæ¶ååæä½ççº¿ç¨è¿å¥å°åçº¿ç¨éåæéï¼ç­å¾è¯»çº¿ç¨å°éååç´ ç§»é¤ï¼ç¶åå¤éåçº¿ç¨éåçç¬¬ä¸ä¸ªç­å¾çº¿ç¨ã\n\nå¯¹äº arrayblockingqueueï¼æä»¬å¯ä»¥å¨æé çæ¶åæå®ä»¥ä¸ä¸ä¸ªåæ°ï¼\n\n * éåå®¹éï¼å¶éå¶äºéåä¸­æå¤åè®¸çåç´ ä¸ªæ°ï¼\n * æå®ç¬å éæ¯å¬å¹³éè¿æ¯éå¬å¹³éãéå¬å¹³éçååéæ¯è¾é«ï¼å¬å¹³éå¯ä»¥ä¿è¯æ¯æ¬¡é½æ¯ç­å¾æä¹ççº¿ç¨è·åå°éï¼\n * å¯ä»¥æå®ç¨ä¸ä¸ªéåæ¥åå§åï¼å°æ­¤éåä¸­çåç´ å¨æé æ¹æ³æé´å°±åæ·»å å°éåä¸­ã\n\n\n# linkedblockingqueue ç±»\n\nlinkedblockingqueue æ¯ç±é¾è¡¨ç»æç»æçæçé»å¡éåãå®¹æè¢«è¯¯è§£ä¸ºæ è¾¹çï¼ä½å¶å®å¶è¡ä¸ºååé¨ä»£ç é½æ¯åºäºæççé»è¾å®ç°çï¼åªä¸è¿å¦ææä»¬æ²¡æå¨åå»ºéåæ¶å°±æå®å®¹éï¼é£ä¹å¶å®¹ééå¶å°±èªå¨è¢«è®¾ç½®ä¸º integer.max_valueï¼æä¸ºäºæ çéåã\n\n# linkedblockingqueue è¦ç¹\n\nlinkedblockingqueue ç±»å®ä¹å¦ä¸ï¼\n\npublic class linkedblockingqueue<e> extends abstractqueue<e>\n        implements blockingqueue<e>, java.io.serializable {}\n\n\n * linkedblockingqueue å®ç°äº blockingqueueï¼ä¹æ¯ä¸ä¸ªé»å¡éåã\n * linkedblockingqueue å®ç°äº serializableï¼æ¯æåºååã\n * linkedblockingqueue æ¯åºäºåé¾è¡¨å®ç°çé»å¡éåï¼å¯ä»¥å½åæ çéåä¹å¯ä»¥å½åæçéåæ¥ä½¿ç¨ã\n * linkedblockingqueue ä¸­åç´ æç§æå¥é¡ºåºä¿å­ï¼fifoï¼ã\n\n# linkedblockingqueue åç\n\nlinkedblockingqueue ä¸­çéè¦æ°æ®ç»æï¼\n\n// éåå®¹é\nprivate final int capacity;\n// éåä¸­çåç´ æ°é\nprivate final atomicinteger count = new atomicinteger(0);\n// éå¤´\nprivate transient node<e> head;\n// éå°¾\nprivate transient node<e> last;\n\n// take, poll, peek ç­è¯»æä½çæ¹æ³éè¦è·åå°è¿ä¸ªé\nprivate final reentrantlock takelock = new reentrantlock();\n// å¦æè¯»æä½çæ¶åéåæ¯ç©ºçï¼é£ä¹ç­å¾ notempty æ¡ä»¶\nprivate final condition notempty = takelock.newcondition();\n// put, offer ç­åæä½çæ¹æ³éè¦è·åå°è¿ä¸ªé\nprivate final reentrantlock putlock = new reentrantlock();\n// å¦æåæä½çæ¶åéåæ¯æ»¡çï¼é£ä¹ç­å¾ notfull æ¡ä»¶\nprivate final condition notfull = putlock.newcondition();\n\n\nè¿éç¨äºä¸¤å¯¹ lock å conditionï¼ç®åä»ç»å¦ä¸ï¼\n\n * takelock å notempty æ­éï¼å¦æè¦è·åï¼takeï¼ä¸ä¸ªåç´ ï¼éè¦è·å takelock éï¼ä½æ¯è·åäºéè¿ä¸å¤ï¼å¦æéåæ­¤æ¶ä¸ºç©ºï¼è¿éè¦éåä¸ä¸ºç©ºï¼notemptyï¼è¿ä¸ªæ¡ä»¶ï¼conditionï¼ã\n * putlock éè¦å notfull æ­éï¼å¦æè¦æå¥ï¼putï¼ä¸ä¸ªåç´ ï¼éè¦è·å putlock éï¼ä½æ¯è·åäºéè¿ä¸å¤ï¼å¦æéåæ­¤æ¶å·²æ»¡ï¼è¿éè¦éåä¸æ¯æ»¡çï¼notfullï¼è¿ä¸ªæ¡ä»¶ï¼conditionï¼ã\n\n\n# synchronousqueue ç±»\n\nsynchronousqueue æ¯ä¸å­å¨åç´ çé»å¡éåãæ¯ä¸ªå é¤æä½é½è¦ç­å¾æå¥æä½ï¼åä¹æ¯ä¸ªæå¥æä½ä¹é½è¦ç­å¾å é¤å¨ä½ãé£ä¹è¿ä¸ªéåçå®¹éæ¯å¤å°å¢ï¼æ¯ 1 åï¼å¶å®ä¸æ¯çï¼å¶åé¨å®¹éæ¯ 0ã\n\nsynchronousqueue å®ä¹å¦ä¸ï¼\n\npublic class synchronousqueue<e> extends abstractqueue<e>\n    implements blockingqueue<e>, java.io.serializable {}\n\n\nsynchronousqueue è¿ä¸ªç±»ï¼å¨çº¿ç¨æ± çå®ç°ç±» scheduledthreadpoolexecutor ä¸­å¾å°äºåºç¨ã\n\nsynchronousqueue çéåå¶å®æ¯èçï¼å³éåå®¹éä¸º 0ãæ°æ®å¿é¡»ä»æä¸ªåçº¿ç¨äº¤ç»æä¸ªè¯»çº¿ç¨ï¼èä¸æ¯åå°æä¸ªéåä¸­ç­å¾è¢«æ¶è´¹ã\n\nsynchronousqueue ä¸­ä¸è½ä½¿ç¨ peek æ¹æ³ï¼å¨è¿éè¿ä¸ªæ¹æ³ç´æ¥è¿å nullï¼ï¼peek æ¹æ³çè¯­ä¹æ¯åªè¯»åä¸ç§»é¤ï¼æ¾ç¶ï¼è¿ä¸ªæ¹æ³çè¯­ä¹æ¯ä¸ç¬¦å synchronousqueue çç¹å¾çã\n\nsynchronousqueue ä¹ä¸è½è¢«è¿­ä»£ï¼å ä¸ºæ ¹æ¬å°±æ²¡æåç´ å¯ä»¥æ¿æ¥è¿­ä»£çã\n\nè½ç¶ synchronousqueue é´æ¥å°å®ç°äº collection æ¥å£ï¼ä½æ¯å¦æä½ å°å¶å½å collection æ¥ç¨çè¯ï¼é£ä¹éåæ¯ç©ºçã\n\nå½ç¶ï¼synchronousqueue ä¹ä¸åè®¸ä¼ é null å¼çï¼å¹¶ååä¸­çå®¹å¨ç±»å¥½åé½ä¸æ¯ææå¥ null å¼ï¼å ä¸º null å¼å¾å¾ç¨ä½å¶ä»ç¨éï¼æ¯å¦ç¨äºæ¹æ³çè¿åå¼ä»£è¡¨æä½å¤±è´¥ï¼ã\n\n\n# concurrentlinkeddeque ç±»\n\ndeque çä¾§éç¹æ¯æ¯æå¯¹éåå¤´å°¾é½è¿è¡æå¥åå é¤ï¼æä»¥æä¾äºç¹å®çæ¹æ³ï¼å¦:\n\n * å°¾é¨æå¥æ¶éè¦ç addlast(e)ãofferlast(e)ã\n * å°¾é¨å é¤æéè¦ç removelast()ãpolllast()ã\n\n\n# queue çå¹¶ååºç¨\n\nqueue è¢«å¹¿æ³ä½¿ç¨å¨çäº§è - æ¶è´¹èåºæ¯ãèå¨å¹¶ååºæ¯ï¼å©ç¨ blockingqueue çé»å¡æºå¶ï¼å¯ä»¥åå°å¾å¤å¹¶ååè°å·¥ä½ã\n\nè¿ä¹å¤å¹¶å queue çå®ç°ï¼å¦ä½éæ©å¢ï¼\n\n * èèåºç¨åºæ¯ä¸­å¯¹éåè¾¹ççè¦æ±ãarrayblockingqueue æ¯ææç¡®çå®¹ééå¶çï¼è linkedblockingqueue ååå³äºæä»¬æ¯å¦å¨åå»ºæ¶æå®ï¼synchronousqueue åå¹²èä¸è½ç¼å­ä»»ä½åç´ ã\n * ä»ç©ºé´å©ç¨è§åº¦ï¼æ°ç»ç»æç arrayblockingqueue è¦æ¯ linkedblockingqueue ç´§åï¼å ä¸ºå¶ä¸éè¦åå»ºæè°èç¹ï¼ä½æ¯å¶åå§åéé¶æ®µå°±éè¦ä¸æ®µè¿ç»­çç©ºé´ï¼æä»¥åå§åå­éæ±æ´å¤§ã\n * éç¨åºæ¯ä¸­ï¼linkedblockingqueue çååéä¸è¬ä¼äº arrayblockingqueueï¼å ä¸ºå®å®ç°äºæ´å ç»ç²åº¦çéæä½ã\n * arrayblockingqueue å®ç°æ¯è¾ç®åï¼æ§è½æ´å¥½é¢æµï¼å±äºè¡¨ç°ç¨³å®çâéæâã\n * å¯è½ä»¤äººæå¤çæ¯ï¼å¾å¤æ¶å synchronousqueue çæ§è½è¡¨ç°ï¼å¾å¾å¤§å¤§è¶è¿å¶ä»å®ç°ï¼å°¤å¶æ¯å¨éååç´ è¾å°çåºæ¯ã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * https://blog.csdn.net/u010425776/article/details/54890215\n * https://blog.csdn.net/wangxiaotongfan/article/details/52074160\n * https://my.oschina.net/hosee/blog/675884\n * https://www.jianshu.com/p/c0642afe03e0\n * https://www.jianshu.com/p/f6730d5784ad\n * http://www.javarticles.com/2012/06/copyonwritearraylist.html\n * https://www.cnblogs.com/xrq730/p/5020760.html\n * https://www.cnblogs.com/leesf456/p/5547853.html\n * http://www.cnblogs.com/chengxiao/p/6881974.html\n * http://www.cnblogs.com/dolphin0520/p/3933404.html\n * hashmap? concurrenthashmap? ç¸ä¿¡çå®è¿ç¯æ²¡äººè½é¾ä½ä½ ï¼',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaçº¿ç¨æ± ",frontmatter:{title:"Javaçº¿ç¨æ± ",date:"2019-12-24T23:52:25.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å","çº¿ç¨æ± "],permalink:"/pages/ad9680/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/07.Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/07.Javaçº¿ç¨æ± .md",key:"v-7a471e72",path:"/pages/ad9680/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:15},{level:3,title:"ä»ä¹æ¯çº¿ç¨æ± ",slug:"ä»ä¹æ¯çº¿ç¨æ± ",normalizedTitle:"ä»ä¹æ¯çº¿ç¨æ± ",charIndex:22},{level:3,title:"ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ",slug:"ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ",normalizedTitle:"ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± ",charIndex:80},{level:2,title:"Executor æ¡æ¶",slug:"executor-æ¡æ¶",normalizedTitle:"executor æ¡æ¶",charIndex:399},{level:3,title:"æ ¸å¿ API æ¦è¿°",slug:"æ ¸å¿-api-æ¦è¿°",normalizedTitle:"æ ¸å¿ api æ¦è¿°",charIndex:492},{level:3,title:"Executor",slug:"executor",normalizedTitle:"executor",charIndex:399},{level:3,title:"ExecutorService",slug:"executorservice",normalizedTitle:"executorservice",charIndex:554},{level:3,title:"ScheduledExecutorService",slug:"scheduledexecutorservice",normalizedTitle:"scheduledexecutorservice",charIndex:631},{level:2,title:"ThreadPoolExecutor",slug:"threadpoolexecutor",normalizedTitle:"threadpoolexecutor",charIndex:753},{level:3,title:"éè¦å­æ®µ",slug:"éè¦å­æ®µ",normalizedTitle:"éè¦å­æ®µ",charIndex:3616},{level:3,title:"æé æ¹æ³",slug:"æé æ¹æ³",normalizedTitle:"æé æ¹æ³",charIndex:5105},{level:3,title:"execute æ¹æ³",slug:"execute-æ¹æ³",normalizedTitle:"execute æ¹æ³",charIndex:1008},{level:3,title:"å¶ä»éè¦æ¹æ³",slug:"å¶ä»éè¦æ¹æ³",normalizedTitle:"å¶ä»éè¦æ¹æ³",charIndex:7996},{level:3,title:"ä½¿ç¨ç¤ºä¾",slug:"ä½¿ç¨ç¤ºä¾",normalizedTitle:"ä½¿ç¨ç¤ºä¾",charIndex:8985},{level:2,title:"Executors",slug:"executors",normalizedTitle:"executors",charIndex:905},{level:3,title:"newSingleThreadExecutor",slug:"newsinglethreadexecutor",normalizedTitle:"newsinglethreadexecutor",charIndex:10119},{level:3,title:"newFixedThreadPool",slug:"newfixedthreadpool",normalizedTitle:"newfixedthreadpool",charIndex:6870},{level:3,title:"newCachedThreadPool",slug:"newcachedthreadpool",normalizedTitle:"newcachedthreadpool",charIndex:7052},{level:3,title:"newScheduleThreadPool",slug:"newschedulethreadpool",normalizedTitle:"newschedulethreadpool",charIndex:12235},{level:3,title:"newWorkStealingPool",slug:"newworkstealingpool",normalizedTitle:"newworkstealingpool",charIndex:13411},{level:2,title:"çº¿ç¨æ± æä½³å®è·µ",slug:"çº¿ç¨æ± æä½³å®è·µ",normalizedTitle:"çº¿ç¨æ± æä½³å®è·µ",charIndex:13506},{level:3,title:"è®¡ç®çº¿ç¨æ°é",slug:"è®¡ç®çº¿ç¨æ°é",normalizedTitle:"è®¡ç®çº¿ç¨æ°é",charIndex:13518},{level:3,title:"å»ºè®®ä½¿ç¨æçé»å¡éå",slug:"å»ºè®®ä½¿ç¨æçé»å¡éå",normalizedTitle:"å»ºè®®ä½¿ç¨æçé»å¡éå",charIndex:13890},{level:3,title:"éè¦ä»»å¡åºè¯¥èªå®ä¹æç»ç­ç¥",slug:"éè¦ä»»å¡åºè¯¥èªå®ä¹æç»ç­ç¥",normalizedTitle:"éè¦ä»»å¡åºè¯¥èªå®ä¹æç»ç­ç¥",charIndex:15528},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:15735}],headersStr:"ç®ä» ä»ä¹æ¯çº¿ç¨æ±  ä¸ºä»ä¹è¦ç¨çº¿ç¨æ±  Executor æ¡æ¶ æ ¸å¿ API æ¦è¿° Executor ExecutorService ScheduledExecutorService ThreadPoolExecutor éè¦å­æ®µ æé æ¹æ³ execute æ¹æ³ å¶ä»éè¦æ¹æ³ ä½¿ç¨ç¤ºä¾ Executors newSingleThreadExecutor newFixedThreadPool newCachedThreadPool newScheduleThreadPool newWorkStealingPool çº¿ç¨æ± æä½³å®è·µ è®¡ç®çº¿ç¨æ°é å»ºè®®ä½¿ç¨æçé»å¡éå éè¦ä»»å¡åºè¯¥èªå®ä¹æç»ç­ç¥ åèèµæ",content:'# Java çº¿ç¨æ± \n\n\n# ç®ä»\n\n\n# ä»ä¹æ¯çº¿ç¨æ± \n\nçº¿ç¨æ± æ¯ä¸ç§å¤çº¿ç¨å¤çå½¢å¼ï¼å¤çè¿ç¨ä¸­å°ä»»å¡æ·»å å°éåï¼ç¶åå¨åå»ºçº¿ç¨åèªå¨å¯å¨è¿äºä»»å¡ã\n\n\n# ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± \n\nå¦æå¹¶åè¯·æ±æ°éå¾å¤ï¼ä½æ¯ä¸ªçº¿ç¨æ§è¡çæ¶é´å¾ç­ï¼å°±ä¼åºç°é¢ç¹çåå»ºåéæ¯çº¿ç¨ãå¦æ­¤ä¸æ¥ï¼ä¼å¤§å¤§éä½ç³»ç»çæçï¼å¯è½é¢ç¹åå»ºåéæ¯çº¿ç¨çæ¶é´ãèµæºå¼éè¦å¤§äºå®éå·¥ä½çæéã\n\næ­£æ¯ç±äºè¿ä¸ªé®é¢ï¼æä»¥æå¿è¦å¼å¥çº¿ç¨æ± ãä½¿ç¨ çº¿ç¨æ± çå¥½å¤ æä»¥ä¸å ç¹ï¼\n\n * éä½èµæºæ¶è - éè¿éå¤å©ç¨å·²åå»ºççº¿ç¨éä½çº¿ç¨åå»ºåéæ¯é æçæ¶èã\n * æé«ååºéåº¦ - å½ä»»å¡å°è¾¾æ¶ï¼ä»»å¡å¯ä»¥ä¸éè¦ç­å°çº¿ç¨åå»ºå°±è½ç«å³æ§è¡ã\n * æé«çº¿ç¨çå¯ç®¡çæ§ - çº¿ç¨æ¯ç¨ç¼ºèµæºï¼å¦ææ éå¶çåå»ºï¼ä¸ä»ä¼æ¶èç³»ç»èµæºï¼è¿ä¼éä½ç³»ç»çç¨³å®æ§ï¼ä½¿ç¨çº¿ç¨æ± å¯ä»¥è¿è¡ç»ä¸çåéï¼è°ä¼åçæ§ãä½æ¯è¦åå°åççå©ç¨çº¿ç¨æ± ï¼å¿é¡»å¯¹å¶åçäºå¦ææã\n\n\n# Executor æ¡æ¶\n\n> Executor æ¡æ¶æ¯ä¸ä¸ªæ ¹æ®ä¸ç»æ§è¡ç­ç¥è°ç¨ï¼è°åº¦ï¼æ§è¡åæ§å¶çå¼æ­¥ä»»å¡çæ¡æ¶ï¼ç®çæ¯æä¾ä¸ç§å°âä»»å¡æäº¤âä¸âä»»å¡å¦ä½è¿è¡âåç¦»å¼æ¥çæºå¶ã\n\n\n# æ ¸å¿ API æ¦è¿°\n\nExecutor æ¡æ¶æ ¸å¿ API å¦ä¸ï¼\n\n * Executor - è¿è¡ä»»å¡çç®åæ¥å£ã\n * ExecutorService - æ©å±äº Executor æ¥å£ãæ©å±è½åï¼\n   * æ¯ææè¿åå¼ççº¿ç¨ï¼\n   * æ¯æç®¡ççº¿ç¨ççå½å¨æã\n * ScheduledExecutorService - æ©å±äº ExecutorService æ¥å£ãæ©å±è½åï¼æ¯æå®ææ§è¡ä»»å¡ã\n * AbstractExecutorService - ExecutorService æ¥å£çé»è®¤å®ç°ã\n * ThreadPoolExecutor - Executor æ¡æ¶ææ ¸å¿çç±»ï¼å®ç»§æ¿äº AbstractExecutorService ç±»ã\n * ScheduledThreadPoolExecutor - ScheduledExecutorService æ¥å£çå®ç°ï¼ä¸ä¸ªå¯å®æ¶è°åº¦ä»»å¡ççº¿ç¨æ± ã\n * Executors - å¯ä»¥éè¿è°ç¨ Executors çéæå·¥åæ¹æ³æ¥åå»ºçº¿ç¨æ± å¹¶è¿åä¸ä¸ª ExecutorService å¯¹è±¡ã\n\n\n\n\n# Executor\n\nExecutor æ¥å£ä¸­åªå®ä¹äºä¸ä¸ª execute æ¹æ³ï¼ç¨äºæ¥æ¶ä¸ä¸ª Runnable å¯¹è±¡ã\n\npublic interface Executor {\n    void execute(Runnable command);\n}\n\n\n\n# ExecutorService\n\nExecutorService æ¥å£ç»§æ¿äº Executor æ¥å£ï¼å®è¿æä¾äº invokeAllãinvokeAnyãshutdownãsubmit ç­æ¹æ³ã\n\npublic interface ExecutorService extends Executor {\n\n    void shutdown();\n\n    List<Runnable> shutdownNow();\n\n    boolean isShutdown();\n\n    boolean isTerminated();\n\n    boolean awaitTermination(long timeout, TimeUnit unit)\n        throws InterruptedException;\n\n    <T> Future<T> submit(Callable<T> task);\n\n    <T> Future<T> submit(Runnable task, T result);\n\n    Future<?> submit(Runnable task);\n\n    <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks)\n        throws InterruptedException;\n\n    <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks,\n                                  long timeout, TimeUnit unit)\n        throws InterruptedException;\n\n    <T> T invokeAny(Collection<? extends Callable<T>> tasks)\n        throws InterruptedException, ExecutionException;\n\n    <T> T invokeAny(Collection<? extends Callable<T>> tasks,\n                    long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException;\n}\n\n\nä»å¶æ¯æçæ¹æ³å®ä¹ï¼ä¸é¾çåºï¼ç¸æ¯äº Executor æ¥å£ï¼ExecutorService æ¥å£ä¸»è¦çæ©å±æ¯ï¼\n\n * æ¯ææè¿åå¼ççº¿ç¨ - sumbitãinvokeAllãinvokeAny æ¹æ³ä¸­é½æ¯æä¼ å¥Callable å¯¹è±¡ã\n * æ¯æç®¡ççº¿ç¨çå½å¨æ - shutdownãshutdownNowãisShutdown ç­æ¹æ³ã\n\n\n# ScheduledExecutorService\n\nScheduledExecutorService æ¥å£æ©å±äº ExecutorService æ¥å£ã\n\nå®é¤äºæ¯æåé¢ä¸¤ä¸ªæ¥å£çææè½åä»¥å¤ï¼è¿æ¯æå®æ¶è°åº¦çº¿ç¨ã\n\npublic interface ScheduledExecutorService extends ExecutorService {\n\n    public ScheduledFuture<?> schedule(Runnable command,\n                                       long delay, TimeUnit unit);\n\n    public <V> ScheduledFuture<V> schedule(Callable<V> callable,\n                                           long delay, TimeUnit unit);\n\n    public ScheduledFuture<?> scheduleAtFixedRate(Runnable command,\n                                                  long initialDelay,\n                                                  long period,\n                                                  TimeUnit unit);\n\n    public ScheduledFuture<?> scheduleWithFixedDelay(Runnable command,\n                                                     long initialDelay,\n                                                     long delay,\n                                                     TimeUnit unit);\n\n}\n\n\nå¶æ©å±çæ¥å£æä¾ä»¥ä¸è½åï¼\n\n * schedule æ¹æ³å¯ä»¥å¨æå®çå»¶æ¶åæ§è¡ä¸ä¸ª Runnable æè Callable ä»»å¡ã\n * scheduleAtFixedRate æ¹æ³å scheduleWithFixedDelay æ¹æ³å¯ä»¥æç§æå®æ¶é´é´éï¼å®ææ§è¡ä»»å¡ã\n\n\n# ThreadPoolExecutor\n\njava.uitl.concurrent.ThreadPoolExecutor ç±»æ¯ Executor æ¡æ¶ä¸­ææ ¸å¿çç±»ãæä»¥ï¼æ¬æå°çéè®²è¿°ä¸ä¸è¿ä¸ªç±»ã\n\n\n# éè¦å­æ®µ\n\nThreadPoolExecutor æä»¥ä¸éè¦å­æ®µï¼\n\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\nprivate static final int COUNT_BITS = Integer.SIZE - 3;\nprivate static final int CAPACITY   = (1 << COUNT_BITS) - 1;\n// runState is stored in the high-order bits\nprivate static final int RUNNING    = -1 << COUNT_BITS;\nprivate static final int SHUTDOWN   =  0 << COUNT_BITS;\nprivate static final int STOP       =  1 << COUNT_BITS;\nprivate static final int TIDYING    =  2 << COUNT_BITS;\nprivate static final int TERMINATED =  3 << COUNT_BITS;\n\n\nåæ°è¯´æï¼\n\n * ctl - ç¨äºæ§å¶çº¿ç¨æ± çè¿è¡ç¶æåçº¿ç¨æ± ä¸­çææçº¿ç¨æ°éãå®åå«ä¸¤é¨åçä¿¡æ¯ï¼\n   * çº¿ç¨æ± çè¿è¡ç¶æ (runState)\n   * çº¿ç¨æ± åææçº¿ç¨çæ°é (workerCount)\n   * å¯ä»¥çå°ï¼ctl ä½¿ç¨äº Integer ç±»åæ¥ä¿å­ï¼é« 3 ä½ä¿å­ runStateï¼ä½ 29 ä½ä¿å­ workerCountãCOUNT_BITS å°±æ¯ 29ï¼CAPACITY å°±æ¯ 1 å·¦ç§» 29 ä½å 1ï¼29 ä¸ª 1ï¼ï¼è¿ä¸ªå¸¸éè¡¨ç¤º workerCount çä¸éå¼ï¼å¤§çº¦æ¯ 5 äº¿ã\n * è¿è¡ç¶æ - çº¿ç¨æ± ä¸å±æäºç§è¿è¡ç¶æï¼\n   * RUNNING - è¿è¡ç¶æãæ¥åæ°ä»»å¡ï¼å¹¶ä¸ä¹è½å¤çé»å¡éåä¸­çä»»å¡ã\n   * SHUTDOWN - å³é­ç¶æãä¸æ¥åæ°ä»»å¡ï¼ä½å¯ä»¥å¤çé»å¡éåä¸­çä»»å¡ã\n     * å¨çº¿ç¨æ± å¤äº RUNNING ç¶ææ¶ï¼è°ç¨ shutdown æ¹æ³ä¼ä½¿çº¿ç¨æ± è¿å¥å°è¯¥ç¶æã\n     * finalize æ¹æ³å¨æ§è¡è¿ç¨ä¸­ä¹ä¼è°ç¨ shutdown æ¹æ³è¿å¥è¯¥ç¶æã\n   * STOP - åæ­¢ç¶æãä¸æ¥åæ°ä»»å¡ï¼ä¹ä¸å¤çéåä¸­çä»»å¡ãä¼ä¸­æ­æ­£å¨å¤çä»»å¡ççº¿ç¨ãå¨çº¿ç¨æ± å¤äº RUNNING æ SHUTDOWN ç¶ææ¶ï¼è°ç¨ shutdownNow æ¹æ³ä¼ä½¿çº¿ç¨æ± è¿å¥å°è¯¥ç¶æã\n   * TIDYING - æ´çç¶æãå¦æææçä»»å¡é½å·²ç»æ­¢äºï¼workerCount (ææçº¿ç¨æ°) ä¸º 0ï¼çº¿ç¨æ± è¿å¥è¯¥ç¶æåä¼è°ç¨ terminated æ¹æ³è¿å¥ TERMINATED ç¶æã\n   * TERMINATED - å·²ç»æ­¢ç¶æãå¨ terminated æ¹æ³æ§è¡å®åè¿å¥è¯¥ç¶æãé»è®¤ terminated æ¹æ³ä¸­ä»ä¹ä¹æ²¡æåãè¿å¥ TERMINATED çæ¡ä»¶å¦ä¸ï¼\n     * çº¿ç¨æ± ä¸æ¯ RUNNING ç¶æï¼\n     * çº¿ç¨æ± ç¶æä¸æ¯ TIDYING ç¶ææ TERMINATED ç¶æï¼\n     * å¦æçº¿ç¨æ± ç¶ææ¯ SHUTDOWN å¹¶ä¸ workerQueue ä¸ºç©ºï¼\n     * workerCount ä¸º 0ï¼\n     * è®¾ç½® TIDYING ç¶ææåã\n\n\n\n\n# æé æ¹æ³\n\nThreadPoolExecutor æåä¸ªæé æ¹æ³ï¼åä¸ä¸ªé½æ¯åºäºç¬¬åä¸ªå®ç°ãç¬¬åä¸ªæé æ¹æ³å®ä¹å¦ä¸ï¼\n\npublic ThreadPoolExecutor(int corePoolSize,\n                              int maximumPoolSize,\n                              long keepAliveTime,\n                              TimeUnit unit,\n                              BlockingQueue<Runnable> workQueue,\n                              ThreadFactory threadFactory,\n                              RejectedExecutionHandler handler) {\n\n\nåæ°è¯´æï¼\n\n * corePoolSize - æ ¸å¿çº¿ç¨æ°éãå½ææ°ä»»å¡éè¿ execute æ¹æ³æäº¤æ¶ ï¼çº¿ç¨æ± ä¼æ§è¡ä»¥ä¸å¤æ­ï¼\n   * å¦æè¿è¡ççº¿ç¨æ°å°äº corePoolSizeï¼ååå»ºæ°çº¿ç¨æ¥å¤çä»»å¡ï¼å³ä½¿çº¿ç¨æ± ä¸­çå¶ä»çº¿ç¨æ¯ç©ºé²çã\n   * å¦æçº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äºç­äº corePoolSize ä¸å°äº maximumPoolSizeï¼ååªæå½ workQueue æ»¡æ¶æåå»ºæ°ççº¿ç¨å»å¤çä»»å¡ï¼\n   * å¦æè®¾ç½®ç corePoolSize å maximumPoolSize ç¸åï¼ååå»ºççº¿ç¨æ± çå¤§å°æ¯åºå®çãè¿æ¶å¦æææ°ä»»å¡æäº¤ï¼è¥ workQueue æªæ»¡ï¼åå°è¯·æ±æ¾å¥ workQueue ä¸­ï¼ç­å¾æç©ºé²ççº¿ç¨å»ä» workQueue ä¸­åä»»å¡å¹¶å¤çï¼\n   * å¦æè¿è¡ççº¿ç¨æ°éå¤§äºç­äº maximumPoolSizeï¼è¿æ¶å¦æ workQueue å·²ç»æ»¡äºï¼åä½¿ç¨ handler ææå®çç­ç¥æ¥å¤çä»»å¡ï¼\n   * æä»¥ï¼ä»»å¡æäº¤æ¶ï¼å¤æ­çé¡ºåºä¸º corePoolSize => workQueue => maximumPoolSizeã\n * maximumPoolSize - æå¤§çº¿ç¨æ°éã\n   * å¦æéåæ»¡äºï¼å¹¶ä¸å·²åå»ºççº¿ç¨æ°å°äºæå¤§çº¿ç¨æ°ï¼åçº¿ç¨æ± ä¼ååå»ºæ°ççº¿ç¨æ§è¡ä»»å¡ã\n   * å¼å¾æ³¨æçæ¯ï¼å¦æä½¿ç¨äºæ ççä»»å¡éåè¿ä¸ªåæ°å°±æ²¡ä»ä¹ææã\n * keepAliveTimeï¼çº¿ç¨ä¿ææ´»å¨çæ¶é´ã\n   * å½çº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äº corePoolSize çæ¶åï¼å¦æè¿æ¶æ²¡ææ°çä»»å¡æäº¤ï¼æ ¸å¿çº¿ç¨å¤ççº¿ç¨ä¸ä¼ç«å³éæ¯ï¼èæ¯ä¼ç­å¾ï¼ç´å°ç­å¾çæ¶é´è¶è¿äº keepAliveTimeã\n   * æä»¥ï¼å¦æä»»å¡å¾å¤ï¼å¹¶ä¸æ¯ä¸ªä»»å¡æ§è¡çæ¶é´æ¯è¾ç­ï¼å¯ä»¥è°å¤§è¿ä¸ªæ¶é´ï¼æé«çº¿ç¨çå©ç¨çã\n * unit - keepAliveTime çæ¶é´åä½ãæ 7 ç§åå¼ãå¯éçåä½æå¤©ï¼DAYSï¼ï¼å°æ¶ï¼HOURSï¼ï¼åéï¼MINUTESï¼ï¼æ¯«ç§(MILLISECONDS)ï¼å¾®ç§(MICROSECONDS, ååä¹ä¸æ¯«ç§)åæ¯«å¾®ç§(NANOSECONDS, ååä¹ä¸å¾®ç§)ã\n * workQueue - ç­å¾æ§è¡çä»»å¡éåãç¨äºä¿å­ç­å¾æ§è¡çä»»å¡çé»å¡éåã å¯ä»¥éæ©ä»¥ä¸å ä¸ªé»å¡éåã\n   * ArrayBlockingQueue - æçé»å¡éåã\n     * æ­¤éåæ¯åºäºæ°ç»çåè¿ååºéåï¼FIFOï¼ã\n     * æ­¤éååå»ºæ¶å¿é¡»æå®å¤§å°ã\n   * LinkedBlockingQueue - æ çé»å¡éåã\n     * æ­¤éåæ¯åºäºé¾è¡¨çåè¿ååºéåï¼FIFOï¼ã\n     * å¦æåå»ºæ¶æ²¡ææå®æ­¤éåå¤§å°ï¼åé»è®¤ä¸º Integer.MAX_VALUEã\n     * ååééå¸¸è¦é«äº ArrayBlockingQueueã\n     * ä½¿ç¨ LinkedBlockingQueue æå³çï¼ maximumPoolSize å°ä¸èµ·ä½ç¨ï¼çº¿ç¨æ± è½åå»ºçæå¤§çº¿ç¨æ°ä¸º corePoolSizeï¼å ä¸ºä»»å¡ç­å¾éåæ¯æ çéåã\n     * Executors.newFixedThreadPool ä½¿ç¨äºè¿ä¸ªéåã\n   * SynchronousQueue - ä¸ä¼ä¿å­æäº¤çä»»å¡ï¼èæ¯å°ç´æ¥æ°å»ºä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æ¥çä»»å¡ã\n     * æ¯ä¸ªæå¥æä½å¿é¡»ç­å°å¦ä¸ä¸ªçº¿ç¨è°ç¨ç§»é¤æä½ï¼å¦åæå¥æä½ä¸ç´å¤äºé»å¡ç¶æã\n     * ååééå¸¸è¦é«äº LinkedBlockingQueueã\n     * Executors.newCachedThreadPool ä½¿ç¨äºè¿ä¸ªéåã\n   * PriorityBlockingQueue - å·æä¼åçº§çæ çé»å¡éåã\n * threadFactory - çº¿ç¨å·¥åãå¯ä»¥éè¿çº¿ç¨å·¥åç»æ¯ä¸ªåå»ºåºæ¥ççº¿ç¨è®¾ç½®æ´ææä¹çåå­ã\n * handler - é¥±åç­ç¥ãå®æ¯ RejectedExecutionHandler ç±»åçåéãå½éååçº¿ç¨æ± é½æ»¡äºï¼è¯´æçº¿ç¨æ± å¤äºé¥±åç¶æï¼é£ä¹å¿é¡»éåä¸ç§ç­ç¥å¤çæäº¤çæ°ä»»å¡ãçº¿ç¨æ± æ¯æä»¥ä¸ç­ç¥ï¼\n   * AbortPolicy - ä¸¢å¼ä»»å¡å¹¶æåºå¼å¸¸ãè¿ä¹æ¯é»è®¤ç­ç¥ã\n   * DiscardPolicy - ä¸¢å¼ä»»å¡ï¼ä½ä¸æåºå¼å¸¸ã\n   * DiscardOldestPolicy - ä¸¢å¼éåæåé¢çä»»å¡ï¼ç¶åéæ°å°è¯æ§è¡ä»»å¡ï¼éå¤æ­¤è¿ç¨ï¼ã\n   * CallerRunsPolicy - ç´æ¥è°ç¨ run æ¹æ³å¹¶ä¸é»å¡æ§è¡ã\n   * å¦æä»¥ä¸ç­ç¥é½ä¸è½æ»¡è¶³éè¦ï¼ä¹å¯ä»¥éè¿å®ç° RejectedExecutionHandler æ¥å£æ¥å®å¶å¤çç­ç¥ãå¦è®°å½æ¥å¿ææä¹åä¸è½å¤ççä»»å¡ã\n\n\n# execute æ¹æ³\n\né»è®¤æåµä¸ï¼åå»ºçº¿ç¨æ± ä¹åï¼çº¿ç¨æ± ä¸­æ¯æ²¡æçº¿ç¨çï¼éè¦æäº¤ä»»å¡ä¹åæä¼åå»ºçº¿ç¨ã\n\næäº¤ä»»å¡å¯ä»¥ä½¿ç¨ execute æ¹æ³ï¼å®æ¯ ThreadPoolExecutor çæ ¸å¿æ¹æ³ï¼éè¿è¿ä¸ªæ¹æ³å¯ä»¥åçº¿ç¨æ± æäº¤ä¸ä¸ªä»»å¡ï¼äº¤ç±çº¿ç¨æ± å»æ§è¡ã\n\nexecute æ¹æ³å·¥ä½æµç¨å¦ä¸ï¼\n\n 1. å¦æ workerCount < corePoolSizeï¼ååå»ºå¹¶å¯å¨ä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æäº¤çä»»å¡ï¼\n 2. å¦æ workerCount >= corePoolSizeï¼ä¸çº¿ç¨æ± åçé»å¡éåæªæ»¡ï¼åå°ä»»å¡æ·»å å°è¯¥é»å¡éåä¸­ï¼\n 3. å¦æ workerCount >= corePoolSize && workerCount < maximumPoolSizeï¼ä¸çº¿ç¨æ± åçé»å¡éåå·²æ»¡ï¼ååå»ºå¹¶å¯å¨ä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æäº¤çä»»å¡ï¼\n 4. å¦æworkerCount >= maximumPoolSizeï¼å¹¶ä¸çº¿ç¨æ± åçé»å¡éåå·²æ»¡ï¼åæ ¹æ®æç»ç­ç¥æ¥å¤çè¯¥ä»»å¡, é»è®¤çå¤çæ¹å¼æ¯ç´æ¥æå¼å¸¸ã\n\n\n\n\n# å¶ä»éè¦æ¹æ³\n\nå¨ ThreadPoolExecutor ç±»ä¸­è¿æä¸äºéè¦çæ¹æ³ï¼\n\n * submit - ç±»ä¼¼äº executeï¼ä½æ¯éå¯¹çæ¯æè¿åå¼ççº¿ç¨ãsubmit æ¹æ³æ¯å¨ ExecutorService ä¸­å£°æçæ¹æ³ï¼å¨ AbstractExecutorService å°±å·²ç»æäºå·ä½çå®ç°ãThreadPoolExecutor ç´æ¥å¤ç¨ AbstractExecutorService ç submit æ¹æ³ã\n * shutdown - ä¸ä¼ç«å³ç»æ­¢çº¿ç¨æ± ï¼èæ¯è¦ç­ææä»»å¡ç¼å­éåä¸­çä»»å¡é½æ§è¡å®åæç»æ­¢ï¼ä½åä¹ä¸ä¼æ¥åæ°çä»»å¡ã\n   * å°çº¿ç¨æ± åæ¢å° SHUTDOWN ç¶æï¼\n   * å¹¶è°ç¨ interruptIdleWorkers æ¹æ³è¯·æ±ä¸­æ­ææç©ºé²ç workerï¼\n   * æåè°ç¨ tryTerminate å°è¯ç»æçº¿ç¨æ± ã\n * shutdownNow - ç«å³ç»æ­¢çº¿ç¨æ± ï¼å¹¶å°è¯ææ­æ­£å¨æ§è¡çä»»å¡ï¼å¹¶ä¸æ¸ç©ºä»»å¡ç¼å­éåï¼è¿åå°æªæ§è¡çä»»å¡ãä¸ shutdown æ¹æ³ç±»ä¼¼ï¼ä¸åçå°æ¹å¨äºï¼\n   * è®¾ç½®ç¶æä¸º STOPï¼\n   * ä¸­æ­ææå·¥ä½çº¿ç¨ï¼æ è®ºæ¯å¦æ¯ç©ºé²çï¼\n   * ååºé»å¡éåä¸­æ²¡æè¢«æ§è¡çä»»å¡å¹¶è¿åã\n * isShutdown - è°ç¨äº shutdown æ shutdownNow æ¹æ³åï¼isShutdown æ¹æ³å°±ä¼è¿å trueã\n * isTerminaed - å½ææçä»»å¡é½å·²å³é­åï¼æè¡¨ç¤ºçº¿ç¨æ± å³é­æåï¼è¿æ¶è°ç¨ isTerminaed æ¹æ³ä¼è¿å trueã\n * setCorePoolSize - è®¾ç½®æ ¸å¿çº¿ç¨æ°å¤§å°ã\n * setMaximumPoolSize - è®¾ç½®æå¤§çº¿ç¨æ°å¤§å°ã\n * getTaskCount - çº¿ç¨æ± å·²ç»æ§è¡çåæªæ§è¡çä»»å¡æ»æ°ï¼\n * getCompletedTaskCount - çº¿ç¨æ± å·²å®æçä»»å¡æ°éï¼è¯¥å¼å°äºç­äº taskCountï¼\n * getLargestPoolSize - çº¿ç¨æ± æ¾ç»åå»ºè¿çæå¤§çº¿ç¨æ°éãéè¿è¿ä¸ªæ°æ®å¯ä»¥ç¥éçº¿ç¨æ± æ¯å¦æ»¡è¿ï¼ä¹å°±æ¯è¾¾å°äº maximumPoolSizeï¼\n * getPoolSize - çº¿ç¨æ± å½åççº¿ç¨æ°éï¼\n * getActiveCount - å½åçº¿ç¨æ± ä¸­æ­£å¨æ§è¡ä»»å¡ççº¿ç¨æ°éã\n\n\n# ä½¿ç¨ç¤ºä¾\n\npublic class ThreadPoolExecutorDemo {\n\n    public static void main(String[] args) {\n        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(5, 10, 500, TimeUnit.MILLISECONDS,\n            new LinkedBlockingQueue<Runnable>(),\n            Executors.defaultThreadFactory(),\n            new ThreadPoolExecutor.AbortPolicy());\n\n        for (int i = 0; i < 100; i++) {\n            threadPoolExecutor.execute(new MyThread());\n            String info = String.format("çº¿ç¨æ± ä¸­çº¿ç¨æ°ç®ï¼%sï¼éåä¸­ç­å¾æ§è¡çä»»å¡æ°ç®ï¼%sï¼å·²æ§è¡ç©å«çä»»å¡æ°ç®ï¼%s",\n                threadPoolExecutor.getPoolSize(),\n                threadPoolExecutor.getQueue().size(),\n                threadPoolExecutor.getCompletedTaskCount());\n            System.out.println(info);\n        }\n        threadPoolExecutor.shutdown();\n    }\n\n    static class MyThread implements Runnable {\n\n        @Override\n        public void run() {\n            System.out.println(Thread.currentThread().getName() + " æ§è¡");\n        }\n\n    }\n\n}\n\n\n\n# Executors\n\nJDK ç Executors ç±»ä¸­æä¾äºå ç§å·æä»£è¡¨æ§ççº¿ç¨æ± ï¼è¿äºçº¿ç¨æ±  é½æ¯åºäº ThreadPoolExecutor çå®å¶åå®ç°ã\n\nå¨å®éä½¿ç¨çº¿ç¨æ± çåºæ¯ä¸­ï¼æä»¬å¾å¾ä¸æ¯ç´æ¥ä½¿ç¨ ThreadPoolExecutor ï¼èæ¯ä½¿ç¨ JDK ä¸­æä¾çå·æä»£è¡¨æ§ççº¿ç¨æ± å®ä¾ã\n\n\n# newSingleThreadExecutor\n\nåå»ºä¸ä¸ªåçº¿ç¨ççº¿ç¨æ± ã\n\nåªä¼åå»ºå¯ä¸çå·¥ä½çº¿ç¨æ¥æ§è¡ä»»å¡ï¼ä¿è¯ææä»»å¡æç§æå®é¡ºåº(FIFO, LIFO, ä¼åçº§)æ§è¡ã å¦æè¿ä¸ªå¯ä¸ççº¿ç¨å ä¸ºå¼å¸¸ç»æï¼é£ä¹ä¼æä¸ä¸ªæ°ççº¿ç¨æ¥æ¿ä»£å® ã\n\nåå·¥ä½çº¿ç¨æå¤§çç¹ç¹æ¯ï¼å¯ä¿è¯é¡ºåºå°æ§è¡åä¸ªä»»å¡ã\n\nç¤ºä¾ï¼\n\npublic class SingleThreadExecutorDemo {\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newSingleThreadExecutor();\n        for (int i = 0; i < 100; i++) {\n            executorService.execute(new Runnable() {\n                @Override\n                public void run() {\n                    System.out.println(Thread.currentThread().getName() + " æ§è¡");\n                }\n            });\n        }\n        executorService.shutdown();\n    }\n\n}\n\n\n\n# newFixedThreadPool\n\nåå»ºä¸ä¸ªåºå®å¤§å°ççº¿ç¨æ± ã\n\næ¯æ¬¡æäº¤ä¸ä¸ªä»»å¡å°±ä¼æ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ï¼å¦æå·¥ä½çº¿ç¨æ°éè¾¾å°çº¿ç¨æ± æå¤§çº¿ç¨æ°ï¼åå°æäº¤çä»»å¡å­å¥å°é»å¡éåä¸­ã\n\nFixedThreadPool æ¯ä¸ä¸ªå¸åä¸ä¼ç§ççº¿ç¨æ± ï¼å®å·æçº¿ç¨æ± æé«ç¨åºæçåèçåå»ºçº¿ç¨æ¶æèçå¼éçä¼ç¹ãä½æ¯ï¼å¨çº¿ç¨æ± ç©ºé²æ¶ï¼å³çº¿ç¨æ± ä¸­æ²¡æå¯è¿è¡ä»»å¡æ¶ï¼å®ä¸ä¼éæ¾å·¥ä½çº¿ç¨ï¼è¿ä¼å ç¨ä¸å®çç³»ç»èµæºã\n\nç¤ºä¾ï¼\n\npublic class FixedThreadPoolDemo {\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        for (int i = 0; i < 100; i++) {\n            executorService.execute(new Runnable() {\n                @Override\n                public void run() {\n                    System.out.println(Thread.currentThread().getName() + " æ§è¡");\n                }\n            });\n        }\n        executorService.shutdown();\n    }\n\n}\n\n\n\n# newCachedThreadPool\n\nåå»ºä¸ä¸ªå¯ç¼å­ççº¿ç¨æ± ã\n\n * å¦æçº¿ç¨æ± å¤§å°è¶è¿å¤çä»»å¡æéè¦ççº¿ç¨æ°ï¼å°±ä¼åæ¶é¨åç©ºé²ççº¿ç¨ï¼\n * å¦æé¿æ¶é´æ²¡æå¾çº¿ç¨æ± ä¸­æäº¤ä»»å¡ï¼å³å¦æå·¥ä½çº¿ç¨ç©ºé²äºæå®çæ¶é´ï¼é»è®¤ä¸º 1 åéï¼ï¼åè¯¥å·¥ä½çº¿ç¨å°èªå¨ç»æ­¢ãç»æ­¢åï¼å¦æä½ åæäº¤äºæ°çä»»å¡ï¼åçº¿ç¨æ± éæ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ã\n * æ­¤çº¿ç¨æ± ä¸ä¼å¯¹çº¿ç¨æ± å¤§å°åéå¶ï¼çº¿ç¨æ± å¤§å°å®å¨ä¾èµäºæä½ç³»ç»ï¼æèè¯´ JVMï¼è½å¤åå»ºçæå¤§çº¿ç¨å¤§å°ã å æ­¤ï¼ä½¿ç¨ CachedThreadPool æ¶ï¼ä¸å®è¦æ³¨ææ§å¶ä»»å¡çæ°éï¼å¦åï¼ç±äºå¤§éçº¿ç¨åæ¶è¿è¡ï¼å¾æä¼é æç³»ç»ç«çªã\n\nç¤ºä¾ï¼\n\npublic class CachedThreadPoolDemo {\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newCachedThreadPool();\n        for (int i = 0; i < 100; i++) {\n            executorService.execute(new Runnable() {\n                @Override\n                public void run() {\n                    System.out.println(Thread.currentThread().getName() + " æ§è¡");\n                }\n            });\n        }\n        executorService.shutdown();\n    }\n\n}\n\n\n\n# newScheduleThreadPool\n\nåå»ºä¸ä¸ªå¤§å°æ éççº¿ç¨æ± ãæ­¤çº¿ç¨æ± æ¯æå®æ¶ä»¥åå¨ææ§æ§è¡ä»»å¡çéæ±ã\n\npublic class ScheduledThreadPoolDemo {\n\n    public static void main(String[] args) {\n        schedule();\n        scheduleAtFixedRate();\n    }\n\n    private static void schedule() {\n        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(5);\n        for (int i = 0; i < 100; i++) {\n            executorService.schedule(new Runnable() {\n                @Override\n                public void run() {\n                    System.out.println(Thread.currentThread().getName() + " æ§è¡");\n                }\n            }, 1, TimeUnit.SECONDS);\n        }\n        executorService.shutdown();\n    }\n\n    private static void scheduleAtFixedRate() {\n        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(5);\n        for (int i = 0; i < 100; i++) {\n            executorService.scheduleAtFixedRate(new Runnable() {\n                @Override\n                public void run() {\n                    System.out.println(Thread.currentThread().getName() + " æ§è¡");\n                }\n            }, 1, 1, TimeUnit.SECONDS);\n        }\n        executorService.shutdown();\n    }\n\n}\n\n\n\n# newWorkStealingPool\n\nJava 8 æå¼å¥ã\n\nå¶åé¨ä¼æå»º ForkJoinPoolï¼å©ç¨ Work-Stealing ç®æ³ï¼å¹¶è¡å°å¤çä»»å¡ï¼ä¸ä¿è¯å¤çé¡ºåºã\n\n\n# çº¿ç¨æ± æä½³å®è·µ\n\n\n# è®¡ç®çº¿ç¨æ°é\n\nä¸è¬å¤çº¿ç¨æ§è¡çä»»å¡ç±»åå¯ä»¥åä¸º CPU å¯éåå I/O å¯éåï¼æ ¹æ®ä¸åçä»»å¡ç±»åï¼æä»¬è®¡ç®çº¿ç¨æ°çæ¹æ³ä¹ä¸ä¸æ ·ã\n\n**CPU å¯éåä»»å¡ï¼**è¿ç§ä»»å¡æ¶èçä¸»è¦æ¯ CPU èµæºï¼å¯ä»¥å°çº¿ç¨æ°è®¾ç½®ä¸º Nï¼CPU æ ¸å¿æ°ï¼+1ï¼æ¯ CPU æ ¸å¿æ°å¤åºæ¥çä¸ä¸ªçº¿ç¨æ¯ä¸ºäºé²æ­¢çº¿ç¨å¶åçç¼ºé¡µä¸­æ­ï¼æèå¶å®åå å¯¼è´çä»»å¡æåèå¸¦æ¥çå½±åãä¸æ¦ä»»å¡æåï¼CPU å°±ä¼å¤äºç©ºé²ç¶æï¼èå¨è¿ç§æåµä¸å¤åºæ¥çä¸ä¸ªçº¿ç¨å°±å¯ä»¥ååå©ç¨ CPU çç©ºé²æ¶é´ã\n\n**I/O å¯éåä»»å¡ï¼**è¿ç§ä»»å¡åºç¨èµ·æ¥ï¼ç³»ç»ä¼ç¨å¤§é¨åçæ¶é´æ¥å¤ç I/O äº¤äºï¼èçº¿ç¨å¨å¤ç I/O çæ¶é´æ®µåä¸ä¼å ç¨ CPU æ¥å¤çï¼è¿æ¶å°±å¯ä»¥å° CPU äº¤åºç»å¶å®çº¿ç¨ä½¿ç¨ãå æ­¤å¨ I/O å¯éåä»»å¡çåºç¨ä¸­ï¼æä»¬å¯ä»¥å¤éç½®ä¸äºçº¿ç¨ï¼å·ä½çè®¡ç®æ¹æ³æ¯ 2Nã\n\n\n# å»ºè®®ä½¿ç¨æçé»å¡éå\n\nä¸å»ºè®®ä½¿ç¨ Executors çæéè¦çåå æ¯ï¼Executors æä¾çå¾å¤æ¹æ³é»è®¤ä½¿ç¨çé½æ¯æ çç LinkedBlockingQueueï¼é«è´è½½æå¢ä¸ï¼æ çéåå¾å®¹æå¯¼è´ OOMï¼è OOM ä¼å¯¼è´ææè¯·æ±é½æ æ³å¤çï¼è¿æ¯è´å½é®é¢ãæä»¥å¼ºçå»ºè®®ä½¿ç¨æçéåã\n\nãé¿éå·´å·´ Java å¼åæåãä¸­æå°ï¼ç¦æ­¢ä½¿ç¨è¿äºæ¹æ³æ¥åå»ºçº¿ç¨æ± ï¼èåºè¯¥æå¨ new ThreadPoolExecutor æ¥åå»ºçº¿ç¨æ± ãå¶è®¢è¿æ¡è§åæ¯å ä¸ºå®¹æå¯¼è´çäº§äºæï¼æå¸åçå°±æ¯ newFixedThreadPool å newCachedThreadPoolï¼å¯è½å ä¸ºèµæºèå°½å¯¼è´ OOM é®é¢ã\n\nãç¤ºä¾ãnewFixedThreadPool OOM\n\nThreadPoolExecutor threadPool = (ThreadPoolExecutor) Executors.newFixedThreadPool(1);\nprintStats(threadPool);\nfor (int i = 0; i < 100000000; i++) {\n\tthreadPool.execute(() -> {\n\t\tString payload = IntStream.rangeClosed(1, 1000000)\n\t\t\t.mapToObj(__ -> "a")\n\t\t\t.collect(Collectors.joining("")) + UUID.randomUUID().toString();\n\t\ttry {\n\t\t\tTimeUnit.HOURS.sleep(1);\n\t\t} catch (InterruptedException e) {\n\t\t}\n\t\tlog.info(payload);\n\t});\n}\n\nthreadPool.shutdown();\nthreadPool.awaitTermination(1, TimeUnit.HOURS);\n\n\nnewFixedThreadPool ä½¿ç¨çå·¥ä½éåæ¯ LinkedBlockingQueue ï¼èé»è®¤æé æ¹æ³ç LinkedBlockingQueue æ¯ä¸ä¸ª Integer.MAX_VALUE é¿åº¦çéåï¼å¯ä»¥è®¤ä¸ºæ¯æ ççãå¦æä»»å¡è¾å¤å¹¶ä¸æ§è¡è¾æ¢çè¯ï¼éåå¯è½ä¼å¿«éç§¯åï¼æçåå­å¯¼è´ OOMã\n\nãç¤ºä¾ãnewCachedThreadPool OOM\n\nThreadPoolExecutor threadPool = (ThreadPoolExecutor) Executors.newCachedThreadPool();\nprintStats(threadPool);\nfor (int i = 0; i < 100000000; i++) {\n\tthreadPool.execute(() -> {\n\t\tString payload = UUID.randomUUID().toString();\n\t\ttry {\n\t\t\tTimeUnit.HOURS.sleep(1);\n\t\t} catch (InterruptedException e) {\n\t\t}\n\t\tlog.info(payload);\n\t});\n}\nthreadPool.shutdown();\nthreadPool.awaitTermination(1, TimeUnit.HOURS);\n\n\nnewCachedThreadPool çæå¤§çº¿ç¨æ°æ¯ Integer.MAX_VALUEï¼å¯ä»¥è®¤ä¸ºæ¯æ²¡æä¸éçï¼èå¶å·¥ä½éå SynchronousQueue æ¯ä¸ä¸ªæ²¡æå­å¨ç©ºé´çé»å¡éåãè¿æå³çï¼åªè¦æè¯·æ±å°æ¥ï¼å°±å¿é¡»æ¾å°ä¸æ¡å·¥ä½çº¿ç¨æ¥å¤çï¼å¦æå½åæ²¡æç©ºé²ççº¿ç¨å°±ååå»ºä¸æ¡æ°çã\n\nå¦æå¤§éçä»»å¡è¿æ¥åä¼åå»ºå¤§éççº¿ç¨ãæä»¬ç¥éçº¿ç¨æ¯éè¦åéä¸å®çåå­ç©ºé´ä½ä¸ºçº¿ç¨æ çï¼æ¯å¦ 1MBï¼å æ­¤æ éå¶åå»ºçº¿ç¨å¿ç¶ä¼å¯¼è´ OOMã\n\n\n# éè¦ä»»å¡åºè¯¥èªå®ä¹æç»ç­ç¥\n\nä½¿ç¨æçéåï¼å½ä»»å¡è¿å¤æ¶ï¼çº¿ç¨æ± ä¼è§¦åæ§è¡æç»ç­ç¥ï¼çº¿ç¨æ± é»è®¤çæç»ç­ç¥ä¼ throw RejectedExecutionException è¿æ¯ä¸ªè¿è¡æ¶å¼å¸¸ï¼å¯¹äºè¿è¡æ¶å¼å¸¸ç¼è¯å¨å¹¶ä¸å¼ºå¶ catch å®ï¼æä»¥å¼åäººåå¾å®¹æå¿½ç¥ãå æ­¤é»è®¤æç»ç­ç¥è¦æéä½¿ç¨ãå¦æçº¿ç¨æ± å¤ççä»»å¡éå¸¸éè¦ï¼å»ºè®®èªå®ä¹èªå·±çæç»ç­ç¥ï¼å¹¶ä¸å¨å®éå·¥ä½ä¸­ï¼èªå®ä¹çæç»ç­ç¥å¾å¾åéçº§ç­ç¥éåä½¿ç¨ã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * æ·±å¥çè§£ Java çº¿ç¨æ± ï¼ThreadPoolExecutor\n * java å¹¶åç¼ç¨--Executor æ¡æ¶',normalizedContent:'# java çº¿ç¨æ± \n\n\n# ç®ä»\n\n\n# ä»ä¹æ¯çº¿ç¨æ± \n\nçº¿ç¨æ± æ¯ä¸ç§å¤çº¿ç¨å¤çå½¢å¼ï¼å¤çè¿ç¨ä¸­å°ä»»å¡æ·»å å°éåï¼ç¶åå¨åå»ºçº¿ç¨åèªå¨å¯å¨è¿äºä»»å¡ã\n\n\n# ä¸ºä»ä¹è¦ç¨çº¿ç¨æ± \n\nå¦æå¹¶åè¯·æ±æ°éå¾å¤ï¼ä½æ¯ä¸ªçº¿ç¨æ§è¡çæ¶é´å¾ç­ï¼å°±ä¼åºç°é¢ç¹çåå»ºåéæ¯çº¿ç¨ãå¦æ­¤ä¸æ¥ï¼ä¼å¤§å¤§éä½ç³»ç»çæçï¼å¯è½é¢ç¹åå»ºåéæ¯çº¿ç¨çæ¶é´ãèµæºå¼éè¦å¤§äºå®éå·¥ä½çæéã\n\næ­£æ¯ç±äºè¿ä¸ªé®é¢ï¼æä»¥æå¿è¦å¼å¥çº¿ç¨æ± ãä½¿ç¨ çº¿ç¨æ± çå¥½å¤ æä»¥ä¸å ç¹ï¼\n\n * éä½èµæºæ¶è - éè¿éå¤å©ç¨å·²åå»ºççº¿ç¨éä½çº¿ç¨åå»ºåéæ¯é æçæ¶èã\n * æé«ååºéåº¦ - å½ä»»å¡å°è¾¾æ¶ï¼ä»»å¡å¯ä»¥ä¸éè¦ç­å°çº¿ç¨åå»ºå°±è½ç«å³æ§è¡ã\n * æé«çº¿ç¨çå¯ç®¡çæ§ - çº¿ç¨æ¯ç¨ç¼ºèµæºï¼å¦ææ éå¶çåå»ºï¼ä¸ä»ä¼æ¶èç³»ç»èµæºï¼è¿ä¼éä½ç³»ç»çç¨³å®æ§ï¼ä½¿ç¨çº¿ç¨æ± å¯ä»¥è¿è¡ç»ä¸çåéï¼è°ä¼åçæ§ãä½æ¯è¦åå°åççå©ç¨çº¿ç¨æ± ï¼å¿é¡»å¯¹å¶åçäºå¦ææã\n\n\n# executor æ¡æ¶\n\n> executor æ¡æ¶æ¯ä¸ä¸ªæ ¹æ®ä¸ç»æ§è¡ç­ç¥è°ç¨ï¼è°åº¦ï¼æ§è¡åæ§å¶çå¼æ­¥ä»»å¡çæ¡æ¶ï¼ç®çæ¯æä¾ä¸ç§å°âä»»å¡æäº¤âä¸âä»»å¡å¦ä½è¿è¡âåç¦»å¼æ¥çæºå¶ã\n\n\n# æ ¸å¿ api æ¦è¿°\n\nexecutor æ¡æ¶æ ¸å¿ api å¦ä¸ï¼\n\n * executor - è¿è¡ä»»å¡çç®åæ¥å£ã\n * executorservice - æ©å±äº executor æ¥å£ãæ©å±è½åï¼\n   * æ¯ææè¿åå¼ççº¿ç¨ï¼\n   * æ¯æç®¡ççº¿ç¨ççå½å¨æã\n * scheduledexecutorservice - æ©å±äº executorservice æ¥å£ãæ©å±è½åï¼æ¯æå®ææ§è¡ä»»å¡ã\n * abstractexecutorservice - executorservice æ¥å£çé»è®¤å®ç°ã\n * threadpoolexecutor - executor æ¡æ¶ææ ¸å¿çç±»ï¼å®ç»§æ¿äº abstractexecutorservice ç±»ã\n * scheduledthreadpoolexecutor - scheduledexecutorservice æ¥å£çå®ç°ï¼ä¸ä¸ªå¯å®æ¶è°åº¦ä»»å¡ççº¿ç¨æ± ã\n * executors - å¯ä»¥éè¿è°ç¨ executors çéæå·¥åæ¹æ³æ¥åå»ºçº¿ç¨æ± å¹¶è¿åä¸ä¸ª executorservice å¯¹è±¡ã\n\n\n\n\n# executor\n\nexecutor æ¥å£ä¸­åªå®ä¹äºä¸ä¸ª execute æ¹æ³ï¼ç¨äºæ¥æ¶ä¸ä¸ª runnable å¯¹è±¡ã\n\npublic interface executor {\n    void execute(runnable command);\n}\n\n\n\n# executorservice\n\nexecutorservice æ¥å£ç»§æ¿äº executor æ¥å£ï¼å®è¿æä¾äº invokeallãinvokeanyãshutdownãsubmit ç­æ¹æ³ã\n\npublic interface executorservice extends executor {\n\n    void shutdown();\n\n    list<runnable> shutdownnow();\n\n    boolean isshutdown();\n\n    boolean isterminated();\n\n    boolean awaittermination(long timeout, timeunit unit)\n        throws interruptedexception;\n\n    <t> future<t> submit(callable<t> task);\n\n    <t> future<t> submit(runnable task, t result);\n\n    future<?> submit(runnable task);\n\n    <t> list<future<t>> invokeall(collection<? extends callable<t>> tasks)\n        throws interruptedexception;\n\n    <t> list<future<t>> invokeall(collection<? extends callable<t>> tasks,\n                                  long timeout, timeunit unit)\n        throws interruptedexception;\n\n    <t> t invokeany(collection<? extends callable<t>> tasks)\n        throws interruptedexception, executionexception;\n\n    <t> t invokeany(collection<? extends callable<t>> tasks,\n                    long timeout, timeunit unit)\n        throws interruptedexception, executionexception, timeoutexception;\n}\n\n\nä»å¶æ¯æçæ¹æ³å®ä¹ï¼ä¸é¾çåºï¼ç¸æ¯äº executor æ¥å£ï¼executorservice æ¥å£ä¸»è¦çæ©å±æ¯ï¼\n\n * æ¯ææè¿åå¼ççº¿ç¨ - sumbitãinvokeallãinvokeany æ¹æ³ä¸­é½æ¯æä¼ å¥callable å¯¹è±¡ã\n * æ¯æç®¡ççº¿ç¨çå½å¨æ - shutdownãshutdownnowãisshutdown ç­æ¹æ³ã\n\n\n# scheduledexecutorservice\n\nscheduledexecutorservice æ¥å£æ©å±äº executorservice æ¥å£ã\n\nå®é¤äºæ¯æåé¢ä¸¤ä¸ªæ¥å£çææè½åä»¥å¤ï¼è¿æ¯æå®æ¶è°åº¦çº¿ç¨ã\n\npublic interface scheduledexecutorservice extends executorservice {\n\n    public scheduledfuture<?> schedule(runnable command,\n                                       long delay, timeunit unit);\n\n    public <v> scheduledfuture<v> schedule(callable<v> callable,\n                                           long delay, timeunit unit);\n\n    public scheduledfuture<?> scheduleatfixedrate(runnable command,\n                                                  long initialdelay,\n                                                  long period,\n                                                  timeunit unit);\n\n    public scheduledfuture<?> schedulewithfixeddelay(runnable command,\n                                                     long initialdelay,\n                                                     long delay,\n                                                     timeunit unit);\n\n}\n\n\nå¶æ©å±çæ¥å£æä¾ä»¥ä¸è½åï¼\n\n * schedule æ¹æ³å¯ä»¥å¨æå®çå»¶æ¶åæ§è¡ä¸ä¸ª runnable æè callable ä»»å¡ã\n * scheduleatfixedrate æ¹æ³å schedulewithfixeddelay æ¹æ³å¯ä»¥æç§æå®æ¶é´é´éï¼å®ææ§è¡ä»»å¡ã\n\n\n# threadpoolexecutor\n\njava.uitl.concurrent.threadpoolexecutor ç±»æ¯ executor æ¡æ¶ä¸­ææ ¸å¿çç±»ãæä»¥ï¼æ¬æå°çéè®²è¿°ä¸ä¸è¿ä¸ªç±»ã\n\n\n# éè¦å­æ®µ\n\nthreadpoolexecutor æä»¥ä¸éè¦å­æ®µï¼\n\nprivate final atomicinteger ctl = new atomicinteger(ctlof(running, 0));\nprivate static final int count_bits = integer.size - 3;\nprivate static final int capacity   = (1 << count_bits) - 1;\n// runstate is stored in the high-order bits\nprivate static final int running    = -1 << count_bits;\nprivate static final int shutdown   =  0 << count_bits;\nprivate static final int stop       =  1 << count_bits;\nprivate static final int tidying    =  2 << count_bits;\nprivate static final int terminated =  3 << count_bits;\n\n\nåæ°è¯´æï¼\n\n * ctl - ç¨äºæ§å¶çº¿ç¨æ± çè¿è¡ç¶æåçº¿ç¨æ± ä¸­çææçº¿ç¨æ°éãå®åå«ä¸¤é¨åçä¿¡æ¯ï¼\n   * çº¿ç¨æ± çè¿è¡ç¶æ (runstate)\n   * çº¿ç¨æ± åææçº¿ç¨çæ°é (workercount)\n   * å¯ä»¥çå°ï¼ctl ä½¿ç¨äº integer ç±»åæ¥ä¿å­ï¼é« 3 ä½ä¿å­ runstateï¼ä½ 29 ä½ä¿å­ workercountãcount_bits å°±æ¯ 29ï¼capacity å°±æ¯ 1 å·¦ç§» 29 ä½å 1ï¼29 ä¸ª 1ï¼ï¼è¿ä¸ªå¸¸éè¡¨ç¤º workercount çä¸éå¼ï¼å¤§çº¦æ¯ 5 äº¿ã\n * è¿è¡ç¶æ - çº¿ç¨æ± ä¸å±æäºç§è¿è¡ç¶æï¼\n   * running - è¿è¡ç¶æãæ¥åæ°ä»»å¡ï¼å¹¶ä¸ä¹è½å¤çé»å¡éåä¸­çä»»å¡ã\n   * shutdown - å³é­ç¶æãä¸æ¥åæ°ä»»å¡ï¼ä½å¯ä»¥å¤çé»å¡éåä¸­çä»»å¡ã\n     * å¨çº¿ç¨æ± å¤äº running ç¶ææ¶ï¼è°ç¨ shutdown æ¹æ³ä¼ä½¿çº¿ç¨æ± è¿å¥å°è¯¥ç¶æã\n     * finalize æ¹æ³å¨æ§è¡è¿ç¨ä¸­ä¹ä¼è°ç¨ shutdown æ¹æ³è¿å¥è¯¥ç¶æã\n   * stop - åæ­¢ç¶æãä¸æ¥åæ°ä»»å¡ï¼ä¹ä¸å¤çéåä¸­çä»»å¡ãä¼ä¸­æ­æ­£å¨å¤çä»»å¡ççº¿ç¨ãå¨çº¿ç¨æ± å¤äº running æ shutdown ç¶ææ¶ï¼è°ç¨ shutdownnow æ¹æ³ä¼ä½¿çº¿ç¨æ± è¿å¥å°è¯¥ç¶æã\n   * tidying - æ´çç¶æãå¦æææçä»»å¡é½å·²ç»æ­¢äºï¼workercount (ææçº¿ç¨æ°) ä¸º 0ï¼çº¿ç¨æ± è¿å¥è¯¥ç¶æåä¼è°ç¨ terminated æ¹æ³è¿å¥ terminated ç¶æã\n   * terminated - å·²ç»æ­¢ç¶æãå¨ terminated æ¹æ³æ§è¡å®åè¿å¥è¯¥ç¶æãé»è®¤ terminated æ¹æ³ä¸­ä»ä¹ä¹æ²¡æåãè¿å¥ terminated çæ¡ä»¶å¦ä¸ï¼\n     * çº¿ç¨æ± ä¸æ¯ running ç¶æï¼\n     * çº¿ç¨æ± ç¶æä¸æ¯ tidying ç¶ææ terminated ç¶æï¼\n     * å¦æçº¿ç¨æ± ç¶ææ¯ shutdown å¹¶ä¸ workerqueue ä¸ºç©ºï¼\n     * workercount ä¸º 0ï¼\n     * è®¾ç½® tidying ç¶ææåã\n\n\n\n\n# æé æ¹æ³\n\nthreadpoolexecutor æåä¸ªæé æ¹æ³ï¼åä¸ä¸ªé½æ¯åºäºç¬¬åä¸ªå®ç°ãç¬¬åä¸ªæé æ¹æ³å®ä¹å¦ä¸ï¼\n\npublic threadpoolexecutor(int corepoolsize,\n                              int maximumpoolsize,\n                              long keepalivetime,\n                              timeunit unit,\n                              blockingqueue<runnable> workqueue,\n                              threadfactory threadfactory,\n                              rejectedexecutionhandler handler) {\n\n\nåæ°è¯´æï¼\n\n * corepoolsize - æ ¸å¿çº¿ç¨æ°éãå½ææ°ä»»å¡éè¿ execute æ¹æ³æäº¤æ¶ ï¼çº¿ç¨æ± ä¼æ§è¡ä»¥ä¸å¤æ­ï¼\n   * å¦æè¿è¡ççº¿ç¨æ°å°äº corepoolsizeï¼ååå»ºæ°çº¿ç¨æ¥å¤çä»»å¡ï¼å³ä½¿çº¿ç¨æ± ä¸­çå¶ä»çº¿ç¨æ¯ç©ºé²çã\n   * å¦æçº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äºç­äº corepoolsize ä¸å°äº maximumpoolsizeï¼ååªæå½ workqueue æ»¡æ¶æåå»ºæ°ççº¿ç¨å»å¤çä»»å¡ï¼\n   * å¦æè®¾ç½®ç corepoolsize å maximumpoolsize ç¸åï¼ååå»ºççº¿ç¨æ± çå¤§å°æ¯åºå®çãè¿æ¶å¦æææ°ä»»å¡æäº¤ï¼è¥ workqueue æªæ»¡ï¼åå°è¯·æ±æ¾å¥ workqueue ä¸­ï¼ç­å¾æç©ºé²ççº¿ç¨å»ä» workqueue ä¸­åä»»å¡å¹¶å¤çï¼\n   * å¦æè¿è¡ççº¿ç¨æ°éå¤§äºç­äº maximumpoolsizeï¼è¿æ¶å¦æ workqueue å·²ç»æ»¡äºï¼åä½¿ç¨ handler ææå®çç­ç¥æ¥å¤çä»»å¡ï¼\n   * æä»¥ï¼ä»»å¡æäº¤æ¶ï¼å¤æ­çé¡ºåºä¸º corepoolsize => workqueue => maximumpoolsizeã\n * maximumpoolsize - æå¤§çº¿ç¨æ°éã\n   * å¦æéåæ»¡äºï¼å¹¶ä¸å·²åå»ºççº¿ç¨æ°å°äºæå¤§çº¿ç¨æ°ï¼åçº¿ç¨æ± ä¼ååå»ºæ°ççº¿ç¨æ§è¡ä»»å¡ã\n   * å¼å¾æ³¨æçæ¯ï¼å¦æä½¿ç¨äºæ ççä»»å¡éåè¿ä¸ªåæ°å°±æ²¡ä»ä¹ææã\n * keepalivetimeï¼çº¿ç¨ä¿ææ´»å¨çæ¶é´ã\n   * å½çº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äº corepoolsize çæ¶åï¼å¦æè¿æ¶æ²¡ææ°çä»»å¡æäº¤ï¼æ ¸å¿çº¿ç¨å¤ççº¿ç¨ä¸ä¼ç«å³éæ¯ï¼èæ¯ä¼ç­å¾ï¼ç´å°ç­å¾çæ¶é´è¶è¿äº keepalivetimeã\n   * æä»¥ï¼å¦æä»»å¡å¾å¤ï¼å¹¶ä¸æ¯ä¸ªä»»å¡æ§è¡çæ¶é´æ¯è¾ç­ï¼å¯ä»¥è°å¤§è¿ä¸ªæ¶é´ï¼æé«çº¿ç¨çå©ç¨çã\n * unit - keepalivetime çæ¶é´åä½ãæ 7 ç§åå¼ãå¯éçåä½æå¤©ï¼daysï¼ï¼å°æ¶ï¼hoursï¼ï¼åéï¼minutesï¼ï¼æ¯«ç§(milliseconds)ï¼å¾®ç§(microseconds, ååä¹ä¸æ¯«ç§)åæ¯«å¾®ç§(nanoseconds, ååä¹ä¸å¾®ç§)ã\n * workqueue - ç­å¾æ§è¡çä»»å¡éåãç¨äºä¿å­ç­å¾æ§è¡çä»»å¡çé»å¡éåã å¯ä»¥éæ©ä»¥ä¸å ä¸ªé»å¡éåã\n   * arrayblockingqueue - æçé»å¡éåã\n     * æ­¤éåæ¯åºäºæ°ç»çåè¿ååºéåï¼fifoï¼ã\n     * æ­¤éååå»ºæ¶å¿é¡»æå®å¤§å°ã\n   * linkedblockingqueue - æ çé»å¡éåã\n     * æ­¤éåæ¯åºäºé¾è¡¨çåè¿ååºéåï¼fifoï¼ã\n     * å¦æåå»ºæ¶æ²¡ææå®æ­¤éåå¤§å°ï¼åé»è®¤ä¸º integer.max_valueã\n     * ååééå¸¸è¦é«äº arrayblockingqueueã\n     * ä½¿ç¨ linkedblockingqueue æå³çï¼ maximumpoolsize å°ä¸èµ·ä½ç¨ï¼çº¿ç¨æ± è½åå»ºçæå¤§çº¿ç¨æ°ä¸º corepoolsizeï¼å ä¸ºä»»å¡ç­å¾éåæ¯æ çéåã\n     * executors.newfixedthreadpool ä½¿ç¨äºè¿ä¸ªéåã\n   * synchronousqueue - ä¸ä¼ä¿å­æäº¤çä»»å¡ï¼èæ¯å°ç´æ¥æ°å»ºä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æ¥çä»»å¡ã\n     * æ¯ä¸ªæå¥æä½å¿é¡»ç­å°å¦ä¸ä¸ªçº¿ç¨è°ç¨ç§»é¤æä½ï¼å¦åæå¥æä½ä¸ç´å¤äºé»å¡ç¶æã\n     * ååééå¸¸è¦é«äº linkedblockingqueueã\n     * executors.newcachedthreadpool ä½¿ç¨äºè¿ä¸ªéåã\n   * priorityblockingqueue - å·æä¼åçº§çæ çé»å¡éåã\n * threadfactory - çº¿ç¨å·¥åãå¯ä»¥éè¿çº¿ç¨å·¥åç»æ¯ä¸ªåå»ºåºæ¥ççº¿ç¨è®¾ç½®æ´ææä¹çåå­ã\n * handler - é¥±åç­ç¥ãå®æ¯ rejectedexecutionhandler ç±»åçåéãå½éååçº¿ç¨æ± é½æ»¡äºï¼è¯´æçº¿ç¨æ± å¤äºé¥±åç¶æï¼é£ä¹å¿é¡»éåä¸ç§ç­ç¥å¤çæäº¤çæ°ä»»å¡ãçº¿ç¨æ± æ¯æä»¥ä¸ç­ç¥ï¼\n   * abortpolicy - ä¸¢å¼ä»»å¡å¹¶æåºå¼å¸¸ãè¿ä¹æ¯é»è®¤ç­ç¥ã\n   * discardpolicy - ä¸¢å¼ä»»å¡ï¼ä½ä¸æåºå¼å¸¸ã\n   * discardoldestpolicy - ä¸¢å¼éåæåé¢çä»»å¡ï¼ç¶åéæ°å°è¯æ§è¡ä»»å¡ï¼éå¤æ­¤è¿ç¨ï¼ã\n   * callerrunspolicy - ç´æ¥è°ç¨ run æ¹æ³å¹¶ä¸é»å¡æ§è¡ã\n   * å¦æä»¥ä¸ç­ç¥é½ä¸è½æ»¡è¶³éè¦ï¼ä¹å¯ä»¥éè¿å®ç° rejectedexecutionhandler æ¥å£æ¥å®å¶å¤çç­ç¥ãå¦è®°å½æ¥å¿ææä¹åä¸è½å¤ççä»»å¡ã\n\n\n# execute æ¹æ³\n\né»è®¤æåµä¸ï¼åå»ºçº¿ç¨æ± ä¹åï¼çº¿ç¨æ± ä¸­æ¯æ²¡æçº¿ç¨çï¼éè¦æäº¤ä»»å¡ä¹åæä¼åå»ºçº¿ç¨ã\n\næäº¤ä»»å¡å¯ä»¥ä½¿ç¨ execute æ¹æ³ï¼å®æ¯ threadpoolexecutor çæ ¸å¿æ¹æ³ï¼éè¿è¿ä¸ªæ¹æ³å¯ä»¥åçº¿ç¨æ± æäº¤ä¸ä¸ªä»»å¡ï¼äº¤ç±çº¿ç¨æ± å»æ§è¡ã\n\nexecute æ¹æ³å·¥ä½æµç¨å¦ä¸ï¼\n\n 1. å¦æ workercount < corepoolsizeï¼ååå»ºå¹¶å¯å¨ä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æäº¤çä»»å¡ï¼\n 2. å¦æ workercount >= corepoolsizeï¼ä¸çº¿ç¨æ± åçé»å¡éåæªæ»¡ï¼åå°ä»»å¡æ·»å å°è¯¥é»å¡éåä¸­ï¼\n 3. å¦æ workercount >= corepoolsize && workercount < maximumpoolsizeï¼ä¸çº¿ç¨æ± åçé»å¡éåå·²æ»¡ï¼ååå»ºå¹¶å¯å¨ä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æäº¤çä»»å¡ï¼\n 4. å¦æworkercount >= maximumpoolsizeï¼å¹¶ä¸çº¿ç¨æ± åçé»å¡éåå·²æ»¡ï¼åæ ¹æ®æç»ç­ç¥æ¥å¤çè¯¥ä»»å¡, é»è®¤çå¤çæ¹å¼æ¯ç´æ¥æå¼å¸¸ã\n\n\n\n\n# å¶ä»éè¦æ¹æ³\n\nå¨ threadpoolexecutor ç±»ä¸­è¿æä¸äºéè¦çæ¹æ³ï¼\n\n * submit - ç±»ä¼¼äº executeï¼ä½æ¯éå¯¹çæ¯æè¿åå¼ççº¿ç¨ãsubmit æ¹æ³æ¯å¨ executorservice ä¸­å£°æçæ¹æ³ï¼å¨ abstractexecutorservice å°±å·²ç»æäºå·ä½çå®ç°ãthreadpoolexecutor ç´æ¥å¤ç¨ abstractexecutorservice ç submit æ¹æ³ã\n * shutdown - ä¸ä¼ç«å³ç»æ­¢çº¿ç¨æ± ï¼èæ¯è¦ç­ææä»»å¡ç¼å­éåä¸­çä»»å¡é½æ§è¡å®åæç»æ­¢ï¼ä½åä¹ä¸ä¼æ¥åæ°çä»»å¡ã\n   * å°çº¿ç¨æ± åæ¢å° shutdown ç¶æï¼\n   * å¹¶è°ç¨ interruptidleworkers æ¹æ³è¯·æ±ä¸­æ­ææç©ºé²ç workerï¼\n   * æåè°ç¨ tryterminate å°è¯ç»æçº¿ç¨æ± ã\n * shutdownnow - ç«å³ç»æ­¢çº¿ç¨æ± ï¼å¹¶å°è¯ææ­æ­£å¨æ§è¡çä»»å¡ï¼å¹¶ä¸æ¸ç©ºä»»å¡ç¼å­éåï¼è¿åå°æªæ§è¡çä»»å¡ãä¸ shutdown æ¹æ³ç±»ä¼¼ï¼ä¸åçå°æ¹å¨äºï¼\n   * è®¾ç½®ç¶æä¸º stopï¼\n   * ä¸­æ­ææå·¥ä½çº¿ç¨ï¼æ è®ºæ¯å¦æ¯ç©ºé²çï¼\n   * ååºé»å¡éåä¸­æ²¡æè¢«æ§è¡çä»»å¡å¹¶è¿åã\n * isshutdown - è°ç¨äº shutdown æ shutdownnow æ¹æ³åï¼isshutdown æ¹æ³å°±ä¼è¿å trueã\n * isterminaed - å½ææçä»»å¡é½å·²å³é­åï¼æè¡¨ç¤ºçº¿ç¨æ± å³é­æåï¼è¿æ¶è°ç¨ isterminaed æ¹æ³ä¼è¿å trueã\n * setcorepoolsize - è®¾ç½®æ ¸å¿çº¿ç¨æ°å¤§å°ã\n * setmaximumpoolsize - è®¾ç½®æå¤§çº¿ç¨æ°å¤§å°ã\n * gettaskcount - çº¿ç¨æ± å·²ç»æ§è¡çåæªæ§è¡çä»»å¡æ»æ°ï¼\n * getcompletedtaskcount - çº¿ç¨æ± å·²å®æçä»»å¡æ°éï¼è¯¥å¼å°äºç­äº taskcountï¼\n * getlargestpoolsize - çº¿ç¨æ± æ¾ç»åå»ºè¿çæå¤§çº¿ç¨æ°éãéè¿è¿ä¸ªæ°æ®å¯ä»¥ç¥éçº¿ç¨æ± æ¯å¦æ»¡è¿ï¼ä¹å°±æ¯è¾¾å°äº maximumpoolsizeï¼\n * getpoolsize - çº¿ç¨æ± å½åççº¿ç¨æ°éï¼\n * getactivecount - å½åçº¿ç¨æ± ä¸­æ­£å¨æ§è¡ä»»å¡ççº¿ç¨æ°éã\n\n\n# ä½¿ç¨ç¤ºä¾\n\npublic class threadpoolexecutordemo {\n\n    public static void main(string[] args) {\n        threadpoolexecutor threadpoolexecutor = new threadpoolexecutor(5, 10, 500, timeunit.milliseconds,\n            new linkedblockingqueue<runnable>(),\n            executors.defaultthreadfactory(),\n            new threadpoolexecutor.abortpolicy());\n\n        for (int i = 0; i < 100; i++) {\n            threadpoolexecutor.execute(new mythread());\n            string info = string.format("çº¿ç¨æ± ä¸­çº¿ç¨æ°ç®ï¼%sï¼éåä¸­ç­å¾æ§è¡çä»»å¡æ°ç®ï¼%sï¼å·²æ§è¡ç©å«çä»»å¡æ°ç®ï¼%s",\n                threadpoolexecutor.getpoolsize(),\n                threadpoolexecutor.getqueue().size(),\n                threadpoolexecutor.getcompletedtaskcount());\n            system.out.println(info);\n        }\n        threadpoolexecutor.shutdown();\n    }\n\n    static class mythread implements runnable {\n\n        @override\n        public void run() {\n            system.out.println(thread.currentthread().getname() + " æ§è¡");\n        }\n\n    }\n\n}\n\n\n\n# executors\n\njdk ç executors ç±»ä¸­æä¾äºå ç§å·æä»£è¡¨æ§ççº¿ç¨æ± ï¼è¿äºçº¿ç¨æ±  é½æ¯åºäº threadpoolexecutor çå®å¶åå®ç°ã\n\nå¨å®éä½¿ç¨çº¿ç¨æ± çåºæ¯ä¸­ï¼æä»¬å¾å¾ä¸æ¯ç´æ¥ä½¿ç¨ threadpoolexecutor ï¼èæ¯ä½¿ç¨ jdk ä¸­æä¾çå·æä»£è¡¨æ§ççº¿ç¨æ± å®ä¾ã\n\n\n# newsinglethreadexecutor\n\nåå»ºä¸ä¸ªåçº¿ç¨ççº¿ç¨æ± ã\n\nåªä¼åå»ºå¯ä¸çå·¥ä½çº¿ç¨æ¥æ§è¡ä»»å¡ï¼ä¿è¯ææä»»å¡æç§æå®é¡ºåº(fifo, lifo, ä¼åçº§)æ§è¡ã å¦æè¿ä¸ªå¯ä¸ççº¿ç¨å ä¸ºå¼å¸¸ç»æï¼é£ä¹ä¼æä¸ä¸ªæ°ççº¿ç¨æ¥æ¿ä»£å® ã\n\nåå·¥ä½çº¿ç¨æå¤§çç¹ç¹æ¯ï¼å¯ä¿è¯é¡ºåºå°æ§è¡åä¸ªä»»å¡ã\n\nç¤ºä¾ï¼\n\npublic class singlethreadexecutordemo {\n\n    public static void main(string[] args) {\n        executorservice executorservice = executors.newsinglethreadexecutor();\n        for (int i = 0; i < 100; i++) {\n            executorservice.execute(new runnable() {\n                @override\n                public void run() {\n                    system.out.println(thread.currentthread().getname() + " æ§è¡");\n                }\n            });\n        }\n        executorservice.shutdown();\n    }\n\n}\n\n\n\n# newfixedthreadpool\n\nåå»ºä¸ä¸ªåºå®å¤§å°ççº¿ç¨æ± ã\n\næ¯æ¬¡æäº¤ä¸ä¸ªä»»å¡å°±ä¼æ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ï¼å¦æå·¥ä½çº¿ç¨æ°éè¾¾å°çº¿ç¨æ± æå¤§çº¿ç¨æ°ï¼åå°æäº¤çä»»å¡å­å¥å°é»å¡éåä¸­ã\n\nfixedthreadpool æ¯ä¸ä¸ªå¸åä¸ä¼ç§ççº¿ç¨æ± ï¼å®å·æçº¿ç¨æ± æé«ç¨åºæçåèçåå»ºçº¿ç¨æ¶æèçå¼éçä¼ç¹ãä½æ¯ï¼å¨çº¿ç¨æ± ç©ºé²æ¶ï¼å³çº¿ç¨æ± ä¸­æ²¡æå¯è¿è¡ä»»å¡æ¶ï¼å®ä¸ä¼éæ¾å·¥ä½çº¿ç¨ï¼è¿ä¼å ç¨ä¸å®çç³»ç»èµæºã\n\nç¤ºä¾ï¼\n\npublic class fixedthreadpooldemo {\n\n    public static void main(string[] args) {\n        executorservice executorservice = executors.newfixedthreadpool(3);\n        for (int i = 0; i < 100; i++) {\n            executorservice.execute(new runnable() {\n                @override\n                public void run() {\n                    system.out.println(thread.currentthread().getname() + " æ§è¡");\n                }\n            });\n        }\n        executorservice.shutdown();\n    }\n\n}\n\n\n\n# newcachedthreadpool\n\nåå»ºä¸ä¸ªå¯ç¼å­ççº¿ç¨æ± ã\n\n * å¦æçº¿ç¨æ± å¤§å°è¶è¿å¤çä»»å¡æéè¦ççº¿ç¨æ°ï¼å°±ä¼åæ¶é¨åç©ºé²ççº¿ç¨ï¼\n * å¦æé¿æ¶é´æ²¡æå¾çº¿ç¨æ± ä¸­æäº¤ä»»å¡ï¼å³å¦æå·¥ä½çº¿ç¨ç©ºé²äºæå®çæ¶é´ï¼é»è®¤ä¸º 1 åéï¼ï¼åè¯¥å·¥ä½çº¿ç¨å°èªå¨ç»æ­¢ãç»æ­¢åï¼å¦æä½ åæäº¤äºæ°çä»»å¡ï¼åçº¿ç¨æ± éæ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ã\n * æ­¤çº¿ç¨æ± ä¸ä¼å¯¹çº¿ç¨æ± å¤§å°åéå¶ï¼çº¿ç¨æ± å¤§å°å®å¨ä¾èµäºæä½ç³»ç»ï¼æèè¯´ jvmï¼è½å¤åå»ºçæå¤§çº¿ç¨å¤§å°ã å æ­¤ï¼ä½¿ç¨ cachedthreadpool æ¶ï¼ä¸å®è¦æ³¨ææ§å¶ä»»å¡çæ°éï¼å¦åï¼ç±äºå¤§éçº¿ç¨åæ¶è¿è¡ï¼å¾æä¼é æç³»ç»ç«çªã\n\nç¤ºä¾ï¼\n\npublic class cachedthreadpooldemo {\n\n    public static void main(string[] args) {\n        executorservice executorservice = executors.newcachedthreadpool();\n        for (int i = 0; i < 100; i++) {\n            executorservice.execute(new runnable() {\n                @override\n                public void run() {\n                    system.out.println(thread.currentthread().getname() + " æ§è¡");\n                }\n            });\n        }\n        executorservice.shutdown();\n    }\n\n}\n\n\n\n# newschedulethreadpool\n\nåå»ºä¸ä¸ªå¤§å°æ éççº¿ç¨æ± ãæ­¤çº¿ç¨æ± æ¯æå®æ¶ä»¥åå¨ææ§æ§è¡ä»»å¡çéæ±ã\n\npublic class scheduledthreadpooldemo {\n\n    public static void main(string[] args) {\n        schedule();\n        scheduleatfixedrate();\n    }\n\n    private static void schedule() {\n        scheduledexecutorservice executorservice = executors.newscheduledthreadpool(5);\n        for (int i = 0; i < 100; i++) {\n            executorservice.schedule(new runnable() {\n                @override\n                public void run() {\n                    system.out.println(thread.currentthread().getname() + " æ§è¡");\n                }\n            }, 1, timeunit.seconds);\n        }\n        executorservice.shutdown();\n    }\n\n    private static void scheduleatfixedrate() {\n        scheduledexecutorservice executorservice = executors.newscheduledthreadpool(5);\n        for (int i = 0; i < 100; i++) {\n            executorservice.scheduleatfixedrate(new runnable() {\n                @override\n                public void run() {\n                    system.out.println(thread.currentthread().getname() + " æ§è¡");\n                }\n            }, 1, 1, timeunit.seconds);\n        }\n        executorservice.shutdown();\n    }\n\n}\n\n\n\n# newworkstealingpool\n\njava 8 æå¼å¥ã\n\nå¶åé¨ä¼æå»º forkjoinpoolï¼å©ç¨ work-stealing ç®æ³ï¼å¹¶è¡å°å¤çä»»å¡ï¼ä¸ä¿è¯å¤çé¡ºåºã\n\n\n# çº¿ç¨æ± æä½³å®è·µ\n\n\n# è®¡ç®çº¿ç¨æ°é\n\nä¸è¬å¤çº¿ç¨æ§è¡çä»»å¡ç±»åå¯ä»¥åä¸º cpu å¯éåå i/o å¯éåï¼æ ¹æ®ä¸åçä»»å¡ç±»åï¼æä»¬è®¡ç®çº¿ç¨æ°çæ¹æ³ä¹ä¸ä¸æ ·ã\n\n**cpu å¯éåä»»å¡ï¼**è¿ç§ä»»å¡æ¶èçä¸»è¦æ¯ cpu èµæºï¼å¯ä»¥å°çº¿ç¨æ°è®¾ç½®ä¸º nï¼cpu æ ¸å¿æ°ï¼+1ï¼æ¯ cpu æ ¸å¿æ°å¤åºæ¥çä¸ä¸ªçº¿ç¨æ¯ä¸ºäºé²æ­¢çº¿ç¨å¶åçç¼ºé¡µä¸­æ­ï¼æèå¶å®åå å¯¼è´çä»»å¡æåèå¸¦æ¥çå½±åãä¸æ¦ä»»å¡æåï¼cpu å°±ä¼å¤äºç©ºé²ç¶æï¼èå¨è¿ç§æåµä¸å¤åºæ¥çä¸ä¸ªçº¿ç¨å°±å¯ä»¥ååå©ç¨ cpu çç©ºé²æ¶é´ã\n\n**i/o å¯éåä»»å¡ï¼**è¿ç§ä»»å¡åºç¨èµ·æ¥ï¼ç³»ç»ä¼ç¨å¤§é¨åçæ¶é´æ¥å¤ç i/o äº¤äºï¼èçº¿ç¨å¨å¤ç i/o çæ¶é´æ®µåä¸ä¼å ç¨ cpu æ¥å¤çï¼è¿æ¶å°±å¯ä»¥å° cpu äº¤åºç»å¶å®çº¿ç¨ä½¿ç¨ãå æ­¤å¨ i/o å¯éåä»»å¡çåºç¨ä¸­ï¼æä»¬å¯ä»¥å¤éç½®ä¸äºçº¿ç¨ï¼å·ä½çè®¡ç®æ¹æ³æ¯ 2nã\n\n\n# å»ºè®®ä½¿ç¨æçé»å¡éå\n\nä¸å»ºè®®ä½¿ç¨ executors çæéè¦çåå æ¯ï¼executors æä¾çå¾å¤æ¹æ³é»è®¤ä½¿ç¨çé½æ¯æ çç linkedblockingqueueï¼é«è´è½½æå¢ä¸ï¼æ çéåå¾å®¹æå¯¼è´ oomï¼è oom ä¼å¯¼è´ææè¯·æ±é½æ æ³å¤çï¼è¿æ¯è´å½é®é¢ãæä»¥å¼ºçå»ºè®®ä½¿ç¨æçéåã\n\nãé¿éå·´å·´ java å¼åæåãä¸­æå°ï¼ç¦æ­¢ä½¿ç¨è¿äºæ¹æ³æ¥åå»ºçº¿ç¨æ± ï¼èåºè¯¥æå¨ new threadpoolexecutor æ¥åå»ºçº¿ç¨æ± ãå¶è®¢è¿æ¡è§åæ¯å ä¸ºå®¹æå¯¼è´çäº§äºæï¼æå¸åçå°±æ¯ newfixedthreadpool å newcachedthreadpoolï¼å¯è½å ä¸ºèµæºèå°½å¯¼è´ oom é®é¢ã\n\nãç¤ºä¾ãnewfixedthreadpool oom\n\nthreadpoolexecutor threadpool = (threadpoolexecutor) executors.newfixedthreadpool(1);\nprintstats(threadpool);\nfor (int i = 0; i < 100000000; i++) {\n\tthreadpool.execute(() -> {\n\t\tstring payload = intstream.rangeclosed(1, 1000000)\n\t\t\t.maptoobj(__ -> "a")\n\t\t\t.collect(collectors.joining("")) + uuid.randomuuid().tostring();\n\t\ttry {\n\t\t\ttimeunit.hours.sleep(1);\n\t\t} catch (interruptedexception e) {\n\t\t}\n\t\tlog.info(payload);\n\t});\n}\n\nthreadpool.shutdown();\nthreadpool.awaittermination(1, timeunit.hours);\n\n\nnewfixedthreadpool ä½¿ç¨çå·¥ä½éåæ¯ linkedblockingqueue ï¼èé»è®¤æé æ¹æ³ç linkedblockingqueue æ¯ä¸ä¸ª integer.max_value é¿åº¦çéåï¼å¯ä»¥è®¤ä¸ºæ¯æ ççãå¦æä»»å¡è¾å¤å¹¶ä¸æ§è¡è¾æ¢çè¯ï¼éåå¯è½ä¼å¿«éç§¯åï¼æçåå­å¯¼è´ oomã\n\nãç¤ºä¾ãnewcachedthreadpool oom\n\nthreadpoolexecutor threadpool = (threadpoolexecutor) executors.newcachedthreadpool();\nprintstats(threadpool);\nfor (int i = 0; i < 100000000; i++) {\n\tthreadpool.execute(() -> {\n\t\tstring payload = uuid.randomuuid().tostring();\n\t\ttry {\n\t\t\ttimeunit.hours.sleep(1);\n\t\t} catch (interruptedexception e) {\n\t\t}\n\t\tlog.info(payload);\n\t});\n}\nthreadpool.shutdown();\nthreadpool.awaittermination(1, timeunit.hours);\n\n\nnewcachedthreadpool çæå¤§çº¿ç¨æ°æ¯ integer.max_valueï¼å¯ä»¥è®¤ä¸ºæ¯æ²¡æä¸éçï¼èå¶å·¥ä½éå synchronousqueue æ¯ä¸ä¸ªæ²¡æå­å¨ç©ºé´çé»å¡éåãè¿æå³çï¼åªè¦æè¯·æ±å°æ¥ï¼å°±å¿é¡»æ¾å°ä¸æ¡å·¥ä½çº¿ç¨æ¥å¤çï¼å¦æå½åæ²¡æç©ºé²ççº¿ç¨å°±ååå»ºä¸æ¡æ°çã\n\nå¦æå¤§éçä»»å¡è¿æ¥åä¼åå»ºå¤§éççº¿ç¨ãæä»¬ç¥éçº¿ç¨æ¯éè¦åéä¸å®çåå­ç©ºé´ä½ä¸ºçº¿ç¨æ çï¼æ¯å¦ 1mbï¼å æ­¤æ éå¶åå»ºçº¿ç¨å¿ç¶ä¼å¯¼è´ oomã\n\n\n# éè¦ä»»å¡åºè¯¥èªå®ä¹æç»ç­ç¥\n\nä½¿ç¨æçéåï¼å½ä»»å¡è¿å¤æ¶ï¼çº¿ç¨æ± ä¼è§¦åæ§è¡æç»ç­ç¥ï¼çº¿ç¨æ± é»è®¤çæç»ç­ç¥ä¼ throw rejectedexecutionexception è¿æ¯ä¸ªè¿è¡æ¶å¼å¸¸ï¼å¯¹äºè¿è¡æ¶å¼å¸¸ç¼è¯å¨å¹¶ä¸å¼ºå¶ catch å®ï¼æä»¥å¼åäººåå¾å®¹æå¿½ç¥ãå æ­¤é»è®¤æç»ç­ç¥è¦æéä½¿ç¨ãå¦æçº¿ç¨æ± å¤ççä»»å¡éå¸¸éè¦ï¼å»ºè®®èªå®ä¹èªå·±çæç»ç­ç¥ï¼å¹¶ä¸å¨å®éå·¥ä½ä¸­ï¼èªå®ä¹çæç»ç­ç¥å¾å¾åéçº§ç­ç¥éåä½¿ç¨ã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * æ·±å¥çè§£ java çº¿ç¨æ± ï¼threadpoolexecutor\n * java å¹¶åç¼ç¨--executor æ¡æ¶',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaåå­æ¨¡å",frontmatter:{title:"Javaåå­æ¨¡å",date:"2020-12-25T18:43:11.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å"],permalink:"/pages/d4e06f/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/09.Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/09.Javaåå­æ¨¡å.md",key:"v-c2716862",path:"/pages/d4e06f/",headers:[{level:2,title:"ç©çåå­æ¨¡å",slug:"ç©çåå­æ¨¡å",normalizedTitle:"ç©çåå­æ¨¡å",charIndex:218},{level:3,title:"ç¡¬ä»¶å¤çæç",slug:"ç¡¬ä»¶å¤çæç",normalizedTitle:"ç¡¬ä»¶å¤çæç",charIndex:287},{level:3,title:"ç¼å­ä¸è´æ§",slug:"ç¼å­ä¸è´æ§",normalizedTitle:"ç¼å­ä¸è´æ§",charIndex:568},{level:3,title:"ä»£ç ä¹±åºæ§è¡ä¼å",slug:"ä»£ç ä¹±åºæ§è¡ä¼å",normalizedTitle:"ä»£ç ä¹±åºæ§è¡ä¼å",charIndex:759},{level:2,title:"Java åå­æ¨¡å",slug:"java-åå­æ¨¡å-2",normalizedTitle:"java åå­æ¨¡å",charIndex:2},{level:3,title:"ä¸»åå­åå·¥ä½åå­",slug:"ä¸»åå­åå·¥ä½åå­",normalizedTitle:"ä¸»åå­åå·¥ä½åå­",charIndex:1535},{level:3,title:"JMM åå­æä½çé®é¢",slug:"jmm-åå­æä½çé®é¢",normalizedTitle:"jmm åå­æä½çé®é¢",charIndex:2079},{level:3,title:"åå­é´äº¤äºæä½",slug:"åå­é´äº¤äºæä½",normalizedTitle:"åå­é´äº¤äºæä½",charIndex:2596},{level:3,title:"å¹¶åå®å¨ç¹æ§",slug:"å¹¶åå®å¨ç¹æ§",normalizedTitle:"å¹¶åå®å¨ç¹æ§",charIndex:4067},{level:4,title:"åå­æ§",slug:"åå­æ§",normalizedTitle:"åå­æ§",charIndex:1318},{level:4,title:"å¯è§æ§",slug:"å¯è§æ§",normalizedTitle:"å¯è§æ§",charIndex:133},{level:4,title:"æåºæ§",slug:"æåºæ§",normalizedTitle:"æåºæ§",charIndex:137},{level:2,title:"Happens-Before",slug:"happens-before",normalizedTitle:"happens-before",charIndex:51},{level:2,title:"åå­å±é",slug:"åå­å±é",normalizedTitle:"åå­å±é",charIndex:66},{level:2,title:"volatile",slug:"volatile",normalizedTitle:"volatile",charIndex:23},{level:4,title:"volatile åéçç¹æ§",slug:"volatile-åéçç¹æ§",normalizedTitle:"volatile åéçç¹æ§",charIndex:6782},{level:5,title:"ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§",slug:"ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§",normalizedTitle:"ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§",charIndex:6821},{level:5,title:"è¯­ä¹ 2 ç¦æ­¢è¿è¡æä»¤éæåº",slug:"è¯­ä¹-2-ç¦æ­¢è¿è¡æä»¤éæåº",normalizedTitle:"è¯­ä¹ 2 ç¦æ­¢è¿è¡æä»¤éæåº",charIndex:7574},{level:4,title:"volatile çåç",slug:"volatile-çåç",normalizedTitle:"volatile çåç",charIndex:8322},{level:4,title:"volatile çä½¿ç¨åºæ¯",slug:"volatile-çä½¿ç¨åºæ¯",normalizedTitle:"volatile çä½¿ç¨åºæ¯",charIndex:8868},{level:2,title:"synchronized",slug:"synchronized",normalizedTitle:"synchronized",charIndex:32},{level:3,title:"long å double åéçç¹æ®è§å",slug:"long-å-double-åéçç¹æ®è§å",normalizedTitle:"long å double åéçç¹æ®è§å",charIndex:8989},{level:3,title:"final åéçç¹æ®è§å",slug:"final-åéçç¹æ®è§å",normalizedTitle:"final åéçç¹æ®è§å",charIndex:9416},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:9592}],headersStr:"ç©çåå­æ¨¡å ç¡¬ä»¶å¤çæç ç¼å­ä¸è´æ§ ä»£ç ä¹±åºæ§è¡ä¼å Java åå­æ¨¡å ä¸»åå­åå·¥ä½åå­ JMM åå­æä½çé®é¢ åå­é´äº¤äºæä½ å¹¶åå®å¨ç¹æ§ åå­æ§ å¯è§æ§ æåºæ§ Happens-Before åå­å±é volatile volatile åéçç¹æ§ ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§ è¯­ä¹ 2 ç¦æ­¢è¿è¡æä»¤éæåº volatile çåç volatile çä½¿ç¨åºæ¯ synchronized long å double åéçç¹æ®è§å final åéçç¹æ®è§å åèèµæ",content:'# Java åå­æ¨¡å\n\n> å³é®è¯ï¼JMMãvolatileãsynchronizedãfinalãHappens-Beforeãåå­å±é\n> \n> æè¦ï¼Java åå­æ¨¡åï¼Java Memory Modelï¼ï¼ç®ç§° JMMãJava åå­æ¨¡åçç®æ æ¯ä¸ºäºè§£å³ç±å¯è§æ§åæåºæ§å¯¼è´çå¹¶åå®å¨é®é¢ãJava åå­æ¨¡åéè¿ å±è½åç§ç¡¬ä»¶åæä½ç³»ç»çåå­è®¿é®å·®å¼ï¼ä»¥å®ç°è®© Java ç¨åºå¨åç§å¹³å°ä¸é½è½è¾¾å°ä¸è´çåå­è®¿é®ææã\n\n\n# ç©çåå­æ¨¡å\n\nç©çæºéå°çå¹¶åé®é¢ä¸èææºä¸­çæåµæä¸å°ç¸ä¼¼ä¹å¤ï¼ç©çæºå¯¹å¹¶åçå¤çæ¹æ¡å¯¹äºèææºçå®ç°ä¹æç¸å½å¤§çåèæä¹ã\n\n\n# ç¡¬ä»¶å¤çæç\n\nç©çåå­çç¬¬ä¸ä¸ªé®é¢æ¯ï¼ç¡¬ä»¶å¤çæçã\n\n * ç»å¤§å¤æ°çè¿ç®ä»»å¡é½ä¸å¯è½åªé å¤çå¨âè®¡ç®âå°±è½å®æï¼å¤çå¨è³å°éè¦ä¸åå­äº¤äºï¼å¦è¯»åè¿ç®æ°æ®ãå­å¨è¿ç®ç»æï¼è¿ä¸ª I/O æä½æ¯å¾é¾æ¶é¤çï¼æ æ³ä»é å¯å­å¨å®æææè¿ç®ä»»å¡ï¼ã\n * ç±äºè®¡ç®æºçå­å¨è®¾å¤ä¸å¤çå¨çè¿ç®éåº¦æå ä¸ªæ°éçº§çå·®è· ï¼è¿ç§éåº¦ä¸ççç¾ï¼ä¼éä½ç¡¬ä»¶çå¤çæçãæä»¥ï¼ç°ä»£è®¡ç®æºé½ä¸å¾ä¸ å å¥é«éç¼å­ï¼Cacheï¼ æ¥ä½ä¸ºåå­åå¤çå¨ä¹é´çç¼å²ãå°éè¦ç¨å°çæ°æ®å¤å¶å°ç¼å­ä¸­ï¼è®©è¿ç®è½å¿«éè¿è¡ï¼å½è¿ç®ç»æååä»ç¼å­åæ­¥ä¼åå­ä¸­ï¼è¿æ ·å¤çå¨å°±æ éç­å¾ç¼æ¢çåå­è¯»åäºã\n\n\n# ç¼å­ä¸è´æ§\n\né«éç¼å­è§£å³äº ç¡¬ä»¶æçé®é¢ï¼ä½æ¯å¼å¥äºä¸ä¸ªæ°çé®é¢ï¼ç¼å­ä¸è´æ§ï¼Cache Coherenceï¼ã\n\nå¨å¤å¤çå¨ç³»ç»ä¸­ï¼æ¯ä¸ªå¤çå¨é½æèªå·±çé«éç¼å­ï¼èå®ä»¬åå±äº«åä¸ä¸»åå­ãå½å¤ä¸ªå¤çå¨çè¿ç®ä»»å¡é½æ¶ååä¸åä¸»åå­åºåæ¶ï¼å°å¯è½å¯¼è´åèªçç¼å­æ°æ®ä¸ä¸è´ã\n\nä¸ºäºè§£å³ç¼å­ä¸è´æ§é®é¢ï¼éè¦åä¸ªå¤çå¨è®¿é®ç¼å­æ¶é½éµå¾ªä¸äºåè®®ï¼å¨è¯»åæ¶è¦æ ¹æ®åè®®æ¥è¿è¡æä½ã\n\n\n\n\n# ä»£ç ä¹±åºæ§è¡ä¼å\n\né¤äºé«éç¼å­ä»¥å¤ï¼ä¸ºäºä½¿å¾å¤çå¨åé¨çè¿ç®ååå°½éè¢«ååå©ç¨ï¼å¤çå¨å¯è½ä¼å¯¹è¾å¥ä»£ç è¿è¡ä¹±åºæ§è¡ï¼Out-Of-Order Executionï¼ä¼åãå¤çå¨ä¼å¨è®¡ç®ä¹åå°ä¹±åºæ§è¡çç»æéç»ï¼ä¿è¯è¯¥ç»æä¸é¡ºåºæ§è¡çç»ææ¯ä¸è´çï¼ä½ä¸ä¿è¯ç¨åºä¸­åä¸ªè¯­å¥è®¡ç®çååé¡ºåºä¸è¾å¥ä»£ç ä¸­çé¡ºåºä¸è´ã\n\n\n\nä¹±åºæ§è¡ææ¯æ¯å¤çå¨ä¸ºæé«è¿ç®éåº¦èååºè¿èä»£ç åæé¡ºåºçä¼åã\n\n * åæ ¸ç¯å¢ä¸ï¼å¤çå¨ä¿è¯ååºçä¼åä¸ä¼å¯¼è´æ§è¡ç»æè¿ç¦»é¢æç®æ ï¼ä½å¨å¤æ ¸ç¯å¢ä¸å´å¹¶éå¦æ­¤ã\n * å¤æ ¸ç¯å¢ä¸ï¼ å¦æå­å¨ä¸ä¸ªæ ¸çè®¡ç®ä»»å¡ä¾èµå¦ä¸ä¸ªæ ¸çè®¡ç®ä»»å¡çä¸­é´ç»æï¼èä¸å¯¹ç¸å³æ°æ®è¯»åæ²¡åä»»ä½é²æ¤æªæ½ï¼é£ä¹å¶é¡ºåºæ§å¹¶ä¸è½é ä»£ç çååé¡ºåºæ¥ä¿è¯ã\n\n\n\n\n# Java åå­æ¨¡å\n\nåå­æ¨¡å è¿ä¸ªæ¦å¿µãæä»¬å¯ä»¥çè§£ä¸ºï¼å¨ç¹å®çæä½åè®®ä¸ï¼å¯¹ç¹å®çåå­æé«éç¼å­è¿è¡è¯»åè®¿é®çè¿ç¨æ½è±¡ãä¸åæ¶æçç©çè®¡ç®æºå¯ä»¥æä¸ä¸æ ·çåå­æ¨¡åï¼JVM ä¹æèªå·±çåå­æ¨¡åã\n\nJVM ä¸­è¯å¾å®ä¹ä¸ç§ Java åå­æ¨¡åï¼Java Memory Model, JMMï¼æ¥å±è½åç§ç¡¬ä»¶åæä½ç³»ç»çåå­è®¿é®å·®å¼ï¼ä»¥å®ç°è®© Java ç¨åº å¨åç§å¹³å°ä¸é½è½è¾¾å°ä¸è´çåå­è®¿é®ææã\n\nå¨ Java å¹¶åç®ä» ä¸­å·²ç»ä»ç»äºï¼å¹¶åå®å¨éè¦æ»¡è¶³å¯è§æ§ãæåºæ§ãåå­æ§ãå¶ä¸­ï¼å¯¼è´å¯è§æ§çåå æ¯ç¼å­ï¼å¯¼è´æåºæ§çåå æ¯ç¼è¯ä¼åãé£è§£å³å¯è§æ§ãæåºæ§æç´æ¥çåæ³å°±æ¯ç¦ç¨ç¼å­åç¼è¯ä¼å ãä½è¿ä¹åï¼æ§è½å°±å ªå¿§äºã\n\nåççæ¹æ¡åºè¯¥æ¯æéç¦ç¨ç¼å­ä»¥åç¼è¯ä¼åãé£ä¹ï¼å¦ä½åå°å¢ï¼ï¼Java åå­æ¨¡åè§èäº JVM å¦ä½æä¾æéç¦ç¨ç¼å­åç¼è¯ä¼åçæ¹æ³ãå·ä½æ¥è¯´ï¼è¿äºæ¹æ³åæ¬ volatileãsynchronized å final ä¸ä¸ªå³é®å­ï¼ä»¥å Happens-Before è§åã\n\n\n# ä¸»åå­åå·¥ä½åå­\n\nJMM çä¸»è¦ç®æ æ¯ å®ä¹ç¨åºä¸­åä¸ªåéçè®¿é®è§åï¼å³å¨èææºä¸­å°åéå­å¨å°åå­åä»åå­ä¸­ååºåéè¿æ ·çåºå±ç»èãæ­¤å¤çåéï¼Variablesï¼ä¸ Java ç¼ç¨ä¸­æè¯´çåéææåºå«ï¼å®åæ¬äºå®ä¾å­æ®µãéæå­æ®µåæææ°å¼å¯¹è±¡çåç´ ï¼ä½ä¸åæ¬å±é¨åéä¸æ¹æ³åæ°ï¼å ä¸ºåèæ¯çº¿ç¨ç§æçï¼ä¸ä¼è¢«å±äº«ï¼èªç¶å°±ä¸ä¼å­å¨ç«äºé®é¢ãä¸ºäºè·å¾è¾å¥½çæ§è¡æè½ï¼JMM å¹¶æ²¡æéå¶æ§è¡å¼æä½¿ç¨å¤çå¨çç¹å®å¯å­å¨æç¼å­æ¥åä¸»å­è¿è¡äº¤äºï¼ä¹æ²¡æéå¶å³ä½¿ç¼è¯å¨è¿è¡è°æ´ä»£ç æ§è¡é¡ºåºè¿ç±»ä¼åæªæ½ã\n\nJMM è§å®äºææçåéé½å­å¨å¨ä¸»åå­ï¼Main Memoryï¼ä¸­ã\n\næ¯æ¡çº¿ç¨è¿æèªå·±çå·¥ä½åå­ï¼Working Memoryï¼ï¼å·¥ä½åå­ä¸­ä¿çäºè¯¥çº¿ç¨ä½¿ç¨å°çåéçä¸»åå­çå¯æ¬ãå·¥ä½åå­æ¯ JMM çä¸ä¸ªæ½è±¡æ¦å¿µï¼å¹¶ä¸çå®å­å¨ï¼å®æ¶µçäºç¼å­ï¼åç¼å²åºï¼å¯å­å¨ä»¥åå¶ä»çç¡¬ä»¶åç¼è¯å¨ä¼åã\n\n\n\nçº¿ç¨å¯¹åéçæææä½é½å¿é¡»å¨å·¥ä½åå­ä¸­è¿è¡ï¼èä¸è½ç´æ¥è¯»åä¸»åå­ä¸­çåéãä¸åççº¿ç¨é´ä¹æ æ³ç´æ¥è®¿é®å¯¹æ¹å·¥ä½åå­ä¸­çåéï¼çº¿ç¨é´åéå¼çä¼ éåéè¦éè¿ä¸»åå­æ¥å®æã\n\n\n\n> è¯´æï¼\n> \n> è¿éè¯´çä¸»åå­ãå·¥ä½åå­ä¸ Java åå­åºåä¸­çå ãæ ãæ¹æ³åºç­ä¸æ¯åä¸ä¸ªå±æ¬¡çåå­ååã\n\n\n# JMM åå­æä½çé®é¢\n\nç±»ä¼¼äºç©çåå­æ¨¡åé¢ä¸´çé®é¢ï¼JMM å­å¨ä»¥ä¸ä¸¤ä¸ªé®é¢ï¼\n\n * å·¥ä½åå­æ°æ®ä¸è´æ§ - åä¸ªçº¿ç¨æä½æ°æ®æ¶ä¼ä¿å­ä½¿ç¨å°çä¸»åå­ä¸­çå±äº«åéå¯æ¬ï¼å½å¤ä¸ªçº¿ç¨çè¿ç®ä»»å¡é½æ¶ååä¸ä¸ªå±äº«åéæ¶ï¼å°å¯¼è´åèªççå±äº«åéå¯æ¬ä¸ä¸è´ãå¦æççåçè¿ç§æåµï¼æ°æ®åæ­¥åä¸»åå­ä»¥è°çå¯æ¬æ°æ®ä¸ºåï¼ Java åå­æ¨¡åä¸»è¦éè¿ä¸ç³»åçæ°æ®åæ­¥åè®®ãè§åæ¥ä¿è¯æ°æ®çä¸è´æ§ã\n * æä»¤éæåºä¼å - Java ä¸­éæåºéå¸¸æ¯ç¼è¯å¨æè¿è¡æ¶ç¯å¢ä¸ºäºä¼åç¨åºæ§è½èéåçå¯¹æä»¤è¿è¡éæ°æåºæ§è¡çä¸ç§ææ®µãéæåºåä¸ºä¸¤ç±»ï¼ç¼è¯æéæåºåè¿è¡æéæåºï¼åå«å¯¹åºç¼è¯æ¶åè¿è¡æ¶ç¯å¢ã åæ ·çï¼æä»¤éæåºä¸æ¯éæéæåºï¼å®éè¦æ»¡è¶³ä»¥ä¸ä¸¤ä¸ªæ¡ä»¶ï¼\n   * å¨åçº¿ç¨ç¯å¢ä¸ä¸è½æ¹åç¨åºè¿è¡çç»æãå³æ¶ç¼è¯å¨ï¼åå¤çå¨ï¼éè¦ä¿è¯ç¨åºè½å¤éµå® as-if-serial å±æ§ãéä¿å°è¯´ï¼å°±æ¯å¨åçº¿ç¨æåµä¸ï¼è¦ç»ç¨åºä¸ä¸ªé¡ºåºæ§è¡çåè±¡ãå³ç»è¿éæåºçæ§è¡ç»æè¦ä¸é¡ºåºæ§è¡çç»æä¿æä¸è´ã\n   * å­å¨æ°æ®ä¾èµå³ç³»çä¸åè®¸éæåºã\n   * å¤çº¿ç¨ç¯å¢ä¸ï¼å¦æçº¿ç¨å¤çé»è¾ä¹é´å­å¨ä¾èµå³ç³»ï¼æå¯è½å ä¸ºæä»¤éæåºå¯¼è´è¿è¡ç»æä¸é¢æä¸åã\n\n\n# åå­é´äº¤äºæä½\n\nJMM å®ä¹äº 8 ä¸ªæä½æ¥å®æä¸»åå­åå·¥ä½åå­ä¹é´çäº¤äºæä½ãJVM å®ç°æ¶å¿é¡»ä¿è¯ä¸é¢ä»ç»çæ¯ç§æä½é½æ¯ åå­çï¼å¯¹äº double å long åçåéæ¥è¯´ï¼loadãstoreãreadãå write æä½å¨æäºå¹³å°ä¸åè®¸æä¾å¤ ï¼ã\n\n * lock (éå®) - ä½ç¨äºä¸»åå­çåéï¼å®æä¸ä¸ªåéæ è¯ä¸ºä¸æ¡çº¿ç¨ç¬å çç¶æã\n * unlock (è§£é) - ä½ç¨äºä¸»åå­çåéï¼å®æä¸ä¸ªå¤äºéå®ç¶æçåééæ¾åºæ¥ï¼éæ¾åçåéæå¯ä»¥è¢«å¶ä»çº¿ç¨éå®ã\n * read (è¯»å) - ä½ç¨äºä¸»åå­çåéï¼å®æä¸ä¸ªåéçå¼ä»ä¸»åå­ä¼ è¾å°çº¿ç¨çå·¥ä½åå­ä¸­ï¼ä»¥ä¾¿éåç load å¨ä½ä½¿ç¨ã\n * write (åå¥) - ä½ç¨äºä¸»åå­çåéï¼å®æ store æä½ä»å·¥ä½åå­ä¸­å¾å°çåéçå¼æ¾å¥ä¸»åå­çåéä¸­ã\n * load (è½½å¥) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æ read æä½ä»ä¸»åå­ä¸­å¾å°çåéå¼æ¾å¥å·¥ä½åå­çåéå¯æ¬ä¸­ã\n * use (ä½¿ç¨) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æå·¥ä½åå­ä¸­ä¸ä¸ªåéçå¼ä¼ éç»æ§è¡å¼æï¼æ¯å½èææºéå°ä¸ä¸ªéè¦ä½¿ç¨å°åéçå¼å¾å­èç æä»¤æ¶å°±ä¼æ§è¡è¿ä¸ªæä½ã\n * assign (èµå¼) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æä¸ä¸ªä»æ§è¡å¼ææ¥æ¶å°çå¼èµç»å·¥ä½åå­çåéï¼æ¯å½èææºéå°ä¸ä¸ªç»åéèµå¼çå­èç æä»¤æ¶æ§è¡è¿ä¸ªæä½ã\n * store (å­å¨) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æå·¥ä½åå­ä¸­ä¸ä¸ªåéçå¼ä¼ éå°ä¸»åå­ä¸­ï¼ä»¥ä¾¿éå write æä½ä½¿ç¨ã\n\nå¦æè¦æä¸ä¸ªåéä»ä¸»åå­ä¸­å¤å¶å°å·¥ä½åå­ï¼å°±éè¦æåºæ§è¡ read å load æä½ï¼å¦ææåéä»å·¥ä½åå­ä¸­åæ­¥åä¸»åå­ä¸­ï¼å°±éè¦æåºæ§è¡ store å write æä½ãä½ Java åå­æ¨¡ååªè¦æ±ä¸è¿°æä½å¿é¡»æé¡ºåºæ§è¡ï¼èæ²¡æä¿è¯å¿é¡»æ¯è¿ç»­æ§è¡ã\n\nJMM è¿è§å®äºä¸è¿° 8 ç§åºæ¬æä½ï¼éè¦æ»¡è¶³ä»¥ä¸è§åï¼\n\n * read å load å¿é¡»æå¯¹åºç°ï¼store å write å¿é¡»æå¯¹åºç°ãå³ä¸åè®¸ä¸ä¸ªåéä»ä¸»åå­è¯»åäºä½å·¥ä½åå­ä¸æ¥åï¼æä»å·¥ä½åå­åèµ·ååäºä½ä¸»åå­ä¸æ¥åçæåµåºç°ã\n * ä¸åè®¸ä¸ä¸ªçº¿ç¨ä¸¢å¼å®çæè¿ assign çæä½ï¼å³åéå¨å·¥ä½åå­ä¸­æ¹åäºä¹åå¿é¡»æåååæ­¥å°ä¸»åå­ä¸­ã\n * ä¸åè®¸ä¸ä¸ªçº¿ç¨æ åå çï¼æ²¡æåçè¿ä»»ä½ assign æä½ï¼ææ°æ®ä»å·¥ä½åå­åæ­¥åä¸»åå­ä¸­ã\n * ä¸ä¸ªæ°çåéåªè½å¨ä¸»åå­ä¸­è¯çï¼ä¸åè®¸å¨å·¥ä½åå­ä¸­ç´æ¥ä½¿ç¨ä¸ä¸ªæªè¢«åå§åï¼load æ assign ï¼çåéãæ¢å¥è¯è¯´ï¼å°±æ¯å¯¹ä¸ä¸ªåéå®æ½ use å store æä½ä¹åï¼å¿é¡»åæ§è¡è¿äº load æ assign æä½ã\n * ä¸ä¸ªåéå¨åä¸ä¸ªæ¶å»åªåè®¸ä¸æ¡çº¿ç¨å¯¹å¶è¿è¡ lock æä½ï¼ä½ lock æä½å¯ä»¥è¢«åä¸æ¡çº¿ç¨éå¤æ§è¡å¤æ¬¡ï¼å¤æ¬¡æ§è¡ lock åï¼åªææ§è¡ç¸åæ¬¡æ°ç unlock æä½ï¼åéæä¼è¢«è§£éãæä»¥ lock å unlock å¿é¡»æå¯¹åºç°ã\n * å¦æå¯¹ä¸ä¸ªåéæ§è¡ lock æä½ï¼å°ä¼æ¸ç©ºå·¥ä½åå­ä¸­æ­¤åéçå¼ï¼å¨æ§è¡å¼æä½¿ç¨è¿ä¸ªåéåï¼éè¦éæ°æ§è¡ load æ assign æä½åå§ååéçå¼ã\n * å¦æä¸ä¸ªåéäºåæ²¡æè¢« lock æä½éå®ï¼åä¸åè®¸å¯¹å®æ§è¡ unlock æä½ï¼ä¹ä¸åè®¸å» unlock ä¸ä¸ªè¢«å¶ä»çº¿ç¨éå®çåéã\n * å¯¹ä¸ä¸ªåéæ§è¡ unlock æä½ä¹åï¼å¿é¡»åææ­¤åéåæ­¥å°ä¸»åå­ä¸­ï¼æ§è¡ store å write æä½ï¼\n\n\n\n\n# å¹¶åå®å¨ç¹æ§\n\nä¸æä»ç»äº Java åå­äº¤äºç 8 ç§åºæ¬æä½ï¼å®ä»¬éµå¾ª Java åå­ä¸å¤§ç¹æ§ï¼åå­æ§ãå¯è§æ§ãæåºæ§ã\n\nèè¿ä¸å¤§ç¹æ§ï¼å½æ ¹ç»åºï¼æ¯ä¸ºäºå®ç°å¤çº¿ç¨ç æ°æ®ä¸è´æ§ï¼ä½¿å¾ç¨åºå¨å¤çº¿ç¨å¹¶åï¼æä»¤éæåºä¼åçç¯å¢ä¸­è½å¦é¢æè¿è¡ã\n\n# åå­æ§\n\nåå­æ§å³ä¸ä¸ªæä½æèå¤ä¸ªæä½ï¼è¦ä¹å¨é¨æ§è¡ï¼æ§è¡çè¿ç¨ä¸ä¼è¢«ä»»ä½å ç´ ææ­ï¼ï¼è¦ä¹å°±é½ä¸æ§è¡ãå³ä½¿å¨å¤ä¸ªçº¿ç¨ä¸èµ·æ§è¡çæ¶åï¼ä¸ä¸ªæä½ä¸æ¦å¼å§ï¼å°±ä¸ä¼è¢«å¶ä»çº¿ç¨æå¹²æ°ã\n\nå¨ Java ä¸­ï¼ä¸ºäºä¿è¯åå­æ§ï¼æä¾äºä¸¤ä¸ªé«çº§çå­èç æä»¤ monitorenter å monitorexitãè¿ä¸¤ä¸ªå­èç ï¼å¨ Java ä¸­å¯¹åºçå³é®å­å°±æ¯ synchronizedã\n\nå æ­¤ï¼å¨ Java ä¸­å¯ä»¥ä½¿ç¨ synchronized æ¥ä¿è¯æ¹æ³åä»£ç ååçæä½æ¯åå­æ§çã\n\n# å¯è§æ§\n\nå¯è§æ§æ¯æå½å¤ä¸ªçº¿ç¨è®¿é®åä¸ä¸ªåéæ¶ï¼ä¸ä¸ªçº¿ç¨ä¿®æ¹äºè¿ä¸ªåéçå¼ï¼å¶ä»çº¿ç¨è½å¤ç«å³çå¾å°ä¿®æ¹çå¼ã\n\nJMM æ¯éè¿ "åéä¿®æ¹åå°æ°å¼åæ­¥åä¸»åå­ï¼ åéè¯»ååä»ä¸»åå­å·æ°åéå¼" è¿ç§ä¾èµä¸»åå­ä½ä¸ºä¼ éåªä»çæ¹å¼æ¥å®ç°çã\n\nJava å®ç°å¤çº¿ç¨å¯è§æ§çæ¹å¼æï¼\n\n * volatile\n * synchronized\n * final\n\n# æåºæ§\n\næåºæ§è§åè¡¨ç°å¨ä»¥ä¸ä¸¤ç§åºæ¯: çº¿ç¨ååçº¿ç¨é´\n\n * çº¿ç¨å - ä»æä¸ªçº¿ç¨çè§åº¦çæ¹æ³çæ§è¡ï¼æä»¤ä¼æç§ä¸ç§å«âä¸²è¡âï¼as-if-serialï¼çæ¹å¼æ§è¡ï¼æ­¤ç§æ¹å¼å·²ç»åºç¨äºé¡ºåºç¼ç¨è¯­è¨ã\n * çº¿ç¨é´ - è¿ä¸ªçº¿ç¨âè§å¯âå°å¶ä»çº¿ç¨å¹¶åå°æ§è¡éåæ­¥çä»£ç æ¶ï¼ç±äºæä»¤éæåºä¼åï¼ä»»ä½ä»£ç é½æå¯è½äº¤åæ§è¡ãå¯ä¸èµ·ä½ç¨ççº¦ææ¯ï¼å¯¹äºåæ­¥æ¹æ³ï¼åæ­¥åï¼synchronized å³é®å­ä¿®é¥°ï¼ä»¥å volatile å­æ®µçæä½ä»ç»´æç¸å¯¹æåºã\n\nå¨ Java ä¸­ï¼å¯ä»¥ä½¿ç¨ synchronized å volatile æ¥ä¿è¯å¤çº¿ç¨ä¹é´æä½çæåºæ§ãå®ç°æ¹å¼ææåºå«ï¼\n\n * volatile å³é®å­ä¼ç¦æ­¢æä»¤éæåºã\n * synchronized å³é®å­éè¿äºæ¥ä¿è¯åä¸æ¶å»åªåè®¸ä¸æ¡çº¿ç¨æä½ã\n\n\n# Happens-Before\n\nJMM ä¸ºç¨åºä¸­ææçæä½å®ä¹äºä¸ä¸ªååºå³ç³»ï¼ç§°ä¹ä¸º åè¡åçååï¼Happens-Beforeï¼ã\n\nHappens-Before æ¯æ åé¢ä¸ä¸ªæä½çç»æå¯¹åç»­æä½æ¯å¯è§çã\n\nHappens-Before éå¸¸éè¦ï¼å®æ¯å¤æ­æ°æ®æ¯å¦å­å¨ç«äºãçº¿ç¨æ¯å¦å®å¨çä¸»è¦ä¾æ®ï¼ä¾é è¿ä¸ªååï¼æä»¬å¯ä»¥éè¿å æ¡è§åä¸æ½å­å°è§£å³å¹¶åç¯å¢ä¸ä¸¤ä¸ªæä½é´æ¯å¦å¯è½å­å¨å²çªçææé®é¢ã\n\n * ç¨åºæ¬¡åºè§å - ä¸ä¸ªçº¿ç¨åï¼æç§ä»£ç é¡ºåºï¼ä¹¦åå¨åé¢çæä½åè¡åçäºä¹¦åå¨åé¢çæä½ã\n * éå®è§å - ä¸ä¸ª unLock æä½åè¡åçäºåé¢å¯¹åä¸ä¸ªéç lock æä½ã\n * volatile åéè§å - å¯¹ä¸ä¸ª volatile åéçåæä½åè¡åçäºåé¢å¯¹è¿ä¸ªåéçè¯»æä½ã\n * çº¿ç¨å¯å¨è§å - Thread å¯¹è±¡ç start() æ¹æ³åè¡åçäºæ­¤çº¿ç¨çæ¯ä¸ªä¸ä¸ªå¨ä½ã\n * çº¿ç¨ç»æ­¢è§å - çº¿ç¨ä¸­ææçæä½é½åè¡åçäºçº¿ç¨çç»æ­¢æ£æµï¼æä»¬å¯ä»¥éè¿ Thread.join() æ¹æ³ç»æãThread.isAlive() çè¿åå¼ææ®µæ£æµå°çº¿ç¨å·²ç»ç»æ­¢æ§è¡ã\n * çº¿ç¨ä¸­æ­è§å - å¯¹çº¿ç¨ interrupt() æ¹æ³çè°ç¨åè¡åçäºè¢«ä¸­æ­çº¿ç¨çä»£ç æ£æµå°ä¸­æ­äºä»¶çåçï¼å¯ä»¥éè¿ Thread.interrupted() æ¹æ³æ£æµå°æ¯å¦æä¸­æ­åçã\n * å¯¹è±¡ç»ç»è§å - ä¸ä¸ªå¯¹è±¡çåå§åå®æåè¡åçäºå®ç finalize() æ¹æ³çå¼å§ã\n * ä¼ éæ§ - å¦ææä½ A åè¡åçäº æä½ Bï¼èæä½ B å åè¡åçäº æä½ Cï¼åå¯ä»¥å¾åºæä½ A åè¡åçäº æä½ Cã\n\n\n# åå­å±é\n\nJava ä¸­å¦ä½ä¿è¯åºå±æä½çæåºæ§åå¯è§æ§ï¼å¯ä»¥éè¿åå­å±éï¼memory barrierï¼ã\n\nåå­å±éæ¯è¢«æå¥ä¸¤ä¸ª CPU æä»¤ä¹é´çä¸ç§æä»¤ï¼ç¨æ¥ç¦æ­¢å¤çå¨æä»¤åçéæåºï¼åå±éä¸æ ·ï¼ï¼ä»èä¿éæåºæ§çãå¦å¤ï¼ä¸ºäºè¾¾å°å±éçææï¼å®ä¹ä¼ä½¿å¤çå¨åå¥ãè¯»åå¼ä¹åï¼å°ä¸»åå­çå¼åå¥é«éç¼å­ï¼æ¸ç©ºæ æéåï¼ä»èä¿éå¯è§æ§ã\n\nä¸¾ä¸ªä¾å­ï¼\n\nStore1;\nStore2;\nLoad1;\nStoreLoad;  //åå­å±é\nStore3;\nLoad2;\nLoad3;\nå¤å¶ä»£ç \n\n\nå¯¹äºä¸é¢çä¸ç» CPU æä»¤ï¼Store è¡¨ç¤ºåå¥æä»¤ï¼Load è¡¨ç¤ºè¯»åæä»¤ï¼ï¼StoreLoad å±éä¹åç Store æä»¤æ æ³ä¸ StoreLoad å±éä¹åç Load æä»¤è¿è¡äº¤æ¢ä½ç½®ï¼å³éæåºãä½æ¯ StoreLoad å±éä¹ååä¹åçæä»¤æ¯å¯ä»¥äºæ¢ä½ç½®çï¼å³ Store1 å¯ä»¥å Store2 äºæ¢ï¼Load2 å¯ä»¥å Load3 äºæ¢ã\n\nå¸¸è§æ 4 ç§å±é\n\n * LoadLoad å±é - å¯¹äºè¿æ ·çè¯­å¥ Load1; LoadLoad; Load2ï¼å¨ Load2 ååç»­è¯»åæä½è¦è¯»åçæ°æ®è¢«è®¿é®åï¼ä¿è¯ Load1 è¦è¯»åçæ°æ®è¢«è¯»åå®æ¯ã\n * StoreStore å±é - å¯¹äºè¿æ ·çè¯­å¥ Store1; StoreStore; Store2ï¼å¨ Store2 ååç»­åå¥æä½æ§è¡åï¼ä¿è¯ Store1 çåå¥æä½å¯¹å¶å®å¤çå¨å¯è§ã\n * LoadStore å±é - å¯¹äºè¿æ ·çè¯­å¥ Load1; LoadStore; Store2ï¼å¨ Store2 ååç»­åå¥æä½è¢«æ§è¡åï¼ä¿è¯ Load1 è¦è¯»åçæ°æ®è¢«è¯»åå®æ¯ã\n * StoreLoad å±é - å¯¹äºè¿æ ·çè¯­å¥ Store1; StoreLoad; Load2ï¼å¨ Load2 ååç»­ææè¯»åæä½æ§è¡åï¼ä¿è¯ Store1 çåå¥å¯¹ææå¤çå¨å¯è§ãå®çå¼éæ¯åç§å±éä¸­æå¤§çï¼å²å·åç¼å²å¨ï¼æ¸ç©ºæ æåéåï¼ãå¨å¤§å¤æ°å¤çå¨çå®ç°ä¸­ï¼è¿ä¸ªå±éæ¯ä¸ªä¸è½å±éï¼å¼å·å¶å®ä¸ç§åå­å±éçåè½ã\n\nJava ä¸­å¯¹åå­å±éçä½¿ç¨å¨ä¸è¬çä»£ç ä¸­ä¸å¤ªå®¹æè§å°ï¼å¸¸è§çæ volatile å synchronized å³é®å­ä¿®é¥°çä»£ç å(åé¢åå±å¼ä»ç»)ï¼è¿å¯ä»¥éè¿ Unsafe è¿ä¸ªç±»æ¥ä½¿ç¨åå­å±éã\n\n\n# volatile\n\nvolatile æ¯ JVM æä¾ç æè½»éçº§çåæ­¥æºå¶ã\n\nvolatile çä¸­ææææ¯ä¸ç¨³å®çï¼æåçï¼ç¨ volatile ä¿®é¥°åéæ¯ä¸ºäºä¿è¯åéå¨å¤çº¿ç¨ä¸­çå¯è§æ§ã\n\n# volatile åéçç¹æ§\n\nvolatile åéå·æä¸¤ç§ç¹æ§ï¼\n\n * ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§ã\n * ç¦æ­¢è¿è¡æä»¤éæåº\n\n# ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§\n\nè¿éçå¯è§æ§æ¯æå½ä¸æ¡çº¿ç¨ä¿®æ¹äº volatile åéçå¼ï¼æ°å¼å¯¹äºå¶ä»çº¿ç¨æ¥è¯´æ¯å¯ä»¥ç«å³å¾ç¥çãèæ®éåéä¸è½åå°è¿ä¸ç¹ï¼æ®éåéçå¼å¨çº¿ç¨é´ä¼ éåéè¦éè¿ä¸»åå­æ¥å®æã\n\nçº¿ç¨å volatile åéçè¿ç¨ï¼\n\n 1. æ¹åçº¿ç¨å·¥ä½åå­ä¸­ volatile åéå¯æ¬çå¼\n 2. å°æ¹ååçå¯æ¬çå¼ä»å·¥ä½åå­å·æ°å°ä¸»åå­\n\nçº¿ç¨è¯» volatile åéçè¿ç¨ï¼\n\n 1. ä»ä¸»åå­ä¸­è¯»å volatile åéçææ°å¼å°çº¿ç¨çå·¥ä½åå­ä¸­\n 2. ä»å·¥ä½åå­ä¸­è¯»å volatile åéçå¯æ¬\n\n> æ³¨æï¼ä¿è¯å¯è§æ§ä¸ç­åäº volatile åéä¿è¯å¹¶åæä½çå®å¨æ§\n> \n> å¨ä¸ç¬¦åä»¥ä¸ä¸¤ç¹çåºæ¯ä¸­ï¼ä»ç¶è¦éè¿æ·éæ¥ä¿è¯åå­æ§ï¼\n> \n>  * è¿ç®ç»æå¹¶ä¸ä¾èµåéçå½åå¼ï¼æèè½å¤ç¡®ä¿åªæåä¸ççº¿ç¨ä¿®æ¹åéçå¼ã\n>  * åéä¸éè¦ä¸å¶ä»ç¶æåéå±ååä¸ä¸åçº¦æã\n\nä½æ¯å¦æå¤ä¸ªçº¿ç¨åæ¶ææ´æ°åçåéå¼åæ¶å·æ°åä¸»åå­ï¼å¯è½å¯¼è´å¾å°çå¼ä¸æ¯é¢æç»æï¼\n\nä¸¾ä¸ªä¾å­ï¼ å®ä¹ volatile int count = 0ï¼2 ä¸ªçº¿ç¨åæ¶æ§è¡ count++ æä½ï¼æ¯ä¸ªçº¿ç¨é½æ§è¡ 500 æ¬¡ï¼æç»ç»æå°äº 1000ï¼åå æ¯æ¯ä¸ªçº¿ç¨æ§è¡ count++ éè¦ä»¥ä¸ 3 ä¸ªæ­¥éª¤ï¼\n\n 1. çº¿ç¨ä»ä¸»åå­è¯»åææ°ç count çå¼\n 2. æ§è¡å¼ææ count å¼å  1ï¼å¹¶èµå¼ç»çº¿ç¨å·¥ä½åå­\n 3. çº¿ç¨å·¥ä½åå­æ count å¼ä¿å­å°ä¸»åå­ æå¯è½æä¸æ¶å» 2 ä¸ªçº¿ç¨å¨æ­¥éª¤ 1 è¯»åå°çå¼é½æ¯ 100ï¼æ§è¡å®æ­¥éª¤ 2 å¾å°çå¼é½æ¯ 101ï¼æåå·æ°äº 2 æ¬¡ 101 ä¿å­å°ä¸»åå­ã\n\n# è¯­ä¹ 2 ç¦æ­¢è¿è¡æä»¤éæåº\n\nå·ä½ä¸ç¹è§£éï¼ç¦æ­¢éæåºçè§åå¦ä¸ï¼\n\n * å½ç¨åºæ§è¡å° volatile åéçè¯»æä½æèåæä½æ¶ï¼å¨å¶åé¢çæä½çæ´æ¹è¯å®å¨é¨å·²ç»è¿è¡ï¼ä¸ç»æå·²ç»å¯¹åé¢çæä½å¯è§ï¼å¨å¶åé¢çæä½è¯å®è¿æ²¡æè¿è¡ï¼\n * å¨è¿è¡æä»¤ä¼åæ¶ï¼ä¸è½å°å¨å¯¹ volatile åéè®¿é®çè¯­å¥æ¾å¨å¶åé¢æ§è¡ï¼ä¹ä¸è½æ volatile åéåé¢çè¯­å¥æ¾å°å¶åé¢æ§è¡ã\n\næ®éçåéä»ä»ä¼ä¿è¯è¯¥æ¹æ³çæ§è¡è¿ç¨ä¸­ææä¾èµèµå¼ç»æçå°æ¹é½è½è·åå°æ­£ç¡®çç»æï¼èä¸è½ä¿è¯èµå¼æä½çé¡ºåºä¸ç¨åºä»£ç ä¸­çæ§è¡é¡ºåºä¸è´ã\n\nä¸¾ä¸ªä¾å­ï¼\n\nvolatile boolean initialized = false;\n\n// ä¸é¢ä»£ç çº¿ç¨Aä¸­æ§è¡\n// è¯»åéç½®ä¿¡æ¯ï¼å½è¯»åå®æåå°initializedè®¾ç½®ä¸ºtrueä»¥éç¥å¶ä»çº¿ç¨éç½®å¯ç¨\ndoSomethingReadConfg();\ninitialized = true;\n\n// ä¸é¢ä»£ç çº¿ç¨Bä¸­æ§è¡\n// ç­å¾initialized ä¸ºtrueï¼ä»£è¡¨çº¿ç¨Aå·²ç»æéç½®ä¿¡æ¯åå§åå®æ\nwhile (!initialized) {\n     sleep();\n}\n// ä½¿ç¨çº¿ç¨Aåå§åå¥½çéç½®ä¿¡æ¯\ndoSomethingWithConfig();\nå¤å¶ä»£ç \n\n\nä¸é¢ä»£ç ä¸­å¦æå®ä¹ initialized åéæ¶æ²¡æä½¿ç¨ volatile ä¿®é¥°ï¼å°±æå¯è½ä¼ç±äºæä»¤éæåºçä¼åï¼å¯¼è´çº¿ç¨ A ä¸­æåä¸å¥ä»£ç  "initialized = true" å¨ âdoSomethingReadConfg()â ä¹åè¢«æ§è¡ï¼è¿æ ·ä¼å¯¼è´çº¿ç¨ B ä¸­ä½¿ç¨éç½®ä¿¡æ¯çä»£ç å°±å¯è½åºç°éè¯¯ï¼è volatile å³é®å­å°±ç¦æ­¢éæåºçè¯­ä¹å¯ä»¥é¿åæ­¤ç±»æåµåçã\n\n# volatile çåç\n\nå·ä½å®ç°æ¹å¼æ¯å¨ç¼è¯æçæå­èç æ¶ï¼ä¼å¨æä»¤åºåä¸­å¢å åå­å±éæ¥ä¿è¯ï¼ä¸é¢æ¯åºäºä¿å®ç­ç¥ç JMM åå­å±éæå¥ç­ç¥ï¼\n\n * å¨æ¯ä¸ª volatile åæä½çåé¢æå¥ä¸ä¸ª StoreStore å±éã è¯¥å±éé¤äºä¿è¯äºå±éä¹åçåæä½åè¯¥å±éä¹åçåæä½ä¸è½éæåºï¼è¿ä¼ä¿è¯äº volatile åæä½ä¹åï¼ä»»ä½çè¯»åæä½é½ä¼åäº volatile è¢«æäº¤ã\n * å¨æ¯ä¸ª volatile åæä½çåé¢æå¥ä¸ä¸ª StoreLoad å±éã è¯¥å±éé¤äºä½¿ volatile åæä½ä¸ä¼ä¸ä¹åçè¯»æä½éæåºå¤ï¼è¿ä¼å·æ°å¤çå¨ç¼å­ï¼ä½¿ volatile åéçåæ´æ°å¯¹å¶ä»çº¿ç¨å¯è§ã\n * å¨æ¯ä¸ª volatile è¯»æä½çåé¢æå¥ä¸ä¸ª LoadLoad å±éã è¯¥å±éé¤äºä½¿ volatile è¯»æä½ä¸ä¼ä¸ä¹åçåæä½åçéæåºå¤ï¼è¿ä¼å·æ°å¤çå¨ç¼å­ï¼ä½¿ volatile åéè¯»åçä¸ºææ°å¼ã\n * å¨æ¯ä¸ª volatile è¯»æä½çåé¢æå¥ä¸ä¸ª LoadStore å±éã è¯¥å±éé¤äºç¦æ­¢äº volatile è¯»æä½ä¸å¶ä¹åçä»»ä½åæä½è¿è¡éæåºï¼è¿ä¼å·æ°å¤çå¨ç¼å­ï¼ä½¿å¶ä»çº¿ç¨ volatile åéçåæ´æ°å¯¹ volatile è¯»æä½ççº¿ç¨å¯è§ã\n\n# volatile çä½¿ç¨åºæ¯\n\næ»ç»èµ·æ¥ï¼å°±æ¯âä¸æ¬¡åå¥ï¼å°å¤è¯»åâï¼æä¸çº¿ç¨è´è´£æ´æ°åéï¼å¶ä»çº¿ç¨åªè¯»ååé(ä¸æ´æ°åé)ï¼å¹¶æ ¹æ®åéçæ°å¼æ§è¡ç¸åºé»è¾ãä¾å¦ç¶ææ å¿ä½æ´æ°ï¼è§å¯èæ¨¡ååéå¼åå¸ã\n\n\n# synchronized\n\n\n# long å double åéçç¹æ®è§å\n\nJMM è¦æ± lockãunlockãreadãloadãassignãuseãstoreãwrite è¿ 8 ç§æä½é½å·æåå­æ§ï¼ä½æ¯å¯¹äº 64 ä½çæ°æ®ç±»åï¼long å doubleï¼ï¼å¨æ¨¡åä¸­ç¹å«å®ä¹ç¸å¯¹å®½æ¾çè§å®ï¼åè®¸èææºå°æ²¡æè¢« volatile ä¿®é¥°ç 64 ä½æ°æ®çè¯»åæä½åä¸º 2 æ¬¡ 32 ä½çæä½æ¥è¿è¡ï¼å³åè®¸èææºå¯éæ©ä¸ä¿è¯ 64 ä½æ°æ®ç±»åç loadãstoreãread å write è¿ 4 ä¸ªæä½çåå­æ§ãç±äºè¿ç§éåå­æ§ï¼æå¯è½å¯¼è´å¶ä»çº¿ç¨è¯»å°åæ­¥æªå®æçâ32 ä½çåä¸ªåéâçå¼ã\n\nä¸è¿å®éå¼åä¸­ï¼Java åå­æ¨¡åå¼ºçå»ºè®®èææºæ 64 ä½æ°æ®çè¯»åå®ç°ä¸ºå·æåå­æ§ï¼ç®ååç§å¹³å°ä¸çåç¨èææºé½éæ©æ 64 ä½æ°æ®çè¯»åæä½ä½ä¸ºåå­æä½æ¥å¯¹å¾ï¼å æ­¤æä»¬å¨ç¼åä»£ç æ¶ä¸è¬ä¸éè¦æç¨å°ç long å double åéä¸é¨å£°æä¸º volatileã\n\n\n# final åéçç¹æ®è§å\n\næä»¬ç¥éï¼final æååéå¿é¡»å¨å£°æçæ¶ååå§åæèå¨æé å¨ä¸­åå§åï¼å¦åå°±ä¼æ¥ç¼è¯éè¯¯ã final å³é®å­çå¯è§æ§æ¯æï¼è¢« final ä¿®é¥°çå­æ®µå¨å£°ææ¶æèæé å¨ä¸­ï¼ä¸æ¦åå§åå®æï¼é£ä¹å¨å¶ä»çº¿ç¨æ é¡»åæ­¥å°±è½æ­£ç¡®çè§ final å­æ®µçå¼ãè¿æ¯å ä¸ºä¸æ¦åå§åå®æï¼final åéçå¼ç«å»ååå°ä¸»åå­ã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ Java èææºã\n * çè§£ Java åå­æ¨¡å\n * ãJava å¹¶åç¼ç¨å®æã',normalizedContent:'# java åå­æ¨¡å\n\n> å³é®è¯ï¼jmmãvolatileãsynchronizedãfinalãhappens-beforeãåå­å±é\n> \n> æè¦ï¼java åå­æ¨¡åï¼java memory modelï¼ï¼ç®ç§° jmmãjava åå­æ¨¡åçç®æ æ¯ä¸ºäºè§£å³ç±å¯è§æ§åæåºæ§å¯¼è´çå¹¶åå®å¨é®é¢ãjava åå­æ¨¡åéè¿ å±è½åç§ç¡¬ä»¶åæä½ç³»ç»çåå­è®¿é®å·®å¼ï¼ä»¥å®ç°è®© java ç¨åºå¨åç§å¹³å°ä¸é½è½è¾¾å°ä¸è´çåå­è®¿é®ææã\n\n\n# ç©çåå­æ¨¡å\n\nç©çæºéå°çå¹¶åé®é¢ä¸èææºä¸­çæåµæä¸å°ç¸ä¼¼ä¹å¤ï¼ç©çæºå¯¹å¹¶åçå¤çæ¹æ¡å¯¹äºèææºçå®ç°ä¹æç¸å½å¤§çåèæä¹ã\n\n\n# ç¡¬ä»¶å¤çæç\n\nç©çåå­çç¬¬ä¸ä¸ªé®é¢æ¯ï¼ç¡¬ä»¶å¤çæçã\n\n * ç»å¤§å¤æ°çè¿ç®ä»»å¡é½ä¸å¯è½åªé å¤çå¨âè®¡ç®âå°±è½å®æï¼å¤çå¨è³å°éè¦ä¸åå­äº¤äºï¼å¦è¯»åè¿ç®æ°æ®ãå­å¨è¿ç®ç»æï¼è¿ä¸ª i/o æä½æ¯å¾é¾æ¶é¤çï¼æ æ³ä»é å¯å­å¨å®æææè¿ç®ä»»å¡ï¼ã\n * ç±äºè®¡ç®æºçå­å¨è®¾å¤ä¸å¤çå¨çè¿ç®éåº¦æå ä¸ªæ°éçº§çå·®è· ï¼è¿ç§éåº¦ä¸ççç¾ï¼ä¼éä½ç¡¬ä»¶çå¤çæçãæä»¥ï¼ç°ä»£è®¡ç®æºé½ä¸å¾ä¸ å å¥é«éç¼å­ï¼cacheï¼ æ¥ä½ä¸ºåå­åå¤çå¨ä¹é´çç¼å²ãå°éè¦ç¨å°çæ°æ®å¤å¶å°ç¼å­ä¸­ï¼è®©è¿ç®è½å¿«éè¿è¡ï¼å½è¿ç®ç»æååä»ç¼å­åæ­¥ä¼åå­ä¸­ï¼è¿æ ·å¤çå¨å°±æ éç­å¾ç¼æ¢çåå­è¯»åäºã\n\n\n# ç¼å­ä¸è´æ§\n\né«éç¼å­è§£å³äº ç¡¬ä»¶æçé®é¢ï¼ä½æ¯å¼å¥äºä¸ä¸ªæ°çé®é¢ï¼ç¼å­ä¸è´æ§ï¼cache coherenceï¼ã\n\nå¨å¤å¤çå¨ç³»ç»ä¸­ï¼æ¯ä¸ªå¤çå¨é½æèªå·±çé«éç¼å­ï¼èå®ä»¬åå±äº«åä¸ä¸»åå­ãå½å¤ä¸ªå¤çå¨çè¿ç®ä»»å¡é½æ¶ååä¸åä¸»åå­åºåæ¶ï¼å°å¯è½å¯¼è´åèªçç¼å­æ°æ®ä¸ä¸è´ã\n\nä¸ºäºè§£å³ç¼å­ä¸è´æ§é®é¢ï¼éè¦åä¸ªå¤çå¨è®¿é®ç¼å­æ¶é½éµå¾ªä¸äºåè®®ï¼å¨è¯»åæ¶è¦æ ¹æ®åè®®æ¥è¿è¡æä½ã\n\n\n\n\n# ä»£ç ä¹±åºæ§è¡ä¼å\n\né¤äºé«éç¼å­ä»¥å¤ï¼ä¸ºäºä½¿å¾å¤çå¨åé¨çè¿ç®ååå°½éè¢«ååå©ç¨ï¼å¤çå¨å¯è½ä¼å¯¹è¾å¥ä»£ç è¿è¡ä¹±åºæ§è¡ï¼out-of-order executionï¼ä¼åãå¤çå¨ä¼å¨è®¡ç®ä¹åå°ä¹±åºæ§è¡çç»æéç»ï¼ä¿è¯è¯¥ç»æä¸é¡ºåºæ§è¡çç»ææ¯ä¸è´çï¼ä½ä¸ä¿è¯ç¨åºä¸­åä¸ªè¯­å¥è®¡ç®çååé¡ºåºä¸è¾å¥ä»£ç ä¸­çé¡ºåºä¸è´ã\n\n\n\nä¹±åºæ§è¡ææ¯æ¯å¤çå¨ä¸ºæé«è¿ç®éåº¦èååºè¿èä»£ç åæé¡ºåºçä¼åã\n\n * åæ ¸ç¯å¢ä¸ï¼å¤çå¨ä¿è¯ååºçä¼åä¸ä¼å¯¼è´æ§è¡ç»æè¿ç¦»é¢æç®æ ï¼ä½å¨å¤æ ¸ç¯å¢ä¸å´å¹¶éå¦æ­¤ã\n * å¤æ ¸ç¯å¢ä¸ï¼ å¦æå­å¨ä¸ä¸ªæ ¸çè®¡ç®ä»»å¡ä¾èµå¦ä¸ä¸ªæ ¸çè®¡ç®ä»»å¡çä¸­é´ç»æï¼èä¸å¯¹ç¸å³æ°æ®è¯»åæ²¡åä»»ä½é²æ¤æªæ½ï¼é£ä¹å¶é¡ºåºæ§å¹¶ä¸è½é ä»£ç çååé¡ºåºæ¥ä¿è¯ã\n\n\n\n\n# java åå­æ¨¡å\n\nåå­æ¨¡å è¿ä¸ªæ¦å¿µãæä»¬å¯ä»¥çè§£ä¸ºï¼å¨ç¹å®çæä½åè®®ä¸ï¼å¯¹ç¹å®çåå­æé«éç¼å­è¿è¡è¯»åè®¿é®çè¿ç¨æ½è±¡ãä¸åæ¶æçç©çè®¡ç®æºå¯ä»¥æä¸ä¸æ ·çåå­æ¨¡åï¼jvm ä¹æèªå·±çåå­æ¨¡åã\n\njvm ä¸­è¯å¾å®ä¹ä¸ç§ java åå­æ¨¡åï¼java memory model, jmmï¼æ¥å±è½åç§ç¡¬ä»¶åæä½ç³»ç»çåå­è®¿é®å·®å¼ï¼ä»¥å®ç°è®© java ç¨åº å¨åç§å¹³å°ä¸é½è½è¾¾å°ä¸è´çåå­è®¿é®ææã\n\nå¨ java å¹¶åç®ä» ä¸­å·²ç»ä»ç»äºï¼å¹¶åå®å¨éè¦æ»¡è¶³å¯è§æ§ãæåºæ§ãåå­æ§ãå¶ä¸­ï¼å¯¼è´å¯è§æ§çåå æ¯ç¼å­ï¼å¯¼è´æåºæ§çåå æ¯ç¼è¯ä¼åãé£è§£å³å¯è§æ§ãæåºæ§æç´æ¥çåæ³å°±æ¯ç¦ç¨ç¼å­åç¼è¯ä¼å ãä½è¿ä¹åï¼æ§è½å°±å ªå¿§äºã\n\nåççæ¹æ¡åºè¯¥æ¯æéç¦ç¨ç¼å­ä»¥åç¼è¯ä¼åãé£ä¹ï¼å¦ä½åå°å¢ï¼ï¼java åå­æ¨¡åè§èäº jvm å¦ä½æä¾æéç¦ç¨ç¼å­åç¼è¯ä¼åçæ¹æ³ãå·ä½æ¥è¯´ï¼è¿äºæ¹æ³åæ¬ volatileãsynchronized å final ä¸ä¸ªå³é®å­ï¼ä»¥å happens-before è§åã\n\n\n# ä¸»åå­åå·¥ä½åå­\n\njmm çä¸»è¦ç®æ æ¯ å®ä¹ç¨åºä¸­åä¸ªåéçè®¿é®è§åï¼å³å¨èææºä¸­å°åéå­å¨å°åå­åä»åå­ä¸­ååºåéè¿æ ·çåºå±ç»èãæ­¤å¤çåéï¼variablesï¼ä¸ java ç¼ç¨ä¸­æè¯´çåéææåºå«ï¼å®åæ¬äºå®ä¾å­æ®µãéæå­æ®µåæææ°å¼å¯¹è±¡çåç´ ï¼ä½ä¸åæ¬å±é¨åéä¸æ¹æ³åæ°ï¼å ä¸ºåèæ¯çº¿ç¨ç§æçï¼ä¸ä¼è¢«å±äº«ï¼èªç¶å°±ä¸ä¼å­å¨ç«äºé®é¢ãä¸ºäºè·å¾è¾å¥½çæ§è¡æè½ï¼jmm å¹¶æ²¡æéå¶æ§è¡å¼æä½¿ç¨å¤çå¨çç¹å®å¯å­å¨æç¼å­æ¥åä¸»å­è¿è¡äº¤äºï¼ä¹æ²¡æéå¶å³ä½¿ç¼è¯å¨è¿è¡è°æ´ä»£ç æ§è¡é¡ºåºè¿ç±»ä¼åæªæ½ã\n\njmm è§å®äºææçåéé½å­å¨å¨ä¸»åå­ï¼main memoryï¼ä¸­ã\n\næ¯æ¡çº¿ç¨è¿æèªå·±çå·¥ä½åå­ï¼working memoryï¼ï¼å·¥ä½åå­ä¸­ä¿çäºè¯¥çº¿ç¨ä½¿ç¨å°çåéçä¸»åå­çå¯æ¬ãå·¥ä½åå­æ¯ jmm çä¸ä¸ªæ½è±¡æ¦å¿µï¼å¹¶ä¸çå®å­å¨ï¼å®æ¶µçäºç¼å­ï¼åç¼å²åºï¼å¯å­å¨ä»¥åå¶ä»çç¡¬ä»¶åç¼è¯å¨ä¼åã\n\n\n\nçº¿ç¨å¯¹åéçæææä½é½å¿é¡»å¨å·¥ä½åå­ä¸­è¿è¡ï¼èä¸è½ç´æ¥è¯»åä¸»åå­ä¸­çåéãä¸åççº¿ç¨é´ä¹æ æ³ç´æ¥è®¿é®å¯¹æ¹å·¥ä½åå­ä¸­çåéï¼çº¿ç¨é´åéå¼çä¼ éåéè¦éè¿ä¸»åå­æ¥å®æã\n\n\n\n> è¯´æï¼\n> \n> è¿éè¯´çä¸»åå­ãå·¥ä½åå­ä¸ java åå­åºåä¸­çå ãæ ãæ¹æ³åºç­ä¸æ¯åä¸ä¸ªå±æ¬¡çåå­ååã\n\n\n# jmm åå­æä½çé®é¢\n\nç±»ä¼¼äºç©çåå­æ¨¡åé¢ä¸´çé®é¢ï¼jmm å­å¨ä»¥ä¸ä¸¤ä¸ªé®é¢ï¼\n\n * å·¥ä½åå­æ°æ®ä¸è´æ§ - åä¸ªçº¿ç¨æä½æ°æ®æ¶ä¼ä¿å­ä½¿ç¨å°çä¸»åå­ä¸­çå±äº«åéå¯æ¬ï¼å½å¤ä¸ªçº¿ç¨çè¿ç®ä»»å¡é½æ¶ååä¸ä¸ªå±äº«åéæ¶ï¼å°å¯¼è´åèªççå±äº«åéå¯æ¬ä¸ä¸è´ãå¦æççåçè¿ç§æåµï¼æ°æ®åæ­¥åä¸»åå­ä»¥è°çå¯æ¬æ°æ®ä¸ºåï¼ java åå­æ¨¡åä¸»è¦éè¿ä¸ç³»åçæ°æ®åæ­¥åè®®ãè§åæ¥ä¿è¯æ°æ®çä¸è´æ§ã\n * æä»¤éæåºä¼å - java ä¸­éæåºéå¸¸æ¯ç¼è¯å¨æè¿è¡æ¶ç¯å¢ä¸ºäºä¼åç¨åºæ§è½èéåçå¯¹æä»¤è¿è¡éæ°æåºæ§è¡çä¸ç§ææ®µãéæåºåä¸ºä¸¤ç±»ï¼ç¼è¯æéæåºåè¿è¡æéæåºï¼åå«å¯¹åºç¼è¯æ¶åè¿è¡æ¶ç¯å¢ã åæ ·çï¼æä»¤éæåºä¸æ¯éæéæåºï¼å®éè¦æ»¡è¶³ä»¥ä¸ä¸¤ä¸ªæ¡ä»¶ï¼\n   * å¨åçº¿ç¨ç¯å¢ä¸ä¸è½æ¹åç¨åºè¿è¡çç»æãå³æ¶ç¼è¯å¨ï¼åå¤çå¨ï¼éè¦ä¿è¯ç¨åºè½å¤éµå® as-if-serial å±æ§ãéä¿å°è¯´ï¼å°±æ¯å¨åçº¿ç¨æåµä¸ï¼è¦ç»ç¨åºä¸ä¸ªé¡ºåºæ§è¡çåè±¡ãå³ç»è¿éæåºçæ§è¡ç»æè¦ä¸é¡ºåºæ§è¡çç»æä¿æä¸è´ã\n   * å­å¨æ°æ®ä¾èµå³ç³»çä¸åè®¸éæåºã\n   * å¤çº¿ç¨ç¯å¢ä¸ï¼å¦æçº¿ç¨å¤çé»è¾ä¹é´å­å¨ä¾èµå³ç³»ï¼æå¯è½å ä¸ºæä»¤éæåºå¯¼è´è¿è¡ç»æä¸é¢æä¸åã\n\n\n# åå­é´äº¤äºæä½\n\njmm å®ä¹äº 8 ä¸ªæä½æ¥å®æä¸»åå­åå·¥ä½åå­ä¹é´çäº¤äºæä½ãjvm å®ç°æ¶å¿é¡»ä¿è¯ä¸é¢ä»ç»çæ¯ç§æä½é½æ¯ åå­çï¼å¯¹äº double å long åçåéæ¥è¯´ï¼loadãstoreãreadãå write æä½å¨æäºå¹³å°ä¸åè®¸æä¾å¤ ï¼ã\n\n * lock (éå®) - ä½ç¨äºä¸»åå­çåéï¼å®æä¸ä¸ªåéæ è¯ä¸ºä¸æ¡çº¿ç¨ç¬å çç¶æã\n * unlock (è§£é) - ä½ç¨äºä¸»åå­çåéï¼å®æä¸ä¸ªå¤äºéå®ç¶æçåééæ¾åºæ¥ï¼éæ¾åçåéæå¯ä»¥è¢«å¶ä»çº¿ç¨éå®ã\n * read (è¯»å) - ä½ç¨äºä¸»åå­çåéï¼å®æä¸ä¸ªåéçå¼ä»ä¸»åå­ä¼ è¾å°çº¿ç¨çå·¥ä½åå­ä¸­ï¼ä»¥ä¾¿éåç load å¨ä½ä½¿ç¨ã\n * write (åå¥) - ä½ç¨äºä¸»åå­çåéï¼å®æ store æä½ä»å·¥ä½åå­ä¸­å¾å°çåéçå¼æ¾å¥ä¸»åå­çåéä¸­ã\n * load (è½½å¥) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æ read æä½ä»ä¸»åå­ä¸­å¾å°çåéå¼æ¾å¥å·¥ä½åå­çåéå¯æ¬ä¸­ã\n * use (ä½¿ç¨) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æå·¥ä½åå­ä¸­ä¸ä¸ªåéçå¼ä¼ éç»æ§è¡å¼æï¼æ¯å½èææºéå°ä¸ä¸ªéè¦ä½¿ç¨å°åéçå¼å¾å­èç æä»¤æ¶å°±ä¼æ§è¡è¿ä¸ªæä½ã\n * assign (èµå¼) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æä¸ä¸ªä»æ§è¡å¼ææ¥æ¶å°çå¼èµç»å·¥ä½åå­çåéï¼æ¯å½èææºéå°ä¸ä¸ªç»åéèµå¼çå­èç æä»¤æ¶æ§è¡è¿ä¸ªæä½ã\n * store (å­å¨) - ä½ç¨äºå·¥ä½åå­çåéï¼å®æå·¥ä½åå­ä¸­ä¸ä¸ªåéçå¼ä¼ éå°ä¸»åå­ä¸­ï¼ä»¥ä¾¿éå write æä½ä½¿ç¨ã\n\nå¦æè¦æä¸ä¸ªåéä»ä¸»åå­ä¸­å¤å¶å°å·¥ä½åå­ï¼å°±éè¦æåºæ§è¡ read å load æä½ï¼å¦ææåéä»å·¥ä½åå­ä¸­åæ­¥åä¸»åå­ä¸­ï¼å°±éè¦æåºæ§è¡ store å write æä½ãä½ java åå­æ¨¡ååªè¦æ±ä¸è¿°æä½å¿é¡»æé¡ºåºæ§è¡ï¼èæ²¡æä¿è¯å¿é¡»æ¯è¿ç»­æ§è¡ã\n\njmm è¿è§å®äºä¸è¿° 8 ç§åºæ¬æä½ï¼éè¦æ»¡è¶³ä»¥ä¸è§åï¼\n\n * read å load å¿é¡»æå¯¹åºç°ï¼store å write å¿é¡»æå¯¹åºç°ãå³ä¸åè®¸ä¸ä¸ªåéä»ä¸»åå­è¯»åäºä½å·¥ä½åå­ä¸æ¥åï¼æä»å·¥ä½åå­åèµ·ååäºä½ä¸»åå­ä¸æ¥åçæåµåºç°ã\n * ä¸åè®¸ä¸ä¸ªçº¿ç¨ä¸¢å¼å®çæè¿ assign çæä½ï¼å³åéå¨å·¥ä½åå­ä¸­æ¹åäºä¹åå¿é¡»æåååæ­¥å°ä¸»åå­ä¸­ã\n * ä¸åè®¸ä¸ä¸ªçº¿ç¨æ åå çï¼æ²¡æåçè¿ä»»ä½ assign æä½ï¼ææ°æ®ä»å·¥ä½åå­åæ­¥åä¸»åå­ä¸­ã\n * ä¸ä¸ªæ°çåéåªè½å¨ä¸»åå­ä¸­è¯çï¼ä¸åè®¸å¨å·¥ä½åå­ä¸­ç´æ¥ä½¿ç¨ä¸ä¸ªæªè¢«åå§åï¼load æ assign ï¼çåéãæ¢å¥è¯è¯´ï¼å°±æ¯å¯¹ä¸ä¸ªåéå®æ½ use å store æä½ä¹åï¼å¿é¡»åæ§è¡è¿äº load æ assign æä½ã\n * ä¸ä¸ªåéå¨åä¸ä¸ªæ¶å»åªåè®¸ä¸æ¡çº¿ç¨å¯¹å¶è¿è¡ lock æä½ï¼ä½ lock æä½å¯ä»¥è¢«åä¸æ¡çº¿ç¨éå¤æ§è¡å¤æ¬¡ï¼å¤æ¬¡æ§è¡ lock åï¼åªææ§è¡ç¸åæ¬¡æ°ç unlock æä½ï¼åéæä¼è¢«è§£éãæä»¥ lock å unlock å¿é¡»æå¯¹åºç°ã\n * å¦æå¯¹ä¸ä¸ªåéæ§è¡ lock æä½ï¼å°ä¼æ¸ç©ºå·¥ä½åå­ä¸­æ­¤åéçå¼ï¼å¨æ§è¡å¼æä½¿ç¨è¿ä¸ªåéåï¼éè¦éæ°æ§è¡ load æ assign æä½åå§ååéçå¼ã\n * å¦æä¸ä¸ªåéäºåæ²¡æè¢« lock æä½éå®ï¼åä¸åè®¸å¯¹å®æ§è¡ unlock æä½ï¼ä¹ä¸åè®¸å» unlock ä¸ä¸ªè¢«å¶ä»çº¿ç¨éå®çåéã\n * å¯¹ä¸ä¸ªåéæ§è¡ unlock æä½ä¹åï¼å¿é¡»åææ­¤åéåæ­¥å°ä¸»åå­ä¸­ï¼æ§è¡ store å write æä½ï¼\n\n\n\n\n# å¹¶åå®å¨ç¹æ§\n\nä¸æä»ç»äº java åå­äº¤äºç 8 ç§åºæ¬æä½ï¼å®ä»¬éµå¾ª java åå­ä¸å¤§ç¹æ§ï¼åå­æ§ãå¯è§æ§ãæåºæ§ã\n\nèè¿ä¸å¤§ç¹æ§ï¼å½æ ¹ç»åºï¼æ¯ä¸ºäºå®ç°å¤çº¿ç¨ç æ°æ®ä¸è´æ§ï¼ä½¿å¾ç¨åºå¨å¤çº¿ç¨å¹¶åï¼æä»¤éæåºä¼åçç¯å¢ä¸­è½å¦é¢æè¿è¡ã\n\n# åå­æ§\n\nåå­æ§å³ä¸ä¸ªæä½æèå¤ä¸ªæä½ï¼è¦ä¹å¨é¨æ§è¡ï¼æ§è¡çè¿ç¨ä¸ä¼è¢«ä»»ä½å ç´ ææ­ï¼ï¼è¦ä¹å°±é½ä¸æ§è¡ãå³ä½¿å¨å¤ä¸ªçº¿ç¨ä¸èµ·æ§è¡çæ¶åï¼ä¸ä¸ªæä½ä¸æ¦å¼å§ï¼å°±ä¸ä¼è¢«å¶ä»çº¿ç¨æå¹²æ°ã\n\nå¨ java ä¸­ï¼ä¸ºäºä¿è¯åå­æ§ï¼æä¾äºä¸¤ä¸ªé«çº§çå­èç æä»¤ monitorenter å monitorexitãè¿ä¸¤ä¸ªå­èç ï¼å¨ java ä¸­å¯¹åºçå³é®å­å°±æ¯ synchronizedã\n\nå æ­¤ï¼å¨ java ä¸­å¯ä»¥ä½¿ç¨ synchronized æ¥ä¿è¯æ¹æ³åä»£ç ååçæä½æ¯åå­æ§çã\n\n# å¯è§æ§\n\nå¯è§æ§æ¯æå½å¤ä¸ªçº¿ç¨è®¿é®åä¸ä¸ªåéæ¶ï¼ä¸ä¸ªçº¿ç¨ä¿®æ¹äºè¿ä¸ªåéçå¼ï¼å¶ä»çº¿ç¨è½å¤ç«å³çå¾å°ä¿®æ¹çå¼ã\n\njmm æ¯éè¿ "åéä¿®æ¹åå°æ°å¼åæ­¥åä¸»åå­ï¼ åéè¯»ååä»ä¸»åå­å·æ°åéå¼" è¿ç§ä¾èµä¸»åå­ä½ä¸ºä¼ éåªä»çæ¹å¼æ¥å®ç°çã\n\njava å®ç°å¤çº¿ç¨å¯è§æ§çæ¹å¼æï¼\n\n * volatile\n * synchronized\n * final\n\n# æåºæ§\n\næåºæ§è§åè¡¨ç°å¨ä»¥ä¸ä¸¤ç§åºæ¯: çº¿ç¨ååçº¿ç¨é´\n\n * çº¿ç¨å - ä»æä¸ªçº¿ç¨çè§åº¦çæ¹æ³çæ§è¡ï¼æä»¤ä¼æç§ä¸ç§å«âä¸²è¡âï¼as-if-serialï¼çæ¹å¼æ§è¡ï¼æ­¤ç§æ¹å¼å·²ç»åºç¨äºé¡ºåºç¼ç¨è¯­è¨ã\n * çº¿ç¨é´ - è¿ä¸ªçº¿ç¨âè§å¯âå°å¶ä»çº¿ç¨å¹¶åå°æ§è¡éåæ­¥çä»£ç æ¶ï¼ç±äºæä»¤éæåºä¼åï¼ä»»ä½ä»£ç é½æå¯è½äº¤åæ§è¡ãå¯ä¸èµ·ä½ç¨ççº¦ææ¯ï¼å¯¹äºåæ­¥æ¹æ³ï¼åæ­¥åï¼synchronized å³é®å­ä¿®é¥°ï¼ä»¥å volatile å­æ®µçæä½ä»ç»´æç¸å¯¹æåºã\n\nå¨ java ä¸­ï¼å¯ä»¥ä½¿ç¨ synchronized å volatile æ¥ä¿è¯å¤çº¿ç¨ä¹é´æä½çæåºæ§ãå®ç°æ¹å¼ææåºå«ï¼\n\n * volatile å³é®å­ä¼ç¦æ­¢æä»¤éæåºã\n * synchronized å³é®å­éè¿äºæ¥ä¿è¯åä¸æ¶å»åªåè®¸ä¸æ¡çº¿ç¨æä½ã\n\n\n# happens-before\n\njmm ä¸ºç¨åºä¸­ææçæä½å®ä¹äºä¸ä¸ªååºå³ç³»ï¼ç§°ä¹ä¸º åè¡åçååï¼happens-beforeï¼ã\n\nhappens-before æ¯æ åé¢ä¸ä¸ªæä½çç»æå¯¹åç»­æä½æ¯å¯è§çã\n\nhappens-before éå¸¸éè¦ï¼å®æ¯å¤æ­æ°æ®æ¯å¦å­å¨ç«äºãçº¿ç¨æ¯å¦å®å¨çä¸»è¦ä¾æ®ï¼ä¾é è¿ä¸ªååï¼æä»¬å¯ä»¥éè¿å æ¡è§åä¸æ½å­å°è§£å³å¹¶åç¯å¢ä¸ä¸¤ä¸ªæä½é´æ¯å¦å¯è½å­å¨å²çªçææé®é¢ã\n\n * ç¨åºæ¬¡åºè§å - ä¸ä¸ªçº¿ç¨åï¼æç§ä»£ç é¡ºåºï¼ä¹¦åå¨åé¢çæä½åè¡åçäºä¹¦åå¨åé¢çæä½ã\n * éå®è§å - ä¸ä¸ª unlock æä½åè¡åçäºåé¢å¯¹åä¸ä¸ªéç lock æä½ã\n * volatile åéè§å - å¯¹ä¸ä¸ª volatile åéçåæä½åè¡åçäºåé¢å¯¹è¿ä¸ªåéçè¯»æä½ã\n * çº¿ç¨å¯å¨è§å - thread å¯¹è±¡ç start() æ¹æ³åè¡åçäºæ­¤çº¿ç¨çæ¯ä¸ªä¸ä¸ªå¨ä½ã\n * çº¿ç¨ç»æ­¢è§å - çº¿ç¨ä¸­ææçæä½é½åè¡åçäºçº¿ç¨çç»æ­¢æ£æµï¼æä»¬å¯ä»¥éè¿ thread.join() æ¹æ³ç»æãthread.isalive() çè¿åå¼ææ®µæ£æµå°çº¿ç¨å·²ç»ç»æ­¢æ§è¡ã\n * çº¿ç¨ä¸­æ­è§å - å¯¹çº¿ç¨ interrupt() æ¹æ³çè°ç¨åè¡åçäºè¢«ä¸­æ­çº¿ç¨çä»£ç æ£æµå°ä¸­æ­äºä»¶çåçï¼å¯ä»¥éè¿ thread.interrupted() æ¹æ³æ£æµå°æ¯å¦æä¸­æ­åçã\n * å¯¹è±¡ç»ç»è§å - ä¸ä¸ªå¯¹è±¡çåå§åå®æåè¡åçäºå®ç finalize() æ¹æ³çå¼å§ã\n * ä¼ éæ§ - å¦ææä½ a åè¡åçäº æä½ bï¼èæä½ b å åè¡åçäº æä½ cï¼åå¯ä»¥å¾åºæä½ a åè¡åçäº æä½ cã\n\n\n# åå­å±é\n\njava ä¸­å¦ä½ä¿è¯åºå±æä½çæåºæ§åå¯è§æ§ï¼å¯ä»¥éè¿åå­å±éï¼memory barrierï¼ã\n\nåå­å±éæ¯è¢«æå¥ä¸¤ä¸ª cpu æä»¤ä¹é´çä¸ç§æä»¤ï¼ç¨æ¥ç¦æ­¢å¤çå¨æä»¤åçéæåºï¼åå±éä¸æ ·ï¼ï¼ä»èä¿éæåºæ§çãå¦å¤ï¼ä¸ºäºè¾¾å°å±éçææï¼å®ä¹ä¼ä½¿å¤çå¨åå¥ãè¯»åå¼ä¹åï¼å°ä¸»åå­çå¼åå¥é«éç¼å­ï¼æ¸ç©ºæ æéåï¼ä»èä¿éå¯è§æ§ã\n\nä¸¾ä¸ªä¾å­ï¼\n\nstore1;\nstore2;\nload1;\nstoreload;  //åå­å±é\nstore3;\nload2;\nload3;\nå¤å¶ä»£ç \n\n\nå¯¹äºä¸é¢çä¸ç» cpu æä»¤ï¼store è¡¨ç¤ºåå¥æä»¤ï¼load è¡¨ç¤ºè¯»åæä»¤ï¼ï¼storeload å±éä¹åç store æä»¤æ æ³ä¸ storeload å±éä¹åç load æä»¤è¿è¡äº¤æ¢ä½ç½®ï¼å³éæåºãä½æ¯ storeload å±éä¹ååä¹åçæä»¤æ¯å¯ä»¥äºæ¢ä½ç½®çï¼å³ store1 å¯ä»¥å store2 äºæ¢ï¼load2 å¯ä»¥å load3 äºæ¢ã\n\nå¸¸è§æ 4 ç§å±é\n\n * loadload å±é - å¯¹äºè¿æ ·çè¯­å¥ load1; loadload; load2ï¼å¨ load2 ååç»­è¯»åæä½è¦è¯»åçæ°æ®è¢«è®¿é®åï¼ä¿è¯ load1 è¦è¯»åçæ°æ®è¢«è¯»åå®æ¯ã\n * storestore å±é - å¯¹äºè¿æ ·çè¯­å¥ store1; storestore; store2ï¼å¨ store2 ååç»­åå¥æä½æ§è¡åï¼ä¿è¯ store1 çåå¥æä½å¯¹å¶å®å¤çå¨å¯è§ã\n * loadstore å±é - å¯¹äºè¿æ ·çè¯­å¥ load1; loadstore; store2ï¼å¨ store2 ååç»­åå¥æä½è¢«æ§è¡åï¼ä¿è¯ load1 è¦è¯»åçæ°æ®è¢«è¯»åå®æ¯ã\n * storeload å±é - å¯¹äºè¿æ ·çè¯­å¥ store1; storeload; load2ï¼å¨ load2 ååç»­ææè¯»åæä½æ§è¡åï¼ä¿è¯ store1 çåå¥å¯¹ææå¤çå¨å¯è§ãå®çå¼éæ¯åç§å±éä¸­æå¤§çï¼å²å·åç¼å²å¨ï¼æ¸ç©ºæ æåéåï¼ãå¨å¤§å¤æ°å¤çå¨çå®ç°ä¸­ï¼è¿ä¸ªå±éæ¯ä¸ªä¸è½å±éï¼å¼å·å¶å®ä¸ç§åå­å±éçåè½ã\n\njava ä¸­å¯¹åå­å±éçä½¿ç¨å¨ä¸è¬çä»£ç ä¸­ä¸å¤ªå®¹æè§å°ï¼å¸¸è§çæ volatile å synchronized å³é®å­ä¿®é¥°çä»£ç å(åé¢åå±å¼ä»ç»)ï¼è¿å¯ä»¥éè¿ unsafe è¿ä¸ªç±»æ¥ä½¿ç¨åå­å±éã\n\n\n# volatile\n\nvolatile æ¯ jvm æä¾ç æè½»éçº§çåæ­¥æºå¶ã\n\nvolatile çä¸­ææææ¯ä¸ç¨³å®çï¼æåçï¼ç¨ volatile ä¿®é¥°åéæ¯ä¸ºäºä¿è¯åéå¨å¤çº¿ç¨ä¸­çå¯è§æ§ã\n\n# volatile åéçç¹æ§\n\nvolatile åéå·æä¸¤ç§ç¹æ§ï¼\n\n * ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§ã\n * ç¦æ­¢è¿è¡æä»¤éæåº\n\n# ä¿è¯åéå¯¹ææçº¿ç¨çå¯è§æ§\n\nè¿éçå¯è§æ§æ¯æå½ä¸æ¡çº¿ç¨ä¿®æ¹äº volatile åéçå¼ï¼æ°å¼å¯¹äºå¶ä»çº¿ç¨æ¥è¯´æ¯å¯ä»¥ç«å³å¾ç¥çãèæ®éåéä¸è½åå°è¿ä¸ç¹ï¼æ®éåéçå¼å¨çº¿ç¨é´ä¼ éåéè¦éè¿ä¸»åå­æ¥å®æã\n\nçº¿ç¨å volatile åéçè¿ç¨ï¼\n\n 1. æ¹åçº¿ç¨å·¥ä½åå­ä¸­ volatile åéå¯æ¬çå¼\n 2. å°æ¹ååçå¯æ¬çå¼ä»å·¥ä½åå­å·æ°å°ä¸»åå­\n\nçº¿ç¨è¯» volatile åéçè¿ç¨ï¼\n\n 1. ä»ä¸»åå­ä¸­è¯»å volatile åéçææ°å¼å°çº¿ç¨çå·¥ä½åå­ä¸­\n 2. ä»å·¥ä½åå­ä¸­è¯»å volatile åéçå¯æ¬\n\n> æ³¨æï¼ä¿è¯å¯è§æ§ä¸ç­åäº volatile åéä¿è¯å¹¶åæä½çå®å¨æ§\n> \n> å¨ä¸ç¬¦åä»¥ä¸ä¸¤ç¹çåºæ¯ä¸­ï¼ä»ç¶è¦éè¿æ·éæ¥ä¿è¯åå­æ§ï¼\n> \n>  * è¿ç®ç»æå¹¶ä¸ä¾èµåéçå½åå¼ï¼æèè½å¤ç¡®ä¿åªæåä¸ççº¿ç¨ä¿®æ¹åéçå¼ã\n>  * åéä¸éè¦ä¸å¶ä»ç¶æåéå±ååä¸ä¸åçº¦æã\n\nä½æ¯å¦æå¤ä¸ªçº¿ç¨åæ¶ææ´æ°åçåéå¼åæ¶å·æ°åä¸»åå­ï¼å¯è½å¯¼è´å¾å°çå¼ä¸æ¯é¢æç»æï¼\n\nä¸¾ä¸ªä¾å­ï¼ å®ä¹ volatile int count = 0ï¼2 ä¸ªçº¿ç¨åæ¶æ§è¡ count++ æä½ï¼æ¯ä¸ªçº¿ç¨é½æ§è¡ 500 æ¬¡ï¼æç»ç»æå°äº 1000ï¼åå æ¯æ¯ä¸ªçº¿ç¨æ§è¡ count++ éè¦ä»¥ä¸ 3 ä¸ªæ­¥éª¤ï¼\n\n 1. çº¿ç¨ä»ä¸»åå­è¯»åææ°ç count çå¼\n 2. æ§è¡å¼ææ count å¼å  1ï¼å¹¶èµå¼ç»çº¿ç¨å·¥ä½åå­\n 3. çº¿ç¨å·¥ä½åå­æ count å¼ä¿å­å°ä¸»åå­ æå¯è½æä¸æ¶å» 2 ä¸ªçº¿ç¨å¨æ­¥éª¤ 1 è¯»åå°çå¼é½æ¯ 100ï¼æ§è¡å®æ­¥éª¤ 2 å¾å°çå¼é½æ¯ 101ï¼æåå·æ°äº 2 æ¬¡ 101 ä¿å­å°ä¸»åå­ã\n\n# è¯­ä¹ 2 ç¦æ­¢è¿è¡æä»¤éæåº\n\nå·ä½ä¸ç¹è§£éï¼ç¦æ­¢éæåºçè§åå¦ä¸ï¼\n\n * å½ç¨åºæ§è¡å° volatile åéçè¯»æä½æèåæä½æ¶ï¼å¨å¶åé¢çæä½çæ´æ¹è¯å®å¨é¨å·²ç»è¿è¡ï¼ä¸ç»æå·²ç»å¯¹åé¢çæä½å¯è§ï¼å¨å¶åé¢çæä½è¯å®è¿æ²¡æè¿è¡ï¼\n * å¨è¿è¡æä»¤ä¼åæ¶ï¼ä¸è½å°å¨å¯¹ volatile åéè®¿é®çè¯­å¥æ¾å¨å¶åé¢æ§è¡ï¼ä¹ä¸è½æ volatile åéåé¢çè¯­å¥æ¾å°å¶åé¢æ§è¡ã\n\næ®éçåéä»ä»ä¼ä¿è¯è¯¥æ¹æ³çæ§è¡è¿ç¨ä¸­ææä¾èµèµå¼ç»æçå°æ¹é½è½è·åå°æ­£ç¡®çç»æï¼èä¸è½ä¿è¯èµå¼æä½çé¡ºåºä¸ç¨åºä»£ç ä¸­çæ§è¡é¡ºåºä¸è´ã\n\nä¸¾ä¸ªä¾å­ï¼\n\nvolatile boolean initialized = false;\n\n// ä¸é¢ä»£ç çº¿ç¨aä¸­æ§è¡\n// è¯»åéç½®ä¿¡æ¯ï¼å½è¯»åå®æåå°initializedè®¾ç½®ä¸ºtrueä»¥éç¥å¶ä»çº¿ç¨éç½®å¯ç¨\ndosomethingreadconfg();\ninitialized = true;\n\n// ä¸é¢ä»£ç çº¿ç¨bä¸­æ§è¡\n// ç­å¾initialized ä¸ºtrueï¼ä»£è¡¨çº¿ç¨aå·²ç»æéç½®ä¿¡æ¯åå§åå®æ\nwhile (!initialized) {\n     sleep();\n}\n// ä½¿ç¨çº¿ç¨aåå§åå¥½çéç½®ä¿¡æ¯\ndosomethingwithconfig();\nå¤å¶ä»£ç \n\n\nä¸é¢ä»£ç ä¸­å¦æå®ä¹ initialized åéæ¶æ²¡æä½¿ç¨ volatile ä¿®é¥°ï¼å°±æå¯è½ä¼ç±äºæä»¤éæåºçä¼åï¼å¯¼è´çº¿ç¨ a ä¸­æåä¸å¥ä»£ç  "initialized = true" å¨ âdosomethingreadconfg()â ä¹åè¢«æ§è¡ï¼è¿æ ·ä¼å¯¼è´çº¿ç¨ b ä¸­ä½¿ç¨éç½®ä¿¡æ¯çä»£ç å°±å¯è½åºç°éè¯¯ï¼è volatile å³é®å­å°±ç¦æ­¢éæåºçè¯­ä¹å¯ä»¥é¿åæ­¤ç±»æåµåçã\n\n# volatile çåç\n\nå·ä½å®ç°æ¹å¼æ¯å¨ç¼è¯æçæå­èç æ¶ï¼ä¼å¨æä»¤åºåä¸­å¢å åå­å±éæ¥ä¿è¯ï¼ä¸é¢æ¯åºäºä¿å®ç­ç¥ç jmm åå­å±éæå¥ç­ç¥ï¼\n\n * å¨æ¯ä¸ª volatile åæä½çåé¢æå¥ä¸ä¸ª storestore å±éã è¯¥å±éé¤äºä¿è¯äºå±éä¹åçåæä½åè¯¥å±éä¹åçåæä½ä¸è½éæåºï¼è¿ä¼ä¿è¯äº volatile åæä½ä¹åï¼ä»»ä½çè¯»åæä½é½ä¼åäº volatile è¢«æäº¤ã\n * å¨æ¯ä¸ª volatile åæä½çåé¢æå¥ä¸ä¸ª storeload å±éã è¯¥å±éé¤äºä½¿ volatile åæä½ä¸ä¼ä¸ä¹åçè¯»æä½éæåºå¤ï¼è¿ä¼å·æ°å¤çå¨ç¼å­ï¼ä½¿ volatile åéçåæ´æ°å¯¹å¶ä»çº¿ç¨å¯è§ã\n * å¨æ¯ä¸ª volatile è¯»æä½çåé¢æå¥ä¸ä¸ª loadload å±éã è¯¥å±éé¤äºä½¿ volatile è¯»æä½ä¸ä¼ä¸ä¹åçåæä½åçéæåºå¤ï¼è¿ä¼å·æ°å¤çå¨ç¼å­ï¼ä½¿ volatile åéè¯»åçä¸ºææ°å¼ã\n * å¨æ¯ä¸ª volatile è¯»æä½çåé¢æå¥ä¸ä¸ª loadstore å±éã è¯¥å±éé¤äºç¦æ­¢äº volatile è¯»æä½ä¸å¶ä¹åçä»»ä½åæä½è¿è¡éæåºï¼è¿ä¼å·æ°å¤çå¨ç¼å­ï¼ä½¿å¶ä»çº¿ç¨ volatile åéçåæ´æ°å¯¹ volatile è¯»æä½ççº¿ç¨å¯è§ã\n\n# volatile çä½¿ç¨åºæ¯\n\næ»ç»èµ·æ¥ï¼å°±æ¯âä¸æ¬¡åå¥ï¼å°å¤è¯»åâï¼æä¸çº¿ç¨è´è´£æ´æ°åéï¼å¶ä»çº¿ç¨åªè¯»ååé(ä¸æ´æ°åé)ï¼å¹¶æ ¹æ®åéçæ°å¼æ§è¡ç¸åºé»è¾ãä¾å¦ç¶ææ å¿ä½æ´æ°ï¼è§å¯èæ¨¡ååéå¼åå¸ã\n\n\n# synchronized\n\n\n# long å double åéçç¹æ®è§å\n\njmm è¦æ± lockãunlockãreadãloadãassignãuseãstoreãwrite è¿ 8 ç§æä½é½å·æåå­æ§ï¼ä½æ¯å¯¹äº 64 ä½çæ°æ®ç±»åï¼long å doubleï¼ï¼å¨æ¨¡åä¸­ç¹å«å®ä¹ç¸å¯¹å®½æ¾çè§å®ï¼åè®¸èææºå°æ²¡æè¢« volatile ä¿®é¥°ç 64 ä½æ°æ®çè¯»åæä½åä¸º 2 æ¬¡ 32 ä½çæä½æ¥è¿è¡ï¼å³åè®¸èææºå¯éæ©ä¸ä¿è¯ 64 ä½æ°æ®ç±»åç loadãstoreãread å write è¿ 4 ä¸ªæä½çåå­æ§ãç±äºè¿ç§éåå­æ§ï¼æå¯è½å¯¼è´å¶ä»çº¿ç¨è¯»å°åæ­¥æªå®æçâ32 ä½çåä¸ªåéâçå¼ã\n\nä¸è¿å®éå¼åä¸­ï¼java åå­æ¨¡åå¼ºçå»ºè®®èææºæ 64 ä½æ°æ®çè¯»åå®ç°ä¸ºå·æåå­æ§ï¼ç®ååç§å¹³å°ä¸çåç¨èææºé½éæ©æ 64 ä½æ°æ®çè¯»åæä½ä½ä¸ºåå­æä½æ¥å¯¹å¾ï¼å æ­¤æä»¬å¨ç¼åä»£ç æ¶ä¸è¬ä¸éè¦æç¨å°ç long å double åéä¸é¨å£°æä¸º volatileã\n\n\n# final åéçç¹æ®è§å\n\næä»¬ç¥éï¼final æååéå¿é¡»å¨å£°æçæ¶ååå§åæèå¨æé å¨ä¸­åå§åï¼å¦åå°±ä¼æ¥ç¼è¯éè¯¯ã final å³é®å­çå¯è§æ§æ¯æï¼è¢« final ä¿®é¥°çå­æ®µå¨å£°ææ¶æèæé å¨ä¸­ï¼ä¸æ¦åå§åå®æï¼é£ä¹å¨å¶ä»çº¿ç¨æ é¡»åæ­¥å°±è½æ­£ç¡®çè§ final å­æ®µçå¼ãè¿æ¯å ä¸ºä¸æ¦åå§åå®æï¼final åéçå¼ç«å»ååå°ä¸»åå­ã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ java èææºã\n * çè§£ java åå­æ¨¡å\n * ãjava å¹¶åç¼ç¨å®æã',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Javaå¹¶åå·¥å·ç±»",frontmatter:{title:"Javaå¹¶åå·¥å·ç±»",date:"2019-12-24T23:52:25.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å"],permalink:"/pages/02d274/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/08.Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/08.Javaå¹¶åå·¥å·ç±».md",key:"v-69f9625e",path:"/pages/02d274/",headers:[{level:2,title:"CountDownLatch",slug:"countdownlatch",normalizedTitle:"countdownlatch",charIndex:75},{level:2,title:"CyclicBarrier",slug:"cyclicbarrier",normalizedTitle:"cyclicbarrier",charIndex:1891},{level:2,title:"Semaphore",slug:"semaphore",normalizedTitle:"semaphore",charIndex:4270},{level:2,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:6049},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6317}],headersStr:"CountDownLatch CyclicBarrier Semaphore æ»ç» åèèµæ",content:'# Java å¹¶åå·¥å·ç±»\n\n> JDK ç java.util.concurrent åï¼å³ J.U.Cï¼ä¸­æä¾äºå ä¸ªéå¸¸æç¨çå¹¶åå·¥å·ç±»ã\n\n\n# CountDownLatch\n\n> å­é¢ææä¸º éåè®¡æ°éãç¨äºæ§å¶ä¸ä¸ªçº¿ç¨ç­å¾å¤ä¸ªçº¿ç¨ã\n> \n> CountDownLatch ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countï¼è¡¨ç¤ºéè¦ç­å¾çäºä»¶æ°éãcountDown æ¹æ³éåè®¡æ°å¨ï¼è¡¨ç¤ºæä¸ä¸ªäºä»¶å·²ç»åçãè°ç¨ await æ¹æ³ççº¿ç¨ä¼ä¸ç´é»å¡ç´å°è®¡æ°å¨ä¸ºé¶ï¼æèç­å¾ä¸­ççº¿ç¨ä¸­æ­ï¼æèç­å¾è¶æ¶ã\n\n\n\nCountDownLatch æ¯åºäº AQS(AbstractQueuedSynchronizer) å®ç°çã\n\nCountDownLatch å¯ä¸çæé æ¹æ³ï¼\n\n// åå§åè®¡æ°å¨\npublic CountDownLatch(int count) {};\n\n\nè¯´æï¼\n\n * count ä¸ºç»è®¡å¼ã\n\nCountDownLatch çéè¦æ¹æ³ï¼\n\npublic void await() throws InterruptedException { };\npublic boolean await(long timeout, TimeUnit unit) throws InterruptedException { };\npublic void countDown() { };\n\n\nè¯´æï¼\n\n * await() - è°ç¨ await() æ¹æ³ççº¿ç¨ä¼è¢«æèµ·ï¼å®ä¼ç­å¾ç´å° count å¼ä¸º 0 æç»§ç»­æ§è¡ã\n * await(long timeout, TimeUnit unit) - å await() ç±»ä¼¼ï¼åªä¸è¿ç­å¾ä¸å®çæ¶é´å count å¼è¿æ²¡åä¸º 0 çè¯å°±ä¼ç»§ç»­æ§è¡\n * countDown() - å°ç»è®¡å¼ count å 1\n\nç¤ºä¾ï¼\n\npublic class CountDownLatchDemo {\n\n    public static void main(String[] args) {\n        final CountDownLatch latch = new CountDownLatch(2);\n\n        new Thread(new MyThread(latch)).start();\n        new Thread(new MyThread(latch)).start();\n\n        try {\n            System.out.println("ç­å¾2ä¸ªå­çº¿ç¨æ§è¡å®æ¯...");\n            latch.await();\n            System.out.println("2ä¸ªå­çº¿ç¨å·²ç»æ§è¡å®æ¯");\n            System.out.println("ç»§ç»­æ§è¡ä¸»çº¿ç¨");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    static class MyThread implements Runnable {\n\n        private CountDownLatch latch;\n\n        public MyThread(CountDownLatch latch) {\n            this.latch = latch;\n        }\n\n        @Override\n        public void run() {\n            System.out.println("å­çº¿ç¨" + Thread.currentThread().getName() + "æ­£å¨æ§è¡");\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("å­çº¿ç¨" + Thread.currentThread().getName() + "æ§è¡å®æ¯");\n            latch.countDown();\n        }\n\n    }\n\n}\n\n\n\n# CyclicBarrier\n\n> å­é¢æææ¯ å¾ªç¯æ æ ãCyclicBarrier å¯ä»¥è®©ä¸ç»çº¿ç¨ç­å¾è³æä¸ªç¶æï¼éµå¾ªå­é¢ææï¼ä¸å¦¨ç§°è¿ä¸ªç¶æä¸ºæ æ ï¼ä¹ååå¨é¨åæ¶æ§è¡ãä¹æä»¥å«å¾ªç¯æ æ æ¯å ä¸ºï¼å½ææç­å¾çº¿ç¨é½è¢«éæ¾ä»¥åï¼CyclicBarrier å¯ä»¥è¢«éç¨ã\n> \n> CyclicBarrier ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countãæ¯æ¬¡æ§è¡ await æ¹æ³ä¹åï¼count å  1ï¼ç´å°è®¡æ°å¨çå¼åè®¾ç½®çå¼ç¸ç­ï¼ç­å¾çææçº¿ç¨æä¼ç»§ç»­æ§è¡ã\n\nCyclicBarrier æ¯åºäº ReentrantLock å Condition å®ç°çã\n\nCyclicBarrier åºç¨åºæ¯ï¼CyclicBarrier å¨å¹¶è¡è¿­ä»£ç®æ³ä¸­éå¸¸æç¨ã\n\n\n\nCyclicBarrier æä¾äº 2 ä¸ªæé æ¹æ³\n\npublic CyclicBarrier(int parties) {}\npublic CyclicBarrier(int parties, Runnable barrierAction) {}\n\n\n> è¯´æï¼\n> \n>  * parties - parties æ°ç¸å½äºä¸ä¸ªéå¼ï¼å½æ parties æ°éççº¿ç¨å¨ç­å¾æ¶ï¼ CyclicBarrier å¤äºæ æ ç¶æã\n>  * barrierAction - å½ CyclicBarrier å¤äºæ æ ç¶ææ¶æ§è¡çå¨ä½ã\n\nCyclicBarrier çéè¦æ¹æ³ï¼\n\npublic int await() throws InterruptedException, BrokenBarrierException {}\npublic int await(long timeout, TimeUnit unit)\n        throws InterruptedException,\n               BrokenBarrierException,\n               TimeoutException {}\n// å°å±ééç½®ä¸ºåå§ç¶æ\npublic void reset() {}\n\n\n> è¯´æï¼\n> \n>  * await() - ç­å¾è°ç¨ await() ççº¿ç¨æ°è¾¾å°å±éæ°ãå¦æå½åçº¿ç¨æ¯æåä¸ä¸ªå°è¾¾ççº¿ç¨ï¼å¹¶ä¸å¨æé å½æ°ä¸­æä¾äºéç©ºå±éæä½ï¼åå½åçº¿ç¨å¨åè®¸å¶ä»çº¿ç¨ç»§ç»­ä¹åè¿è¡è¯¥æä½ãå¦æå¨å±éå¨ä½æé´åçå¼å¸¸ï¼é£ä¹è¯¥å¼å¸¸å°å¨å½åçº¿ç¨ä¸­ä¼ æ­å¹¶ä¸å±éè¢«ç½®äºæ­å¼ç¶æã\n>  * await(long timeout, TimeUnit unit) - ç¸æ¯äº await() æ¹æ³ï¼è¿ä¸ªæ¹æ³è®©è¿äºçº¿ç¨ç­å¾è³ä¸å®çæ¶é´ï¼å¦æè¿æçº¿ç¨æ²¡æå°è¾¾æ æ ç¶æå°±ç´æ¥è®©å°è¾¾æ æ ç¶æççº¿ç¨æ§è¡åç»­ä»»å¡ã\n>  * reset() - å°å±ééç½®ä¸ºåå§ç¶æã\n\nç¤ºä¾ï¼\n\npublic class CyclicBarrierDemo {\n\n    final static int N = 4;\n\n    public static void main(String[] args) {\n        CyclicBarrier barrier = new CyclicBarrier(N,\n            new Runnable() {\n                @Override\n                public void run() {\n                    System.out.println("å½åçº¿ç¨" + Thread.currentThread().getName());\n                }\n            });\n\n        for (int i = 0; i < N; i++) {\n            MyThread myThread = new MyThread(barrier);\n            new Thread(myThread).start();\n        }\n    }\n\n    static class MyThread implements Runnable {\n\n        private CyclicBarrier cyclicBarrier;\n\n        MyThread(CyclicBarrier cyclicBarrier) {\n            this.cyclicBarrier = cyclicBarrier;\n        }\n\n        @Override\n        public void run() {\n            System.out.println("çº¿ç¨" + Thread.currentThread().getName() + "æ­£å¨åå¥æ°æ®...");\n            try {\n                Thread.sleep(3000); // ä»¥ç¡ç æ¥æ¨¡æåå¥æ°æ®æä½\n                System.out.println("çº¿ç¨" + Thread.currentThread().getName() + "åå¥æ°æ®å®æ¯ï¼ç­å¾å¶ä»çº¿ç¨åå¥å®æ¯");\n                cyclicBarrier.await();\n            } catch (InterruptedException | BrokenBarrierException e) {\n                e.printStackTrace();\n            }\n        }\n\n    }\n\n}\n\n\n\n# Semaphore\n\n> å­é¢ææä¸º ä¿¡å·éãSemaphore ç¨æ¥æ§å¶ææ®µä»£ç åçå¹¶åæ°ã\n> \n> Semaphore ç®¡ççä¸ç»èæçè®¸å¯ï¼permitï¼ï¼permit çåå§æ°éå¯éè¿æé æ¹æ³æ¥æå®ãæ¯æ¬¡æ§è¡ acquire æ¹æ³å¯ä»¥è·åä¸ä¸ª permitï¼å¦ææ²¡æå°±ç­å¾ï¼è release æ¹æ³å¯ä»¥éæ¾ä¸ä¸ª permitã\n\nSemaphore åºç¨åºæ¯ï¼\n\n * Semaphore å¯ä»¥ç¨äºå®ç°èµæºæ± ï¼å¦æ°æ®åºè¿æ¥æ± ã\n * Semaphore å¯ä»¥ç¨äºå°ä»»ä½ä¸ç§å®¹å¨åææçé»å¡å®¹å¨ã\n\n\n\nSemaphore æä¾äº 2 ä¸ªæé æ¹æ³ï¼\n\n// åæ° permits è¡¨ç¤ºè®¸å¯æ°ç®ï¼å³åæ¶å¯ä»¥åè®¸å¤å°çº¿ç¨è¿è¡è®¿é®\npublic Semaphore(int permits) {}\n// åæ° fair è¡¨ç¤ºæ¯å¦æ¯å¬å¹³çï¼å³ç­å¾æ¶é´è¶ä¹çè¶åè·åè®¸å¯\npublic Semaphore(int permits, boolean fair) {}\n\n\n> è¯´æï¼\n> \n>  * permits - åå§ååºå®æ°éç permitï¼å¹¶ä¸é»è®¤ä¸ºéå¬å¹³æ¨¡å¼ã\n>  * fair - è®¾ç½®æ¯å¦ä¸ºå¬å¹³æ¨¡å¼ãæè°å¬å¹³ï¼æ¯æç­å¾ä¹çä¼åè·å permitã\n\nSemaphoreçéè¦æ¹æ³ï¼\n\n// è·å 1 ä¸ªè®¸å¯\npublic void acquire() throws InterruptedException {}\n//è·å permits ä¸ªè®¸å¯\npublic void acquire(int permits) throws InterruptedException {}\n// éæ¾ 1 ä¸ªè®¸å¯\npublic void release() {}\n//éæ¾ permits ä¸ªè®¸å¯\npublic void release(int permits) {}\n\n\nè¯´æï¼\n\n * acquire() - è·å 1 ä¸ª permitã\n * acquire(int permits) - è·å permits æ°éç permitã\n * release() - éæ¾ 1 ä¸ª permitã\n * release(int permits) - éæ¾ permits æ°éç permitã\n\nç¤ºä¾ï¼\n\npublic class SemaphoreDemo {\n\n    private static final int THREAD_COUNT = 30;\n\n    private static ExecutorService threadPool = Executors.newFixedThreadPool(THREAD_COUNT);\n\n    private static Semaphore semaphore = new Semaphore(10);\n\n    public static void main(String[] args) {\n        for (int i = 0; i < THREAD_COUNT; i++) {\n            threadPool.execute(new Runnable() {\n                @Override\n                public void run() {\n                    try {\n                        semaphore.acquire();\n                        System.out.println("save data");\n                        semaphore.release();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            });\n        }\n\n        threadPool.shutdown();\n    }\n\n}\n\n\n\n# æ»ç»\n\n * CountDownLatch å CyclicBarrier é½è½å¤å®ç°çº¿ç¨ä¹é´çç­å¾ï¼åªä¸è¿å®ä»¬ä¾§éç¹ä¸åï¼\n   * CountDownLatch ä¸è¬ç¨äºæä¸ªçº¿ç¨ A ç­å¾è¥å¹²ä¸ªå¶ä»çº¿ç¨æ§è¡å®ä»»å¡ä¹åï¼å®ææ§è¡ï¼\n   * CyclicBarrier ä¸è¬ç¨äºä¸ç»çº¿ç¨äºç¸ç­å¾è³æä¸ªç¶æï¼ç¶åè¿ä¸ç»çº¿ç¨ååæ¶æ§è¡ï¼\n   * å¦å¤ï¼CountDownLatch æ¯ä¸å¯ä»¥éç¨çï¼è CyclicBarrier æ¯å¯ä»¥éç¨çã\n * Semaphore å¶å®åéæç¹ç±»ä¼¼ï¼å®ä¸è¬ç¨äºæ§å¶å¯¹æç»èµæºçè®¿é®æéã\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * Java å¹¶åç¼ç¨ï¼CountDownLatchãCyclicBarrier å Semaphore',normalizedContent:'# java å¹¶åå·¥å·ç±»\n\n> jdk ç java.util.concurrent åï¼å³ j.u.cï¼ä¸­æä¾äºå ä¸ªéå¸¸æç¨çå¹¶åå·¥å·ç±»ã\n\n\n# countdownlatch\n\n> å­é¢ææä¸º éåè®¡æ°éãç¨äºæ§å¶ä¸ä¸ªçº¿ç¨ç­å¾å¤ä¸ªçº¿ç¨ã\n> \n> countdownlatch ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countï¼è¡¨ç¤ºéè¦ç­å¾çäºä»¶æ°éãcountdown æ¹æ³éåè®¡æ°å¨ï¼è¡¨ç¤ºæä¸ä¸ªäºä»¶å·²ç»åçãè°ç¨ await æ¹æ³ççº¿ç¨ä¼ä¸ç´é»å¡ç´å°è®¡æ°å¨ä¸ºé¶ï¼æèç­å¾ä¸­ççº¿ç¨ä¸­æ­ï¼æèç­å¾è¶æ¶ã\n\n\n\ncountdownlatch æ¯åºäº aqs(abstractqueuedsynchronizer) å®ç°çã\n\ncountdownlatch å¯ä¸çæé æ¹æ³ï¼\n\n// åå§åè®¡æ°å¨\npublic countdownlatch(int count) {};\n\n\nè¯´æï¼\n\n * count ä¸ºç»è®¡å¼ã\n\ncountdownlatch çéè¦æ¹æ³ï¼\n\npublic void await() throws interruptedexception { };\npublic boolean await(long timeout, timeunit unit) throws interruptedexception { };\npublic void countdown() { };\n\n\nè¯´æï¼\n\n * await() - è°ç¨ await() æ¹æ³ççº¿ç¨ä¼è¢«æèµ·ï¼å®ä¼ç­å¾ç´å° count å¼ä¸º 0 æç»§ç»­æ§è¡ã\n * await(long timeout, timeunit unit) - å await() ç±»ä¼¼ï¼åªä¸è¿ç­å¾ä¸å®çæ¶é´å count å¼è¿æ²¡åä¸º 0 çè¯å°±ä¼ç»§ç»­æ§è¡\n * countdown() - å°ç»è®¡å¼ count å 1\n\nç¤ºä¾ï¼\n\npublic class countdownlatchdemo {\n\n    public static void main(string[] args) {\n        final countdownlatch latch = new countdownlatch(2);\n\n        new thread(new mythread(latch)).start();\n        new thread(new mythread(latch)).start();\n\n        try {\n            system.out.println("ç­å¾2ä¸ªå­çº¿ç¨æ§è¡å®æ¯...");\n            latch.await();\n            system.out.println("2ä¸ªå­çº¿ç¨å·²ç»æ§è¡å®æ¯");\n            system.out.println("ç»§ç»­æ§è¡ä¸»çº¿ç¨");\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n    }\n\n    static class mythread implements runnable {\n\n        private countdownlatch latch;\n\n        public mythread(countdownlatch latch) {\n            this.latch = latch;\n        }\n\n        @override\n        public void run() {\n            system.out.println("å­çº¿ç¨" + thread.currentthread().getname() + "æ­£å¨æ§è¡");\n            try {\n                thread.sleep(1000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("å­çº¿ç¨" + thread.currentthread().getname() + "æ§è¡å®æ¯");\n            latch.countdown();\n        }\n\n    }\n\n}\n\n\n\n# cyclicbarrier\n\n> å­é¢æææ¯ å¾ªç¯æ æ ãcyclicbarrier å¯ä»¥è®©ä¸ç»çº¿ç¨ç­å¾è³æä¸ªç¶æï¼éµå¾ªå­é¢ææï¼ä¸å¦¨ç§°è¿ä¸ªç¶æä¸ºæ æ ï¼ä¹ååå¨é¨åæ¶æ§è¡ãä¹æä»¥å«å¾ªç¯æ æ æ¯å ä¸ºï¼å½ææç­å¾çº¿ç¨é½è¢«éæ¾ä»¥åï¼cyclicbarrier å¯ä»¥è¢«éç¨ã\n> \n> cyclicbarrier ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countãæ¯æ¬¡æ§è¡ await æ¹æ³ä¹åï¼count å  1ï¼ç´å°è®¡æ°å¨çå¼åè®¾ç½®çå¼ç¸ç­ï¼ç­å¾çææçº¿ç¨æä¼ç»§ç»­æ§è¡ã\n\ncyclicbarrier æ¯åºäº reentrantlock å condition å®ç°çã\n\ncyclicbarrier åºç¨åºæ¯ï¼cyclicbarrier å¨å¹¶è¡è¿­ä»£ç®æ³ä¸­éå¸¸æç¨ã\n\n\n\ncyclicbarrier æä¾äº 2 ä¸ªæé æ¹æ³\n\npublic cyclicbarrier(int parties) {}\npublic cyclicbarrier(int parties, runnable barrieraction) {}\n\n\n> è¯´æï¼\n> \n>  * parties - parties æ°ç¸å½äºä¸ä¸ªéå¼ï¼å½æ parties æ°éççº¿ç¨å¨ç­å¾æ¶ï¼ cyclicbarrier å¤äºæ æ ç¶æã\n>  * barrieraction - å½ cyclicbarrier å¤äºæ æ ç¶ææ¶æ§è¡çå¨ä½ã\n\ncyclicbarrier çéè¦æ¹æ³ï¼\n\npublic int await() throws interruptedexception, brokenbarrierexception {}\npublic int await(long timeout, timeunit unit)\n        throws interruptedexception,\n               brokenbarrierexception,\n               timeoutexception {}\n// å°å±ééç½®ä¸ºåå§ç¶æ\npublic void reset() {}\n\n\n> è¯´æï¼\n> \n>  * await() - ç­å¾è°ç¨ await() ççº¿ç¨æ°è¾¾å°å±éæ°ãå¦æå½åçº¿ç¨æ¯æåä¸ä¸ªå°è¾¾ççº¿ç¨ï¼å¹¶ä¸å¨æé å½æ°ä¸­æä¾äºéç©ºå±éæä½ï¼åå½åçº¿ç¨å¨åè®¸å¶ä»çº¿ç¨ç»§ç»­ä¹åè¿è¡è¯¥æä½ãå¦æå¨å±éå¨ä½æé´åçå¼å¸¸ï¼é£ä¹è¯¥å¼å¸¸å°å¨å½åçº¿ç¨ä¸­ä¼ æ­å¹¶ä¸å±éè¢«ç½®äºæ­å¼ç¶æã\n>  * await(long timeout, timeunit unit) - ç¸æ¯äº await() æ¹æ³ï¼è¿ä¸ªæ¹æ³è®©è¿äºçº¿ç¨ç­å¾è³ä¸å®çæ¶é´ï¼å¦æè¿æçº¿ç¨æ²¡æå°è¾¾æ æ ç¶æå°±ç´æ¥è®©å°è¾¾æ æ ç¶æççº¿ç¨æ§è¡åç»­ä»»å¡ã\n>  * reset() - å°å±ééç½®ä¸ºåå§ç¶æã\n\nç¤ºä¾ï¼\n\npublic class cyclicbarrierdemo {\n\n    final static int n = 4;\n\n    public static void main(string[] args) {\n        cyclicbarrier barrier = new cyclicbarrier(n,\n            new runnable() {\n                @override\n                public void run() {\n                    system.out.println("å½åçº¿ç¨" + thread.currentthread().getname());\n                }\n            });\n\n        for (int i = 0; i < n; i++) {\n            mythread mythread = new mythread(barrier);\n            new thread(mythread).start();\n        }\n    }\n\n    static class mythread implements runnable {\n\n        private cyclicbarrier cyclicbarrier;\n\n        mythread(cyclicbarrier cyclicbarrier) {\n            this.cyclicbarrier = cyclicbarrier;\n        }\n\n        @override\n        public void run() {\n            system.out.println("çº¿ç¨" + thread.currentthread().getname() + "æ­£å¨åå¥æ°æ®...");\n            try {\n                thread.sleep(3000); // ä»¥ç¡ç æ¥æ¨¡æåå¥æ°æ®æä½\n                system.out.println("çº¿ç¨" + thread.currentthread().getname() + "åå¥æ°æ®å®æ¯ï¼ç­å¾å¶ä»çº¿ç¨åå¥å®æ¯");\n                cyclicbarrier.await();\n            } catch (interruptedexception | brokenbarrierexception e) {\n                e.printstacktrace();\n            }\n        }\n\n    }\n\n}\n\n\n\n# semaphore\n\n> å­é¢ææä¸º ä¿¡å·éãsemaphore ç¨æ¥æ§å¶ææ®µä»£ç åçå¹¶åæ°ã\n> \n> semaphore ç®¡ççä¸ç»èæçè®¸å¯ï¼permitï¼ï¼permit çåå§æ°éå¯éè¿æé æ¹æ³æ¥æå®ãæ¯æ¬¡æ§è¡ acquire æ¹æ³å¯ä»¥è·åä¸ä¸ª permitï¼å¦ææ²¡æå°±ç­å¾ï¼è release æ¹æ³å¯ä»¥éæ¾ä¸ä¸ª permitã\n\nsemaphore åºç¨åºæ¯ï¼\n\n * semaphore å¯ä»¥ç¨äºå®ç°èµæºæ± ï¼å¦æ°æ®åºè¿æ¥æ± ã\n * semaphore å¯ä»¥ç¨äºå°ä»»ä½ä¸ç§å®¹å¨åææçé»å¡å®¹å¨ã\n\n\n\nsemaphore æä¾äº 2 ä¸ªæé æ¹æ³ï¼\n\n// åæ° permits è¡¨ç¤ºè®¸å¯æ°ç®ï¼å³åæ¶å¯ä»¥åè®¸å¤å°çº¿ç¨è¿è¡è®¿é®\npublic semaphore(int permits) {}\n// åæ° fair è¡¨ç¤ºæ¯å¦æ¯å¬å¹³çï¼å³ç­å¾æ¶é´è¶ä¹çè¶åè·åè®¸å¯\npublic semaphore(int permits, boolean fair) {}\n\n\n> è¯´æï¼\n> \n>  * permits - åå§ååºå®æ°éç permitï¼å¹¶ä¸é»è®¤ä¸ºéå¬å¹³æ¨¡å¼ã\n>  * fair - è®¾ç½®æ¯å¦ä¸ºå¬å¹³æ¨¡å¼ãæè°å¬å¹³ï¼æ¯æç­å¾ä¹çä¼åè·å permitã\n\nsemaphoreçéè¦æ¹æ³ï¼\n\n// è·å 1 ä¸ªè®¸å¯\npublic void acquire() throws interruptedexception {}\n//è·å permits ä¸ªè®¸å¯\npublic void acquire(int permits) throws interruptedexception {}\n// éæ¾ 1 ä¸ªè®¸å¯\npublic void release() {}\n//éæ¾ permits ä¸ªè®¸å¯\npublic void release(int permits) {}\n\n\nè¯´æï¼\n\n * acquire() - è·å 1 ä¸ª permitã\n * acquire(int permits) - è·å permits æ°éç permitã\n * release() - éæ¾ 1 ä¸ª permitã\n * release(int permits) - éæ¾ permits æ°éç permitã\n\nç¤ºä¾ï¼\n\npublic class semaphoredemo {\n\n    private static final int thread_count = 30;\n\n    private static executorservice threadpool = executors.newfixedthreadpool(thread_count);\n\n    private static semaphore semaphore = new semaphore(10);\n\n    public static void main(string[] args) {\n        for (int i = 0; i < thread_count; i++) {\n            threadpool.execute(new runnable() {\n                @override\n                public void run() {\n                    try {\n                        semaphore.acquire();\n                        system.out.println("save data");\n                        semaphore.release();\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                }\n            });\n        }\n\n        threadpool.shutdown();\n    }\n\n}\n\n\n\n# æ»ç»\n\n * countdownlatch å cyclicbarrier é½è½å¤å®ç°çº¿ç¨ä¹é´çç­å¾ï¼åªä¸è¿å®ä»¬ä¾§éç¹ä¸åï¼\n   * countdownlatch ä¸è¬ç¨äºæä¸ªçº¿ç¨ a ç­å¾è¥å¹²ä¸ªå¶ä»çº¿ç¨æ§è¡å®ä»»å¡ä¹åï¼å®ææ§è¡ï¼\n   * cyclicbarrier ä¸è¬ç¨äºä¸ç»çº¿ç¨äºç¸ç­å¾è³æä¸ªç¶æï¼ç¶åè¿ä¸ç»çº¿ç¨ååæ¶æ§è¡ï¼\n   * å¦å¤ï¼countdownlatch æ¯ä¸å¯ä»¥éç¨çï¼è cyclicbarrier æ¯å¯ä»¥éç¨çã\n * semaphore å¶å®åéæç¹ç±»ä¼¼ï¼å®ä¸è¬ç¨äºæ§å¶å¯¹æç»èµæºçè®¿é®æéã\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * java å¹¶åç¼ç¨ï¼countdownlatchãcyclicbarrier å semaphore',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"ForkJoinæ¡æ¶",frontmatter:{title:"ForkJoinæ¡æ¶",date:"2020-07-14T15:27:46.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å"],permalink:"/pages/edd121/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/10.ForkJoin%E6%A1%86%E6%9E%B6.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/10.ForkJoinæ¡æ¶.md",key:"v-cd87896e",path:"/pages/edd121/",headers:[{level:2,title:"CompletableFuture",slug:"completablefuture",normalizedTitle:"completablefuture",charIndex:93},{level:3,title:"runAsync å supplyAsync æ¹æ³",slug:"runasync-å-supplyasync-æ¹æ³",normalizedTitle:"runasync å supplyasync æ¹æ³",charIndex:179},{level:2,title:"CompletionStage",slug:"completionstage",normalizedTitle:"completionstage",charIndex:707},{level:3,title:"ä¸²è¡å³ç³»",slug:"ä¸²è¡å³ç³»",normalizedTitle:"ä¸²è¡å³ç³»",charIndex:760},{level:3,title:"æè¿° AND æ±èå³ç³»",slug:"æè¿°-and-æ±èå³ç³»",normalizedTitle:"æè¿° and æ±èå³ç³»",charIndex:1397},{level:3,title:"æè¿° OR æ±èå³ç³»",slug:"æè¿°-or-æ±èå³ç³»",normalizedTitle:"æè¿° or æ±èå³ç³»",charIndex:1855},{level:3,title:"å¼å¸¸å¤ç",slug:"å¼å¸¸å¤ç",normalizedTitle:"å¼å¸¸å¤ç",charIndex:2764},{level:2,title:"Fork/Join",slug:"fork-join",normalizedTitle:"fork/join",charIndex:3866},{level:3,title:"ForkJoinPool å·¥ä½åç",slug:"forkjoinpool-å·¥ä½åç",normalizedTitle:"forkjoinpool å·¥ä½åç",charIndex:4451},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5241}],headersStr:"CompletableFuture runAsync å supplyAsync æ¹æ³ CompletionStage ä¸²è¡å³ç³» æè¿° AND æ±èå³ç³» æè¿° OR æ±èå³ç³» å¼å¸¸å¤ç Fork/Join ForkJoinPool å·¥ä½åç åèèµæ",content:"# Java Fork Join æ¡æ¶\n\nå¯¹äºç®åçå¹¶è¡ä»»å¡ï¼ä½ å¯ä»¥éè¿âçº¿ç¨æ±  +Futureâçæ¹æ¡æ¥è§£å³ï¼å¦æä»»å¡ä¹é´æèåå³ç³»ï¼æ è®ºæ¯ AND èåè¿æ¯ OR èåï¼é½å¯ä»¥éè¿ CompletableFuture æ¥è§£å³ï¼èæ¹éçå¹¶è¡ä»»å¡ï¼åå¯ä»¥éè¿ CompletionService æ¥è§£å³ã\n\n\n# CompletableFuture\n\n\n# runAsync å supplyAsync æ¹æ³\n\nCompletableFuture æä¾äºåä¸ªéææ¹æ³æ¥åå»ºä¸ä¸ªå¼æ­¥æä½ã\n\npublic static CompletableFuture<Void> runAsync(Runnable runnable)\npublic static CompletableFuture<Void> runAsync(Runnable runnable, Executor executor)\npublic static <U> CompletableFuture<U> supplyAsync(Supplier<U> supplier)\npublic static <U> CompletableFuture<U> supplyAsync(Supplier<U> supplier, Executor executor)\n\n\næ²¡ææå® Executor çæ¹æ³ä¼ä½¿ç¨ ForkJoinPool.commonPool() ä½ä¸ºå®ççº¿ç¨æ± æ§è¡å¼æ­¥ä»£ç ãå¦ææå®çº¿ç¨æ± ï¼åä½¿ç¨æå®ççº¿ç¨æ± è¿è¡ãä»¥ä¸ææçæ¹æ³é½ç±»åã\n\n * runAsync æ¹æ³ä¸æ¯æè¿åå¼ã\n * supplyAsync å¯ä»¥æ¯æè¿åå¼ã\n\n\n# CompletionStage\n\nCompletionStage æ¥å£å¯ä»¥æ¸æ°å°æè¿°ä»»å¡ä¹é´çæ¶åºå³ç³»ï¼å¦ä¸²è¡å³ç³»ãå¹¶è¡å³ç³»ãæ±èå³ç³»ç­ã\n\n\n# ä¸²è¡å³ç³»\n\nCompletionStage æ¥å£éé¢æè¿°ä¸²è¡å³ç³»ï¼ä¸»è¦æ¯ thenApplyãthenAcceptãthenRun å thenCompose è¿åä¸ªç³»åçæ¥å£ã\n\nthenApply ç³»åå½æ°éåæ° fn çç±»åæ¯æ¥å£ Function<T, R>ï¼è¿ä¸ªæ¥å£éä¸ CompletionStage ç¸å³çæ¹æ³æ¯ R apply(T t)ï¼è¿ä¸ªæ¹æ³æ¢è½æ¥æ¶åæ°ä¹æ¯æè¿åå¼ï¼æä»¥ thenApply ç³»åæ¹æ³è¿åçæ¯CompletionStageã\n\nè thenAccept ç³»åæ¹æ³éåæ° consumer çç±»åæ¯æ¥å£ Consumer<T>ï¼è¿ä¸ªæ¥å£éä¸ CompletionStage ç¸å³çæ¹æ³æ¯ void accept(T t)ï¼è¿ä¸ªæ¹æ³è½ç¶æ¯æåæ°ï¼ä½å´ä¸æ¯æåå¼ï¼æä»¥ thenAccept ç³»åæ¹æ³è¿åçæ¯CompletionStage<Void>ã\n\nthenRun ç³»åæ¹æ³é action çåæ°æ¯ Runnableï¼æä»¥ action æ¢ä¸è½æ¥æ¶åæ°ä¹ä¸æ¯æè¿åå¼ï¼æä»¥ thenRun ç³»åæ¹æ³è¿åçä¹æ¯CompletionStage<Void>ã\n\nè¿äºæ¹æ³éé¢ Async ä»£è¡¨çæ¯å¼æ­¥æ§è¡ fnãconsumer æè actionãå¶ä¸­ï¼éè¦ä½ æ³¨æçæ¯ thenCompose ç³»åæ¹æ³ï¼è¿ä¸ªç³»åçæ¹æ³ä¼æ°åå»ºåºä¸ä¸ªå­æµç¨ï¼æç»ç»æå thenApply ç³»åæ¯ç¸åçã\n\n\n# æè¿° AND æ±èå³ç³»\n\nCompletionStage æ¥å£éé¢æè¿° AND æ±èå³ç³»ï¼ä¸»è¦æ¯ thenCombineãthenAcceptBoth å runAfterBoth ç³»åçæ¥å£ï¼è¿äºæ¥å£çåºå«ä¹æ¯æºèª fnãconsumerãaction è¿ä¸ä¸ªæ ¸å¿åæ°ä¸åã\n\nCompletionStage<R> thenCombine(other, fn);\nCompletionStage<R> thenCombineAsync(other, fn);\nCompletionStage<Void> thenAcceptBoth(other, consumer);\nCompletionStage<Void> thenAcceptBothAsync(other, consumer);\nCompletionStage<Void> runAfterBoth(other, action);\nCompletionStage<Void> runAfterBothAsync(other, action);\n\n\n\n# æè¿° OR æ±èå³ç³»\n\nCompletionStage æ¥å£éé¢æè¿° OR æ±èå³ç³»ï¼ä¸»è¦æ¯ applyToEitherãacceptEither å runAfterEither ç³»åçæ¥å£ï¼è¿äºæ¥å£çåºå«ä¹æ¯æºèª fnãconsumerãaction è¿ä¸ä¸ªæ ¸å¿åæ°ä¸åã\n\nCompletionStage applyToEither(other, fn);\nCompletionStage applyToEitherAsync(other, fn);\nCompletionStage acceptEither(other, consumer);\nCompletionStage acceptEitherAsync(other, consumer);\nCompletionStage runAfterEither(other, action);\nCompletionStage runAfterEitherAsync(other, action);\n\n\nä¸é¢çç¤ºä¾ä»£ç å±ç¤ºäºå¦ä½ä½¿ç¨ applyToEither() æ¹æ³æ¥æè¿°ä¸ä¸ª OR æ±èå³ç³»ã\n\nCompletableFuture<String> f1 =\n  CompletableFuture.supplyAsync(()->{\n    int t = getRandom(5, 10);\n    sleep(t, TimeUnit.SECONDS);\n    return String.valueOf(t);\n});\n\nCompletableFuture<String> f2 =\n  CompletableFuture.supplyAsync(()->{\n    int t = getRandom(5, 10);\n    sleep(t, TimeUnit.SECONDS);\n    return String.valueOf(t);\n});\n\nCompletableFuture<String> f3 =\n  f1.applyToEither(f2,s -> s);\n\nSystem.out.println(f3.join());\n\n\n\n# å¼å¸¸å¤ç\n\nè½ç¶ä¸é¢æä»¬æå°ç fnãconsumerãaction å®ä»¬çæ ¸å¿æ¹æ³é½ä¸åè®¸æåºå¯æ£æ¥å¼å¸¸ï¼ä½æ¯å´æ æ³éå¶å®ä»¬æåºè¿è¡æ¶å¼å¸¸ï¼ä¾å¦ä¸é¢çä»£ç ï¼æ§è¡ 7/0 å°±ä¼åºç°é¤é¶éè¯¯è¿ä¸ªè¿è¡æ¶å¼å¸¸ãéå¼æ­¥ç¼ç¨éé¢ï¼æä»¬å¯ä»¥ä½¿ç¨ try{}catch{} æ¥æè·å¹¶å¤çå¼å¸¸ï¼é£å¨å¼æ­¥ç¼ç¨éé¢ï¼å¼å¸¸è¯¥å¦ä½å¤çå¢ï¼\n\nCompletableFuture<Integer>\n  f0 = CompletableFuture.\n    .supplyAsync(()->(7/0))\n    .thenApply(r->r*10);\nSystem.out.println(f0.join());\n\n\nCompletionStage æ¥å£ç»æä»¬æä¾çæ¹æ¡éå¸¸ç®åï¼æ¯ try{}catch{}è¿è¦ç®åï¼ä¸é¢æ¯ç¸å³çæ¹æ³ï¼ä½¿ç¨è¿äºæ¹æ³è¿è¡å¼å¸¸å¤çåä¸²è¡æä½æ¯ä¸æ ·çï¼é½æ¯æé¾å¼ç¼ç¨æ¹å¼ã\n\nCompletionStage exceptionally(fn);\nCompletionStage<R> whenComplete(consumer);\nCompletionStage<R> whenCompleteAsync(consumer);\nCompletionStage<R> handle(fn);\nCompletionStage<R> handleAsync(fn);\n\n\nä¸é¢çç¤ºä¾ä»£ç å±ç¤ºäºå¦ä½ä½¿ç¨ exceptionally() æ¹æ³æ¥å¤çå¼å¸¸ï¼exceptionally() çä½¿ç¨éå¸¸ç±»ä¼¼äº try{}catch{}ä¸­ç catch{}ï¼ä½æ¯ç±äºæ¯æé¾å¼ç¼ç¨æ¹å¼ï¼æä»¥ç¸å¯¹æ´ç®åãæ¢ç¶æ try{}catch{}ï¼é£å°±ä¸å®è¿æ try{}finally{}ï¼whenComplete() å handle() ç³»åæ¹æ³å°±ç±»ä¼¼äº try{}finally{}ä¸­ç finally{}ï¼æ è®ºæ¯å¦åçå¼å¸¸é½ä¼æ§è¡ whenComplete() ä¸­çåè°å½æ° consumer å handle() ä¸­çåè°å½æ° fnãwhenComplete() å handle() çåºå«å¨äº whenComplete() ä¸æ¯æè¿åç»æï¼è handle() æ¯æ¯æè¿åç»æçã\n\nCompletableFuture<Integer>\n  f0 = CompletableFuture\n    .supplyAsync(()->7/0))\n    .thenApply(r->r*10)\n    .exceptionally(e->0);\nSystem.out.println(f0.join());\n\n\n\n# Fork/Join\n\nFork/Join æ¯ä¸ä¸ªå¹¶è¡è®¡ç®çæ¡æ¶ï¼ä¸»è¦å°±æ¯ç¨æ¥æ¯æåæ²»ä»»å¡æ¨¡åçï¼è¿ä¸ªè®¡ç®æ¡æ¶éçFork å¯¹åºçæ¯åæ²»ä»»å¡æ¨¡åéçä»»å¡åè§£ï¼Join å¯¹åºçæ¯ç»æåå¹¶ãFork/Join è®¡ç®æ¡æ¶ä¸»è¦åå«ä¸¤é¨åï¼ä¸é¨åæ¯åæ²»ä»»å¡ççº¿ç¨æ±  ForkJoinPoolï¼å¦ä¸é¨åæ¯åæ²»ä»»å¡ ForkJoinTaskãè¿ä¸¤é¨åçå³ç³»ç±»ä¼¼äº ThreadPoolExecutor å Runnable çå³ç³»ï¼é½å¯ä»¥çè§£ä¸ºæäº¤ä»»å¡å°çº¿ç¨æ± ï¼åªä¸è¿åæ²»ä»»å¡æèªå·±ç¬ç¹ç±»å ForkJoinTaskã\n\nForkJoinTask æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®çæ¹æ³æå¾å¤ï¼ææ ¸å¿çæ¯ fork() æ¹æ³å join() æ¹æ³ï¼å¶ä¸­ fork() æ¹æ³ä¼å¼æ­¥å°æ§è¡ä¸ä¸ªå­ä»»å¡ï¼è join() æ¹æ³åä¼é»å¡å½åçº¿ç¨æ¥ç­å¾å­ä»»å¡çæ§è¡ç»æãForkJoinTask æä¸¤ä¸ªå­ç±»ââRecursiveAction å RecursiveTaskï¼éè¿åå­ä½ å°±åºè¯¥è½ç¥éï¼å®ä»¬é½æ¯ç¨éå½çæ¹å¼æ¥å¤çåæ²»ä»»å¡çãè¿ä¸¤ä¸ªå­ç±»é½å®ä¹äºæ½è±¡æ¹æ³ compute()ï¼ä¸è¿åºå«æ¯ RecursiveAction å®ä¹ç compute() æ²¡æè¿åå¼ï¼è RecursiveTask å®ä¹ç compute() æ¹æ³æ¯æè¿åå¼çãè¿ä¸¤ä¸ªå­ç±»ä¹æ¯æ½è±¡ç±»ï¼å¨ä½¿ç¨çæ¶åï¼éè¦ä½ å®ä¹å­ç±»å»æ©å±ã\n\n\n# ForkJoinPool å·¥ä½åç\n\nFork/Join å¹¶è¡è®¡ç®çæ ¸å¿ç»ä»¶æ¯ ForkJoinPoolï¼æä»¥ä¸é¢æä»¬å°±æ¥ç®åä»ç»ä¸ä¸ ForkJoinPool çå·¥ä½åçã\n\néè¿ä¸æ åé¢æç« çå­¦ä¹ ï¼ä½ åºè¯¥å·²ç»ç¥é ThreadPoolExecutor æ¬è´¨ä¸æ¯ä¸ä¸ªçäº§è - æ¶è´¹èæ¨¡å¼çå®ç°ï¼åé¨æä¸ä¸ªä»»å¡éåï¼è¿ä¸ªä»»å¡éåæ¯çäº§èåæ¶è´¹èéä¿¡çåªä»ï¼ThreadPoolExecutor å¯ä»¥æå¤ä¸ªå·¥ä½çº¿ç¨ï¼ä½æ¯è¿äºå·¥ä½çº¿ç¨é½å±äº«ä¸ä¸ªä»»å¡éåã\n\nForkJoinPool æ¬è´¨ä¸ä¹æ¯ä¸ä¸ªçäº§è - æ¶è´¹èçå®ç°ï¼ä½æ¯æ´å æºè½ï¼ä½ å¯ä»¥åèä¸é¢ç ForkJoinPool å·¥ä½åçå¾æ¥çè§£å¶åçãThreadPoolExecutor åé¨åªæä¸ä¸ªä»»å¡éåï¼è ForkJoinPool åé¨æå¤ä¸ªä»»å¡éåï¼å½æä»¬éè¿ ForkJoinPool ç invoke() æè submit() æ¹æ³æäº¤ä»»å¡æ¶ï¼ForkJoinPool æ ¹æ®ä¸å®çè·¯ç±è§åæä»»å¡æäº¤å°ä¸ä¸ªä»»å¡éåä¸­ï¼å¦æä»»å¡å¨æ§è¡è¿ç¨ä¸­ä¼åå»ºåºå­ä»»å¡ï¼é£ä¹å­ä»»å¡ä¼æäº¤å°å·¥ä½çº¿ç¨å¯¹åºçä»»å¡éåä¸­ã\n\nå¦æå·¥ä½çº¿ç¨å¯¹åºçä»»å¡éåç©ºäºï¼æ¯ä¸æ¯å°±æ²¡æ´»å¿å¹²äºå¢ï¼ä¸æ¯çï¼ForkJoinPool æ¯æä¸ç§å«åâä»»å¡çªåâçæºå¶ï¼å¦æå·¥ä½çº¿ç¨ç©ºé²äºï¼é£å®å¯ä»¥âçªåâå¶ä»å·¥ä½ä»»å¡éåéçä»»å¡ï¼ä¾å¦ä¸å¾ä¸­ï¼çº¿ç¨ T2 å¯¹åºçä»»å¡éåå·²ç»ç©ºäºï¼å®å¯ä»¥âçªåâçº¿ç¨ T1 å¯¹åºçä»»å¡éåçä»»å¡ãå¦æ­¤ä¸æ¥ï¼ææçå·¥ä½çº¿ç¨é½ä¸ä¼é²ä¸æ¥äºã\n\nForkJoinPool ä¸­çä»»å¡éåéç¨çæ¯åç«¯éåï¼å·¥ä½çº¿ç¨æ­£å¸¸è·åä»»å¡åâçªåä»»å¡âåå«æ¯ä»ä»»å¡éåä¸åçç«¯æ¶è´¹ï¼è¿æ ·è½é¿åå¾å¤ä¸å¿è¦çæ°æ®ç«äºãæä»¬è¿éä»ç»çä»ä»æ¯ç®ååçåçï¼ForkJoinPool çå®ç°è¿æ¯æä»¬è¿éä»ç»çå¤æï¼å¦æä½ æå´è¶£ï¼å»ºè®®å»çå®çæºç ã\n\n\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * ãJava å¹¶åç¼ç¨å®æã\n * CompletableFuture ä½¿ç¨è¯¦è§£",normalizedContent:"# java fork join æ¡æ¶\n\nå¯¹äºç®åçå¹¶è¡ä»»å¡ï¼ä½ å¯ä»¥éè¿âçº¿ç¨æ±  +futureâçæ¹æ¡æ¥è§£å³ï¼å¦æä»»å¡ä¹é´æèåå³ç³»ï¼æ è®ºæ¯ and èåè¿æ¯ or èåï¼é½å¯ä»¥éè¿ completablefuture æ¥è§£å³ï¼èæ¹éçå¹¶è¡ä»»å¡ï¼åå¯ä»¥éè¿ completionservice æ¥è§£å³ã\n\n\n# completablefuture\n\n\n# runasync å supplyasync æ¹æ³\n\ncompletablefuture æä¾äºåä¸ªéææ¹æ³æ¥åå»ºä¸ä¸ªå¼æ­¥æä½ã\n\npublic static completablefuture<void> runasync(runnable runnable)\npublic static completablefuture<void> runasync(runnable runnable, executor executor)\npublic static <u> completablefuture<u> supplyasync(supplier<u> supplier)\npublic static <u> completablefuture<u> supplyasync(supplier<u> supplier, executor executor)\n\n\næ²¡ææå® executor çæ¹æ³ä¼ä½¿ç¨ forkjoinpool.commonpool() ä½ä¸ºå®ççº¿ç¨æ± æ§è¡å¼æ­¥ä»£ç ãå¦ææå®çº¿ç¨æ± ï¼åä½¿ç¨æå®ççº¿ç¨æ± è¿è¡ãä»¥ä¸ææçæ¹æ³é½ç±»åã\n\n * runasync æ¹æ³ä¸æ¯æè¿åå¼ã\n * supplyasync å¯ä»¥æ¯æè¿åå¼ã\n\n\n# completionstage\n\ncompletionstage æ¥å£å¯ä»¥æ¸æ°å°æè¿°ä»»å¡ä¹é´çæ¶åºå³ç³»ï¼å¦ä¸²è¡å³ç³»ãå¹¶è¡å³ç³»ãæ±èå³ç³»ç­ã\n\n\n# ä¸²è¡å³ç³»\n\ncompletionstage æ¥å£éé¢æè¿°ä¸²è¡å³ç³»ï¼ä¸»è¦æ¯ thenapplyãthenacceptãthenrun å thencompose è¿åä¸ªç³»åçæ¥å£ã\n\nthenapply ç³»åå½æ°éåæ° fn çç±»åæ¯æ¥å£ function<t, r>ï¼è¿ä¸ªæ¥å£éä¸ completionstage ç¸å³çæ¹æ³æ¯ r apply(t t)ï¼è¿ä¸ªæ¹æ³æ¢è½æ¥æ¶åæ°ä¹æ¯æè¿åå¼ï¼æä»¥ thenapply ç³»åæ¹æ³è¿åçæ¯completionstageã\n\nè thenaccept ç³»åæ¹æ³éåæ° consumer çç±»åæ¯æ¥å£ consumer<t>ï¼è¿ä¸ªæ¥å£éä¸ completionstage ç¸å³çæ¹æ³æ¯ void accept(t t)ï¼è¿ä¸ªæ¹æ³è½ç¶æ¯æåæ°ï¼ä½å´ä¸æ¯æåå¼ï¼æä»¥ thenaccept ç³»åæ¹æ³è¿åçæ¯completionstage<void>ã\n\nthenrun ç³»åæ¹æ³é action çåæ°æ¯ runnableï¼æä»¥ action æ¢ä¸è½æ¥æ¶åæ°ä¹ä¸æ¯æè¿åå¼ï¼æä»¥ thenrun ç³»åæ¹æ³è¿åçä¹æ¯completionstage<void>ã\n\nè¿äºæ¹æ³éé¢ async ä»£è¡¨çæ¯å¼æ­¥æ§è¡ fnãconsumer æè actionãå¶ä¸­ï¼éè¦ä½ æ³¨æçæ¯ thencompose ç³»åæ¹æ³ï¼è¿ä¸ªç³»åçæ¹æ³ä¼æ°åå»ºåºä¸ä¸ªå­æµç¨ï¼æç»ç»æå thenapply ç³»åæ¯ç¸åçã\n\n\n# æè¿° and æ±èå³ç³»\n\ncompletionstage æ¥å£éé¢æè¿° and æ±èå³ç³»ï¼ä¸»è¦æ¯ thencombineãthenacceptboth å runafterboth ç³»åçæ¥å£ï¼è¿äºæ¥å£çåºå«ä¹æ¯æºèª fnãconsumerãaction è¿ä¸ä¸ªæ ¸å¿åæ°ä¸åã\n\ncompletionstage<r> thencombine(other, fn);\ncompletionstage<r> thencombineasync(other, fn);\ncompletionstage<void> thenacceptboth(other, consumer);\ncompletionstage<void> thenacceptbothasync(other, consumer);\ncompletionstage<void> runafterboth(other, action);\ncompletionstage<void> runafterbothasync(other, action);\n\n\n\n# æè¿° or æ±èå³ç³»\n\ncompletionstage æ¥å£éé¢æè¿° or æ±èå³ç³»ï¼ä¸»è¦æ¯ applytoeitherãaccepteither å runaftereither ç³»åçæ¥å£ï¼è¿äºæ¥å£çåºå«ä¹æ¯æºèª fnãconsumerãaction è¿ä¸ä¸ªæ ¸å¿åæ°ä¸åã\n\ncompletionstage applytoeither(other, fn);\ncompletionstage applytoeitherasync(other, fn);\ncompletionstage accepteither(other, consumer);\ncompletionstage accepteitherasync(other, consumer);\ncompletionstage runaftereither(other, action);\ncompletionstage runaftereitherasync(other, action);\n\n\nä¸é¢çç¤ºä¾ä»£ç å±ç¤ºäºå¦ä½ä½¿ç¨ applytoeither() æ¹æ³æ¥æè¿°ä¸ä¸ª or æ±èå³ç³»ã\n\ncompletablefuture<string> f1 =\n  completablefuture.supplyasync(()->{\n    int t = getrandom(5, 10);\n    sleep(t, timeunit.seconds);\n    return string.valueof(t);\n});\n\ncompletablefuture<string> f2 =\n  completablefuture.supplyasync(()->{\n    int t = getrandom(5, 10);\n    sleep(t, timeunit.seconds);\n    return string.valueof(t);\n});\n\ncompletablefuture<string> f3 =\n  f1.applytoeither(f2,s -> s);\n\nsystem.out.println(f3.join());\n\n\n\n# å¼å¸¸å¤ç\n\nè½ç¶ä¸é¢æä»¬æå°ç fnãconsumerãaction å®ä»¬çæ ¸å¿æ¹æ³é½ä¸åè®¸æåºå¯æ£æ¥å¼å¸¸ï¼ä½æ¯å´æ æ³éå¶å®ä»¬æåºè¿è¡æ¶å¼å¸¸ï¼ä¾å¦ä¸é¢çä»£ç ï¼æ§è¡ 7/0 å°±ä¼åºç°é¤é¶éè¯¯è¿ä¸ªè¿è¡æ¶å¼å¸¸ãéå¼æ­¥ç¼ç¨éé¢ï¼æä»¬å¯ä»¥ä½¿ç¨ try{}catch{} æ¥æè·å¹¶å¤çå¼å¸¸ï¼é£å¨å¼æ­¥ç¼ç¨éé¢ï¼å¼å¸¸è¯¥å¦ä½å¤çå¢ï¼\n\ncompletablefuture<integer>\n  f0 = completablefuture.\n    .supplyasync(()->(7/0))\n    .thenapply(r->r*10);\nsystem.out.println(f0.join());\n\n\ncompletionstage æ¥å£ç»æä»¬æä¾çæ¹æ¡éå¸¸ç®åï¼æ¯ try{}catch{}è¿è¦ç®åï¼ä¸é¢æ¯ç¸å³çæ¹æ³ï¼ä½¿ç¨è¿äºæ¹æ³è¿è¡å¼å¸¸å¤çåä¸²è¡æä½æ¯ä¸æ ·çï¼é½æ¯æé¾å¼ç¼ç¨æ¹å¼ã\n\ncompletionstage exceptionally(fn);\ncompletionstage<r> whencomplete(consumer);\ncompletionstage<r> whencompleteasync(consumer);\ncompletionstage<r> handle(fn);\ncompletionstage<r> handleasync(fn);\n\n\nä¸é¢çç¤ºä¾ä»£ç å±ç¤ºäºå¦ä½ä½¿ç¨ exceptionally() æ¹æ³æ¥å¤çå¼å¸¸ï¼exceptionally() çä½¿ç¨éå¸¸ç±»ä¼¼äº try{}catch{}ä¸­ç catch{}ï¼ä½æ¯ç±äºæ¯æé¾å¼ç¼ç¨æ¹å¼ï¼æä»¥ç¸å¯¹æ´ç®åãæ¢ç¶æ try{}catch{}ï¼é£å°±ä¸å®è¿æ try{}finally{}ï¼whencomplete() å handle() ç³»åæ¹æ³å°±ç±»ä¼¼äº try{}finally{}ä¸­ç finally{}ï¼æ è®ºæ¯å¦åçå¼å¸¸é½ä¼æ§è¡ whencomplete() ä¸­çåè°å½æ° consumer å handle() ä¸­çåè°å½æ° fnãwhencomplete() å handle() çåºå«å¨äº whencomplete() ä¸æ¯æè¿åç»æï¼è handle() æ¯æ¯æè¿åç»æçã\n\ncompletablefuture<integer>\n  f0 = completablefuture\n    .supplyasync(()->7/0))\n    .thenapply(r->r*10)\n    .exceptionally(e->0);\nsystem.out.println(f0.join());\n\n\n\n# fork/join\n\nfork/join æ¯ä¸ä¸ªå¹¶è¡è®¡ç®çæ¡æ¶ï¼ä¸»è¦å°±æ¯ç¨æ¥æ¯æåæ²»ä»»å¡æ¨¡åçï¼è¿ä¸ªè®¡ç®æ¡æ¶éçfork å¯¹åºçæ¯åæ²»ä»»å¡æ¨¡åéçä»»å¡åè§£ï¼join å¯¹åºçæ¯ç»æåå¹¶ãfork/join è®¡ç®æ¡æ¶ä¸»è¦åå«ä¸¤é¨åï¼ä¸é¨åæ¯åæ²»ä»»å¡ççº¿ç¨æ±  forkjoinpoolï¼å¦ä¸é¨åæ¯åæ²»ä»»å¡ forkjointaskãè¿ä¸¤é¨åçå³ç³»ç±»ä¼¼äº threadpoolexecutor å runnable çå³ç³»ï¼é½å¯ä»¥çè§£ä¸ºæäº¤ä»»å¡å°çº¿ç¨æ± ï¼åªä¸è¿åæ²»ä»»å¡æèªå·±ç¬ç¹ç±»å forkjointaskã\n\nforkjointask æ¯ä¸ä¸ªæ½è±¡ç±»ï¼å®çæ¹æ³æå¾å¤ï¼ææ ¸å¿çæ¯ fork() æ¹æ³å join() æ¹æ³ï¼å¶ä¸­ fork() æ¹æ³ä¼å¼æ­¥å°æ§è¡ä¸ä¸ªå­ä»»å¡ï¼è join() æ¹æ³åä¼é»å¡å½åçº¿ç¨æ¥ç­å¾å­ä»»å¡çæ§è¡ç»æãforkjointask æä¸¤ä¸ªå­ç±»âârecursiveaction å recursivetaskï¼éè¿åå­ä½ å°±åºè¯¥è½ç¥éï¼å®ä»¬é½æ¯ç¨éå½çæ¹å¼æ¥å¤çåæ²»ä»»å¡çãè¿ä¸¤ä¸ªå­ç±»é½å®ä¹äºæ½è±¡æ¹æ³ compute()ï¼ä¸è¿åºå«æ¯ recursiveaction å®ä¹ç compute() æ²¡æè¿åå¼ï¼è recursivetask å®ä¹ç compute() æ¹æ³æ¯æè¿åå¼çãè¿ä¸¤ä¸ªå­ç±»ä¹æ¯æ½è±¡ç±»ï¼å¨ä½¿ç¨çæ¶åï¼éè¦ä½ å®ä¹å­ç±»å»æ©å±ã\n\n\n# forkjoinpool å·¥ä½åç\n\nfork/join å¹¶è¡è®¡ç®çæ ¸å¿ç»ä»¶æ¯ forkjoinpoolï¼æä»¥ä¸é¢æä»¬å°±æ¥ç®åä»ç»ä¸ä¸ forkjoinpool çå·¥ä½åçã\n\néè¿ä¸æ åé¢æç« çå­¦ä¹ ï¼ä½ åºè¯¥å·²ç»ç¥é threadpoolexecutor æ¬è´¨ä¸æ¯ä¸ä¸ªçäº§è - æ¶è´¹èæ¨¡å¼çå®ç°ï¼åé¨æä¸ä¸ªä»»å¡éåï¼è¿ä¸ªä»»å¡éåæ¯çäº§èåæ¶è´¹èéä¿¡çåªä»ï¼threadpoolexecutor å¯ä»¥æå¤ä¸ªå·¥ä½çº¿ç¨ï¼ä½æ¯è¿äºå·¥ä½çº¿ç¨é½å±äº«ä¸ä¸ªä»»å¡éåã\n\nforkjoinpool æ¬è´¨ä¸ä¹æ¯ä¸ä¸ªçäº§è - æ¶è´¹èçå®ç°ï¼ä½æ¯æ´å æºè½ï¼ä½ å¯ä»¥åèä¸é¢ç forkjoinpool å·¥ä½åçå¾æ¥çè§£å¶åçãthreadpoolexecutor åé¨åªæä¸ä¸ªä»»å¡éåï¼è forkjoinpool åé¨æå¤ä¸ªä»»å¡éåï¼å½æä»¬éè¿ forkjoinpool ç invoke() æè submit() æ¹æ³æäº¤ä»»å¡æ¶ï¼forkjoinpool æ ¹æ®ä¸å®çè·¯ç±è§åæä»»å¡æäº¤å°ä¸ä¸ªä»»å¡éåä¸­ï¼å¦æä»»å¡å¨æ§è¡è¿ç¨ä¸­ä¼åå»ºåºå­ä»»å¡ï¼é£ä¹å­ä»»å¡ä¼æäº¤å°å·¥ä½çº¿ç¨å¯¹åºçä»»å¡éåä¸­ã\n\nå¦æå·¥ä½çº¿ç¨å¯¹åºçä»»å¡éåç©ºäºï¼æ¯ä¸æ¯å°±æ²¡æ´»å¿å¹²äºå¢ï¼ä¸æ¯çï¼forkjoinpool æ¯æä¸ç§å«åâä»»å¡çªåâçæºå¶ï¼å¦æå·¥ä½çº¿ç¨ç©ºé²äºï¼é£å®å¯ä»¥âçªåâå¶ä»å·¥ä½ä»»å¡éåéçä»»å¡ï¼ä¾å¦ä¸å¾ä¸­ï¼çº¿ç¨ t2 å¯¹åºçä»»å¡éåå·²ç»ç©ºäºï¼å®å¯ä»¥âçªåâçº¿ç¨ t1 å¯¹åºçä»»å¡éåçä»»å¡ãå¦æ­¤ä¸æ¥ï¼ææçå·¥ä½çº¿ç¨é½ä¸ä¼é²ä¸æ¥äºã\n\nforkjoinpool ä¸­çä»»å¡éåéç¨çæ¯åç«¯éåï¼å·¥ä½çº¿ç¨æ­£å¸¸è·åä»»å¡åâçªåä»»å¡âåå«æ¯ä»ä»»å¡éåä¸åçç«¯æ¶è´¹ï¼è¿æ ·è½é¿åå¾å¤ä¸å¿è¦çæ°æ®ç«äºãæä»¬è¿éä»ç»çä»ä»æ¯ç®ååçåçï¼forkjoinpool çå®ç°è¿æ¯æä»¬è¿éä»ç»çå¤æï¼å¦æä½ æå´è¶£ï¼å»ºè®®å»çå®çæºç ã\n\n\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * ãjava å¹¶åç¼ç¨å®æã\n * completablefuture ä½¿ç¨è¯¦è§£",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Synchronized",frontmatter:{title:"Synchronized",date:"2020-12-25T18:43:11.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å"],permalink:"/pages/8655a7/"},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/11.Synchronized.html",relativePath:"01.Java/01.JavaSE/05.å¹¶å/11.Synchronized.md",key:"v-fea6165a",path:"/pages/8655a7/",headers:[{level:2,title:"synchronized çç®ä»",slug:"synchronized-çç®ä»",normalizedTitle:"synchronized çç®ä»",charIndex:19},{level:2,title:"synchronized çåºç¨",slug:"synchronized-çåºç¨",normalizedTitle:"synchronized çåºç¨",charIndex:421},{level:3,title:"åæ­¥å®ä¾æ¹æ³",slug:"åæ­¥å®ä¾æ¹æ³",normalizedTitle:"åæ­¥å®ä¾æ¹æ³",charIndex:467},{level:3,title:"åæ­¥éææ¹æ³",slug:"åæ­¥éææ¹æ³",normalizedTitle:"åæ­¥éææ¹æ³",charIndex:497},{level:3,title:"åæ­¥ä»£ç å",slug:"åæ­¥ä»£ç å",normalizedTitle:"åæ­¥ä»£ç å",charIndex:534},{level:2,title:"synchronized çåç",slug:"synchronized-çåç",normalizedTitle:"synchronized çåç",charIndex:5655},{level:3,title:"åæ­¥ä»£ç å",slug:"åæ­¥ä»£ç å-2",normalizedTitle:"åæ­¥ä»£ç å",charIndex:534},{level:3,title:"åæ­¥æ¹æ³",slug:"åæ­¥æ¹æ³",normalizedTitle:"åæ­¥æ¹æ³",charIndex:480},{level:3,title:"Monitor",slug:"monitor",normalizedTitle:"monitor",charIndex:5727},{level:2,title:"synchronized çä¼å",slug:"synchronized-çä¼å",normalizedTitle:"synchronized çä¼å",charIndex:7389},{level:3,title:"Java å¯¹è±¡å¤´",slug:"java-å¯¹è±¡å¤´",normalizedTitle:"java å¯¹è±¡å¤´",charIndex:7480},{level:3,title:"ååé",slug:"ååé",normalizedTitle:"ååé",charIndex:7705},{level:3,title:"è½»éçº§é",slug:"è½»éçº§é",normalizedTitle:"è½»éçº§é",charIndex:7754},{level:3,title:"éæ¶é¤ / éç²å",slug:"éæ¶é¤-éç²å",normalizedTitle:"éæ¶é¤ / éç²å",charIndex:8633},{level:4,title:"éæ¶é¤",slug:"éæ¶é¤",normalizedTitle:"éæ¶é¤",charIndex:8633},{level:4,title:"éç²å",slug:"éç²å",normalizedTitle:"éç²å",charIndex:8639},{level:3,title:"èªæé",slug:"èªæé",normalizedTitle:"èªæé",charIndex:9774},{level:2,title:"synchronized çè¯¯åº",slug:"synchronized-çè¯¯åº",normalizedTitle:"synchronized çè¯¯åº",charIndex:10036},{level:3,title:"synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯",slug:"synchronized-ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯",normalizedTitle:"synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯",charIndex:10087},{level:3,title:"synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯",slug:"synchronized-ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯",normalizedTitle:"synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯",charIndex:11671},{level:3,title:"éç²åº¦å¯¼è´çé®é¢",slug:"éç²åº¦å¯¼è´çé®é¢",normalizedTitle:"éç²åº¦å¯¼è´çé®é¢",charIndex:12882},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:14224}],headersStr:"synchronized çç®ä» synchronized çåºç¨ åæ­¥å®ä¾æ¹æ³ åæ­¥éææ¹æ³ åæ­¥ä»£ç å synchronized çåç åæ­¥ä»£ç å åæ­¥æ¹æ³ Monitor synchronized çä¼å Java å¯¹è±¡å¤´ ååé è½»éçº§é éæ¶é¤ / éç²å éæ¶é¤ éç²å èªæé synchronized çè¯¯åº synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯ synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯ éç²åº¦å¯¼è´çé®é¢ åèèµæ",content:'# Synchronized\n\n\n# synchronized çç®ä»\n\nsynchronized æ¯ Java ä¸­çå³é®å­ï¼æ¯ å©ç¨éçæºå¶æ¥å®ç°äºæ¥åæ­¥çã\n\nsynchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\nå¦æä¸éè¦ Lock ãReadWriteLock ææä¾çé«çº§åæ­¥ç¹æ§ï¼åºè¯¥ä¼åèèä½¿ç¨ synchronized ï¼çç±å¦ä¸ï¼\n\n * Java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ Lock ãReadWriteLock åºæ¬ä¸æå¹³ãä»è¶å¿æ¥çï¼Java æªæ¥ä»å°ç»§ç»­ä¼å synchronized ï¼èä¸æ¯ ReentrantLock ã\n * ReentrantLock æ¯ Oracle JDK ç APIï¼å¨å¶ä»çæ¬ç JDK ä¸­ä¸ä¸å®æ¯æï¼è synchronized æ¯ JVM çåç½®ç¹æ§ï¼ææ JDK çæ¬é½æä¾æ¯æã\n\n\n# synchronized çåºç¨\n\nsynchronized æ 3 ç§åºç¨æ¹å¼ï¼\n\n * åæ­¥å®ä¾æ¹æ³ - å¯¹äºæ®éåæ­¥æ¹æ³ï¼éæ¯å½åå®ä¾å¯¹è±¡\n * åæ­¥éææ¹æ³ - å¯¹äºéæåæ­¥æ¹æ³ï¼éæ¯å½åç±»ç Class å¯¹è±¡\n * åæ­¥ä»£ç å - å¯¹äºåæ­¥æ¹æ³åï¼éæ¯ synchonized æ¬å·ééç½®çå¯¹è±¡\n\n> è¯´æï¼\n> \n> ç±»ä¼¼ VectorãHashtable è¿ç±»åæ­¥ç±»ï¼å°±æ¯ä½¿ç¨ synchonized ä¿®é¥°å¶éè¦æ¹æ³ï¼æ¥ä¿è¯å¶çº¿ç¨å®å¨ã\n> \n> äºå®ä¸ï¼è¿ç±»åæ­¥å®¹å¨ä¹éç»å¯¹ççº¿ç¨å®å¨ï¼å½æ§è¡è¿­ä»£å¨éåï¼æ ¹æ®æ¡ä»¶å é¤åç´ è¿ç§åºæ¯ä¸ï¼å°±å¯è½åºç°çº¿ç¨ä¸å®å¨çæåµãæ­¤å¤ï¼Java 1.6 éå¯¹ synchonized è¿è¡ä¼ååï¼ç±äºé»å¡ï¼å¶æ§è½ä¸é«ã\n> \n> ç»¼ä¸ï¼è¿ç±»åæ­¥å®¹å¨ï¼å¨ç°ä»£ Java ç¨åºä¸­ï¼å·²ç»æ¸æ¸ä¸ç¨äºã\n\n\n# åæ­¥å®ä¾æ¹æ³\n\nâ éè¯¯ç¤ºä¾ - æªåæ­¥çç¤ºä¾\n\npublic class NoSynchronizedDemo implements Runnable {\n\n    public static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        NoSynchronizedDemo instance = new NoSynchronizedDemo();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    public void increase() {\n        count++;\n    }\n\n}\n// è¾åºç»æ: å°äº 200000 çéæºæ°å­\n\n\nJava å®ä¾æ¹æ³åæ­¥æ¯åæ­¥å¨æ¥æè¯¥æ¹æ³çå¯¹è±¡ä¸ãè¿æ ·ï¼æ¯ä¸ªå®ä¾å¶æ¹æ³åæ­¥é½åæ­¥å¨ä¸åçå¯¹è±¡ä¸ï¼å³è¯¥æ¹æ³æå±çå®ä¾ãåªæä¸ä¸ªçº¿ç¨è½å¤å¨å®ä¾æ¹æ³åæ­¥åä¸­è¿è¡ãå¦ææå¤ä¸ªå®ä¾å­å¨ï¼é£ä¹ä¸ä¸ªçº¿ç¨ä¸æ¬¡å¯ä»¥å¨ä¸ä¸ªå®ä¾åæ­¥åä¸­æ§è¡æä½ãä¸ä¸ªå®ä¾ä¸ä¸ªçº¿ç¨ã\n\npublic class SynchronizedDemo implements Runnable {\n\n    private static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedDemo instance = new SynchronizedDemo();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°æ®éæ¹æ³\n     */\n    public synchronized void increase() {\n        count++;\n    }\n\n}\n\n\nãç¤ºä¾ãéè¯¯ç¤ºä¾\n\nclass Account {\n  private int balance;\n  // è½¬è´¦\n  synchronized void transfer(\n      Account target, int amt){\n    if (this.balance > amt) {\n      this.balance -= amt;\n      target.balance += amt;\n    }\n  }\n}\n\n\nå¨è¿æ®µä»£ç ä¸­ï¼ä¸´çåºåæä¸¤ä¸ªèµæºï¼åå«æ¯è½¬åºè´¦æ·çä½é¢ this.balance åè½¬å¥è´¦æ·çä½é¢ target.balanceï¼å¹¶ä¸ç¨çæ¯ä¸æé thisï¼ç¬¦åæä»¬åé¢æå°çï¼å¤ä¸ªèµæºå¯ä»¥ç¨ä¸æéæ¥ä¿æ¤ï¼è¿çä¸å»å®å¨æ­£ç¡®åãççæ¯è¿æ ·åï¼å¯æï¼è¿ä¸ªæ¹æ¡ä»ä»æ¯çä¼¼æ­£ç¡®ï¼ä¸ºä»ä¹å¢ï¼\n\né®é¢å°±åºå¨ this è¿æéä¸ï¼this è¿æéå¯ä»¥ä¿æ¤èªå·±çä½é¢ this.balanceï¼å´ä¿æ¤ä¸äºå«äººçä½é¢ target.balanceï¼å°±åä½ ä¸è½ç¨èªå®¶çéæ¥ä¿æ¤å«äººå®¶çèµäº§ï¼ä¹ä¸è½ç¨èªå·±çç¥¨æ¥ä¿æ¤å«äººçåº§ä½ä¸æ ·ã\n\n\n\nåºè¯¥ä¿è¯ä½¿ç¨çéè½è¦çææåä¿æ¤èµæºã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass Account {\n  private Object lockï¼\n  private int balance;\n  private Account();\n  // åå»º Account æ¶ä¼ å¥åä¸ä¸ª lock å¯¹è±¡\n  public Account(Object lock) {\n    this.lock = lock;\n  }\n  // è½¬è´¦\n  void transfer(Account target, int amt){\n    // æ­¤å¤æ£æ¥ææå¯¹è±¡å±äº«çé\n    synchronized(lock) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\nè¿ä¸ªåæ³ç¡®å®è½è§£å³é®é¢ï¼ä½æ¯æç¹å°ççµï¼å®è¦æ±å¨åå»º Account å¯¹è±¡çæ¶åå¿é¡»ä¼ å¥åä¸ä¸ªå¯¹è±¡ï¼å¦æåå»º Account å¯¹è±¡æ¶ï¼ä¼ å¥ç lock ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼é£å¯å°±æ¨äºï¼ä¼åºç°éèªå®¶é¨æ¥ä¿æ¤ä»å®¶èµäº§çèåäºãå¨çå®çé¡¹ç®åºæ¯ä¸­ï¼åå»º Account å¯¹è±¡çä»£ç å¾å¯è½åæ£å¨å¤ä¸ªå·¥ç¨ä¸­ï¼ä¼ å¥å±äº«ç lock ççå¾é¾ã\n\nä¸é¢çæ¹æ¡ç¼ºä¹å®è·µçå¯è¡æ§ï¼æä»¬éè¦æ´å¥½çæ¹æ¡ãè¿çæï¼å°±æ¯ç¨ Account.class ä½ä¸ºå±äº«çéãAccount.class æ¯ææ Account å¯¹è±¡å±äº«çï¼èä¸è¿ä¸ªå¯¹è±¡æ¯ Java èææºå¨å è½½ Account ç±»çæ¶ååå»ºçï¼æä»¥æä»¬ä¸ç¨æå¿å®çå¯ä¸æ§ãä½¿ç¨ Account.class ä½ä¸ºå±äº«çéï¼æä»¬å°±æ éå¨åå»º Account å¯¹è±¡æ¶ä¼ å¥äºï¼ä»£ç æ´ç®åã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass Account {\n  private int balance;\n  // è½¬è´¦\n  void transfer(Account target, int amt){\n    synchronized(Account.class) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\n\n# åæ­¥éææ¹æ³\n\néææ¹æ³çåæ­¥æ¯æåæ­¥å¨è¯¥æ¹æ³æå¨çç±»å¯¹è±¡ä¸ãå ä¸ºå¨ JVM ä¸­ä¸ä¸ªç±»åªè½å¯¹åºä¸ä¸ªç±»å¯¹è±¡ï¼æä»¥åæ¶åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡åä¸ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³ã\n\nå¯¹äºä¸åç±»ä¸­çéæåæ­¥æ¹æ³ï¼ä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æ¯ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³èæ éç­å¾ãä¸ç®¡ç±»ä¸­çé£ä¸ªéæåæ­¥æ¹æ³è¢«è°ç¨ï¼ä¸ä¸ªç±»åªè½ç±ä¸ä¸ªçº¿ç¨åæ¶æ§è¡ã\n\npublic class SynchronizedDemo2 implements Runnable {\n\n    private static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedDemo2 instance = new SynchronizedDemo2();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°éææ¹æ³\n     */\n    public synchronized static void increase() {\n        count++;\n    }\n\n}\n\n\n\n# åæ­¥ä»£ç å\n\nææ¶ä½ ä¸éè¦åæ­¥æ´ä¸ªæ¹æ³ï¼èæ¯åæ­¥æ¹æ³ä¸­çä¸é¨åãJava å¯ä»¥å¯¹æ¹æ³çä¸é¨åè¿è¡åæ­¥ã\n\næ³¨æ Java åæ­¥åæé å¨ç¨æ¬å·å°å¯¹è±¡æ¬èµ·æ¥ãå¨ä¸ä¾ä¸­ï¼ä½¿ç¨äº thisï¼å³ä¸ºè°ç¨ add æ¹æ³çå®ä¾æ¬èº«ãå¨åæ­¥æé å¨ä¸­ç¨æ¬å·æ¬èµ·æ¥çå¯¹è±¡å«åçè§å¨å¯¹è±¡ãä¸è¿°ä»£ç ä½¿ç¨çè§å¨å¯¹è±¡åæ­¥ï¼åæ­¥å®ä¾æ¹æ³ä½¿ç¨è°ç¨æ¹æ³æ¬èº«çå®ä¾ä½ä¸ºçè§å¨å¯¹è±¡ã\n\nä¸æ¬¡åªæä¸ä¸ªçº¿ç¨è½å¤å¨åæ­¥äºåä¸ä¸ªçè§å¨å¯¹è±¡ç Java æ¹æ³åæ§è¡ã\n\npublic class SynchronizedDemo3 implements Runnable {\n\n    private static final int MAX = 100000;\n\n    private static int count = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedDemo3 instance = new SynchronizedDemo3();\n        Thread t1 = new Thread(instance);\n        Thread t2 = new Thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(count);\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < MAX; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°ä»£ç å\n     */\n    public static void increase() {\n        synchronized (SynchronizedDemo3.class) {\n            count++;\n        }\n    }\n\n}\n\n\n\n# synchronized çåç\n\nsynchronized ä»£ç åæ¯ç±ä¸å¯¹ monitorenter å monitorexit æä»¤å®ç°çï¼Monitor å¯¹è±¡æ¯åæ­¥çåºæ¬å®ç°ååãå¨ Java 6 ä¹åï¼Monitor çå®ç°å®å¨æ¯ä¾é æä½ç³»ç»åé¨çäºæ¥éï¼å ä¸ºéè¦è¿è¡ç¨æ·æå°åæ ¸æçåæ¢ï¼æä»¥åæ­¥æä½æ¯ä¸ä¸ªæ å·®å«çééçº§æä½ã\n\nå¦æ synchronized æç¡®å¶å®äºå¯¹è±¡åæ°ï¼é£å°±æ¯è¿ä¸ªå¯¹è±¡çå¼ç¨ï¼å¦ææ²¡ææç¡®æå®ï¼é£å°±æ ¹æ® synchronized ä¿®é¥°çæ¯å®ä¾æ¹æ³è¿æ¯éææ¹æ³ï¼å»å¯¹å¯¹åºçå¯¹è±¡å®ä¾æ Class å¯¹è±¡æ¥ä½ä¸ºéå¯¹è±¡ã\n\nsynchronized åæ­¥åå¯¹åä¸çº¿ç¨æ¥è¯´æ¯å¯éå¥çï¼ä¸ä¼åºç°éæ­»é®é¢ã\n\nsynchronized åæ­¥åæ¯äºæ¥çï¼å³å·²è¿å¥ççº¿ç¨æ§è¡å®æåï¼ä¼é»å¡å¶ä»è¯å¾è¿å¥ççº¿ç¨ã\n\nãç¤ºä¾ã\n\npublic void foo(Object lock) {\n    synchronized (lock) {\n      lock.hashCode();\n    }\n  }\n  // ä¸é¢ç Java ä»£ç å°ç¼è¯ä¸ºä¸é¢çå­èç \n  public void foo(java.lang.Object);\n    Code:\n       0: aload_1\n       1: dup\n       2: astore_2\n       3: monitorenter\n       4: aload_1\n       5: invokevirtual java/lang/Object.hashCode:()I\n       8: pop\n       9: aload_2\n      10: monitorexit\n      11: goto          19\n      14: astore_3\n      15: aload_2\n      16: monitorexit\n      17: aload_3\n      18: athrow\n      19: return\n    Exception table:\n       from    to  target type\n           4    11    14   any\n          14    17    14   any\n\n\n\n\n# åæ­¥ä»£ç å\n\nsynchronized å¨ä¿®é¥°åæ­¥ä»£ç åæ¶ï¼æ¯ç± monitorenter å monitorexit æä»¤æ¥å®ç°åæ­¥çãè¿å¥ monitorenter æä»¤åï¼çº¿ç¨å°ææ Monitor å¯¹è±¡ï¼éåº monitorenter æä»¤åï¼çº¿ç¨å°éæ¾è¯¥ Monitor å¯¹è±¡ã\n\n\n# åæ­¥æ¹æ³\n\nsynchronized ä¿®é¥°åæ­¥æ¹æ³æ¶ï¼ä¼è®¾ç½®ä¸ä¸ª ACC_SYNCHRONIZED æ å¿ãå½æ¹æ³è°ç¨æ¶ï¼è°ç¨æä»¤å°ä¼æ£æ¥è¯¥æ¹æ³æ¯å¦è¢«è®¾ç½® ACC_SYNCHRONIZED è®¿é®æ å¿ãå¦æè®¾ç½®äºè¯¥æ å¿ï¼æ§è¡çº¿ç¨å°åææ Monitor å¯¹è±¡ï¼ç¶ååæ§è¡æ¹æ³ãå¨è¯¥æ¹æ³è¿è¡æé´ï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ Mointor å¯¹è±¡ï¼å½æ¹æ³æ§è¡å®æåï¼åéæ¾è¯¥ Monitor å¯¹è±¡ã\n\n\n# Monitor\n\næ¯ä¸ªå¯¹è±¡å®ä¾é½ä¼æä¸ä¸ª Monitorï¼Monitor å¯ä»¥åå¯¹è±¡ä¸èµ·åå»ºãéæ¯ãMonitor æ¯ç± ObjectMonitor å®ç°ï¼è ObjectMonitor æ¯ç± C++ ç ObjectMonitor.hpp æä»¶å®ç°ã\n\nå½å¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸æ®µåæ­¥ä»£ç æ¶ï¼å¤ä¸ªçº¿ç¨ä¼åè¢«å­æ¾å¨ EntryList éåä¸­ï¼å¤äº block ç¶æççº¿ç¨ï¼é½ä¼è¢«å å¥å°è¯¥åè¡¨ãæ¥ä¸æ¥å½çº¿ç¨è·åå°å¯¹è±¡ç Monitor æ¶ï¼Monitor æ¯ä¾é åºå±æä½ç³»ç»ç Mutex Lock æ¥å®ç°äºæ¥çï¼çº¿ç¨ç³è¯· Mutex æåï¼åææè¯¥ Mutexï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ Mutexã\n\nå¦æçº¿ç¨è°ç¨ wait() æ¹æ³ï¼å°±ä¼éæ¾å½åææç Mutexï¼å¹¶ä¸è¯¥çº¿ç¨ä¼è¿å¥ WaitSet éåä¸­ï¼ç­å¾ä¸ä¸æ¬¡è¢«å¤éãå¦æå½åçº¿ç¨é¡ºå©æ§è¡å®æ¹æ³ï¼ä¹å°éæ¾ Mutexã\n\n\n# synchronized çä¼å\n\n> Java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ Lock ãReadWriteLock åºæ¬ä¸æå¹³ã\n\n\n# Java å¯¹è±¡å¤´\n\nå¨ JDK1.6 JVM ä¸­ï¼å¯¹è±¡å®ä¾å¨å åå­ä¸­è¢«åä¸ºäºä¸ä¸ªé¨åï¼å¯¹è±¡å¤´ãå®ä¾æ°æ®åå¯¹é½å¡«åãå¶ä¸­ Java å¯¹è±¡å¤´ç± Mark Wordãæåç±»çæéä»¥åæ°ç»é¿åº¦ä¸é¨åç»æã\n\nMark Word è®°å½äºå¯¹è±¡åéæå³çä¿¡æ¯ãMark Word å¨ 64 ä½ JVM ä¸­çé¿åº¦æ¯ 64bitï¼æä»¬å¯ä»¥ä¸èµ·çä¸ 64 ä½ JVM çå­å¨ç»ææ¯æä¹æ ·çãå¦ä¸å¾æç¤ºï¼\n\n\n\néåçº§åè½ä¸»è¦ä¾èµäº Mark Word ä¸­çéæ å¿ä½åéæ¾ååéæ å¿ä½ï¼synchronized åæ­¥éå°±æ¯ä»ååéå¼å§çï¼éçç«äºè¶æ¥è¶æ¿çï¼ååéåçº§å°è½»éçº§éï¼æç»åçº§å°ééçº§éã\n\nJava 1.6 å¼å¥äºååéåè½»éçº§éï¼ä»èè®© synchronized æ¥æäºåä¸ªç¶æï¼\n\n * æ éç¶æï¼unlockedï¼\n * ååéç¶æï¼biasbleï¼\n * è½»éçº§éç¶æï¼lightweight lockedï¼\n * ééçº§éç¶æï¼inflatedï¼\n\nå½ JVM æ£æµå°ä¸åçç«äºç¶åµæ¶ï¼ä¼èªå¨åæ¢å°éåçéå®ç°ã\n\nå½æ²¡æç«äºåºç°æ¶ï¼é»è®¤ä¼ä½¿ç¨ååéãJVM ä¼å©ç¨ CAS æä½ï¼compare and swapï¼ï¼å¨å¯¹è±¡å¤´ä¸ç Mark Word é¨åè®¾ç½®çº¿ç¨ IDï¼ä»¥è¡¨ç¤ºè¿ä¸ªå¯¹è±¡ååäºå½åçº¿ç¨ï¼æä»¥å¹¶ä¸æ¶åçæ­£çäºæ¥éãè¿æ ·åçåè®¾æ¯åºäºå¨å¾å¤åºç¨åºæ¯ä¸­ï¼å¤§é¨åå¯¹è±¡çå½å¨æä¸­æå¤ä¼è¢«ä¸ä¸ªçº¿ç¨éå®ï¼ä½¿ç¨åæéå¯ä»¥éä½æ ç«äºå¼éã\n\nå¦ææå¦å¤ççº¿ç¨è¯å¾éå®æä¸ªå·²ç»è¢«åæè¿çå¯¹è±¡ï¼JVM å°±éè¦æ¤éï¼revokeï¼ååéï¼å¹¶åæ¢å°è½»éçº§éå®ç°ãè½»éçº§éä¾èµ CAS æä½ Mark Word æ¥è¯å¾è·åéï¼å¦æéè¯æåï¼å°±ä½¿ç¨æ®éçè½»éçº§éï¼å¦åï¼è¿ä¸æ­¥åçº§ä¸ºééçº§éã\n\n\n# ååé\n\nååéçææ³æ¯ååäºç¬¬ä¸ä¸ªè·åéå¯¹è±¡ççº¿ç¨ï¼è¿ä¸ªçº¿ç¨å¨ä¹åè·åè¯¥éå°±ä¸åéè¦è¿è¡åæ­¥æä½ï¼çè³è¿ CAS æä½ä¹ä¸åéè¦ã\n\n\n\n\n# è½»éçº§é\n\nè½»éçº§éæ¯ç¸å¯¹äºä¼ ç»çééçº§éèè¨ï¼å® ä½¿ç¨ CAS æä½æ¥é¿åééçº§éä½¿ç¨äºæ¥éçå¼éãå¯¹äºç»å¤§é¨åçéï¼å¨æ´ä¸ªåæ­¥å¨æåé½æ¯ä¸å­å¨ç«äºçï¼å æ­¤ä¹å°±ä¸éè¦é½ä½¿ç¨äºæ¥éè¿è¡åæ­¥ï¼å¯ä»¥åéç¨ CAS æä½è¿è¡åæ­¥ï¼å¦æ CAS å¤±è´¥äºåæ¹ç¨äºæ¥éè¿è¡åæ­¥ã\n\nå½å°è¯è·åä¸ä¸ªéå¯¹è±¡æ¶ï¼å¦æéå¯¹è±¡æ è®°ä¸º 0|01ï¼è¯´æéå¯¹è±¡çéæªéå®ï¼unlockedï¼ç¶æãæ­¤æ¶èææºå¨å½åçº¿ç¨çèææºæ ä¸­åå»º Lock Recordï¼ç¶åä½¿ç¨ CAS æä½å°å¯¹è±¡ç Mark Word æ´æ°ä¸º Lock Record æéãå¦æ CAS æä½æåäºï¼é£ä¹çº¿ç¨å°±è·åäºè¯¥å¯¹è±¡ä¸çéï¼å¹¶ä¸å¯¹è±¡ç Mark Word çéæ è®°åä¸º 00ï¼è¡¨ç¤ºè¯¥å¯¹è±¡å¤äºè½»éçº§éç¶æã\n\n\n\n\n# éæ¶é¤ / éç²å\n\né¤äºéåçº§ä¼åï¼Java è¿ä½¿ç¨äºç¼è¯å¨å¯¹éè¿è¡ä¼åã\n\n# éæ¶é¤\n\néæ¶é¤æ¯æå¯¹äºè¢«æ£æµåºä¸å¯è½å­å¨ç«äºçå±äº«æ°æ®çéè¿è¡æ¶é¤ã\n\nJIT ç¼è¯å¨å¨å¨æç¼è¯åæ­¥åçæ¶åï¼åå©äºä¸ç§è¢«ç§°ä¸ºéé¸åæçææ¯ï¼æ¥å¤æ­åæ­¥åä½¿ç¨çéå¯¹è±¡æ¯å¦åªè½å¤è¢«ä¸ä¸ªçº¿ç¨è®¿é®ï¼èæ²¡æè¢«åå¸å°å¶å®çº¿ç¨ã\n\nç¡®è®¤æ¯çè¯ï¼é£ä¹ JIT ç¼è¯å¨å¨ç¼è¯è¿ä¸ªåæ­¥åçæ¶åä¸ä¼çæ synchronized æè¡¨ç¤ºçéçç³è¯·ä¸éæ¾çæºå¨ç ï¼å³æ¶é¤äºéçä½¿ç¨ãå¨ Java7 ä¹åççæ¬å°±ä¸éè¦æå¨éç½®äºï¼è¯¥æä½å¯ä»¥èªå¨å®ç°ã\n\nå¯¹äºä¸äºçèµ·æ¥æ²¡æå éçä»£ç ï¼å¶å®éå¼çå äºå¾å¤éãä¾å¦ä¸é¢çå­ç¬¦ä¸²æ¼æ¥ä»£ç å°±éå¼å äºéï¼\n\npublic static String concatString(String s1, String s2, String s3) {\n    return s1 + s2 + s3;\n}\n\n\nString æ¯ä¸ä¸ªä¸å¯åçç±»ï¼ç¼è¯å¨ä¼å¯¹ String çæ¼æ¥èªå¨ä¼åãå¨ Java 1.5 ä¹åï¼ä¼è½¬åä¸º StringBuffer å¯¹è±¡çè¿ç»­ append() æä½ï¼\n\npublic static String concatString(String s1, String s2, String s3) {\n    StringBuffer sb = new StringBuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.toString();\n}\n\n\næ¯ä¸ª append() æ¹æ³ä¸­é½æä¸ä¸ªåæ­¥åãèææºè§å¯åé sbï¼å¾å¿«å°±ä¼åç°å®çå¨æä½ç¨åè¢«éå¶å¨ concatString() æ¹æ³åé¨ãä¹å°±æ¯è¯´ï¼sb çææå¼ç¨æ°¸è¿ä¸ä¼éé¸å° concatString() æ¹æ³ä¹å¤ï¼å¶ä»çº¿ç¨æ æ³è®¿é®å°å®ï¼å æ­¤å¯ä»¥è¿è¡æ¶é¤ã\n\n# éç²å\n\néç²ååçï¼å°±æ¯å¨ JIT ç¼è¯å¨å¨æç¼è¯æ¶ï¼å¦æåç°å ä¸ªç¸é»çåæ­¥åä½¿ç¨çæ¯åä¸ä¸ªéå®ä¾ï¼é£ä¹ JIT ç¼è¯å¨å°ä¼æè¿å ä¸ªåæ­¥ååå¹¶ä¸ºä¸ä¸ªå¤§çåæ­¥åï¼ä»èé¿åä¸ä¸ªçº¿ç¨âåå¤ç³è¯·ãéæ¾åä¸ä¸ªéâæå¸¦æ¥çæ§è½å¼éã\n\nå¦æä¸ç³»åçè¿ç»­æä½é½å¯¹åä¸ä¸ªå¯¹è±¡åå¤å éåè§£éï¼é¢ç¹çå éæä½å°±ä¼å¯¼è´æ§è½æèã\n\nä¸ä¸èçç¤ºä¾ä»£ç ä¸­è¿ç»­ç append() æ¹æ³å°±å±äºè¿ç±»æåµãå¦æèææºæ¢æµå°ç±è¿æ ·çä¸ä¸²é¶ç¢çæä½é½å¯¹åä¸ä¸ªå¯¹è±¡å éï¼å°ä¼æå éçèå´æ©å±ï¼ç²åï¼å°æ´ä¸ªæä½åºåçå¤é¨ãå¯¹äºä¸ä¸èçç¤ºä¾ä»£ç å°±æ¯æ©å±å°ç¬¬ä¸ä¸ª append() æä½ä¹åç´è³æåä¸ä¸ª append() æä½ä¹åï¼è¿æ ·åªéè¦å éä¸æ¬¡å°±å¯ä»¥äºã\n\n\n# èªæé\n\näºæ¥åæ­¥è¿å¥é»å¡ç¶æçå¼éé½å¾å¤§ï¼åºè¯¥å°½éé¿åãå¨è®¸å¤åºç¨ä¸­ï¼å±äº«æ°æ®çéå®ç¶æåªä¼æç»­å¾ç­çä¸æ®µæ¶é´ãèªæéçææ³æ¯è®©ä¸ä¸ªçº¿ç¨å¨è¯·æ±ä¸ä¸ªå±äº«æ°æ®çéæ¶æ§è¡å¿å¾ªç¯ï¼èªæï¼ä¸æ®µæ¶é´ï¼å¦æå¨è¿æ®µæ¶é´åè½è·å¾éï¼å°±å¯ä»¥é¿åè¿å¥é»å¡ç¶æã\n\nèªæéè½ç¶è½é¿åè¿å¥é»å¡ç¶æä»èåå°å¼éï¼ä½æ¯å®éè¦è¿è¡å¿å¾ªç¯æä½å ç¨ CPU æ¶é´ï¼å®åªéç¨äºå±äº«æ°æ®çéå®ç¶æå¾ç­çåºæ¯ã\n\nå¨ Java 1.6 ä¸­å¼å¥äºèªéåºçèªæéãèªéåºæå³çèªæçæ¬¡æ°ä¸ååºå®äºï¼èæ¯ç±åä¸æ¬¡å¨åä¸ä¸ªéä¸çèªææ¬¡æ°åéçæ¥æèçç¶ææ¥å³å®ã\n\n\n# synchronized çè¯¯åº\n\n> ç¤ºä¾æèªï¼ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\n\n# synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯\n\npublic class Interesting {\n\n    volatile int a = 1;\n    volatile int b = 1;\n\n    public static void main(String[] args) {\n        Interesting interesting = new Interesting();\n        new Thread(() -> interesting.add()).start();\n        new Thread(() -> interesting.compare()).start();\n    }\n\n    public synchronized void add() {\n        log.info("add start");\n        for (int i = 0; i < 10000; i++) {\n            a++;\n            b++;\n        }\n        log.info("add done");\n    }\n\n    public void compare() {\n        log.info("compare start");\n        for (int i = 0; i < 10000; i++) {\n            //aå§ç»ç­äºbåï¼\n            if (a < b) {\n                log.info("a:{},b:{},{}", a, b, a > b);\n                //æåça>båºè¯¥å§ç»æ¯falseåï¼\n            }\n        }\n        log.info("compare done");\n    }\n\n}\n\n\nãè¾åºã\n\n16:05:25.541 [Thread-0] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add start\n16:05:25.544 [Thread-0] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add done\n16:05:25.544 [Thread-1] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare start\n16:05:25.544 [Thread-1] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare done\n\n\nä¹æä»¥åºç°è¿ç§éä¹±ï¼æ¯å ä¸ºä¸¤ä¸ªçº¿ç¨æ¯äº¤éæ§è¡ add å compare æ¹æ³ä¸­çä¸å¡é»è¾ï¼èä¸è¿äºä¸å¡é»è¾ä¸æ¯åå­æ§çï¼a++ å b++ æä½ä¸­å¯ä»¥ç©¿æå¨ compare æ¹æ³çæ¯è¾ä»£ç ä¸­ï¼æ´éè¦æ³¨æçæ¯ï¼a<b è¿ç§æ¯è¾æä½å¨å­èç å±é¢æ¯å è½½ aãå è½½ b åæ¯è¾ä¸æ­¥ï¼ä»£ç è½ç¶æ¯ä¸è¡ä½ä¹ä¸æ¯åå­æ§çã\n\næä»¥ï¼æ­£ç¡®çåæ³åºè¯¥æ¯ï¼ä¸º add å compare é½å ä¸æ¹æ³éï¼ç¡®ä¿ add æ¹æ³æ§è¡æ¶ï¼compare æ æ³è¯»å a å bï¼\n\npublic synchronized void add()\npublic synchronized void compare()\n\n\næä»¥ï¼ä½¿ç¨éè§£å³é®é¢ä¹åä¸å®è¦çæ¸æ¥ï¼æä»¬è¦ä¿æ¤çæ¯ä»ä¹é»è¾ï¼å¤çº¿ç¨æ§è¡çæåµåæ¯ææ ·çã\n\n\n# synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯\n\nå éåè¦æ¸æ¥éåè¢«ä¿æ¤çå¯¹è±¡æ¯ä¸æ¯ä¸ä¸ªå±é¢çã\n\néæå­æ®µå±äºç±»ï¼ç±»çº§å«çéæè½ä¿æ¤ï¼èééæå­æ®µå±äºç±»å®ä¾ï¼å®ä¾çº§å«çéå°±å¯ä»¥ä¿æ¤ã\n\npublic class synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 {\n\n    public static void main(String[] args) {\n        synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 demo = new synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2();\n        System.out.println(demo.wrong(1000000));\n        System.out.println(demo.right(1000000));\n    }\n\n    public int wrong(int count) {\n        Data.reset();\n        IntStream.rangeClosed(1, count).parallel().forEach(i -> new Data().wrong());\n        return Data.getCounter();\n    }\n\n    public int right(int count) {\n        Data.reset();\n        IntStream.rangeClosed(1, count).parallel().forEach(i -> new Data().right());\n        return Data.getCounter();\n    }\n\n    private static class Data {\n\n        @Getter\n        private static int counter = 0;\n        private static Object locker = new Object();\n\n        public static int reset() {\n            counter = 0;\n            return counter;\n        }\n\n        public synchronized void wrong() {\n            counter++;\n        }\n\n        public void right() {\n            synchronized (locker) {\n                counter++;\n            }\n        }\n\n    }\n\n}\n\n\nwrong æ¹æ³ä¸­è¯å¾å¯¹ä¸ä¸ªéæå¯¹è±¡å å¯¹è±¡çº§å«ç synchronized éï¼å¹¶ä¸è½ä¿è¯çº¿ç¨å®å¨ã\n\n\n# éç²åº¦å¯¼è´çé®é¢\n\nè¦å°½å¯è½çç¼©å°å éçèå´ï¼è¿å¯ä»¥æé«å¹¶åååã\n\nå¦æç²¾ç»åèèäºéåºç¨èå´åï¼æ§è½è¿æ æ³æ»¡è¶³éæ±çè¯ï¼æä»¬å°±è¦èèå¦ä¸ä¸ªç»´åº¦çç²åº¦é®é¢äºï¼å³ï¼åºåè¯»ååºæ¯ä»¥åèµæºçè®¿é®å²çªï¼èèä½¿ç¨æ²è§æ¹å¼çéè¿æ¯ä¹è§æ¹å¼çéã\n\npublic class synchronizedéç²åº¦ä¸å½ {\n\n    public static void main(String[] args) {\n        Demo demo = new Demo();\n        demo.wrong();\n        demo.right();\n    }\n\n    private static class Demo {\n\n        private List<Integer> data = new ArrayList<>();\n\n        private void slow() {\n            try {\n                TimeUnit.MILLISECONDS.sleep(10);\n            } catch (InterruptedException e) {\n            }\n        }\n\n        public int wrong() {\n            long begin = System.currentTimeMillis();\n            IntStream.rangeClosed(1, 1000).parallel().forEach(i -> {\n                synchronized (this) {\n                    slow();\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", System.currentTimeMillis() - begin);\n            return data.size();\n        }\n\n        public int right() {\n            long begin = System.currentTimeMillis();\n            IntStream.rangeClosed(1, 1000).parallel().forEach(i -> {\n                slow();\n                synchronized (data) {\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", System.currentTimeMillis() - begin);\n            return data.size();\n        }\n\n    }\n\n}\n\n\n\n# åèèµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * Java å¹¶åç¼ç¨ï¼volatile å³é®å­è§£æ\n * Java å¹¶åç¼ç¨ï¼synchronized\n * æ·±å¥çè§£ Java å¹¶åä¹ synchronized å®ç°åç\n * Java CAS å®å¨è§£è¯»\n * Java ä¸­ CAS è¯¦è§£\n * ThreadLocal ç»æç¯\n * synchronized å®ç°åçåéä¼å\n * Non-blocking Algorithms',normalizedContent:'# synchronized\n\n\n# synchronized çç®ä»\n\nsynchronized æ¯ java ä¸­çå³é®å­ï¼æ¯ å©ç¨éçæºå¶æ¥å®ç°äºæ¥åæ­¥çã\n\nsynchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\nå¦æä¸éè¦ lock ãreadwritelock ææä¾çé«çº§åæ­¥ç¹æ§ï¼åºè¯¥ä¼åèèä½¿ç¨ synchronized ï¼çç±å¦ä¸ï¼\n\n * java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ lock ãreadwritelock åºæ¬ä¸æå¹³ãä»è¶å¿æ¥çï¼java æªæ¥ä»å°ç»§ç»­ä¼å synchronized ï¼èä¸æ¯ reentrantlock ã\n * reentrantlock æ¯ oracle jdk ç apiï¼å¨å¶ä»çæ¬ç jdk ä¸­ä¸ä¸å®æ¯æï¼è synchronized æ¯ jvm çåç½®ç¹æ§ï¼ææ jdk çæ¬é½æä¾æ¯æã\n\n\n# synchronized çåºç¨\n\nsynchronized æ 3 ç§åºç¨æ¹å¼ï¼\n\n * åæ­¥å®ä¾æ¹æ³ - å¯¹äºæ®éåæ­¥æ¹æ³ï¼éæ¯å½åå®ä¾å¯¹è±¡\n * åæ­¥éææ¹æ³ - å¯¹äºéæåæ­¥æ¹æ³ï¼éæ¯å½åç±»ç class å¯¹è±¡\n * åæ­¥ä»£ç å - å¯¹äºåæ­¥æ¹æ³åï¼éæ¯ synchonized æ¬å·ééç½®çå¯¹è±¡\n\n> è¯´æï¼\n> \n> ç±»ä¼¼ vectorãhashtable è¿ç±»åæ­¥ç±»ï¼å°±æ¯ä½¿ç¨ synchonized ä¿®é¥°å¶éè¦æ¹æ³ï¼æ¥ä¿è¯å¶çº¿ç¨å®å¨ã\n> \n> äºå®ä¸ï¼è¿ç±»åæ­¥å®¹å¨ä¹éç»å¯¹ççº¿ç¨å®å¨ï¼å½æ§è¡è¿­ä»£å¨éåï¼æ ¹æ®æ¡ä»¶å é¤åç´ è¿ç§åºæ¯ä¸ï¼å°±å¯è½åºç°çº¿ç¨ä¸å®å¨çæåµãæ­¤å¤ï¼java 1.6 éå¯¹ synchonized è¿è¡ä¼ååï¼ç±äºé»å¡ï¼å¶æ§è½ä¸é«ã\n> \n> ç»¼ä¸ï¼è¿ç±»åæ­¥å®¹å¨ï¼å¨ç°ä»£ java ç¨åºä¸­ï¼å·²ç»æ¸æ¸ä¸ç¨äºã\n\n\n# åæ­¥å®ä¾æ¹æ³\n\nâ éè¯¯ç¤ºä¾ - æªåæ­¥çç¤ºä¾\n\npublic class nosynchronizeddemo implements runnable {\n\n    public static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        nosynchronizeddemo instance = new nosynchronizeddemo();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    public void increase() {\n        count++;\n    }\n\n}\n// è¾åºç»æ: å°äº 200000 çéæºæ°å­\n\n\njava å®ä¾æ¹æ³åæ­¥æ¯åæ­¥å¨æ¥æè¯¥æ¹æ³çå¯¹è±¡ä¸ãè¿æ ·ï¼æ¯ä¸ªå®ä¾å¶æ¹æ³åæ­¥é½åæ­¥å¨ä¸åçå¯¹è±¡ä¸ï¼å³è¯¥æ¹æ³æå±çå®ä¾ãåªæä¸ä¸ªçº¿ç¨è½å¤å¨å®ä¾æ¹æ³åæ­¥åä¸­è¿è¡ãå¦ææå¤ä¸ªå®ä¾å­å¨ï¼é£ä¹ä¸ä¸ªçº¿ç¨ä¸æ¬¡å¯ä»¥å¨ä¸ä¸ªå®ä¾åæ­¥åä¸­æ§è¡æä½ãä¸ä¸ªå®ä¾ä¸ä¸ªçº¿ç¨ã\n\npublic class synchronizeddemo implements runnable {\n\n    private static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        synchronizeddemo instance = new synchronizeddemo();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°æ®éæ¹æ³\n     */\n    public synchronized void increase() {\n        count++;\n    }\n\n}\n\n\nãç¤ºä¾ãéè¯¯ç¤ºä¾\n\nclass account {\n  private int balance;\n  // è½¬è´¦\n  synchronized void transfer(\n      account target, int amt){\n    if (this.balance > amt) {\n      this.balance -= amt;\n      target.balance += amt;\n    }\n  }\n}\n\n\nå¨è¿æ®µä»£ç ä¸­ï¼ä¸´çåºåæä¸¤ä¸ªèµæºï¼åå«æ¯è½¬åºè´¦æ·çä½é¢ this.balance åè½¬å¥è´¦æ·çä½é¢ target.balanceï¼å¹¶ä¸ç¨çæ¯ä¸æé thisï¼ç¬¦åæä»¬åé¢æå°çï¼å¤ä¸ªèµæºå¯ä»¥ç¨ä¸æéæ¥ä¿æ¤ï¼è¿çä¸å»å®å¨æ­£ç¡®åãççæ¯è¿æ ·åï¼å¯æï¼è¿ä¸ªæ¹æ¡ä»ä»æ¯çä¼¼æ­£ç¡®ï¼ä¸ºä»ä¹å¢ï¼\n\né®é¢å°±åºå¨ this è¿æéä¸ï¼this è¿æéå¯ä»¥ä¿æ¤èªå·±çä½é¢ this.balanceï¼å´ä¿æ¤ä¸äºå«äººçä½é¢ target.balanceï¼å°±åä½ ä¸è½ç¨èªå®¶çéæ¥ä¿æ¤å«äººå®¶çèµäº§ï¼ä¹ä¸è½ç¨èªå·±çç¥¨æ¥ä¿æ¤å«äººçåº§ä½ä¸æ ·ã\n\n\n\nåºè¯¥ä¿è¯ä½¿ç¨çéè½è¦çææåä¿æ¤èµæºã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass account {\n  private object lockï¼\n  private int balance;\n  private account();\n  // åå»º account æ¶ä¼ å¥åä¸ä¸ª lock å¯¹è±¡\n  public account(object lock) {\n    this.lock = lock;\n  }\n  // è½¬è´¦\n  void transfer(account target, int amt){\n    // æ­¤å¤æ£æ¥ææå¯¹è±¡å±äº«çé\n    synchronized(lock) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\nè¿ä¸ªåæ³ç¡®å®è½è§£å³é®é¢ï¼ä½æ¯æç¹å°ççµï¼å®è¦æ±å¨åå»º account å¯¹è±¡çæ¶åå¿é¡»ä¼ å¥åä¸ä¸ªå¯¹è±¡ï¼å¦æåå»º account å¯¹è±¡æ¶ï¼ä¼ å¥ç lock ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼é£å¯å°±æ¨äºï¼ä¼åºç°éèªå®¶é¨æ¥ä¿æ¤ä»å®¶èµäº§çèåäºãå¨çå®çé¡¹ç®åºæ¯ä¸­ï¼åå»º account å¯¹è±¡çä»£ç å¾å¯è½åæ£å¨å¤ä¸ªå·¥ç¨ä¸­ï¼ä¼ å¥å±äº«ç lock ççå¾é¾ã\n\nä¸é¢çæ¹æ¡ç¼ºä¹å®è·µçå¯è¡æ§ï¼æä»¬éè¦æ´å¥½çæ¹æ¡ãè¿çæï¼å°±æ¯ç¨ account.class ä½ä¸ºå±äº«çéãaccount.class æ¯ææ account å¯¹è±¡å±äº«çï¼èä¸è¿ä¸ªå¯¹è±¡æ¯ java èææºå¨å è½½ account ç±»çæ¶ååå»ºçï¼æä»¥æä»¬ä¸ç¨æå¿å®çå¯ä¸æ§ãä½¿ç¨ account.class ä½ä¸ºå±äº«çéï¼æä»¬å°±æ éå¨åå»º account å¯¹è±¡æ¶ä¼ å¥äºï¼ä»£ç æ´ç®åã\n\nãç¤ºä¾ãæ­£ç¡®å§¿å¿\n\nclass account {\n  private int balance;\n  // è½¬è´¦\n  void transfer(account target, int amt){\n    synchronized(account.class) {\n      if (this.balance > amt) {\n        this.balance -= amt;\n        target.balance += amt;\n      }\n    }\n  }\n}\n\n\n\n# åæ­¥éææ¹æ³\n\néææ¹æ³çåæ­¥æ¯æåæ­¥å¨è¯¥æ¹æ³æå¨çç±»å¯¹è±¡ä¸ãå ä¸ºå¨ jvm ä¸­ä¸ä¸ªç±»åªè½å¯¹åºä¸ä¸ªç±»å¯¹è±¡ï¼æä»¥åæ¶åªåè®¸ä¸ä¸ªçº¿ç¨æ§è¡åä¸ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³ã\n\nå¯¹äºä¸åç±»ä¸­çéæåæ­¥æ¹æ³ï¼ä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æ¯ä¸ªç±»ä¸­çéæåæ­¥æ¹æ³èæ éç­å¾ãä¸ç®¡ç±»ä¸­çé£ä¸ªéæåæ­¥æ¹æ³è¢«è°ç¨ï¼ä¸ä¸ªç±»åªè½ç±ä¸ä¸ªçº¿ç¨åæ¶æ§è¡ã\n\npublic class synchronizeddemo2 implements runnable {\n\n    private static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        synchronizeddemo2 instance = new synchronizeddemo2();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°éææ¹æ³\n     */\n    public synchronized static void increase() {\n        count++;\n    }\n\n}\n\n\n\n# åæ­¥ä»£ç å\n\nææ¶ä½ ä¸éè¦åæ­¥æ´ä¸ªæ¹æ³ï¼èæ¯åæ­¥æ¹æ³ä¸­çä¸é¨åãjava å¯ä»¥å¯¹æ¹æ³çä¸é¨åè¿è¡åæ­¥ã\n\næ³¨æ java åæ­¥åæé å¨ç¨æ¬å·å°å¯¹è±¡æ¬èµ·æ¥ãå¨ä¸ä¾ä¸­ï¼ä½¿ç¨äº thisï¼å³ä¸ºè°ç¨ add æ¹æ³çå®ä¾æ¬èº«ãå¨åæ­¥æé å¨ä¸­ç¨æ¬å·æ¬èµ·æ¥çå¯¹è±¡å«åçè§å¨å¯¹è±¡ãä¸è¿°ä»£ç ä½¿ç¨çè§å¨å¯¹è±¡åæ­¥ï¼åæ­¥å®ä¾æ¹æ³ä½¿ç¨è°ç¨æ¹æ³æ¬èº«çå®ä¾ä½ä¸ºçè§å¨å¯¹è±¡ã\n\nä¸æ¬¡åªæä¸ä¸ªçº¿ç¨è½å¤å¨åæ­¥äºåä¸ä¸ªçè§å¨å¯¹è±¡ç java æ¹æ³åæ§è¡ã\n\npublic class synchronizeddemo3 implements runnable {\n\n    private static final int max = 100000;\n\n    private static int count = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        synchronizeddemo3 instance = new synchronizeddemo3();\n        thread t1 = new thread(instance);\n        thread t2 = new thread(instance);\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(count);\n    }\n\n    @override\n    public void run() {\n        for (int i = 0; i < max; i++) {\n            increase();\n        }\n    }\n\n    /**\n     * synchronized ä¿®é¥°ä»£ç å\n     */\n    public static void increase() {\n        synchronized (synchronizeddemo3.class) {\n            count++;\n        }\n    }\n\n}\n\n\n\n# synchronized çåç\n\nsynchronized ä»£ç åæ¯ç±ä¸å¯¹ monitorenter å monitorexit æä»¤å®ç°çï¼monitor å¯¹è±¡æ¯åæ­¥çåºæ¬å®ç°ååãå¨ java 6 ä¹åï¼monitor çå®ç°å®å¨æ¯ä¾é æä½ç³»ç»åé¨çäºæ¥éï¼å ä¸ºéè¦è¿è¡ç¨æ·æå°åæ ¸æçåæ¢ï¼æä»¥åæ­¥æä½æ¯ä¸ä¸ªæ å·®å«çééçº§æä½ã\n\nå¦æ synchronized æç¡®å¶å®äºå¯¹è±¡åæ°ï¼é£å°±æ¯è¿ä¸ªå¯¹è±¡çå¼ç¨ï¼å¦ææ²¡ææç¡®æå®ï¼é£å°±æ ¹æ® synchronized ä¿®é¥°çæ¯å®ä¾æ¹æ³è¿æ¯éææ¹æ³ï¼å»å¯¹å¯¹åºçå¯¹è±¡å®ä¾æ class å¯¹è±¡æ¥ä½ä¸ºéå¯¹è±¡ã\n\nsynchronized åæ­¥åå¯¹åä¸çº¿ç¨æ¥è¯´æ¯å¯éå¥çï¼ä¸ä¼åºç°éæ­»é®é¢ã\n\nsynchronized åæ­¥åæ¯äºæ¥çï¼å³å·²è¿å¥ççº¿ç¨æ§è¡å®æåï¼ä¼é»å¡å¶ä»è¯å¾è¿å¥ççº¿ç¨ã\n\nãç¤ºä¾ã\n\npublic void foo(object lock) {\n    synchronized (lock) {\n      lock.hashcode();\n    }\n  }\n  // ä¸é¢ç java ä»£ç å°ç¼è¯ä¸ºä¸é¢çå­èç \n  public void foo(java.lang.object);\n    code:\n       0: aload_1\n       1: dup\n       2: astore_2\n       3: monitorenter\n       4: aload_1\n       5: invokevirtual java/lang/object.hashcode:()i\n       8: pop\n       9: aload_2\n      10: monitorexit\n      11: goto          19\n      14: astore_3\n      15: aload_2\n      16: monitorexit\n      17: aload_3\n      18: athrow\n      19: return\n    exception table:\n       from    to  target type\n           4    11    14   any\n          14    17    14   any\n\n\n\n\n# åæ­¥ä»£ç å\n\nsynchronized å¨ä¿®é¥°åæ­¥ä»£ç åæ¶ï¼æ¯ç± monitorenter å monitorexit æä»¤æ¥å®ç°åæ­¥çãè¿å¥ monitorenter æä»¤åï¼çº¿ç¨å°ææ monitor å¯¹è±¡ï¼éåº monitorenter æä»¤åï¼çº¿ç¨å°éæ¾è¯¥ monitor å¯¹è±¡ã\n\n\n# åæ­¥æ¹æ³\n\nsynchronized ä¿®é¥°åæ­¥æ¹æ³æ¶ï¼ä¼è®¾ç½®ä¸ä¸ª acc_synchronized æ å¿ãå½æ¹æ³è°ç¨æ¶ï¼è°ç¨æä»¤å°ä¼æ£æ¥è¯¥æ¹æ³æ¯å¦è¢«è®¾ç½® acc_synchronized è®¿é®æ å¿ãå¦æè®¾ç½®äºè¯¥æ å¿ï¼æ§è¡çº¿ç¨å°åææ monitor å¯¹è±¡ï¼ç¶ååæ§è¡æ¹æ³ãå¨è¯¥æ¹æ³è¿è¡æé´ï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ mointor å¯¹è±¡ï¼å½æ¹æ³æ§è¡å®æåï¼åéæ¾è¯¥ monitor å¯¹è±¡ã\n\n\n# monitor\n\næ¯ä¸ªå¯¹è±¡å®ä¾é½ä¼æä¸ä¸ª monitorï¼monitor å¯ä»¥åå¯¹è±¡ä¸èµ·åå»ºãéæ¯ãmonitor æ¯ç± objectmonitor å®ç°ï¼è objectmonitor æ¯ç± c++ ç objectmonitor.hpp æä»¶å®ç°ã\n\nå½å¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸æ®µåæ­¥ä»£ç æ¶ï¼å¤ä¸ªçº¿ç¨ä¼åè¢«å­æ¾å¨ entrylist éåä¸­ï¼å¤äº block ç¶æççº¿ç¨ï¼é½ä¼è¢«å å¥å°è¯¥åè¡¨ãæ¥ä¸æ¥å½çº¿ç¨è·åå°å¯¹è±¡ç monitor æ¶ï¼monitor æ¯ä¾é åºå±æä½ç³»ç»ç mutex lock æ¥å®ç°äºæ¥çï¼çº¿ç¨ç³è¯· mutex æåï¼åææè¯¥ mutexï¼å¶å®çº¿ç¨å°æ æ³è·åå°è¯¥ mutexã\n\nå¦æçº¿ç¨è°ç¨ wait() æ¹æ³ï¼å°±ä¼éæ¾å½åææç mutexï¼å¹¶ä¸è¯¥çº¿ç¨ä¼è¿å¥ waitset éåä¸­ï¼ç­å¾ä¸ä¸æ¬¡è¢«å¤éãå¦æå½åçº¿ç¨é¡ºå©æ§è¡å®æ¹æ³ï¼ä¹å°éæ¾ mutexã\n\n\n# synchronized çä¼å\n\n> java 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ lock ãreadwritelock åºæ¬ä¸æå¹³ã\n\n\n# java å¯¹è±¡å¤´\n\nå¨ jdk1.6 jvm ä¸­ï¼å¯¹è±¡å®ä¾å¨å åå­ä¸­è¢«åä¸ºäºä¸ä¸ªé¨åï¼å¯¹è±¡å¤´ãå®ä¾æ°æ®åå¯¹é½å¡«åãå¶ä¸­ java å¯¹è±¡å¤´ç± mark wordãæåç±»çæéä»¥åæ°ç»é¿åº¦ä¸é¨åç»æã\n\nmark word è®°å½äºå¯¹è±¡åéæå³çä¿¡æ¯ãmark word å¨ 64 ä½ jvm ä¸­çé¿åº¦æ¯ 64bitï¼æä»¬å¯ä»¥ä¸èµ·çä¸ 64 ä½ jvm çå­å¨ç»ææ¯æä¹æ ·çãå¦ä¸å¾æç¤ºï¼\n\n\n\néåçº§åè½ä¸»è¦ä¾èµäº mark word ä¸­çéæ å¿ä½åéæ¾ååéæ å¿ä½ï¼synchronized åæ­¥éå°±æ¯ä»ååéå¼å§çï¼éçç«äºè¶æ¥è¶æ¿çï¼ååéåçº§å°è½»éçº§éï¼æç»åçº§å°ééçº§éã\n\njava 1.6 å¼å¥äºååéåè½»éçº§éï¼ä»èè®© synchronized æ¥æäºåä¸ªç¶æï¼\n\n * æ éç¶æï¼unlockedï¼\n * ååéç¶æï¼biasbleï¼\n * è½»éçº§éç¶æï¼lightweight lockedï¼\n * ééçº§éç¶æï¼inflatedï¼\n\nå½ jvm æ£æµå°ä¸åçç«äºç¶åµæ¶ï¼ä¼èªå¨åæ¢å°éåçéå®ç°ã\n\nå½æ²¡æç«äºåºç°æ¶ï¼é»è®¤ä¼ä½¿ç¨ååéãjvm ä¼å©ç¨ cas æä½ï¼compare and swapï¼ï¼å¨å¯¹è±¡å¤´ä¸ç mark word é¨åè®¾ç½®çº¿ç¨ idï¼ä»¥è¡¨ç¤ºè¿ä¸ªå¯¹è±¡ååäºå½åçº¿ç¨ï¼æä»¥å¹¶ä¸æ¶åçæ­£çäºæ¥éãè¿æ ·åçåè®¾æ¯åºäºå¨å¾å¤åºç¨åºæ¯ä¸­ï¼å¤§é¨åå¯¹è±¡çå½å¨æä¸­æå¤ä¼è¢«ä¸ä¸ªçº¿ç¨éå®ï¼ä½¿ç¨åæéå¯ä»¥éä½æ ç«äºå¼éã\n\nå¦ææå¦å¤ççº¿ç¨è¯å¾éå®æä¸ªå·²ç»è¢«åæè¿çå¯¹è±¡ï¼jvm å°±éè¦æ¤éï¼revokeï¼ååéï¼å¹¶åæ¢å°è½»éçº§éå®ç°ãè½»éçº§éä¾èµ cas æä½ mark word æ¥è¯å¾è·åéï¼å¦æéè¯æåï¼å°±ä½¿ç¨æ®éçè½»éçº§éï¼å¦åï¼è¿ä¸æ­¥åçº§ä¸ºééçº§éã\n\n\n# ååé\n\nååéçææ³æ¯ååäºç¬¬ä¸ä¸ªè·åéå¯¹è±¡ççº¿ç¨ï¼è¿ä¸ªçº¿ç¨å¨ä¹åè·åè¯¥éå°±ä¸åéè¦è¿è¡åæ­¥æä½ï¼çè³è¿ cas æä½ä¹ä¸åéè¦ã\n\n\n\n\n# è½»éçº§é\n\nè½»éçº§éæ¯ç¸å¯¹äºä¼ ç»çééçº§éèè¨ï¼å® ä½¿ç¨ cas æä½æ¥é¿åééçº§éä½¿ç¨äºæ¥éçå¼éãå¯¹äºç»å¤§é¨åçéï¼å¨æ´ä¸ªåæ­¥å¨æåé½æ¯ä¸å­å¨ç«äºçï¼å æ­¤ä¹å°±ä¸éè¦é½ä½¿ç¨äºæ¥éè¿è¡åæ­¥ï¼å¯ä»¥åéç¨ cas æä½è¿è¡åæ­¥ï¼å¦æ cas å¤±è´¥äºåæ¹ç¨äºæ¥éè¿è¡åæ­¥ã\n\nå½å°è¯è·åä¸ä¸ªéå¯¹è±¡æ¶ï¼å¦æéå¯¹è±¡æ è®°ä¸º 0|01ï¼è¯´æéå¯¹è±¡çéæªéå®ï¼unlockedï¼ç¶æãæ­¤æ¶èææºå¨å½åçº¿ç¨çèææºæ ä¸­åå»º lock recordï¼ç¶åä½¿ç¨ cas æä½å°å¯¹è±¡ç mark word æ´æ°ä¸º lock record æéãå¦æ cas æä½æåäºï¼é£ä¹çº¿ç¨å°±è·åäºè¯¥å¯¹è±¡ä¸çéï¼å¹¶ä¸å¯¹è±¡ç mark word çéæ è®°åä¸º 00ï¼è¡¨ç¤ºè¯¥å¯¹è±¡å¤äºè½»éçº§éç¶æã\n\n\n\n\n# éæ¶é¤ / éç²å\n\né¤äºéåçº§ä¼åï¼java è¿ä½¿ç¨äºç¼è¯å¨å¯¹éè¿è¡ä¼åã\n\n# éæ¶é¤\n\néæ¶é¤æ¯æå¯¹äºè¢«æ£æµåºä¸å¯è½å­å¨ç«äºçå±äº«æ°æ®çéè¿è¡æ¶é¤ã\n\njit ç¼è¯å¨å¨å¨æç¼è¯åæ­¥åçæ¶åï¼åå©äºä¸ç§è¢«ç§°ä¸ºéé¸åæçææ¯ï¼æ¥å¤æ­åæ­¥åä½¿ç¨çéå¯¹è±¡æ¯å¦åªè½å¤è¢«ä¸ä¸ªçº¿ç¨è®¿é®ï¼èæ²¡æè¢«åå¸å°å¶å®çº¿ç¨ã\n\nç¡®è®¤æ¯çè¯ï¼é£ä¹ jit ç¼è¯å¨å¨ç¼è¯è¿ä¸ªåæ­¥åçæ¶åä¸ä¼çæ synchronized æè¡¨ç¤ºçéçç³è¯·ä¸éæ¾çæºå¨ç ï¼å³æ¶é¤äºéçä½¿ç¨ãå¨ java7 ä¹åççæ¬å°±ä¸éè¦æå¨éç½®äºï¼è¯¥æä½å¯ä»¥èªå¨å®ç°ã\n\nå¯¹äºä¸äºçèµ·æ¥æ²¡æå éçä»£ç ï¼å¶å®éå¼çå äºå¾å¤éãä¾å¦ä¸é¢çå­ç¬¦ä¸²æ¼æ¥ä»£ç å°±éå¼å äºéï¼\n\npublic static string concatstring(string s1, string s2, string s3) {\n    return s1 + s2 + s3;\n}\n\n\nstring æ¯ä¸ä¸ªä¸å¯åçç±»ï¼ç¼è¯å¨ä¼å¯¹ string çæ¼æ¥èªå¨ä¼åãå¨ java 1.5 ä¹åï¼ä¼è½¬åä¸º stringbuffer å¯¹è±¡çè¿ç»­ append() æä½ï¼\n\npublic static string concatstring(string s1, string s2, string s3) {\n    stringbuffer sb = new stringbuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.tostring();\n}\n\n\næ¯ä¸ª append() æ¹æ³ä¸­é½æä¸ä¸ªåæ­¥åãèææºè§å¯åé sbï¼å¾å¿«å°±ä¼åç°å®çå¨æä½ç¨åè¢«éå¶å¨ concatstring() æ¹æ³åé¨ãä¹å°±æ¯è¯´ï¼sb çææå¼ç¨æ°¸è¿ä¸ä¼éé¸å° concatstring() æ¹æ³ä¹å¤ï¼å¶ä»çº¿ç¨æ æ³è®¿é®å°å®ï¼å æ­¤å¯ä»¥è¿è¡æ¶é¤ã\n\n# éç²å\n\néç²ååçï¼å°±æ¯å¨ jit ç¼è¯å¨å¨æç¼è¯æ¶ï¼å¦æåç°å ä¸ªç¸é»çåæ­¥åä½¿ç¨çæ¯åä¸ä¸ªéå®ä¾ï¼é£ä¹ jit ç¼è¯å¨å°ä¼æè¿å ä¸ªåæ­¥ååå¹¶ä¸ºä¸ä¸ªå¤§çåæ­¥åï¼ä»èé¿åä¸ä¸ªçº¿ç¨âåå¤ç³è¯·ãéæ¾åä¸ä¸ªéâæå¸¦æ¥çæ§è½å¼éã\n\nå¦æä¸ç³»åçè¿ç»­æä½é½å¯¹åä¸ä¸ªå¯¹è±¡åå¤å éåè§£éï¼é¢ç¹çå éæä½å°±ä¼å¯¼è´æ§è½æèã\n\nä¸ä¸èçç¤ºä¾ä»£ç ä¸­è¿ç»­ç append() æ¹æ³å°±å±äºè¿ç±»æåµãå¦æèææºæ¢æµå°ç±è¿æ ·çä¸ä¸²é¶ç¢çæä½é½å¯¹åä¸ä¸ªå¯¹è±¡å éï¼å°ä¼æå éçèå´æ©å±ï¼ç²åï¼å°æ´ä¸ªæä½åºåçå¤é¨ãå¯¹äºä¸ä¸èçç¤ºä¾ä»£ç å°±æ¯æ©å±å°ç¬¬ä¸ä¸ª append() æä½ä¹åç´è³æåä¸ä¸ª append() æä½ä¹åï¼è¿æ ·åªéè¦å éä¸æ¬¡å°±å¯ä»¥äºã\n\n\n# èªæé\n\näºæ¥åæ­¥è¿å¥é»å¡ç¶æçå¼éé½å¾å¤§ï¼åºè¯¥å°½éé¿åãå¨è®¸å¤åºç¨ä¸­ï¼å±äº«æ°æ®çéå®ç¶æåªä¼æç»­å¾ç­çä¸æ®µæ¶é´ãèªæéçææ³æ¯è®©ä¸ä¸ªçº¿ç¨å¨è¯·æ±ä¸ä¸ªå±äº«æ°æ®çéæ¶æ§è¡å¿å¾ªç¯ï¼èªæï¼ä¸æ®µæ¶é´ï¼å¦æå¨è¿æ®µæ¶é´åè½è·å¾éï¼å°±å¯ä»¥é¿åè¿å¥é»å¡ç¶æã\n\nèªæéè½ç¶è½é¿åè¿å¥é»å¡ç¶æä»èåå°å¼éï¼ä½æ¯å®éè¦è¿è¡å¿å¾ªç¯æä½å ç¨ cpu æ¶é´ï¼å®åªéç¨äºå±äº«æ°æ®çéå®ç¶æå¾ç­çåºæ¯ã\n\nå¨ java 1.6 ä¸­å¼å¥äºèªéåºçèªæéãèªéåºæå³çèªæçæ¬¡æ°ä¸ååºå®äºï¼èæ¯ç±åä¸æ¬¡å¨åä¸ä¸ªéä¸çèªææ¬¡æ°åéçæ¥æèçç¶ææ¥å³å®ã\n\n\n# synchronized çè¯¯åº\n\n> ç¤ºä¾æèªï¼ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n\n\n# synchronized ä½¿ç¨èå´ä¸å½å¯¼è´çéè¯¯\n\npublic class interesting {\n\n    volatile int a = 1;\n    volatile int b = 1;\n\n    public static void main(string[] args) {\n        interesting interesting = new interesting();\n        new thread(() -> interesting.add()).start();\n        new thread(() -> interesting.compare()).start();\n    }\n\n    public synchronized void add() {\n        log.info("add start");\n        for (int i = 0; i < 10000; i++) {\n            a++;\n            b++;\n        }\n        log.info("add done");\n    }\n\n    public void compare() {\n        log.info("compare start");\n        for (int i = 0; i < 10000; i++) {\n            //aå§ç»ç­äºbåï¼\n            if (a < b) {\n                log.info("a:{},b:{},{}", a, b, a > b);\n                //æåça>båºè¯¥å§ç»æ¯falseåï¼\n            }\n        }\n        log.info("compare done");\n    }\n\n}\n\n\nãè¾åºã\n\n16:05:25.541 [thread-0] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add start\n16:05:25.544 [thread-0] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - add done\n16:05:25.544 [thread-1] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare start\n16:05:25.544 [thread-1] info io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç¨èå´ä¸å½ - compare done\n\n\nä¹æä»¥åºç°è¿ç§éä¹±ï¼æ¯å ä¸ºä¸¤ä¸ªçº¿ç¨æ¯äº¤éæ§è¡ add å compare æ¹æ³ä¸­çä¸å¡é»è¾ï¼èä¸è¿äºä¸å¡é»è¾ä¸æ¯åå­æ§çï¼a++ å b++ æä½ä¸­å¯ä»¥ç©¿æå¨ compare æ¹æ³çæ¯è¾ä»£ç ä¸­ï¼æ´éè¦æ³¨æçæ¯ï¼a<b è¿ç§æ¯è¾æä½å¨å­èç å±é¢æ¯å è½½ aãå è½½ b åæ¯è¾ä¸æ­¥ï¼ä»£ç è½ç¶æ¯ä¸è¡ä½ä¹ä¸æ¯åå­æ§çã\n\næä»¥ï¼æ­£ç¡®çåæ³åºè¯¥æ¯ï¼ä¸º add å compare é½å ä¸æ¹æ³éï¼ç¡®ä¿ add æ¹æ³æ§è¡æ¶ï¼compare æ æ³è¯»å a å bï¼\n\npublic synchronized void add()\npublic synchronized void compare()\n\n\næä»¥ï¼ä½¿ç¨éè§£å³é®é¢ä¹åä¸å®è¦çæ¸æ¥ï¼æä»¬è¦ä¿æ¤çæ¯ä»ä¹é»è¾ï¼å¤çº¿ç¨æ§è¡çæåµåæ¯ææ ·çã\n\n\n# synchronized ä¿æ¤å¯¹è±¡ä¸å¯¹å¯¼è´çéè¯¯\n\nå éåè¦æ¸æ¥éåè¢«ä¿æ¤çå¯¹è±¡æ¯ä¸æ¯ä¸ä¸ªå±é¢çã\n\néæå­æ®µå±äºç±»ï¼ç±»çº§å«çéæè½ä¿æ¤ï¼èééæå­æ®µå±äºç±»å®ä¾ï¼å®ä¾çº§å«çéå°±å¯ä»¥ä¿æ¤ã\n\npublic class synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 {\n\n    public static void main(string[] args) {\n        synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2 demo = new synchronizedéè¯¯ä½¿ç¨ç¤ºä¾2();\n        system.out.println(demo.wrong(1000000));\n        system.out.println(demo.right(1000000));\n    }\n\n    public int wrong(int count) {\n        data.reset();\n        intstream.rangeclosed(1, count).parallel().foreach(i -> new data().wrong());\n        return data.getcounter();\n    }\n\n    public int right(int count) {\n        data.reset();\n        intstream.rangeclosed(1, count).parallel().foreach(i -> new data().right());\n        return data.getcounter();\n    }\n\n    private static class data {\n\n        @getter\n        private static int counter = 0;\n        private static object locker = new object();\n\n        public static int reset() {\n            counter = 0;\n            return counter;\n        }\n\n        public synchronized void wrong() {\n            counter++;\n        }\n\n        public void right() {\n            synchronized (locker) {\n                counter++;\n            }\n        }\n\n    }\n\n}\n\n\nwrong æ¹æ³ä¸­è¯å¾å¯¹ä¸ä¸ªéæå¯¹è±¡å å¯¹è±¡çº§å«ç synchronized éï¼å¹¶ä¸è½ä¿è¯çº¿ç¨å®å¨ã\n\n\n# éç²åº¦å¯¼è´çé®é¢\n\nè¦å°½å¯è½çç¼©å°å éçèå´ï¼è¿å¯ä»¥æé«å¹¶åååã\n\nå¦æç²¾ç»åèèäºéåºç¨èå´åï¼æ§è½è¿æ æ³æ»¡è¶³éæ±çè¯ï¼æä»¬å°±è¦èèå¦ä¸ä¸ªç»´åº¦çç²åº¦é®é¢äºï¼å³ï¼åºåè¯»ååºæ¯ä»¥åèµæºçè®¿é®å²çªï¼èèä½¿ç¨æ²è§æ¹å¼çéè¿æ¯ä¹è§æ¹å¼çéã\n\npublic class synchronizedéç²åº¦ä¸å½ {\n\n    public static void main(string[] args) {\n        demo demo = new demo();\n        demo.wrong();\n        demo.right();\n    }\n\n    private static class demo {\n\n        private list<integer> data = new arraylist<>();\n\n        private void slow() {\n            try {\n                timeunit.milliseconds.sleep(10);\n            } catch (interruptedexception e) {\n            }\n        }\n\n        public int wrong() {\n            long begin = system.currenttimemillis();\n            intstream.rangeclosed(1, 1000).parallel().foreach(i -> {\n                synchronized (this) {\n                    slow();\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", system.currenttimemillis() - begin);\n            return data.size();\n        }\n\n        public int right() {\n            long begin = system.currenttimemillis();\n            intstream.rangeclosed(1, 1000).parallel().foreach(i -> {\n                slow();\n                synchronized (data) {\n                    data.add(i);\n                }\n            });\n            log.info("took:{}", system.currenttimemillis() - begin);\n            return data.size();\n        }\n\n    }\n\n}\n\n\n\n# åèèµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ java èææºã\n * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * java å¹¶åç¼ç¨ï¼volatile å³é®å­è§£æ\n * java å¹¶åç¼ç¨ï¼synchronized\n * æ·±å¥çè§£ java å¹¶åä¹ synchronized å®ç°åç\n * java cas å®å¨è§£è¯»\n * java ä¸­ cas è¯¦è§£\n * threadlocal ç»æç¯\n * synchronized å®ç°åçåéä¼å\n * non-blocking algorithms',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å¹¶å",frontmatter:{title:"Java å¹¶å",date:"2020-06-04T13:51:01.000Z",categories:["Java","JavaSE","å¹¶å"],tags:["Java","JavaSE","å¹¶å"],permalink:"/pages/6e5393/",hidden:!0},regularPath:"/01.Java/01.JavaSE/05.%E5%B9%B6%E5%8F%91/",relativePath:"01.Java/01.JavaSE/05.å¹¶å/README.md",key:"v-364ddd94",path:"/pages/6e5393/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:236},{level:3,title:"Java å¹¶åç®ä»",slug:"java-å¹¶åç®ä»",normalizedTitle:"java å¹¶åç®ä»",charIndex:246},{level:3,title:"Java çº¿ç¨åºç¡",slug:"java-çº¿ç¨åºç¡",normalizedTitle:"java çº¿ç¨åºç¡",charIndex:298},{level:3,title:"Java å¹¶åæ ¸å¿æºå¶",slug:"java-å¹¶åæ ¸å¿æºå¶",normalizedTitle:"java å¹¶åæ ¸å¿æºå¶",charIndex:404},{level:3,title:"Java å¹¶åé",slug:"java-å¹¶åé",normalizedTitle:"java å¹¶åé",charIndex:465},{level:3,title:"Java åå­ç±»",slug:"java-åå­ç±»",normalizedTitle:"java åå­ç±»",charIndex:536},{level:3,title:"Java å¹¶åå®¹å¨",slug:"java-å¹¶åå®¹å¨",normalizedTitle:"java å¹¶åå®¹å¨",charIndex:567},{level:3,title:"Java çº¿ç¨æ± ",slug:"java-çº¿ç¨æ± ",normalizedTitle:"java çº¿ç¨æ± ",charIndex:627},{level:3,title:"Java å¹¶åå·¥å·ç±»",slug:"java-å¹¶åå·¥å·ç±»",normalizedTitle:"java å¹¶åå·¥å·ç±»",charIndex:701},{level:3,title:"Java åå­æ¨¡å",slug:"java-åå­æ¨¡å",normalizedTitle:"java åå­æ¨¡å",charIndex:762},{level:3,title:"ForkJoin æ¡æ¶",slug:"forkjoin-æ¡æ¶",normalizedTitle:"forkjoin æ¡æ¶",charIndex:835},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:851},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:1014}],headersStr:"ð åå®¹ Java å¹¶åç®ä» Java çº¿ç¨åºç¡ Java å¹¶åæ ¸å¿æºå¶ Java å¹¶åé Java åå­ç±» Java å¹¶åå®¹å¨ Java çº¿ç¨æ±  Java å¹¶åå·¥å·ç±» Java åå­æ¨¡å ForkJoin æ¡æ¶ ð èµæ ðª ä¼ é",content:"# Java å¹¶å\n\n> Java å¹¶åæ»ç»ãæ´ç Java å¹¶åç¼ç¨ç¸å³ç¥è¯ç¹ã\n> \n> å¹¶åç¼ç¨å¹¶é Java è¯­è¨æç¬æï¼èæ¯ä¸ç§æççç¼ç¨èå¼ï¼Java åªæ¯ç¨èªå·±çæ¹å¼å®ç°äºå¹¶åå·¥ä½æ¨¡åãå­¦ä¹  Java å¹¶åç¼ç¨ï¼åºè¯¥åçæå¹¶åçåºæ¬æ¦å¿µï¼ç¶åè¿ä¸æ­¥äºè§£å¹¶åçç¹æ§ä»¥åå¶ç¹æ§æé¢ä¸´çé®é¢ãææ¡äºè¿äºï¼å½å­¦ä¹  Java å¹¶åå·¥å·æ¶ï¼æä¼æç½å®ä»¬åèªæ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼ä¸ºä»ä¹è¦è¿æ ·è®¾è®¡ãéè¿è¿æ ·ç±ç¹å°é¢çå­¦ä¹ æ¹å¼ï¼æ´å®¹æèä¼è´¯éï¼å°å¹¶åç¥è¯å½¢æä½ç³»åã\n\n\n# ð åå®¹\n\n\n# Java å¹¶åç®ä»\n\n> å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n\n\n\n\n# Java çº¿ç¨åºç¡\n\n> å³é®è¯ï¼ThreadãRunnableãCallableãFutureãwaitãnotifyãnotifyAllãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n\n\n\n\n\n\n# Java å¹¶åæ ¸å¿æºå¶\n\n> å³é®è¯ï¼synchronizedãvolatileãCASãThreadLocal\n\n\n# Java å¹¶åé\n\n> å³é®è¯ï¼AQSãReentrantLockãReentrantReadWriteLockãCondition\n\n\n# Java åå­ç±»\n\n> å³é®è¯ï¼CASãAtomic\n\n\n# Java å¹¶åå®¹å¨\n\n> å³é®è¯ï¼ConcurrentHashMapãCopyOnWriteArrayList\n\n\n# Java çº¿ç¨æ± \n\n> å³é®è¯ï¼ExecutorãExecutorServiceãThreadPoolExecutorãExecutors\n\n\n# Java å¹¶åå·¥å·ç±»\n\n> å³é®è¯ï¼CountDownLatchãCyclicBarrierãSemaphore\n\n\n# Java åå­æ¨¡å\n\n> å³é®è¯ï¼JMMãvolatileãsynchronizedãfinalãHappens-Beforeãåå­å±é\n\n\n# ForkJoin æ¡æ¶\n\n\n# ð èµæ\n\n * ãJava å¹¶åç¼ç¨å®æã\n * ãJava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ Java èææºã\n * ãEffective Javaã\n * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * ãJava æ§è½è°ä¼å®æã\n * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * ãJava å¹¶åç¼ç¨å®æã\n\n\n# ðª ä¼ é\n\nâ¾ ð  JAVACORE é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# java å¹¶å\n\n> java å¹¶åæ»ç»ãæ´ç java å¹¶åç¼ç¨ç¸å³ç¥è¯ç¹ã\n> \n> å¹¶åç¼ç¨å¹¶é java è¯­è¨æç¬æï¼èæ¯ä¸ç§æççç¼ç¨èå¼ï¼java åªæ¯ç¨èªå·±çæ¹å¼å®ç°äºå¹¶åå·¥ä½æ¨¡åãå­¦ä¹  java å¹¶åç¼ç¨ï¼åºè¯¥åçæå¹¶åçåºæ¬æ¦å¿µï¼ç¶åè¿ä¸æ­¥äºè§£å¹¶åçç¹æ§ä»¥åå¶ç¹æ§æé¢ä¸´çé®é¢ãææ¡äºè¿äºï¼å½å­¦ä¹  java å¹¶åå·¥å·æ¶ï¼æä¼æç½å®ä»¬åèªæ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼ä¸ºä»ä¹è¦è¿æ ·è®¾è®¡ãéè¿è¿æ ·ç±ç¹å°é¢çå­¦ä¹ æ¹å¼ï¼æ´å®¹æèä¼è´¯éï¼å°å¹¶åç¥è¯å½¢æä½ç³»åã\n\n\n# ð åå®¹\n\n\n# java å¹¶åç®ä»\n\n> å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n\n\n\n\n# java çº¿ç¨åºç¡\n\n> å³é®è¯ï¼threadãrunnableãcallableãfutureãwaitãnotifyãnotifyallãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n\n\n\n\n\n\n# java å¹¶åæ ¸å¿æºå¶\n\n> å³é®è¯ï¼synchronizedãvolatileãcasãthreadlocal\n\n\n# java å¹¶åé\n\n> å³é®è¯ï¼aqsãreentrantlockãreentrantreadwritelockãcondition\n\n\n# java åå­ç±»\n\n> å³é®è¯ï¼casãatomic\n\n\n# java å¹¶åå®¹å¨\n\n> å³é®è¯ï¼concurrenthashmapãcopyonwritearraylist\n\n\n# java çº¿ç¨æ± \n\n> å³é®è¯ï¼executorãexecutorserviceãthreadpoolexecutorãexecutors\n\n\n# java å¹¶åå·¥å·ç±»\n\n> å³é®è¯ï¼countdownlatchãcyclicbarrierãsemaphore\n\n\n# java åå­æ¨¡å\n\n> å³é®è¯ï¼jmmãvolatileãsynchronizedãfinalãhappens-beforeãåå­å±é\n\n\n# forkjoin æ¡æ¶\n\n\n# ð èµæ\n\n * ãjava å¹¶åç¼ç¨å®æã\n * ãjava å¹¶åç¼ç¨çèºæ¯ã\n * ãæ·±å¥çè§£ java èææºã\n * ãeffective javaã\n * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * ãjava æ§è½è°ä¼å®æã\n * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * ãjava å¹¶åç¼ç¨å®æã\n\n\n# ðª ä¼ é\n\nâ¾ ð  javacore é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java åå­ç®¡ç",frontmatter:{title:"Java åå­ç®¡ç",date:"2020-06-28T16:19:00.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM"],permalink:"/pages/db5b69/"},regularPath:"/01.Java/01.JavaSE/06.JVM/02.JVM%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F.html",relativePath:"01.Java/01.JavaSE/06.JVM/02.JVMåå­åºå.md",key:"v-95392858",path:"/pages/db5b69/",headers:[{level:2,title:"åå­ç®ä»",slug:"åå­ç®ä»",normalizedTitle:"åå­ç®ä»",charIndex:16},{level:3,title:"ç©çåå­åèæåå­",slug:"ç©çåå­åèæåå­",normalizedTitle:"ç©çåå­åèæåå­",charIndex:25},{level:3,title:"åæ ¸ç©ºé´åç¨æ·ç©ºé´",slug:"åæ ¸ç©ºé´åç¨æ·ç©ºé´",normalizedTitle:"åæ ¸ç©ºé´åç¨æ·ç©ºé´",charIndex:119},{level:3,title:"ä½¿ç¨åå­ç Java ç»ä»¶",slug:"ä½¿ç¨åå­ç-java-ç»ä»¶",normalizedTitle:"ä½¿ç¨åå­ç java ç»ä»¶",charIndex:202},{level:2,title:"è¿è¡æ¶æ°æ®åºå",slug:"è¿è¡æ¶æ°æ®åºå",normalizedTitle:"è¿è¡æ¶æ°æ®åºå",charIndex:315},{level:3,title:"ç¨åºè®¡æ°å¨",slug:"ç¨åºè®¡æ°å¨",normalizedTitle:"ç¨åºè®¡æ°å¨",charIndex:444},{level:3,title:"Java èææºæ ",slug:"java-èææºæ ",normalizedTitle:"java èææºæ ",charIndex:884},{level:3,title:"æ¬å°æ¹æ³æ ",slug:"æ¬å°æ¹æ³æ ",normalizedTitle:"æ¬å°æ¹æ³æ ",charIndex:1688},{level:3,title:"Java å ",slug:"java-å ",normalizedTitle:"java å ",charIndex:271},{level:3,title:"æ¹æ³åº",slug:"æ¹æ³åº",normalizedTitle:"æ¹æ³åº",charIndex:1226},{level:3,title:"è¿è¡æ¶å¸¸éæ± ",slug:"è¿è¡æ¶å¸¸éæ± ",normalizedTitle:"è¿è¡æ¶å¸¸éæ± ",charIndex:1219},{level:3,title:"ç´æ¥åå­",slug:"ç´æ¥åå­",normalizedTitle:"ç´æ¥åå­",charIndex:3182},{level:3,title:"Java åå­åºåå¯¹æ¯",slug:"java-åå­åºåå¯¹æ¯",normalizedTitle:"java åå­åºåå¯¹æ¯",charIndex:3529},{level:2,title:"JVM è¿è¡åç",slug:"jvm-è¿è¡åç",normalizedTitle:"jvm è¿è¡åç",charIndex:3871},{level:2,title:"OutOfMemoryError",slug:"outofmemoryerror",normalizedTitle:"outofmemoryerror",charIndex:856},{level:3,title:"ä»ä¹æ¯ OutOfMemoryError",slug:"ä»ä¹æ¯-outofmemoryerror",normalizedTitle:"ä»ä¹æ¯ outofmemoryerror",charIndex:5637},{level:3,title:"å ç©ºé´æº¢åº",slug:"å ç©ºé´æº¢åº",normalizedTitle:"å ç©ºé´æº¢åº",charIndex:5829},{level:4,title:"Java heap space åææ­¥éª¤",slug:"java-heap-space-åææ­¥éª¤",normalizedTitle:"java heap space åææ­¥éª¤",charIndex:6144},{level:4,title:"åå­æ³æ¼",slug:"åå­æ³æ¼",normalizedTitle:"åå­æ³æ¼",charIndex:6030},{level:4,title:"åå­æº¢åº",slug:"åå­æº¢åº",normalizedTitle:"åå­æº¢åº",charIndex:6052},{level:3,title:"GC å¼éè¶è¿éå¶",slug:"gc-å¼éè¶è¿éå¶",normalizedTitle:"gc å¼éè¶è¿éå¶",charIndex:8225},{level:3,title:"æ°¸ä¹ä»£ç©ºé´ä¸è¶³",slug:"æ°¸ä¹ä»£ç©ºé´ä¸è¶³",normalizedTitle:"æ°¸ä¹ä»£ç©ºé´ä¸è¶³",charIndex:8980},{level:4,title:"åå§åæ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³",slug:"åå§åæ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³",normalizedTitle:"åå§åæ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³",charIndex:9337},{level:4,title:"éé¨ç½²æ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³",slug:"éé¨ç½²æ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³",normalizedTitle:"éé¨ç½²æ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³",charIndex:10125},{level:4,title:"PermGen space è§£å³æ¹æ¡",slug:"permgen-space-è§£å³æ¹æ¡",normalizedTitle:"permgen space è§£å³æ¹æ¡",charIndex:10755},{level:3,title:"åæ°æ®åºç©ºé´ä¸è¶³",slug:"åæ°æ®åºç©ºé´ä¸è¶³",normalizedTitle:"åæ°æ®åºç©ºé´ä¸è¶³",charIndex:12227},{level:3,title:"æ æ³æ°å»ºæ¬å°çº¿ç¨",slug:"æ æ³æ°å»ºæ¬å°çº¿ç¨",normalizedTitle:"æ æ³æ°å»ºæ¬å°çº¿ç¨",charIndex:13565},{level:3,title:"ç´æ¥åå­æº¢åº",slug:"ç´æ¥åå­æº¢åº",normalizedTitle:"ç´æ¥åå­æº¢åº",charIndex:15208},{level:2,title:"StackOverflowError",slug:"stackoverflowerror",normalizedTitle:"stackoverflowerror",charIndex:1516},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:16494}],headersStr:"åå­ç®ä» ç©çåå­åèæåå­ åæ ¸ç©ºé´åç¨æ·ç©ºé´ ä½¿ç¨åå­ç Java ç»ä»¶ è¿è¡æ¶æ°æ®åºå ç¨åºè®¡æ°å¨ Java èææºæ  æ¬å°æ¹æ³æ  Java å  æ¹æ³åº è¿è¡æ¶å¸¸éæ±  ç´æ¥åå­ Java åå­åºåå¯¹æ¯ JVM è¿è¡åç OutOfMemoryError ä»ä¹æ¯ OutOfMemoryError å ç©ºé´æº¢åº Java heap space åææ­¥éª¤ åå­æ³æ¼ åå­æº¢åº GC å¼éè¶è¿éå¶ æ°¸ä¹ä»£ç©ºé´ä¸è¶³ åå§åæ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³ éé¨ç½²æ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³ PermGen space è§£å³æ¹æ¡ åæ°æ®åºç©ºé´ä¸è¶³ æ æ³æ°å»ºæ¬å°çº¿ç¨ ç´æ¥åå­æº¢åº StackOverflowError åèèµæ",content:'# Java åå­ç®¡ç\n\n\n# åå­ç®ä»\n\n\n# ç©çåå­åèæåå­\n\næè°ç©çåå­å°±æ¯éå¸¸æè¯´ç RAMï¼éæºå­å¨å¨ï¼ã\n\nèæåå­ä½¿å¾å¤ä¸ªè¿ç¨å¨åæ¶è¿è¡æ¶å¯ä»¥å±äº«ç©çåå­ï¼è¿éçå±äº«åªæ¯ç©ºé´ä¸å±äº«ï¼å¨é»è¾ä¸å½¼æ­¤ä»ç¶æ¯éç¦»çã\n\n\n# åæ ¸ç©ºé´åç¨æ·ç©ºé´\n\nä¸ä¸ªè®¡ç®éå¸¸æåºå®å¤§å°çåå­ç©ºé´ï¼ä½æ¯ç¨åºå¹¶ä¸è½ä½¿ç¨å¨é¨çç©ºé´ãå ä¸ºè¿äºç©ºé´è¢«ååä¸ºåæ ¸ç©ºé´åç¨æ·ç©ºé´ï¼èç¨åºåªè½ä½¿ç¨ç¨æ·ç©ºé´çåå­ã\n\n\n# ä½¿ç¨åå­ç Java ç»ä»¶\n\nJava å¯å¨åï¼ä½ä¸ºä¸ä¸ªè¿ç¨è¿è¡å¨æä½ç³»ç»ä¸­ã\n\næåªäº Java ç»ä»¶éè¦å ç¨åå­å¢ï¼\n\n * å åå­ï¼Java å ãç±»åç±»å è½½å¨\n * æ åå­ï¼çº¿ç¨\n * æ¬å°åå­ï¼NIOãJNI\n\n\n# è¿è¡æ¶æ°æ®åºå\n\nJVM å¨æ§è¡ Java ç¨åºçè¿ç¨ä¸­ä¼æå®æç®¡ççåå­ååä¸ºè¥å¹²ä¸ªä¸åçæ°æ®åºåãè¿äºåºåé½æåèªçç¨éï¼ä»¥ååå»ºåéæ¯çæ¶é´ï¼æçåºåéçèææºè¿ç¨çå¯å¨èå­å¨ï¼æäºåºååä¾èµç¨æ·çº¿ç¨çå¯å¨åç»æèå»ºç«åéæ¯ãå¦ä¸å¾æç¤ºï¼\n\n\n\n\n# ç¨åºè®¡æ°å¨\n\nç¨åºè®¡æ°å¨ï¼Program Counter Registerï¼ æ¯ä¸åè¾å°çåå­ç©ºé´ï¼å®å¯ä»¥çåæ¯å½åçº¿ç¨ææ§è¡çå­èç çè¡å·æç¤ºå¨ãä¾å¦ï¼åæ¯ãå¾ªç¯ãè·³è½¬ãå¼å¸¸ãçº¿ç¨æ¢å¤ç­é½ä¾èµäºè®¡æ°å¨ã\n\nå½æ§è¡ççº¿ç¨æ°éè¶è¿ CPU æ°éæ¶ï¼çº¿ç¨ä¹é´ä¼æ ¹æ®æ¶é´çè½®è¯¢äºå¤º CPU èµæºãå¦æä¸ä¸ªçº¿ç¨çæ¶é´çç¨å®äºï¼æèæ¯å¶å®åå å¯¼è´è¿ä¸ªçº¿ç¨ç CPU èµæºè¢«æåæ¢å¤ºï¼é£ä¹è¿ä¸ªéåºççº¿ç¨å°±éè¦åç¬çä¸ä¸ªç¨åºè®¡æ°å¨ï¼æ¥è®°å½ä¸ä¸æ¡è¿è¡çæä»¤ï¼ä»èå¨çº¿ç¨åæ¢åè½æ¢å¤å°æ­£ç¡®çæ§è¡ä½ç½®ãåæ¡çº¿ç¨é´çè®¡æ°å¨äºä¸å½±åï¼ç¬ç«å­å¨ï¼æä»¬ç§°è¿ç±»åå­åºåä¸º âçº¿ç¨ç§æâ çåå­ã\n\n * å¦æçº¿ç¨æ­£å¨æ§è¡çæ¯ä¸ä¸ª Java æ¹æ³ï¼è¿ä¸ªè®¡æ°å¨è®°å½çæ¯æ­£å¨æ§è¡çèææºå­èç æä»¤çå°åï¼\n * å¦ææ­£å¨æ§è¡çæ¯ Native æ¹æ³ï¼è¿ä¸ªè®¡æ°å¨å¼åä¸ºç©ºï¼Undefinedï¼ã\n\n> ð æ³¨æï¼æ­¤åå­åºåæ¯å¯ä¸ä¸ä¸ªå¨ JVM ä¸­æ²¡æè§å®ä»»ä½ OutOfMemoryError æåµçåºåã\n\n\n# Java èææºæ \n\nJava èææºæ ï¼Java Virtual Machine Stacksï¼ ä¹æ¯çº¿ç¨ç§æçï¼å®ççå½å¨æä¸çº¿ç¨ç¸åã\n\næ¯ä¸ª Java æ¹æ³å¨æ§è¡çåæ¶é½ä¼åå»ºä¸ä¸ªæ å¸§ï¼Stack Frameï¼ç¨äºå­å¨ å±é¨åéè¡¨ãæä½æ°æ ãå¸¸éæ± å¼ç¨ ç­ä¿¡æ¯ãæ¯ä¸ä¸ªæ¹æ³ä»è°ç¨ç´è³æ§è¡å®æçè¿ç¨ï¼å°±å¯¹åºçä¸ä¸ªæ å¸§å¨ Java èææºæ ä¸­å¥æ ååºæ çè¿ç¨ã\n\n\n\n * å±é¨åéè¡¨ - 32 ä½åéæ§½ï¼å­æ¾äºç¼è¯æå¯ç¥çåç§åºæ¬æ°æ®ç±»åãå¯¹è±¡å¼ç¨ãReturnAddress ç±»åã\n * æä½æ°æ  - åºäºæ çæ§è¡å¼æï¼èææºææä½æ°æ ä½ä¸ºå®çå·¥ä½åºï¼å¤§å¤æ°æä»¤é½è¦ä»è¿éå¼¹åºæ°æ®ãæ§è¡è¿ç®ï¼ç¶åæç»æååæä½æ°æ ã\n * å¨æé¾æ¥ - æ¯ä¸ªæ å¸§é½åå«ä¸ä¸ªæåè¿è¡æ¶å¸¸éæ± ï¼æ¹æ³åºçä¸é¨åï¼ä¸­è¯¥æ å¸§æå±æ¹æ³çå¼ç¨ãææè¿ä¸ªå¼ç¨æ¯ä¸ºäºæ¯ææ¹æ³è°ç¨è¿ç¨ä¸­çå¨æè¿æ¥ãClass æä»¶çå¸¸éæ± ä¸­æå¤§éçç¬¦å·å¼ç¨ï¼å­èç ä¸­çæ¹æ³è°ç¨æä»¤å°±ä»¥å¸¸éæ± ä¸­æåæ¹æ³çç¬¦å·å¼ç¨ä¸ºåæ°ãè¿äºç¬¦å·å¼ç¨ä¸é¨åä¼å¨ç±»å è½½é¶æ®µæç¬¬ä¸æ¬¡ä½¿ç¨çæ¶åè½¬åä¸ºç´æ¥å¼ç¨ï¼è¿ç§è½¬åç§°ä¸ºéæè§£æãå¦ä¸é¨åå°å¨æ¯ä¸æ¬¡çè¿è¡æé´è½¬åä¸ºç´æ¥åºç¨ï¼è¿é¨åç§°ä¸ºå¨æé¾æ¥ã\n * æ¹æ³åºå£ - è¿åæ¹æ³è¢«è°ç¨çä½ç½®ï¼æ¢å¤ä¸å±æ¹æ³çå±é¨åéåæä½æ°æ ï¼å¦ææ è¿åå¼ï¼åæå®åå¥è°ç¨èçæä½æ°æ ã\n\n> ð æ³¨æï¼\n> \n> è¯¥åºåå¯è½æåºä»¥ä¸å¼å¸¸ï¼\n> \n>  * å¦æçº¿ç¨è¯·æ±çæ æ·±åº¦è¶è¿æå¤§å¼ï¼å°±ä¼æåº StackOverflowError å¼å¸¸ï¼\n>  * å¦æèææºæ è¿è¡å¨ææ©å±æ¶ï¼æ æ³ç³è¯·å°è¶³å¤åå­ï¼å°±ä¼æåº OutOfMemoryError å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼\n> \n> å¯ä»¥éè¿ -Xss è¿ä¸ªèææºåæ°æ¥æå®ä¸ä¸ªç¨åºç Java èææºæ åå­å¤§å°ï¼\n> \n> java -Xss=512M HackTheJava\n\n\n# æ¬å°æ¹æ³æ \n\næ¬å°æ¹æ³æ ï¼Native Method Stackï¼ ä¸èææºæ çä½ç¨ç¸ä¼¼ã\n\näºèçåºå«å¨äºï¼èææºæ ä¸º Java æ¹æ³æå¡ï¼æ¬å°æ¹æ³æ ä¸º Native æ¹æ³æå¡ãæ¬å°æ¹æ³å¹¶ä¸æ¯ç¨ Java å®ç°çï¼èæ¯ç± C è¯­è¨å®ç°çã\n\n\n\n> ð æ³¨æï¼æ¬å°æ¹æ³æ ä¹ä¼æåº StackOverflowError å¼å¸¸å OutOfMemoryError å¼å¸¸ã\n\n\n# Java å \n\nJava å ï¼Java Heapï¼ çä½ç¨å°±æ¯å­æ¾å¯¹è±¡å®ä¾ï¼å ä¹ææçå¯¹è±¡å®ä¾é½æ¯å¨è¿éåéåå­ã\n\nJava å æ¯åå¾æ¶éçä¸»è¦åºåï¼å æ­¤ä¹è¢«å«å"GC å "ï¼ãç°ä»£çåå¾æ¶éå¨åºæ¬é½æ¯éç¨åä»£æ¶éç®æ³ï¼è¯¥ç®æ³çææ³æ¯éå¯¹ä¸åçå¯¹è±¡éåä¸åçåå¾åæ¶ç®æ³ã\n\nå æ­¤èææºæ Java å åæä»¥ä¸ä¸åï¼\n\n * æ°çä»£ï¼Young Generationï¼\n   * Eden - Eden å Survivor çæ¯ä¾ä¸º 8:1\n   * From Survivor\n   * To Survivor\n * èå¹´ä»£ï¼Old Generationï¼\n * æ°¸ä¹ä»£ï¼Permanent Generationï¼\n\nå½ä¸ä¸ªå¯¹è±¡è¢«åå»ºæ¶ï¼å®é¦åè¿å¥æ°çä»£ï¼ä¹åæå¯è½è¢«è½¬ç§»å°èå¹´ä»£ä¸­ãæ°çä»£å­æ¾çå¤§éççå½å¾ç­çå¯¹è±¡ï¼å æ­¤æ°çä»£å¨ä¸ä¸ªåºåä¸­åå¾åæ¶çé¢çæé«ã\n\n\n\n> ð æ³¨æï¼Java å ä¸éè¦è¿ç»­åå­ï¼å¹¶ä¸å¯ä»¥å¨ææ©å±å¶åå­ï¼æ©å±å¤±è´¥ä¼æåº OutOfMemoryError å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼å¯ä»¥éè¿ -Xms å -Xmx ä¸¤ä¸ªèææºåæ°æ¥æå®ä¸ä¸ªç¨åºç Java å åå­å¤§å°ï¼ç¬¬ä¸ä¸ªåæ°è®¾ç½®åå§å¼ï¼ç¬¬äºä¸ªåæ°è®¾ç½®æå¤§å¼ã\n> \n> java -Xms=1M -Xmx=2M HackTheJava\n\n\n# æ¹æ³åº\n\næ¹æ³åºï¼Method Areaï¼ä¹è¢«ç§°ä¸ºæ°¸ä¹ä»£ãæ¹æ³åºç¨äºå­æ¾å·²è¢«å è½½çç±»ä¿¡æ¯ãå¸¸éãéæåéãå³æ¶ç¼è¯å¨ç¼è¯åçä»£ç ç­æ°æ®ã\n\nå¯¹è¿ååºåè¿è¡åå¾åæ¶çä¸»è¦ç®æ æ¯å¯¹å¸¸éæ± çåæ¶åå¯¹ç±»çå¸è½½ï¼ä½æ¯ä¸è¬æ¯è¾é¾å®ç°ã\n\n> ð æ³¨æï¼å Java å ä¸æ ·ä¸éè¦è¿ç»­çåå­ï¼å¹¶ä¸å¯ä»¥å¨ææ©å±ï¼å¨ææ©å±å¤±è´¥ä¸æ ·ä¼æåº OutOfMemoryError å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼\n> \n>  * JDK 1.7 ä¹åï¼HotSpot èææºæå®å½ææ°¸ä¹ä»£æ¥è¿è¡åå¾åæ¶ãå¯éè¿åæ° -XX:PermSize å -XX:MaxPermSize è®¾ç½®ã\n>  * JDK 1.8 ä¹åï¼åæ¶äºæ°¸ä¹ä»£ï¼ç¨ **metaspaceï¼åæ°æ®ï¼**åºæ¿ä»£ãå¯éè¿åæ° -XX:MaxMetaspaceSize è®¾ç½®ã\n\n\n# è¿è¡æ¶å¸¸éæ± \n\nè¿è¡æ¶å¸¸éæ± ï¼Runtime Constant Poolï¼ æ¯æ¹æ³åºçä¸é¨åï¼Class æä»¶ä¸­é¤äºæç±»ççæ¬ãå­æ®µãæ¹æ³ãæ¥å£ç­æè¿°ä¿¡æ¯ï¼è¿æä¸é¡¹ä¿¡æ¯æ¯å¸¸éæ± ï¼Constant Pool Tableï¼ï¼ç¨äºå­æ¾ç¼è¯å¨çæçåç§å­é¢éåç¬¦å·å¼ç¨ï¼è¿é¨ååå®¹ä¼å¨ç±»å è½½åè¢«æ¾å¥è¿ä¸ªåºåã\n\n * å­é¢é - ææ¬å­ç¬¦ä¸²ãå£°æä¸º final çå¸¸éå¼ç­ã\n * ç¬¦å·å¼ç¨ - ç±»åæ¥å£çå®å¨éå®åï¼Fully Qualified Nameï¼ãå­æ®µçåç§°åæè¿°ç¬¦ï¼Descriptorï¼ãæ¹æ³çåç§°åæè¿°ç¬¦ã\n\né¤äºå¨ç¼è¯æçæçå¸¸éï¼è¿åè®¸å¨æçæï¼ä¾å¦ String ç±»ç intern()ãè¿é¨åå¸¸éä¹ä¼è¢«æ¾å¥è¿è¡æ¶å¸¸éæ± ã\n\n> ð æ³¨æï¼å½å¸¸éæ± æ æ³åç³è¯·å°åå­æ¶ä¼æåº OutOfMemoryError å¼å¸¸ã\n\n\n# ç´æ¥åå­\n\nç´æ¥åå­ï¼Direct Memoryï¼å¹¶ä¸æ¯èææºè¿è¡æ¶æ°æ®åºçä¸é¨åï¼ä¹ä¸æ¯ JVM è§èä¸­å®ä¹çåå­åºåã\n\nå¨ JDK 1.4 ä¸­æ°å å¥äº NIO ç±»ï¼å®å¯ä»¥ä½¿ç¨ Native å½æ°åºç´æ¥åéå å¤åå­ï¼ç¶åéè¿ä¸ä¸ªå­å¨å¨ Java å éç DirectByteBuffer å¯¹è±¡ä½ä¸ºè¿ååå­çå¼ç¨è¿è¡æä½ãè¿æ ·è½å¨ä¸äºåºæ¯ä¸­æ¾èæé«æ§è½ï¼å ä¸ºé¿åäºå¨ Java å å Native å ä¸­æ¥åå¤å¶æ°æ®ã\n\n> ð æ³¨æï¼ç´æ¥åå­è¿é¨åä¹è¢«é¢ç¹çä½¿ç¨ï¼ä¸ä¹å¯è½å¯¼è´ OutOfMemoryError å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼ç´æ¥åå­å®¹éå¯éè¿ -XX:MaxDirectMemorySize æå®ï¼å¦æä¸æå®ï¼åé»è®¤ä¸ Java å æå¤§å¼ï¼-Xmx æå®ï¼ä¸æ ·ã\n\n\n# Java åå­åºåå¯¹æ¯\n\nåå­åºå        åå­ä½ç¨èå´    å¼å¸¸\nç¨åºè®¡æ°å¨       çº¿ç¨ç§æ      æ \nJava èææºæ    çº¿ç¨ç§æ      StackOverflowError å OutOfMemoryError\næ¬å°æ¹æ³æ        çº¿ç¨ç§æ      StackOverflowError å OutOfMemoryError\nJava å       çº¿ç¨å±äº«      OutOfMemoryError\næ¹æ³åº         çº¿ç¨å±äº«      OutOfMemoryError\nè¿è¡æ¶å¸¸éæ±       çº¿ç¨å±äº«      OutOfMemoryError\nç´æ¥åå­        éè¿è¡æ¶æ°æ®åº   OutOfMemoryError\n\n\n# JVM è¿è¡åç\n\npublic class JVMCase {\n\n\t// å¸¸é\n\tpublic final static String MAN_SEX_TYPE = "man";\n\n\t// éæåé\n\tpublic static String WOMAN_SEX_TYPE = "woman";\n\n\tpublic static void main(String[] args) {\n\n\t\tStudent stu = new Student();\n\t\tstu.setName("nick");\n\t\tstu.setSexType(MAN_SEX_TYPE);\n\t\tstu.setAge(20);\n\n\t\tJVMCase jvmcase = new JVMCase();\n\n\t\t// è°ç¨éææ¹æ³\n\t\tprint(stu);\n\t\t// è°ç¨ééææ¹æ³\n\t\tjvmcase.sayHello(stu);\n\t}\n\n\n\t// å¸¸è§éææ¹æ³\n\tpublic static void print(Student stu) {\n\t\tSystem.out.println("name: " + stu.getName() + "; sex:" + stu.getSexType() + "; age:" + stu.getAge());\n\t}\n\n\n\t// ééææ¹æ³\n\tpublic void sayHello(Student stu) {\n\t\tSystem.out.println(stu.getName() + "say: hello");\n\t}\n}\n\nclass Student{\n\tString name;\n\tString sexType;\n\tint age;\n\n\tpublic String getName() {\n\t\treturn name;\n\t}\n\tpublic void setName(String name) {\n\t\tthis.name = name;\n\t}\n\n\tpublic String getSexType() {\n\t\treturn sexType;\n\t}\n\tpublic void setSexType(String sexType) {\n\t\tthis.sexType = sexType;\n\t}\n\tpublic int getAge() {\n\t\treturn age;\n\t}\n\tpublic void setAge(int age) {\n\t\tthis.age = age;\n\t}\n}\n\n\nè¿è¡ä»¥ä¸ä»£ç æ¶ï¼JVM å¤çè¿ç¨å¦ä¸ï¼\n\nï¼1ï¼JVM åæä½ç³»ç»ç³è¯·åå­ï¼JVM ç¬¬ä¸æ­¥å°±æ¯éè¿éç½®åæ°æèé»è®¤éç½®åæ°åæä½ç³»ç»ç³è¯·åå­ç©ºé´ï¼æ ¹æ®åå­å¤§å°æ¾å°å·ä½çåå­åéè¡¨ï¼ç¶åæåå­æ®µçèµ·å§å°ååç»æ­¢å°ååéç» JVMï¼æ¥ä¸æ¥ JVM å°±è¿è¡åé¨åéã\n\nï¼2ï¼JVM è·å¾åå­ç©ºé´åï¼ä¼æ ¹æ®éç½®åæ°åéå ãæ ä»¥åæ¹æ³åºçåå­å¤§å°ã\n\nï¼3ï¼class æä»¶å è½½ãéªè¯ãåå¤ä»¥åè§£æï¼å¶ä¸­åå¤é¶æ®µä¼ä¸ºç±»çéæåéåéåå­ï¼åå§åä¸ºç³»ç»çåå§å¼ï¼è¿é¨åæå¨ç¬¬ 21 è®²è¿ä¼è¯¦ç»ä»ç»ï¼ã\n\n\n\nï¼4ï¼å®æä¸ä¸ä¸ªæ­¥éª¤åï¼å°ä¼è¿è¡æåä¸ä¸ªåå§åé¶æ®µãå¨è¿ä¸ªé¶æ®µä¸­ï¼JVM é¦åä¼æ§è¡æé å¨ <clinit> æ¹æ³ï¼ç¼è¯å¨ä¼å¨ .java æä»¶è¢«ç¼è¯æ .class æä»¶æ¶ï¼æ¶éææç±»çåå§åä»£ç ï¼åæ¬éæåéèµå¼è¯­å¥ãéæä»£ç åãéææ¹æ³ï¼æ¶éå¨ä¸èµ·æä¸º <clinit>() æ¹æ³ã\n\n\n\nï¼5ï¼æ§è¡æ¹æ³ãå¯å¨ main çº¿ç¨ï¼æ§è¡ main æ¹æ³ï¼å¼å§æ§è¡ç¬¬ä¸è¡ä»£ç ãæ­¤æ¶å åå­ä¸­ä¼åå»ºä¸ä¸ª student å¯¹è±¡ï¼å¯¹è±¡å¼ç¨ student å°±å­æ¾å¨æ ä¸­ã\n\n\n\nï¼6ï¼æ­¤æ¶åæ¬¡åå»ºä¸ä¸ª JVMCase å¯¹è±¡ï¼è°ç¨ sayHello ééææ¹æ³ï¼sayHello æ¹æ³å±äºå¯¹è±¡ JVMCaseï¼æ­¤æ¶ sayHello æ¹æ³å¥æ ï¼å¹¶éè¿æ ä¸­ç student å¼ç¨è°ç¨å ä¸­ç Student å¯¹è±¡ï¼ä¹åï¼è°ç¨éææ¹æ³ printï¼print éææ¹æ³å±äº JVMCase ç±»ï¼æ¯ä»éææ¹æ³ä¸­è·åï¼ä¹åæ¾å¥å°æ ä¸­ï¼ä¹æ¯éè¿ student å¼ç¨è°ç¨å ä¸­ç student å¯¹è±¡ã\n\n\n\n\n# OutOfMemoryError\n\n\n# ä»ä¹æ¯ OutOfMemoryError\n\nOutOfMemoryError ç®ç§°ä¸º OOMãJava ä¸­å¯¹ OOM çè§£éæ¯ï¼æ²¡æç©ºé²åå­ï¼å¹¶ä¸åå¾æ¶éå¨ä¹æ æ³æä¾æ´å¤åå­ãéä¿çè§£éæ¯ï¼JVM åå­ä¸è¶³äºã\n\nå¨ JVM è§èä¸­ï¼é¤äºç¨åºè®¡æ°å¨åºåå¤ï¼å¶ä»è¿è¡æ¶åºåé½å¯è½åç OutOfMemoryError å¼å¸¸ï¼ç®ç§° OOMï¼ã\n\nä¸é¢éä¸ä»ç» OOM åçåºæ¯ã\n\n\n# å ç©ºé´æº¢åº\n\njava.lang.OutOfMemoryError: Java heap space è¿ä¸ªéè¯¯æå³çï¼å ç©ºé´æº¢åºã\n\næ´ç»è´çè¯´æ³æ¯ï¼Java å åå­å·²ç»è¾¾å° -Xmx è®¾ç½®çæå¤§å¼ãJava å ç¨äºå­å¨å¯¹è±¡å®ä¾ï¼åªè¦ä¸æ­å°åå»ºå¯¹è±¡ï¼å¹¶ä¸ä¿è¯ GC Roots å°å¯¹è±¡ä¹é´æå¯è¾¾è·¯å¾æ¥é¿ååå¾æ¶éå¨åæ¶è¿äºå¯¹è±¡ï¼é£ä¹å½å ç©ºé´å°è¾¾æå¤§å®¹ééå¶åå°±ä¼äº§ç OOMã\n\nå ç©ºé´æº¢åºæå¯è½æ¯**åå­æ³æ¼ï¼Memory Leakï¼** æ åå­æº¢åºï¼Memory Overflowï¼ ãéè¦ä½¿ç¨ jstack å jmap çæ threaddump å heapdumpï¼ç¶åç¨åå­åæå·¥å·ï¼å¦ï¼MATï¼è¿è¡åæã\n\n# Java heap space åææ­¥éª¤\n\n 1. ä½¿ç¨ jmap æ -XX:+HeapDumpOnOutOfMemoryError è·åå å¿«ç§ã\n 2. ä½¿ç¨åå­åæå·¥å·ï¼visualvmãmatãjProfile ç­ï¼å¯¹å å¿«ç§æä»¶è¿è¡åæã\n 3. æ ¹æ®åæå¾ï¼éç¹æ¯ç¡®è®¤åå­ä¸­çå¯¹è±¡æ¯å¦æ¯å¿è¦çï¼åæ¸ç©¶ç«æ¯æ¯åå­æ³æ¼ï¼Memory Leakï¼è¿æ¯åå­æº¢åºï¼Memory Overflowï¼ã\n\n# åå­æ³æ¼\n\nåå­æ³æ¼æ¯æç±äºçå¿½æéè¯¯é æç¨åºæªè½éæ¾å·²ç»ä¸åä½¿ç¨çåå­çæåµã\n\nåå­æ³æ¼å¹¶éæåå­å¨ç©çä¸çæ¶å¤±ï¼èæ¯åºç¨ç¨åºåéææ®µåå­åï¼ç±äºè®¾è®¡éè¯¯ï¼å¤±å»äºå¯¹è¯¥æ®µåå­çæ§å¶ï¼å èé æäºåå­çæµªè´¹ãåå­æ³æ¼éçè¢«æ§è¡çæ¬¡æ°ä¸æ­å¢å ï¼æç»ä¼å¯¼è´åå­æº¢åºã\n\nåå­æ³æ¼å¸¸è§åºæ¯ï¼\n\n * éæå®¹å¨\n   * å£°æä¸ºéæï¼staticï¼ç HashMapãVector ç­éå\n   * éä¿æ¥è®² A ä¸­æ Bï¼å½ååªæ B è®¾ç½®ä¸ºç©ºï¼A æ²¡æè®¾ç½®ä¸ºç©ºï¼åæ¶æ¶ B æ æ³åæ¶ãå ä¸ºè¢« A å¼ç¨ã\n * çå¬å¨\n   * çå¬å¨è¢«æ³¨ååéæ¾å¯¹è±¡æ¶æ²¡æå é¤çå¬å¨\n * ç©çè¿æ¥\n   * åç§è¿æ¥æ± å»ºç«äºè¿æ¥ï¼å¿é¡»éè¿ close() å³é­é¾æ¥\n * åé¨ç±»åå¤é¨æ¨¡åç­çå¼ç¨\n   * åç°å®çæ¹å¼ååå­æº¢åºï¼å¯åå ä¸ªå®æ¶è§å¯\n   * jstat -gcutil 7362 2500 70\n\néç¹å³æ³¨ï¼\n\n * FGC â ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶åç Full GC çæ¬¡æ°ã\n * FGCT â ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ Full GC æç¨çæ¶é´ï¼åä½ç§ï¼ã\n * FGC æ¬¡æ°è¶å¤ï¼FGCT æéæ¶é´è¶å¤ï¼è¶æå¯è½å­å¨åå­æ³æ¼ã\n\nå¦ææ¯åå­æ³æ¼ï¼å¯ä»¥è¿ä¸æ­¥æ¥çæ³æ¼å¯¹è±¡å° GC Roots çå¯¹è±¡å¼ç¨é¾ãè¿æ ·å°±è½æ¾å°æ³æ¼å¯¹è±¡æ¯ææ ·ä¸ GC Roots å³èå¹¶å¯¼è´ GC æ æ³åæ¶å®ä»¬çãææ¡äºè¿äºåå ï¼å°±å¯ä»¥è¾åç¡®çå®ä½åºå¼èµ·åå­æ³æ¼çä»£ç ã\n\nå¯¼è´åå­æ³æ¼çå¸¸è§åå æ¯ä½¿ç¨å®¹å¨ï¼ä¸ä¸æ­åå®¹å¨ä¸­æ·»å åç´ ï¼ä½æ²¡ææ¸çï¼å¯¼è´å®¹å¨åå­ä¸æ­è¨èã\n\nãç¤ºä¾ã\n\n/**\n * åå­æ³æ¼ç¤ºä¾\n * éè¯¯ç°è±¡ï¼java.lang.OutOfMemoryError: Java heap space\n * VM Argsï¼-verbose:gc -Xms10M -Xmx10M -XX:+HeapDumpOnOutOfMemoryError\n */\npublic class HeapOutOfMemoryDemo {\n\n    public static void main(String[] args) {\n        List<OomObject> list = new ArrayList<>();\n        while (true) {\n            list.add(new OomObject());\n        }\n    }\n\n    static class OomObject {}\n\n}\n\n\n# åå­æº¢åº\n\nå¦æä¸å­å¨åå­æ³æ¼ï¼å³åå­ä¸­çå¯¹è±¡ç¡®å®é½å¿é¡»å­æ´»çï¼ååºå½æ£æ¥èææºçå åæ°ï¼-Xmx å -Xmsï¼ï¼ä¸æºå¨ç©çåå­è¿è¡å¯¹æ¯ï¼ççæ¯å¦å¯ä»¥è°å¤§ãå¹¶ä»ä»£ç ä¸æ£æ¥æ¯å¦å­å¨æäºå¯¹è±¡çå½å¨æè¿é¿ãæææ¶é´è¿é¿çæåµï¼å°è¯åå°ç¨åºè¿è¡æçåå­æ¶èã\n\nãç¤ºä¾ã\n\n/**\n * å æº¢åºç¤ºä¾\n * <p>\n * éè¯¯ç°è±¡ï¼java.lang.OutOfMemoryError: Java heap space\n * <p>\n * VM Argsï¼-verbose:gc -Xms10M -Xmx10M\n *\n * @author <a href="mailto:forbreak@163.com">Zhang Peng</a>\n * @since 2019-06-25\n */\npublic class HeapOutOfMemoryDemo {\n\n    public static void main(String[] args) {\n        Double[] array = new Double[999999999];\n        System.out.println("array length = [" + array.length + "]");\n    }\n\n}\n\n\næ§è¡ java -verbose:gc -Xms10M -Xmx10M -XX:+HeapDumpOnOutOfMemoryError io.github.dunwu.javacore.jvm.memory.HeapMemoryLeakMemoryErrorDemo\n\nä¸é¢çä¾å­æ¯ä¸ä¸ªæç«¯çä¾å­ï¼è¯å¾åå»ºä¸ä¸ªç»´åº¦å¾å¤§çæ°ç»ï¼å åå­æ æ³åéè¿ä¹å¤§çåå­ï¼ä»èæ¥éï¼Java heap spaceã\n\nä½å¦æå¨ç°å®ä¸­ï¼ä»£ç å¹¶æ²¡æé®é¢ï¼ä»ä»æ¯å ä¸ºå åå­ä¸è¶³ï¼å¯ä»¥éè¿ -Xms å -Xmx éå½è°æ´å åå­å¤§å°ã\n\n\n# GC å¼éè¶è¿éå¶\n\njava.lang.OutOfMemoryError: GC overhead limit exceeded è¿ä¸ªéè¯¯ï¼å®æ¹ç»åºçå®ä¹æ¯ï¼è¶è¿ 98% çæ¶é´ç¨æ¥å GC å¹¶ä¸åæ¶äºä¸å° 2% çå åå­æ¶ä¼æåºæ­¤å¼å¸¸ãè¿æå³çï¼åçå¨ GC å ç¨å¤§éæ¶é´ä¸ºéæ¾å¾å°ç©ºé´çæ¶ååççï¼æ¯ä¸ç§ä¿æ¤æºå¶ãå¯¼è´å¼å¸¸çåå ï¼ä¸è¬æ¯å ä¸ºå å¤ªå°ï¼æ²¡æè¶³å¤çåå­ã\n\nãç¤ºä¾ã\n\n/**\n * GC overhead limit exceeded ç¤ºä¾\n * éè¯¯ç°è±¡ï¼java.lang.OutOfMemoryError: GC overhead limit exceeded\n * åçå¨GCå ç¨å¤§éæ¶é´ä¸ºéæ¾å¾å°ç©ºé´çæ¶ååççï¼æ¯ä¸ç§ä¿æ¤æºå¶ãå¯¼è´å¼å¸¸çåå ï¼ä¸è¬æ¯å ä¸ºå å¤ªå°ï¼æ²¡æè¶³å¤çåå­ã\n * å®æ¹å¯¹æ­¤çå®ä¹ï¼è¶è¿98%çæ¶é´ç¨æ¥åGCå¹¶ä¸åæ¶äºä¸å°2%çå åå­æ¶ä¼æåºæ­¤å¼å¸¸ã\n * VM Args: -Xms10M -Xmx10M\n */\npublic class GcOverheadLimitExceededDemo {\n\n    public static void main(String[] args) {\n        List<Double> list = new ArrayList<>();\n        double d = 0.0;\n        while (true) {\n            list.add(d++);\n        }\n    }\n\n}\n\n\nãå¤çã\n\nä¸ Java heap space éè¯¯å¤çæ¹æ³ç±»ä¼¼ï¼åå¤æ­æ¯å¦å­å¨åå­æ³æ¼ãå¦ææï¼åä¿®æ­£ä»£ç ï¼å¦ææ²¡æï¼åéè¿ -Xms å -Xmx éå½è°æ´å åå­å¤§å°ã\n\n\n# æ°¸ä¹ä»£ç©ºé´ä¸è¶³\n\nãéè¯¯ã\n\njava.lang.OutOfMemoryError: PermGen space\n\n\nãåå ã\n\nPerm ï¼æ°¸ä¹ä»£ï¼ç©ºé´ä¸»è¦ç¨äºå­æ¾ Class å Meta ä¿¡æ¯ï¼åæ¬ç±»çåç§°åå­æ®µï¼å¸¦ææ¹æ³å­èç çæ¹æ³ï¼å¸¸éæ± ä¿¡æ¯ï¼ä¸ç±»å³èçå¯¹è±¡æ°ç»åç±»åæ°ç»ä»¥åå³æ¶ç¼è¯å¨ä¼åãGC å¨ä¸»ç¨åºè¿è¡æé´ä¸ä¼å¯¹æ°¸ä¹ä»£ç©ºé´è¿è¡æ¸çï¼é»è®¤æ¯ 64M å¤§å°ã\n\næ ¹æ®ä¸é¢çå®ä¹ï¼å¯ä»¥å¾åº PermGen å¤§å°è¦æ±åå³äºå è½½çç±»çæ°éä»¥åæ­¤ç±»å£°æçå¤§å°ãå æ­¤ï¼å¯ä»¥è¯´é æè¯¥éè¯¯çä¸»è¦åå æ¯æ°¸ä¹ä»£ä¸­è£å¥äºå¤ªå¤çç±»æå¤ªå¤§çç±»ã\n\nå¨ JDK8 ä¹åççæ¬ä¸­ï¼å¯ä»¥éè¿ -XX:PermSize å -XX:MaxPermSize è®¾ç½®æ°¸ä¹ä»£ç©ºé´å¤§å°ï¼ä»èéå¶æ¹æ³åºå¤§å°ï¼å¹¶é´æ¥éå¶å¶ä¸­å¸¸éæ± çå®¹éã\n\n# åå§åæ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³\n\nãç¤ºä¾ã\n\n/**\n * æ°¸ä¹ä»£åå­ç©ºé´ä¸è¶³ç¤ºä¾\n * <p>\n * éè¯¯ç°è±¡ï¼\n * <ul>\n * <li>java.lang.OutOfMemoryError: PermGen space (JDK8 ä»¥åçæ¬)</li>\n * <li>java.lang.OutOfMemoryError: Metaspace (JDK8 åä»¥åçæ¬)</li>\n * </ul>\n * VM Args:\n * <ul>\n * <li>-Xmx100M -XX:MaxPermSize=16M (JDK8 ä»¥åçæ¬)</li>\n * <li>-Xmx100M -XX:MaxMetaspaceSize=16M (JDK8 åä»¥åçæ¬)</li>\n * </ul>\n */\npublic class PermOutOfMemoryErrorDemo {\n\n    public static void main(String[] args) throws Exception {\n        for (int i = 0; i < 100_000_000; i++) {\n            generate("eu.plumbr.demo.Generated" + i);\n        }\n    }\n\n    public static Class generate(String name) throws Exception {\n        ClassPool pool = ClassPool.getDefault();\n        return pool.makeClass(name).toClass();\n    }\n\n}\n\n\nå¨æ­¤ç¤ºä¾ä¸­ï¼æºä»£ç éåå¾ªç¯å¹¶å¨è¿è¡æ¶çæç±»ãjavassist åºæ­£å¨å¤çç±»çæçå¤ææ§ã\n\n# éé¨ç½²æ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³\n\nå¯¹äºæ´å¤æï¼æ´å®éçç¤ºä¾ï¼è®©æä»¬éæ­¥ä»ç»ä¸ä¸å¨åºç¨ç¨åºéæ°é¨ç½²æé´åçç Permgen ç©ºé´éè¯¯ãéæ°é¨ç½²åºç¨ç¨åºæ¶ï¼ä½ å¸æåå¾åæ¶ä¼æè±å¼ç¨ææååå è½½çç±»çå è½½å¨ï¼å¹¶è¢«å è½½æ°ç±»çç±»å è½½å¨åä»£ã\n\nä¸å¹¸çæ¯ï¼è®¸å¤ç¬¬ä¸æ¹åºä»¥åå¯¹çº¿ç¨ï¼JDBC é©±å¨ç¨åºææä»¶ç³»ç»å¥æç­èµæºçä¸è¯å¤çä½¿å¾æ æ³å¸è½½ä»¥åä½¿ç¨çç±»å è½½å¨ãåè¿æ¥ï¼è¿æå³çå¨æ¯æ¬¡éæ°é¨ç½²æé´ï¼ææååçæ¬çç±»ä»å°é©»çå¨ PermGen ä¸­ï¼ä»èå¨æ¯æ¬¡éæ°é¨ç½²æé´çææ°ååçåå¾ã\n\nè®©æä»¬æ³è±¡ä¸ä¸ªä½¿ç¨ JDBC é©±å¨ç¨åºè¿æ¥å°å³ç³»æ°æ®åºçç¤ºä¾åºç¨ç¨åºãå¯å¨åºç¨ç¨åºæ¶ï¼åå§åä»£ç å°å è½½ JDBC é©±å¨ç¨åºä»¥è¿æ¥å°æ°æ®åºãå¯¹åºäºè§èï¼JDBC é©±å¨ç¨åºå java.sql.DriverManager è¿è¡æ³¨åãè¯¥æ³¨ååæ¬å°å¯¹é©±å¨ç¨åºå®ä¾çå¼ç¨å­å¨å¨ DriverManager çéæå­æ®µä¸­ã\n\nç°å¨ï¼å½ä»åºç¨ç¨åºæå¡å¨åæ¶é¨ç½²åºç¨ç¨åºæ¶ï¼java.sql.DriverManager ä»å°ä¿çè¯¥å¼ç¨ãæä»¬æç»è·å¾äºå¯¹é©±å¨ç¨åºç±»çå®æ¶å¼ç¨ï¼èé©±å¨ç¨åºç±»åä¿çäºç¨äºå è½½åºç¨ç¨åºç java.lang.Classloader å®ä¾çå¼ç¨ãåè¿æ¥ï¼è¿æå³çåå¾åæ¶ç®æ³æ æ³åæ¶ç©ºé´ã\n\nèä¸è¯¥ java.lang.ClassLoader å®ä¾ä»å¼ç¨åºç¨ç¨åºçææç±»ï¼éå¸¸å¨ PermGen ä¸­å æ®æ°ååå­èãè¿æå³çåªéå°ééæ°é¨ç½²å³å¯å¡«åéå¸¸å¤§å°ç PermGenã\n\n# PermGen space è§£å³æ¹æ¡\n\nï¼1ï¼è§£å³åå§åæ¶ç OutOfMemoryError\n\nå¨åºç¨ç¨åºå¯å¨æé´è§¦åç±äº PermGen èå°½å¯¼è´ç OutOfMemoryError æ¶ï¼è§£å³æ¹æ¡å¾ç®åãè¯¥åºç¨ç¨åºä»éè¦æ´å¤ç©ºé´æè½å°ææç±»å è½½å° PermGen åºåï¼å æ­¤æä»¬åªéè¦å¢å å¶å¤§å°å³å¯ãä¸ºæ­¤ï¼æ´æ¹ä½ çåºç¨ç¨åºå¯å¨éç½®å¹¶æ·»å ï¼æå¢å ï¼å¦æå­å¨ï¼-XX:MaxPermSize åæ°ï¼ç±»ä¼¼äºä»¥ä¸ç¤ºä¾ï¼\n\njava -XX:MaxPermSize=512m com.yourcompany.YourClass\n\n\nä¸é¢çéç½®å°åè¯ JVMï¼PermGen å¯ä»¥å¢é¿å° 512MBã\n\næ¸çåºç¨ç¨åºä¸­ WEB-INF/lib ä¸ç jarï¼ç¨ä¸ä¸ç jar å é¤æï¼å¤ä¸ªåºç¨å¬å±ç jar ç§»å¨å° Tomcat ç lib ç®å½ï¼åå°éå¤å è½½ã\n\nð æ³¨æï¼-XX:PermSize ä¸è¬è®¾ä¸º 64M\n\nï¼2ï¼è§£å³éæ°é¨ç½²æ¶ç OutOfMemoryError\n\néæ°é¨ç½²åºç¨ç¨åºåç«å³åç OutOfMemoryError æ¶ï¼åºç¨ç¨åºä¼é­åç±»å è½½å¨æ³æ¼çå°æ°ãå¨è¿ç§æåµä¸ï¼è§£å³é®é¢çæç®åï¼ç»§ç»­è¿è¡å è½¬å¨åæâä½¿ç¨ç±»ä¼¼äºä»¥ä¸å½ä»¤çéæ°é¨ç½²åè¿è¡å è½¬å¨ï¼\n\njmap -dump:format=b,file=dump.hprof <process-id>\n\n\nç¶åä½¿ç¨ä½ æåæ¬¢çå è½¬å¨åæå¨æå¼è½¬å¨ï¼Eclipse MAT æ¯ä¸ä¸ªå¾å¥½çå·¥å·ï¼ãå¨åæå¨ä¸­å¯ä»¥æ¥æ¾éå¤çç±»ï¼å°¤å¶æ¯é£äºæ­£å¨å è½½åºç¨ç¨åºç±»çç±»ãä»é£éï¼ä½ éè¦è¿è¡ææç±»å è½½å¨çæ¥æ¾ï¼ä»¥æ¾å°å½åæ´»å¨çç±»å è½½å¨ã\n\nå¯¹äºéæ´»å¨ç±»å è½½å¨ï¼ä½ éè¦éè¿ä»éæ´»å¨ç±»å è½½å¨æ¶éå° GC æ ¹çæç­è·¯å¾æ¥ç¡®å®é»æ­¢å®ä»¬è¢«åå¾æ¶éçå¼ç¨ãæäºæ­¤ä¿¡æ¯ï¼ä½ å°æ¾å°æ ¹æ¬åå ãå¦ææ ¹æ¬åå æ¯å¨ç¬¬ä¸æ¹åºä¸­ï¼åå¯ä»¥è¿å¥ Google/StackOverflow æ¥çæ¯å¦æ¯å·²ç¥é®é¢ä»¥è·åè¡¥ä¸/è§£å³æ¹æ³ã\n\nï¼3ï¼è§£å³è¿è¡æ¶ OutOfMemoryError\n\nç¬¬ä¸æ­¥æ¯æ£æ¥æ¯å¦åè®¸ GC ä» PermGen å¸è½½ç±»ãå¨è¿æ¹é¢ï¼æ åç JVM ç¸å½ä¿å®-ç±»æ¯å¤©ççãå æ­¤ï¼ä¸æ¦å è½½ï¼å³ä½¿æ²¡æä»£ç å¨ä½¿ç¨å®ä»¬ï¼ç±»ä¹ä¼ä¿çå¨åå­ä¸­ãå½åºç¨ç¨åºå¨æåå»ºè®¸å¤ç±»å¹¶ä¸é¿æ¶é´ä¸éè¦çæçç±»æ¶ï¼è¿å¯è½ä¼æä¸ºé®é¢ãå¨è¿ç§æåµä¸ï¼åè®¸ JVM å¸è½½ç±»å®ä¹å¯è½ä¼ææå¸®å©ãè¿å¯ä»¥éè¿å¨å¯å¨èæ¬ä¸­ä»æ·»å ä¸ä¸ªéç½®åæ°æ¥å®ç°ï¼\n\n-XX:+CMSClassUnloadingEnabled\n\n\né»è®¤æåµä¸ï¼æ­¤éé¡¹è®¾ç½®ä¸º falseï¼å æ­¤è¦å¯ç¨æ­¤åè½ï¼ä½ éè¦å¨ Java éé¡¹ä¸­æ¾å¼è®¾ç½®ãå¦æå¯ç¨ CMSClassUnloadingEnabledï¼GC ä¹ä¼æ«æ PermGen å¹¶å é¤ä¸åä½¿ç¨çç±»ãè¯·è®°ä½ï¼åªæåæ¶ä½¿ç¨ UseConcMarkSweepGC æ¶æ­¤éé¡¹æèµ·ä½ç¨ã\n\n-XX:+UseConcMarkSweepGC\n\n\nå¨ç¡®ä¿å¯ä»¥å¸è½½ç±»å¹¶ä¸é®é¢ä»ç¶å­å¨ä¹åï¼ä½ åºè¯¥ç»§ç»­è¿è¡å è½¬å¨åæâä½¿ç¨ç±»ä¼¼äºä»¥ä¸å½ä»¤çæ¹æ³è¿è¡å è½¬å¨ï¼\n\njmap -dump:file=dump.hprof,format=b <process-id>\n\n\nç¶åï¼ä½¿ç¨ä½ æåæ¬¢çå è½¬å¨åæå¨ï¼ä¾å¦ Eclipse MATï¼æå¼è½¬å¨ï¼ç¶åæ ¹æ®å·²å è½½çç±»æ°æ¥æ¾ææè´µçç±»å è½½å¨ãä»æ­¤ç±»å è½½å¨ä¸­ï¼ä½ å¯ä»¥ç»§ç»­æåå·²å è½½çç±»ï¼å¹¶æå®ä¾å¯¹æ­¤ç±»è¿è¡æåºï¼ä»¥ä½¿å¯çå¯¹è±¡æå¨é¦ä½ã\n\nç¶åï¼å¯¹äºæ¯ä¸ªå¯çèï¼å°±éè¦ä½ æå¨å°æ ¹æ¬åå è¿½æº¯å°çææ­¤ç±»çåºç¨ç¨åºä»£ç ã\n\n\n# åæ°æ®åºç©ºé´ä¸è¶³\n\nãéè¯¯ã\n\nException in thread "main" java.lang.OutOfMemoryError: Metaspace\n\n\nãåå ã\n\nJava8 ä»¥åï¼JVM åå­ç©ºé´åçäºå¾å¤§çååãåæ¶äºæ°¸ä¹ä»£ï¼è½¬èåä¸ºåæ°æ®åºã\n\nåæ°æ®åºçåå­ä¸è¶³ï¼å³æ¹æ³åºåè¿è¡æ¶å¸¸éæ± çç©ºé´ä¸è¶³ã\n\næ¹æ³åºç¨äºå­æ¾ Class çç¸å³ä¿¡æ¯ï¼å¦ç±»åãè®¿é®ä¿®é¥°ç¬¦ãå¸¸éæ± ãå­æ®µæè¿°ãæ¹æ³æè¿°ç­ã\n\nä¸ä¸ªç±»è¦è¢«åå¾æ¶éå¨åæ¶ï¼å¤å®æ¡ä»¶æ¯æ¯è¾èå»çãå¨ç»å¸¸å¨æçæå¤§é Class çåºç¨ä¸­ï¼éè¦ç¹å«æ³¨æç±»çåæ¶ç¶åµãè¿ç±»å¸¸è§é¤äº CGLib å­èç å¢å¼ºåå¨æè¯­è¨ä»¥å¤ï¼å¸¸è§çè¿æï¼å¤§é JSP æå¨æäº§ç JSP æä»¶çåºç¨ï¼JSP ç¬¬ä¸æ¬¡è¿è¡æ¶éè¦ç¼è¯ä¸º Java ç±»ï¼ãåºäº OSGi çåºç¨ï¼å³ä½¿æ¯åä¸ä¸ªç±»æä»¶ï¼è¢«ä¸åçå è½½å¨å è½½ä¹ä¼è§ä¸ºä¸åçç±»ï¼ç­ã\n\nãç¤ºä¾ãæ¹æ³åºåºç° OutOfMemoryError\n\npublic class MethodAreaOutOfMemoryDemo {\n\n    public static void main(String[] args) {\n        while (true) {\n            Enhancer enhancer = new Enhancer();\n            enhancer.setSuperclass(Bean.class);\n            enhancer.setUseCache(false);\n            enhancer.setCallback(new MethodInterceptor() {\n                @Override\n                public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n                    return proxy.invokeSuper(obj, args);\n                }\n            });\n            enhancer.create();\n        }\n    }\n\n    static class Bean {}\n\n}\n\n\nãè§£å³ã\n\nå½ç±äºåç©ºé´èé¢ä¸´ OutOfMemoryError æ¶ï¼ç¬¬ä¸ä¸ªè§£å³æ¹æ¡åºè¯¥æ¯æ¾èæè§çãå¦æåºç¨ç¨åºèå°½äºåå­ä¸­ç Metaspace åºåï¼ååºå¢å  Metaspace çå¤§å°ãæ´æ¹åºç¨ç¨åºå¯å¨éç½®å¹¶å¢å ä»¥ä¸åå®¹ï¼\n\n-XX:MaxMetaspaceSize=512m\n\n\nä¸é¢çéç½®ç¤ºä¾åè¯ JVMï¼åè®¸ Metaspace å¢é¿å° 512 MBã\n\nå¦ä¸ç§è§£å³æ¹æ¡çè³æ´ç®åãä½ å¯ä»¥éè¿å é¤æ­¤åæ°æ¥å®å¨è§£é¤å¯¹ Metaspace å¤§å°çéå¶ï¼JVM é»è®¤å¯¹ Metaspace çå¤§å°æ²¡æéå¶ãä½æ¯è¯·æ³¨æä»¥ä¸äºå®ï¼è¿æ ·åå¯è½ä¼å¯¼è´å¤§éäº¤æ¢æè¾¾å°æ¬æºç©çåå­èåéå¤±è´¥ã\n\n\n# æ æ³æ°å»ºæ¬å°çº¿ç¨\n\njava.lang.OutOfMemoryError: Unable to create new native thread è¿ä¸ªéè¯¯æå³çï¼Java åºç¨ç¨åºå·²è¾¾å°å¶å¯ä»¥å¯å¨çº¿ç¨æ°çéå¶ã\n\nãåå ã\n\nå½åèµ·ä¸ä¸ªçº¿ç¨çåå»ºæ¶ï¼èææºä¼å¨ JVM åå­åå»ºä¸ä¸ª Thread å¯¹è±¡åæ¶åå»ºä¸ä¸ªæä½ç³»ç»çº¿ç¨ï¼èè¿ä¸ªç³»ç»çº¿ç¨çåå­ç¨çä¸æ¯ JVM åå­ï¼èæ¯ç³»ç»ä¸­å©ä¸çåå­ã\n\né£ä¹ï¼ç©¶ç«è½åå»ºå¤å°çº¿ç¨å¢ï¼è¿éæä¸ä¸ªå¬å¼ï¼\n\nçº¿ç¨æ° = (MaxProcessMemory - JVMMemory - ReservedOsMemory) / (ThreadStackSize)\n\n\nãåæ°ã\n\n * MaxProcessMemory - ä¸ä¸ªè¿ç¨çæå¤§åå­\n * JVMMemory - JVM åå­\n * ReservedOsMemory - ä¿ççæä½ç³»ç»åå­\n * ThreadStackSize - çº¿ç¨æ çå¤§å°\n\nç» JVM åéçåå­è¶å¤ï¼é£ä¹è½ç¨æ¥åå»ºç³»ç»çº¿ç¨çåå­å°±ä¼è¶å°ï¼è¶å®¹æåç unable to create new native threadãæä»¥ï¼JVM åå­ä¸æ¯åéçè¶å¤§è¶å¥½ã\n\nä½æ¯ï¼éå¸¸å¯¼è´ java.lang.OutOfMemoryError çæåµï¼æ æ³åå»ºæ°çæ¬æºçº¿ç¨éè¦ç»åä»¥ä¸é¶æ®µï¼\n\n 1. JVM åé¨è¿è¡çåºç¨ç¨åºè¯·æ±æ°ç Java çº¿ç¨\n 2. JVM æ¬æºä»£ç ä»£çä¸ºæä½ç³»ç»åå»ºæ°æ¬æºçº¿ç¨çè¯·æ±\n 3. æä½ç³»ç»å°è¯åå»ºä¸ä¸ªæ°çæ¬æºçº¿ç¨ï¼è¯¥çº¿ç¨éè¦å°åå­åéç»è¯¥çº¿ç¨\n 4. æä½ç³»ç»å°æç»æ¬æºåå­åéï¼åå æ¯ 32 ä½ Java è¿ç¨å¤§å°å·²èå°½å¶åå­å°åç©ºé´ï¼ä¾å¦ï¼å·²è¾¾å°ï¼2-4ï¼GB è¿ç¨å¤§å°éå¶ï¼ææä½ç³»ç»çèæåå­å·²å®å¨èå°½\n 5. å¼å java.lang.OutOfMemoryError: Unable to create new native thread éè¯¯ã\n\nãç¤ºä¾ã\n\npublic class UnableCreateNativeThreadErrorDemo {\n\n    public static void main(String[] args) {\n        while (true) {\n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    try {\n                        TimeUnit.MINUTES.sleep(5);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }).start();\n        }\n    }\n}\n\n\nãå¤çã\n\nå¯ä»¥éè¿å¢å æä½ç³»ç»çº§å«çéå¶æ¥ç»è¿æ æ³åå»ºæ°çæ¬æºçº¿ç¨é®é¢ãä¾å¦ï¼å¦æéå¶äº JVM å¯å¨ç¨æ·ç©ºé´ä¸­äº§ççè¿ç¨æ°ï¼ååºæ£æ¥åºå¹¶å¯è½å¢å è¯¥éå¶ï¼\n\n[root@dev ~]# ulimit -a\ncore file size          (blocks, -c) 0\n--- cut for brevity ---\nmax user processes              (-u) 1800\n\n\néå¸¸ï¼OutOfMemoryError å¯¹æ°çæ¬æºçº¿ç¨çéå¶è¡¨ç¤ºç¼ç¨éè¯¯ãå½åºç¨ç¨åºäº§çæ°åä¸ªçº¿ç¨æ¶ï¼å¾å¯è½åºäºä¸äºé®é¢âå¾å°æåºç¨ç¨åºå¯ä»¥ä»å¦æ­¤å¤§éççº¿ç¨ä¸­åçã\n\nè§£å³é®é¢çä¸ç§æ¹æ³æ¯å¼å§è¿è¡çº¿ç¨è½¬å¨ä»¥äºè§£æåµã\n\n\n# ç´æ¥åå­æº¢åº\n\nç±ç´æ¥åå­å¯¼è´çåå­æº¢åºï¼ä¸ä¸ªææ¾çç¹å¾æ¯å¨ Head Dump æä»¶ä¸­ä¸ä¼çè§ææ¾çå¼å¸¸ï¼å¦æåç° OOM ä¹å Dump æä»¶å¾å°ï¼èç¨åºä¸­åç´æ¥æé´æ¥ä½¿ç¨äº NIOï¼å°±å¯ä»¥èèæ£æ¥ä¸ä¸æ¯ä¸æ¯è¿æ¹é¢çåå ã\n\nãç¤ºä¾ãç´æ¥åå­ OutOfMemoryError\n\n/**\n * æ¬æºç´æ¥åå­æº¢åºç¤ºä¾\n * éè¯¯ç°è±¡ï¼java.lang.OutOfMemoryError\n * VM Argsï¼-Xmx20M -XX:MaxDirectMemorySize=10M\n */\npublic class DirectOutOfMemoryDemo {\n\n    private static final int _1MB = 1024 * 1024;\n\n    public static void main(String[] args) throws IllegalAccessException {\n        Field unsafeField = Unsafe.class.getDeclaredFields()[0];\n        unsafeField.setAccessible(true);\n        Unsafe unsafe = (Unsafe) unsafeField.get(null);\n        while (true) {\n            unsafe.allocateMemory(_1MB);\n        }\n    }\n\n}\n\n\n\n# StackOverflowError\n\nå¯¹äº HotSpot èææºæ¥è¯´ï¼æ å®¹éåªç± -Xss åæ°æ¥å³å®å¦æçº¿ç¨è¯·æ±çæ æ·±åº¦å¤§äºèææºæåè®¸çæå¤§æ·±åº¦ï¼å°æåº StackOverflowError å¼å¸¸ã\n\nä»å®ææ¥è¯´ï¼æ æº¢åºçå¸¸è§åå ï¼\n\n * éå½å½æ°è°ç¨å±æ°å¤ªæ·±\n * å¤§éå¾ªç¯ææ­»å¾ªç¯\n\nãç¤ºä¾ãéå½å½æ°è°ç¨å±æ°å¤ªæ·±å¯¼è´ StackOverflowError\n\npublic class StackOverflowDemo {\n\n    private int stackLength = 1;\n\n    public void recursion() {\n        stackLength++;\n        recursion();\n    }\n\n    public static void main(String[] args) {\n        StackOverflowDemo obj = new StackOverflowDemo();\n        try {\n            obj.recursion();\n        } catch (Throwable e) {\n            System.out.println("æ æ·±åº¦ï¼" + obj.stackLength);\n            e.printStackTrace();\n        }\n    }\n\n}\n\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava æ§è½è°ä¼å®æã\n * ä»è¡¨å°éå­¦ä¹  JVM å®ç°\n * ä½ä¸ºæµè¯ä½ åºè¯¥ç¥éç JAVA OOM åå®ä½åæ\n * å¼å¸¸ãå åå­æº¢åºãOOM çå ç§æåµ\n * ä»ç» JVM ä¸­ OOM ç 8 ç§ç±»å',normalizedContent:'# java åå­ç®¡ç\n\n\n# åå­ç®ä»\n\n\n# ç©çåå­åèæåå­\n\næè°ç©çåå­å°±æ¯éå¸¸æè¯´ç ramï¼éæºå­å¨å¨ï¼ã\n\nèæåå­ä½¿å¾å¤ä¸ªè¿ç¨å¨åæ¶è¿è¡æ¶å¯ä»¥å±äº«ç©çåå­ï¼è¿éçå±äº«åªæ¯ç©ºé´ä¸å±äº«ï¼å¨é»è¾ä¸å½¼æ­¤ä»ç¶æ¯éç¦»çã\n\n\n# åæ ¸ç©ºé´åç¨æ·ç©ºé´\n\nä¸ä¸ªè®¡ç®éå¸¸æåºå®å¤§å°çåå­ç©ºé´ï¼ä½æ¯ç¨åºå¹¶ä¸è½ä½¿ç¨å¨é¨çç©ºé´ãå ä¸ºè¿äºç©ºé´è¢«ååä¸ºåæ ¸ç©ºé´åç¨æ·ç©ºé´ï¼èç¨åºåªè½ä½¿ç¨ç¨æ·ç©ºé´çåå­ã\n\n\n# ä½¿ç¨åå­ç java ç»ä»¶\n\njava å¯å¨åï¼ä½ä¸ºä¸ä¸ªè¿ç¨è¿è¡å¨æä½ç³»ç»ä¸­ã\n\næåªäº java ç»ä»¶éè¦å ç¨åå­å¢ï¼\n\n * å åå­ï¼java å ãç±»åç±»å è½½å¨\n * æ åå­ï¼çº¿ç¨\n * æ¬å°åå­ï¼nioãjni\n\n\n# è¿è¡æ¶æ°æ®åºå\n\njvm å¨æ§è¡ java ç¨åºçè¿ç¨ä¸­ä¼æå®æç®¡ççåå­ååä¸ºè¥å¹²ä¸ªä¸åçæ°æ®åºåãè¿äºåºåé½æåèªçç¨éï¼ä»¥ååå»ºåéæ¯çæ¶é´ï¼æçåºåéçèææºè¿ç¨çå¯å¨èå­å¨ï¼æäºåºååä¾èµç¨æ·çº¿ç¨çå¯å¨åç»æèå»ºç«åéæ¯ãå¦ä¸å¾æç¤ºï¼\n\n\n\n\n# ç¨åºè®¡æ°å¨\n\nç¨åºè®¡æ°å¨ï¼program counter registerï¼ æ¯ä¸åè¾å°çåå­ç©ºé´ï¼å®å¯ä»¥çåæ¯å½åçº¿ç¨ææ§è¡çå­èç çè¡å·æç¤ºå¨ãä¾å¦ï¼åæ¯ãå¾ªç¯ãè·³è½¬ãå¼å¸¸ãçº¿ç¨æ¢å¤ç­é½ä¾èµäºè®¡æ°å¨ã\n\nå½æ§è¡ççº¿ç¨æ°éè¶è¿ cpu æ°éæ¶ï¼çº¿ç¨ä¹é´ä¼æ ¹æ®æ¶é´çè½®è¯¢äºå¤º cpu èµæºãå¦æä¸ä¸ªçº¿ç¨çæ¶é´çç¨å®äºï¼æèæ¯å¶å®åå å¯¼è´è¿ä¸ªçº¿ç¨ç cpu èµæºè¢«æåæ¢å¤ºï¼é£ä¹è¿ä¸ªéåºççº¿ç¨å°±éè¦åç¬çä¸ä¸ªç¨åºè®¡æ°å¨ï¼æ¥è®°å½ä¸ä¸æ¡è¿è¡çæä»¤ï¼ä»èå¨çº¿ç¨åæ¢åè½æ¢å¤å°æ­£ç¡®çæ§è¡ä½ç½®ãåæ¡çº¿ç¨é´çè®¡æ°å¨äºä¸å½±åï¼ç¬ç«å­å¨ï¼æä»¬ç§°è¿ç±»åå­åºåä¸º âçº¿ç¨ç§æâ çåå­ã\n\n * å¦æçº¿ç¨æ­£å¨æ§è¡çæ¯ä¸ä¸ª java æ¹æ³ï¼è¿ä¸ªè®¡æ°å¨è®°å½çæ¯æ­£å¨æ§è¡çèææºå­èç æä»¤çå°åï¼\n * å¦ææ­£å¨æ§è¡çæ¯ native æ¹æ³ï¼è¿ä¸ªè®¡æ°å¨å¼åä¸ºç©ºï¼undefinedï¼ã\n\n> ð æ³¨æï¼æ­¤åå­åºåæ¯å¯ä¸ä¸ä¸ªå¨ jvm ä¸­æ²¡æè§å®ä»»ä½ outofmemoryerror æåµçåºåã\n\n\n# java èææºæ \n\njava èææºæ ï¼java virtual machine stacksï¼ ä¹æ¯çº¿ç¨ç§æçï¼å®ççå½å¨æä¸çº¿ç¨ç¸åã\n\næ¯ä¸ª java æ¹æ³å¨æ§è¡çåæ¶é½ä¼åå»ºä¸ä¸ªæ å¸§ï¼stack frameï¼ç¨äºå­å¨ å±é¨åéè¡¨ãæä½æ°æ ãå¸¸éæ± å¼ç¨ ç­ä¿¡æ¯ãæ¯ä¸ä¸ªæ¹æ³ä»è°ç¨ç´è³æ§è¡å®æçè¿ç¨ï¼å°±å¯¹åºçä¸ä¸ªæ å¸§å¨ java èææºæ ä¸­å¥æ ååºæ çè¿ç¨ã\n\n\n\n * å±é¨åéè¡¨ - 32 ä½åéæ§½ï¼å­æ¾äºç¼è¯æå¯ç¥çåç§åºæ¬æ°æ®ç±»åãå¯¹è±¡å¼ç¨ãreturnaddress ç±»åã\n * æä½æ°æ  - åºäºæ çæ§è¡å¼æï¼èææºææä½æ°æ ä½ä¸ºå®çå·¥ä½åºï¼å¤§å¤æ°æä»¤é½è¦ä»è¿éå¼¹åºæ°æ®ãæ§è¡è¿ç®ï¼ç¶åæç»æååæä½æ°æ ã\n * å¨æé¾æ¥ - æ¯ä¸ªæ å¸§é½åå«ä¸ä¸ªæåè¿è¡æ¶å¸¸éæ± ï¼æ¹æ³åºçä¸é¨åï¼ä¸­è¯¥æ å¸§æå±æ¹æ³çå¼ç¨ãææè¿ä¸ªå¼ç¨æ¯ä¸ºäºæ¯ææ¹æ³è°ç¨è¿ç¨ä¸­çå¨æè¿æ¥ãclass æä»¶çå¸¸éæ± ä¸­æå¤§éçç¬¦å·å¼ç¨ï¼å­èç ä¸­çæ¹æ³è°ç¨æä»¤å°±ä»¥å¸¸éæ± ä¸­æåæ¹æ³çç¬¦å·å¼ç¨ä¸ºåæ°ãè¿äºç¬¦å·å¼ç¨ä¸é¨åä¼å¨ç±»å è½½é¶æ®µæç¬¬ä¸æ¬¡ä½¿ç¨çæ¶åè½¬åä¸ºç´æ¥å¼ç¨ï¼è¿ç§è½¬åç§°ä¸ºéæè§£æãå¦ä¸é¨åå°å¨æ¯ä¸æ¬¡çè¿è¡æé´è½¬åä¸ºç´æ¥åºç¨ï¼è¿é¨åç§°ä¸ºå¨æé¾æ¥ã\n * æ¹æ³åºå£ - è¿åæ¹æ³è¢«è°ç¨çä½ç½®ï¼æ¢å¤ä¸å±æ¹æ³çå±é¨åéåæä½æ°æ ï¼å¦ææ è¿åå¼ï¼åæå®åå¥è°ç¨èçæä½æ°æ ã\n\n> ð æ³¨æï¼\n> \n> è¯¥åºåå¯è½æåºä»¥ä¸å¼å¸¸ï¼\n> \n>  * å¦æçº¿ç¨è¯·æ±çæ æ·±åº¦è¶è¿æå¤§å¼ï¼å°±ä¼æåº stackoverflowerror å¼å¸¸ï¼\n>  * å¦æèææºæ è¿è¡å¨ææ©å±æ¶ï¼æ æ³ç³è¯·å°è¶³å¤åå­ï¼å°±ä¼æåº outofmemoryerror å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼\n> \n> å¯ä»¥éè¿ -xss è¿ä¸ªèææºåæ°æ¥æå®ä¸ä¸ªç¨åºç java èææºæ åå­å¤§å°ï¼\n> \n> java -xss=512m hackthejava\n\n\n# æ¬å°æ¹æ³æ \n\næ¬å°æ¹æ³æ ï¼native method stackï¼ ä¸èææºæ çä½ç¨ç¸ä¼¼ã\n\näºèçåºå«å¨äºï¼èææºæ ä¸º java æ¹æ³æå¡ï¼æ¬å°æ¹æ³æ ä¸º native æ¹æ³æå¡ãæ¬å°æ¹æ³å¹¶ä¸æ¯ç¨ java å®ç°çï¼èæ¯ç± c è¯­è¨å®ç°çã\n\n\n\n> ð æ³¨æï¼æ¬å°æ¹æ³æ ä¹ä¼æåº stackoverflowerror å¼å¸¸å outofmemoryerror å¼å¸¸ã\n\n\n# java å \n\njava å ï¼java heapï¼ çä½ç¨å°±æ¯å­æ¾å¯¹è±¡å®ä¾ï¼å ä¹ææçå¯¹è±¡å®ä¾é½æ¯å¨è¿éåéåå­ã\n\njava å æ¯åå¾æ¶éçä¸»è¦åºåï¼å æ­¤ä¹è¢«å«å"gc å "ï¼ãç°ä»£çåå¾æ¶éå¨åºæ¬é½æ¯éç¨åä»£æ¶éç®æ³ï¼è¯¥ç®æ³çææ³æ¯éå¯¹ä¸åçå¯¹è±¡éåä¸åçåå¾åæ¶ç®æ³ã\n\nå æ­¤èææºæ java å åæä»¥ä¸ä¸åï¼\n\n * æ°çä»£ï¼young generationï¼\n   * eden - eden å survivor çæ¯ä¾ä¸º 8:1\n   * from survivor\n   * to survivor\n * èå¹´ä»£ï¼old generationï¼\n * æ°¸ä¹ä»£ï¼permanent generationï¼\n\nå½ä¸ä¸ªå¯¹è±¡è¢«åå»ºæ¶ï¼å®é¦åè¿å¥æ°çä»£ï¼ä¹åæå¯è½è¢«è½¬ç§»å°èå¹´ä»£ä¸­ãæ°çä»£å­æ¾çå¤§éççå½å¾ç­çå¯¹è±¡ï¼å æ­¤æ°çä»£å¨ä¸ä¸ªåºåä¸­åå¾åæ¶çé¢çæé«ã\n\n\n\n> ð æ³¨æï¼java å ä¸éè¦è¿ç»­åå­ï¼å¹¶ä¸å¯ä»¥å¨ææ©å±å¶åå­ï¼æ©å±å¤±è´¥ä¼æåº outofmemoryerror å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼å¯ä»¥éè¿ -xms å -xmx ä¸¤ä¸ªèææºåæ°æ¥æå®ä¸ä¸ªç¨åºç java å åå­å¤§å°ï¼ç¬¬ä¸ä¸ªåæ°è®¾ç½®åå§å¼ï¼ç¬¬äºä¸ªåæ°è®¾ç½®æå¤§å¼ã\n> \n> java -xms=1m -xmx=2m hackthejava\n\n\n# æ¹æ³åº\n\næ¹æ³åºï¼method areaï¼ä¹è¢«ç§°ä¸ºæ°¸ä¹ä»£ãæ¹æ³åºç¨äºå­æ¾å·²è¢«å è½½çç±»ä¿¡æ¯ãå¸¸éãéæåéãå³æ¶ç¼è¯å¨ç¼è¯åçä»£ç ç­æ°æ®ã\n\nå¯¹è¿ååºåè¿è¡åå¾åæ¶çä¸»è¦ç®æ æ¯å¯¹å¸¸éæ± çåæ¶åå¯¹ç±»çå¸è½½ï¼ä½æ¯ä¸è¬æ¯è¾é¾å®ç°ã\n\n> ð æ³¨æï¼å java å ä¸æ ·ä¸éè¦è¿ç»­çåå­ï¼å¹¶ä¸å¯ä»¥å¨ææ©å±ï¼å¨ææ©å±å¤±è´¥ä¸æ ·ä¼æåº outofmemoryerror å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼\n> \n>  * jdk 1.7 ä¹åï¼hotspot èææºæå®å½ææ°¸ä¹ä»£æ¥è¿è¡åå¾åæ¶ãå¯éè¿åæ° -xx:permsize å -xx:maxpermsize è®¾ç½®ã\n>  * jdk 1.8 ä¹åï¼åæ¶äºæ°¸ä¹ä»£ï¼ç¨ **metaspaceï¼åæ°æ®ï¼**åºæ¿ä»£ãå¯éè¿åæ° -xx:maxmetaspacesize è®¾ç½®ã\n\n\n# è¿è¡æ¶å¸¸éæ± \n\nè¿è¡æ¶å¸¸éæ± ï¼runtime constant poolï¼ æ¯æ¹æ³åºçä¸é¨åï¼class æä»¶ä¸­é¤äºæç±»ççæ¬ãå­æ®µãæ¹æ³ãæ¥å£ç­æè¿°ä¿¡æ¯ï¼è¿æä¸é¡¹ä¿¡æ¯æ¯å¸¸éæ± ï¼constant pool tableï¼ï¼ç¨äºå­æ¾ç¼è¯å¨çæçåç§å­é¢éåç¬¦å·å¼ç¨ï¼è¿é¨ååå®¹ä¼å¨ç±»å è½½åè¢«æ¾å¥è¿ä¸ªåºåã\n\n * å­é¢é - ææ¬å­ç¬¦ä¸²ãå£°æä¸º final çå¸¸éå¼ç­ã\n * ç¬¦å·å¼ç¨ - ç±»åæ¥å£çå®å¨éå®åï¼fully qualified nameï¼ãå­æ®µçåç§°åæè¿°ç¬¦ï¼descriptorï¼ãæ¹æ³çåç§°åæè¿°ç¬¦ã\n\né¤äºå¨ç¼è¯æçæçå¸¸éï¼è¿åè®¸å¨æçæï¼ä¾å¦ string ç±»ç intern()ãè¿é¨åå¸¸éä¹ä¼è¢«æ¾å¥è¿è¡æ¶å¸¸éæ± ã\n\n> ð æ³¨æï¼å½å¸¸éæ± æ æ³åç³è¯·å°åå­æ¶ä¼æåº outofmemoryerror å¼å¸¸ã\n\n\n# ç´æ¥åå­\n\nç´æ¥åå­ï¼direct memoryï¼å¹¶ä¸æ¯èææºè¿è¡æ¶æ°æ®åºçä¸é¨åï¼ä¹ä¸æ¯ jvm è§èä¸­å®ä¹çåå­åºåã\n\nå¨ jdk 1.4 ä¸­æ°å å¥äº nio ç±»ï¼å®å¯ä»¥ä½¿ç¨ native å½æ°åºç´æ¥åéå å¤åå­ï¼ç¶åéè¿ä¸ä¸ªå­å¨å¨ java å éç directbytebuffer å¯¹è±¡ä½ä¸ºè¿ååå­çå¼ç¨è¿è¡æä½ãè¿æ ·è½å¨ä¸äºåºæ¯ä¸­æ¾èæé«æ§è½ï¼å ä¸ºé¿åäºå¨ java å å native å ä¸­æ¥åå¤å¶æ°æ®ã\n\n> ð æ³¨æï¼ç´æ¥åå­è¿é¨åä¹è¢«é¢ç¹çä½¿ç¨ï¼ä¸ä¹å¯è½å¯¼è´ outofmemoryerror å¼å¸¸ã\n> \n> ð¡ æç¤ºï¼ç´æ¥åå­å®¹éå¯éè¿ -xx:maxdirectmemorysize æå®ï¼å¦æä¸æå®ï¼åé»è®¤ä¸ java å æå¤§å¼ï¼-xmx æå®ï¼ä¸æ ·ã\n\n\n# java åå­åºåå¯¹æ¯\n\nåå­åºå        åå­ä½ç¨èå´    å¼å¸¸\nç¨åºè®¡æ°å¨       çº¿ç¨ç§æ      æ \njava èææºæ    çº¿ç¨ç§æ      stackoverflowerror å outofmemoryerror\næ¬å°æ¹æ³æ        çº¿ç¨ç§æ      stackoverflowerror å outofmemoryerror\njava å       çº¿ç¨å±äº«      outofmemoryerror\næ¹æ³åº         çº¿ç¨å±äº«      outofmemoryerror\nè¿è¡æ¶å¸¸éæ±       çº¿ç¨å±äº«      outofmemoryerror\nç´æ¥åå­        éè¿è¡æ¶æ°æ®åº   outofmemoryerror\n\n\n# jvm è¿è¡åç\n\npublic class jvmcase {\n\n\t// å¸¸é\n\tpublic final static string man_sex_type = "man";\n\n\t// éæåé\n\tpublic static string woman_sex_type = "woman";\n\n\tpublic static void main(string[] args) {\n\n\t\tstudent stu = new student();\n\t\tstu.setname("nick");\n\t\tstu.setsextype(man_sex_type);\n\t\tstu.setage(20);\n\n\t\tjvmcase jvmcase = new jvmcase();\n\n\t\t// è°ç¨éææ¹æ³\n\t\tprint(stu);\n\t\t// è°ç¨ééææ¹æ³\n\t\tjvmcase.sayhello(stu);\n\t}\n\n\n\t// å¸¸è§éææ¹æ³\n\tpublic static void print(student stu) {\n\t\tsystem.out.println("name: " + stu.getname() + "; sex:" + stu.getsextype() + "; age:" + stu.getage());\n\t}\n\n\n\t// ééææ¹æ³\n\tpublic void sayhello(student stu) {\n\t\tsystem.out.println(stu.getname() + "say: hello");\n\t}\n}\n\nclass student{\n\tstring name;\n\tstring sextype;\n\tint age;\n\n\tpublic string getname() {\n\t\treturn name;\n\t}\n\tpublic void setname(string name) {\n\t\tthis.name = name;\n\t}\n\n\tpublic string getsextype() {\n\t\treturn sextype;\n\t}\n\tpublic void setsextype(string sextype) {\n\t\tthis.sextype = sextype;\n\t}\n\tpublic int getage() {\n\t\treturn age;\n\t}\n\tpublic void setage(int age) {\n\t\tthis.age = age;\n\t}\n}\n\n\nè¿è¡ä»¥ä¸ä»£ç æ¶ï¼jvm å¤çè¿ç¨å¦ä¸ï¼\n\nï¼1ï¼jvm åæä½ç³»ç»ç³è¯·åå­ï¼jvm ç¬¬ä¸æ­¥å°±æ¯éè¿éç½®åæ°æèé»è®¤éç½®åæ°åæä½ç³»ç»ç³è¯·åå­ç©ºé´ï¼æ ¹æ®åå­å¤§å°æ¾å°å·ä½çåå­åéè¡¨ï¼ç¶åæåå­æ®µçèµ·å§å°ååç»æ­¢å°ååéç» jvmï¼æ¥ä¸æ¥ jvm å°±è¿è¡åé¨åéã\n\nï¼2ï¼jvm è·å¾åå­ç©ºé´åï¼ä¼æ ¹æ®éç½®åæ°åéå ãæ ä»¥åæ¹æ³åºçåå­å¤§å°ã\n\nï¼3ï¼class æä»¶å è½½ãéªè¯ãåå¤ä»¥åè§£æï¼å¶ä¸­åå¤é¶æ®µä¼ä¸ºç±»çéæåéåéåå­ï¼åå§åä¸ºç³»ç»çåå§å¼ï¼è¿é¨åæå¨ç¬¬ 21 è®²è¿ä¼è¯¦ç»ä»ç»ï¼ã\n\n\n\nï¼4ï¼å®æä¸ä¸ä¸ªæ­¥éª¤åï¼å°ä¼è¿è¡æåä¸ä¸ªåå§åé¶æ®µãå¨è¿ä¸ªé¶æ®µä¸­ï¼jvm é¦åä¼æ§è¡æé å¨ <clinit> æ¹æ³ï¼ç¼è¯å¨ä¼å¨ .java æä»¶è¢«ç¼è¯æ .class æä»¶æ¶ï¼æ¶éææç±»çåå§åä»£ç ï¼åæ¬éæåéèµå¼è¯­å¥ãéæä»£ç åãéææ¹æ³ï¼æ¶éå¨ä¸èµ·æä¸º <clinit>() æ¹æ³ã\n\n\n\nï¼5ï¼æ§è¡æ¹æ³ãå¯å¨ main çº¿ç¨ï¼æ§è¡ main æ¹æ³ï¼å¼å§æ§è¡ç¬¬ä¸è¡ä»£ç ãæ­¤æ¶å åå­ä¸­ä¼åå»ºä¸ä¸ª student å¯¹è±¡ï¼å¯¹è±¡å¼ç¨ student å°±å­æ¾å¨æ ä¸­ã\n\n\n\nï¼6ï¼æ­¤æ¶åæ¬¡åå»ºä¸ä¸ª jvmcase å¯¹è±¡ï¼è°ç¨ sayhello ééææ¹æ³ï¼sayhello æ¹æ³å±äºå¯¹è±¡ jvmcaseï¼æ­¤æ¶ sayhello æ¹æ³å¥æ ï¼å¹¶éè¿æ ä¸­ç student å¼ç¨è°ç¨å ä¸­ç student å¯¹è±¡ï¼ä¹åï¼è°ç¨éææ¹æ³ printï¼print éææ¹æ³å±äº jvmcase ç±»ï¼æ¯ä»éææ¹æ³ä¸­è·åï¼ä¹åæ¾å¥å°æ ä¸­ï¼ä¹æ¯éè¿ student å¼ç¨è°ç¨å ä¸­ç student å¯¹è±¡ã\n\n\n\n\n# outofmemoryerror\n\n\n# ä»ä¹æ¯ outofmemoryerror\n\noutofmemoryerror ç®ç§°ä¸º oomãjava ä¸­å¯¹ oom çè§£éæ¯ï¼æ²¡æç©ºé²åå­ï¼å¹¶ä¸åå¾æ¶éå¨ä¹æ æ³æä¾æ´å¤åå­ãéä¿çè§£éæ¯ï¼jvm åå­ä¸è¶³äºã\n\nå¨ jvm è§èä¸­ï¼é¤äºç¨åºè®¡æ°å¨åºåå¤ï¼å¶ä»è¿è¡æ¶åºåé½å¯è½åç outofmemoryerror å¼å¸¸ï¼ç®ç§° oomï¼ã\n\nä¸é¢éä¸ä»ç» oom åçåºæ¯ã\n\n\n# å ç©ºé´æº¢åº\n\njava.lang.outofmemoryerror: java heap space è¿ä¸ªéè¯¯æå³çï¼å ç©ºé´æº¢åºã\n\næ´ç»è´çè¯´æ³æ¯ï¼java å åå­å·²ç»è¾¾å° -xmx è®¾ç½®çæå¤§å¼ãjava å ç¨äºå­å¨å¯¹è±¡å®ä¾ï¼åªè¦ä¸æ­å°åå»ºå¯¹è±¡ï¼å¹¶ä¸ä¿è¯ gc roots å°å¯¹è±¡ä¹é´æå¯è¾¾è·¯å¾æ¥é¿ååå¾æ¶éå¨åæ¶è¿äºå¯¹è±¡ï¼é£ä¹å½å ç©ºé´å°è¾¾æå¤§å®¹ééå¶åå°±ä¼äº§ç oomã\n\nå ç©ºé´æº¢åºæå¯è½æ¯**åå­æ³æ¼ï¼memory leakï¼** æ åå­æº¢åºï¼memory overflowï¼ ãéè¦ä½¿ç¨ jstack å jmap çæ threaddump å heapdumpï¼ç¶åç¨åå­åæå·¥å·ï¼å¦ï¼matï¼è¿è¡åæã\n\n# java heap space åææ­¥éª¤\n\n 1. ä½¿ç¨ jmap æ -xx:+heapdumponoutofmemoryerror è·åå å¿«ç§ã\n 2. ä½¿ç¨åå­åæå·¥å·ï¼visualvmãmatãjprofile ç­ï¼å¯¹å å¿«ç§æä»¶è¿è¡åæã\n 3. æ ¹æ®åæå¾ï¼éç¹æ¯ç¡®è®¤åå­ä¸­çå¯¹è±¡æ¯å¦æ¯å¿è¦çï¼åæ¸ç©¶ç«æ¯æ¯åå­æ³æ¼ï¼memory leakï¼è¿æ¯åå­æº¢åºï¼memory overflowï¼ã\n\n# åå­æ³æ¼\n\nåå­æ³æ¼æ¯æç±äºçå¿½æéè¯¯é æç¨åºæªè½éæ¾å·²ç»ä¸åä½¿ç¨çåå­çæåµã\n\nåå­æ³æ¼å¹¶éæåå­å¨ç©çä¸çæ¶å¤±ï¼èæ¯åºç¨ç¨åºåéææ®µåå­åï¼ç±äºè®¾è®¡éè¯¯ï¼å¤±å»äºå¯¹è¯¥æ®µåå­çæ§å¶ï¼å èé æäºåå­çæµªè´¹ãåå­æ³æ¼éçè¢«æ§è¡çæ¬¡æ°ä¸æ­å¢å ï¼æç»ä¼å¯¼è´åå­æº¢åºã\n\nåå­æ³æ¼å¸¸è§åºæ¯ï¼\n\n * éæå®¹å¨\n   * å£°æä¸ºéæï¼staticï¼ç hashmapãvector ç­éå\n   * éä¿æ¥è®² a ä¸­æ bï¼å½ååªæ b è®¾ç½®ä¸ºç©ºï¼a æ²¡æè®¾ç½®ä¸ºç©ºï¼åæ¶æ¶ b æ æ³åæ¶ãå ä¸ºè¢« a å¼ç¨ã\n * çå¬å¨\n   * çå¬å¨è¢«æ³¨ååéæ¾å¯¹è±¡æ¶æ²¡æå é¤çå¬å¨\n * ç©çè¿æ¥\n   * åç§è¿æ¥æ± å»ºç«äºè¿æ¥ï¼å¿é¡»éè¿ close() å³é­é¾æ¥\n * åé¨ç±»åå¤é¨æ¨¡åç­çå¼ç¨\n   * åç°å®çæ¹å¼ååå­æº¢åºï¼å¯åå ä¸ªå®æ¶è§å¯\n   * jstat -gcutil 7362 2500 70\n\néç¹å³æ³¨ï¼\n\n * fgc â ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶åç full gc çæ¬¡æ°ã\n * fgct â ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ full gc æç¨çæ¶é´ï¼åä½ç§ï¼ã\n * fgc æ¬¡æ°è¶å¤ï¼fgct æéæ¶é´è¶å¤ï¼è¶æå¯è½å­å¨åå­æ³æ¼ã\n\nå¦ææ¯åå­æ³æ¼ï¼å¯ä»¥è¿ä¸æ­¥æ¥çæ³æ¼å¯¹è±¡å° gc roots çå¯¹è±¡å¼ç¨é¾ãè¿æ ·å°±è½æ¾å°æ³æ¼å¯¹è±¡æ¯ææ ·ä¸ gc roots å³èå¹¶å¯¼è´ gc æ æ³åæ¶å®ä»¬çãææ¡äºè¿äºåå ï¼å°±å¯ä»¥è¾åç¡®çå®ä½åºå¼èµ·åå­æ³æ¼çä»£ç ã\n\nå¯¼è´åå­æ³æ¼çå¸¸è§åå æ¯ä½¿ç¨å®¹å¨ï¼ä¸ä¸æ­åå®¹å¨ä¸­æ·»å åç´ ï¼ä½æ²¡ææ¸çï¼å¯¼è´å®¹å¨åå­ä¸æ­è¨èã\n\nãç¤ºä¾ã\n\n/**\n * åå­æ³æ¼ç¤ºä¾\n * éè¯¯ç°è±¡ï¼java.lang.outofmemoryerror: java heap space\n * vm argsï¼-verbose:gc -xms10m -xmx10m -xx:+heapdumponoutofmemoryerror\n */\npublic class heapoutofmemorydemo {\n\n    public static void main(string[] args) {\n        list<oomobject> list = new arraylist<>();\n        while (true) {\n            list.add(new oomobject());\n        }\n    }\n\n    static class oomobject {}\n\n}\n\n\n# åå­æº¢åº\n\nå¦æä¸å­å¨åå­æ³æ¼ï¼å³åå­ä¸­çå¯¹è±¡ç¡®å®é½å¿é¡»å­æ´»çï¼ååºå½æ£æ¥èææºçå åæ°ï¼-xmx å -xmsï¼ï¼ä¸æºå¨ç©çåå­è¿è¡å¯¹æ¯ï¼ççæ¯å¦å¯ä»¥è°å¤§ãå¹¶ä»ä»£ç ä¸æ£æ¥æ¯å¦å­å¨æäºå¯¹è±¡çå½å¨æè¿é¿ãæææ¶é´è¿é¿çæåµï¼å°è¯åå°ç¨åºè¿è¡æçåå­æ¶èã\n\nãç¤ºä¾ã\n\n/**\n * å æº¢åºç¤ºä¾\n * <p>\n * éè¯¯ç°è±¡ï¼java.lang.outofmemoryerror: java heap space\n * <p>\n * vm argsï¼-verbose:gc -xms10m -xmx10m\n *\n * @author <a href="mailto:forbreak@163.com">zhang peng</a>\n * @since 2019-06-25\n */\npublic class heapoutofmemorydemo {\n\n    public static void main(string[] args) {\n        double[] array = new double[999999999];\n        system.out.println("array length = [" + array.length + "]");\n    }\n\n}\n\n\næ§è¡ java -verbose:gc -xms10m -xmx10m -xx:+heapdumponoutofmemoryerror io.github.dunwu.javacore.jvm.memory.heapmemoryleakmemoryerrordemo\n\nä¸é¢çä¾å­æ¯ä¸ä¸ªæç«¯çä¾å­ï¼è¯å¾åå»ºä¸ä¸ªç»´åº¦å¾å¤§çæ°ç»ï¼å åå­æ æ³åéè¿ä¹å¤§çåå­ï¼ä»èæ¥éï¼java heap spaceã\n\nä½å¦æå¨ç°å®ä¸­ï¼ä»£ç å¹¶æ²¡æé®é¢ï¼ä»ä»æ¯å ä¸ºå åå­ä¸è¶³ï¼å¯ä»¥éè¿ -xms å -xmx éå½è°æ´å åå­å¤§å°ã\n\n\n# gc å¼éè¶è¿éå¶\n\njava.lang.outofmemoryerror: gc overhead limit exceeded è¿ä¸ªéè¯¯ï¼å®æ¹ç»åºçå®ä¹æ¯ï¼è¶è¿ 98% çæ¶é´ç¨æ¥å gc å¹¶ä¸åæ¶äºä¸å° 2% çå åå­æ¶ä¼æåºæ­¤å¼å¸¸ãè¿æå³çï¼åçå¨ gc å ç¨å¤§éæ¶é´ä¸ºéæ¾å¾å°ç©ºé´çæ¶ååççï¼æ¯ä¸ç§ä¿æ¤æºå¶ãå¯¼è´å¼å¸¸çåå ï¼ä¸è¬æ¯å ä¸ºå å¤ªå°ï¼æ²¡æè¶³å¤çåå­ã\n\nãç¤ºä¾ã\n\n/**\n * gc overhead limit exceeded ç¤ºä¾\n * éè¯¯ç°è±¡ï¼java.lang.outofmemoryerror: gc overhead limit exceeded\n * åçå¨gcå ç¨å¤§éæ¶é´ä¸ºéæ¾å¾å°ç©ºé´çæ¶ååççï¼æ¯ä¸ç§ä¿æ¤æºå¶ãå¯¼è´å¼å¸¸çåå ï¼ä¸è¬æ¯å ä¸ºå å¤ªå°ï¼æ²¡æè¶³å¤çåå­ã\n * å®æ¹å¯¹æ­¤çå®ä¹ï¼è¶è¿98%çæ¶é´ç¨æ¥ågcå¹¶ä¸åæ¶äºä¸å°2%çå åå­æ¶ä¼æåºæ­¤å¼å¸¸ã\n * vm args: -xms10m -xmx10m\n */\npublic class gcoverheadlimitexceededdemo {\n\n    public static void main(string[] args) {\n        list<double> list = new arraylist<>();\n        double d = 0.0;\n        while (true) {\n            list.add(d++);\n        }\n    }\n\n}\n\n\nãå¤çã\n\nä¸ java heap space éè¯¯å¤çæ¹æ³ç±»ä¼¼ï¼åå¤æ­æ¯å¦å­å¨åå­æ³æ¼ãå¦ææï¼åä¿®æ­£ä»£ç ï¼å¦ææ²¡æï¼åéè¿ -xms å -xmx éå½è°æ´å åå­å¤§å°ã\n\n\n# æ°¸ä¹ä»£ç©ºé´ä¸è¶³\n\nãéè¯¯ã\n\njava.lang.outofmemoryerror: permgen space\n\n\nãåå ã\n\nperm ï¼æ°¸ä¹ä»£ï¼ç©ºé´ä¸»è¦ç¨äºå­æ¾ class å meta ä¿¡æ¯ï¼åæ¬ç±»çåç§°åå­æ®µï¼å¸¦ææ¹æ³å­èç çæ¹æ³ï¼å¸¸éæ± ä¿¡æ¯ï¼ä¸ç±»å³èçå¯¹è±¡æ°ç»åç±»åæ°ç»ä»¥åå³æ¶ç¼è¯å¨ä¼åãgc å¨ä¸»ç¨åºè¿è¡æé´ä¸ä¼å¯¹æ°¸ä¹ä»£ç©ºé´è¿è¡æ¸çï¼é»è®¤æ¯ 64m å¤§å°ã\n\næ ¹æ®ä¸é¢çå®ä¹ï¼å¯ä»¥å¾åº permgen å¤§å°è¦æ±åå³äºå è½½çç±»çæ°éä»¥åæ­¤ç±»å£°æçå¤§å°ãå æ­¤ï¼å¯ä»¥è¯´é æè¯¥éè¯¯çä¸»è¦åå æ¯æ°¸ä¹ä»£ä¸­è£å¥äºå¤ªå¤çç±»æå¤ªå¤§çç±»ã\n\nå¨ jdk8 ä¹åççæ¬ä¸­ï¼å¯ä»¥éè¿ -xx:permsize å -xx:maxpermsize è®¾ç½®æ°¸ä¹ä»£ç©ºé´å¤§å°ï¼ä»èéå¶æ¹æ³åºå¤§å°ï¼å¹¶é´æ¥éå¶å¶ä¸­å¸¸éæ± çå®¹éã\n\n# åå§åæ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³\n\nãç¤ºä¾ã\n\n/**\n * æ°¸ä¹ä»£åå­ç©ºé´ä¸è¶³ç¤ºä¾\n * <p>\n * éè¯¯ç°è±¡ï¼\n * <ul>\n * <li>java.lang.outofmemoryerror: permgen space (jdk8 ä»¥åçæ¬)</li>\n * <li>java.lang.outofmemoryerror: metaspace (jdk8 åä»¥åçæ¬)</li>\n * </ul>\n * vm args:\n * <ul>\n * <li>-xmx100m -xx:maxpermsize=16m (jdk8 ä»¥åçæ¬)</li>\n * <li>-xmx100m -xx:maxmetaspacesize=16m (jdk8 åä»¥åçæ¬)</li>\n * </ul>\n */\npublic class permoutofmemoryerrordemo {\n\n    public static void main(string[] args) throws exception {\n        for (int i = 0; i < 100_000_000; i++) {\n            generate("eu.plumbr.demo.generated" + i);\n        }\n    }\n\n    public static class generate(string name) throws exception {\n        classpool pool = classpool.getdefault();\n        return pool.makeclass(name).toclass();\n    }\n\n}\n\n\nå¨æ­¤ç¤ºä¾ä¸­ï¼æºä»£ç éåå¾ªç¯å¹¶å¨è¿è¡æ¶çæç±»ãjavassist åºæ­£å¨å¤çç±»çæçå¤ææ§ã\n\n# éé¨ç½²æ¶æ°¸ä¹ä»£ç©ºé´ä¸è¶³\n\nå¯¹äºæ´å¤æï¼æ´å®éçç¤ºä¾ï¼è®©æä»¬éæ­¥ä»ç»ä¸ä¸å¨åºç¨ç¨åºéæ°é¨ç½²æé´åçç permgen ç©ºé´éè¯¯ãéæ°é¨ç½²åºç¨ç¨åºæ¶ï¼ä½ å¸æåå¾åæ¶ä¼æè±å¼ç¨ææååå è½½çç±»çå è½½å¨ï¼å¹¶è¢«å è½½æ°ç±»çç±»å è½½å¨åä»£ã\n\nä¸å¹¸çæ¯ï¼è®¸å¤ç¬¬ä¸æ¹åºä»¥åå¯¹çº¿ç¨ï¼jdbc é©±å¨ç¨åºææä»¶ç³»ç»å¥æç­èµæºçä¸è¯å¤çä½¿å¾æ æ³å¸è½½ä»¥åä½¿ç¨çç±»å è½½å¨ãåè¿æ¥ï¼è¿æå³çå¨æ¯æ¬¡éæ°é¨ç½²æé´ï¼ææååçæ¬çç±»ä»å°é©»çå¨ permgen ä¸­ï¼ä»èå¨æ¯æ¬¡éæ°é¨ç½²æé´çææ°ååçåå¾ã\n\nè®©æä»¬æ³è±¡ä¸ä¸ªä½¿ç¨ jdbc é©±å¨ç¨åºè¿æ¥å°å³ç³»æ°æ®åºçç¤ºä¾åºç¨ç¨åºãå¯å¨åºç¨ç¨åºæ¶ï¼åå§åä»£ç å°å è½½ jdbc é©±å¨ç¨åºä»¥è¿æ¥å°æ°æ®åºãå¯¹åºäºè§èï¼jdbc é©±å¨ç¨åºå java.sql.drivermanager è¿è¡æ³¨åãè¯¥æ³¨ååæ¬å°å¯¹é©±å¨ç¨åºå®ä¾çå¼ç¨å­å¨å¨ drivermanager çéæå­æ®µä¸­ã\n\nç°å¨ï¼å½ä»åºç¨ç¨åºæå¡å¨åæ¶é¨ç½²åºç¨ç¨åºæ¶ï¼java.sql.drivermanager ä»å°ä¿çè¯¥å¼ç¨ãæä»¬æç»è·å¾äºå¯¹é©±å¨ç¨åºç±»çå®æ¶å¼ç¨ï¼èé©±å¨ç¨åºç±»åä¿çäºç¨äºå è½½åºç¨ç¨åºç java.lang.classloader å®ä¾çå¼ç¨ãåè¿æ¥ï¼è¿æå³çåå¾åæ¶ç®æ³æ æ³åæ¶ç©ºé´ã\n\nèä¸è¯¥ java.lang.classloader å®ä¾ä»å¼ç¨åºç¨ç¨åºçææç±»ï¼éå¸¸å¨ permgen ä¸­å æ®æ°ååå­èãè¿æå³çåªéå°ééæ°é¨ç½²å³å¯å¡«åéå¸¸å¤§å°ç permgenã\n\n# permgen space è§£å³æ¹æ¡\n\nï¼1ï¼è§£å³åå§åæ¶ç outofmemoryerror\n\nå¨åºç¨ç¨åºå¯å¨æé´è§¦åç±äº permgen èå°½å¯¼è´ç outofmemoryerror æ¶ï¼è§£å³æ¹æ¡å¾ç®åãè¯¥åºç¨ç¨åºä»éè¦æ´å¤ç©ºé´æè½å°ææç±»å è½½å° permgen åºåï¼å æ­¤æä»¬åªéè¦å¢å å¶å¤§å°å³å¯ãä¸ºæ­¤ï¼æ´æ¹ä½ çåºç¨ç¨åºå¯å¨éç½®å¹¶æ·»å ï¼æå¢å ï¼å¦æå­å¨ï¼-xx:maxpermsize åæ°ï¼ç±»ä¼¼äºä»¥ä¸ç¤ºä¾ï¼\n\njava -xx:maxpermsize=512m com.yourcompany.yourclass\n\n\nä¸é¢çéç½®å°åè¯ jvmï¼permgen å¯ä»¥å¢é¿å° 512mbã\n\næ¸çåºç¨ç¨åºä¸­ web-inf/lib ä¸ç jarï¼ç¨ä¸ä¸ç jar å é¤æï¼å¤ä¸ªåºç¨å¬å±ç jar ç§»å¨å° tomcat ç lib ç®å½ï¼åå°éå¤å è½½ã\n\nð æ³¨æï¼-xx:permsize ä¸è¬è®¾ä¸º 64m\n\nï¼2ï¼è§£å³éæ°é¨ç½²æ¶ç outofmemoryerror\n\néæ°é¨ç½²åºç¨ç¨åºåç«å³åç outofmemoryerror æ¶ï¼åºç¨ç¨åºä¼é­åç±»å è½½å¨æ³æ¼çå°æ°ãå¨è¿ç§æåµä¸ï¼è§£å³é®é¢çæç®åï¼ç»§ç»­è¿è¡å è½¬å¨åæâä½¿ç¨ç±»ä¼¼äºä»¥ä¸å½ä»¤çéæ°é¨ç½²åè¿è¡å è½¬å¨ï¼\n\njmap -dump:format=b,file=dump.hprof <process-id>\n\n\nç¶åä½¿ç¨ä½ æåæ¬¢çå è½¬å¨åæå¨æå¼è½¬å¨ï¼eclipse mat æ¯ä¸ä¸ªå¾å¥½çå·¥å·ï¼ãå¨åæå¨ä¸­å¯ä»¥æ¥æ¾éå¤çç±»ï¼å°¤å¶æ¯é£äºæ­£å¨å è½½åºç¨ç¨åºç±»çç±»ãä»é£éï¼ä½ éè¦è¿è¡ææç±»å è½½å¨çæ¥æ¾ï¼ä»¥æ¾å°å½åæ´»å¨çç±»å è½½å¨ã\n\nå¯¹äºéæ´»å¨ç±»å è½½å¨ï¼ä½ éè¦éè¿ä»éæ´»å¨ç±»å è½½å¨æ¶éå° gc æ ¹çæç­è·¯å¾æ¥ç¡®å®é»æ­¢å®ä»¬è¢«åå¾æ¶éçå¼ç¨ãæäºæ­¤ä¿¡æ¯ï¼ä½ å°æ¾å°æ ¹æ¬åå ãå¦ææ ¹æ¬åå æ¯å¨ç¬¬ä¸æ¹åºä¸­ï¼åå¯ä»¥è¿å¥ google/stackoverflow æ¥çæ¯å¦æ¯å·²ç¥é®é¢ä»¥è·åè¡¥ä¸/è§£å³æ¹æ³ã\n\nï¼3ï¼è§£å³è¿è¡æ¶ outofmemoryerror\n\nç¬¬ä¸æ­¥æ¯æ£æ¥æ¯å¦åè®¸ gc ä» permgen å¸è½½ç±»ãå¨è¿æ¹é¢ï¼æ åç jvm ç¸å½ä¿å®-ç±»æ¯å¤©ççãå æ­¤ï¼ä¸æ¦å è½½ï¼å³ä½¿æ²¡æä»£ç å¨ä½¿ç¨å®ä»¬ï¼ç±»ä¹ä¼ä¿çå¨åå­ä¸­ãå½åºç¨ç¨åºå¨æåå»ºè®¸å¤ç±»å¹¶ä¸é¿æ¶é´ä¸éè¦çæçç±»æ¶ï¼è¿å¯è½ä¼æä¸ºé®é¢ãå¨è¿ç§æåµä¸ï¼åè®¸ jvm å¸è½½ç±»å®ä¹å¯è½ä¼ææå¸®å©ãè¿å¯ä»¥éè¿å¨å¯å¨èæ¬ä¸­ä»æ·»å ä¸ä¸ªéç½®åæ°æ¥å®ç°ï¼\n\n-xx:+cmsclassunloadingenabled\n\n\né»è®¤æåµä¸ï¼æ­¤éé¡¹è®¾ç½®ä¸º falseï¼å æ­¤è¦å¯ç¨æ­¤åè½ï¼ä½ éè¦å¨ java éé¡¹ä¸­æ¾å¼è®¾ç½®ãå¦æå¯ç¨ cmsclassunloadingenabledï¼gc ä¹ä¼æ«æ permgen å¹¶å é¤ä¸åä½¿ç¨çç±»ãè¯·è®°ä½ï¼åªæåæ¶ä½¿ç¨ useconcmarksweepgc æ¶æ­¤éé¡¹æèµ·ä½ç¨ã\n\n-xx:+useconcmarksweepgc\n\n\nå¨ç¡®ä¿å¯ä»¥å¸è½½ç±»å¹¶ä¸é®é¢ä»ç¶å­å¨ä¹åï¼ä½ åºè¯¥ç»§ç»­è¿è¡å è½¬å¨åæâä½¿ç¨ç±»ä¼¼äºä»¥ä¸å½ä»¤çæ¹æ³è¿è¡å è½¬å¨ï¼\n\njmap -dump:file=dump.hprof,format=b <process-id>\n\n\nç¶åï¼ä½¿ç¨ä½ æåæ¬¢çå è½¬å¨åæå¨ï¼ä¾å¦ eclipse matï¼æå¼è½¬å¨ï¼ç¶åæ ¹æ®å·²å è½½çç±»æ°æ¥æ¾ææè´µçç±»å è½½å¨ãä»æ­¤ç±»å è½½å¨ä¸­ï¼ä½ å¯ä»¥ç»§ç»­æåå·²å è½½çç±»ï¼å¹¶æå®ä¾å¯¹æ­¤ç±»è¿è¡æåºï¼ä»¥ä½¿å¯çå¯¹è±¡æå¨é¦ä½ã\n\nç¶åï¼å¯¹äºæ¯ä¸ªå¯çèï¼å°±éè¦ä½ æå¨å°æ ¹æ¬åå è¿½æº¯å°çææ­¤ç±»çåºç¨ç¨åºä»£ç ã\n\n\n# åæ°æ®åºç©ºé´ä¸è¶³\n\nãéè¯¯ã\n\nexception in thread "main" java.lang.outofmemoryerror: metaspace\n\n\nãåå ã\n\njava8 ä»¥åï¼jvm åå­ç©ºé´åçäºå¾å¤§çååãåæ¶äºæ°¸ä¹ä»£ï¼è½¬èåä¸ºåæ°æ®åºã\n\nåæ°æ®åºçåå­ä¸è¶³ï¼å³æ¹æ³åºåè¿è¡æ¶å¸¸éæ± çç©ºé´ä¸è¶³ã\n\næ¹æ³åºç¨äºå­æ¾ class çç¸å³ä¿¡æ¯ï¼å¦ç±»åãè®¿é®ä¿®é¥°ç¬¦ãå¸¸éæ± ãå­æ®µæè¿°ãæ¹æ³æè¿°ç­ã\n\nä¸ä¸ªç±»è¦è¢«åå¾æ¶éå¨åæ¶ï¼å¤å®æ¡ä»¶æ¯æ¯è¾èå»çãå¨ç»å¸¸å¨æçæå¤§é class çåºç¨ä¸­ï¼éè¦ç¹å«æ³¨æç±»çåæ¶ç¶åµãè¿ç±»å¸¸è§é¤äº cglib å­èç å¢å¼ºåå¨æè¯­è¨ä»¥å¤ï¼å¸¸è§çè¿æï¼å¤§é jsp æå¨æäº§ç jsp æä»¶çåºç¨ï¼jsp ç¬¬ä¸æ¬¡è¿è¡æ¶éè¦ç¼è¯ä¸º java ç±»ï¼ãåºäº osgi çåºç¨ï¼å³ä½¿æ¯åä¸ä¸ªç±»æä»¶ï¼è¢«ä¸åçå è½½å¨å è½½ä¹ä¼è§ä¸ºä¸åçç±»ï¼ç­ã\n\nãç¤ºä¾ãæ¹æ³åºåºç° outofmemoryerror\n\npublic class methodareaoutofmemorydemo {\n\n    public static void main(string[] args) {\n        while (true) {\n            enhancer enhancer = new enhancer();\n            enhancer.setsuperclass(bean.class);\n            enhancer.setusecache(false);\n            enhancer.setcallback(new methodinterceptor() {\n                @override\n                public object intercept(object obj, method method, object[] args, methodproxy proxy) throws throwable {\n                    return proxy.invokesuper(obj, args);\n                }\n            });\n            enhancer.create();\n        }\n    }\n\n    static class bean {}\n\n}\n\n\nãè§£å³ã\n\nå½ç±äºåç©ºé´èé¢ä¸´ outofmemoryerror æ¶ï¼ç¬¬ä¸ä¸ªè§£å³æ¹æ¡åºè¯¥æ¯æ¾èæè§çãå¦æåºç¨ç¨åºèå°½äºåå­ä¸­ç metaspace åºåï¼ååºå¢å  metaspace çå¤§å°ãæ´æ¹åºç¨ç¨åºå¯å¨éç½®å¹¶å¢å ä»¥ä¸åå®¹ï¼\n\n-xx:maxmetaspacesize=512m\n\n\nä¸é¢çéç½®ç¤ºä¾åè¯ jvmï¼åè®¸ metaspace å¢é¿å° 512 mbã\n\nå¦ä¸ç§è§£å³æ¹æ¡çè³æ´ç®åãä½ å¯ä»¥éè¿å é¤æ­¤åæ°æ¥å®å¨è§£é¤å¯¹ metaspace å¤§å°çéå¶ï¼jvm é»è®¤å¯¹ metaspace çå¤§å°æ²¡æéå¶ãä½æ¯è¯·æ³¨æä»¥ä¸äºå®ï¼è¿æ ·åå¯è½ä¼å¯¼è´å¤§éäº¤æ¢æè¾¾å°æ¬æºç©çåå­èåéå¤±è´¥ã\n\n\n# æ æ³æ°å»ºæ¬å°çº¿ç¨\n\njava.lang.outofmemoryerror: unable to create new native thread è¿ä¸ªéè¯¯æå³çï¼java åºç¨ç¨åºå·²è¾¾å°å¶å¯ä»¥å¯å¨çº¿ç¨æ°çéå¶ã\n\nãåå ã\n\nå½åèµ·ä¸ä¸ªçº¿ç¨çåå»ºæ¶ï¼èææºä¼å¨ jvm åå­åå»ºä¸ä¸ª thread å¯¹è±¡åæ¶åå»ºä¸ä¸ªæä½ç³»ç»çº¿ç¨ï¼èè¿ä¸ªç³»ç»çº¿ç¨çåå­ç¨çä¸æ¯ jvm åå­ï¼èæ¯ç³»ç»ä¸­å©ä¸çåå­ã\n\né£ä¹ï¼ç©¶ç«è½åå»ºå¤å°çº¿ç¨å¢ï¼è¿éæä¸ä¸ªå¬å¼ï¼\n\nçº¿ç¨æ° = (maxprocessmemory - jvmmemory - reservedosmemory) / (threadstacksize)\n\n\nãåæ°ã\n\n * maxprocessmemory - ä¸ä¸ªè¿ç¨çæå¤§åå­\n * jvmmemory - jvm åå­\n * reservedosmemory - ä¿ççæä½ç³»ç»åå­\n * threadstacksize - çº¿ç¨æ çå¤§å°\n\nç» jvm åéçåå­è¶å¤ï¼é£ä¹è½ç¨æ¥åå»ºç³»ç»çº¿ç¨çåå­å°±ä¼è¶å°ï¼è¶å®¹æåç unable to create new native threadãæä»¥ï¼jvm åå­ä¸æ¯åéçè¶å¤§è¶å¥½ã\n\nä½æ¯ï¼éå¸¸å¯¼è´ java.lang.outofmemoryerror çæåµï¼æ æ³åå»ºæ°çæ¬æºçº¿ç¨éè¦ç»åä»¥ä¸é¶æ®µï¼\n\n 1. jvm åé¨è¿è¡çåºç¨ç¨åºè¯·æ±æ°ç java çº¿ç¨\n 2. jvm æ¬æºä»£ç ä»£çä¸ºæä½ç³»ç»åå»ºæ°æ¬æºçº¿ç¨çè¯·æ±\n 3. æä½ç³»ç»å°è¯åå»ºä¸ä¸ªæ°çæ¬æºçº¿ç¨ï¼è¯¥çº¿ç¨éè¦å°åå­åéç»è¯¥çº¿ç¨\n 4. æä½ç³»ç»å°æç»æ¬æºåå­åéï¼åå æ¯ 32 ä½ java è¿ç¨å¤§å°å·²èå°½å¶åå­å°åç©ºé´ï¼ä¾å¦ï¼å·²è¾¾å°ï¼2-4ï¼gb è¿ç¨å¤§å°éå¶ï¼ææä½ç³»ç»çèæåå­å·²å®å¨èå°½\n 5. å¼å java.lang.outofmemoryerror: unable to create new native thread éè¯¯ã\n\nãç¤ºä¾ã\n\npublic class unablecreatenativethreaderrordemo {\n\n    public static void main(string[] args) {\n        while (true) {\n            new thread(new runnable() {\n                @override\n                public void run() {\n                    try {\n                        timeunit.minutes.sleep(5);\n                    } catch (interruptedexception e) {\n                        e.printstacktrace();\n                    }\n                }\n            }).start();\n        }\n    }\n}\n\n\nãå¤çã\n\nå¯ä»¥éè¿å¢å æä½ç³»ç»çº§å«çéå¶æ¥ç»è¿æ æ³åå»ºæ°çæ¬æºçº¿ç¨é®é¢ãä¾å¦ï¼å¦æéå¶äº jvm å¯å¨ç¨æ·ç©ºé´ä¸­äº§ççè¿ç¨æ°ï¼ååºæ£æ¥åºå¹¶å¯è½å¢å è¯¥éå¶ï¼\n\n[root@dev ~]# ulimit -a\ncore file size          (blocks, -c) 0\n--- cut for brevity ---\nmax user processes              (-u) 1800\n\n\néå¸¸ï¼outofmemoryerror å¯¹æ°çæ¬æºçº¿ç¨çéå¶è¡¨ç¤ºç¼ç¨éè¯¯ãå½åºç¨ç¨åºäº§çæ°åä¸ªçº¿ç¨æ¶ï¼å¾å¯è½åºäºä¸äºé®é¢âå¾å°æåºç¨ç¨åºå¯ä»¥ä»å¦æ­¤å¤§éççº¿ç¨ä¸­åçã\n\nè§£å³é®é¢çä¸ç§æ¹æ³æ¯å¼å§è¿è¡çº¿ç¨è½¬å¨ä»¥äºè§£æåµã\n\n\n# ç´æ¥åå­æº¢åº\n\nç±ç´æ¥åå­å¯¼è´çåå­æº¢åºï¼ä¸ä¸ªææ¾çç¹å¾æ¯å¨ head dump æä»¶ä¸­ä¸ä¼çè§ææ¾çå¼å¸¸ï¼å¦æåç° oom ä¹å dump æä»¶å¾å°ï¼èç¨åºä¸­åç´æ¥æé´æ¥ä½¿ç¨äº nioï¼å°±å¯ä»¥èèæ£æ¥ä¸ä¸æ¯ä¸æ¯è¿æ¹é¢çåå ã\n\nãç¤ºä¾ãç´æ¥åå­ outofmemoryerror\n\n/**\n * æ¬æºç´æ¥åå­æº¢åºç¤ºä¾\n * éè¯¯ç°è±¡ï¼java.lang.outofmemoryerror\n * vm argsï¼-xmx20m -xx:maxdirectmemorysize=10m\n */\npublic class directoutofmemorydemo {\n\n    private static final int _1mb = 1024 * 1024;\n\n    public static void main(string[] args) throws illegalaccessexception {\n        field unsafefield = unsafe.class.getdeclaredfields()[0];\n        unsafefield.setaccessible(true);\n        unsafe unsafe = (unsafe) unsafefield.get(null);\n        while (true) {\n            unsafe.allocatememory(_1mb);\n        }\n    }\n\n}\n\n\n\n# stackoverflowerror\n\nå¯¹äº hotspot èææºæ¥è¯´ï¼æ å®¹éåªç± -xss åæ°æ¥å³å®å¦æçº¿ç¨è¯·æ±çæ æ·±åº¦å¤§äºèææºæåè®¸çæå¤§æ·±åº¦ï¼å°æåº stackoverflowerror å¼å¸¸ã\n\nä»å®ææ¥è¯´ï¼æ æº¢åºçå¸¸è§åå ï¼\n\n * éå½å½æ°è°ç¨å±æ°å¤ªæ·±\n * å¤§éå¾ªç¯ææ­»å¾ªç¯\n\nãç¤ºä¾ãéå½å½æ°è°ç¨å±æ°å¤ªæ·±å¯¼è´ stackoverflowerror\n\npublic class stackoverflowdemo {\n\n    private int stacklength = 1;\n\n    public void recursion() {\n        stacklength++;\n        recursion();\n    }\n\n    public static void main(string[] args) {\n        stackoverflowdemo obj = new stackoverflowdemo();\n        try {\n            obj.recursion();\n        } catch (throwable e) {\n            system.out.println("æ æ·±åº¦ï¼" + obj.stacklength);\n            e.printstacktrace();\n        }\n    }\n\n}\n\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * ãjava æ§è½è°ä¼å®æã\n * ä»è¡¨å°éå­¦ä¹  jvm å®ç°\n * ä½ä¸ºæµè¯ä½ åºè¯¥ç¥éç java oom åå®ä½åæ\n * å¼å¸¸ãå åå­æº¢åºãoom çå ç§æåµ\n * ä»ç» jvm ä¸­ oom ç 8 ç§ç±»å',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JVM ä½ç³»ç»æ",frontmatter:{title:"JVM ä½ç³»ç»æ",date:"2021-05-24T15:41:47.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM"],permalink:"/pages/08f153/"},regularPath:"/01.Java/01.JavaSE/06.JVM/01.JVM%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.html",relativePath:"01.Java/01.JavaSE/06.JVM/01.JVMä½ç³»ç»æ.md",key:"v-7fd1094f",path:"/pages/08f153/",headers:[{level:2,title:"JVM ç®ä»",slug:"jvm-ç®ä»",normalizedTitle:"jvm ç®ä»",charIndex:65},{level:3,title:"è®¡ç®æºä½ç³»ç»æ",slug:"è®¡ç®æºä½ç³»ç»æ",normalizedTitle:"è®¡ç®æºä½ç³»ç»æ",charIndex:76},{level:3,title:"JVM ä½ç³»ç»æç®ä»",slug:"jvm-ä½ç³»ç»æç®ä»",normalizedTitle:"jvm ä½ç³»ç»æç®ä»",charIndex:152},{level:2,title:"Hotspot æ¶æ",slug:"hotspot-æ¶æ",normalizedTitle:"hotspot æ¶æ",charIndex:287},{level:3,title:"Hotspot å³é®ç»ä»¶",slug:"hotspot-å³é®ç»ä»¶",normalizedTitle:"hotspot å³é®ç»ä»¶",charIndex:551},{level:3,title:"æ§è½ææ ",slug:"æ§è½ææ ",normalizedTitle:"æ§è½ææ ",charIndex:706},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1019}],headersStr:"JVM ç®ä» è®¡ç®æºä½ç³»ç»æ JVM ä½ç³»ç»æç®ä» Hotspot æ¶æ Hotspot å³é®ç»ä»¶ æ§è½ææ  åèèµæ",content:"# JVM ä½ç³»ç»æ\n\n> JVM è½è·¨å¹³å°å·¥ä½ï¼ä¸»è¦æ¯ç±äº JVM å±è½äºä¸åä¸ªè®¡ç®æºå¹³å°ç¸å³çè½¯ä»¶ãç¡¬ä»¶ä¹é´çå·®å¼ã\n\n\n# JVM ç®ä»\n\n\n# è®¡ç®æºä½ç³»ç»æ\n\nçå®çè®¡ç®æºä½ç³»ç»æçæ ¸å¿é¨ååå«ï¼\n\n * æä»¤é\n * è®¡ç®ååï¼CPUï¼\n * å¯»åæ¹å¼\n * å¯å­å¨\n * å­å¨åå\n\n\n# JVM ä½ç³»ç»æç®ä»\n\nJVM ä½ç³»ç»æä¸è®¡ç®æºä½ç³»ç»æç¸ä¼¼ï¼å®çæ ¸å¿é¨ååå«ï¼\n\n * JVM æä»¤é\n * ç±»å è½½å¨\n * æ§è¡å¼æ - ç¸å½äº JVM ç CPU\n * åå­åº - JVM çå­å¨\n * æ¬å°æ¹æ³è°ç¨ - è°ç¨ C/C++ å®ç°çæ¬å°æ¹æ³\n\n\n# Hotspot æ¶æ\n\nHotspot æ¯ææµè¡ç JVMã\n\nJava èææºçä¸»è¦ç»ä»¶ï¼åæ¬ç±»å è½½å¨ãè¿è¡æ¶æ°æ®åºåæ§è¡å¼æã\n\nHotspot èææºæ¥æä¸ä¸ªæ¶æï¼å®æ¯æå¼ºå¤§ç¹æ§åè½åçåºç¡å¹³å°ï¼æ¯æå®ç°é«æ§è½åå¼ºå¤§çå¯ä¼¸ç¼©æ§çè½åãä¸¾ä¸ªä¾å­ï¼Hotspot èææº JIT ç¼è¯å¨çæå¨æçä¼åï¼æ¢å¥è¯è¯´ï¼å®ä»¬å¨ Java åºç¨æ§è¡æååºä¼åï¼ä¸ºåºå±ç³»ç»æ¶æçæé«æ§è½çæ¬å°æºå¨æä»¤ãå¦å¤ï¼ç»è¿å®çè¿è¡æ¶ç¯å¢åå¤çº¿ç¨åå¾åæ¶æççè¿ååè¿ç»­çè®¾è®¡ï¼ Hotspot èææºå¨é«å¯ç¨è®¡ç®ç³»ç»ä¸äº§åºäºé«ä¼¸ç¼©æ§ã\n\n\n\n\n# Hotspot å³é®ç»ä»¶\n\nJava èææºæä¸ä¸ªç»ä»¶å³æ³¨çä»ä¹æ¶åè¿è¡æ§è½ä¼åï¼å ç©ºé´æ¯å¯¹è±¡æå­å¨çå°æ¹ï¼è¿ä¸ªåºåè¢«å¯å¨æ¶éæ©çåå¾åæ¶å¨ç®¡çï¼å¤§é¨åè°ä¼éé¡¹ä¸è°æ´å å¤§å°åæ ¹æ®ä½ çæåµéæ©æéå½çåå¾æ¶éå¨ç¸å³ãå³æ¶ç¼è¯å¨å¯¹æ§è½ä¹æå¾å¤§çå½±åï¼ä½æ¯ä½¿ç¨æ°çæ¬ç Java èææºæ¶å¾å°éè¦è°æ´ã\n\n\n\n\n# æ§è½ææ \n\nJava èææºçæ§è½ææ ä¸»è¦æä¸¤ç¹ï¼\n\n * åé¡¿æ¶é´ - ååºå»¶è¿æ¯æä¸ä¸ªåºç¨ååºä¸ä¸ªè¯·æ±çéåº¦æå¤å¿«ãå¯¹å³æ³¨ååºè½åçåºç¨æ¥è¯´ï¼é¿æåæ¶é´æ¯ä¸å¯æ¥åçï¼éç¹æ¯å¨ç­çæ¶é´å¨æåè½ååºååºã\n   * æ¡é¢ UI ååºäºä»¶çéåº¦\n   * ç½ç«è¿åç½é¡µçéåº¦\n   * æ°æ®æ¥è¯¢è¿åçéåº¦\n * ååé - ååéå³æ³¨å¨ç¹å®çæ¶é´å¨æåä¸ä¸ªåºç¨çå·¥ä½éçæå¤§å¼ãå¯¹å³æ³¨ååéçåºç¨æ¥è¯´é¿æåæ¶é´æ¯å¯ä»¥æ¥åçãç±äºé«ååéçåºç¨å³æ³¨çåºåå¨æ´é¿å¨ææ¶é´ä¸ï¼æä»¥å¿«éååºæ¶é´ä¸å¨èèä¹åã\n   * ç»å®æ¶é´åå®æäºå¡çæ°é\n   * ä¸å°æ¶åæ¹å¤çç¨åºå®æçå·¥ä½æ°é\n   * ä¸å°æ¶åæ°æ®æ¥è¯¢å®æçæ°é\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã",normalizedContent:"# jvm ä½ç³»ç»æ\n\n> jvm è½è·¨å¹³å°å·¥ä½ï¼ä¸»è¦æ¯ç±äº jvm å±è½äºä¸åä¸ªè®¡ç®æºå¹³å°ç¸å³çè½¯ä»¶ãç¡¬ä»¶ä¹é´çå·®å¼ã\n\n\n# jvm ç®ä»\n\n\n# è®¡ç®æºä½ç³»ç»æ\n\nçå®çè®¡ç®æºä½ç³»ç»æçæ ¸å¿é¨ååå«ï¼\n\n * æä»¤é\n * è®¡ç®ååï¼cpuï¼\n * å¯»åæ¹å¼\n * å¯å­å¨\n * å­å¨åå\n\n\n# jvm ä½ç³»ç»æç®ä»\n\njvm ä½ç³»ç»æä¸è®¡ç®æºä½ç³»ç»æç¸ä¼¼ï¼å®çæ ¸å¿é¨ååå«ï¼\n\n * jvm æä»¤é\n * ç±»å è½½å¨\n * æ§è¡å¼æ - ç¸å½äº jvm ç cpu\n * åå­åº - jvm çå­å¨\n * æ¬å°æ¹æ³è°ç¨ - è°ç¨ c/c++ å®ç°çæ¬å°æ¹æ³\n\n\n# hotspot æ¶æ\n\nhotspot æ¯ææµè¡ç jvmã\n\njava èææºçä¸»è¦ç»ä»¶ï¼åæ¬ç±»å è½½å¨ãè¿è¡æ¶æ°æ®åºåæ§è¡å¼æã\n\nhotspot èææºæ¥æä¸ä¸ªæ¶æï¼å®æ¯æå¼ºå¤§ç¹æ§åè½åçåºç¡å¹³å°ï¼æ¯æå®ç°é«æ§è½åå¼ºå¤§çå¯ä¼¸ç¼©æ§çè½åãä¸¾ä¸ªä¾å­ï¼hotspot èææº jit ç¼è¯å¨çæå¨æçä¼åï¼æ¢å¥è¯è¯´ï¼å®ä»¬å¨ java åºç¨æ§è¡æååºä¼åï¼ä¸ºåºå±ç³»ç»æ¶æçæé«æ§è½çæ¬å°æºå¨æä»¤ãå¦å¤ï¼ç»è¿å®çè¿è¡æ¶ç¯å¢åå¤çº¿ç¨åå¾åæ¶æççè¿ååè¿ç»­çè®¾è®¡ï¼ hotspot èææºå¨é«å¯ç¨è®¡ç®ç³»ç»ä¸äº§åºäºé«ä¼¸ç¼©æ§ã\n\n\n\n\n# hotspot å³é®ç»ä»¶\n\njava èææºæä¸ä¸ªç»ä»¶å³æ³¨çä»ä¹æ¶åè¿è¡æ§è½ä¼åï¼å ç©ºé´æ¯å¯¹è±¡æå­å¨çå°æ¹ï¼è¿ä¸ªåºåè¢«å¯å¨æ¶éæ©çåå¾åæ¶å¨ç®¡çï¼å¤§é¨åè°ä¼éé¡¹ä¸è°æ´å å¤§å°åæ ¹æ®ä½ çæåµéæ©æéå½çåå¾æ¶éå¨ç¸å³ãå³æ¶ç¼è¯å¨å¯¹æ§è½ä¹æå¾å¤§çå½±åï¼ä½æ¯ä½¿ç¨æ°çæ¬ç java èææºæ¶å¾å°éè¦è°æ´ã\n\n\n\n\n# æ§è½ææ \n\njava èææºçæ§è½ææ ä¸»è¦æä¸¤ç¹ï¼\n\n * åé¡¿æ¶é´ - ååºå»¶è¿æ¯æä¸ä¸ªåºç¨ååºä¸ä¸ªè¯·æ±çéåº¦æå¤å¿«ãå¯¹å³æ³¨ååºè½åçåºç¨æ¥è¯´ï¼é¿æåæ¶é´æ¯ä¸å¯æ¥åçï¼éç¹æ¯å¨ç­çæ¶é´å¨æåè½ååºååºã\n   * æ¡é¢ ui ååºäºä»¶çéåº¦\n   * ç½ç«è¿åç½é¡µçéåº¦\n   * æ°æ®æ¥è¯¢è¿åçéåº¦\n * ååé - ååéå³æ³¨å¨ç¹å®çæ¶é´å¨æåä¸ä¸ªåºç¨çå·¥ä½éçæå¤§å¼ãå¯¹å³æ³¨ååéçåºç¨æ¥è¯´é¿æåæ¶é´æ¯å¯ä»¥æ¥åçãç±äºé«ååéçåºç¨å³æ³¨çåºåå¨æ´é¿å¨ææ¶é´ä¸ï¼æä»¥å¿«éååºæ¶é´ä¸å¨èèä¹åã\n   * ç»å®æ¶é´åå®æäºå¡çæ°é\n   * ä¸å°æ¶åæ¹å¤çç¨åºå®æçå·¥ä½æ°é\n   * ä¸å°æ¶åæ°æ®æ¥è¯¢å®æçæ°é\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JVM åå¾æ¶é",frontmatter:{title:"JVM åå¾æ¶é",date:"2020-06-07T09:21:16.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM","GC"],permalink:"/pages/c5a5b6/"},regularPath:"/01.Java/01.JavaSE/06.JVM/03.JVM%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86.html",relativePath:"01.Java/01.JavaSE/06.JVM/03.JVMåå¾æ¶é.md",key:"v-7aafddb2",path:"/pages/c5a5b6/",headers:[{level:2,title:"å¯¹è±¡æ´»çå",slug:"å¯¹è±¡æ´»çå",normalizedTitle:"å¯¹è±¡æ´»çå",charIndex:113},{level:3,title:"å¼ç¨è®¡æ°ç®æ³",slug:"å¼ç¨è®¡æ°ç®æ³",normalizedTitle:"å¼ç¨è®¡æ°ç®æ³",charIndex:123},{level:3,title:"å¯è¾¾æ§åæç®æ³",slug:"å¯è¾¾æ§åæç®æ³",normalizedTitle:"å¯è¾¾æ§åæç®æ³",charIndex:598},{level:3,title:"å¼ç¨ç±»å",slug:"å¼ç¨ç±»å",normalizedTitle:"å¼ç¨ç±»å",charIndex:773},{level:4,title:"å¼ºå¼ç¨",slug:"å¼ºå¼ç¨",normalizedTitle:"å¼ºå¼ç¨",charIndex:866},{level:4,title:"è½¯å¼ç¨",slug:"è½¯å¼ç¨",normalizedTitle:"è½¯å¼ç¨",charIndex:970},{level:4,title:"å¼±å¼ç¨",slug:"å¼±å¼ç¨",normalizedTitle:"å¼±å¼ç¨",charIndex:1167},{level:4,title:"èå¼ç¨",slug:"èå¼ç¨",normalizedTitle:"èå¼ç¨",charIndex:2418},{level:3,title:"æ¹æ³åºçåæ¶",slug:"æ¹æ³åºçåæ¶",normalizedTitle:"æ¹æ³åºçåæ¶",charIndex:2666},{level:3,title:"finalize()",slug:"finalize",normalizedTitle:"finalize()",charIndex:3039},{level:2,title:"åå¾æ¶éç®æ³",slug:"åå¾æ¶éç®æ³",normalizedTitle:"åå¾æ¶éç®æ³",charIndex:3237},{level:3,title:"åå¾æ¶éæ§è½",slug:"åå¾æ¶éæ§è½",normalizedTitle:"åå¾æ¶éæ§è½",charIndex:3248},{level:3,title:"æ è®° - æ¸é¤ï¼Mark-Sweepï¼",slug:"æ è®°-æ¸é¤-mark-sweep",normalizedTitle:"æ è®° - æ¸é¤ï¼mark-sweepï¼",charIndex:3413},{level:3,title:"æ è®° - æ´çï¼Mark-Compactï¼",slug:"æ è®°-æ´ç-mark-compact",normalizedTitle:"æ è®° - æ´çï¼mark-compactï¼",charIndex:3520},{level:3,title:"å¤å¶ï¼Copyingï¼",slug:"å¤å¶-copying",normalizedTitle:"å¤å¶ï¼copyingï¼",charIndex:3614},{level:3,title:"åä»£æ¶é",slug:"åä»£æ¶é",normalizedTitle:"åä»£æ¶é",charIndex:4079},{level:4,title:"æ°çä»£",slug:"æ°çä»£",normalizedTitle:"æ°çä»£",charIndex:4208},{level:4,title:"èå¹´ä»£",slug:"èå¹´ä»£",normalizedTitle:"èå¹´ä»£",charIndex:4044},{level:4,title:"æ°¸ä¹ä»£",slug:"æ°¸ä¹ä»£",normalizedTitle:"æ°¸ä¹ä»£",charIndex:2683},{level:4,title:"JVM åæ°",slug:"jvm-åæ°",normalizedTitle:"jvm åæ°",charIndex:4884},{level:2,title:"åå¾æ¶éå¨",slug:"åå¾æ¶éå¨",normalizedTitle:"åå¾æ¶éå¨",charIndex:901},{level:3,title:"ä¸²è¡æ¶éå¨",slug:"ä¸²è¡æ¶éå¨",normalizedTitle:"ä¸²è¡æ¶éå¨",charIndex:5485},{level:4,title:"Serial æ¶éå¨",slug:"serial-æ¶éå¨",normalizedTitle:"serial æ¶éå¨",charIndex:5580},{level:4,title:"Serial Old æ¶éå¨",slug:"serial-old-æ¶éå¨",normalizedTitle:"serial old æ¶éå¨",charIndex:5767},{level:3,title:"å¹¶è¡æ¶éå¨",slug:"å¹¶è¡æ¶éå¨",normalizedTitle:"å¹¶è¡æ¶éå¨",charIndex:6179},{level:4,title:"Parallel Scavenge æ¶éå¨",slug:"parallel-scavenge-æ¶éå¨",normalizedTitle:"parallel scavenge æ¶éå¨",charIndex:6092},{level:4,title:"Parallel Old æ¶éå¨",slug:"parallel-old-æ¶éå¨",normalizedTitle:"parallel old æ¶éå¨",charIndex:6339},{level:3,title:"å¹¶åæ è®°æ¸é¤æ¶éå¨",slug:"å¹¶åæ è®°æ¸é¤æ¶éå¨",normalizedTitle:"å¹¶åæ è®°æ¸é¤æ¶éå¨",charIndex:7419},{level:4,title:"CMS æ¶éå¨",slug:"cms-æ¶éå¨",normalizedTitle:"cms æ¶éå¨",charIndex:6125},{level:5,title:"CMS åæ¶æºå¶",slug:"cms-åæ¶æºå¶",normalizedTitle:"cms åæ¶æºå¶",charIndex:7768},{level:5,title:"CMS åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤",slug:"cms-åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤",normalizedTitle:"cms åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤",charIndex:8055},{level:5,title:"CMS åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤",slug:"cms-åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤",normalizedTitle:"cms åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤",charIndex:8468},{level:5,title:"CMS ç¹ç¹",slug:"cms-ç¹ç¹",normalizedTitle:"cms ç¹ç¹",charIndex:8805},{level:4,title:"ParNew æ¶éå¨",slug:"parnew-æ¶éå¨",normalizedTitle:"parnew æ¶éå¨",charIndex:7552},{level:3,title:"G1 æ¶éå¨",slug:"g1-æ¶éå¨",normalizedTitle:"g1 æ¶éå¨",charIndex:9801},{level:4,title:"åä»£åååº",slug:"åä»£åååº",normalizedTitle:"åä»£åååº",charIndex:10047},{level:4,title:"G1 åæ¶æºå¶",slug:"g1-åæ¶æºå¶",normalizedTitle:"g1 åæ¶æºå¶",charIndex:10478},{level:4,title:"G1 åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤",slug:"g1-åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤",normalizedTitle:"g1 åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤",charIndex:11025},{level:4,title:"G1 åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤",slug:"g1-åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤",normalizedTitle:"g1 åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤",charIndex:12029},{level:3,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:11859},{level:2,title:"åå­åéä¸åæ¶ç­ç¥",slug:"åå­åéä¸åæ¶ç­ç¥",normalizedTitle:"åå­åéä¸åæ¶ç­ç¥",charIndex:13094},{level:3,title:"Minor GC",slug:"minor-gc",normalizedTitle:"minor gc",charIndex:4325},{level:3,title:"Full GC",slug:"full-gc",normalizedTitle:"full gc",charIndex:9280},{level:4,title:"åå­åéç­ç¥",slug:"åå­åéç­ç¥",normalizedTitle:"åå­åéç­ç¥",charIndex:13759},{level:4,title:"Full GC çè§¦åæ¡ä»¶",slug:"full-gc-çè§¦åæ¡ä»¶",normalizedTitle:"full gc çè§¦åæ¡ä»¶",charIndex:14598},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:15563}],headersStr:"å¯¹è±¡æ´»çå å¼ç¨è®¡æ°ç®æ³ å¯è¾¾æ§åæç®æ³ å¼ç¨ç±»å å¼ºå¼ç¨ è½¯å¼ç¨ å¼±å¼ç¨ èå¼ç¨ æ¹æ³åºçåæ¶ finalize() åå¾æ¶éç®æ³ åå¾æ¶éæ§è½ æ è®° - æ¸é¤ï¼Mark-Sweepï¼ æ è®° - æ´çï¼Mark-Compactï¼ å¤å¶ï¼Copyingï¼ åä»£æ¶é æ°çä»£ èå¹´ä»£ æ°¸ä¹ä»£ JVM åæ° åå¾æ¶éå¨ ä¸²è¡æ¶éå¨ Serial æ¶éå¨ Serial Old æ¶éå¨ å¹¶è¡æ¶éå¨ Parallel Scavenge æ¶éå¨ Parallel Old æ¶éå¨ å¹¶åæ è®°æ¸é¤æ¶éå¨ CMS æ¶éå¨ CMS åæ¶æºå¶ CMS åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤ CMS åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤ CMS ç¹ç¹ ParNew æ¶éå¨ G1 æ¶éå¨ åä»£åååº G1 åæ¶æºå¶ G1 åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤ G1 åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤ æ»ç» åå­åéä¸åæ¶ç­ç¥ Minor GC Full GC åå­åéç­ç¥ Full GC çè§¦åæ¡ä»¶ åèèµæ",content:"# JVM åå¾æ¶é\n\n> ç¨åºè®¡æ°å¨ãèææºæ åæ¬å°æ¹æ³æ è¿ä¸ä¸ªåºåå±äºçº¿ç¨ç§æçï¼åªå­å¨äºçº¿ç¨ççå½å¨æåï¼çº¿ç¨ç»æä¹åä¹ä¼æ¶å¤±ï¼å æ­¤ä¸éè¦å¯¹è¿ä¸ä¸ªåºåè¿è¡åå¾åæ¶ãåå¾åæ¶ä¸»è¦æ¯éå¯¹ Java å åæ¹æ³åºè¿è¡ã\n\n\n# å¯¹è±¡æ´»çå\n\n\n# å¼ç¨è®¡æ°ç®æ³\n\nç»å¯¹è±¡æ·»å ä¸ä¸ªå¼ç¨è®¡æ°å¨ï¼å½å¯¹è±¡å¢å ä¸ä¸ªå¼ç¨æ¶è®¡æ°å¨å  1ï¼å¼ç¨å¤±ææ¶è®¡æ°å¨å 1ãå¼ç¨è®¡æ°ä¸º 0 çå¯¹è±¡å¯è¢«åæ¶ã\n\nä¸¤ä¸ªå¯¹è±¡åºç°å¾ªç¯å¼ç¨çæåµä¸ï¼æ­¤æ¶å¼ç¨è®¡æ°å¨æ°¸è¿ä¸ä¸º 0ï¼å¯¼è´æ æ³å¯¹å®ä»¬è¿è¡åæ¶ã\n\npublic class ReferenceCountingGC {\n    public Object instance = null;\n\n    public static void main(String[] args) {\n        ReferenceCountingGC objectA = new ReferenceCountingGC();\n        ReferenceCountingGC objectB = new ReferenceCountingGC();\n        objectA.instance = objectB;\n        objectB.instance = objectA;\n    }\n}\n\n\nå ä¸ºå¾ªç¯å¼ç¨çå­å¨ï¼æä»¥ Java èææºä¸éç¨å¼ç¨è®¡æ°ç®æ³ã\n\n\n# å¯è¾¾æ§åæç®æ³\n\néè¿ GC Roots ä½ä¸ºèµ·å§ç¹è¿è¡æç´¢ï¼JVM å°è½å¤å°è¾¾å°çå¯¹è±¡è§ä¸ºå­æ´»ï¼ä¸å¯è¾¾çå¯¹è±¡è§ä¸ºæ­»äº¡ã\n\nå¯è¾¾æ§åæç®æ³\n\nå¯ä½ä¸º GC Roots çå¯¹è±¡åæ¬ä¸é¢å ç§ï¼\n\n * èææºæ ä¸­å¼ç¨çå¯¹è±¡\n * æ¬å°æ¹æ³æ ä¸­å¼ç¨çå¯¹è±¡ï¼Native æ¹æ³ï¼\n * æ¹æ³åºä¸­ï¼ç±»éæå±æ§å¼ç¨çå¯¹è±¡\n * æ¹æ³åºä¸­ï¼å¸¸éå¼ç¨çå¯¹è±¡\n\n\n# å¼ç¨ç±»å\n\næ è®ºæ¯éè¿å¼ç¨è®¡ç®ç®æ³å¤æ­å¯¹è±¡çå¼ç¨æ°éï¼è¿æ¯éè¿å¯è¾¾æ§åæç®æ³å¤æ­å¯¹è±¡çå¼ç¨é¾æ¯å¦å¯è¾¾ï¼å¤å®å¯¹è±¡æ¯å¦å¯è¢«åæ¶é½ä¸å¼ç¨æå³ã\n\nJava å·æåç§å¼ºåº¦ä¸åçå¼ç¨ç±»åã\n\n# å¼ºå¼ç¨\n\nè¢«å¼ºå¼ç¨ï¼Strong Referenceï¼å³èçå¯¹è±¡ä¸ä¼è¢«åå¾æ¶éå¨åæ¶ã\n\nå¼ºå¼ç¨ï¼ä½¿ç¨ new ä¸ä¸ªæ°å¯¹è±¡çæ¹å¼æ¥åå»ºå¼ºå¼ç¨ã\n\nObject obj = new Object();\n\n\n# è½¯å¼ç¨\n\nè¢«è½¯å¼ç¨ï¼Soft Referenceï¼å³èçå¯¹è±¡ï¼åªæå¨åå­ä¸å¤çæåµä¸æä¼è¢«åæ¶ã\n\nè½¯å¼ç¨ï¼ä½¿ç¨ SoftReference ç±»æ¥åå»ºè½¯å¼ç¨ã\n\nObject obj = new Object();\nSoftReference<Object> sf = new SoftReference<Object>(obj);\nobj = null; // ä½¿å¯¹è±¡åªè¢«è½¯å¼ç¨å³è\n\n\n# å¼±å¼ç¨\n\nè¢«å¼±å¼ç¨ï¼Weak Referenceï¼å³èçå¯¹è±¡ä¸å®ä¼è¢«åå¾æ¶éå¨åæ¶ï¼ä¹å°±æ¯è¯´å®åªè½å­æ´»å°ä¸ä¸æ¬¡åå¾æ¶éåçä¹åã\n\nä½¿ç¨ WeakReference ç±»æ¥å®ç°å¼±å¼ç¨ã\n\nObject obj = new Object();\nWeakReference<Object> wf = new WeakReference<Object>(obj);\nobj = null;\n\n\nWeakHashMap ç Entry ç»§æ¿èª WeakReferenceï¼ä¸»è¦ç¨æ¥å®ç°ç¼å­ã\n\nprivate static class Entry<K,V> extends WeakReference<Object> implements Map.Entry<K,V>\n\n\nTomcat ä¸­ç ConcurrentCache å°±ä½¿ç¨äº WeakHashMap æ¥å®ç°ç¼å­åè½ãConcurrentCache éåçæ¯åä»£ç¼å­ï¼ç»å¸¸ä½¿ç¨çå¯¹è±¡æ¾å¥ eden ä¸­ï¼èä¸å¸¸ç¨çå¯¹è±¡æ¾å¥ longtermãeden ä½¿ç¨ ConcurrentHashMap å®ç°ï¼longterm ä½¿ç¨ WeakHashMapï¼ä¿è¯äºä¸å¸¸ä½¿ç¨çå¯¹è±¡å®¹æè¢«åæ¶ã\n\npublic final class ConcurrentCache<K, V> {\n\n    private final int size;\n\n    private final Map<K, V> eden;\n\n    private final Map<K, V> longterm;\n\n    public ConcurrentCache(int size) {\n        this.size = size;\n        this.eden = new ConcurrentHashMap<>(size);\n        this.longterm = new WeakHashMap<>(size);\n    }\n\n    public V get(K k) {\n        V v = this.eden.get(k);\n        if (v == null) {\n            v = this.longterm.get(k);\n            if (v != null)\n                this.eden.put(k, v);\n        }\n        return v;\n    }\n\n    public void put(K k, V v) {\n        if (this.eden.size() >= size) {\n            this.longterm.putAll(this.eden);\n            this.eden.clear();\n        }\n        this.eden.put(k, v);\n    }\n}\n\n\n# èå¼ç¨\n\nåç§°ä¸ºå¹½çµå¼ç¨æèå¹»å½±å¼ç¨ãä¸ä¸ªå¯¹è±¡æ¯å¦æèå¼ç¨çå­å¨ï¼å®å¨ä¸ä¼å¯¹å¶çå­æ¶é´ææå½±åï¼ä¹æ æ³éè¿èå¼ç¨åå¾ä¸ä¸ªå¯¹è±¡å®ä¾ã\n\nä¸ºä¸ä¸ªå¯¹è±¡è®¾ç½®èå¼ç¨å³èçå¯ä¸ç®çå°±æ¯è½å¨è¿ä¸ªå¯¹è±¡è¢«æ¶éå¨åæ¶æ¶æ¶å°ä¸ä¸ªç³»ç»éç¥ã\n\nä½¿ç¨ PhantomReference æ¥å®ç°èå¼ç¨ã\n\nObject obj = new Object();\nPhantomReference<Object> pf = new PhantomReference<Object>(obj);\nobj = null;\n\n\n\n# æ¹æ³åºçåæ¶\n\nå ä¸ºæ¹æ³åºä¸»è¦å­æ¾æ°¸ä¹ä»£å¯¹è±¡ï¼èæ°¸ä¹ä»£å¯¹è±¡çåæ¶çæ¯å¹´è½»ä»£å·®å¾å¤ï¼å æ­¤å¨æ¹æ³åºä¸è¿è¡åæ¶æ§ä»·æ¯ä¸é«ã\n\nä¸»è¦æ¯å¯¹å¸¸éæ± çåæ¶åå¯¹ç±»çå¸è½½ã\n\nç±»çå¸è½½æ¡ä»¶å¾å¤ï¼éè¦æ»¡è¶³ä»¥ä¸ä¸ä¸ªæ¡ä»¶ï¼å¹¶ä¸æ»¡è¶³äºä¹ä¸ä¸å®ä¼è¢«å¸è½½ï¼\n\n * è¯¥ç±»ææçå®ä¾é½å·²ç»è¢«åæ¶ï¼ä¹å°±æ¯ Java å ä¸­ä¸å­å¨è¯¥ç±»çä»»ä½å®ä¾ã\n * å è½½è¯¥ç±»ç ClassLoader å·²ç»è¢«åæ¶ã\n * è¯¥ç±»å¯¹åºç java.lang.Class å¯¹è±¡æ²¡æå¨ä»»ä½å°æ¹è¢«å¼ç¨ï¼ä¹å°±æ æ³å¨ä»»ä½å°æ¹éè¿åå°è®¿é®è¯¥ç±»æ¹æ³ã\n\nå¯ä»¥éè¿ -Xnoclassgc åæ°æ¥æ§å¶æ¯å¦å¯¹ç±»è¿è¡å¸è½½ã\n\nå¨å¤§éä½¿ç¨åå°ãå¨æä»£çãCGLib ç­å­èç æ¡æ¶ãå¨æçæ JSP ä»¥å OSGi è¿ç±»é¢ç¹èªå®ä¹ ClassLoader çåºæ¯é½éè¦èææºå·å¤ç±»å¸è½½åè½ï¼ä»¥ä¿è¯ä¸ä¼åºç°åå­æº¢åºã\n\n\n# finalize()\n\nfinalize() ç±»ä¼¼ C++ çææå½æ°ï¼ç¨æ¥åå³é­å¤é¨èµæºç­å·¥ä½ãä½æ¯ try-finally ç­æ¹å¼å¯ä»¥åçæ´å¥½ï¼å¹¶ä¸è¯¥æ¹æ³è¿è¡ä»£ä»·é«æï¼ä¸ç¡®å®æ§å¤§ï¼æ æ³ä¿è¯åä¸ªå¯¹è±¡çè°ç¨é¡ºåºï¼å æ­¤æå¥½ä¸è¦ä½¿ç¨ finalize()ã\n\nå½ä¸ä¸ªå¯¹è±¡å¯è¢«åæ¶æ¶ï¼å¦æéè¦æ§è¡è¯¥å¯¹è±¡ç finalize() æ¹æ³ï¼é£ä¹å°±æå¯è½éè¿å¨è¯¥æ¹æ³ä¸­è®©å¯¹è±¡éæ°è¢«å¼ç¨ï¼ä»èå®ç°èªæã\n\n\n# åå¾æ¶éç®æ³\n\n\n# åå¾æ¶éæ§è½\n\nåå¾æ¶éå¨çæ§è½ææ ä¸»è¦æä¸¤ç¹ï¼\n\n * åé¡¿æ¶é´ - åé¡¿æ¶é´æ¯å ä¸º GC èå¯¼è´ç¨åºä¸è½å·¥ä½çæ¶é´é¿åº¦ã\n * ååé - ååéå³æ³¨å¨ç¹å®çæ¶é´å¨æåä¸ä¸ªåºç¨çå·¥ä½éçæå¤§å¼ãå¯¹å³æ³¨ååéçåºç¨æ¥è¯´é¿æåæ¶é´æ¯å¯ä»¥æ¥åçãç±äºé«ååéçåºç¨å³æ³¨çåºåå¨æ´é¿å¨ææ¶é´ä¸ï¼æä»¥å¿«éååºæ¶é´ä¸å¨èèä¹åã\n\n\n# æ è®° - æ¸é¤ï¼Mark-Sweepï¼\n\n\n\nå°éè¦åæ¶çå¯¹è±¡è¿è¡æ è®°ï¼ç¶åæ¸çæè¢«æ è®°çå¯¹è±¡ã\n\nä¸è¶³ï¼\n\n * æ è®°åæ¸é¤è¿ç¨æçé½ä¸é«ï¼\n * ä¼äº§çå¤§éä¸è¿ç»­çåå­ç¢çï¼å¯¼è´æ æ³ç»å¤§å¯¹è±¡åéåå­ã\n\n\n# æ è®° - æ´çï¼Mark-Compactï¼\n\n\n\nè®©ææå­æ´»çå¯¹è±¡é½åä¸ç«¯ç§»å¨ï¼ç¶åç´æ¥æ¸çæç«¯è¾¹çä»¥å¤çåå­ã\n\nè¿ç§åæ³è½å¤è§£å³åå­ç¢çåçé®é¢ï¼ä½ä»£ä»·æ¯åç¼©ç®æ³çæ§è½å¼éã\n\n\n# å¤å¶ï¼Copyingï¼\n\n\n\nå°åå­ååä¸ºå¤§å°ç¸ç­çä¸¤åï¼æ¯æ¬¡åªä½¿ç¨å¶ä¸­ä¸åï¼å½è¿ä¸ååå­ç¨å®äºå°±å°è¿å­æ´»çå¯¹è±¡å¤å¶å°å¦ä¸åä¸é¢ï¼ç¶ååæä½¿ç¨è¿çåå­ç©ºé´è¿è¡ä¸æ¬¡æ¸çã\n\nä¸»è¦ä¸è¶³æ¯åªä½¿ç¨äºåå­çä¸åã\n\nç°å¨çåä¸èææºé½éç¨è¿ç§æ¶éç®æ³æ¥åæ¶å¹´è½»ä»£ï¼ä½æ¯å¹¶ä¸æ¯å°åå­ååä¸ºå¤§å°ç¸ç­çä¸¤åï¼èæ¯åä¸ºä¸åè¾å¤§ç Eden ç©ºé´åä¸¤åè¾å°ç Survior ç©ºé´ï¼æ¯æ¬¡ä½¿ç¨ Eden ç©ºé´åå¶ä¸­ä¸å Survivorãå¨åæ¶æ¶ï¼å° Eden å Survivor ä¸­è¿å­æ´»ççå¯¹è±¡ä¸æ¬¡æ§å¤å¶å°å¦ä¸å Survivor ç©ºé´ä¸ï¼æåæ¸ç Eden åä½¿ç¨è¿çé£ä¸å SurvivorãHotSpot èææºç Eden å Survivor çå¤§å°æ¯ä¾é»è®¤ä¸º 8:1ï¼å¯ä»¥éè¿åæ° -XX:SurvivorRatio æ¥è°æ´æ¯ä¾ï¼ï¼ä¿è¯äºåå­çå©ç¨çè¾¾å° 90 %ãå¦ææ¯æ¬¡åæ¶æå¤äº 10% çå¯¹è±¡å­æ´»ï¼é£ä¹ä¸å Survivor ç©ºé´å°±ä¸å¤ç¨äºï¼æ­¤æ¶éè¦ä¾èµäºèå¹´ä»£è¿è¡åéæä¿ï¼ä¹å°±æ¯åç¨èå¹´ä»£çç©ºé´å­å¨æ¾ä¸ä¸çå¯¹è±¡ã\n\n\n# åä»£æ¶é\n\nç°å¨çåä¸èææºéç¨åä»£æ¶éç®æ³ï¼å®æ ¹æ®å¯¹è±¡å­æ´»å¨æå°åå­ååä¸ºå åï¼ä¸ååéç¨éå½çæ¶éç®æ³ã\n\nä¸è¬å° Java å åä¸ºå¹´è½»ä»£åèå¹´ä»£ã\n\n * å¹´è½»ä»£ä½¿ç¨ï¼å¤å¶ ç®æ³\n * èå¹´ä»£ä½¿ç¨ï¼æ è®° - æ¸ç æè æ è®° - æ´ç ç®æ³\n\n\n\n# æ°çä»£\n\næ°çä»£æ¯å¤§é¨åå¯¹è±¡åå»ºåéæ¯çåºåï¼å¨éå¸¸ç Java åºç¨ä¸­ï¼ç»å¤§é¨åå¯¹è±¡çå½å¨æé½æ¯å¾ç­æçãå¶åé¨ååä¸º Eden åºåï¼ä½ä¸ºå¯¹è±¡åå§åéçåºåï¼ä¸¤ä¸ª Survivorï¼ææ¶åä¹å« fromãto åºåï¼è¢«ç¨æ¥æ¾ç½®ä» Minor GC ä¸­ä¿çä¸æ¥çå¯¹è±¡ã\n\nJVM ä¼éæéåä¸ä¸ª Survivor åºåä½ä¸º toï¼ç¶åä¼å¨ GC è¿ç¨ä¸­è¿è¡åºåé´æ·è´ï¼ä¹å°±æ¯å° Eden ä¸­å­æ´»ä¸æ¥çå¯¹è±¡å from åºåçå¯¹è±¡ï¼æ·è´å°è¿ä¸ªtoåºåãè¿ç§è®¾è®¡ä¸»è¦æ¯ä¸ºäºé²æ­¢åå­çç¢çåï¼å¹¶è¿ä¸æ­¥æ¸çæ ç¨å¯¹è±¡ã\n\nJava èææºä¼è®°å½ Survivor åºä¸­çå¯¹è±¡ä¸å±è¢«æ¥åå¤å¶äºå æ¬¡ãå¦æä¸ä¸ªå¯¹è±¡è¢«å¤å¶çæ¬¡æ°ä¸º 15ï¼å¯¹åºèææºåæ° -XX:+MaxTenuringThresholdï¼ï¼é£ä¹è¯¥å¯¹è±¡å°è¢«æåï¼promoteï¼è³èå¹´ä»£ãå¦å¤ï¼å¦æåä¸ª Survivor åºå·²ç»è¢«å ç¨äº 50%ï¼å¯¹åºèææºåæ° -XX:TargetSurvivorRatioï¼ï¼é£ä¹è¾é«å¤å¶æ¬¡æ°çå¯¹è±¡ä¹ä¼è¢«æåè³èå¹´ä»£ã\n\n# èå¹´ä»£\n\næ¾ç½®é¿çå½å¨æçå¯¹è±¡ï¼éå¸¸é½æ¯ä» Survivor åºåæ·è´è¿æ¥çå¯¹è±¡ãå½ç¶ï¼ä¹æç¹æ®æåµï¼å¦æå¯¹è±¡è¾å¤§ï¼JVM ä¼è¯å¾ç´æ¥åéå¨ Eden å¶ä»ä½ç½®ä¸ï¼å¦æå¯¹è±¡å¤ªå¤§ï¼å®å¨æ æ³å¨æ°çä»£æ¾å°è¶³å¤é¿çè¿ç»­ç©ºé²ç©ºé´ï¼JVM å°±ä¼ç´æ¥åéå°èå¹´ä»£ã\n\n# æ°¸ä¹ä»£\n\nè¿é¨åå°±æ¯æ©æ Hotspot JVM çæ¹æ³åºå®ç°æ¹å¼äºï¼å¨å­ Java ç±»åæ°æ®ãå¸¸éæ± ãIntern å­ç¬¦ä¸²ç¼å­ãå¨ JDK 8 ä¹åå°±ä¸å­å¨æ°¸ä¹ä»£è¿åå¿äºã\n\n# JVM åæ°\n\nè¿éé¡ºä¾¿æä¸ä¸ï¼JVM åè®¸å¯¹å ç©ºé´å¤§å°ãåä»£ç©ºé´å¤§å°è¿è¡è®¾ç½®ï¼ä»¥è°æ´ JVM GCã\n\néç½®                  æè¿°\n-Xss                èææºæ å¤§å°ã\n-Xms                å ç©ºé´åå§å¼ã\n-Xmx                å ç©ºé´æå¤§å¼ã\n-Xmn                æ°çä»£ç©ºé´å¤§å°ã\n-XX:NewSize         æ°çä»£ç©ºé´åå§å¼ã\n-XX:MaxNewSize      æ°çä»£ç©ºé´æå¤§å¼ã\n-XX:NewRatio        æ°çä»£ä¸å¹´èä»£çæ¯ä¾ãé»è®¤ä¸º 2ï¼æå³çèå¹´ä»£æ¯æ°çä»£ç 2 åã\n-XX:SurvivorRatio   æ°çä»£ä¸­è°æ´ eden åºä¸ survivor åºçæ¯ä¾ï¼é»è®¤ä¸º 8ãå³ eden åºä¸º 80% çå¤§å°ï¼ä¸¤ä¸ª\n                    survivor åå«ä¸º 10% çå¤§å°ã\n-XX:PermSize        æ°¸ä¹ä»£ç©ºé´çåå§å¼ã\n-XX:MaxPermSize     æ°¸ä¹ä»£ç©ºé´çæå¤§å¼ã\n\n\n# åå¾æ¶éå¨\n\n\n\nä»¥ä¸æ¯ HotSpot èææºä¸­ç 7 ä¸ªåå¾æ¶éå¨ï¼è¿çº¿è¡¨ç¤ºåå¾æ¶éå¨å¯ä»¥éåä½¿ç¨ã\n\næ³¨ï¼G1 åå¾æ¶éå¨æ¢å¯ä»¥åæ¶å¹´è½»ä»£åå­ï¼ä¹å¯ä»¥åæ¶èå¹´ä»£åå­ãèå¶ä»åå¾æ¶éå¨åªè½éå¯¹ç¹å®ä»£çåå­è¿è¡åæ¶ã\n\n\n# ä¸²è¡æ¶éå¨\n\nä¸²è¡æ¶éå¨ï¼Serialï¼æ¯æåºæ¬ãåå±åå²ææ ä¹çæ¶éå¨ã\n\nä¸²è¡æ¶éå¨æ¯ client æ¨¡å¼ä¸çé»è®¤æ¶éå¨éç½®ãå ä¸ºå¨å®¢æ·ç«¯æ¨¡å¼ä¸ï¼åéç»èææºç®¡ççåå­ä¸è¬æ¥è¯´ä¸ä¼å¾å¤§ãSerial æ¶éå¨æ¶éå ååçè³ä¸ä¸¤ç¾åçå¹´è½»ä»£åé¡¿æ¶é´å¯ä»¥æ§å¶å¨ä¸ç¾å¤æ¯«ç§ä»¥åï¼åªè¦ä¸æ¯å¤ªé¢ç¹ï¼è¿ç¹åé¡¿æ¯å¯ä»¥æ¥åçã\n\nä¸²è¡æ¶éå¨éç¨åçº¿ç¨ stop-the-world çæ¹å¼è¿è¡æ¶éãå½åå­ä¸è¶³æ¶ï¼ä¸²è¡ GC è®¾ç½®åé¡¿æ è¯ï¼å¾ææçº¿ç¨é½è¿å¥å®å¨ç¹ï¼Safepointï¼æ¶ï¼åºç¨çº¿ç¨æåï¼ä¸²è¡ GC å¼å§å·¥ä½ï¼éç¨åçº¿ç¨æ¹å¼åæ¶ç©ºé´å¹¶æ´çåå­ã\n\nSerial / Serial Old æ¶éå¨è¿è¡ç¤ºæå¾\n\nåçº¿ç¨æå³çå¤æåº¦æ´ä½ãå ç¨åå­æ´å°ï¼åå¾åæ¶æçé«ï¼ä½åæ¶ä¹æå³çä¸è½ææå©ç¨å¤æ ¸ä¼å¿ãäºå®ä¸ï¼ä¸²è¡æ¶éå¨ç¹å«éåå åå­ä¸é«ãåæ ¸çè³åæ ¸ CPU çåºåã\n\n# Serial æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-XX:+UseSerialGC\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ Serial + Serial Old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n\n# Serial Old æ¶éå¨\n\nSerial Old æ¯ Serial æ¶éå¨çèå¹´ä»£çæ¬ï¼ä¹æ¯ç» Client æ¨¡å¼ä¸çèææºä½¿ç¨ãå¦æç¨å¨ Server æ¨¡å¼ä¸ï¼å®æä¸¤å¤§ç¨éï¼\n\n * å¨ JDK 1.5 ä»¥åä¹åçæ¬ï¼Parallel Old è¯çä»¥åï¼ä¸­ä¸ Parallel Scavenge æ¶éå¨æ­éä½¿ç¨ã\n * ä½ä¸º CMS æ¶éå¨çåå¤é¢æ¡ï¼å¨å¹¶åæ¶éåç Concurrent Mode Failure æ¶ä½¿ç¨ã\n\n\n# å¹¶è¡æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-XX:+UseParallelGC\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ Parallel Scavenge + Serial Old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n> \n> å¼å¯éé¡¹ï¼-XX:+UseParallelOldGC\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ Parallel Scavenge + Parallel Old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n\nå¶ä»æ¶éå¨é½æ¯ä»¥å³æ³¨åé¡¿æ¶é´ä¸ºç®æ ï¼èå¹¶è¡æ¶éå¨æ¯ä»¥å³æ³¨ååéï¼Throughputï¼ä¸ºç®æ çåå¾æ¶éå¨ã\n\n * åé¡¿æ¶é´è¶ç­å°±è¶éåéè¦ä¸ç¨æ·äº¤äºçç¨åºï¼è¯å¥½çååºéåº¦è½æåç¨æ·ä½éªï¼\n * èé«ååéåå¯ä»¥é«æçå°å©ç¨ CPU æ¶é´ï¼å°½å¿«å®æç¨åºçè¿ç®ä»»å¡ï¼ä¸»è¦éåå¨åå°è¿ç®èä¸éè¦å¤ªå¤äº¤äºçä»»å¡ã\n\nååé = è¿è¡ç¨æ·ä»£ç æ¶é´ / (è¿è¡ç¨æ·ä»£ç æ¶é´ + åå¾æ¶éæ¶é´)\n\n\nå¹¶è¡æ¶éå¨æ¯ server æ¨¡å¼ä¸çé»è®¤æ¶éå¨ã\n\nå¹¶è¡æ¶éå¨ä¸ä¸²è¡æ¶éå¨å·¥ä½æ¨¡å¼ç¸ä¼¼ï¼é½æ¯ stop-the-world æ¹å¼ï¼åªæ¯æåæ¶å¹¶è¡å°è¿è¡åå¾æ¶éãå¹¶è¡æ¶éå¨å¹´è½»ä»£éç¨å¤å¶ç®æ³ï¼èå¹´ä»£éç¨æ è®°-æ´çï¼å¨åæ¶çåæ¶è¿ä¼å¯¹åå­è¿è¡åç¼©ãå¹¶è¡æ¶éå¨éåå¯¹ååéè¦æ±è¿è¿é«äºå»¶è¿è¦æ±çåºæ¯ï¼å¹¶ä¸å¨æ»¡è¶³æå·®å»¶æ¶çæåµä¸ï¼å¹¶è¡æ¶éå¨å°æä¾æä½³çååéã\n\nå¨æ³¨éååéä»¥å CPU èµæºææçåºåï¼é½å¯ä»¥ä¼åèè Parallel Scavenge æ¶éå¨ + Parallel Old æ¶éå¨ã\n\nParallel / Parallel Old æ¶éå¨è¿è¡ç¤ºæå¾\n\n# Parallel Scavenge æ¶éå¨\n\nParallel Scavenge æ¶éå¨æä¾äºä¸¤ä¸ªåæ°ç¨äºç²¾ç¡®æ§å¶ååéï¼åå«æ¯ï¼\n\n * -XX:MaxGCPauseMillis - æ§å¶æå¤§åå¾æ¶éåé¡¿æ¶é´ï¼æ¶éå¨å°å°½å¯è½ä¿è¯åå­åæ¶æ¶é´ä¸è¶è¿è®¾å®å¼ã\n * -XX:GCTimeRatio - ç´æ¥è®¾ç½®ååéå¤§å°çï¼å¼ä¸ºå¤§äº 0 ä¸å°äº 100 çæ´æ°ï¼ã\n\nç¼©ç­åé¡¿æ¶é´æ¯ä»¥çºç²ååéåå¹´è½»ä»£ç©ºé´æ¥æ¢åçï¼å¹´è½»ä»£ç©ºé´åå°ï¼åå¾åæ¶åå¾é¢ç¹ï¼å¯¼è´ååéä¸éã\n\nParallel Scavenge æ¶éå¨è¿æä¾äºä¸ä¸ªåæ° -XX:+UseAdaptiveSizePolicyï¼è¿æ¯ä¸ä¸ªå¼å³åæ°ï¼æå¼åæ°åï¼å°±ä¸éè¦æå·¥æå®å¹´è½»ä»£çå¤§å°ï¼-Xmnï¼ãEden å Survivor åºçæ¯ä¾ï¼-XX:SurvivorRatioï¼ãæåèå¹´ä»£å¯¹è±¡å¹´é¾ï¼-XX:PretenureSizeThresholdï¼ç­ç»èåæ°äºï¼èææºä¼æ ¹æ®å½åç³»ç»çè¿è¡æåµæ¶éæ§è½çæ§ä¿¡æ¯ï¼å¨æè°æ´è¿äºåæ°ä»¥æä¾æåéçåé¡¿æ¶é´æèæå¤§çååéï¼è¿ç§æ¹å¼ç§°ä¸º GC èªéåºçè°èç­ç¥ï¼GC Ergonomicsï¼ã\n\n# Parallel Old æ¶éå¨\n\næ¯ Parallel Scavenge æ¶éå¨çèå¹´ä»£çæ¬ï¼ä½¿ç¨å¤çº¿ç¨å âæ è®°-æ´çâ ç®æ³ã\n\n\n# å¹¶åæ è®°æ¸é¤æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-XX:+UseConcMarkSweepGC\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ CMS + ParNew + Serial Old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n\nå¹¶åæ è®°æ¸é¤æ¶éå¨æ¯ä»¥è·åæç­åé¡¿æ¶é´ä¸ºç®æ ã\n\nå¼å¯åï¼å¹´è½»ä»£ä½¿ç¨ ParNew æ¶éå¨ï¼èå¹´ä»£ä½¿ç¨ CMS æ¶éå¨ï¼å¦æ CMS äº§ççç¢çè¿å¤ï¼å¯¼è´æ æ³å­æ¾æµ®å¨åå¾ï¼JVM ä¼åºç° Concurrent Mode Failure ï¼æ­¤æ¶ä½¿ç¨ Serial Old æ¶éå¨æ¥æ¿ä»£ CMS æ¶éå¨æ¸çç¢çã\n\n# CMS æ¶éå¨\n\nCMS æ¶éå¨æ¯ä¸ç§ä»¥è·åæç­åé¡¿æ¶é´ä¸ºç®æ çæ¶éå¨ã\n\nCMSï¼Concurrent Mark Sweepï¼ï¼Mark Sweep æçæ¯æ è®° - æ¸é¤ç®æ³ã\n\n# CMS åæ¶æºå¶\n\nCMS æ¶éå¨è¿è¡æ­¥éª¤å¦ä¸ï¼\n\n 1. åå§æ è®°ï¼ä»ä»åªæ¯æ è®°ä¸ä¸ GC Roots è½ç´æ¥å³èå°çå¯¹è±¡ï¼éåº¦å¾å¿«ï¼éè¦åé¡¿ã\n 2. å¹¶åæ è®°ï¼è¿è¡ GC Roots Tracing çè¿ç¨ï¼å®å¨æ´ä¸ªåæ¶è¿ç¨ä¸­èæ¶æé¿ï¼ä¸éè¦åé¡¿ã\n 3. éæ°æ è®°ï¼ä¸ºäºä¿®æ­£å¹¶åæ è®°æé´å ç¨æ·ç¨åºç»§ç»­è¿ä½èå¯¼è´æ è®°äº§çåå¨çé£ä¸é¨åå¯¹è±¡çæ è®°è®°å½ï¼éè¦åé¡¿ã\n 4. å¹¶åæ¸é¤ï¼åæ¶å¨æ è®°é¶æ®µè¢«é´å®ä¸ºä¸å¯è¾¾çå¯¹è±¡ãä¸éè¦åé¡¿ã\n\nå¨æ´ä¸ªè¿ç¨ä¸­èæ¶æé¿çå¹¶åæ è®°åå¹¶åæ¸é¤è¿ç¨ä¸­ï¼æ¶éå¨çº¿ç¨é½å¯ä»¥ä¸ç¨æ·çº¿ç¨ä¸èµ·å·¥ä½ï¼ä¸éè¦è¿è¡åé¡¿ã\n\nCMS æ¶éå¨è¿è¡ç¤ºæå¾\n\n# CMS åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼å ç©ºé´è¢«åå²ä¸ºä¸åç©ºé´\n\nå¹´è½»ä»£åå²æä¸ä¸ª Eden åºåä¸¤ä¸ª Survivor åºãå¹´èä»£ä¸ä¸ªè¿ç»­çç©ºé´ãå°±å°å®æå¯¹è±¡æ¶éãé¤éæ FullGC å¦åä¸ä¼åç¼©ã\n\nï¼2ï¼CMS å¹´è½»ä»£åå¾æ¶éå¦ä½å·¥ä½\n\nå¹´è½»ä»£è¢«æ ä¸ºæµç»¿è²ï¼å¹´èä»£è¢«æ è®°ä¸ºèè²ãå¦æä½ çåºç¨å·²ç»è¿è¡äºä¸æ®µæ¶é´ï¼CMS çå çèµ·æ¥åºè¯¥æ¯è¿ä¸ªæ ·å­ãå¯¹è±¡åæ£å¨å¹´èä»£åºåéã\n\n\n\nä½¿ç¨ CMSï¼å¹´èä»£å¯¹è±¡å°±å°éæ¾ãå®ä»¬ä¸ä¼è¢«æ¥åç§»å¨ãè¿ä¸ªç©ºé´ä¸ä¼è¢«åç¼©é¤éåç FullGCã\n\nï¼3ï¼å¹´è½»ä»£æ¶é\n\nä» Eden å Survivor åºå¤å¶æ´»è·å¯¹è±¡å°å¦ä¸ä¸ª Survivor åºãææè¾¾å°ä»ä»¬çå¹´é¾éå¼çå¯¹è±¡ä¼æåå°å¹´èä»£ã\n\nï¼4ï¼å¹´è½»ä»£åæ¶ä¹å\n\nä¸æ¬¡å¹´è½»ä»£åå¾æ¶éä¹åï¼Eden åºåå¶ä¸­ä¸ä¸ª Survivor åºè¢«æ¸ç©ºã\n\næè¿æåçå¯¹è±¡ä»¥æ·±èè²æ¾ç¤ºå¨ä¸å¾ä¸­ï¼ç»¿è²çå¯¹è±¡æ¯å¹´è½»ä»£å¹¸åçè¿æ²¡ææåå°èå¹´ä»£å¯¹è±¡ã\n\n# CMS åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼CMS çå¹´èä»£æ¶é\n\nåçä¸¤æ¬¡ stop the world äºä»¶ï¼åå§æ è®°åéæ°æ è®°ãå½å¹´èä»£è¾¾å°ç¹å®çå ç¨æ¯ä¾æ¶ï¼CMS å¼å§æ§è¡ã\n\n\n\n * åå§æ è®°æ¯ä¸ä¸ªç­ææåçãå¯è¾¾å¯¹è±¡è¢«æ è®°çé¶æ®µã\n * å¹¶åæ è®°å¯»æ¾æ´»è·å¯¹è±¡å¨åºç¨è¿ç»­æ§è¡æ¶ã\n * æåï¼å¨éæ°æ è®°é¶æ®µï¼å¯»æ¾å¨ä¹åå¹¶åæ è®°é¶æ®µä¸­ä¸¢å¤±çå¯¹è±¡ã\n\nï¼2ï¼å¹´èä»£æ¶é-å¹¶åæ¸é¤\n\nå¨ä¹åé¶æ®µæ²¡æè¢«æ è®°çå¯¹è±¡ä¼è¢«å°±å°éæ¾ãä¸è¿è¡åç¼©æä½ã\n\n**æ³¨æï¼**æªè¢«æ è®°çå¯¹è±¡ç­äºæ­»äº¡å¯¹è±¡\n\nï¼3ï¼å¹´èä»£æ¶é-æ¸é¤ä¹å\n\næ¸é¤é¶æ®µä¹åï¼ä½ å¯ä»¥çå°å¤§éåå­è¢«éæ¾ãä½ è¿å¯ä»¥æ³¨æå°æ²¡æè¿è¡åç¼©æä½ã\n\næåï¼CMS æ¶éå¨ä¼åæ¬¡è¿å¥éæ°è®¾ç½®é¶æ®µï¼ç­å¾ä¸ä¸æ¬¡åå¾æ¶éæ¶æºçå°æ¥ã\n\n# CMS ç¹ç¹\n\nCMS æ¶éå¨å·æä»¥ä¸ç¼ºç¹ï¼\n\n * å¹¶åæ¶é - å¹¶åæçæ¯ç¨æ·çº¿ç¨å GC çº¿ç¨åæ¶è¿è¡ã\n * ååéä½ - ä½åé¡¿æ¶é´æ¯ä»¥çºç²ååéä¸ºä»£ä»·çï¼å¯¼è´ CPU å©ç¨çä¸å¤é«ã\n * æ æ³å¤çæµ®å¨åå¾ - å¯è½åºç° Concurrent Mode Failureãæµ®å¨åå¾æ¯æå¹¶åæ¸é¤é¶æ®µç±äºç¨æ·çº¿ç¨ç»§ç»­è¿è¡èäº§ççåå¾ï¼è¿é¨ååå¾åªè½å°ä¸ä¸æ¬¡ GC æ¶æè½è¿è¡åæ¶ãç±äºæµ®å¨åå¾çå­å¨ï¼å æ­¤éè¦é¢çåºä¸é¨ååå­ï¼æå³ç CMS æ¶éä¸è½åå¶å®æ¶éå¨é£æ ·ç­å¾èå¹´ä»£å¿«æ»¡çæ¶åååæ¶ã\n   * å¯ä»¥ä½¿ç¨ -XX:CMSInitiatingOccupancyFraction æ¥æ¹åè§¦å CMS æ¶éå¨å·¥ä½çåå­å ç¨ç¾åï¼å¦æè¿ä¸ªå¼è®¾ç½®çå¤ªå¤§ï¼å¯¼è´é¢ççåå­ä¸å¤å­æ¾æµ®å¨åå¾ï¼å°±ä¼åºç° Concurrent Mode Failureï¼è¿æ¶èææºå°ä¸´æ¶å¯ç¨ Serial Old æ¶éå¨æ¥æ¿ä»£ CMS æ¶éå¨ã\n * æ è®° - æ¸é¤ç®æ³å¯¼è´çç©ºé´ç¢çï¼å¾å¾åºç°èå¹´ä»£ç©ºé´å©ä½ï¼ä½æ æ³æ¾å°è¶³å¤å¤§è¿ç»­ç©ºé´æ¥åéå½åå¯¹è±¡ï¼ä¸å¾ä¸æåè§¦åä¸æ¬¡ Full GCã\n   * å¯ä»¥ä½¿ç¨ -XX:+UseCMSCompactAtFullCollection ï¼ç¨äºå¨ CMS æ¶éå¨è¦è¿è¡ Full GC æ¶å¼å¯åå­ç¢ççåå¹¶æ´çï¼åå­æ´ççè¿ç¨æ¯æ æ³å¹¶åçï¼ç©ºé´ç¢çé®é¢æ²¡æäºï¼ä½æ¯åé¡¿æ¶é´ä¸å¾ä¸åé¿äºã\n   * å¯ä»¥ä½¿ç¨ -XX:CMSFullGCsBeforeCompaction ï¼ç¨äºè®¾ç½®æ§è¡å¤å°æ¬¡ä¸åç¼©ç Full GC åï¼æ¥ä¸æ¬¡å¸¦åç¼©çï¼é»è®¤ä¸º 0ï¼è¡¨ç¤ºæ¯æ¬¡è¿å¥ Full GC æ¶é½è¦è¿è¡ç¢çæ´çï¼ã\n\n# ParNew æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-XX:+UseParNewGC\n\nParNew æ¶éå¨å¶å®æ¯ Serial æ¶éå¨çå¤çº¿ç¨çæ¬ã\n\nParNew æ¶éå¨è¿è¡ç¤ºæå¾\n\næ¯ Server æ¨¡å¼ä¸çèææºé¦éå¹´è½»ä»£æ¶éå¨ï¼é¤äºæ§è½åå å¤ï¼ä¸»è¦æ¯å ä¸ºé¤äº Serial æ¶éå¨ï¼åªæå®è½ä¸ CMS æ¶éå¨éåå·¥ä½ã\n\nParNew æ¶éå¨ä¹æ¯ä½¿ç¨ -XX:+UseConcMarkSweepGC åçé»è®¤å¹´è½»ä»£æ¶éå¨ã\n\nParNew æ¶éå¨é»è®¤å¼å¯ççº¿ç¨æ°éä¸ CPU æ°éç¸åï¼å¯ä»¥ä½¿ç¨ -XX:ParallelGCThreads åæ°æ¥è®¾ç½®çº¿ç¨æ°ã\n\n\n# G1 æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-XX:+UseG1GC\n\nåé¢æå°çåå¾æ¶éå¨ä¸è¬ç­ç¥æ¯å³æ³¨ååéæåé¡¿æ¶é´ãè G1 æ¯ä¸ç§å¼é¡¾ååéååé¡¿æ¶é´ç GC æ¶éå¨ãG1 æ¯ Oracle JDK9 ä»¥åçé»è®¤ GC æ¶éå¨ãG1 å¯ä»¥ç´è§çè®¾å®åé¡¿æ¶é´çç®æ ï¼ç¸æ¯äº CMS GCï¼G1 æªå¿è½åå° CMS å¨æå¥½æåµä¸çå»¶æ¶åé¡¿ï¼ä½æ¯æå·®æåµè¦å¥½å¾å¤ã\n\nG1 æå¤§çç¹ç¹æ¯å¼å¥ååºçæè·¯ï¼å¼±åäºåä»£çæ¦å¿µï¼åçå©ç¨åå¾æ¶éåä¸ªå¨æçèµæºï¼è§£å³äºå¶ä»æ¶éå¨çè³ CMS çä¼å¤ç¼ºé·ã\n\n# åä»£åååº\n\næ§çåå¾æ¶éå¨ä¸è¬éååä»£æ¶éï¼Java å è¢«åä¸ºå¹´è½»ä»£ãèå¹´ä»£åæ°¸ä¹ä»£ãæ¶éçèå´é½æ¯æ´ä¸ªå¹´è½»ä»£æèæ´ä¸ªèå¹´ä»£ã\n\nG1 åæ¶äºæ°¸ä¹ä»£ï¼å¹¶æå¹´è½»ä»£åèå¹´ä»£ååæå¤ä¸ªå¤§å°ç¸ç­çç¬ç«åºåï¼Regionï¼ï¼å¹´è½»ä»£åèå¹´ä»£ä¸åç©çéç¦»ãG1 å¯ä»¥ç´æ¥å¯¹å¹´è½»ä»£åèå¹´ä»£ä¸èµ·åæ¶ã\n\n\n\néè¿å¼å¥ Region çæ¦å¿µï¼ä»èå°åæ¥çä¸æ´ååå­ç©ºé´ååæå¤ä¸ªçå°ç©ºé´ï¼ä½¿å¾æ¯ä¸ªå°ç©ºé´å¯ä»¥åç¬è¿è¡åå¾åæ¶ãè¿ç§ååæ¹æ³å¸¦æ¥äºå¾å¤§ççµæ´»æ§ï¼ä½¿å¾å¯é¢æµçåé¡¿æ¶é´æ¨¡åæä¸ºå¯è½ãéè¿è®°å½æ¯ä¸ª Region åå¾åæ¶æ¶é´ä»¥ååæ¶æè·å¾çç©ºé´ï¼è¿ä¸¤ä¸ªå¼æ¯éè¿è¿å»åæ¶çç»éªè·å¾ï¼ï¼å¹¶ç»´æ¤ä¸ä¸ªä¼ååè¡¨ï¼æ¯æ¬¡æ ¹æ®åè®¸çæ¶éæ¶é´ï¼ä¼ååæ¶ä»·å¼æå¤§ç Regionã\n\næ¯ä¸ª Region é½æä¸ä¸ª Remembered Setï¼ç¨æ¥è®°å½è¯¥ Region å¯¹è±¡çå¼ç¨å¯¹è±¡æå¨ç Regionãéè¿ä½¿ç¨ Remembered Setï¼å¨åå¯è¾¾æ§åæçæ¶åå°±å¯ä»¥é¿åå¨å æ«æã\n\n# G1 åæ¶æºå¶\n\nG1 æ¶éå¨è¿è¡ç¤ºæå¾\n\nå¦æä¸è®¡ç®ç»´æ¤ Remembered Set çæä½ï¼G1 æ¶éå¨çè¿ä½å¤§è´å¯ååä¸ºä»¥ä¸å ä¸ªæ­¥éª¤ï¼\n\n 1. åå§æ è®°\n 2. å¹¶åæ è®°\n 3. æç»æ è®° - ä¸ºäºä¿®æ­£å¨å¹¶åæ è®°æé´å ç¨æ·ç¨åºç»§ç»­è¿ä½èå¯¼è´æ è®°äº§çåå¨çé£ä¸é¨åæ è®°è®°å½ï¼èææºå°è¿æ®µæ¶é´å¯¹è±¡ååè®°å½å¨çº¿ç¨ç Remembered Set Logs éé¢ï¼æç»æ è®°é¶æ®µéè¦æ Remembered Set Logs çæ°æ®åå¹¶å° Remembered Set ä¸­ãè¿é¶æ®µéè¦åé¡¿çº¿ç¨ï¼ä½æ¯å¯å¹¶è¡æ§è¡ã\n 4. ç­éåæ¶ - é¦åå¯¹åä¸ª Region ä¸­çåæ¶ä»·å¼åææ¬è¿è¡æåºï¼æ ¹æ®ç¨æ·æææç GC åé¡¿æ¯æ¶é´æ¥å¶å®åæ¶è®¡åãæ­¤é¶æ®µå¶å®ä¹å¯ä»¥åå°ä¸ç¨æ·ç¨åºä¸èµ·å¹¶åæ§è¡ï¼ä½æ¯å ä¸ºåªåæ¶ä¸é¨å Regionï¼æ¶é´æ¯ç¨æ·å¯æ§å¶çï¼èä¸åé¡¿ç¨æ·çº¿ç¨å°å¤§å¹åº¦æé«æ¶éæçã\n\nå·å¤å¦ä¸ç¹ç¹ï¼\n\n * ç©ºé´æ´åï¼æ´ä½æ¥çæ¯åºäºâæ è®° - æ´çâç®æ³å®ç°çæ¶éå¨ï¼ä»å±é¨ï¼ä¸¤ä¸ª Region ä¹é´ï¼ä¸æ¥çæ¯åºäºâå¤å¶âç®æ³å®ç°çï¼è¿æå³çè¿è¡æé´ä¸ä¼äº§çåå­ç©ºé´ç¢çã\n * å¯é¢æµçåé¡¿ï¼è½è®©ä½¿ç¨èæç¡®æå®å¨ä¸ä¸ªé¿åº¦ä¸º M æ¯«ç§çæ¶é´çæ®µåï¼æ¶èå¨ GC ä¸çæ¶é´ä¸å¾è¶è¿ N æ¯«ç§ã\n\n# G1 åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼G1 åå§å ç©ºé´\n\nå ç©ºé´æ¯ä¸ä¸ªè¢«åæè®¸å¤åºå®å¤§å°åºåçåå­åã\n\nJava èææºå¯å¨æ¶éå®åºåå¤§å°ãJava èææºéå¸¸ä¼æå® 2000 ä¸ªå·¦å³çå¤§å°ç¸ç­ãæ¯ä¸ªå¤§å°èå´å¨ 1 å° 32M çåºåã\n\nï¼2ï¼G1 å ç©ºé´åé\n\nå®éä¸ï¼è¿äºåºåè¢«æ å°æ EdenãSurvivorãå¹´èä»£ç©ºé´çé»è¾è¡¨è¿°å½¢å¼ã\n\nå¾çä¸­çé¢è²è¡¨æäºåªä¸ªåºåè¢«å³èä¸ä»ä¹è§è²ãæ´»è·å¯¹è±¡ä»ä¸ä¸ªåºåçæ£ï¼å¤å¶ãç§»å¨ï¼å°å¦ä¸ä¸ªåºåãåºåè¢«è®¾è®¡ä¸ºå¹¶è¡çæ¹å¼æ¶éï¼å¯ä»¥æåæèä¸æåææçå¶å®ç¨æ·çº¿ç¨ã\n\nææ¾çåºåå¯ä»¥è¢«åéæ EdenãSurvivorãOld åºåãå¦å¤ï¼æç¬¬åç§ç±»åçåºåå«åæå¤§åºå(Humongous regions)ãè¿äºåºåè¢«è®¾è®¡æä¿ææ ååºåå¤§å°ç 50%æèæ´å¤§çå¯¹è±¡ãå®ä»¬è¢«ä¿å­å¨ä¸ä¸ªè¿ç»­çåºåéåéãæåï¼æåä¸ä¸ªç±»åçåºåå°±æ¯å ç©ºé´éæ²¡æä½¿ç¨çåºåã\n\n**æ³¨æï¼**åä½æ­¤æç« æ¶ï¼æ¶éæå¤§å¯¹è±¡æ¶è¿æ²¡æè¢«ä¼åãå æ­¤ï¼ä½ åºè¯¥é¿ååå»ºè¿ä¸ªå¤§å°çå¯¹è±¡ã\n\nï¼3ï¼G1 çå¹´è½»ä»£\n\nå ç©ºé´è¢«åå²æå¤§çº¦ 2000 ä¸ªåºåãæå° 1Mï¼æå¤§ 32Mï¼èè²åºåä¿æå¹´èä»£å¯¹è±¡ï¼ç»¿è²åºåä¿æå¹´è½»ä»£å¯¹è±¡ã\n\n**æ³¨æï¼**åºåæ²¡æå¿è¦åæ§çæ¶éå¨ä¸æ ·æ¯ä¿æè¿ç»­çã\n\nï¼4ï¼G1 çå¹´è½»ä»£æ¶é\n\næ´»è·å¯¹è±¡ä¼è¢«çæ£ï¼å¤å¶ãç§»å¨ï¼å°ä¸ä¸ªæå¤ä¸ª survivor åºåãå¦æè¾¾å°æåæ»éå¼ï¼å¯¹è±¡ä¼æåå°å¹´èä»£åºåã\n\nè¿æ¯ä¸ä¸ª stop the world æåãä¸ºä¸ä¸æ¬¡å¹´è½»ä»£åå¾åæ¶è®¡ç® Eden å Survivor çå¤§å°ãä¿çå®¡è®¡ä¿¡æ¯æå©äºè®¡ç®å¤§å°ãç±»ä¼¼ç®æ æåæ¶é´çäºæä¼è¢«èèå¨åã\n\nè¿ä¸ªæ¹æ³ä½¿éè°åºåå¤§å°åå¾å¾å®¹æï¼æéæå®ä»¬è°å¤§æè°å°ã\n\nï¼5ï¼G1 å¹´è½»ä»£åæ¶çå°¾å£°\n\næ´»è·å¯¹è±¡è¢«çæ£å° Survivor æèå¹´èä»£åºåã\n\næè¿æåçå¯¹è±¡æ¾ç¤ºä¸ºæ·±èè²ãSurvivor åºåæ¾ç¤ºä¸ºç»¿è²ã\n\nå³äº G1 çå¹´è½»ä»£åæ¶åä»¥ä¸æ»ç»ï¼\n\n * å ç©ºé´æ¯ä¸ååç¬çåå­ç©ºé´è¢«åå²æå¤ä¸ªåºåã\n * å¹´è½»ä»£åå­æ¯ç±ä¸ç»éè¿ç»­çåºåç»æãè¿ä½¿å¾éè¦éè°å¤§å°åå¾å®¹æã\n * å¹´è½»ä»£åå¾åæ¶æ¯ stop the world äºä»¶ï¼ææåºç¨çº¿ç¨é½ä¼å æ­¤æä½æåã\n * å¹´è½»ä»£åå¾æ¶éä½¿ç¨å¤çº¿ç¨å¹¶è¡åæ¶ã\n * æ´»è·å¯¹è±¡è¢«å¤å¶å°æ°ç Survivor åºæèå¹´èä»£åºåã\n\n# G1 åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼åå§æ è®°é¶æ®µ\n\nå¹´è½»ä»£åå¾æ¶éè©è´çæ´»è·å¯¹è±¡åå§æ è®°çä»»å¡ãå¨æ¥å¿æä»¶ä¸­è¢«æ ä¸ºGC pause (young)(inital-mark)\n\nï¼2ï¼å¹¶åæ è®°é¶æ®µ\n\nå¦æåç°ç©ºåºå(âXâæ ç¤ºç)ï¼å¨éæ°æ è®°é¶æ®µå®ä»¬ä¼è¢«é©¬ä¸æ¸é¤æãå½ç¶ï¼å³å®æ´»æ§çå®¡è®¡ä¿¡æ¯ä¹å¨æ­¤æ¶è¢«è®¡ç®ã\n\nï¼3ï¼éæ°æ è®°é¶æ®µ\n\nç©ºçåºåè¢«æ¸é¤ååæ¶æãææåºåçæ´»æ§å¨æ­¤æ¶è®¡ç®ã\n\nï¼4ï¼å¤å¶/æ¸çé¶æ®µ\n\nG1 éæ©æ´»æ§æä½çåºåï¼è¿äºåºåè½å¤ä»¥æå¿«çéåº¦åæ¶ãç¶åè¿äºåºåä¼å¨å¹´è½»ä»£åå¾åæ¶è¿ç¨ä¸­è¢«åæ¶ãå¨æ¥å¿ä¸­è¢«æç¤ºä¸º*[GC pause (mixed)]*ãæä»¥å¹´è½»ä»£åå¹´èä»£å¨åä¸æ¶é´è¢«åæ¶ã\n\nï¼5ï¼å¤å¶/æ¸çé¶æ®µä¹å\n\nè¢«éæ©çåºåå·²ç»è¢«åæ¶ååç¼©å°å¾ä¸­æ¾ç¤ºçæ·±èè²åºåæ·±ç»¿è²åºä¸­ã\n\n\n\n\n# æ»ç»\n\næ¶éå¨                 ä¸²è¡/å¹¶è¡/å¹¶å   å¹´è½»ä»£/èå¹´ä»£     æ¶éç®æ³           ç®æ        éç¨åºæ¯\nSerial              ä¸²è¡         å¹´è½»ä»£         å¤å¶             ååºéåº¦ä¼å   å CPU ç¯å¢ä¸ç Client æ¨¡å¼\nSerial Old          ä¸²è¡         èå¹´ä»£         æ è®°-æ´ç          ååºéåº¦ä¼å   å CPU ç¯å¢ä¸ç Client æ¨¡å¼ãCMS çåå¤é¢æ¡\nParNew              ä¸²è¡ + å¹¶è¡    å¹´è½»ä»£         å¤å¶ç®æ³           ååºéåº¦ä¼å   å¤ CPU ç¯å¢æ¶å¨ Server æ¨¡å¼ä¸ä¸ CMS éå\nParallel Scavenge   ä¸²è¡ + å¹¶è¡    å¹´è½»ä»£         å¤å¶ç®æ³           ååéä¼å    å¨åå°è¿ç®èä¸éè¦å¤ªå¤äº¤äºçä»»å¡\nParallel Old        ä¸²è¡ + å¹¶è¡    èå¹´ä»£         æ è®°-æ´ç          ååéä¼å    å¨åå°è¿ç®èä¸éè¦å¤ªå¤äº¤äºçä»»å¡\nCMS                 å¹¶è¡ + å¹¶å    èå¹´ä»£         æ è®°-æ¸é¤          ååºéåº¦ä¼å   éä¸­å¨äºèç½ç«æ B/S ç³»ç»æå¡ç«¯ä¸ç Java åºç¨\nG1                  å¹¶è¡ + å¹¶å    å¹´è½»ä»£ + èå¹´ä»£   æ è®°-æ´ç + å¤å¶ç®æ³   ååºéåº¦ä¼å   é¢åæå¡ç«¯åºç¨ï¼å°æ¥æ¿æ¢ CMS\n\n\n# åå­åéä¸åæ¶ç­ç¥\n\nå¯¹è±¡çåå­åéï¼ä¹å°±æ¯å¨å ä¸åéãä¸»è¦åéå¨å¹´è½»ä»£ç Eden åºä¸ï¼å°æ°æåµä¸ä¹å¯è½ç´æ¥åéå¨èå¹´ä»£ä¸­ã\n\n\n# Minor GC\n\nå½ Eden åºç©ºé´ä¸è¶³æ¶ï¼è§¦å Minor GCã\n\nMinor GC åçå¨å¹´è½»ä»£ä¸ï¼å ä¸ºå¹´è½»ä»£å¯¹è±¡å­æ´»æ¶é´å¾ç­ï¼å æ­¤ Minor GC ä¼é¢ç¹æ§è¡ï¼æ§è¡çéåº¦ä¸è¬ä¹ä¼æ¯è¾å¿«ã\n\nMinor GC å·¥ä½æµç¨ï¼\n\n 1. Java åºç¨ä¸æ­åå»ºå¯¹è±¡ï¼éå¸¸é½æ¯åéå¨ Eden åºåï¼å½å¶ç©ºé´ä¸è¶³æ¶ï¼è¾¾å°è®¾å®çéå¼ï¼ï¼è§¦å minor GCãä»ç¶è¢«å¼ç¨çå¯¹è±¡ï¼ç»¿è²æ¹åï¼å­æ´»ä¸æ¥ï¼è¢«å¤å¶å° JVM éæ©ç Survivor åºåï¼èæ²¡æè¢«å¼ç¨çå¯¹è±¡ï¼é»è²æ¹åï¼åè¢«åæ¶ã\n\n 2. ç»è¿ä¸æ¬¡ Minor GCï¼Eden å°±ä¼ç©ºé²ä¸æ¥ï¼ç´å°åæ¬¡è¾¾å° Minor GC è§¦åæ¡ä»¶ãè¿æ¶åï¼å¦å¤ä¸ä¸ª Survivor åºååä¼æä¸º To åºåï¼Eden åºåçå­æ´»å¯¹è±¡å From åºåå¯¹è±¡ï¼é½ä¼è¢«å¤å¶å° To åºåï¼å¹¶ä¸å­æ´»çå¹´é¾è®¡æ°ä¼è¢«å  1ã\n\n 3. ç±»ä¼¼ç¬¬äºæ­¥çè¿ç¨ä¼åçå¾å¤æ¬¡ï¼ç´å°æå¯¹è±¡å¹´é¾è®¡æ°è¾¾å°éå¼ï¼è¿æ¶åå°±ä¼åçæè°çæåï¼Promotionï¼è¿ç¨ï¼å¦ä¸å¾æç¤ºï¼è¶è¿éå¼çå¯¹è±¡ä¼è¢«æåå°èå¹´ä»£ãè¿ä¸ªéå¼æ¯å¯ä»¥éè¿ -XX:MaxTenuringThreshold åæ°æå®ã\n\n\n# Full GC\n\nFull GC åçå¨èå¹´ä»£ä¸ï¼èå¹´ä»£å¯¹è±¡åå¹´è½»ä»£çç¸åï¼å¶å­æ´»æ¶é´é¿ï¼å æ­¤ Full GC å¾å°æ§è¡ï¼èä¸æ§è¡éåº¦ä¼æ¯ Minor GC æ¢å¾å¤ã\n\n# åå­åéç­ç¥\n\nï¼ä¸ï¼å¯¹è±¡ä¼åå¨ Eden åé\n\nå¤§å¤æ°æåµä¸ï¼å¯¹è±¡å¨å¹´è½»ä»£ Eden åºåéï¼å½ Eden åºç©ºé´ä¸å¤æ¶ï¼åèµ· Minor GCã\n\nï¼äºï¼å¤§å¯¹è±¡ç´æ¥è¿å¥èå¹´ä»£\n\nå¤§å¯¹è±¡æ¯æéè¦è¿ç»­åå­ç©ºé´çå¯¹è±¡ï¼æå¸åçå¤§å¯¹è±¡æ¯é£ç§å¾é¿çå­ç¬¦ä¸²ä»¥åæ°ç»ã\n\nç»å¸¸åºç°å¤§å¯¹è±¡ä¼æåè§¦ååå¾æ¶éä»¥è·åè¶³å¤çè¿ç»­ç©ºé´åéç»å¤§å¯¹è±¡ã\n\n-XX:PretenureSizeThresholdï¼å¤§äºæ­¤å¼çå¯¹è±¡ç´æ¥å¨èå¹´ä»£åéï¼é¿åå¨ Eden åºå Survivor åºä¹é´çå¤§éåå­å¤å¶ã\n\nï¼ä¸ï¼é¿æå­æ´»çå¯¹è±¡è¿å¥èå¹´ä»£\n\nä¸ºå¯¹è±¡å®ä¹å¹´é¾è®¡æ°å¨ï¼å¯¹è±¡å¨ Eden åºçå¹¶ç»è¿ Minor GC ä¾ç¶å­æ´»ï¼å°ç§»å¨å° Survivor ä¸­ï¼å¹´é¾å°±å¢å  1 å²ï¼å¢å å°ä¸å®å¹´é¾åç§»å¨å°èå¹´ä»£ä¸­ã\n\n-XX:MaxTenuringThreshold ç¨æ¥å®ä¹å¹´é¾çéå¼ã\n\nï¼åï¼å¨æå¯¹è±¡å¹´é¾å¤å®\n\nèææºå¹¶ä¸æ¯æ°¸è¿å°è¦æ±å¯¹è±¡çå¹´é¾å¿é¡»è¾¾å° MaxTenuringThreshold æè½æåèå¹´ä»£ï¼å¦æå¨ Survivor åºä¸­ç¸åå¹´é¾ææå¯¹è±¡å¤§å°çæ»åå¤§äº Survivor ç©ºé´çä¸åï¼åå¹´é¾å¤§äºæç­äºè¯¥å¹´é¾çå¯¹è±¡å¯ä»¥ç´æ¥è¿å¥èå¹´ä»£ï¼æ éç­å° MaxTenuringThreshold ä¸­è¦æ±çå¹´é¾ã\n\nï¼äºï¼ç©ºé´åéæä¿\n\nå¨åç Minor GC ä¹åï¼èææºåæ£æ¥èå¹´ä»£æå¤§å¯ç¨çè¿ç»­ç©ºé´æ¯å¦å¤§äºå¹´è½»ä»£ææå¯¹è±¡æ»ç©ºé´ï¼å¦ææ¡ä»¶æç«çè¯ï¼é£ä¹ Minor GC å¯ä»¥ç¡®è®¤æ¯å®å¨çï¼å¦æä¸æç«çè¯èææºä¼æ¥ç HandlePromotionFailure è®¾ç½®å¼æ¯å¦åè®¸æä¿å¤±è´¥ï¼å¦æåè®¸é£ä¹å°±ä¼ç»§ç»­æ£æ¥èå¹´ä»£æå¤§å¯ç¨çè¿ç»­ç©ºé´æ¯å¦å¤§äºåæ¬¡æåå°èå¹´ä»£å¯¹è±¡çå¹³åå¤§å°ï¼å¦æå¤§äºï¼å°å°è¯çè¿è¡ä¸æ¬¡ Minor GCï¼å°½ç®¡è¿æ¬¡ Minor GC æ¯æé£é©çï¼å¦æå°äºï¼æè HandlePromotionFailure è®¾ç½®ä¸åè®¸åé©ï¼é£è¿æ¶ä¹è¦æ¹ä¸ºè¿è¡ä¸æ¬¡ Full GCã\n\n# Full GC çè§¦åæ¡ä»¶\n\nå¯¹äº Minor GCï¼å¶è§¦åæ¡ä»¶éå¸¸ç®åï¼å½ Eden åºç©ºé´æ»¡æ¶ï¼å°±å°è§¦åä¸æ¬¡ Minor GCãè Full GC åç¸å¯¹å¤æï¼æä»¥ä¸æ¡ä»¶ï¼\n\nï¼1ï¼è°ç¨ System.gc()\n\næ­¤æ¹æ³çè°ç¨æ¯å»ºè®®èææºè¿è¡ Full GCï¼è½ç¶åªæ¯å»ºè®®èéä¸å®ï¼ä½å¾å¤æåµä¸å®ä¼è§¦å Full GCï¼ä»èå¢å  Full GC çé¢çï¼ä¹å³å¢å äºé´æ­æ§åé¡¿çæ¬¡æ°ãå æ­¤å¼ºçå»ºè®®è½ä¸ä½¿ç¨æ­¤æ¹æ³å°±ä¸è¦ä½¿ç¨ï¼è®©èææºèªå·±å»ç®¡çå®çåå­ãå¯éè¿ -XX:DisableExplicitGC æ¥ç¦æ­¢ RMI è°ç¨ System.gc()ã\n\nï¼2ï¼èå¹´ä»£ç©ºé´ä¸è¶³\n\nèå¹´ä»£ç©ºé´ä¸è¶³çå¸¸è§åºæ¯ä¸ºåææè®²çå¤§å¯¹è±¡ç´æ¥è¿å¥èå¹´ä»£ãé¿æå­æ´»çå¯¹è±¡è¿å¥èå¹´ä»£ç­ï¼å½æ§è¡ Full GC åç©ºé´ä»ç¶ä¸è¶³ï¼åæåº java.lang.OutOfMemoryError: Java heap spaceãä¸ºé¿åä»¥ä¸åå å¼èµ·ç Full GCï¼è°ä¼æ¶åºå°½éåå°è®©å¯¹è±¡å¨ Minor GC é¶æ®µè¢«åæ¶ãè®©å¯¹è±¡å¨å¹´è½»ä»£å¤å­æ´»ä¸æ®µæ¶é´ä»¥åä¸è¦åå»ºè¿å¤§çå¯¹è±¡åæ°ç»ã\n\nï¼3ï¼æ¹æ³åºç©ºé´ä¸è¶³\n\nJVM è§èä¸­è¿è¡æ¶æ°æ®åºåä¸­çæ¹æ³åºï¼å¨ HotSpot èææºä¸­åè¢«ä¹ æ¯ç§°ä¸ºæ°¸ä¹ä»£ï¼æ°¸ä¹ä»£ä¸­å­æ¾çæ¯ç±»çæè¿°ä¿¡æ¯ãå¸¸éãéæåéç­æ°æ®ï¼å½ç³»ç»ä¸­è¦å è½½çç±»ãåå°çç±»åè°ç¨çæ¹æ³è¾å¤æ¶ï¼æ°¸ä¹ä»£å¯è½ä¼è¢«å æ»¡ï¼å¨æªéç½®ä¸ºéç¨ CMS GC çæåµä¸ä¹ä¼æ§è¡ Full GCãå¦æç»è¿ Full GC ä»ç¶åæ¶ä¸äºï¼é£ä¹ JVM ä¼æåº java.lang.OutOfMemoryError: PermGen space éè¯¯ãä¸ºé¿åæ°¸ä¹ä»£å æ»¡é æ Full GC ç°è±¡ï¼å¯éç¨çæ¹æ³ä¸ºå¢å¤§ Perm Gen ç©ºé´æè½¬ä¸ºä½¿ç¨ CMS GCã\n\nï¼4ï¼Minor GC çå¹³åæåç©ºé´å¤§å°å¤§äºèå¹´ä»£å¯ç¨ç©ºé´\n\nå¦æåç°ç»è®¡æ°æ®è¯´ä¹å Minor GC çå¹³åæåå¤§å°æ¯ç®åèå¹´ä»£å©ä½çç©ºé´å¤§ï¼åä¸ä¼è§¦å Minor GC èæ¯è½¬ä¸ºè§¦å Full GCã\n\nï¼5ï¼å¯¹è±¡å¤§å°å¤§äº To åºåèå¹´ä»£çå¯ç¨åå­\n\nç± Eden åºãFrom åºå To åºå¤å¶æ¶ï¼å¯¹è±¡å¤§å°å¤§äº To åºå¯ç¨åå­ï¼åæè¯¥å¯¹è±¡è½¬å­å°èå¹´ä»£ï¼ä¸èå¹´ä»£çå¯ç¨åå­å°äºè¯¥å¯¹è±¡å¤§å°ã\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * ä»è¡¨å°éå­¦ä¹  JVM å®ç°\n * è¯¦è§£ JVM Garbage First(G1) åå¾æ¶éå¨\n * G1 åå¾æ¶éå¨å¥é¨\n * Getting Started with the G1 Garbage Collector",normalizedContent:"# jvm åå¾æ¶é\n\n> ç¨åºè®¡æ°å¨ãèææºæ åæ¬å°æ¹æ³æ è¿ä¸ä¸ªåºåå±äºçº¿ç¨ç§æçï¼åªå­å¨äºçº¿ç¨ççå½å¨æåï¼çº¿ç¨ç»æä¹åä¹ä¼æ¶å¤±ï¼å æ­¤ä¸éè¦å¯¹è¿ä¸ä¸ªåºåè¿è¡åå¾åæ¶ãåå¾åæ¶ä¸»è¦æ¯éå¯¹ java å åæ¹æ³åºè¿è¡ã\n\n\n# å¯¹è±¡æ´»çå\n\n\n# å¼ç¨è®¡æ°ç®æ³\n\nç»å¯¹è±¡æ·»å ä¸ä¸ªå¼ç¨è®¡æ°å¨ï¼å½å¯¹è±¡å¢å ä¸ä¸ªå¼ç¨æ¶è®¡æ°å¨å  1ï¼å¼ç¨å¤±ææ¶è®¡æ°å¨å 1ãå¼ç¨è®¡æ°ä¸º 0 çå¯¹è±¡å¯è¢«åæ¶ã\n\nä¸¤ä¸ªå¯¹è±¡åºç°å¾ªç¯å¼ç¨çæåµä¸ï¼æ­¤æ¶å¼ç¨è®¡æ°å¨æ°¸è¿ä¸ä¸º 0ï¼å¯¼è´æ æ³å¯¹å®ä»¬è¿è¡åæ¶ã\n\npublic class referencecountinggc {\n    public object instance = null;\n\n    public static void main(string[] args) {\n        referencecountinggc objecta = new referencecountinggc();\n        referencecountinggc objectb = new referencecountinggc();\n        objecta.instance = objectb;\n        objectb.instance = objecta;\n    }\n}\n\n\nå ä¸ºå¾ªç¯å¼ç¨çå­å¨ï¼æä»¥ java èææºä¸éç¨å¼ç¨è®¡æ°ç®æ³ã\n\n\n# å¯è¾¾æ§åæç®æ³\n\néè¿ gc roots ä½ä¸ºèµ·å§ç¹è¿è¡æç´¢ï¼jvm å°è½å¤å°è¾¾å°çå¯¹è±¡è§ä¸ºå­æ´»ï¼ä¸å¯è¾¾çå¯¹è±¡è§ä¸ºæ­»äº¡ã\n\nå¯è¾¾æ§åæç®æ³\n\nå¯ä½ä¸º gc roots çå¯¹è±¡åæ¬ä¸é¢å ç§ï¼\n\n * èææºæ ä¸­å¼ç¨çå¯¹è±¡\n * æ¬å°æ¹æ³æ ä¸­å¼ç¨çå¯¹è±¡ï¼native æ¹æ³ï¼\n * æ¹æ³åºä¸­ï¼ç±»éæå±æ§å¼ç¨çå¯¹è±¡\n * æ¹æ³åºä¸­ï¼å¸¸éå¼ç¨çå¯¹è±¡\n\n\n# å¼ç¨ç±»å\n\næ è®ºæ¯éè¿å¼ç¨è®¡ç®ç®æ³å¤æ­å¯¹è±¡çå¼ç¨æ°éï¼è¿æ¯éè¿å¯è¾¾æ§åæç®æ³å¤æ­å¯¹è±¡çå¼ç¨é¾æ¯å¦å¯è¾¾ï¼å¤å®å¯¹è±¡æ¯å¦å¯è¢«åæ¶é½ä¸å¼ç¨æå³ã\n\njava å·æåç§å¼ºåº¦ä¸åçå¼ç¨ç±»åã\n\n# å¼ºå¼ç¨\n\nè¢«å¼ºå¼ç¨ï¼strong referenceï¼å³èçå¯¹è±¡ä¸ä¼è¢«åå¾æ¶éå¨åæ¶ã\n\nå¼ºå¼ç¨ï¼ä½¿ç¨ new ä¸ä¸ªæ°å¯¹è±¡çæ¹å¼æ¥åå»ºå¼ºå¼ç¨ã\n\nobject obj = new object();\n\n\n# è½¯å¼ç¨\n\nè¢«è½¯å¼ç¨ï¼soft referenceï¼å³èçå¯¹è±¡ï¼åªæå¨åå­ä¸å¤çæåµä¸æä¼è¢«åæ¶ã\n\nè½¯å¼ç¨ï¼ä½¿ç¨ softreference ç±»æ¥åå»ºè½¯å¼ç¨ã\n\nobject obj = new object();\nsoftreference<object> sf = new softreference<object>(obj);\nobj = null; // ä½¿å¯¹è±¡åªè¢«è½¯å¼ç¨å³è\n\n\n# å¼±å¼ç¨\n\nè¢«å¼±å¼ç¨ï¼weak referenceï¼å³èçå¯¹è±¡ä¸å®ä¼è¢«åå¾æ¶éå¨åæ¶ï¼ä¹å°±æ¯è¯´å®åªè½å­æ´»å°ä¸ä¸æ¬¡åå¾æ¶éåçä¹åã\n\nä½¿ç¨ weakreference ç±»æ¥å®ç°å¼±å¼ç¨ã\n\nobject obj = new object();\nweakreference<object> wf = new weakreference<object>(obj);\nobj = null;\n\n\nweakhashmap ç entry ç»§æ¿èª weakreferenceï¼ä¸»è¦ç¨æ¥å®ç°ç¼å­ã\n\nprivate static class entry<k,v> extends weakreference<object> implements map.entry<k,v>\n\n\ntomcat ä¸­ç concurrentcache å°±ä½¿ç¨äº weakhashmap æ¥å®ç°ç¼å­åè½ãconcurrentcache éåçæ¯åä»£ç¼å­ï¼ç»å¸¸ä½¿ç¨çå¯¹è±¡æ¾å¥ eden ä¸­ï¼èä¸å¸¸ç¨çå¯¹è±¡æ¾å¥ longtermãeden ä½¿ç¨ concurrenthashmap å®ç°ï¼longterm ä½¿ç¨ weakhashmapï¼ä¿è¯äºä¸å¸¸ä½¿ç¨çå¯¹è±¡å®¹æè¢«åæ¶ã\n\npublic final class concurrentcache<k, v> {\n\n    private final int size;\n\n    private final map<k, v> eden;\n\n    private final map<k, v> longterm;\n\n    public concurrentcache(int size) {\n        this.size = size;\n        this.eden = new concurrenthashmap<>(size);\n        this.longterm = new weakhashmap<>(size);\n    }\n\n    public v get(k k) {\n        v v = this.eden.get(k);\n        if (v == null) {\n            v = this.longterm.get(k);\n            if (v != null)\n                this.eden.put(k, v);\n        }\n        return v;\n    }\n\n    public void put(k k, v v) {\n        if (this.eden.size() >= size) {\n            this.longterm.putall(this.eden);\n            this.eden.clear();\n        }\n        this.eden.put(k, v);\n    }\n}\n\n\n# èå¼ç¨\n\nåç§°ä¸ºå¹½çµå¼ç¨æèå¹»å½±å¼ç¨ãä¸ä¸ªå¯¹è±¡æ¯å¦æèå¼ç¨çå­å¨ï¼å®å¨ä¸ä¼å¯¹å¶çå­æ¶é´ææå½±åï¼ä¹æ æ³éè¿èå¼ç¨åå¾ä¸ä¸ªå¯¹è±¡å®ä¾ã\n\nä¸ºä¸ä¸ªå¯¹è±¡è®¾ç½®èå¼ç¨å³èçå¯ä¸ç®çå°±æ¯è½å¨è¿ä¸ªå¯¹è±¡è¢«æ¶éå¨åæ¶æ¶æ¶å°ä¸ä¸ªç³»ç»éç¥ã\n\nä½¿ç¨ phantomreference æ¥å®ç°èå¼ç¨ã\n\nobject obj = new object();\nphantomreference<object> pf = new phantomreference<object>(obj);\nobj = null;\n\n\n\n# æ¹æ³åºçåæ¶\n\nå ä¸ºæ¹æ³åºä¸»è¦å­æ¾æ°¸ä¹ä»£å¯¹è±¡ï¼èæ°¸ä¹ä»£å¯¹è±¡çåæ¶çæ¯å¹´è½»ä»£å·®å¾å¤ï¼å æ­¤å¨æ¹æ³åºä¸è¿è¡åæ¶æ§ä»·æ¯ä¸é«ã\n\nä¸»è¦æ¯å¯¹å¸¸éæ± çåæ¶åå¯¹ç±»çå¸è½½ã\n\nç±»çå¸è½½æ¡ä»¶å¾å¤ï¼éè¦æ»¡è¶³ä»¥ä¸ä¸ä¸ªæ¡ä»¶ï¼å¹¶ä¸æ»¡è¶³äºä¹ä¸ä¸å®ä¼è¢«å¸è½½ï¼\n\n * è¯¥ç±»ææçå®ä¾é½å·²ç»è¢«åæ¶ï¼ä¹å°±æ¯ java å ä¸­ä¸å­å¨è¯¥ç±»çä»»ä½å®ä¾ã\n * å è½½è¯¥ç±»ç classloader å·²ç»è¢«åæ¶ã\n * è¯¥ç±»å¯¹åºç java.lang.class å¯¹è±¡æ²¡æå¨ä»»ä½å°æ¹è¢«å¼ç¨ï¼ä¹å°±æ æ³å¨ä»»ä½å°æ¹éè¿åå°è®¿é®è¯¥ç±»æ¹æ³ã\n\nå¯ä»¥éè¿ -xnoclassgc åæ°æ¥æ§å¶æ¯å¦å¯¹ç±»è¿è¡å¸è½½ã\n\nå¨å¤§éä½¿ç¨åå°ãå¨æä»£çãcglib ç­å­èç æ¡æ¶ãå¨æçæ jsp ä»¥å osgi è¿ç±»é¢ç¹èªå®ä¹ classloader çåºæ¯é½éè¦èææºå·å¤ç±»å¸è½½åè½ï¼ä»¥ä¿è¯ä¸ä¼åºç°åå­æº¢åºã\n\n\n# finalize()\n\nfinalize() ç±»ä¼¼ c++ çææå½æ°ï¼ç¨æ¥åå³é­å¤é¨èµæºç­å·¥ä½ãä½æ¯ try-finally ç­æ¹å¼å¯ä»¥åçæ´å¥½ï¼å¹¶ä¸è¯¥æ¹æ³è¿è¡ä»£ä»·é«æï¼ä¸ç¡®å®æ§å¤§ï¼æ æ³ä¿è¯åä¸ªå¯¹è±¡çè°ç¨é¡ºåºï¼å æ­¤æå¥½ä¸è¦ä½¿ç¨ finalize()ã\n\nå½ä¸ä¸ªå¯¹è±¡å¯è¢«åæ¶æ¶ï¼å¦æéè¦æ§è¡è¯¥å¯¹è±¡ç finalize() æ¹æ³ï¼é£ä¹å°±æå¯è½éè¿å¨è¯¥æ¹æ³ä¸­è®©å¯¹è±¡éæ°è¢«å¼ç¨ï¼ä»èå®ç°èªæã\n\n\n# åå¾æ¶éç®æ³\n\n\n# åå¾æ¶éæ§è½\n\nåå¾æ¶éå¨çæ§è½ææ ä¸»è¦æä¸¤ç¹ï¼\n\n * åé¡¿æ¶é´ - åé¡¿æ¶é´æ¯å ä¸º gc èå¯¼è´ç¨åºä¸è½å·¥ä½çæ¶é´é¿åº¦ã\n * ååé - ååéå³æ³¨å¨ç¹å®çæ¶é´å¨æåä¸ä¸ªåºç¨çå·¥ä½éçæå¤§å¼ãå¯¹å³æ³¨ååéçåºç¨æ¥è¯´é¿æåæ¶é´æ¯å¯ä»¥æ¥åçãç±äºé«ååéçåºç¨å³æ³¨çåºåå¨æ´é¿å¨ææ¶é´ä¸ï¼æä»¥å¿«éååºæ¶é´ä¸å¨èèä¹åã\n\n\n# æ è®° - æ¸é¤ï¼mark-sweepï¼\n\n\n\nå°éè¦åæ¶çå¯¹è±¡è¿è¡æ è®°ï¼ç¶åæ¸çæè¢«æ è®°çå¯¹è±¡ã\n\nä¸è¶³ï¼\n\n * æ è®°åæ¸é¤è¿ç¨æçé½ä¸é«ï¼\n * ä¼äº§çå¤§éä¸è¿ç»­çåå­ç¢çï¼å¯¼è´æ æ³ç»å¤§å¯¹è±¡åéåå­ã\n\n\n# æ è®° - æ´çï¼mark-compactï¼\n\n\n\nè®©ææå­æ´»çå¯¹è±¡é½åä¸ç«¯ç§»å¨ï¼ç¶åç´æ¥æ¸çæç«¯è¾¹çä»¥å¤çåå­ã\n\nè¿ç§åæ³è½å¤è§£å³åå­ç¢çåçé®é¢ï¼ä½ä»£ä»·æ¯åç¼©ç®æ³çæ§è½å¼éã\n\n\n# å¤å¶ï¼copyingï¼\n\n\n\nå°åå­ååä¸ºå¤§å°ç¸ç­çä¸¤åï¼æ¯æ¬¡åªä½¿ç¨å¶ä¸­ä¸åï¼å½è¿ä¸ååå­ç¨å®äºå°±å°è¿å­æ´»çå¯¹è±¡å¤å¶å°å¦ä¸åä¸é¢ï¼ç¶ååæä½¿ç¨è¿çåå­ç©ºé´è¿è¡ä¸æ¬¡æ¸çã\n\nä¸»è¦ä¸è¶³æ¯åªä½¿ç¨äºåå­çä¸åã\n\nç°å¨çåä¸èææºé½éç¨è¿ç§æ¶éç®æ³æ¥åæ¶å¹´è½»ä»£ï¼ä½æ¯å¹¶ä¸æ¯å°åå­ååä¸ºå¤§å°ç¸ç­çä¸¤åï¼èæ¯åä¸ºä¸åè¾å¤§ç eden ç©ºé´åä¸¤åè¾å°ç survior ç©ºé´ï¼æ¯æ¬¡ä½¿ç¨ eden ç©ºé´åå¶ä¸­ä¸å survivorãå¨åæ¶æ¶ï¼å° eden å survivor ä¸­è¿å­æ´»ççå¯¹è±¡ä¸æ¬¡æ§å¤å¶å°å¦ä¸å survivor ç©ºé´ä¸ï¼æåæ¸ç eden åä½¿ç¨è¿çé£ä¸å survivorãhotspot èææºç eden å survivor çå¤§å°æ¯ä¾é»è®¤ä¸º 8:1ï¼å¯ä»¥éè¿åæ° -xx:survivorratio æ¥è°æ´æ¯ä¾ï¼ï¼ä¿è¯äºåå­çå©ç¨çè¾¾å° 90 %ãå¦ææ¯æ¬¡åæ¶æå¤äº 10% çå¯¹è±¡å­æ´»ï¼é£ä¹ä¸å survivor ç©ºé´å°±ä¸å¤ç¨äºï¼æ­¤æ¶éè¦ä¾èµäºèå¹´ä»£è¿è¡åéæä¿ï¼ä¹å°±æ¯åç¨èå¹´ä»£çç©ºé´å­å¨æ¾ä¸ä¸çå¯¹è±¡ã\n\n\n# åä»£æ¶é\n\nç°å¨çåä¸èææºéç¨åä»£æ¶éç®æ³ï¼å®æ ¹æ®å¯¹è±¡å­æ´»å¨æå°åå­ååä¸ºå åï¼ä¸ååéç¨éå½çæ¶éç®æ³ã\n\nä¸è¬å° java å åä¸ºå¹´è½»ä»£åèå¹´ä»£ã\n\n * å¹´è½»ä»£ä½¿ç¨ï¼å¤å¶ ç®æ³\n * èå¹´ä»£ä½¿ç¨ï¼æ è®° - æ¸ç æè æ è®° - æ´ç ç®æ³\n\n\n\n# æ°çä»£\n\næ°çä»£æ¯å¤§é¨åå¯¹è±¡åå»ºåéæ¯çåºåï¼å¨éå¸¸ç java åºç¨ä¸­ï¼ç»å¤§é¨åå¯¹è±¡çå½å¨æé½æ¯å¾ç­æçãå¶åé¨ååä¸º eden åºåï¼ä½ä¸ºå¯¹è±¡åå§åéçåºåï¼ä¸¤ä¸ª survivorï¼ææ¶åä¹å« fromãto åºåï¼è¢«ç¨æ¥æ¾ç½®ä» minor gc ä¸­ä¿çä¸æ¥çå¯¹è±¡ã\n\njvm ä¼éæéåä¸ä¸ª survivor åºåä½ä¸º toï¼ç¶åä¼å¨ gc è¿ç¨ä¸­è¿è¡åºåé´æ·è´ï¼ä¹å°±æ¯å° eden ä¸­å­æ´»ä¸æ¥çå¯¹è±¡å from åºåçå¯¹è±¡ï¼æ·è´å°è¿ä¸ªtoåºåãè¿ç§è®¾è®¡ä¸»è¦æ¯ä¸ºäºé²æ­¢åå­çç¢çåï¼å¹¶è¿ä¸æ­¥æ¸çæ ç¨å¯¹è±¡ã\n\njava èææºä¼è®°å½ survivor åºä¸­çå¯¹è±¡ä¸å±è¢«æ¥åå¤å¶äºå æ¬¡ãå¦æä¸ä¸ªå¯¹è±¡è¢«å¤å¶çæ¬¡æ°ä¸º 15ï¼å¯¹åºèææºåæ° -xx:+maxtenuringthresholdï¼ï¼é£ä¹è¯¥å¯¹è±¡å°è¢«æåï¼promoteï¼è³èå¹´ä»£ãå¦å¤ï¼å¦æåä¸ª survivor åºå·²ç»è¢«å ç¨äº 50%ï¼å¯¹åºèææºåæ° -xx:targetsurvivorratioï¼ï¼é£ä¹è¾é«å¤å¶æ¬¡æ°çå¯¹è±¡ä¹ä¼è¢«æåè³èå¹´ä»£ã\n\n# èå¹´ä»£\n\næ¾ç½®é¿çå½å¨æçå¯¹è±¡ï¼éå¸¸é½æ¯ä» survivor åºåæ·è´è¿æ¥çå¯¹è±¡ãå½ç¶ï¼ä¹æç¹æ®æåµï¼å¦æå¯¹è±¡è¾å¤§ï¼jvm ä¼è¯å¾ç´æ¥åéå¨ eden å¶ä»ä½ç½®ä¸ï¼å¦æå¯¹è±¡å¤ªå¤§ï¼å®å¨æ æ³å¨æ°çä»£æ¾å°è¶³å¤é¿çè¿ç»­ç©ºé²ç©ºé´ï¼jvm å°±ä¼ç´æ¥åéå°èå¹´ä»£ã\n\n# æ°¸ä¹ä»£\n\nè¿é¨åå°±æ¯æ©æ hotspot jvm çæ¹æ³åºå®ç°æ¹å¼äºï¼å¨å­ java ç±»åæ°æ®ãå¸¸éæ± ãintern å­ç¬¦ä¸²ç¼å­ãå¨ jdk 8 ä¹åå°±ä¸å­å¨æ°¸ä¹ä»£è¿åå¿äºã\n\n# jvm åæ°\n\nè¿éé¡ºä¾¿æä¸ä¸ï¼jvm åè®¸å¯¹å ç©ºé´å¤§å°ãåä»£ç©ºé´å¤§å°è¿è¡è®¾ç½®ï¼ä»¥è°æ´ jvm gcã\n\néç½®                  æè¿°\n-xss                èææºæ å¤§å°ã\n-xms                å ç©ºé´åå§å¼ã\n-xmx                å ç©ºé´æå¤§å¼ã\n-xmn                æ°çä»£ç©ºé´å¤§å°ã\n-xx:newsize         æ°çä»£ç©ºé´åå§å¼ã\n-xx:maxnewsize      æ°çä»£ç©ºé´æå¤§å¼ã\n-xx:newratio        æ°çä»£ä¸å¹´èä»£çæ¯ä¾ãé»è®¤ä¸º 2ï¼æå³çèå¹´ä»£æ¯æ°çä»£ç 2 åã\n-xx:survivorratio   æ°çä»£ä¸­è°æ´ eden åºä¸ survivor åºçæ¯ä¾ï¼é»è®¤ä¸º 8ãå³ eden åºä¸º 80% çå¤§å°ï¼ä¸¤ä¸ª\n                    survivor åå«ä¸º 10% çå¤§å°ã\n-xx:permsize        æ°¸ä¹ä»£ç©ºé´çåå§å¼ã\n-xx:maxpermsize     æ°¸ä¹ä»£ç©ºé´çæå¤§å¼ã\n\n\n# åå¾æ¶éå¨\n\n\n\nä»¥ä¸æ¯ hotspot èææºä¸­ç 7 ä¸ªåå¾æ¶éå¨ï¼è¿çº¿è¡¨ç¤ºåå¾æ¶éå¨å¯ä»¥éåä½¿ç¨ã\n\næ³¨ï¼g1 åå¾æ¶éå¨æ¢å¯ä»¥åæ¶å¹´è½»ä»£åå­ï¼ä¹å¯ä»¥åæ¶èå¹´ä»£åå­ãèå¶ä»åå¾æ¶éå¨åªè½éå¯¹ç¹å®ä»£çåå­è¿è¡åæ¶ã\n\n\n# ä¸²è¡æ¶éå¨\n\nä¸²è¡æ¶éå¨ï¼serialï¼æ¯æåºæ¬ãåå±åå²ææ ä¹çæ¶éå¨ã\n\nä¸²è¡æ¶éå¨æ¯ client æ¨¡å¼ä¸çé»è®¤æ¶éå¨éç½®ãå ä¸ºå¨å®¢æ·ç«¯æ¨¡å¼ä¸ï¼åéç»èææºç®¡ççåå­ä¸è¬æ¥è¯´ä¸ä¼å¾å¤§ãserial æ¶éå¨æ¶éå ååçè³ä¸ä¸¤ç¾åçå¹´è½»ä»£åé¡¿æ¶é´å¯ä»¥æ§å¶å¨ä¸ç¾å¤æ¯«ç§ä»¥åï¼åªè¦ä¸æ¯å¤ªé¢ç¹ï¼è¿ç¹åé¡¿æ¯å¯ä»¥æ¥åçã\n\nä¸²è¡æ¶éå¨éç¨åçº¿ç¨ stop-the-world çæ¹å¼è¿è¡æ¶éãå½åå­ä¸è¶³æ¶ï¼ä¸²è¡ gc è®¾ç½®åé¡¿æ è¯ï¼å¾ææçº¿ç¨é½è¿å¥å®å¨ç¹ï¼safepointï¼æ¶ï¼åºç¨çº¿ç¨æåï¼ä¸²è¡ gc å¼å§å·¥ä½ï¼éç¨åçº¿ç¨æ¹å¼åæ¶ç©ºé´å¹¶æ´çåå­ã\n\nserial / serial old æ¶éå¨è¿è¡ç¤ºæå¾\n\nåçº¿ç¨æå³çå¤æåº¦æ´ä½ãå ç¨åå­æ´å°ï¼åå¾åæ¶æçé«ï¼ä½åæ¶ä¹æå³çä¸è½ææå©ç¨å¤æ ¸ä¼å¿ãäºå®ä¸ï¼ä¸²è¡æ¶éå¨ç¹å«éåå åå­ä¸é«ãåæ ¸çè³åæ ¸ cpu çåºåã\n\n# serial æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-xx:+useserialgc\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ serial + serial old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n\n# serial old æ¶éå¨\n\nserial old æ¯ serial æ¶éå¨çèå¹´ä»£çæ¬ï¼ä¹æ¯ç» client æ¨¡å¼ä¸çèææºä½¿ç¨ãå¦æç¨å¨ server æ¨¡å¼ä¸ï¼å®æä¸¤å¤§ç¨éï¼\n\n * å¨ jdk 1.5 ä»¥åä¹åçæ¬ï¼parallel old è¯çä»¥åï¼ä¸­ä¸ parallel scavenge æ¶éå¨æ­éä½¿ç¨ã\n * ä½ä¸º cms æ¶éå¨çåå¤é¢æ¡ï¼å¨å¹¶åæ¶éåç concurrent mode failure æ¶ä½¿ç¨ã\n\n\n# å¹¶è¡æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-xx:+useparallelgc\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ parallel scavenge + serial old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n> \n> å¼å¯éé¡¹ï¼-xx:+useparalleloldgc\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ parallel scavenge + parallel old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n\nå¶ä»æ¶éå¨é½æ¯ä»¥å³æ³¨åé¡¿æ¶é´ä¸ºç®æ ï¼èå¹¶è¡æ¶éå¨æ¯ä»¥å³æ³¨ååéï¼throughputï¼ä¸ºç®æ çåå¾æ¶éå¨ã\n\n * åé¡¿æ¶é´è¶ç­å°±è¶éåéè¦ä¸ç¨æ·äº¤äºçç¨åºï¼è¯å¥½çååºéåº¦è½æåç¨æ·ä½éªï¼\n * èé«ååéåå¯ä»¥é«æçå°å©ç¨ cpu æ¶é´ï¼å°½å¿«å®æç¨åºçè¿ç®ä»»å¡ï¼ä¸»è¦éåå¨åå°è¿ç®èä¸éè¦å¤ªå¤äº¤äºçä»»å¡ã\n\nååé = è¿è¡ç¨æ·ä»£ç æ¶é´ / (è¿è¡ç¨æ·ä»£ç æ¶é´ + åå¾æ¶éæ¶é´)\n\n\nå¹¶è¡æ¶éå¨æ¯ server æ¨¡å¼ä¸çé»è®¤æ¶éå¨ã\n\nå¹¶è¡æ¶éå¨ä¸ä¸²è¡æ¶éå¨å·¥ä½æ¨¡å¼ç¸ä¼¼ï¼é½æ¯ stop-the-world æ¹å¼ï¼åªæ¯æåæ¶å¹¶è¡å°è¿è¡åå¾æ¶éãå¹¶è¡æ¶éå¨å¹´è½»ä»£éç¨å¤å¶ç®æ³ï¼èå¹´ä»£éç¨æ è®°-æ´çï¼å¨åæ¶çåæ¶è¿ä¼å¯¹åå­è¿è¡åç¼©ãå¹¶è¡æ¶éå¨éåå¯¹ååéè¦æ±è¿è¿é«äºå»¶è¿è¦æ±çåºæ¯ï¼å¹¶ä¸å¨æ»¡è¶³æå·®å»¶æ¶çæåµä¸ï¼å¹¶è¡æ¶éå¨å°æä¾æä½³çååéã\n\nå¨æ³¨éååéä»¥å cpu èµæºææçåºåï¼é½å¯ä»¥ä¼åèè parallel scavenge æ¶éå¨ + parallel old æ¶éå¨ã\n\nparallel / parallel old æ¶éå¨è¿è¡ç¤ºæå¾\n\n# parallel scavenge æ¶éå¨\n\nparallel scavenge æ¶éå¨æä¾äºä¸¤ä¸ªåæ°ç¨äºç²¾ç¡®æ§å¶ååéï¼åå«æ¯ï¼\n\n * -xx:maxgcpausemillis - æ§å¶æå¤§åå¾æ¶éåé¡¿æ¶é´ï¼æ¶éå¨å°å°½å¯è½ä¿è¯åå­åæ¶æ¶é´ä¸è¶è¿è®¾å®å¼ã\n * -xx:gctimeratio - ç´æ¥è®¾ç½®ååéå¤§å°çï¼å¼ä¸ºå¤§äº 0 ä¸å°äº 100 çæ´æ°ï¼ã\n\nç¼©ç­åé¡¿æ¶é´æ¯ä»¥çºç²ååéåå¹´è½»ä»£ç©ºé´æ¥æ¢åçï¼å¹´è½»ä»£ç©ºé´åå°ï¼åå¾åæ¶åå¾é¢ç¹ï¼å¯¼è´ååéä¸éã\n\nparallel scavenge æ¶éå¨è¿æä¾äºä¸ä¸ªåæ° -xx:+useadaptivesizepolicyï¼è¿æ¯ä¸ä¸ªå¼å³åæ°ï¼æå¼åæ°åï¼å°±ä¸éè¦æå·¥æå®å¹´è½»ä»£çå¤§å°ï¼-xmnï¼ãeden å survivor åºçæ¯ä¾ï¼-xx:survivorratioï¼ãæåèå¹´ä»£å¯¹è±¡å¹´é¾ï¼-xx:pretenuresizethresholdï¼ç­ç»èåæ°äºï¼èææºä¼æ ¹æ®å½åç³»ç»çè¿è¡æåµæ¶éæ§è½çæ§ä¿¡æ¯ï¼å¨æè°æ´è¿äºåæ°ä»¥æä¾æåéçåé¡¿æ¶é´æèæå¤§çååéï¼è¿ç§æ¹å¼ç§°ä¸º gc èªéåºçè°èç­ç¥ï¼gc ergonomicsï¼ã\n\n# parallel old æ¶éå¨\n\næ¯ parallel scavenge æ¶éå¨çèå¹´ä»£çæ¬ï¼ä½¿ç¨å¤çº¿ç¨å âæ è®°-æ´çâ ç®æ³ã\n\n\n# å¹¶åæ è®°æ¸é¤æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-xx:+useconcmarksweepgc\n> \n> æå¼æ­¤å¼å³åï¼ä½¿ç¨ cms + parnew + serial old æ¶éå¨ç»åæ¥è¿è¡åå­åæ¶ã\n\nå¹¶åæ è®°æ¸é¤æ¶éå¨æ¯ä»¥è·åæç­åé¡¿æ¶é´ä¸ºç®æ ã\n\nå¼å¯åï¼å¹´è½»ä»£ä½¿ç¨ parnew æ¶éå¨ï¼èå¹´ä»£ä½¿ç¨ cms æ¶éå¨ï¼å¦æ cms äº§ççç¢çè¿å¤ï¼å¯¼è´æ æ³å­æ¾æµ®å¨åå¾ï¼jvm ä¼åºç° concurrent mode failure ï¼æ­¤æ¶ä½¿ç¨ serial old æ¶éå¨æ¥æ¿ä»£ cms æ¶éå¨æ¸çç¢çã\n\n# cms æ¶éå¨\n\ncms æ¶éå¨æ¯ä¸ç§ä»¥è·åæç­åé¡¿æ¶é´ä¸ºç®æ çæ¶éå¨ã\n\ncmsï¼concurrent mark sweepï¼ï¼mark sweep æçæ¯æ è®° - æ¸é¤ç®æ³ã\n\n# cms åæ¶æºå¶\n\ncms æ¶éå¨è¿è¡æ­¥éª¤å¦ä¸ï¼\n\n 1. åå§æ è®°ï¼ä»ä»åªæ¯æ è®°ä¸ä¸ gc roots è½ç´æ¥å³èå°çå¯¹è±¡ï¼éåº¦å¾å¿«ï¼éè¦åé¡¿ã\n 2. å¹¶åæ è®°ï¼è¿è¡ gc roots tracing çè¿ç¨ï¼å®å¨æ´ä¸ªåæ¶è¿ç¨ä¸­èæ¶æé¿ï¼ä¸éè¦åé¡¿ã\n 3. éæ°æ è®°ï¼ä¸ºäºä¿®æ­£å¹¶åæ è®°æé´å ç¨æ·ç¨åºç»§ç»­è¿ä½èå¯¼è´æ è®°äº§çåå¨çé£ä¸é¨åå¯¹è±¡çæ è®°è®°å½ï¼éè¦åé¡¿ã\n 4. å¹¶åæ¸é¤ï¼åæ¶å¨æ è®°é¶æ®µè¢«é´å®ä¸ºä¸å¯è¾¾çå¯¹è±¡ãä¸éè¦åé¡¿ã\n\nå¨æ´ä¸ªè¿ç¨ä¸­èæ¶æé¿çå¹¶åæ è®°åå¹¶åæ¸é¤è¿ç¨ä¸­ï¼æ¶éå¨çº¿ç¨é½å¯ä»¥ä¸ç¨æ·çº¿ç¨ä¸èµ·å·¥ä½ï¼ä¸éè¦è¿è¡åé¡¿ã\n\ncms æ¶éå¨è¿è¡ç¤ºæå¾\n\n# cms åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼å ç©ºé´è¢«åå²ä¸ºä¸åç©ºé´\n\nå¹´è½»ä»£åå²æä¸ä¸ª eden åºåä¸¤ä¸ª survivor åºãå¹´èä»£ä¸ä¸ªè¿ç»­çç©ºé´ãå°±å°å®æå¯¹è±¡æ¶éãé¤éæ fullgc å¦åä¸ä¼åç¼©ã\n\nï¼2ï¼cms å¹´è½»ä»£åå¾æ¶éå¦ä½å·¥ä½\n\nå¹´è½»ä»£è¢«æ ä¸ºæµç»¿è²ï¼å¹´èä»£è¢«æ è®°ä¸ºèè²ãå¦æä½ çåºç¨å·²ç»è¿è¡äºä¸æ®µæ¶é´ï¼cms çå çèµ·æ¥åºè¯¥æ¯è¿ä¸ªæ ·å­ãå¯¹è±¡åæ£å¨å¹´èä»£åºåéã\n\n\n\nä½¿ç¨ cmsï¼å¹´èä»£å¯¹è±¡å°±å°éæ¾ãå®ä»¬ä¸ä¼è¢«æ¥åç§»å¨ãè¿ä¸ªç©ºé´ä¸ä¼è¢«åç¼©é¤éåç fullgcã\n\nï¼3ï¼å¹´è½»ä»£æ¶é\n\nä» eden å survivor åºå¤å¶æ´»è·å¯¹è±¡å°å¦ä¸ä¸ª survivor åºãææè¾¾å°ä»ä»¬çå¹´é¾éå¼çå¯¹è±¡ä¼æåå°å¹´èä»£ã\n\nï¼4ï¼å¹´è½»ä»£åæ¶ä¹å\n\nä¸æ¬¡å¹´è½»ä»£åå¾æ¶éä¹åï¼eden åºåå¶ä¸­ä¸ä¸ª survivor åºè¢«æ¸ç©ºã\n\næè¿æåçå¯¹è±¡ä»¥æ·±èè²æ¾ç¤ºå¨ä¸å¾ä¸­ï¼ç»¿è²çå¯¹è±¡æ¯å¹´è½»ä»£å¹¸åçè¿æ²¡ææåå°èå¹´ä»£å¯¹è±¡ã\n\n# cms åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼cms çå¹´èä»£æ¶é\n\nåçä¸¤æ¬¡ stop the world äºä»¶ï¼åå§æ è®°åéæ°æ è®°ãå½å¹´èä»£è¾¾å°ç¹å®çå ç¨æ¯ä¾æ¶ï¼cms å¼å§æ§è¡ã\n\n\n\n * åå§æ è®°æ¯ä¸ä¸ªç­ææåçãå¯è¾¾å¯¹è±¡è¢«æ è®°çé¶æ®µã\n * å¹¶åæ è®°å¯»æ¾æ´»è·å¯¹è±¡å¨åºç¨è¿ç»­æ§è¡æ¶ã\n * æåï¼å¨éæ°æ è®°é¶æ®µï¼å¯»æ¾å¨ä¹åå¹¶åæ è®°é¶æ®µä¸­ä¸¢å¤±çå¯¹è±¡ã\n\nï¼2ï¼å¹´èä»£æ¶é-å¹¶åæ¸é¤\n\nå¨ä¹åé¶æ®µæ²¡æè¢«æ è®°çå¯¹è±¡ä¼è¢«å°±å°éæ¾ãä¸è¿è¡åç¼©æä½ã\n\n**æ³¨æï¼**æªè¢«æ è®°çå¯¹è±¡ç­äºæ­»äº¡å¯¹è±¡\n\nï¼3ï¼å¹´èä»£æ¶é-æ¸é¤ä¹å\n\næ¸é¤é¶æ®µä¹åï¼ä½ å¯ä»¥çå°å¤§éåå­è¢«éæ¾ãä½ è¿å¯ä»¥æ³¨æå°æ²¡æè¿è¡åç¼©æä½ã\n\næåï¼cms æ¶éå¨ä¼åæ¬¡è¿å¥éæ°è®¾ç½®é¶æ®µï¼ç­å¾ä¸ä¸æ¬¡åå¾æ¶éæ¶æºçå°æ¥ã\n\n# cms ç¹ç¹\n\ncms æ¶éå¨å·æä»¥ä¸ç¼ºç¹ï¼\n\n * å¹¶åæ¶é - å¹¶åæçæ¯ç¨æ·çº¿ç¨å gc çº¿ç¨åæ¶è¿è¡ã\n * ååéä½ - ä½åé¡¿æ¶é´æ¯ä»¥çºç²ååéä¸ºä»£ä»·çï¼å¯¼è´ cpu å©ç¨çä¸å¤é«ã\n * æ æ³å¤çæµ®å¨åå¾ - å¯è½åºç° concurrent mode failureãæµ®å¨åå¾æ¯æå¹¶åæ¸é¤é¶æ®µç±äºç¨æ·çº¿ç¨ç»§ç»­è¿è¡èäº§ççåå¾ï¼è¿é¨ååå¾åªè½å°ä¸ä¸æ¬¡ gc æ¶æè½è¿è¡åæ¶ãç±äºæµ®å¨åå¾çå­å¨ï¼å æ­¤éè¦é¢çåºä¸é¨ååå­ï¼æå³ç cms æ¶éä¸è½åå¶å®æ¶éå¨é£æ ·ç­å¾èå¹´ä»£å¿«æ»¡çæ¶åååæ¶ã\n   * å¯ä»¥ä½¿ç¨ -xx:cmsinitiatingoccupancyfraction æ¥æ¹åè§¦å cms æ¶éå¨å·¥ä½çåå­å ç¨ç¾åï¼å¦æè¿ä¸ªå¼è®¾ç½®çå¤ªå¤§ï¼å¯¼è´é¢ççåå­ä¸å¤å­æ¾æµ®å¨åå¾ï¼å°±ä¼åºç° concurrent mode failureï¼è¿æ¶èææºå°ä¸´æ¶å¯ç¨ serial old æ¶éå¨æ¥æ¿ä»£ cms æ¶éå¨ã\n * æ è®° - æ¸é¤ç®æ³å¯¼è´çç©ºé´ç¢çï¼å¾å¾åºç°èå¹´ä»£ç©ºé´å©ä½ï¼ä½æ æ³æ¾å°è¶³å¤å¤§è¿ç»­ç©ºé´æ¥åéå½åå¯¹è±¡ï¼ä¸å¾ä¸æåè§¦åä¸æ¬¡ full gcã\n   * å¯ä»¥ä½¿ç¨ -xx:+usecmscompactatfullcollection ï¼ç¨äºå¨ cms æ¶éå¨è¦è¿è¡ full gc æ¶å¼å¯åå­ç¢ççåå¹¶æ´çï¼åå­æ´ççè¿ç¨æ¯æ æ³å¹¶åçï¼ç©ºé´ç¢çé®é¢æ²¡æäºï¼ä½æ¯åé¡¿æ¶é´ä¸å¾ä¸åé¿äºã\n   * å¯ä»¥ä½¿ç¨ -xx:cmsfullgcsbeforecompaction ï¼ç¨äºè®¾ç½®æ§è¡å¤å°æ¬¡ä¸åç¼©ç full gc åï¼æ¥ä¸æ¬¡å¸¦åç¼©çï¼é»è®¤ä¸º 0ï¼è¡¨ç¤ºæ¯æ¬¡è¿å¥ full gc æ¶é½è¦è¿è¡ç¢çæ´çï¼ã\n\n# parnew æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-xx:+useparnewgc\n\nparnew æ¶éå¨å¶å®æ¯ serial æ¶éå¨çå¤çº¿ç¨çæ¬ã\n\nparnew æ¶éå¨è¿è¡ç¤ºæå¾\n\næ¯ server æ¨¡å¼ä¸çèææºé¦éå¹´è½»ä»£æ¶éå¨ï¼é¤äºæ§è½åå å¤ï¼ä¸»è¦æ¯å ä¸ºé¤äº serial æ¶éå¨ï¼åªæå®è½ä¸ cms æ¶éå¨éåå·¥ä½ã\n\nparnew æ¶éå¨ä¹æ¯ä½¿ç¨ -xx:+useconcmarksweepgc åçé»è®¤å¹´è½»ä»£æ¶éå¨ã\n\nparnew æ¶éå¨é»è®¤å¼å¯ççº¿ç¨æ°éä¸ cpu æ°éç¸åï¼å¯ä»¥ä½¿ç¨ -xx:parallelgcthreads åæ°æ¥è®¾ç½®çº¿ç¨æ°ã\n\n\n# g1 æ¶éå¨\n\n> å¼å¯éé¡¹ï¼-xx:+useg1gc\n\nåé¢æå°çåå¾æ¶éå¨ä¸è¬ç­ç¥æ¯å³æ³¨ååéæåé¡¿æ¶é´ãè g1 æ¯ä¸ç§å¼é¡¾ååéååé¡¿æ¶é´ç gc æ¶éå¨ãg1 æ¯ oracle jdk9 ä»¥åçé»è®¤ gc æ¶éå¨ãg1 å¯ä»¥ç´è§çè®¾å®åé¡¿æ¶é´çç®æ ï¼ç¸æ¯äº cms gcï¼g1 æªå¿è½åå° cms å¨æå¥½æåµä¸çå»¶æ¶åé¡¿ï¼ä½æ¯æå·®æåµè¦å¥½å¾å¤ã\n\ng1 æå¤§çç¹ç¹æ¯å¼å¥ååºçæè·¯ï¼å¼±åäºåä»£çæ¦å¿µï¼åçå©ç¨åå¾æ¶éåä¸ªå¨æçèµæºï¼è§£å³äºå¶ä»æ¶éå¨çè³ cms çä¼å¤ç¼ºé·ã\n\n# åä»£åååº\n\næ§çåå¾æ¶éå¨ä¸è¬éååä»£æ¶éï¼java å è¢«åä¸ºå¹´è½»ä»£ãèå¹´ä»£åæ°¸ä¹ä»£ãæ¶éçèå´é½æ¯æ´ä¸ªå¹´è½»ä»£æèæ´ä¸ªèå¹´ä»£ã\n\ng1 åæ¶äºæ°¸ä¹ä»£ï¼å¹¶æå¹´è½»ä»£åèå¹´ä»£ååæå¤ä¸ªå¤§å°ç¸ç­çç¬ç«åºåï¼regionï¼ï¼å¹´è½»ä»£åèå¹´ä»£ä¸åç©çéç¦»ãg1 å¯ä»¥ç´æ¥å¯¹å¹´è½»ä»£åèå¹´ä»£ä¸èµ·åæ¶ã\n\n\n\néè¿å¼å¥ region çæ¦å¿µï¼ä»èå°åæ¥çä¸æ´ååå­ç©ºé´ååæå¤ä¸ªçå°ç©ºé´ï¼ä½¿å¾æ¯ä¸ªå°ç©ºé´å¯ä»¥åç¬è¿è¡åå¾åæ¶ãè¿ç§ååæ¹æ³å¸¦æ¥äºå¾å¤§ççµæ´»æ§ï¼ä½¿å¾å¯é¢æµçåé¡¿æ¶é´æ¨¡åæä¸ºå¯è½ãéè¿è®°å½æ¯ä¸ª region åå¾åæ¶æ¶é´ä»¥ååæ¶æè·å¾çç©ºé´ï¼è¿ä¸¤ä¸ªå¼æ¯éè¿è¿å»åæ¶çç»éªè·å¾ï¼ï¼å¹¶ç»´æ¤ä¸ä¸ªä¼ååè¡¨ï¼æ¯æ¬¡æ ¹æ®åè®¸çæ¶éæ¶é´ï¼ä¼ååæ¶ä»·å¼æå¤§ç regionã\n\næ¯ä¸ª region é½æä¸ä¸ª remembered setï¼ç¨æ¥è®°å½è¯¥ region å¯¹è±¡çå¼ç¨å¯¹è±¡æå¨ç regionãéè¿ä½¿ç¨ remembered setï¼å¨åå¯è¾¾æ§åæçæ¶åå°±å¯ä»¥é¿åå¨å æ«æã\n\n# g1 åæ¶æºå¶\n\ng1 æ¶éå¨è¿è¡ç¤ºæå¾\n\nå¦æä¸è®¡ç®ç»´æ¤ remembered set çæä½ï¼g1 æ¶éå¨çè¿ä½å¤§è´å¯ååä¸ºä»¥ä¸å ä¸ªæ­¥éª¤ï¼\n\n 1. åå§æ è®°\n 2. å¹¶åæ è®°\n 3. æç»æ è®° - ä¸ºäºä¿®æ­£å¨å¹¶åæ è®°æé´å ç¨æ·ç¨åºç»§ç»­è¿ä½èå¯¼è´æ è®°äº§çåå¨çé£ä¸é¨åæ è®°è®°å½ï¼èææºå°è¿æ®µæ¶é´å¯¹è±¡ååè®°å½å¨çº¿ç¨ç remembered set logs éé¢ï¼æç»æ è®°é¶æ®µéè¦æ remembered set logs çæ°æ®åå¹¶å° remembered set ä¸­ãè¿é¶æ®µéè¦åé¡¿çº¿ç¨ï¼ä½æ¯å¯å¹¶è¡æ§è¡ã\n 4. ç­éåæ¶ - é¦åå¯¹åä¸ª region ä¸­çåæ¶ä»·å¼åææ¬è¿è¡æåºï¼æ ¹æ®ç¨æ·æææç gc åé¡¿æ¯æ¶é´æ¥å¶å®åæ¶è®¡åãæ­¤é¶æ®µå¶å®ä¹å¯ä»¥åå°ä¸ç¨æ·ç¨åºä¸èµ·å¹¶åæ§è¡ï¼ä½æ¯å ä¸ºåªåæ¶ä¸é¨å regionï¼æ¶é´æ¯ç¨æ·å¯æ§å¶çï¼èä¸åé¡¿ç¨æ·çº¿ç¨å°å¤§å¹åº¦æé«æ¶éæçã\n\nå·å¤å¦ä¸ç¹ç¹ï¼\n\n * ç©ºé´æ´åï¼æ´ä½æ¥çæ¯åºäºâæ è®° - æ´çâç®æ³å®ç°çæ¶éå¨ï¼ä»å±é¨ï¼ä¸¤ä¸ª region ä¹é´ï¼ä¸æ¥çæ¯åºäºâå¤å¶âç®æ³å®ç°çï¼è¿æå³çè¿è¡æé´ä¸ä¼äº§çåå­ç©ºé´ç¢çã\n * å¯é¢æµçåé¡¿ï¼è½è®©ä½¿ç¨èæç¡®æå®å¨ä¸ä¸ªé¿åº¦ä¸º m æ¯«ç§çæ¶é´çæ®µåï¼æ¶èå¨ gc ä¸çæ¶é´ä¸å¾è¶è¿ n æ¯«ç§ã\n\n# g1 åæ¶å¹´è½»ä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼g1 åå§å ç©ºé´\n\nå ç©ºé´æ¯ä¸ä¸ªè¢«åæè®¸å¤åºå®å¤§å°åºåçåå­åã\n\njava èææºå¯å¨æ¶éå®åºåå¤§å°ãjava èææºéå¸¸ä¼æå® 2000 ä¸ªå·¦å³çå¤§å°ç¸ç­ãæ¯ä¸ªå¤§å°èå´å¨ 1 å° 32m çåºåã\n\nï¼2ï¼g1 å ç©ºé´åé\n\nå®éä¸ï¼è¿äºåºåè¢«æ å°æ edenãsurvivorãå¹´èä»£ç©ºé´çé»è¾è¡¨è¿°å½¢å¼ã\n\nå¾çä¸­çé¢è²è¡¨æäºåªä¸ªåºåè¢«å³èä¸ä»ä¹è§è²ãæ´»è·å¯¹è±¡ä»ä¸ä¸ªåºåçæ£ï¼å¤å¶ãç§»å¨ï¼å°å¦ä¸ä¸ªåºåãåºåè¢«è®¾è®¡ä¸ºå¹¶è¡çæ¹å¼æ¶éï¼å¯ä»¥æåæèä¸æåææçå¶å®ç¨æ·çº¿ç¨ã\n\nææ¾çåºåå¯ä»¥è¢«åéæ edenãsurvivorãold åºåãå¦å¤ï¼æç¬¬åç§ç±»åçåºåå«åæå¤§åºå(humongous regions)ãè¿äºåºåè¢«è®¾è®¡æä¿ææ ååºåå¤§å°ç 50%æèæ´å¤§çå¯¹è±¡ãå®ä»¬è¢«ä¿å­å¨ä¸ä¸ªè¿ç»­çåºåéåéãæåï¼æåä¸ä¸ªç±»åçåºåå°±æ¯å ç©ºé´éæ²¡æä½¿ç¨çåºåã\n\n**æ³¨æï¼**åä½æ­¤æç« æ¶ï¼æ¶éæå¤§å¯¹è±¡æ¶è¿æ²¡æè¢«ä¼åãå æ­¤ï¼ä½ åºè¯¥é¿ååå»ºè¿ä¸ªå¤§å°çå¯¹è±¡ã\n\nï¼3ï¼g1 çå¹´è½»ä»£\n\nå ç©ºé´è¢«åå²æå¤§çº¦ 2000 ä¸ªåºåãæå° 1mï¼æå¤§ 32mï¼èè²åºåä¿æå¹´èä»£å¯¹è±¡ï¼ç»¿è²åºåä¿æå¹´è½»ä»£å¯¹è±¡ã\n\n**æ³¨æï¼**åºåæ²¡æå¿è¦åæ§çæ¶éå¨ä¸æ ·æ¯ä¿æè¿ç»­çã\n\nï¼4ï¼g1 çå¹´è½»ä»£æ¶é\n\næ´»è·å¯¹è±¡ä¼è¢«çæ£ï¼å¤å¶ãç§»å¨ï¼å°ä¸ä¸ªæå¤ä¸ª survivor åºåãå¦æè¾¾å°æåæ»éå¼ï¼å¯¹è±¡ä¼æåå°å¹´èä»£åºåã\n\nè¿æ¯ä¸ä¸ª stop the world æåãä¸ºä¸ä¸æ¬¡å¹´è½»ä»£åå¾åæ¶è®¡ç® eden å survivor çå¤§å°ãä¿çå®¡è®¡ä¿¡æ¯æå©äºè®¡ç®å¤§å°ãç±»ä¼¼ç®æ æåæ¶é´çäºæä¼è¢«èèå¨åã\n\nè¿ä¸ªæ¹æ³ä½¿éè°åºåå¤§å°åå¾å¾å®¹æï¼æéæå®ä»¬è°å¤§æè°å°ã\n\nï¼5ï¼g1 å¹´è½»ä»£åæ¶çå°¾å£°\n\næ´»è·å¯¹è±¡è¢«çæ£å° survivor æèå¹´èä»£åºåã\n\næè¿æåçå¯¹è±¡æ¾ç¤ºä¸ºæ·±èè²ãsurvivor åºåæ¾ç¤ºä¸ºç»¿è²ã\n\nå³äº g1 çå¹´è½»ä»£åæ¶åä»¥ä¸æ»ç»ï¼\n\n * å ç©ºé´æ¯ä¸ååç¬çåå­ç©ºé´è¢«åå²æå¤ä¸ªåºåã\n * å¹´è½»ä»£åå­æ¯ç±ä¸ç»éè¿ç»­çåºåç»æãè¿ä½¿å¾éè¦éè°å¤§å°åå¾å®¹æã\n * å¹´è½»ä»£åå¾åæ¶æ¯ stop the world äºä»¶ï¼ææåºç¨çº¿ç¨é½ä¼å æ­¤æä½æåã\n * å¹´è½»ä»£åå¾æ¶éä½¿ç¨å¤çº¿ç¨å¹¶è¡åæ¶ã\n * æ´»è·å¯¹è±¡è¢«å¤å¶å°æ°ç survivor åºæèå¹´èä»£åºåã\n\n# g1 åæ¶å¹´èä»£è¯¦ç»æ­¥éª¤\n\nï¼1ï¼åå§æ è®°é¶æ®µ\n\nå¹´è½»ä»£åå¾æ¶éè©è´çæ´»è·å¯¹è±¡åå§æ è®°çä»»å¡ãå¨æ¥å¿æä»¶ä¸­è¢«æ ä¸ºgc pause (young)(inital-mark)\n\nï¼2ï¼å¹¶åæ è®°é¶æ®µ\n\nå¦æåç°ç©ºåºå(âxâæ ç¤ºç)ï¼å¨éæ°æ è®°é¶æ®µå®ä»¬ä¼è¢«é©¬ä¸æ¸é¤æãå½ç¶ï¼å³å®æ´»æ§çå®¡è®¡ä¿¡æ¯ä¹å¨æ­¤æ¶è¢«è®¡ç®ã\n\nï¼3ï¼éæ°æ è®°é¶æ®µ\n\nç©ºçåºåè¢«æ¸é¤ååæ¶æãææåºåçæ´»æ§å¨æ­¤æ¶è®¡ç®ã\n\nï¼4ï¼å¤å¶/æ¸çé¶æ®µ\n\ng1 éæ©æ´»æ§æä½çåºåï¼è¿äºåºåè½å¤ä»¥æå¿«çéåº¦åæ¶ãç¶åè¿äºåºåä¼å¨å¹´è½»ä»£åå¾åæ¶è¿ç¨ä¸­è¢«åæ¶ãå¨æ¥å¿ä¸­è¢«æç¤ºä¸º*[gc pause (mixed)]*ãæä»¥å¹´è½»ä»£åå¹´èä»£å¨åä¸æ¶é´è¢«åæ¶ã\n\nï¼5ï¼å¤å¶/æ¸çé¶æ®µä¹å\n\nè¢«éæ©çåºåå·²ç»è¢«åæ¶ååç¼©å°å¾ä¸­æ¾ç¤ºçæ·±èè²åºåæ·±ç»¿è²åºä¸­ã\n\n\n\n\n# æ»ç»\n\næ¶éå¨                 ä¸²è¡/å¹¶è¡/å¹¶å   å¹´è½»ä»£/èå¹´ä»£     æ¶éç®æ³           ç®æ        éç¨åºæ¯\nserial              ä¸²è¡         å¹´è½»ä»£         å¤å¶             ååºéåº¦ä¼å   å cpu ç¯å¢ä¸ç client æ¨¡å¼\nserial old          ä¸²è¡         èå¹´ä»£         æ è®°-æ´ç          ååºéåº¦ä¼å   å cpu ç¯å¢ä¸ç client æ¨¡å¼ãcms çåå¤é¢æ¡\nparnew              ä¸²è¡ + å¹¶è¡    å¹´è½»ä»£         å¤å¶ç®æ³           ååºéåº¦ä¼å   å¤ cpu ç¯å¢æ¶å¨ server æ¨¡å¼ä¸ä¸ cms éå\nparallel scavenge   ä¸²è¡ + å¹¶è¡    å¹´è½»ä»£         å¤å¶ç®æ³           ååéä¼å    å¨åå°è¿ç®èä¸éè¦å¤ªå¤äº¤äºçä»»å¡\nparallel old        ä¸²è¡ + å¹¶è¡    èå¹´ä»£         æ è®°-æ´ç          ååéä¼å    å¨åå°è¿ç®èä¸éè¦å¤ªå¤äº¤äºçä»»å¡\ncms                 å¹¶è¡ + å¹¶å    èå¹´ä»£         æ è®°-æ¸é¤          ååºéåº¦ä¼å   éä¸­å¨äºèç½ç«æ b/s ç³»ç»æå¡ç«¯ä¸ç java åºç¨\ng1                  å¹¶è¡ + å¹¶å    å¹´è½»ä»£ + èå¹´ä»£   æ è®°-æ´ç + å¤å¶ç®æ³   ååºéåº¦ä¼å   é¢åæå¡ç«¯åºç¨ï¼å°æ¥æ¿æ¢ cms\n\n\n# åå­åéä¸åæ¶ç­ç¥\n\nå¯¹è±¡çåå­åéï¼ä¹å°±æ¯å¨å ä¸åéãä¸»è¦åéå¨å¹´è½»ä»£ç eden åºä¸ï¼å°æ°æåµä¸ä¹å¯è½ç´æ¥åéå¨èå¹´ä»£ä¸­ã\n\n\n# minor gc\n\nå½ eden åºç©ºé´ä¸è¶³æ¶ï¼è§¦å minor gcã\n\nminor gc åçå¨å¹´è½»ä»£ä¸ï¼å ä¸ºå¹´è½»ä»£å¯¹è±¡å­æ´»æ¶é´å¾ç­ï¼å æ­¤ minor gc ä¼é¢ç¹æ§è¡ï¼æ§è¡çéåº¦ä¸è¬ä¹ä¼æ¯è¾å¿«ã\n\nminor gc å·¥ä½æµç¨ï¼\n\n 1. java åºç¨ä¸æ­åå»ºå¯¹è±¡ï¼éå¸¸é½æ¯åéå¨ eden åºåï¼å½å¶ç©ºé´ä¸è¶³æ¶ï¼è¾¾å°è®¾å®çéå¼ï¼ï¼è§¦å minor gcãä»ç¶è¢«å¼ç¨çå¯¹è±¡ï¼ç»¿è²æ¹åï¼å­æ´»ä¸æ¥ï¼è¢«å¤å¶å° jvm éæ©ç survivor åºåï¼èæ²¡æè¢«å¼ç¨çå¯¹è±¡ï¼é»è²æ¹åï¼åè¢«åæ¶ã\n\n 2. ç»è¿ä¸æ¬¡ minor gcï¼eden å°±ä¼ç©ºé²ä¸æ¥ï¼ç´å°åæ¬¡è¾¾å° minor gc è§¦åæ¡ä»¶ãè¿æ¶åï¼å¦å¤ä¸ä¸ª survivor åºååä¼æä¸º to åºåï¼eden åºåçå­æ´»å¯¹è±¡å from åºåå¯¹è±¡ï¼é½ä¼è¢«å¤å¶å° to åºåï¼å¹¶ä¸å­æ´»çå¹´é¾è®¡æ°ä¼è¢«å  1ã\n\n 3. ç±»ä¼¼ç¬¬äºæ­¥çè¿ç¨ä¼åçå¾å¤æ¬¡ï¼ç´å°æå¯¹è±¡å¹´é¾è®¡æ°è¾¾å°éå¼ï¼è¿æ¶åå°±ä¼åçæè°çæåï¼promotionï¼è¿ç¨ï¼å¦ä¸å¾æç¤ºï¼è¶è¿éå¼çå¯¹è±¡ä¼è¢«æåå°èå¹´ä»£ãè¿ä¸ªéå¼æ¯å¯ä»¥éè¿ -xx:maxtenuringthreshold åæ°æå®ã\n\n\n# full gc\n\nfull gc åçå¨èå¹´ä»£ä¸ï¼èå¹´ä»£å¯¹è±¡åå¹´è½»ä»£çç¸åï¼å¶å­æ´»æ¶é´é¿ï¼å æ­¤ full gc å¾å°æ§è¡ï¼èä¸æ§è¡éåº¦ä¼æ¯ minor gc æ¢å¾å¤ã\n\n# åå­åéç­ç¥\n\nï¼ä¸ï¼å¯¹è±¡ä¼åå¨ eden åé\n\nå¤§å¤æ°æåµä¸ï¼å¯¹è±¡å¨å¹´è½»ä»£ eden åºåéï¼å½ eden åºç©ºé´ä¸å¤æ¶ï¼åèµ· minor gcã\n\nï¼äºï¼å¤§å¯¹è±¡ç´æ¥è¿å¥èå¹´ä»£\n\nå¤§å¯¹è±¡æ¯æéè¦è¿ç»­åå­ç©ºé´çå¯¹è±¡ï¼æå¸åçå¤§å¯¹è±¡æ¯é£ç§å¾é¿çå­ç¬¦ä¸²ä»¥åæ°ç»ã\n\nç»å¸¸åºç°å¤§å¯¹è±¡ä¼æåè§¦ååå¾æ¶éä»¥è·åè¶³å¤çè¿ç»­ç©ºé´åéç»å¤§å¯¹è±¡ã\n\n-xx:pretenuresizethresholdï¼å¤§äºæ­¤å¼çå¯¹è±¡ç´æ¥å¨èå¹´ä»£åéï¼é¿åå¨ eden åºå survivor åºä¹é´çå¤§éåå­å¤å¶ã\n\nï¼ä¸ï¼é¿æå­æ´»çå¯¹è±¡è¿å¥èå¹´ä»£\n\nä¸ºå¯¹è±¡å®ä¹å¹´é¾è®¡æ°å¨ï¼å¯¹è±¡å¨ eden åºçå¹¶ç»è¿ minor gc ä¾ç¶å­æ´»ï¼å°ç§»å¨å° survivor ä¸­ï¼å¹´é¾å°±å¢å  1 å²ï¼å¢å å°ä¸å®å¹´é¾åç§»å¨å°èå¹´ä»£ä¸­ã\n\n-xx:maxtenuringthreshold ç¨æ¥å®ä¹å¹´é¾çéå¼ã\n\nï¼åï¼å¨æå¯¹è±¡å¹´é¾å¤å®\n\nèææºå¹¶ä¸æ¯æ°¸è¿å°è¦æ±å¯¹è±¡çå¹´é¾å¿é¡»è¾¾å° maxtenuringthreshold æè½æåèå¹´ä»£ï¼å¦æå¨ survivor åºä¸­ç¸åå¹´é¾ææå¯¹è±¡å¤§å°çæ»åå¤§äº survivor ç©ºé´çä¸åï¼åå¹´é¾å¤§äºæç­äºè¯¥å¹´é¾çå¯¹è±¡å¯ä»¥ç´æ¥è¿å¥èå¹´ä»£ï¼æ éç­å° maxtenuringthreshold ä¸­è¦æ±çå¹´é¾ã\n\nï¼äºï¼ç©ºé´åéæä¿\n\nå¨åç minor gc ä¹åï¼èææºåæ£æ¥èå¹´ä»£æå¤§å¯ç¨çè¿ç»­ç©ºé´æ¯å¦å¤§äºå¹´è½»ä»£ææå¯¹è±¡æ»ç©ºé´ï¼å¦ææ¡ä»¶æç«çè¯ï¼é£ä¹ minor gc å¯ä»¥ç¡®è®¤æ¯å®å¨çï¼å¦æä¸æç«çè¯èææºä¼æ¥ç handlepromotionfailure è®¾ç½®å¼æ¯å¦åè®¸æä¿å¤±è´¥ï¼å¦æåè®¸é£ä¹å°±ä¼ç»§ç»­æ£æ¥èå¹´ä»£æå¤§å¯ç¨çè¿ç»­ç©ºé´æ¯å¦å¤§äºåæ¬¡æåå°èå¹´ä»£å¯¹è±¡çå¹³åå¤§å°ï¼å¦æå¤§äºï¼å°å°è¯çè¿è¡ä¸æ¬¡ minor gcï¼å°½ç®¡è¿æ¬¡ minor gc æ¯æé£é©çï¼å¦æå°äºï¼æè handlepromotionfailure è®¾ç½®ä¸åè®¸åé©ï¼é£è¿æ¶ä¹è¦æ¹ä¸ºè¿è¡ä¸æ¬¡ full gcã\n\n# full gc çè§¦åæ¡ä»¶\n\nå¯¹äº minor gcï¼å¶è§¦åæ¡ä»¶éå¸¸ç®åï¼å½ eden åºç©ºé´æ»¡æ¶ï¼å°±å°è§¦åä¸æ¬¡ minor gcãè full gc åç¸å¯¹å¤æï¼æä»¥ä¸æ¡ä»¶ï¼\n\nï¼1ï¼è°ç¨ system.gc()\n\næ­¤æ¹æ³çè°ç¨æ¯å»ºè®®èææºè¿è¡ full gcï¼è½ç¶åªæ¯å»ºè®®èéä¸å®ï¼ä½å¾å¤æåµä¸å®ä¼è§¦å full gcï¼ä»èå¢å  full gc çé¢çï¼ä¹å³å¢å äºé´æ­æ§åé¡¿çæ¬¡æ°ãå æ­¤å¼ºçå»ºè®®è½ä¸ä½¿ç¨æ­¤æ¹æ³å°±ä¸è¦ä½¿ç¨ï¼è®©èææºèªå·±å»ç®¡çå®çåå­ãå¯éè¿ -xx:disableexplicitgc æ¥ç¦æ­¢ rmi è°ç¨ system.gc()ã\n\nï¼2ï¼èå¹´ä»£ç©ºé´ä¸è¶³\n\nèå¹´ä»£ç©ºé´ä¸è¶³çå¸¸è§åºæ¯ä¸ºåææè®²çå¤§å¯¹è±¡ç´æ¥è¿å¥èå¹´ä»£ãé¿æå­æ´»çå¯¹è±¡è¿å¥èå¹´ä»£ç­ï¼å½æ§è¡ full gc åç©ºé´ä»ç¶ä¸è¶³ï¼åæåº java.lang.outofmemoryerror: java heap spaceãä¸ºé¿åä»¥ä¸åå å¼èµ·ç full gcï¼è°ä¼æ¶åºå°½éåå°è®©å¯¹è±¡å¨ minor gc é¶æ®µè¢«åæ¶ãè®©å¯¹è±¡å¨å¹´è½»ä»£å¤å­æ´»ä¸æ®µæ¶é´ä»¥åä¸è¦åå»ºè¿å¤§çå¯¹è±¡åæ°ç»ã\n\nï¼3ï¼æ¹æ³åºç©ºé´ä¸è¶³\n\njvm è§èä¸­è¿è¡æ¶æ°æ®åºåä¸­çæ¹æ³åºï¼å¨ hotspot èææºä¸­åè¢«ä¹ æ¯ç§°ä¸ºæ°¸ä¹ä»£ï¼æ°¸ä¹ä»£ä¸­å­æ¾çæ¯ç±»çæè¿°ä¿¡æ¯ãå¸¸éãéæåéç­æ°æ®ï¼å½ç³»ç»ä¸­è¦å è½½çç±»ãåå°çç±»åè°ç¨çæ¹æ³è¾å¤æ¶ï¼æ°¸ä¹ä»£å¯è½ä¼è¢«å æ»¡ï¼å¨æªéç½®ä¸ºéç¨ cms gc çæåµä¸ä¹ä¼æ§è¡ full gcãå¦æç»è¿ full gc ä»ç¶åæ¶ä¸äºï¼é£ä¹ jvm ä¼æåº java.lang.outofmemoryerror: permgen space éè¯¯ãä¸ºé¿åæ°¸ä¹ä»£å æ»¡é æ full gc ç°è±¡ï¼å¯éç¨çæ¹æ³ä¸ºå¢å¤§ perm gen ç©ºé´æè½¬ä¸ºä½¿ç¨ cms gcã\n\nï¼4ï¼minor gc çå¹³åæåç©ºé´å¤§å°å¤§äºèå¹´ä»£å¯ç¨ç©ºé´\n\nå¦æåç°ç»è®¡æ°æ®è¯´ä¹å minor gc çå¹³åæåå¤§å°æ¯ç®åèå¹´ä»£å©ä½çç©ºé´å¤§ï¼åä¸ä¼è§¦å minor gc èæ¯è½¬ä¸ºè§¦å full gcã\n\nï¼5ï¼å¯¹è±¡å¤§å°å¤§äº to åºåèå¹´ä»£çå¯ç¨åå­\n\nç± eden åºãfrom åºå to åºå¤å¶æ¶ï¼å¯¹è±¡å¤§å°å¤§äº to åºå¯ç¨åå­ï¼åæè¯¥å¯¹è±¡è½¬å­å°èå¹´ä»£ï¼ä¸èå¹´ä»£çå¯ç¨åå­å°äºè¯¥å¯¹è±¡å¤§å°ã\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * ä»è¡¨å°éå­¦ä¹  jvm å®ç°\n * è¯¦è§£ jvm garbage first(g1) åå¾æ¶éå¨\n * g1 åå¾æ¶éå¨å¥é¨\n * getting started with the g1 garbage collector",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java å­èç ",frontmatter:{title:"Java å­èç ",date:"2019-10-28T22:04:39.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM","å­èç ","javaagent","asm","javassist"],permalink:"/pages/e9eb4b/"},regularPath:"/01.Java/01.JavaSE/06.JVM/05.JVM%E5%AD%97%E8%8A%82%E7%A0%81.html",relativePath:"01.Java/01.JavaSE/06.JVM/05.JVMå­èç .md",key:"v-f116965a",path:"/pages/e9eb4b/",headers:[{level:2,title:"å­èç ç®ä»",slug:"å­èç ç®ä»",normalizedTitle:"å­èç ç®ä»",charIndex:15},{level:3,title:"ä»ä¹æ¯å­èç ",slug:"ä»ä¹æ¯å­èç ",normalizedTitle:"ä»ä¹æ¯å­èç ",charIndex:25},{level:3,title:"åç¼è¯å­èç æä»¶",slug:"åç¼è¯å­èç æä»¶",normalizedTitle:"åç¼è¯å­èç æä»¶",charIndex:280},{level:3,title:"å­èç æä»¶ç»æ",slug:"å­èç æä»¶ç»æ",normalizedTitle:"å­èç æä»¶ç»æ",charIndex:5525},{level:4,title:"é­æ°",slug:"é­æ°",normalizedTitle:"é­æ°",charIndex:5566},{level:4,title:"çæ¬å·",slug:"çæ¬å·",normalizedTitle:"çæ¬å·",charIndex:5670},{level:4,title:"å¸¸éæ± ",slug:"å¸¸éæ± ",normalizedTitle:"å¸¸éæ± ",charIndex:5871},{level:4,title:"è®¿é®æ å¿",slug:"è®¿é®æ å¿",normalizedTitle:"è®¿é®æ å¿",charIndex:6171},{level:4,title:"ç±»ç´¢å¼ãç¶ç±»ç´¢å¼ãæ¥å£ç´¢å¼",slug:"ç±»ç´¢å¼ãç¶ç±»ç´¢å¼ãæ¥å£ç´¢å¼",normalizedTitle:"ç±»ç´¢å¼ãç¶ç±»ç´¢å¼ãæ¥å£ç´¢å¼",charIndex:6690},{level:4,title:"å­æ®µè¡¨",slug:"å­æ®µè¡¨",normalizedTitle:"å­æ®µè¡¨",charIndex:6796},{level:4,title:"æ¹æ³è¡¨",slug:"æ¹æ³è¡¨",normalizedTitle:"æ¹æ³è¡¨",charIndex:6910},{level:4,title:"å±æ§è¡¨éå",slug:"å±æ§è¡¨éå",normalizedTitle:"å±æ§è¡¨éå",charIndex:6961},{level:3,title:"å­èç æä»¤",slug:"å­èç æä»¤",normalizedTitle:"å­èç æä»¤",charIndex:6461},{level:2,title:"å­èç å¢å¼º",slug:"å­èç å¢å¼º",normalizedTitle:"å­èç å¢å¼º",charIndex:7303},{level:3,title:"Asm",slug:"asm",normalizedTitle:"asm",charIndex:7623},{level:3,title:"Javassist",slug:"javassist",normalizedTitle:"javassist",charIndex:7388},{level:2,title:"è¿è¡æ¶ç±»çéè½½",slug:"è¿è¡æ¶ç±»çéè½½",normalizedTitle:"è¿è¡æ¶ç±»çéè½½",charIndex:8811},{level:3,title:"Instrument",slug:"instrument",normalizedTitle:"instrument",charIndex:8823},{level:2,title:"JavaAgent",slug:"javaagent",normalizedTitle:"javaagent",charIndex:9175},{level:3,title:"Java Agent ææ¯ç®ä»",slug:"java-agent-ææ¯ç®ä»",normalizedTitle:"java agent ææ¯ç®ä»",charIndex:9822},{level:3,title:"Java Agent åè½ä»ç»",slug:"java-agent-åè½ä»ç»",normalizedTitle:"java agent åè½ä»ç»",charIndex:10156},{level:3,title:"Java Agent å®ç°åç",slug:"java-agent-å®ç°åç",normalizedTitle:"java agent å®ç°åç",charIndex:10496},{level:3,title:"Java Agent æ¡ä¾",slug:"java-agent-æ¡ä¾",normalizedTitle:"java agent æ¡ä¾",charIndex:11694},{level:4,title:"å è½½ Java å­èç ä¹åæ¦æª",slug:"å è½½-java-å­èç ä¹åæ¦æª",normalizedTitle:"å è½½ java å­èç ä¹åæ¦æª",charIndex:10210},{level:5,title:"App é¡¹ç®",slug:"app-é¡¹ç®",normalizedTitle:"app é¡¹ç®",charIndex:11730},{level:5,title:"Agent é¡¹ç®",slug:"agent-é¡¹ç®",normalizedTitle:"agent é¡¹ç®",charIndex:12975},{level:4,title:"è¿è¡æ¶æ¦æªï¼JDK 1.6 åä»¥ä¸ï¼",slug:"è¿è¡æ¶æ¦æª-jdk-1-6-åä»¥ä¸",normalizedTitle:"è¿è¡æ¶æ¦æªï¼jdk 1.6 åä»¥ä¸ï¼",charIndex:17800},{level:2,title:"å­èç å·¥å·",slug:"å­èç å·¥å·",normalizedTitle:"å­èç å·¥å·",charIndex:19725},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:20115}],headersStr:"å­èç ç®ä» ä»ä¹æ¯å­èç  åç¼è¯å­èç æä»¶ å­èç æä»¶ç»æ é­æ° çæ¬å· å¸¸éæ±  è®¿é®æ å¿ ç±»ç´¢å¼ãç¶ç±»ç´¢å¼ãæ¥å£ç´¢å¼ å­æ®µè¡¨ æ¹æ³è¡¨ å±æ§è¡¨éå å­èç æä»¤ å­èç å¢å¼º Asm Javassist è¿è¡æ¶ç±»çéè½½ Instrument JavaAgent Java Agent ææ¯ç®ä» Java Agent åè½ä»ç» Java Agent å®ç°åç Java Agent æ¡ä¾ å è½½ Java å­èç ä¹åæ¦æª App é¡¹ç® Agent é¡¹ç® è¿è¡æ¶æ¦æªï¼JDK 1.6 åä»¥ä¸ï¼ å­èç å·¥å· åèèµæ",content:'# Java å­èç \n\n\n# å­èç ç®ä»\n\n\n# ä»ä¹æ¯å­èç \n\nJava å­èç æ¯ Java èææºæ§è¡çä¸ç§æä»¤æ ¼å¼ãä¹æä»¥è¢«ç§°ä¹ä¸ºå­èç ï¼æ¯å ä¸ºï¼Java å­èç æä»¶ï¼.classï¼æ¯ä¸ç§ä»¥ 8 ä½å­èä¸ºåºç¡åä½çäºè¿å¶æµæä»¶ï¼åä¸ªæ°æ®é¡¹ä¸¥æ ¼æç§é¡ºåºç´§åå°æåå¨ .class æä»¶ä¸­ï¼ä¸­é´æ²¡ææ·»å ä»»ä½åéç¬¦ãæ´ä¸ª .class æä»¶æ¬è´¨ä¸å°±æ¯ä¸å¼ è¡¨ã\n\nJava è½åå° âä¸æ¬¡ç¼è¯ï¼å°å¤è¿è¡âï¼ä¸æ¯å ä¸º JVM éå¯¹åç§æä½ç³»ç»ãå¹³å°é½è¿è¡äºå®å¶ï¼äºæ¯å ä¸ºæ è®ºå¨ä»ä¹å¹³å°ï¼é½å¯ä»¥ç¼è¯çæåºå®æ ¼å¼ç Java å­èç æä»¶ï¼.classï¼ã\n\n\n\n\n# åç¼è¯å­èç æä»¶\n\næä»¬éè¿ä¸ä¸ªç¤ºä¾æ¥è®²è§£å¦ä½åç¼è¯å­èç æä»¶ã\n\nï¼1ï¼é¦åï¼åå»ºä¸ä¸ª Demo.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\npublic class Demo {\n\n    public static void main(String[] args) {\n        System.out.println("hello world");\n    }\n\n}\n\n\nï¼2ï¼æ§è¡ javac Demo.javaï¼ç¼è¯ Demo.java æä»¶ï¼å¨å½åè·¯å¾ä¸çæä¸ä¸ª Demo.class æä»¶ã\n\næä»¶åå®¹å¦ä¸ï¼æ¯ä¸å  16 è¿å¶æ°ï¼\n\nca fe ba be 20 20 20 34 20 1d 0a 20 06 20 0f 09 20 10 20 11 08 20 12 0a 20 13 20 14 07 20 15 07 20 16 01 20 06 3c 69 6e 69 74 3e 01 20 03 28 29 56 01 20 04 43 6f 64 65 01 20 0f 4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 01 20 04 6d 61 69 6e 01 20 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 01 20 0a 53 6f 75 72 63 65 46 69 6c 65 01 20 09 44 65 6d 6f 2e 6a 61 76 61 0c 20 07 20 08 07 20 17 0c 20 18 20 19 01 20 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 07 20 1a 0c 20 1b 20 1c 01 20 26 69 6f 2f 67 69 74 68 75 62 2f 64 75 6e 77 75 2f 6a 61 76 61 63 6f 72 65 2f 62 79 74 65 63 6f 64 65 2f 44 65 6d 6f 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 20 03 6f 75 74 01 20 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b 01 20 13 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 01 20 07 70 72 69 6e 74 6c 6e 01 20 15 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 20 21 20 05 20 06 20 20 20 20 20 02 20 01 20 07 20 08 20 01 20 09 20 20 20 1d 20 01 20 01 20 20 20 05 2a b7 20 01 b1 20 20 20 01 20 0a 20 20 20 06 20 01 20 20 20 03 20 09 20 0b 20 0c 20 01 20 09 20 20 20 25 20 02 20 01 20 20 20 09 b2 20 02 12 03 b6 20 04 b1 20 20 20 01 20 0a 20 20 20 0a 20 02 20 20 20 06 20 08 20 07 20 01 20 0d 20 20 20 02 20 0e\n\n\nåé¢å·²ç»æè¿ï¼Java å­èç æä»¶ï¼.classï¼æ¯ä¸ç§ä»¥ 8 ä½å­èä¸ºåºç¡åä½çäºè¿å¶æµæä»¶ï¼åä¸ªæ°æ®é¡¹ä¸¥æ ¼æç§é¡ºåºç´§åå°æåå¨ .class æä»¶ä¸­ï¼ä¸­é´æ²¡ææ·»å ä»»ä½åéç¬¦ã\n\nï¼3ï¼ä½¿ç¨å° Java åç½®çåç¼è¯å·¥å· javap å¯ä»¥åç¼è¯å­èç æä»¶ã\n\næ§è¡ javap -verbose -p Demo.classï¼æ§å¶å°ä¼è¾åºç¸å¯¹èè¨ï¼å¯ä»¥çè§£çæä»¤ãè¾åºåå®¹å¤§è´å¦ä¸ï¼\n\nClassfile /D:/Workspace/Demo.class\n  Last modified 2023-4-20; size 447 bytes\n  MD5 checksum 0baafe4215fe2bd2e51b48d51fe563a3\n  Compiled from "Demo.java"\npublic class io.github.dunwu.javacore.bytecode.Demo\n  minor version: 0\n  major version: 52\n  flags: ACC_PUBLIC, ACC_SUPER\nConstant pool:\n   #1 = Methodref          #6.#15         // java/lang/Object."<init>":()V\n   #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;\n   #3 = String             #18            // hello world\n   #4 = Methodref          #19.#20        // java/io/PrintStream.println:(Ljava/lang/String;)V\n   #5 = Class              #21            // io/github/dunwu/javacore/bytecode/Demo\n   #6 = Class              #22            // java/lang/Object\n   #7 = Utf8               <init>\n   #8 = Utf8               ()V\n   #9 = Utf8               Code\n  #10 = Utf8               LineNumberTable\n  #11 = Utf8               main\n  #12 = Utf8               ([Ljava/lang/String;)V\n  #13 = Utf8               SourceFile\n  #14 = Utf8               Demo.java\n  #15 = NameAndType        #7:#8          // "<init>":()V\n  #16 = Class              #23            // java/lang/System\n  #17 = NameAndType        #24:#25        // out:Ljava/io/PrintStream;\n  #18 = Utf8               hello world\n  #19 = Class              #26            // java/io/PrintStream\n  #20 = NameAndType        #27:#28        // println:(Ljava/lang/String;)V\n  #21 = Utf8               io/github/dunwu/javacore/bytecode/Demo\n  #22 = Utf8               java/lang/Object\n  #23 = Utf8               java/lang/System\n  #24 = Utf8               out\n  #25 = Utf8               Ljava/io/PrintStream;\n  #26 = Utf8               java/io/PrintStream\n  #27 = Utf8               println\n  #28 = Utf8               (Ljava/lang/String;)V\n{\n  public io.github.dunwu.javacore.bytecode.Demo();\n    descriptor: ()V\n    flags: ACC_PUBLIC\n    Code:\n      stack=1, locals=1, args_size=1\n         0: aload_0\n         1: invokespecial #1                  // Method java/lang/Object."<init>":()V\n         4: return\n      LineNumberTable:\n        line 3: 0\n\n  public static void main(java.lang.String[]);\n    descriptor: ([Ljava/lang/String;)V\n    flags: ACC_PUBLIC, ACC_STATIC\n    Code:\n      stack=2, locals=1, args_size=1\n         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;\n         3: ldc           #3                  // String hello world\n         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V\n         8: return\n      LineNumberTable:\n        line 6: 0\n        line 7: 8\n}\nSourceFile: "Demo.java"\n\n\n> æç¤ºï¼éè¿ javap -help å¯äºè§£ javap çåºæ¬ç¨æ³ã\n> \n> ç¨æ³: javap <options> <classes>\n> å¶ä¸­, å¯è½çéé¡¹åæ¬:\n>   -help  --help  -?        è¾åºæ­¤ç¨æ³æ¶æ¯\n>   -version                 çæ¬ä¿¡æ¯\n>     -v  -verbose             è¾åºéå ä¿¡æ¯\n>     -l                       è¾åºè¡å·åæ¬å°åéè¡¨\n>     -public                  ä»æ¾ç¤ºå¬å±ç±»åæå\n>     -protected               æ¾ç¤ºåä¿æ¤ç/å¬å±ç±»åæå\n>     -package                 æ¾ç¤ºç¨åºå/åä¿æ¤ç/å¬å±ç±»\n>                              åæå (é»è®¤)\n>     -p  -private             æ¾ç¤ºææç±»åæå\n>      -c                       å¯¹ä»£ç è¿è¡åæ±ç¼\n>     -s                       è¾åºåé¨ç±»åç­¾å\n>     -sysinfo                 æ¾ç¤ºæ­£å¨å¤ççç±»ç\n>                              ç³»ç»ä¿¡æ¯ (è·¯å¾, å¤§å°, æ¥æ, MD5 æ£å)\n>     -constants               æ¾ç¤ºæç»å¸¸é\n>      -classpath <path>        æå®æ¥æ¾ç¨æ·ç±»æä»¶çä½ç½®\n>     -cp <path>               æå®æ¥æ¾ç¨æ·ç±»æä»¶çä½ç½®\n>     -bootclasspath <path>    è¦çå¼å¯¼ç±»æä»¶çä½ç½®\n\n\n# å­èç æä»¶ç»æ\n\nå­èç çä¼¼æä¹±æ åºï¼å®éä¸æ¯ç±ä¸¥æ ¼çæ ¼å¼è¦æ±ç»æçã\n\n\n\n# é­æ°\n\næ¯ä¸ª .class æä»¶çå¤´ 4 ä¸ªå­èç§°ä¸º é­æ°ï¼magic_numberï¼ï¼å®çå¯ä¸ä½ç¨æ¯ç¡®å®è¿ä¸ªæä»¶æ¯å¦ä¸ºä¸ä¸ªè½è¢«èææºæ¥æ¶ç .class æä»¶ãé­æ°çåºå®å¼ä¸ºï¼0xCAFEBABEã\n\n# çæ¬å·\n\nçæ¬å·ï¼versionï¼æ 4 ä¸ªå­èï¼åä¸¤ä¸ªå­èè¡¨ç¤ºæ¬¡çæ¬å·ï¼Minor Versionï¼ï¼åä¸¤ä¸ªå­èè¡¨ç¤ºä¸»çæ¬å·ï¼Major Versionï¼ã\n\nä¸¾ä¾æ¥è¯´ï¼å¦æçæ¬å·ä¸ºï¼â00 00 00 34âãé£ä¹ï¼æ¬¡çæ¬å·è½¬åä¸ºåè¿å¶ä¸º 0ï¼ä¸»çæ¬å·è½¬åä¸ºåè¿å¶ä¸º 52ï¼å¨ Oracle å®ç½ä¸­æ¥è¯¢åºå· 52 å¯¹åºçä¸»çæ¬å·ä¸º 1.8ï¼æä»¥ç¼è¯è¯¥æä»¶ç Java çæ¬å·ä¸º 1.8.0ã\n\n# å¸¸éæ± \n\nç´§æ¥çä¸»çæ¬å·ä¹åçå­èä¸ºå¸¸éæ± ï¼constant_poolï¼ï¼å¸¸éæ± å¯ä»¥çè§£ä¸º .class æä»¶ä¸­çèµæºä»åºã\n\nå¸¸éæ± æ´ä½ä¸åä¸ºä¸¤é¨åï¼å¸¸éæ± è®¡æ°å¨ä»¥åå¸¸éæ± æ°æ®åº\n\n * å¸¸éæ± è®¡æ°å¨ï¼constant_pool_countï¼ - ç±äºå¸¸éçæ°éä¸åºå®ï¼æä»¥éè¦åæ¾ç½®ä¸¤ä¸ªå­èæ¥è¡¨ç¤ºå¸¸éæ± å®¹éè®¡æ°å¼ã\n\n * å¸¸éæ± æ°æ®åº - æ°æ®åºçæ¯ä¸é¡¹å¸¸éé½æ¯ä¸ä¸ªè¡¨ï¼ä¸ç»æåä¸ç¸åã\n\nå¸¸éæ± ä¸»è¦å­æ¾ä¸¤ç±»å¸¸éï¼\n\n * å­é¢é - å¦ææ¬å­ç¬¦ä¸²ãå£°æä¸º final çå¸¸éå¼ã\n * ç¬¦å·å¼ç¨\n   * ç±»åæ¥å£çå¨éå®å\n   * å­æ®µçåç§°åæè¿°ç¬¦\n   * æ¹æ³çåç§°åæè¿°ç¬¦\n\n# è®¿é®æ å¿\n\nç´§æ¥çå¸¸éæ± ç 2 ä¸ªå­èä»£è¡¨è®¿é®æ å¿ï¼access_flagsï¼ï¼è¿ä¸ªæ å¿ç¨äºè¯å«ä¸äºç±»æèæ¥å£çè®¿é®ä¿¡æ¯ï¼æè¿°è¯¥ Class æ¯ç±»è¿æ¯æ¥å£ï¼ä»¥åæ¯å¦è¢« publicãabstractãfinal ç­ä¿®é¥°ç¬¦ä¿®é¥°ã\n\nè®¿é®æ å¿æä»¥ä¸ç±»åï¼\n\næ å¿åç§°             æ å¿å¼      å«ä¹\nACC_PUBLIC       0x0001   æ¯å¦ä¸º Public ç±»å\nACC_FINAL        0x0010   æ¯å¦è¢«å£°æä¸º finalï¼åªæç±»å¯ä»¥è®¾ç½®\nACC_SUPER        0x0020   æ¯å¦åè®¸ä½¿ç¨ invokespecial å­èç æä»¤çæ°è¯­ä¹ï¼\nACC_INTERFACE    0x0200   æ å¿è¿æ¯ä¸ä¸ªæ¥å£\nACC_ABSTRACT     0x0400   æ¯å¦ä¸º abstract ç±»åï¼å¯¹äºæ¥å£æèæ½è±¡ç±»æ¥è¯´ï¼ æ¬¡æ å¿å¼ä¸ºçï¼å¶ä»ç±»åä¸ºå\nACC_SYNTHETIC    0x1000   æ å¿è¿ä¸ªç±»å¹¶éç±ç¨æ·ä»£ç äº§ç\nACC_ANNOTATION   0x2000   æ å¿è¿æ¯ä¸ä¸ªæ³¨è§£\nACC_ENUM         0x4000   æ å¿è¿æ¯ä¸ä¸ªæä¸¾\n\n# ç±»ç´¢å¼ãç¶ç±»ç´¢å¼ãæ¥å£ç´¢å¼\n\nç±»ç´¢å¼ï¼this_classï¼åç¶ç±»ç´¢å¼é½æ¯ä¸ä¸ª u2 ç±»åçæ°æ®ï¼èæ¥å£ç´¢å¼éåæ¯ä¸ç» u2 ç±»åçæ°æ®çéåã.class æä»¶ä¸­ç±è¿ 3 é¡¹æ°æ®æ¥ç¡®å®è¿ä¸ªç±»çç»§æ¿å³ç³»ã\n\n# å­æ®µè¡¨\n\nå­æ®µè¡¨ç¨äºæè¿°ç±»åæ¥å£ä¸­å£°æçåéãåå«ç±»çº§åéä»¥åå®ä¾çº§åéï¼ä½æ¯ä¸åå«æ¹æ³åé¨å£°æçå±é¨åéã\n\nå­æ®µè¡¨ä¹åä¸ºä¸¤é¨åï¼ç¬¬ä¸é¨åä¸ºä¸¤ä¸ªå­èï¼æè¿°å­æ®µä¸ªæ°ï¼ç¬¬äºé¨åæ¯æ¯ä¸ªå­æ®µçè¯¦ç»ä¿¡æ¯ fields_infoã\n\n# æ¹æ³è¡¨\n\nå­æ®µè¡¨ç»æåä¸ºæ¹æ³è¡¨ï¼æ¹æ³è¡¨çç»æå¦åå­æ®µè¡¨ä¸æ ·ï¼ä¾æ¬¡åæ¬äºè®¿é®æ å¿ãåç§°ç´¢å¼ãæè¿°ç¬¦ç´¢å¼ãå±æ§è¡¨éåå é¡¹ã\n\n# å±æ§è¡¨éå\n\nå±æ§è¡¨éåå­æ¾äºå¨è¯¥æä»¶ä¸­ç±»ææ¥å£æå®ä¹å±æ§çåºæ¬ä¿¡æ¯ã\n\n\n# å­èç æä»¤\n\nå­èç æä»¤ç±ä¸ä¸ªå­èé¿åº¦çãä»£è¡¨çæç§ç¹å®æä½å«ä¹çæ°å­ï¼ç§°ä¸ºæä½ç ï¼Opcodeï¼ä»¥åè·éå¶åçé¶å°å¤ä¸ªä»£è¡¨æ­¤æä½æéåæ°ï¼Operandsï¼èææãç±äº JVM éç¨é¢åæä½æ°æ æ¶æèä¸æ¯å¯å­å¨æ¶æï¼æä»¥å¤§å¤æ°çæä»¤é½ä¸åæ¬æä½æ°ï¼åªæä¸ä¸ªæä½ç ã\n\nJVM æä½ç çé¿åº¦ä¸º 1 ä¸ªå­èï¼å æ­¤æä»¤éçæä½ç æå¤åªæ 256 ä¸ªã\n\nå­èç æä½å¤§è´åä¸º 9 ç±»ï¼\n\n * å è½½åå­å¨æä»¤\n * è¿ç®æä»¤\n * ç±»åè½¬æ¢æä»¤\n * å¯¹è±¡åå»ºä¸è®¿é®æä»¤\n * æä½æ°æ ç®¡çæä»¤\n * æ§å¶è½¬ç§»æä»¤\n * æ¹æ³è°ç¨åè¿åæä»¤\n * å¼å¸¸å¤çæä»¤\n * åæ­¥æä»¤\n\n\n# å­èç å¢å¼º\n\nå­èç å¢å¼ºææ¯å°±æ¯ä¸ç±»å¯¹ç°æå­èç è¿è¡ä¿®æ¹æèå¨æçæå¨æ°å­èç æä»¶çææ¯ã\n\nå¸¸è§çå­èç å¢å¼ºæ¡æ¶æï¼\n\n * asm -\n * javassist - Javassist çæ¯éè¿æ§å¶åºå±å­èç æ¥å®ç°å¨æä»£çï¼ä¸éè¦åå°å®æè°ç¨ï¼æä»¥æ§è½è¯å®æ¯ JDK çå¨æä»£çæ¹å¼æ§è½è¦å¥½ã\n * Byte Buddy - Byte Buddy åå±äºåèµ·ä¹ç§ï¼å¨å¾å¤ä¼ç§çé¡¹ç®ä¸­ï¼å SpringãJackson é½ç¨å°äº Byte Buddy æ¥å®æåºå±ä»£çãç¸æ¯ Javassistï¼Byte Buddy æä¾äºæ´å®¹ææä½ç APIï¼ç¼åçä»£ç å¯è¯»æ§æ´é«ãæ´éè¦çæ¯ï¼çæçä»£çç±»æ§è¡éåº¦æ¯ Javassist æ´å¿«ã\n\n\n# Asm\n\nå¯¹äºéè¦æå¨æçºµå­èç çéæ±ï¼å¯ä»¥ä½¿ç¨ Asmï¼å®å¯ä»¥ç´æ¥çäº§ .classå­èç æä»¶ï¼ä¹å¯ä»¥å¨ç±»è¢«å è½½å¥ JVM ä¹åå¨æä¿®æ¹ç±»è¡ä¸ºã\n\nAsm çåºç¨åºæ¯æ AOPï¼Cglib å°±æ¯åºäº Asmï¼ãç­é¨ç½²ãä¿®æ¹å¶ä» jar åä¸­çç±»ç­ãå½ç¶ï¼æ¶åå°å¦æ­¤åºå±çæ­¥éª¤ï¼å®ç°èµ·æ¥ä¹æ¯è¾éº»ç¦ã\n\nAsm æä¸¤ç±» APIï¼æ ¸å¿ API åæ å½¢ API\n\n * æ ¸å¿ API - Asm Core API å¯ä»¥ç±»æ¯è§£æ XML æä»¶ä¸­ç SAX æ¹å¼ï¼ä¸éè¦æè¿ä¸ªç±»çæ´ä¸ªç»æè¯»åè¿æ¥ï¼å°±å¯ä»¥ç¨æµå¼çæ¹æ³æ¥å¤çå­èç æä»¶ãå¥½å¤æ¯éå¸¸èçº¦åå­ï¼ä½æ¯ç¼ç¨é¾åº¦è¾å¤§ãç¶èåºäºæ§è½èèï¼ä¸è¬æåµä¸ç¼ç¨é½ä½¿ç¨ Core APIãå¨ Core API ä¸­æä»¥ä¸å ä¸ªå³é®ç±»ï¼\n   * ClassReader - ç¨äºè¯»åå·²ç»ç¼è¯å¥½ç .class æä»¶ã\n   * ClassWriter - ç¨äºéæ°æå»ºç¼è¯åçç±»ï¼å¦ä¿®æ¹ç±»åãå±æ§ä»¥åæ¹æ³ï¼ä¹å¯ä»¥çææ°çç±»çå­èç æä»¶ã\n   * åç§ Visitor ç±» - CoreAPI æ ¹æ®å­èç ä»ä¸å°ä¸ä¾æ¬¡å¤çï¼å¯¹äºå­èç æä»¶ä¸­ä¸åçåºåæä¸åç Visitorï¼æ¯å¦ç¨äºè®¿é®æ¹æ³ç MethodVisitorãç¨äºè®¿é®ç±»åéç FieldVisitorãç¨äºè®¿é®æ³¨è§£ç AnnotationVisitor ç­ãä¸ºäºå®ç° AOPï¼éç¹è¦ä½¿ç¨çæ¯ MethodVisitorã\n * æ å½¢ API - Asm Tree API å¯ä»¥ç±»æ¯è§£æ XML æä»¶ä¸­ç DOM æ¹å¼ï¼ææ´ä¸ªç±»çç»æè¯»åå°åå­ä¸­ï¼ç¼ºç¹æ¯æ¶èåå­å¤ï¼ä½æ¯ç¼ç¨æ¯è¾ç®åãTreeApi ä¸åäº CoreAPIï¼TreeAPI éè¿åç§ Node ç±»æ¥æ å°å­èç çåä¸ªåºåï¼ç±»æ¯ DOM èç¹ï¼å°±å¯ä»¥å¾å¥½å°çè§£è¿ç§ç¼ç¨æ¹å¼ã\n\n\n# Javassist\n\nå©ç¨ Javassist å®ç°å­èç å¢å¼ºæ¶ï¼å¯ä»¥æ é¡»å³æ³¨å­èç å»æ¿çç»æï¼å¶ä¼ç¹å°±å¨äºç¼ç¨ç®åãç´æ¥ä½¿ç¨ java ç¼ç çå½¢å¼ï¼èä¸éè¦äºè§£èææºæä»¤ï¼å°±è½å¨ææ¹åç±»çç»ææèå¨æçæç±»ã\n\nå¶æ ¸å¿ç±»å¦ä¸ï¼\n\n * CtClassï¼compile-time classï¼ - ç¼è¯æ¶ç±»ä¿¡æ¯ãå®æ¯ä¸ä¸ª class æä»¶å¨ä»£ç ä¸­çæ½è±¡ï¼å¯ä»¥éè¿ä¸ä¸ªç±»çå¨éå®åæ¥è·åä¸ä¸ª CtClass å¯¹è±¡ï¼ç¨æ¥è¡¨ç¤ºè¿ä¸ªç±»æä»¶ã\n * ClassPool - ClassPool å¯ä»¥çæä¸å¼ ä¿å­ CtClass ä¿¡æ¯ç HashTableï¼key ä¸ºç±»åï¼value ä¸ºç±»åå¯¹åºç CtClass å¯¹è±¡ãå½æä»¬éè¦å¯¹æä¸ªç±»è¿è¡ä¿®æ¹æ¶ï¼å°±æ¯éè¿ pool.getCtClass("className") æ¹æ³ä» pool ä¸­è·åå°ç¸åºç CtClassã\n * CtMethodãCtField - å¯¹åºçæ¯ç±»ä¸­çæ¹æ³åå±æ§ã\n\n\n# è¿è¡æ¶ç±»çéè½½\n\n\n# Instrument\n\ninstrument æ¯ JVM æä¾çä¸ä¸ªå¯ä»¥ä¿®æ¹å·²å è½½ç±»çç±»åºï¼ä¸é¨ä¸º Java è¯­è¨ç¼åçææ¡©æå¡æä¾æ¯æãå®éè¦ä¾èµ JVMTI ç Attach API æºå¶å®ç°ãå¨ JDK 1.6 ä»¥åï¼instrument åªè½å¨ JVM åå¯å¨å¼å§å è½½ç±»æ¶çæï¼èå¨ JDK 1.6 ä¹åï¼instrument æ¯æäºå¨è¿è¡æ¶å¯¹ç±»å®ä¹çä¿®æ¹ãè¦ä½¿ç¨ instrument çç±»ä¿®æ¹åè½ï¼æä»¬éè¦å®ç°å®æä¾ç ClassFileTransformer æ¥å£ï¼å®ä¹ä¸ä¸ªç±»æä»¶è½¬æ¢å¨ãæ¥å£ä¸­ç transform()æ¹æ³ä¼å¨ç±»æä»¶è¢«å è½½æ¶è°ç¨ï¼èå¨ transform æ¹æ³éï¼å¯ä»¥å©ç¨ ASM æ Javassist å¯¹ä¼ å¥çå­èç è¿è¡æ¹åææ¿æ¢ï¼çææ°çå­èç æ°ç»åè¿åã\n\n\n# JavaAgent\n\nJavaagent æ¯ä»ä¹ï¼\n\nJavaagent æ¯ java å½ä»¤çä¸ä¸ªåæ°ãåæ° javaagent å¯ä»¥ç¨äºæå®ä¸ä¸ª jar åï¼å®å©ç¨ JVM æä¾ç Instrumentation API æ¥æ´æ¹å è½½ JVM ä¸­çç°æå­èç ã\n\n 1. è¿ä¸ª jar åç MANIFEST.MF æä»¶å¿é¡»æå® Premain-Class é¡¹ã\n 2. Premain-Class æå®çé£ä¸ªç±»å¿é¡»å®ç° premain() æ¹æ³ã\n\npremain æ¹æ³ï¼ä»å­é¢ä¸çè§£ï¼å°±æ¯è¿è¡å¨ main å½æ°ä¹åççç±»ãå½ Java èææºå¯å¨æ¶ï¼å¨æ§è¡ main å½æ°ä¹åï¼JVM ä¼åè¿è¡-javaagentææå® jar åå Premain-Class è¿ä¸ªç±»ç premain æ¹æ³ ã\n\nå¨å½ä»¤è¡è¾å¥ javaå¯ä»¥çå°ç¸åºçåæ°ï¼å¶ä¸­æ å java agent ç¸å³çï¼\n\n-agentlib:<libname>[=<éé¡¹>]\n\t\t\t  å è½½æ¬æºä»£çåº <libname>, ä¾å¦ -agentlib:hprof\n\t\t\t  å¦è¯·åé -agentlib:jdwp=help å -agentlib:hprof=help\n-agentpath:<pathname>[=<éé¡¹>]\n\t\t\t  æå®æ´è·¯å¾åå è½½æ¬æºä»£çåº\n-javaagent:<jarpath>[=<éé¡¹>]\n\t\t\t  å è½½ Java ç¼ç¨è¯­è¨ä»£ç, è¯·åé java.lang.instrument\n\n\n\n# Java Agent ææ¯ç®ä»\n\nJava Agent ç´è¯ä¸º Java ä»£çï¼ä¹å¸¸å¸¸è¢«ç§°ä¸º Java æ¢éææ¯ã\n\nJava Agent æ¯å¨ JDK1.5 å¼å¥çï¼æ¯ä¸ç§å¯ä»¥å¨æä¿®æ¹ Java å­èç çææ¯ãJava ä¸­çç±»ç¼è¯åå½¢æå­èç è¢« JVM æ§è¡ï¼å¨ JVM å¨æ§è¡è¿äºå­èç ä¹åè·åè¿äºå­èç çä¿¡æ¯ï¼å¹¶ä¸éè¿å­èç è½¬æ¢å¨å¯¹è¿äºå­èç è¿è¡ä¿®æ¹ï¼ä»¥æ­¤æ¥å®æä¸äºé¢å¤çåè½ã\n\nJava Agent æ¯ä¸ä¸ªä¸è½ç¬ç«è¿è¡ jar åï¼å®éè¿ä¾éäºç®æ ç¨åºç JVM è¿ç¨ï¼è¿è¡å·¥ä½ãå¯å¨æ¶åªéè¦å¨ç®æ ç¨åºçå¯å¨åæ°ä¸­æ·»å -javaagent åæ°æ·»å  ClassFileTransformer å­èç è½¬æ¢å¨ï¼ç¸å½äºå¨ main æ¹æ³åå äºä¸ä¸ªæ¦æªå¨ã\n\n\n# Java Agent åè½ä»ç»\n\nJava Agent ä¸»è¦æä»¥ä¸åè½\n\n * Java Agent è½å¤å¨å è½½ Java å­èç ä¹åæ¦æªå¹¶å¯¹å­èç è¿è¡ä¿®æ¹;\n * Java Agent è½å¤å¨ Jvm è¿è¡æé´ä¿®æ¹å·²ç»å è½½çå­èç ;\n\nJava Agent çåºç¨åºæ¯\n\n * IDE çè°è¯åè½ï¼ä¾å¦ EclipseãIntelliJ IDEA ï¼\n * ç­é¨ç½²åè½ï¼ä¾å¦ JRebelãXRebelãspring-loadedï¼\n * åç§çº¿ä¸è¯æ­å·¥å·ï¼ä¾å¦ BtraceãGreysï¼è¿æé¿éç Arthasï¼\n * åç§æ§è½åæå·¥å·ï¼ä¾å¦ Visual VMãJConsole ç­ï¼\n * å¨é¾è·¯æ§è½æ£æµå·¥å·ï¼ä¾å¦ SkywalkingãPinpoint ç­ï¼\n\n\n# Java Agent å®ç°åç\n\nå¨äºè§£ Java Agent çå®ç°åçä¹åï¼éè¦å¯¹ Java ç±»å è½½æºå¶æä¸ä¸ªè¾ä¸ºæ¸æ°çè®¤ç¥ãä¸ç§æ¯å¨ man æ¹æ³æ§è¡ä¹åï¼éè¿ premain æ¥æ§è¡ï¼å¦ä¸ç§æ¯ç¨åºè¿è¡ä¸­ä¿®æ¹ï¼ééè¿ JVM ä¸­ç Attach å®ç°ï¼Attach çå®ç°åçæ¯åºäº JVMTIã\n\nä¸»è¦æ¯å¨ç±»å è½½ä¹åï¼è¿è¡æ¦æªï¼å¯¹å­èç ä¿®æ¹\n\nä¸é¢æä»¬åå«ä»ç»ä¸ä¸è¿äºå³é®æ¯è¯­ï¼\n\n * JVMTI å°±æ¯ JVM Tool Interfaceï¼æ¯ JVM æ´é²åºæ¥ç»ç¨æ·æ©å±ä½¿ç¨çæ¥å£éåï¼JVMTI æ¯åºäºäºä»¶é©±å¨çï¼JVM æ¯æ§è¡ä¸å®çé»è¾å°±ä¼è§¦åä¸äºäºä»¶çåè°æ¥å£ï¼éè¿è¿äºåè°æ¥å£ï¼ç¨æ·å¯ä»¥èªè¡æ©å±\n   \n   JVMTI æ¯å®ç° DebuggerãProfilerãMonitorãThread Analyser ç­å·¥å·çç»ä¸åºç¡ï¼å¨ä¸»æµ Java èææºä¸­é½æå®ç°\n\n * JVMTIAgentæ¯ä¸ä¸ªå¨æåºï¼å©ç¨ JVMTI æ´é²åºæ¥çä¸äºæ¥å£æ¥å¹²ä¸äºæä»¬æ³åãä½æ¯æ­£å¸¸æåµä¸ååä¸å°çäºæï¼ä¸è¿ä¸ºäºåæ®éçå¨æåºè¿è¡åºåï¼å®ä¸è¬ä¼å®ç°å¦ä¸çä¸ä¸ªæèå¤ä¸ªå½æ°ï¼\n   \n   * Agent_OnLoad å½æ°ï¼å¦æ agent æ¯å¨å¯å¨æ¶å è½½çï¼éè¿ JVM åæ°è®¾ç½®\n   * Agent_OnAttach å½æ°ï¼å¦æ agent ä¸æ¯å¨å¯å¨æ¶å è½½çï¼èæ¯æä»¬å attach å°ç®æ è¿ç¨ä¸ï¼ç¶åç»å¯¹åºçç®æ è¿ç¨åé load å½ä»¤æ¥å è½½ï¼åå¨å è½½è¿ç¨ä¸­ä¼è°ç¨ Agent_OnAttach å½æ°\n   * Agent_OnUnload å½æ°ï¼å¨ agent å¸è½½æ¶è°ç¨\n\n * javaagent ä¾èµäº instrument ç JVMTIAgentï¼Linux ä¸å¯¹åºçå¨æåºæ¯ libinstrument.soï¼ï¼è¿æä¸ªå«åå« JPLISAgent(Java Programming Language Instrumentation Services Agent)ï¼ä¸é¨ä¸º Java è¯­è¨ç¼åçææ¡©æå¡æä¾æ¯æç\n\n * instrument å®ç°äº Agent_OnLoad å Agent_OnAttach ä¸¤æ¹æ³ï¼ä¹å°±æ¯è¯´å¨ä½¿ç¨æ¶ï¼agent æ¢å¯ä»¥å¨å¯å¨æ¶å è½½ï¼ä¹å¯ä»¥å¨è¿è¡æ¶å¨æå è½½ãå¶ä¸­å¯å¨æ¶å è½½è¿å¯ä»¥éè¿ç±»ä¼¼-javaagent:jar åè·¯å¾çæ¹å¼æ¥é´æ¥å è½½ instrument agentï¼è¿è¡æ¶å¨æå è½½ä¾èµçæ¯ JVM ç attach æºå¶ï¼éè¿åé load å½ä»¤æ¥å è½½ agent\n\n * JVM Attach æ¯æ JVM æä¾çä¸ç§è¿ç¨é´éä¿¡çåè½ï¼è½è®©ä¸ä¸ªè¿ç¨ä¼ å½ä»¤ç»å¦ä¸ä¸ªè¿ç¨ï¼å¹¶è¿è¡ä¸äºåé¨çæä½ï¼æ¯å¦è¿è¡çº¿ç¨ dumpï¼é£ä¹å°±éè¦æ§è¡ jstack è¿è¡ï¼ç¶åæ pid ç­åæ°ä¼ éç»éè¦ dump ççº¿ç¨æ¥æ§è¡\n\n\n# Java Agent æ¡ä¾\n\n# å è½½ Java å­èç ä¹åæ¦æª\n\n# App é¡¹ç®\n\nï¼1ï¼åå»ºä¸ä¸ªåä¸º javacore-javaagent-app ç maven å·¥ç¨\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0"\n  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n  <modelVersion>4.0.0</modelVersion>\n\n  <groupId>io.github.dunwu.javacore</groupId>\n  <artifactId>javacore-javaagent-app</artifactId>\n  <version>1.0.1</version>\n  <name>JavaCore :: JavaAgent :: App</name>\n\n  <properties>\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    <java.version>1.8</java.version>\n    <maven.compiler.source>${java.version}</maven.compiler.source>\n    <maven.compiler.target>${java.version}</maven.compiler.target>\n  </properties>\n</project>\n\n\nï¼2ï¼åå»ºä¸ä¸ªåºç¨å¯å¨ç±»\n\npublic class AppMain {\n\n    public static void main(String[] args) {\n        System.out.println("APP å¯å¨ï¼ï¼ï¼");\n        AppInit.init();\n    }\n\n}\n\n\nï¼3ï¼åå»ºä¸ä¸ªæ¨¡æåºç¨åå§åçç±»\n\npublic class AppInit {\n\n    public static void init() {\n        try {\n            System.out.println("APPåå§åä¸­...");\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n}\n\n\nï¼4ï¼è¾åº\n\nAPP å¯å¨ï¼ï¼ï¼\nAPPåå§åä¸­...\n\n\n# Agent é¡¹ç®\n\nï¼1ï¼åå»ºä¸ä¸ªåä¸º javacore-javaagent-agent ç maven å·¥ç¨\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0"\n  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n  <modelVersion>4.0.0</modelVersion>\n\n  <groupId>io.github.dunwu.javacore</groupId>\n  <artifactId>javacore-javaagent-agent</artifactId>\n  <version>1.0.1</version>\n  <name>JavaCore :: JavaAgent :: Agent</name>\n\n  <properties>\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    <java.version>1.8</java.version>\n    <maven.compiler.source>${java.version}</maven.compiler.source>\n    <maven.compiler.target>${java.version}</maven.compiler.target>\n  </properties>\n\n  <dependencies>\n    \x3c!--javaagent å·¥å·å--\x3e\n    <dependency>\n      <groupId>org.javassist</groupId>\n      <artifactId>javassist</artifactId>\n      <version>3.26.0-GA</version>\n    </dependency>\n  </dependencies>\n\n  <build>\n    <plugins>\n      <plugin>\n        <groupId>org.apache.maven.plugins</groupId>\n        <artifactId>maven-compiler-plugin</artifactId>\n        <version>3.5.1</version>\n        \x3c!--æå® maven ç¼è¯ç jdk çæ¬ãè¥ä¸æå®ï¼maven3 é»è®¤ç¨ jdk 1.5ï¼maven2 é»è®¤ç¨ jdk1.3--\x3e\n        <configuration>\n          <source>8</source>\n          <target>8</target>\n        </configuration>\n      </plugin>\n\n      <plugin>\n        <groupId>org.apache.maven.plugins</groupId>\n        <artifactId>maven-jar-plugin</artifactId>\n        <version>3.2.0</version>\n        <configuration>\n          <archive>\n            \x3c!--èªå¨æ·»å META-INF/MANIFEST.MF --\x3e\n            <manifest>\n              <addClasspath>true</addClasspath>\n            </manifest>\n            <manifestEntries>\n              <Menifest-Version>1.0</Menifest-Version>\n              <Premain-Class>io.github.dunwu.javacore.javaagent.RunTimeAgent</Premain-Class>\n              <Can-Redefine-Classes>true</Can-Redefine-Classes>\n              <Can-Retransform-Classes>true</Can-Retransform-Classes>\n            </manifestEntries>\n          </archive>\n        </configuration>\n      </plugin>\n    </plugins>\n  </build>\n</project>\n\n\nï¼2ï¼åå»ºä¸ä¸ª Agent å¯å¨ç±»\n\npublic class RunTimeAgent {\n\n    public static void premain(String arg, Instrumentation instrumentation) {\n        System.out.println("æ¢éå¯å¨ï¼ï¼ï¼");\n        System.out.println("æ¢éä¼ å¥åæ°ï¼" + arg);\n        instrumentation.addTransformer(new RunTimeTransformer());\n    }\n}\n\n\nè¿éæ¯ä¸ªç±»å è½½çæ¶åé½ä¼èµ°è¿ä¸ªæ¹æ³ï¼æä»¬å¯ä»¥éè¿ className è¿è¡æå®ç±»çæ¦æªï¼ç¶ååå© javassist è¿ä¸ªå·¥å·ï¼è¿è¡å¯¹ Class çå¤çï¼è¿éçææ³ååå°ç±»ä¼¼ï¼ä½æ¯è¦æ¯åå°åè½æ´å å¼ºå¤§ï¼å¯ä»¥å¨æä¿®æ¹å­èç ã\n\nï¼3ï¼ä½¿ç¨ javassist æ¦æªæå®ç±»ï¼å¹¶è¿è¡ä»£ç å¢å¼º\n\npackage io.github.dunwu.javacore.javaagent;\n\nimport javassist.ClassPool;\nimport javassist.CtClass;\nimport javassist.CtMethod;\n\nimport java.lang.instrument.ClassFileTransformer;\nimport java.lang.instrument.IllegalClassFormatException;\nimport java.security.ProtectionDomain;\n\npublic class RunTimeTransformer implements ClassFileTransformer {\n\n    private static final String INJECTED_CLASS = "io.github.dunwu.javacore.javaagent.AppInit";\n\n    @Override\n    public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined,\n        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {\n        String realClassName = className.replace("/", ".");\n        if (realClassName.equals(INJECTED_CLASS)) {\n            System.out.println("æ¦æªå°çç±»åï¼" + realClassName);\n            CtClass ctClass;\n            try {\n                // ä½¿ç¨javassist,è·åå­èç ç±»\n                ClassPool classPool = ClassPool.getDefault();\n                ctClass = classPool.get(realClassName);\n\n                // å¾å°è¯¥ç±»ææçæ¹æ³å®ä¾ï¼ä¹å¯éæ©æ¹æ³ï¼è¿è¡å¢å¼º\n                CtMethod[] declaredMethods = ctClass.getDeclaredMethods();\n                for (CtMethod method : declaredMethods) {\n                    System.out.println(method.getName() + "æ¹æ³è¢«æ¦æª");\n                    method.addLocalVariable("time", CtClass.longType);\n                    method.insertBefore("System.out.println(\\"---å¼å§æ§è¡---\\");");\n                    method.insertBefore("time = System.currentTimeMillis();");\n                    method.insertAfter("System.out.println(\\"---ç»ææ§è¡---\\");");\n                    method.insertAfter("System.out.println(\\"è¿è¡èæ¶: \\" + (System.currentTimeMillis() - time));");\n                }\n                return ctClass.toBytecode();\n            } catch (Throwable e) { //è¿éè¦ç¨Throwableï¼ä¸è¦ç¨Exception\n                System.out.println(e.getMessage());\n                e.printStackTrace();\n            }\n        }\n        return classfileBuffer;\n    }\n\n}\n\n\nï¼4ï¼è¾åº\n\næå® VM åæ° -javaagent:F:\\code\\myCode\\agent-test\\runtime-agent\\target\\runtime-agent-1.0-SNAPSHOT.jar=helloï¼è¿è¡ AppMain\n\næ¢éå¯å¨ï¼ï¼ï¼\næ¢éä¼ å¥åæ°ï¼hello\nAPP å¯å¨ï¼ï¼ï¼\næ¦æªå°çç±»åï¼io.github.dunwu.javacore.javaagent.AppInit\ninitæ¹æ³è¢«æ¦æª\n---å¼å§æ§è¡---\nAPPåå§åä¸­...\n---ç»ææ§è¡---\nè¿è¡èæ¶: 1014\n\n\n# è¿è¡æ¶æ¦æªï¼JDK 1.6 åä»¥ä¸ï¼\n\nå¦ä½å®ç°å¨ç¨åºè¿è¡æ¶å»å®æå¨æä¿®æ¹å­èç å¢ï¼\n\nå¨æä¿®æ¹å­èç éè¦ä¾èµäº JDK ä¸ºæä»¬æä¾ç JVM å·¥å·ï¼ä¹å°±æ¯ä¸è¾¹æä»¬æå°ç Attachï¼éè¿å®å»å è½½æä»¬çä»£çç¨åºã\n\né¦åæä»¬å¨ä»£çç¨åºä¸­éè¦å®ä¹ä¸ä¸ªåå­ä¸º agentmain çæ¹æ³ï¼å®å¯ä»¥åä¸è¾¹æä»¬æå°ç premain æ¯ä¸æ ·çåå®¹ï¼ä¹å¯æ ¹æ® agentmain çç¹æ§è¿è¡èªå·±é»è¾çå¼åã\n\n/**\n * agentmain å¨ main å½æ°å¼å§è¿è¡åæå¯å¨ï¼ä¾èµäºAttachæºå¶ï¼\n */\npublic class RunTimeAgent {\n\n    public static void agentmain(String arg, Instrumentation instrumentation) {\n        System.out.println("agentmainæ¢éå¯å¨ï¼ï¼ï¼");\n        System.out.println("agentmainæ¢éä¼ å¥åæ°ï¼" + arg);\n        instrumentation.addTransformer(new RunTimeTransformer());\n    }\n}\n\n\nç¶åå°±æ¯æä»¬éè¦å°éç½®ä¸­è®¾ç½®ï¼è®©å¶ç¥éæä»¬çæ¢ééè¦å è½½è¿ä¸ªç±»ï¼å¨ maven ä¸­è®¾ç½®å¦ä¸ï¼å¦ææ¯ META-INF/MANIFEST.MF æä»¶åçã\n\n\x3c!--<Premain-Class>com.zhj.agent.agentmain.RunTimeAgent</Premain-Class>--\x3e\n<Agent-Class>com.zhj.agent.agentmain.RunTimeAgent</Agent-Class>\n\n\nè¿æ ·å¶å®æä»¬çæ¢éå°±å·²ç»æ¹é å¥½äºï¼ç¶åæä»¬éè¦å¨ç®æ ç¨åºç main æ¹æ³ä¸­æ¤å¥ä¸äºä»£ç ï¼ä½¿å¶å¯ä»¥è¯»åå°æä»¬çä»£çç¨åºï¼è¿æ ·æä»¬ä¹æ éå»éç½® JVM çåæ°ï¼å°±å¯ä»¥å è½½æ¢éç¨åºã\n\npublic class APPMain {\n\n    public static void main(String[] args) {\n        System.out.println("APP å¯å¨ï¼ï¼ï¼");\n        for (VirtualMachineDescriptor vmd : VirtualMachine.list()) {\n            // æå®çVMæå¯ä»¥è¢«ä»£ç\n            if (true) {\n                System.out.println("è¯¥VMä¸ºæå®ä»£ççVM");\n                System.out.println(vmd.displayName());\n                try {\n                    VirtualMachine vm = VirtualMachine.attach(vmd.id());\n                    vm.loadAgent("D:/Code/java/idea_project/agent-test/runtime-agent/target/runtime-agent-1.0-SNAPSHOT.jar=hello");\n                    vm.detach();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n        AppInit.init();\n    }\n}\n\n\nå¶ä¸­ VirtualMachine æ¯ JDK å·¥å·åä¸çç±»ï¼å¦æç³»ç»ç¯å¢åéæ²¡æéç½®ï¼éè¦èªå·±å¨ Maven ä¸­å¼å¥æ¬å°æä»¶ã\n\n<dependency>\n    <groupId>com.sun</groupId>\n    <artifactId>tools</artifactId>\n    <version>1.8</version>\n    <scope>system</scope>\n    <systemPath>D:/Software/java_dev/java_jdk/lib/tools.jar</systemPath>\n</dependency>\n\n\nè¿æ ·æä»¬å¨ç¨åºå¯å¨ååå»å¨æä¿®æ¹å­èç æä»¶çç®åæ¡ä¾å°±å®æäºã\n\n\n# å­èç å·¥å·\n\n * jclasslib - IDEA æä»¶ï¼å¯ä»¥ç´è§æ¥çå½åå­èç æä»¶çç±»ä¿¡æ¯ãå¸¸éæ± ãæ¹æ³åºç­ä¿¡æ¯ã\n * classpy - Classpy æ¯ä¸ä¸ªç¨äºç ç©¶ Java ç±»æä»¶ãLua äºè¿å¶åãWasm äºè¿å¶ä»£ç åå¶ä»äºè¿å¶æä»¶æ ¼å¼ç GUI å·¥å·ã\n * ASM ByteCode Outline - å©ç¨ ASM æåå­èç æ¶ï¼éè¦å©ç¨ä¸ç³»å visitXXXXInsn() æ¹æ³æ¥åå¯¹åºçå©è®°ç¬¦ï¼æä»¥éè¦åå°æ¯ä¸è¡æºä»£ç è½¬åä¸ºä¸ä¸ªä¸ªçå©è®°ç¬¦ï¼ç¶åéè¿ ASM çè¯­æ³è½¬æ¢ä¸º visitXXXXInsn() è¿ç§åæ³ãç¬¬ä¸æ­¥å°æºç è½¬åä¸ºå©è®°ç¬¦å°±å·²ç»å¤éº»ç¦äºï¼ä¸çæå­èç æä½éåçè¯ï¼éè¦æä»¬å°ä»£ç ç¼è¯åååç¼è¯ï¼æè½å¾å°æºä»£ç å¯¹åºçå©è®°ç¬¦ãç¬¬äºæ­¥å©ç¨ ASM åå­èç æ¶ï¼å¦ä½ä¼ åä¹å¾ä»¤äººå¤´ç¼ãASM ç¤¾åºä¹ç¥éè¿ä¸¤ä¸ªé®é¢ï¼æä»¥æä¾äºæ­¤å·¥å·ã\n\n\n# åèèµæ\n\n * ä¹¦ç±\n   * ãæ·±å¥çè§£ Java èææºã\n * æç« \n   * å­èç å¢å¼ºææ¯æ¢ç´¢\n   * è½»æ¾çæJavaå­èç \n   * Java Agent æ¢éææ¯\n * å­èç æ¡æ¶\n   * asm å®æ¹\n   * Javassist Github\n   * Byte Buddy Github',normalizedContent:'# java å­èç \n\n\n# å­èç ç®ä»\n\n\n# ä»ä¹æ¯å­èç \n\njava å­èç æ¯ java èææºæ§è¡çä¸ç§æä»¤æ ¼å¼ãä¹æä»¥è¢«ç§°ä¹ä¸ºå­èç ï¼æ¯å ä¸ºï¼java å­èç æä»¶ï¼.classï¼æ¯ä¸ç§ä»¥ 8 ä½å­èä¸ºåºç¡åä½çäºè¿å¶æµæä»¶ï¼åä¸ªæ°æ®é¡¹ä¸¥æ ¼æç§é¡ºåºç´§åå°æåå¨ .class æä»¶ä¸­ï¼ä¸­é´æ²¡ææ·»å ä»»ä½åéç¬¦ãæ´ä¸ª .class æä»¶æ¬è´¨ä¸å°±æ¯ä¸å¼ è¡¨ã\n\njava è½åå° âä¸æ¬¡ç¼è¯ï¼å°å¤è¿è¡âï¼ä¸æ¯å ä¸º jvm éå¯¹åç§æä½ç³»ç»ãå¹³å°é½è¿è¡äºå®å¶ï¼äºæ¯å ä¸ºæ è®ºå¨ä»ä¹å¹³å°ï¼é½å¯ä»¥ç¼è¯çæåºå®æ ¼å¼ç java å­èç æä»¶ï¼.classï¼ã\n\n\n\n\n# åç¼è¯å­èç æä»¶\n\næä»¬éè¿ä¸ä¸ªç¤ºä¾æ¥è®²è§£å¦ä½åç¼è¯å­èç æä»¶ã\n\nï¼1ï¼é¦åï¼åå»ºä¸ä¸ª demo.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\npublic class demo {\n\n    public static void main(string[] args) {\n        system.out.println("hello world");\n    }\n\n}\n\n\nï¼2ï¼æ§è¡ javac demo.javaï¼ç¼è¯ demo.java æä»¶ï¼å¨å½åè·¯å¾ä¸çæä¸ä¸ª demo.class æä»¶ã\n\næä»¶åå®¹å¦ä¸ï¼æ¯ä¸å  16 è¿å¶æ°ï¼\n\nca fe ba be 20 20 20 34 20 1d 0a 20 06 20 0f 09 20 10 20 11 08 20 12 0a 20 13 20 14 07 20 15 07 20 16 01 20 06 3c 69 6e 69 74 3e 01 20 03 28 29 56 01 20 04 43 6f 64 65 01 20 0f 4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 01 20 04 6d 61 69 6e 01 20 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 01 20 0a 53 6f 75 72 63 65 46 69 6c 65 01 20 09 44 65 6d 6f 2e 6a 61 76 61 0c 20 07 20 08 07 20 17 0c 20 18 20 19 01 20 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 07 20 1a 0c 20 1b 20 1c 01 20 26 69 6f 2f 67 69 74 68 75 62 2f 64 75 6e 77 75 2f 6a 61 76 61 63 6f 72 65 2f 62 79 74 65 63 6f 64 65 2f 44 65 6d 6f 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74 01 20 10 6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 20 03 6f 75 74 01 20 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 3b 01 20 13 6a 61 76 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d 01 20 07 70 72 69 6e 74 6c 6e 01 20 15 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b 29 56 20 21 20 05 20 06 20 20 20 20 20 02 20 01 20 07 20 08 20 01 20 09 20 20 20 1d 20 01 20 01 20 20 20 05 2a b7 20 01 b1 20 20 20 01 20 0a 20 20 20 06 20 01 20 20 20 03 20 09 20 0b 20 0c 20 01 20 09 20 20 20 25 20 02 20 01 20 20 20 09 b2 20 02 12 03 b6 20 04 b1 20 20 20 01 20 0a 20 20 20 0a 20 02 20 20 20 06 20 08 20 07 20 01 20 0d 20 20 20 02 20 0e\n\n\nåé¢å·²ç»æè¿ï¼java å­èç æä»¶ï¼.classï¼æ¯ä¸ç§ä»¥ 8 ä½å­èä¸ºåºç¡åä½çäºè¿å¶æµæä»¶ï¼åä¸ªæ°æ®é¡¹ä¸¥æ ¼æç§é¡ºåºç´§åå°æåå¨ .class æä»¶ä¸­ï¼ä¸­é´æ²¡ææ·»å ä»»ä½åéç¬¦ã\n\nï¼3ï¼ä½¿ç¨å° java åç½®çåç¼è¯å·¥å· javap å¯ä»¥åç¼è¯å­èç æä»¶ã\n\næ§è¡ javap -verbose -p demo.classï¼æ§å¶å°ä¼è¾åºç¸å¯¹èè¨ï¼å¯ä»¥çè§£çæä»¤ãè¾åºåå®¹å¤§è´å¦ä¸ï¼\n\nclassfile /d:/workspace/demo.class\n  last modified 2023-4-20; size 447 bytes\n  md5 checksum 0baafe4215fe2bd2e51b48d51fe563a3\n  compiled from "demo.java"\npublic class io.github.dunwu.javacore.bytecode.demo\n  minor version: 0\n  major version: 52\n  flags: acc_public, acc_super\nconstant pool:\n   #1 = methodref          #6.#15         // java/lang/object."<init>":()v\n   #2 = fieldref           #16.#17        // java/lang/system.out:ljava/io/printstream;\n   #3 = string             #18            // hello world\n   #4 = methodref          #19.#20        // java/io/printstream.println:(ljava/lang/string;)v\n   #5 = class              #21            // io/github/dunwu/javacore/bytecode/demo\n   #6 = class              #22            // java/lang/object\n   #7 = utf8               <init>\n   #8 = utf8               ()v\n   #9 = utf8               code\n  #10 = utf8               linenumbertable\n  #11 = utf8               main\n  #12 = utf8               ([ljava/lang/string;)v\n  #13 = utf8               sourcefile\n  #14 = utf8               demo.java\n  #15 = nameandtype        #7:#8          // "<init>":()v\n  #16 = class              #23            // java/lang/system\n  #17 = nameandtype        #24:#25        // out:ljava/io/printstream;\n  #18 = utf8               hello world\n  #19 = class              #26            // java/io/printstream\n  #20 = nameandtype        #27:#28        // println:(ljava/lang/string;)v\n  #21 = utf8               io/github/dunwu/javacore/bytecode/demo\n  #22 = utf8               java/lang/object\n  #23 = utf8               java/lang/system\n  #24 = utf8               out\n  #25 = utf8               ljava/io/printstream;\n  #26 = utf8               java/io/printstream\n  #27 = utf8               println\n  #28 = utf8               (ljava/lang/string;)v\n{\n  public io.github.dunwu.javacore.bytecode.demo();\n    descriptor: ()v\n    flags: acc_public\n    code:\n      stack=1, locals=1, args_size=1\n         0: aload_0\n         1: invokespecial #1                  // method java/lang/object."<init>":()v\n         4: return\n      linenumbertable:\n        line 3: 0\n\n  public static void main(java.lang.string[]);\n    descriptor: ([ljava/lang/string;)v\n    flags: acc_public, acc_static\n    code:\n      stack=2, locals=1, args_size=1\n         0: getstatic     #2                  // field java/lang/system.out:ljava/io/printstream;\n         3: ldc           #3                  // string hello world\n         5: invokevirtual #4                  // method java/io/printstream.println:(ljava/lang/string;)v\n         8: return\n      linenumbertable:\n        line 6: 0\n        line 7: 8\n}\nsourcefile: "demo.java"\n\n\n> æç¤ºï¼éè¿ javap -help å¯äºè§£ javap çåºæ¬ç¨æ³ã\n> \n> ç¨æ³: javap <options> <classes>\n> å¶ä¸­, å¯è½çéé¡¹åæ¬:\n>   -help  --help  -?        è¾åºæ­¤ç¨æ³æ¶æ¯\n>   -version                 çæ¬ä¿¡æ¯\n>     -v  -verbose             è¾åºéå ä¿¡æ¯\n>     -l                       è¾åºè¡å·åæ¬å°åéè¡¨\n>     -public                  ä»æ¾ç¤ºå¬å±ç±»åæå\n>     -protected               æ¾ç¤ºåä¿æ¤ç/å¬å±ç±»åæå\n>     -package                 æ¾ç¤ºç¨åºå/åä¿æ¤ç/å¬å±ç±»\n>                              åæå (é»è®¤)\n>     -p  -private             æ¾ç¤ºææç±»åæå\n>      -c                       å¯¹ä»£ç è¿è¡åæ±ç¼\n>     -s                       è¾åºåé¨ç±»åç­¾å\n>     -sysinfo                 æ¾ç¤ºæ­£å¨å¤ççç±»ç\n>                              ç³»ç»ä¿¡æ¯ (è·¯å¾, å¤§å°, æ¥æ, md5 æ£å)\n>     -constants               æ¾ç¤ºæç»å¸¸é\n>      -classpath <path>        æå®æ¥æ¾ç¨æ·ç±»æä»¶çä½ç½®\n>     -cp <path>               æå®æ¥æ¾ç¨æ·ç±»æä»¶çä½ç½®\n>     -bootclasspath <path>    è¦çå¼å¯¼ç±»æä»¶çä½ç½®\n\n\n# å­èç æä»¶ç»æ\n\nå­èç çä¼¼æä¹±æ åºï¼å®éä¸æ¯ç±ä¸¥æ ¼çæ ¼å¼è¦æ±ç»æçã\n\n\n\n# é­æ°\n\næ¯ä¸ª .class æä»¶çå¤´ 4 ä¸ªå­èç§°ä¸º é­æ°ï¼magic_numberï¼ï¼å®çå¯ä¸ä½ç¨æ¯ç¡®å®è¿ä¸ªæä»¶æ¯å¦ä¸ºä¸ä¸ªè½è¢«èææºæ¥æ¶ç .class æä»¶ãé­æ°çåºå®å¼ä¸ºï¼0xcafebabeã\n\n# çæ¬å·\n\nçæ¬å·ï¼versionï¼æ 4 ä¸ªå­èï¼åä¸¤ä¸ªå­èè¡¨ç¤ºæ¬¡çæ¬å·ï¼minor versionï¼ï¼åä¸¤ä¸ªå­èè¡¨ç¤ºä¸»çæ¬å·ï¼major versionï¼ã\n\nä¸¾ä¾æ¥è¯´ï¼å¦æçæ¬å·ä¸ºï¼â00 00 00 34âãé£ä¹ï¼æ¬¡çæ¬å·è½¬åä¸ºåè¿å¶ä¸º 0ï¼ä¸»çæ¬å·è½¬åä¸ºåè¿å¶ä¸º 52ï¼å¨ oracle å®ç½ä¸­æ¥è¯¢åºå· 52 å¯¹åºçä¸»çæ¬å·ä¸º 1.8ï¼æä»¥ç¼è¯è¯¥æä»¶ç java çæ¬å·ä¸º 1.8.0ã\n\n# å¸¸éæ± \n\nç´§æ¥çä¸»çæ¬å·ä¹åçå­èä¸ºå¸¸éæ± ï¼constant_poolï¼ï¼å¸¸éæ± å¯ä»¥çè§£ä¸º .class æä»¶ä¸­çèµæºä»åºã\n\nå¸¸éæ± æ´ä½ä¸åä¸ºä¸¤é¨åï¼å¸¸éæ± è®¡æ°å¨ä»¥åå¸¸éæ± æ°æ®åº\n\n * å¸¸éæ± è®¡æ°å¨ï¼constant_pool_countï¼ - ç±äºå¸¸éçæ°éä¸åºå®ï¼æä»¥éè¦åæ¾ç½®ä¸¤ä¸ªå­èæ¥è¡¨ç¤ºå¸¸éæ± å®¹éè®¡æ°å¼ã\n\n * å¸¸éæ± æ°æ®åº - æ°æ®åºçæ¯ä¸é¡¹å¸¸éé½æ¯ä¸ä¸ªè¡¨ï¼ä¸ç»æåä¸ç¸åã\n\nå¸¸éæ± ä¸»è¦å­æ¾ä¸¤ç±»å¸¸éï¼\n\n * å­é¢é - å¦ææ¬å­ç¬¦ä¸²ãå£°æä¸º final çå¸¸éå¼ã\n * ç¬¦å·å¼ç¨\n   * ç±»åæ¥å£çå¨éå®å\n   * å­æ®µçåç§°åæè¿°ç¬¦\n   * æ¹æ³çåç§°åæè¿°ç¬¦\n\n# è®¿é®æ å¿\n\nç´§æ¥çå¸¸éæ± ç 2 ä¸ªå­èä»£è¡¨è®¿é®æ å¿ï¼access_flagsï¼ï¼è¿ä¸ªæ å¿ç¨äºè¯å«ä¸äºç±»æèæ¥å£çè®¿é®ä¿¡æ¯ï¼æè¿°è¯¥ class æ¯ç±»è¿æ¯æ¥å£ï¼ä»¥åæ¯å¦è¢« publicãabstractãfinal ç­ä¿®é¥°ç¬¦ä¿®é¥°ã\n\nè®¿é®æ å¿æä»¥ä¸ç±»åï¼\n\næ å¿åç§°             æ å¿å¼      å«ä¹\nacc_public       0x0001   æ¯å¦ä¸º public ç±»å\nacc_final        0x0010   æ¯å¦è¢«å£°æä¸º finalï¼åªæç±»å¯ä»¥è®¾ç½®\nacc_super        0x0020   æ¯å¦åè®¸ä½¿ç¨ invokespecial å­èç æä»¤çæ°è¯­ä¹ï¼\nacc_interface    0x0200   æ å¿è¿æ¯ä¸ä¸ªæ¥å£\nacc_abstract     0x0400   æ¯å¦ä¸º abstract ç±»åï¼å¯¹äºæ¥å£æèæ½è±¡ç±»æ¥è¯´ï¼ æ¬¡æ å¿å¼ä¸ºçï¼å¶ä»ç±»åä¸ºå\nacc_synthetic    0x1000   æ å¿è¿ä¸ªç±»å¹¶éç±ç¨æ·ä»£ç äº§ç\nacc_annotation   0x2000   æ å¿è¿æ¯ä¸ä¸ªæ³¨è§£\nacc_enum         0x4000   æ å¿è¿æ¯ä¸ä¸ªæä¸¾\n\n# ç±»ç´¢å¼ãç¶ç±»ç´¢å¼ãæ¥å£ç´¢å¼\n\nç±»ç´¢å¼ï¼this_classï¼åç¶ç±»ç´¢å¼é½æ¯ä¸ä¸ª u2 ç±»åçæ°æ®ï¼èæ¥å£ç´¢å¼éåæ¯ä¸ç» u2 ç±»åçæ°æ®çéåã.class æä»¶ä¸­ç±è¿ 3 é¡¹æ°æ®æ¥ç¡®å®è¿ä¸ªç±»çç»§æ¿å³ç³»ã\n\n# å­æ®µè¡¨\n\nå­æ®µè¡¨ç¨äºæè¿°ç±»åæ¥å£ä¸­å£°æçåéãåå«ç±»çº§åéä»¥åå®ä¾çº§åéï¼ä½æ¯ä¸åå«æ¹æ³åé¨å£°æçå±é¨åéã\n\nå­æ®µè¡¨ä¹åä¸ºä¸¤é¨åï¼ç¬¬ä¸é¨åä¸ºä¸¤ä¸ªå­èï¼æè¿°å­æ®µä¸ªæ°ï¼ç¬¬äºé¨åæ¯æ¯ä¸ªå­æ®µçè¯¦ç»ä¿¡æ¯ fields_infoã\n\n# æ¹æ³è¡¨\n\nå­æ®µè¡¨ç»æåä¸ºæ¹æ³è¡¨ï¼æ¹æ³è¡¨çç»æå¦åå­æ®µè¡¨ä¸æ ·ï¼ä¾æ¬¡åæ¬äºè®¿é®æ å¿ãåç§°ç´¢å¼ãæè¿°ç¬¦ç´¢å¼ãå±æ§è¡¨éåå é¡¹ã\n\n# å±æ§è¡¨éå\n\nå±æ§è¡¨éåå­æ¾äºå¨è¯¥æä»¶ä¸­ç±»ææ¥å£æå®ä¹å±æ§çåºæ¬ä¿¡æ¯ã\n\n\n# å­èç æä»¤\n\nå­èç æä»¤ç±ä¸ä¸ªå­èé¿åº¦çãä»£è¡¨çæç§ç¹å®æä½å«ä¹çæ°å­ï¼ç§°ä¸ºæä½ç ï¼opcodeï¼ä»¥åè·éå¶åçé¶å°å¤ä¸ªä»£è¡¨æ­¤æä½æéåæ°ï¼operandsï¼èææãç±äº jvm éç¨é¢åæä½æ°æ æ¶æèä¸æ¯å¯å­å¨æ¶æï¼æä»¥å¤§å¤æ°çæä»¤é½ä¸åæ¬æä½æ°ï¼åªæä¸ä¸ªæä½ç ã\n\njvm æä½ç çé¿åº¦ä¸º 1 ä¸ªå­èï¼å æ­¤æä»¤éçæä½ç æå¤åªæ 256 ä¸ªã\n\nå­èç æä½å¤§è´åä¸º 9 ç±»ï¼\n\n * å è½½åå­å¨æä»¤\n * è¿ç®æä»¤\n * ç±»åè½¬æ¢æä»¤\n * å¯¹è±¡åå»ºä¸è®¿é®æä»¤\n * æä½æ°æ ç®¡çæä»¤\n * æ§å¶è½¬ç§»æä»¤\n * æ¹æ³è°ç¨åè¿åæä»¤\n * å¼å¸¸å¤çæä»¤\n * åæ­¥æä»¤\n\n\n# å­èç å¢å¼º\n\nå­èç å¢å¼ºææ¯å°±æ¯ä¸ç±»å¯¹ç°æå­èç è¿è¡ä¿®æ¹æèå¨æçæå¨æ°å­èç æä»¶çææ¯ã\n\nå¸¸è§çå­èç å¢å¼ºæ¡æ¶æï¼\n\n * asm -\n * javassist - javassist çæ¯éè¿æ§å¶åºå±å­èç æ¥å®ç°å¨æä»£çï¼ä¸éè¦åå°å®æè°ç¨ï¼æä»¥æ§è½è¯å®æ¯ jdk çå¨æä»£çæ¹å¼æ§è½è¦å¥½ã\n * byte buddy - byte buddy åå±äºåèµ·ä¹ç§ï¼å¨å¾å¤ä¼ç§çé¡¹ç®ä¸­ï¼å springãjackson é½ç¨å°äº byte buddy æ¥å®æåºå±ä»£çãç¸æ¯ javassistï¼byte buddy æä¾äºæ´å®¹ææä½ç apiï¼ç¼åçä»£ç å¯è¯»æ§æ´é«ãæ´éè¦çæ¯ï¼çæçä»£çç±»æ§è¡éåº¦æ¯ javassist æ´å¿«ã\n\n\n# asm\n\nå¯¹äºéè¦æå¨æçºµå­èç çéæ±ï¼å¯ä»¥ä½¿ç¨ asmï¼å®å¯ä»¥ç´æ¥çäº§ .classå­èç æä»¶ï¼ä¹å¯ä»¥å¨ç±»è¢«å è½½å¥ jvm ä¹åå¨æä¿®æ¹ç±»è¡ä¸ºã\n\nasm çåºç¨åºæ¯æ aopï¼cglib å°±æ¯åºäº asmï¼ãç­é¨ç½²ãä¿®æ¹å¶ä» jar åä¸­çç±»ç­ãå½ç¶ï¼æ¶åå°å¦æ­¤åºå±çæ­¥éª¤ï¼å®ç°èµ·æ¥ä¹æ¯è¾éº»ç¦ã\n\nasm æä¸¤ç±» apiï¼æ ¸å¿ api åæ å½¢ api\n\n * æ ¸å¿ api - asm core api å¯ä»¥ç±»æ¯è§£æ xml æä»¶ä¸­ç sax æ¹å¼ï¼ä¸éè¦æè¿ä¸ªç±»çæ´ä¸ªç»æè¯»åè¿æ¥ï¼å°±å¯ä»¥ç¨æµå¼çæ¹æ³æ¥å¤çå­èç æä»¶ãå¥½å¤æ¯éå¸¸èçº¦åå­ï¼ä½æ¯ç¼ç¨é¾åº¦è¾å¤§ãç¶èåºäºæ§è½èèï¼ä¸è¬æåµä¸ç¼ç¨é½ä½¿ç¨ core apiãå¨ core api ä¸­æä»¥ä¸å ä¸ªå³é®ç±»ï¼\n   * classreader - ç¨äºè¯»åå·²ç»ç¼è¯å¥½ç .class æä»¶ã\n   * classwriter - ç¨äºéæ°æå»ºç¼è¯åçç±»ï¼å¦ä¿®æ¹ç±»åãå±æ§ä»¥åæ¹æ³ï¼ä¹å¯ä»¥çææ°çç±»çå­èç æä»¶ã\n   * åç§ visitor ç±» - coreapi æ ¹æ®å­èç ä»ä¸å°ä¸ä¾æ¬¡å¤çï¼å¯¹äºå­èç æä»¶ä¸­ä¸åçåºåæä¸åç visitorï¼æ¯å¦ç¨äºè®¿é®æ¹æ³ç methodvisitorãç¨äºè®¿é®ç±»åéç fieldvisitorãç¨äºè®¿é®æ³¨è§£ç annotationvisitor ç­ãä¸ºäºå®ç° aopï¼éç¹è¦ä½¿ç¨çæ¯ methodvisitorã\n * æ å½¢ api - asm tree api å¯ä»¥ç±»æ¯è§£æ xml æä»¶ä¸­ç dom æ¹å¼ï¼ææ´ä¸ªç±»çç»æè¯»åå°åå­ä¸­ï¼ç¼ºç¹æ¯æ¶èåå­å¤ï¼ä½æ¯ç¼ç¨æ¯è¾ç®åãtreeapi ä¸åäº coreapiï¼treeapi éè¿åç§ node ç±»æ¥æ å°å­èç çåä¸ªåºåï¼ç±»æ¯ dom èç¹ï¼å°±å¯ä»¥å¾å¥½å°çè§£è¿ç§ç¼ç¨æ¹å¼ã\n\n\n# javassist\n\nå©ç¨ javassist å®ç°å­èç å¢å¼ºæ¶ï¼å¯ä»¥æ é¡»å³æ³¨å­èç å»æ¿çç»æï¼å¶ä¼ç¹å°±å¨äºç¼ç¨ç®åãç´æ¥ä½¿ç¨ java ç¼ç çå½¢å¼ï¼èä¸éè¦äºè§£èææºæä»¤ï¼å°±è½å¨ææ¹åç±»çç»ææèå¨æçæç±»ã\n\nå¶æ ¸å¿ç±»å¦ä¸ï¼\n\n * ctclassï¼compile-time classï¼ - ç¼è¯æ¶ç±»ä¿¡æ¯ãå®æ¯ä¸ä¸ª class æä»¶å¨ä»£ç ä¸­çæ½è±¡ï¼å¯ä»¥éè¿ä¸ä¸ªç±»çå¨éå®åæ¥è·åä¸ä¸ª ctclass å¯¹è±¡ï¼ç¨æ¥è¡¨ç¤ºè¿ä¸ªç±»æä»¶ã\n * classpool - classpool å¯ä»¥çæä¸å¼ ä¿å­ ctclass ä¿¡æ¯ç hashtableï¼key ä¸ºç±»åï¼value ä¸ºç±»åå¯¹åºç ctclass å¯¹è±¡ãå½æä»¬éè¦å¯¹æä¸ªç±»è¿è¡ä¿®æ¹æ¶ï¼å°±æ¯éè¿ pool.getctclass("classname") æ¹æ³ä» pool ä¸­è·åå°ç¸åºç ctclassã\n * ctmethodãctfield - å¯¹åºçæ¯ç±»ä¸­çæ¹æ³åå±æ§ã\n\n\n# è¿è¡æ¶ç±»çéè½½\n\n\n# instrument\n\ninstrument æ¯ jvm æä¾çä¸ä¸ªå¯ä»¥ä¿®æ¹å·²å è½½ç±»çç±»åºï¼ä¸é¨ä¸º java è¯­è¨ç¼åçææ¡©æå¡æä¾æ¯æãå®éè¦ä¾èµ jvmti ç attach api æºå¶å®ç°ãå¨ jdk 1.6 ä»¥åï¼instrument åªè½å¨ jvm åå¯å¨å¼å§å è½½ç±»æ¶çæï¼èå¨ jdk 1.6 ä¹åï¼instrument æ¯æäºå¨è¿è¡æ¶å¯¹ç±»å®ä¹çä¿®æ¹ãè¦ä½¿ç¨ instrument çç±»ä¿®æ¹åè½ï¼æä»¬éè¦å®ç°å®æä¾ç classfiletransformer æ¥å£ï¼å®ä¹ä¸ä¸ªç±»æä»¶è½¬æ¢å¨ãæ¥å£ä¸­ç transform()æ¹æ³ä¼å¨ç±»æä»¶è¢«å è½½æ¶è°ç¨ï¼èå¨ transform æ¹æ³éï¼å¯ä»¥å©ç¨ asm æ javassist å¯¹ä¼ å¥çå­èç è¿è¡æ¹åææ¿æ¢ï¼çææ°çå­èç æ°ç»åè¿åã\n\n\n# javaagent\n\njavaagent æ¯ä»ä¹ï¼\n\njavaagent æ¯ java å½ä»¤çä¸ä¸ªåæ°ãåæ° javaagent å¯ä»¥ç¨äºæå®ä¸ä¸ª jar åï¼å®å©ç¨ jvm æä¾ç instrumentation api æ¥æ´æ¹å è½½ jvm ä¸­çç°æå­èç ã\n\n 1. è¿ä¸ª jar åç manifest.mf æä»¶å¿é¡»æå® premain-class é¡¹ã\n 2. premain-class æå®çé£ä¸ªç±»å¿é¡»å®ç° premain() æ¹æ³ã\n\npremain æ¹æ³ï¼ä»å­é¢ä¸çè§£ï¼å°±æ¯è¿è¡å¨ main å½æ°ä¹åççç±»ãå½ java èææºå¯å¨æ¶ï¼å¨æ§è¡ main å½æ°ä¹åï¼jvm ä¼åè¿è¡-javaagentææå® jar åå premain-class è¿ä¸ªç±»ç premain æ¹æ³ ã\n\nå¨å½ä»¤è¡è¾å¥ javaå¯ä»¥çå°ç¸åºçåæ°ï¼å¶ä¸­æ å java agent ç¸å³çï¼\n\n-agentlib:<libname>[=<éé¡¹>]\n\t\t\t  å è½½æ¬æºä»£çåº <libname>, ä¾å¦ -agentlib:hprof\n\t\t\t  å¦è¯·åé -agentlib:jdwp=help å -agentlib:hprof=help\n-agentpath:<pathname>[=<éé¡¹>]\n\t\t\t  æå®æ´è·¯å¾åå è½½æ¬æºä»£çåº\n-javaagent:<jarpath>[=<éé¡¹>]\n\t\t\t  å è½½ java ç¼ç¨è¯­è¨ä»£ç, è¯·åé java.lang.instrument\n\n\n\n# java agent ææ¯ç®ä»\n\njava agent ç´è¯ä¸º java ä»£çï¼ä¹å¸¸å¸¸è¢«ç§°ä¸º java æ¢éææ¯ã\n\njava agent æ¯å¨ jdk1.5 å¼å¥çï¼æ¯ä¸ç§å¯ä»¥å¨æä¿®æ¹ java å­èç çææ¯ãjava ä¸­çç±»ç¼è¯åå½¢æå­èç è¢« jvm æ§è¡ï¼å¨ jvm å¨æ§è¡è¿äºå­èç ä¹åè·åè¿äºå­èç çä¿¡æ¯ï¼å¹¶ä¸éè¿å­èç è½¬æ¢å¨å¯¹è¿äºå­èç è¿è¡ä¿®æ¹ï¼ä»¥æ­¤æ¥å®æä¸äºé¢å¤çåè½ã\n\njava agent æ¯ä¸ä¸ªä¸è½ç¬ç«è¿è¡ jar åï¼å®éè¿ä¾éäºç®æ ç¨åºç jvm è¿ç¨ï¼è¿è¡å·¥ä½ãå¯å¨æ¶åªéè¦å¨ç®æ ç¨åºçå¯å¨åæ°ä¸­æ·»å -javaagent åæ°æ·»å  classfiletransformer å­èç è½¬æ¢å¨ï¼ç¸å½äºå¨ main æ¹æ³åå äºä¸ä¸ªæ¦æªå¨ã\n\n\n# java agent åè½ä»ç»\n\njava agent ä¸»è¦æä»¥ä¸åè½\n\n * java agent è½å¤å¨å è½½ java å­èç ä¹åæ¦æªå¹¶å¯¹å­èç è¿è¡ä¿®æ¹;\n * java agent è½å¤å¨ jvm è¿è¡æé´ä¿®æ¹å·²ç»å è½½çå­èç ;\n\njava agent çåºç¨åºæ¯\n\n * ide çè°è¯åè½ï¼ä¾å¦ eclipseãintellij idea ï¼\n * ç­é¨ç½²åè½ï¼ä¾å¦ jrebelãxrebelãspring-loadedï¼\n * åç§çº¿ä¸è¯æ­å·¥å·ï¼ä¾å¦ btraceãgreysï¼è¿æé¿éç arthasï¼\n * åç§æ§è½åæå·¥å·ï¼ä¾å¦ visual vmãjconsole ç­ï¼\n * å¨é¾è·¯æ§è½æ£æµå·¥å·ï¼ä¾å¦ skywalkingãpinpoint ç­ï¼\n\n\n# java agent å®ç°åç\n\nå¨äºè§£ java agent çå®ç°åçä¹åï¼éè¦å¯¹ java ç±»å è½½æºå¶æä¸ä¸ªè¾ä¸ºæ¸æ°çè®¤ç¥ãä¸ç§æ¯å¨ man æ¹æ³æ§è¡ä¹åï¼éè¿ premain æ¥æ§è¡ï¼å¦ä¸ç§æ¯ç¨åºè¿è¡ä¸­ä¿®æ¹ï¼ééè¿ jvm ä¸­ç attach å®ç°ï¼attach çå®ç°åçæ¯åºäº jvmtiã\n\nä¸»è¦æ¯å¨ç±»å è½½ä¹åï¼è¿è¡æ¦æªï¼å¯¹å­èç ä¿®æ¹\n\nä¸é¢æä»¬åå«ä»ç»ä¸ä¸è¿äºå³é®æ¯è¯­ï¼\n\n * jvmti å°±æ¯ jvm tool interfaceï¼æ¯ jvm æ´é²åºæ¥ç»ç¨æ·æ©å±ä½¿ç¨çæ¥å£éåï¼jvmti æ¯åºäºäºä»¶é©±å¨çï¼jvm æ¯æ§è¡ä¸å®çé»è¾å°±ä¼è§¦åä¸äºäºä»¶çåè°æ¥å£ï¼éè¿è¿äºåè°æ¥å£ï¼ç¨æ·å¯ä»¥èªè¡æ©å±\n   \n   jvmti æ¯å®ç° debuggerãprofilerãmonitorãthread analyser ç­å·¥å·çç»ä¸åºç¡ï¼å¨ä¸»æµ java èææºä¸­é½æå®ç°\n\n * jvmtiagentæ¯ä¸ä¸ªå¨æåºï¼å©ç¨ jvmti æ´é²åºæ¥çä¸äºæ¥å£æ¥å¹²ä¸äºæä»¬æ³åãä½æ¯æ­£å¸¸æåµä¸ååä¸å°çäºæï¼ä¸è¿ä¸ºäºåæ®éçå¨æåºè¿è¡åºåï¼å®ä¸è¬ä¼å®ç°å¦ä¸çä¸ä¸ªæèå¤ä¸ªå½æ°ï¼\n   \n   * agent_onload å½æ°ï¼å¦æ agent æ¯å¨å¯å¨æ¶å è½½çï¼éè¿ jvm åæ°è®¾ç½®\n   * agent_onattach å½æ°ï¼å¦æ agent ä¸æ¯å¨å¯å¨æ¶å è½½çï¼èæ¯æä»¬å attach å°ç®æ è¿ç¨ä¸ï¼ç¶åç»å¯¹åºçç®æ è¿ç¨åé load å½ä»¤æ¥å è½½ï¼åå¨å è½½è¿ç¨ä¸­ä¼è°ç¨ agent_onattach å½æ°\n   * agent_onunload å½æ°ï¼å¨ agent å¸è½½æ¶è°ç¨\n\n * javaagent ä¾èµäº instrument ç jvmtiagentï¼linux ä¸å¯¹åºçå¨æåºæ¯ libinstrument.soï¼ï¼è¿æä¸ªå«åå« jplisagent(java programming language instrumentation services agent)ï¼ä¸é¨ä¸º java è¯­è¨ç¼åçææ¡©æå¡æä¾æ¯æç\n\n * instrument å®ç°äº agent_onload å agent_onattach ä¸¤æ¹æ³ï¼ä¹å°±æ¯è¯´å¨ä½¿ç¨æ¶ï¼agent æ¢å¯ä»¥å¨å¯å¨æ¶å è½½ï¼ä¹å¯ä»¥å¨è¿è¡æ¶å¨æå è½½ãå¶ä¸­å¯å¨æ¶å è½½è¿å¯ä»¥éè¿ç±»ä¼¼-javaagent:jar åè·¯å¾çæ¹å¼æ¥é´æ¥å è½½ instrument agentï¼è¿è¡æ¶å¨æå è½½ä¾èµçæ¯ jvm ç attach æºå¶ï¼éè¿åé load å½ä»¤æ¥å è½½ agent\n\n * jvm attach æ¯æ jvm æä¾çä¸ç§è¿ç¨é´éä¿¡çåè½ï¼è½è®©ä¸ä¸ªè¿ç¨ä¼ å½ä»¤ç»å¦ä¸ä¸ªè¿ç¨ï¼å¹¶è¿è¡ä¸äºåé¨çæä½ï¼æ¯å¦è¿è¡çº¿ç¨ dumpï¼é£ä¹å°±éè¦æ§è¡ jstack è¿è¡ï¼ç¶åæ pid ç­åæ°ä¼ éç»éè¦ dump ççº¿ç¨æ¥æ§è¡\n\n\n# java agent æ¡ä¾\n\n# å è½½ java å­èç ä¹åæ¦æª\n\n# app é¡¹ç®\n\nï¼1ï¼åå»ºä¸ä¸ªåä¸º javacore-javaagent-app ç maven å·¥ç¨\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns:xsi="http://www.w3.org/2001/xmlschema-instance" xmlns="http://maven.apache.org/pom/4.0.0"\n  xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n  <modelversion>4.0.0</modelversion>\n\n  <groupid>io.github.dunwu.javacore</groupid>\n  <artifactid>javacore-javaagent-app</artifactid>\n  <version>1.0.1</version>\n  <name>javacore :: javaagent :: app</name>\n\n  <properties>\n    <project.build.sourceencoding>utf-8</project.build.sourceencoding>\n    <java.version>1.8</java.version>\n    <maven.compiler.source>${java.version}</maven.compiler.source>\n    <maven.compiler.target>${java.version}</maven.compiler.target>\n  </properties>\n</project>\n\n\nï¼2ï¼åå»ºä¸ä¸ªåºç¨å¯å¨ç±»\n\npublic class appmain {\n\n    public static void main(string[] args) {\n        system.out.println("app å¯å¨ï¼ï¼ï¼");\n        appinit.init();\n    }\n\n}\n\n\nï¼3ï¼åå»ºä¸ä¸ªæ¨¡æåºç¨åå§åçç±»\n\npublic class appinit {\n\n    public static void init() {\n        try {\n            system.out.println("appåå§åä¸­...");\n            thread.sleep(1000);\n        } catch (interruptedexception e) {\n            e.printstacktrace();\n        }\n    }\n\n}\n\n\nï¼4ï¼è¾åº\n\napp å¯å¨ï¼ï¼ï¼\nappåå§åä¸­...\n\n\n# agent é¡¹ç®\n\nï¼1ï¼åå»ºä¸ä¸ªåä¸º javacore-javaagent-agent ç maven å·¥ç¨\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns:xsi="http://www.w3.org/2001/xmlschema-instance" xmlns="http://maven.apache.org/pom/4.0.0"\n  xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n  <modelversion>4.0.0</modelversion>\n\n  <groupid>io.github.dunwu.javacore</groupid>\n  <artifactid>javacore-javaagent-agent</artifactid>\n  <version>1.0.1</version>\n  <name>javacore :: javaagent :: agent</name>\n\n  <properties>\n    <project.build.sourceencoding>utf-8</project.build.sourceencoding>\n    <java.version>1.8</java.version>\n    <maven.compiler.source>${java.version}</maven.compiler.source>\n    <maven.compiler.target>${java.version}</maven.compiler.target>\n  </properties>\n\n  <dependencies>\n    \x3c!--javaagent å·¥å·å--\x3e\n    <dependency>\n      <groupid>org.javassist</groupid>\n      <artifactid>javassist</artifactid>\n      <version>3.26.0-ga</version>\n    </dependency>\n  </dependencies>\n\n  <build>\n    <plugins>\n      <plugin>\n        <groupid>org.apache.maven.plugins</groupid>\n        <artifactid>maven-compiler-plugin</artifactid>\n        <version>3.5.1</version>\n        \x3c!--æå® maven ç¼è¯ç jdk çæ¬ãè¥ä¸æå®ï¼maven3 é»è®¤ç¨ jdk 1.5ï¼maven2 é»è®¤ç¨ jdk1.3--\x3e\n        <configuration>\n          <source>8</source>\n          <target>8</target>\n        </configuration>\n      </plugin>\n\n      <plugin>\n        <groupid>org.apache.maven.plugins</groupid>\n        <artifactid>maven-jar-plugin</artifactid>\n        <version>3.2.0</version>\n        <configuration>\n          <archive>\n            \x3c!--èªå¨æ·»å meta-inf/manifest.mf --\x3e\n            <manifest>\n              <addclasspath>true</addclasspath>\n            </manifest>\n            <manifestentries>\n              <menifest-version>1.0</menifest-version>\n              <premain-class>io.github.dunwu.javacore.javaagent.runtimeagent</premain-class>\n              <can-redefine-classes>true</can-redefine-classes>\n              <can-retransform-classes>true</can-retransform-classes>\n            </manifestentries>\n          </archive>\n        </configuration>\n      </plugin>\n    </plugins>\n  </build>\n</project>\n\n\nï¼2ï¼åå»ºä¸ä¸ª agent å¯å¨ç±»\n\npublic class runtimeagent {\n\n    public static void premain(string arg, instrumentation instrumentation) {\n        system.out.println("æ¢éå¯å¨ï¼ï¼ï¼");\n        system.out.println("æ¢éä¼ å¥åæ°ï¼" + arg);\n        instrumentation.addtransformer(new runtimetransformer());\n    }\n}\n\n\nè¿éæ¯ä¸ªç±»å è½½çæ¶åé½ä¼èµ°è¿ä¸ªæ¹æ³ï¼æä»¬å¯ä»¥éè¿ classname è¿è¡æå®ç±»çæ¦æªï¼ç¶ååå© javassist è¿ä¸ªå·¥å·ï¼è¿è¡å¯¹ class çå¤çï¼è¿éçææ³ååå°ç±»ä¼¼ï¼ä½æ¯è¦æ¯åå°åè½æ´å å¼ºå¤§ï¼å¯ä»¥å¨æä¿®æ¹å­èç ã\n\nï¼3ï¼ä½¿ç¨ javassist æ¦æªæå®ç±»ï¼å¹¶è¿è¡ä»£ç å¢å¼º\n\npackage io.github.dunwu.javacore.javaagent;\n\nimport javassist.classpool;\nimport javassist.ctclass;\nimport javassist.ctmethod;\n\nimport java.lang.instrument.classfiletransformer;\nimport java.lang.instrument.illegalclassformatexception;\nimport java.security.protectiondomain;\n\npublic class runtimetransformer implements classfiletransformer {\n\n    private static final string injected_class = "io.github.dunwu.javacore.javaagent.appinit";\n\n    @override\n    public byte[] transform(classloader loader, string classname, class<?> classbeingredefined,\n        protectiondomain protectiondomain, byte[] classfilebuffer) throws illegalclassformatexception {\n        string realclassname = classname.replace("/", ".");\n        if (realclassname.equals(injected_class)) {\n            system.out.println("æ¦æªå°çç±»åï¼" + realclassname);\n            ctclass ctclass;\n            try {\n                // ä½¿ç¨javassist,è·åå­èç ç±»\n                classpool classpool = classpool.getdefault();\n                ctclass = classpool.get(realclassname);\n\n                // å¾å°è¯¥ç±»ææçæ¹æ³å®ä¾ï¼ä¹å¯éæ©æ¹æ³ï¼è¿è¡å¢å¼º\n                ctmethod[] declaredmethods = ctclass.getdeclaredmethods();\n                for (ctmethod method : declaredmethods) {\n                    system.out.println(method.getname() + "æ¹æ³è¢«æ¦æª");\n                    method.addlocalvariable("time", ctclass.longtype);\n                    method.insertbefore("system.out.println(\\"---å¼å§æ§è¡---\\");");\n                    method.insertbefore("time = system.currenttimemillis();");\n                    method.insertafter("system.out.println(\\"---ç»ææ§è¡---\\");");\n                    method.insertafter("system.out.println(\\"è¿è¡èæ¶: \\" + (system.currenttimemillis() - time));");\n                }\n                return ctclass.tobytecode();\n            } catch (throwable e) { //è¿éè¦ç¨throwableï¼ä¸è¦ç¨exception\n                system.out.println(e.getmessage());\n                e.printstacktrace();\n            }\n        }\n        return classfilebuffer;\n    }\n\n}\n\n\nï¼4ï¼è¾åº\n\næå® vm åæ° -javaagent:f:\\code\\mycode\\agent-test\\runtime-agent\\target\\runtime-agent-1.0-snapshot.jar=helloï¼è¿è¡ appmain\n\næ¢éå¯å¨ï¼ï¼ï¼\næ¢éä¼ å¥åæ°ï¼hello\napp å¯å¨ï¼ï¼ï¼\næ¦æªå°çç±»åï¼io.github.dunwu.javacore.javaagent.appinit\ninitæ¹æ³è¢«æ¦æª\n---å¼å§æ§è¡---\nappåå§åä¸­...\n---ç»ææ§è¡---\nè¿è¡èæ¶: 1014\n\n\n# è¿è¡æ¶æ¦æªï¼jdk 1.6 åä»¥ä¸ï¼\n\nå¦ä½å®ç°å¨ç¨åºè¿è¡æ¶å»å®æå¨æä¿®æ¹å­èç å¢ï¼\n\nå¨æä¿®æ¹å­èç éè¦ä¾èµäº jdk ä¸ºæä»¬æä¾ç jvm å·¥å·ï¼ä¹å°±æ¯ä¸è¾¹æä»¬æå°ç attachï¼éè¿å®å»å è½½æä»¬çä»£çç¨åºã\n\né¦åæä»¬å¨ä»£çç¨åºä¸­éè¦å®ä¹ä¸ä¸ªåå­ä¸º agentmain çæ¹æ³ï¼å®å¯ä»¥åä¸è¾¹æä»¬æå°ç premain æ¯ä¸æ ·çåå®¹ï¼ä¹å¯æ ¹æ® agentmain çç¹æ§è¿è¡èªå·±é»è¾çå¼åã\n\n/**\n * agentmain å¨ main å½æ°å¼å§è¿è¡åæå¯å¨ï¼ä¾èµäºattachæºå¶ï¼\n */\npublic class runtimeagent {\n\n    public static void agentmain(string arg, instrumentation instrumentation) {\n        system.out.println("agentmainæ¢éå¯å¨ï¼ï¼ï¼");\n        system.out.println("agentmainæ¢éä¼ å¥åæ°ï¼" + arg);\n        instrumentation.addtransformer(new runtimetransformer());\n    }\n}\n\n\nç¶åå°±æ¯æä»¬éè¦å°éç½®ä¸­è®¾ç½®ï¼è®©å¶ç¥éæä»¬çæ¢ééè¦å è½½è¿ä¸ªç±»ï¼å¨ maven ä¸­è®¾ç½®å¦ä¸ï¼å¦ææ¯ meta-inf/manifest.mf æä»¶åçã\n\n\x3c!--<premain-class>com.zhj.agent.agentmain.runtimeagent</premain-class>--\x3e\n<agent-class>com.zhj.agent.agentmain.runtimeagent</agent-class>\n\n\nè¿æ ·å¶å®æä»¬çæ¢éå°±å·²ç»æ¹é å¥½äºï¼ç¶åæä»¬éè¦å¨ç®æ ç¨åºç main æ¹æ³ä¸­æ¤å¥ä¸äºä»£ç ï¼ä½¿å¶å¯ä»¥è¯»åå°æä»¬çä»£çç¨åºï¼è¿æ ·æä»¬ä¹æ éå»éç½® jvm çåæ°ï¼å°±å¯ä»¥å è½½æ¢éç¨åºã\n\npublic class appmain {\n\n    public static void main(string[] args) {\n        system.out.println("app å¯å¨ï¼ï¼ï¼");\n        for (virtualmachinedescriptor vmd : virtualmachine.list()) {\n            // æå®çvmæå¯ä»¥è¢«ä»£ç\n            if (true) {\n                system.out.println("è¯¥vmä¸ºæå®ä»£ççvm");\n                system.out.println(vmd.displayname());\n                try {\n                    virtualmachine vm = virtualmachine.attach(vmd.id());\n                    vm.loadagent("d:/code/java/idea_project/agent-test/runtime-agent/target/runtime-agent-1.0-snapshot.jar=hello");\n                    vm.detach();\n                } catch (exception e) {\n                    e.printstacktrace();\n                }\n            }\n        }\n        appinit.init();\n    }\n}\n\n\nå¶ä¸­ virtualmachine æ¯ jdk å·¥å·åä¸çç±»ï¼å¦æç³»ç»ç¯å¢åéæ²¡æéç½®ï¼éè¦èªå·±å¨ maven ä¸­å¼å¥æ¬å°æä»¶ã\n\n<dependency>\n    <groupid>com.sun</groupid>\n    <artifactid>tools</artifactid>\n    <version>1.8</version>\n    <scope>system</scope>\n    <systempath>d:/software/java_dev/java_jdk/lib/tools.jar</systempath>\n</dependency>\n\n\nè¿æ ·æä»¬å¨ç¨åºå¯å¨ååå»å¨æä¿®æ¹å­èç æä»¶çç®åæ¡ä¾å°±å®æäºã\n\n\n# å­èç å·¥å·\n\n * jclasslib - idea æä»¶ï¼å¯ä»¥ç´è§æ¥çå½åå­èç æä»¶çç±»ä¿¡æ¯ãå¸¸éæ± ãæ¹æ³åºç­ä¿¡æ¯ã\n * classpy - classpy æ¯ä¸ä¸ªç¨äºç ç©¶ java ç±»æä»¶ãlua äºè¿å¶åãwasm äºè¿å¶ä»£ç åå¶ä»äºè¿å¶æä»¶æ ¼å¼ç gui å·¥å·ã\n * asm bytecode outline - å©ç¨ asm æåå­èç æ¶ï¼éè¦å©ç¨ä¸ç³»å visitxxxxinsn() æ¹æ³æ¥åå¯¹åºçå©è®°ç¬¦ï¼æä»¥éè¦åå°æ¯ä¸è¡æºä»£ç è½¬åä¸ºä¸ä¸ªä¸ªçå©è®°ç¬¦ï¼ç¶åéè¿ asm çè¯­æ³è½¬æ¢ä¸º visitxxxxinsn() è¿ç§åæ³ãç¬¬ä¸æ­¥å°æºç è½¬åä¸ºå©è®°ç¬¦å°±å·²ç»å¤éº»ç¦äºï¼ä¸çæå­èç æä½éåçè¯ï¼éè¦æä»¬å°ä»£ç ç¼è¯åååç¼è¯ï¼æè½å¾å°æºä»£ç å¯¹åºçå©è®°ç¬¦ãç¬¬äºæ­¥å©ç¨ asm åå­èç æ¶ï¼å¦ä½ä¼ åä¹å¾ä»¤äººå¤´ç¼ãasm ç¤¾åºä¹ç¥éè¿ä¸¤ä¸ªé®é¢ï¼æä»¥æä¾äºæ­¤å·¥å·ã\n\n\n# åèèµæ\n\n * ä¹¦ç±\n   * ãæ·±å¥çè§£ java èææºã\n * æç« \n   * å­èç å¢å¼ºææ¯æ¢ç´¢\n   * è½»æ¾çæjavaå­èç \n   * java agent æ¢éææ¯\n * å­èç æ¡æ¶\n   * asm å®æ¹\n   * javassist github\n   * byte buddy github',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JVM ç±»å è½½",frontmatter:{title:"JVM ç±»å è½½",date:"2020-06-17T15:06:46.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM"],permalink:"/pages/17aad9/"},regularPath:"/01.Java/01.JavaSE/06.JVM/04.JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD.html",relativePath:"01.Java/01.JavaSE/06.JVM/04.JVMç±»å è½½.md",key:"v-5bfd289c",path:"/pages/17aad9/",headers:[{level:2,title:"ç±»å è½½æºå¶",slug:"ç±»å è½½æºå¶",normalizedTitle:"ç±»å è½½æºå¶",charIndex:16},{level:2,title:"ç±»ççå½å¨æ",slug:"ç±»ççå½å¨æ",normalizedTitle:"ç±»ççå½å¨æ",charIndex:376},{level:3,title:"ï¼ä¸ï¼å è½½",slug:"ä¸-å è½½",normalizedTitle:"ï¼ä¸ï¼å è½½",charIndex:689},{level:3,title:"ï¼äºï¼éªè¯",slug:"äº-éªè¯",normalizedTitle:"ï¼äºï¼éªè¯",charIndex:1234},{level:3,title:"ï¼ä¸ï¼åå¤",slug:"ä¸-åå¤",normalizedTitle:"ï¼ä¸ï¼åå¤",charIndex:1641},{level:3,title:"ï¼åï¼è§£æ",slug:"å-è§£æ",normalizedTitle:"ï¼åï¼è§£æ",charIndex:2980},{level:3,title:"ï¼äºï¼åå§å",slug:"äº-åå§å",normalizedTitle:"ï¼äºï¼åå§å",charIndex:3430},{level:4,title:"ç±»åå§åæ¹å¼",slug:"ç±»åå§åæ¹å¼",normalizedTitle:"ç±»åå§åæ¹å¼",charIndex:3733},{level:4,title:"ç±»åå§åæ­¥éª¤",slug:"ç±»åå§åæ­¥éª¤",normalizedTitle:"ç±»åå§åæ­¥éª¤",charIndex:3844},{level:4,title:"ç±»åå§åæ¶æº",slug:"ç±»åå§åæ¶æº",normalizedTitle:"ç±»åå§åæ¶æº",charIndex:3939},{level:4,title:"ç±»åå§åç»è",slug:"ç±»åå§åç»è",normalizedTitle:"ç±»åå§åç»è",charIndex:4613},{level:2,title:"ClassLoader",slug:"classloader",normalizedTitle:"classloader",charIndex:1214},{level:3,title:"ç±»ä¸ç±»å è½½å¨",slug:"ç±»ä¸ç±»å è½½å¨",normalizedTitle:"ç±»ä¸ç±»å è½½å¨",charIndex:6040},{level:3,title:"ç±»å è½½å¨åç±»",slug:"ç±»å è½½å¨åç±»",normalizedTitle:"ç±»å è½½å¨åç±»",charIndex:6243},{level:4,title:"Bootstrap ClassLoader",slug:"bootstrap-classloader",normalizedTitle:"bootstrap classloader",charIndex:6255},{level:4,title:"ExtClassLoader",slug:"extclassloader",normalizedTitle:"extclassloader",charIndex:6602},{level:4,title:"AppClassLoader",slug:"appclassloader",normalizedTitle:"appclassloader",charIndex:6803},{level:4,title:"èªå®ä¹ç±»å è½½å¨",slug:"èªå®ä¹ç±»å è½½å¨",normalizedTitle:"èªå®ä¹ç±»å è½½å¨",charIndex:6555},{level:3,title:"åäº²å§æ´¾",slug:"åäº²å§æ´¾",normalizedTitle:"åäº²å§æ´¾",charIndex:7421},{level:3,title:"ClassLoader åæ°",slug:"classloader-åæ°",normalizedTitle:"classloader åæ°",charIndex:11773},{level:2,title:"ç±»çå è½½",slug:"ç±»çå è½½",normalizedTitle:"ç±»çå è½½",charIndex:40},{level:3,title:"ç±»å è½½æ¹å¼",slug:"ç±»å è½½æ¹å¼",normalizedTitle:"ç±»å è½½æ¹å¼",charIndex:12473},{level:3,title:"å è½½ç±»éè¯¯",slug:"å è½½ç±»éè¯¯",normalizedTitle:"å è½½ç±»éè¯¯",charIndex:12914},{level:4,title:"ClassNotFoundException",slug:"classnotfoundexception",normalizedTitle:"classnotfoundexception",charIndex:7945},{level:4,title:"NoClassDefFoundError",slug:"noclassdeffounderror",normalizedTitle:"noclassdeffounderror",charIndex:13479},{level:4,title:"UnsatisfiedLinkError",slug:"unsatisfiedlinkerror",normalizedTitle:"unsatisfiedlinkerror",charIndex:13632},{level:4,title:"ClassCastException",slug:"classcastexception",normalizedTitle:"classcastexception",charIndex:14375},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:14987}],headersStr:"ç±»å è½½æºå¶ ç±»ççå½å¨æ ï¼ä¸ï¼å è½½ ï¼äºï¼éªè¯ ï¼ä¸ï¼åå¤ ï¼åï¼è§£æ ï¼äºï¼åå§å ç±»åå§åæ¹å¼ ç±»åå§åæ­¥éª¤ ç±»åå§åæ¶æº ç±»åå§åç»è ClassLoader ç±»ä¸ç±»å è½½å¨ ç±»å è½½å¨åç±» Bootstrap ClassLoader ExtClassLoader AppClassLoader èªå®ä¹ç±»å è½½å¨ åäº²å§æ´¾ ClassLoader åæ° ç±»çå è½½ ç±»å è½½æ¹å¼ å è½½ç±»éè¯¯ ClassNotFoundException NoClassDefFoundError UnsatisfiedLinkError ClassCastException åèèµæ",content:'# JVM ç±»å è½½\n\n\n\n\n# ç±»å è½½æºå¶\n\n> ç±»æ¯å¨è¿è¡æé´å¨æå è½½çã\n\nç±»çå è½½æçæ¯å°ç±»ç .class æä»¶ä¸­çäºè¿å¶æ°æ®è¯»å¥å°åå­ä¸­ï¼å°å¶æ¾å¨è¿è¡æ¶æ°æ®åºçæ¹æ³åºåï¼ç¶åå¨å åºåå»ºä¸ä¸ªjava.lang.Classå¯¹è±¡ï¼ç¨æ¥å°è£ç±»å¨æ¹æ³åºåçæ°æ®ç»æãç±»çå è½½çæç»äº§åæ¯ä½äºå åºä¸­çClasså¯¹è±¡ï¼Classå¯¹è±¡å°è£äºç±»å¨æ¹æ³åºåçæ°æ®ç»æï¼å¹¶ä¸å Java ç¨åºåæä¾äºè®¿é®æ¹æ³åºåçæ°æ®ç»æçæ¥å£ã\n\nç±»å è½½å¨å¹¶ä¸éè¦ç­å°æä¸ªç±»è¢«âé¦æ¬¡ä¸»å¨ä½¿ç¨âæ¶åå è½½å®ï¼JVM è§èåè®¸ç±»å è½½å¨å¨é¢ææä¸ªç±»å°è¦è¢«ä½¿ç¨æ¶å°±é¢åå è½½å®ï¼å¦æå¨é¢åå è½½çè¿ç¨ä¸­éå°äº.class æä»¶ç¼ºå¤±æå­å¨éè¯¯ï¼ç±»å è½½å¨å¿é¡»å¨ç¨åºé¦æ¬¡ä¸»å¨ä½¿ç¨è¯¥ç±»æ¶ææ¥åéè¯¯ï¼LinkageError éè¯¯ï¼å¦æè¿ä¸ªç±»ä¸ç´æ²¡æè¢«ç¨åºä¸»å¨ä½¿ç¨ï¼é£ä¹ç±»å è½½å¨å°±ä¸ä¼æ¥åéè¯¯\n\n\n# ç±»ççå½å¨æ\n\n\n\nJava ç±»çå®æ´çå½å¨æåæ¬ä»¥ä¸å ä¸ªé¶æ®µï¼\n\n * å è½½ï¼Loadingï¼\n * é¾æ¥ï¼Linkingï¼\n   * éªè¯ï¼Verificationï¼\n   * åå¤ï¼Preparationï¼\n   * è§£æï¼Resolutionï¼\n * åå§åï¼Initializationï¼\n * ä½¿ç¨ï¼Usingï¼\n * å¸è½½ï¼Unloadingï¼\n\nå è½½ãéªè¯ãåå¤ãåå§ååå¸è½½è¿ 5 ä¸ªé¶æ®µçé¡ºåºæ¯ç¡®å®çï¼ç±»çå è½½è¿ç¨å¿é¡»æç§è¿ç§é¡ºåºæé¨å°±ç­å°å¼å§ãèè§£æè¿ç¨å¨æäºæåµä¸å¯ä»¥å¨åå§åé¶æ®µä¹ååå¼å§ï¼è¿æ¯ä¸ºäºæ¯æ Java çå¨æç»å®ã\n\nç±»å è½½è¿ç¨æ¯æå è½½ãéªè¯ãåå¤ãè§£æååå§åè¿ 5 ä¸ªé¶æ®µã\n\n\n# ï¼ä¸ï¼å è½½\n\nå è½½æ¯ç±»å è½½çä¸ä¸ªé¶æ®µï¼æ³¨æä¸è¦æ··æ·ã\n\nå è½½ï¼æ¯ææ¥æ¾å­èæµï¼å¹¶ä¸æ®æ­¤åå»ºç±»çè¿ç¨ã\n\nå è½½è¿ç¨å®æä»¥ä¸ä¸ä»¶äºï¼\n\n * éè¿ä¸ä¸ªç±»çå¨éå®åæ¥è·åå®ä¹æ­¤ç±»çäºè¿å¶å­èæµã\n * å°è¿ä¸ªå­èæµæä»£è¡¨çéæå­å¨ç»æè½¬åä¸ºæ¹æ³åºçè¿è¡æ¶å­å¨ç»æã\n * å¨åå­ä¸­çæä¸ä¸ªä»£è¡¨è¿ä¸ªç±»ç Class å¯¹è±¡ï¼ä½ä¸ºæ¹æ³åºè¿ä¸ªç±»çåç§æ°æ®çè®¿é®å¥å£ã\n\nå¶ä¸­äºè¿å¶å­èæµå¯ä»¥ä»ä»¥ä¸æ¹å¼ä¸­è·åï¼\n\n * ä» ZIP åè¯»åï¼è¿å¾å¸¸è§ï¼æç»æä¸ºæ¥å JARãEARãWAR æ ¼å¼çåºç¡ã\n * ä»ç½ç»ä¸­è·åï¼è¿ç§åºæ¯æå¸åçåºç¨æ¯ Appletã\n * è¿è¡æ¶è®¡ç®çæï¼è¿ç§åºæ¯ä½¿ç¨å¾æå¤å¾å°±æ¯å¨æä»£çææ¯ï¼å¨ java.lang.reflect.Proxy ä¸­ï¼å°±æ¯ç¨äº ProxyGenerator.generateProxyClass çä»£çç±»çäºè¿å¶å­èæµã\n * ç±å¶ä»æä»¶çæï¼å¸ååºæ¯æ¯ JSP åºç¨ï¼å³ç± JSP æä»¶çæå¯¹åºç Class ç±»ã\n * ä»æ°æ®åºè¯»åï¼è¿ç§åºæ¯ç¸å¯¹å°è§ï¼ä¾å¦æäºä¸­é´ä»¶æå¡å¨ï¼å¦ SAP Netweaverï¼å¯ä»¥éæ©æç¨åºå®è£å°æ°æ®åºä¸­æ¥å®æç¨åºä»£ç å¨éç¾¤é´çååã ...\n\n> æ´è¯¦ç»åå®¹ä¼å¨ 3. ClassLoader ä»ç»ã\n\n\n# ï¼äºï¼éªè¯\n\néªè¯æ¯é¾æ¥é¶æ®µçç¬¬ä¸æ­¥ãéªè¯çç®æ æ¯ç¡®ä¿ Class æä»¶çå­èæµä¸­åå«çä¿¡æ¯ç¬¦åå½åèææºçè¦æ±ï¼å¹¶ä¸ä¸ä¼å±å®³èææºèªèº«çå®å¨ã\n\néªè¯é¶æ®µå¤§è´ä¼å®æ 4 ä¸ªé¶æ®µçæ£éªå¨ä½ï¼\n\n * æä»¶æ ¼å¼éªè¯ - éªè¯å­èæµæ¯å¦ç¬¦å Class æä»¶æ ¼å¼çè§èï¼å¹¶ä¸è½è¢«å½åçæ¬çèææºå¤çã\n * åæ°æ®éªè¯ - å¯¹å­èç æè¿°çä¿¡æ¯è¿è¡è¯­ä¹åæï¼ä»¥ä¿è¯å¶æè¿°çä¿¡æ¯ç¬¦å Java è¯­è¨è§èçè¦æ±ã\n * å­èç éªè¯ - éè¿æ°æ®æµåæ§å¶æµåæï¼ç¡®ä¿ç¨åºè¯­ä¹æ¯åæ³ãç¬¦åé»è¾çã\n * ç¬¦å·å¼ç¨éªè¯ - åçå¨èææºå°ç¬¦å·å¼ç¨è½¬æ¢ä¸ºç´æ¥å¼ç¨çæ¶åï¼å¯¹ç±»èªèº«ä»¥å¤ï¼å¸¸éæ± ä¸­çåç§ç¬¦å·å¼ç¨ï¼çä¿¡æ¯è¿è¡å¹éæ§æ ¡éªã\n\néªè¯é¶æ®µæ¯éå¸¸éè¦çï¼ä½ä¸æ¯å¿é¡»çï¼å®å¯¹ç¨åºè¿è¡ææ²¡æå½±åï¼å¦ææå¼ç¨çç±»ç»è¿åå¤éªè¯ï¼é£ä¹å¯ä»¥èèéç¨ -Xverifynone åæ°æ¥å³é­å¤§é¨åçç±»éªè¯æªæ½ï¼ä»¥ç¼©ç­èææºç±»å è½½çæ¶é´ã\n\n\n# ï¼ä¸ï¼åå¤\n\nç±»åéæ¯è¢« static ä¿®é¥°çåéï¼åå¤é¶æ®µä¸º static åéå¨æ¹æ³åºåéåå­å¹¶åå§åä¸ºé»è®¤å¼ï¼ä½¿ç¨çæ¯æ¹æ³åºçåå­ã\n\nå®ä¾åéä¸ä¼å¨è¿é¶æ®µåéåå­ï¼å®å°ä¼å¨å¯¹è±¡å®ä¾åæ¶éçå¯¹è±¡ä¸èµ·åéå¨ Java å ä¸­ãï¼å®ä¾åä¸æ¯ç±»å è½½çä¸ä¸ªè¿ç¨ï¼ç±»å è½½åçå¨ææå®ä¾åæä½ä¹åï¼å¹¶ä¸ç±»å è½½åªè¿è¡ä¸æ¬¡ï¼å®ä¾åå¯ä»¥è¿è¡å¤æ¬¡ï¼\n\nåå§å¼ä¸è¬ä¸º 0 å¼ï¼ä¾å¦ä¸é¢çç±»åé value è¢«åå§åä¸º 0 èä¸æ¯ 123ã\n\npublic static int value = 123;\n\n\nå¦æç±»åéæ¯å¸¸éï¼é£ä¹ä¼æç§è¡¨è¾¾å¼æ¥è¿è¡åå§åï¼èä¸æ¯èµå¼ä¸º 0ã\n\npublic static final int value = 123;\n\n\nåå¤é¶æ®µæä»¥ä¸å ç¹éè¦æ³¨æï¼\n\n * è¿æ¶åè¿è¡åå­åéçä»åæ¬ç±»åéï¼staticï¼ï¼èä¸åæ¬å®ä¾åéï¼å®ä¾åéä¼å¨å¯¹è±¡å®ä¾åæ¶éçå¯¹è±¡ä¸ååéå¨ Java å ä¸­ã\n * è¿éæè®¾ç½®çåå§å¼éå¸¸æåµä¸æ¯æ°æ®ç±»åé»è®¤çé¶å¼ï¼å¦ 0ã0Lãnullãfalse ç­ï¼ï¼èä¸æ¯è¢«å¨ Java ä»£ç ä¸­è¢«æ¾å¼å°èµäºçå¼ã\n\nåè®¾ä¸ä¸ªç±»åéçå®ä¹ä¸ºï¼public static int value = 3ï¼\n\né£ä¹åé value å¨åå¤é¶æ®µè¿åçåå§å¼ä¸º 0ï¼èä¸æ¯ 3ï¼å ä¸ºè¿æ¶åå°æªå¼å§æ§è¡ä»»ä½ Java æ¹æ³ï¼èæ value èµå¼ä¸º 3 çpublic staticæä»¤æ¯å¨ç¨åºç¼è¯åï¼å­æ¾äºç±»æé å¨ï¼ï¼æ¹æ³ä¹ä¸­çï¼æä»¥æ value èµå¼ä¸º 3 çå¨ä½å°å¨åå§åé¶æ®µæä¼æ§è¡ã\n\n> è¿éè¿éè¦æ³¨æå¦ä¸å ç¹ï¼\n> \n>  * å¯¹åºæ¬æ°æ®ç±»åæ¥è¯´ï¼å¯¹äºç±»åéï¼staticï¼åå¨å±åéï¼å¦æä¸æ¾å¼å°å¯¹å¶èµå¼èç´æ¥ä½¿ç¨ï¼åç³»ç»ä¼ä¸ºå¶èµäºé»è®¤çé¶å¼ï¼èå¯¹äºå±é¨åéæ¥è¯´ï¼å¨ä½¿ç¨åå¿é¡»æ¾å¼å°ä¸ºå¶èµå¼ï¼å¦åç¼è¯æ¶ä¸éè¿ã\n>  * å¯¹äºåæ¶è¢« static å final ä¿®é¥°çå¸¸éï¼å¿é¡»å¨å£°æçæ¶åå°±ä¸ºå¶æ¾å¼å°èµå¼ï¼å¦åç¼è¯æ¶ä¸éè¿ï¼èåªè¢« final ä¿®é¥°çå¸¸éåæ¢å¯ä»¥å¨å£°ææ¶æ¾å¼å°ä¸ºå¶èµå¼ï¼ä¹å¯ä»¥å¨ç±»åå§åæ¶æ¾å¼å°ä¸ºå¶èµå¼ï¼æ»ä¹ï¼å¨ä½¿ç¨åå¿é¡»ä¸ºå¶æ¾å¼å°èµå¼ï¼ç³»ç»ä¸ä¼ä¸ºå¶èµäºé»è®¤é¶å¼ã\n>  * å¯¹äºå¼ç¨æ°æ®ç±»å reference æ¥è¯´ï¼å¦æ°ç»å¼ç¨ãå¯¹è±¡å¼ç¨ç­ï¼å¦ææ²¡æå¯¹å¶è¿è¡æ¾å¼å°èµå¼èç´æ¥ä½¿ç¨ï¼ç³»ç»é½ä¼ä¸ºå¶èµäºé»è®¤çé¶å¼ï¼å³ nullã\n>  * å¦æå¨æ°ç»åå§åæ¶æ²¡æå¯¹æ°ç»ä¸­çååç´ èµå¼ï¼é£ä¹å¶ä¸­çåç´ å°æ ¹æ®å¯¹åºçæ°æ®ç±»åèè¢«èµäºé»è®¤çé¶å¼ã\n\n * å¦æç±»å­æ®µçå­æ®µå±æ§è¡¨ä¸­å­å¨ConstantValueå±æ§ï¼å³åæ¶è¢« final å static ä¿®é¥°ï¼é£ä¹å¨åå¤é¶æ®µåé value å°±ä¼è¢«åå§åä¸º ConstValue å±æ§ææå®çå¼ã\n\nåè®¾ä¸é¢çç±»åé value è¢«å®ä¹ä¸ºï¼ public static final int value = 3ï¼\n\nç¼è¯æ¶ Javac å°ä¼ä¸º value çæ ConstantValue å±æ§ï¼å¨åå¤é¶æ®µèææºå°±ä¼æ ¹æ®ConstantValueçè®¾ç½®å° value èµå¼ä¸º 3ãæä»¬å¯ä»¥çè§£ä¸º static final å¸¸éå¨ç¼è¯æå°±å°å¶ç»ææ¾å¥äºè°ç¨å®çç±»çå¸¸éæ± ä¸­\n\n\n# ï¼åï¼è§£æ\n\nå¨ class æä»¶è¢«å è½½è³ Java èææºä¹åï¼è¿ä¸ªç±»æ æ³ç¥éå¶ä»ç±»åå¶æ¹æ³ãå­æ®µæå¯¹åºçå·ä½å°åï¼çè³ä¸ç¥éèªå·±æ¹æ³ãå­æ®µçå°åãå æ­¤ï¼æ¯å½éè¦å¼ç¨è¿äºæåæ¶ï¼Java ç¼è¯å¨ä¼çæä¸ä¸ªç¬¦å·å¼ç¨ãå¨è¿è¡é¶æ®µï¼è¿ä¸ªç¬¦å·å¼ç¨ä¸è¬é½è½å¤æ æ­§ä¹å°å®ä½å°å·ä½ç®æ ä¸ã\n\nä¸¾ä¾æ¥è¯´ï¼å¯¹äºä¸ä¸ªæ¹æ³è°ç¨ï¼ç¼è¯å¨ä¼çæä¸ä¸ªåå«ç®æ æ¹æ³æå¨ç±»çåå­ãç®æ æ¹æ³çåå­ãæ¥æ¶åæ°ç±»åä»¥åè¿åå¼ç±»åçç¬¦å·å¼ç¨ï¼æ¥æä»£æè¦è°ç¨çæ¹æ³ã\n\nè§£æé¶æ®µç®æ æ¯å°å¸¸éæ± çç¬¦å·å¼ç¨æ¿æ¢ä¸ºç´æ¥å¼ç¨çè¿ç¨ãè§£æå¨ä½ä¸»è¦éå¯¹ç±»ææ¥å£ãå­æ®µãç±»æ¹æ³ãæ¥å£æ¹æ³ãæ¹æ³ç±»åãæ¹æ³å¥æåè°ç¨ç¹éå®ç¬¦ 7 ç±»ç¬¦å·å¼ç¨è¿è¡ã\n\n * ç¬¦å·å¼ç¨ï¼Symbolic Referencesï¼ - ç¬¦å·å¼ç¨ä»¥ä¸ç»ç¬¦å·æ¥æè¿°æå¼ç¨çç®æ ï¼ç¬¦å·å¯ä»¥æ¯ä»»ä½å½¢å¼çå­é¢éï¼åªè¦ä½¿ç¨æ¶è½æ æ­§ä¹å°å®ä½å°ç®æ å³å¯ã\n * ç´æ¥å¼ç¨ï¼Direct Referenceï¼ - ç´æ¥å¼ç¨å¯ä»¥æ¯ç´æ¥æåç®æ çæéãç¸å¯¹åç§»éææ¯ä¸ä¸ªè½é´æ¥å®ä½å°ç®æ çå¥æã\n\n\n# ï¼äºï¼åå§å\n\nå¨ Java ä»£ç ä¸­ï¼å¦æè¦åå§åä¸ä¸ªéæå­æ®µï¼å¯ä»¥å¨å£°ææ¶ç´æ¥èµå¼ï¼ä¹å¯ä»¥å¨éæä»£ç åä¸­å¯¹å¶èµå¼ã\n\nå¦æç´æ¥èµå¼çéæå­æ®µè¢« final æä¿®é¥°ï¼å¹¶ä¸å®çç±»åæ¯åºæ¬ç±»åæå­ç¬¦ä¸²æ¶ï¼é£ä¹è¯¥å­æ®µä¾¿ä¼è¢« Java ç¼è¯å¨æ è®°æå¸¸éå¼ï¼ConstantValueï¼ï¼å¶åå§åç´æ¥ç± Java èææºå®æãé¤æ­¤ä¹å¤çç´æ¥èµå¼æä½ï¼ä»¥åææéæä»£ç åä¸­çä»£ç ï¼åä¼è¢« Java ç¼è¯å¨ç½®äºåä¸æ¹æ³ä¸­ï¼å¹¶æå®å½åä¸º < clinit >ã\n\nåå§åé¶æ®µæçæ­£å¼å§æ§è¡ç±»ä¸­çå®ä¹ç Java ç¨åºä»£ç ãåå§åï¼ä¸ºç±»çéæåéèµäºæ­£ç¡®çåå§å¼ï¼JVM è´è´£å¯¹ç±»è¿è¡åå§åï¼ä¸»è¦å¯¹ç±»åéè¿è¡åå§åã\n\n# ç±»åå§åæ¹å¼\n\n * å£°æç±»åéæ¶æå®åå§å¼\n * ä½¿ç¨éæä»£ç åä¸ºç±»åéæå®åå§å¼\n\n> å¨åå¤é¶æ®µï¼ç±»åéå·²ç»èµè¿ä¸æ¬¡ç³»ç»è¦æ±çåå§å¼ï¼èå¨åå§åé¶æ®µï¼æ ¹æ®ç¨åºåéè¿ç¨åºå¶å®çä¸»è§è®¡åå»åå§åç±»åéåå¶å®èµæºã\n\n# ç±»åå§åæ­¥éª¤\n\n 1. å¦æç±»è¿æ²¡æè¢«å è½½åé¾æ¥ï¼å¼å§å è½½è¯¥ç±»ã\n 2. å¦æè¯¥ç±»çç´æ¥ç¶ç±»è¿æ²¡æè¢«åå§åï¼ååå§åå¶ç¶ç±»ã\n 3. å¦æè¯¥ç±»æåå§åè¯­å¥ï¼åä¾æ¬¡æ§è¡è¿äºåå§åè¯­å¥ã\n\n# ç±»åå§åæ¶æº\n\nåªæä¸»å¨å¼ç¨ç±»çæ¶åæä¼å¯¼è´ç±»çåå§åã\n\nï¼1ï¼ä¸»å¨å¼ç¨\n\nç±»çä¸»å¨å¼ç¨åæ¬ä»¥ä¸å­ç§ï¼\n\n * åå»ºç±»çå®ä¾ - ä¹å°±æ¯ new å¯¹è±¡\n * è®¿é®éæåé - è®¿é®æä¸ªç±»ææ¥å£çéæåéï¼æèå¯¹è¯¥éæåéèµå¼\n * è®¿é®éææ¹æ³\n * åå° - å¦Class.forName(âcom.shengsiyuan.Testâ)\n * åå§åå­ç±» - åå§åæä¸ªç±»çå­ç±»ï¼åå¶ç¶ç±»ä¹ä¼è¢«åå§å\n * å¯å¨ç±» - Java èææºå¯å¨æ¶è¢«æ æä¸ºå¯å¨ç±»çç±»ï¼Java Testï¼ï¼ç´æ¥ä½¿ç¨java.exeå½ä»¤æ¥è¿è¡æä¸ªä¸»ç±»\n\nï¼2ï¼è¢«å¨å¼ç¨\n\nä»¥ä¸ 5 ç§åºæ¯ä¸­çè¡ä¸ºç§°ä¸ºå¯¹ä¸ä¸ªç±»è¿è¡ä¸»å¨å¼ç¨ãé¤æ­¤ä¹å¤ï¼ææå¼ç¨ç±»çæ¹å¼é½ä¸ä¼è§¦ååå§åï¼ç§°ä¸ºè¢«å¨å¼ç¨ãè¢«å¨å¼ç¨çå¸¸è§ä¾å­åæ¬ï¼\n\n * éè¿å­ç±»å¼ç¨ç¶ç±»çéæå­æ®µï¼ä¸ä¼å¯¼è´å­ç±»åå§åã\n\nSystem.out.println(SubClass.value); // value å­æ®µå¨ SuperClass ä¸­å®ä¹\n\n\n * éè¿æ°ç»å®ä¹æ¥å¼ç¨ç±»ï¼ä¸ä¼è§¦åæ­¤ç±»çåå§åãè¯¥è¿ç¨ä¼å¯¹æ°ç»ç±»è¿è¡åå§åï¼æ°ç»ç±»æ¯ä¸ä¸ªç±èææºèªå¨çæçãç´æ¥ç»§æ¿èª Object çå­ç±»ï¼å¶ä¸­åå«äºæ°ç»çå±æ§åæ¹æ³ã\n\nSuperClass[] sca = new SuperClass[10];\n\n\n * å¸¸éå¨ç¼è¯é¶æ®µä¼å­å¥è°ç¨ç±»çå¸¸éæ± ä¸­ï¼æ¬è´¨ä¸å¹¶æ²¡æç´æ¥å¼ç¨å°å®ä¹å¸¸éçç±»ï¼å æ­¤ä¸ä¼è§¦åå®ä¹å¸¸éçç±»çåå§åã\n\nSystem.out.println(ConstClass.HELLOWORLD);\n\n\n# ç±»åå§åç»è\n\nç±»åå§å <clinit>() æ¹æ³çç»èï¼\n\n * æ¯ç±ç¼è¯å¨èªå¨æ¶éç±»ä¸­ææç±»åéçèµå¼å¨ä½åéæè¯­å¥åï¼static{} åï¼ä¸­çè¯­å¥åå¹¶äº§ççï¼ç¼è¯å¨æ¶éçé¡ºåºç±è¯­å¥å¨æºæä»¶ä¸­åºç°çé¡ºåºå³å®ãç¹å«æ³¨æçæ¯ï¼éæè¯­å¥ååªè½è®¿é®å°å®ä¹å¨å®ä¹åçç±»åéï¼å®ä¹å¨å®ä¹åçç±»åéåªè½èµå¼ï¼ä¸è½è®¿é®ãä¾å¦ä»¥ä¸ä»£ç ï¼\n\npublic class Test {\n    static {\n        i = 0;                // ç»åéèµå¼å¯ä»¥æ­£å¸¸ç¼è¯éè¿\n        System.out.print(i);  // è¿å¥ç¼è¯å¨ä¼æç¤ºâéæ³ååå¼ç¨â\n    }\n    static int i = 1;\n}\n\n\n * ä¸ç±»çæé å½æ°ï¼æèè¯´å®ä¾æé å¨ <init>()ï¼ä¸åï¼ä¸éè¦æ¾å¼çè°ç¨ç¶ç±»çæé å¨ãèææºä¼èªå¨ä¿è¯å¨å­ç±»ç <clinit>() æ¹æ³è¿è¡ä¹åï¼ç¶ç±»ç <clinit>() æ¹æ³å·²ç»æ§è¡ç»æãå æ­¤èææºä¸­ç¬¬ä¸ä¸ªæ§è¡ <clinit>() æ¹æ³çç±»è¯å®ä¸º java.lang.Objectã\n * ç±äºç¶ç±»ç <clinit>() æ¹æ³åæ§è¡ï¼ä¹å°±æå³çç¶ç±»ä¸­å®ä¹çéæè¯­å¥åè¦ä¼äºå­ç±»çåéèµå¼æä½ãä¾å¦ä»¥ä¸ä»£ç ï¼\n\nstatic class Parent {\n    public static int A = 1;\n    static {\n        A = 2;\n    }\n}\n\nstatic class Sub extends Parent {\n    public static int B = A;\n}\n\npublic static void main(String[] args) {\n     System.out.println(Sub.B);  // è¾åºç»ææ¯ç¶ç±»ä¸­çéæåé A çå¼ï¼ä¹å°±æ¯ 2ã\n}\n\n\n * <clinit>() æ¹æ³å¯¹äºç±»ææ¥å£ä¸æ¯å¿é¡»çï¼å¦æä¸ä¸ªç±»ä¸­ä¸åå«éæè¯­å¥åï¼ä¹æ²¡æå¯¹ç±»åéçèµå¼æä½ï¼ç¼è¯å¨å¯ä»¥ä¸ä¸ºè¯¥ç±»çæ <clinit>() æ¹æ³ã\n * æ¥å£ä¸­ä¸å¯ä»¥ä½¿ç¨éæè¯­å¥åï¼ä½ä»ç¶æç±»åéåå§åçèµå¼æä½ï¼å æ­¤æ¥å£ä¸ç±»ä¸æ ·é½ä¼çæ <clinit>() æ¹æ³ãä½æ¥å£ä¸ç±»ä¸åçæ¯ï¼æ§è¡æ¥å£ç <clinit>() æ¹æ³ä¸éè¦åæ§è¡ç¶æ¥å£ç <clinit>() æ¹æ³ãåªæå½ç¶æ¥å£ä¸­å®ä¹çåéä½¿ç¨æ¶ï¼ç¶æ¥å£æä¼åå§åãå¦å¤ï¼æ¥å£çå®ç°ç±»å¨åå§åæ¶ä¹ä¸æ ·ä¸ä¼æ§è¡æ¥å£ç <clinit>() æ¹æ³ã\n * èææºä¼ä¿è¯ä¸ä¸ªç±»ç <clinit>() æ¹æ³å¨å¤çº¿ç¨ç¯å¢ä¸è¢«æ­£ç¡®çå éååæ­¥ï¼å¦æå¤ä¸ªçº¿ç¨åæ¶åå§åä¸ä¸ªç±»ï¼åªä¼æä¸ä¸ªçº¿ç¨æ§è¡è¿ä¸ªç±»ç <clinit>() æ¹æ³ï¼å¶å®çº¿ç¨é½ä¼é»å¡ç­å¾ï¼ç´å°æ´»å¨çº¿ç¨æ§è¡ <clinit>() æ¹æ³å®æ¯ãå¦æå¨ä¸ä¸ªç±»ç <clinit>() æ¹æ³ä¸­æèæ¶çæä½ï¼å°±å¯è½é æå¤ä¸ªçº¿ç¨é»å¡ï¼å¨å®éè¿ç¨ä¸­æ­¤ç§é»å¡å¾éè½ã\n\n\n# ClassLoader\n\nClassLoader å³ç±»å è½½å¨ï¼è´è´£å°ç±»å è½½å° JVMãå¨ Java èææºå¤é¨å®ç°ï¼ä»¥ä¾¿è®©åºç¨ç¨åºèªå·±å³å®å¦ä½å»è·åæéè¦çç±»ã\n\nJVM å è½½ class æä»¶å°åå­æä¸¤ç§æ¹å¼ï¼\n\n * éå¼å è½½ - JVM èªå¨å è½½éè¦çç±»å°åå­ä¸­ã\n * æ¾ç¤ºå è½½ - éè¿ä½¿ç¨ ClassLoader æ¥å è½½ä¸ä¸ªç±»å°åå­ä¸­ã\n\n\n# ç±»ä¸ç±»å è½½å¨\n\nå¦ä½å¤æ­ä¸¤ä¸ªç±»æ¯å¦ç¸ç­ï¼ç±»æ¬èº«ç¸ç­ï¼å¹¶ä¸ä½¿ç¨åä¸ä¸ªç±»å è½½å¨è¿è¡å è½½ãè¿æ¯å ä¸ºæ¯ä¸ä¸ª ClassLoader é½æ¥æä¸ä¸ªç¬ç«çç±»åç§°ç©ºé´ã\n\nè¿éçç¸ç­ï¼åæ¬ç±»ç Class å¯¹è±¡ç equals() æ¹æ³ãisAssignableFrom() æ¹æ³ãisInstance() æ¹æ³çè¿åç»æä¸º trueï¼ä¹åæ¬ä½¿ç¨ instanceof å³é®å­åå¯¹è±¡æå±å³ç³»å¤å®ç»æä¸º trueã\n\n\n# ç±»å è½½å¨åç±»\n\n\n\n# Bootstrap ClassLoader\n\nBootstrap ClassLoader ï¼å³å¯å¨ç±»å è½½å¨ ï¼è´è´£å è½½ JVM èªèº«å·¥ä½æéè¦çç±»ã\n\nBootstrap ClassLoader ä¼å°å­æ¾å¨ <JAVA_HOME>\\lib ç®å½ä¸­çï¼æèè¢« -Xbootclasspath åæ°ææå®çè·¯å¾ä¸­çï¼å¹¶ä¸æ¯èææºè¯å«çï¼ä»æç§æä»¶åè¯å«ï¼å¦ rt.jarï¼åå­ä¸ç¬¦åçç±»åºå³ä½¿æ¾å¨ lib ç®å½ä¸­ä¹ä¸ä¼è¢«å è½½ï¼ç±»åºå è½½å°èææºåå­ä¸­ã\n\nBootstrap ClassLoader æ¯ç± C++ å®ç°çï¼å®å®å¨ç± JVM èªå·±æ§å¶çï¼å¯å¨ç±»å è½½å¨æ æ³è¢« Java ç¨åºç´æ¥å¼ç¨ï¼ç¨æ·å¨ç¼åèªå®ä¹ç±»å è½½å¨æ¶ï¼å¦æéè¦æå è½½è¯·æ±å§æ´¾ç»å¯å¨ç±»å è½½å¨ï¼ç´æ¥ä½¿ç¨ null ä»£æ¿å³å¯ã\n\n# ExtClassLoader\n\nExtClassLoaderï¼å³æ©å±ç±»å è½½å¨ï¼è¿ä¸ªç±»å è½½å¨æ¯ç± ExtClassLoader(sun.misc.Launcher\\$ExtClassLoader)å®ç°çã\n\nExtClassLoader è´è´£å° <JAVA_HOME>\\lib\\ext æèè¢« java.ext.dir ç³»ç»åéææå®è·¯å¾ä¸­çææç±»åºå è½½å°åå­ä¸­ï¼å¼åèå¯ä»¥ç´æ¥ä½¿ç¨æ©å±ç±»å è½½å¨ã\n\n# AppClassLoader\n\nAppClassLoaderï¼å³åºç¨ç¨åºç±»å è½½å¨ï¼è¿ä¸ªç±»å è½½å¨æ¯ç± AppClassLoader(sun.misc.Launcher\\$AppClassLoader) å®ç°çãç±äºè¿ä¸ªç±»å è½½å¨æ¯ ClassLoader ä¸­ç getSystemClassLoader() æ¹æ³çè¿åå¼ï¼å æ­¤ä¸è¬ç§°ä¸ºç³»ç»ç±»å è½½å¨ã\n\nAppClassLoader è´è´£å è½½ç¨æ·ç±»è·¯å¾ï¼å³ classpathï¼ä¸ææå®çç±»åºï¼å¼åèå¯ä»¥ç´æ¥ä½¿ç¨è¿ä¸ªç±»å è½½å¨ï¼å¦æåºç¨ç¨åºä¸­æ²¡æèªå®ä¹è¿èªå·±çç±»å è½½å¨ï¼ä¸è¬æåµä¸è¿ä¸ªå°±æ¯ç¨åºä¸­é»è®¤çç±»å è½½å¨ã\n\n# èªå®ä¹ç±»å è½½å¨\n\nèªå®ä¹ç±»å è½½å¨å¯ä»¥åå°å¦ä¸å ç¹ï¼\n\n * å¨æ§è¡éç½®ä¿¡ä»£ç ä¹åï¼èªå¨éªè¯æ°å­ç­¾åã\n * å¨æå°åå»ºç¬¦åç¨æ·ç¹å®éè¦çå®å¶åæå»ºç±»ã\n * ä»ç¹å®çåºæåå¾ java classï¼ä¾å¦æ°æ®åºä¸­åç½ç»ä¸­ã\n\nåè®¾ï¼æä»¬éè¦èªå®ä¹ä¸ä¸ªåä¸º FileSystemClassLoader çç±»å è½½å¨ï¼ç»§æ¿èª java.lang.ClassLoaderï¼ç¨äºå è½½æä»¶ç³»ç»ä¸çç±»ãå®é¦åæ ¹æ®ç±»çå¨åå¨æä»¶ç³»ç»ä¸æ¥æ¾ç±»çå­èä»£ç æä»¶ï¼.class æä»¶ï¼ï¼ç¶åè¯»åè¯¥æä»¶åå®¹ï¼æåéè¿ defineClass() æ¹æ³æ¥æè¿äºå­èä»£ç è½¬æ¢æ java.lang.Class ç±»çå®ä¾ã\n\njava.lang.ClassLoader ç±»çæ¹æ³ loadClass() å®ç°äºåäº²å§æ´¾æ¨¡åçé»è¾ï¼å æ­¤èªå®ä¹ç±»å è½½å¨ä¸è¬ä¸å»è¦åå®ï¼èæ¯éè¿è¦å findClass() æ¹æ³ã\n\nClassLoader å¸¸ç¨çåºæ¯ï¼\n\n * å®¹å¨ - å¸ååºç¨ï¼Servlet å®¹å¨ï¼å¦ï¼TomcatãJettyï¼ãudf ï¼MysqlãHiveï¼ç­ãå è½½è§£å jar åæ war ååï¼å è½½å¶ Class å°æå®çç±»å è½½å¨ä¸­è¿è¡ï¼éå¸¸éè¦èèç©ºé´éç¦»ï¼ã\n * ç­é¨ç½²ãç­ææ - åºç¨å¯å¨åï¼å¨æè·å¾æä¸ªç±»ä¿¡æ¯ï¼ç¶åå è½½å° JVM ä¸­å·¥ä½ãå¾å¤èåçå®¹å¨è½¯ä»¶ãæ¡æ¶ï¼å¦ï¼Spring ç­ï¼ï¼é½ä½¿ç¨ ClassLoader æ¥å®ç°èªèº«çç­é¨ç½²ã\n\nãç¤ºä¾ãèªå®ä¹ä¸ä¸ªç±»å è½½å¨\n\npublic class FileSystemClassLoader extends ClassLoader {\n\n    private String rootDir;\n\n    public FileSystemClassLoader(String rootDir) {\n        this.rootDir = rootDir;\n    }\n\n    protected Class<?> findClass(String name) throws ClassNotFoundException {\n        byte[] classData = getClassData(name);\n        if (classData == null) {\n            throw new ClassNotFoundException();\n        } else {\n            return defineClass(name, classData, 0, classData.length);\n        }\n    }\n\n    private byte[] getClassData(String className) {\n        String path = classNameToPath(className);\n        try {\n            InputStream ins = new FileInputStream(path);\n            ByteArrayOutputStream baos = new ByteArrayOutputStream();\n            int bufferSize = 4096;\n            byte[] buffer = new byte[bufferSize];\n            int bytesNumRead;\n            while ((bytesNumRead = ins.read(buffer)) != -1) {\n                baos.write(buffer, 0, bytesNumRead);\n            }\n            return baos.toByteArray();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    private String classNameToPath(String className) {\n        return rootDir + File.separatorChar\n                + className.replace(\'.\', File.separatorChar) + ".class";\n    }\n}\n\n\n\n# åäº²å§æ´¾\n\nçè§£åäº²å§æ´¾ä¹åï¼åè®©æä»¬çä¸ä¸ªç¤ºä¾ã\n\nãç¤ºä¾ãå¯»æ¾ç±»å è½½ç¤ºä¾\n\npublic static void main(String[] args) {\n    ClassLoader loader = Thread.currentThread().getContextClassLoader();\n    System.out.println(loader);\n    System.out.println(loader.getParent());\n    System.out.println(loader.getParent().getParent());\n}\n\n\nè¾åºï¼\n\nsun.misc.Launcher$AppClassLoader@18b4aac2\nsun.misc.Launcher$ExtClassLoader@19e1023e\nnull\n\n\nä»ä¸é¢çç»æå¯ä»¥çåºï¼å¹¶æ²¡æè·åå° ExtClassLoader çç¶ Loaderï¼åå æ¯ Bootstrap Loaderï¼å¼å¯¼ç±»å è½½å¨ï¼æ¯ç¨ C è¯­è¨å®ç°çï¼æ¾ä¸å°ä¸ä¸ªç¡®å®çè¿åç¶ Loader çæ¹å¼ï¼äºæ¯å°±è¿å nullã\n\nä¸å¾å±ç¤ºçç±»å è½½å¨ä¹é´çå±æ¬¡å³ç³»ï¼ç§°ä¸ºç±»å è½½å¨çåäº²å§æ´¾æ¨¡åï¼Parents Delegation Modelï¼ãè¯¥æ¨¡åè¦æ±é¤äºé¡¶å±ç Bootstrap ClassLoader å¤ï¼å¶ä½çç±»å è½½å¨é½åºæèªå·±çç¶ç±»å è½½å¨ãè¿éç±»å è½½å¨ä¹é´çç¶å­å³ç³»ä¸è¬éè¿ç»åï¼Compositionï¼å³ç³»æ¥å®ç°ï¼èä¸æ¯éè¿ç»§æ¿ï¼Inheritanceï¼çå³ç³»å®ç°ã\n\n\n\nï¼1ï¼å·¥ä½è¿ç¨\n\nä¸ä¸ªç±»å è½½å¨é¦åå°ç±»å è½½è¯·æ±ä¼ éå°ç¶ç±»å è½½å¨ï¼åªæå½ç¶ç±»å è½½å¨æ æ³å®æç±»å è½½è¯·æ±æ¶æå°è¯å è½½ã\n\nï¼2ï¼å¥½å¤\n\nä½¿å¾ Java ç±»éçå®çç±»å è½½å¨ä¸èµ·å·æä¸ç§å¸¦æä¼åçº§çå±æ¬¡å³ç³»ï¼ä»èä½¿å¾åºç¡ç±»å¾å°ç»ä¸ï¼\n\n * ç³»ç»ç±»é²æ­¢åå­ä¸­åºç°å¤ä»½åæ ·çå­èç \n * ä¿è¯ Java ç¨åºå®å¨ç¨³å®è¿è¡\n\nä¾å¦ï¼ java.lang.Object å­æ¾å¨ rt.jar ä¸­ï¼å¦æç¼åå¦å¤ä¸ä¸ª java.lang.Object çç±»å¹¶æ¾å° classpath ä¸­ï¼ç¨åºå¯ä»¥ç¼è¯éè¿ãå ä¸ºåäº²å§æ´¾æ¨¡åçå­å¨ï¼æä»¥å¨ rt.jar ä¸­ç Object æ¯å¨ classpath ä¸­ç Object ä¼åçº§æ´é«ï¼å ä¸º rt.jar ä¸­ç Object ä½¿ç¨çæ¯å¯å¨ç±»å è½½å¨ï¼è classpath ä¸­ç Object ä½¿ç¨çæ¯åºç¨ç¨åºç±»å è½½å¨ãæ­£å ä¸º rt.jar ä¸­ç Object ä¼åçº§æ´é«ï¼å ä¸ºç¨åºä¸­ææç Object é½æ¯è¿ä¸ª Objectã\n\nï¼3ï¼å®ç°\n\nä»¥ä¸æ¯æ½è±¡ç±» java.lang.ClassLoader çä»£ç çæ®µï¼å¶ä¸­ç loadClass() æ¹æ³è¿è¡è¿ç¨å¦ä¸ï¼\n\npublic abstract class ClassLoader {\n    // The parent class loader for delegation\n    private final ClassLoader parent;\n\n    public Class<?> loadClass(String name) throws ClassNotFoundException {\n        return loadClass(name, false);\n    }\n\n    protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {\n        synchronized (getClassLoadingLock(name)) {\n            // é¦åå¤æ­è¯¥ç±»åæ¯å¦å·²ç»è¢«å è½½\n            Class<?> c = findLoadedClass(name);\n            if (c == null) {\n                // å¦ææ²¡æè¢«å è½½ï¼å°±å§æç»ç¶ç±»å è½½æèå§æ´¾ç»å¯å¨ç±»å è½½å¨å è½½\n                try {\n                    if (parent != null) {\n                        // å¦æå­å¨ç¶ç±»å è½½å¨ï¼å°±å§æ´¾ç»ç¶ç±»å è½½å¨å è½½\n                        c = parent.loadClass(name, false);\n                    } else {\n                        // å¦æä¸å­å¨ç¶ç±»å è½½å¨ï¼å°±æ£æ¥æ¯å¦æ¯ç±å¯å¨ç±»å è½½å¨å è½½çç±»ï¼éè¿è°ç¨æ¬å°æ¹æ³native Class findBootstrapClass(String name)\n                        c = findBootstrapClassOrNull(name);\n                    }\n                } catch (ClassNotFoundException e) {\n                    // å¦æç¶ç±»å è½½å¨å è½½å¤±è´¥ï¼ä¼æåº ClassNotFoundException\n                }\n\n                if (c == null) {\n                    // å¦æç¶ç±»å è½½å¨åå¯å¨ç±»å è½½å¨é½ä¸è½å®æå è½½ä»»å¡ï¼æè°ç¨èªèº«çå è½½åè½\n                    c = findClass(name);\n                }\n            }\n            if (resolve) {\n                resolveClass(c);\n            }\n            return c;\n        }\n    }\n\n    protected Class<?> findClass(String name) throws ClassNotFoundException {\n        throw new ClassNotFoundException(name);\n    }\n}\n\n\nãè¯´æã\n\n * åæ£æ¥ç±»æ¯å¦å·²ç»å è½½è¿ï¼å¦ææ²¡æåè®©ç¶ç±»å è½½å¨å»å è½½ã\n * å½ç¶ç±»å è½½å¨å è½½å¤±è´¥æ¶æåº ClassNotFoundExceptionï¼æ­¤æ¶å°è¯èªå·±å»å è½½ã\n\n\n# ClassLoader åæ°\n\nå¨çäº§ç¯å¢ä¸å¯å¨ java åºç¨æ¶ï¼éå¸¸ä¼æå®ä¸äº ClassLoader åæ°ï¼ä»¥å è½½åºç¨æéè¦ç libï¼\n\njava -jar xxx.jar -classpath lib/*\n\n\nClassLoader ç¸å³åæ°éé¡¹ï¼\n\nåæ°éé¡¹                                   CLASSLOADER ç±»å          è¯´æ\n-Xbootclasspath                        Bootstrap ClassLoader   è®¾ç½® Bootstrap ClassLoader æç´¢è·¯å¾ããä¸å¸¸ç¨ã\n-Xbootclasspath/a                      Bootstrap ClassLoader   æè·¯å¾æ·»å å°å·²å­å¨ç Bootstrap ClassLoader æç´¢è·¯å¾åé¢ããå¸¸ç¨ã\n-Xbootclasspath/p                      Bootstrap ClassLoader   æè·¯å¾æ·»å å°å·²å­å¨ç Bootstrap ClassLoader æç´¢è·¯å¾åé¢ããä¸å¸¸ç¨ã\n-Djava.ext.dirs                        ExtClassLoader          è®¾ç½® ExtClassLoader æç´¢è·¯å¾ã\n-Djava.class.path æ -cp æ -classpath   AppClassLoader          è®¾ç½® AppClassLoader æç´¢è·¯å¾ã\n\n\n# ç±»çå è½½\n\n\n# ç±»å è½½æ¹å¼\n\nç±»å è½½æä¸ç§æ¹å¼ï¼\n\n * å½ä»¤è¡å¯å¨åºç¨æ¶åç± JVM åå§åå è½½\n * éè¿ Class.forName() æ¹æ³å¨æå è½½\n * éè¿ ClassLoader.loadClass() æ¹æ³å¨æå è½½\n\nClass.forName() å ClassLoader.loadClass() åºå«\n\n * Class.forName() å°ç±»ç .class æä»¶å è½½å° jvm ä¸­ä¹å¤ï¼è¿ä¼å¯¹ç±»è¿è¡è§£éï¼æ§è¡ç±»ä¸­ç static åï¼\n * ClassLoader.loadClass() åªå¹²ä¸ä»¶äºæï¼å°±æ¯å° .class æä»¶å è½½å° jvm ä¸­ï¼ä¸ä¼æ§è¡ static ä¸­çåå®¹ï¼åªæå¨ newInstance æä¼å»æ§è¡ static åã\n * Class.forName(name, initialize, loader) å¸¦åå½æ°ä¹å¯æ§å¶æ¯å¦å è½½ static åãå¹¶ä¸åªæè°ç¨äº newInstance() æ¹æ³éç¨è°ç¨æé å½æ°ï¼åå»ºç±»çå¯¹è±¡ ã\n\n\n# å è½½ç±»éè¯¯\n\n# ClassNotFoundException\n\nClassNotFoundException å¼å¸¸åºéçæé«ãClassNotFoundException è¡¨ç¤ºå½å classpath ä¸æ¾ä¸å°æå®ç±»ã\n\nå¸¸è§é®é¢åå ï¼\n\n * è°ç¨ Class ç forName() æ¹æ³ï¼æªæ¾å°ç±»ã\n * è°ç¨ ClassLoader ä¸­ç loadClass() æ¹æ³ï¼æªæ¾å°ç±»ã\n * è°ç¨ ClassLoader ä¸­ç findSystemClass() æ¹æ³ï¼æªæ¾å°ç±»ã\n\nãç¤ºä¾ãæ§è¡ä»¥ä¸ä»£ç ï¼ä¼æåº ClassNotFoundException å¼å¸¸ï¼\n\npublic class ClassNotFoundExceptionDemo {\n    public static void main(String[] args) {\n        try {\n            Class.forName("NotFound");\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\nè§£å³æ¹æ³ï¼æ£æ¥ classpath ä¸ææ²¡æç¸åºç class æä»¶ã\n\n# NoClassDefFoundError\n\nå¸¸è§é®é¢åå ï¼\n\n * ç±»ä¾èµç Class æè jar ä¸å­å¨ã\n * ç±»æä»¶å­å¨ï¼ä½æ¯å­å¨ä¸åçåä¸­ã\n\nè§£å³æ¹æ³ï¼ç°ä»£ Java é¡¹ç®ï¼ä¸è¬ä½¿ç¨ mavenãgradle ç­æå»ºå·¥å·ç®¡çé¡¹ç®ï¼ä»ç»æ£æ¥æ¾ä¸å°çç±»æå¨ç jar åæ¯å¦å·²æ·»å ä¸ºä¾èµã\n\n# UnsatisfiedLinkError\n\nè¿ä¸ªå¼å¸¸åä¸æ¯å¾å¸¸è§ï¼ä½æ¯åºéçè¯ï¼éå¸¸æ¯å¨ JVM å¯å¨çæ¶åå¦æä¸ä¸å°å¿å°å¨ JVM ä¸­çæä¸ª lib å é¤äºï¼å¯è½å°±ä¼æ¥è¿ä¸ªéè¯¯äºã\n\nãç¤ºä¾ãæ§è¡ä»¥ä¸ä»£ç ï¼ä¼æåº UnsatisfiedLinkError éè¯¯ã\n\npublic class UnsatisfiedLinkErrorDemo {\n\n    public native void nativeMethod();\n\n    static {\n        System.loadLibrary("NoLib");\n    }\n\n    public static void main(String[] args) {\n        new UnsatisfiedLinkErrorDemo().nativeMethod();\n    }\n\n}\n\n\nãè¾åºã\n\njava.lang.UnsatisfiedLinkError: no NoLib in java.library.path\n\tat java.lang.ClassLoader.loadLibrary(ClassLoader.java:1867)\n\tat java.lang.Runtime.loadLibrary0(Runtime.java:870)\n\tat java.lang.System.loadLibrary(System.java:1122)\n\tat io.github.dunwu.javacore.jvm.classloader.exception.UnsatisfiedLinkErrorDemo.<clinit>(UnsatisfiedLinkErrorDemo.java:12)\n\n\n# ClassCastException\n\nClassCastException å¼å¸¸éå¸¸æ¯å¨ç¨åºä¸­å¼ºå¶ç±»åè½¬æ¢å¤±è´¥æ¶åºç°ã\n\nãç¤ºä¾ãæ§è¡ä»¥ä¸ä»£ç ï¼ä¼æåº ClassCastException å¼å¸¸ã\n\npublic class ClassCastExceptionDemo {\n\n    public static void main(String[] args) {\n        Object obj = new Object();\n        EmptyClass newObj = (EmptyClass) obj;\n    }\n\n    static class EmptyClass {}\n\n}\n\n\nãè¾åºã\n\nException in thread "main" java.lang.ClassCastException: java.lang.Object cannot be cast to io.github.dunwu.javacore.jvm.classloader.exception.ClassCastExceptionDemo$EmptyClass\n\tat io.github.dunwu.javacore.jvm.classloader.exception.ClassCastExceptionDemo.main(ClassCastExceptionDemo.java:11)\n\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * æ·±å¥æè§£ Java èææº\n * ä¸ç¯å¾æå½»åºå¼æç±»å è½½å¨ä¸åäº²å§æ´¾æºå¶\n * Jvm ç³»å(ä¸):Java ç±»çå è½½æºå¶',normalizedContent:'# jvm ç±»å è½½\n\n\n\n\n# ç±»å è½½æºå¶\n\n> ç±»æ¯å¨è¿è¡æé´å¨æå è½½çã\n\nç±»çå è½½æçæ¯å°ç±»ç .class æä»¶ä¸­çäºè¿å¶æ°æ®è¯»å¥å°åå­ä¸­ï¼å°å¶æ¾å¨è¿è¡æ¶æ°æ®åºçæ¹æ³åºåï¼ç¶åå¨å åºåå»ºä¸ä¸ªjava.lang.classå¯¹è±¡ï¼ç¨æ¥å°è£ç±»å¨æ¹æ³åºåçæ°æ®ç»æãç±»çå è½½çæç»äº§åæ¯ä½äºå åºä¸­çclasså¯¹è±¡ï¼classå¯¹è±¡å°è£äºç±»å¨æ¹æ³åºåçæ°æ®ç»æï¼å¹¶ä¸å java ç¨åºåæä¾äºè®¿é®æ¹æ³åºåçæ°æ®ç»æçæ¥å£ã\n\nç±»å è½½å¨å¹¶ä¸éè¦ç­å°æä¸ªç±»è¢«âé¦æ¬¡ä¸»å¨ä½¿ç¨âæ¶åå è½½å®ï¼jvm è§èåè®¸ç±»å è½½å¨å¨é¢ææä¸ªç±»å°è¦è¢«ä½¿ç¨æ¶å°±é¢åå è½½å®ï¼å¦æå¨é¢åå è½½çè¿ç¨ä¸­éå°äº.class æä»¶ç¼ºå¤±æå­å¨éè¯¯ï¼ç±»å è½½å¨å¿é¡»å¨ç¨åºé¦æ¬¡ä¸»å¨ä½¿ç¨è¯¥ç±»æ¶ææ¥åéè¯¯ï¼linkageerror éè¯¯ï¼å¦æè¿ä¸ªç±»ä¸ç´æ²¡æè¢«ç¨åºä¸»å¨ä½¿ç¨ï¼é£ä¹ç±»å è½½å¨å°±ä¸ä¼æ¥åéè¯¯\n\n\n# ç±»ççå½å¨æ\n\n\n\njava ç±»çå®æ´çå½å¨æåæ¬ä»¥ä¸å ä¸ªé¶æ®µï¼\n\n * å è½½ï¼loadingï¼\n * é¾æ¥ï¼linkingï¼\n   * éªè¯ï¼verificationï¼\n   * åå¤ï¼preparationï¼\n   * è§£æï¼resolutionï¼\n * åå§åï¼initializationï¼\n * ä½¿ç¨ï¼usingï¼\n * å¸è½½ï¼unloadingï¼\n\nå è½½ãéªè¯ãåå¤ãåå§ååå¸è½½è¿ 5 ä¸ªé¶æ®µçé¡ºåºæ¯ç¡®å®çï¼ç±»çå è½½è¿ç¨å¿é¡»æç§è¿ç§é¡ºåºæé¨å°±ç­å°å¼å§ãèè§£æè¿ç¨å¨æäºæåµä¸å¯ä»¥å¨åå§åé¶æ®µä¹ååå¼å§ï¼è¿æ¯ä¸ºäºæ¯æ java çå¨æç»å®ã\n\nç±»å è½½è¿ç¨æ¯æå è½½ãéªè¯ãåå¤ãè§£æååå§åè¿ 5 ä¸ªé¶æ®µã\n\n\n# ï¼ä¸ï¼å è½½\n\nå è½½æ¯ç±»å è½½çä¸ä¸ªé¶æ®µï¼æ³¨æä¸è¦æ··æ·ã\n\nå è½½ï¼æ¯ææ¥æ¾å­èæµï¼å¹¶ä¸æ®æ­¤åå»ºç±»çè¿ç¨ã\n\nå è½½è¿ç¨å®æä»¥ä¸ä¸ä»¶äºï¼\n\n * éè¿ä¸ä¸ªç±»çå¨éå®åæ¥è·åå®ä¹æ­¤ç±»çäºè¿å¶å­èæµã\n * å°è¿ä¸ªå­èæµæä»£è¡¨çéæå­å¨ç»æè½¬åä¸ºæ¹æ³åºçè¿è¡æ¶å­å¨ç»æã\n * å¨åå­ä¸­çæä¸ä¸ªä»£è¡¨è¿ä¸ªç±»ç class å¯¹è±¡ï¼ä½ä¸ºæ¹æ³åºè¿ä¸ªç±»çåç§æ°æ®çè®¿é®å¥å£ã\n\nå¶ä¸­äºè¿å¶å­èæµå¯ä»¥ä»ä»¥ä¸æ¹å¼ä¸­è·åï¼\n\n * ä» zip åè¯»åï¼è¿å¾å¸¸è§ï¼æç»æä¸ºæ¥å jarãearãwar æ ¼å¼çåºç¡ã\n * ä»ç½ç»ä¸­è·åï¼è¿ç§åºæ¯æå¸åçåºç¨æ¯ appletã\n * è¿è¡æ¶è®¡ç®çæï¼è¿ç§åºæ¯ä½¿ç¨å¾æå¤å¾å°±æ¯å¨æä»£çææ¯ï¼å¨ java.lang.reflect.proxy ä¸­ï¼å°±æ¯ç¨äº proxygenerator.generateproxyclass çä»£çç±»çäºè¿å¶å­èæµã\n * ç±å¶ä»æä»¶çæï¼å¸ååºæ¯æ¯ jsp åºç¨ï¼å³ç± jsp æä»¶çæå¯¹åºç class ç±»ã\n * ä»æ°æ®åºè¯»åï¼è¿ç§åºæ¯ç¸å¯¹å°è§ï¼ä¾å¦æäºä¸­é´ä»¶æå¡å¨ï¼å¦ sap netweaverï¼å¯ä»¥éæ©æç¨åºå®è£å°æ°æ®åºä¸­æ¥å®æç¨åºä»£ç å¨éç¾¤é´çååã ...\n\n> æ´è¯¦ç»åå®¹ä¼å¨ 3. classloader ä»ç»ã\n\n\n# ï¼äºï¼éªè¯\n\néªè¯æ¯é¾æ¥é¶æ®µçç¬¬ä¸æ­¥ãéªè¯çç®æ æ¯ç¡®ä¿ class æä»¶çå­èæµä¸­åå«çä¿¡æ¯ç¬¦åå½åèææºçè¦æ±ï¼å¹¶ä¸ä¸ä¼å±å®³èææºèªèº«çå®å¨ã\n\néªè¯é¶æ®µå¤§è´ä¼å®æ 4 ä¸ªé¶æ®µçæ£éªå¨ä½ï¼\n\n * æä»¶æ ¼å¼éªè¯ - éªè¯å­èæµæ¯å¦ç¬¦å class æä»¶æ ¼å¼çè§èï¼å¹¶ä¸è½è¢«å½åçæ¬çèææºå¤çã\n * åæ°æ®éªè¯ - å¯¹å­èç æè¿°çä¿¡æ¯è¿è¡è¯­ä¹åæï¼ä»¥ä¿è¯å¶æè¿°çä¿¡æ¯ç¬¦å java è¯­è¨è§èçè¦æ±ã\n * å­èç éªè¯ - éè¿æ°æ®æµåæ§å¶æµåæï¼ç¡®ä¿ç¨åºè¯­ä¹æ¯åæ³ãç¬¦åé»è¾çã\n * ç¬¦å·å¼ç¨éªè¯ - åçå¨èææºå°ç¬¦å·å¼ç¨è½¬æ¢ä¸ºç´æ¥å¼ç¨çæ¶åï¼å¯¹ç±»èªèº«ä»¥å¤ï¼å¸¸éæ± ä¸­çåç§ç¬¦å·å¼ç¨ï¼çä¿¡æ¯è¿è¡å¹éæ§æ ¡éªã\n\néªè¯é¶æ®µæ¯éå¸¸éè¦çï¼ä½ä¸æ¯å¿é¡»çï¼å®å¯¹ç¨åºè¿è¡ææ²¡æå½±åï¼å¦ææå¼ç¨çç±»ç»è¿åå¤éªè¯ï¼é£ä¹å¯ä»¥èèéç¨ -xverifynone åæ°æ¥å³é­å¤§é¨åçç±»éªè¯æªæ½ï¼ä»¥ç¼©ç­èææºç±»å è½½çæ¶é´ã\n\n\n# ï¼ä¸ï¼åå¤\n\nç±»åéæ¯è¢« static ä¿®é¥°çåéï¼åå¤é¶æ®µä¸º static åéå¨æ¹æ³åºåéåå­å¹¶åå§åä¸ºé»è®¤å¼ï¼ä½¿ç¨çæ¯æ¹æ³åºçåå­ã\n\nå®ä¾åéä¸ä¼å¨è¿é¶æ®µåéåå­ï¼å®å°ä¼å¨å¯¹è±¡å®ä¾åæ¶éçå¯¹è±¡ä¸èµ·åéå¨ java å ä¸­ãï¼å®ä¾åä¸æ¯ç±»å è½½çä¸ä¸ªè¿ç¨ï¼ç±»å è½½åçå¨ææå®ä¾åæä½ä¹åï¼å¹¶ä¸ç±»å è½½åªè¿è¡ä¸æ¬¡ï¼å®ä¾åå¯ä»¥è¿è¡å¤æ¬¡ï¼\n\nåå§å¼ä¸è¬ä¸º 0 å¼ï¼ä¾å¦ä¸é¢çç±»åé value è¢«åå§åä¸º 0 èä¸æ¯ 123ã\n\npublic static int value = 123;\n\n\nå¦æç±»åéæ¯å¸¸éï¼é£ä¹ä¼æç§è¡¨è¾¾å¼æ¥è¿è¡åå§åï¼èä¸æ¯èµå¼ä¸º 0ã\n\npublic static final int value = 123;\n\n\nåå¤é¶æ®µæä»¥ä¸å ç¹éè¦æ³¨æï¼\n\n * è¿æ¶åè¿è¡åå­åéçä»åæ¬ç±»åéï¼staticï¼ï¼èä¸åæ¬å®ä¾åéï¼å®ä¾åéä¼å¨å¯¹è±¡å®ä¾åæ¶éçå¯¹è±¡ä¸ååéå¨ java å ä¸­ã\n * è¿éæè®¾ç½®çåå§å¼éå¸¸æåµä¸æ¯æ°æ®ç±»åé»è®¤çé¶å¼ï¼å¦ 0ã0lãnullãfalse ç­ï¼ï¼èä¸æ¯è¢«å¨ java ä»£ç ä¸­è¢«æ¾å¼å°èµäºçå¼ã\n\nåè®¾ä¸ä¸ªç±»åéçå®ä¹ä¸ºï¼public static int value = 3ï¼\n\né£ä¹åé value å¨åå¤é¶æ®µè¿åçåå§å¼ä¸º 0ï¼èä¸æ¯ 3ï¼å ä¸ºè¿æ¶åå°æªå¼å§æ§è¡ä»»ä½ java æ¹æ³ï¼èæ value èµå¼ä¸º 3 çpublic staticæä»¤æ¯å¨ç¨åºç¼è¯åï¼å­æ¾äºç±»æé å¨ï¼ï¼æ¹æ³ä¹ä¸­çï¼æä»¥æ value èµå¼ä¸º 3 çå¨ä½å°å¨åå§åé¶æ®µæä¼æ§è¡ã\n\n> è¿éè¿éè¦æ³¨æå¦ä¸å ç¹ï¼\n> \n>  * å¯¹åºæ¬æ°æ®ç±»åæ¥è¯´ï¼å¯¹äºç±»åéï¼staticï¼åå¨å±åéï¼å¦æä¸æ¾å¼å°å¯¹å¶èµå¼èç´æ¥ä½¿ç¨ï¼åç³»ç»ä¼ä¸ºå¶èµäºé»è®¤çé¶å¼ï¼èå¯¹äºå±é¨åéæ¥è¯´ï¼å¨ä½¿ç¨åå¿é¡»æ¾å¼å°ä¸ºå¶èµå¼ï¼å¦åç¼è¯æ¶ä¸éè¿ã\n>  * å¯¹äºåæ¶è¢« static å final ä¿®é¥°çå¸¸éï¼å¿é¡»å¨å£°æçæ¶åå°±ä¸ºå¶æ¾å¼å°èµå¼ï¼å¦åç¼è¯æ¶ä¸éè¿ï¼èåªè¢« final ä¿®é¥°çå¸¸éåæ¢å¯ä»¥å¨å£°ææ¶æ¾å¼å°ä¸ºå¶èµå¼ï¼ä¹å¯ä»¥å¨ç±»åå§åæ¶æ¾å¼å°ä¸ºå¶èµå¼ï¼æ»ä¹ï¼å¨ä½¿ç¨åå¿é¡»ä¸ºå¶æ¾å¼å°èµå¼ï¼ç³»ç»ä¸ä¼ä¸ºå¶èµäºé»è®¤é¶å¼ã\n>  * å¯¹äºå¼ç¨æ°æ®ç±»å reference æ¥è¯´ï¼å¦æ°ç»å¼ç¨ãå¯¹è±¡å¼ç¨ç­ï¼å¦ææ²¡æå¯¹å¶è¿è¡æ¾å¼å°èµå¼èç´æ¥ä½¿ç¨ï¼ç³»ç»é½ä¼ä¸ºå¶èµäºé»è®¤çé¶å¼ï¼å³ nullã\n>  * å¦æå¨æ°ç»åå§åæ¶æ²¡æå¯¹æ°ç»ä¸­çååç´ èµå¼ï¼é£ä¹å¶ä¸­çåç´ å°æ ¹æ®å¯¹åºçæ°æ®ç±»åèè¢«èµäºé»è®¤çé¶å¼ã\n\n * å¦æç±»å­æ®µçå­æ®µå±æ§è¡¨ä¸­å­å¨constantvalueå±æ§ï¼å³åæ¶è¢« final å static ä¿®é¥°ï¼é£ä¹å¨åå¤é¶æ®µåé value å°±ä¼è¢«åå§åä¸º constvalue å±æ§ææå®çå¼ã\n\nåè®¾ä¸é¢çç±»åé value è¢«å®ä¹ä¸ºï¼ public static final int value = 3ï¼\n\nç¼è¯æ¶ javac å°ä¼ä¸º value çæ constantvalue å±æ§ï¼å¨åå¤é¶æ®µèææºå°±ä¼æ ¹æ®constantvalueçè®¾ç½®å° value èµå¼ä¸º 3ãæä»¬å¯ä»¥çè§£ä¸º static final å¸¸éå¨ç¼è¯æå°±å°å¶ç»ææ¾å¥äºè°ç¨å®çç±»çå¸¸éæ± ä¸­\n\n\n# ï¼åï¼è§£æ\n\nå¨ class æä»¶è¢«å è½½è³ java èææºä¹åï¼è¿ä¸ªç±»æ æ³ç¥éå¶ä»ç±»åå¶æ¹æ³ãå­æ®µæå¯¹åºçå·ä½å°åï¼çè³ä¸ç¥éèªå·±æ¹æ³ãå­æ®µçå°åãå æ­¤ï¼æ¯å½éè¦å¼ç¨è¿äºæåæ¶ï¼java ç¼è¯å¨ä¼çæä¸ä¸ªç¬¦å·å¼ç¨ãå¨è¿è¡é¶æ®µï¼è¿ä¸ªç¬¦å·å¼ç¨ä¸è¬é½è½å¤æ æ­§ä¹å°å®ä½å°å·ä½ç®æ ä¸ã\n\nä¸¾ä¾æ¥è¯´ï¼å¯¹äºä¸ä¸ªæ¹æ³è°ç¨ï¼ç¼è¯å¨ä¼çæä¸ä¸ªåå«ç®æ æ¹æ³æå¨ç±»çåå­ãç®æ æ¹æ³çåå­ãæ¥æ¶åæ°ç±»åä»¥åè¿åå¼ç±»åçç¬¦å·å¼ç¨ï¼æ¥æä»£æè¦è°ç¨çæ¹æ³ã\n\nè§£æé¶æ®µç®æ æ¯å°å¸¸éæ± çç¬¦å·å¼ç¨æ¿æ¢ä¸ºç´æ¥å¼ç¨çè¿ç¨ãè§£æå¨ä½ä¸»è¦éå¯¹ç±»ææ¥å£ãå­æ®µãç±»æ¹æ³ãæ¥å£æ¹æ³ãæ¹æ³ç±»åãæ¹æ³å¥æåè°ç¨ç¹éå®ç¬¦ 7 ç±»ç¬¦å·å¼ç¨è¿è¡ã\n\n * ç¬¦å·å¼ç¨ï¼symbolic referencesï¼ - ç¬¦å·å¼ç¨ä»¥ä¸ç»ç¬¦å·æ¥æè¿°æå¼ç¨çç®æ ï¼ç¬¦å·å¯ä»¥æ¯ä»»ä½å½¢å¼çå­é¢éï¼åªè¦ä½¿ç¨æ¶è½æ æ­§ä¹å°å®ä½å°ç®æ å³å¯ã\n * ç´æ¥å¼ç¨ï¼direct referenceï¼ - ç´æ¥å¼ç¨å¯ä»¥æ¯ç´æ¥æåç®æ çæéãç¸å¯¹åç§»éææ¯ä¸ä¸ªè½é´æ¥å®ä½å°ç®æ çå¥æã\n\n\n# ï¼äºï¼åå§å\n\nå¨ java ä»£ç ä¸­ï¼å¦æè¦åå§åä¸ä¸ªéæå­æ®µï¼å¯ä»¥å¨å£°ææ¶ç´æ¥èµå¼ï¼ä¹å¯ä»¥å¨éæä»£ç åä¸­å¯¹å¶èµå¼ã\n\nå¦æç´æ¥èµå¼çéæå­æ®µè¢« final æä¿®é¥°ï¼å¹¶ä¸å®çç±»åæ¯åºæ¬ç±»åæå­ç¬¦ä¸²æ¶ï¼é£ä¹è¯¥å­æ®µä¾¿ä¼è¢« java ç¼è¯å¨æ è®°æå¸¸éå¼ï¼constantvalueï¼ï¼å¶åå§åç´æ¥ç± java èææºå®æãé¤æ­¤ä¹å¤çç´æ¥èµå¼æä½ï¼ä»¥åææéæä»£ç åä¸­çä»£ç ï¼åä¼è¢« java ç¼è¯å¨ç½®äºåä¸æ¹æ³ä¸­ï¼å¹¶æå®å½åä¸º < clinit >ã\n\nåå§åé¶æ®µæçæ­£å¼å§æ§è¡ç±»ä¸­çå®ä¹ç java ç¨åºä»£ç ãåå§åï¼ä¸ºç±»çéæåéèµäºæ­£ç¡®çåå§å¼ï¼jvm è´è´£å¯¹ç±»è¿è¡åå§åï¼ä¸»è¦å¯¹ç±»åéè¿è¡åå§åã\n\n# ç±»åå§åæ¹å¼\n\n * å£°æç±»åéæ¶æå®åå§å¼\n * ä½¿ç¨éæä»£ç åä¸ºç±»åéæå®åå§å¼\n\n> å¨åå¤é¶æ®µï¼ç±»åéå·²ç»èµè¿ä¸æ¬¡ç³»ç»è¦æ±çåå§å¼ï¼èå¨åå§åé¶æ®µï¼æ ¹æ®ç¨åºåéè¿ç¨åºå¶å®çä¸»è§è®¡åå»åå§åç±»åéåå¶å®èµæºã\n\n# ç±»åå§åæ­¥éª¤\n\n 1. å¦æç±»è¿æ²¡æè¢«å è½½åé¾æ¥ï¼å¼å§å è½½è¯¥ç±»ã\n 2. å¦æè¯¥ç±»çç´æ¥ç¶ç±»è¿æ²¡æè¢«åå§åï¼ååå§åå¶ç¶ç±»ã\n 3. å¦æè¯¥ç±»æåå§åè¯­å¥ï¼åä¾æ¬¡æ§è¡è¿äºåå§åè¯­å¥ã\n\n# ç±»åå§åæ¶æº\n\nåªæä¸»å¨å¼ç¨ç±»çæ¶åæä¼å¯¼è´ç±»çåå§åã\n\nï¼1ï¼ä¸»å¨å¼ç¨\n\nç±»çä¸»å¨å¼ç¨åæ¬ä»¥ä¸å­ç§ï¼\n\n * åå»ºç±»çå®ä¾ - ä¹å°±æ¯ new å¯¹è±¡\n * è®¿é®éæåé - è®¿é®æä¸ªç±»ææ¥å£çéæåéï¼æèå¯¹è¯¥éæåéèµå¼\n * è®¿é®éææ¹æ³\n * åå° - å¦class.forname(âcom.shengsiyuan.testâ)\n * åå§åå­ç±» - åå§åæä¸ªç±»çå­ç±»ï¼åå¶ç¶ç±»ä¹ä¼è¢«åå§å\n * å¯å¨ç±» - java èææºå¯å¨æ¶è¢«æ æä¸ºå¯å¨ç±»çç±»ï¼java testï¼ï¼ç´æ¥ä½¿ç¨java.exeå½ä»¤æ¥è¿è¡æä¸ªä¸»ç±»\n\nï¼2ï¼è¢«å¨å¼ç¨\n\nä»¥ä¸ 5 ç§åºæ¯ä¸­çè¡ä¸ºç§°ä¸ºå¯¹ä¸ä¸ªç±»è¿è¡ä¸»å¨å¼ç¨ãé¤æ­¤ä¹å¤ï¼ææå¼ç¨ç±»çæ¹å¼é½ä¸ä¼è§¦ååå§åï¼ç§°ä¸ºè¢«å¨å¼ç¨ãè¢«å¨å¼ç¨çå¸¸è§ä¾å­åæ¬ï¼\n\n * éè¿å­ç±»å¼ç¨ç¶ç±»çéæå­æ®µï¼ä¸ä¼å¯¼è´å­ç±»åå§åã\n\nsystem.out.println(subclass.value); // value å­æ®µå¨ superclass ä¸­å®ä¹\n\n\n * éè¿æ°ç»å®ä¹æ¥å¼ç¨ç±»ï¼ä¸ä¼è§¦åæ­¤ç±»çåå§åãè¯¥è¿ç¨ä¼å¯¹æ°ç»ç±»è¿è¡åå§åï¼æ°ç»ç±»æ¯ä¸ä¸ªç±èææºèªå¨çæçãç´æ¥ç»§æ¿èª object çå­ç±»ï¼å¶ä¸­åå«äºæ°ç»çå±æ§åæ¹æ³ã\n\nsuperclass[] sca = new superclass[10];\n\n\n * å¸¸éå¨ç¼è¯é¶æ®µä¼å­å¥è°ç¨ç±»çå¸¸éæ± ä¸­ï¼æ¬è´¨ä¸å¹¶æ²¡æç´æ¥å¼ç¨å°å®ä¹å¸¸éçç±»ï¼å æ­¤ä¸ä¼è§¦åå®ä¹å¸¸éçç±»çåå§åã\n\nsystem.out.println(constclass.helloworld);\n\n\n# ç±»åå§åç»è\n\nç±»åå§å <clinit>() æ¹æ³çç»èï¼\n\n * æ¯ç±ç¼è¯å¨èªå¨æ¶éç±»ä¸­ææç±»åéçèµå¼å¨ä½åéæè¯­å¥åï¼static{} åï¼ä¸­çè¯­å¥åå¹¶äº§ççï¼ç¼è¯å¨æ¶éçé¡ºåºç±è¯­å¥å¨æºæä»¶ä¸­åºç°çé¡ºåºå³å®ãç¹å«æ³¨æçæ¯ï¼éæè¯­å¥ååªè½è®¿é®å°å®ä¹å¨å®ä¹åçç±»åéï¼å®ä¹å¨å®ä¹åçç±»åéåªè½èµå¼ï¼ä¸è½è®¿é®ãä¾å¦ä»¥ä¸ä»£ç ï¼\n\npublic class test {\n    static {\n        i = 0;                // ç»åéèµå¼å¯ä»¥æ­£å¸¸ç¼è¯éè¿\n        system.out.print(i);  // è¿å¥ç¼è¯å¨ä¼æç¤ºâéæ³ååå¼ç¨â\n    }\n    static int i = 1;\n}\n\n\n * ä¸ç±»çæé å½æ°ï¼æèè¯´å®ä¾æé å¨ <init>()ï¼ä¸åï¼ä¸éè¦æ¾å¼çè°ç¨ç¶ç±»çæé å¨ãèææºä¼èªå¨ä¿è¯å¨å­ç±»ç <clinit>() æ¹æ³è¿è¡ä¹åï¼ç¶ç±»ç <clinit>() æ¹æ³å·²ç»æ§è¡ç»æãå æ­¤èææºä¸­ç¬¬ä¸ä¸ªæ§è¡ <clinit>() æ¹æ³çç±»è¯å®ä¸º java.lang.objectã\n * ç±äºç¶ç±»ç <clinit>() æ¹æ³åæ§è¡ï¼ä¹å°±æå³çç¶ç±»ä¸­å®ä¹çéæè¯­å¥åè¦ä¼äºå­ç±»çåéèµå¼æä½ãä¾å¦ä»¥ä¸ä»£ç ï¼\n\nstatic class parent {\n    public static int a = 1;\n    static {\n        a = 2;\n    }\n}\n\nstatic class sub extends parent {\n    public static int b = a;\n}\n\npublic static void main(string[] args) {\n     system.out.println(sub.b);  // è¾åºç»ææ¯ç¶ç±»ä¸­çéæåé a çå¼ï¼ä¹å°±æ¯ 2ã\n}\n\n\n * <clinit>() æ¹æ³å¯¹äºç±»ææ¥å£ä¸æ¯å¿é¡»çï¼å¦æä¸ä¸ªç±»ä¸­ä¸åå«éæè¯­å¥åï¼ä¹æ²¡æå¯¹ç±»åéçèµå¼æä½ï¼ç¼è¯å¨å¯ä»¥ä¸ä¸ºè¯¥ç±»çæ <clinit>() æ¹æ³ã\n * æ¥å£ä¸­ä¸å¯ä»¥ä½¿ç¨éæè¯­å¥åï¼ä½ä»ç¶æç±»åéåå§åçèµå¼æä½ï¼å æ­¤æ¥å£ä¸ç±»ä¸æ ·é½ä¼çæ <clinit>() æ¹æ³ãä½æ¥å£ä¸ç±»ä¸åçæ¯ï¼æ§è¡æ¥å£ç <clinit>() æ¹æ³ä¸éè¦åæ§è¡ç¶æ¥å£ç <clinit>() æ¹æ³ãåªæå½ç¶æ¥å£ä¸­å®ä¹çåéä½¿ç¨æ¶ï¼ç¶æ¥å£æä¼åå§åãå¦å¤ï¼æ¥å£çå®ç°ç±»å¨åå§åæ¶ä¹ä¸æ ·ä¸ä¼æ§è¡æ¥å£ç <clinit>() æ¹æ³ã\n * èææºä¼ä¿è¯ä¸ä¸ªç±»ç <clinit>() æ¹æ³å¨å¤çº¿ç¨ç¯å¢ä¸è¢«æ­£ç¡®çå éååæ­¥ï¼å¦æå¤ä¸ªçº¿ç¨åæ¶åå§åä¸ä¸ªç±»ï¼åªä¼æä¸ä¸ªçº¿ç¨æ§è¡è¿ä¸ªç±»ç <clinit>() æ¹æ³ï¼å¶å®çº¿ç¨é½ä¼é»å¡ç­å¾ï¼ç´å°æ´»å¨çº¿ç¨æ§è¡ <clinit>() æ¹æ³å®æ¯ãå¦æå¨ä¸ä¸ªç±»ç <clinit>() æ¹æ³ä¸­æèæ¶çæä½ï¼å°±å¯è½é æå¤ä¸ªçº¿ç¨é»å¡ï¼å¨å®éè¿ç¨ä¸­æ­¤ç§é»å¡å¾éè½ã\n\n\n# classloader\n\nclassloader å³ç±»å è½½å¨ï¼è´è´£å°ç±»å è½½å° jvmãå¨ java èææºå¤é¨å®ç°ï¼ä»¥ä¾¿è®©åºç¨ç¨åºèªå·±å³å®å¦ä½å»è·åæéè¦çç±»ã\n\njvm å è½½ class æä»¶å°åå­æä¸¤ç§æ¹å¼ï¼\n\n * éå¼å è½½ - jvm èªå¨å è½½éè¦çç±»å°åå­ä¸­ã\n * æ¾ç¤ºå è½½ - éè¿ä½¿ç¨ classloader æ¥å è½½ä¸ä¸ªç±»å°åå­ä¸­ã\n\n\n# ç±»ä¸ç±»å è½½å¨\n\nå¦ä½å¤æ­ä¸¤ä¸ªç±»æ¯å¦ç¸ç­ï¼ç±»æ¬èº«ç¸ç­ï¼å¹¶ä¸ä½¿ç¨åä¸ä¸ªç±»å è½½å¨è¿è¡å è½½ãè¿æ¯å ä¸ºæ¯ä¸ä¸ª classloader é½æ¥æä¸ä¸ªç¬ç«çç±»åç§°ç©ºé´ã\n\nè¿éçç¸ç­ï¼åæ¬ç±»ç class å¯¹è±¡ç equals() æ¹æ³ãisassignablefrom() æ¹æ³ãisinstance() æ¹æ³çè¿åç»æä¸º trueï¼ä¹åæ¬ä½¿ç¨ instanceof å³é®å­åå¯¹è±¡æå±å³ç³»å¤å®ç»æä¸º trueã\n\n\n# ç±»å è½½å¨åç±»\n\n\n\n# bootstrap classloader\n\nbootstrap classloader ï¼å³å¯å¨ç±»å è½½å¨ ï¼è´è´£å è½½ jvm èªèº«å·¥ä½æéè¦çç±»ã\n\nbootstrap classloader ä¼å°å­æ¾å¨ <java_home>\\lib ç®å½ä¸­çï¼æèè¢« -xbootclasspath åæ°ææå®çè·¯å¾ä¸­çï¼å¹¶ä¸æ¯èææºè¯å«çï¼ä»æç§æä»¶åè¯å«ï¼å¦ rt.jarï¼åå­ä¸ç¬¦åçç±»åºå³ä½¿æ¾å¨ lib ç®å½ä¸­ä¹ä¸ä¼è¢«å è½½ï¼ç±»åºå è½½å°èææºåå­ä¸­ã\n\nbootstrap classloader æ¯ç± c++ å®ç°çï¼å®å®å¨ç± jvm èªå·±æ§å¶çï¼å¯å¨ç±»å è½½å¨æ æ³è¢« java ç¨åºç´æ¥å¼ç¨ï¼ç¨æ·å¨ç¼åèªå®ä¹ç±»å è½½å¨æ¶ï¼å¦æéè¦æå è½½è¯·æ±å§æ´¾ç»å¯å¨ç±»å è½½å¨ï¼ç´æ¥ä½¿ç¨ null ä»£æ¿å³å¯ã\n\n# extclassloader\n\nextclassloaderï¼å³æ©å±ç±»å è½½å¨ï¼è¿ä¸ªç±»å è½½å¨æ¯ç± extclassloader(sun.misc.launcher\\$extclassloader)å®ç°çã\n\nextclassloader è´è´£å° <java_home>\\lib\\ext æèè¢« java.ext.dir ç³»ç»åéææå®è·¯å¾ä¸­çææç±»åºå è½½å°åå­ä¸­ï¼å¼åèå¯ä»¥ç´æ¥ä½¿ç¨æ©å±ç±»å è½½å¨ã\n\n# appclassloader\n\nappclassloaderï¼å³åºç¨ç¨åºç±»å è½½å¨ï¼è¿ä¸ªç±»å è½½å¨æ¯ç± appclassloader(sun.misc.launcher\\$appclassloader) å®ç°çãç±äºè¿ä¸ªç±»å è½½å¨æ¯ classloader ä¸­ç getsystemclassloader() æ¹æ³çè¿åå¼ï¼å æ­¤ä¸è¬ç§°ä¸ºç³»ç»ç±»å è½½å¨ã\n\nappclassloader è´è´£å è½½ç¨æ·ç±»è·¯å¾ï¼å³ classpathï¼ä¸ææå®çç±»åºï¼å¼åèå¯ä»¥ç´æ¥ä½¿ç¨è¿ä¸ªç±»å è½½å¨ï¼å¦æåºç¨ç¨åºä¸­æ²¡æèªå®ä¹è¿èªå·±çç±»å è½½å¨ï¼ä¸è¬æåµä¸è¿ä¸ªå°±æ¯ç¨åºä¸­é»è®¤çç±»å è½½å¨ã\n\n# èªå®ä¹ç±»å è½½å¨\n\nèªå®ä¹ç±»å è½½å¨å¯ä»¥åå°å¦ä¸å ç¹ï¼\n\n * å¨æ§è¡éç½®ä¿¡ä»£ç ä¹åï¼èªå¨éªè¯æ°å­ç­¾åã\n * å¨æå°åå»ºç¬¦åç¨æ·ç¹å®éè¦çå®å¶åæå»ºç±»ã\n * ä»ç¹å®çåºæåå¾ java classï¼ä¾å¦æ°æ®åºä¸­åç½ç»ä¸­ã\n\nåè®¾ï¼æä»¬éè¦èªå®ä¹ä¸ä¸ªåä¸º filesystemclassloader çç±»å è½½å¨ï¼ç»§æ¿èª java.lang.classloaderï¼ç¨äºå è½½æä»¶ç³»ç»ä¸çç±»ãå®é¦åæ ¹æ®ç±»çå¨åå¨æä»¶ç³»ç»ä¸æ¥æ¾ç±»çå­èä»£ç æä»¶ï¼.class æä»¶ï¼ï¼ç¶åè¯»åè¯¥æä»¶åå®¹ï¼æåéè¿ defineclass() æ¹æ³æ¥æè¿äºå­èä»£ç è½¬æ¢æ java.lang.class ç±»çå®ä¾ã\n\njava.lang.classloader ç±»çæ¹æ³ loadclass() å®ç°äºåäº²å§æ´¾æ¨¡åçé»è¾ï¼å æ­¤èªå®ä¹ç±»å è½½å¨ä¸è¬ä¸å»è¦åå®ï¼èæ¯éè¿è¦å findclass() æ¹æ³ã\n\nclassloader å¸¸ç¨çåºæ¯ï¼\n\n * å®¹å¨ - å¸ååºç¨ï¼servlet å®¹å¨ï¼å¦ï¼tomcatãjettyï¼ãudf ï¼mysqlãhiveï¼ç­ãå è½½è§£å jar åæ war ååï¼å è½½å¶ class å°æå®çç±»å è½½å¨ä¸­è¿è¡ï¼éå¸¸éè¦èèç©ºé´éç¦»ï¼ã\n * ç­é¨ç½²ãç­ææ - åºç¨å¯å¨åï¼å¨æè·å¾æä¸ªç±»ä¿¡æ¯ï¼ç¶åå è½½å° jvm ä¸­å·¥ä½ãå¾å¤èåçå®¹å¨è½¯ä»¶ãæ¡æ¶ï¼å¦ï¼spring ç­ï¼ï¼é½ä½¿ç¨ classloader æ¥å®ç°èªèº«çç­é¨ç½²ã\n\nãç¤ºä¾ãèªå®ä¹ä¸ä¸ªç±»å è½½å¨\n\npublic class filesystemclassloader extends classloader {\n\n    private string rootdir;\n\n    public filesystemclassloader(string rootdir) {\n        this.rootdir = rootdir;\n    }\n\n    protected class<?> findclass(string name) throws classnotfoundexception {\n        byte[] classdata = getclassdata(name);\n        if (classdata == null) {\n            throw new classnotfoundexception();\n        } else {\n            return defineclass(name, classdata, 0, classdata.length);\n        }\n    }\n\n    private byte[] getclassdata(string classname) {\n        string path = classnametopath(classname);\n        try {\n            inputstream ins = new fileinputstream(path);\n            bytearrayoutputstream baos = new bytearrayoutputstream();\n            int buffersize = 4096;\n            byte[] buffer = new byte[buffersize];\n            int bytesnumread;\n            while ((bytesnumread = ins.read(buffer)) != -1) {\n                baos.write(buffer, 0, bytesnumread);\n            }\n            return baos.tobytearray();\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return null;\n    }\n\n    private string classnametopath(string classname) {\n        return rootdir + file.separatorchar\n                + classname.replace(\'.\', file.separatorchar) + ".class";\n    }\n}\n\n\n\n# åäº²å§æ´¾\n\nçè§£åäº²å§æ´¾ä¹åï¼åè®©æä»¬çä¸ä¸ªç¤ºä¾ã\n\nãç¤ºä¾ãå¯»æ¾ç±»å è½½ç¤ºä¾\n\npublic static void main(string[] args) {\n    classloader loader = thread.currentthread().getcontextclassloader();\n    system.out.println(loader);\n    system.out.println(loader.getparent());\n    system.out.println(loader.getparent().getparent());\n}\n\n\nè¾åºï¼\n\nsun.misc.launcher$appclassloader@18b4aac2\nsun.misc.launcher$extclassloader@19e1023e\nnull\n\n\nä»ä¸é¢çç»æå¯ä»¥çåºï¼å¹¶æ²¡æè·åå° extclassloader çç¶ loaderï¼åå æ¯ bootstrap loaderï¼å¼å¯¼ç±»å è½½å¨ï¼æ¯ç¨ c è¯­è¨å®ç°çï¼æ¾ä¸å°ä¸ä¸ªç¡®å®çè¿åç¶ loader çæ¹å¼ï¼äºæ¯å°±è¿å nullã\n\nä¸å¾å±ç¤ºçç±»å è½½å¨ä¹é´çå±æ¬¡å³ç³»ï¼ç§°ä¸ºç±»å è½½å¨çåäº²å§æ´¾æ¨¡åï¼parents delegation modelï¼ãè¯¥æ¨¡åè¦æ±é¤äºé¡¶å±ç bootstrap classloader å¤ï¼å¶ä½çç±»å è½½å¨é½åºæèªå·±çç¶ç±»å è½½å¨ãè¿éç±»å è½½å¨ä¹é´çç¶å­å³ç³»ä¸è¬éè¿ç»åï¼compositionï¼å³ç³»æ¥å®ç°ï¼èä¸æ¯éè¿ç»§æ¿ï¼inheritanceï¼çå³ç³»å®ç°ã\n\n\n\nï¼1ï¼å·¥ä½è¿ç¨\n\nä¸ä¸ªç±»å è½½å¨é¦åå°ç±»å è½½è¯·æ±ä¼ éå°ç¶ç±»å è½½å¨ï¼åªæå½ç¶ç±»å è½½å¨æ æ³å®æç±»å è½½è¯·æ±æ¶æå°è¯å è½½ã\n\nï¼2ï¼å¥½å¤\n\nä½¿å¾ java ç±»éçå®çç±»å è½½å¨ä¸èµ·å·æä¸ç§å¸¦æä¼åçº§çå±æ¬¡å³ç³»ï¼ä»èä½¿å¾åºç¡ç±»å¾å°ç»ä¸ï¼\n\n * ç³»ç»ç±»é²æ­¢åå­ä¸­åºç°å¤ä»½åæ ·çå­èç \n * ä¿è¯ java ç¨åºå®å¨ç¨³å®è¿è¡\n\nä¾å¦ï¼ java.lang.object å­æ¾å¨ rt.jar ä¸­ï¼å¦æç¼åå¦å¤ä¸ä¸ª java.lang.object çç±»å¹¶æ¾å° classpath ä¸­ï¼ç¨åºå¯ä»¥ç¼è¯éè¿ãå ä¸ºåäº²å§æ´¾æ¨¡åçå­å¨ï¼æä»¥å¨ rt.jar ä¸­ç object æ¯å¨ classpath ä¸­ç object ä¼åçº§æ´é«ï¼å ä¸º rt.jar ä¸­ç object ä½¿ç¨çæ¯å¯å¨ç±»å è½½å¨ï¼è classpath ä¸­ç object ä½¿ç¨çæ¯åºç¨ç¨åºç±»å è½½å¨ãæ­£å ä¸º rt.jar ä¸­ç object ä¼åçº§æ´é«ï¼å ä¸ºç¨åºä¸­ææç object é½æ¯è¿ä¸ª objectã\n\nï¼3ï¼å®ç°\n\nä»¥ä¸æ¯æ½è±¡ç±» java.lang.classloader çä»£ç çæ®µï¼å¶ä¸­ç loadclass() æ¹æ³è¿è¡è¿ç¨å¦ä¸ï¼\n\npublic abstract class classloader {\n    // the parent class loader for delegation\n    private final classloader parent;\n\n    public class<?> loadclass(string name) throws classnotfoundexception {\n        return loadclass(name, false);\n    }\n\n    protected class<?> loadclass(string name, boolean resolve) throws classnotfoundexception {\n        synchronized (getclassloadinglock(name)) {\n            // é¦åå¤æ­è¯¥ç±»åæ¯å¦å·²ç»è¢«å è½½\n            class<?> c = findloadedclass(name);\n            if (c == null) {\n                // å¦ææ²¡æè¢«å è½½ï¼å°±å§æç»ç¶ç±»å è½½æèå§æ´¾ç»å¯å¨ç±»å è½½å¨å è½½\n                try {\n                    if (parent != null) {\n                        // å¦æå­å¨ç¶ç±»å è½½å¨ï¼å°±å§æ´¾ç»ç¶ç±»å è½½å¨å è½½\n                        c = parent.loadclass(name, false);\n                    } else {\n                        // å¦æä¸å­å¨ç¶ç±»å è½½å¨ï¼å°±æ£æ¥æ¯å¦æ¯ç±å¯å¨ç±»å è½½å¨å è½½çç±»ï¼éè¿è°ç¨æ¬å°æ¹æ³native class findbootstrapclass(string name)\n                        c = findbootstrapclassornull(name);\n                    }\n                } catch (classnotfoundexception e) {\n                    // å¦æç¶ç±»å è½½å¨å è½½å¤±è´¥ï¼ä¼æåº classnotfoundexception\n                }\n\n                if (c == null) {\n                    // å¦æç¶ç±»å è½½å¨åå¯å¨ç±»å è½½å¨é½ä¸è½å®æå è½½ä»»å¡ï¼æè°ç¨èªèº«çå è½½åè½\n                    c = findclass(name);\n                }\n            }\n            if (resolve) {\n                resolveclass(c);\n            }\n            return c;\n        }\n    }\n\n    protected class<?> findclass(string name) throws classnotfoundexception {\n        throw new classnotfoundexception(name);\n    }\n}\n\n\nãè¯´æã\n\n * åæ£æ¥ç±»æ¯å¦å·²ç»å è½½è¿ï¼å¦ææ²¡æåè®©ç¶ç±»å è½½å¨å»å è½½ã\n * å½ç¶ç±»å è½½å¨å è½½å¤±è´¥æ¶æåº classnotfoundexceptionï¼æ­¤æ¶å°è¯èªå·±å»å è½½ã\n\n\n# classloader åæ°\n\nå¨çäº§ç¯å¢ä¸å¯å¨ java åºç¨æ¶ï¼éå¸¸ä¼æå®ä¸äº classloader åæ°ï¼ä»¥å è½½åºç¨æéè¦ç libï¼\n\njava -jar xxx.jar -classpath lib/*\n\n\nclassloader ç¸å³åæ°éé¡¹ï¼\n\nåæ°éé¡¹                                   classloader ç±»å          è¯´æ\n-xbootclasspath                        bootstrap classloader   è®¾ç½® bootstrap classloader æç´¢è·¯å¾ããä¸å¸¸ç¨ã\n-xbootclasspath/a                      bootstrap classloader   æè·¯å¾æ·»å å°å·²å­å¨ç bootstrap classloader æç´¢è·¯å¾åé¢ããå¸¸ç¨ã\n-xbootclasspath/p                      bootstrap classloader   æè·¯å¾æ·»å å°å·²å­å¨ç bootstrap classloader æç´¢è·¯å¾åé¢ããä¸å¸¸ç¨ã\n-djava.ext.dirs                        extclassloader          è®¾ç½® extclassloader æç´¢è·¯å¾ã\n-djava.class.path æ -cp æ -classpath   appclassloader          è®¾ç½® appclassloader æç´¢è·¯å¾ã\n\n\n# ç±»çå è½½\n\n\n# ç±»å è½½æ¹å¼\n\nç±»å è½½æä¸ç§æ¹å¼ï¼\n\n * å½ä»¤è¡å¯å¨åºç¨æ¶åç± jvm åå§åå è½½\n * éè¿ class.forname() æ¹æ³å¨æå è½½\n * éè¿ classloader.loadclass() æ¹æ³å¨æå è½½\n\nclass.forname() å classloader.loadclass() åºå«\n\n * class.forname() å°ç±»ç .class æä»¶å è½½å° jvm ä¸­ä¹å¤ï¼è¿ä¼å¯¹ç±»è¿è¡è§£éï¼æ§è¡ç±»ä¸­ç static åï¼\n * classloader.loadclass() åªå¹²ä¸ä»¶äºæï¼å°±æ¯å° .class æä»¶å è½½å° jvm ä¸­ï¼ä¸ä¼æ§è¡ static ä¸­çåå®¹ï¼åªæå¨ newinstance æä¼å»æ§è¡ static åã\n * class.forname(name, initialize, loader) å¸¦åå½æ°ä¹å¯æ§å¶æ¯å¦å è½½ static åãå¹¶ä¸åªæè°ç¨äº newinstance() æ¹æ³éç¨è°ç¨æé å½æ°ï¼åå»ºç±»çå¯¹è±¡ ã\n\n\n# å è½½ç±»éè¯¯\n\n# classnotfoundexception\n\nclassnotfoundexception å¼å¸¸åºéçæé«ãclassnotfoundexception è¡¨ç¤ºå½å classpath ä¸æ¾ä¸å°æå®ç±»ã\n\nå¸¸è§é®é¢åå ï¼\n\n * è°ç¨ class ç forname() æ¹æ³ï¼æªæ¾å°ç±»ã\n * è°ç¨ classloader ä¸­ç loadclass() æ¹æ³ï¼æªæ¾å°ç±»ã\n * è°ç¨ classloader ä¸­ç findsystemclass() æ¹æ³ï¼æªæ¾å°ç±»ã\n\nãç¤ºä¾ãæ§è¡ä»¥ä¸ä»£ç ï¼ä¼æåº classnotfoundexception å¼å¸¸ï¼\n\npublic class classnotfoundexceptiondemo {\n    public static void main(string[] args) {\n        try {\n            class.forname("notfound");\n        } catch (classnotfoundexception e) {\n            e.printstacktrace();\n        }\n    }\n}\n\n\nè§£å³æ¹æ³ï¼æ£æ¥ classpath ä¸ææ²¡æç¸åºç class æä»¶ã\n\n# noclassdeffounderror\n\nå¸¸è§é®é¢åå ï¼\n\n * ç±»ä¾èµç class æè jar ä¸å­å¨ã\n * ç±»æä»¶å­å¨ï¼ä½æ¯å­å¨ä¸åçåä¸­ã\n\nè§£å³æ¹æ³ï¼ç°ä»£ java é¡¹ç®ï¼ä¸è¬ä½¿ç¨ mavenãgradle ç­æå»ºå·¥å·ç®¡çé¡¹ç®ï¼ä»ç»æ£æ¥æ¾ä¸å°çç±»æå¨ç jar åæ¯å¦å·²æ·»å ä¸ºä¾èµã\n\n# unsatisfiedlinkerror\n\nè¿ä¸ªå¼å¸¸åä¸æ¯å¾å¸¸è§ï¼ä½æ¯åºéçè¯ï¼éå¸¸æ¯å¨ jvm å¯å¨çæ¶åå¦æä¸ä¸å°å¿å°å¨ jvm ä¸­çæä¸ª lib å é¤äºï¼å¯è½å°±ä¼æ¥è¿ä¸ªéè¯¯äºã\n\nãç¤ºä¾ãæ§è¡ä»¥ä¸ä»£ç ï¼ä¼æåº unsatisfiedlinkerror éè¯¯ã\n\npublic class unsatisfiedlinkerrordemo {\n\n    public native void nativemethod();\n\n    static {\n        system.loadlibrary("nolib");\n    }\n\n    public static void main(string[] args) {\n        new unsatisfiedlinkerrordemo().nativemethod();\n    }\n\n}\n\n\nãè¾åºã\n\njava.lang.unsatisfiedlinkerror: no nolib in java.library.path\n\tat java.lang.classloader.loadlibrary(classloader.java:1867)\n\tat java.lang.runtime.loadlibrary0(runtime.java:870)\n\tat java.lang.system.loadlibrary(system.java:1122)\n\tat io.github.dunwu.javacore.jvm.classloader.exception.unsatisfiedlinkerrordemo.<clinit>(unsatisfiedlinkerrordemo.java:12)\n\n\n# classcastexception\n\nclasscastexception å¼å¸¸éå¸¸æ¯å¨ç¨åºä¸­å¼ºå¶ç±»åè½¬æ¢å¤±è´¥æ¶åºç°ã\n\nãç¤ºä¾ãæ§è¡ä»¥ä¸ä»£ç ï¼ä¼æåº classcastexception å¼å¸¸ã\n\npublic class classcastexceptiondemo {\n\n    public static void main(string[] args) {\n        object obj = new object();\n        emptyclass newobj = (emptyclass) obj;\n    }\n\n    static class emptyclass {}\n\n}\n\n\nãè¾åºã\n\nexception in thread "main" java.lang.classcastexception: java.lang.object cannot be cast to io.github.dunwu.javacore.jvm.classloader.exception.classcastexceptiondemo$emptyclass\n\tat io.github.dunwu.javacore.jvm.classloader.exception.classcastexceptiondemo.main(classcastexceptiondemo.java:11)\n\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * æ·±å¥æè§£ java èææº\n * ä¸ç¯å¾æå½»åºå¼æç±»å è½½å¨ä¸åäº²å§æ´¾æºå¶\n * jvm ç³»å(ä¸):java ç±»çå è½½æºå¶',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JVM å½ä»¤è¡å·¥å·",frontmatter:{title:"JVM å½ä»¤è¡å·¥å·",date:"2020-07-30T17:56:33.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM","å½ä»¤è¡"],permalink:"/pages/c590ae/"},regularPath:"/01.Java/01.JavaSE/06.JVM/11.JVM%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7.html",relativePath:"01.Java/01.JavaSE/06.JVM/11.JVMå½ä»¤è¡å·¥å·.md",key:"v-cc303ce8",path:"/pages/c590ae/",headers:[{level:2,title:"jps",slug:"jps",normalizedTitle:"jps",charIndex:149},{level:3,title:"jps å½ä»¤ç¨æ³",slug:"jps-å½ä»¤ç¨æ³",normalizedTitle:"jps å½ä»¤ç¨æ³",charIndex:684},{level:3,title:"jps ä½¿ç¨ç¤ºä¾",slug:"jps-ä½¿ç¨ç¤ºä¾",normalizedTitle:"jps ä½¿ç¨ç¤ºä¾",charIndex:1024},{level:2,title:"jstat",slug:"jstat",normalizedTitle:"jstat",charIndex:186},{level:3,title:"jstat å½ä»¤ç¨æ³",slug:"jstat-å½ä»¤ç¨æ³",normalizedTitle:"jstat å½ä»¤ç¨æ³",charIndex:1428},{level:3,title:"jstat ä½¿ç¨ç¤ºä¾",slug:"jstat-ä½¿ç¨ç¤ºä¾",normalizedTitle:"jstat ä½¿ç¨ç¤ºä¾",charIndex:2179},{level:4,title:"ç±»å è½½ç»è®¡",slug:"ç±»å è½½ç»è®¡",normalizedTitle:"ç±»å è½½ç»è®¡",charIndex:304},{level:4,title:"ç¼è¯ç»è®¡",slug:"ç¼è¯ç»è®¡",normalizedTitle:"ç¼è¯ç»è®¡",charIndex:2226},{level:4,title:"GC ç»è®¡",slug:"gc-ç»è®¡",normalizedTitle:"gc ç»è®¡",charIndex:2828},{level:2,title:"jmap",slug:"jmap",normalizedTitle:"jmap",charIndex:266},{level:3,title:"jmap å½ä»¤ç¨æ³",slug:"jmap-å½ä»¤ç¨æ³",normalizedTitle:"jmap å½ä»¤ç¨æ³",charIndex:5231},{level:3,title:"jstat ä½¿ç¨ç¤ºä¾",slug:"jstat-ä½¿ç¨ç¤ºä¾-2",normalizedTitle:"jstat ä½¿ç¨ç¤ºä¾",charIndex:2179},{level:4,title:"çæ heapdump å¿«ç§",slug:"çæ-heapdump-å¿«ç§",normalizedTitle:"çæ heapdump å¿«ç§",charIndex:5576},{level:4,title:"æ¥çå®ä¾æ°æå¤çç±»",slug:"æ¥çå®ä¾æ°æå¤çç±»",normalizedTitle:"æ¥çå®ä¾æ°æå¤çç±»",charIndex:5817},{level:4,title:"æ¥çæå®è¿ç¨çå ä¿¡æ¯",slug:"æ¥çæå®è¿ç¨çå ä¿¡æ¯",normalizedTitle:"æ¥çæå®è¿ç¨çå ä¿¡æ¯",charIndex:6093},{level:2,title:"jstack",slug:"jstack",normalizedTitle:"jstack",charIndex:357},{level:3,title:"jstack å½ä»¤ç¨æ³",slug:"jstack-å½ä»¤ç¨æ³",normalizedTitle:"jstack å½ä»¤ç¨æ³",charIndex:8158},{level:3,title:"thread dump æä»¶",slug:"thread-dump-æä»¶",normalizedTitle:"thread dump æä»¶",charIndex:8302},{level:4,title:"ç¬¬ä¸é¨åï¼Full thread dump identifier",slug:"ç¬¬ä¸é¨å-full-thread-dump-identifier",normalizedTitle:"ç¬¬ä¸é¨åï¼full thread dump identifier",charIndex:8352},{level:4,title:"ç¬¬äºé¨åï¼Java EE middleware, third party & custom application Threads",slug:"ç¬¬äºé¨å-java-ee-middleware-third-party-custom-application-threads",normalizedTitle:"ç¬¬äºé¨åï¼java ee middleware, third party &amp; custom application threads",charIndex:null},{level:4,title:"ç¬¬ä¸é¨åï¼HotSpot VM Thread",slug:"ç¬¬ä¸é¨å-hotspot-vm-thread",normalizedTitle:"ç¬¬ä¸é¨åï¼hotspot vm thread",charIndex:9780},{level:5,title:'"Attach Listener"',slug:"attach-listener",normalizedTitle:"&quot;attach listener&quot;",charIndex:null},{level:5,title:'"DestroyJavaVM"',slug:"destroyjavavm",normalizedTitle:"&quot;destroyjavavm&quot;",charIndex:null},{level:5,title:'"Service Thread"',slug:"service-thread",normalizedTitle:"&quot;service thread&quot;",charIndex:null},{level:5,title:'"CompilerThread"',slug:"compilerthread",normalizedTitle:"&quot;compilerthread&quot;",charIndex:null},{level:5,title:'"Signal Dispatcher"',slug:"signal-dispatcher",normalizedTitle:"&quot;signal dispatcher&quot;",charIndex:null},{level:5,title:'"Finalizer"',slug:"finalizer",normalizedTitle:"&quot;finalizer&quot;",charIndex:null},{level:5,title:'"Reference Handler"',slug:"reference-handler",normalizedTitle:"&quot;reference handler&quot;",charIndex:null},{level:5,title:'"VM Thread"',slug:"vm-thread",normalizedTitle:"&quot;vm thread&quot;",charIndex:null},{level:4,title:"ç¬¬åé¨åï¼HotSpot GC Thread",slug:"ç¬¬åé¨å-hotspot-gc-thread",normalizedTitle:"ç¬¬åé¨åï¼hotspot gc thread",charIndex:13318},{level:5,title:'"VM Periodic Task Thread"',slug:"vm-periodic-task-thread",normalizedTitle:"&quot;vm periodic task thread&quot;",charIndex:null},{level:5,title:'"GC task thread#0 (ParallelGC)"',slug:"gc-task-thread-0-parallelgc",normalizedTitle:"&quot;gc task thread#0 (parallelgc)&quot;",charIndex:null},{level:5,title:'"Gang worker#0 (Parallel GC Threads)"',slug:"gang-worker-0-parallel-gc-threads",normalizedTitle:"&quot;gang worker#0 (parallel gc threads)&quot;",charIndex:null},{level:5,title:'"Concurrent Mark-Sweep GC Thread"',slug:"concurrent-mark-sweep-gc-thread",normalizedTitle:"&quot;concurrent mark-sweep gc thread&quot;",charIndex:null},{level:5,title:'"Surrogate Locker Thread (Concurrent GC)"',slug:"surrogate-locker-thread-concurrent-gc",normalizedTitle:"&quot;surrogate locker thread (concurrent gc)&quot;",charIndex:null},{level:4,title:"ç¬¬äºé¨åï¼JNI global references count",slug:"ç¬¬äºé¨å-jni-global-references-count",normalizedTitle:"ç¬¬äºé¨åï¼jni global references count",charIndex:16301},{level:3,title:"ç³»ç»çº¿ç¨ç¶æ",slug:"ç³»ç»çº¿ç¨ç¶æ",normalizedTitle:"ç³»ç»çº¿ç¨ç¶æ",charIndex:9562},{level:4,title:"deadlock",slug:"deadlock",normalizedTitle:"deadlock",charIndex:16520},{level:4,title:"runnable",slug:"runnable",normalizedTitle:"runnable",charIndex:10437},{level:4,title:"blocked",slug:"blocked",normalizedTitle:"blocked",charIndex:19170},{level:4,title:"waiting on condition",slug:"waiting-on-condition",normalizedTitle:"waiting on condition",charIndex:8718},{level:4,title:"waiting for monitor entry æ in Object.wait()",slug:"waiting-for-monitor-entry-æ-in-object-wait",normalizedTitle:"waiting for monitor entry æ in object.wait()",charIndex:22453},{level:3,title:"jstack ä½¿ç¨ç¤ºä¾",slug:"jstack-ä½¿ç¨ç¤ºä¾",normalizedTitle:"jstack ä½¿ç¨ç¤ºä¾",charIndex:23679},{level:4,title:"æ¾åºæ Java è¿ç¨ä¸­æèè´¹ CPU ç Java çº¿ç¨",slug:"æ¾åºæ-java-è¿ç¨ä¸­æèè´¹-cpu-ç-java-çº¿ç¨",normalizedTitle:"æ¾åºæ java è¿ç¨ä¸­æèè´¹ cpu ç java çº¿ç¨",charIndex:23694},{level:4,title:"çæ threaddump æä»¶",slug:"çæ-threaddump-æä»¶",normalizedTitle:"çæ threaddump æä»¶",charIndex:24951},{level:2,title:"jinfo",slug:"jinfo",normalizedTitle:"jinfo",charIndex:480},{level:2,title:"jhat",slug:"jhat",normalizedTitle:"jhat",charIndex:448},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:25975}],headersStr:'jps jps å½ä»¤ç¨æ³ jps ä½¿ç¨ç¤ºä¾ jstat jstat å½ä»¤ç¨æ³ jstat ä½¿ç¨ç¤ºä¾ ç±»å è½½ç»è®¡ ç¼è¯ç»è®¡ GC ç»è®¡ jmap jmap å½ä»¤ç¨æ³ jstat ä½¿ç¨ç¤ºä¾ çæ heapdump å¿«ç§ æ¥çå®ä¾æ°æå¤çç±» æ¥çæå®è¿ç¨çå ä¿¡æ¯ jstack jstack å½ä»¤ç¨æ³ thread dump æä»¶ ç¬¬ä¸é¨åï¼Full thread dump identifier ç¬¬äºé¨åï¼Java EE middleware, third party & custom application Threads ç¬¬ä¸é¨åï¼HotSpot VM Thread "Attach Listener" "DestroyJavaVM" "Service Thread" "CompilerThread" "Signal Dispatcher" "Finalizer" "Reference Handler" "VM Thread" ç¬¬åé¨åï¼HotSpot GC Thread "VM Periodic Task Thread" "GC task thread#0 (ParallelGC)" "Gang worker#0 (Parallel GC Threads)" "Concurrent Mark-Sweep GC Thread" "Surrogate Locker Thread (Concurrent GC)" ç¬¬äºé¨åï¼JNI global references count ç³»ç»çº¿ç¨ç¶æ deadlock runnable blocked waiting on condition waiting for monitor entry æ in Object.wait() jstack ä½¿ç¨ç¤ºä¾ æ¾åºæ Java è¿ç¨ä¸­æèè´¹ CPU ç Java çº¿ç¨ çæ threaddump æä»¶ jinfo jhat åèèµæ',content:'# JVM å½ä»¤è¡å·¥å·\n\n> Java ç¨åºååä¸äºæéææ¥å·¥ä½ï¼æä»¥ç»å¸¸éè¦ä½¿ç¨ä¸äº JVM å·¥å·ã\n> \n> JDK èªå¸¦äºä¸äºå®ç¨çå½ä»¤è¡å·¥å·æ¥çæ§ãåæ JVM ä¿¡æ¯ï¼ææ¡å®ä»¬ï¼éå¸¸æå©äº TroubleShootingã\n\nä»¥ä¸æ¯è¾å¸¸ç¨ç JDK å½ä»¤è¡å·¥å·ï¼\n\nåç§°       æè¿°\njps      JVM è¿ç¨ç¶æå·¥å·ãæ¾ç¤ºç³»ç»åçææ JVM è¿ç¨ã\njstat    JVM ç»è®¡çæ§å·¥å·ãçæ§èææºè¿è¡æ¶ç¶æä¿¡æ¯ï¼å®å¯ä»¥æ¾ç¤ºåº JVM è¿ç¨ä¸­çç±»è£è½½ãåå­ãGCãJIT\n         ç¼è¯ç­è¿è¡æ°æ®ã\njmap     JVM å åå­åæå·¥å·ãç¨äºæå° JVM è¿ç¨å¯¹è±¡ç´æ¹å¾ãç±»å è½½ç»è®¡ãå¹¶ä¸å¯ä»¥çæå è½¬å¨å¿«ç§ï¼ä¸è¬ç§°ä¸º heapdump\n         æ dump æä»¶ï¼ã\njstack   JVM æ æ¥çå·¥å·ãç¨äºæå° JVM è¿ç¨ççº¿ç¨åéçæåµãå¹¶ä¸å¯ä»¥çæçº¿ç¨å¿«ç§ï¼ä¸è¬ç§°ä¸º threaddump æ\n         javacore æä»¶ï¼ã\njhat     ç¨æ¥åæ jmap çæç dump æä»¶ã\njinfo    JVM ä¿¡æ¯æ¥çå·¥å·ãç¨äºå®æ¶æ¥çåè°æ´ JVM è¿ç¨åæ°ã\njcmd     JVM å½ä»¤è¡è°è¯ å·¥å·ãç¨äºå JVM è¿ç¨åéè°è¯å½ä»¤ã\n\n\n# jps\n\n> jps(JVM Process Status Tool) æ¯èææºè¿ç¨ç¶æå·¥å·ãå®å¯ä»¥æ¾ç¤ºæå®ç³»ç»åææç HotSpot èææºè¿ç¨ç¶æä¿¡æ¯ãjps éè¿ RMI åè®®æ¥è¯¢å¼å¯äº RMI æå¡çè¿ç¨èææºè¿ç¨ç¶æã\n\n\n# jps å½ä»¤ç¨æ³\n\njps [option] [hostid]\njps [-help]\n\n\nå¦æä¸æå® hostid å°±é»è®¤ä¸ºå½åä¸»æºææå¡å¨ã\n\nå¸¸ç¨åæ°ï¼\n\n * option - éé¡¹åæ°\n   * -m - è¾åº JVM å¯å¨æ¶ä¼ éç» main() çåæ°ã\n   * -l - è¾åºä¸»ç±»çå¨åï¼å¦æè¿ç¨æ§è¡çæ¯ jar åï¼è¾åº jar è·¯å¾ã\n   * -v - æ¾ç¤ºä¼ éç» JVM çåæ°ã\n   * -q - ä»è¾åºæ¬å° JVM è¿ç¨ IDã\n   * -V - ä»è¾åºæ¬å° JVM æ è¯ç¬¦ã\n * hostid - RMI æ³¨åè¡¨ä¸­æ³¨åçä¸»æºåãå¦æä¸æå® hostid å°±é»è®¤ä¸ºå½åä¸»æºææå¡å¨ã\n\nå¶ä¸­ optionãhostid åæ°ä¹å¯ä»¥ä¸åã\n\n\n# jps ä½¿ç¨ç¤ºä¾\n\nãç¤ºä¾ãååºæ¬å° Java è¿ç¨\n\n$ jps\n18027 Java2Demo.JAR\n18032 jps\n18005 jstat\n\n\nãç¤ºä¾ãååºæ¬å° Java è¿ç¨ ID\n\n$ jps -q\n8841\n1292\n5398\n\n\nãç¤ºä¾ãååºæ¬å° Java è¿ç¨ IDï¼å¹¶è¾åºä¸»ç±»çå¨åï¼å¦æè¿ç¨æ§è¡çæ¯ jar åï¼è¾åº jar è·¯å¾\n\n$ jps -l remote.domain\n3002 /opt/jdk1.7.0/demo/jfc/Java2D/Java2Demo.JAR\n2857 sun.tools.jstatd.jstatd\n\n\n\n# jstat\n\n> jstat(JVM statistics Monitoring)ï¼æ¯èææºç»è®¡ä¿¡æ¯çè§å·¥å·ãjstat ç¨äºçè§èææºè¿è¡æ¶ç¶æä¿¡æ¯ï¼å®å¯ä»¥æ¾ç¤ºåºèææºè¿ç¨ä¸­çç±»è£è½½ãåå­ãåå¾æ¶éãJIT ç¼è¯ç­è¿è¡æ°æ®ã\n\n\n# jstat å½ä»¤ç¨æ³\n\nå½ä»¤æ ¼å¼ï¼\n\njstat [option] VMID [interval] [count]\n\n\nå¸¸ç¨åæ°ï¼\n\n * option - éé¡¹åæ°ï¼ç¨äºæå®ç¨æ·éè¦æ¥è¯¢çèææºä¿¡æ¯\n   * -class - çè§ç±»è£è½½ãå¸è½½æ°éãæ»ç©ºé´ä»¥åç±»è£è½½æèè´¹çæ¶é´\n   * -compilerï¼æ¾ç¤º JIT ç¼è¯çç¸å³ä¿¡æ¯ï¼\n   * -gcï¼çè§ Java å ç¶åµï¼åæ¬ Eden åºãä¸¤ä¸ª survivor åºãèå¹´ä»£ãæ°¸ä¹ä»£ç­åºçå®¹éãå·²ç¨ç©ºé´ãGC æ¶é´åè®¡ç­ä¿¡æ¯ã\n   * -gccapacityï¼æ¾ç¤ºåä¸ªä»£çå®¹éä»¥åä½¿ç¨æåµï¼\n   * -gcmetacapacityï¼æ¾ç¤º Metaspace çå¤§å°ï¼\n   * -gcnewï¼æ¾ç¤ºæ°çä»£ä¿¡æ¯ï¼\n   * -gcnewcapacityï¼æ¾ç¤ºæ°çä»£å¤§å°åä½¿ç¨æåµï¼\n   * -gcoldï¼æ¾ç¤ºèå¹´ä»£åæ°¸ä¹ä»£çä¿¡æ¯ï¼\n   * -gcoldcapacityï¼æ¾ç¤ºèå¹´ä»£çå¤§å°ï¼\n   * -gcutilï¼æ¾ç¤ºåå¾åæ¶ç»è®¡ä¿¡æ¯ï¼\n   * -gccauseï¼æ¾ç¤ºåå¾åæ¶çç¸å³ä¿¡æ¯ï¼é -gcutilï¼ï¼åæ¶æ¾ç¤ºæåä¸æ¬¡æå½åæ­£å¨åççåå¾åæ¶çè¯±å ï¼\n   * -printcompilationï¼è¾åº JIT ç¼è¯çæ¹æ³ä¿¡æ¯ã\n * VMID - å¦ææ¯æ¬å°èææºè¿ç¨ï¼å VMID ä¸ LVMID æ¯ä¸è´çï¼å¦ææ¯è¿ç¨èææºè¿ç¨ï¼é£ VMID çæ ¼å¼åºå½æ¯ï¼[protocol:][//]lvmid[@hostname[:port]/servername]\n * interval - æ¥è¯¢é´é\n * count - æ¥è¯¢æ¬¡æ°\n\n> ãåèãæ´è¯¦ç»è¯´æå¯ä»¥åèï¼jstat å½ä»¤æ¥ç jvm ç GC æåµ\n\n\n# jstat ä½¿ç¨ç¤ºä¾\n\n# ç±»å è½½ç»è®¡\n\nä½¿ç¨ jstat -class pid å½ä»¤å¯ä»¥æ¥çç¼è¯ç»è®¡ä¿¡æ¯ã\n\nãåæ°ã\n\n * Loaded - å è½½ class çæ°é\n * Bytes - æå ç¨ç©ºé´å¤§å°\n * Unloaded - æªå è½½æ°é\n * Bytes - æªå è½½å ç¨ç©ºé´\n * Time - æ¶é´\n\nãç¤ºä¾ãæ¥çç±»å è½½ä¿¡æ¯\n\n$ jstat -class 7129\nLoaded  Bytes  Unloaded  Bytes     Time\n 26749 50405.3      873  1216.8      19.75\n\n\n# ç¼è¯ç»è®¡\n\nä½¿ç¨ jstat -compiler pid å½ä»¤å¯ä»¥æ¥çç¼è¯ç»è®¡ä¿¡æ¯ã\n\nãç¤ºä¾ã\n\n$ jstat -compiler 7129\nCompiled Failed Invalid   Time   FailedType FailedMethod\n   42030      2       0   302.53          1 org/apache/felix/framework/BundleWiringImpl$BundleClassLoader findClass\n\n\nãåæ°ã\n\n * Compiled - ç¼è¯æ°é\n * Failed - å¤±è´¥æ°é\n * Invalid - ä¸å¯ç¨æ°é\n * Time - æ¶é´\n * FailedType - å¤±è´¥ç±»å\n * FailedMethod - å¤±è´¥çæ¹æ³\n\n# GC ç»è®¡\n\nä½¿ç¨ jstat -gc pid time å½ä»¤å¯ä»¥æ¥ç GC ç»è®¡ä¿¡æ¯ã\n\nãç¤ºä¾ãä»¥ 250 æ¯«ç§çé´éè¿è¡ 7 ä¸ªéæ ·ï¼å¹¶æ¾ç¤º-gcutil éé¡¹æå®çè¾åºã\n\n$ jstat -gcutil 21891 250 7\n  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT\n  0.00  97.02  70.31  66.80  95.52  89.14      7    0.300     0    0.000    0.300\n  0.00  97.02  86.23  66.80  95.52  89.14      7    0.300     0    0.000    0.300\n  0.00  97.02  96.53  66.80  95.52  89.14      7    0.300     0    0.000    0.300\n 91.03   0.00   1.98  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n 91.03   0.00  15.82  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n 91.03   0.00  17.80  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n 91.03   0.00  17.80  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n\n\nãç¤ºä¾ãä»¥ 1 ç§çé´éè¿è¡ 4 ä¸ªéæ ·ï¼å¹¶æ¾ç¤º-gc éé¡¹æå®çè¾åºã\n\n$ jstat -gc 25196 1s 4\n S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n\n\nåæ°è¯´æï¼\n\n * S0Cï¼å¹´è½»ä»£ä¸­ To Survivor çå®¹éï¼åä½ KBï¼ï¼\n * S1Cï¼å¹´è½»ä»£ä¸­ From Survivor çå®¹éï¼åä½ KBï¼ï¼\n * S0Uï¼å¹´è½»ä»£ä¸­ To Survivor ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ KBï¼ï¼\n * S1Uï¼å¹´è½»ä»£ä¸­ From Survivor ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ KBï¼ï¼\n * ECï¼å¹´è½»ä»£ä¸­ Eden çå®¹éï¼åä½ KBï¼ï¼\n * EUï¼å¹´è½»ä»£ä¸­ Eden ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ KBï¼ï¼\n * OCï¼Old ä»£çå®¹éï¼åä½ KBï¼ï¼\n * OUï¼Old ä»£ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ KBï¼ï¼\n * MCï¼Metaspace çå®¹éï¼åä½ KBï¼ï¼\n * MUï¼Metaspace ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ KBï¼ï¼\n * YGCï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶å¹´è½»ä»£ä¸­ gc æ¬¡æ°ï¼\n * YGCTï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶å¹´è½»ä»£ä¸­ gc æç¨æ¶é´ (s)ï¼\n * FGCï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ old ä»£ï¼å¨ gcï¼gc æ¬¡æ°ï¼\n * FGCTï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ old ä»£ï¼å¨ gcï¼gc æç¨æ¶é´ (s)ï¼\n * GCTï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ gc ç¨çæ»æ¶é´ (s)ã\n\n> æ³¨ï¼æ´è¯¦ç»çåæ°å«ä¹å¯ä»¥åèå®æ¹ææ¡£ï¼http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html\n\n\n# jmap\n\n> jmap(JVM Memory Map) æ¯ Java åå­æ åå·¥å·ãjmap ç¨äºçæå è½¬å¨å¿«ç§ï¼ä¸è¬ç§°ä¸º heapdump æ dump æä»¶ï¼ãjmap ä¸ä»è½çæ dump æä»¶ï¼è¿å¯ä»¥æ¥è¯¢ finalize æ§è¡éåãJava å åæ°¸ä¹ä»£çè¯¦ç»ä¿¡æ¯ï¼å¦å½åä½¿ç¨çãå½åä½¿ç¨çæ¯åªç§æ¶éå¨ç­ã\n> \n> å¦æä¸ä½¿ç¨è¿ä¸ªå½ä»¤ï¼è¿å¯ä»¥ä½¿ç¨ -XX:+HeapDumpOnOutOfMemoryError åæ°æ¥è®©èææºåºç° OOM çæ¶åï¼èªå¨çæ dump æä»¶ã\n\n\n# jmap å½ä»¤ç¨æ³\n\nå½ä»¤æ ¼å¼ï¼\n\njmap [option] pid\n\n\noption éé¡¹åæ°ï¼\n\n * -dump - çæå è½¬å¨å¿«ç§ã-dump:live åªä¿å­å ä¸­çå­æ´»å¯¹è±¡ã\n * -finalizerinfo - æ¾ç¤ºå¨ F-Queue éåç­å¾æ§è¡ finalizer æ¹æ³çå¯¹è±¡\n * -heap - æ¾ç¤º Java å è¯¦ç»ä¿¡æ¯ã\n * -histo - æ¾ç¤ºå ä¸­å¯¹è±¡çç»è®¡ä¿¡æ¯ï¼åæ¬ç±»ãå®ä¾æ°éãåè®¡å®¹éã-histo:live åªç»è®¡å ä¸­çå­æ´»å¯¹è±¡ã\n * -permstat - to print permanent generation statistics\n * -F - å½-dump æ²¡æååºæ¶ï¼å¼ºå¶çæ dump å¿«ç§\n\n\n# jstat ä½¿ç¨ç¤ºä¾\n\n# çæ heapdump å¿«ç§\n\ndump å å°æä»¶ï¼format æå®è¾åºæ ¼å¼ï¼live æææ¯æ´»ççå¯¹è±¡ï¼file æå®æä»¶å\n\n$ jmap -dump:live,format=b,file=dump.hprof 28920\nDumping heap to /home/xxx/dump.hprof ...\nHeap dump file created\n\n\ndump.hprof è¿ä¸ªåç¼æ¯ä¸ºäºåç»­å¯ä»¥ç´æ¥ç¨ MAT(Memory Anlysis Tool)ç­å·¥å·æå¼ã\n\n# æ¥çå®ä¾æ°æå¤çç±»\n\n$ jmap -histo 29527 | head -n 6\n\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:      13673280     1438961864  [C\n   2:       1207166      411277184  [I\n   3:       7382322      347307096  [Ljava.lang.Object;\n\n\n# æ¥çæå®è¿ç¨çå ä¿¡æ¯\n\næ³¨æï¼ä½¿ç¨ CMS GC æåµä¸ï¼jmap -heap PID çæ§è¡æå¯è½ä¼å¯¼è´ java è¿ç¨æèµ·ã\n\n$ jmap -heap 12379\nAttaching to process ID 12379, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 17.0-b16\n\nusing thread-local object allocation.\nParallel GC with 6 thread(s)\n\nHeap Configuration:\n   MinHeapFreeRatio = 40\n   MaxHeapFreeRatio = 70\n   MaxHeapSize      = 83886080 (80.0MB)\n   NewSize          = 1310720 (1.25MB)\n   MaxNewSize       = 17592186044415 MB\n   OldSize          = 5439488 (5.1875MB)\n   NewRatio         = 2\n   SurvivorRatio    = 8\n   PermSize         = 20971520 (20.0MB)\n   MaxPermSize      = 88080384 (84.0MB)\n\nHeap Usage:\nPS Young Generation\nEden Space:\n   capacity = 9306112 (8.875MB)\n   used     = 5375360 (5.1263427734375MB)\n   free     = 3930752 (3.7486572265625MB)\n   57.761608714788736% used\nFrom Space:\n   capacity = 9306112 (8.875MB)\n   used     = 3425240 (3.2665634155273438MB)\n   free     = 5880872 (5.608436584472656MB)\n   36.80634834397007% used\nTo Space:\n   capacity = 9306112 (8.875MB)\n   used     = 0 (0.0MB)\n   free     = 9306112 (8.875MB)\n   0.0% used\nPS Old Generation\n   capacity = 55967744 (53.375MB)\n   used     = 48354640 (46.11457824707031MB)\n   free     = 7613104 (7.2604217529296875MB)\n   86.39733629427693% used\nPS Perm Generation\n   capacity = 62062592 (59.1875MB)\n   used     = 60243112 (57.452308654785156MB)\n   free     = 1819480 (1.7351913452148438MB)\n   97.06831451706046% used\n\n\n\n# jstack\n\n> jstack(Stack Trace for java) æ¯ Java å æ è·è¸ªå·¥å·ãjstack ç¨æ¥æå°ç®æ  Java è¿ç¨ä¸­åä¸ªçº¿ç¨çæ è½¨è¿¹ï¼ä»¥åè¿äºçº¿ç¨æææçéï¼å¹¶å¯ä»¥çæ java èææºå½åæ¶å»ççº¿ç¨å¿«ç§ï¼ä¸è¬ç§°ä¸º threaddump æ javacore æä»¶ï¼ã\n> \n> çº¿ç¨å¿«ç§æ¯å½åèææºåæ¯ä¸æ¡çº¿ç¨æ­£å¨æ§è¡çæ¹æ³å æ çéåï¼çæçº¿ç¨å¿«ç§çä¸»è¦ç®çæ¯å®ä½çº¿ç¨åºç°é¿æ¶é´åé¡¿çåå ï¼å¦çº¿ç¨é´æ­»éãæ­»å¾ªç¯ãè¯·æ±å¤é¨èµæºå¯¼è´çé¿æ¶é´ç­å¾ç­ã\n\njstack éå¸¸ä¼ç»å top -Hp pid æ pidstat -p pid -t ä¸èµ·æ¥çå·ä½çº¿ç¨çç¶æï¼ä¹ç»å¸¸ç¨æ¥ææ¥ä¸äºæ­»éçå¼å¸¸ã\n\nçº¿ç¨åºç°åé¡¿çæ¶åéè¿ jstack æ¥æ¥çåä¸ªçº¿ç¨çè°ç¨å æ ï¼å°±å¯ä»¥ç¥éæ²¡æååºççº¿ç¨å°åºå¨åå°åä»ä¹äºæï¼æèç­å¾ä»ä¹èµæºã å¦æ java ç¨åºå´©æºçæ core æä»¶ï¼jstack å·¥å·å¯ä»¥ç¨æ¥è·å¾ core æä»¶ç java stack å native stack çä¿¡æ¯ï¼ä»èå¯ä»¥è½»æ¾å°ç¥é java ç¨åºæ¯å¦ä½å´©æºåå¨ç¨åºä½å¤åçé®é¢ãå¦å¤ï¼jstack å·¥å·è¿å¯ä»¥éå±å°æ­£å¨è¿è¡ç java ç¨åºä¸­ï¼çå°å½æ¶è¿è¡ç java ç¨åºç java stack å native stack çä¿¡æ¯, å¦æç°å¨è¿è¡ç java ç¨åºåç° hung çç¶æï¼jstack æ¯éå¸¸æç¨çã\n\n\n# jstack å½ä»¤ç¨æ³\n\nå½ä»¤æ ¼å¼ï¼\n\njstack [option] pid\n\n\noption éé¡¹åæ°\n\n * -F - å½æ­£å¸¸è¾åºè¯·æ±ä¸è¢«ååºæ¶ï¼å¼ºå¶è¾åºçº¿ç¨å æ \n * -l - é¤å æ å¤ï¼æ¾ç¤ºå³äºéçéå ä¿¡æ¯\n * -m - æå° java å jni æ¡æ¶çæææ ä¿¡æ¯\n\n\n# thread dump æä»¶\n\n\n\nä¸ä¸ª Thread Dump æä»¶å¤§è´å¯ä»¥åä¸ºäºä¸ªé¨åã\n\n# ç¬¬ä¸é¨åï¼Full thread dump identifier\n\nè¿ä¸é¨åæ¯åå®¹æå¼å§çé¨åï¼å±ç¤ºäºå¿«ç§æä»¶ççææ¶é´å JVM ççæ¬ä¿¡æ¯ã\n\n2017-10-19 10:46:44\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (24.79-b02 mixed mode):\n\n\n# ç¬¬äºé¨åï¼Java EE middleware, third party & custom application Threads\n\nè¿æ¯æ´ä¸ªæä»¶çæ ¸å¿é¨åï¼éé¢å±ç¤ºäº JavaEE å®¹å¨ï¼å¦ tomcatãresin ç­ï¼ãèªå·±çç¨åºä¸­æä½¿ç¨ççº¿ç¨ä¿¡æ¯ã\n\n"resin-22129" daemon prio=10 tid=0x00007fbe5c34e000 nid=0x4cb1 waiting on condition [0x00007fbe4ff7c000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:315)\n    at com.caucho.env.thread2.ResinThread2.park(ResinThread2.java:196)\n    at com.caucho.env.thread2.ResinThread2.runTasks(ResinThread2.java:147)\n    at com.caucho.env.thread2.ResinThread2.run(ResinThread2.java:118)\n\n\nåæ°è¯´æï¼\n\n * "resin-22129" **çº¿ç¨åç§°ï¼**å¦æä½¿ç¨ java.lang.Thread ç±»çæä¸ä¸ªçº¿ç¨çæ¶åï¼çº¿ç¨åç§°ä¸º Thread-(æ°å­) çå½¢å¼ï¼è¿éæ¯ resin çæççº¿ç¨ï¼\n * daemon **çº¿ç¨ç±»åï¼**çº¿ç¨åä¸ºå®æ¤çº¿ç¨ (daemon) åéå®æ¤çº¿ç¨ (non-daemon) ä¸¤ç§ï¼éå¸¸é½æ¯å®æ¤çº¿ç¨ï¼\n * prio=10 **çº¿ç¨ä¼åçº§ï¼**é»è®¤ä¸º 5ï¼æ°å­è¶å¤§ä¼åçº§è¶é«ï¼\n * tid=0x00007fbe5c34e000 **JVM çº¿ç¨ç idï¼**JVM åé¨çº¿ç¨çå¯ä¸æ è¯ï¼éè¿ java.lang.Thread.getId()è·åï¼éå¸¸ç¨èªå¢çæ¹å¼å®ç°ï¼\n * nid=0x4cb1 **ç³»ç»çº¿ç¨ idï¼**å¯¹åºçç³»ç»çº¿ç¨ idï¼Native Thread ID)ï¼å¯ä»¥éè¿ top å½ä»¤è¿è¡æ¥çï¼ç°åº id æ¯åå­è¿å¶çå½¢å¼ï¼\n * waiting on condition **ç³»ç»çº¿ç¨ç¶æï¼**è¿éæ¯ç³»ç»ççº¿ç¨ç¶æï¼\n * [0x00007fbe4ff7c000] **èµ·å§æ å°åï¼**çº¿ç¨å æ è°ç¨çå¶å®åå­å°åï¼\n * java.lang.Thread.State: WAITING (parking) **JVM çº¿ç¨ç¶æï¼**è¿éæ æäºçº¿ç¨å¨ä»£ç çº§å«çç¶æã\n * **çº¿ç¨è°ç¨æ ä¿¡æ¯ï¼**ä¸é¢å°±æ¯å½åçº¿ç¨è°ç¨çè¯¦ç»æ ä¿¡æ¯ï¼ç¨äºä»£ç çåæãå æ ä¿¡æ¯åºè¯¥ä»ä¸åä¸è§£è¯»ï¼å ä¸ºç¨åºè°ç¨çé¡ºåºæ¯ä»ä¸åä¸çã\n\n# ç¬¬ä¸é¨åï¼HotSpot VM Thread\n\nè¿ä¸é¨åå±ç¤ºäº JVM åé¨çº¿ç¨çä¿¡æ¯ï¼ç¨äºæ§è¡åé¨çåçæä½ãä¸é¢å¸¸è§çéä¸­åç½®çº¿ç¨ï¼\n\n# "Attach Listener"\n\nè¯¥çº¿ç¨è´è´£æ¥æ¶å¤é¨å½ä»¤ï¼æ§è¡è¯¥å½ä»¤å¹¶æç»æè¿åç»è°ç¨èï¼æ­¤ç§ç±»åççº¿ç¨éå¸¸å¨æ¡é¢ç¨åºä¸­åºç°ã\n\n"Attach Listener" daemon prio=5 tid=0x00007fc6b6800800 nid=0x3b07 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\n# "DestroyJavaVM"\n\næ§è¡ main() ççº¿ç¨å¨æ§è¡å®ä¹åè°ç¨ JNI ä¸­ç jni_DestroyJavaVM() æ¹æ³ä¼å¤èµ· DestroyJavaVM çº¿ç¨ï¼å¤äºç­å¾ç¶æï¼ç­å¾å¶å®çº¿ç¨ï¼java çº¿ç¨å native çº¿ç¨ï¼éåºæ¶éç¥å®å¸è½½ JVMã\n\n"DestroyJavaVM" prio=5 tid=0x00007fc6b3001000 nid=0x1903 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\n# "Service Thread"\n\nç¨äºå¯å¨æå¡ççº¿ç¨\n\n"Service Thread" daemon prio=10 tid=0x00007fbea81b3000 nid=0x5f2 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\n# "CompilerThread"\n\nç¨æ¥è°ç¨ JITingï¼å®æ¶ç¼è¯è£å¸ç±»ãéå¸¸ JVM ä¼å¯å¨å¤ä¸ªçº¿ç¨æ¥å¤çè¿é¨åå·¥ä½ï¼çº¿ç¨åç§°åé¢çæ°å­ä¹ä¼ç´¯å ï¼æ¯å¦ CompilerThread1ã\n\n"C2 CompilerThread1" daemon prio=10 tid=0x00007fbea814b000 nid=0x5f1 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n"C2 CompilerThread0" daemon prio=10 tid=0x00007fbea8142000 nid=0x5f0 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\n# "Signal Dispatcher"\n\nAttach Listener çº¿ç¨çèè´£æ¯æ¥æ¶å¤é¨ jvm å½ä»¤ï¼å½å½ä»¤æ¥æ¶æååï¼ä¼äº¤ç» signal dispather çº¿ç¨å»è¿è¡ååå°åä¸ªä¸åçæ¨¡åå¤çå½ä»¤ï¼å¹¶ä¸è¿åå¤çç»æã signal dispather çº¿ç¨ä¹æ¯å¨ç¬¬ä¸æ¬¡æ¥æ¶å¤é¨ jvm å½ä»¤æ¶ï¼è¿è¡åå§åå·¥ä½ã\n\n"Signal Dispatcher" daemon prio=10 tid=0x00007fbea81bf800 nid=0x5ef runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\n# "Finalizer"\n\nè¿ä¸ªçº¿ç¨ä¹æ¯å¨ main çº¿ç¨ä¹ååå»ºçï¼å¶ä¼åçº§ä¸º 10ï¼ä¸»è¦ç¨äºå¨åå¾æ¶éåï¼è°ç¨å¯¹è±¡ç finalize() æ¹æ³ï¼å³äº Finalizer çº¿ç¨çå ç¹ï¼\n\n * åªæå½å¼å§ä¸è½®åå¾æ¶éæ¶ï¼æä¼å¼å§è°ç¨ finalize()æ¹æ³ï¼å æ­¤å¹¶ä¸æ¯ææå¯¹è±¡ç finalize()æ¹æ³é½ä¼è¢«æ§è¡ï¼\n * è¯¥çº¿ç¨ä¹æ¯ daemon çº¿ç¨ï¼å æ­¤å¦æèææºä¸­æ²¡æå¶ä»é daemon çº¿ç¨ï¼ä¸ç®¡è¯¥çº¿ç¨ææ²¡ææ§è¡å® finalize()æ¹æ³ï¼JVM ä¹ä¼éåºï¼\n * JVM å¨åå¾æ¶éæ¶ä¼å°å¤±å»å¼ç¨çå¯¹è±¡åè£æ Finalizer å¯¹è±¡ï¼Reference çå®ç°ï¼ï¼å¹¶æ¾å¥ ReferenceQueueï¼ç± Finalizer çº¿ç¨æ¥å¤çï¼æåå°è¯¥ Finalizer å¯¹è±¡çå¼ç¨ç½®ä¸º nullï¼ç±åå¾æ¶éå¨æ¥åæ¶ï¼\n\nJVM ä¸ºä»ä¹è¦åç¬ç¨ä¸ä¸ªçº¿ç¨æ¥æ§è¡ finalize() æ¹æ³å¢ï¼\n\nå¦æ JVM çåå¾æ¶éçº¿ç¨èªå·±æ¥åï¼å¾æå¯è½ç±äºå¨ finalize()æ¹æ³ä¸­è¯¯æä½å¯¼è´ GC çº¿ç¨åæ­¢æä¸å¯æ§ï¼è¿å¯¹ GC çº¿ç¨æ¥è¯´æ¯ä¸ç§ç¾é¾ã\n\n"Finalizer" daemon prio=10 tid=0x00007fbea80da000 nid=0x5eb in Object.wait() [0x00007fbeac044000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)\n    - locked <0x00000006d173c1a8> (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)\n    at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)\n\n\n# "Reference Handler"\n\nJVM å¨åå»º main çº¿ç¨åå°±åå»º Reference Handler çº¿ç¨ï¼å¶ä¼åçº§æé«ï¼ä¸º 10ï¼å®ä¸»è¦ç¨äºå¤çå¼ç¨å¯¹è±¡æ¬èº«ï¼è½¯å¼ç¨ãå¼±å¼ç¨ãèå¼ç¨ï¼çåå¾åæ¶é®é¢ ã\n\n"Reference Handler" daemon prio=10 tid=0x00007fbea80d8000 nid=0x5ea in Object.wait() [0x00007fbeac085000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:503)\n    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)\n    - locked <0x00000006d173c1f0> (a java.lang.ref.Reference$Lock)\n\n\n# "VM Thread"\n\nJVM ä¸­çº¿ç¨çæ¯ä½ï¼æ ¹æ® HotSpot æºç ä¸­å³äº vmThread.hpp éé¢çæ³¨éï¼å®æ¯ä¸ä¸ªåä¾çå¯¹è±¡ï¼æåå§ççº¿ç¨ï¼ä¼äº§çæè§¦åææå¶ä»ççº¿ç¨ï¼è¿ä¸ªåä¾ç VM çº¿ç¨æ¯ä¼è¢«å¶ä»çº¿ç¨æä½¿ç¨æ¥åä¸äº VM æä½ï¼å¦æ¸æ«åå¾ç­ï¼ã å¨ VM Thread çç»æä½éæä¸ä¸ª VMOperationQueue åéï¼ææç VM çº¿ç¨æä½(vm_operation)é½ä¼è¢«ä¿å­å°è¿ä¸ªåéå½ä¸­ï¼VMThread æ¬èº«å°±æ¯ä¸ä¸ªçº¿ç¨ï¼å®ççº¿ç¨è´è´£æ§è¡ä¸ä¸ªèªè½®è¯¢ç loop å½æ°(å·ä½å¯ä»¥åèï¼VMThread.cpp éé¢ç void VMThread::loop()) ï¼è¯¥ loop å½æ°ä» VMOperationQueue åéä¸­æç§ä¼åçº§ååºå½åéè¦æ§è¡çæä½å¯¹è±¡(VM_Operation)ï¼å¹¶ä¸è°ç¨ VM_Operation->evaluate å½æ°å»æ§è¡è¯¥æä½ç±»åæ¬èº«çä¸å¡é»è¾ã VM æä½ç±»åè¢«å®ä¹å¨ vm_operations.hpp æä»¶åï¼åä¸¾å ä¸ªï¼ThreadStopãThreadDumpãPrintThreadsãGenCollectFullãGenCollectFullConcurrentãCMS_Initial_MarkãCMS_Final_Remarkâ¦.. æå´è¶£çåå­¦ï¼å¯ä»¥èªå·±å»æ¥çæºæä»¶ã\n\n"VM Thread" prio=10 tid=0x00007fbea80d3800 nid=0x5e9 runnable\n\n\n# ç¬¬åé¨åï¼HotSpot GC Thread\n\nJVM ä¸­ç¨äºè¿è¡èµæºåæ¶ççº¿ç¨ï¼åæ¬ä»¥ä¸å ç§ç±»åççº¿ç¨ï¼\n\n# "VM Periodic Task Thread"\n\nè¯¥çº¿ç¨æ¯ JVM å¨ææ§ä»»å¡è°åº¦ççº¿ç¨ï¼å®ç± WatcherThread åå»ºï¼æ¯ä¸ä¸ªåä¾å¯¹è±¡ãè¯¥çº¿ç¨å¨ JVM åä½¿ç¨å¾æ¯è¾é¢ç¹ï¼æ¯å¦ï¼å®æçåå­çæ§ãJVM è¿è¡ç¶åµçæ§ã\n\n"VM Periodic Task Thread" prio=10 tid=0x00007fbea82ae800 nid=0x5fa waiting on condition\n\n\nå¯ä»¥ä½¿ç¨ jstat å½ä»¤æ¥ç GC çæåµï¼æ¯å¦æ¥çæä¸ªè¿ç¨æ²¡æå­æ´»å¿è¦çå¼ç¨å¯ä»¥ä½¿ç¨å½ä»¤ jstat -gcutil 250 7 åæ°ä¸­ pid æ¯è¿ç¨ idï¼åé¢ç 250 å 7 è¡¨ç¤ºæ¯ 250 æ¯«ç§æå°ä¸æ¬¡ï¼æ»å±æå° 7 æ¬¡ã è¿å¯¹äºé²æ­¢å ä¸ºåºç¨ä»£ç ä¸­ç´æ¥ä½¿ç¨ native åºæèç¬¬ä¸æ¹çä¸äºçæ§å·¥å·çåå­æ³æ¼æéå¸¸å¤§çå¸®å©ã\n\n# "GC task thread#0 (ParallelGC)"\n\nåå¾åæ¶çº¿ç¨ï¼è¯¥çº¿ç¨ä¼è´è´£è¿è¡åå¾åæ¶ãéå¸¸ JVM ä¼å¯å¨å¤ä¸ªçº¿ç¨æ¥å¤çè¿ä¸ªå·¥ä½ï¼çº¿ç¨åç§°ä¸­#åé¢çæ°å­ä¹ä¼ç´¯å ã\n\n"GC task thread#0 (ParallelGC)" prio=5 tid=0x00007fc6b480d000 nid=0x2503 runnable\n\n"GC task thread#1 (ParallelGC)" prio=5 tid=0x00007fc6b2812000 nid=0x2703 runnable\n\n"GC task thread#2 (ParallelGC)" prio=5 tid=0x00007fc6b2812800 nid=0x2903 runnable\n\n"GC task thread#3 (ParallelGC)" prio=5 tid=0x00007fc6b2813000 nid=0x2b03 runnable\n\n\nå¦æå¨ JVM ä¸­å¢å äº -XX:+UseConcMarkSweepGC åæ°å°ä¼å¯ç¨ CMS ï¼Concurrent Mark-Sweepï¼GC Thread æ¹å¼ï¼ä»¥ä¸æ¯è¯¥æ¨¡å¼ä¸ççº¿ç¨ç±»åï¼\n\n# "Gang worker#0 (Parallel GC Threads)"\n\nåæ¥åå¾åæ¶çº¿ç¨ GC task thread#0 (ParallelGC) è¢«æ¿æ¢ä¸º Gang worker#0 (Parallel GC Threads)ãGang worker æ¯ JVM ç¨äºå¹´è½»ä»£åå¾åæ¶(minor gc)ççº¿ç¨ã\n\n"Gang worker#0 (Parallel GC Threads)" prio=10 tid=0x00007fbea801b800 nid=0x5e4 runnable\n\n"Gang worker#1 (Parallel GC Threads)" prio=10 tid=0x00007fbea801d800 nid=0x5e7 runnable\n\n\n# "Concurrent Mark-Sweep GC Thread"\n\nå¹¶åæ è®°æ¸é¤åå¾åæ¶å¨ï¼å°±æ¯éå¸¸æè¯´ç CMS GCï¼çº¿ç¨ï¼ è¯¥çº¿ç¨ä¸»è¦éå¯¹äºå¹´èä»£åå¾åæ¶ã\n\n"Concurrent Mark-Sweep GC Thread" prio=10 tid=0x00007fbea8073800 nid=0x5e8 runnable\n\n\n# "Surrogate Locker Thread (Concurrent GC)"\n\næ­¤çº¿ç¨ä¸»è¦éå CMS åå¾åæ¶å¨æ¥ä½¿ç¨ï¼æ¯ä¸ä¸ªå®æ¤çº¿ç¨ï¼ä¸»è¦è´è´£å¤ç GC è¿ç¨ä¸­ Java å±ç Referenceï¼æè½¯å¼ç¨ãå¼±å¼ç¨ç­ç­ï¼ä¸ jvm åé¨å±é¢çå¯¹è±¡ç¶æåæ­¥ã\n\n"Surrogate Locker Thread (Concurrent GC)" daemon prio=10 tid=0x00007fbea8158800 nid=0x5ee waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\nè¿éä»¥ WeakHashMap ä¸ºä¾è¿è¡è¯´æï¼é¦åæ¯ä¸ä¸ªå³é®ç¹ï¼\n\n * WeakHashMap å HashMap ä¸æ ·ï¼åé¨æä¸ä¸ª Entry[]æ°ç»;\n * WeakHashMap ç Entry æ¯è¾ç¹æ®ï¼å®çç»§æ¿ä½ç³»ç»æä¸º Entry->WeakReference->Reference;\n * Reference éé¢æä¸ä¸ªå¨å±éå¯¹è±¡ï¼Lockï¼å®ä¹è¢«ç§°ä¸º pending_lockï¼æ³¨æï¼å®æ¯éæå¯¹è±¡ï¼\n * Reference éé¢æä¸ä¸ªéæåéï¼pendingï¼\n * Reference éé¢æä¸ä¸ªéæåé¨ç±»ï¼ReferenceHandler ççº¿ç¨ï¼å®å¨ static åéé¢è¢«åå§åå¹¶ä¸å¯å¨ï¼å¯å¨å®æåå¤äº wait ç¶æï¼å®å¨ä¸ä¸ª Lock åæ­¥éæ¨¡åä¸­ç­å¾ï¼\n * WeakHashMap éé¢è¿å®ä¾åäºä¸ä¸ª ReferenceQueue åé\n\nåè®¾ï¼WeakHashMap å¯¹è±¡éé¢å·²ç»ä¿å­äºå¾å¤å¯¹è±¡çå¼ç¨ï¼JVM å¨è¿è¡ CMS GC çæ¶åä¼åå»ºä¸ä¸ª ConcurrentMarkSweepThreadï¼ç®ç§° CMSTï¼çº¿ç¨å»è¿è¡ GCãConcurrentMarkSweepThread çº¿ç¨è¢«åå»ºçåæ¶ä¼åå»ºä¸ä¸ª SurrogateLockerThreadï¼ç®ç§° SLTï¼çº¿ç¨å¹¶ä¸å¯å¨å®ï¼SLT å¯å¨ä¹åï¼å¤äºç­å¾é¶æ®µã CMST å¼å§ GC æ¶ï¼ä¼åä¸ä¸ªæ¶æ¯ç» SLT è®©å®å»è·å Java å± Reference å¯¹è±¡çå¨å±éï¼Lockãç´å° CMS GC å®æ¯ä¹åï¼JVM ä¼å° WeakHashMap ä¸­ææè¢«åæ¶çå¯¹è±¡æå±ç WeakReference å®¹å¨å¯¹è±¡æ¾å¥å° Reference ç pending å±æ§å½ä¸­ï¼æ¯æ¬¡ GC å®æ¯ä¹åï¼pending å±æ§åºæ¬ä¸é½ä¸ä¼ä¸º null äºï¼ï¼ç¶åéç¥ SLT éæ¾å¹¶ä¸ notify å¨å±é:Lockãæ­¤æ¶æ¿æ´»äº ReferenceHandler çº¿ç¨ç run æ¹æ³ï¼ä½¿å¶è±ç¦» wait ç¶æï¼å¼å§å·¥ä½äºã ReferenceHandler è¿ä¸ªçº¿ç¨ä¼å° pending ä¸­çææ WeakReference å¯¹è±¡é½ç§»å¨å°å®ä»¬åèªçåéå½ä¸­ï¼æ¯å¦å½åè¿ä¸ª WeakReference å±äºæä¸ª WeakHashMap å¯¹è±¡ï¼é£ä¹å®å°±ä¼è¢«æ¾å¥ç¸åºç ReferenceQueue åééé¢ï¼è¯¥åéæ¯é¾è¡¨ç»æï¼ã å½æä»¬ä¸æ¬¡ä» WeakHashMap å¯¹è±¡éé¢ getãput æ°æ®æèè°ç¨ size æ¹æ³çæ¶åï¼WeakHashMap å°±ä¼å° ReferenceQueue åéä¸­ç WeakReference ä¾ä¾ poll åºæ¥å»å Entry[]æ°æ®åæ¯è¾ï¼å¦æåç°ç¸åçï¼åè¯´æè¿ä¸ª Entry æä¿å­çå¯¹è±¡å·²ç»è¢« GC æäºï¼é£ä¹å° Entry[]åç Entry å¯¹è±¡åé¤æã\n\n# ç¬¬äºé¨åï¼JNI global references count\n\nè¿ä¸é¨åä¸»è¦åæ¶é£äºå¨ native ä»£ç ä¸è¢«å¼ç¨ï¼ä½å¨ java ä»£ç ä¸­å´æ²¡æå­æ´»å¿è¦çå¼ç¨ï¼å¯¹äºé²æ­¢å ä¸ºåºç¨ä»£ç ä¸­ç´æ¥ä½¿ç¨ native åºæç¬¬ä¸æ¹çä¸äºçæ§å·¥å·çåå­æ³æ¼æéå¸¸å¤§çå¸®å©ã\n\nJNI global references: 830\n\n\nä¸ä¸ç¯æç« å°è¦è®²è¿°ä¸ä¸ªç´æ¥æ¾åº CPU 100% çº¿ç¨çä¾å­ã\n\n\n# ç³»ç»çº¿ç¨ç¶æ\n\nç³»ç»çº¿ç¨æå¦ä¸ç¶æï¼\n\n# deadlock\n\næ­»éçº¿ç¨ï¼ä¸è¬æå¤ä¸ªçº¿ç¨è°ç¨æé´è¿å¥äºç¸äºèµæºå ç¨ï¼å¯¼è´ä¸ç´ç­å¾æ æ³éæ¾çæåµã\n\nãç¤ºä¾ãdeadlock ç¤ºä¾\n\n"DEADLOCK_TEST-1" daemon prio=6 tid=0x000000000690f800 nid=0x1820 waiting for monitor entry [0x000000000805f000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)\n                - waiting to lock <0x00000007d58f5e60> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)\n                - locked <0x00000007d58f5e48> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)\n\n   Locked ownable synchronizers:\n                - None\n\n"DEADLOCK_TEST-2" daemon prio=6 tid=0x0000000006858800 nid=0x17b8 waiting for monitor entry [0x000000000815f000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)\n                - waiting to lock <0x00000007d58f5e78> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)\n                - locked <0x00000007d58f5e60> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)\n\n   Locked ownable synchronizers:\n                - None\n\n"DEADLOCK_TEST-3" daemon prio=6 tid=0x0000000006859000 nid=0x25dc waiting for monitor entry [0x000000000825f000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)\n                - waiting to lock <0x00000007d58f5e48> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)\n                - locked <0x00000007d58f5e78> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)\n                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)\n\n   Locked ownable synchronizers:\n                - None\n\n\n# runnable\n\nä¸è¬æè¯¥çº¿ç¨æ­£å¨æ§è¡ç¶æä¸­ï¼è¯¥çº¿ç¨å ç¨äºèµæºï¼æ­£å¨å¤çæä¸ªæä½ï¼å¦éè¿ SQL è¯­å¥æ¥è¯¢æ°æ®åºãå¯¹æä¸ªæä»¶è¿è¡åå¥ç­ã\n\n# blocked\n\nçº¿ç¨æ­£å¤äºé»å¡ç¶æï¼æå½åçº¿ç¨æ§è¡è¿ç¨ä¸­ï¼æéè¦çèµæºé¿æ¶é´ç­å¾å´ä¸ç´æªè½è·åå°ï¼è¢«å®¹å¨ççº¿ç¨ç®¡çå¨æ è¯ä¸ºé»å¡ç¶æï¼å¯ä»¥çè§£ä¸ºç­å¾èµæºè¶æ¶ççº¿ç¨ã\n\nãç¤ºä¾ãblocked ç¤ºä¾\n\n"BLOCKED_TEST pool-1-thread-2" prio=6 tid=0x0000000007673800 nid=0x260c waiting for monitor entry [0x0000000008abf000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n                at com.nbp.theplatform.threaddump.ThreadBlockedState.monitorLock(ThreadBlockedState.java:43)\n                - waiting to lock <0x0000000780a000b0> (a com.nbp.theplatform.threaddump.ThreadBlockedState)\n                at com.nbp.theplatform.threaddump.ThreadBlockedState$2.run(ThreadBlockedState.java:26)\n                at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n                at java.lang.Thread.run(Thread.java:662)\n   Locked ownable synchronizers:\n                - <0x0000000780b0c6a0> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n"BLOCKED_TEST pool-1-thread-3" prio=6 tid=0x00000000074f5800 nid=0x1994 waiting for monitor entry [0x0000000008bbf000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n                at com.nbp.theplatform.threaddump.ThreadBlockedState.monitorLock(ThreadBlockedState.java:42)\n                - waiting to lock <0x0000000780a000b0> (a com.nbp.theplatform.threaddump.ThreadBlockedState)\n                at com.nbp.theplatform.threaddump.ThreadBlockedState$3.run(ThreadBlockedState.java:34)\n                at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886\n                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n                at java.lang.Thread.run(Thread.java:662)\n   Locked ownable synchronizers:\n                - <0x0000000780b0e1b8> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n\n\n# waiting on condition\n\nçº¿ç¨æ­£å¤äºç­å¾èµæºæç­å¾æä¸ªæ¡ä»¶çåçï¼å·ä½çåå éè¦ç»åä¸é¢å æ ä¿¡æ¯è¿è¡åæã\n\nï¼1ï¼å¦æå æ ä¿¡æ¯æç¡®æ¯åºç¨ä»£ç ï¼åè¯æè¯¥çº¿ç¨æ­£å¨ç­å¾èµæºï¼ä¸è¬æ¯å¤§éè¯»åæç§èµæºä¸è¯¥èµæºéç¨äºèµæºéçæåµä¸ï¼çº¿ç¨è¿å¥ç­å¾ç¶æï¼ç­å¾èµæºçè¯»åï¼æèæ­£å¨ç­å¾å¶ä»çº¿ç¨çæ§è¡ç­ã\n\nï¼2ï¼å¦æåç°æå¤§éççº¿ç¨é½æ­£å¤äºè¿ç§ç¶æï¼å¹¶ä¸å æ ä¿¡æ¯ä¸­å¾ç¥æ­£ç­å¾ç½ç»è¯»åï¼è¿æ¯å ä¸ºç½ç»é»å¡å¯¼è´çº¿ç¨æ æ³æ§è¡ï¼å¾æå¯è½æ¯ä¸ä¸ªç½ç»ç¶é¢çå¾åï¼\n\n * ç½ç»éå¸¸ç¹å¿ï¼å ä¹æ¶èäºææçå¸¦å®½ï¼ä»ç¶æå¤§éæ°æ®ç­å¾ç½ç»è¯»åï¼\n\n * ç½ç»å¯è½æ¯ç©ºé²çï¼ä½ç±äºè·¯ç±æé²ç«å¢ç­åå ï¼å¯¼è´åæ æ³æ­£å¸¸å°è¾¾ï¼\n\næä»¥ä¸å®è¦ç»åç³»ç»çä¸äºæ§è½è§å¯å·¥å·è¿è¡ç»¼ååæï¼æ¯å¦ netstat ç»è®¡åä½æ¶é´çåéåçæ°éï¼çæ¯å¦å¾ææ¾è¶è¿äºæå¨ç½ç»å¸¦å®½çéå¶ï¼è§å¯ CPU çå©ç¨çï¼çç³»ç»æç CPU æ¶é´æ¯å¦ææ¾å¤§äºç¨æ·æç CPU æ¶é´ãè¿äºé½æåç±äºç½ç»å¸¦å®½æéå¯¼è´çç½ç»ç¶é¢ã\n\nï¼3ï¼è¿æä¸ç§å¸¸è§çæåµæ¯è¯¥çº¿ç¨å¨ sleepï¼ç­å¾ sleep çæ¶é´å°äºï¼å°è¢«å¤éã\n\nãç¤ºä¾ãç­å¾ç¶ææ ·ä¾\n\n "IoWaitThread" prio=6 tid=0x0000000007334800 nid=0x2b3c waiting on condition [0x000000000893f000]\n   java.lang.Thread.State: WAITING (parking)\n                at sun.misc.Unsafe.park(Native Method)\n                - parking to wait for  <0x00000007d5c45850> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n                at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)\n                at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1987)\n                at java.util.concurrent.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:440)\n                at java.util.concurrent.LinkedBlockingDeque.take(LinkedBlockingDeque.java:629)\n                at com.nbp.theplatform.threaddump.ThreadIoWaitState$IoWaitHandler2.run(ThreadIoWaitState.java:89)\n                at java.lang.Thread.run(Thread.java:662)\n\n\n# waiting for monitor entry æ in Object.wait()\n\nMoniter æ¯ Java ä¸­ç¨ä»¥å®ç°çº¿ç¨ä¹é´çäºæ¥ä¸åä½çä¸»è¦ææ®µï¼å®å¯ä»¥çææ¯å¯¹è±¡æè class çéï¼æ¯ä¸ªå¯¹è±¡é½æï¼ä¹ä»æä¸ä¸ª Monitorã\n\n\n\nä»ä¸å¾å¯ä»¥çåºï¼æ¯ä¸ª Monitor å¨æä¸ªæ¶å»åªè½è¢«ä¸ä¸ªçº¿ç¨æ¥æï¼è¯¥çº¿ç¨å°±æ¯ "Active Thread"ï¼èå¶ä»çº¿ç¨é½æ¯ "Waiting Thread"ï¼åå«å¨ä¸¤ä¸ªéå "Entry Set"å"Waint Set"éé¢ç­å¾ãå¶ä¸­å¨ "Entry Set" ä¸­ç­å¾ççº¿ç¨ç¶ææ¯ waiting for monitor entryï¼å¨ "Wait Set" ä¸­ç­å¾ççº¿ç¨ç¶ææ¯ in Object.wait()ã\n\nï¼1ï¼"Entry Set"éé¢ççº¿ç¨ã\n\næä»¬ç§°è¢« synchronized ä¿æ¤èµ·æ¥çä»£ç æ®µä¸ºä¸´çåºï¼å¯¹åºçä»£ç å¦ä¸ï¼\n\nsynchronized(obj) {\n}\n\n\nå½ä¸ä¸ªçº¿ç¨ç³è¯·è¿å¥ä¸´çåºæ¶ï¼å®å°±è¿å¥äº "Entry Set" éåä¸­ï¼è¿æ¶åæä¸¤ç§å¯è½æ§ï¼\n\n * è¯¥ Monitor ä¸è¢«å¶ä»çº¿ç¨æ¥æï¼"Entry Set"éé¢ä¹æ²¡æå¶ä»ç­å¾ççº¿ç¨ãæ¬çº¿ç¨å³æä¸ºç¸åºç±»æèå¯¹è±¡ç Monitor ç Ownerï¼æ§è¡ä¸´çåºéé¢çä»£ç ï¼æ­¤æ¶å¨ Thread Dump ä¸­æ¾ç¤ºçº¿ç¨å¤äº "Runnable" ç¶æã\n * è¯¥ Monitor è¢«å¶ä»çº¿ç¨æ¥æï¼æ¬çº¿ç¨å¨ "Entry Set" éåä¸­ç­å¾ãæ­¤æ¶å¨ Thread Dump ä¸­æ¾ç¤ºçº¿ç¨å¤äº "waiting for monity entry" ç¶æã\n\nä¸´çåºçè®¾ç½®æ¯ä¸ºäºä¿è¯å¶åé¨çä»£ç æ§è¡çåå­æ§åå®æ´æ§ï¼ä½å ä¸ºä¸´çåºå¨ä»»ä½æ¶é´åªåè®¸çº¿ç¨ä¸²è¡éè¿ï¼è¿åæä»¬ä½¿ç¨å¤çº¿ç¨çåè¡·æ¯ç¸åçãå¦æå¨å¤çº¿ç¨ç¨åºä¸­å¤§éä½¿ç¨ synchronizedï¼æèä¸éå½çä½¿ç¨å®ï¼ä¼é æå¤§éçº¿ç¨å¨ä¸´çåºçå¥å£ç­å¾ï¼é æç³»ç»çæ§è½å¤§å¹ä¸éãå¦æå¨ Thread Dump ä¸­åç°è¿ä¸ªæåµï¼åºè¯¥å®¡è§æºç å¹¶å¯¹å¶è¿è¡æ¹è¿ã\n\nï¼2ï¼"Wait Set"éé¢ççº¿ç¨\n\nå½çº¿ç¨è·å¾äº Monitorï¼è¿å¥äºä¸´çåºä¹åï¼å¦æåç°çº¿ç¨ç»§ç»­è¿è¡çæ¡ä»¶æ²¡ææ»¡è¶³ï¼å®åè°ç¨å¯¹è±¡ï¼éå¸¸æ¯è¢« synchronized çå¯¹è±¡ï¼ç wait()æ¹æ³ï¼æ¾å¼ Monitorï¼è¿å¥ "Wait Set"éåãåªæå½å«ççº¿ç¨å¨è¯¥å¯¹è±¡ä¸è°ç¨äº notify()æè notifyAll()æ¹æ³ï¼"Wait Set"éåä¸­ççº¿ç¨æå¾å°æºä¼å»ç«äºï¼ä½æ¯åªæä¸ä¸ªçº¿ç¨è·å¾å¯¹è±¡ç Monitorï¼æ¢å¤å°è¿è¡æã"Wait Set"ä¸­ççº¿ç¨å¨ Thread Dump ä¸­æ¾ç¤ºçç¶æä¸º in Object.wait()ãéå¸¸æ¥è¯´ï¼å½ CPU å¾å¿çæ¶åå³æ³¨ Runnable ç¶æççº¿ç¨ï¼åä¹åå³æ³¨ waiting for monitor entry ç¶æççº¿ç¨ã\n\n\n# jstack ä½¿ç¨ç¤ºä¾\n\n# æ¾åºæ Java è¿ç¨ä¸­æèè´¹ CPU ç Java çº¿ç¨\n\nï¼1ï¼æ¾åº Java è¿ç¨\n\nåè®¾åºç¨åç§°ä¸º myappï¼\n\n$ jps | grep myapp\n29527 myapp.jar\n\n\nå¾å°è¿ç¨ ID ä¸º 21711\n\nï¼2ï¼æ¾åºè¯¥è¿ç¨åæèè´¹ CPU ççº¿ç¨ï¼å¯ä»¥ä½¿ç¨ ps -Lfp pid æè ps -mp pid -o THREAD, tid, time æè top -Hp pid\n\nTIME åå°±æ¯åä¸ª Java çº¿ç¨èè´¹ç CPU æ¶é´ï¼CPU æ¶é´æé¿çæ¯çº¿ç¨ ID ä¸º 21742 ççº¿ç¨ï¼ç¨\n\nprintf "%x\\n" 21742\n\n\nå¾å° 21742 çåå­è¿å¶å¼ä¸º 54eeï¼ä¸é¢ä¼ç¨å°ã\n\nï¼3ï¼ä½¿ç¨ jstack æå°çº¿ç¨å æ ä¿¡æ¯\n\nä¸ä¸æ­¥ç»äºè½®å° jstack ä¸åºäºï¼å®ç¨æ¥è¾åºè¿ç¨ 21711 çå æ ä¿¡æ¯ï¼ç¶åæ ¹æ®çº¿ç¨ ID çåå­è¿å¶å¼ grepï¼å¦ä¸ï¼\n\n$ jstack 21711 | grep 54ee\n"PollIntervalRetrySchedulerThread" prio=10 tid=0x00007f950043e000 nid=0x54ee in Object.wait() [0x00007f94c6eda000]\n\n\nå¯ä»¥çå° CPU æ¶èå¨ PollIntervalRetrySchedulerThread è¿ä¸ªç±»ç Object.wait()ã\n\n> æ³¨ï¼ä¸é¢çä¾å­ä¸­ï¼é»è®¤åªæ¾ç¤ºäºä¸è¡ä¿¡æ¯ï¼ä½å¾å¤æ¶åæä»¬å¸ææ¥çæ´è¯¦ç»çè°ç¨æ ãå¯ä»¥éè¿æå® -A <num> çæ¹å¼æ¥æ¾ç¤ºè¡æ°ãä¾å¦ï¼jstack -l <pid> | grep <thread-hex-id> -A 10\n\nï¼4ï¼åæä»£ç \n\nææ¾äºä¸æçä»£ç ï¼å®ä½å°ä¸é¢çä»£ç ï¼\n\n// Idle wait\ngetLog().info("Thread [" + getName() + "] is idle waiting...");\nschedulerThreadState = PollTaskSchedulerThreadState.IdleWaiting;\nlong now = System.currentTimeMillis();\nlong waitTime = now + getIdleWaitTime();\nlong timeUntilContinue = waitTime - now;\nsynchronized(sigLock) {\n\ttry {\n    \tif(!halted.get()) {\n    \t\tsigLock.wait(timeUntilContinue);\n    \t}\n    }\n\tcatch (InterruptedException ignore) {\n    }\n}\n\n\nå®æ¯è½®è¯¢ä»»å¡çç©ºé²ç­å¾ä»£ç ï¼ä¸é¢ç sigLock.wait(timeUntilContinue) å°±å¯¹åºäºåé¢ç Object.wait()ã\n\n# çæ threaddump æä»¶\n\nå¯ä»¥ä½¿ç¨ jstack -l <pid> > <file-path> å½ä»¤çæ threaddump æä»¶\n\nãç¤ºä¾ãçæè¿ç¨ ID ä¸º 8841 ç Java è¿ç¨ç threaddump æä»¶ã\n\njstack -l 8841 > /home/threaddump.txt\n\n\n\n# jinfo\n\n> jinfo(JVM Configuration info)ï¼æ¯ Java éç½®ä¿¡æ¯å·¥å·ãjinfo ç¨äºå®æ¶æ¥çåè°æ´èææºè¿è¡åæ°ãå¦ä¼ éç» Java èææºç-Xï¼å³è¾åºä¸­ç jvm_argsï¼ã-XXåæ°ï¼å³è¾åºä¸­ç VM Flagsï¼ï¼ä»¥åå¯å¨ Java å±é¢éè¿System.getPropertyè·åç-Dåæ°ï¼å³è¾åºä¸­ç System Propertiesï¼ã\n\nä¹åç jps -v å£ä»¤åªè½æ¥çå°æ¾ç¤ºæå®çåæ°ï¼å¦ææ³è¦æ¥çæªè¢«æ¾ç¤ºæå®çåæ°çå¼å°±è¦ä½¿ç¨ jinfo å£ä»¤ã\n\njinfo å½ä»¤æ ¼å¼ï¼\n\njinfo [option] pid\n\n\noption éé¡¹åæ°ï¼\n\n * -flag - è¾åºæå® args åæ°çå¼\n * -sysprops - è¾åºç³»ç»å±æ§ï¼ç­åäº System.getProperties()\n\nãç¤ºä¾ãjinfo ä½¿ç¨ç¤ºä¾\n\n$ jinfo -sysprops 29527\nAttaching to process ID 29527, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 25.222-b10\n...\n\n\n\n# jhat\n\n> jhat(JVM Heap Analysis Tool)ï¼æ¯èææºå è½¬å¨å¿«ç§åæå·¥å·ãjhat ä¸ jmap æ­éä½¿ç¨ï¼ç¨æ¥åæ jmap çæç dump æä»¶ãjhat åç½®äºä¸ä¸ªå¾®åç HTTP/HTML æå¡å¨ï¼çæ dump çåæç»æåï¼å¯ä»¥å¨æµè§å¨ä¸­æ¥çã\n> \n> æ³¨æï¼ä¸è¬ä¸ä¼ç´æ¥å¨æå¡å¨ä¸è¿è¡åæï¼å ä¸º jhat æ¯ä¸ä¸ªèæ¶å¹¶ä¸èè´¹ç¡¬ä»¶èµæºçè¿ç¨ï¼ä¸è¬ææå¡å¨çæç dump æä»¶ï¼ç¨ jvisualvm ãEclipse Memory AnalyzerãIBM HeapAnalyzer ç­å·¥å·æ¥åæã\n\nå½ä»¤æ ¼å¼ï¼\n\njhat [dumpfile]\n\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava æ§è½è°ä¼å®æã\n * JVM æ§è½è°ä¼çæ§å·¥å· jpsãjstackãjmapãjhatãjstatãhprof ä½¿ç¨è¯¦è§£\n * jconsole å®æ¹ææ¡£\n * jconsole å·¥å·ä½¿ç¨\n * jstat å½ä»¤æ¥ç jvm ç GC æåµ\n * å©ç¨åå­åæå·¥å·ï¼Memory Analyzer Toolï¼MATï¼åæ java é¡¹ç®åå­æ³é²\n * JVM æéåæåæ§è½ä¼åç³»åä¹ä¸ï¼ä½¿ç¨ jstack å®ä½çº¿ç¨å æ ä¿¡æ¯',normalizedContent:'# jvm å½ä»¤è¡å·¥å·\n\n> java ç¨åºååä¸äºæéææ¥å·¥ä½ï¼æä»¥ç»å¸¸éè¦ä½¿ç¨ä¸äº jvm å·¥å·ã\n> \n> jdk èªå¸¦äºä¸äºå®ç¨çå½ä»¤è¡å·¥å·æ¥çæ§ãåæ jvm ä¿¡æ¯ï¼ææ¡å®ä»¬ï¼éå¸¸æå©äº troubleshootingã\n\nä»¥ä¸æ¯è¾å¸¸ç¨ç jdk å½ä»¤è¡å·¥å·ï¼\n\nåç§°       æè¿°\njps      jvm è¿ç¨ç¶æå·¥å·ãæ¾ç¤ºç³»ç»åçææ jvm è¿ç¨ã\njstat    jvm ç»è®¡çæ§å·¥å·ãçæ§èææºè¿è¡æ¶ç¶æä¿¡æ¯ï¼å®å¯ä»¥æ¾ç¤ºåº jvm è¿ç¨ä¸­çç±»è£è½½ãåå­ãgcãjit\n         ç¼è¯ç­è¿è¡æ°æ®ã\njmap     jvm å åå­åæå·¥å·ãç¨äºæå° jvm è¿ç¨å¯¹è±¡ç´æ¹å¾ãç±»å è½½ç»è®¡ãå¹¶ä¸å¯ä»¥çæå è½¬å¨å¿«ç§ï¼ä¸è¬ç§°ä¸º heapdump\n         æ dump æä»¶ï¼ã\njstack   jvm æ æ¥çå·¥å·ãç¨äºæå° jvm è¿ç¨ççº¿ç¨åéçæåµãå¹¶ä¸å¯ä»¥çæçº¿ç¨å¿«ç§ï¼ä¸è¬ç§°ä¸º threaddump æ\n         javacore æä»¶ï¼ã\njhat     ç¨æ¥åæ jmap çæç dump æä»¶ã\njinfo    jvm ä¿¡æ¯æ¥çå·¥å·ãç¨äºå®æ¶æ¥çåè°æ´ jvm è¿ç¨åæ°ã\njcmd     jvm å½ä»¤è¡è°è¯ å·¥å·ãç¨äºå jvm è¿ç¨åéè°è¯å½ä»¤ã\n\n\n# jps\n\n> jps(jvm process status tool) æ¯èææºè¿ç¨ç¶æå·¥å·ãå®å¯ä»¥æ¾ç¤ºæå®ç³»ç»åææç hotspot èææºè¿ç¨ç¶æä¿¡æ¯ãjps éè¿ rmi åè®®æ¥è¯¢å¼å¯äº rmi æå¡çè¿ç¨èææºè¿ç¨ç¶æã\n\n\n# jps å½ä»¤ç¨æ³\n\njps [option] [hostid]\njps [-help]\n\n\nå¦æä¸æå® hostid å°±é»è®¤ä¸ºå½åä¸»æºææå¡å¨ã\n\nå¸¸ç¨åæ°ï¼\n\n * option - éé¡¹åæ°\n   * -m - è¾åº jvm å¯å¨æ¶ä¼ éç» main() çåæ°ã\n   * -l - è¾åºä¸»ç±»çå¨åï¼å¦æè¿ç¨æ§è¡çæ¯ jar åï¼è¾åº jar è·¯å¾ã\n   * -v - æ¾ç¤ºä¼ éç» jvm çåæ°ã\n   * -q - ä»è¾åºæ¬å° jvm è¿ç¨ idã\n   * -v - ä»è¾åºæ¬å° jvm æ è¯ç¬¦ã\n * hostid - rmi æ³¨åè¡¨ä¸­æ³¨åçä¸»æºåãå¦æä¸æå® hostid å°±é»è®¤ä¸ºå½åä¸»æºææå¡å¨ã\n\nå¶ä¸­ optionãhostid åæ°ä¹å¯ä»¥ä¸åã\n\n\n# jps ä½¿ç¨ç¤ºä¾\n\nãç¤ºä¾ãååºæ¬å° java è¿ç¨\n\n$ jps\n18027 java2demo.jar\n18032 jps\n18005 jstat\n\n\nãç¤ºä¾ãååºæ¬å° java è¿ç¨ id\n\n$ jps -q\n8841\n1292\n5398\n\n\nãç¤ºä¾ãååºæ¬å° java è¿ç¨ idï¼å¹¶è¾åºä¸»ç±»çå¨åï¼å¦æè¿ç¨æ§è¡çæ¯ jar åï¼è¾åº jar è·¯å¾\n\n$ jps -l remote.domain\n3002 /opt/jdk1.7.0/demo/jfc/java2d/java2demo.jar\n2857 sun.tools.jstatd.jstatd\n\n\n\n# jstat\n\n> jstat(jvm statistics monitoring)ï¼æ¯èææºç»è®¡ä¿¡æ¯çè§å·¥å·ãjstat ç¨äºçè§èææºè¿è¡æ¶ç¶æä¿¡æ¯ï¼å®å¯ä»¥æ¾ç¤ºåºèææºè¿ç¨ä¸­çç±»è£è½½ãåå­ãåå¾æ¶éãjit ç¼è¯ç­è¿è¡æ°æ®ã\n\n\n# jstat å½ä»¤ç¨æ³\n\nå½ä»¤æ ¼å¼ï¼\n\njstat [option] vmid [interval] [count]\n\n\nå¸¸ç¨åæ°ï¼\n\n * option - éé¡¹åæ°ï¼ç¨äºæå®ç¨æ·éè¦æ¥è¯¢çèææºä¿¡æ¯\n   * -class - çè§ç±»è£è½½ãå¸è½½æ°éãæ»ç©ºé´ä»¥åç±»è£è½½æèè´¹çæ¶é´\n   * -compilerï¼æ¾ç¤º jit ç¼è¯çç¸å³ä¿¡æ¯ï¼\n   * -gcï¼çè§ java å ç¶åµï¼åæ¬ eden åºãä¸¤ä¸ª survivor åºãèå¹´ä»£ãæ°¸ä¹ä»£ç­åºçå®¹éãå·²ç¨ç©ºé´ãgc æ¶é´åè®¡ç­ä¿¡æ¯ã\n   * -gccapacityï¼æ¾ç¤ºåä¸ªä»£çå®¹éä»¥åä½¿ç¨æåµï¼\n   * -gcmetacapacityï¼æ¾ç¤º metaspace çå¤§å°ï¼\n   * -gcnewï¼æ¾ç¤ºæ°çä»£ä¿¡æ¯ï¼\n   * -gcnewcapacityï¼æ¾ç¤ºæ°çä»£å¤§å°åä½¿ç¨æåµï¼\n   * -gcoldï¼æ¾ç¤ºèå¹´ä»£åæ°¸ä¹ä»£çä¿¡æ¯ï¼\n   * -gcoldcapacityï¼æ¾ç¤ºèå¹´ä»£çå¤§å°ï¼\n   * -gcutilï¼æ¾ç¤ºåå¾åæ¶ç»è®¡ä¿¡æ¯ï¼\n   * -gccauseï¼æ¾ç¤ºåå¾åæ¶çç¸å³ä¿¡æ¯ï¼é -gcutilï¼ï¼åæ¶æ¾ç¤ºæåä¸æ¬¡æå½åæ­£å¨åççåå¾åæ¶çè¯±å ï¼\n   * -printcompilationï¼è¾åº jit ç¼è¯çæ¹æ³ä¿¡æ¯ã\n * vmid - å¦ææ¯æ¬å°èææºè¿ç¨ï¼å vmid ä¸ lvmid æ¯ä¸è´çï¼å¦ææ¯è¿ç¨èææºè¿ç¨ï¼é£ vmid çæ ¼å¼åºå½æ¯ï¼[protocol:][//]lvmid[@hostname[:port]/servername]\n * interval - æ¥è¯¢é´é\n * count - æ¥è¯¢æ¬¡æ°\n\n> ãåèãæ´è¯¦ç»è¯´æå¯ä»¥åèï¼jstat å½ä»¤æ¥ç jvm ç gc æåµ\n\n\n# jstat ä½¿ç¨ç¤ºä¾\n\n# ç±»å è½½ç»è®¡\n\nä½¿ç¨ jstat -class pid å½ä»¤å¯ä»¥æ¥çç¼è¯ç»è®¡ä¿¡æ¯ã\n\nãåæ°ã\n\n * loaded - å è½½ class çæ°é\n * bytes - æå ç¨ç©ºé´å¤§å°\n * unloaded - æªå è½½æ°é\n * bytes - æªå è½½å ç¨ç©ºé´\n * time - æ¶é´\n\nãç¤ºä¾ãæ¥çç±»å è½½ä¿¡æ¯\n\n$ jstat -class 7129\nloaded  bytes  unloaded  bytes     time\n 26749 50405.3      873  1216.8      19.75\n\n\n# ç¼è¯ç»è®¡\n\nä½¿ç¨ jstat -compiler pid å½ä»¤å¯ä»¥æ¥çç¼è¯ç»è®¡ä¿¡æ¯ã\n\nãç¤ºä¾ã\n\n$ jstat -compiler 7129\ncompiled failed invalid   time   failedtype failedmethod\n   42030      2       0   302.53          1 org/apache/felix/framework/bundlewiringimpl$bundleclassloader findclass\n\n\nãåæ°ã\n\n * compiled - ç¼è¯æ°é\n * failed - å¤±è´¥æ°é\n * invalid - ä¸å¯ç¨æ°é\n * time - æ¶é´\n * failedtype - å¤±è´¥ç±»å\n * failedmethod - å¤±è´¥çæ¹æ³\n\n# gc ç»è®¡\n\nä½¿ç¨ jstat -gc pid time å½ä»¤å¯ä»¥æ¥ç gc ç»è®¡ä¿¡æ¯ã\n\nãç¤ºä¾ãä»¥ 250 æ¯«ç§çé´éè¿è¡ 7 ä¸ªéæ ·ï¼å¹¶æ¾ç¤º-gcutil éé¡¹æå®çè¾åºã\n\n$ jstat -gcutil 21891 250 7\n  s0     s1     e      o      m     ccs    ygc     ygct    fgc    fgct     gct\n  0.00  97.02  70.31  66.80  95.52  89.14      7    0.300     0    0.000    0.300\n  0.00  97.02  86.23  66.80  95.52  89.14      7    0.300     0    0.000    0.300\n  0.00  97.02  96.53  66.80  95.52  89.14      7    0.300     0    0.000    0.300\n 91.03   0.00   1.98  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n 91.03   0.00  15.82  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n 91.03   0.00  17.80  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n 91.03   0.00  17.80  68.19  95.89  91.24      8    0.378     0    0.000    0.378\n\n\nãç¤ºä¾ãä»¥ 1 ç§çé´éè¿è¡ 4 ä¸ªéæ ·ï¼å¹¶æ¾ç¤º-gc éé¡¹æå®çè¾åºã\n\n$ jstat -gc 25196 1s 4\n s0c    s1c    s0u    s1u      ec       eu        oc         ou       mc     mu    ccsc   ccsu   ygc     ygct    fgc    fgct     gct\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n20928.0 20928.0  0.0    0.0   167936.0  8880.5   838912.0   80291.2   106668.0 100032.1 12772.0 11602.2    760   14.332  580   656.218  670.550\n\n\nåæ°è¯´æï¼\n\n * s0cï¼å¹´è½»ä»£ä¸­ to survivor çå®¹éï¼åä½ kbï¼ï¼\n * s1cï¼å¹´è½»ä»£ä¸­ from survivor çå®¹éï¼åä½ kbï¼ï¼\n * s0uï¼å¹´è½»ä»£ä¸­ to survivor ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ kbï¼ï¼\n * s1uï¼å¹´è½»ä»£ä¸­ from survivor ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ kbï¼ï¼\n * ecï¼å¹´è½»ä»£ä¸­ eden çå®¹éï¼åä½ kbï¼ï¼\n * euï¼å¹´è½»ä»£ä¸­ eden ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ kbï¼ï¼\n * ocï¼old ä»£çå®¹éï¼åä½ kbï¼ï¼\n * ouï¼old ä»£ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ kbï¼ï¼\n * mcï¼metaspace çå®¹éï¼åä½ kbï¼ï¼\n * muï¼metaspace ç®åå·²ä½¿ç¨ç©ºé´ï¼åä½ kbï¼ï¼\n * ygcï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶å¹´è½»ä»£ä¸­ gc æ¬¡æ°ï¼\n * ygctï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶å¹´è½»ä»£ä¸­ gc æç¨æ¶é´ (s)ï¼\n * fgcï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ old ä»£ï¼å¨ gcï¼gc æ¬¡æ°ï¼\n * fgctï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ old ä»£ï¼å¨ gcï¼gc æç¨æ¶é´ (s)ï¼\n * gctï¼ä»åºç¨ç¨åºå¯å¨å°éæ ·æ¶ gc ç¨çæ»æ¶é´ (s)ã\n\n> æ³¨ï¼æ´è¯¦ç»çåæ°å«ä¹å¯ä»¥åèå®æ¹ææ¡£ï¼http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html\n\n\n# jmap\n\n> jmap(jvm memory map) æ¯ java åå­æ åå·¥å·ãjmap ç¨äºçæå è½¬å¨å¿«ç§ï¼ä¸è¬ç§°ä¸º heapdump æ dump æä»¶ï¼ãjmap ä¸ä»è½çæ dump æä»¶ï¼è¿å¯ä»¥æ¥è¯¢ finalize æ§è¡éåãjava å åæ°¸ä¹ä»£çè¯¦ç»ä¿¡æ¯ï¼å¦å½åä½¿ç¨çãå½åä½¿ç¨çæ¯åªç§æ¶éå¨ç­ã\n> \n> å¦æä¸ä½¿ç¨è¿ä¸ªå½ä»¤ï¼è¿å¯ä»¥ä½¿ç¨ -xx:+heapdumponoutofmemoryerror åæ°æ¥è®©èææºåºç° oom çæ¶åï¼èªå¨çæ dump æä»¶ã\n\n\n# jmap å½ä»¤ç¨æ³\n\nå½ä»¤æ ¼å¼ï¼\n\njmap [option] pid\n\n\noption éé¡¹åæ°ï¼\n\n * -dump - çæå è½¬å¨å¿«ç§ã-dump:live åªä¿å­å ä¸­çå­æ´»å¯¹è±¡ã\n * -finalizerinfo - æ¾ç¤ºå¨ f-queue éåç­å¾æ§è¡ finalizer æ¹æ³çå¯¹è±¡\n * -heap - æ¾ç¤º java å è¯¦ç»ä¿¡æ¯ã\n * -histo - æ¾ç¤ºå ä¸­å¯¹è±¡çç»è®¡ä¿¡æ¯ï¼åæ¬ç±»ãå®ä¾æ°éãåè®¡å®¹éã-histo:live åªç»è®¡å ä¸­çå­æ´»å¯¹è±¡ã\n * -permstat - to print permanent generation statistics\n * -f - å½-dump æ²¡æååºæ¶ï¼å¼ºå¶çæ dump å¿«ç§\n\n\n# jstat ä½¿ç¨ç¤ºä¾\n\n# çæ heapdump å¿«ç§\n\ndump å å°æä»¶ï¼format æå®è¾åºæ ¼å¼ï¼live æææ¯æ´»ççå¯¹è±¡ï¼file æå®æä»¶å\n\n$ jmap -dump:live,format=b,file=dump.hprof 28920\ndumping heap to /home/xxx/dump.hprof ...\nheap dump file created\n\n\ndump.hprof è¿ä¸ªåç¼æ¯ä¸ºäºåç»­å¯ä»¥ç´æ¥ç¨ mat(memory anlysis tool)ç­å·¥å·æå¼ã\n\n# æ¥çå®ä¾æ°æå¤çç±»\n\n$ jmap -histo 29527 | head -n 6\n\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:      13673280     1438961864  [c\n   2:       1207166      411277184  [i\n   3:       7382322      347307096  [ljava.lang.object;\n\n\n# æ¥çæå®è¿ç¨çå ä¿¡æ¯\n\næ³¨æï¼ä½¿ç¨ cms gc æåµä¸ï¼jmap -heap pid çæ§è¡æå¯è½ä¼å¯¼è´ java è¿ç¨æèµ·ã\n\n$ jmap -heap 12379\nattaching to process id 12379, please wait...\ndebugger attached successfully.\nserver compiler detected.\njvm version is 17.0-b16\n\nusing thread-local object allocation.\nparallel gc with 6 thread(s)\n\nheap configuration:\n   minheapfreeratio = 40\n   maxheapfreeratio = 70\n   maxheapsize      = 83886080 (80.0mb)\n   newsize          = 1310720 (1.25mb)\n   maxnewsize       = 17592186044415 mb\n   oldsize          = 5439488 (5.1875mb)\n   newratio         = 2\n   survivorratio    = 8\n   permsize         = 20971520 (20.0mb)\n   maxpermsize      = 88080384 (84.0mb)\n\nheap usage:\nps young generation\neden space:\n   capacity = 9306112 (8.875mb)\n   used     = 5375360 (5.1263427734375mb)\n   free     = 3930752 (3.7486572265625mb)\n   57.761608714788736% used\nfrom space:\n   capacity = 9306112 (8.875mb)\n   used     = 3425240 (3.2665634155273438mb)\n   free     = 5880872 (5.608436584472656mb)\n   36.80634834397007% used\nto space:\n   capacity = 9306112 (8.875mb)\n   used     = 0 (0.0mb)\n   free     = 9306112 (8.875mb)\n   0.0% used\nps old generation\n   capacity = 55967744 (53.375mb)\n   used     = 48354640 (46.11457824707031mb)\n   free     = 7613104 (7.2604217529296875mb)\n   86.39733629427693% used\nps perm generation\n   capacity = 62062592 (59.1875mb)\n   used     = 60243112 (57.452308654785156mb)\n   free     = 1819480 (1.7351913452148438mb)\n   97.06831451706046% used\n\n\n\n# jstack\n\n> jstack(stack trace for java) æ¯ java å æ è·è¸ªå·¥å·ãjstack ç¨æ¥æå°ç®æ  java è¿ç¨ä¸­åä¸ªçº¿ç¨çæ è½¨è¿¹ï¼ä»¥åè¿äºçº¿ç¨æææçéï¼å¹¶å¯ä»¥çæ java èææºå½åæ¶å»ççº¿ç¨å¿«ç§ï¼ä¸è¬ç§°ä¸º threaddump æ javacore æä»¶ï¼ã\n> \n> çº¿ç¨å¿«ç§æ¯å½åèææºåæ¯ä¸æ¡çº¿ç¨æ­£å¨æ§è¡çæ¹æ³å æ çéåï¼çæçº¿ç¨å¿«ç§çä¸»è¦ç®çæ¯å®ä½çº¿ç¨åºç°é¿æ¶é´åé¡¿çåå ï¼å¦çº¿ç¨é´æ­»éãæ­»å¾ªç¯ãè¯·æ±å¤é¨èµæºå¯¼è´çé¿æ¶é´ç­å¾ç­ã\n\njstack éå¸¸ä¼ç»å top -hp pid æ pidstat -p pid -t ä¸èµ·æ¥çå·ä½çº¿ç¨çç¶æï¼ä¹ç»å¸¸ç¨æ¥ææ¥ä¸äºæ­»éçå¼å¸¸ã\n\nçº¿ç¨åºç°åé¡¿çæ¶åéè¿ jstack æ¥æ¥çåä¸ªçº¿ç¨çè°ç¨å æ ï¼å°±å¯ä»¥ç¥éæ²¡æååºççº¿ç¨å°åºå¨åå°åä»ä¹äºæï¼æèç­å¾ä»ä¹èµæºã å¦æ java ç¨åºå´©æºçæ core æä»¶ï¼jstack å·¥å·å¯ä»¥ç¨æ¥è·å¾ core æä»¶ç java stack å native stack çä¿¡æ¯ï¼ä»èå¯ä»¥è½»æ¾å°ç¥é java ç¨åºæ¯å¦ä½å´©æºåå¨ç¨åºä½å¤åçé®é¢ãå¦å¤ï¼jstack å·¥å·è¿å¯ä»¥éå±å°æ­£å¨è¿è¡ç java ç¨åºä¸­ï¼çå°å½æ¶è¿è¡ç java ç¨åºç java stack å native stack çä¿¡æ¯, å¦æç°å¨è¿è¡ç java ç¨åºåç° hung çç¶æï¼jstack æ¯éå¸¸æç¨çã\n\n\n# jstack å½ä»¤ç¨æ³\n\nå½ä»¤æ ¼å¼ï¼\n\njstack [option] pid\n\n\noption éé¡¹åæ°\n\n * -f - å½æ­£å¸¸è¾åºè¯·æ±ä¸è¢«ååºæ¶ï¼å¼ºå¶è¾åºçº¿ç¨å æ \n * -l - é¤å æ å¤ï¼æ¾ç¤ºå³äºéçéå ä¿¡æ¯\n * -m - æå° java å jni æ¡æ¶çæææ ä¿¡æ¯\n\n\n# thread dump æä»¶\n\n\n\nä¸ä¸ª thread dump æä»¶å¤§è´å¯ä»¥åä¸ºäºä¸ªé¨åã\n\n# ç¬¬ä¸é¨åï¼full thread dump identifier\n\nè¿ä¸é¨åæ¯åå®¹æå¼å§çé¨åï¼å±ç¤ºäºå¿«ç§æä»¶ççææ¶é´å jvm ççæ¬ä¿¡æ¯ã\n\n2017-10-19 10:46:44\nfull thread dump java hotspot(tm) 64-bit server vm (24.79-b02 mixed mode):\n\n\n# ç¬¬äºé¨åï¼java ee middleware, third party & custom application threads\n\nè¿æ¯æ´ä¸ªæä»¶çæ ¸å¿é¨åï¼éé¢å±ç¤ºäº javaee å®¹å¨ï¼å¦ tomcatãresin ç­ï¼ãèªå·±çç¨åºä¸­æä½¿ç¨ççº¿ç¨ä¿¡æ¯ã\n\n"resin-22129" daemon prio=10 tid=0x00007fbe5c34e000 nid=0x4cb1 waiting on condition [0x00007fbe4ff7c000]\n   java.lang.thread.state: waiting (parking)\n    at sun.misc.unsafe.park(native method)\n    at java.util.concurrent.locks.locksupport.park(locksupport.java:315)\n    at com.caucho.env.thread2.resinthread2.park(resinthread2.java:196)\n    at com.caucho.env.thread2.resinthread2.runtasks(resinthread2.java:147)\n    at com.caucho.env.thread2.resinthread2.run(resinthread2.java:118)\n\n\nåæ°è¯´æï¼\n\n * "resin-22129" **çº¿ç¨åç§°ï¼**å¦æä½¿ç¨ java.lang.thread ç±»çæä¸ä¸ªçº¿ç¨çæ¶åï¼çº¿ç¨åç§°ä¸º thread-(æ°å­) çå½¢å¼ï¼è¿éæ¯ resin çæççº¿ç¨ï¼\n * daemon **çº¿ç¨ç±»åï¼**çº¿ç¨åä¸ºå®æ¤çº¿ç¨ (daemon) åéå®æ¤çº¿ç¨ (non-daemon) ä¸¤ç§ï¼éå¸¸é½æ¯å®æ¤çº¿ç¨ï¼\n * prio=10 **çº¿ç¨ä¼åçº§ï¼**é»è®¤ä¸º 5ï¼æ°å­è¶å¤§ä¼åçº§è¶é«ï¼\n * tid=0x00007fbe5c34e000 **jvm çº¿ç¨ç idï¼**jvm åé¨çº¿ç¨çå¯ä¸æ è¯ï¼éè¿ java.lang.thread.getid()è·åï¼éå¸¸ç¨èªå¢çæ¹å¼å®ç°ï¼\n * nid=0x4cb1 **ç³»ç»çº¿ç¨ idï¼**å¯¹åºçç³»ç»çº¿ç¨ idï¼native thread id)ï¼å¯ä»¥éè¿ top å½ä»¤è¿è¡æ¥çï¼ç°åº id æ¯åå­è¿å¶çå½¢å¼ï¼\n * waiting on condition **ç³»ç»çº¿ç¨ç¶æï¼**è¿éæ¯ç³»ç»ççº¿ç¨ç¶æï¼\n * [0x00007fbe4ff7c000] **èµ·å§æ å°åï¼**çº¿ç¨å æ è°ç¨çå¶å®åå­å°åï¼\n * java.lang.thread.state: waiting (parking) **jvm çº¿ç¨ç¶æï¼**è¿éæ æäºçº¿ç¨å¨ä»£ç çº§å«çç¶æã\n * **çº¿ç¨è°ç¨æ ä¿¡æ¯ï¼**ä¸é¢å°±æ¯å½åçº¿ç¨è°ç¨çè¯¦ç»æ ä¿¡æ¯ï¼ç¨äºä»£ç çåæãå æ ä¿¡æ¯åºè¯¥ä»ä¸åä¸è§£è¯»ï¼å ä¸ºç¨åºè°ç¨çé¡ºåºæ¯ä»ä¸åä¸çã\n\n# ç¬¬ä¸é¨åï¼hotspot vm thread\n\nè¿ä¸é¨åå±ç¤ºäº jvm åé¨çº¿ç¨çä¿¡æ¯ï¼ç¨äºæ§è¡åé¨çåçæä½ãä¸é¢å¸¸è§çéä¸­åç½®çº¿ç¨ï¼\n\n# "attach listener"\n\nè¯¥çº¿ç¨è´è´£æ¥æ¶å¤é¨å½ä»¤ï¼æ§è¡è¯¥å½ä»¤å¹¶æç»æè¿åç»è°ç¨èï¼æ­¤ç§ç±»åççº¿ç¨éå¸¸å¨æ¡é¢ç¨åºä¸­åºç°ã\n\n"attach listener" daemon prio=5 tid=0x00007fc6b6800800 nid=0x3b07 waiting on condition [0x0000000000000000]\n   java.lang.thread.state: runnable\n\n\n# "destroyjavavm"\n\næ§è¡ main() ççº¿ç¨å¨æ§è¡å®ä¹åè°ç¨ jni ä¸­ç jni_destroyjavavm() æ¹æ³ä¼å¤èµ· destroyjavavm çº¿ç¨ï¼å¤äºç­å¾ç¶æï¼ç­å¾å¶å®çº¿ç¨ï¼java çº¿ç¨å native çº¿ç¨ï¼éåºæ¶éç¥å®å¸è½½ jvmã\n\n"destroyjavavm" prio=5 tid=0x00007fc6b3001000 nid=0x1903 waiting on condition [0x0000000000000000]\n   java.lang.thread.state: runnable\n\n\n# "service thread"\n\nç¨äºå¯å¨æå¡ççº¿ç¨\n\n"service thread" daemon prio=10 tid=0x00007fbea81b3000 nid=0x5f2 runnable [0x0000000000000000]\n   java.lang.thread.state: runnable\n\n\n# "compilerthread"\n\nç¨æ¥è°ç¨ jitingï¼å®æ¶ç¼è¯è£å¸ç±»ãéå¸¸ jvm ä¼å¯å¨å¤ä¸ªçº¿ç¨æ¥å¤çè¿é¨åå·¥ä½ï¼çº¿ç¨åç§°åé¢çæ°å­ä¹ä¼ç´¯å ï¼æ¯å¦ compilerthread1ã\n\n"c2 compilerthread1" daemon prio=10 tid=0x00007fbea814b000 nid=0x5f1 waiting on condition [0x0000000000000000]\n   java.lang.thread.state: runnable\n\n"c2 compilerthread0" daemon prio=10 tid=0x00007fbea8142000 nid=0x5f0 waiting on condition [0x0000000000000000]\n   java.lang.thread.state: runnable\n\n\n# "signal dispatcher"\n\nattach listener çº¿ç¨çèè´£æ¯æ¥æ¶å¤é¨ jvm å½ä»¤ï¼å½å½ä»¤æ¥æ¶æååï¼ä¼äº¤ç» signal dispather çº¿ç¨å»è¿è¡ååå°åä¸ªä¸åçæ¨¡åå¤çå½ä»¤ï¼å¹¶ä¸è¿åå¤çç»æã signal dispather çº¿ç¨ä¹æ¯å¨ç¬¬ä¸æ¬¡æ¥æ¶å¤é¨ jvm å½ä»¤æ¶ï¼è¿è¡åå§åå·¥ä½ã\n\n"signal dispatcher" daemon prio=10 tid=0x00007fbea81bf800 nid=0x5ef runnable [0x0000000000000000]\n   java.lang.thread.state: runnable\n\n\n# "finalizer"\n\nè¿ä¸ªçº¿ç¨ä¹æ¯å¨ main çº¿ç¨ä¹ååå»ºçï¼å¶ä¼åçº§ä¸º 10ï¼ä¸»è¦ç¨äºå¨åå¾æ¶éåï¼è°ç¨å¯¹è±¡ç finalize() æ¹æ³ï¼å³äº finalizer çº¿ç¨çå ç¹ï¼\n\n * åªæå½å¼å§ä¸è½®åå¾æ¶éæ¶ï¼æä¼å¼å§è°ç¨ finalize()æ¹æ³ï¼å æ­¤å¹¶ä¸æ¯ææå¯¹è±¡ç finalize()æ¹æ³é½ä¼è¢«æ§è¡ï¼\n * è¯¥çº¿ç¨ä¹æ¯ daemon çº¿ç¨ï¼å æ­¤å¦æèææºä¸­æ²¡æå¶ä»é daemon çº¿ç¨ï¼ä¸ç®¡è¯¥çº¿ç¨ææ²¡ææ§è¡å® finalize()æ¹æ³ï¼jvm ä¹ä¼éåºï¼\n * jvm å¨åå¾æ¶éæ¶ä¼å°å¤±å»å¼ç¨çå¯¹è±¡åè£æ finalizer å¯¹è±¡ï¼reference çå®ç°ï¼ï¼å¹¶æ¾å¥ referencequeueï¼ç± finalizer çº¿ç¨æ¥å¤çï¼æåå°è¯¥ finalizer å¯¹è±¡çå¼ç¨ç½®ä¸º nullï¼ç±åå¾æ¶éå¨æ¥åæ¶ï¼\n\njvm ä¸ºä»ä¹è¦åç¬ç¨ä¸ä¸ªçº¿ç¨æ¥æ§è¡ finalize() æ¹æ³å¢ï¼\n\nå¦æ jvm çåå¾æ¶éçº¿ç¨èªå·±æ¥åï¼å¾æå¯è½ç±äºå¨ finalize()æ¹æ³ä¸­è¯¯æä½å¯¼è´ gc çº¿ç¨åæ­¢æä¸å¯æ§ï¼è¿å¯¹ gc çº¿ç¨æ¥è¯´æ¯ä¸ç§ç¾é¾ã\n\n"finalizer" daemon prio=10 tid=0x00007fbea80da000 nid=0x5eb in object.wait() [0x00007fbeac044000]\n   java.lang.thread.state: waiting (on object monitor)\n    at java.lang.object.wait(native method)\n    at java.lang.ref.referencequeue.remove(referencequeue.java:135)\n    - locked <0x00000006d173c1a8> (a java.lang.ref.referencequeue$lock)\n    at java.lang.ref.referencequeue.remove(referencequeue.java:151)\n    at java.lang.ref.finalizer$finalizerthread.run(finalizer.java:209)\n\n\n# "reference handler"\n\njvm å¨åå»º main çº¿ç¨åå°±åå»º reference handler çº¿ç¨ï¼å¶ä¼åçº§æé«ï¼ä¸º 10ï¼å®ä¸»è¦ç¨äºå¤çå¼ç¨å¯¹è±¡æ¬èº«ï¼è½¯å¼ç¨ãå¼±å¼ç¨ãèå¼ç¨ï¼çåå¾åæ¶é®é¢ ã\n\n"reference handler" daemon prio=10 tid=0x00007fbea80d8000 nid=0x5ea in object.wait() [0x00007fbeac085000]\n   java.lang.thread.state: waiting (on object monitor)\n    at java.lang.object.wait(native method)\n    at java.lang.object.wait(object.java:503)\n    at java.lang.ref.reference$referencehandler.run(reference.java:133)\n    - locked <0x00000006d173c1f0> (a java.lang.ref.reference$lock)\n\n\n# "vm thread"\n\njvm ä¸­çº¿ç¨çæ¯ä½ï¼æ ¹æ® hotspot æºç ä¸­å³äº vmthread.hpp éé¢çæ³¨éï¼å®æ¯ä¸ä¸ªåä¾çå¯¹è±¡ï¼æåå§ççº¿ç¨ï¼ä¼äº§çæè§¦åææå¶ä»ççº¿ç¨ï¼è¿ä¸ªåä¾ç vm çº¿ç¨æ¯ä¼è¢«å¶ä»çº¿ç¨æä½¿ç¨æ¥åä¸äº vm æä½ï¼å¦æ¸æ«åå¾ç­ï¼ã å¨ vm thread çç»æä½éæä¸ä¸ª vmoperationqueue åéï¼ææç vm çº¿ç¨æä½(vm_operation)é½ä¼è¢«ä¿å­å°è¿ä¸ªåéå½ä¸­ï¼vmthread æ¬èº«å°±æ¯ä¸ä¸ªçº¿ç¨ï¼å®ççº¿ç¨è´è´£æ§è¡ä¸ä¸ªèªè½®è¯¢ç loop å½æ°(å·ä½å¯ä»¥åèï¼vmthread.cpp éé¢ç void vmthread::loop()) ï¼è¯¥ loop å½æ°ä» vmoperationqueue åéä¸­æç§ä¼åçº§ååºå½åéè¦æ§è¡çæä½å¯¹è±¡(vm_operation)ï¼å¹¶ä¸è°ç¨ vm_operation->evaluate å½æ°å»æ§è¡è¯¥æä½ç±»åæ¬èº«çä¸å¡é»è¾ã vm æä½ç±»åè¢«å®ä¹å¨ vm_operations.hpp æä»¶åï¼åä¸¾å ä¸ªï¼threadstopãthreaddumpãprintthreadsãgencollectfullãgencollectfullconcurrentãcms_initial_markãcms_final_remarkâ¦.. æå´è¶£çåå­¦ï¼å¯ä»¥èªå·±å»æ¥çæºæä»¶ã\n\n"vm thread" prio=10 tid=0x00007fbea80d3800 nid=0x5e9 runnable\n\n\n# ç¬¬åé¨åï¼hotspot gc thread\n\njvm ä¸­ç¨äºè¿è¡èµæºåæ¶ççº¿ç¨ï¼åæ¬ä»¥ä¸å ç§ç±»åççº¿ç¨ï¼\n\n# "vm periodic task thread"\n\nè¯¥çº¿ç¨æ¯ jvm å¨ææ§ä»»å¡è°åº¦ççº¿ç¨ï¼å®ç± watcherthread åå»ºï¼æ¯ä¸ä¸ªåä¾å¯¹è±¡ãè¯¥çº¿ç¨å¨ jvm åä½¿ç¨å¾æ¯è¾é¢ç¹ï¼æ¯å¦ï¼å®æçåå­çæ§ãjvm è¿è¡ç¶åµçæ§ã\n\n"vm periodic task thread" prio=10 tid=0x00007fbea82ae800 nid=0x5fa waiting on condition\n\n\nå¯ä»¥ä½¿ç¨ jstat å½ä»¤æ¥ç gc çæåµï¼æ¯å¦æ¥çæä¸ªè¿ç¨æ²¡æå­æ´»å¿è¦çå¼ç¨å¯ä»¥ä½¿ç¨å½ä»¤ jstat -gcutil 250 7 åæ°ä¸­ pid æ¯è¿ç¨ idï¼åé¢ç 250 å 7 è¡¨ç¤ºæ¯ 250 æ¯«ç§æå°ä¸æ¬¡ï¼æ»å±æå° 7 æ¬¡ã è¿å¯¹äºé²æ­¢å ä¸ºåºç¨ä»£ç ä¸­ç´æ¥ä½¿ç¨ native åºæèç¬¬ä¸æ¹çä¸äºçæ§å·¥å·çåå­æ³æ¼æéå¸¸å¤§çå¸®å©ã\n\n# "gc task thread#0 (parallelgc)"\n\nåå¾åæ¶çº¿ç¨ï¼è¯¥çº¿ç¨ä¼è´è´£è¿è¡åå¾åæ¶ãéå¸¸ jvm ä¼å¯å¨å¤ä¸ªçº¿ç¨æ¥å¤çè¿ä¸ªå·¥ä½ï¼çº¿ç¨åç§°ä¸­#åé¢çæ°å­ä¹ä¼ç´¯å ã\n\n"gc task thread#0 (parallelgc)" prio=5 tid=0x00007fc6b480d000 nid=0x2503 runnable\n\n"gc task thread#1 (parallelgc)" prio=5 tid=0x00007fc6b2812000 nid=0x2703 runnable\n\n"gc task thread#2 (parallelgc)" prio=5 tid=0x00007fc6b2812800 nid=0x2903 runnable\n\n"gc task thread#3 (parallelgc)" prio=5 tid=0x00007fc6b2813000 nid=0x2b03 runnable\n\n\nå¦æå¨ jvm ä¸­å¢å äº -xx:+useconcmarksweepgc åæ°å°ä¼å¯ç¨ cms ï¼concurrent mark-sweepï¼gc thread æ¹å¼ï¼ä»¥ä¸æ¯è¯¥æ¨¡å¼ä¸ççº¿ç¨ç±»åï¼\n\n# "gang worker#0 (parallel gc threads)"\n\nåæ¥åå¾åæ¶çº¿ç¨ gc task thread#0 (parallelgc) è¢«æ¿æ¢ä¸º gang worker#0 (parallel gc threads)ãgang worker æ¯ jvm ç¨äºå¹´è½»ä»£åå¾åæ¶(minor gc)ççº¿ç¨ã\n\n"gang worker#0 (parallel gc threads)" prio=10 tid=0x00007fbea801b800 nid=0x5e4 runnable\n\n"gang worker#1 (parallel gc threads)" prio=10 tid=0x00007fbea801d800 nid=0x5e7 runnable\n\n\n# "concurrent mark-sweep gc thread"\n\nå¹¶åæ è®°æ¸é¤åå¾åæ¶å¨ï¼å°±æ¯éå¸¸æè¯´ç cms gcï¼çº¿ç¨ï¼ è¯¥çº¿ç¨ä¸»è¦éå¯¹äºå¹´èä»£åå¾åæ¶ã\n\n"concurrent mark-sweep gc thread" prio=10 tid=0x00007fbea8073800 nid=0x5e8 runnable\n\n\n# "surrogate locker thread (concurrent gc)"\n\næ­¤çº¿ç¨ä¸»è¦éå cms åå¾åæ¶å¨æ¥ä½¿ç¨ï¼æ¯ä¸ä¸ªå®æ¤çº¿ç¨ï¼ä¸»è¦è´è´£å¤ç gc è¿ç¨ä¸­ java å±ç referenceï¼æè½¯å¼ç¨ãå¼±å¼ç¨ç­ç­ï¼ä¸ jvm åé¨å±é¢çå¯¹è±¡ç¶æåæ­¥ã\n\n"surrogate locker thread (concurrent gc)" daemon prio=10 tid=0x00007fbea8158800 nid=0x5ee waiting on condition [0x0000000000000000]\n   java.lang.thread.state: runnable\n\n\nè¿éä»¥ weakhashmap ä¸ºä¾è¿è¡è¯´æï¼é¦åæ¯ä¸ä¸ªå³é®ç¹ï¼\n\n * weakhashmap å hashmap ä¸æ ·ï¼åé¨æä¸ä¸ª entry[]æ°ç»;\n * weakhashmap ç entry æ¯è¾ç¹æ®ï¼å®çç»§æ¿ä½ç³»ç»æä¸º entry->weakreference->reference;\n * reference éé¢æä¸ä¸ªå¨å±éå¯¹è±¡ï¼lockï¼å®ä¹è¢«ç§°ä¸º pending_lockï¼æ³¨æï¼å®æ¯éæå¯¹è±¡ï¼\n * reference éé¢æä¸ä¸ªéæåéï¼pendingï¼\n * reference éé¢æä¸ä¸ªéæåé¨ç±»ï¼referencehandler ççº¿ç¨ï¼å®å¨ static åéé¢è¢«åå§åå¹¶ä¸å¯å¨ï¼å¯å¨å®æåå¤äº wait ç¶æï¼å®å¨ä¸ä¸ª lock åæ­¥éæ¨¡åä¸­ç­å¾ï¼\n * weakhashmap éé¢è¿å®ä¾åäºä¸ä¸ª referencequeue åé\n\nåè®¾ï¼weakhashmap å¯¹è±¡éé¢å·²ç»ä¿å­äºå¾å¤å¯¹è±¡çå¼ç¨ï¼jvm å¨è¿è¡ cms gc çæ¶åä¼åå»ºä¸ä¸ª concurrentmarksweepthreadï¼ç®ç§° cmstï¼çº¿ç¨å»è¿è¡ gcãconcurrentmarksweepthread çº¿ç¨è¢«åå»ºçåæ¶ä¼åå»ºä¸ä¸ª surrogatelockerthreadï¼ç®ç§° sltï¼çº¿ç¨å¹¶ä¸å¯å¨å®ï¼slt å¯å¨ä¹åï¼å¤äºç­å¾é¶æ®µã cmst å¼å§ gc æ¶ï¼ä¼åä¸ä¸ªæ¶æ¯ç» slt è®©å®å»è·å java å± reference å¯¹è±¡çå¨å±éï¼lockãç´å° cms gc å®æ¯ä¹åï¼jvm ä¼å° weakhashmap ä¸­ææè¢«åæ¶çå¯¹è±¡æå±ç weakreference å®¹å¨å¯¹è±¡æ¾å¥å° reference ç pending å±æ§å½ä¸­ï¼æ¯æ¬¡ gc å®æ¯ä¹åï¼pending å±æ§åºæ¬ä¸é½ä¸ä¼ä¸º null äºï¼ï¼ç¶åéç¥ slt éæ¾å¹¶ä¸ notify å¨å±é:lockãæ­¤æ¶æ¿æ´»äº referencehandler çº¿ç¨ç run æ¹æ³ï¼ä½¿å¶è±ç¦» wait ç¶æï¼å¼å§å·¥ä½äºã referencehandler è¿ä¸ªçº¿ç¨ä¼å° pending ä¸­çææ weakreference å¯¹è±¡é½ç§»å¨å°å®ä»¬åèªçåéå½ä¸­ï¼æ¯å¦å½åè¿ä¸ª weakreference å±äºæä¸ª weakhashmap å¯¹è±¡ï¼é£ä¹å®å°±ä¼è¢«æ¾å¥ç¸åºç referencequeue åééé¢ï¼è¯¥åéæ¯é¾è¡¨ç»æï¼ã å½æä»¬ä¸æ¬¡ä» weakhashmap å¯¹è±¡éé¢ getãput æ°æ®æèè°ç¨ size æ¹æ³çæ¶åï¼weakhashmap å°±ä¼å° referencequeue åéä¸­ç weakreference ä¾ä¾ poll åºæ¥å»å entry[]æ°æ®åæ¯è¾ï¼å¦æåç°ç¸åçï¼åè¯´æè¿ä¸ª entry æä¿å­çå¯¹è±¡å·²ç»è¢« gc æäºï¼é£ä¹å° entry[]åç entry å¯¹è±¡åé¤æã\n\n# ç¬¬äºé¨åï¼jni global references count\n\nè¿ä¸é¨åä¸»è¦åæ¶é£äºå¨ native ä»£ç ä¸è¢«å¼ç¨ï¼ä½å¨ java ä»£ç ä¸­å´æ²¡æå­æ´»å¿è¦çå¼ç¨ï¼å¯¹äºé²æ­¢å ä¸ºåºç¨ä»£ç ä¸­ç´æ¥ä½¿ç¨ native åºæç¬¬ä¸æ¹çä¸äºçæ§å·¥å·çåå­æ³æ¼æéå¸¸å¤§çå¸®å©ã\n\njni global references: 830\n\n\nä¸ä¸ç¯æç« å°è¦è®²è¿°ä¸ä¸ªç´æ¥æ¾åº cpu 100% çº¿ç¨çä¾å­ã\n\n\n# ç³»ç»çº¿ç¨ç¶æ\n\nç³»ç»çº¿ç¨æå¦ä¸ç¶æï¼\n\n# deadlock\n\næ­»éçº¿ç¨ï¼ä¸è¬æå¤ä¸ªçº¿ç¨è°ç¨æé´è¿å¥äºç¸äºèµæºå ç¨ï¼å¯¼è´ä¸ç´ç­å¾æ æ³éæ¾çæåµã\n\nãç¤ºä¾ãdeadlock ç¤ºä¾\n\n"deadlock_test-1" daemon prio=6 tid=0x000000000690f800 nid=0x1820 waiting for monitor entry [0x000000000805f000]\n   java.lang.thread.state: blocked (on object monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.gomonitordeadlock(threaddeadlockstate.java:197)\n                - waiting to lock <0x00000007d58f5e60> (a com.nbp.theplatform.threaddump.threaddeadlockstate$monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.monitorourlock(threaddeadlockstate.java:182)\n                - locked <0x00000007d58f5e48> (a com.nbp.theplatform.threaddump.threaddeadlockstate$monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.run(threaddeadlockstate.java:135)\n\n   locked ownable synchronizers:\n                - none\n\n"deadlock_test-2" daemon prio=6 tid=0x0000000006858800 nid=0x17b8 waiting for monitor entry [0x000000000815f000]\n   java.lang.thread.state: blocked (on object monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.gomonitordeadlock(threaddeadlockstate.java:197)\n                - waiting to lock <0x00000007d58f5e78> (a com.nbp.theplatform.threaddump.threaddeadlockstate$monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.monitorourlock(threaddeadlockstate.java:182)\n                - locked <0x00000007d58f5e60> (a com.nbp.theplatform.threaddump.threaddeadlockstate$monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.run(threaddeadlockstate.java:135)\n\n   locked ownable synchronizers:\n                - none\n\n"deadlock_test-3" daemon prio=6 tid=0x0000000006859000 nid=0x25dc waiting for monitor entry [0x000000000825f000]\n   java.lang.thread.state: blocked (on object monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.gomonitordeadlock(threaddeadlockstate.java:197)\n                - waiting to lock <0x00000007d58f5e48> (a com.nbp.theplatform.threaddump.threaddeadlockstate$monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.monitorourlock(threaddeadlockstate.java:182)\n                - locked <0x00000007d58f5e78> (a com.nbp.theplatform.threaddump.threaddeadlockstate$monitor)\n                at com.nbp.theplatform.threaddump.threaddeadlockstate$deadlockthread.run(threaddeadlockstate.java:135)\n\n   locked ownable synchronizers:\n                - none\n\n\n# runnable\n\nä¸è¬æè¯¥çº¿ç¨æ­£å¨æ§è¡ç¶æä¸­ï¼è¯¥çº¿ç¨å ç¨äºèµæºï¼æ­£å¨å¤çæä¸ªæä½ï¼å¦éè¿ sql è¯­å¥æ¥è¯¢æ°æ®åºãå¯¹æä¸ªæä»¶è¿è¡åå¥ç­ã\n\n# blocked\n\nçº¿ç¨æ­£å¤äºé»å¡ç¶æï¼æå½åçº¿ç¨æ§è¡è¿ç¨ä¸­ï¼æéè¦çèµæºé¿æ¶é´ç­å¾å´ä¸ç´æªè½è·åå°ï¼è¢«å®¹å¨ççº¿ç¨ç®¡çå¨æ è¯ä¸ºé»å¡ç¶æï¼å¯ä»¥çè§£ä¸ºç­å¾èµæºè¶æ¶ççº¿ç¨ã\n\nãç¤ºä¾ãblocked ç¤ºä¾\n\n"blocked_test pool-1-thread-2" prio=6 tid=0x0000000007673800 nid=0x260c waiting for monitor entry [0x0000000008abf000]\n   java.lang.thread.state: blocked (on object monitor)\n                at com.nbp.theplatform.threaddump.threadblockedstate.monitorlock(threadblockedstate.java:43)\n                - waiting to lock <0x0000000780a000b0> (a com.nbp.theplatform.threaddump.threadblockedstate)\n                at com.nbp.theplatform.threaddump.threadblockedstate$2.run(threadblockedstate.java:26)\n                at java.util.concurrent.threadpoolexecutor$worker.runtask(threadpoolexecutor.java:886)\n                at java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:908)\n                at java.lang.thread.run(thread.java:662)\n   locked ownable synchronizers:\n                - <0x0000000780b0c6a0> (a java.util.concurrent.locks.reentrantlock$nonfairsync)\n"blocked_test pool-1-thread-3" prio=6 tid=0x00000000074f5800 nid=0x1994 waiting for monitor entry [0x0000000008bbf000]\n   java.lang.thread.state: blocked (on object monitor)\n                at com.nbp.theplatform.threaddump.threadblockedstate.monitorlock(threadblockedstate.java:42)\n                - waiting to lock <0x0000000780a000b0> (a com.nbp.theplatform.threaddump.threadblockedstate)\n                at com.nbp.theplatform.threaddump.threadblockedstate$3.run(threadblockedstate.java:34)\n                at java.util.concurrent.threadpoolexecutor$worker.runtask(threadpoolexecutor.java:886\n                at java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:908)\n                at java.lang.thread.run(thread.java:662)\n   locked ownable synchronizers:\n                - <0x0000000780b0e1b8> (a java.util.concurrent.locks.reentrantlock$nonfairsync)\n\n\n# waiting on condition\n\nçº¿ç¨æ­£å¤äºç­å¾èµæºæç­å¾æä¸ªæ¡ä»¶çåçï¼å·ä½çåå éè¦ç»åä¸é¢å æ ä¿¡æ¯è¿è¡åæã\n\nï¼1ï¼å¦æå æ ä¿¡æ¯æç¡®æ¯åºç¨ä»£ç ï¼åè¯æè¯¥çº¿ç¨æ­£å¨ç­å¾èµæºï¼ä¸è¬æ¯å¤§éè¯»åæç§èµæºä¸è¯¥èµæºéç¨äºèµæºéçæåµä¸ï¼çº¿ç¨è¿å¥ç­å¾ç¶æï¼ç­å¾èµæºçè¯»åï¼æèæ­£å¨ç­å¾å¶ä»çº¿ç¨çæ§è¡ç­ã\n\nï¼2ï¼å¦æåç°æå¤§éççº¿ç¨é½æ­£å¤äºè¿ç§ç¶æï¼å¹¶ä¸å æ ä¿¡æ¯ä¸­å¾ç¥æ­£ç­å¾ç½ç»è¯»åï¼è¿æ¯å ä¸ºç½ç»é»å¡å¯¼è´çº¿ç¨æ æ³æ§è¡ï¼å¾æå¯è½æ¯ä¸ä¸ªç½ç»ç¶é¢çå¾åï¼\n\n * ç½ç»éå¸¸ç¹å¿ï¼å ä¹æ¶èäºææçå¸¦å®½ï¼ä»ç¶æå¤§éæ°æ®ç­å¾ç½ç»è¯»åï¼\n\n * ç½ç»å¯è½æ¯ç©ºé²çï¼ä½ç±äºè·¯ç±æé²ç«å¢ç­åå ï¼å¯¼è´åæ æ³æ­£å¸¸å°è¾¾ï¼\n\næä»¥ä¸å®è¦ç»åç³»ç»çä¸äºæ§è½è§å¯å·¥å·è¿è¡ç»¼ååæï¼æ¯å¦ netstat ç»è®¡åä½æ¶é´çåéåçæ°éï¼çæ¯å¦å¾ææ¾è¶è¿äºæå¨ç½ç»å¸¦å®½çéå¶ï¼è§å¯ cpu çå©ç¨çï¼çç³»ç»æç cpu æ¶é´æ¯å¦ææ¾å¤§äºç¨æ·æç cpu æ¶é´ãè¿äºé½æåç±äºç½ç»å¸¦å®½æéå¯¼è´çç½ç»ç¶é¢ã\n\nï¼3ï¼è¿æä¸ç§å¸¸è§çæåµæ¯è¯¥çº¿ç¨å¨ sleepï¼ç­å¾ sleep çæ¶é´å°äºï¼å°è¢«å¤éã\n\nãç¤ºä¾ãç­å¾ç¶ææ ·ä¾\n\n "iowaitthread" prio=6 tid=0x0000000007334800 nid=0x2b3c waiting on condition [0x000000000893f000]\n   java.lang.thread.state: waiting (parking)\n                at sun.misc.unsafe.park(native method)\n                - parking to wait for  <0x00000007d5c45850> (a java.util.concurrent.locks.abstractqueuedsynchronizer$conditionobject)\n                at java.util.concurrent.locks.locksupport.park(locksupport.java:156)\n                at java.util.concurrent.locks.abstractqueuedsynchronizer$conditionobject.await(abstractqueuedsynchronizer.java:1987)\n                at java.util.concurrent.linkedblockingdeque.takefirst(linkedblockingdeque.java:440)\n                at java.util.concurrent.linkedblockingdeque.take(linkedblockingdeque.java:629)\n                at com.nbp.theplatform.threaddump.threadiowaitstate$iowaithandler2.run(threadiowaitstate.java:89)\n                at java.lang.thread.run(thread.java:662)\n\n\n# waiting for monitor entry æ in object.wait()\n\nmoniter æ¯ java ä¸­ç¨ä»¥å®ç°çº¿ç¨ä¹é´çäºæ¥ä¸åä½çä¸»è¦ææ®µï¼å®å¯ä»¥çææ¯å¯¹è±¡æè class çéï¼æ¯ä¸ªå¯¹è±¡é½æï¼ä¹ä»æä¸ä¸ª monitorã\n\n\n\nä»ä¸å¾å¯ä»¥çåºï¼æ¯ä¸ª monitor å¨æä¸ªæ¶å»åªè½è¢«ä¸ä¸ªçº¿ç¨æ¥æï¼è¯¥çº¿ç¨å°±æ¯ "active thread"ï¼èå¶ä»çº¿ç¨é½æ¯ "waiting thread"ï¼åå«å¨ä¸¤ä¸ªéå "entry set"å"waint set"éé¢ç­å¾ãå¶ä¸­å¨ "entry set" ä¸­ç­å¾ççº¿ç¨ç¶ææ¯ waiting for monitor entryï¼å¨ "wait set" ä¸­ç­å¾ççº¿ç¨ç¶ææ¯ in object.wait()ã\n\nï¼1ï¼"entry set"éé¢ççº¿ç¨ã\n\næä»¬ç§°è¢« synchronized ä¿æ¤èµ·æ¥çä»£ç æ®µä¸ºä¸´çåºï¼å¯¹åºçä»£ç å¦ä¸ï¼\n\nsynchronized(obj) {\n}\n\n\nå½ä¸ä¸ªçº¿ç¨ç³è¯·è¿å¥ä¸´çåºæ¶ï¼å®å°±è¿å¥äº "entry set" éåä¸­ï¼è¿æ¶åæä¸¤ç§å¯è½æ§ï¼\n\n * è¯¥ monitor ä¸è¢«å¶ä»çº¿ç¨æ¥æï¼"entry set"éé¢ä¹æ²¡æå¶ä»ç­å¾ççº¿ç¨ãæ¬çº¿ç¨å³æä¸ºç¸åºç±»æèå¯¹è±¡ç monitor ç ownerï¼æ§è¡ä¸´çåºéé¢çä»£ç ï¼æ­¤æ¶å¨ thread dump ä¸­æ¾ç¤ºçº¿ç¨å¤äº "runnable" ç¶æã\n * è¯¥ monitor è¢«å¶ä»çº¿ç¨æ¥æï¼æ¬çº¿ç¨å¨ "entry set" éåä¸­ç­å¾ãæ­¤æ¶å¨ thread dump ä¸­æ¾ç¤ºçº¿ç¨å¤äº "waiting for monity entry" ç¶æã\n\nä¸´çåºçè®¾ç½®æ¯ä¸ºäºä¿è¯å¶åé¨çä»£ç æ§è¡çåå­æ§åå®æ´æ§ï¼ä½å ä¸ºä¸´çåºå¨ä»»ä½æ¶é´åªåè®¸çº¿ç¨ä¸²è¡éè¿ï¼è¿åæä»¬ä½¿ç¨å¤çº¿ç¨çåè¡·æ¯ç¸åçãå¦æå¨å¤çº¿ç¨ç¨åºä¸­å¤§éä½¿ç¨ synchronizedï¼æèä¸éå½çä½¿ç¨å®ï¼ä¼é æå¤§éçº¿ç¨å¨ä¸´çåºçå¥å£ç­å¾ï¼é æç³»ç»çæ§è½å¤§å¹ä¸éãå¦æå¨ thread dump ä¸­åç°è¿ä¸ªæåµï¼åºè¯¥å®¡è§æºç å¹¶å¯¹å¶è¿è¡æ¹è¿ã\n\nï¼2ï¼"wait set"éé¢ççº¿ç¨\n\nå½çº¿ç¨è·å¾äº monitorï¼è¿å¥äºä¸´çåºä¹åï¼å¦æåç°çº¿ç¨ç»§ç»­è¿è¡çæ¡ä»¶æ²¡ææ»¡è¶³ï¼å®åè°ç¨å¯¹è±¡ï¼éå¸¸æ¯è¢« synchronized çå¯¹è±¡ï¼ç wait()æ¹æ³ï¼æ¾å¼ monitorï¼è¿å¥ "wait set"éåãåªæå½å«ççº¿ç¨å¨è¯¥å¯¹è±¡ä¸è°ç¨äº notify()æè notifyall()æ¹æ³ï¼"wait set"éåä¸­ççº¿ç¨æå¾å°æºä¼å»ç«äºï¼ä½æ¯åªæä¸ä¸ªçº¿ç¨è·å¾å¯¹è±¡ç monitorï¼æ¢å¤å°è¿è¡æã"wait set"ä¸­ççº¿ç¨å¨ thread dump ä¸­æ¾ç¤ºçç¶æä¸º in object.wait()ãéå¸¸æ¥è¯´ï¼å½ cpu å¾å¿çæ¶åå³æ³¨ runnable ç¶æççº¿ç¨ï¼åä¹åå³æ³¨ waiting for monitor entry ç¶æççº¿ç¨ã\n\n\n# jstack ä½¿ç¨ç¤ºä¾\n\n# æ¾åºæ java è¿ç¨ä¸­æèè´¹ cpu ç java çº¿ç¨\n\nï¼1ï¼æ¾åº java è¿ç¨\n\nåè®¾åºç¨åç§°ä¸º myappï¼\n\n$ jps | grep myapp\n29527 myapp.jar\n\n\nå¾å°è¿ç¨ id ä¸º 21711\n\nï¼2ï¼æ¾åºè¯¥è¿ç¨åæèè´¹ cpu ççº¿ç¨ï¼å¯ä»¥ä½¿ç¨ ps -lfp pid æè ps -mp pid -o thread, tid, time æè top -hp pid\n\ntime åå°±æ¯åä¸ª java çº¿ç¨èè´¹ç cpu æ¶é´ï¼cpu æ¶é´æé¿çæ¯çº¿ç¨ id ä¸º 21742 ççº¿ç¨ï¼ç¨\n\nprintf "%x\\n" 21742\n\n\nå¾å° 21742 çåå­è¿å¶å¼ä¸º 54eeï¼ä¸é¢ä¼ç¨å°ã\n\nï¼3ï¼ä½¿ç¨ jstack æå°çº¿ç¨å æ ä¿¡æ¯\n\nä¸ä¸æ­¥ç»äºè½®å° jstack ä¸åºäºï¼å®ç¨æ¥è¾åºè¿ç¨ 21711 çå æ ä¿¡æ¯ï¼ç¶åæ ¹æ®çº¿ç¨ id çåå­è¿å¶å¼ grepï¼å¦ä¸ï¼\n\n$ jstack 21711 | grep 54ee\n"pollintervalretryschedulerthread" prio=10 tid=0x00007f950043e000 nid=0x54ee in object.wait() [0x00007f94c6eda000]\n\n\nå¯ä»¥çå° cpu æ¶èå¨ pollintervalretryschedulerthread è¿ä¸ªç±»ç object.wait()ã\n\n> æ³¨ï¼ä¸é¢çä¾å­ä¸­ï¼é»è®¤åªæ¾ç¤ºäºä¸è¡ä¿¡æ¯ï¼ä½å¾å¤æ¶åæä»¬å¸ææ¥çæ´è¯¦ç»çè°ç¨æ ãå¯ä»¥éè¿æå® -a <num> çæ¹å¼æ¥æ¾ç¤ºè¡æ°ãä¾å¦ï¼jstack -l <pid> | grep <thread-hex-id> -a 10\n\nï¼4ï¼åæä»£ç \n\nææ¾äºä¸æçä»£ç ï¼å®ä½å°ä¸é¢çä»£ç ï¼\n\n// idle wait\ngetlog().info("thread [" + getname() + "] is idle waiting...");\nschedulerthreadstate = polltaskschedulerthreadstate.idlewaiting;\nlong now = system.currenttimemillis();\nlong waittime = now + getidlewaittime();\nlong timeuntilcontinue = waittime - now;\nsynchronized(siglock) {\n\ttry {\n    \tif(!halted.get()) {\n    \t\tsiglock.wait(timeuntilcontinue);\n    \t}\n    }\n\tcatch (interruptedexception ignore) {\n    }\n}\n\n\nå®æ¯è½®è¯¢ä»»å¡çç©ºé²ç­å¾ä»£ç ï¼ä¸é¢ç siglock.wait(timeuntilcontinue) å°±å¯¹åºäºåé¢ç object.wait()ã\n\n# çæ threaddump æä»¶\n\nå¯ä»¥ä½¿ç¨ jstack -l <pid> > <file-path> å½ä»¤çæ threaddump æä»¶\n\nãç¤ºä¾ãçæè¿ç¨ id ä¸º 8841 ç java è¿ç¨ç threaddump æä»¶ã\n\njstack -l 8841 > /home/threaddump.txt\n\n\n\n# jinfo\n\n> jinfo(jvm configuration info)ï¼æ¯ java éç½®ä¿¡æ¯å·¥å·ãjinfo ç¨äºå®æ¶æ¥çåè°æ´èææºè¿è¡åæ°ãå¦ä¼ éç» java èææºç-xï¼å³è¾åºä¸­ç jvm_argsï¼ã-xxåæ°ï¼å³è¾åºä¸­ç vm flagsï¼ï¼ä»¥åå¯å¨ java å±é¢éè¿system.getpropertyè·åç-dåæ°ï¼å³è¾åºä¸­ç system propertiesï¼ã\n\nä¹åç jps -v å£ä»¤åªè½æ¥çå°æ¾ç¤ºæå®çåæ°ï¼å¦ææ³è¦æ¥çæªè¢«æ¾ç¤ºæå®çåæ°çå¼å°±è¦ä½¿ç¨ jinfo å£ä»¤ã\n\njinfo å½ä»¤æ ¼å¼ï¼\n\njinfo [option] pid\n\n\noption éé¡¹åæ°ï¼\n\n * -flag - è¾åºæå® args åæ°çå¼\n * -sysprops - è¾åºç³»ç»å±æ§ï¼ç­åäº system.getproperties()\n\nãç¤ºä¾ãjinfo ä½¿ç¨ç¤ºä¾\n\n$ jinfo -sysprops 29527\nattaching to process id 29527, please wait...\ndebugger attached successfully.\nserver compiler detected.\njvm version is 25.222-b10\n...\n\n\n\n# jhat\n\n> jhat(jvm heap analysis tool)ï¼æ¯èææºå è½¬å¨å¿«ç§åæå·¥å·ãjhat ä¸ jmap æ­éä½¿ç¨ï¼ç¨æ¥åæ jmap çæç dump æä»¶ãjhat åç½®äºä¸ä¸ªå¾®åç http/html æå¡å¨ï¼çæ dump çåæç»æåï¼å¯ä»¥å¨æµè§å¨ä¸­æ¥çã\n> \n> æ³¨æï¼ä¸è¬ä¸ä¼ç´æ¥å¨æå¡å¨ä¸è¿è¡åæï¼å ä¸º jhat æ¯ä¸ä¸ªèæ¶å¹¶ä¸èè´¹ç¡¬ä»¶èµæºçè¿ç¨ï¼ä¸è¬ææå¡å¨çæç dump æä»¶ï¼ç¨ jvisualvm ãeclipse memory analyzerãibm heapanalyzer ç­å·¥å·æ¥åæã\n\nå½ä»¤æ ¼å¼ï¼\n\njhat [dumpfile]\n\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * ãjava æ§è½è°ä¼å®æã\n * jvm æ§è½è°ä¼çæ§å·¥å· jpsãjstackãjmapãjhatãjstatãhprof ä½¿ç¨è¯¦è§£\n * jconsole å®æ¹ææ¡£\n * jconsole å·¥å·ä½¿ç¨\n * jstat å½ä»¤æ¥ç jvm ç gc æåµ\n * å©ç¨åå­åæå·¥å·ï¼memory analyzer toolï¼matï¼åæ java é¡¹ç®åå­æ³é²\n * jvm æéåæåæ§è½ä¼åç³»åä¹ä¸ï¼ä½¿ç¨ jstack å®ä½çº¿ç¨å æ ä¿¡æ¯',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JVM GUI å·¥å·",frontmatter:{title:"JVM GUI å·¥å·",date:"2020-07-30T17:56:33.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM","GUI"],permalink:"/pages/43a8e5/"},regularPath:"/01.Java/01.JavaSE/06.JVM/12.JVM_GUI%E5%B7%A5%E5%85%B7.html",relativePath:"01.Java/01.JavaSE/06.JVM/12.JVM_GUIå·¥å·.md",key:"v-27908e84",path:"/pages/43a8e5/",headers:[{level:2,title:"jconsole",slug:"jconsole",normalizedTitle:"jconsole",charIndex:88},{level:3,title:"å¼å¯ JMX",slug:"å¼å¯-jmx",normalizedTitle:"å¼å¯ jmx",charIndex:313},{level:3,title:"è¿æ¥ jconsole",slug:"è¿æ¥-jconsole",normalizedTitle:"è¿æ¥ jconsole",charIndex:742},{level:3,title:"jconsole çé¢",slug:"jconsole-çé¢",normalizedTitle:"jconsole çé¢",charIndex:831},{level:2,title:"jvisualvm",slug:"jvisualvm",normalizedTitle:"jvisualvm",charIndex:365},{level:3,title:"jvisualvm æ¦è¿°é¡µé¢",slug:"jvisualvm-æ¦è¿°é¡µé¢",normalizedTitle:"jvisualvm æ¦è¿°é¡µé¢",charIndex:1207},{level:3,title:"jvisualvm çæ§é¡µé¢",slug:"jvisualvm-çæ§é¡µé¢",normalizedTitle:"jvisualvm çæ§é¡µé¢",charIndex:1289},{level:3,title:"jvisualvm çº¿ç¨é¡µé¢",slug:"jvisualvm-çº¿ç¨é¡µé¢",normalizedTitle:"jvisualvm çº¿ç¨é¡µé¢",charIndex:1362},{level:3,title:"jvisualvm æ½æ ·å¨é¡µé¢",slug:"jvisualvm-æ½æ ·å¨é¡µé¢",normalizedTitle:"jvisualvm æ½æ ·å¨é¡µé¢",charIndex:1453},{level:2,title:"MAT",slug:"mat",normalizedTitle:"mat",charIndex:1513},{level:3,title:"MAT éç½®",slug:"mat-éç½®",normalizedTitle:"mat éç½®",charIndex:1710},{level:3,title:"MAT åæ",slug:"mat-åæ",normalizedTitle:"mat åæ",charIndex:2025},{level:2,title:"JProfile",slug:"jprofile",normalizedTitle:"jprofile",charIndex:2549},{level:2,title:"Arthas",slug:"arthas",normalizedTitle:"arthas",charIndex:2645},{level:3,title:"Arthas åºç¡å½ä»¤",slug:"arthas-åºç¡å½ä»¤",normalizedTitle:"arthas åºç¡å½ä»¤",charIndex:2821},{level:3,title:"Arthas jvm ç¸å³å½ä»¤",slug:"arthas-jvm-ç¸å³å½ä»¤",normalizedTitle:"arthas jvm ç¸å³å½ä»¤",charIndex:3312},{level:3,title:"Arthas class/classloader ç¸å³å½ä»¤",slug:"arthas-class-classloader-ç¸å³å½ä»¤",normalizedTitle:"arthas class/classloader ç¸å³å½ä»¤",charIndex:3685},{level:3,title:"Arthas monitor/watch/trace ç¸å³å½ä»¤",slug:"arthas-monitor-watch-trace-ç¸å³å½ä»¤",normalizedTitle:"arthas monitor/watch/trace ç¸å³å½ä»¤",charIndex:3972},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:4282}],headersStr:"jconsole å¼å¯ JMX è¿æ¥ jconsole jconsole çé¢ jvisualvm jvisualvm æ¦è¿°é¡µé¢ jvisualvm çæ§é¡µé¢ jvisualvm çº¿ç¨é¡µé¢ jvisualvm æ½æ ·å¨é¡µé¢ MAT MAT éç½® MAT åæ JProfile Arthas Arthas åºç¡å½ä»¤ Arthas jvm ç¸å³å½ä»¤ Arthas class/classloader ç¸å³å½ä»¤ Arthas monitor/watch/trace ç¸å³å½ä»¤ åèèµæ",content:'# JVM GUI å·¥å·\n\n> Java ç¨åºååä¸äºæéææ¥å·¥ä½ï¼æä»¥ç»å¸¸éè¦ä½¿ç¨ä¸äº JVM å·¥å·ã\n> \n> æ¬æç³»ç»æ§çä»ç»ä¸ä¸å¸¸ç¨ç JVM GUI å·¥å·ã\n\n\n# jconsole\n\n> jconsole æ¯ JDK èªå¸¦ç GUI å·¥å·ãjconsole(Java Monitoring and Management Console) æ¯ä¸ç§åºäº JMX çå¯è§åçè§ä¸ç®¡çå·¥å·ã\n> \n> jconsole çç®¡çåè½æ¯éå¯¹ JMX MBean è¿è¡ç®¡çï¼ç±äº MBean å¯ä»¥ä½¿ç¨ä»£ç ãä¸­é´ä»¶æå¡å¨çç®¡çæ§å¶å°æææç¬¦å JMX è§èçè½¯ä»¶è¿è¡è®¿é®ã\n\næ³¨æï¼ä½¿ç¨ jconsole çåææ¯ Java åºç¨å¼å¯ JMXã\n\n\n# å¼å¯ JMX\n\nJava åºç¨å¼å¯ JMX åï¼å¯ä»¥ä½¿ç¨ jconsole æ jvisualvm è¿è¡çæ§ Java ç¨åºçåºæ¬ä¿¡æ¯åè¿è¡æåµã\n\nå¼å¯æ¹æ³æ¯ï¼å¨ java æä»¤åï¼æ·»å ä»¥ä¸åæ°ï¼\n\n-Dcom.sun.management.jmxremote=true\n-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.authenticate=false\n-Djava.rmi.server.hostname=127.0.0.1\n-Dcom.sun.management.jmxremote.port=18888\n\n\n * -Djava.rmi.server.hostname - æå® Java ç¨åºè¿è¡çæå¡å¨\n * -Dcom.sun.management.jmxremote.port - æå® JMX æå¡çå¬ç«¯å£\n\n\n# è¿æ¥ jconsole\n\nå¦ææ¯æ¬å° Java è¿ç¨ï¼jconsole å¯ä»¥ç´æ¥ç»å®è¿æ¥ã\n\nå¦ææ¯è¿ç¨ Java è¿ç¨ï¼éè¦è¿æ¥ Java è¿ç¨ç JMX ç«¯å£ã\n\n\n\n\n# jconsole çé¢\n\nè¿å¥ jconsole åºç¨åï¼å¯ä»¥çå°ä»¥ä¸ tab é¡µé¢ã\n\n * æ¦è¿° - æ¾ç¤ºæå³ Java VM åçè§å¼çæ¦è¿°ä¿¡æ¯ã\n * åå­ - æ¾ç¤ºæå³åå­ä½¿ç¨çä¿¡æ¯ãåå­é¡µç¸å½äºå¯è§åç jstat å½ä»¤ã\n * çº¿ç¨ - æ¾ç¤ºæå³çº¿ç¨ä½¿ç¨çä¿¡æ¯ã\n * ç±» - æ¾ç¤ºæå³ç±»å è½½çä¿¡æ¯ã\n * VM æè¦ - æ¾ç¤ºæå³ Java VM çä¿¡æ¯ã\n * MBean - æ¾ç¤ºæå³ MBean çä¿¡æ¯ã\n\n\n\n\n# jvisualvm\n\n> jvisualvm æ¯ JDK èªå¸¦ç GUI å·¥å·ãjvisualvm(All-In-One Java Troubleshooting Tool) æ¯å¤åä¸æéå¤çå·¥å·ãå®æ¯æè¿è¡çè§ãæéå¤çãæ§è½åæç­åè½ã\n\nä¸ªäººè§å¾ jvisualvm æ¯ jconsole å¥½ç¨ã\n\n\n# jvisualvm æ¦è¿°é¡µé¢\n\njvisualvm æ¦è¿°é¡µé¢å¯ä»¥æ¥çå½å Java è¿ç¨çåºæ¬ä¿¡æ¯ï¼å¦ï¼JDK çæ¬ãJava è¿ç¨ãJVM åæ°ç­ã\n\n\n\n\n# jvisualvm çæ§é¡µé¢\n\nå¨ jvisualvm çæ§é¡µé¢ï¼å¯ä»¥çå° Java è¿ç¨ç CPUãåå­ãç±»å è½½ãçº¿ç¨çå®æ¶ååã\n\n\n\n\n# jvisualvm çº¿ç¨é¡µé¢\n\njvisualvm çº¿ç¨é¡µé¢å±ç¤ºäºå½åççº¿ç¨ç¶æã\n\n\n\njvisualvm è¿å¯ä»¥çæçº¿ç¨ Dump æä»¶ï¼å¸®å©è¿ä¸æ­¥åæçº¿ç¨æ ä¿¡æ¯ã\n\n\n\n\n# jvisualvm æ½æ ·å¨é¡µé¢\n\njvisualvm å¯ä»¥å¯¹ CPUãåå­è¿è¡æ½æ ·ï¼å¸®å©æä»¬è¿è¡æ§è½åæã\n\n\n\n\n# MAT\n\nMAT å³ Eclipse Memory Analyzer Tool çç¼©åã\n\nMAT æ¬èº«ä¹è½å¤è·åå çäºè¿å¶å¿«ç§ãè¯¥åè½å°åå© jps ååºå½åæ­£å¨è¿è¡ç Java è¿ç¨ï¼ä»¥ä¾éæ©å¹¶è·åå¿«ç§ãç±äº jps ä¼å°èªå·±åå¥å¶ä¸­ï¼å æ­¤ä½ ä¼å¨åè¡¨ä¸­åç°ä¸ä¸ªå·²ç»ç»æè¿è¡ç jps è¿ç¨ã\n\nMAT å¯ä»¥ç¬ç«å®è£ï¼å®æ¹ä¸è½½å°åï¼ï¼ä¹å¯ä»¥ä½ä¸º Eclipse IDE çæä»¶å®è£ã\n\n\n# MAT éç½®\n\nMAT è§£ååï¼å®è£ç®å½ä¸æä¸ª MemoryAnalyzer.ini æä»¶ã\n\nMemoryAnalyzer.ini ä¸­æä¸ªéè¦çåæ° Xmx è¡¨ç¤ºæå¤§åå­ï¼é»è®¤ä¸ºï¼-vmargs -Xmx1024m\n\nå¦æè¯å¾ç¨ MAT å¯¼å¥ç dump æä»¶è¶è¿ 1024 Mï¼ä¼æ¥éï¼\n\nAn internal error occurred during: "Parsing heap dump from XXX"\n\n\næ­¤æ¶ï¼å¯ä»¥éå½è°æ´ Xmx å¤§å°ãå¦æè®¾ç½®ç Xmx æ°å¼è¿å¤§ï¼æ¬æºåå­ä¸è¶³ä»¥æ¯æï¼å¯å¨ MAT ä¼æ¥éï¼\n\nFailed to create the Java Virtual Machine\n\n\n\n# MAT åæ\n\n\n\nç¹å» Leak Suspects å¯ä»¥è¿å¥åå­æ³æ¼é¡µé¢ã\n\nï¼1ï¼é¦åï¼å¯ä»¥æ¥çé¥¼å¾äºè§£åå­çæ´ä½æ¶èæåµ\n\n\n\nï¼2ï¼ç¼©å°èå´ï¼å¯»æ¾é®é¢çä¼¼ç¹\n\n\n\nå¯ä»¥ç¹å»è¿å¥è¯¦æé¡µé¢ï¼å¨è¯¦æé¡µé¢ Shortest Paths To the Accumulation Point è¡¨ç¤º GC root å°åå­æ¶èèéç¹çæç­è·¯å¾ï¼å¦ææä¸ªåå­æ¶èèéç¹æè·¯å¾å°è¾¾ GC rootï¼åè¯¥åå­æ¶èèéç¹ä¸ä¼è¢«å½ååå¾è¢«åæ¶ã\n\nä¸ºäºæ¾å°åå­æ³é²ï¼æè·åäºä¸¤ä¸ªå è½¬å¨æä»¶ï¼ä¸¤ä¸ªæä»¶è·åæ¶é´é´éæ¯ä¸å¤©ï¼å ä¸ºåå­åªæ¯å°å¹åº¦å¢é¿ï¼ç­æ¶é´å¾é¾åç°é®é¢ï¼ãå¯¹æ¯ä¸¤ä¸ªæä»¶çå¯¹è±¡ï¼éè¿å¯¹æ¯åçç»æå¯ä»¥å¾æ¹ä¾¿å®ä½åå­æ³é²ã\n\nMAT åæ¶æå¼ä¸¤ä¸ªå è½¬å¨æä»¶ï¼åå«æå¼ Histogramï¼å¦ä¸å¾ãå¨ä¸å¾ä¸­æ¹æ¡ 1 æé®ç¨äºå¯¹æ¯ä¸¤ä¸ª Histogramï¼å¯¹æ¯åå¨æ¹æ¡ 2 å¤éæ© Group By packageï¼ç¶åå¯¹æ¯åå¯¹è±¡çååãä¸é¾åç° heap3.hprof æ¯ heap6.hprof å°äº 64 ä¸ª eventInfo å¯¹è±¡ï¼å¦æå¯¹ä»£ç æ¯è¾çæçè¯æ³å¿è¿æ ·ä¸ä¸ªç»ææ¯è½å¤ç»ç¨åºåä¸å®çå¯ç¤ºçãèæä¹æ¯æ ¹æ®è¿ä¸ªå¯ç¤ºå·®æ¾å°äºæç»åå­æ³é²çä½ç½®ã\n\n\n# JProfile\n\nJProfiler æ¯ä¸æ¬¾æ§è½åæå·¥å·ã\n\nç±äºå®æ¯æ¶è´¹çï¼æä»¥ææ¬äººä½¿ç¨è¾å°ãä½æ¯ï¼å®ç¡®å®åè½å¼ºå¤§ï¼ä¸æ¹ä¾¿ä½¿ç¨ï¼è¿å¯ä»¥å Intellij Idea éæã\n\n\n\n\n# Arthas\n\nArthas æ¯ Alibaba å¼æºç Java è¯æ­å·¥å·ï¼æ·±åå¼åèåç±ãå¨çº¿ææ¥é®é¢ï¼æ ééå¯ï¼å¨æè·è¸ª Java ä»£ç ï¼å®æ¶çæ§ JVM ç¶æã\n\nArthas æ¯æ JDK 6+ï¼æ¯æ Linux/Mac/Windowsï¼éç¨å½ä»¤è¡äº¤äºæ¨¡å¼ï¼åæ¶æä¾ä¸°å¯ç Tab èªå¨è¡¥å¨åè½ï¼è¿ä¸æ­¥æ¹ä¾¿è¿è¡é®é¢çå®ä½åè¯æ­ã\n\n\n\n\n# Arthas åºç¡å½ä»¤\n\n * helpââæ¥çå½ä»¤å¸®å©ä¿¡æ¯\n * catââæå°æä»¶åå®¹ï¼å linux éç cat å½ä»¤ç±»ä¼¼\n * echoâæå°åæ°ï¼å linux éç echo å½ä»¤ç±»ä¼¼\n * grepââå¹éæ¥æ¾ï¼å linux éç grep å½ä»¤ç±»ä¼¼\n * teeââå¤å¶æ åè¾å¥å°æ åè¾åºåæå®çæä»¶ï¼å linux éç tee å½ä»¤ç±»ä¼¼\n * pwdââè¿åå½åçå·¥ä½ç®å½ï¼å linux å½ä»¤ç±»ä¼¼\n * clsââæ¸ç©ºå½åå±å¹åºå\n * sessionââæ¥çå½åä¼è¯çä¿¡æ¯\n * resetââéç½®å¢å¼ºç±»ï¼å°è¢« Arthas å¢å¼ºè¿çç±»å¨é¨è¿åï¼Arthas æå¡ç«¯å³é­æ¶ä¼éç½®ææå¢å¼ºè¿çç±»\n * versionââè¾åºå½åç®æ  Java è¿ç¨æå è½½ç Arthas çæ¬å·\n * historyââæå°å½ä»¤åå²\n * quitââéåºå½å Arthas å®¢æ·ç«¯ï¼å¶ä» Arthas å®¢æ·ç«¯ä¸åå½±å\n * stopââå³é­ Arthas æå¡ç«¯ï¼ææ Arthas å®¢æ·ç«¯å¨é¨éåº\n * keymapââArthas å¿«æ·é®åè¡¨åèªå®ä¹å¿«æ·é®\n\n\n# Arthas jvm ç¸å³å½ä»¤\n\n * dashboardââå½åç³»ç»çå®æ¶æ°æ®é¢æ¿\n * threadââæ¥çå½å JVM ççº¿ç¨å æ ä¿¡æ¯\n * jvmââæ¥çå½å JVM çä¿¡æ¯\n * syspropââæ¥çåä¿®æ¹ JVM çç³»ç»å±æ§\n * sysenvââæ¥ç JVM çç¯å¢åé\n * vmoptionââæ¥çåä¿®æ¹ JVM éè¯æ­ç¸å³ç option\n * perfcounterââæ¥çå½å JVM ç Perf Counter ä¿¡æ¯\n * loggerââæ¥çåä¿®æ¹ logger\n * getstaticââæ¥çç±»çéæå±æ§\n * ognlââæ§è¡ ognl è¡¨è¾¾å¼\n * mbeanââæ¥ç Mbean çä¿¡æ¯\n * heapdumpââdump java heap, ç±»ä¼¼ jmap å½ä»¤ç heap dump åè½\n\n\n# Arthas class/classloader ç¸å³å½ä»¤\n\n * scââæ¥ç JVM å·²å è½½çç±»ä¿¡æ¯\n * smââæ¥çå·²å è½½ç±»çæ¹æ³ä¿¡æ¯\n * jadââåç¼è¯æå®å·²å è½½ç±»çæºç \n * mcââåå­ç¼è¯å¨ï¼åå­ç¼è¯.javaæä»¶ä¸º.classæä»¶\n * redefineââå è½½å¤é¨ç.classæä»¶ï¼redefine å° JVM é\n * dumpââdump å·²å è½½ç±»ç byte code å°ç¹å®ç®å½\n * classloaderââæ¥ç classloader çç»§æ¿æ ï¼urlsï¼ç±»å è½½ä¿¡æ¯ï¼ä½¿ç¨ classloader å» getResource\n\n\n# Arthas monitor/watch/trace ç¸å³å½ä»¤\n\n> è¯·æ³¨æï¼è¿äºå½ä»¤ï¼é½éè¿å­èç å¢å¼ºææ¯æ¥å®ç°çï¼ä¼å¨æå®ç±»çæ¹æ³ä¸­æå¥ä¸äºåé¢æ¥å®ç°æ°æ®ç»è®¡åè§æµï¼å æ­¤å¨çº¿ä¸ãé¢åä½¿ç¨æ¶ï¼è¯·å°½éæç¡®éè¦è§æµçç±»ãæ¹æ³ä»¥åæ¡ä»¶ï¼è¯æ­ç»æè¦æ§è¡ stop æå°å¢å¼ºè¿çç±»æ§è¡ reset å½ä»¤ã\n\n * monitorââæ¹æ³æ§è¡çæ§\n * watchââæ¹æ³æ§è¡æ°æ®è§æµ\n * traceââæ¹æ³åé¨è°ç¨è·¯å¾ï¼å¹¶è¾åºæ¹æ³è·¯å¾ä¸çæ¯ä¸ªèç¹ä¸èæ¶\n * stackââè¾åºå½åæ¹æ³è¢«è°ç¨çè°ç¨è·¯å¾\n * ttââæ¹æ³æ§è¡æ°æ®çæ¶ç©ºé§éï¼è®°å½ä¸æå®æ¹æ³æ¯æ¬¡è°ç¨çå¥ååè¿åä¿¡æ¯ï¼å¹¶è½å¯¹è¿äºä¸åçæ¶é´ä¸è°ç¨è¿è¡è§æµ\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava æ§è½è°ä¼å®æã\n * jconsole å®æ¹ææ¡£\n * jconsole å·¥å·ä½¿ç¨\n * jvisualvm å®æ¹ææ¡£\n * Java jvisualvm ç®è¦è¯´æ\n * å©ç¨åå­åæå·¥å·ï¼Memory Analyzer Toolï¼MATï¼åæ java é¡¹ç®åå­æ³é²',normalizedContent:'# jvm gui å·¥å·\n\n> java ç¨åºååä¸äºæéææ¥å·¥ä½ï¼æä»¥ç»å¸¸éè¦ä½¿ç¨ä¸äº jvm å·¥å·ã\n> \n> æ¬æç³»ç»æ§çä»ç»ä¸ä¸å¸¸ç¨ç jvm gui å·¥å·ã\n\n\n# jconsole\n\n> jconsole æ¯ jdk èªå¸¦ç gui å·¥å·ãjconsole(java monitoring and management console) æ¯ä¸ç§åºäº jmx çå¯è§åçè§ä¸ç®¡çå·¥å·ã\n> \n> jconsole çç®¡çåè½æ¯éå¯¹ jmx mbean è¿è¡ç®¡çï¼ç±äº mbean å¯ä»¥ä½¿ç¨ä»£ç ãä¸­é´ä»¶æå¡å¨çç®¡çæ§å¶å°æææç¬¦å jmx è§èçè½¯ä»¶è¿è¡è®¿é®ã\n\næ³¨æï¼ä½¿ç¨ jconsole çåææ¯ java åºç¨å¼å¯ jmxã\n\n\n# å¼å¯ jmx\n\njava åºç¨å¼å¯ jmx åï¼å¯ä»¥ä½¿ç¨ jconsole æ jvisualvm è¿è¡çæ§ java ç¨åºçåºæ¬ä¿¡æ¯åè¿è¡æåµã\n\nå¼å¯æ¹æ³æ¯ï¼å¨ java æä»¤åï¼æ·»å ä»¥ä¸åæ°ï¼\n\n-dcom.sun.management.jmxremote=true\n-dcom.sun.management.jmxremote.ssl=false\n-dcom.sun.management.jmxremote.authenticate=false\n-djava.rmi.server.hostname=127.0.0.1\n-dcom.sun.management.jmxremote.port=18888\n\n\n * -djava.rmi.server.hostname - æå® java ç¨åºè¿è¡çæå¡å¨\n * -dcom.sun.management.jmxremote.port - æå® jmx æå¡çå¬ç«¯å£\n\n\n# è¿æ¥ jconsole\n\nå¦ææ¯æ¬å° java è¿ç¨ï¼jconsole å¯ä»¥ç´æ¥ç»å®è¿æ¥ã\n\nå¦ææ¯è¿ç¨ java è¿ç¨ï¼éè¦è¿æ¥ java è¿ç¨ç jmx ç«¯å£ã\n\n\n\n\n# jconsole çé¢\n\nè¿å¥ jconsole åºç¨åï¼å¯ä»¥çå°ä»¥ä¸ tab é¡µé¢ã\n\n * æ¦è¿° - æ¾ç¤ºæå³ java vm åçè§å¼çæ¦è¿°ä¿¡æ¯ã\n * åå­ - æ¾ç¤ºæå³åå­ä½¿ç¨çä¿¡æ¯ãåå­é¡µç¸å½äºå¯è§åç jstat å½ä»¤ã\n * çº¿ç¨ - æ¾ç¤ºæå³çº¿ç¨ä½¿ç¨çä¿¡æ¯ã\n * ç±» - æ¾ç¤ºæå³ç±»å è½½çä¿¡æ¯ã\n * vm æè¦ - æ¾ç¤ºæå³ java vm çä¿¡æ¯ã\n * mbean - æ¾ç¤ºæå³ mbean çä¿¡æ¯ã\n\n\n\n\n# jvisualvm\n\n> jvisualvm æ¯ jdk èªå¸¦ç gui å·¥å·ãjvisualvm(all-in-one java troubleshooting tool) æ¯å¤åä¸æéå¤çå·¥å·ãå®æ¯æè¿è¡çè§ãæéå¤çãæ§è½åæç­åè½ã\n\nä¸ªäººè§å¾ jvisualvm æ¯ jconsole å¥½ç¨ã\n\n\n# jvisualvm æ¦è¿°é¡µé¢\n\njvisualvm æ¦è¿°é¡µé¢å¯ä»¥æ¥çå½å java è¿ç¨çåºæ¬ä¿¡æ¯ï¼å¦ï¼jdk çæ¬ãjava è¿ç¨ãjvm åæ°ç­ã\n\n\n\n\n# jvisualvm çæ§é¡µé¢\n\nå¨ jvisualvm çæ§é¡µé¢ï¼å¯ä»¥çå° java è¿ç¨ç cpuãåå­ãç±»å è½½ãçº¿ç¨çå®æ¶ååã\n\n\n\n\n# jvisualvm çº¿ç¨é¡µé¢\n\njvisualvm çº¿ç¨é¡µé¢å±ç¤ºäºå½åççº¿ç¨ç¶æã\n\n\n\njvisualvm è¿å¯ä»¥çæçº¿ç¨ dump æä»¶ï¼å¸®å©è¿ä¸æ­¥åæçº¿ç¨æ ä¿¡æ¯ã\n\n\n\n\n# jvisualvm æ½æ ·å¨é¡µé¢\n\njvisualvm å¯ä»¥å¯¹ cpuãåå­è¿è¡æ½æ ·ï¼å¸®å©æä»¬è¿è¡æ§è½åæã\n\n\n\n\n# mat\n\nmat å³ eclipse memory analyzer tool çç¼©åã\n\nmat æ¬èº«ä¹è½å¤è·åå çäºè¿å¶å¿«ç§ãè¯¥åè½å°åå© jps ååºå½åæ­£å¨è¿è¡ç java è¿ç¨ï¼ä»¥ä¾éæ©å¹¶è·åå¿«ç§ãç±äº jps ä¼å°èªå·±åå¥å¶ä¸­ï¼å æ­¤ä½ ä¼å¨åè¡¨ä¸­åç°ä¸ä¸ªå·²ç»ç»æè¿è¡ç jps è¿ç¨ã\n\nmat å¯ä»¥ç¬ç«å®è£ï¼å®æ¹ä¸è½½å°åï¼ï¼ä¹å¯ä»¥ä½ä¸º eclipse ide çæä»¶å®è£ã\n\n\n# mat éç½®\n\nmat è§£ååï¼å®è£ç®å½ä¸æä¸ª memoryanalyzer.ini æä»¶ã\n\nmemoryanalyzer.ini ä¸­æä¸ªéè¦çåæ° xmx è¡¨ç¤ºæå¤§åå­ï¼é»è®¤ä¸ºï¼-vmargs -xmx1024m\n\nå¦æè¯å¾ç¨ mat å¯¼å¥ç dump æä»¶è¶è¿ 1024 mï¼ä¼æ¥éï¼\n\nan internal error occurred during: "parsing heap dump from xxx"\n\n\næ­¤æ¶ï¼å¯ä»¥éå½è°æ´ xmx å¤§å°ãå¦æè®¾ç½®ç xmx æ°å¼è¿å¤§ï¼æ¬æºåå­ä¸è¶³ä»¥æ¯æï¼å¯å¨ mat ä¼æ¥éï¼\n\nfailed to create the java virtual machine\n\n\n\n# mat åæ\n\n\n\nç¹å» leak suspects å¯ä»¥è¿å¥åå­æ³æ¼é¡µé¢ã\n\nï¼1ï¼é¦åï¼å¯ä»¥æ¥çé¥¼å¾äºè§£åå­çæ´ä½æ¶èæåµ\n\n\n\nï¼2ï¼ç¼©å°èå´ï¼å¯»æ¾é®é¢çä¼¼ç¹\n\n\n\nå¯ä»¥ç¹å»è¿å¥è¯¦æé¡µé¢ï¼å¨è¯¦æé¡µé¢ shortest paths to the accumulation point è¡¨ç¤º gc root å°åå­æ¶èèéç¹çæç­è·¯å¾ï¼å¦ææä¸ªåå­æ¶èèéç¹æè·¯å¾å°è¾¾ gc rootï¼åè¯¥åå­æ¶èèéç¹ä¸ä¼è¢«å½ååå¾è¢«åæ¶ã\n\nä¸ºäºæ¾å°åå­æ³é²ï¼æè·åäºä¸¤ä¸ªå è½¬å¨æä»¶ï¼ä¸¤ä¸ªæä»¶è·åæ¶é´é´éæ¯ä¸å¤©ï¼å ä¸ºåå­åªæ¯å°å¹åº¦å¢é¿ï¼ç­æ¶é´å¾é¾åç°é®é¢ï¼ãå¯¹æ¯ä¸¤ä¸ªæä»¶çå¯¹è±¡ï¼éè¿å¯¹æ¯åçç»æå¯ä»¥å¾æ¹ä¾¿å®ä½åå­æ³é²ã\n\nmat åæ¶æå¼ä¸¤ä¸ªå è½¬å¨æä»¶ï¼åå«æå¼ histogramï¼å¦ä¸å¾ãå¨ä¸å¾ä¸­æ¹æ¡ 1 æé®ç¨äºå¯¹æ¯ä¸¤ä¸ª histogramï¼å¯¹æ¯åå¨æ¹æ¡ 2 å¤éæ© group by packageï¼ç¶åå¯¹æ¯åå¯¹è±¡çååãä¸é¾åç° heap3.hprof æ¯ heap6.hprof å°äº 64 ä¸ª eventinfo å¯¹è±¡ï¼å¦æå¯¹ä»£ç æ¯è¾çæçè¯æ³å¿è¿æ ·ä¸ä¸ªç»ææ¯è½å¤ç»ç¨åºåä¸å®çå¯ç¤ºçãèæä¹æ¯æ ¹æ®è¿ä¸ªå¯ç¤ºå·®æ¾å°äºæç»åå­æ³é²çä½ç½®ã\n\n\n# jprofile\n\njprofiler æ¯ä¸æ¬¾æ§è½åæå·¥å·ã\n\nç±äºå®æ¯æ¶è´¹çï¼æä»¥ææ¬äººä½¿ç¨è¾å°ãä½æ¯ï¼å®ç¡®å®åè½å¼ºå¤§ï¼ä¸æ¹ä¾¿ä½¿ç¨ï¼è¿å¯ä»¥å intellij idea éæã\n\n\n\n\n# arthas\n\narthas æ¯ alibaba å¼æºç java è¯æ­å·¥å·ï¼æ·±åå¼åèåç±ãå¨çº¿ææ¥é®é¢ï¼æ ééå¯ï¼å¨æè·è¸ª java ä»£ç ï¼å®æ¶çæ§ jvm ç¶æã\n\narthas æ¯æ jdk 6+ï¼æ¯æ linux/mac/windowsï¼éç¨å½ä»¤è¡äº¤äºæ¨¡å¼ï¼åæ¶æä¾ä¸°å¯ç tab èªå¨è¡¥å¨åè½ï¼è¿ä¸æ­¥æ¹ä¾¿è¿è¡é®é¢çå®ä½åè¯æ­ã\n\n\n\n\n# arthas åºç¡å½ä»¤\n\n * helpââæ¥çå½ä»¤å¸®å©ä¿¡æ¯\n * catââæå°æä»¶åå®¹ï¼å linux éç cat å½ä»¤ç±»ä¼¼\n * echoâæå°åæ°ï¼å linux éç echo å½ä»¤ç±»ä¼¼\n * grepââå¹éæ¥æ¾ï¼å linux éç grep å½ä»¤ç±»ä¼¼\n * teeââå¤å¶æ åè¾å¥å°æ åè¾åºåæå®çæä»¶ï¼å linux éç tee å½ä»¤ç±»ä¼¼\n * pwdââè¿åå½åçå·¥ä½ç®å½ï¼å linux å½ä»¤ç±»ä¼¼\n * clsââæ¸ç©ºå½åå±å¹åºå\n * sessionââæ¥çå½åä¼è¯çä¿¡æ¯\n * resetââéç½®å¢å¼ºç±»ï¼å°è¢« arthas å¢å¼ºè¿çç±»å¨é¨è¿åï¼arthas æå¡ç«¯å³é­æ¶ä¼éç½®ææå¢å¼ºè¿çç±»\n * versionââè¾åºå½åç®æ  java è¿ç¨æå è½½ç arthas çæ¬å·\n * historyââæå°å½ä»¤åå²\n * quitââéåºå½å arthas å®¢æ·ç«¯ï¼å¶ä» arthas å®¢æ·ç«¯ä¸åå½±å\n * stopââå³é­ arthas æå¡ç«¯ï¼ææ arthas å®¢æ·ç«¯å¨é¨éåº\n * keymapââarthas å¿«æ·é®åè¡¨åèªå®ä¹å¿«æ·é®\n\n\n# arthas jvm ç¸å³å½ä»¤\n\n * dashboardââå½åç³»ç»çå®æ¶æ°æ®é¢æ¿\n * threadââæ¥çå½å jvm ççº¿ç¨å æ ä¿¡æ¯\n * jvmââæ¥çå½å jvm çä¿¡æ¯\n * syspropââæ¥çåä¿®æ¹ jvm çç³»ç»å±æ§\n * sysenvââæ¥ç jvm çç¯å¢åé\n * vmoptionââæ¥çåä¿®æ¹ jvm éè¯æ­ç¸å³ç option\n * perfcounterââæ¥çå½å jvm ç perf counter ä¿¡æ¯\n * loggerââæ¥çåä¿®æ¹ logger\n * getstaticââæ¥çç±»çéæå±æ§\n * ognlââæ§è¡ ognl è¡¨è¾¾å¼\n * mbeanââæ¥ç mbean çä¿¡æ¯\n * heapdumpââdump java heap, ç±»ä¼¼ jmap å½ä»¤ç heap dump åè½\n\n\n# arthas class/classloader ç¸å³å½ä»¤\n\n * scââæ¥ç jvm å·²å è½½çç±»ä¿¡æ¯\n * smââæ¥çå·²å è½½ç±»çæ¹æ³ä¿¡æ¯\n * jadââåç¼è¯æå®å·²å è½½ç±»çæºç \n * mcââåå­ç¼è¯å¨ï¼åå­ç¼è¯.javaæä»¶ä¸º.classæä»¶\n * redefineââå è½½å¤é¨ç.classæä»¶ï¼redefine å° jvm é\n * dumpââdump å·²å è½½ç±»ç byte code å°ç¹å®ç®å½\n * classloaderââæ¥ç classloader çç»§æ¿æ ï¼urlsï¼ç±»å è½½ä¿¡æ¯ï¼ä½¿ç¨ classloader å» getresource\n\n\n# arthas monitor/watch/trace ç¸å³å½ä»¤\n\n> è¯·æ³¨æï¼è¿äºå½ä»¤ï¼é½éè¿å­èç å¢å¼ºææ¯æ¥å®ç°çï¼ä¼å¨æå®ç±»çæ¹æ³ä¸­æå¥ä¸äºåé¢æ¥å®ç°æ°æ®ç»è®¡åè§æµï¼å æ­¤å¨çº¿ä¸ãé¢åä½¿ç¨æ¶ï¼è¯·å°½éæç¡®éè¦è§æµçç±»ãæ¹æ³ä»¥åæ¡ä»¶ï¼è¯æ­ç»æè¦æ§è¡ stop æå°å¢å¼ºè¿çç±»æ§è¡ reset å½ä»¤ã\n\n * monitorââæ¹æ³æ§è¡çæ§\n * watchââæ¹æ³æ§è¡æ°æ®è§æµ\n * traceââæ¹æ³åé¨è°ç¨è·¯å¾ï¼å¹¶è¾åºæ¹æ³è·¯å¾ä¸çæ¯ä¸ªèç¹ä¸èæ¶\n * stackââè¾åºå½åæ¹æ³è¢«è°ç¨çè°ç¨è·¯å¾\n * ttââæ¹æ³æ§è¡æ°æ®çæ¶ç©ºé§éï¼è®°å½ä¸æå®æ¹æ³æ¯æ¬¡è°ç¨çå¥ååè¿åä¿¡æ¯ï¼å¹¶è½å¯¹è¿äºä¸åçæ¶é´ä¸è°ç¨è¿è¡è§æµ\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * ãjava æ§è½è°ä¼å®æã\n * jconsole å®æ¹ææ¡£\n * jconsole å·¥å·ä½¿ç¨\n * jvisualvm å®æ¹ææ¡£\n * java jvisualvm ç®è¦è¯´æ\n * å©ç¨åå­åæå·¥å·ï¼memory analyzer toolï¼matï¼åæ java é¡¹ç®åå­æ³é²',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JVM å®æ",frontmatter:{title:"JVM å®æ",date:"2019-10-28T22:04:39.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM"],permalink:"/pages/9cb60a/"},regularPath:"/01.Java/01.JavaSE/06.JVM/21.JVM%E5%AE%9E%E6%88%98.html",relativePath:"01.Java/01.JavaSE/06.JVM/21.JVMå®æ.md",key:"v-2ecce247",path:"/pages/9cb60a/",headers:[{level:2,title:"JVM è°ä¼æ¦è¿°",slug:"jvm-è°ä¼æ¦è¿°",normalizedTitle:"jvm è°ä¼æ¦è¿°",charIndex:13},{level:3,title:"GC æ§è½ææ ",slug:"gc-æ§è½ææ ",normalizedTitle:"gc æ§è½ææ ",charIndex:26},{level:3,title:"è°ä¼åå",slug:"è°ä¼åå",normalizedTitle:"è°ä¼åå",charIndex:387},{level:4,title:"éä½ Minor GC é¢ç",slug:"éä½-minor-gc-é¢ç",normalizedTitle:"éä½ minor gc é¢ç",charIndex:535},{level:4,title:"éä½ Full GC çé¢ç",slug:"éä½-full-gc-çé¢ç",normalizedTitle:"éä½ full gc çé¢ç",charIndex:409},{level:4,title:"éä½ Full GC çæ¶é´",slug:"éä½-full-gc-çæ¶é´",normalizedTitle:"éä½ full gc çæ¶é´",charIndex:1598},{level:3,title:"GC ä¼åçè¿ç¨",slug:"gc-ä¼åçè¿ç¨",normalizedTitle:"gc ä¼åçè¿ç¨",charIndex:2298},{level:4,title:"ï¼1ï¼çæ§ GC ç¶æ",slug:"_1-çæ§-gc-ç¶æ",normalizedTitle:"ï¼1ï¼çæ§ gc ç¶æ",charIndex:2330},{level:4,title:"ï¼2ï¼åæ GC æ¥å¿",slug:"_2-åæ-gc-æ¥å¿",normalizedTitle:"ï¼2ï¼åæ gc æ¥å¿",charIndex:2376},{level:4,title:"ï¼3ï¼éæ©åé GC åæ¶å¨",slug:"_3-éæ©åé-gc-åæ¶å¨",normalizedTitle:"ï¼3ï¼éæ©åé gc åæ¶å¨",charIndex:2857},{level:4,title:"ï¼4ï¼åæç»æ",slug:"_4-åæç»æ",normalizedTitle:"ï¼4ï¼åæç»æ",charIndex:2973},{level:4,title:"ï¼5ï¼åºç¨ä¼åéç½®",slug:"_5-åºç¨ä¼åéç½®",normalizedTitle:"ï¼5ï¼åºç¨ä¼åéç½®",charIndex:3110},{level:2,title:"GC æ¥å¿",slug:"gc-æ¥å¿",normalizedTitle:"gc æ¥å¿",charIndex:2382},{level:3,title:"è·å GC æ¥å¿",slug:"è·å-gc-æ¥å¿",normalizedTitle:"è·å gc æ¥å¿",charIndex:3206},{level:4,title:"jstat å½ä»¤æ¥ç GC",slug:"jstat-å½ä»¤æ¥ç-gc",normalizedTitle:"jstat å½ä»¤æ¥ç gc",charIndex:3276},{level:4,title:"æå° GC çåæ°",slug:"æå°-gc-çåæ°",normalizedTitle:"æå° gc çåæ°",charIndex:3672},{level:3,title:"åæ GC æ¥å¿",slug:"åæ-gc-æ¥å¿",normalizedTitle:"åæ gc æ¥å¿",charIndex:2379},{level:4,title:"CPU è¿é«",slug:"cpu-è¿é«",normalizedTitle:"cpu è¿é«",charIndex:6062},{level:2,title:"GC éç½®",slug:"gc-éç½®",normalizedTitle:"gc éç½®",charIndex:10821},{level:3,title:"å å¤§å°è®¾ç½®",slug:"å å¤§å°è®¾ç½®",normalizedTitle:"å å¤§å°è®¾ç½®",charIndex:10882},{level:3,title:"JVM åå­éç½®",slug:"jvm-åå­éç½®",normalizedTitle:"jvm åå­éç½®",charIndex:11097},{level:3,title:"GC ç±»åéç½®",slug:"gc-ç±»åéç½®",normalizedTitle:"gc ç±»åéç½®",charIndex:11541},{level:3,title:"åå¾åæ¶å¨éç¨åæ°",slug:"åå¾åæ¶å¨éç¨åæ°",normalizedTitle:"åå¾åæ¶å¨éç¨åæ°",charIndex:11974},{level:3,title:"JMX",slug:"jmx",normalizedTitle:"jmx",charIndex:12219},{level:3,title:"è¿ç¨ DEBUG",slug:"è¿ç¨-debug",normalizedTitle:"è¿ç¨ debug",charIndex:12586},{level:3,title:"HeapDump",slug:"heapdump",normalizedTitle:"heapdump",charIndex:12766},{level:3,title:"è¾å©éç½®",slug:"è¾å©éç½®",normalizedTitle:"è¾å©éç½®",charIndex:12844},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:13027}],headersStr:"JVM è°ä¼æ¦è¿° GC æ§è½ææ  è°ä¼åå éä½ Minor GC é¢ç éä½ Full GC çé¢ç éä½ Full GC çæ¶é´ GC ä¼åçè¿ç¨ ï¼1ï¼çæ§ GC ç¶æ ï¼2ï¼åæ GC æ¥å¿ ï¼3ï¼éæ©åé GC åæ¶å¨ ï¼4ï¼åæç»æ ï¼5ï¼åºç¨ä¼åéç½® GC æ¥å¿ è·å GC æ¥å¿ jstat å½ä»¤æ¥ç GC æå° GC çåæ° åæ GC æ¥å¿ CPU è¿é« GC éç½® å å¤§å°è®¾ç½® JVM åå­éç½® GC ç±»åéç½® åå¾åæ¶å¨éç¨åæ° JMX è¿ç¨ DEBUG HeapDump è¾å©éç½® åèèµæ",content:'# JVM å®æ\n\n\n# JVM è°ä¼æ¦è¿°\n\n\n# GC æ§è½ææ \n\nå¯¹äº JVM è°ä¼æ¥è¯´ï¼éè¦åæç¡®è°ä¼çç®æ ã ä»æ§è½çè§åº¦çï¼éå¸¸å³æ³¨ä¸ä¸ªææ ï¼\n\n * ååéï¼throughputï¼ - æä¸èè GC å¼èµ·çåé¡¿æ¶é´æåå­æ¶èï¼åå¾æ¶éå¨è½æ¯æåºç¨è¾¾å°çæé«æ§è½ææ ã\n * åé¡¿æ¶é´ï¼latencyï¼ - å¶åº¦éæ åæ¯ç¼©ç­ç±äºåå¾åæ¶éå¼èµ·çåé¡¿æ¶é´æèå®å¨æ¶é¤å åå¾æ¶éæå¼èµ·çåé¡¿ï¼é¿ååºç¨è¿è¡æ¶åçæå¨ã\n * åå¾åæ¶é¢ç - ä¹åçä¸æ¬¡æåå¾åæ¶å¢ï¼éå¸¸åå¾åæ¶çé¢çè¶ä½è¶å¥½ï¼å¢å¤§å åå­ç©ºé´å¯ä»¥ææéä½åå¾åæ¶åççé¢çï¼ä½åæ¶ä¹æå³çå ç§¯çåæ¶å¯¹è±¡è¶å¤ï¼æç»ä¹ä¼å¢å åæ¶æ¶çåé¡¿æ¶é´ãæä»¥æä»¬åªè¦éå½å°å¢å¤§å åå­ç©ºé´ï¼ä¿è¯æ­£å¸¸çåå¾åæ¶é¢çå³å¯ã\n\nå¤§å¤æ°æåµä¸è°ä¼ä¼ä¾§éäºå¶ä¸­ä¸ä¸ªæèä¸¤ä¸ªæ¹é¢çç®æ ï¼å¾å°ææåµå¯ä»¥å¼é¡¾ä¸ä¸ªä¸åçè§åº¦ã\n\n\n# è°ä¼åå\n\nGC ä¼åçä¸¤ä¸ªç®æ ï¼\n\n * éä½ Full GC çé¢ç\n * åå° Full GC çæ§è¡æ¶é´\n\nGC ä¼åçåºæ¬ååæ¯ï¼å°ä¸åç GC åæ°åºç¨å°ä¸¤ä¸ªåä»¥ä¸çæå¡å¨ä¸ç¶åæ¯è¾å®ä»¬çæ§è½ï¼ç¶åå°é£äºè¢«è¯æå¯ä»¥æé«æ§è½æåå° GC æ§è¡æ¶é´çåæ°åºç¨äºæç»çå·¥ä½æå¡å¨ä¸ã\n\n# éä½ Minor GC é¢ç\n\nå¦ææ°çä»£ç©ºé´è¾å°ï¼Eden åºå¾å¿«è¢«å¡«æ»¡ï¼å°±ä¼å¯¼è´é¢ç¹ Minor GCï¼å æ­¤æä»¬å¯ä»¥éè¿å¢å¤§æ°çä»£ç©ºé´æ¥éä½ Minor GC çé¢çã\n\nå¯è½ä½ ä¼æè¿æ ·ççé®ï¼æ©å®¹ Eden åºè½ç¶å¯ä»¥åå° Minor GC çæ¬¡æ°ï¼ä½ä¸ä¼å¢å åæ¬¡ Minor GC çæ¶é´åï¼å¦æåæ¬¡ Minor GC çæ¶é´å¢å ï¼é£ä¹å¾é¾è¾¾å°æä»¬æå¾çä¼åææåã\n\næä»¬ç¥éï¼åæ¬¡ Minor GC æ¶é´æ¯ç±ä¸¤é¨åç»æï¼T1ï¼æ«ææ°çä»£ï¼å T2ï¼å¤å¶å­æ´»å¯¹è±¡ï¼ãåè®¾ä¸ä¸ªå¯¹è±¡å¨ Eden åºçå­æ´»æ¶é´ä¸º 500msï¼Minor GC çæ¶é´é´éæ¯ 300msï¼é£ä¹æ­£å¸¸æåµä¸ï¼Minor GC çæ¶é´ä¸º ï¼T1+T2ã\n\nå½æä»¬å¢å¤§æ°çä»£ç©ºé´ï¼Minor GC çæ¶é´é´éå¯è½ä¼æ©å¤§å° 600msï¼æ­¤æ¶ä¸ä¸ªå­æ´» 500ms çå¯¹è±¡å°±ä¼å¨ Eden åºä¸­è¢«åæ¶æï¼æ­¤æ¶å°±ä¸å­å¨å¤å¶å­æ´»å¯¹è±¡äºï¼æä»¥ååç Minor GC çæ¶é´ä¸ºï¼ä¸¤æ¬¡æ«ææ°çä»£ï¼å³ 2T1ã\n\nå¯è§ï¼æ©å®¹åï¼Minor GC æ¶å¢å äº T1ï¼ä½çå»äº T2 çæ¶é´ãéå¸¸å¨èææºä¸­ï¼å¤å¶å¯¹è±¡çææ¬è¦è¿é«äºæ«æææ¬ã\n\nå¦æå¨å åå­ä¸­å­å¨è¾å¤çé¿æå­æ´»çå¯¹è±¡ï¼æ­¤æ¶å¢å å¹´è½»ä»£ç©ºé´ï¼åèä¼å¢å  Minor GC çæ¶é´ãå¦æå ä¸­çç­æå¯¹è±¡å¾å¤ï¼é£ä¹æ©å®¹æ°çä»£ï¼åæ¬¡ Minor GC æ¶é´ä¸ä¼æ¾èå¢å ãå æ­¤ï¼åæ¬¡ Minor GC æ¶é´æ´å¤åå³äº GC åå­æ´»å¯¹è±¡çæ°éï¼èé Eden åºçå¤§å°ã\n\n# éä½ Full GC çé¢ç\n\nFull GC ç¸å¯¹æ¥è¯´ä¼æ¯ Minor GC æ´èæ¶ãåå°è¿å¥èå¹´ä»£çå¯¹è±¡æ°éå¯ä»¥æ¾èéä½ Full GC çé¢çã\n\nåå°åå»ºå¤§å¯¹è±¡ï¼å¦æå¯¹è±¡å ç¨åå­è¿å¤§ï¼å¨ Eden åºè¢«åå»ºåä¼ç´æ¥è¢«ä¼ å¥èå¹´ä»£ãå¨å¹³å¸¸çä¸å¡åºæ¯ä¸­ï¼æä»¬ä¹ æ¯ä¸æ¬¡æ§ä»æ°æ®åºä¸­æ¥è¯¢åºä¸ä¸ªå¤§å¯¹è±¡ç¨äº web ç«¯æ¾ç¤ºãä¾å¦ï¼æä¹åç¢°å°è¿ä¸ä¸ªä¸æ¬¡æ§æ¥è¯¢åº 60 ä¸ªå­æ®µçä¸å¡æä½ï¼è¿ç§å¤§å¯¹è±¡å¦æè¶è¿å¹´è½»ä»£æå¤§å¯¹è±¡éå¼ï¼ä¼è¢«ç´æ¥åå»ºå¨èå¹´ä»£ï¼å³ä½¿è¢«åå»ºå¨äºå¹´è½»ä»£ï¼ç±äºå¹´è½»ä»£çåå­ç©ºé´æéï¼éè¿ Minor GC ä¹åä¹ä¼è¿å¥å°èå¹´ä»£ãè¿ç§å¤§å¯¹è±¡å¾å®¹æäº§çè¾å¤ç Full GCã\n\næä»¬å¯ä»¥å°è¿ç§å¤§å¯¹è±¡æè§£åºæ¥ï¼é¦æ¬¡åªæ¥è¯¢ä¸äºæ¯è¾éè¦çå­æ®µï¼å¦æè¿éè¦å¶å®å­æ®µè¾å©æ¥çï¼åéè¿ç¬¬äºæ¬¡æ¥è¯¢æ¾ç¤ºå©ä½çå­æ®µã\n\n**å¢å¤§å åå­ç©ºé´ï¼**å¨å åå­ä¸è¶³çæåµä¸ï¼å¢å¤§å åå­ç©ºé´ï¼ä¸è®¾ç½®åå§åå åå­ä¸ºæå¤§å åå­ï¼ä¹å¯ä»¥éä½ Full GC çé¢çã\n\n# éä½ Full GC çæ¶é´\n\nFull GC çæ§è¡æ¶é´æ¯ Minor GC è¦é¿å¾å¤ï¼å æ­¤ï¼å¦æå¨ Full GC ä¸è±è´¹è¿å¤çæ¶é´ï¼è¶è¿ 1sï¼ï¼å°å¯è½åºç°è¶æ¶éè¯¯ã\n\n * å¦æéè¿åå°èå¹´ä»£åå­æ¥åå° Full GC æ¶é´ï¼å¯è½ä¼å¼èµ· OutOfMemoryError æèå¯¼è´ Full GC çé¢çåé«ã\n * å¦å¤ï¼å¦æéè¿å¢å èå¹´ä»£åå­æ¥éä½ Full GC çé¢çï¼Full GC çæ¶é´å¯è½å æ­¤å¢å ã\n\nå æ­¤ï¼ä½ éè¦æèå¹´ä»£çå¤§å°è®¾ç½®æä¸ä¸ªâåéâçå¼ã\n\nGC ä¼åéè¦èèç JVM åæ°\n\nç±»å        åæ°                  æè¿°\nå åå­å¤§å°     -Xms                å¯å¨ JVM æ¶å åå­çå¤§å°\n          -Xmx                å åå­æå¤§éå¶\næ°çä»£ç©ºé´å¤§å°   -XX:NewRatio        æ°çä»£åèå¹´ä»£çåå­æ¯\n          -XX:NewSize         æ°çä»£åå­å¤§å°\n          -XX:SurvivorRatio   Eden åºå Survivor åºçåå­æ¯\n\nGC ä¼åæ¶æå¸¸ç¨çåæ°æ¯-Xms,-Xmxå-XX:NewRatioã-Xmså-Xmxåæ°éå¸¸æ¯å¿é¡»çï¼æä»¥NewRatioçå¼å°å¯¹ GC æ§è½äº§çéè¦çå½±åã\n\næäºäººå¯è½ä¼é®å¦ä½è®¾ç½®æ°¸ä¹ä»£åå­å¤§å°ï¼ä½ å¯ä»¥ç¨-XX:PermSizeå-XX:MaxPermSizeåæ°æ¥è¿è¡è®¾ç½®ï¼ä½æ¯è¦è®°ä½ï¼åªæå½åºç°OutOfMemoryErroréè¯¯æ¶ä½ æéè¦å»è®¾ç½®æ°¸ä¹ä»£åå­ã\n\n\n# GC ä¼åçè¿ç¨\n\nGC ä¼åçè¿ç¨å¤§è´å¯åä¸ºä»¥ä¸æ­¥éª¤ï¼\n\n# ï¼1ï¼çæ§ GC ç¶æ\n\nä½ éè¦çæ§ GC ä»èæ£æ¥ç³»ç»ä¸­è¿è¡ç GC çåç§ç¶æã\n\n# ï¼2ï¼åæ GC æ¥å¿\n\nå¨æ£æ¥ GC ç¶æåï¼ä½ éè¦åæçæ§ç»æå¹¶å³å®æ¯å¦éè¦è¿è¡ GC ä¼åãå¦æåæç»ææ¾ç¤ºè¿è¡ GC çæ¶é´åªæ 0.1-0.3 ç§ï¼é£ä¹å°±ä¸éè¦ææ¶é´æµªè´¹å¨ GC ä¼åä¸ï¼ä½å¦æè¿è¡ GC çæ¶é´è¾¾å° 1-3 ç§ï¼çè³å¤§äº 10 ç§ï¼é£ä¹ GC ä¼åå°æ¯å¾æå¿è¦çã\n\nä½æ¯ï¼å¦æä½ å·²ç»åéäºå¤§çº¦ 10GB åå­ç» Javaï¼å¹¶ä¸è¿äºåå­æ æ³çä¸ï¼é£ä¹å°±æ æ³è¿è¡ GC ä¼åäºãå¨è¿è¡ GC ä¼åä¹åï¼ä½ éè¦èèä¸ºä»ä¹ä½ éè¦åéè¿ä¹å¤§çåå­ç©ºé´ï¼å¦æä½ åéäº 1GB æ 2GB å¤§å°çåå­å¹¶ä¸åºç°äºOutOfMemoryErrorï¼é£ä½ å°±åºè¯¥æ§è¡**å å¿«ç§ï¼heap dumpï¼**æ¥æ¶é¤å¯¼è´å¼å¸¸çåå ã\n\n> ð æ³¨æï¼\n\n> **å å¿«ç§ï¼heap dumpï¼**æ¯ä¸ä¸ªç¨æ¥æ£æ¥ Java åå­ä¸­çå¯¹è±¡åæ°æ®çåå­æä»¶ãè¯¥æä»¶å¯ä»¥éè¿æ§è¡ JDK ä¸­çjmapå½ä»¤æ¥åå»ºãå¨åå»ºæä»¶çè¿ç¨ä¸­ï¼ææ Java ç¨åºé½å°æåï¼å æ­¤ï¼ä¸è¦å¨ç³»ç»æ§è¡è¿ç¨ä¸­åå»ºè¯¥æä»¶ã\n\n> ä½ å¯ä»¥å¨äºèç½ä¸æç´¢ heap dump çè¯¦ç»è¯´æã\n\n# ï¼3ï¼éæ©åé GC åæ¶å¨\n\nå¦æä½ å³å®è¦è¿è¡ GC ä¼åï¼é£ä¹ä½ éè¦éæ©ä¸ä¸ª GC åæ¶å¨ï¼å¹¶ä¸ä¸ºå®è®¾ç½®åç JVM åæ°ãæ­¤æ¶å¦æä½ æå¤ä¸ªæå¡å¨ï¼è¯·å¦ä¸ææå°çé£æ ·ï¼å¨æ¯å°æºå¨ä¸è®¾ç½®ä¸åç GC åæ°å¹¶åæå®ä»¬çåºå«ã\n\n# ï¼4ï¼åæç»æ\n\nå¨è®¾ç½®å® GC åæ°åå°±å¯ä»¥å¼å§æ¶éæ°æ®ï¼è¯·å¨æ¶éè³å° 24 å°æ¶ååè¿è¡ç»æåæãå¦æä½ è¶³å¤å¹¸è¿ï¼ä½ å¯è½ä¼æ¾å°ç³»ç»çæä½³ GC åæ°ãå¦è¥ä¸ç¶ï¼ä½ è¿éè¦åæè¾åºæ¥å¿å¹¶æ£æ¥åéçåå­ï¼ç¶åéè¦éè¿ä¸æ­è°æ´ GC ç±»å/åå­å¤§å°æ¥æ¾å°ç³»ç»çæä½³åæ°ã\n\n# ï¼5ï¼åºç¨ä¼åéç½®\n\nå¦æ GC ä¼åçç»æä»¤äººæ»¡æï¼å°±å¯ä»¥å°åæ°åºç¨å°æææå¡å¨ä¸ï¼å¹¶åæ­¢ GC ä¼åã\n\nå¨ä¸é¢çç« èä¸­ï¼ä½ å°ä¼çå°ä¸è¿°æ¯ä¸æ­¥æåçå·ä½å·¥ä½ã\n\n\n# GC æ¥å¿\n\n\n# è·å GC æ¥å¿\n\nè·å GC æ¥å¿æä¸¤ç§æ¹å¼ï¼\n\n * ä½¿ç¨ jstat å½ä»¤å¨ææ¥ç\n * å¨å®¹å¨ä¸­è®¾ç½®ç¸å³åæ°æå° GC æ¥å¿\n\n# jstat å½ä»¤æ¥ç GC\n\njstat -gc ç»è®¡åå¾åæ¶å çè¡ä¸ºï¼\n\njstat -gc 1262\n S0C    S1C     S0U     S1U   EC       EU        OC         OU        PC       PU         YGC    YGCT    FGC    FGCT     GCT\n26112.0 24064.0 6562.5  0.0   564224.0 76274.5   434176.0   388518.3  524288.0 42724.7    320    6.417   1      0.398    6.815\n\n\nä¹å¯ä»¥è®¾ç½®é´éåºå®æ¶é´æ¥æå°ï¼\n\njstat -gc 1262 2000 20\n\n\nè¿ä¸ªå½ä»¤ææå°±æ¯æ¯é 2000ms è¾åº 1262 ç gc æåµï¼ä¸å±è¾åº 20 æ¬¡\n\n# æå° GC çåæ°\n\néè¿ JVM åæ°é¢åè®¾ç½® GC æ¥å¿ï¼éå¸¸æä»¥ä¸å ç§ JVM åæ°è®¾ç½®ï¼\n\n-XX:+PrintGC è¾åº GC æ¥å¿\n-XX:+PrintGCDetails è¾åº GC çè¯¦ç»æ¥å¿\n-XX:+PrintGCTimeStamps è¾åº GC çæ¶é´æ³ï¼ä»¥åºåæ¶é´çå½¢å¼ï¼\n-XX:+PrintGCDateStamps è¾åº GC çæ¶é´æ³ï¼ä»¥æ¥æçå½¢å¼ï¼å¦ 2013-05-04T21:53:59.234+0800ï¼\n-XX:+PrintHeapAtGC å¨è¿è¡ GC çååæå°åºå çä¿¡æ¯\n-verbose:gc -Xloggc:../logs/gc.log æ¥å¿æä»¶çè¾åºè·¯å¾\n\n\nå¦ææ¯é¿æ¶é´ç GC æ¥å¿ï¼æä»¬å¾é¾éè¿ææ¬å½¢å¼å»æ¥çæ´ä½ç GC æ§è½ãæ­¤æ¶ï¼æä»¬å¯ä»¥éè¿GCViewå·¥å·æå¼æ¥å¿æä»¶ï¼å¾å½¢åçé¢æ¥çæ´ä½ç GC æ§è½ã\n\nãç¤ºä¾ãTomcat è®¾ç½®ç¤ºä¾\n\nJAVA_OPTS="-server -Xms2000m -Xmx2000m -Xmn800m -XX:PermSize=64m -XX:MaxPermSize=256m -XX:SurvivorRatio=4\n-verbose:gc -Xloggc:$CATALINA_HOME/logs/gc.log\n-Djava.awt.headless=true\n-XX:+PrintGCTimeStamps -XX:+PrintGCDetails\n-Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000\n-XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15"\n\n\n * -Xms2000m -Xmx2000m -Xmn800m -XX:PermSize=64m -XX:MaxPermSize=256m Xmsï¼å³ä¸º jvm å¯å¨æ¶å¾ JVM åå§å å¤§å°,Xmx ä¸º jvm çæå¤§å å¤§å°ï¼xmn ä¸ºæ°çä»£çå¤§å°ï¼permsize ä¸ºæ°¸ä¹ä»£çåå§å¤§å°ï¼MaxPermSize ä¸ºæ°¸ä¹ä»£çæå¤§ç©ºé´ã\n * -XX:SurvivorRatio=4 SurvivorRatio ä¸ºæ°çä»£ç©ºé´ä¸­ç Eden åºåæå©ç©ºé´ Survivor åºçå¤§å°æ¯å¼ï¼é»è®¤æ¯ 8ï¼åä¸¤ä¸ª Survivor åºä¸ä¸ä¸ª Eden åºçæ¯å¼ä¸º 2:8,ä¸ä¸ª Survivor åºå æ´ä¸ªå¹´è½»ä»£ç 1/10ãè°å°è¿ä¸ªåæ°å°å¢å¤§ survivor åºï¼è®©å¯¹è±¡å°½éå¨ survitor åºåé¿ä¸ç¹ï¼åå°è¿å¥å¹´èä»£çå¯¹è±¡ãå»ææå©ç©ºé´çæ³æ³æ¯è®©å¤§é¨åä¸è½é©¬ä¸åæ¶çæ°æ®å°½å¿«è¿å¥å¹´èä»£ï¼å å¿«å¹´èä»£çåæ¶é¢çï¼åå°å¹´èä»£æ´æ¶¨çå¯è½æ§ï¼è¿ä¸ªæ¯éè¿å°-XX:SurvivorRatio è®¾ç½®ææ¯è¾å¤§çå¼ï¼æ¯å¦ 65536)æ¥åå°ã\n * -verbose:gc -Xloggc:$CATALINA_HOME/logs/gc.log å°èææºæ¯æ¬¡åå¾åæ¶çä¿¡æ¯åå°æ¥å¿æä»¶ä¸­ï¼æä»¶åç± file æå®ï¼æä»¶æ ¼å¼æ¯å¹³æä»¶ï¼åå®¹å-verbose:gc è¾åºåå®¹ç¸åã\n * -Djava.awt.headless=true Headless æ¨¡å¼æ¯ç³»ç»çä¸ç§éç½®æ¨¡å¼ãå¨è¯¥æ¨¡å¼ä¸ï¼ç³»ç»ç¼ºå°äºæ¾ç¤ºè®¾å¤ãé®çæé¼ æ ã\n * -XX:+PrintGCTimeStamps -XX:+PrintGCDetails è®¾ç½® gc æ¥å¿çæ ¼å¼\n * -Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000 æå® rmi è°ç¨æ¶ gc çæ¶é´é´é\n * -XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15 éç¨å¹¶å gc æ¹å¼ï¼ç»è¿ 15 æ¬¡ minor gc åè¿å¥å¹´èä»£\n\n\n# åæ GC æ¥å¿\n\nYoung GC åæ¶æ¥å¿:\n\n2016-07-05T10:43:18.093+0800: 25.395: [GC [PSYoungGen: 274931K->10738K(274944K)] 371093K->147186K(450048K), 0.0668480 secs] [Times: user=0.17 sys=0.08, real=0.07 secs]\n\n\nFull GC åæ¶æ¥å¿:\n\n2016-07-05T10:43:18.160+0800: 25.462: [Full GC [PSYoungGen: 10738K->0K(274944K)] [ParOldGen: 136447K->140379K(302592K)] 147186K->140379K(577536K) [PSPermGen: 85411K->85376K(171008K)], 0.6763541 secs] [Times: user=1.75 sys=0.02, real=0.68 secs]\n\n\néè¿ä¸é¢æ¥å¿åæå¾åºï¼PSYoungGenãParOldGenãPSPermGen å±äº Parallel æ¶éå¨ãå¶ä¸­ PSYoungGen è¡¨ç¤º gc åæ¶ååå¹´è½»ä»£çåå­ååï¼ParOldGen è¡¨ç¤º gc åæ¶ååèå¹´ä»£çåå­ååï¼PSPermGen è¡¨ç¤º gc åæ¶ååæ°¸ä¹åºçåå­ååãyoung gc ä¸»è¦æ¯éå¯¹å¹´è½»ä»£è¿è¡åå­åæ¶æ¯è¾é¢ç¹ï¼èæ¶ç­ï¼full gc ä¼å¯¹æ´ä¸ªå åå­è¿è¡ååï¼èæ¶é¿ï¼å æ­¤ä¸è¬å°½éåå° full gc çæ¬¡æ°\n\néè¿ä¸¤å¼ å¾éå¸¸ææ¾çåº gc æ¥å¿ææï¼\n\nYOUNG GC\n\n\n\nFULL GC\n\n\n\n# CPU è¿é«\n\nå®ä½æ­¥éª¤ï¼\n\nï¼1ï¼æ§è¡ top -c å½ä»¤ï¼æ¾å° cpu æé«çè¿ç¨ç id\n\nï¼2ï¼jstack PID å¯¼åº Java åºç¨ç¨åºççº¿ç¨å æ ä¿¡æ¯ã\n\nç¤ºä¾ï¼\n\njstack 6795\n\n"Low Memory Detector" daemon prio=10 tid=0x081465f8 nid=0x7 runnable [0x00000000..0x00000000]\n        "CompilerThread0" daemon prio=10 tid=0x08143c58 nid=0x6 waiting on condition [0x00000000..0xfb5fd798]\n        "Signal Dispatcher" daemon prio=10 tid=0x08142f08 nid=0x5 waiting on condition [0x00000000..0x00000000]\n        "Finalizer" daemon prio=10 tid=0x08137ca0 nid=0x4 in Object.wait() [0xfbeed000..0xfbeeddb8]\n\n        at java.lang.Object.wait(Native Method)\n\n        - waiting on <0xef600848> (a java.lang.ref.ReferenceQueue$Lock)\n\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:116)\n\n        - locked <0xef600848> (a java.lang.ref.ReferenceQueue$Lock)\n\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:132)\n\n        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\n\n        "Reference Handler" daemon prio=10 tid=0x081370f0 nid=0x3 in Object.wait() [0xfbf4a000..0xfbf4aa38]\n\n        at java.lang.Object.wait(Native Method)\n\n        - waiting on <0xef600758> (a java.lang.ref.Reference$Lock)\n\n        at java.lang.Object.wait(Object.java:474)\n\n        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\n\n        - locked <0xef600758> (a java.lang.ref.Reference$Lock)\n\n        "VM Thread" prio=10 tid=0x08134878 nid=0x2 runnable\n\n        "VM Periodic Task Thread" prio=10 tid=0x08147768 nid=0x8 waiting on condition\n\n\nå¨æå°çå æ æ¥å¿æä»¶ä¸­ï¼tid å nid çå«ä¹ï¼\n\nnid : å¯¹åºç Linux æä½ç³»ç»ä¸ç tid çº¿ç¨å·ï¼ä¹å°±æ¯åé¢è½¬åç 16 è¿å¶æ°å­\ntid: è¿ä¸ªåºè¯¥æ¯ jvm ç jmm åå­è§èä¸­çå¯ä¸å°åå®ä½\n\n\nå¨ CPU è¿é«çæåµä¸ï¼æ¥æ¾ååºççº¿ç¨ï¼ä¸è¬å®ä½é½æ¯ç¨ nid æ¥å®ä½çãèå¦æåçæ­»éä¹ç±»çé®é¢ï¼ä¸è¬ç¨ tid æ¥å®ä½ã\n\nï¼3ï¼å®ä½ CPU é«ççº¿ç¨æå°å¶ nid\n\næ¥ççº¿ç¨ä¸å·ä½è¿ç¨ä¿¡æ¯çå½ä»¤å¦ä¸ï¼\n\ntop -H -p 6735\n\ntop - 14:20:09 up 611 days,  2:56,  1 user,  load average: 13.19, 7.76, 7.82\nThreads: 6991 total,  17 running, 6974 sleeping,   0 stopped,   0 zombie\n%Cpu(s): 90.4 us,  2.1 sy,  0.0 ni,  7.0 id,  0.0 wa,  0.0 hi,  0.4 si,  0.0 st\nKiB Mem:  32783044 total, 32505008 used,   278036 free,   120304 buffers\nKiB Swap:        0 total,        0 used,        0 free. 4497428 cached Mem\n\n  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND\n 6800 root      20   0 27.299g 0.021t   7172 S 54.7 70.1 187:55.61 java\n 6803 root      20   0 27.299g 0.021t   7172 S 54.4 70.1 187:52.59 java\n 6798 root      20   0 27.299g 0.021t   7172 S 53.7 70.1 187:55.08 java\n 6801 root      20   0 27.299g 0.021t   7172 S 53.7 70.1 187:55.25 java\n 6797 root      20   0 27.299g 0.021t   7172 S 53.1 70.1 187:52.78 java\n 6804 root      20   0 27.299g 0.021t   7172 S 53.1 70.1 187:55.76 java\n 6802 root      20   0 27.299g 0.021t   7172 S 52.1 70.1 187:54.79 java\n 6799 root      20   0 27.299g 0.021t   7172 S 51.8 70.1 187:53.36 java\n 6807 root      20   0 27.299g 0.021t   7172 S 13.6 70.1  48:58.60 java\n11014 root      20   0 27.299g 0.021t   7172 R  8.4 70.1   8:00.32 java\n10642 root      20   0 27.299g 0.021t   7172 R  6.5 70.1   6:32.06 java\n 6808 root      20   0 27.299g 0.021t   7172 S  6.1 70.1 159:08.40 java\n11315 root      20   0 27.299g 0.021t   7172 S  3.9 70.1   5:54.10 java\n12545 root      20   0 27.299g 0.021t   7172 S  3.9 70.1   6:55.48 java\n23353 root      20   0 27.299g 0.021t   7172 S  3.9 70.1   2:20.55 java\n24868 root      20   0 27.299g 0.021t   7172 S  3.9 70.1   2:12.46 java\n 9146 root      20   0 27.299g 0.021t   7172 S  3.6 70.1   7:42.72 java\n\n\nç±æ­¤å¯ä»¥çåºå ç¨ CPU è¾é«ççº¿ç¨ï¼ä½æ¯è¿äºè¿ä¸é«ï¼æ æ³ç´æ¥å®ä½å°å·ä½çç±»ãnid æ¯ 16 è¿å¶çï¼æä»¥æä»¬è¦è·åçº¿ç¨ç 16 è¿å¶ IDï¼\n\nprintf "%x\\n" 6800\n\n\nè¾åºç»æ:45cd\n\n\nç¶åæ ¹æ®è¾åºç»æå° jstack æå°çå æ æ¥å¿ä¸­æ¥å®ä½ï¼\n\n"catalina-exec-5692" daemon prio=10 tid=0x00007f3b05013800 nid=0x45cd waiting on condition [0x00007f3ae08e3000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0x00000006a7800598> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2082)\n        at java.util.concurrent.LinkedBlockingQueue.poll(LinkedBlockingQueue.java:467)\n        at org.apache.tomcat.util.threads.TaskQueue.poll(TaskQueue.java:86)\n        at org.apache.tomcat.util.threads.TaskQueue.poll(TaskQueue.java:32)\n        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\n\n\n\n# GC éç½®\n\n> è¯¦ç»åæ°è¯´æè¯·åèå®æ¹ææ¡£ï¼JavaHotSpot VM Optionsï¼è¿éä»åä¸¾å¸¸ç¨åæ°ã\n\n\n# å å¤§å°è®¾ç½®\n\nå¹´è½»ä»£çè®¾ç½®å¾å³é®ã\n\nJVM ä¸­æå¤§å å¤§å°æä¸æ¹é¢éå¶ï¼\n\n 1. ç¸å³æä½ç³»ç»çæ°æ®æ¨¡åï¼32-bt è¿æ¯ 64-bitï¼éå¶ï¼\n 2. ç³»ç»çå¯ç¨èæåå­éå¶ï¼\n 3. ç³»ç»çå¯ç¨ç©çåå­éå¶ã\n\næ´ä¸ªå å¤§å° = å¹´è½»ä»£å¤§å° + å¹´èä»£å¤§å° + æä¹ä»£å¤§å°\n\n\n * æä¹ä»£ä¸è¬åºå®å¤§å°ä¸º 64mãä½¿ç¨ -XX:PermSize è®¾ç½®ã\n * å®æ¹æ¨èå¹´è½»ä»£å æ´ä¸ªå ç 3/8ãä½¿ç¨ -Xmn è®¾ç½®ã\n\n\n# JVM åå­éç½®\n\néç½®                  æè¿°\n-Xss                èææºæ å¤§å°ã\n-Xms                å ç©ºé´åå§å¼ã\n-Xmx                å ç©ºé´æå¤§å¼ã\n-Xmn                æ°çä»£ç©ºé´å¤§å°ã\n-XX:NewSize         æ°çä»£ç©ºé´åå§å¼ã\n-XX:MaxNewSize      æ°çä»£ç©ºé´æå¤§å¼ã\n-XX:NewRatio        æ°çä»£ä¸å¹´èä»£çæ¯ä¾ãé»è®¤ä¸º 2ï¼æå³çèå¹´ä»£æ¯æ°çä»£ç 2 åã\n-XX:SurvivorRatio   æ°çä»£ä¸­è°æ´ eden åºä¸ survivor åºçæ¯ä¾ï¼é»è®¤ä¸º 8ãå³ eden åºä¸º 80% çå¤§å°ï¼ä¸¤ä¸ª\n                    survivor åå«ä¸º 10% çå¤§å°ã\n-XX:PermSize        æ°¸ä¹ä»£ç©ºé´çåå§å¼ã\n-XX:MaxPermSize     æ°¸ä¹ä»£ç©ºé´çæå¤§å¼ã\n\n\n# GC ç±»åéç½®\n\néç½®                        æè¿°\n-XX:+UseSerialGC          ä½¿ç¨ Serial + Serial Old åå¾åæ¶å¨ç»å\n-XX:+UseParallelGC        ä½¿ç¨ Parallel Scavenge + Parallel Old åå¾åæ¶å¨ç»å\n-XX:+UseParallelOldGC     ä½¿ç¨ Parallel Old åå¾åæ¶å¨ï¼JDK5 åå·²æ ç¨ï¼\n-XX:+UseParNewGC          ä½¿ç¨ ParNew + Serial Old åå¾åæ¶å¨\n-XX:+UseConcMarkSweepGC   ä½¿ç¨ CMS + ParNew + Serial Old åå¾åæ¶å¨ç»å\n-XX:+UseG1GC              ä½¿ç¨ G1 åå¾åæ¶å¨\n-XX:ParallelCMSThreads    å¹¶åæ è®°æ«æåå¾åæ¶å¨ = ä¸ºä½¿ç¨ççº¿ç¨æ°é\n\n\n# åå¾åæ¶å¨éç¨åæ°\n\néç½®                       æè¿°\nPretenureSizeThreshold   æåå¹´èä»£çå¯¹è±¡å¤§å°ãé»è®¤ä¸º 0ãæ¯å¦è®¾ä¸º 10Mï¼åè¶è¿ 10M çå¯¹è±¡å°ä¸å¨ eden åºåéï¼èç´æ¥è¿å¥å¹´èä»£ã\nMaxTenuringThreshold     æåèå¹´ä»£çæå¤§å¹´é¾ãé»è®¤ä¸º 15ãæ¯å¦è®¾ä¸º 10ï¼åå¯¹è±¡å¨ 10 æ¬¡æ®é GC åå°ä¼è¢«æ¾å¥å¹´èä»£ã\nDisableExplicitGC        ç¦ç¨ System.gc()\n\n\n# JMX\n\nå¼å¯ JMX åï¼å¯ä»¥ä½¿ç¨ jconsole æ jvisualvm è¿è¡çæ§ Java ç¨åºçåºæ¬ä¿¡æ¯åè¿è¡æåµã\n\n-Dcom.sun.management.jmxremote=true\n-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.authenticate=false\n-Djava.rmi.server.hostname=127.0.0.1\n-Dcom.sun.management.jmxremote.port=18888\n\n\n-Djava.rmi.server.hostname æå® Java ç¨åºè¿è¡çæå¡å¨ï¼-Dcom.sun.management.jmxremote.port æå®æå¡çå¬ç«¯å£ã\n\n\n# è¿ç¨ DEBUG\n\nå¦æå¼å¯ Java åºç¨çè¿ç¨ Debug åè½ï¼éè¦æå®å¦ä¸åæ°ï¼\n\n-Xdebug\n-Xnoagent\n-Djava.compiler=NONE\n-Xrunjdwp:transport=dt_socket,address=28888,server=y,suspend=n\n\n\naddress å³ä¸ºè¿ç¨ debug ççå¬ç«¯å£ã\n\n\n# HeapDump\n\n-XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError\n\n\n\n# è¾å©éç½®\n\néç½®                                æè¿°\n-XX:+PrintGCDetails               æå° GC æ¥å¿\n-Xloggc:<filename>                æå® GC æ¥å¿æä»¶å\n-XX:+HeapDumpOnOutOfMemoryError   åå­æº¢åºæ¶è¾åºå å¿«ç§æä»¶\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava æ§è½è°ä¼å®æã\n * ä»è¡¨å°éå­¦ä¹  JVM å®ç°\n * JVMï¼4ï¼ï¼Jvm è°ä¼-å½ä»¤ç¯\n * Java ç³»åç¬è®°(4) - JVM çæ§ä¸è°ä¼\n * Java æå¡ GC åæ°è°ä¼æ¡ä¾\n * JVM è°ä¼æ»ç»ï¼5ï¼ï¼å¸åéç½®\n * å¦ä½åççè§åä¸æ¬¡ jvm æ§è½è°ä¼\n * jvm ç³»å(ä¹):å¦ä½ä¼å Java GCãè¯ã\n * https://my.oschina.net/feichexia/blog/196575',normalizedContent:'# jvm å®æ\n\n\n# jvm è°ä¼æ¦è¿°\n\n\n# gc æ§è½ææ \n\nå¯¹äº jvm è°ä¼æ¥è¯´ï¼éè¦åæç¡®è°ä¼çç®æ ã ä»æ§è½çè§åº¦çï¼éå¸¸å³æ³¨ä¸ä¸ªææ ï¼\n\n * ååéï¼throughputï¼ - æä¸èè gc å¼èµ·çåé¡¿æ¶é´æåå­æ¶èï¼åå¾æ¶éå¨è½æ¯æåºç¨è¾¾å°çæé«æ§è½ææ ã\n * åé¡¿æ¶é´ï¼latencyï¼ - å¶åº¦éæ åæ¯ç¼©ç­ç±äºåå¾åæ¶éå¼èµ·çåé¡¿æ¶é´æèå®å¨æ¶é¤å åå¾æ¶éæå¼èµ·çåé¡¿ï¼é¿ååºç¨è¿è¡æ¶åçæå¨ã\n * åå¾åæ¶é¢ç - ä¹åçä¸æ¬¡æåå¾åæ¶å¢ï¼éå¸¸åå¾åæ¶çé¢çè¶ä½è¶å¥½ï¼å¢å¤§å åå­ç©ºé´å¯ä»¥ææéä½åå¾åæ¶åççé¢çï¼ä½åæ¶ä¹æå³çå ç§¯çåæ¶å¯¹è±¡è¶å¤ï¼æç»ä¹ä¼å¢å åæ¶æ¶çåé¡¿æ¶é´ãæä»¥æä»¬åªè¦éå½å°å¢å¤§å åå­ç©ºé´ï¼ä¿è¯æ­£å¸¸çåå¾åæ¶é¢çå³å¯ã\n\nå¤§å¤æ°æåµä¸è°ä¼ä¼ä¾§éäºå¶ä¸­ä¸ä¸ªæèä¸¤ä¸ªæ¹é¢çç®æ ï¼å¾å°ææåµå¯ä»¥å¼é¡¾ä¸ä¸ªä¸åçè§åº¦ã\n\n\n# è°ä¼åå\n\ngc ä¼åçä¸¤ä¸ªç®æ ï¼\n\n * éä½ full gc çé¢ç\n * åå° full gc çæ§è¡æ¶é´\n\ngc ä¼åçåºæ¬ååæ¯ï¼å°ä¸åç gc åæ°åºç¨å°ä¸¤ä¸ªåä»¥ä¸çæå¡å¨ä¸ç¶åæ¯è¾å®ä»¬çæ§è½ï¼ç¶åå°é£äºè¢«è¯æå¯ä»¥æé«æ§è½æåå° gc æ§è¡æ¶é´çåæ°åºç¨äºæç»çå·¥ä½æå¡å¨ä¸ã\n\n# éä½ minor gc é¢ç\n\nå¦ææ°çä»£ç©ºé´è¾å°ï¼eden åºå¾å¿«è¢«å¡«æ»¡ï¼å°±ä¼å¯¼è´é¢ç¹ minor gcï¼å æ­¤æä»¬å¯ä»¥éè¿å¢å¤§æ°çä»£ç©ºé´æ¥éä½ minor gc çé¢çã\n\nå¯è½ä½ ä¼æè¿æ ·ççé®ï¼æ©å®¹ eden åºè½ç¶å¯ä»¥åå° minor gc çæ¬¡æ°ï¼ä½ä¸ä¼å¢å åæ¬¡ minor gc çæ¶é´åï¼å¦æåæ¬¡ minor gc çæ¶é´å¢å ï¼é£ä¹å¾é¾è¾¾å°æä»¬æå¾çä¼åææåã\n\næä»¬ç¥éï¼åæ¬¡ minor gc æ¶é´æ¯ç±ä¸¤é¨åç»æï¼t1ï¼æ«ææ°çä»£ï¼å t2ï¼å¤å¶å­æ´»å¯¹è±¡ï¼ãåè®¾ä¸ä¸ªå¯¹è±¡å¨ eden åºçå­æ´»æ¶é´ä¸º 500msï¼minor gc çæ¶é´é´éæ¯ 300msï¼é£ä¹æ­£å¸¸æåµä¸ï¼minor gc çæ¶é´ä¸º ï¼t1+t2ã\n\nå½æä»¬å¢å¤§æ°çä»£ç©ºé´ï¼minor gc çæ¶é´é´éå¯è½ä¼æ©å¤§å° 600msï¼æ­¤æ¶ä¸ä¸ªå­æ´» 500ms çå¯¹è±¡å°±ä¼å¨ eden åºä¸­è¢«åæ¶æï¼æ­¤æ¶å°±ä¸å­å¨å¤å¶å­æ´»å¯¹è±¡äºï¼æä»¥ååç minor gc çæ¶é´ä¸ºï¼ä¸¤æ¬¡æ«ææ°çä»£ï¼å³ 2t1ã\n\nå¯è§ï¼æ©å®¹åï¼minor gc æ¶å¢å äº t1ï¼ä½çå»äº t2 çæ¶é´ãéå¸¸å¨èææºä¸­ï¼å¤å¶å¯¹è±¡çææ¬è¦è¿é«äºæ«æææ¬ã\n\nå¦æå¨å åå­ä¸­å­å¨è¾å¤çé¿æå­æ´»çå¯¹è±¡ï¼æ­¤æ¶å¢å å¹´è½»ä»£ç©ºé´ï¼åèä¼å¢å  minor gc çæ¶é´ãå¦æå ä¸­çç­æå¯¹è±¡å¾å¤ï¼é£ä¹æ©å®¹æ°çä»£ï¼åæ¬¡ minor gc æ¶é´ä¸ä¼æ¾èå¢å ãå æ­¤ï¼åæ¬¡ minor gc æ¶é´æ´å¤åå³äº gc åå­æ´»å¯¹è±¡çæ°éï¼èé eden åºçå¤§å°ã\n\n# éä½ full gc çé¢ç\n\nfull gc ç¸å¯¹æ¥è¯´ä¼æ¯ minor gc æ´èæ¶ãåå°è¿å¥èå¹´ä»£çå¯¹è±¡æ°éå¯ä»¥æ¾èéä½ full gc çé¢çã\n\nåå°åå»ºå¤§å¯¹è±¡ï¼å¦æå¯¹è±¡å ç¨åå­è¿å¤§ï¼å¨ eden åºè¢«åå»ºåä¼ç´æ¥è¢«ä¼ å¥èå¹´ä»£ãå¨å¹³å¸¸çä¸å¡åºæ¯ä¸­ï¼æä»¬ä¹ æ¯ä¸æ¬¡æ§ä»æ°æ®åºä¸­æ¥è¯¢åºä¸ä¸ªå¤§å¯¹è±¡ç¨äº web ç«¯æ¾ç¤ºãä¾å¦ï¼æä¹åç¢°å°è¿ä¸ä¸ªä¸æ¬¡æ§æ¥è¯¢åº 60 ä¸ªå­æ®µçä¸å¡æä½ï¼è¿ç§å¤§å¯¹è±¡å¦æè¶è¿å¹´è½»ä»£æå¤§å¯¹è±¡éå¼ï¼ä¼è¢«ç´æ¥åå»ºå¨èå¹´ä»£ï¼å³ä½¿è¢«åå»ºå¨äºå¹´è½»ä»£ï¼ç±äºå¹´è½»ä»£çåå­ç©ºé´æéï¼éè¿ minor gc ä¹åä¹ä¼è¿å¥å°èå¹´ä»£ãè¿ç§å¤§å¯¹è±¡å¾å®¹æäº§çè¾å¤ç full gcã\n\næä»¬å¯ä»¥å°è¿ç§å¤§å¯¹è±¡æè§£åºæ¥ï¼é¦æ¬¡åªæ¥è¯¢ä¸äºæ¯è¾éè¦çå­æ®µï¼å¦æè¿éè¦å¶å®å­æ®µè¾å©æ¥çï¼åéè¿ç¬¬äºæ¬¡æ¥è¯¢æ¾ç¤ºå©ä½çå­æ®µã\n\n**å¢å¤§å åå­ç©ºé´ï¼**å¨å åå­ä¸è¶³çæåµä¸ï¼å¢å¤§å åå­ç©ºé´ï¼ä¸è®¾ç½®åå§åå åå­ä¸ºæå¤§å åå­ï¼ä¹å¯ä»¥éä½ full gc çé¢çã\n\n# éä½ full gc çæ¶é´\n\nfull gc çæ§è¡æ¶é´æ¯ minor gc è¦é¿å¾å¤ï¼å æ­¤ï¼å¦æå¨ full gc ä¸è±è´¹è¿å¤çæ¶é´ï¼è¶è¿ 1sï¼ï¼å°å¯è½åºç°è¶æ¶éè¯¯ã\n\n * å¦æéè¿åå°èå¹´ä»£åå­æ¥åå° full gc æ¶é´ï¼å¯è½ä¼å¼èµ· outofmemoryerror æèå¯¼è´ full gc çé¢çåé«ã\n * å¦å¤ï¼å¦æéè¿å¢å èå¹´ä»£åå­æ¥éä½ full gc çé¢çï¼full gc çæ¶é´å¯è½å æ­¤å¢å ã\n\nå æ­¤ï¼ä½ éè¦æèå¹´ä»£çå¤§å°è®¾ç½®æä¸ä¸ªâåéâçå¼ã\n\ngc ä¼åéè¦èèç jvm åæ°\n\nç±»å        åæ°                  æè¿°\nå åå­å¤§å°     -xms                å¯å¨ jvm æ¶å åå­çå¤§å°\n          -xmx                å åå­æå¤§éå¶\næ°çä»£ç©ºé´å¤§å°   -xx:newratio        æ°çä»£åèå¹´ä»£çåå­æ¯\n          -xx:newsize         æ°çä»£åå­å¤§å°\n          -xx:survivorratio   eden åºå survivor åºçåå­æ¯\n\ngc ä¼åæ¶æå¸¸ç¨çåæ°æ¯-xms,-xmxå-xx:newratioã-xmså-xmxåæ°éå¸¸æ¯å¿é¡»çï¼æä»¥newratioçå¼å°å¯¹ gc æ§è½äº§çéè¦çå½±åã\n\næäºäººå¯è½ä¼é®å¦ä½è®¾ç½®æ°¸ä¹ä»£åå­å¤§å°ï¼ä½ å¯ä»¥ç¨-xx:permsizeå-xx:maxpermsizeåæ°æ¥è¿è¡è®¾ç½®ï¼ä½æ¯è¦è®°ä½ï¼åªæå½åºç°outofmemoryerroréè¯¯æ¶ä½ æéè¦å»è®¾ç½®æ°¸ä¹ä»£åå­ã\n\n\n# gc ä¼åçè¿ç¨\n\ngc ä¼åçè¿ç¨å¤§è´å¯åä¸ºä»¥ä¸æ­¥éª¤ï¼\n\n# ï¼1ï¼çæ§ gc ç¶æ\n\nä½ éè¦çæ§ gc ä»èæ£æ¥ç³»ç»ä¸­è¿è¡ç gc çåç§ç¶æã\n\n# ï¼2ï¼åæ gc æ¥å¿\n\nå¨æ£æ¥ gc ç¶æåï¼ä½ éè¦åæçæ§ç»æå¹¶å³å®æ¯å¦éè¦è¿è¡ gc ä¼åãå¦æåæç»ææ¾ç¤ºè¿è¡ gc çæ¶é´åªæ 0.1-0.3 ç§ï¼é£ä¹å°±ä¸éè¦ææ¶é´æµªè´¹å¨ gc ä¼åä¸ï¼ä½å¦æè¿è¡ gc çæ¶é´è¾¾å° 1-3 ç§ï¼çè³å¤§äº 10 ç§ï¼é£ä¹ gc ä¼åå°æ¯å¾æå¿è¦çã\n\nä½æ¯ï¼å¦æä½ å·²ç»åéäºå¤§çº¦ 10gb åå­ç» javaï¼å¹¶ä¸è¿äºåå­æ æ³çä¸ï¼é£ä¹å°±æ æ³è¿è¡ gc ä¼åäºãå¨è¿è¡ gc ä¼åä¹åï¼ä½ éè¦èèä¸ºä»ä¹ä½ éè¦åéè¿ä¹å¤§çåå­ç©ºé´ï¼å¦æä½ åéäº 1gb æ 2gb å¤§å°çåå­å¹¶ä¸åºç°äºoutofmemoryerrorï¼é£ä½ å°±åºè¯¥æ§è¡**å å¿«ç§ï¼heap dumpï¼**æ¥æ¶é¤å¯¼è´å¼å¸¸çåå ã\n\n> ð æ³¨æï¼\n\n> **å å¿«ç§ï¼heap dumpï¼**æ¯ä¸ä¸ªç¨æ¥æ£æ¥ java åå­ä¸­çå¯¹è±¡åæ°æ®çåå­æä»¶ãè¯¥æä»¶å¯ä»¥éè¿æ§è¡ jdk ä¸­çjmapå½ä»¤æ¥åå»ºãå¨åå»ºæä»¶çè¿ç¨ä¸­ï¼ææ java ç¨åºé½å°æåï¼å æ­¤ï¼ä¸è¦å¨ç³»ç»æ§è¡è¿ç¨ä¸­åå»ºè¯¥æä»¶ã\n\n> ä½ å¯ä»¥å¨äºèç½ä¸æç´¢ heap dump çè¯¦ç»è¯´æã\n\n# ï¼3ï¼éæ©åé gc åæ¶å¨\n\nå¦æä½ å³å®è¦è¿è¡ gc ä¼åï¼é£ä¹ä½ éè¦éæ©ä¸ä¸ª gc åæ¶å¨ï¼å¹¶ä¸ä¸ºå®è®¾ç½®åç jvm åæ°ãæ­¤æ¶å¦æä½ æå¤ä¸ªæå¡å¨ï¼è¯·å¦ä¸ææå°çé£æ ·ï¼å¨æ¯å°æºå¨ä¸è®¾ç½®ä¸åç gc åæ°å¹¶åæå®ä»¬çåºå«ã\n\n# ï¼4ï¼åæç»æ\n\nå¨è®¾ç½®å® gc åæ°åå°±å¯ä»¥å¼å§æ¶éæ°æ®ï¼è¯·å¨æ¶éè³å° 24 å°æ¶ååè¿è¡ç»æåæãå¦æä½ è¶³å¤å¹¸è¿ï¼ä½ å¯è½ä¼æ¾å°ç³»ç»çæä½³ gc åæ°ãå¦è¥ä¸ç¶ï¼ä½ è¿éè¦åæè¾åºæ¥å¿å¹¶æ£æ¥åéçåå­ï¼ç¶åéè¦éè¿ä¸æ­è°æ´ gc ç±»å/åå­å¤§å°æ¥æ¾å°ç³»ç»çæä½³åæ°ã\n\n# ï¼5ï¼åºç¨ä¼åéç½®\n\nå¦æ gc ä¼åçç»æä»¤äººæ»¡æï¼å°±å¯ä»¥å°åæ°åºç¨å°æææå¡å¨ä¸ï¼å¹¶åæ­¢ gc ä¼åã\n\nå¨ä¸é¢çç« èä¸­ï¼ä½ å°ä¼çå°ä¸è¿°æ¯ä¸æ­¥æåçå·ä½å·¥ä½ã\n\n\n# gc æ¥å¿\n\n\n# è·å gc æ¥å¿\n\nè·å gc æ¥å¿æä¸¤ç§æ¹å¼ï¼\n\n * ä½¿ç¨ jstat å½ä»¤å¨ææ¥ç\n * å¨å®¹å¨ä¸­è®¾ç½®ç¸å³åæ°æå° gc æ¥å¿\n\n# jstat å½ä»¤æ¥ç gc\n\njstat -gc ç»è®¡åå¾åæ¶å çè¡ä¸ºï¼\n\njstat -gc 1262\n s0c    s1c     s0u     s1u   ec       eu        oc         ou        pc       pu         ygc    ygct    fgc    fgct     gct\n26112.0 24064.0 6562.5  0.0   564224.0 76274.5   434176.0   388518.3  524288.0 42724.7    320    6.417   1      0.398    6.815\n\n\nä¹å¯ä»¥è®¾ç½®é´éåºå®æ¶é´æ¥æå°ï¼\n\njstat -gc 1262 2000 20\n\n\nè¿ä¸ªå½ä»¤ææå°±æ¯æ¯é 2000ms è¾åº 1262 ç gc æåµï¼ä¸å±è¾åº 20 æ¬¡\n\n# æå° gc çåæ°\n\néè¿ jvm åæ°é¢åè®¾ç½® gc æ¥å¿ï¼éå¸¸æä»¥ä¸å ç§ jvm åæ°è®¾ç½®ï¼\n\n-xx:+printgc è¾åº gc æ¥å¿\n-xx:+printgcdetails è¾åº gc çè¯¦ç»æ¥å¿\n-xx:+printgctimestamps è¾åº gc çæ¶é´æ³ï¼ä»¥åºåæ¶é´çå½¢å¼ï¼\n-xx:+printgcdatestamps è¾åº gc çæ¶é´æ³ï¼ä»¥æ¥æçå½¢å¼ï¼å¦ 2013-05-04t21:53:59.234+0800ï¼\n-xx:+printheapatgc å¨è¿è¡ gc çååæå°åºå çä¿¡æ¯\n-verbose:gc -xloggc:../logs/gc.log æ¥å¿æä»¶çè¾åºè·¯å¾\n\n\nå¦ææ¯é¿æ¶é´ç gc æ¥å¿ï¼æä»¬å¾é¾éè¿ææ¬å½¢å¼å»æ¥çæ´ä½ç gc æ§è½ãæ­¤æ¶ï¼æä»¬å¯ä»¥éè¿gcviewå·¥å·æå¼æ¥å¿æä»¶ï¼å¾å½¢åçé¢æ¥çæ´ä½ç gc æ§è½ã\n\nãç¤ºä¾ãtomcat è®¾ç½®ç¤ºä¾\n\njava_opts="-server -xms2000m -xmx2000m -xmn800m -xx:permsize=64m -xx:maxpermsize=256m -xx:survivorratio=4\n-verbose:gc -xloggc:$catalina_home/logs/gc.log\n-djava.awt.headless=true\n-xx:+printgctimestamps -xx:+printgcdetails\n-dsun.rmi.dgc.server.gcinterval=600000 -dsun.rmi.dgc.client.gcinterval=600000\n-xx:+useconcmarksweepgc -xx:maxtenuringthreshold=15"\n\n\n * -xms2000m -xmx2000m -xmn800m -xx:permsize=64m -xx:maxpermsize=256m xmsï¼å³ä¸º jvm å¯å¨æ¶å¾ jvm åå§å å¤§å°,xmx ä¸º jvm çæå¤§å å¤§å°ï¼xmn ä¸ºæ°çä»£çå¤§å°ï¼permsize ä¸ºæ°¸ä¹ä»£çåå§å¤§å°ï¼maxpermsize ä¸ºæ°¸ä¹ä»£çæå¤§ç©ºé´ã\n * -xx:survivorratio=4 survivorratio ä¸ºæ°çä»£ç©ºé´ä¸­ç eden åºåæå©ç©ºé´ survivor åºçå¤§å°æ¯å¼ï¼é»è®¤æ¯ 8ï¼åä¸¤ä¸ª survivor åºä¸ä¸ä¸ª eden åºçæ¯å¼ä¸º 2:8,ä¸ä¸ª survivor åºå æ´ä¸ªå¹´è½»ä»£ç 1/10ãè°å°è¿ä¸ªåæ°å°å¢å¤§ survivor åºï¼è®©å¯¹è±¡å°½éå¨ survitor åºåé¿ä¸ç¹ï¼åå°è¿å¥å¹´èä»£çå¯¹è±¡ãå»ææå©ç©ºé´çæ³æ³æ¯è®©å¤§é¨åä¸è½é©¬ä¸åæ¶çæ°æ®å°½å¿«è¿å¥å¹´èä»£ï¼å å¿«å¹´èä»£çåæ¶é¢çï¼åå°å¹´èä»£æ´æ¶¨çå¯è½æ§ï¼è¿ä¸ªæ¯éè¿å°-xx:survivorratio è®¾ç½®ææ¯è¾å¤§çå¼ï¼æ¯å¦ 65536)æ¥åå°ã\n * -verbose:gc -xloggc:$catalina_home/logs/gc.log å°èææºæ¯æ¬¡åå¾åæ¶çä¿¡æ¯åå°æ¥å¿æä»¶ä¸­ï¼æä»¶åç± file æå®ï¼æä»¶æ ¼å¼æ¯å¹³æä»¶ï¼åå®¹å-verbose:gc è¾åºåå®¹ç¸åã\n * -djava.awt.headless=true headless æ¨¡å¼æ¯ç³»ç»çä¸ç§éç½®æ¨¡å¼ãå¨è¯¥æ¨¡å¼ä¸ï¼ç³»ç»ç¼ºå°äºæ¾ç¤ºè®¾å¤ãé®çæé¼ æ ã\n * -xx:+printgctimestamps -xx:+printgcdetails è®¾ç½® gc æ¥å¿çæ ¼å¼\n * -dsun.rmi.dgc.server.gcinterval=600000 -dsun.rmi.dgc.client.gcinterval=600000 æå® rmi è°ç¨æ¶ gc çæ¶é´é´é\n * -xx:+useconcmarksweepgc -xx:maxtenuringthreshold=15 éç¨å¹¶å gc æ¹å¼ï¼ç»è¿ 15 æ¬¡ minor gc åè¿å¥å¹´èä»£\n\n\n# åæ gc æ¥å¿\n\nyoung gc åæ¶æ¥å¿:\n\n2016-07-05t10:43:18.093+0800: 25.395: [gc [psyounggen: 274931k->10738k(274944k)] 371093k->147186k(450048k), 0.0668480 secs] [times: user=0.17 sys=0.08, real=0.07 secs]\n\n\nfull gc åæ¶æ¥å¿:\n\n2016-07-05t10:43:18.160+0800: 25.462: [full gc [psyounggen: 10738k->0k(274944k)] [paroldgen: 136447k->140379k(302592k)] 147186k->140379k(577536k) [pspermgen: 85411k->85376k(171008k)], 0.6763541 secs] [times: user=1.75 sys=0.02, real=0.68 secs]\n\n\néè¿ä¸é¢æ¥å¿åæå¾åºï¼psyounggenãparoldgenãpspermgen å±äº parallel æ¶éå¨ãå¶ä¸­ psyounggen è¡¨ç¤º gc åæ¶ååå¹´è½»ä»£çåå­ååï¼paroldgen è¡¨ç¤º gc åæ¶ååèå¹´ä»£çåå­ååï¼pspermgen è¡¨ç¤º gc åæ¶ååæ°¸ä¹åºçåå­ååãyoung gc ä¸»è¦æ¯éå¯¹å¹´è½»ä»£è¿è¡åå­åæ¶æ¯è¾é¢ç¹ï¼èæ¶ç­ï¼full gc ä¼å¯¹æ´ä¸ªå åå­è¿è¡ååï¼èæ¶é¿ï¼å æ­¤ä¸è¬å°½éåå° full gc çæ¬¡æ°\n\néè¿ä¸¤å¼ å¾éå¸¸ææ¾çåº gc æ¥å¿ææï¼\n\nyoung gc\n\n\n\nfull gc\n\n\n\n# cpu è¿é«\n\nå®ä½æ­¥éª¤ï¼\n\nï¼1ï¼æ§è¡ top -c å½ä»¤ï¼æ¾å° cpu æé«çè¿ç¨ç id\n\nï¼2ï¼jstack pid å¯¼åº java åºç¨ç¨åºççº¿ç¨å æ ä¿¡æ¯ã\n\nç¤ºä¾ï¼\n\njstack 6795\n\n"low memory detector" daemon prio=10 tid=0x081465f8 nid=0x7 runnable [0x00000000..0x00000000]\n        "compilerthread0" daemon prio=10 tid=0x08143c58 nid=0x6 waiting on condition [0x00000000..0xfb5fd798]\n        "signal dispatcher" daemon prio=10 tid=0x08142f08 nid=0x5 waiting on condition [0x00000000..0x00000000]\n        "finalizer" daemon prio=10 tid=0x08137ca0 nid=0x4 in object.wait() [0xfbeed000..0xfbeeddb8]\n\n        at java.lang.object.wait(native method)\n\n        - waiting on <0xef600848> (a java.lang.ref.referencequeue$lock)\n\n        at java.lang.ref.referencequeue.remove(referencequeue.java:116)\n\n        - locked <0xef600848> (a java.lang.ref.referencequeue$lock)\n\n        at java.lang.ref.referencequeue.remove(referencequeue.java:132)\n\n        at java.lang.ref.finalizer$finalizerthread.run(finalizer.java:159)\n\n        "reference handler" daemon prio=10 tid=0x081370f0 nid=0x3 in object.wait() [0xfbf4a000..0xfbf4aa38]\n\n        at java.lang.object.wait(native method)\n\n        - waiting on <0xef600758> (a java.lang.ref.reference$lock)\n\n        at java.lang.object.wait(object.java:474)\n\n        at java.lang.ref.reference$referencehandler.run(reference.java:116)\n\n        - locked <0xef600758> (a java.lang.ref.reference$lock)\n\n        "vm thread" prio=10 tid=0x08134878 nid=0x2 runnable\n\n        "vm periodic task thread" prio=10 tid=0x08147768 nid=0x8 waiting on condition\n\n\nå¨æå°çå æ æ¥å¿æä»¶ä¸­ï¼tid å nid çå«ä¹ï¼\n\nnid : å¯¹åºç linux æä½ç³»ç»ä¸ç tid çº¿ç¨å·ï¼ä¹å°±æ¯åé¢è½¬åç 16 è¿å¶æ°å­\ntid: è¿ä¸ªåºè¯¥æ¯ jvm ç jmm åå­è§èä¸­çå¯ä¸å°åå®ä½\n\n\nå¨ cpu è¿é«çæåµä¸ï¼æ¥æ¾ååºççº¿ç¨ï¼ä¸è¬å®ä½é½æ¯ç¨ nid æ¥å®ä½çãèå¦æåçæ­»éä¹ç±»çé®é¢ï¼ä¸è¬ç¨ tid æ¥å®ä½ã\n\nï¼3ï¼å®ä½ cpu é«ççº¿ç¨æå°å¶ nid\n\næ¥ççº¿ç¨ä¸å·ä½è¿ç¨ä¿¡æ¯çå½ä»¤å¦ä¸ï¼\n\ntop -h -p 6735\n\ntop - 14:20:09 up 611 days,  2:56,  1 user,  load average: 13.19, 7.76, 7.82\nthreads: 6991 total,  17 running, 6974 sleeping,   0 stopped,   0 zombie\n%cpu(s): 90.4 us,  2.1 sy,  0.0 ni,  7.0 id,  0.0 wa,  0.0 hi,  0.4 si,  0.0 st\nkib mem:  32783044 total, 32505008 used,   278036 free,   120304 buffers\nkib swap:        0 total,        0 used,        0 free. 4497428 cached mem\n\n  pid user      pr  ni    virt    res    shr s %cpu %mem     time+ command\n 6800 root      20   0 27.299g 0.021t   7172 s 54.7 70.1 187:55.61 java\n 6803 root      20   0 27.299g 0.021t   7172 s 54.4 70.1 187:52.59 java\n 6798 root      20   0 27.299g 0.021t   7172 s 53.7 70.1 187:55.08 java\n 6801 root      20   0 27.299g 0.021t   7172 s 53.7 70.1 187:55.25 java\n 6797 root      20   0 27.299g 0.021t   7172 s 53.1 70.1 187:52.78 java\n 6804 root      20   0 27.299g 0.021t   7172 s 53.1 70.1 187:55.76 java\n 6802 root      20   0 27.299g 0.021t   7172 s 52.1 70.1 187:54.79 java\n 6799 root      20   0 27.299g 0.021t   7172 s 51.8 70.1 187:53.36 java\n 6807 root      20   0 27.299g 0.021t   7172 s 13.6 70.1  48:58.60 java\n11014 root      20   0 27.299g 0.021t   7172 r  8.4 70.1   8:00.32 java\n10642 root      20   0 27.299g 0.021t   7172 r  6.5 70.1   6:32.06 java\n 6808 root      20   0 27.299g 0.021t   7172 s  6.1 70.1 159:08.40 java\n11315 root      20   0 27.299g 0.021t   7172 s  3.9 70.1   5:54.10 java\n12545 root      20   0 27.299g 0.021t   7172 s  3.9 70.1   6:55.48 java\n23353 root      20   0 27.299g 0.021t   7172 s  3.9 70.1   2:20.55 java\n24868 root      20   0 27.299g 0.021t   7172 s  3.9 70.1   2:12.46 java\n 9146 root      20   0 27.299g 0.021t   7172 s  3.6 70.1   7:42.72 java\n\n\nç±æ­¤å¯ä»¥çåºå ç¨ cpu è¾é«ççº¿ç¨ï¼ä½æ¯è¿äºè¿ä¸é«ï¼æ æ³ç´æ¥å®ä½å°å·ä½çç±»ãnid æ¯ 16 è¿å¶çï¼æä»¥æä»¬è¦è·åçº¿ç¨ç 16 è¿å¶ idï¼\n\nprintf "%x\\n" 6800\n\n\nè¾åºç»æ:45cd\n\n\nç¶åæ ¹æ®è¾åºç»æå° jstack æå°çå æ æ¥å¿ä¸­æ¥å®ä½ï¼\n\n"catalina-exec-5692" daemon prio=10 tid=0x00007f3b05013800 nid=0x45cd waiting on condition [0x00007f3ae08e3000]\n   java.lang.thread.state: timed_waiting (parking)\n        at sun.misc.unsafe.park(native method)\n        - parking to wait for  <0x00000006a7800598> (a java.util.concurrent.locks.abstractqueuedsynchronizer$conditionobject)\n        at java.util.concurrent.locks.locksupport.parknanos(locksupport.java:226)\n        at java.util.concurrent.locks.abstractqueuedsynchronizer$conditionobject.awaitnanos(abstractqueuedsynchronizer.java:2082)\n        at java.util.concurrent.linkedblockingqueue.poll(linkedblockingqueue.java:467)\n        at org.apache.tomcat.util.threads.taskqueue.poll(taskqueue.java:86)\n        at org.apache.tomcat.util.threads.taskqueue.poll(taskqueue.java:32)\n        at java.util.concurrent.threadpoolexecutor.gettask(threadpoolexecutor.java:1068)\n        at java.util.concurrent.threadpoolexecutor.runworker(threadpoolexecutor.java:1130)\n        at java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:615)\n        at org.apache.tomcat.util.threads.taskthread$wrappingrunnable.run(taskthread.java:61)\n        at java.lang.thread.run(thread.java:745)\n\n\n\n# gc éç½®\n\n> è¯¦ç»åæ°è¯´æè¯·åèå®æ¹ææ¡£ï¼javahotspot vm optionsï¼è¿éä»åä¸¾å¸¸ç¨åæ°ã\n\n\n# å å¤§å°è®¾ç½®\n\nå¹´è½»ä»£çè®¾ç½®å¾å³é®ã\n\njvm ä¸­æå¤§å å¤§å°æä¸æ¹é¢éå¶ï¼\n\n 1. ç¸å³æä½ç³»ç»çæ°æ®æ¨¡åï¼32-bt è¿æ¯ 64-bitï¼éå¶ï¼\n 2. ç³»ç»çå¯ç¨èæåå­éå¶ï¼\n 3. ç³»ç»çå¯ç¨ç©çåå­éå¶ã\n\næ´ä¸ªå å¤§å° = å¹´è½»ä»£å¤§å° + å¹´èä»£å¤§å° + æä¹ä»£å¤§å°\n\n\n * æä¹ä»£ä¸è¬åºå®å¤§å°ä¸º 64mãä½¿ç¨ -xx:permsize è®¾ç½®ã\n * å®æ¹æ¨èå¹´è½»ä»£å æ´ä¸ªå ç 3/8ãä½¿ç¨ -xmn è®¾ç½®ã\n\n\n# jvm åå­éç½®\n\néç½®                  æè¿°\n-xss                èææºæ å¤§å°ã\n-xms                å ç©ºé´åå§å¼ã\n-xmx                å ç©ºé´æå¤§å¼ã\n-xmn                æ°çä»£ç©ºé´å¤§å°ã\n-xx:newsize         æ°çä»£ç©ºé´åå§å¼ã\n-xx:maxnewsize      æ°çä»£ç©ºé´æå¤§å¼ã\n-xx:newratio        æ°çä»£ä¸å¹´èä»£çæ¯ä¾ãé»è®¤ä¸º 2ï¼æå³çèå¹´ä»£æ¯æ°çä»£ç 2 åã\n-xx:survivorratio   æ°çä»£ä¸­è°æ´ eden åºä¸ survivor åºçæ¯ä¾ï¼é»è®¤ä¸º 8ãå³ eden åºä¸º 80% çå¤§å°ï¼ä¸¤ä¸ª\n                    survivor åå«ä¸º 10% çå¤§å°ã\n-xx:permsize        æ°¸ä¹ä»£ç©ºé´çåå§å¼ã\n-xx:maxpermsize     æ°¸ä¹ä»£ç©ºé´çæå¤§å¼ã\n\n\n# gc ç±»åéç½®\n\néç½®                        æè¿°\n-xx:+useserialgc          ä½¿ç¨ serial + serial old åå¾åæ¶å¨ç»å\n-xx:+useparallelgc        ä½¿ç¨ parallel scavenge + parallel old åå¾åæ¶å¨ç»å\n-xx:+useparalleloldgc     ä½¿ç¨ parallel old åå¾åæ¶å¨ï¼jdk5 åå·²æ ç¨ï¼\n-xx:+useparnewgc          ä½¿ç¨ parnew + serial old åå¾åæ¶å¨\n-xx:+useconcmarksweepgc   ä½¿ç¨ cms + parnew + serial old åå¾åæ¶å¨ç»å\n-xx:+useg1gc              ä½¿ç¨ g1 åå¾åæ¶å¨\n-xx:parallelcmsthreads    å¹¶åæ è®°æ«æåå¾åæ¶å¨ = ä¸ºä½¿ç¨ççº¿ç¨æ°é\n\n\n# åå¾åæ¶å¨éç¨åæ°\n\néç½®                       æè¿°\npretenuresizethreshold   æåå¹´èä»£çå¯¹è±¡å¤§å°ãé»è®¤ä¸º 0ãæ¯å¦è®¾ä¸º 10mï¼åè¶è¿ 10m çå¯¹è±¡å°ä¸å¨ eden åºåéï¼èç´æ¥è¿å¥å¹´èä»£ã\nmaxtenuringthreshold     æåèå¹´ä»£çæå¤§å¹´é¾ãé»è®¤ä¸º 15ãæ¯å¦è®¾ä¸º 10ï¼åå¯¹è±¡å¨ 10 æ¬¡æ®é gc åå°ä¼è¢«æ¾å¥å¹´èä»£ã\ndisableexplicitgc        ç¦ç¨ system.gc()\n\n\n# jmx\n\nå¼å¯ jmx åï¼å¯ä»¥ä½¿ç¨ jconsole æ jvisualvm è¿è¡çæ§ java ç¨åºçåºæ¬ä¿¡æ¯åè¿è¡æåµã\n\n-dcom.sun.management.jmxremote=true\n-dcom.sun.management.jmxremote.ssl=false\n-dcom.sun.management.jmxremote.authenticate=false\n-djava.rmi.server.hostname=127.0.0.1\n-dcom.sun.management.jmxremote.port=18888\n\n\n-djava.rmi.server.hostname æå® java ç¨åºè¿è¡çæå¡å¨ï¼-dcom.sun.management.jmxremote.port æå®æå¡çå¬ç«¯å£ã\n\n\n# è¿ç¨ debug\n\nå¦æå¼å¯ java åºç¨çè¿ç¨ debug åè½ï¼éè¦æå®å¦ä¸åæ°ï¼\n\n-xdebug\n-xnoagent\n-djava.compiler=none\n-xrunjdwp:transport=dt_socket,address=28888,server=y,suspend=n\n\n\naddress å³ä¸ºè¿ç¨ debug ççå¬ç«¯å£ã\n\n\n# heapdump\n\n-xx:-omitstacktraceinfastthrow -xx:+heapdumponoutofmemoryerror\n\n\n\n# è¾å©éç½®\n\néç½®                                æè¿°\n-xx:+printgcdetails               æå° gc æ¥å¿\n-xloggc:<filename>                æå® gc æ¥å¿æä»¶å\n-xx:+heapdumponoutofmemoryerror   åå­æº¢åºæ¶è¾åºå å¿«ç§æä»¶\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * ãjava æ§è½è°ä¼å®æã\n * ä»è¡¨å°éå­¦ä¹  jvm å®ç°\n * jvmï¼4ï¼ï¼jvm è°ä¼-å½ä»¤ç¯\n * java ç³»åç¬è®°(4) - jvm çæ§ä¸è°ä¼\n * java æå¡ gc åæ°è°ä¼æ¡ä¾\n * jvm è°ä¼æ»ç»ï¼5ï¼ï¼å¸åéç½®\n * å¦ä½åççè§åä¸æ¬¡ jvm æ§è½è°ä¼\n * jvm ç³»å(ä¹):å¦ä½ä¼å java gcãè¯ã\n * https://my.oschina.net/feichexia/blog/196575',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java æéè¯æ­",frontmatter:{title:"Java æéè¯æ­",date:"2020-07-30T17:56:33.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM","æéè¯æ­"],permalink:"/pages/84f329/"},regularPath:"/01.Java/01.JavaSE/06.JVM/22.Java%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD.html",relativePath:"01.Java/01.JavaSE/06.JVM/22.Javaæéè¯æ­.md",key:"v-0bede0ba",path:"/pages/84f329/",headers:[{level:2,title:"æéå®ä½æè·¯",slug:"æéå®ä½æè·¯",normalizedTitle:"æéå®ä½æè·¯",charIndex:16},{level:2,title:"CPU é®é¢",slug:"cpu-é®é¢",normalizedTitle:"cpu é®é¢",charIndex:126},{level:3,title:"æ¥æ¾ CPU å ç¨çè¾é«çè¿ç¨ãçº¿ç¨",slug:"æ¥æ¾-cpu-å ç¨çè¾é«çè¿ç¨ãçº¿ç¨",normalizedTitle:"æ¥æ¾ cpu å ç¨çè¾é«çè¿ç¨ãçº¿ç¨",charIndex:260},{level:3,title:"æ¯å¦å­å¨é¢ç¹ GC",slug:"æ¯å¦å­å¨é¢ç¹-gc",normalizedTitle:"æ¯å¦å­å¨é¢ç¹ gc",charIndex:1639},{level:3,title:"æ¯å¦å­å¨é¢ç¹ä¸ä¸æåæ¢",slug:"æ¯å¦å­å¨é¢ç¹ä¸ä¸æåæ¢",normalizedTitle:"æ¯å¦å­å¨é¢ç¹ä¸ä¸æåæ¢",charIndex:2678},{level:2,title:"åå­é®é¢",slug:"åå­é®é¢",normalizedTitle:"åå­é®é¢",charIndex:3292},{level:2,title:"ç£çé®é¢",slug:"ç£çé®é¢",normalizedTitle:"ç£çé®é¢",charIndex:3635},{level:3,title:"æ¥çç£çç©ºé´ä½¿ç¨ç",slug:"æ¥çç£çç©ºé´ä½¿ç¨ç",normalizedTitle:"æ¥çç£çç©ºé´ä½¿ç¨ç",charIndex:3644},{level:3,title:"æ¥çç£çè¯»åæ§è½",slug:"æ¥çç£çè¯»åæ§è½",normalizedTitle:"æ¥çç£çè¯»åæ§è½",charIndex:4064},{level:3,title:"æ¥çå·ä½çæä»¶è¯»åæåµ",slug:"æ¥çå·ä½çæä»¶è¯»åæåµ",normalizedTitle:"æ¥çå·ä½çæä»¶è¯»åæåµ",charIndex:4819},{level:2,title:"ç½ç»é®é¢",slug:"ç½ç»é®é¢",normalizedTitle:"ç½ç»é®é¢",charIndex:4856},{level:3,title:"æ æ³è¿æ¥",slug:"æ æ³è¿æ¥",normalizedTitle:"æ æ³è¿æ¥",charIndex:4865},{level:3,title:"ç½ç»è¶æ¶",slug:"ç½ç»è¶æ¶",normalizedTitle:"ç½ç»è¶æ¶",charIndex:4944},{level:3,title:"TCP éåæº¢åº",slug:"tcp-éåæº¢åº",normalizedTitle:"tcp éåæº¢åº",charIndex:5608},{level:3,title:"RST å¼å¸¸",slug:"rst-å¼å¸¸",normalizedTitle:"rst å¼å¸¸",charIndex:6664},{level:3,title:"TIMEWAIT å CLOSEWAIT",slug:"time-wait-å-close-wait",normalizedTitle:"timewait å closewait",charIndex:null},{level:4,title:"TIME_WAIT",slug:"time-wait",normalizedTitle:"time_wait",charIndex:7704},{level:4,title:"CLOSE_WAIT",slug:"close-wait",normalizedTitle:"close_wait",charIndex:7716},{level:2,title:"GC é®é¢",slug:"gc-é®é¢",normalizedTitle:"gc é®é¢",charIndex:1707},{level:3,title:"OOM",slug:"oom",normalizedTitle:"oom",charIndex:3331},{level:3,title:"Minor GC",slug:"minor-gc",normalizedTitle:"minor gc",charIndex:9293},{level:4,title:"Minor GC è¿é¢",slug:"minor-gc-è¿é¢",normalizedTitle:"minor gc è¿é¢",charIndex:9541},{level:4,title:"Minor GC èæ¶è¿é¿",slug:"minor-gc-èæ¶è¿é¿",normalizedTitle:"minor gc èæ¶è¿é¿",charIndex:9725},{level:3,title:"Full GC è¿é¢",slug:"full-gc-è¿é¢",normalizedTitle:"full gc è¿é¢",charIndex:9952},{level:2,title:"å¸¸ç¨ Linux å½ä»¤",slug:"å¸¸ç¨-linux-å½ä»¤",normalizedTitle:"å¸¸ç¨ linux å½ä»¤",charIndex:10712},{level:3,title:"top",slug:"top",normalizedTitle:"top",charIndex:418},{level:3,title:"vmstat",slug:"vmstat",normalizedTitle:"vmstat",charIndex:2708},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:11312}],headersStr:"æéå®ä½æè·¯ CPU é®é¢ æ¥æ¾ CPU å ç¨çè¾é«çè¿ç¨ãçº¿ç¨ æ¯å¦å­å¨é¢ç¹ GC æ¯å¦å­å¨é¢ç¹ä¸ä¸æåæ¢ åå­é®é¢ ç£çé®é¢ æ¥çç£çç©ºé´ä½¿ç¨ç æ¥çç£çè¯»åæ§è½ æ¥çå·ä½çæä»¶è¯»åæåµ ç½ç»é®é¢ æ æ³è¿æ¥ ç½ç»è¶æ¶ TCP éåæº¢åº RST å¼å¸¸ TIMEWAIT å CLOSEWAIT TIME_WAIT CLOSE_WAIT GC é®é¢ OOM Minor GC Minor GC è¿é¢ Minor GC èæ¶è¿é¿ Full GC è¿é¢ å¸¸ç¨ Linux å½ä»¤ top vmstat åèèµæ",content:"# Java æéè¯æ­\n\n\n# æéå®ä½æè·¯\n\nJava åºç¨åºç°çº¿ä¸æéï¼å¦ä½è¿è¡è¯æ­ï¼\n\næä»¬å¨å®ä½çº¿ä¸é®é¢æ¶è¦æä¸ä¸ªæ´ä½çæè·¯ï¼é¡ºè¤æ¸çï¼æè½è¾å¿«çæ¾å°é®é¢åå ã\n\nä¸è¬æ¥è¯´ï¼æå¡å¨æéè¯æ­çæ´ä½æè·¯å¦ä¸ï¼\n\n\n\nåºç¨æéè¯æ­æè·¯ï¼\n\n\n\n\n# CPU é®é¢\n\nä¸ãCPU ä½¿ç¨çè¿é«ï¼å¾å¾æ¯ç±äºç¨åºé»è¾é®é¢å¯¼è´çãå¸¸è§å¯¼è´ CPU é£åçé®é¢åºæ¯å¦ï¼æ­»å¾ªç¯ï¼æ ééå½ãé¢ç¹ GCãçº¿ç¨ä¸ä¸æåæ¢è¿å¤ã\n\näºãCPU å§ç»åä¸ä¸å»ï¼å¾å¾æ¯ç±äºç¨åºä¸­å­å¨å¤§é IO æä½å¹¶ä¸æ¶é´å¾é¿ï¼æ°æ®åºè¯»åãæ¥å¿ç­ï¼ã\n\n\n# æ¥æ¾ CPU å ç¨çè¾é«çè¿ç¨ãçº¿ç¨\n\nçº¿ä¸ç¯å¢ç Java åºç¨å¯è½æå¤ä¸ªè¿ç¨ãçº¿ç¨ï¼æä»¥ï¼è¦åæ¾å° CPU å ç¨çè¾é«çè¿ç¨ãçº¿ç¨ã\n\nï¼1ï¼ä½¿ç¨ ps å½ä»¤æ¥ç xxx åºç¨çè¿ç¨ IDï¼PIDï¼\n\nps -ef | grep xxx\n\n\nä¹å¯ä»¥ä½¿ç¨ jps å½ä»¤æ¥æ¥çã\n\nï¼2ï¼å¦æåºç¨æå¤ä¸ªè¿ç¨ï¼å¯ä»¥ç¨ top å½ä»¤æ¥çåªä¸ªå ç¨ CPU è¾é«ã\n\nï¼3ï¼ç¨ top -Hp pid æ¥æ¾å° CPU ä½¿ç¨çæ¯è¾é«çä¸äºçº¿ç¨ã\n\nï¼4ï¼å°å ç¨ CPU æé«ç PID è½¬æ¢ä¸º 16 è¿å¶ï¼ä½¿ç¨ printf '%x\\n' pid å¾å° nid\n\nï¼5ï¼ä½¿ç¨ jstack pic | grep 'nid' -C5 å½ä»¤ï¼æ¥çå æ ä¿¡æ¯ï¼\n\n$ jstack 7129 | grep '0x1c23' -C5\n        at java.lang.Object.wait(Object.java:502)\n        at java.lang.ref.Reference.tryHandlePending(Reference.java:191)\n        - locked <0x00000000b5383ff0> (a java.lang.ref.Reference$Lock)\n        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)\n\n\"main\" #1 prio=5 os_prio=0 tid=0x00007f4df400a800 nid=0x1c23 in Object.wait() [0x00007f4dfdec8000]\n   java.lang.Thread.State: WAITING (on object monitor)\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0x00000000b5384018> (a org.apache.felix.framework.util.ThreadGate)\n        at org.apache.felix.framework.util.ThreadGate.await(ThreadGate.java:79)\n        - locked <0x00000000b5384018> (a org.apache.felix.framework.util.ThreadGate)\n\n\nï¼6ï¼æ´å¸¸è§çæä½æ¯ç¨ jstack çæå æ å¿«ç§ï¼ç¶ååºäºå¿«ç§æä»¶è¿è¡åæãçæå¿«ç§å½ä»¤ï¼\n\njstack -F -l pid >> threaddump.log\n\n\nï¼7ï¼åæå æ ä¿¡æ¯\n\nä¸è¬æ¥è¯´ï¼ç¶æä¸º WAITINGãTIMED_WAITING ãBLOCKED ççº¿ç¨æ´å¯è½åºç°é®é¢ãå¯ä»¥æ§è¡ä»¥ä¸å½ä»¤æ¥ççº¿ç¨ç¶æç»è®¡ï¼\n\ncat threaddump.log | grep \"java.lang.Thread.State\" | sort -nr | uniq -c\n\n\nå¦æå­å¨å¤§é WAITINGãTIMED_WAITING ãBLOCKED ï¼é£ä¹å¤åæ¯æé®é¢å¦ã\n\n\n# æ¯å¦å­å¨é¢ç¹ GC\n\nå¦æåºç¨é¢ç¹ GCï¼ä¹å¯è½å¯¼è´ CPU é£åãä¸ºä½é¢ç¹ GC å¯ä»¥ä½¿ç¨ jstack æ¥åæé®é¢ï¼åæåè§£å³é¢ç¹ GC é®é¢ï¼å¨åç»­è®²è§£ï¼ã\n\né£ä¹ï¼å¦ä½å¤æ­ Java è¿ç¨ GC æ¯å¦é¢ç¹ï¼\n\nå¯ä»¥ä½¿ç¨ jstat -gc pid 1000 å½ä»¤æ¥è§å¯ GC ç¶æã\n\n$ jstat -gc 29527 200 5\n S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n\n\n\n# æ¯å¦å­å¨é¢ç¹ä¸ä¸æåæ¢\n\néå¯¹é¢ç¹ä¸ä¸æåæ¢é®é¢ï¼å¯ä»¥ä½¿ç¨ vmstat pid å½ä»¤æ¥è¿è¡æ¥çã\n\n$ vmstat 7129\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n 1  0   6836 737532   1588 3504956    0    0     1     4    5    3  0  0 100  0  0\n\n\nå¶ä¸­ï¼cs ä¸åä»£è¡¨äºä¸ä¸æåæ¢çæ¬¡æ°ã\n\nãè§£å³æ¹æ³ã\n\nå¦æï¼çº¿ç¨ä¸ä¸æåæ¢å¾é¢ç¹ï¼å¯ä»¥èèå¨åºç¨ä¸­éå¯¹çº¿ç¨è¿è¡ä¼åï¼æ¹æ³æï¼\n\n * æ éå¹¶åï¼å¤çº¿ç¨ç«äºæ¶ï¼ä¼å¼èµ·ä¸ä¸æåæ¢ï¼æä»¥å¤çº¿ç¨å¤çæ°æ®æ¶ï¼å¯ä»¥ç¨ä¸äºåæ³æ¥é¿åä½¿ç¨éï¼å¦å°æ°æ®ç ID æç§ Hash åæ¨¡åæ®µï¼ä¸åççº¿ç¨å¤çä¸åæ®µçæ°æ®ï¼\n * CAS ç®æ³ï¼Java ç Atomic åä½¿ç¨ CAS ç®æ³æ¥æ´æ°æ°æ®ï¼èä¸éè¦å éï¼\n * æå°çº¿ç¨ï¼é¿ååå»ºä¸éè¦ççº¿ç¨ï¼æ¯å¦ä»»å¡å¾å°ï¼ä½æ¯åå»ºäºå¾å¤çº¿ç¨æ¥å¤çï¼è¿æ ·ä¼é æå¤§éçº¿ç¨é½å¤äºç­å¾ç¶æï¼\n * ä½¿ç¨åç¨ï¼å¨åçº¿ç¨éå®ç°å¤ä»»å¡çè°åº¦ï¼å¹¶å¨åçº¿ç¨éç»´æå¤ä¸ªä»»å¡é´çåæ¢ï¼\n\n\n# åå­é®é¢\n\nåå­é®é¢è¯æ­èµ·æ¥ç¸å¯¹æ¯ CPU éº»ç¦ä¸äºï¼åºæ¯ä¹æ¯è¾å¤ãä¸»è¦åæ¬ OOMãGC é®é¢åå å¤åå­ãä¸è¬æ¥è®²ï¼æä»¬ä¼åç¨ free å½ä»¤åæ¥æ£æ¥ä¸ååå­çåç§æåµã\n\nè¯æ­åå­é®é¢ï¼ä¸è¬é¦åä¼ç¨ free å½ä»¤æ¥çä¸ä¸æºå¨çç©çåå­ä½¿ç¨æåµã\n\n$ free\n              total        used        free      shared  buff/cache   available\nMem:        8011164     3767900      735364        8804     3507900     3898568\nSwap:       5242876        6836     5236040\n\n\n\n# ç£çé®é¢\n\n\n# æ¥çç£çç©ºé´ä½¿ç¨ç\n\nå¯ä»¥ä½¿ç¨ df -hl å½ä»¤æ¥çç£çç©ºé´ä½¿ç¨çã\n\n$ df -hl\nFilesystem      Size  Used Avail Use% Mounted on\ndevtmpfs        494M     0  494M   0% /dev\ntmpfs           504M     0  504M   0% /dev/shm\ntmpfs           504M   58M  447M  12% /run\ntmpfs           504M     0  504M   0% /sys/fs/cgroup\n/dev/sda2        20G  5.7G   13G  31% /\n/dev/sda1       380M  142M  218M  40% /boot\ntmpfs           101M     0  101M   0% /run/user/0\n\n\n\n# æ¥çç£çè¯»åæ§è½\n\nå¯ä»¥ä½¿ç¨ iostat å½ä»¤æ¥çç£çè¯»åæ§è½ã\n\niostat -d -k -x\nLinux 3.10.0-327.el7.x86_64 (elk-server)        03/07/2020      _x86_64_        (4 CPU)\n\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsda               0.00     0.14    0.01    1.63     0.42   157.56   193.02     0.00    2.52   11.43    2.48   0.60   0.10\nscd0              0.00     0.00    0.00    0.00     0.00     0.00     8.00     0.00    0.27    0.27    0.00   0.27   0.00\ndm-0              0.00     0.00    0.01    1.78     0.41   157.56   177.19     0.00    2.46   12.09    2.42   0.59   0.10\ndm-1              0.00     0.00    0.00    0.00     0.00     0.00    16.95     0.00    1.04    1.04    0.00   1.02   0.00\n\n\n\n# æ¥çå·ä½çæä»¶è¯»åæåµ\n\nå¯ä»¥ä½¿ç¨ lsof -p pid å½ä»¤\n\n\n# ç½ç»é®é¢\n\n\n# æ æ³è¿æ¥\n\nå¯ä»¥éè¿ ping å½ä»¤ï¼æ¥çæ¯å¦è½è¿éã\n\néè¿ netstat -nlp | grep <port> å½ä»¤ï¼æ¥çæå¡ç«¯å£æ¯å¦å¨å·¥ä½ã\n\n\n# ç½ç»è¶æ¶\n\nç½ç»è¶æ¶é®é¢å¤§é¨ååºå¨åºç¨å±é¢ãè¶æ¶å¤§ä½å¯ä»¥åä¸ºè¿æ¥è¶æ¶åè¯»åè¶æ¶ï¼æäºä½¿ç¨è¿æ¥æ± çå®¢æ·ç«¯æ¡æ¶è¿ä¼å­å¨è·åè¿æ¥è¶æ¶åç©ºé²è¿æ¥æ¸çè¶æ¶ã\n\n * è¯»åè¶æ¶ãreadTimeout/writeTimeoutï¼æäºæ¡æ¶å«å so_timeout æè socketTimeoutï¼åæçæ¯æ°æ®è¯»åè¶æ¶ãæ³¨æè¿è¾¹çè¶æ¶å¤§é¨åæ¯æé»è¾ä¸çè¶æ¶ãsoa çè¶æ¶æçä¹æ¯è¯»è¶æ¶ãè¯»åè¶æ¶ä¸è¬é½åªéå¯¹å®¢æ·ç«¯è®¾ç½®ã\n * è¿æ¥è¶æ¶ãconnectionTimeoutï¼å®¢æ·ç«¯éå¸¸æä¸æå¡ç«¯å»ºç«è¿æ¥çæå¤§æ¶é´ãæå¡ç«¯è¿è¾¹ connectionTimeout å°±æäºäºè±å«é¨äºï¼jetty ä¸­è¡¨ç¤ºç©ºé²è¿æ¥æ¸çæ¶é´ï¼tomcat åè¡¨ç¤ºè¿æ¥ç»´æçæå¤§æ¶é´ã\n * å¶ä»ãåæ¬è¿æ¥è·åè¶æ¶ connectionAcquireTimeout åç©ºé²è¿æ¥æ¸çè¶æ¶ idleConnectionTimeoutãå¤ç¨äºä½¿ç¨è¿æ¥æ± æéåçå®¢æ·ç«¯ææå¡ç«¯æ¡æ¶ã\n\næä»¬å¨è®¾ç½®åç§è¶æ¶æ¶é´ä¸­ï¼éè¦ç¡®è®¤çæ¯å°½éä¿æå®¢æ·ç«¯çè¶æ¶å°äºæå¡ç«¯çè¶æ¶ï¼ä»¥ä¿è¯è¿æ¥æ­£å¸¸ç»æã\n\nå¨å®éå¼åä¸­ï¼æä»¬å³å¿æå¤çåºè¯¥æ¯æ¥å£çè¯»åè¶æ¶äºã\n\nå¦ä½è®¾ç½®åççæ¥å£è¶æ¶æ¯ä¸ä¸ªé®é¢ãå¦ææ¥å£è¶æ¶è®¾ç½®çè¿é¿ï¼é£ä¹æå¯è½ä¼è¿å¤å°å ç¨æå¡ç«¯ç tcp è¿æ¥ãèå¦ææ¥å£è®¾ç½®çè¿ç­ï¼é£ä¹æ¥å£è¶æ¶å°±ä¼éå¸¸é¢ç¹ã\n\næå¡ç«¯æ¥å£ææ rt éä½ï¼ä½å®¢æ·ç«¯ä»ç¶ä¸ç´è¶æ¶åæ¯å¦ä¸ä¸ªé®é¢ãè¿ä¸ªé®é¢å¶å®å¾ç®åï¼å®¢æ·ç«¯å°æå¡ç«¯çé¾è·¯åæ¬ç½ç»ä¼ è¾ãæéä»¥åæå¡å¤çç­ï¼æ¯ä¸ä¸ªç¯èé½å¯è½æ¯èæ¶çåå ã\n\n\n# TCP éåæº¢åº\n\ntcp éåæº¢åºæ¯ä¸ªç¸å¯¹åºå±çéè¯¯ï¼å®å¯è½ä¼é æè¶æ¶ãrst ç­æ´è¡¨å±çéè¯¯ãå æ­¤éè¯¯ä¹æ´éè½ï¼æä»¥æä»¬åç¬è¯´ä¸è¯´ã\n\nå¦ä¸å¾æç¤ºï¼è¿éæä¸¤ä¸ªéåï¼syns queue(åè¿æ¥éåï¼ãaccept queueï¼å¨è¿æ¥éåï¼ãä¸æ¬¡æ¡æï¼å¨ server æ¶å° client ç syn åï¼ææ¶æ¯æ¾å° syns queueï¼åå¤ syn+ack ç» clientï¼server æ¶å° client ç ackï¼å¦æè¿æ¶ accept queue æ²¡æ»¡ï¼é£å°±ä» syns queue æ¿åºæå­çä¿¡æ¯æ¾å¥ accept queue ä¸­ï¼å¦åæ tcp_abort_on_overflow æç¤ºçæ§è¡ã\n\ntcp_abort_on_overflow 0 è¡¨ç¤ºå¦æä¸æ¬¡æ¡æç¬¬ä¸æ­¥çæ¶å accept queue æ»¡äºé£ä¹ server ææ client åè¿æ¥ç ackãtcp_abort_on_overflow 1 åè¡¨ç¤ºç¬¬ä¸æ­¥çæ¶åå¦æå¨è¿æ¥éåæ»¡äºï¼server åéä¸ä¸ª rst åç» clientï¼è¡¨ç¤ºåºæè¿ä¸ªæ¡æè¿ç¨åè¿ä¸ªè¿æ¥ï¼æå³çæ¥å¿éå¯è½ä¼æå¾å¤connection reset / connection reset by peerã\n\né£ä¹å¨å®éå¼åä¸­ï¼æä»¬æä¹è½å¿«éå®ä½å° tcp éåæº¢åºå¢ï¼\n\nnetstat å½ä»¤ï¼æ§è¡ netstat -s | egrep \"listen|LISTEN\" å¦ä¸å¾æç¤ºï¼overflowed è¡¨ç¤ºå¨è¿æ¥éåæº¢åºçæ¬¡æ°ï¼sockets dropped è¡¨ç¤ºåè¿æ¥éåæº¢åºçæ¬¡æ°ã\n\nss å½ä»¤ï¼æ§è¡ ss -lnt ä¸é¢çå° Send-Q è¡¨ç¤ºç¬¬ä¸åç listen ç«¯å£ä¸çå¨è¿æ¥éåæå¤§ä¸º 5ï¼ç¬¬ä¸å Recv-Q ä¸ºå¨è¿æ¥éåå½åä½¿ç¨äºå¤å°ã\n\næ¥çæä»¬ççæä¹è®¾ç½®å¨è¿æ¥ãåè¿æ¥éåå¤§å°å§ï¼\n\nå¨è¿æ¥éåçå¤§å°åå³äº min(backlog, somaxconn)ãbacklog æ¯å¨ socket åå»ºçæ¶åä¼ å¥çï¼somaxconn æ¯ä¸ä¸ª os çº§å«çç³»ç»åæ°ãèåè¿æ¥éåçå¤§å°åå³äº max(64, /proc/sys/net/ipv4/tcp_max_syn_backlog)ã\n\nå¨æ¥å¸¸å¼åä¸­ï¼æä»¬å¾å¾ä½¿ç¨ servlet å®¹å¨ä½ä¸ºæå¡ç«¯ï¼æä»¥æä»¬ææ¶åä¹éè¦å³æ³¨å®¹å¨çè¿æ¥éåå¤§å°ãå¨ tomcat ä¸­ backlog å«åacceptCountï¼å¨ jetty éé¢åæ¯acceptQueueSizeã\n\n\n# RST å¼å¸¸\n\nRST åè¡¨ç¤ºè¿æ¥éç½®ï¼ç¨äºå³é­ä¸äºæ ç¨çè¿æ¥ï¼éå¸¸è¡¨ç¤ºå¼å¸¸å³é­ï¼åºå«äºåæ¬¡æ¥æã\n\nå¨å®éå¼åä¸­ï¼æä»¬å¾å¾ä¼çå°connection reset / connection reset by peeréè¯¯ï¼è¿ç§æåµå°±æ¯ RST åå¯¼è´çã\n\nç«¯å£ä¸å­å¨\n\nå¦æåä¸å­å¨çç«¯å£ååºå»ºç«è¿æ¥ SYN è¯·æ±ï¼é£ä¹æå¡ç«¯åç°èªå·±å¹¶æ²¡æè¿ä¸ªç«¯å£åä¼ç´æ¥è¿åä¸ä¸ª RST æ¥æï¼ç¨äºä¸­æ­è¿æ¥ã\n\nä¸»å¨ä»£æ¿ FIN ç»æ­¢è¿æ¥\n\nä¸è¬æ¥è¯´ï¼æ­£å¸¸çè¿æ¥å³é­é½æ¯éè¦éè¿ FIN æ¥æå®ç°ï¼ç¶èæä»¬ä¹å¯ä»¥ç¨ RST æ¥ææ¥ä»£æ¿ FINï¼è¡¨ç¤ºç´æ¥ç»æ­¢è¿æ¥ãå®éå¼åä¸­ï¼å¯è®¾ç½® SO_LINGER æ°å¼æ¥æ§å¶ï¼è¿ç§å¾å¾æ¯ææçï¼æ¥è·³è¿ TIMED_WAITï¼æä¾äº¤äºæçï¼ä¸é²å°±æç¨ã\n\nå®¢æ·ç«¯ææå¡ç«¯æä¸è¾¹åçäºå¼å¸¸ï¼è¯¥æ¹åå¯¹ç«¯åé RST ä»¥åç¥å³é­è¿æ¥\n\næä»¬ä¸é¢è®²ç tcp éåæº¢åºåé RST åå¶å®ä¹æ¯å±äºè¿ä¸ç§ãè¿ç§å¾å¾æ¯ç±äºæäºåå ï¼ä¸æ¹æ æ³åè½æ­£å¸¸å¤çè¯·æ±è¿æ¥äº(æ¯å¦ç¨åºå´©äºï¼éåæ»¡äº)ï¼ä»èåç¥å¦ä¸æ¹å³é­è¿æ¥ã\n\næ¥æ¶å°ç TCP æ¥æä¸å¨å·²ç¥ç TCP è¿æ¥å\n\næ¯å¦ï¼ä¸æ¹æºå¨ç±äºç½ç»å®å¨å¤ªå·® TCP æ¥æå¤±è¸ªäºï¼å¦ä¸æ¹å³é­äºè¯¥è¿æ¥ï¼ç¶åè¿äºè®¸ä¹æ¶å°äºä¹åå¤±è¸ªç TCP æ¥æï¼ä½ç±äºå¯¹åºç TCP è¿æ¥å·²ä¸å­å¨ï¼é£ä¹ä¼ç´æ¥åä¸ä¸ª RST åä»¥ä¾¿å¼å¯æ°çè¿æ¥ã\n\nä¸æ¹é¿ææªæ¶å°å¦ä¸æ¹çç¡®è®¤æ¥æï¼å¨ä¸å®æ¶é´æéä¼ æ¬¡æ°åååº RST æ¥æ\n\nè¿ç§å¤§å¤ä¹åç½ç»ç¯å¢ç¸å³äºï¼ç½ç»ç¯å¢å·®å¯è½ä¼å¯¼è´æ´å¤ç RST æ¥æã\n\nä¹åè¯´è¿ RST æ¥æå¤ä¼å¯¼è´ç¨åºæ¥éï¼å¨ä¸ä¸ªå·²å³é­çè¿æ¥ä¸è¯»æä½ä¼æ¥connection resetï¼èå¨ä¸ä¸ªå·²å³é­çè¿æ¥ä¸åæä½åä¼æ¥connection reset by peerãéå¸¸æä»¬å¯è½è¿ä¼çå°broken pipeéè¯¯ï¼è¿æ¯ç®¡éå±é¢çéè¯¯ï¼è¡¨ç¤ºå¯¹å·²å³é­çç®¡éè¿è¡è¯»åï¼å¾å¾æ¯å¨æ¶å° RSTï¼æ¥åºconnection resetéåç»§ç»­è¯»åæ°æ®æ¥çéï¼è¿ä¸ªå¨ glibc æºç æ³¨éä¸­ä¹æä»ç»ã\n\næä»¬å¨è¯æ­æéæ¶åæä¹ç¡®å®æ RST åçå­å¨å¢ï¼å½ç¶æ¯ä½¿ç¨ tcpdump å½ä»¤è¿è¡æåï¼å¹¶ä½¿ç¨ wireshark è¿è¡ç®ååæäºãtcpdump -i en0 tcp -w xxx.capï¼en0 è¡¨ç¤ºçå¬çç½å¡ã\n\næ¥ä¸æ¥æä»¬éè¿ wireshark æå¼æå°çåï¼å¯è½å°±è½çå°å¦ä¸å¾æç¤ºï¼çº¢è²çå°±è¡¨ç¤º RST åäºã\n\n\n# TIME_WAIT å CLOSE_WAIT\n\nTIME_WAIT å CLOSE_WAIT æ¯å¥ææç¸ä¿¡å¤§å®¶é½ç¥éã å¨çº¿ä¸æ¶ï¼æä»¬å¯ä»¥ç´æ¥ç¨å½ä»¤netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'æ¥æ¥ç time-wait å close_wait çæ°é\n\nç¨ ss å½ä»¤ä¼æ´å¿«ss -ant | awk '{++S[$1]} END {for(a in S) print a, S[a]}'\n\n\n\n# TIME_WAIT\n\ntime_wait çå­å¨ä¸æ¯ä¸ºäºä¸¢å¤±çæ°æ®åè¢«åé¢è¿æ¥å¤ç¨ï¼äºæ¯ä¸ºäºå¨ 2MSL çæ¶é´èå´åæ­£å¸¸å³é­è¿æ¥ãå®çå­å¨å¶å®ä¼å¤§å¤§åå° RST åçåºç°ã\n\nè¿å¤ç time_wait å¨ç­è¿æ¥é¢ç¹çåºæ¯æ¯è¾å®¹æåºç°ãè¿ç§æåµå¯ä»¥å¨æå¡ç«¯åä¸äºåæ ¸åæ°è°ä¼:\n\n#è¡¨ç¤ºå¼å¯éç¨ãåè®¸å°TIME-WAIT socketséæ°ç¨äºæ°çTCPè¿æ¥ï¼é»è®¤ä¸º0ï¼è¡¨ç¤ºå³é­\nnet.ipv4.tcp_tw_reuse = 1\n#è¡¨ç¤ºå¼å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçå¿«éåæ¶ï¼é»è®¤ä¸º0ï¼è¡¨ç¤ºå³é­\nnet.ipv4.tcp_tw_recycle = 1\n\n\nå½ç¶æä»¬ä¸è¦å¿è®°å¨ NAT ç¯å¢ä¸å ä¸ºæ¶é´æ³éä¹±å¯¼è´æ°æ®åè¢«æç»çåäºï¼å¦å¤çåæ³å°±æ¯æ¹å°tcp_max_tw_bucketsï¼è¶è¿è¿ä¸ªæ°ç time_wait é½ä¼è¢«å¹²æï¼ä¸è¿è¿ä¹ä¼å¯¼è´æ¥time wait bucket table overflowçéã\n\n# CLOSE_WAIT\n\nclose_wait å¾å¾é½æ¯å ä¸ºåºç¨ç¨åºåçæé®é¢ï¼æ²¡æå¨ ACK ååæ¬¡åèµ· FIN æ¥æãclose_wait åºç°çæ¦ççè³æ¯ time_wait è¦æ´é«ï¼åæä¹æ´ä¸¥éãå¾å¾æ¯ç±äºæä¸ªå°æ¹é»å¡ä½äºï¼æ²¡ææ­£å¸¸å³é­è¿æ¥ï¼ä»èæ¸æ¸å°æ¶èå®ææççº¿ç¨ã\n\næ³è¦å®ä½è¿ç±»é®é¢ï¼æå¥½æ¯éè¿ jstack æ¥åæçº¿ç¨å æ æ¥è¯æ­é®é¢ï¼å·ä½å¯åèä¸è¿°ç« èãè¿éä»ä¸¾ä¸ä¸ªä¾å­ã\n\nå¼ååå­¦è¯´åºç¨ä¸çº¿å CLOSE_WAIT å°±ä¸ç´å¢å¤ï¼ç´å°ææä¸ºæ­¢ï¼jstack åæ¾å°æ¯è¾å¯ççå æ æ¯å¤§é¨åçº¿ç¨é½å¡å¨äºcountdownlatch.awaitæ¹æ³ï¼æ¾å¼ååå­¦äºè§£åå¾ç¥ä½¿ç¨äºå¤çº¿ç¨ä½æ¯ç¡®æ²¡æ catch å¼å¸¸ï¼ä¿®æ¹ååç°å¼å¸¸ä»ä»æ¯æç®åçåçº§ sdk åå¸¸åºç°çclass not foundã\n\n\n# GC é®é¢\n\nGC é®é¢é¤äºå½±å CPU ä¹ä¼å½±ååå­ï¼è¯æ­æè·¯ä¹æ¯ä¸è´çã\n\nï¼1ï¼éå¸¸ï¼åä½¿ç¨ jstat æ¥æ¥çåä»£ååæåµï¼æ¯å¦ minor gc æ full gc æ¬¡æ°æ¯ä¸æ¯å¤ªé¢ç¹ãèæ¶å¤ªä¹ã\n\nçº¿ç¨éå¤ªå¤§ï¼ä¸ä¸è¢«åæ¶ GC ä¹ä¼å¼å OOMï¼å¤§é¨åå°±æ¯ä¹åè¯´ç unable to create new native threadãé¤äº jstack ç»ç»åæ dump æä»¶å¤ï¼æä»¬ä¸è¬åä¼çä¸æ»ä½çº¿ç¨ã\n\nå¯ä»¥æ§è¡ä»¥ä¸å½ä»¤ä¸­ä»»æä¸ä¸ªï¼æ²¡æ¥æ¥çå½åè¿ç¨åå»ºçæ»çº¿ç¨æ°ã\n\npstreee -p pid | wc -l\nls -l /proc/pid/task | wc -l\n\n\nå ååå­æ³æ¼æ»æ¯å GC å¼å¸¸ç¸ä¼´ãä¸è¿ GC é®é¢ä¸åªæ¯ååå­é®é¢ç¸å³ï¼è¿æå¯è½å¼èµ· CPU è´è½½ãç½ç»é®é¢ç­ç³»åå¹¶åçï¼åªæ¯ç¸å¯¹æ¥è¯´ååå­èç³»ç´§å¯äºï¼æä»¥æä»¬å¨æ­¤åç¬æ»ç»ä¸ä¸ GC ç¸å³é®é¢ã\n\næä»¬å¨ cpu ç« ä»ç»äºä½¿ç¨ jstat æ¥è·åå½å GC åä»£ååä¿¡æ¯ãèæ´å¤æ¶åï¼æä»¬æ¯éè¿ GC æ¥å¿æ¥è¯æ­é®é¢çï¼å¨å¯å¨åæ°ä¸­å ä¸-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStampsæ¥å¼å¯ GC æ¥å¿ã å¸¸è§ç Minor GCãFull GC æ¥å¿å«ä¹å¨æ­¤å°±ä¸åèµè¿°äºã\n\néå¯¹ gc æ¥å¿ï¼æä»¬å°±è½å¤§è´æ¨æ­åº Minor GC ä¸ fullGC æ¯å¦è¿äºé¢ç¹æèèæ¶è¿é¿ï¼ä»èå¯¹çä¸è¯ãæä»¬ä¸é¢å°å¯¹ G1 åå¾æ¶éå¨æ¥ååæï¼è¿è¾¹ä¹å»ºè®®å¤§å®¶ä½¿ç¨ G1-XX:+UseG1GCã\n\n\n# OOM\n\næ¥ç GC æ¥å¿ï¼å¦ææææ¾æç¤º OOM é®é¢ï¼é£å°±å¯ä»¥æ ¹æ®æç¤ºä¿¡æ¯ï¼è¾ä¸ºå¿«éçå®ä½é®é¢ã\n\n> OOM å®ä½å¯ä»¥åèï¼JVM åå­ç®¡ç ä¹ OutOfMemoryError\n\n\n# Minor GC\n\n# Minor GC è¿é¢\n\nMinor GC é¢ç¹ä¸è¬æ¯ç­å¨æç Java å°å¯¹è±¡è¾å¤ã\n\nï¼1ï¼åèèæ¯ä¸æ¯ Eden åº/æ°çä»£è®¾ç½®çå¤ªå°äºï¼çè½å¦éè¿è°æ´ -Xmnã-XX:SurvivorRatio ç­åæ°è®¾ç½®æ¥è§£å³é®é¢ã\n\nï¼2ï¼å¦æåæ°æ­£å¸¸ï¼ä½æ¯ Minor GC é¢çè¿æ¯å¤ªé«ï¼å°±éè¦ä½¿ç¨ jmap å MAT å¯¹ dump æä»¶è¿è¡è¿ä¸æ­¥è¯æ­äºã\n\n# Minor GC èæ¶è¿é¿\n\nMinor GC èæ¶è¿é¿é®é¢å°±è¦ç GC æ¥å¿éèæ¶èå¨åªä¸åäºã\n\nä»¥ G1 GC æ¥å¿ä¸ºä¾ï¼å¯ä»¥å³æ³¨ Root ScanningãObject CopyãRef Proc ç­é¶æ®µãRef Proc èæ¶é¿ï¼å°±è¦æ³¨æå¼ç¨ç¸å³çå¯¹è±¡ãRoot Scanning èæ¶é¿ï¼å°±è¦æ³¨æçº¿ç¨æ°ãè·¨ä»£å¼ç¨ãObject Copy åéè¦å³æ³¨å¯¹è±¡çå­å¨æãèä¸èæ¶åæå®éè¦æ¨ªåæ¯è¾ï¼å°±æ¯åå¶ä»é¡¹ç®æèæ­£å¸¸æ¶é´æ®µçèæ¶æ¯è¾ã\n\n\n# Full GC è¿é¢\n\nG1 ä¸­æ´å¤çè¿æ¯ mixedGCï¼ä½ mixedGC å¯ä»¥å Minor GC æè·¯ä¸æ ·å»è¯æ­ãè§¦å fullGC äºä¸è¬é½ä¼æé®é¢ï¼G1 ä¼éåä½¿ç¨ Serial æ¶éå¨æ¥å®æåå¾çæ¸çå·¥ä½ï¼æåæ¶é¿è¾¾å°ç§çº§å«ï¼å¯ä»¥è¯´æ¯åè·ªäºã\n\nfullGC çåå å¯è½åæ¬ä»¥ä¸è¿äºï¼ä»¥ååæ°è°æ´æ¹é¢çä¸äºæè·¯ï¼\n\n * å¹¶åé¶æ®µå¤±è´¥ï¼å¨å¹¶åæ è®°é¶æ®µï¼MixGC ä¹åèå¹´ä»£å°±è¢«å¡«æ»¡äºï¼é£ä¹è¿æ¶å G1 å°±ä¼æ¾å¼æ è®°å¨æãè¿ç§æåµï¼å¯è½å°±éè¦å¢å å å¤§å°ï¼æèè°æ´å¹¶åæ è®°çº¿ç¨æ°-XX:ConcGCThreadsã\n * æåå¤±è´¥ï¼å¨ GC çæ¶åæ²¡æè¶³å¤çåå­ä¾å­æ´»/æåå¯¹è±¡ä½¿ç¨ï¼æä»¥è§¦åäº Full GCãè¿æ¶åå¯ä»¥éè¿-XX:G1ReservePercentæ¥å¢å é¢çåå­ç¾åæ¯ï¼åå°-XX:InitiatingHeapOccupancyPercentæ¥æåå¯å¨æ è®°ï¼-XX:ConcGCThreadsæ¥å¢å æ è®°çº¿ç¨æ°ä¹æ¯å¯ä»¥çã\n * å¤§å¯¹è±¡åéå¤±è´¥ï¼å¤§å¯¹è±¡æ¾ä¸å°åéç region ç©ºé´è¿è¡åéï¼å°±ä¼è¿è¡ fullGCï¼è¿ç§æåµä¸å¯ä»¥å¢å¤§åå­æèå¢å¤§-XX:G1HeapRegionSizeã\n * ç¨åºä¸»å¨æ§è¡ System.gc()ï¼ä¸è¦éä¾¿åå°±å¯¹äºã\n\nå¦å¤ï¼æä»¬å¯ä»¥å¨å¯å¨åæ°ä¸­éç½®-XX:HeapDumpPath=/xxx/dump.hprofæ¥ dump fullGC ç¸å³çæä»¶ï¼å¹¶éè¿ jinfo æ¥è¿è¡ gc ååç dump\n\njinfo -flag +HeapDumpBeforeFullGC pid\njinfo -flag +HeapDumpAfterFullGC pid\n\n\nè¿æ ·å¾å° 2 ä»½ dump æä»¶ï¼å¯¹æ¯åä¸»è¦å³æ³¨è¢« gc æçé®é¢å¯¹è±¡æ¥å®ä½é®é¢ã\n\n\n# å¸¸ç¨ Linux å½ä»¤\n\nå¨æéææ¥æ¶ï¼æä¸äº Linux å½ä»¤ååæç¨ï¼å»ºè®®ææ¡ã\n\n\n# top\n\ntop å½ä»¤å¯ä»¥å®æ¶å¨æå°æ¥çç³»ç»çæ´ä½è¿è¡æåµï¼æ¯ä¸ä¸ªç»¼åäºå¤æ¹ä¿¡æ¯çæµç³»ç»æ§è½åè¿è¡ä¿¡æ¯çå®ç¨å·¥å·ã\n\néå¸¸ï¼ä¼ä½¿ç¨ top -Hp pid æ¥çå·ä½çº¿ç¨ä½¿ç¨ç³»ç»èµæºæåµã\n\n> å½ä»¤è¯¦æåèï¼http://man.linuxde.net/top\n\n\n# vmstat\n\nvmstat æ¯ä¸æ¬¾æå®éæ ·å¨æåæ¬¡æ°çåè½æ§çæµå·¥å·ï¼æä»¬å¯ä»¥çå°ï¼å®ä¸ä»å¯ä»¥ç»è®¡åå­çä½¿ç¨æåµï¼è¿å¯ä»¥è§æµå° CPU çä½¿ç¨çãswap çä½¿ç¨æåµãä½ vmstat ä¸è¬å¾å°ç¨æ¥æ¥çåå­çä½¿ç¨æåµï¼èæ¯ç»å¸¸è¢«ç¨æ¥è§å¯è¿ç¨çä¸ä¸æåæ¢ã\n\n * rï¼ç­å¾è¿è¡çè¿ç¨æ°ï¼\n * bï¼å¤äºéä¸­æ­ç¡ç ç¶æçè¿ç¨æ°ï¼\n * swpdï¼èæåå­ä½¿ç¨æåµï¼\n * freeï¼ç©ºé²çåå­ï¼\n * buffï¼ç¨æ¥ä½ä¸ºç¼å²çåå­æ°ï¼\n * siï¼ä»ç£çäº¤æ¢å°åå­çäº¤æ¢é¡µæ°éï¼\n * soï¼ä»åå­äº¤æ¢å°ç£ççäº¤æ¢é¡µæ°éï¼\n * biï¼åéå°åè®¾å¤çåæ°ï¼\n * boï¼ä»åè®¾å¤æ¥æ¶å°çåæ°ï¼\n * inï¼æ¯ç§ä¸­æ­æ°ï¼\n * csï¼æ¯ç§ä¸ä¸æåæ¢æ¬¡æ°ï¼\n * usï¼ç¨æ· CPU ä½¿ç¨æ¶é´ï¼\n * syï¼åæ ¸ CPU ç³»ç»ä½¿ç¨æ¶é´ï¼\n * idï¼ç©ºé²æ¶é´ï¼\n * waï¼ç­å¾ I/O æ¶é´ï¼\n * stï¼è¿è¡èææºçªåçæ¶é´ã\n\n\n# åèèµæ\n\n * ãJava æ§è½è°ä¼å®æã\n * JAVA çº¿ä¸æéè¯æ­å¨å¥è·¯\n * ä»å®éæ¡ä¾èè Java åºç¨ç GC ä¼å",normalizedContent:"# java æéè¯æ­\n\n\n# æéå®ä½æè·¯\n\njava åºç¨åºç°çº¿ä¸æéï¼å¦ä½è¿è¡è¯æ­ï¼\n\næä»¬å¨å®ä½çº¿ä¸é®é¢æ¶è¦æä¸ä¸ªæ´ä½çæè·¯ï¼é¡ºè¤æ¸çï¼æè½è¾å¿«çæ¾å°é®é¢åå ã\n\nä¸è¬æ¥è¯´ï¼æå¡å¨æéè¯æ­çæ´ä½æè·¯å¦ä¸ï¼\n\n\n\nåºç¨æéè¯æ­æè·¯ï¼\n\n\n\n\n# cpu é®é¢\n\nä¸ãcpu ä½¿ç¨çè¿é«ï¼å¾å¾æ¯ç±äºç¨åºé»è¾é®é¢å¯¼è´çãå¸¸è§å¯¼è´ cpu é£åçé®é¢åºæ¯å¦ï¼æ­»å¾ªç¯ï¼æ ééå½ãé¢ç¹ gcãçº¿ç¨ä¸ä¸æåæ¢è¿å¤ã\n\näºãcpu å§ç»åä¸ä¸å»ï¼å¾å¾æ¯ç±äºç¨åºä¸­å­å¨å¤§é io æä½å¹¶ä¸æ¶é´å¾é¿ï¼æ°æ®åºè¯»åãæ¥å¿ç­ï¼ã\n\n\n# æ¥æ¾ cpu å ç¨çè¾é«çè¿ç¨ãçº¿ç¨\n\nçº¿ä¸ç¯å¢ç java åºç¨å¯è½æå¤ä¸ªè¿ç¨ãçº¿ç¨ï¼æä»¥ï¼è¦åæ¾å° cpu å ç¨çè¾é«çè¿ç¨ãçº¿ç¨ã\n\nï¼1ï¼ä½¿ç¨ ps å½ä»¤æ¥ç xxx åºç¨çè¿ç¨ idï¼pidï¼\n\nps -ef | grep xxx\n\n\nä¹å¯ä»¥ä½¿ç¨ jps å½ä»¤æ¥æ¥çã\n\nï¼2ï¼å¦æåºç¨æå¤ä¸ªè¿ç¨ï¼å¯ä»¥ç¨ top å½ä»¤æ¥çåªä¸ªå ç¨ cpu è¾é«ã\n\nï¼3ï¼ç¨ top -hp pid æ¥æ¾å° cpu ä½¿ç¨çæ¯è¾é«çä¸äºçº¿ç¨ã\n\nï¼4ï¼å°å ç¨ cpu æé«ç pid è½¬æ¢ä¸º 16 è¿å¶ï¼ä½¿ç¨ printf '%x\\n' pid å¾å° nid\n\nï¼5ï¼ä½¿ç¨ jstack pic | grep 'nid' -c5 å½ä»¤ï¼æ¥çå æ ä¿¡æ¯ï¼\n\n$ jstack 7129 | grep '0x1c23' -c5\n        at java.lang.object.wait(object.java:502)\n        at java.lang.ref.reference.tryhandlepending(reference.java:191)\n        - locked <0x00000000b5383ff0> (a java.lang.ref.reference$lock)\n        at java.lang.ref.reference$referencehandler.run(reference.java:153)\n\n\"main\" #1 prio=5 os_prio=0 tid=0x00007f4df400a800 nid=0x1c23 in object.wait() [0x00007f4dfdec8000]\n   java.lang.thread.state: waiting (on object monitor)\n        at java.lang.object.wait(native method)\n        - waiting on <0x00000000b5384018> (a org.apache.felix.framework.util.threadgate)\n        at org.apache.felix.framework.util.threadgate.await(threadgate.java:79)\n        - locked <0x00000000b5384018> (a org.apache.felix.framework.util.threadgate)\n\n\nï¼6ï¼æ´å¸¸è§çæä½æ¯ç¨ jstack çæå æ å¿«ç§ï¼ç¶ååºäºå¿«ç§æä»¶è¿è¡åæãçæå¿«ç§å½ä»¤ï¼\n\njstack -f -l pid >> threaddump.log\n\n\nï¼7ï¼åæå æ ä¿¡æ¯\n\nä¸è¬æ¥è¯´ï¼ç¶æä¸º waitingãtimed_waiting ãblocked ççº¿ç¨æ´å¯è½åºç°é®é¢ãå¯ä»¥æ§è¡ä»¥ä¸å½ä»¤æ¥ççº¿ç¨ç¶æç»è®¡ï¼\n\ncat threaddump.log | grep \"java.lang.thread.state\" | sort -nr | uniq -c\n\n\nå¦æå­å¨å¤§é waitingãtimed_waiting ãblocked ï¼é£ä¹å¤åæ¯æé®é¢å¦ã\n\n\n# æ¯å¦å­å¨é¢ç¹ gc\n\nå¦æåºç¨é¢ç¹ gcï¼ä¹å¯è½å¯¼è´ cpu é£åãä¸ºä½é¢ç¹ gc å¯ä»¥ä½¿ç¨ jstack æ¥åæé®é¢ï¼åæåè§£å³é¢ç¹ gc é®é¢ï¼å¨åç»­è®²è§£ï¼ã\n\né£ä¹ï¼å¦ä½å¤æ­ java è¿ç¨ gc æ¯å¦é¢ç¹ï¼\n\nå¯ä»¥ä½¿ç¨ jstat -gc pid 1000 å½ä»¤æ¥è§å¯ gc ç¶æã\n\n$ jstat -gc 29527 200 5\n s0c    s1c    s0u    s1u      ec       eu        oc         ou       mc     mu    ccsc   ccsu   ygc     ygct    fgc    fgct     gct\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n22528.0 22016.0  0.0   21388.2 4106752.0 921244.7 5592576.0  2086826.5  110716.0 103441.1 12416.0 11167.7   3189   90.057  10      2.140   92.197\n\n\n\n# æ¯å¦å­å¨é¢ç¹ä¸ä¸æåæ¢\n\néå¯¹é¢ç¹ä¸ä¸æåæ¢é®é¢ï¼å¯ä»¥ä½¿ç¨ vmstat pid å½ä»¤æ¥è¿è¡æ¥çã\n\n$ vmstat 7129\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n 1  0   6836 737532   1588 3504956    0    0     1     4    5    3  0  0 100  0  0\n\n\nå¶ä¸­ï¼cs ä¸åä»£è¡¨äºä¸ä¸æåæ¢çæ¬¡æ°ã\n\nãè§£å³æ¹æ³ã\n\nå¦æï¼çº¿ç¨ä¸ä¸æåæ¢å¾é¢ç¹ï¼å¯ä»¥èèå¨åºç¨ä¸­éå¯¹çº¿ç¨è¿è¡ä¼åï¼æ¹æ³æï¼\n\n * æ éå¹¶åï¼å¤çº¿ç¨ç«äºæ¶ï¼ä¼å¼èµ·ä¸ä¸æåæ¢ï¼æä»¥å¤çº¿ç¨å¤çæ°æ®æ¶ï¼å¯ä»¥ç¨ä¸äºåæ³æ¥é¿åä½¿ç¨éï¼å¦å°æ°æ®ç id æç§ hash åæ¨¡åæ®µï¼ä¸åççº¿ç¨å¤çä¸åæ®µçæ°æ®ï¼\n * cas ç®æ³ï¼java ç atomic åä½¿ç¨ cas ç®æ³æ¥æ´æ°æ°æ®ï¼èä¸éè¦å éï¼\n * æå°çº¿ç¨ï¼é¿ååå»ºä¸éè¦ççº¿ç¨ï¼æ¯å¦ä»»å¡å¾å°ï¼ä½æ¯åå»ºäºå¾å¤çº¿ç¨æ¥å¤çï¼è¿æ ·ä¼é æå¤§éçº¿ç¨é½å¤äºç­å¾ç¶æï¼\n * ä½¿ç¨åç¨ï¼å¨åçº¿ç¨éå®ç°å¤ä»»å¡çè°åº¦ï¼å¹¶å¨åçº¿ç¨éç»´æå¤ä¸ªä»»å¡é´çåæ¢ï¼\n\n\n# åå­é®é¢\n\nåå­é®é¢è¯æ­èµ·æ¥ç¸å¯¹æ¯ cpu éº»ç¦ä¸äºï¼åºæ¯ä¹æ¯è¾å¤ãä¸»è¦åæ¬ oomãgc é®é¢åå å¤åå­ãä¸è¬æ¥è®²ï¼æä»¬ä¼åç¨ free å½ä»¤åæ¥æ£æ¥ä¸ååå­çåç§æåµã\n\nè¯æ­åå­é®é¢ï¼ä¸è¬é¦åä¼ç¨ free å½ä»¤æ¥çä¸ä¸æºå¨çç©çåå­ä½¿ç¨æåµã\n\n$ free\n              total        used        free      shared  buff/cache   available\nmem:        8011164     3767900      735364        8804     3507900     3898568\nswap:       5242876        6836     5236040\n\n\n\n# ç£çé®é¢\n\n\n# æ¥çç£çç©ºé´ä½¿ç¨ç\n\nå¯ä»¥ä½¿ç¨ df -hl å½ä»¤æ¥çç£çç©ºé´ä½¿ç¨çã\n\n$ df -hl\nfilesystem      size  used avail use% mounted on\ndevtmpfs        494m     0  494m   0% /dev\ntmpfs           504m     0  504m   0% /dev/shm\ntmpfs           504m   58m  447m  12% /run\ntmpfs           504m     0  504m   0% /sys/fs/cgroup\n/dev/sda2        20g  5.7g   13g  31% /\n/dev/sda1       380m  142m  218m  40% /boot\ntmpfs           101m     0  101m   0% /run/user/0\n\n\n\n# æ¥çç£çè¯»åæ§è½\n\nå¯ä»¥ä½¿ç¨ iostat å½ä»¤æ¥çç£çè¯»åæ§è½ã\n\niostat -d -k -x\nlinux 3.10.0-327.el7.x86_64 (elk-server)        03/07/2020      _x86_64_        (4 cpu)\n\ndevice:         rrqm/s   wrqm/s     r/s     w/s    rkb/s    wkb/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsda               0.00     0.14    0.01    1.63     0.42   157.56   193.02     0.00    2.52   11.43    2.48   0.60   0.10\nscd0              0.00     0.00    0.00    0.00     0.00     0.00     8.00     0.00    0.27    0.27    0.00   0.27   0.00\ndm-0              0.00     0.00    0.01    1.78     0.41   157.56   177.19     0.00    2.46   12.09    2.42   0.59   0.10\ndm-1              0.00     0.00    0.00    0.00     0.00     0.00    16.95     0.00    1.04    1.04    0.00   1.02   0.00\n\n\n\n# æ¥çå·ä½çæä»¶è¯»åæåµ\n\nå¯ä»¥ä½¿ç¨ lsof -p pid å½ä»¤\n\n\n# ç½ç»é®é¢\n\n\n# æ æ³è¿æ¥\n\nå¯ä»¥éè¿ ping å½ä»¤ï¼æ¥çæ¯å¦è½è¿éã\n\néè¿ netstat -nlp | grep <port> å½ä»¤ï¼æ¥çæå¡ç«¯å£æ¯å¦å¨å·¥ä½ã\n\n\n# ç½ç»è¶æ¶\n\nç½ç»è¶æ¶é®é¢å¤§é¨ååºå¨åºç¨å±é¢ãè¶æ¶å¤§ä½å¯ä»¥åä¸ºè¿æ¥è¶æ¶åè¯»åè¶æ¶ï¼æäºä½¿ç¨è¿æ¥æ± çå®¢æ·ç«¯æ¡æ¶è¿ä¼å­å¨è·åè¿æ¥è¶æ¶åç©ºé²è¿æ¥æ¸çè¶æ¶ã\n\n * è¯»åè¶æ¶ãreadtimeout/writetimeoutï¼æäºæ¡æ¶å«å so_timeout æè sockettimeoutï¼åæçæ¯æ°æ®è¯»åè¶æ¶ãæ³¨æè¿è¾¹çè¶æ¶å¤§é¨åæ¯æé»è¾ä¸çè¶æ¶ãsoa çè¶æ¶æçä¹æ¯è¯»è¶æ¶ãè¯»åè¶æ¶ä¸è¬é½åªéå¯¹å®¢æ·ç«¯è®¾ç½®ã\n * è¿æ¥è¶æ¶ãconnectiontimeoutï¼å®¢æ·ç«¯éå¸¸æä¸æå¡ç«¯å»ºç«è¿æ¥çæå¤§æ¶é´ãæå¡ç«¯è¿è¾¹ connectiontimeout å°±æäºäºè±å«é¨äºï¼jetty ä¸­è¡¨ç¤ºç©ºé²è¿æ¥æ¸çæ¶é´ï¼tomcat åè¡¨ç¤ºè¿æ¥ç»´æçæå¤§æ¶é´ã\n * å¶ä»ãåæ¬è¿æ¥è·åè¶æ¶ connectionacquiretimeout åç©ºé²è¿æ¥æ¸çè¶æ¶ idleconnectiontimeoutãå¤ç¨äºä½¿ç¨è¿æ¥æ± æéåçå®¢æ·ç«¯ææå¡ç«¯æ¡æ¶ã\n\næä»¬å¨è®¾ç½®åç§è¶æ¶æ¶é´ä¸­ï¼éè¦ç¡®è®¤çæ¯å°½éä¿æå®¢æ·ç«¯çè¶æ¶å°äºæå¡ç«¯çè¶æ¶ï¼ä»¥ä¿è¯è¿æ¥æ­£å¸¸ç»æã\n\nå¨å®éå¼åä¸­ï¼æä»¬å³å¿æå¤çåºè¯¥æ¯æ¥å£çè¯»åè¶æ¶äºã\n\nå¦ä½è®¾ç½®åççæ¥å£è¶æ¶æ¯ä¸ä¸ªé®é¢ãå¦ææ¥å£è¶æ¶è®¾ç½®çè¿é¿ï¼é£ä¹æå¯è½ä¼è¿å¤å°å ç¨æå¡ç«¯ç tcp è¿æ¥ãèå¦ææ¥å£è®¾ç½®çè¿ç­ï¼é£ä¹æ¥å£è¶æ¶å°±ä¼éå¸¸é¢ç¹ã\n\næå¡ç«¯æ¥å£ææ rt éä½ï¼ä½å®¢æ·ç«¯ä»ç¶ä¸ç´è¶æ¶åæ¯å¦ä¸ä¸ªé®é¢ãè¿ä¸ªé®é¢å¶å®å¾ç®åï¼å®¢æ·ç«¯å°æå¡ç«¯çé¾è·¯åæ¬ç½ç»ä¼ è¾ãæéä»¥åæå¡å¤çç­ï¼æ¯ä¸ä¸ªç¯èé½å¯è½æ¯èæ¶çåå ã\n\n\n# tcp éåæº¢åº\n\ntcp éåæº¢åºæ¯ä¸ªç¸å¯¹åºå±çéè¯¯ï¼å®å¯è½ä¼é æè¶æ¶ãrst ç­æ´è¡¨å±çéè¯¯ãå æ­¤éè¯¯ä¹æ´éè½ï¼æä»¥æä»¬åç¬è¯´ä¸è¯´ã\n\nå¦ä¸å¾æç¤ºï¼è¿éæä¸¤ä¸ªéåï¼syns queue(åè¿æ¥éåï¼ãaccept queueï¼å¨è¿æ¥éåï¼ãä¸æ¬¡æ¡æï¼å¨ server æ¶å° client ç syn åï¼ææ¶æ¯æ¾å° syns queueï¼åå¤ syn+ack ç» clientï¼server æ¶å° client ç ackï¼å¦æè¿æ¶ accept queue æ²¡æ»¡ï¼é£å°±ä» syns queue æ¿åºæå­çä¿¡æ¯æ¾å¥ accept queue ä¸­ï¼å¦åæ tcp_abort_on_overflow æç¤ºçæ§è¡ã\n\ntcp_abort_on_overflow 0 è¡¨ç¤ºå¦æä¸æ¬¡æ¡æç¬¬ä¸æ­¥çæ¶å accept queue æ»¡äºé£ä¹ server ææ client åè¿æ¥ç ackãtcp_abort_on_overflow 1 åè¡¨ç¤ºç¬¬ä¸æ­¥çæ¶åå¦æå¨è¿æ¥éåæ»¡äºï¼server åéä¸ä¸ª rst åç» clientï¼è¡¨ç¤ºåºæè¿ä¸ªæ¡æè¿ç¨åè¿ä¸ªè¿æ¥ï¼æå³çæ¥å¿éå¯è½ä¼æå¾å¤connection reset / connection reset by peerã\n\né£ä¹å¨å®éå¼åä¸­ï¼æä»¬æä¹è½å¿«éå®ä½å° tcp éåæº¢åºå¢ï¼\n\nnetstat å½ä»¤ï¼æ§è¡ netstat -s | egrep \"listen|listen\" å¦ä¸å¾æç¤ºï¼overflowed è¡¨ç¤ºå¨è¿æ¥éåæº¢åºçæ¬¡æ°ï¼sockets dropped è¡¨ç¤ºåè¿æ¥éåæº¢åºçæ¬¡æ°ã\n\nss å½ä»¤ï¼æ§è¡ ss -lnt ä¸é¢çå° send-q è¡¨ç¤ºç¬¬ä¸åç listen ç«¯å£ä¸çå¨è¿æ¥éåæå¤§ä¸º 5ï¼ç¬¬ä¸å recv-q ä¸ºå¨è¿æ¥éåå½åä½¿ç¨äºå¤å°ã\n\næ¥çæä»¬ççæä¹è®¾ç½®å¨è¿æ¥ãåè¿æ¥éåå¤§å°å§ï¼\n\nå¨è¿æ¥éåçå¤§å°åå³äº min(backlog, somaxconn)ãbacklog æ¯å¨ socket åå»ºçæ¶åä¼ å¥çï¼somaxconn æ¯ä¸ä¸ª os çº§å«çç³»ç»åæ°ãèåè¿æ¥éåçå¤§å°åå³äº max(64, /proc/sys/net/ipv4/tcp_max_syn_backlog)ã\n\nå¨æ¥å¸¸å¼åä¸­ï¼æä»¬å¾å¾ä½¿ç¨ servlet å®¹å¨ä½ä¸ºæå¡ç«¯ï¼æä»¥æä»¬ææ¶åä¹éè¦å³æ³¨å®¹å¨çè¿æ¥éåå¤§å°ãå¨ tomcat ä¸­ backlog å«åacceptcountï¼å¨ jetty éé¢åæ¯acceptqueuesizeã\n\n\n# rst å¼å¸¸\n\nrst åè¡¨ç¤ºè¿æ¥éç½®ï¼ç¨äºå³é­ä¸äºæ ç¨çè¿æ¥ï¼éå¸¸è¡¨ç¤ºå¼å¸¸å³é­ï¼åºå«äºåæ¬¡æ¥æã\n\nå¨å®éå¼åä¸­ï¼æä»¬å¾å¾ä¼çå°connection reset / connection reset by peeréè¯¯ï¼è¿ç§æåµå°±æ¯ rst åå¯¼è´çã\n\nç«¯å£ä¸å­å¨\n\nå¦æåä¸å­å¨çç«¯å£ååºå»ºç«è¿æ¥ syn è¯·æ±ï¼é£ä¹æå¡ç«¯åç°èªå·±å¹¶æ²¡æè¿ä¸ªç«¯å£åä¼ç´æ¥è¿åä¸ä¸ª rst æ¥æï¼ç¨äºä¸­æ­è¿æ¥ã\n\nä¸»å¨ä»£æ¿ fin ç»æ­¢è¿æ¥\n\nä¸è¬æ¥è¯´ï¼æ­£å¸¸çè¿æ¥å³é­é½æ¯éè¦éè¿ fin æ¥æå®ç°ï¼ç¶èæä»¬ä¹å¯ä»¥ç¨ rst æ¥ææ¥ä»£æ¿ finï¼è¡¨ç¤ºç´æ¥ç»æ­¢è¿æ¥ãå®éå¼åä¸­ï¼å¯è®¾ç½® so_linger æ°å¼æ¥æ§å¶ï¼è¿ç§å¾å¾æ¯ææçï¼æ¥è·³è¿ timed_waitï¼æä¾äº¤äºæçï¼ä¸é²å°±æç¨ã\n\nå®¢æ·ç«¯ææå¡ç«¯æä¸è¾¹åçäºå¼å¸¸ï¼è¯¥æ¹åå¯¹ç«¯åé rst ä»¥åç¥å³é­è¿æ¥\n\næä»¬ä¸é¢è®²ç tcp éåæº¢åºåé rst åå¶å®ä¹æ¯å±äºè¿ä¸ç§ãè¿ç§å¾å¾æ¯ç±äºæäºåå ï¼ä¸æ¹æ æ³åè½æ­£å¸¸å¤çè¯·æ±è¿æ¥äº(æ¯å¦ç¨åºå´©äºï¼éåæ»¡äº)ï¼ä»èåç¥å¦ä¸æ¹å³é­è¿æ¥ã\n\næ¥æ¶å°ç tcp æ¥æä¸å¨å·²ç¥ç tcp è¿æ¥å\n\næ¯å¦ï¼ä¸æ¹æºå¨ç±äºç½ç»å®å¨å¤ªå·® tcp æ¥æå¤±è¸ªäºï¼å¦ä¸æ¹å³é­äºè¯¥è¿æ¥ï¼ç¶åè¿äºè®¸ä¹æ¶å°äºä¹åå¤±è¸ªç tcp æ¥æï¼ä½ç±äºå¯¹åºç tcp è¿æ¥å·²ä¸å­å¨ï¼é£ä¹ä¼ç´æ¥åä¸ä¸ª rst åä»¥ä¾¿å¼å¯æ°çè¿æ¥ã\n\nä¸æ¹é¿ææªæ¶å°å¦ä¸æ¹çç¡®è®¤æ¥æï¼å¨ä¸å®æ¶é´æéä¼ æ¬¡æ°åååº rst æ¥æ\n\nè¿ç§å¤§å¤ä¹åç½ç»ç¯å¢ç¸å³äºï¼ç½ç»ç¯å¢å·®å¯è½ä¼å¯¼è´æ´å¤ç rst æ¥æã\n\nä¹åè¯´è¿ rst æ¥æå¤ä¼å¯¼è´ç¨åºæ¥éï¼å¨ä¸ä¸ªå·²å³é­çè¿æ¥ä¸è¯»æä½ä¼æ¥connection resetï¼èå¨ä¸ä¸ªå·²å³é­çè¿æ¥ä¸åæä½åä¼æ¥connection reset by peerãéå¸¸æä»¬å¯è½è¿ä¼çå°broken pipeéè¯¯ï¼è¿æ¯ç®¡éå±é¢çéè¯¯ï¼è¡¨ç¤ºå¯¹å·²å³é­çç®¡éè¿è¡è¯»åï¼å¾å¾æ¯å¨æ¶å° rstï¼æ¥åºconnection resetéåç»§ç»­è¯»åæ°æ®æ¥çéï¼è¿ä¸ªå¨ glibc æºç æ³¨éä¸­ä¹æä»ç»ã\n\næä»¬å¨è¯æ­æéæ¶åæä¹ç¡®å®æ rst åçå­å¨å¢ï¼å½ç¶æ¯ä½¿ç¨ tcpdump å½ä»¤è¿è¡æåï¼å¹¶ä½¿ç¨ wireshark è¿è¡ç®ååæäºãtcpdump -i en0 tcp -w xxx.capï¼en0 è¡¨ç¤ºçå¬çç½å¡ã\n\næ¥ä¸æ¥æä»¬éè¿ wireshark æå¼æå°çåï¼å¯è½å°±è½çå°å¦ä¸å¾æç¤ºï¼çº¢è²çå°±è¡¨ç¤º rst åäºã\n\n\n# time_wait å close_wait\n\ntime_wait å close_wait æ¯å¥ææç¸ä¿¡å¤§å®¶é½ç¥éã å¨çº¿ä¸æ¶ï¼æä»¬å¯ä»¥ç´æ¥ç¨å½ä»¤netstat -n | awk '/^tcp/ {++s[$nf]} end {for(a in s) print a, s[a]}'æ¥æ¥ç time-wait å close_wait çæ°é\n\nç¨ ss å½ä»¤ä¼æ´å¿«ss -ant | awk '{++s[$1]} end {for(a in s) print a, s[a]}'\n\n\n\n# time_wait\n\ntime_wait çå­å¨ä¸æ¯ä¸ºäºä¸¢å¤±çæ°æ®åè¢«åé¢è¿æ¥å¤ç¨ï¼äºæ¯ä¸ºäºå¨ 2msl çæ¶é´èå´åæ­£å¸¸å³é­è¿æ¥ãå®çå­å¨å¶å®ä¼å¤§å¤§åå° rst åçåºç°ã\n\nè¿å¤ç time_wait å¨ç­è¿æ¥é¢ç¹çåºæ¯æ¯è¾å®¹æåºç°ãè¿ç§æåµå¯ä»¥å¨æå¡ç«¯åä¸äºåæ ¸åæ°è°ä¼:\n\n#è¡¨ç¤ºå¼å¯éç¨ãåè®¸å°time-wait socketséæ°ç¨äºæ°çtcpè¿æ¥ï¼é»è®¤ä¸º0ï¼è¡¨ç¤ºå³é­\nnet.ipv4.tcp_tw_reuse = 1\n#è¡¨ç¤ºå¼å¯tcpè¿æ¥ä¸­time-wait socketsçå¿«éåæ¶ï¼é»è®¤ä¸º0ï¼è¡¨ç¤ºå³é­\nnet.ipv4.tcp_tw_recycle = 1\n\n\nå½ç¶æä»¬ä¸è¦å¿è®°å¨ nat ç¯å¢ä¸å ä¸ºæ¶é´æ³éä¹±å¯¼è´æ°æ®åè¢«æç»çåäºï¼å¦å¤çåæ³å°±æ¯æ¹å°tcp_max_tw_bucketsï¼è¶è¿è¿ä¸ªæ°ç time_wait é½ä¼è¢«å¹²æï¼ä¸è¿è¿ä¹ä¼å¯¼è´æ¥time wait bucket table overflowçéã\n\n# close_wait\n\nclose_wait å¾å¾é½æ¯å ä¸ºåºç¨ç¨åºåçæé®é¢ï¼æ²¡æå¨ ack ååæ¬¡åèµ· fin æ¥æãclose_wait åºç°çæ¦ççè³æ¯ time_wait è¦æ´é«ï¼åæä¹æ´ä¸¥éãå¾å¾æ¯ç±äºæä¸ªå°æ¹é»å¡ä½äºï¼æ²¡ææ­£å¸¸å³é­è¿æ¥ï¼ä»èæ¸æ¸å°æ¶èå®ææççº¿ç¨ã\n\næ³è¦å®ä½è¿ç±»é®é¢ï¼æå¥½æ¯éè¿ jstack æ¥åæçº¿ç¨å æ æ¥è¯æ­é®é¢ï¼å·ä½å¯åèä¸è¿°ç« èãè¿éä»ä¸¾ä¸ä¸ªä¾å­ã\n\nå¼ååå­¦è¯´åºç¨ä¸çº¿å close_wait å°±ä¸ç´å¢å¤ï¼ç´å°ææä¸ºæ­¢ï¼jstack åæ¾å°æ¯è¾å¯ççå æ æ¯å¤§é¨åçº¿ç¨é½å¡å¨äºcountdownlatch.awaitæ¹æ³ï¼æ¾å¼ååå­¦äºè§£åå¾ç¥ä½¿ç¨äºå¤çº¿ç¨ä½æ¯ç¡®æ²¡æ catch å¼å¸¸ï¼ä¿®æ¹ååç°å¼å¸¸ä»ä»æ¯æç®åçåçº§ sdk åå¸¸åºç°çclass not foundã\n\n\n# gc é®é¢\n\ngc é®é¢é¤äºå½±å cpu ä¹ä¼å½±ååå­ï¼è¯æ­æè·¯ä¹æ¯ä¸è´çã\n\nï¼1ï¼éå¸¸ï¼åä½¿ç¨ jstat æ¥æ¥çåä»£ååæåµï¼æ¯å¦ minor gc æ full gc æ¬¡æ°æ¯ä¸æ¯å¤ªé¢ç¹ãèæ¶å¤ªä¹ã\n\nçº¿ç¨éå¤ªå¤§ï¼ä¸ä¸è¢«åæ¶ gc ä¹ä¼å¼å oomï¼å¤§é¨åå°±æ¯ä¹åè¯´ç unable to create new native threadãé¤äº jstack ç»ç»åæ dump æä»¶å¤ï¼æä»¬ä¸è¬åä¼çä¸æ»ä½çº¿ç¨ã\n\nå¯ä»¥æ§è¡ä»¥ä¸å½ä»¤ä¸­ä»»æä¸ä¸ªï¼æ²¡æ¥æ¥çå½åè¿ç¨åå»ºçæ»çº¿ç¨æ°ã\n\npstreee -p pid | wc -l\nls -l /proc/pid/task | wc -l\n\n\nå ååå­æ³æ¼æ»æ¯å gc å¼å¸¸ç¸ä¼´ãä¸è¿ gc é®é¢ä¸åªæ¯ååå­é®é¢ç¸å³ï¼è¿æå¯è½å¼èµ· cpu è´è½½ãç½ç»é®é¢ç­ç³»åå¹¶åçï¼åªæ¯ç¸å¯¹æ¥è¯´ååå­èç³»ç´§å¯äºï¼æä»¥æä»¬å¨æ­¤åç¬æ»ç»ä¸ä¸ gc ç¸å³é®é¢ã\n\næä»¬å¨ cpu ç« ä»ç»äºä½¿ç¨ jstat æ¥è·åå½å gc åä»£ååä¿¡æ¯ãèæ´å¤æ¶åï¼æä»¬æ¯éè¿ gc æ¥å¿æ¥è¯æ­é®é¢çï¼å¨å¯å¨åæ°ä¸­å ä¸-verbose:gc -xx:+printgcdetails -xx:+printgcdatestamps -xx:+printgctimestampsæ¥å¼å¯ gc æ¥å¿ã å¸¸è§ç minor gcãfull gc æ¥å¿å«ä¹å¨æ­¤å°±ä¸åèµè¿°äºã\n\néå¯¹ gc æ¥å¿ï¼æä»¬å°±è½å¤§è´æ¨æ­åº minor gc ä¸ fullgc æ¯å¦è¿äºé¢ç¹æèèæ¶è¿é¿ï¼ä»èå¯¹çä¸è¯ãæä»¬ä¸é¢å°å¯¹ g1 åå¾æ¶éå¨æ¥ååæï¼è¿è¾¹ä¹å»ºè®®å¤§å®¶ä½¿ç¨ g1-xx:+useg1gcã\n\n\n# oom\n\næ¥ç gc æ¥å¿ï¼å¦ææææ¾æç¤º oom é®é¢ï¼é£å°±å¯ä»¥æ ¹æ®æç¤ºä¿¡æ¯ï¼è¾ä¸ºå¿«éçå®ä½é®é¢ã\n\n> oom å®ä½å¯ä»¥åèï¼jvm åå­ç®¡ç ä¹ outofmemoryerror\n\n\n# minor gc\n\n# minor gc è¿é¢\n\nminor gc é¢ç¹ä¸è¬æ¯ç­å¨æç java å°å¯¹è±¡è¾å¤ã\n\nï¼1ï¼åèèæ¯ä¸æ¯ eden åº/æ°çä»£è®¾ç½®çå¤ªå°äºï¼çè½å¦éè¿è°æ´ -xmnã-xx:survivorratio ç­åæ°è®¾ç½®æ¥è§£å³é®é¢ã\n\nï¼2ï¼å¦æåæ°æ­£å¸¸ï¼ä½æ¯ minor gc é¢çè¿æ¯å¤ªé«ï¼å°±éè¦ä½¿ç¨ jmap å mat å¯¹ dump æä»¶è¿è¡è¿ä¸æ­¥è¯æ­äºã\n\n# minor gc èæ¶è¿é¿\n\nminor gc èæ¶è¿é¿é®é¢å°±è¦ç gc æ¥å¿éèæ¶èå¨åªä¸åäºã\n\nä»¥ g1 gc æ¥å¿ä¸ºä¾ï¼å¯ä»¥å³æ³¨ root scanningãobject copyãref proc ç­é¶æ®µãref proc èæ¶é¿ï¼å°±è¦æ³¨æå¼ç¨ç¸å³çå¯¹è±¡ãroot scanning èæ¶é¿ï¼å°±è¦æ³¨æçº¿ç¨æ°ãè·¨ä»£å¼ç¨ãobject copy åéè¦å³æ³¨å¯¹è±¡çå­å¨æãèä¸èæ¶åæå®éè¦æ¨ªåæ¯è¾ï¼å°±æ¯åå¶ä»é¡¹ç®æèæ­£å¸¸æ¶é´æ®µçèæ¶æ¯è¾ã\n\n\n# full gc è¿é¢\n\ng1 ä¸­æ´å¤çè¿æ¯ mixedgcï¼ä½ mixedgc å¯ä»¥å minor gc æè·¯ä¸æ ·å»è¯æ­ãè§¦å fullgc äºä¸è¬é½ä¼æé®é¢ï¼g1 ä¼éåä½¿ç¨ serial æ¶éå¨æ¥å®æåå¾çæ¸çå·¥ä½ï¼æåæ¶é¿è¾¾å°ç§çº§å«ï¼å¯ä»¥è¯´æ¯åè·ªäºã\n\nfullgc çåå å¯è½åæ¬ä»¥ä¸è¿äºï¼ä»¥ååæ°è°æ´æ¹é¢çä¸äºæè·¯ï¼\n\n * å¹¶åé¶æ®µå¤±è´¥ï¼å¨å¹¶åæ è®°é¶æ®µï¼mixgc ä¹åèå¹´ä»£å°±è¢«å¡«æ»¡äºï¼é£ä¹è¿æ¶å g1 å°±ä¼æ¾å¼æ è®°å¨æãè¿ç§æåµï¼å¯è½å°±éè¦å¢å å å¤§å°ï¼æèè°æ´å¹¶åæ è®°çº¿ç¨æ°-xx:concgcthreadsã\n * æåå¤±è´¥ï¼å¨ gc çæ¶åæ²¡æè¶³å¤çåå­ä¾å­æ´»/æåå¯¹è±¡ä½¿ç¨ï¼æä»¥è§¦åäº full gcãè¿æ¶åå¯ä»¥éè¿-xx:g1reservepercentæ¥å¢å é¢çåå­ç¾åæ¯ï¼åå°-xx:initiatingheapoccupancypercentæ¥æåå¯å¨æ è®°ï¼-xx:concgcthreadsæ¥å¢å æ è®°çº¿ç¨æ°ä¹æ¯å¯ä»¥çã\n * å¤§å¯¹è±¡åéå¤±è´¥ï¼å¤§å¯¹è±¡æ¾ä¸å°åéç region ç©ºé´è¿è¡åéï¼å°±ä¼è¿è¡ fullgcï¼è¿ç§æåµä¸å¯ä»¥å¢å¤§åå­æèå¢å¤§-xx:g1heapregionsizeã\n * ç¨åºä¸»å¨æ§è¡ system.gc()ï¼ä¸è¦éä¾¿åå°±å¯¹äºã\n\nå¦å¤ï¼æä»¬å¯ä»¥å¨å¯å¨åæ°ä¸­éç½®-xx:heapdumppath=/xxx/dump.hprofæ¥ dump fullgc ç¸å³çæä»¶ï¼å¹¶éè¿ jinfo æ¥è¿è¡ gc ååç dump\n\njinfo -flag +heapdumpbeforefullgc pid\njinfo -flag +heapdumpafterfullgc pid\n\n\nè¿æ ·å¾å° 2 ä»½ dump æä»¶ï¼å¯¹æ¯åä¸»è¦å³æ³¨è¢« gc æçé®é¢å¯¹è±¡æ¥å®ä½é®é¢ã\n\n\n# å¸¸ç¨ linux å½ä»¤\n\nå¨æéææ¥æ¶ï¼æä¸äº linux å½ä»¤ååæç¨ï¼å»ºè®®ææ¡ã\n\n\n# top\n\ntop å½ä»¤å¯ä»¥å®æ¶å¨æå°æ¥çç³»ç»çæ´ä½è¿è¡æåµï¼æ¯ä¸ä¸ªç»¼åäºå¤æ¹ä¿¡æ¯çæµç³»ç»æ§è½åè¿è¡ä¿¡æ¯çå®ç¨å·¥å·ã\n\néå¸¸ï¼ä¼ä½¿ç¨ top -hp pid æ¥çå·ä½çº¿ç¨ä½¿ç¨ç³»ç»èµæºæåµã\n\n> å½ä»¤è¯¦æåèï¼http://man.linuxde.net/top\n\n\n# vmstat\n\nvmstat æ¯ä¸æ¬¾æå®éæ ·å¨æåæ¬¡æ°çåè½æ§çæµå·¥å·ï¼æä»¬å¯ä»¥çå°ï¼å®ä¸ä»å¯ä»¥ç»è®¡åå­çä½¿ç¨æåµï¼è¿å¯ä»¥è§æµå° cpu çä½¿ç¨çãswap çä½¿ç¨æåµãä½ vmstat ä¸è¬å¾å°ç¨æ¥æ¥çåå­çä½¿ç¨æåµï¼èæ¯ç»å¸¸è¢«ç¨æ¥è§å¯è¿ç¨çä¸ä¸æåæ¢ã\n\n * rï¼ç­å¾è¿è¡çè¿ç¨æ°ï¼\n * bï¼å¤äºéä¸­æ­ç¡ç ç¶æçè¿ç¨æ°ï¼\n * swpdï¼èæåå­ä½¿ç¨æåµï¼\n * freeï¼ç©ºé²çåå­ï¼\n * buffï¼ç¨æ¥ä½ä¸ºç¼å²çåå­æ°ï¼\n * siï¼ä»ç£çäº¤æ¢å°åå­çäº¤æ¢é¡µæ°éï¼\n * soï¼ä»åå­äº¤æ¢å°ç£ççäº¤æ¢é¡µæ°éï¼\n * biï¼åéå°åè®¾å¤çåæ°ï¼\n * boï¼ä»åè®¾å¤æ¥æ¶å°çåæ°ï¼\n * inï¼æ¯ç§ä¸­æ­æ°ï¼\n * csï¼æ¯ç§ä¸ä¸æåæ¢æ¬¡æ°ï¼\n * usï¼ç¨æ· cpu ä½¿ç¨æ¶é´ï¼\n * syï¼åæ ¸ cpu ç³»ç»ä½¿ç¨æ¶é´ï¼\n * idï¼ç©ºé²æ¶é´ï¼\n * waï¼ç­å¾ i/o æ¶é´ï¼\n * stï¼è¿è¡èææºçªåçæ¶é´ã\n\n\n# åèèµæ\n\n * ãjava æ§è½è°ä¼å®æã\n * java çº¿ä¸æéè¯æ­å¨å¥è·¯\n * ä»å®éæ¡ä¾èè java åºç¨ç gc ä¼å",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JVM æç¨",frontmatter:{title:"JVM æç¨",date:"2020-06-04T13:51:01.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM"],permalink:"/pages/51172b/",hidden:!0},regularPath:"/01.Java/01.JavaSE/06.JVM/",relativePath:"01.Java/01.JavaSE/06.JVM/README.md",key:"v-740bd8b4",path:"/pages/51172b/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:51},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:473},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:598}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# JVM æç¨\n\n> ãJava èææºãæ»ç»ãæ´çäºä¸ªäººå¯¹äº JVM çå­¦ä¹ ãåºç¨å¿å¾ã\n\n\n# ð åå®¹\n\n * JVM ä½ç³»ç»æ\n * JVM åå­åºå - å³é®è¯ï¼ç¨åºè®¡æ°å¨ãèææºæ ãæ¬å°æ¹æ³æ ãå ãæ¹æ³åºãè¿è¡æ¶å¸¸éæ± ãç´æ¥åå­ãOutOfMemoryErrorãStackOverflowError\n * JVM åå¾æ¶é - å³é®è¯ï¼GC RootsãSerialãParallelãCMSãG1ãMinor GCãFull GC\n * JVM ç±»å è½½ - å³é®è¯ï¼ClassLoaderãåäº²å§æ´¾\n * JVM å­èç  - å³é®è¯ï¼bytecodeãasmãjavassist\n * JVM å½ä»¤è¡å·¥å· - å³é®è¯ï¼jpsãjstatãjmap ãjstackãjhatãjinfo\n * JVM GUI å·¥å· - å³é®è¯ï¼jconsoleãjvisualvmãMATãJProfileãArthas\n * JVM å®æ - å³é®è¯ï¼éç½®ãè°ä¼\n * Java æéè¯æ­ - å³é®è¯ï¼CPUãåå­ãç£çãç½ç»ãGC\n\n\n# ð èµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * ãJava æ§è½è°ä¼å®æã\n * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * æ·±å¥æè§£ Java èææº\n * ä»è¡¨å°éå­¦ä¹  JVM å®ç°\n\n\n# ðª ä¼ é\n\nâ¾ ð  JAVACORE é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# jvm æç¨\n\n> ãjava èææºãæ»ç»ãæ´çäºä¸ªäººå¯¹äº jvm çå­¦ä¹ ãåºç¨å¿å¾ã\n\n\n# ð åå®¹\n\n * jvm ä½ç³»ç»æ\n * jvm åå­åºå - å³é®è¯ï¼ç¨åºè®¡æ°å¨ãèææºæ ãæ¬å°æ¹æ³æ ãå ãæ¹æ³åºãè¿è¡æ¶å¸¸éæ± ãç´æ¥åå­ãoutofmemoryerrorãstackoverflowerror\n * jvm åå¾æ¶é - å³é®è¯ï¼gc rootsãserialãparallelãcmsãg1ãminor gcãfull gc\n * jvm ç±»å è½½ - å³é®è¯ï¼classloaderãåäº²å§æ´¾\n * jvm å­èç  - å³é®è¯ï¼bytecodeãasmãjavassist\n * jvm å½ä»¤è¡å·¥å· - å³é®è¯ï¼jpsãjstatãjmap ãjstackãjhatãjinfo\n * jvm gui å·¥å· - å³é®è¯ï¼jconsoleãjvisualvmãmatãjprofileãarthas\n * jvm å®æ - å³é®è¯ï¼éç½®ãè°ä¼\n * java æéè¯æ­ - å³é®è¯ï¼cpuãåå­ãç£çãç½ç»ãgc\n\n\n# ð èµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n * ãjava æ§è½è°ä¼å®æã\n * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n * æ·±å¥æè§£ java èææº\n * ä»è¡¨å°éå­¦ä¹  jvm å®ç°\n\n\n# ðª ä¼ é\n\nâ¾ ð  javacore é¦é¡µ â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"jvm-and-java",frontmatter:{title:"jvm-and-java",date:"2020-10-16T20:29:24.000Z",categories:["Java","JavaSE","JVM"],tags:["Java","JavaSE","JVM"],permalink:"/pages/ebf8d4/"},regularPath:"/01.Java/01.JavaSE/06.JVM/jvm-and-java.html",relativePath:"01.Java/01.JavaSE/06.JVM/jvm-and-java.md",key:"v-bdc85676",path:"/pages/ebf8d4/",headers:[{level:2,title:"JVM å¦ä½æ§è¡æ¹æ³è°ç¨",slug:"jvm-å¦ä½æ§è¡æ¹æ³è°ç¨",normalizedTitle:"jvm å¦ä½æ§è¡æ¹æ³è°ç¨",charIndex:20},{level:3,title:"éæç»å®åå¨æç»å®",slug:"éæç»å®åå¨æç»å®",normalizedTitle:"éæç»å®åå¨æç»å®",charIndex:403},{level:3,title:"è°ç¨æä»¤çç¬¦å·å¼ç¨",slug:"è°ç¨æä»¤çç¬¦å·å¼ç¨",normalizedTitle:"è°ç¨æä»¤çç¬¦å·å¼ç¨",charIndex:1692},{level:3,title:"èæ¹æ³è°ç¨",slug:"èæ¹æ³è°ç¨",normalizedTitle:"èæ¹æ³è°ç¨",charIndex:1926},{level:3,title:"æ¹æ³è¡¨",slug:"æ¹æ³è¡¨",normalizedTitle:"æ¹æ³è¡¨",charIndex:1914},{level:3,title:"åèç¼å­",slug:"åèç¼å­",normalizedTitle:"åèç¼å­",charIndex:2431},{level:2,title:"JVM å¦ä½å¤çå¼å¸¸",slug:"jvm-å¦ä½å¤çå¼å¸¸",normalizedTitle:"jvm å¦ä½å¤çå¼å¸¸",charIndex:2573},{level:3,title:"JVM å¦ä½æè·å¼å¸¸",slug:"jvm-å¦ä½æè·å¼å¸¸",normalizedTitle:"jvm å¦ä½æè·å¼å¸¸",charIndex:2588},{level:3,title:"Java 7 ç Supressed å¼å¸¸ä»¥åè¯­æ³ç³",slug:"java-7-ç-supressed-å¼å¸¸ä»¥åè¯­æ³ç³",normalizedTitle:"java 7 ç supressed å¼å¸¸ä»¥åè¯­æ³ç³",charIndex:3708},{level:2,title:"JVM å¦ä½å®ç°åå°",slug:"jvm-å¦ä½å®ç°åå°",normalizedTitle:"jvm å¦ä½å®ç°åå°",charIndex:5102},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5117}],headersStr:"JVM å¦ä½æ§è¡æ¹æ³è°ç¨ éæç»å®åå¨æç»å® è°ç¨æä»¤çç¬¦å·å¼ç¨ èæ¹æ³è°ç¨ æ¹æ³è¡¨ åèç¼å­ JVM å¦ä½å¤çå¼å¸¸ JVM å¦ä½æè·å¼å¸¸ Java 7 ç Supressed å¼å¸¸ä»¥åè¯­æ³ç³ JVM å¦ä½å®ç°åå° åèèµæ",content:'# JVM å Java ç¹æ§\n\n\n# JVM å¦ä½æ§è¡æ¹æ³è°ç¨\n\nå¨ Java ç¨åºéï¼å¦æåä¸ä¸ªç±»ä¸­åºç°å¤ä¸ªåå­ç¸åï¼å¹¶ä¸åæ°ç±»åç¸åçæ¹æ³ï¼é£ä¹å®æ æ³éè¿ç¼è¯ãå¦ææä»¬æ³è¦å¨åä¸ä¸ªç±»ä¸­å®ä¹åå­ç¸åçæ¹æ³ï¼é£ä¹å®ä»¬çåæ°ç±»åå¿é¡»ä¸åãè¿äºæ¹æ³ä¹é´çå³ç³»ï¼æä»¬ç§°ä¹ä¸ºéè½½ã\n\néè½½çæ¹æ³å¨ç¼è¯è¿ç¨ä¸­å³å¯å®æè¯å«ãå·ä½å°æ¯ä¸ä¸ªæ¹æ³è°ç¨ï¼Java ç¼è¯å¨ä¼æ ¹æ®æä¼ å¥åæ°çå£°æç±»åï¼æ³¨æä¸å®éç±»ååºåï¼æ¥éåéè½½æ¹æ³ãéåçè¿ç¨å±åä¸ºä¸ä¸ªé¶æ®µï¼\n\n 1. å¨ä¸èèå¯¹åºæ¬ç±»åèªå¨è£æç®±ï¼auto-boxingï¼auto-unboxingï¼ï¼ä»¥åå¯åé¿åæ°çæåµä¸éåéè½½æ¹æ³ï¼\n 2. å¦æå¨ç¬¬ 1 ä¸ªé¶æ®µä¸­æ²¡ææ¾å°ééçæ¹æ³ï¼é£ä¹å¨åè®¸èªå¨è£æç®±ï¼ä½ä¸åè®¸å¯åé¿åæ°çæåµä¸éåéè½½æ¹æ³ï¼\n 3. å¦æå¨ç¬¬ 2 ä¸ªé¶æ®µä¸­æ²¡ææ¾å°ééçæ¹æ³ï¼é£ä¹å¨åè®¸èªå¨è£æç®±ä»¥åå¯åé¿åæ°çæåµä¸éåéè½½æ¹æ³ã\n\n\n# éæç»å®åå¨æç»å®\n\nJava èææºè¯å«æ¹æ³çå³é®å¨äºç±»åãæ¹æ³åä»¥åæ¹æ³æè¿°ç¬¦ï¼method descriptorï¼ãæ¹æ³æè¿°ç¬¦ï¼å®æ¯ç±æ¹æ³çåæ°ç±»åä»¥åè¿åç±»åæææã\n\nJava èææºä¸­å³äºæ¹æ³éåçå¤å®åæ ·åºäºæ¹æ³æè¿°ç¬¦ãä¹å°±æ¯è¯´ï¼å¦æå­ç±»å®ä¹äºä¸ç¶ç±»ä¸­éç§æãééææ¹æ³ååçæ¹æ³ï¼é£ä¹åªæå½è¿ä¸¤ä¸ªæ¹æ³çåæ°ç±»åä»¥åè¿åç±»åä¸è´ï¼Java èææºæä¼å¤å®ä¸ºéåã\n\nç±äºå¯¹éè½½æ¹æ³çåºåå¨ç¼è¯é¶æ®µå·²ç»å®æï¼æä»¬å¯ä»¥è®¤ä¸º Java èææºä¸å­å¨éè½½è¿ä¸æ¦å¿µãå æ­¤ï¼å¨æäºæç« ä¸­ï¼éè½½ä¹è¢«ç§°ä¸ºéæç»å®ï¼static bindingï¼ï¼æèç¼è¯æ¶å¤æï¼compile-time polymorphismï¼ï¼èéååè¢«ç§°ä¸ºå¨æç»å®ï¼dynamic bindingï¼ã\n\nç¡®åå°è¯´ï¼Java èææºä¸­çéæç»å®æçæ¯å¨è§£ææ¶ä¾¿è½å¤ç´æ¥è¯å«ç®æ æ¹æ³çæåµï¼èå¨æç»å®åæçæ¯éè¦å¨è¿è¡è¿ç¨ä¸­æ ¹æ®è°ç¨èçå¨æç±»åæ¥è¯å«ç®æ æ¹æ³çæåµã\n\nå·ä½æ¥è¯´ï¼Java å­èç ä¸­ä¸è°ç¨ç¸å³çæä»¤å±æäºç§ã\n\n 1. invokestaticï¼ç¨äºè°ç¨éææ¹æ³ã\n 2. invokespecialï¼ç¨äºè°ç¨ç§æå®ä¾æ¹æ³ãæé å¨ï¼ä»¥åä½¿ç¨ super å³é®å­è°ç¨ç¶ç±»çå®ä¾æ¹æ³ææé å¨ï¼åæå®ç°æ¥å£çé»è®¤æ¹æ³ã\n 3. invokevirtualï¼ç¨äºè°ç¨éç§æå®ä¾æ¹æ³ã\n 4. invokeinterfaceï¼ç¨äºè°ç¨æ¥å£æ¹æ³ã\n 5. invokedynamicï¼ç¨äºè°ç¨å¨ææ¹æ³ã\n\nãç¤ºä¾ã\n\ninterface å®¢æ· {\n  boolean isVIP();\n}\n\nclass åæ· {\n  public double æåä»·æ ¼ (double åä»·, å®¢æ· æå®¢æ·) {\n    return åä»· * 0.8d;\n  }\n}\n\nclass å¥¸å extends åæ· {\n  @Override\n  public double æåä»·æ ¼ (double åä»·, å®¢æ· æå®¢æ·) {\n    if (æå®¢æ·.isVIP()) {                         // invokeinterface\n      return åä»· * ä»·æ ¼æ­§è§ ();                    // invokestatic\n    } else {\n      return super. æåä»·æ ¼ (åä»·, æå®¢æ·);          // invokespecial\n    }\n  }\n  public static double ä»·æ ¼æ­§è§ () {\n    // å±ä»¬çæçç®æ³å¤ªç²æ´äºï¼åºè¯¥å°å®¢æ·åå¸ä½ä¸ºéæºæ°çæå¨çç§å­ã\n    return new Random()                          // invokespecial\n           .nextDouble()                         // invokevirtual\n           + 0.8d;\n  }\n}\n\n\n\n# è°ç¨æä»¤çç¬¦å·å¼ç¨\n\nå¨ç¼è¯è¿ç¨ä¸­ï¼æä»¬å¹¶ä¸ç¥éç®æ æ¹æ³çå·ä½åå­å°åãå æ­¤ï¼Java ç¼è¯å¨ä¼ææ¶ç¨ç¬¦å·å¼ç¨æ¥è¡¨ç¤ºè¯¥ç®æ æ¹æ³ãè¿ä¸ç¬¦å·å¼ç¨åæ¬ç®æ æ¹æ³æå¨çç±»ææ¥å£çåå­ï¼ä»¥åç®æ æ¹æ³çæ¹æ³ååæ¹æ³æè¿°ç¬¦ã\n\nç¬¦å·å¼ç¨å­å¨å¨ class æä»¶çå¸¸éæ± ä¹ä¸­ãæ ¹æ®ç®æ æ¹æ³æ¯å¦ä¸ºæ¥å£æ¹æ³ï¼è¿äºå¼ç¨å¯åä¸ºæ¥å£ç¬¦å·å¼ç¨åéæ¥å£ç¬¦å·å¼ç¨ã\n\nå¯¹äºå¯ä»¥éæç»å®çæ¹æ³è°ç¨èè¨ï¼å®éå¼ç¨æ¯ä¸ä¸ªæåæ¹æ³çæéãå¯¹äºéè¦å¨æç»å®çæ¹æ³è°ç¨èè¨ï¼å®éå¼ç¨åæ¯ä¸ä¸ªæ¹æ³è¡¨çç´¢å¼ã\n\n\n# èæ¹æ³è°ç¨\n\nJava éææéç§æå®ä¾æ¹æ³è°ç¨é½ä¼è¢«ç¼è¯æ invokevirtual æä»¤ï¼èæ¥å£æ¹æ³è°ç¨é½ä¼è¢«ç¼è¯æ invokeinterface æä»¤ãè¿ä¸¤ç§æä»¤ï¼åå±äº Java èææºä¸­çèæ¹æ³è°ç¨ã\n\nå¨ Java èææºä¸­ï¼éæç»å®åæ¬ç¨äºè°ç¨éææ¹æ³ç invokestatic æä»¤ï¼åç¨äºè°ç¨æé å¨ãç§æå®ä¾æ¹æ³ä»¥åè¶ç±»éç§æå®ä¾æ¹æ³ç invokespecial æä»¤ãå¦æèæ¹æ³è°ç¨æåä¸ä¸ªæ è®°ä¸º final çæ¹æ³ï¼é£ä¹ Java èææºä¹å¯ä»¥éæç»å®è¯¥èæ¹æ³è°ç¨çç®æ æ¹æ³ã\n\n\n# æ¹æ³è¡¨\n\næ¹æ³è¡¨æ¯ Java èææºå®ç°å¨æç»å®çå³é®æå¨ã\n\næ¹æ³è¡¨æ¬è´¨ä¸æ¯ä¸ä¸ªæ°ç»ï¼æ¯ä¸ªæ°ç»åç´ æåä¸ä¸ªå½åç±»åå¶ç¥åç±»ä¸­éç§æçå®ä¾æ¹æ³ã\n\nè¿äºæ¹æ³å¯è½æ¯å·ä½çãå¯æ§è¡çæ¹æ³ï¼ä¹å¯è½æ¯æ²¡æç¸åºå­èç çæ½è±¡æ¹æ³ãæ¹æ³è¡¨æ»¡è¶³ä¸¤ä¸ªç¹è´¨ï¼å¶ä¸ï¼å­ç±»æ¹æ³è¡¨ä¸­åå«ç¶ç±»æ¹æ³è¡¨ä¸­çæææ¹æ³ï¼å¶äºï¼å­ç±»æ¹æ³å¨æ¹æ³è¡¨ä¸­çç´¢å¼å¼ï¼ä¸å®æéåçç¶ç±»æ¹æ³çç´¢å¼å¼ç¸åã\n\nå¨æ§è¡è¿ç¨ä¸­ï¼Java èææºå°è·åè°ç¨èçå®éç±»åï¼å¹¶å¨è¯¥å®éç±»åçèæ¹æ³è¡¨ä¸­ï¼æ ¹æ®ç´¢å¼å¼è·å¾ç®æ æ¹æ³ãè¿ä¸ªè¿ç¨ä¾¿æ¯å¨æç»å®ã\n\n\n# åèç¼å­\n\nåèç¼å­æ¯ä¸ç§å å¿«å¨æç»å®çä¼åææ¯ãå®è½å¤ç¼å­èæ¹æ³è°ç¨ä¸­è°ç¨èçå¨æç±»åï¼ä»¥åè¯¥ç±»åæå¯¹åºçç®æ æ¹æ³ãå¨ä¹åçæ§è¡è¿ç¨ä¸­ï¼å¦æç¢°å°å·²ç¼å­çç±»åï¼åèç¼å­ä¾¿ä¼ç´æ¥è°ç¨è¯¥ç±»åæå¯¹åºçç®æ æ¹æ³ãå¦ææ²¡æç¢°å°å·²ç¼å­çç±»åï¼åèç¼å­åä¼éåè³ä½¿ç¨åºäºæ¹æ³è¡¨çå¨æç»å®ã\n\n\n# JVM å¦ä½å¤çå¼å¸¸\n\n\n# JVM å¦ä½æè·å¼å¸¸\n\nå¨ç¼è¯çæçå­èç ä¸­ï¼æ¯ä¸ªæ¹æ³é½éå¸¦ä¸ä¸ªå¼å¸¸è¡¨ãå¼å¸¸è¡¨ä¸­çæ¯ä¸ä¸ªæ¡ç®ä»£è¡¨ä¸ä¸ªå¼å¸¸å¤çå¨ï¼å¹¶ä¸ç± from æéãto æéãtarget æéä»¥åææè·çå¼å¸¸ç±»åææãè¿äºæéçå¼æ¯å­èç ç´¢å¼ï¼bytecode indexï¼bciï¼ï¼ç¨ä»¥å®ä½å­èç ã\n\nå¶ä¸­ï¼from æéå to æéæ ç¤ºäºè¯¥å¼å¸¸å¤çå¨æçæ§çèå´ï¼ä¾å¦ try ä»£ç åæè¦ççèå´ãtarget æéåæåå¼å¸¸å¤çå¨çèµ·å§ä½ç½®ï¼ä¾å¦ catch ä»£ç åçèµ·å§ä½ç½®ã\n\npublic static void main(String[] args) {\n  try {\n    mayThrowException();\n  } catch (Exception e) {\n    e.printStackTrace();\n  }\n}\n// å¯¹åºç Java å­èç \npublic static void main(java.lang.String[]);\n  Code:\n    0: invokestatic mayThrowException:()V\n    3: goto 11\n    6: astore_1\n    7: aload_1\n    8: invokevirtual java.lang.Exception.printStackTrace\n   11: return\n  Exception table:\n    from  to target type\n      0   3   6  Class java/lang/Exception  // å¼å¸¸è¡¨æ¡ç®\n\n\nè¯´æï¼ç¼è¯è¿åï¼è¯¥æ¹æ³çå¼å¸¸è¡¨æ¥æä¸ä¸ªæ¡ç®ãå¶ from æéå to æéåå«ä¸º 0 å 3ï¼ä»£è¡¨å®ççæ§èå´ä»ç´¢å¼ä¸º 0 çå­èç å¼å§ï¼å°ç´¢å¼ä¸º 3 çå­èç ç»æï¼ä¸åæ¬ 3ï¼ãè¯¥æ¡ç®ç target æéæ¯ 6ï¼ä»£è¡¨è¿ä¸ªå¼å¸¸å¤çå¨ä»ç´¢å¼ä¸º 6 çå­èç å¼å§ãæ¡ç®çæåä¸åï¼ä»£è¡¨è¯¥å¼å¸¸å¤çå¨ææè·çå¼å¸¸ç±»åæ­£æ¯ Exceptionã\n\nå½ç¨åºè§¦åå¼å¸¸æ¶ï¼Java èææºä¼ä»ä¸è³ä¸éåå¼å¸¸è¡¨ä¸­çæææ¡ç®ãå½è§¦åå¼å¸¸çå­èç çç´¢å¼å¼å¨æä¸ªå¼å¸¸è¡¨æ¡ç®ççæ§èå´åï¼Java èææºä¼å¤æ­ææåºçå¼å¸¸åè¯¥æ¡ç®æ³è¦æè·çå¼å¸¸æ¯å¦å¹éãå¦æå¹éï¼Java èææºä¼å°æ§å¶æµè½¬ç§»è³è¯¥æ¡ç® target æéæåçå­èç ã\n\nå¦æéåå®ææå¼å¸¸è¡¨æ¡ç®ï¼Java èææºä»æªå¹éå°å¼å¸¸å¤çå¨ï¼é£ä¹å®ä¼å¼¹åºå½åæ¹æ³å¯¹åºç Java æ å¸§ï¼å¹¶ä¸å¨è°ç¨èï¼callerï¼ä¸­éå¤ä¸è¿°æä½ãå¨æåæåµä¸ï¼Java èææºéè¦éåå½åçº¿ç¨ Java æ ä¸æææ¹æ³çå¼å¸¸è¡¨ã\n\n\n# Java 7 ç Supressed å¼å¸¸ä»¥åè¯­æ³ç³\n\nå¦æ catch ä»£ç åæè·äºå¼å¸¸ï¼å¹¶ä¸è§¦åäºå¦ä¸ä¸ªå¼å¸¸ï¼é£ä¹ finally æè·å¹¶ä¸éæçå¼å¸¸æ¯åªä¸ªå¢ï¼ç­æ¡æ¯åèãä¹å°±æ¯è¯´åæ¬çå¼å¸¸ä¾¿ä¼è¢«å¿½ç¥æï¼è¿å¯¹äºä»£ç è°è¯æ¥è¯´ååä¸å©ã\n\nJava 7 å¼å¥äº Supressed å¼å¸¸æ¥è§£å³è¿ä¸ªé®é¢ãè¿ä¸ªæ°ç¹æ§åè®¸å¼åäººåå°ä¸ä¸ªå¼å¸¸éäºå¦ä¸ä¸ªå¼å¸¸ä¹ä¸ãå æ­¤ï¼æåºçå¼å¸¸å¯ä»¥éå¸¦å¤ä¸ªå¼å¸¸çä¿¡æ¯ã\n\nJava 7 ä¸é¨æé äºä¸ä¸ªåä¸º try-with-resources çè¯­æ³ç³ï¼å¨å­èç å±é¢èªå¨ä½¿ç¨ Supressed å¼å¸¸ã\n\npublic class Foo implements AutoCloseable {\n  private final String name;\n  public Foo(String name) { this.name = name; }\n\n  @Override\n  public void close() {\n    throw new RuntimeException(name);\n  }\n\n  public static void main(String[] args) {\n    try (Foo foo0 = new Foo("Foo0"); // try-with-resources\n         Foo foo1 = new Foo("Foo1");\n         Foo foo2 = new Foo("Foo2")) {\n      throw new RuntimeException("Initial");\n    }\n  }\n}\n\n// è¿è¡ç»æï¼\nException in thread "main" java.lang.RuntimeException: Initial\n        at Foo.main(Foo.java:18)\n        Suppressed: java.lang.RuntimeException: Foo2\n                at Foo.close(Foo.java:13)\n                at Foo.main(Foo.java:19)\n        Suppressed: java.lang.RuntimeException: Foo1\n                at Foo.close(Foo.java:13)\n                at Foo.main(Foo.java:19)\n        Suppressed: java.lang.RuntimeException: Foo0\n                at Foo.close(Foo.java:13)\n                at Foo.main(Foo.java:19)\n\n\né¤äº try-with-resources è¯­æ³ç³ä¹å¤ï¼Java 7 è¿æ¯æå¨åä¸ catch ä»£ç åä¸­æè·å¤ç§å¼å¸¸ãå®éå®ç°éå¸¸ç®åï¼çæå¤ä¸ªå¼å¸¸è¡¨æ¡ç®å³å¯ã\n\n// å¨åä¸ catch ä»£ç åä¸­æè·å¤ç§å¼å¸¸\ntry {\n  ...\n} catch (SomeException | OtherException e) {\n  ...\n}\n\n\n\n# JVM å¦ä½å®ç°åå°\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ Java èææºã\n * æ·±å¥æè§£ Java èææº',normalizedContent:'# jvm å java ç¹æ§\n\n\n# jvm å¦ä½æ§è¡æ¹æ³è°ç¨\n\nå¨ java ç¨åºéï¼å¦æåä¸ä¸ªç±»ä¸­åºç°å¤ä¸ªåå­ç¸åï¼å¹¶ä¸åæ°ç±»åç¸åçæ¹æ³ï¼é£ä¹å®æ æ³éè¿ç¼è¯ãå¦ææä»¬æ³è¦å¨åä¸ä¸ªç±»ä¸­å®ä¹åå­ç¸åçæ¹æ³ï¼é£ä¹å®ä»¬çåæ°ç±»åå¿é¡»ä¸åãè¿äºæ¹æ³ä¹é´çå³ç³»ï¼æä»¬ç§°ä¹ä¸ºéè½½ã\n\néè½½çæ¹æ³å¨ç¼è¯è¿ç¨ä¸­å³å¯å®æè¯å«ãå·ä½å°æ¯ä¸ä¸ªæ¹æ³è°ç¨ï¼java ç¼è¯å¨ä¼æ ¹æ®æä¼ å¥åæ°çå£°æç±»åï¼æ³¨æä¸å®éç±»ååºåï¼æ¥éåéè½½æ¹æ³ãéåçè¿ç¨å±åä¸ºä¸ä¸ªé¶æ®µï¼\n\n 1. å¨ä¸èèå¯¹åºæ¬ç±»åèªå¨è£æç®±ï¼auto-boxingï¼auto-unboxingï¼ï¼ä»¥åå¯åé¿åæ°çæåµä¸éåéè½½æ¹æ³ï¼\n 2. å¦æå¨ç¬¬ 1 ä¸ªé¶æ®µä¸­æ²¡ææ¾å°ééçæ¹æ³ï¼é£ä¹å¨åè®¸èªå¨è£æç®±ï¼ä½ä¸åè®¸å¯åé¿åæ°çæåµä¸éåéè½½æ¹æ³ï¼\n 3. å¦æå¨ç¬¬ 2 ä¸ªé¶æ®µä¸­æ²¡ææ¾å°ééçæ¹æ³ï¼é£ä¹å¨åè®¸èªå¨è£æç®±ä»¥åå¯åé¿åæ°çæåµä¸éåéè½½æ¹æ³ã\n\n\n# éæç»å®åå¨æç»å®\n\njava èææºè¯å«æ¹æ³çå³é®å¨äºç±»åãæ¹æ³åä»¥åæ¹æ³æè¿°ç¬¦ï¼method descriptorï¼ãæ¹æ³æè¿°ç¬¦ï¼å®æ¯ç±æ¹æ³çåæ°ç±»åä»¥åè¿åç±»åæææã\n\njava èææºä¸­å³äºæ¹æ³éåçå¤å®åæ ·åºäºæ¹æ³æè¿°ç¬¦ãä¹å°±æ¯è¯´ï¼å¦æå­ç±»å®ä¹äºä¸ç¶ç±»ä¸­éç§æãééææ¹æ³ååçæ¹æ³ï¼é£ä¹åªæå½è¿ä¸¤ä¸ªæ¹æ³çåæ°ç±»åä»¥åè¿åç±»åä¸è´ï¼java èææºæä¼å¤å®ä¸ºéåã\n\nç±äºå¯¹éè½½æ¹æ³çåºåå¨ç¼è¯é¶æ®µå·²ç»å®æï¼æä»¬å¯ä»¥è®¤ä¸º java èææºä¸å­å¨éè½½è¿ä¸æ¦å¿µãå æ­¤ï¼å¨æäºæç« ä¸­ï¼éè½½ä¹è¢«ç§°ä¸ºéæç»å®ï¼static bindingï¼ï¼æèç¼è¯æ¶å¤æï¼compile-time polymorphismï¼ï¼èéååè¢«ç§°ä¸ºå¨æç»å®ï¼dynamic bindingï¼ã\n\nç¡®åå°è¯´ï¼java èææºä¸­çéæç»å®æçæ¯å¨è§£ææ¶ä¾¿è½å¤ç´æ¥è¯å«ç®æ æ¹æ³çæåµï¼èå¨æç»å®åæçæ¯éè¦å¨è¿è¡è¿ç¨ä¸­æ ¹æ®è°ç¨èçå¨æç±»åæ¥è¯å«ç®æ æ¹æ³çæåµã\n\nå·ä½æ¥è¯´ï¼java å­èç ä¸­ä¸è°ç¨ç¸å³çæä»¤å±æäºç§ã\n\n 1. invokestaticï¼ç¨äºè°ç¨éææ¹æ³ã\n 2. invokespecialï¼ç¨äºè°ç¨ç§æå®ä¾æ¹æ³ãæé å¨ï¼ä»¥åä½¿ç¨ super å³é®å­è°ç¨ç¶ç±»çå®ä¾æ¹æ³ææé å¨ï¼åæå®ç°æ¥å£çé»è®¤æ¹æ³ã\n 3. invokevirtualï¼ç¨äºè°ç¨éç§æå®ä¾æ¹æ³ã\n 4. invokeinterfaceï¼ç¨äºè°ç¨æ¥å£æ¹æ³ã\n 5. invokedynamicï¼ç¨äºè°ç¨å¨ææ¹æ³ã\n\nãç¤ºä¾ã\n\ninterface å®¢æ· {\n  boolean isvip();\n}\n\nclass åæ· {\n  public double æåä»·æ ¼ (double åä»·, å®¢æ· æå®¢æ·) {\n    return åä»· * 0.8d;\n  }\n}\n\nclass å¥¸å extends åæ· {\n  @override\n  public double æåä»·æ ¼ (double åä»·, å®¢æ· æå®¢æ·) {\n    if (æå®¢æ·.isvip()) {                         // invokeinterface\n      return åä»· * ä»·æ ¼æ­§è§ ();                    // invokestatic\n    } else {\n      return super. æåä»·æ ¼ (åä»·, æå®¢æ·);          // invokespecial\n    }\n  }\n  public static double ä»·æ ¼æ­§è§ () {\n    // å±ä»¬çæçç®æ³å¤ªç²æ´äºï¼åºè¯¥å°å®¢æ·åå¸ä½ä¸ºéæºæ°çæå¨çç§å­ã\n    return new random()                          // invokespecial\n           .nextdouble()                         // invokevirtual\n           + 0.8d;\n  }\n}\n\n\n\n# è°ç¨æä»¤çç¬¦å·å¼ç¨\n\nå¨ç¼è¯è¿ç¨ä¸­ï¼æä»¬å¹¶ä¸ç¥éç®æ æ¹æ³çå·ä½åå­å°åãå æ­¤ï¼java ç¼è¯å¨ä¼ææ¶ç¨ç¬¦å·å¼ç¨æ¥è¡¨ç¤ºè¯¥ç®æ æ¹æ³ãè¿ä¸ç¬¦å·å¼ç¨åæ¬ç®æ æ¹æ³æå¨çç±»ææ¥å£çåå­ï¼ä»¥åç®æ æ¹æ³çæ¹æ³ååæ¹æ³æè¿°ç¬¦ã\n\nç¬¦å·å¼ç¨å­å¨å¨ class æä»¶çå¸¸éæ± ä¹ä¸­ãæ ¹æ®ç®æ æ¹æ³æ¯å¦ä¸ºæ¥å£æ¹æ³ï¼è¿äºå¼ç¨å¯åä¸ºæ¥å£ç¬¦å·å¼ç¨åéæ¥å£ç¬¦å·å¼ç¨ã\n\nå¯¹äºå¯ä»¥éæç»å®çæ¹æ³è°ç¨èè¨ï¼å®éå¼ç¨æ¯ä¸ä¸ªæåæ¹æ³çæéãå¯¹äºéè¦å¨æç»å®çæ¹æ³è°ç¨èè¨ï¼å®éå¼ç¨åæ¯ä¸ä¸ªæ¹æ³è¡¨çç´¢å¼ã\n\n\n# èæ¹æ³è°ç¨\n\njava éææéç§æå®ä¾æ¹æ³è°ç¨é½ä¼è¢«ç¼è¯æ invokevirtual æä»¤ï¼èæ¥å£æ¹æ³è°ç¨é½ä¼è¢«ç¼è¯æ invokeinterface æä»¤ãè¿ä¸¤ç§æä»¤ï¼åå±äº java èææºä¸­çèæ¹æ³è°ç¨ã\n\nå¨ java èææºä¸­ï¼éæç»å®åæ¬ç¨äºè°ç¨éææ¹æ³ç invokestatic æä»¤ï¼åç¨äºè°ç¨æé å¨ãç§æå®ä¾æ¹æ³ä»¥åè¶ç±»éç§æå®ä¾æ¹æ³ç invokespecial æä»¤ãå¦æèæ¹æ³è°ç¨æåä¸ä¸ªæ è®°ä¸º final çæ¹æ³ï¼é£ä¹ java èææºä¹å¯ä»¥éæç»å®è¯¥èæ¹æ³è°ç¨çç®æ æ¹æ³ã\n\n\n# æ¹æ³è¡¨\n\næ¹æ³è¡¨æ¯ java èææºå®ç°å¨æç»å®çå³é®æå¨ã\n\næ¹æ³è¡¨æ¬è´¨ä¸æ¯ä¸ä¸ªæ°ç»ï¼æ¯ä¸ªæ°ç»åç´ æåä¸ä¸ªå½åç±»åå¶ç¥åç±»ä¸­éç§æçå®ä¾æ¹æ³ã\n\nè¿äºæ¹æ³å¯è½æ¯å·ä½çãå¯æ§è¡çæ¹æ³ï¼ä¹å¯è½æ¯æ²¡æç¸åºå­èç çæ½è±¡æ¹æ³ãæ¹æ³è¡¨æ»¡è¶³ä¸¤ä¸ªç¹è´¨ï¼å¶ä¸ï¼å­ç±»æ¹æ³è¡¨ä¸­åå«ç¶ç±»æ¹æ³è¡¨ä¸­çæææ¹æ³ï¼å¶äºï¼å­ç±»æ¹æ³å¨æ¹æ³è¡¨ä¸­çç´¢å¼å¼ï¼ä¸å®æéåçç¶ç±»æ¹æ³çç´¢å¼å¼ç¸åã\n\nå¨æ§è¡è¿ç¨ä¸­ï¼java èææºå°è·åè°ç¨èçå®éç±»åï¼å¹¶å¨è¯¥å®éç±»åçèæ¹æ³è¡¨ä¸­ï¼æ ¹æ®ç´¢å¼å¼è·å¾ç®æ æ¹æ³ãè¿ä¸ªè¿ç¨ä¾¿æ¯å¨æç»å®ã\n\n\n# åèç¼å­\n\nåèç¼å­æ¯ä¸ç§å å¿«å¨æç»å®çä¼åææ¯ãå®è½å¤ç¼å­èæ¹æ³è°ç¨ä¸­è°ç¨èçå¨æç±»åï¼ä»¥åè¯¥ç±»åæå¯¹åºçç®æ æ¹æ³ãå¨ä¹åçæ§è¡è¿ç¨ä¸­ï¼å¦æç¢°å°å·²ç¼å­çç±»åï¼åèç¼å­ä¾¿ä¼ç´æ¥è°ç¨è¯¥ç±»åæå¯¹åºçç®æ æ¹æ³ãå¦ææ²¡æç¢°å°å·²ç¼å­çç±»åï¼åèç¼å­åä¼éåè³ä½¿ç¨åºäºæ¹æ³è¡¨çå¨æç»å®ã\n\n\n# jvm å¦ä½å¤çå¼å¸¸\n\n\n# jvm å¦ä½æè·å¼å¸¸\n\nå¨ç¼è¯çæçå­èç ä¸­ï¼æ¯ä¸ªæ¹æ³é½éå¸¦ä¸ä¸ªå¼å¸¸è¡¨ãå¼å¸¸è¡¨ä¸­çæ¯ä¸ä¸ªæ¡ç®ä»£è¡¨ä¸ä¸ªå¼å¸¸å¤çå¨ï¼å¹¶ä¸ç± from æéãto æéãtarget æéä»¥åææè·çå¼å¸¸ç±»åææãè¿äºæéçå¼æ¯å­èç ç´¢å¼ï¼bytecode indexï¼bciï¼ï¼ç¨ä»¥å®ä½å­èç ã\n\nå¶ä¸­ï¼from æéå to æéæ ç¤ºäºè¯¥å¼å¸¸å¤çå¨æçæ§çèå´ï¼ä¾å¦ try ä»£ç åæè¦ççèå´ãtarget æéåæåå¼å¸¸å¤çå¨çèµ·å§ä½ç½®ï¼ä¾å¦ catch ä»£ç åçèµ·å§ä½ç½®ã\n\npublic static void main(string[] args) {\n  try {\n    maythrowexception();\n  } catch (exception e) {\n    e.printstacktrace();\n  }\n}\n// å¯¹åºç java å­èç \npublic static void main(java.lang.string[]);\n  code:\n    0: invokestatic maythrowexception:()v\n    3: goto 11\n    6: astore_1\n    7: aload_1\n    8: invokevirtual java.lang.exception.printstacktrace\n   11: return\n  exception table:\n    from  to target type\n      0   3   6  class java/lang/exception  // å¼å¸¸è¡¨æ¡ç®\n\n\nè¯´æï¼ç¼è¯è¿åï¼è¯¥æ¹æ³çå¼å¸¸è¡¨æ¥æä¸ä¸ªæ¡ç®ãå¶ from æéå to æéåå«ä¸º 0 å 3ï¼ä»£è¡¨å®ççæ§èå´ä»ç´¢å¼ä¸º 0 çå­èç å¼å§ï¼å°ç´¢å¼ä¸º 3 çå­èç ç»æï¼ä¸åæ¬ 3ï¼ãè¯¥æ¡ç®ç target æéæ¯ 6ï¼ä»£è¡¨è¿ä¸ªå¼å¸¸å¤çå¨ä»ç´¢å¼ä¸º 6 çå­èç å¼å§ãæ¡ç®çæåä¸åï¼ä»£è¡¨è¯¥å¼å¸¸å¤çå¨ææè·çå¼å¸¸ç±»åæ­£æ¯ exceptionã\n\nå½ç¨åºè§¦åå¼å¸¸æ¶ï¼java èææºä¼ä»ä¸è³ä¸éåå¼å¸¸è¡¨ä¸­çæææ¡ç®ãå½è§¦åå¼å¸¸çå­èç çç´¢å¼å¼å¨æä¸ªå¼å¸¸è¡¨æ¡ç®ççæ§èå´åï¼java èææºä¼å¤æ­ææåºçå¼å¸¸åè¯¥æ¡ç®æ³è¦æè·çå¼å¸¸æ¯å¦å¹éãå¦æå¹éï¼java èææºä¼å°æ§å¶æµè½¬ç§»è³è¯¥æ¡ç® target æéæåçå­èç ã\n\nå¦æéåå®ææå¼å¸¸è¡¨æ¡ç®ï¼java èææºä»æªå¹éå°å¼å¸¸å¤çå¨ï¼é£ä¹å®ä¼å¼¹åºå½åæ¹æ³å¯¹åºç java æ å¸§ï¼å¹¶ä¸å¨è°ç¨èï¼callerï¼ä¸­éå¤ä¸è¿°æä½ãå¨æåæåµä¸ï¼java èææºéè¦éåå½åçº¿ç¨ java æ ä¸æææ¹æ³çå¼å¸¸è¡¨ã\n\n\n# java 7 ç supressed å¼å¸¸ä»¥åè¯­æ³ç³\n\nå¦æ catch ä»£ç åæè·äºå¼å¸¸ï¼å¹¶ä¸è§¦åäºå¦ä¸ä¸ªå¼å¸¸ï¼é£ä¹ finally æè·å¹¶ä¸éæçå¼å¸¸æ¯åªä¸ªå¢ï¼ç­æ¡æ¯åèãä¹å°±æ¯è¯´åæ¬çå¼å¸¸ä¾¿ä¼è¢«å¿½ç¥æï¼è¿å¯¹äºä»£ç è°è¯æ¥è¯´ååä¸å©ã\n\njava 7 å¼å¥äº supressed å¼å¸¸æ¥è§£å³è¿ä¸ªé®é¢ãè¿ä¸ªæ°ç¹æ§åè®¸å¼åäººåå°ä¸ä¸ªå¼å¸¸éäºå¦ä¸ä¸ªå¼å¸¸ä¹ä¸ãå æ­¤ï¼æåºçå¼å¸¸å¯ä»¥éå¸¦å¤ä¸ªå¼å¸¸çä¿¡æ¯ã\n\njava 7 ä¸é¨æé äºä¸ä¸ªåä¸º try-with-resources çè¯­æ³ç³ï¼å¨å­èç å±é¢èªå¨ä½¿ç¨ supressed å¼å¸¸ã\n\npublic class foo implements autocloseable {\n  private final string name;\n  public foo(string name) { this.name = name; }\n\n  @override\n  public void close() {\n    throw new runtimeexception(name);\n  }\n\n  public static void main(string[] args) {\n    try (foo foo0 = new foo("foo0"); // try-with-resources\n         foo foo1 = new foo("foo1");\n         foo foo2 = new foo("foo2")) {\n      throw new runtimeexception("initial");\n    }\n  }\n}\n\n// è¿è¡ç»æï¼\nexception in thread "main" java.lang.runtimeexception: initial\n        at foo.main(foo.java:18)\n        suppressed: java.lang.runtimeexception: foo2\n                at foo.close(foo.java:13)\n                at foo.main(foo.java:19)\n        suppressed: java.lang.runtimeexception: foo1\n                at foo.close(foo.java:13)\n                at foo.main(foo.java:19)\n        suppressed: java.lang.runtimeexception: foo0\n                at foo.close(foo.java:13)\n                at foo.main(foo.java:19)\n\n\né¤äº try-with-resources è¯­æ³ç³ä¹å¤ï¼java 7 è¿æ¯æå¨åä¸ catch ä»£ç åä¸­æè·å¤ç§å¼å¸¸ãå®éå®ç°éå¸¸ç®åï¼çæå¤ä¸ªå¼å¸¸è¡¨æ¡ç®å³å¯ã\n\n// å¨åä¸ catch ä»£ç åä¸­æè·å¤ç§å¼å¸¸\ntry {\n  ...\n} catch (someexception | otherexception e) {\n  ...\n}\n\n\n\n# jvm å¦ä½å®ç°åå°\n\n\n# åèèµæ\n\n * ãæ·±å¥çè§£ java èææºã\n * æ·±å¥æè§£ java èææº',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Java é¢è¯æ»ç»",frontmatter:{title:"Java é¢è¯æ»ç»",date:"2020-06-04T13:51:00.000Z",categories:["Java","JavaSE"],tags:["Java","JavaSE","é¢è¯"],permalink:"/pages/5f886e/"},regularPath:"/01.Java/01.JavaSE/99.Java%E9%9D%A2%E8%AF%95.html",relativePath:"01.Java/01.JavaSE/99.Javaé¢è¯.md",key:"v-6c8957c8",path:"/pages/5f886e/",headers:[{level:2,title:"åºç¡",slug:"åºç¡",normalizedTitle:"åºç¡",charIndex:16},{level:3,title:"å·¥å·ç±»",slug:"å·¥å·ç±»",normalizedTitle:"å·¥å·ç±»",charIndex:23},{level:4,title:"String",slug:"string",normalizedTitle:"string",charIndex:30},{level:3,title:"é¢åå¯¹è±¡",slug:"é¢åå¯¹è±¡",normalizedTitle:"é¢åå¯¹è±¡",charIndex:291},{level:3,title:"åå°",slug:"åå°",normalizedTitle:"åå°",charIndex:416},{level:4,title:"â­ åå»ºå®ä¾",slug:"â­-åå»ºå®ä¾",normalizedTitle:"â­ åå»ºå®ä¾",charIndex:422},{level:4,title:"â­ å è½½å®ä¾",slug:"â­-å è½½å®ä¾",normalizedTitle:"â­ å è½½å®ä¾",charIndex:538},{level:4,title:"â­â­ å¨æä»£ç",slug:"â­â­-å¨æä»£ç",normalizedTitle:"â­â­ å¨æä»£ç",charIndex:748},{level:3,title:"JDK8",slug:"jdk8",normalizedTitle:"jdk8",charIndex:1164},{level:3,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:1173},{level:4,title:"â­ hashcode",slug:"â­-hashcode",normalizedTitle:"â­ hashcode",charIndex:1179},{level:2,title:"IO",slug:"io",normalizedTitle:"io",charIndex:1768},{level:3,title:"NIO",slug:"nio",normalizedTitle:"nio",charIndex:1775},{level:3,title:"åºåå",slug:"åºåå",normalizedTitle:"åºåå",charIndex:1820},{level:4,title:"â­ åºååé®é¢",slug:"â­-åºååé®é¢",normalizedTitle:"â­ åºååé®é¢",charIndex:1827},{level:2,title:"å®¹å¨",slug:"å®¹å¨",normalizedTitle:"å®¹å¨",charIndex:2160},{level:3,title:"List",slug:"list",normalizedTitle:"list",charIndex:2167},{level:4,title:"ArrayList å LinkedList æä»ä¹åºå«ï¼",slug:"arraylist-å-linkedlist-æä»ä¹åºå«",normalizedTitle:"arraylist å linkedlist æä»ä¹åºå«ï¼",charIndex:2175},{level:3,title:"Map",slug:"map",normalizedTitle:"map",charIndex:2259},{level:2,title:"å¹¶å",slug:"å¹¶å",normalizedTitle:"å¹¶å",charIndex:2287},{level:3,title:"å¹¶åç®ä»",slug:"å¹¶åç®ä»",normalizedTitle:"å¹¶åç®ä»",charIndex:2294},{level:4,title:"ä»ä¹æ¯è¿ç¨ï¼ä»ä¹æ¯çº¿ç¨ï¼è¿ç¨åçº¿ç¨çåºå«ï¼",slug:"ä»ä¹æ¯è¿ç¨-ä»ä¹æ¯çº¿ç¨-è¿ç¨åçº¿ç¨çåºå«",normalizedTitle:"ä»ä¹æ¯è¿ç¨ï¼ä»ä¹æ¯çº¿ç¨ï¼è¿ç¨åçº¿ç¨çåºå«ï¼",charIndex:2302},{level:4,title:"å¹¶åï¼å¤çº¿ç¨ï¼ç¼ç¨çå¥½å¤æ¯ä»ä¹ï¼",slug:"å¹¶å-å¤çº¿ç¨-ç¼ç¨çå¥½å¤æ¯ä»ä¹",normalizedTitle:"å¹¶åï¼å¤çº¿ç¨ï¼ç¼ç¨çå¥½å¤æ¯ä»ä¹ï¼",charIndex:2568},{level:4,title:"å¹¶åä¸å®æ¯ä¸²è¡æ´å¿«åï¼",slug:"å¹¶åä¸å®æ¯ä¸²è¡æ´å¿«å",normalizedTitle:"å¹¶åä¸å®æ¯ä¸²è¡æ´å¿«åï¼",charIndex:2628},{level:4,title:"å¦ä½è®©æ­£å¨è¿è¡ççº¿ç¨æåä¸æ®µæ¶é´ï¼",slug:"å¦ä½è®©æ­£å¨è¿è¡ççº¿ç¨æåä¸æ®µæ¶é´",normalizedTitle:"å¦ä½è®©æ­£å¨è¿è¡ççº¿ç¨æåä¸æ®µæ¶é´ï¼",charIndex:2902},{level:4,title:"ä»ä¹æ¯çº¿ç¨è°åº¦å¨(Thread Scheduler)åæ¶é´åç(Time Slicing)ï¼",slug:"ä»ä¹æ¯çº¿ç¨è°åº¦å¨-thread-scheduler-åæ¶é´åç-time-slicing",normalizedTitle:"ä»ä¹æ¯çº¿ç¨è°åº¦å¨(thread scheduler)åæ¶é´åç(time slicing)ï¼",charIndex:3029},{level:4,title:"å¨å¤çº¿ç¨ä¸­ï¼ä»ä¹æ¯ä¸ä¸æåæ¢(context-switching)ï¼",slug:"å¨å¤çº¿ç¨ä¸­-ä»ä¹æ¯ä¸ä¸æåæ¢-context-switching",normalizedTitle:"å¨å¤çº¿ç¨ä¸­ï¼ä»ä¹æ¯ä¸ä¸æåæ¢(context-switching)ï¼",charIndex:3288},{level:4,title:"å¦ä½ç¡®ä¿çº¿ç¨å®å¨ï¼",slug:"å¦ä½ç¡®ä¿çº¿ç¨å®å¨",normalizedTitle:"å¦ä½ç¡®ä¿çº¿ç¨å®å¨ï¼",charIndex:3393},{level:4,title:"ä»ä¹æ¯æ­»é(Deadlock)ï¼å¦ä½åæåé¿åæ­»éï¼",slug:"ä»ä¹æ¯æ­»é-deadlock-å¦ä½åæåé¿åæ­»é",normalizedTitle:"ä»ä¹æ¯æ­»é(deadlock)ï¼å¦ä½åæåé¿åæ­»éï¼",charIndex:3475},{level:3,title:"çº¿ç¨åºç¡",slug:"çº¿ç¨åºç¡",normalizedTitle:"çº¿ç¨åºç¡",charIndex:3696},{level:4,title:"Java çº¿ç¨çå½å¨æä¸­æåªäºç¶æï¼åç¶æä¹é´å¦ä½åæ¢ï¼",slug:"java-çº¿ç¨çå½å¨æä¸­æåªäºç¶æ-åç¶æä¹é´å¦ä½åæ¢",normalizedTitle:"java çº¿ç¨çå½å¨æä¸­æåªäºç¶æï¼åç¶æä¹é´å¦ä½åæ¢ï¼",charIndex:3704},{level:4,title:"åå»ºçº¿ç¨æåªäºæ¹å¼ï¼è¿äºæ¹æ³åèªå©å¼æ¯ä»ä¹ï¼",slug:"åå»ºçº¿ç¨æåªäºæ¹å¼-è¿äºæ¹æ³åèªå©å¼æ¯ä»ä¹",normalizedTitle:"åå»ºçº¿ç¨æåªäºæ¹å¼ï¼è¿äºæ¹æ³åèªå©å¼æ¯ä»ä¹ï¼",charIndex:4542},{level:4,title:"ä»ä¹æ¯ Callable å Futureï¼ä»ä¹æ¯ FutureTaskï¼",slug:"ä»ä¹æ¯-callable-å-future-ä»ä¹æ¯-futuretask",normalizedTitle:"ä»ä¹æ¯ callable å futureï¼ä»ä¹æ¯ futuretaskï¼",charIndex:5364},{level:4,title:"start() å run() æä»ä¹åºå«ï¼å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run() æ¹æ³ä¹ï¼",slug:"start-å-run-æä»ä¹åºå«-å¯ä»¥ç´æ¥è°ç¨-thread-ç±»ç-run-æ¹æ³ä¹",normalizedTitle:"start() å run() æä»ä¹åºå«ï¼å¯ä»¥ç´æ¥è°ç¨ thread ç±»ç run() æ¹æ³ä¹ï¼",charIndex:6e3},{level:4,title:"sleep()ãyield()ãjoin() æ¹æ³æä»ä¹åºå«ï¼ä¸ºä»ä¹ sleep() å yield() æ¹æ³æ¯éæï¼staticï¼çï¼",slug:"sleep-ãyield-ãjoin-æ¹æ³æä»ä¹åºå«-ä¸ºä»ä¹-sleep-å-yield-æ¹æ³æ¯éæ-static-ç",normalizedTitle:"sleep()ãyield()ãjoin() æ¹æ³æä»ä¹åºå«ï¼ä¸ºä»ä¹ sleep() å yield() æ¹æ³æ¯éæï¼staticï¼çï¼",charIndex:6236},{level:4,title:"Java ççº¿ç¨ä¼åçº§å¦ä½æ§å¶ï¼é«ä¼åçº§ç Java çº¿ç¨ä¸å®åæ§è¡åï¼",slug:"java-ççº¿ç¨ä¼åçº§å¦ä½æ§å¶-é«ä¼åçº§ç-java-çº¿ç¨ä¸å®åæ§è¡å",normalizedTitle:"java ççº¿ç¨ä¼åçº§å¦ä½æ§å¶ï¼é«ä¼åçº§ç java çº¿ç¨ä¸å®åæ§è¡åï¼",charIndex:6998},{level:4,title:"ä»ä¹æ¯å®æ¤çº¿ç¨ï¼ä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨ï¼å¦ä½åå»ºå®æ¤çº¿ç¨ï¼",slug:"ä»ä¹æ¯å®æ¤çº¿ç¨-ä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨-å¦ä½åå»ºå®æ¤çº¿ç¨",normalizedTitle:"ä»ä¹æ¯å®æ¤çº¿ç¨ï¼ä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨ï¼å¦ä½åå»ºå®æ¤çº¿ç¨ï¼",charIndex:7327},{level:4,title:"çº¿ç¨é´æ¯å¦ä½éä¿¡çï¼",slug:"çº¿ç¨é´æ¯å¦ä½éä¿¡ç",normalizedTitle:"çº¿ç¨é´æ¯å¦ä½éä¿¡çï¼",charIndex:7805},{level:4,title:"ä¸ºä»ä¹çº¿ç¨éä¿¡çæ¹æ³ wait(), notify() å notifyAll() è¢«å®ä¹å¨ Object ç±»éï¼",slug:"ä¸ºä»ä¹çº¿ç¨éä¿¡çæ¹æ³-wait-notify-å-notifyall-è¢«å®ä¹å¨-object-ç±»é",normalizedTitle:"ä¸ºä»ä¹çº¿ç¨éä¿¡çæ¹æ³ wait(), notify() å notifyall() è¢«å®ä¹å¨ object ç±»éï¼",charIndex:7979},{level:4,title:"ä¸ºä»ä¹ wait(), notify() å notifyAll() å¿é¡»å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨ï¼",slug:"ä¸ºä»ä¹-wait-notify-å-notifyall-å¿é¡»å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨",normalizedTitle:"ä¸ºä»ä¹ wait(), notify() å notifyall() å¿é¡»å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨ï¼",charIndex:8205},{level:3,title:"å¹¶åæºå¶çåºå±å®ç°",slug:"å¹¶åæºå¶çåºå±å®ç°",normalizedTitle:"å¹¶åæºå¶çåºå±å®ç°",charIndex:8469},{level:4,title:"â­â­â­ synchronized",slug:"â­â­â­-synchronized",normalizedTitle:"â­â­â­ synchronized",charIndex:8505},{level:4,title:"â­ volatile",slug:"â­-volatile",normalizedTitle:"â­ volatile",charIndex:9437},{level:4,title:"â­â­ CAS",slug:"â­â­-cas",normalizedTitle:"â­â­ cas",charIndex:10327},{level:4,title:"â­ ThreadLocal",slug:"â­-threadlocal",normalizedTitle:"â­ threadlocal",charIndex:11332},{level:3,title:"åå­æ¨¡å",slug:"åå­æ¨¡å",normalizedTitle:"åå­æ¨¡å",charIndex:12024},{level:4,title:"ä»ä¹æ¯ Java åå­æ¨¡å",slug:"ä»ä¹æ¯-java-åå­æ¨¡å",normalizedTitle:"ä»ä¹æ¯ java åå­æ¨¡å",charIndex:12032},{level:3,title:"åæ­¥å®¹å¨åå¹¶åå®¹å¨",slug:"åæ­¥å®¹å¨åå¹¶åå®¹å¨",normalizedTitle:"åæ­¥å®¹å¨åå¹¶åå®¹å¨",charIndex:12999},{level:4,title:"â­ åæ­¥å®¹å¨",slug:"â­-åæ­¥å®¹å¨",normalizedTitle:"â­ åæ­¥å®¹å¨",charIndex:13033},{level:4,title:"â­â­â­ ConcurrentHashMap",slug:"â­â­â­-concurrenthashmap",normalizedTitle:"â­â­â­ concurrenthashmap",charIndex:13432},{level:4,title:"â­â­ CopyOnWriteArrayList",slug:"â­â­-copyonwritearraylist",normalizedTitle:"â­â­ copyonwritearraylist",charIndex:14051},{level:3,title:"å¹¶åé",slug:"å¹¶åé",normalizedTitle:"å¹¶åé",charIndex:14512},{level:4,title:"â­â­ éç±»å",slug:"â­â­-éç±»å",normalizedTitle:"â­â­ éç±»å",charIndex:14539},{level:4,title:"â­â­ AQS",slug:"â­â­-aqs",normalizedTitle:"â­â­ aqs",charIndex:15361},{level:4,title:"â­â­ ReentrantLock",slug:"â­â­-reentrantlock",normalizedTitle:"â­â­ reentrantlock",charIndex:16528},{level:4,title:"â­ ReentrantReadWriteLock",slug:"â­-reentrantreadwritelock",normalizedTitle:"â­ reentrantreadwritelock",charIndex:17078},{level:4,title:"â­ Condition",slug:"â­-condition",normalizedTitle:"â­ condition",charIndex:17630},{level:4,title:"â­â­ æ­»é",slug:"â­â­-æ­»é",normalizedTitle:"â­â­ æ­»é",charIndex:17796},{level:3,title:"åå­åéç±»",slug:"åå­åéç±»",normalizedTitle:"åå­åéç±»",charIndex:17956},{level:4,title:"â­ åå­ç±»ç®ä»",slug:"â­-åå­ç±»ç®ä»",normalizedTitle:"â­ åå­ç±»ç®ä»",charIndex:17985},{level:4,title:"â­ åå­ç±»çåç",slug:"â­-åå­ç±»çåç",normalizedTitle:"â­ åå­ç±»çåç",charIndex:18621},{level:3,title:"å¹¶åå·¥å·ç±»",slug:"å¹¶åå·¥å·ç±»",normalizedTitle:"å¹¶åå·¥å·ç±»",charIndex:18754},{level:4,title:"â­ CountDownLatch",slug:"â­-countdownlatch",normalizedTitle:"â­ countdownlatch",charIndex:18785},{level:4,title:"â­ CyclicBarrier",slug:"â­-cyclicbarrier",normalizedTitle:"â­ cyclicbarrier",charIndex:19069},{level:4,title:"â­ Semaphore",slug:"â­-semaphore",normalizedTitle:"â­ semaphore",charIndex:19537},{level:3,title:"çº¿ç¨æ± ",slug:"çº¿ç¨æ± ",normalizedTitle:"çº¿ç¨æ± ",charIndex:5553},{level:4,title:"â­â­ ThreadPoolExecutor",slug:"â­â­-threadpoolexecutor",normalizedTitle:"â­â­ threadpoolexecutor",charIndex:19845},{level:4,title:"â­ Executors",slug:"â­-executors",normalizedTitle:"â­ executors",charIndex:22437},{level:2,title:"JVM",slug:"jvm",normalizedTitle:"jvm",charIndex:677},{level:3,title:"åå­ç®¡ç",slug:"åå­ç®¡ç",normalizedTitle:"åå­ç®¡ç",charIndex:23316},{level:3,title:"OOM",slug:"oom",normalizedTitle:"oom",charIndex:23325},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:23333}],headersStr:"åºç¡ å·¥å·ç±» String é¢åå¯¹è±¡ åå° â­ åå»ºå®ä¾ â­ å è½½å®ä¾ â­â­ å¨æä»£ç JDK8 å¶ä» â­ hashcode IO NIO åºåå â­ åºååé®é¢ å®¹å¨ List ArrayList å LinkedList æä»ä¹åºå«ï¼ Map å¹¶å å¹¶åç®ä» ä»ä¹æ¯è¿ç¨ï¼ä»ä¹æ¯çº¿ç¨ï¼è¿ç¨åçº¿ç¨çåºå«ï¼ å¹¶åï¼å¤çº¿ç¨ï¼ç¼ç¨çå¥½å¤æ¯ä»ä¹ï¼ å¹¶åä¸å®æ¯ä¸²è¡æ´å¿«åï¼ å¦ä½è®©æ­£å¨è¿è¡ççº¿ç¨æåä¸æ®µæ¶é´ï¼ ä»ä¹æ¯çº¿ç¨è°åº¦å¨(Thread Scheduler)åæ¶é´åç(Time Slicing)ï¼ å¨å¤çº¿ç¨ä¸­ï¼ä»ä¹æ¯ä¸ä¸æåæ¢(context-switching)ï¼ å¦ä½ç¡®ä¿çº¿ç¨å®å¨ï¼ ä»ä¹æ¯æ­»é(Deadlock)ï¼å¦ä½åæåé¿åæ­»éï¼ çº¿ç¨åºç¡ Java çº¿ç¨çå½å¨æä¸­æåªäºç¶æï¼åç¶æä¹é´å¦ä½åæ¢ï¼ åå»ºçº¿ç¨æåªäºæ¹å¼ï¼è¿äºæ¹æ³åèªå©å¼æ¯ä»ä¹ï¼ ä»ä¹æ¯ Callable å Futureï¼ä»ä¹æ¯ FutureTaskï¼ start() å run() æä»ä¹åºå«ï¼å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run() æ¹æ³ä¹ï¼ sleep()ãyield()ãjoin() æ¹æ³æä»ä¹åºå«ï¼ä¸ºä»ä¹ sleep() å yield() æ¹æ³æ¯éæï¼staticï¼çï¼ Java ççº¿ç¨ä¼åçº§å¦ä½æ§å¶ï¼é«ä¼åçº§ç Java çº¿ç¨ä¸å®åæ§è¡åï¼ ä»ä¹æ¯å®æ¤çº¿ç¨ï¼ä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨ï¼å¦ä½åå»ºå®æ¤çº¿ç¨ï¼ çº¿ç¨é´æ¯å¦ä½éä¿¡çï¼ ä¸ºä»ä¹çº¿ç¨éä¿¡çæ¹æ³ wait(), notify() å notifyAll() è¢«å®ä¹å¨ Object ç±»éï¼ ä¸ºä»ä¹ wait(), notify() å notifyAll() å¿é¡»å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨ï¼ å¹¶åæºå¶çåºå±å®ç° â­â­â­ synchronized â­ volatile â­â­ CAS â­ ThreadLocal åå­æ¨¡å ä»ä¹æ¯ Java åå­æ¨¡å åæ­¥å®¹å¨åå¹¶åå®¹å¨ â­ åæ­¥å®¹å¨ â­â­â­ ConcurrentHashMap â­â­ CopyOnWriteArrayList å¹¶åé â­â­ éç±»å â­â­ AQS â­â­ ReentrantLock â­ ReentrantReadWriteLock â­ Condition â­â­ æ­»é åå­åéç±» â­ åå­ç±»ç®ä» â­ åå­ç±»çåç å¹¶åå·¥å·ç±» â­ CountDownLatch â­ CyclicBarrier â­ Semaphore çº¿ç¨æ±  â­â­ ThreadPoolExecutor â­ Executors JVM åå­ç®¡ç OOM åèèµæ",content:'# Java é¢è¯æ»ç»\n\n\n# åºç¡\n\n\n# å·¥å·ç±»\n\n# String\n\n> String ç±»è½è¢«ç»§æ¿åï¼\n> \n> Stringï¼StringBufferï¼StringBuilder çåºå«ã\n\nString ç±»ä¸è½è¢«ç»§æ¿ãå ä¸ºå¶è¢« final ä¿®é¥°ï¼æä»¥æ æ³è¢«ç»§æ¿ã\n\nStringBufferï¼StringBuilder æ¼æ¥å­ç¬¦ä¸²ï¼ä½¿ç¨ append æ¯ String æçé«ãå ä¸º String ä¼éå¼ new String å¯¹è±¡ã\n\nStringBuffer ä¸»è¦æ¹æ³é½ç¨ synchronized ä¿®é¥°ï¼æ¯çº¿ç¨å®å¨çï¼è StringBuilder ä¸æ¯ã\n\n\n# é¢åå¯¹è±¡\n\n> æ½è±¡ç±»åæ¥å£çåºå«ï¼\n> \n> ç±»å¯ä»¥ç»§æ¿å¤ä¸ªç±»ä¹ï¼æ¥å£å¯ä»¥ç»§æ¿å¤ä¸ªæ¥å£ä¹ï¼ç±»å¯ä»¥å®ç°å¤ä¸ªæ¥å£ä¹ï¼\n\nç±»åªè½ç»§æ¿ä¸ä¸ªç±»ï¼ä½æ¯å¯ä»¥å®ç°å¤ä¸ªæ¥å£ãæ¥å£å¯ä»¥ç»§æ¿å¤ä¸ªæ¥å£ã\n\n> ç»§æ¿åèåçåºå«å¨åªï¼\n\nä¸è¬ï¼è½ç¨èåå°±å«ç¨ç»§æ¿ã\n\n\n# åå°\n\n# â­ åå»ºå®ä¾\n\n> åå°åå»ºå®ä¾æå ç§æ¹å¼ï¼\n\néè¿åå°æ¥åå»ºå®ä¾å¯¹è±¡ä¸»è¦æä¸¤ç§æ¹å¼ï¼\n\n * ç¨ Class å¯¹è±¡ç newInstance æ¹æ³ã\n * ç¨ Constructor å¯¹è±¡ç newInstance æ¹æ³ã\n\n# â­ å è½½å®ä¾\n\n> å è½½å®ä¾æå ç§æ¹å¼ï¼\n> \n> Class.forName("className") å ClassLoader.laodClass("className") æä»ä¹åºå«ï¼\n\n * Class.forName("className") å è½½çæ¯å·²ç»åå§åå° JVM ä¸­çç±»ã\n * ClassLoader.loadClass("className") è£è½½çæ¯è¿æ²¡æåå§åå° JVM ä¸­çç±»ã\n\n# â­â­ å¨æä»£ç\n\n> å¨æä»£çæå ç§å®ç°æ¹å¼ï¼æä»ä¹ç¹ç¹ï¼\n> \n> JDK å¨æä»£çå CGLIB å¨æä»£çæä»ä¹åºå«ï¼\n\nï¼1ï¼JDK æ¹å¼\n\nä»£çç±»ä¸å§æç±»å®ç°åä¸æ¥å£ï¼ä¸»è¦æ¯éè¿ä»£çç±»å®ç° InvocationHandler å¹¶éå invoke æ¹æ³æ¥è¿è¡å¨æä»£ççï¼å¨ invoke æ¹æ³ä¸­å°å¯¹æ¹æ³è¿è¡å¤çã\n\nJDK å¨æä»£çç¹ç¹ï¼\n\n * ä¼ç¹ï¼ç¸å¯¹äºéæä»£çæ¨¡å¼ï¼ä¸éè¦ç¡¬ç¼ç æ¥å£ï¼ä»£ç å¤ç¨çé«ã\n * ç¼ºç¹ï¼å¼ºå¶è¦æ±ä»£çç±»å®ç° InvocationHandler æ¥å£ã\n\nï¼2ï¼CGLIB\n\nCGLIB åºå±ï¼å¶å®æ¯åå©äº ASM è¿ä¸ªå¼ºå¤§ç Java å­èç æ¡æ¶å»è¿è¡å­èç å¢å¼ºæä½ã\n\nCGLIB å¨æä»£çç¹ç¹ï¼\n\nä¼ç¹ï¼ä½¿ç¨å­èç å¢å¼ºï¼æ¯ JDK å¨æä»£çæ¹å¼æ§è½é«ãå¯ä»¥å¨è¿è¡æ¶å¯¹ç±»æèæ¯æ¥å£è¿è¡å¢å¼ºæä½ï¼ä¸å§æç±»æ éå®ç°æ¥å£ã\n\nç¼ºç¹ï¼ä¸è½å¯¹ final ç±»ä»¥å final æ¹æ³è¿è¡ä»£çã\n\n\n# JDK8\n\n\n# å¶ä»\n\n# â­ hashcode\n\n> æ==è¿ç®ç¬¦äºï¼ä¸ºä»ä¹è¿éè¦ equals åï¼\n> \n> è¯´ä¸è¯´ä½ å¯¹ java.lang.Object å¯¹è±¡ä¸­ hashCode å equals æ¹æ³ççè§£ãå¨ä»ä¹åºæ¯ä¸é è¦éæ°å®ç°è¿ä¸¤ä¸ªæ¹æ³ã\n> \n> ææ²¡æå¯è½ 2 ä¸ªä¸ç¸ç­çå¯¹è±¡æç¸åç hashcode\n\nï¼1ï¼æ==è¿ç®ç¬¦äºï¼ä¸ºä»ä¹è¿éè¦ equals åï¼\n\nequals ç­ä»·äº==,è==è¿ç®ç¬¦æ¯å¤æ­ä¸¤ä¸ªå¯¹è±¡æ¯ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼å³ä»ä»¬çå°åæ¯å¦ç¸ç­ãèè¦å equals æ´å¤çæ¯è¿½æ±ä¸¤ä¸ªå¯¹è±¡å¨é»è¾ä¸çç¸ç­ï¼ä½ å¯ä»¥è¯´æ¯å¼ç¸ç­ï¼ä¹å¯è¯´æ¯åå®¹ç¸ç­ã\n\nï¼2ï¼è¯´ä¸è¯´ä½ å¯¹ java.lang.Object å¯¹è±¡ä¸­ hashCode å equals æ¹æ³ççè§£ãå¨ä»ä¹åºæ¯ä¸é è¦éæ°å®ç°è¿ä¸¤ä¸ªæ¹æ³ã\n\nå¨éåæ¥æ¾æ¶ï¼hashcode è½å¤§å¤§éä½å¯¹è±¡æ¯è¾æ¬¡æ°ï¼æé«æ¥æ¾æçï¼\n\nï¼3ï¼ææ²¡æå¯è½ 2 ä¸ªä¸ç¸ç­çå¯¹è±¡æç¸åç hashcode\n\næå¯è½ã\n\n * å¦æä¸¤ä¸ªå¯¹è±¡ equalsï¼Java è¿è¡æ¶ç¯å¢ä¼è®¤ä¸ºä»ä»¬ç hashcode ä¸å®ç¸ç­ã\n * å¦æä¸¤ä¸ªå¯¹è±¡ä¸ equalsï¼ä»ä»¬ç hashcode æå¯è½ç¸ç­ã\n * å¦æä¸¤ä¸ªå¯¹è±¡ hashcode ç¸ç­ï¼ä»ä»¬ä¸ä¸å® equalsã\n * å¦æä¸¤ä¸ªå¯¹è±¡ hashcode ä¸ç¸ç­ï¼ä»ä»¬ä¸å®ä¸ equalsã\n\n\n# IO\n\n\n# NIO\n\n> ä»ä¹æ¯ NIOï¼\n> \n> NIO å BIOãAIO æä½å·®å«ï¼\n\n\n# åºåå\n\n# â­ åºååé®é¢\n\n> åºååãååºååæåªäºé®é¢ï¼å¦ä½è§£å³ï¼\n\nJava çåºååè½ä¿è¯å¯¹è±¡ç¶æçæä¹ä¿å­ï¼ä½æ¯éå°ä¸äºå¯¹è±¡ç»æå¤æçæåµè¿æ¯é¾ä»¥å¤çï¼è¿éå½çº³ä¸ä¸ï¼\n\n * å½ç¶ç±»ç»§æ¿ Serializable æ¥å£æ¶ï¼ææå­ç±»é½å¯ä»¥è¢«åºååã\n * å­ç±»å®ç°äº Serializable æ¥å£ï¼ç¶ç±»æ²¡æï¼åç¶ç±»çå±æ§ä¸ä¼è¢«åºååï¼ä¸æ¥éï¼æ°æ®ä¸¢å¤±ï¼ï¼å­ç±»çå±æ§ä»å¯ä»¥æ­£ç¡®åºååã\n * å¦æåºååçå±æ§æ¯å¯¹è±¡ï¼åè¿ä¸ªå¯¹è±¡ä¹å¿é¡»å®ç° Serializable æ¥å£ï¼å¦åä¼æ¥éã\n * å¨ååºååæ¶ï¼å¦æå¯¹è±¡çå±æ§æä¿®æ¹æå åï¼åä¿®æ¹çé¨åå±æ§ä¼ä¸¢å¤±ï¼ä½ä¸ä¼æ¥éã\n * å¨ååºååæ¶ï¼å¦æ serialVersionUID è¢«ä¿®æ¹ï¼åååºååæ¶ä¼å¤±è´¥ã\n\n\n# å®¹å¨\n\n\n# List\n\n# ArrayList å LinkedList æä»ä¹åºå«ï¼\n\nArrayList æ¯æ°ç»é¾è¡¨ï¼è®¿é®æçæ´é«ã\n\nLinkedList æ¯åé¾è¡¨ï¼æ°æ®æåºå­å¨ã\n\n\n# Map\n\nè¯·æè¿° HashMap çå®ç°åçï¼\n\n\n# å¹¶å\n\n\n# å¹¶åç®ä»\n\n# ä»ä¹æ¯è¿ç¨ï¼ä»ä¹æ¯çº¿ç¨ï¼è¿ç¨åçº¿ç¨çåºå«ï¼\n\n * ä»ä¹æ¯è¿ç¨ï¼\n   * ç®è¨ä¹ï¼è¿ç¨å¯è§ä¸ºä¸ä¸ªæ­£å¨è¿è¡çç¨åºã\n   * è¿ç¨æ¯å·æä¸å®ç¬ç«åè½çç¨åºå³äºæä¸ªæ°æ®éåä¸çä¸æ¬¡è¿è¡æ´»å¨ãè¿ç¨æ¯æä½ç³»ç»è¿è¡èµæºåéçåºæ¬åä½ã\n * ä»ä¹æ¯çº¿ç¨ï¼\n   * çº¿ç¨æ¯æä½ç³»ç»è¿è¡è°åº¦çåºæ¬åä½ã\n * è¿ç¨ vs. çº¿ç¨\n   * ä¸ä¸ªç¨åºè³å°æä¸ä¸ªè¿ç¨ï¼ä¸ä¸ªè¿ç¨è³å°æä¸ä¸ªçº¿ç¨ã\n   * çº¿ç¨æ¯è¿ç¨ååæ´ç»ï¼æä»¥æ§è¡å¼éæ´å°ï¼å¹¶åæ§æ´é«ã\n   * è¿ç¨æ¯ä¸ä¸ªå®ä½ï¼æ¥æç¬ç«çèµæºï¼èåä¸ä¸ªè¿ç¨ä¸­çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çèµæºã\n\n# å¹¶åï¼å¤çº¿ç¨ï¼ç¼ç¨çå¥½å¤æ¯ä»ä¹ï¼\n\n * æ´ææççå©ç¨å¤å¤çå¨æ ¸å¿\n * æ´å¿«çååºæ¶é´\n * æ´å¥½çç¼ç¨æ¨¡å\n\n# å¹¶åä¸å®æ¯ä¸²è¡æ´å¿«åï¼\n\nç­ï¼å¦ã\n\nè¦ç¹ï¼åå»ºçº¿ç¨åçº¿ç¨ä¸ä¸æåæ¢æä¸å®å¼éã\n\nè¯´æï¼å³ä½¿æ¯åæ ¸å¤çå¨ä¹æ¯æå¤çº¿ç¨ãCPU éè¿ç»æ¯ä¸ªçº¿ç¨åéæ¶é´åççç®æ³æ¥å¾ªç¯æ§è¡ä»»å¡ï¼å½åä»»å¡æ§è¡ä¸ä¸ªæ¶é´çåä¼åæ¢å°ä¸ä¸ä¸ªä»»å¡ãä½æ¯ï¼å¨åæ¢åä¼ä¿æä¸ä¸ä¸ªä»»å¡çç¶æï¼ä»¥ä¾¿ä¸æ¬¡åæ¢åè¿ä¸ªä»»å¡æ¶ï¼å¯ä»¥åå è½½è¿ä¸ªä»»å¡çç¶æãæä»¥ä»»å¡ä»ä¿å­å°åå è½½çè¿ç¨å°±æ¯ä¸æ¬¡ä¸ä¸æåæ¢ã\n\nå¼ç³\n\n * å¦ä½åå°ä¸ä¸æåæ¢ï¼\n   * å°½éå°ç¨é\n   * CAS ç®æ³\n   * çº¿ç¨æ°è¦åç\n   * åç¨ï¼å¨åçº¿ç¨ä¸­å®ç°å¤ä»»å¡è°åº¦ï¼å¹¶å¨åçº¿ç¨ä¸­ç»´æå¤ä¸ªä»»å¡çåæ¢\n\n# å¦ä½è®©æ­£å¨è¿è¡ççº¿ç¨æåä¸æ®µæ¶é´ï¼\n\næä»¬å¯ä»¥ä½¿ç¨ Thread ç±»ç Sleep() æ¹æ³è®©çº¿ç¨æåä¸æ®µæ¶é´ã\n\néè¦æ³¨æçæ¯ï¼è¿å¹¶ä¸ä¼è®©çº¿ç¨ç»æ­¢ï¼ä¸æ¦ä»ä¼ç ä¸­å¤éçº¿ç¨ï¼çº¿ç¨çç¶æå°ä¼è¢«æ¹åä¸º Runnableï¼å¹¶ä¸æ ¹æ®çº¿ç¨è°åº¦ï¼å®å°å¾å°æ§è¡ã\n\n# ä»ä¹æ¯çº¿ç¨è°åº¦å¨(Thread Scheduler)åæ¶é´åç(Time Slicing)ï¼\n\nçº¿ç¨è°åº¦å¨æ¯ä¸ä¸ªæä½ç³»ç»æå¡ï¼å®è´è´£ä¸º Runnable ç¶æççº¿ç¨åé CPU æ¶é´ãä¸æ¦æä»¬åå»ºä¸ä¸ªçº¿ç¨å¹¶å¯å¨å®ï¼å®çæ§è¡ä¾¿ä¾èµäºçº¿ç¨è°åº¦å¨çå®ç°ã\n\næ¶é´åçæ¯æå°å¯ç¨ç CPU æ¶é´åéç»å¯ç¨ç Runnable çº¿ç¨çè¿ç¨ã\n\nåé CPU æ¶é´å¯ä»¥åºäºçº¿ç¨ä¼åçº§æèçº¿ç¨ç­å¾çæ¶é´ãçº¿ç¨è°åº¦å¹¶ä¸åå° Java èææºæ§å¶ï¼æä»¥ç±åºç¨ç¨åºæ¥æ§å¶å®æ¯æ´å¥½çéæ©ï¼ä¹å°±æ¯è¯´ä¸è¦è®©ä½ çç¨åºä¾èµäºçº¿ç¨çä¼åçº§ï¼ã\n\n# å¨å¤çº¿ç¨ä¸­ï¼ä»ä¹æ¯ä¸ä¸æåæ¢(context-switching)ï¼\n\nä¸ä¸æåæ¢æ¯å­å¨åæ¢å¤ CPU ç¶æçè¿ç¨ï¼å®ä½¿å¾çº¿ç¨æ§è¡è½å¤ä»ä¸­æ­ç¹æ¢å¤æ§è¡ãä¸ä¸æåæ¢æ¯å¤ä»»å¡æä½ç³»ç»åå¤çº¿ç¨ç¯å¢çåºæ¬ç¹å¾ã\n\n# å¦ä½ç¡®ä¿çº¿ç¨å®å¨ï¼\n\n * åå­ç±»(atomic concurrent classes)\n * é\n * volatile å³é®å­\n * ä¸åç±»åçº¿ç¨å®å¨ç±»\n\n# ä»ä¹æ¯æ­»é(Deadlock)ï¼å¦ä½åæåé¿åæ­»éï¼\n\næ­»éæ¯æä¸¤ä¸ªä»¥ä¸ççº¿ç¨æ°¸è¿ç¸äºé»å¡çæåµï¼è¿ç§æåµäº§çè³å°éè¦ä¸¤ä¸ªä»¥ä¸ççº¿ç¨åä¸¤ä¸ªä»¥ä¸çèµæºã\n\nåææ­»éï¼æä»¬éè¦æ¥ç Java åºç¨ç¨åºççº¿ç¨è½¬å¨ãæä»¬éè¦æ¾åºé£äºç¶æä¸º BLOCKED ççº¿ç¨åä»ä»¬ç­å¾çèµæºãæ¯ä¸ªèµæºé½æä¸ä¸ªå¯ä¸ç idï¼ç¨è¿ä¸ª id æä»¬å¯ä»¥æ¾åºåªäºçº¿ç¨å·²ç»æ¥æäºå®çå¯¹è±¡éã\n\né¿ååµå¥éï¼åªå¨éè¦çå°æ¹ä½¿ç¨éåé¿åæ éæç­å¾æ¯é¿åæ­»éçéå¸¸åæ³ã\n\n\n# çº¿ç¨åºç¡\n\n# Java çº¿ç¨çå½å¨æä¸­æåªäºç¶æï¼åç¶æä¹é´å¦ä½åæ¢ï¼\n\n\n\njava.lang.Thread.State ä¸­å®ä¹äº 6 ç§ä¸åççº¿ç¨ç¶æï¼å¨ç»å®çä¸ä¸ªæ¶å»ï¼çº¿ç¨åªè½å¤äºå¶ä¸­çä¸ä¸ªç¶æã\n\nä»¥ä¸æ¯åç¶æçè¯´æï¼ä»¥åç¶æé´çèç³»ï¼\n\n * å¼å§ï¼Newï¼ - è¿æ²¡æè°ç¨ start() æ¹æ³ççº¿ç¨å¤äºæ­¤ç¶æã\n * å¯è¿è¡ï¼Runnableï¼ - å·²ç»è°ç¨äº start() æ¹æ³ççº¿ç¨ç¶æãæ­¤ç¶ææå³çï¼çº¿ç¨å·²ç»åå¤å¥½äºï¼ä¸æ¦è¢«çº¿ç¨è°åº¦å¨åéäº CPU æ¶é´çï¼å°±å¯ä»¥è¿è¡çº¿ç¨ã\n * é»å¡ï¼Blockedï¼ - é»å¡ç¶æãçº¿ç¨é»å¡ççº¿ç¨ç¶æç­å¾çè§å¨éå®ãå¤äºé»å¡ç¶æççº¿ç¨æ­£å¨ç­å¾çè§å¨éå®ï¼ä»¥ä¾¿å¨è°ç¨ Object.wait() ä¹åè¾å¥åæ­¥å/æ¹æ³æéæ°è¾å¥åæ­¥å/æ¹æ³ã\n * ç­å¾ï¼Waitingï¼ - ç­å¾ç¶æãä¸ä¸ªçº¿ç¨å¤äºç­å¾ç¶æï¼æ¯ç±äºæ§è¡äº 3 ä¸ªæ¹æ³ä¸­çä»»ææ¹æ³ï¼\n   * Object.wait()\n   * Thread.join()\n   * LockSupport.park()\n * å®æ¶ç­å¾ï¼Timed waitingï¼ - ç­å¾æå®æ¶é´çç¶æãä¸ä¸ªçº¿ç¨å¤äºå®æ¶ç­å¾ç¶æï¼æ¯ç±äºæ§è¡äºä»¥ä¸æ¹æ³ä¸­çä»»ææ¹æ³ï¼\n   * Thread.sleep(sleeptime)\n   * Object.wait(timeout)\n   * Thread.join(timeout)\n   * LockSupport.parkNanos(timeout)\n   * LockSupport.parkUntil(timeout)\n * ç»æ­¢(Terminated) - çº¿ç¨ run() æ¹æ³æ§è¡ç»æï¼æèå å¼å¸¸éåºäº run() æ¹æ³ï¼åè¯¥çº¿ç¨ç»æçå½å¨æãæ­»äº¡ççº¿ç¨ä¸å¯åæ¬¡å¤çã\n\n> ð åèéè¯»ï¼JavaThread Methods and Thread States ð åèéè¯»ï¼Java çº¿ç¨ç 5 ç§ç¶æååæ¢(éå½»è®²è§£)\n\n# åå»ºçº¿ç¨æåªäºæ¹å¼ï¼è¿äºæ¹æ³åèªå©å¼æ¯ä»ä¹ï¼\n\nåå»ºçº¿ç¨ä¸»è¦æä¸ç§æ¹å¼ï¼\n\n1. ç»§æ¿ Thread ç±»\n\n * å®ä¹ Thread ç±»çå­ç±»ï¼å¹¶éåè¯¥ç±»ç run() æ¹æ³ï¼è¯¥ run() æ¹æ³çæ¹æ³ä½å°±ä»£è¡¨äºçº¿ç¨è¦å®æçä»»å¡ãå æ­¤æ run() æ¹æ³ç§°ä¸ºæ§è¡ä½ã\n * åå»º Thread å­ç±»çå®ä¾ï¼å³åå»ºäºçº¿ç¨å¯¹è±¡ã\n * è°ç¨çº¿ç¨å¯¹è±¡ç start() æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\n2. å®ç° Runnable æ¥å£\n\n * å®ä¹ Runnable æ¥å£çå®ç°ç±»ï¼å¹¶éåè¯¥æ¥å£ç run() æ¹æ³ï¼è¯¥ run() æ¹æ³çæ¹æ³ä½åæ ·æ¯è¯¥çº¿ç¨ççº¿ç¨æ§è¡ä½ã\n * åå»º Runnable å®ç°ç±»çå®ä¾ï¼å¹¶ä»¥æ­¤å®ä¾ä½ä¸º Thread å¯¹è±¡ï¼è¯¥ Thread å¯¹è±¡ææ¯çæ­£ççº¿ç¨å¯¹è±¡ã\n * è°ç¨çº¿ç¨å¯¹è±¡ç start() æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\n3. éè¿ Callable æ¥å£å Future æ¥å£\n\n * åå»º Callable æ¥å£çå®ç°ç±»ï¼å¹¶å®ç° call() æ¹æ³ï¼è¯¥ call() æ¹æ³å°ä½ä¸ºçº¿ç¨æ§è¡ä½ï¼å¹¶ä¸æè¿åå¼ã\n * åå»º Callable å®ç°ç±»çå®ä¾ï¼ä½¿ç¨ FutureTask ç±»æ¥åè£ Callable å¯¹è±¡ï¼è¯¥ FutureTask å¯¹è±¡å°è£äºè¯¥ Callable å¯¹è±¡ç call() æ¹æ³çè¿åå¼ã\n * ä½¿ç¨ FutureTask å¯¹è±¡ä½ä¸º Thread å¯¹è±¡ç target åå»ºå¹¶å¯å¨æ°çº¿ç¨ã\n * è°ç¨ FutureTask å¯¹è±¡ç get() æ¹æ³æ¥è·å¾å­çº¿ç¨æ§è¡ç»æåçè¿åå¼\n\nä¸ç§åå»ºçº¿ç¨æ¹å¼å¯¹æ¯\n\n * å®ç° Runnable æ¥å£ä¼äºç»§æ¿ Thread ç±»ï¼å ä¸ºæ ¹æ®å¼æ¾å°é­ååââå®ç°æ¥å£æ´ä¾¿äºæ©å±ï¼\n * å®ç° Runnable æ¥å£ççº¿ç¨æ²¡æè¿åå¼ï¼èä½¿ç¨ Callable / Future æ¹å¼å¯ä»¥è®©çº¿ç¨æè¿åå¼ã\n\n> ð åèéè¯»ï¼Java åå»ºçº¿ç¨çä¸ç§æ¹å¼åå¶å¯¹æ¯\n\n# ä»ä¹æ¯ Callable å Futureï¼ä»ä¹æ¯ FutureTaskï¼\n\nä»ä¹æ¯ Callable å Futureï¼\n\nJava 5 å¨ concurrency åä¸­å¼å¥äº Callable æ¥å£ï¼å®å Runnable æ¥å£å¾ç¸ä¼¼ï¼ä½å®å¯ä»¥è¿åä¸ä¸ªå¯¹è±¡æèæåºä¸ä¸ªå¼å¸¸ã\n\nCallable æ¥å£ä½¿ç¨æ³åå»å®ä¹å®çè¿åç±»åãExecutors ç±»æä¾äºä¸äºæç¨çæ¹æ³å»å¨çº¿ç¨æ± ä¸­æ§è¡ Callable åçä»»å¡ãç±äº Callable ä»»å¡æ¯å¹¶è¡çï¼æä»¬å¿é¡»ç­å¾å®è¿åçç»æãFuture å¯¹è±¡ä¸ºæä»¬è§£å³äºè¿ä¸ªé®é¢ãå¨çº¿ç¨æ± æäº¤ Callable ä»»å¡åè¿åäºä¸ä¸ª Future å¯¹è±¡ï¼ä½¿ç¨å®æä»¬å¯ä»¥ç¥é Callable ä»»å¡çç¶æåå¾å° Callable è¿åçæ§è¡ç»æãFuture æä¾äº get() æ¹æ³è®©æä»¬å¯ä»¥ç­å¾ Callable ç»æå¹¶è·åå®çæ§è¡ç»æã\n\nä»ä¹æ¯ FutureTaskï¼\n\nFutureTask æ¯ Future çä¸ä¸ªåºç¡å®ç°ï¼æä»¬å¯ä»¥å°å®å Executors ä½¿ç¨å¤çå¼æ­¥ä»»å¡ãéå¸¸æä»¬ä¸éè¦ä½¿ç¨ FutureTask ç±»ï¼åå½æä»¬æç®éå Future æ¥å£çä¸äºæ¹æ³å¹¶ä¿æåæ¥åºç¡çå®ç°æ¯ï¼å®å°±åå¾éå¸¸æç¨ãæä»¬å¯ä»¥ä»ä»ç»§æ¿äºå®å¹¶éåæä»¬éè¦çæ¹æ³ãéè¯» Java FutureTask ä¾å­ï¼å­¦ä¹ å¦ä½ä½¿ç¨å®ã\n\n> ð åèéè¯»ï¼Java å¹¶åç¼ç¨ï¼CallableãFuture å FutureTask\n\n# start() å run() æä»ä¹åºå«ï¼å¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run() æ¹æ³ä¹ï¼\n\n * run() æ¹æ³æ¯çº¿ç¨çæ§è¡ä½ã\n * start() æ¹æ³è´è´£å¯å¨çº¿ç¨ï¼ç¶å JVM ä¼è®©è¿ä¸ªçº¿ç¨å»æ§è¡ run() æ¹æ³ã\n\nå¯ä»¥ç´æ¥è°ç¨ Thread ç±»ç run() æ¹æ³ä¹ï¼\n\n * å¯ä»¥ãä½æ¯å¦æç´æ¥è°ç¨ Thread ç run() æ¹æ³ï¼å®çè¡ä¸ºå°±ä¼åæ®éçæ¹æ³ä¸æ ·ã\n * ä¸ºäºå¨æ°ççº¿ç¨ä¸­æ§è¡æä»¬çä»£ç ï¼å¿é¡»ä½¿ç¨ start() æ¹æ³ã\n\n# sleep()ãyield()ãjoin() æ¹æ³æä»ä¹åºå«ï¼ä¸ºä»ä¹ sleep() å yield() æ¹æ³æ¯éæï¼staticï¼çï¼\n\nyield()\n\n * yield() æ¹æ³å¯ä»¥è®©å½åæ­£å¨æ§è¡ççº¿ç¨æåï¼ä½å®ä¸ä¼é»å¡è¯¥çº¿ç¨ï¼å®åªæ¯å°è¯¥çº¿ç¨ä» Running ç¶æè½¬å¥ Runnable ç¶æã\n * å½æä¸ªçº¿ç¨è°ç¨äº yield() æ¹æ³æåä¹åï¼åªæä¼åçº§ä¸å½åçº¿ç¨ç¸åï¼æèä¼åçº§æ¯å½åçº¿ç¨æ´é«çå¤äºå°±ç»ªç¶æççº¿ç¨æä¼è·å¾æ§è¡çæºä¼ã\n\nsleep()\n\n * sleep() æ¹æ³éè¦æå®ç­å¾çæ¶é´ï¼å®å¯ä»¥è®©å½åæ­£å¨æ§è¡ççº¿ç¨å¨æå®çæ¶é´åæåæ§è¡ï¼è¿å¥ Blocked ç¶æã\n * è¯¥æ¹æ³æ¢å¯ä»¥è®©å¶ä»åä¼åçº§æèé«ä¼åçº§ççº¿ç¨å¾å°æ§è¡çæºä¼ï¼ä¹å¯ä»¥è®©ä½ä¼åçº§ççº¿ç¨å¾å°æ§è¡æºä¼ã\n * ä½æ¯ï¼sleep() æ¹æ³ä¸ä¼éæ¾âéæ å¿âï¼ä¹å°±æ¯è¯´å¦ææ synchronized åæ­¥åï¼å¶ä»çº¿ç¨ä»ç¶ä¸è½è®¿é®å±äº«æ°æ®ã\n\njoin()\n\n * join() æ¹æ³ä¼ä½¿å½åçº¿ç¨è½¬å¥ Blocked ç¶æï¼ç­å¾è°ç¨ join() æ¹æ³ççº¿ç¨ç»æåæè½ç»§ç»­æ§è¡ã\n\nä¸ºä»ä¹ sleep() å yield() æ¹æ³æ¯éæï¼staticï¼çï¼\n\n * Thread ç±»ç sleep() å yield() æ¹æ³å°å¤ç Running ç¶æççº¿ç¨ãæä»¥å¨å¶ä»å¤äºé Running ç¶æççº¿ç¨ä¸æ§è¡è¿ä¸¤ä¸ªæ¹æ³æ¯æ²¡ææä¹çãè¿å°±æ¯ä¸ºä»ä¹è¿äºæ¹æ³æ¯éæçãå®ä»¬å¯ä»¥å¨å½åæ­£å¨æ§è¡ççº¿ç¨ä¸­å·¥ä½ï¼å¹¶é¿åç¨åºåéè¯¯çè®¤ä¸ºå¯ä»¥å¨å¶ä»éè¿è¡çº¿ç¨è°ç¨è¿äºæ¹æ³ã\n\n> ð åèéè¯»ï¼Java çº¿ç¨ä¸­ yield ä¸ join æ¹æ³çåºå« ð åèéè¯»ï¼sleep()ï¼wait()ï¼yield()å join()æ¹æ³çåºå«\n\n# Java ççº¿ç¨ä¼åçº§å¦ä½æ§å¶ï¼é«ä¼åçº§ç Java çº¿ç¨ä¸å®åæ§è¡åï¼\n\nJava ä¸­ççº¿ç¨ä¼åçº§å¦ä½æ§å¶\n\n * Java ä¸­ççº¿ç¨ä¼åçº§çèå´æ¯ [1,10]ï¼ä¸è¬æ¥è¯´ï¼é«ä¼åçº§ççº¿ç¨å¨è¿è¡æ¶ä¼å·æä¼åæãå¯ä»¥éè¿ thread.setPriority(Thread.MAX_PRIORITY) çæ¹å¼è®¾ç½®ï¼é»è®¤ä¼åçº§ä¸º 5ã\n\né«ä¼åçº§ç Java çº¿ç¨ä¸å®åæ§è¡å\n\n * å³ä½¿è®¾ç½®äºçº¿ç¨çä¼åçº§ï¼ä¹æ æ³ä¿è¯é«ä¼åçº§ççº¿ç¨ä¸å®åæ§è¡ã\n * åå ï¼è¿æ¯å ä¸º Java çº¿ç¨ä¼åçº§ä¾èµäºæä½ç³»ç»çæ¯æï¼ç¶èï¼ä¸åçæä½ç³»ç»æ¯æççº¿ç¨ä¼åçº§å¹¶ä¸ç¸åï¼ä¸è½å¾å¥½çå Java ä¸­çº¿ç¨ä¼åçº§ä¸ä¸å¯¹åºã\n * ç»è®ºï¼Java çº¿ç¨ä¼åçº§æ§å¶å¹¶ä¸å¯é ã\n\n# ä»ä¹æ¯å®æ¤çº¿ç¨ï¼ä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨ï¼å¦ä½åå»ºå®æ¤çº¿ç¨ï¼\n\nä»ä¹æ¯å®æ¤çº¿ç¨\n\n * å®æ¤çº¿ç¨ï¼Daemon Threadï¼æ¯å¨åå°æ§è¡å¹¶ä¸ä¸ä¼é»æ­¢ JVM ç»æ­¢ççº¿ç¨ã\n * ä¸å®æ¤çº¿ç¨ï¼Daemon Threadï¼ç¸åçï¼å«ç¨æ·çº¿ç¨ï¼User Threadï¼ï¼ä¹å°±æ¯éå®æ¤çº¿ç¨ã\n\nä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨\n\n * å®æ¤çº¿ç¨çä¼åçº§æ¯è¾ä½ï¼ç¨äºä¸ºç³»ç»ä¸­çå¶å®å¯¹è±¡åçº¿ç¨æä¾æå¡ãå¸åçåºç¨å°±æ¯åå¾åæ¶å¨ã\n\nå¦ä½åå»ºå®æ¤çº¿ç¨\n\n * ä½¿ç¨ thread.setDaemon(true) å¯ä»¥è®¾ç½® thread çº¿ç¨ä¸ºå®æ¤çº¿ç¨ã\n * æ³¨æç¹ï¼\n   * æ­£å¨è¿è¡çç¨æ·çº¿ç¨æ æ³è®¾ç½®ä¸ºå®æ¤çº¿ç¨ï¼æä»¥ thread.setDaemon(true) å¿é¡»å¨ thread.start() ä¹åè®¾ç½®ï¼å¦åä¼æåº llegalThreadStateException å¼å¸¸ï¼\n   * ä¸ä¸ªå®æ¤çº¿ç¨åå»ºçå­çº¿ç¨ä¾ç¶æ¯å®æ¤çº¿ç¨ã\n   * ä¸è¦è®¤ä¸ºææçåºç¨é½å¯ä»¥åéç»å®æ¤çº¿ç¨æ¥è¿è¡æå¡ï¼æ¯å¦è¯»åæä½æèè®¡ç®é»è¾ã\n\n> ð åèéè¯»ï¼Java ä¸­å®æ¤çº¿ç¨çæ»ç»\n\n# çº¿ç¨é´æ¯å¦ä½éä¿¡çï¼\n\nå½çº¿ç¨é´æ¯å¯ä»¥å±äº«èµæºæ¶ï¼çº¿ç¨é´éä¿¡æ¯åè°å®ä»¬çéè¦çææ®µãObject ç±»ä¸­ wait(), notify() å notifyAll() æ¹æ³å¯ä»¥ç¨äºçº¿ç¨é´éä¿¡å³äºèµæºçéçç¶æã\n\n> ð åèéè¯»ï¼Java å¹¶åç¼ç¨ï¼çº¿ç¨é´åä½çä¸¤ç§æ¹å¼ï¼waitãnotifyãnotifyAll å Condition\n\n# ä¸ºä»ä¹çº¿ç¨éä¿¡çæ¹æ³ wait(), notify() å notifyAll() è¢«å®ä¹å¨ Object ç±»éï¼\n\nJava çæ¯ä¸ªå¯¹è±¡ä¸­é½æä¸ä¸ªé(monitorï¼ä¹å¯ä»¥æä¸ºçè§å¨) å¹¶ä¸ wait()ãnotify() ç­æ¹æ³ç¨äºç­å¾å¯¹è±¡çéæèéç¥å¶ä»çº¿ç¨å¯¹è±¡ççè§å¨å¯ç¨ãå¨ Java ççº¿ç¨ä¸­å¹¶æ²¡æå¯ä¾ä»»ä½å¯¹è±¡ä½¿ç¨çéååæ­¥å¨ãè¿å°±æ¯ä¸ºä»ä¹è¿äºæ¹æ³æ¯ Object ç±»çä¸é¨åï¼è¿æ · Java çæ¯ä¸ä¸ªç±»é½æç¨äºçº¿ç¨é´éä¿¡çåºæ¬æ¹æ³\n\n# ä¸ºä»ä¹ wait(), notify() å notifyAll() å¿é¡»å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨ï¼\n\nå½ä¸ä¸ªçº¿ç¨éè¦è°ç¨å¯¹è±¡ç wait() æ¹æ³çæ¶åï¼è¿ä¸ªçº¿ç¨å¿é¡»æ¥æè¯¥å¯¹è±¡çéï¼æ¥çå®å°±ä¼éæ¾è¿ä¸ªå¯¹è±¡éå¹¶è¿å¥ç­å¾ç¶æç´å°å¶ä»çº¿ç¨è°ç¨è¿ä¸ªå¯¹è±¡ä¸ç notify() æ¹æ³ãåæ ·çï¼å½ä¸ä¸ªçº¿ç¨éè¦è°ç¨å¯¹è±¡ç notify() æ¹æ³æ¶ï¼å®ä¼éæ¾è¿ä¸ªå¯¹è±¡çéï¼ä»¥ä¾¿å¶ä»å¨ç­å¾ççº¿ç¨å°±å¯ä»¥å¾å°è¿ä¸ªå¯¹è±¡éã\n\nç±äºææçè¿äºæ¹æ³é½éè¦çº¿ç¨ææå¯¹è±¡çéï¼è¿æ ·å°±åªè½éè¿åæ­¥æ¥å®ç°ï¼æä»¥ä»ä»¬åªè½å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨ã\n\n\n# å¹¶åæºå¶çåºå±å®ç°\n\n> ð åèéè¯»ï¼Java å¹¶åæ ¸å¿æºå¶\n\n# â­â­â­ synchronized\n\n> synchronized æä»ä¹ä½ç¨ï¼\n> \n> synchronized çåçæ¯ä»ä¹ï¼\n> \n> åæ­¥æ¹æ³ååæ­¥åï¼åªä¸ªæ´å¥½ï¼\n> \n> JDK1.6 å¯¹synchronized åäºåªäºä¼åï¼\n> \n> ä½¿ç¨ synchronized ä¿®é¥°éææ¹æ³åééææ¹æ³æä»ä¹åºå«ï¼\n\nä½ç¨\n\nsynchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\nsynchronized æ 3 ç§åºç¨æ¹å¼ï¼\n\n * åæ­¥å®ä¾æ¹æ³ - å¯¹äºæ®éåæ­¥æ¹æ³ï¼éæ¯å½åå®ä¾å¯¹è±¡\n * åæ­¥éææ¹æ³ - å¯¹äºéæåæ­¥æ¹æ³ï¼éæ¯å½åç±»ç Class å¯¹è±¡\n * åæ­¥ä»£ç å - å¯¹äºåæ­¥æ¹æ³åï¼éæ¯ synchonized æ¬å·ééç½®çå¯¹è±¡\n\nåç\n\nsynchronized ç»è¿ç¼è¯åï¼ä¼å¨åæ­¥åçåååå«å½¢æ monitorenter å monitorexit è¿ä¸¤ä¸ªå­èç æä»¤ï¼è¿ä¸¤ä¸ªå­èç æä»¤é½éè¦ä¸ä¸ªå¼ç¨ç±»åçåæ°æ¥ææè¦éå®åè§£éçå¯¹è±¡ãå¦æ synchronized æç¡®å¶å®äºå¯¹è±¡åæ°ï¼é£å°±æ¯è¿ä¸ªå¯¹è±¡çå¼ç¨ï¼å¦ææ²¡ææç¡®æå®ï¼é£å°±æ ¹æ® synchronized ä¿®é¥°çæ¯å®ä¾æ¹æ³è¿æ¯éææ¹æ³ï¼å»å¯¹å¯¹åºçå¯¹è±¡å®ä¾æ Class å¯¹è±¡æ¥ä½ä¸ºéå¯¹è±¡ã\n\nsynchronized åæ­¥åå¯¹åä¸çº¿ç¨æ¥è¯´æ¯å¯éå¥çï¼ä¸ä¼åºç°éæ­»é®é¢ã\n\nsynchronized åæ­¥åæ¯äºæ¥çï¼å³å·²è¿å¥ççº¿ç¨æ§è¡å®æåï¼ä¼é»å¡å¶ä»è¯å¾è¿å¥ççº¿ç¨ã\n\nä¼å\n\nJava 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ Lock ãReadWriteLock åºæ¬ä¸æå¹³ã\n\nsynchronized çä¼åæ¯å°éç²åº¦åä¸ºä¸åçº§å«ï¼synchronized ä¼æ ¹æ®è¿è¡ç¶æå¨æçç±ä½å°é«è°æ´éçº§å«ï¼ååé -> è½»éçº§é -> ééçº§éï¼ï¼ä»¥åå°é»å¡ã\n\nåæ­¥æ¹æ³ or åæ­¥åï¼\n\n * åæ­¥åæ¯æ´å¥½çéæ©ã\n * å ä¸ºå®ä¸ä¼éä½æ´ä¸ªå¯¹è±¡ï¼å½ç¶ä½ ä¹å¯ä»¥è®©å®éä½æ´ä¸ªå¯¹è±¡ï¼ãåæ­¥æ¹æ³ä¼éä½æ´ä¸ªå¯¹è±¡ï¼åªæè¿ä¸ªç±»ä¸­æå¤ä¸ªä¸ç¸å³èçåæ­¥åï¼è¿éå¸¸ä¼å¯¼è´ä»ä»¬åæ­¢æ§è¡å¹¶éè¦ç­å¾è·å¾è¿ä¸ªå¯¹è±¡ä¸çéã\n\n# â­ volatile\n\n> volatile æä»ä¹ä½ç¨ï¼\n> \n> volatile çåçæ¯ä»ä¹ï¼\n> \n> volatile è½ä»£æ¿éåï¼\n> \n> volatile å synchronized çåºå«ï¼\n\nvolatile æ æ³æ¿ä»£ synchronized ï¼å ä¸º volatile æ æ³ä¿è¯æä½çåå­æ§ã\n\nä½ç¨\n\nè¢« volatile å³é®å­ä¿®é¥°çåéæä¸¤å±å«ä¹ï¼\n\n * ä¿è¯äºä¸åçº¿ç¨å¯¹è¿ä¸ªåéè¿è¡æä½æ¶çå¯è§æ§ï¼å³ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªåéçå¼ï¼è¿æ°å¼å¯¹å¶ä»çº¿ç¨æ¥è¯´æ¯ç«å³å¯è§çã\n * ç¦æ­¢æä»¤éæåºã\n\nåç\n\nè§å¯å å¥ volatile å³é®å­åæ²¡æå å¥ volatile å³é®å­æ¶æçæçæ±ç¼ä»£ç åç°ï¼å å¥ volatile å³é®å­æ¶ï¼ä¼å¤åºä¸ä¸ª lock åç¼æä»¤ã\n\nlock åç¼æä»¤å®éä¸ç¸å½äºä¸ä¸ªåå­å±éï¼ä¹æåå­æ æ ï¼ï¼åå­å±éä¼æä¾ 3 ä¸ªåè½ï¼\n\n * å®ç¡®ä¿æä»¤éæåºæ¶ä¸ä¼æå¶åé¢çæä»¤æå°åå­å±éä¹åçä½ç½®ï¼ä¹ä¸ä¼æåé¢çæä»¤æå°åå­å±éçåé¢ï¼å³å¨æ§è¡å°åå­å±éè¿å¥æä»¤æ¶ï¼å¨å®åé¢çæä½å·²ç»å¨é¨å®æï¼\n * å®ä¼å¼ºå¶å°å¯¹ç¼å­çä¿®æ¹æä½ç«å³åå¥ä¸»å­ï¼\n * å¦ææ¯åæä½ï¼å®ä¼å¯¼è´å¶ä» CPU ä¸­å¯¹åºçç¼å­è¡æ æã\n\nvolatile å synchronized çåºå«ï¼\n\n * volatile æ¬è´¨æ¯å¨åè¯ jvm å½ååéå¨å¯å­å¨ï¼å·¥ä½åå­ï¼ä¸­çå¼æ¯ä¸ç¡®å®çï¼éè¦ä»ä¸»å­ä¸­è¯»åï¼ synchronized åæ¯éå®å½ååéï¼åªæå½åçº¿ç¨å¯ä»¥è®¿é®è¯¥åéï¼å¶ä»çº¿ç¨è¢«é»å¡ä½ã\n * volatile ä»è½ä½¿ç¨å¨åéçº§å«ï¼synchronized åå¯ä»¥ä½¿ç¨å¨åéãæ¹æ³ãåç±»çº§å«çã\n * volatile ä»è½å®ç°åéçä¿®æ¹å¯è§æ§ï¼ä¸è½ä¿è¯åå­æ§ï¼è synchronized åå¯ä»¥ä¿è¯åéçä¿®æ¹å¯è§æ§ååå­æ§\n * volatile ä¸ä¼é æçº¿ç¨çé»å¡ï¼synchronized å¯è½ä¼é æçº¿ç¨çé»å¡ã\n * volatile æ è®°çåéä¸ä¼è¢«ç¼è¯å¨ä¼åï¼synchronized æ è®°çåéå¯ä»¥è¢«ç¼è¯å¨ä¼åã\n\n# â­â­ CAS\n\n> ä»ä¹æ¯ CASï¼\n> \n> CAS æä»ä¹ä½ç¨ï¼\n> \n> CAS çåçæ¯ä»ä¹ï¼\n> \n> CAS çä¸å¤§é®é¢ï¼\n\nä½ç¨\n\nCASï¼Compare and Swapï¼ï¼å­é¢ææä¸ºæ¯è¾å¹¶äº¤æ¢ãCAS æ 3 ä¸ªæä½æ°ï¼åå«æ¯ï¼åå­å¼ Vï¼æ§çé¢æå¼ Aï¼è¦ä¿®æ¹çæ°å¼ Bãå½ä¸ä»å½é¢æå¼ A ååå­å¼ V ç¸åæ¶ï¼å°åå­å¼ V ä¿®æ¹ä¸º Bï¼å¦åä»ä¹é½ä¸åã\n\nåç\n\nJava ä¸»è¦å©ç¨ Unsafe è¿ä¸ªç±»æä¾ç CAS æä½ãUnsafe ç CAS ä¾èµçæ¯ JV M éå¯¹ä¸åçæä½ç³»ç»å®ç°ç Atomic::cmpxchg æä»¤ã\n\nä¸å¤§é®é¢\n\n 1. ABA é®é¢ï¼å ä¸º CAS éè¦å¨æä½å¼çæ¶åæ£æ¥ä¸å¼ææ²¡æåçååï¼å¦ææ²¡æåçåååæ´æ°ï¼ä½æ¯å¦æä¸ä¸ªå¼åæ¥æ¯ Aï¼åæäº Bï¼ååæäº Aï¼é£ä¹ä½¿ç¨ CAS è¿è¡æ£æ¥æ¶ä¼åç°å®çå¼æ²¡æåçååï¼ä½æ¯å®éä¸å´ååäºãABA é®é¢çè§£å³æè·¯å°±æ¯ä½¿ç¨çæ¬å·ãå¨åéåé¢è¿½å ä¸çæ¬å·ï¼æ¯æ¬¡åéæ´æ°çæ¶åæçæ¬å·å ä¸ï¼é£ä¹ Aï¼Bï¼A å°±ä¼åæ 1A-2Bï¼3Aã\n 2. å¾ªç¯æ¶é´é¿å¼éå¤§ãèªæ CAS å¦æé¿æ¶é´ä¸æåï¼ä¼ç» CPU å¸¦æ¥éå¸¸å¤§çæ§è¡å¼éãå¦æ JVM è½æ¯æå¤çå¨æä¾ç pause æä»¤é£ä¹æçä¼æä¸å®çæåï¼pause æä»¤æä¸¤ä¸ªä½ç¨ï¼ç¬¬ä¸å®å¯ä»¥å»¶è¿æµæ°´çº¿æ§è¡æä»¤ï¼de-pipelineï¼,ä½¿ CPU ä¸ä¼æ¶èè¿å¤çæ§è¡èµæºï¼å»¶è¿çæ¶é´åå³äºå·ä½å®ç°ççæ¬ï¼å¨ä¸äºå¤çå¨ä¸å»¶è¿æ¶é´æ¯é¶ãç¬¬äºå®å¯ä»¥é¿åå¨éåºå¾ªç¯çæ¶åå åå­é¡ºåºå²çªï¼memory order violationï¼èå¼èµ· CPU æµæ°´çº¿è¢«æ¸ç©ºï¼CPU pipeline flushï¼ï¼ä»èæé« CPU çæ§è¡æçã\n 3. åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æä½ãå½å¯¹ä¸ä¸ªå±äº«åéæ§è¡æä½æ¶ï¼æä»¬å¯ä»¥ä½¿ç¨å¾ªç¯ CAS çæ¹å¼æ¥ä¿è¯åå­æä½ï¼ä½æ¯å¯¹å¤ä¸ªå±äº«åéæä½æ¶ï¼å¾ªç¯ CAS å°±æ æ³ä¿è¯æä½çåå­æ§ï¼è¿ä¸ªæ¶åå°±å¯ä»¥ç¨éï¼æèæä¸ä¸ªåå·§çåæ³ï¼å°±æ¯æå¤ä¸ªå±äº«åéåå¹¶æä¸ä¸ªå±äº«åéæ¥æä½ãæ¯å¦æä¸¤ä¸ªå±äº«åé i ï¼ 2,j=aï¼åå¹¶ä¸ä¸ ij=2aï¼ç¶åç¨ CAS æ¥æä½ ijãä» Java1.5 å¼å§ JDK æä¾äº AtomicReference ç±»æ¥ä¿è¯å¼ç¨å¯¹è±¡ä¹é´çåå­æ§ï¼ä½ å¯ä»¥æå¤ä¸ªåéæ¾å¨ä¸ä¸ªå¯¹è±¡éæ¥è¿è¡ CAS æä½ã\n\n# â­ ThreadLocal\n\n> ThreadLocal æä»ä¹ä½ç¨ï¼\n> \n> ThreadLocal çåçæ¯ä»ä¹ï¼\n> \n> å¦ä½è§£å³ ThreadLocal åå­æ³æ¼é®é¢ï¼\n\nä½ç¨\n\nThreadLocal æ¯ä¸ä¸ªå­å¨çº¿ç¨æ¬å°å¯æ¬çå·¥å·ç±»ã\n\nåç\n\nThread ç±»ä¸­ç»´æ¤çä¸ä¸ª ThreadLocal.ThreadLocalMap ç±»åçæå threadLocalsãè¿ä¸ªæåå°±æ¯ç¨æ¥å­å¨å½åçº¿ç¨ç¬å çåéå¯æ¬ã\n\nThreadLocalMap æ¯ ThreadLocal çåé¨ç±»ï¼å®ç»´æ¤çä¸ä¸ª Entry æ°ç»ï¼ Entry ç¨äºä¿å­é®å¼å¯¹ï¼å¶ key æ¯ ThreadLocal å¯¹è±¡ï¼value æ¯ä¼ éè¿æ¥çå¯¹è±¡ï¼åéå¯æ¬ï¼ã Entry ç»§æ¿äº WeakReference ï¼æä»¥æ¯å¼±å¼ç¨ã\n\nåå­æ³æ¼é®é¢\n\nThreadLocalMap ç Entry ç»§æ¿äº WeakReferenceï¼æä»¥å®ç key ï¼ThreadLocal å¯¹è±¡ï¼æ¯å¼±å¼ç¨ï¼è value ï¼åéå¯æ¬ï¼æ¯å¼ºå¼ç¨ã\n\n * å¦æ ThreadLocal å¯¹è±¡æ²¡æå¤é¨å¼ºå¼ç¨æ¥å¼ç¨å®ï¼é£ä¹ ThreadLocal å¯¹è±¡ä¼å¨ä¸æ¬¡ GC æ¶è¢«åæ¶ã\n * æ­¤æ¶ï¼Entry ä¸­ç key å·²ç»è¢«åæ¶ï¼ä½æ¯ value ç±äºæ¯å¼ºå¼ç¨ä¸ä¼è¢«åå¾æ¶éå¨åæ¶ãå¦æåå»º ThreadLocal ççº¿ç¨ä¸ç´æç»­è¿è¡ï¼é£ä¹ value å°±ä¼ä¸ç´å¾ä¸å°åæ¶ï¼äº§çåå­æ³é²ã\n\né£ä¹å¦ä½é¿ååå­æ³æ¼å¢ï¼æ¹æ³å°±æ¯ï¼ä½¿ç¨ ThreadLocal ç set æ¹æ³åï¼æ¾ç¤ºçè°ç¨ remove æ¹æ³ ã\n\n\n# åå­æ¨¡å\n\n# ä»ä¹æ¯ Java åå­æ¨¡å\n\n * Java åå­æ¨¡åå³ Java Memory Modelï¼ç®ç§° JMMãJMM å®ä¹äº JVM å¨è®¡ç®æºåå­(RAM)ä¸­çå·¥ä½æ¹å¼ãJMM æ¯é¶å±äº JVM çã\n * å¹¶åç¼ç¨é¢åä¸¤ä¸ªå³é®é®é¢ï¼çº¿ç¨é´éä¿¡åçº¿ç¨é´åæ­¥\n * çº¿ç¨é´éä¿¡æºå¶\n   * å±äº«åå­ - çº¿ç¨é´éè¿å-è¯»åå­ä¸­çå¬å±ç¶ææ¥éå¼è¿è¡éä¿¡ã\n   * æ¶æ¯ä¼ é - java ä¸­å¸åçæ¶æ¯ä¼ éæ¹å¼å°±æ¯ wait()å notify()ã\n * çº¿ç¨é´åæ­¥æºå¶\n   * å¨å±äº«åå­æ¨¡åä¸­ï¼å¿é¡»æ¾ç¤ºæå®æä¸ªæ¹æ³æææ®µä»£ç å¨çº¿ç¨é´äºæ¥å°æ§è¡ã\n   * å¨æ¶æ¯ä¼ éæ¨¡åä¸­ï¼ç±äºåéæ¶æ¯å¿é¡»å¨æ¥æ¶æ¶æ¯ä¹åï¼å æ­¤åæ­¥æ¯éå¼è¿è¡çã\n * Java çå¹¶åéç¨çæ¯å±äº«åå­æ¨¡å\n * JMM å³å®ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçåå¥ä½æ¶å¯¹å¦ä¸ä¸ªçº¿ç¨å¯è§ã\n * çº¿ç¨ä¹é´çå±äº«åéå­å¨å¨ä¸»åå­ï¼main memoryï¼ä¸­ï¼æ¯ä¸ªçº¿ç¨é½æä¸ä¸ªç§æçæ¬å°åå­ï¼local memoryï¼ï¼æ¬å°åå­ä¸­å­å¨äºè¯¥çº¿ç¨ä»¥è¯»/åå±äº«åéçå¯æ¬ã\n * JMM æåå­åæäºä¸¤é¨åï¼çº¿ç¨æ åºåå åº\n   * çº¿ç¨æ \n     * JVM ä¸­è¿è¡çæ¯ä¸ªçº¿ç¨é½æ¥æèªå·±ççº¿ç¨æ ï¼çº¿ç¨æ åå«äºå½åçº¿ç¨æ§è¡çæ¹æ³è°ç¨ç¸å³ä¿¡æ¯ï¼æä»¬ä¹æå®ç§°ä½è°ç¨æ ãéçä»£ç çä¸æ­æ§è¡ï¼è°ç¨æ ä¼ä¸æ­ååã\n     * çº¿ç¨æ è¿åå«äºå½åæ¹æ³çæææ¬å°åéä¿¡æ¯ãçº¿ç¨ä¸­çæ¬å°åéå¯¹å¶å®çº¿ç¨æ¯ä¸å¯è§çã\n   * å åº\n     * å åºåå«äº Java åºç¨åå»ºçææå¯¹è±¡ä¿¡æ¯ï¼ä¸ç®¡å¯¹è±¡æ¯åªä¸ªçº¿ç¨åå»ºçï¼å¶ä¸­çå¯¹è±¡åæ¬åå§ç±»åçå°è£ç±»ï¼å¦ ByteãIntegerãLong ç­ç­ï¼ãä¸ç®¡å¯¹è±¡æ¯å±äºä¸ä¸ªæååéè¿æ¯æ¹æ³ä¸­çæ¬å°åéï¼å®é½ä¼è¢«å­å¨å¨å åºã\n   * ä¸ä¸ªæ¬å°åéå¦ææ¯åå§ç±»åï¼é£ä¹å®ä¼è¢«å®å¨å­å¨å°æ åºã\n   * ä¸ä¸ªæ¬å°åéä¹æå¯è½æ¯ä¸ä¸ªå¯¹è±¡çå¼ç¨ï¼è¿ç§æåµä¸ï¼è¿ä¸ªæ¬å°å¼ç¨ä¼è¢«å­å¨å°æ ä¸­ï¼ä½æ¯å¯¹è±¡æ¬èº«ä»ç¶å­å¨å¨å åºã\n   * å¯¹äºä¸ä¸ªå¯¹è±¡çæåæ¹æ³ï¼è¿äºæ¹æ³ä¸­åå«æ¬å°åéï¼ä»éè¦å­å¨å¨æ åºï¼å³ä½¿å®ä»¬æå±çå¯¹è±¡å¨å åºã\n   * å¯¹äºä¸ä¸ªå¯¹è±¡çæååéï¼ä¸ç®¡å®æ¯åå§ç±»åè¿æ¯åè£ç±»åï¼é½ä¼è¢«å­å¨å°å åºã\n\n\n\n> ð åèéè¯»ï¼å¨é¢çè§£ Java åå­æ¨¡å\n\n\n# åæ­¥å®¹å¨åå¹¶åå®¹å¨\n\n> ð åèéè¯»ï¼Java å¹¶åå®¹å¨\n\n# â­ åæ­¥å®¹å¨\n\n> ä»ä¹æ¯åæ­¥å®¹å¨ï¼\n> \n> æåªäºå¸¸è§åæ­¥å®¹å¨ï¼\n> \n> å®ä»¬æ¯å¦ä½å®ç°çº¿ç¨å®å¨çï¼\n> \n> åæ­¥å®¹å¨çççº¿ç¨å®å¨åï¼\n\nç±»å\n\nVectorãStackãHashtable\n\nä½ç¨/åç\n\nåæ­¥å®¹å¨çåæ­¥åçå°±æ¯å¨æ¹æ³ä¸ç¨ synchronized ä¿®é¥°ã synchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\nsynchronized çäºæ¥åæ­¥ä¼äº§çé»å¡åå¤éçº¿ç¨çå¼éãæ¾ç¶ï¼è¿ç§æ¹å¼æ¯æ²¡æä½¿ç¨ synchronized çå®¹å¨æ§è½è¦å·®ã\n\nçº¿ç¨å®å¨\n\nåæ­¥å®¹å¨ççç»å¯¹å®å¨åï¼\n\nå¶å®ä¹æªå¿ãå¨åå¤åæä½ï¼éåå­æä½ï¼æ¶ï¼ä»ç¶éè¦å éæ¥ä¿æ¤ãå¸¸è§å¤åæä½å¦ä¸ï¼\n\n * è¿­ä»£ï¼åå¤è®¿é®åç´ ï¼ç´å°éåå®å¨é¨åç´ ï¼\n * è·³è½¬ï¼æ ¹æ®æå®é¡ºåºå¯»æ¾å½ååç´ çä¸ä¸ä¸ªï¼ä¸ n ä¸ªï¼åç´ ï¼\n * æ¡ä»¶è¿ç®ï¼ä¾å¦è¥æ²¡æåæ·»å ç­ï¼\n\n# â­â­â­ ConcurrentHashMap\n\n> è¯·æè¿° ConcurrentHashMap çå®ç°åçï¼\n> \n> ConcurrentHashMap ä¸ºä»ä¹æ¾å¼äºåæ®µéï¼\n\nåºç¡æ°æ®ç»æåçå HashMap ä¸æ ·ï¼JDK 1.7 éç¨ æ°ç»ï¼åé¾è¡¨ï¼JDK 1.8 éç¨æ°ç»ï¼åé¾è¡¨ï¼çº¢é»æ ã\n\nå¹¶åå®å¨ç¹æ§çå®ç°ï¼\n\nJDK 1.7ï¼\n\n * ä½¿ç¨åæ®µéï¼è®¾è®¡æè·¯æ¯ç¼©å°éç²åº¦ï¼æé«å¹¶åååã\n * åæ°æ®æ¶ï¼ä¼ä½¿ç¨å¯éå¥éå»éä½åæ®µï¼segmentï¼ã\n\nJDK 1.8ï¼\n\n * åæ¶åæ®µéï¼ç´æ¥éç¨ transient volatile HashEntry<K,V>[] table ä¿å­æ°æ®ï¼éç¨ table æ°ç»åç´ ä½ä¸ºéï¼ä»èå®ç°äºå¯¹æ¯ä¸è¡æ°æ®è¿è¡å éï¼è¿ä¸æ­¥åå°å¹¶åå²çªçæ¦çã\n * åæ°æ®æ¶ï¼ä½¿ç¨æ¯ CAS + synchronizedã\n   * æ ¹æ® key è®¡ç®åº hashcode ã\n   * å¤æ­æ¯å¦éè¦è¿è¡åå§åã\n   * f å³ä¸ºå½å key å®ä½åºç Nodeï¼å¦æä¸ºç©ºè¡¨ç¤ºå½åä½ç½®å¯ä»¥åå¥æ°æ®ï¼å©ç¨ CAS å°è¯åå¥ï¼å¤±è´¥åèªæä¿è¯æåã\n   * å¦æå½åä½ç½®ç hashcode == MOVED == -1,åéè¦è¿è¡æ©å®¹ã\n   * å¦æé½ä¸æ»¡è¶³ï¼åå©ç¨ synchronized éåå¥æ°æ®ã\n   * å¦ææ°éå¤§äº TREEIFY_THRESHOLD åè¦è½¬æ¢ä¸ºçº¢é»æ ã\n\n# â­â­ CopyOnWriteArrayList\n\n> CopyOnWriteArrayList çä½ç¨ï¼\n> \n> CopyOnWriteArrayList çåçï¼\n\nä½ç¨\n\nCopyOnWrite å­é¢ææä¸ºåå¥æ¶å¤å¶ãCopyOnWriteArrayList æ¯çº¿ç¨å®å¨ç ArrayListã\n\nåç\n\n * å¨ CopyOnWriteAarrayList ä¸­ï¼è¯»æä½ä¸åæ­¥ï¼å ä¸ºå®ä»¬å¨åé¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼æä»¥å¤ä¸ªè¿­ä»£å¨å¯ä»¥åæ¶éåèä¸ä¼ç¸äºé»å¡ï¼1,2,4ï¼ã\n * ææçåæä½é½æ¯åæ­¥çãä»ä»¬å¨å¤ä»½æ°ç»ï¼3ï¼çå¯æ¬ä¸å·¥ä½ãåæä½å®æåï¼åå¤éµåå°è¢«æ¿æ¢ä¸ºå¤å¶çéµåï¼å¹¶éæ¾éå®ãæ¯ææ°ç»åå¾æåï¼æä»¥æ¿æ¢æ°ç»çè°ç¨æ¯åå­ï¼5ï¼ã\n * åæä½ååå»ºçè¿­ä»£å¨å°è½å¤çå°ä¿®æ¹çç»æï¼6,7ï¼ã\n * åæ¶å¤å¶éåè¿åçè¿­ä»£å¨ä¸ä¼æåº ConcurrentModificationExceptionï¼å ä¸ºå®ä»¬å¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼å¹¶ä¸æ è®ºåç»­çä¿®æ¹ï¼2,4ï¼å¦ä½ï¼é½ä¼åè¿­ä»£å¨åå»ºæ¶é£æ ·å®å¨è¿ååç´ ã\n\n\n\n\n# å¹¶åé\n\n> ð åèéè¯»ï¼Java å¹¶åé\n\n# â­â­ éç±»å\n\n> Java ä¸­æåªäºéï¼\n> \n> è¿äºéæä»ä¹ç¹æ§ï¼\n\nå¯éå¥é\n\n * ReentrantLock ãReentrantReadWriteLock æ¯å¯éå¥éãè¿ç¹ï¼ä»å¶å½åä¹ä¸é¾çåºã\n * synchronized ä¹æ¯ä¸ä¸ªå¯éå¥éã\n\nå¬å¹³éä¸éå¬å¹³é\n\n * synchronized åªæ¯æéå¬å¹³éã\n * ReentrantLock ãReentrantReadWriteLockï¼é»è®¤æ¯éå¬å¹³éï¼ä½æ¯æå¬å¹³éã\n\nç¬äº«éä¸å±äº«é\n\n * synchronized ãReentrantLock åªæ¯æç¬äº«éã\n * ReentrantReadWriteLock å¶åéæ¯ç¬äº«éï¼å¶è¯»éæ¯å±äº«éãè¯»éæ¯å±äº«éä½¿å¾å¹¶åè¯»æ¯éå¸¸é«æçï¼è¯»åï¼åè¯» ï¼ååçè¿ç¨æ¯äºæ¥çã\n\næ²è§éä¸ä¹è§é\n\n * æ²è§éå¨ Java ä¸­çåºç¨å°±æ¯éè¿ä½¿ç¨ synchronized å Lock æ¾ç¤ºå éæ¥è¿è¡äºæ¥åæ­¥ï¼è¿æ¯ä¸ç§é»å¡åæ­¥ã\n\n * ä¹è§éå¨ Java ä¸­çåºç¨å°±æ¯éç¨ CAS æºå¶ï¼CAS æä½éè¿ Unsafe ç±»æä¾ï¼ä½è¿ä¸ªç±»ä¸ç´æ¥æ´é²ä¸º APIï¼æä»¥é½æ¯é´æ¥ä½¿ç¨ï¼å¦åç§åå­ç±»ï¼ã\n\nååéãè½»éçº§éãééçº§é\n\nJava 1.6 ä»¥åï¼ééçº§éä¸è¬æçæ¯ synchronized ï¼èè½»éçº§éæçæ¯ volatileã\n\nJava 1.6 ä»¥åï¼éå¯¹ synchronized åäºå¤§éä¼åï¼å¼å¥ 4 ç§éç¶æï¼ æ éç¶æãååéãè½»éçº§éåééçº§éãéå¯ä»¥ååçä»ååéåçº§å°è½»éçº§éï¼åä»è½»éçº§éåçº§å°ééçº§é ã\n\nåæ®µé\n\nåæ®µéå¶å®æ¯ä¸ç§éçè®¾è®¡ï¼å¹¶ä¸æ¯å·ä½çä¸ç§éãå¸åï¼JDK1.7 ä¹åç ConcurrentHashMap\n\næ¾ç¤ºéååç½®é\n\n * åç½®éï¼synchronized\n * æ¾ç¤ºéï¼ReentrantLockãReentrantReadWriteLock ç­ã\n\n# â­â­ AQS\n\n> ä»ä¹æ¯ AQSï¼\n> \n> AQS çä½ç¨æ¯ä»ä¹ï¼\n> \n> AQS çåçï¼\n\nä½ç¨\n\nAbstractQueuedSynchronizerï¼ç®ç§° AQSï¼æ¯éååæ­¥å¨ï¼é¡¾åæä¹ï¼å¶ä¸»è¦ä½ç¨æ¯å¤çåæ­¥ãå®æ¯å¹¶åéåå¾å¤åæ­¥å·¥å·ç±»çå®ç°åºç³ï¼å¦ ReentrantLockãReentrantReadWriteLockãSemaphore ç­ï¼ã\n\nAQS æä¾äºå¯¹ç¬äº«éä¸å±äº«éçæ¯æã\n\nåç\n\nï¼1ï¼æ°æ®ç»æ\n\n * state - AQS ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤åæ­¥ç¶æã\n   * è¿ä¸ªæ´æ°ç¶æçæä¹ç±å­ç±»æ¥èµäºï¼å¦ReentrantLock ä¸­è¯¥ç¶æå¼è¡¨ç¤ºææèçº¿ç¨å·²ç»éå¤è·åè¯¥éçæ¬¡æ°ï¼Semaphore ä¸­è¯¥ç¶æå¼è¡¨ç¤ºå©ä½çè®¸å¯æ°éã\n * head å tail - AQS ç»´æ¤äºä¸ä¸ª Node ç±»åï¼AQS çåé¨ç±»ï¼çåé¾è¡¨æ¥å®æåæ­¥ç¶æçç®¡çãè¿ä¸ªåé¾è¡¨æ¯ä¸ä¸ªååç FIFO éåï¼éè¿ head å tail æéè¿è¡è®¿é®ãå½ æçº¿ç¨è·åéå¤±è´¥åï¼å°±è¢«æ·»å å°éåæ«å°¾ã\n\nï¼2ï¼è·åç¬å é\n\nAQS ä¸­ä½¿ç¨ acquire(int arg) æ¹æ³è·åç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·ååæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶ææåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶æä¸æåï¼AQS ä¼ä¸æ­å°è¯å©ç¨ CAS æä½å°å½åçº¿ç¨æå¥ç­å¾åæ­¥éåçéå°¾ï¼ç´å°æåä¸ºæ­¢ã\n 3. æ¥çï¼ä¸æ­å°è¯ä¸ºç­å¾éåä¸­ççº¿ç¨èç¹è·åç¬å éã\n\nï¼3ï¼éæ¾ç¬å é\n\nAQS ä¸­ä½¿ç¨ release(int arg) æ¹æ³éæ¾ç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·åè§£éçº¿ç¨çåæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶æä¸æåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶ææåï¼AQS ä¼å°è¯å¤éå½åçº¿ç¨èç¹çåç»§èç¹ã\n\nï¼4ï¼è·åå±äº«é\n\nAQS ä¸­ä½¿ç¨ acquireShared(int arg) æ¹æ³è·åå±äº«éã\n\nacquireShared æ¹æ³å acquire æ¹æ³çé»è¾å¾ç¸ä¼¼ï¼åºå«ä»å¨äºèªæçæ¡ä»¶ä»¥åèç¹åºéçæä½ææä¸åã\n\næåè·å¾å±äº«éçæ¡ä»¶å¦ä¸ï¼\n\n * tryAcquireShared(arg) è¿åå¼å¤§äºç­äº 0 ï¼è¿æå³çå±äº«éç permit è¿æ²¡æç¨å®ï¼ã\n * å½åèç¹çåé©±èç¹æ¯å¤´ç»ç¹ã\n\nï¼5ï¼éæ¾å±äº«é\n\nAQS ä¸­ä½¿ç¨ releaseShared(int arg) æ¹æ³éæ¾å±äº«éã\n\nreleaseShared é¦åä¼å°è¯éæ¾åæ­¥ç¶æï¼å¦ææåï¼åè§£éä¸ä¸ªæå¤ä¸ªåç»§çº¿ç¨èç¹ãéæ¾å±äº«éåéæ¾ç¬äº«éæµç¨å¤§ä½ç¸ä¼¼ï¼åºå«å¨äºï¼\n\nå¯¹äºç¬äº«æ¨¡å¼ï¼å¦æéè¦ SIGNALï¼éæ¾ä»ç¸å½äºè°ç¨å¤´èç¹ç unparkSuccessorã\n\n# â­â­ ReentrantLock\n\n> ä»ä¹æ¯ ReentrantLockï¼\n> \n> ä»ä¹æ¯å¯éå¥éï¼\n> \n> ReentrantLock æä»ä¹ç¨ï¼\n> \n> ReentrantLock åçï¼\n\nä½ç¨\n\nReentrantLock æä¾äºä¸ç»æ æ¡ä»¶çãå¯è½®è¯¢çãå®æ¶çä»¥åå¯ä¸­æ­çéæä½\n\nReentrantLock çç¹æ§å¦ä¸ï¼\n\n * ReentrantLock æä¾äºä¸ synchronized ç¸åçäºæ¥æ§ãåå­å¯è§æ§åå¯éå¥æ§ã\n * ReentrantLock æ¯æå¬å¹³éåéå¬å¹³éï¼é»è®¤ï¼ä¸¤ç§æ¨¡å¼ã\n * ReentrantLock å®ç°äº Lock æ¥å£ï¼æ¯æäº synchronized æä¸å·å¤ççµæ´»æ§ã\n   * synchronized æ æ³ä¸­æ­ä¸ä¸ªæ­£å¨ç­å¾è·åéççº¿ç¨\n   * synchronized æ æ³å¨è¯·æ±è·åä¸ä¸ªéæ¶æ ä¼æ­¢å°ç­å¾\n\nåç\n\nReentrantLock åºäºå¶åé¨ç±» ReentrantLock.Sync å®ç°ï¼Sync ç»§æ¿èª AQSãå®æä¸¤ä¸ªå­ç±»ï¼\n\n * ReentrantLock.FairSync - å¬å¹³éã\n * ReentrantLock.NonfairSync - éå¬å¹³éã\n\næ¬è´¨ä¸ï¼å°±æ¯åºäº AQS å®ç°ã\n\n# â­ ReentrantReadWriteLock\n\n> ReentrantReadWriteLock æ¯ä»ä¹ï¼\n> \n> ReentrantReadWriteLock çä½ç¨ï¼\n> \n> ReentrantReadWriteLock çåçï¼\n\nä½ç¨\n\nReentrantReadWriteLock æ¯ä¸ä¸ªå¯éå¥çè¯»åéãReentrantReadWriteLock ç»´æ¤äºä¸å¯¹è¯»åéï¼å°è¯»åéåå¼ï¼æå©äºæé«å¹¶åæçã\n\nåç\n\nReentrantReadWriteLock æ¬è´¨ä¸ä¹æ¯åºäº AQS å®ç°ãæä¸ä¸ªæ ¸å¿å­æ®µï¼\n\n * sync - åé¨ç±» ReentrantReadWriteLock.Sync å¯¹è±¡ãä¸ ReentrantLock ç±»ä¼¼ï¼å®æä¸¤ä¸ªå­ç±»ï¼ReentrantReadWriteLock.FairSync å ReentrantReadWriteLock.NonfairSync ï¼åå«è¡¨ç¤ºå¬å¹³éåéå¬å¹³éçå®ç°ã\n * readerLock - åé¨ç±» ReentrantReadWriteLock.ReadLock å¯¹è±¡ï¼è¿æ¯ä¸æè¯»éã\n * writerLock - åé¨ç±» ReentrantReadWriteLock.WriteLock å¯¹è±¡ï¼è¿æ¯ä¸æåéã\n\n# â­ Condition\n\n> Condition æä»ä¹ç¨ï¼\n> \n> ä½¿ç¨ Lock ççº¿ç¨ï¼å½¼æ­¤å¦ä½éä¿¡ï¼\n\nä½ç¨\n\nå¯ä»¥çè§£ä¸ºï¼ä»ä¹æ ·çééä»ä¹æ ·çé¥åã\n\nåç½®éï¼synchronizedï¼éååç½®æ¡ä»¶éåï¼waitãnotifyãnotifyAll ï¼ï¼æ¾å¼éï¼Lockï¼éåæ¾å¼æ¡ä»¶éåï¼Condition ï¼ã\n\n# â­â­ æ­»é\n\n> å¦ä½é¿åæ­»éï¼\n\n * é¿åä¸ä¸ªçº¿ç¨åæ¶è·åå¤ä¸ªé\n * é¿åä¸ä¸ªçº¿ç¨å¨éååæ¶å ç¨å¤ä¸ªèµæºï¼å°½éä¿è¯æ¯ä¸ªéåªå ç¨ä¸ä¸ªèµæº\n * å°è¯ä½¿ç¨å®æ¶é lock.tryLock(timeout)ï¼é¿åéä¸ç´ä¸è½éæ¾\n * å¯¹äºæ°æ®åºéï¼å éåè§£éå¿é¡»å¨ä¸ä¸ªæ°æ®åºè¿æ¥ä¸­éï¼å¦åä¼åºç°è§£éå¤±è´¥çæåµã\n\n\n# åå­åéç±»\n\n> ð åèéè¯»ï¼Java åå­ç±»\n\n# â­ åå­ç±»ç®ä»\n\n> ä¸ºä»ä¹è¦ç¨åå­ç±»ï¼\n> \n> ç¨è¿åªäºåå­ç±»ï¼\n\nä½ç¨\n\nå¸¸è§çéï¼Lockãsychronizedï¼ç±äºæ¯é»å¡å¼çï¼å¿å¿å½±åå¹¶åååéã\n\nvolatile å·ç§°è½»éçº§çéï¼ä½ä¸è½ä¿è¯åå­æ§ã\n\nä¸ºäºå¼é¡¾åå­æ§åéçæ§è½é®é¢ï¼æä»¥å¼å¥äºåå­ç±»ã\n\nç±»å\n\nåå­åéç±»å¯ä»¥åä¸º 4 ç»ï¼\n\n * åºæ¬ç±»å\n   * AtomicBoolean - å¸å°ç±»ååå­ç±»\n   * AtomicInteger - æ´ååå­ç±»\n   * AtomicLong - é¿æ´ååå­ç±»\n * å¼ç¨ç±»å\n   * AtomicReference - å¼ç¨ç±»ååå­ç±»\n   * AtomicMarkableReference - å¸¦ææ è®°ä½çå¼ç¨ç±»ååå­ç±»\n   * AtomicStampedReference - å¸¦æçæ¬å·çå¼ç¨ç±»ååå­ç±»\n * æ°ç»ç±»å\n   * AtomicIntegerArray - æ´å½¢æ°ç»åå­ç±»\n   * AtomicLongArray - é¿æ´åæ°ç»åå­ç±»\n   * AtomicReferenceArray - å¼ç¨ç±»åæ°ç»åå­ç±»\n * å±æ§æ´æ°å¨ç±»å\n   * AtomicIntegerFieldUpdater - æ´åå­æ®µçåå­æ´æ°å¨ã\n   * AtomicLongFieldUpdater - é¿æ´åå­æ®µçåå­æ´æ°å¨ã\n   * AtomicReferenceFieldUpdater - åå­æ´æ°å¼ç¨ç±»åéçå­æ®µã\n\n# â­ åå­ç±»çåç\n\n 1. å¤çå¨å®ç°åå­æä½ï¼ä½¿ç¨æ»çº¿éä¿è¯åå­æ§ï¼ä½¿ç¨ç¼å­éä¿è¯åå­æ§ï¼ä¿®æ¹åå­å°åï¼ç¼å­ä¸è´æ§æºå¶ï¼é»æ­¢åæ¶ä¿®æ¹ç± 2 ä¸ªä»¥ä¸çå¤çå¨ç¼å­çåå­åºåæ°æ®ï¼\n 2. JAVA å®ç°åå­æä½ï¼å¾ªç¯ä½¿ç¨ CAS ï¼èªæ CASï¼å®ç°åå­æä½\n\n\n# å¹¶åå·¥å·ç±»\n\n> ð åèéè¯»ï¼Java å¹¶åå·¥å·ç±»\n\n# â­ CountDownLatch\n\n> CountDownLatch ä½ç¨ï¼\n> \n> CountDownLatch åçï¼\n\nä½ç¨\n\nå­é¢ææä¸º éåè®¡æ°éãç¨äºæ§å¶ä¸ä¸ªæèå¤ä¸ªçº¿ç¨ç­å¾å¤ä¸ªçº¿ç¨ã\n\nCountDownLatch ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countï¼è¡¨ç¤ºéè¦ç­å¾çäºä»¶æ°éãcountDown æ¹æ³éåè®¡æ°å¨ï¼è¡¨ç¤ºæä¸ä¸ªäºä»¶å·²ç»åçãè°ç¨ await æ¹æ³ççº¿ç¨ä¼ä¸ç´é»å¡ç´å°è®¡æ°å¨ä¸ºé¶ï¼æèç­å¾ä¸­ççº¿ç¨ä¸­æ­ï¼æèç­å¾è¶æ¶ã\n\n\n\nåç\n\nCountDownLatch æ¯åºäº AQS(AbstractQueuedSynchronizer) å®ç°çã\n\n# â­ CyclicBarrier\n\n> CyclicBarrier æä»ä¹ç¨ï¼\n> \n> CyclicBarrier çåçæ¯ä»ä¹ï¼\n> \n> CyclicBarrier å CountDownLatch æä»ä¹åºå«ï¼\n\nä½ç¨\n\nå­é¢æææ¯ å¾ªç¯æ æ ãCyclicBarrier å¯ä»¥è®©ä¸ç»çº¿ç¨ç­å¾è³æä¸ªç¶æï¼éµå¾ªå­é¢ææï¼ä¸å¦¨ç§°è¿ä¸ªç¶æä¸ºæ æ ï¼ä¹ååå¨é¨åæ¶æ§è¡ãä¹æä»¥å«å¾ªç¯æ æ æ¯å ä¸ºï¼å½ææç­å¾çº¿ç¨é½è¢«éæ¾ä»¥åï¼CyclicBarrier å¯ä»¥è¢«éç¨ã\n\nCyclicBarrier ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countãæ¯æ¬¡æ§è¡ await æ¹æ³ä¹åï¼count å  1ï¼ç´å°è®¡æ°å¨çå¼åè®¾ç½®çå¼ç¸ç­ï¼ç­å¾çææçº¿ç¨æä¼ç»§ç»­æ§è¡ã\n\n\n\nåç\n\nCyclicBarrier æ¯åºäº ReentrantLock å Condition å®ç°çã\n\nåºå«\n\nCyclicBarrier å CountDownLatch é½å¯ä»¥ç¨æ¥è®©ä¸ç»çº¿ç¨ç­å¾å¶å®çº¿ç¨ãä¸ CyclicBarrier ä¸åçæ¯ï¼CountdownLatch ä¸è½éç¨ã\n\n# â­ Semaphore\n\n> Semaphore ä½ç¨ï¼\n\nä½ç¨\n\nå­é¢ææä¸º ä¿¡å·éãSemaphore ç¨æ¥æ§å¶åæ¶è®¿é®æä¸ªç¹å®èµæºçæä½æ°éï¼æèåæ¶æ§è¡æä¸ªæå®æä½çæ°éã\n\nSemaphore ç®¡ççä¸ç»èæçè®¸å¯ï¼permitï¼ï¼permit çåå§æ°éå¯éè¿æé æ¹æ³æ¥æå®ãæ¯æ¬¡æ§è¡ acquire æ¹æ³å¯ä»¥è·åä¸ä¸ª permitï¼å¦ææ²¡æå°±ç­å¾ï¼è release æ¹æ³å¯ä»¥éæ¾ä¸ä¸ª permitã\n\n * Semaphore å¯ä»¥ç¨äºå®ç°èµæºæ± ï¼å¦æ°æ®åºè¿æ¥æ± ã\n * Semaphore å¯ä»¥ç¨äºå°ä»»ä½ä¸ç§å®¹å¨åææçé»å¡å®¹å¨ã\n\n\n\n\n# çº¿ç¨æ± \n\n> ð åèéè¯»ï¼Java çº¿ç¨æ± \n\n# â­â­ ThreadPoolExecutor\n\n> ThreadPoolExecutor æåªäºåæ°ï¼åèªæä»ä¹ç¨ï¼\n> \n> ThreadPoolExecutor å·¥ä½åçï¼\n\nåç\n\n\n\nåæ°\n\njava.uitl.concurrent.ThreadPoolExecutor ç±»æ¯ Executor æ¡æ¶ä¸­ææ ¸å¿çä¸ä¸ªç±»ã\n\nThreadPoolExecutor æåä¸ªæé æ¹æ³ï¼åä¸ä¸ªé½æ¯åºäºç¬¬åä¸ªå®ç°ãç¬¬åä¸ªæé æ¹æ³å®ä¹å¦ä¸ï¼\n\n    public ThreadPoolExecutor(int corePoolSize,\n                              int maximumPoolSize,\n                              long keepAliveTime,\n                              TimeUnit unit,\n                              BlockingQueue<Runnable> workQueue,\n                              ThreadFactory threadFactory,\n                              RejectedExecutionHandler handler) {\n\n\nåæ°è¯´æï¼\n\n * corePoolSize - æ ¸å¿çº¿ç¨æ°éãå½ææ°ä»»å¡éè¿ execute æ¹æ³æäº¤æ¶ ï¼çº¿ç¨æ± ä¼æ§è¡ä»¥ä¸å¤æ­ï¼\n   * å¦æè¿è¡ççº¿ç¨æ°å°äº corePoolSizeï¼ååå»ºæ°çº¿ç¨æ¥å¤çä»»å¡ï¼å³ä½¿çº¿ç¨æ± ä¸­çå¶ä»çº¿ç¨æ¯ç©ºé²çã\n   * å¦æçº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äºç­äº corePoolSize ä¸å°äº maximumPoolSizeï¼ååªæå½ workQueue æ»¡æ¶æåå»ºæ°ççº¿ç¨å»å¤çä»»å¡ï¼\n   * å¦æè®¾ç½®ç corePoolSize å maximumPoolSize ç¸åï¼ååå»ºççº¿ç¨æ± çå¤§å°æ¯åºå®çãè¿æ¶å¦æææ°ä»»å¡æäº¤ï¼è¥ workQueue æªæ»¡ï¼åå°è¯·æ±æ¾å¥ workQueue ä¸­ï¼ç­å¾æç©ºé²ççº¿ç¨å»ä» workQueue ä¸­åä»»å¡å¹¶å¤çï¼\n   * å¦æè¿è¡ççº¿ç¨æ°éå¤§äºç­äº maximumPoolSizeï¼è¿æ¶å¦æ workQueue å·²ç»æ»¡äºï¼åä½¿ç¨ handler ææå®çç­ç¥æ¥å¤çä»»å¡ï¼\n   * æä»¥ï¼ä»»å¡æäº¤æ¶ï¼å¤æ­çé¡ºåºä¸º corePoolSize => workQueue => maximumPoolSizeã\n * maximumPoolSize - æå¤§çº¿ç¨æ°éã\n   * å¦æéåæ»¡äºï¼å¹¶ä¸å·²åå»ºççº¿ç¨æ°å°äºæå¤§çº¿ç¨æ°ï¼åçº¿ç¨æ± ä¼ååå»ºæ°ççº¿ç¨æ§è¡ä»»å¡ã\n   * å¼å¾æ³¨æçæ¯ï¼å¦æä½¿ç¨äºæ ççä»»å¡éåè¿ä¸ªåæ°å°±æ²¡ä»ä¹ææã\n * keepAliveTimeï¼çº¿ç¨ä¿ææ´»å¨çæ¶é´ã\n   * å½çº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äº corePoolSize çæ¶åï¼å¦æè¿æ¶æ²¡ææ°çä»»å¡æäº¤ï¼æ ¸å¿çº¿ç¨å¤ççº¿ç¨ä¸ä¼ç«å³éæ¯ï¼èæ¯ä¼ç­å¾ï¼ç´å°ç­å¾çæ¶é´è¶è¿äº keepAliveTimeã\n   * æä»¥ï¼å¦æä»»å¡å¾å¤ï¼å¹¶ä¸æ¯ä¸ªä»»å¡æ§è¡çæ¶é´æ¯è¾ç­ï¼å¯ä»¥è°å¤§è¿ä¸ªæ¶é´ï¼æé«çº¿ç¨çå©ç¨çã\n * unit - keepAliveTime çæ¶é´åä½ãæ 7 ç§åå¼ãå¯éçåä½æå¤©ï¼DAYSï¼ï¼å°æ¶ï¼HOURSï¼ï¼åéï¼MINUTESï¼ï¼æ¯«ç§(MILLISECONDS)ï¼å¾®ç§(MICROSECONDS, ååä¹ä¸æ¯«ç§)åæ¯«å¾®ç§(NANOSECONDS, ååä¹ä¸å¾®ç§)ã\n * workQueue - ç­å¾æ§è¡çä»»å¡éåãç¨äºä¿å­ç­å¾æ§è¡çä»»å¡çé»å¡éåã å¯ä»¥éæ©ä»¥ä¸å ä¸ªé»å¡éåã\n   * ArrayBlockingQueue - æçé»å¡éåã\n     * æ­¤éåæ¯åºäºæ°ç»çåè¿ååºéåï¼FIFOï¼ã\n     * æ­¤éååå»ºæ¶å¿é¡»æå®å¤§å°ã\n   * LinkedBlockingQueue - æ çé»å¡éåã\n     * æ­¤éåæ¯åºäºé¾è¡¨çåè¿ååºéåï¼FIFOï¼ã\n     * å¦æåå»ºæ¶æ²¡ææå®æ­¤éåå¤§å°ï¼åé»è®¤ä¸º Integer.MAX_VALUEã\n     * ååééå¸¸è¦é«äº ArrayBlockingQueueã\n     * ä½¿ç¨ LinkedBlockingQueue æå³çï¼ maximumPoolSize å°ä¸èµ·ä½ç¨ï¼çº¿ç¨æ± è½åå»ºçæå¤§çº¿ç¨æ°ä¸º corePoolSizeï¼å ä¸ºä»»å¡ç­å¾éåæ¯æ çéåã\n     * Executors.newFixedThreadPool ä½¿ç¨äºè¿ä¸ªéåã\n   * SynchronousQueue - ä¸ä¼ä¿å­æäº¤çä»»å¡ï¼èæ¯å°ç´æ¥æ°å»ºä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æ¥çä»»å¡ã\n     * æ¯ä¸ªæå¥æä½å¿é¡»ç­å°å¦ä¸ä¸ªçº¿ç¨è°ç¨ç§»é¤æä½ï¼å¦åæå¥æä½ä¸ç´å¤äºé»å¡ç¶æã\n     * ååééå¸¸è¦é«äº LinkedBlockingQueueã\n     * Executors.newCachedThreadPool ä½¿ç¨äºè¿ä¸ªéåã\n   * PriorityBlockingQueue - å·æä¼åçº§çæ çé»å¡éåã\n * threadFactory - çº¿ç¨å·¥åãå¯ä»¥éè¿çº¿ç¨å·¥åç»æ¯ä¸ªåå»ºåºæ¥ççº¿ç¨è®¾ç½®æ´ææä¹çåå­ã\n * handler - é¥±åç­ç¥ãå®æ¯ RejectedExecutionHandler ç±»åçåéãå½éååçº¿ç¨æ± é½æ»¡äºï¼è¯´æçº¿ç¨æ± å¤äºé¥±åç¶æï¼é£ä¹å¿é¡»éåä¸ç§ç­ç¥å¤çæäº¤çæ°ä»»å¡ãçº¿ç¨æ± æ¯æä»¥ä¸ç­ç¥ï¼\n   * AbortPolicy - ä¸¢å¼ä»»å¡å¹¶æåºå¼å¸¸ãè¿ä¹æ¯é»è®¤ç­ç¥ã\n   * DiscardPolicy - ä¸¢å¼ä»»å¡ï¼ä½ä¸æåºå¼å¸¸ã\n   * DiscardOldestPolicy - ä¸¢å¼éåæåé¢çä»»å¡ï¼ç¶åéæ°å°è¯æ§è¡ä»»å¡ï¼éå¤æ­¤è¿ç¨ï¼ã\n   * CallerRunsPolicy - åªç¨è°ç¨èæå¨ççº¿ç¨æ¥è¿è¡ä»»å¡ã\n   * å¦æä»¥ä¸ç­ç¥é½ä¸è½æ»¡è¶³éè¦ï¼ä¹å¯ä»¥éè¿å®ç° RejectedExecutionHandler æ¥å£æ¥å®å¶å¤çç­ç¥ãå¦è®°å½æ¥å¿ææä¹åä¸è½å¤ççä»»å¡ã\n\n# â­ Executors\n\n> Executors æä¾äºåªäºåç½®ççº¿ç¨æ± ï¼\n> \n> è¿äºçº¿ç¨æ± åèªæä»ä¹ç¹æ§ï¼éåç¨äºä»ä¹åºæ¯ï¼\n\nExecutors ä¸º Executorï¼ExecutorServiceï¼ScheduledExecutorServiceï¼ThreadFactory å Callable ç±»æä¾äºä¸äºå·¥å·æ¹æ³ã\n\nï¼1ï¼newSingleThreadExecutor\n\nåå»ºä¸ä¸ªåçº¿ç¨ççº¿ç¨æ± ã\n\nåªä¼åå»ºå¯ä¸çå·¥ä½çº¿ç¨æ¥æ§è¡ä»»å¡ï¼ä¿è¯ææä»»å¡æç§æå®é¡ºåº(FIFO, LIFO, ä¼åçº§)æ§è¡ã å¦æè¿ä¸ªå¯ä¸ççº¿ç¨å ä¸ºå¼å¸¸ç»æï¼é£ä¹ä¼æä¸ä¸ªæ°ççº¿ç¨æ¥æ¿ä»£å® ã\n\nåå·¥ä½çº¿ç¨æå¤§çç¹ç¹æ¯ï¼å¯ä¿è¯é¡ºåºå°æ§è¡åä¸ªä»»å¡ã\n\nï¼2ï¼newFixedThreadPool\n\nåå»ºä¸ä¸ªåºå®å¤§å°ççº¿ç¨æ± ã\n\næ¯æ¬¡æäº¤ä¸ä¸ªä»»å¡å°±ä¼æ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ï¼å¦æå·¥ä½çº¿ç¨æ°éè¾¾å°çº¿ç¨æ± æå¤§çº¿ç¨æ°ï¼åå°æäº¤çä»»å¡å­å¥å°é»å¡éåä¸­ã\n\nFixedThreadPool æ¯ä¸ä¸ªå¸åä¸ä¼ç§ççº¿ç¨æ± ï¼å®å·æçº¿ç¨æ± æé«ç¨åºæçåèçåå»ºçº¿ç¨æ¶æèçå¼éçä¼ç¹ãä½æ¯ï¼å¨çº¿ç¨æ± ç©ºé²æ¶ï¼å³çº¿ç¨æ± ä¸­æ²¡æå¯è¿è¡ä»»å¡æ¶ï¼å®ä¸ä¼éæ¾å·¥ä½çº¿ç¨ï¼è¿ä¼å ç¨ä¸å®çç³»ç»èµæºã\n\nï¼3ï¼newCachedThreadPool\n\nåå»ºä¸ä¸ªå¯ç¼å­ççº¿ç¨æ± ã\n\n * å¦æçº¿ç¨æ± å¤§å°è¶è¿å¤çä»»å¡æéè¦ççº¿ç¨æ°ï¼å°±ä¼åæ¶é¨åç©ºé²ççº¿ç¨ï¼\n * å¦æé¿æ¶é´æ²¡æå¾çº¿ç¨æ± ä¸­æäº¤ä»»å¡ï¼å³å¦æå·¥ä½çº¿ç¨ç©ºé²äºæå®çæ¶é´ï¼é»è®¤ä¸º 1 åéï¼ï¼åè¯¥å·¥ä½çº¿ç¨å°èªå¨ç»æ­¢ãç»æ­¢åï¼å¦æä½ åæäº¤äºæ°çä»»å¡ï¼åçº¿ç¨æ± éæ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ã\n * æ­¤çº¿ç¨æ± ä¸ä¼å¯¹çº¿ç¨æ± å¤§å°åéå¶ï¼çº¿ç¨æ± å¤§å°å®å¨ä¾èµäºæä½ç³»ç»ï¼æèè¯´ JVMï¼è½å¤åå»ºçæå¤§çº¿ç¨å¤§å°ã å æ­¤ï¼ä½¿ç¨ CachedThreadPool æ¶ï¼ä¸å®è¦æ³¨ææ§å¶ä»»å¡çæ°éï¼å¦åï¼ç±äºå¤§éçº¿ç¨åæ¶è¿è¡ï¼å¾æä¼é æç³»ç»ç«çªã\n\nï¼4ï¼newScheduleThreadPool\n\nåå»ºä¸ä¸ªå¤§å°æ éççº¿ç¨æ± ãæ­¤çº¿ç¨æ± æ¯æå®æ¶ä»¥åå¨ææ§æ§è¡ä»»å¡çéæ±ã\n\n\n# JVM\n\n\n# åå­ç®¡ç\n\n\n# OOM\n\n\n# åèèµæ\n\n * ä¹¦ç±\n   * ãJava å¹¶åç¼ç¨å®æã\n   * ãJava å¹¶åç¼ç¨çèºæ¯ã\n   * ãæ·±å¥çè§£ Java èææºã\n * æç« \n   * Java çº¿ç¨é¢è¯é¢ Top 50\n   * Java å¤çº¿ç¨åå¹¶ååºç¡é¢è¯é®ç­\n   * è¿ç¨åçº¿ç¨å³ç³»ååºå«\n   * JavaThread Methods and Thread States\n   * Java çº¿ç¨ç 5 ç§ç¶æååæ¢(éå½»è®²è§£)\n   * Java ä¸­å®æ¤çº¿ç¨çæ»ç»\n   * Java åå»ºçº¿ç¨çä¸ç§æ¹å¼åå¶å¯¹æ¯\n   * Java çº¿ç¨ç 5 ç§ç¶æååæ¢(éå½»è®²è§£)\n   * Java çº¿ç¨æ¹æ³ join çç®åæ»ç»\n   * Java å¹¶åç¼ç¨ï¼çº¿ç¨é´åä½çä¸¤ç§æ¹å¼ï¼waitãnotifyãnotifyAll å Condition\n   * Java å¹¶åç¼ç¨ï¼volatile å³é®å­è§£æ\n   * Java å¹¶åç¼ç¨ï¼CallableãFuture å FutureTask\n   * Java å¹¶åç¼ç¨ï¼çº¿ç¨æ± çä½¿ç¨\n   * Java å¹¶åç¼ç¨',normalizedContent:'# java é¢è¯æ»ç»\n\n\n# åºç¡\n\n\n# å·¥å·ç±»\n\n# string\n\n> string ç±»è½è¢«ç»§æ¿åï¼\n> \n> stringï¼stringbufferï¼stringbuilder çåºå«ã\n\nstring ç±»ä¸è½è¢«ç»§æ¿ãå ä¸ºå¶è¢« final ä¿®é¥°ï¼æä»¥æ æ³è¢«ç»§æ¿ã\n\nstringbufferï¼stringbuilder æ¼æ¥å­ç¬¦ä¸²ï¼ä½¿ç¨ append æ¯ string æçé«ãå ä¸º string ä¼éå¼ new string å¯¹è±¡ã\n\nstringbuffer ä¸»è¦æ¹æ³é½ç¨ synchronized ä¿®é¥°ï¼æ¯çº¿ç¨å®å¨çï¼è stringbuilder ä¸æ¯ã\n\n\n# é¢åå¯¹è±¡\n\n> æ½è±¡ç±»åæ¥å£çåºå«ï¼\n> \n> ç±»å¯ä»¥ç»§æ¿å¤ä¸ªç±»ä¹ï¼æ¥å£å¯ä»¥ç»§æ¿å¤ä¸ªæ¥å£ä¹ï¼ç±»å¯ä»¥å®ç°å¤ä¸ªæ¥å£ä¹ï¼\n\nç±»åªè½ç»§æ¿ä¸ä¸ªç±»ï¼ä½æ¯å¯ä»¥å®ç°å¤ä¸ªæ¥å£ãæ¥å£å¯ä»¥ç»§æ¿å¤ä¸ªæ¥å£ã\n\n> ç»§æ¿åèåçåºå«å¨åªï¼\n\nä¸è¬ï¼è½ç¨èåå°±å«ç¨ç»§æ¿ã\n\n\n# åå°\n\n# â­ åå»ºå®ä¾\n\n> åå°åå»ºå®ä¾æå ç§æ¹å¼ï¼\n\néè¿åå°æ¥åå»ºå®ä¾å¯¹è±¡ä¸»è¦æä¸¤ç§æ¹å¼ï¼\n\n * ç¨ class å¯¹è±¡ç newinstance æ¹æ³ã\n * ç¨ constructor å¯¹è±¡ç newinstance æ¹æ³ã\n\n# â­ å è½½å®ä¾\n\n> å è½½å®ä¾æå ç§æ¹å¼ï¼\n> \n> class.forname("classname") å classloader.laodclass("classname") æä»ä¹åºå«ï¼\n\n * class.forname("classname") å è½½çæ¯å·²ç»åå§åå° jvm ä¸­çç±»ã\n * classloader.loadclass("classname") è£è½½çæ¯è¿æ²¡æåå§åå° jvm ä¸­çç±»ã\n\n# â­â­ å¨æä»£ç\n\n> å¨æä»£çæå ç§å®ç°æ¹å¼ï¼æä»ä¹ç¹ç¹ï¼\n> \n> jdk å¨æä»£çå cglib å¨æä»£çæä»ä¹åºå«ï¼\n\nï¼1ï¼jdk æ¹å¼\n\nä»£çç±»ä¸å§æç±»å®ç°åä¸æ¥å£ï¼ä¸»è¦æ¯éè¿ä»£çç±»å®ç° invocationhandler å¹¶éå invoke æ¹æ³æ¥è¿è¡å¨æä»£ççï¼å¨ invoke æ¹æ³ä¸­å°å¯¹æ¹æ³è¿è¡å¤çã\n\njdk å¨æä»£çç¹ç¹ï¼\n\n * ä¼ç¹ï¼ç¸å¯¹äºéæä»£çæ¨¡å¼ï¼ä¸éè¦ç¡¬ç¼ç æ¥å£ï¼ä»£ç å¤ç¨çé«ã\n * ç¼ºç¹ï¼å¼ºå¶è¦æ±ä»£çç±»å®ç° invocationhandler æ¥å£ã\n\nï¼2ï¼cglib\n\ncglib åºå±ï¼å¶å®æ¯åå©äº asm è¿ä¸ªå¼ºå¤§ç java å­èç æ¡æ¶å»è¿è¡å­èç å¢å¼ºæä½ã\n\ncglib å¨æä»£çç¹ç¹ï¼\n\nä¼ç¹ï¼ä½¿ç¨å­èç å¢å¼ºï¼æ¯ jdk å¨æä»£çæ¹å¼æ§è½é«ãå¯ä»¥å¨è¿è¡æ¶å¯¹ç±»æèæ¯æ¥å£è¿è¡å¢å¼ºæä½ï¼ä¸å§æç±»æ éå®ç°æ¥å£ã\n\nç¼ºç¹ï¼ä¸è½å¯¹ final ç±»ä»¥å final æ¹æ³è¿è¡ä»£çã\n\n\n# jdk8\n\n\n# å¶ä»\n\n# â­ hashcode\n\n> æ==è¿ç®ç¬¦äºï¼ä¸ºä»ä¹è¿éè¦ equals åï¼\n> \n> è¯´ä¸è¯´ä½ å¯¹ java.lang.object å¯¹è±¡ä¸­ hashcode å equals æ¹æ³ççè§£ãå¨ä»ä¹åºæ¯ä¸é è¦éæ°å®ç°è¿ä¸¤ä¸ªæ¹æ³ã\n> \n> ææ²¡æå¯è½ 2 ä¸ªä¸ç¸ç­çå¯¹è±¡æç¸åç hashcode\n\nï¼1ï¼æ==è¿ç®ç¬¦äºï¼ä¸ºä»ä¹è¿éè¦ equals åï¼\n\nequals ç­ä»·äº==,è==è¿ç®ç¬¦æ¯å¤æ­ä¸¤ä¸ªå¯¹è±¡æ¯ä¸æ¯åä¸ä¸ªå¯¹è±¡ï¼å³ä»ä»¬çå°åæ¯å¦ç¸ç­ãèè¦å equals æ´å¤çæ¯è¿½æ±ä¸¤ä¸ªå¯¹è±¡å¨é»è¾ä¸çç¸ç­ï¼ä½ å¯ä»¥è¯´æ¯å¼ç¸ç­ï¼ä¹å¯è¯´æ¯åå®¹ç¸ç­ã\n\nï¼2ï¼è¯´ä¸è¯´ä½ å¯¹ java.lang.object å¯¹è±¡ä¸­ hashcode å equals æ¹æ³ççè§£ãå¨ä»ä¹åºæ¯ä¸é è¦éæ°å®ç°è¿ä¸¤ä¸ªæ¹æ³ã\n\nå¨éåæ¥æ¾æ¶ï¼hashcode è½å¤§å¤§éä½å¯¹è±¡æ¯è¾æ¬¡æ°ï¼æé«æ¥æ¾æçï¼\n\nï¼3ï¼ææ²¡æå¯è½ 2 ä¸ªä¸ç¸ç­çå¯¹è±¡æç¸åç hashcode\n\næå¯è½ã\n\n * å¦æä¸¤ä¸ªå¯¹è±¡ equalsï¼java è¿è¡æ¶ç¯å¢ä¼è®¤ä¸ºä»ä»¬ç hashcode ä¸å®ç¸ç­ã\n * å¦æä¸¤ä¸ªå¯¹è±¡ä¸ equalsï¼ä»ä»¬ç hashcode æå¯è½ç¸ç­ã\n * å¦æä¸¤ä¸ªå¯¹è±¡ hashcode ç¸ç­ï¼ä»ä»¬ä¸ä¸å® equalsã\n * å¦æä¸¤ä¸ªå¯¹è±¡ hashcode ä¸ç¸ç­ï¼ä»ä»¬ä¸å®ä¸ equalsã\n\n\n# io\n\n\n# nio\n\n> ä»ä¹æ¯ nioï¼\n> \n> nio å bioãaio æä½å·®å«ï¼\n\n\n# åºåå\n\n# â­ åºååé®é¢\n\n> åºååãååºååæåªäºé®é¢ï¼å¦ä½è§£å³ï¼\n\njava çåºååè½ä¿è¯å¯¹è±¡ç¶æçæä¹ä¿å­ï¼ä½æ¯éå°ä¸äºå¯¹è±¡ç»æå¤æçæåµè¿æ¯é¾ä»¥å¤çï¼è¿éå½çº³ä¸ä¸ï¼\n\n * å½ç¶ç±»ç»§æ¿ serializable æ¥å£æ¶ï¼ææå­ç±»é½å¯ä»¥è¢«åºååã\n * å­ç±»å®ç°äº serializable æ¥å£ï¼ç¶ç±»æ²¡æï¼åç¶ç±»çå±æ§ä¸ä¼è¢«åºååï¼ä¸æ¥éï¼æ°æ®ä¸¢å¤±ï¼ï¼å­ç±»çå±æ§ä»å¯ä»¥æ­£ç¡®åºååã\n * å¦æåºååçå±æ§æ¯å¯¹è±¡ï¼åè¿ä¸ªå¯¹è±¡ä¹å¿é¡»å®ç° serializable æ¥å£ï¼å¦åä¼æ¥éã\n * å¨ååºååæ¶ï¼å¦æå¯¹è±¡çå±æ§æä¿®æ¹æå åï¼åä¿®æ¹çé¨åå±æ§ä¼ä¸¢å¤±ï¼ä½ä¸ä¼æ¥éã\n * å¨ååºååæ¶ï¼å¦æ serialversionuid è¢«ä¿®æ¹ï¼åååºååæ¶ä¼å¤±è´¥ã\n\n\n# å®¹å¨\n\n\n# list\n\n# arraylist å linkedlist æä»ä¹åºå«ï¼\n\narraylist æ¯æ°ç»é¾è¡¨ï¼è®¿é®æçæ´é«ã\n\nlinkedlist æ¯åé¾è¡¨ï¼æ°æ®æåºå­å¨ã\n\n\n# map\n\nè¯·æè¿° hashmap çå®ç°åçï¼\n\n\n# å¹¶å\n\n\n# å¹¶åç®ä»\n\n# ä»ä¹æ¯è¿ç¨ï¼ä»ä¹æ¯çº¿ç¨ï¼è¿ç¨åçº¿ç¨çåºå«ï¼\n\n * ä»ä¹æ¯è¿ç¨ï¼\n   * ç®è¨ä¹ï¼è¿ç¨å¯è§ä¸ºä¸ä¸ªæ­£å¨è¿è¡çç¨åºã\n   * è¿ç¨æ¯å·æä¸å®ç¬ç«åè½çç¨åºå³äºæä¸ªæ°æ®éåä¸çä¸æ¬¡è¿è¡æ´»å¨ãè¿ç¨æ¯æä½ç³»ç»è¿è¡èµæºåéçåºæ¬åä½ã\n * ä»ä¹æ¯çº¿ç¨ï¼\n   * çº¿ç¨æ¯æä½ç³»ç»è¿è¡è°åº¦çåºæ¬åä½ã\n * è¿ç¨ vs. çº¿ç¨\n   * ä¸ä¸ªç¨åºè³å°æä¸ä¸ªè¿ç¨ï¼ä¸ä¸ªè¿ç¨è³å°æä¸ä¸ªçº¿ç¨ã\n   * çº¿ç¨æ¯è¿ç¨ååæ´ç»ï¼æä»¥æ§è¡å¼éæ´å°ï¼å¹¶åæ§æ´é«ã\n   * è¿ç¨æ¯ä¸ä¸ªå®ä½ï¼æ¥æç¬ç«çèµæºï¼èåä¸ä¸ªè¿ç¨ä¸­çå¤ä¸ªçº¿ç¨å±äº«è¿ç¨çèµæºã\n\n# å¹¶åï¼å¤çº¿ç¨ï¼ç¼ç¨çå¥½å¤æ¯ä»ä¹ï¼\n\n * æ´ææççå©ç¨å¤å¤çå¨æ ¸å¿\n * æ´å¿«çååºæ¶é´\n * æ´å¥½çç¼ç¨æ¨¡å\n\n# å¹¶åä¸å®æ¯ä¸²è¡æ´å¿«åï¼\n\nç­ï¼å¦ã\n\nè¦ç¹ï¼åå»ºçº¿ç¨åçº¿ç¨ä¸ä¸æåæ¢æä¸å®å¼éã\n\nè¯´æï¼å³ä½¿æ¯åæ ¸å¤çå¨ä¹æ¯æå¤çº¿ç¨ãcpu éè¿ç»æ¯ä¸ªçº¿ç¨åéæ¶é´åççç®æ³æ¥å¾ªç¯æ§è¡ä»»å¡ï¼å½åä»»å¡æ§è¡ä¸ä¸ªæ¶é´çåä¼åæ¢å°ä¸ä¸ä¸ªä»»å¡ãä½æ¯ï¼å¨åæ¢åä¼ä¿æä¸ä¸ä¸ªä»»å¡çç¶æï¼ä»¥ä¾¿ä¸æ¬¡åæ¢åè¿ä¸ªä»»å¡æ¶ï¼å¯ä»¥åå è½½è¿ä¸ªä»»å¡çç¶æãæä»¥ä»»å¡ä»ä¿å­å°åå è½½çè¿ç¨å°±æ¯ä¸æ¬¡ä¸ä¸æåæ¢ã\n\nå¼ç³\n\n * å¦ä½åå°ä¸ä¸æåæ¢ï¼\n   * å°½éå°ç¨é\n   * cas ç®æ³\n   * çº¿ç¨æ°è¦åç\n   * åç¨ï¼å¨åçº¿ç¨ä¸­å®ç°å¤ä»»å¡è°åº¦ï¼å¹¶å¨åçº¿ç¨ä¸­ç»´æå¤ä¸ªä»»å¡çåæ¢\n\n# å¦ä½è®©æ­£å¨è¿è¡ççº¿ç¨æåä¸æ®µæ¶é´ï¼\n\næä»¬å¯ä»¥ä½¿ç¨ thread ç±»ç sleep() æ¹æ³è®©çº¿ç¨æåä¸æ®µæ¶é´ã\n\néè¦æ³¨æçæ¯ï¼è¿å¹¶ä¸ä¼è®©çº¿ç¨ç»æ­¢ï¼ä¸æ¦ä»ä¼ç ä¸­å¤éçº¿ç¨ï¼çº¿ç¨çç¶æå°ä¼è¢«æ¹åä¸º runnableï¼å¹¶ä¸æ ¹æ®çº¿ç¨è°åº¦ï¼å®å°å¾å°æ§è¡ã\n\n# ä»ä¹æ¯çº¿ç¨è°åº¦å¨(thread scheduler)åæ¶é´åç(time slicing)ï¼\n\nçº¿ç¨è°åº¦å¨æ¯ä¸ä¸ªæä½ç³»ç»æå¡ï¼å®è´è´£ä¸º runnable ç¶æççº¿ç¨åé cpu æ¶é´ãä¸æ¦æä»¬åå»ºä¸ä¸ªçº¿ç¨å¹¶å¯å¨å®ï¼å®çæ§è¡ä¾¿ä¾èµäºçº¿ç¨è°åº¦å¨çå®ç°ã\n\næ¶é´åçæ¯æå°å¯ç¨ç cpu æ¶é´åéç»å¯ç¨ç runnable çº¿ç¨çè¿ç¨ã\n\nåé cpu æ¶é´å¯ä»¥åºäºçº¿ç¨ä¼åçº§æèçº¿ç¨ç­å¾çæ¶é´ãçº¿ç¨è°åº¦å¹¶ä¸åå° java èææºæ§å¶ï¼æä»¥ç±åºç¨ç¨åºæ¥æ§å¶å®æ¯æ´å¥½çéæ©ï¼ä¹å°±æ¯è¯´ä¸è¦è®©ä½ çç¨åºä¾èµäºçº¿ç¨çä¼åçº§ï¼ã\n\n# å¨å¤çº¿ç¨ä¸­ï¼ä»ä¹æ¯ä¸ä¸æåæ¢(context-switching)ï¼\n\nä¸ä¸æåæ¢æ¯å­å¨åæ¢å¤ cpu ç¶æçè¿ç¨ï¼å®ä½¿å¾çº¿ç¨æ§è¡è½å¤ä»ä¸­æ­ç¹æ¢å¤æ§è¡ãä¸ä¸æåæ¢æ¯å¤ä»»å¡æä½ç³»ç»åå¤çº¿ç¨ç¯å¢çåºæ¬ç¹å¾ã\n\n# å¦ä½ç¡®ä¿çº¿ç¨å®å¨ï¼\n\n * åå­ç±»(atomic concurrent classes)\n * é\n * volatile å³é®å­\n * ä¸åç±»åçº¿ç¨å®å¨ç±»\n\n# ä»ä¹æ¯æ­»é(deadlock)ï¼å¦ä½åæåé¿åæ­»éï¼\n\næ­»éæ¯æä¸¤ä¸ªä»¥ä¸ççº¿ç¨æ°¸è¿ç¸äºé»å¡çæåµï¼è¿ç§æåµäº§çè³å°éè¦ä¸¤ä¸ªä»¥ä¸ççº¿ç¨åä¸¤ä¸ªä»¥ä¸çèµæºã\n\nåææ­»éï¼æä»¬éè¦æ¥ç java åºç¨ç¨åºççº¿ç¨è½¬å¨ãæä»¬éè¦æ¾åºé£äºç¶æä¸º blocked ççº¿ç¨åä»ä»¬ç­å¾çèµæºãæ¯ä¸ªèµæºé½æä¸ä¸ªå¯ä¸ç idï¼ç¨è¿ä¸ª id æä»¬å¯ä»¥æ¾åºåªäºçº¿ç¨å·²ç»æ¥æäºå®çå¯¹è±¡éã\n\né¿ååµå¥éï¼åªå¨éè¦çå°æ¹ä½¿ç¨éåé¿åæ éæç­å¾æ¯é¿åæ­»éçéå¸¸åæ³ã\n\n\n# çº¿ç¨åºç¡\n\n# java çº¿ç¨çå½å¨æä¸­æåªäºç¶æï¼åç¶æä¹é´å¦ä½åæ¢ï¼\n\n\n\njava.lang.thread.state ä¸­å®ä¹äº 6 ç§ä¸åççº¿ç¨ç¶æï¼å¨ç»å®çä¸ä¸ªæ¶å»ï¼çº¿ç¨åªè½å¤äºå¶ä¸­çä¸ä¸ªç¶æã\n\nä»¥ä¸æ¯åç¶æçè¯´æï¼ä»¥åç¶æé´çèç³»ï¼\n\n * å¼å§ï¼newï¼ - è¿æ²¡æè°ç¨ start() æ¹æ³ççº¿ç¨å¤äºæ­¤ç¶æã\n * å¯è¿è¡ï¼runnableï¼ - å·²ç»è°ç¨äº start() æ¹æ³ççº¿ç¨ç¶æãæ­¤ç¶ææå³çï¼çº¿ç¨å·²ç»åå¤å¥½äºï¼ä¸æ¦è¢«çº¿ç¨è°åº¦å¨åéäº cpu æ¶é´çï¼å°±å¯ä»¥è¿è¡çº¿ç¨ã\n * é»å¡ï¼blockedï¼ - é»å¡ç¶æãçº¿ç¨é»å¡ççº¿ç¨ç¶æç­å¾çè§å¨éå®ãå¤äºé»å¡ç¶æççº¿ç¨æ­£å¨ç­å¾çè§å¨éå®ï¼ä»¥ä¾¿å¨è°ç¨ object.wait() ä¹åè¾å¥åæ­¥å/æ¹æ³æéæ°è¾å¥åæ­¥å/æ¹æ³ã\n * ç­å¾ï¼waitingï¼ - ç­å¾ç¶æãä¸ä¸ªçº¿ç¨å¤äºç­å¾ç¶æï¼æ¯ç±äºæ§è¡äº 3 ä¸ªæ¹æ³ä¸­çä»»ææ¹æ³ï¼\n   * object.wait()\n   * thread.join()\n   * locksupport.park()\n * å®æ¶ç­å¾ï¼timed waitingï¼ - ç­å¾æå®æ¶é´çç¶æãä¸ä¸ªçº¿ç¨å¤äºå®æ¶ç­å¾ç¶æï¼æ¯ç±äºæ§è¡äºä»¥ä¸æ¹æ³ä¸­çä»»ææ¹æ³ï¼\n   * thread.sleep(sleeptime)\n   * object.wait(timeout)\n   * thread.join(timeout)\n   * locksupport.parknanos(timeout)\n   * locksupport.parkuntil(timeout)\n * ç»æ­¢(terminated) - çº¿ç¨ run() æ¹æ³æ§è¡ç»æï¼æèå å¼å¸¸éåºäº run() æ¹æ³ï¼åè¯¥çº¿ç¨ç»æçå½å¨æãæ­»äº¡ççº¿ç¨ä¸å¯åæ¬¡å¤çã\n\n> ð åèéè¯»ï¼javathread methods and thread states ð åèéè¯»ï¼java çº¿ç¨ç 5 ç§ç¶æååæ¢(éå½»è®²è§£)\n\n# åå»ºçº¿ç¨æåªäºæ¹å¼ï¼è¿äºæ¹æ³åèªå©å¼æ¯ä»ä¹ï¼\n\nåå»ºçº¿ç¨ä¸»è¦æä¸ç§æ¹å¼ï¼\n\n1. ç»§æ¿ thread ç±»\n\n * å®ä¹ thread ç±»çå­ç±»ï¼å¹¶éåè¯¥ç±»ç run() æ¹æ³ï¼è¯¥ run() æ¹æ³çæ¹æ³ä½å°±ä»£è¡¨äºçº¿ç¨è¦å®æçä»»å¡ãå æ­¤æ run() æ¹æ³ç§°ä¸ºæ§è¡ä½ã\n * åå»º thread å­ç±»çå®ä¾ï¼å³åå»ºäºçº¿ç¨å¯¹è±¡ã\n * è°ç¨çº¿ç¨å¯¹è±¡ç start() æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\n2. å®ç° runnable æ¥å£\n\n * å®ä¹ runnable æ¥å£çå®ç°ç±»ï¼å¹¶éåè¯¥æ¥å£ç run() æ¹æ³ï¼è¯¥ run() æ¹æ³çæ¹æ³ä½åæ ·æ¯è¯¥çº¿ç¨ççº¿ç¨æ§è¡ä½ã\n * åå»º runnable å®ç°ç±»çå®ä¾ï¼å¹¶ä»¥æ­¤å®ä¾ä½ä¸º thread å¯¹è±¡ï¼è¯¥ thread å¯¹è±¡ææ¯çæ­£ççº¿ç¨å¯¹è±¡ã\n * è°ç¨çº¿ç¨å¯¹è±¡ç start() æ¹æ³æ¥å¯å¨è¯¥çº¿ç¨ã\n\n3. éè¿ callable æ¥å£å future æ¥å£\n\n * åå»º callable æ¥å£çå®ç°ç±»ï¼å¹¶å®ç° call() æ¹æ³ï¼è¯¥ call() æ¹æ³å°ä½ä¸ºçº¿ç¨æ§è¡ä½ï¼å¹¶ä¸æè¿åå¼ã\n * åå»º callable å®ç°ç±»çå®ä¾ï¼ä½¿ç¨ futuretask ç±»æ¥åè£ callable å¯¹è±¡ï¼è¯¥ futuretask å¯¹è±¡å°è£äºè¯¥ callable å¯¹è±¡ç call() æ¹æ³çè¿åå¼ã\n * ä½¿ç¨ futuretask å¯¹è±¡ä½ä¸º thread å¯¹è±¡ç target åå»ºå¹¶å¯å¨æ°çº¿ç¨ã\n * è°ç¨ futuretask å¯¹è±¡ç get() æ¹æ³æ¥è·å¾å­çº¿ç¨æ§è¡ç»æåçè¿åå¼\n\nä¸ç§åå»ºçº¿ç¨æ¹å¼å¯¹æ¯\n\n * å®ç° runnable æ¥å£ä¼äºç»§æ¿ thread ç±»ï¼å ä¸ºæ ¹æ®å¼æ¾å°é­ååââå®ç°æ¥å£æ´ä¾¿äºæ©å±ï¼\n * å®ç° runnable æ¥å£ççº¿ç¨æ²¡æè¿åå¼ï¼èä½¿ç¨ callable / future æ¹å¼å¯ä»¥è®©çº¿ç¨æè¿åå¼ã\n\n> ð åèéè¯»ï¼java åå»ºçº¿ç¨çä¸ç§æ¹å¼åå¶å¯¹æ¯\n\n# ä»ä¹æ¯ callable å futureï¼ä»ä¹æ¯ futuretaskï¼\n\nä»ä¹æ¯ callable å futureï¼\n\njava 5 å¨ concurrency åä¸­å¼å¥äº callable æ¥å£ï¼å®å runnable æ¥å£å¾ç¸ä¼¼ï¼ä½å®å¯ä»¥è¿åä¸ä¸ªå¯¹è±¡æèæåºä¸ä¸ªå¼å¸¸ã\n\ncallable æ¥å£ä½¿ç¨æ³åå»å®ä¹å®çè¿åç±»åãexecutors ç±»æä¾äºä¸äºæç¨çæ¹æ³å»å¨çº¿ç¨æ± ä¸­æ§è¡ callable åçä»»å¡ãç±äº callable ä»»å¡æ¯å¹¶è¡çï¼æä»¬å¿é¡»ç­å¾å®è¿åçç»æãfuture å¯¹è±¡ä¸ºæä»¬è§£å³äºè¿ä¸ªé®é¢ãå¨çº¿ç¨æ± æäº¤ callable ä»»å¡åè¿åäºä¸ä¸ª future å¯¹è±¡ï¼ä½¿ç¨å®æä»¬å¯ä»¥ç¥é callable ä»»å¡çç¶æåå¾å° callable è¿åçæ§è¡ç»æãfuture æä¾äº get() æ¹æ³è®©æä»¬å¯ä»¥ç­å¾ callable ç»æå¹¶è·åå®çæ§è¡ç»æã\n\nä»ä¹æ¯ futuretaskï¼\n\nfuturetask æ¯ future çä¸ä¸ªåºç¡å®ç°ï¼æä»¬å¯ä»¥å°å®å executors ä½¿ç¨å¤çå¼æ­¥ä»»å¡ãéå¸¸æä»¬ä¸éè¦ä½¿ç¨ futuretask ç±»ï¼åå½æä»¬æç®éå future æ¥å£çä¸äºæ¹æ³å¹¶ä¿æåæ¥åºç¡çå®ç°æ¯ï¼å®å°±åå¾éå¸¸æç¨ãæä»¬å¯ä»¥ä»ä»ç»§æ¿äºå®å¹¶éåæä»¬éè¦çæ¹æ³ãéè¯» java futuretask ä¾å­ï¼å­¦ä¹ å¦ä½ä½¿ç¨å®ã\n\n> ð åèéè¯»ï¼java å¹¶åç¼ç¨ï¼callableãfuture å futuretask\n\n# start() å run() æä»ä¹åºå«ï¼å¯ä»¥ç´æ¥è°ç¨ thread ç±»ç run() æ¹æ³ä¹ï¼\n\n * run() æ¹æ³æ¯çº¿ç¨çæ§è¡ä½ã\n * start() æ¹æ³è´è´£å¯å¨çº¿ç¨ï¼ç¶å jvm ä¼è®©è¿ä¸ªçº¿ç¨å»æ§è¡ run() æ¹æ³ã\n\nå¯ä»¥ç´æ¥è°ç¨ thread ç±»ç run() æ¹æ³ä¹ï¼\n\n * å¯ä»¥ãä½æ¯å¦æç´æ¥è°ç¨ thread ç run() æ¹æ³ï¼å®çè¡ä¸ºå°±ä¼åæ®éçæ¹æ³ä¸æ ·ã\n * ä¸ºäºå¨æ°ççº¿ç¨ä¸­æ§è¡æä»¬çä»£ç ï¼å¿é¡»ä½¿ç¨ start() æ¹æ³ã\n\n# sleep()ãyield()ãjoin() æ¹æ³æä»ä¹åºå«ï¼ä¸ºä»ä¹ sleep() å yield() æ¹æ³æ¯éæï¼staticï¼çï¼\n\nyield()\n\n * yield() æ¹æ³å¯ä»¥è®©å½åæ­£å¨æ§è¡ççº¿ç¨æåï¼ä½å®ä¸ä¼é»å¡è¯¥çº¿ç¨ï¼å®åªæ¯å°è¯¥çº¿ç¨ä» running ç¶æè½¬å¥ runnable ç¶æã\n * å½æä¸ªçº¿ç¨è°ç¨äº yield() æ¹æ³æåä¹åï¼åªæä¼åçº§ä¸å½åçº¿ç¨ç¸åï¼æèä¼åçº§æ¯å½åçº¿ç¨æ´é«çå¤äºå°±ç»ªç¶æççº¿ç¨æä¼è·å¾æ§è¡çæºä¼ã\n\nsleep()\n\n * sleep() æ¹æ³éè¦æå®ç­å¾çæ¶é´ï¼å®å¯ä»¥è®©å½åæ­£å¨æ§è¡ççº¿ç¨å¨æå®çæ¶é´åæåæ§è¡ï¼è¿å¥ blocked ç¶æã\n * è¯¥æ¹æ³æ¢å¯ä»¥è®©å¶ä»åä¼åçº§æèé«ä¼åçº§ççº¿ç¨å¾å°æ§è¡çæºä¼ï¼ä¹å¯ä»¥è®©ä½ä¼åçº§ççº¿ç¨å¾å°æ§è¡æºä¼ã\n * ä½æ¯ï¼sleep() æ¹æ³ä¸ä¼éæ¾âéæ å¿âï¼ä¹å°±æ¯è¯´å¦ææ synchronized åæ­¥åï¼å¶ä»çº¿ç¨ä»ç¶ä¸è½è®¿é®å±äº«æ°æ®ã\n\njoin()\n\n * join() æ¹æ³ä¼ä½¿å½åçº¿ç¨è½¬å¥ blocked ç¶æï¼ç­å¾è°ç¨ join() æ¹æ³ççº¿ç¨ç»æåæè½ç»§ç»­æ§è¡ã\n\nä¸ºä»ä¹ sleep() å yield() æ¹æ³æ¯éæï¼staticï¼çï¼\n\n * thread ç±»ç sleep() å yield() æ¹æ³å°å¤ç running ç¶æççº¿ç¨ãæä»¥å¨å¶ä»å¤äºé running ç¶æççº¿ç¨ä¸æ§è¡è¿ä¸¤ä¸ªæ¹æ³æ¯æ²¡ææä¹çãè¿å°±æ¯ä¸ºä»ä¹è¿äºæ¹æ³æ¯éæçãå®ä»¬å¯ä»¥å¨å½åæ­£å¨æ§è¡ççº¿ç¨ä¸­å·¥ä½ï¼å¹¶é¿åç¨åºåéè¯¯çè®¤ä¸ºå¯ä»¥å¨å¶ä»éè¿è¡çº¿ç¨è°ç¨è¿äºæ¹æ³ã\n\n> ð åèéè¯»ï¼java çº¿ç¨ä¸­ yield ä¸ join æ¹æ³çåºå« ð åèéè¯»ï¼sleep()ï¼wait()ï¼yield()å join()æ¹æ³çåºå«\n\n# java ççº¿ç¨ä¼åçº§å¦ä½æ§å¶ï¼é«ä¼åçº§ç java çº¿ç¨ä¸å®åæ§è¡åï¼\n\njava ä¸­ççº¿ç¨ä¼åçº§å¦ä½æ§å¶\n\n * java ä¸­ççº¿ç¨ä¼åçº§çèå´æ¯ [1,10]ï¼ä¸è¬æ¥è¯´ï¼é«ä¼åçº§ççº¿ç¨å¨è¿è¡æ¶ä¼å·æä¼åæãå¯ä»¥éè¿ thread.setpriority(thread.max_priority) çæ¹å¼è®¾ç½®ï¼é»è®¤ä¼åçº§ä¸º 5ã\n\né«ä¼åçº§ç java çº¿ç¨ä¸å®åæ§è¡å\n\n * å³ä½¿è®¾ç½®äºçº¿ç¨çä¼åçº§ï¼ä¹æ æ³ä¿è¯é«ä¼åçº§ççº¿ç¨ä¸å®åæ§è¡ã\n * åå ï¼è¿æ¯å ä¸º java çº¿ç¨ä¼åçº§ä¾èµäºæä½ç³»ç»çæ¯æï¼ç¶èï¼ä¸åçæä½ç³»ç»æ¯æççº¿ç¨ä¼åçº§å¹¶ä¸ç¸åï¼ä¸è½å¾å¥½çå java ä¸­çº¿ç¨ä¼åçº§ä¸ä¸å¯¹åºã\n * ç»è®ºï¼java çº¿ç¨ä¼åçº§æ§å¶å¹¶ä¸å¯é ã\n\n# ä»ä¹æ¯å®æ¤çº¿ç¨ï¼ä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨ï¼å¦ä½åå»ºå®æ¤çº¿ç¨ï¼\n\nä»ä¹æ¯å®æ¤çº¿ç¨\n\n * å®æ¤çº¿ç¨ï¼daemon threadï¼æ¯å¨åå°æ§è¡å¹¶ä¸ä¸ä¼é»æ­¢ jvm ç»æ­¢ççº¿ç¨ã\n * ä¸å®æ¤çº¿ç¨ï¼daemon threadï¼ç¸åçï¼å«ç¨æ·çº¿ç¨ï¼user threadï¼ï¼ä¹å°±æ¯éå®æ¤çº¿ç¨ã\n\nä¸ºä»ä¹è¦ç¨å®æ¤çº¿ç¨\n\n * å®æ¤çº¿ç¨çä¼åçº§æ¯è¾ä½ï¼ç¨äºä¸ºç³»ç»ä¸­çå¶å®å¯¹è±¡åçº¿ç¨æä¾æå¡ãå¸åçåºç¨å°±æ¯åå¾åæ¶å¨ã\n\nå¦ä½åå»ºå®æ¤çº¿ç¨\n\n * ä½¿ç¨ thread.setdaemon(true) å¯ä»¥è®¾ç½® thread çº¿ç¨ä¸ºå®æ¤çº¿ç¨ã\n * æ³¨æç¹ï¼\n   * æ­£å¨è¿è¡çç¨æ·çº¿ç¨æ æ³è®¾ç½®ä¸ºå®æ¤çº¿ç¨ï¼æä»¥ thread.setdaemon(true) å¿é¡»å¨ thread.start() ä¹åè®¾ç½®ï¼å¦åä¼æåº llegalthreadstateexception å¼å¸¸ï¼\n   * ä¸ä¸ªå®æ¤çº¿ç¨åå»ºçå­çº¿ç¨ä¾ç¶æ¯å®æ¤çº¿ç¨ã\n   * ä¸è¦è®¤ä¸ºææçåºç¨é½å¯ä»¥åéç»å®æ¤çº¿ç¨æ¥è¿è¡æå¡ï¼æ¯å¦è¯»åæä½æèè®¡ç®é»è¾ã\n\n> ð åèéè¯»ï¼java ä¸­å®æ¤çº¿ç¨çæ»ç»\n\n# çº¿ç¨é´æ¯å¦ä½éä¿¡çï¼\n\nå½çº¿ç¨é´æ¯å¯ä»¥å±äº«èµæºæ¶ï¼çº¿ç¨é´éä¿¡æ¯åè°å®ä»¬çéè¦çææ®µãobject ç±»ä¸­ wait(), notify() å notifyall() æ¹æ³å¯ä»¥ç¨äºçº¿ç¨é´éä¿¡å³äºèµæºçéçç¶æã\n\n> ð åèéè¯»ï¼java å¹¶åç¼ç¨ï¼çº¿ç¨é´åä½çä¸¤ç§æ¹å¼ï¼waitãnotifyãnotifyall å condition\n\n# ä¸ºä»ä¹çº¿ç¨éä¿¡çæ¹æ³ wait(), notify() å notifyall() è¢«å®ä¹å¨ object ç±»éï¼\n\njava çæ¯ä¸ªå¯¹è±¡ä¸­é½æä¸ä¸ªé(monitorï¼ä¹å¯ä»¥æä¸ºçè§å¨) å¹¶ä¸ wait()ãnotify() ç­æ¹æ³ç¨äºç­å¾å¯¹è±¡çéæèéç¥å¶ä»çº¿ç¨å¯¹è±¡ççè§å¨å¯ç¨ãå¨ java ççº¿ç¨ä¸­å¹¶æ²¡æå¯ä¾ä»»ä½å¯¹è±¡ä½¿ç¨çéååæ­¥å¨ãè¿å°±æ¯ä¸ºä»ä¹è¿äºæ¹æ³æ¯ object ç±»çä¸é¨åï¼è¿æ · java çæ¯ä¸ä¸ªç±»é½æç¨äºçº¿ç¨é´éä¿¡çåºæ¬æ¹æ³\n\n# ä¸ºä»ä¹ wait(), notify() å notifyall() å¿é¡»å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨ï¼\n\nå½ä¸ä¸ªçº¿ç¨éè¦è°ç¨å¯¹è±¡ç wait() æ¹æ³çæ¶åï¼è¿ä¸ªçº¿ç¨å¿é¡»æ¥æè¯¥å¯¹è±¡çéï¼æ¥çå®å°±ä¼éæ¾è¿ä¸ªå¯¹è±¡éå¹¶è¿å¥ç­å¾ç¶æç´å°å¶ä»çº¿ç¨è°ç¨è¿ä¸ªå¯¹è±¡ä¸ç notify() æ¹æ³ãåæ ·çï¼å½ä¸ä¸ªçº¿ç¨éè¦è°ç¨å¯¹è±¡ç notify() æ¹æ³æ¶ï¼å®ä¼éæ¾è¿ä¸ªå¯¹è±¡çéï¼ä»¥ä¾¿å¶ä»å¨ç­å¾ççº¿ç¨å°±å¯ä»¥å¾å°è¿ä¸ªå¯¹è±¡éã\n\nç±äºææçè¿äºæ¹æ³é½éè¦çº¿ç¨ææå¯¹è±¡çéï¼è¿æ ·å°±åªè½éè¿åæ­¥æ¥å®ç°ï¼æä»¥ä»ä»¬åªè½å¨åæ­¥æ¹æ³æèåæ­¥åä¸­è¢«è°ç¨ã\n\n\n# å¹¶åæºå¶çåºå±å®ç°\n\n> ð åèéè¯»ï¼java å¹¶åæ ¸å¿æºå¶\n\n# â­â­â­ synchronized\n\n> synchronized æä»ä¹ä½ç¨ï¼\n> \n> synchronized çåçæ¯ä»ä¹ï¼\n> \n> åæ­¥æ¹æ³ååæ­¥åï¼åªä¸ªæ´å¥½ï¼\n> \n> jdk1.6 å¯¹synchronized åäºåªäºä¼åï¼\n> \n> ä½¿ç¨ synchronized ä¿®é¥°éææ¹æ³åééææ¹æ³æä»ä¹åºå«ï¼\n\nä½ç¨\n\nsynchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\nsynchronized æ 3 ç§åºç¨æ¹å¼ï¼\n\n * åæ­¥å®ä¾æ¹æ³ - å¯¹äºæ®éåæ­¥æ¹æ³ï¼éæ¯å½åå®ä¾å¯¹è±¡\n * åæ­¥éææ¹æ³ - å¯¹äºéæåæ­¥æ¹æ³ï¼éæ¯å½åç±»ç class å¯¹è±¡\n * åæ­¥ä»£ç å - å¯¹äºåæ­¥æ¹æ³åï¼éæ¯ synchonized æ¬å·ééç½®çå¯¹è±¡\n\nåç\n\nsynchronized ç»è¿ç¼è¯åï¼ä¼å¨åæ­¥åçåååå«å½¢æ monitorenter å monitorexit è¿ä¸¤ä¸ªå­èç æä»¤ï¼è¿ä¸¤ä¸ªå­èç æä»¤é½éè¦ä¸ä¸ªå¼ç¨ç±»åçåæ°æ¥ææè¦éå®åè§£éçå¯¹è±¡ãå¦æ synchronized æç¡®å¶å®äºå¯¹è±¡åæ°ï¼é£å°±æ¯è¿ä¸ªå¯¹è±¡çå¼ç¨ï¼å¦ææ²¡ææç¡®æå®ï¼é£å°±æ ¹æ® synchronized ä¿®é¥°çæ¯å®ä¾æ¹æ³è¿æ¯éææ¹æ³ï¼å»å¯¹å¯¹åºçå¯¹è±¡å®ä¾æ class å¯¹è±¡æ¥ä½ä¸ºéå¯¹è±¡ã\n\nsynchronized åæ­¥åå¯¹åä¸çº¿ç¨æ¥è¯´æ¯å¯éå¥çï¼ä¸ä¼åºç°éæ­»é®é¢ã\n\nsynchronized åæ­¥åæ¯äºæ¥çï¼å³å·²è¿å¥ççº¿ç¨æ§è¡å®æåï¼ä¼é»å¡å¶ä»è¯å¾è¿å¥ççº¿ç¨ã\n\nä¼å\n\njava 1.6 ä»¥åï¼synchronized åäºå¤§éçä¼åï¼å¶æ§è½å·²ç»ä¸ lock ãreadwritelock åºæ¬ä¸æå¹³ã\n\nsynchronized çä¼åæ¯å°éç²åº¦åä¸ºä¸åçº§å«ï¼synchronized ä¼æ ¹æ®è¿è¡ç¶æå¨æçç±ä½å°é«è°æ´éçº§å«ï¼ååé -> è½»éçº§é -> ééçº§éï¼ï¼ä»¥åå°é»å¡ã\n\nåæ­¥æ¹æ³ or åæ­¥åï¼\n\n * åæ­¥åæ¯æ´å¥½çéæ©ã\n * å ä¸ºå®ä¸ä¼éä½æ´ä¸ªå¯¹è±¡ï¼å½ç¶ä½ ä¹å¯ä»¥è®©å®éä½æ´ä¸ªå¯¹è±¡ï¼ãåæ­¥æ¹æ³ä¼éä½æ´ä¸ªå¯¹è±¡ï¼åªæè¿ä¸ªç±»ä¸­æå¤ä¸ªä¸ç¸å³èçåæ­¥åï¼è¿éå¸¸ä¼å¯¼è´ä»ä»¬åæ­¢æ§è¡å¹¶éè¦ç­å¾è·å¾è¿ä¸ªå¯¹è±¡ä¸çéã\n\n# â­ volatile\n\n> volatile æä»ä¹ä½ç¨ï¼\n> \n> volatile çåçæ¯ä»ä¹ï¼\n> \n> volatile è½ä»£æ¿éåï¼\n> \n> volatile å synchronized çåºå«ï¼\n\nvolatile æ æ³æ¿ä»£ synchronized ï¼å ä¸º volatile æ æ³ä¿è¯æä½çåå­æ§ã\n\nä½ç¨\n\nè¢« volatile å³é®å­ä¿®é¥°çåéæä¸¤å±å«ä¹ï¼\n\n * ä¿è¯äºä¸åçº¿ç¨å¯¹è¿ä¸ªåéè¿è¡æä½æ¶çå¯è§æ§ï¼å³ä¸ä¸ªçº¿ç¨ä¿®æ¹äºæä¸ªåéçå¼ï¼è¿æ°å¼å¯¹å¶ä»çº¿ç¨æ¥è¯´æ¯ç«å³å¯è§çã\n * ç¦æ­¢æä»¤éæåºã\n\nåç\n\nè§å¯å å¥ volatile å³é®å­åæ²¡æå å¥ volatile å³é®å­æ¶æçæçæ±ç¼ä»£ç åç°ï¼å å¥ volatile å³é®å­æ¶ï¼ä¼å¤åºä¸ä¸ª lock åç¼æä»¤ã\n\nlock åç¼æä»¤å®éä¸ç¸å½äºä¸ä¸ªåå­å±éï¼ä¹æåå­æ æ ï¼ï¼åå­å±éä¼æä¾ 3 ä¸ªåè½ï¼\n\n * å®ç¡®ä¿æä»¤éæåºæ¶ä¸ä¼æå¶åé¢çæä»¤æå°åå­å±éä¹åçä½ç½®ï¼ä¹ä¸ä¼æåé¢çæä»¤æå°åå­å±éçåé¢ï¼å³å¨æ§è¡å°åå­å±éè¿å¥æä»¤æ¶ï¼å¨å®åé¢çæä½å·²ç»å¨é¨å®æï¼\n * å®ä¼å¼ºå¶å°å¯¹ç¼å­çä¿®æ¹æä½ç«å³åå¥ä¸»å­ï¼\n * å¦ææ¯åæä½ï¼å®ä¼å¯¼è´å¶ä» cpu ä¸­å¯¹åºçç¼å­è¡æ æã\n\nvolatile å synchronized çåºå«ï¼\n\n * volatile æ¬è´¨æ¯å¨åè¯ jvm å½ååéå¨å¯å­å¨ï¼å·¥ä½åå­ï¼ä¸­çå¼æ¯ä¸ç¡®å®çï¼éè¦ä»ä¸»å­ä¸­è¯»åï¼ synchronized åæ¯éå®å½ååéï¼åªæå½åçº¿ç¨å¯ä»¥è®¿é®è¯¥åéï¼å¶ä»çº¿ç¨è¢«é»å¡ä½ã\n * volatile ä»è½ä½¿ç¨å¨åéçº§å«ï¼synchronized åå¯ä»¥ä½¿ç¨å¨åéãæ¹æ³ãåç±»çº§å«çã\n * volatile ä»è½å®ç°åéçä¿®æ¹å¯è§æ§ï¼ä¸è½ä¿è¯åå­æ§ï¼è synchronized åå¯ä»¥ä¿è¯åéçä¿®æ¹å¯è§æ§ååå­æ§\n * volatile ä¸ä¼é æçº¿ç¨çé»å¡ï¼synchronized å¯è½ä¼é æçº¿ç¨çé»å¡ã\n * volatile æ è®°çåéä¸ä¼è¢«ç¼è¯å¨ä¼åï¼synchronized æ è®°çåéå¯ä»¥è¢«ç¼è¯å¨ä¼åã\n\n# â­â­ cas\n\n> ä»ä¹æ¯ casï¼\n> \n> cas æä»ä¹ä½ç¨ï¼\n> \n> cas çåçæ¯ä»ä¹ï¼\n> \n> cas çä¸å¤§é®é¢ï¼\n\nä½ç¨\n\ncasï¼compare and swapï¼ï¼å­é¢ææä¸ºæ¯è¾å¹¶äº¤æ¢ãcas æ 3 ä¸ªæä½æ°ï¼åå«æ¯ï¼åå­å¼ vï¼æ§çé¢æå¼ aï¼è¦ä¿®æ¹çæ°å¼ bãå½ä¸ä»å½é¢æå¼ a ååå­å¼ v ç¸åæ¶ï¼å°åå­å¼ v ä¿®æ¹ä¸º bï¼å¦åä»ä¹é½ä¸åã\n\nåç\n\njava ä¸»è¦å©ç¨ unsafe è¿ä¸ªç±»æä¾ç cas æä½ãunsafe ç cas ä¾èµçæ¯ jv m éå¯¹ä¸åçæä½ç³»ç»å®ç°ç atomic::cmpxchg æä»¤ã\n\nä¸å¤§é®é¢\n\n 1. aba é®é¢ï¼å ä¸º cas éè¦å¨æä½å¼çæ¶åæ£æ¥ä¸å¼ææ²¡æåçååï¼å¦ææ²¡æåçåååæ´æ°ï¼ä½æ¯å¦æä¸ä¸ªå¼åæ¥æ¯ aï¼åæäº bï¼ååæäº aï¼é£ä¹ä½¿ç¨ cas è¿è¡æ£æ¥æ¶ä¼åç°å®çå¼æ²¡æåçååï¼ä½æ¯å®éä¸å´ååäºãaba é®é¢çè§£å³æè·¯å°±æ¯ä½¿ç¨çæ¬å·ãå¨åéåé¢è¿½å ä¸çæ¬å·ï¼æ¯æ¬¡åéæ´æ°çæ¶åæçæ¬å·å ä¸ï¼é£ä¹ aï¼bï¼a å°±ä¼åæ 1a-2bï¼3aã\n 2. å¾ªç¯æ¶é´é¿å¼éå¤§ãèªæ cas å¦æé¿æ¶é´ä¸æåï¼ä¼ç» cpu å¸¦æ¥éå¸¸å¤§çæ§è¡å¼éãå¦æ jvm è½æ¯æå¤çå¨æä¾ç pause æä»¤é£ä¹æçä¼æä¸å®çæåï¼pause æä»¤æä¸¤ä¸ªä½ç¨ï¼ç¬¬ä¸å®å¯ä»¥å»¶è¿æµæ°´çº¿æ§è¡æä»¤ï¼de-pipelineï¼,ä½¿ cpu ä¸ä¼æ¶èè¿å¤çæ§è¡èµæºï¼å»¶è¿çæ¶é´åå³äºå·ä½å®ç°ççæ¬ï¼å¨ä¸äºå¤çå¨ä¸å»¶è¿æ¶é´æ¯é¶ãç¬¬äºå®å¯ä»¥é¿åå¨éåºå¾ªç¯çæ¶åå åå­é¡ºåºå²çªï¼memory order violationï¼èå¼èµ· cpu æµæ°´çº¿è¢«æ¸ç©ºï¼cpu pipeline flushï¼ï¼ä»èæé« cpu çæ§è¡æçã\n 3. åªè½ä¿è¯ä¸ä¸ªå±äº«åéçåå­æä½ãå½å¯¹ä¸ä¸ªå±äº«åéæ§è¡æä½æ¶ï¼æä»¬å¯ä»¥ä½¿ç¨å¾ªç¯ cas çæ¹å¼æ¥ä¿è¯åå­æä½ï¼ä½æ¯å¯¹å¤ä¸ªå±äº«åéæä½æ¶ï¼å¾ªç¯ cas å°±æ æ³ä¿è¯æä½çåå­æ§ï¼è¿ä¸ªæ¶åå°±å¯ä»¥ç¨éï¼æèæä¸ä¸ªåå·§çåæ³ï¼å°±æ¯æå¤ä¸ªå±äº«åéåå¹¶æä¸ä¸ªå±äº«åéæ¥æä½ãæ¯å¦æä¸¤ä¸ªå±äº«åé i ï¼ 2,j=aï¼åå¹¶ä¸ä¸ ij=2aï¼ç¶åç¨ cas æ¥æä½ ijãä» java1.5 å¼å§ jdk æä¾äº atomicreference ç±»æ¥ä¿è¯å¼ç¨å¯¹è±¡ä¹é´çåå­æ§ï¼ä½ å¯ä»¥æå¤ä¸ªåéæ¾å¨ä¸ä¸ªå¯¹è±¡éæ¥è¿è¡ cas æä½ã\n\n# â­ threadlocal\n\n> threadlocal æä»ä¹ä½ç¨ï¼\n> \n> threadlocal çåçæ¯ä»ä¹ï¼\n> \n> å¦ä½è§£å³ threadlocal åå­æ³æ¼é®é¢ï¼\n\nä½ç¨\n\nthreadlocal æ¯ä¸ä¸ªå­å¨çº¿ç¨æ¬å°å¯æ¬çå·¥å·ç±»ã\n\nåç\n\nthread ç±»ä¸­ç»´æ¤çä¸ä¸ª threadlocal.threadlocalmap ç±»åçæå threadlocalsãè¿ä¸ªæåå°±æ¯ç¨æ¥å­å¨å½åçº¿ç¨ç¬å çåéå¯æ¬ã\n\nthreadlocalmap æ¯ threadlocal çåé¨ç±»ï¼å®ç»´æ¤çä¸ä¸ª entry æ°ç»ï¼ entry ç¨äºä¿å­é®å¼å¯¹ï¼å¶ key æ¯ threadlocal å¯¹è±¡ï¼value æ¯ä¼ éè¿æ¥çå¯¹è±¡ï¼åéå¯æ¬ï¼ã entry ç»§æ¿äº weakreference ï¼æä»¥æ¯å¼±å¼ç¨ã\n\nåå­æ³æ¼é®é¢\n\nthreadlocalmap ç entry ç»§æ¿äº weakreferenceï¼æä»¥å®ç key ï¼threadlocal å¯¹è±¡ï¼æ¯å¼±å¼ç¨ï¼è value ï¼åéå¯æ¬ï¼æ¯å¼ºå¼ç¨ã\n\n * å¦æ threadlocal å¯¹è±¡æ²¡æå¤é¨å¼ºå¼ç¨æ¥å¼ç¨å®ï¼é£ä¹ threadlocal å¯¹è±¡ä¼å¨ä¸æ¬¡ gc æ¶è¢«åæ¶ã\n * æ­¤æ¶ï¼entry ä¸­ç key å·²ç»è¢«åæ¶ï¼ä½æ¯ value ç±äºæ¯å¼ºå¼ç¨ä¸ä¼è¢«åå¾æ¶éå¨åæ¶ãå¦æåå»º threadlocal ççº¿ç¨ä¸ç´æç»­è¿è¡ï¼é£ä¹ value å°±ä¼ä¸ç´å¾ä¸å°åæ¶ï¼äº§çåå­æ³é²ã\n\né£ä¹å¦ä½é¿ååå­æ³æ¼å¢ï¼æ¹æ³å°±æ¯ï¼ä½¿ç¨ threadlocal ç set æ¹æ³åï¼æ¾ç¤ºçè°ç¨ remove æ¹æ³ ã\n\n\n# åå­æ¨¡å\n\n# ä»ä¹æ¯ java åå­æ¨¡å\n\n * java åå­æ¨¡åå³ java memory modelï¼ç®ç§° jmmãjmm å®ä¹äº jvm å¨è®¡ç®æºåå­(ram)ä¸­çå·¥ä½æ¹å¼ãjmm æ¯é¶å±äº jvm çã\n * å¹¶åç¼ç¨é¢åä¸¤ä¸ªå³é®é®é¢ï¼çº¿ç¨é´éä¿¡åçº¿ç¨é´åæ­¥\n * çº¿ç¨é´éä¿¡æºå¶\n   * å±äº«åå­ - çº¿ç¨é´éè¿å-è¯»åå­ä¸­çå¬å±ç¶ææ¥éå¼è¿è¡éä¿¡ã\n   * æ¶æ¯ä¼ é - java ä¸­å¸åçæ¶æ¯ä¼ éæ¹å¼å°±æ¯ wait()å notify()ã\n * çº¿ç¨é´åæ­¥æºå¶\n   * å¨å±äº«åå­æ¨¡åä¸­ï¼å¿é¡»æ¾ç¤ºæå®æä¸ªæ¹æ³æææ®µä»£ç å¨çº¿ç¨é´äºæ¥å°æ§è¡ã\n   * å¨æ¶æ¯ä¼ éæ¨¡åä¸­ï¼ç±äºåéæ¶æ¯å¿é¡»å¨æ¥æ¶æ¶æ¯ä¹åï¼å æ­¤åæ­¥æ¯éå¼è¿è¡çã\n * java çå¹¶åéç¨çæ¯å±äº«åå­æ¨¡å\n * jmm å³å®ä¸ä¸ªçº¿ç¨å¯¹å±äº«åéçåå¥ä½æ¶å¯¹å¦ä¸ä¸ªçº¿ç¨å¯è§ã\n * çº¿ç¨ä¹é´çå±äº«åéå­å¨å¨ä¸»åå­ï¼main memoryï¼ä¸­ï¼æ¯ä¸ªçº¿ç¨é½æä¸ä¸ªç§æçæ¬å°åå­ï¼local memoryï¼ï¼æ¬å°åå­ä¸­å­å¨äºè¯¥çº¿ç¨ä»¥è¯»/åå±äº«åéçå¯æ¬ã\n * jmm æåå­åæäºä¸¤é¨åï¼çº¿ç¨æ åºåå åº\n   * çº¿ç¨æ \n     * jvm ä¸­è¿è¡çæ¯ä¸ªçº¿ç¨é½æ¥æèªå·±ççº¿ç¨æ ï¼çº¿ç¨æ åå«äºå½åçº¿ç¨æ§è¡çæ¹æ³è°ç¨ç¸å³ä¿¡æ¯ï¼æä»¬ä¹æå®ç§°ä½è°ç¨æ ãéçä»£ç çä¸æ­æ§è¡ï¼è°ç¨æ ä¼ä¸æ­ååã\n     * çº¿ç¨æ è¿åå«äºå½åæ¹æ³çæææ¬å°åéä¿¡æ¯ãçº¿ç¨ä¸­çæ¬å°åéå¯¹å¶å®çº¿ç¨æ¯ä¸å¯è§çã\n   * å åº\n     * å åºåå«äº java åºç¨åå»ºçææå¯¹è±¡ä¿¡æ¯ï¼ä¸ç®¡å¯¹è±¡æ¯åªä¸ªçº¿ç¨åå»ºçï¼å¶ä¸­çå¯¹è±¡åæ¬åå§ç±»åçå°è£ç±»ï¼å¦ byteãintegerãlong ç­ç­ï¼ãä¸ç®¡å¯¹è±¡æ¯å±äºä¸ä¸ªæååéè¿æ¯æ¹æ³ä¸­çæ¬å°åéï¼å®é½ä¼è¢«å­å¨å¨å åºã\n   * ä¸ä¸ªæ¬å°åéå¦ææ¯åå§ç±»åï¼é£ä¹å®ä¼è¢«å®å¨å­å¨å°æ åºã\n   * ä¸ä¸ªæ¬å°åéä¹æå¯è½æ¯ä¸ä¸ªå¯¹è±¡çå¼ç¨ï¼è¿ç§æåµä¸ï¼è¿ä¸ªæ¬å°å¼ç¨ä¼è¢«å­å¨å°æ ä¸­ï¼ä½æ¯å¯¹è±¡æ¬èº«ä»ç¶å­å¨å¨å åºã\n   * å¯¹äºä¸ä¸ªå¯¹è±¡çæåæ¹æ³ï¼è¿äºæ¹æ³ä¸­åå«æ¬å°åéï¼ä»éè¦å­å¨å¨æ åºï¼å³ä½¿å®ä»¬æå±çå¯¹è±¡å¨å åºã\n   * å¯¹äºä¸ä¸ªå¯¹è±¡çæååéï¼ä¸ç®¡å®æ¯åå§ç±»åè¿æ¯åè£ç±»åï¼é½ä¼è¢«å­å¨å°å åºã\n\n\n\n> ð åèéè¯»ï¼å¨é¢çè§£ java åå­æ¨¡å\n\n\n# åæ­¥å®¹å¨åå¹¶åå®¹å¨\n\n> ð åèéè¯»ï¼java å¹¶åå®¹å¨\n\n# â­ åæ­¥å®¹å¨\n\n> ä»ä¹æ¯åæ­¥å®¹å¨ï¼\n> \n> æåªäºå¸¸è§åæ­¥å®¹å¨ï¼\n> \n> å®ä»¬æ¯å¦ä½å®ç°çº¿ç¨å®å¨çï¼\n> \n> åæ­¥å®¹å¨çççº¿ç¨å®å¨åï¼\n\nç±»å\n\nvectorãstackãhashtable\n\nä½ç¨/åç\n\nåæ­¥å®¹å¨çåæ­¥åçå°±æ¯å¨æ¹æ³ä¸ç¨ synchronized ä¿®é¥°ã synchronized å¯ä»¥ä¿è¯å¨åä¸ä¸ªæ¶å»ï¼åªæä¸ä¸ªçº¿ç¨å¯ä»¥æ§è¡æä¸ªæ¹æ³æèæä¸ªä»£ç åã\n\nsynchronized çäºæ¥åæ­¥ä¼äº§çé»å¡åå¤éçº¿ç¨çå¼éãæ¾ç¶ï¼è¿ç§æ¹å¼æ¯æ²¡æä½¿ç¨ synchronized çå®¹å¨æ§è½è¦å·®ã\n\nçº¿ç¨å®å¨\n\nåæ­¥å®¹å¨ççç»å¯¹å®å¨åï¼\n\nå¶å®ä¹æªå¿ãå¨åå¤åæä½ï¼éåå­æä½ï¼æ¶ï¼ä»ç¶éè¦å éæ¥ä¿æ¤ãå¸¸è§å¤åæä½å¦ä¸ï¼\n\n * è¿­ä»£ï¼åå¤è®¿é®åç´ ï¼ç´å°éåå®å¨é¨åç´ ï¼\n * è·³è½¬ï¼æ ¹æ®æå®é¡ºåºå¯»æ¾å½ååç´ çä¸ä¸ä¸ªï¼ä¸ n ä¸ªï¼åç´ ï¼\n * æ¡ä»¶è¿ç®ï¼ä¾å¦è¥æ²¡æåæ·»å ç­ï¼\n\n# â­â­â­ concurrenthashmap\n\n> è¯·æè¿° concurrenthashmap çå®ç°åçï¼\n> \n> concurrenthashmap ä¸ºä»ä¹æ¾å¼äºåæ®µéï¼\n\nåºç¡æ°æ®ç»æåçå hashmap ä¸æ ·ï¼jdk 1.7 éç¨ æ°ç»ï¼åé¾è¡¨ï¼jdk 1.8 éç¨æ°ç»ï¼åé¾è¡¨ï¼çº¢é»æ ã\n\nå¹¶åå®å¨ç¹æ§çå®ç°ï¼\n\njdk 1.7ï¼\n\n * ä½¿ç¨åæ®µéï¼è®¾è®¡æè·¯æ¯ç¼©å°éç²åº¦ï¼æé«å¹¶åååã\n * åæ°æ®æ¶ï¼ä¼ä½¿ç¨å¯éå¥éå»éä½åæ®µï¼segmentï¼ã\n\njdk 1.8ï¼\n\n * åæ¶åæ®µéï¼ç´æ¥éç¨ transient volatile hashentry<k,v>[] table ä¿å­æ°æ®ï¼éç¨ table æ°ç»åç´ ä½ä¸ºéï¼ä»èå®ç°äºå¯¹æ¯ä¸è¡æ°æ®è¿è¡å éï¼è¿ä¸æ­¥åå°å¹¶åå²çªçæ¦çã\n * åæ°æ®æ¶ï¼ä½¿ç¨æ¯ cas + synchronizedã\n   * æ ¹æ® key è®¡ç®åº hashcode ã\n   * å¤æ­æ¯å¦éè¦è¿è¡åå§åã\n   * f å³ä¸ºå½å key å®ä½åºç nodeï¼å¦æä¸ºç©ºè¡¨ç¤ºå½åä½ç½®å¯ä»¥åå¥æ°æ®ï¼å©ç¨ cas å°è¯åå¥ï¼å¤±è´¥åèªæä¿è¯æåã\n   * å¦æå½åä½ç½®ç hashcode == moved == -1,åéè¦è¿è¡æ©å®¹ã\n   * å¦æé½ä¸æ»¡è¶³ï¼åå©ç¨ synchronized éåå¥æ°æ®ã\n   * å¦ææ°éå¤§äº treeify_threshold åè¦è½¬æ¢ä¸ºçº¢é»æ ã\n\n# â­â­ copyonwritearraylist\n\n> copyonwritearraylist çä½ç¨ï¼\n> \n> copyonwritearraylist çåçï¼\n\nä½ç¨\n\ncopyonwrite å­é¢ææä¸ºåå¥æ¶å¤å¶ãcopyonwritearraylist æ¯çº¿ç¨å®å¨ç arraylistã\n\nåç\n\n * å¨ copyonwriteaarraylist ä¸­ï¼è¯»æä½ä¸åæ­¥ï¼å ä¸ºå®ä»¬å¨åé¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼æä»¥å¤ä¸ªè¿­ä»£å¨å¯ä»¥åæ¶éåèä¸ä¼ç¸äºé»å¡ï¼1,2,4ï¼ã\n * ææçåæä½é½æ¯åæ­¥çãä»ä»¬å¨å¤ä»½æ°ç»ï¼3ï¼çå¯æ¬ä¸å·¥ä½ãåæä½å®æåï¼åå¤éµåå°è¢«æ¿æ¢ä¸ºå¤å¶çéµåï¼å¹¶éæ¾éå®ãæ¯ææ°ç»åå¾æåï¼æä»¥æ¿æ¢æ°ç»çè°ç¨æ¯åå­ï¼5ï¼ã\n * åæä½ååå»ºçè¿­ä»£å¨å°è½å¤çå°ä¿®æ¹çç»æï¼6,7ï¼ã\n * åæ¶å¤å¶éåè¿åçè¿­ä»£å¨ä¸ä¼æåº concurrentmodificationexceptionï¼å ä¸ºå®ä»¬å¨æ°ç»çå¿«ç§ä¸å·¥ä½ï¼å¹¶ä¸æ è®ºåç»­çä¿®æ¹ï¼2,4ï¼å¦ä½ï¼é½ä¼åè¿­ä»£å¨åå»ºæ¶é£æ ·å®å¨è¿ååç´ ã\n\n\n\n\n# å¹¶åé\n\n> ð åèéè¯»ï¼java å¹¶åé\n\n# â­â­ éç±»å\n\n> java ä¸­æåªäºéï¼\n> \n> è¿äºéæä»ä¹ç¹æ§ï¼\n\nå¯éå¥é\n\n * reentrantlock ãreentrantreadwritelock æ¯å¯éå¥éãè¿ç¹ï¼ä»å¶å½åä¹ä¸é¾çåºã\n * synchronized ä¹æ¯ä¸ä¸ªå¯éå¥éã\n\nå¬å¹³éä¸éå¬å¹³é\n\n * synchronized åªæ¯æéå¬å¹³éã\n * reentrantlock ãreentrantreadwritelockï¼é»è®¤æ¯éå¬å¹³éï¼ä½æ¯æå¬å¹³éã\n\nç¬äº«éä¸å±äº«é\n\n * synchronized ãreentrantlock åªæ¯æç¬äº«éã\n * reentrantreadwritelock å¶åéæ¯ç¬äº«éï¼å¶è¯»éæ¯å±äº«éãè¯»éæ¯å±äº«éä½¿å¾å¹¶åè¯»æ¯éå¸¸é«æçï¼è¯»åï¼åè¯» ï¼ååçè¿ç¨æ¯äºæ¥çã\n\næ²è§éä¸ä¹è§é\n\n * æ²è§éå¨ java ä¸­çåºç¨å°±æ¯éè¿ä½¿ç¨ synchronized å lock æ¾ç¤ºå éæ¥è¿è¡äºæ¥åæ­¥ï¼è¿æ¯ä¸ç§é»å¡åæ­¥ã\n\n * ä¹è§éå¨ java ä¸­çåºç¨å°±æ¯éç¨ cas æºå¶ï¼cas æä½éè¿ unsafe ç±»æä¾ï¼ä½è¿ä¸ªç±»ä¸ç´æ¥æ´é²ä¸º apiï¼æä»¥é½æ¯é´æ¥ä½¿ç¨ï¼å¦åç§åå­ç±»ï¼ã\n\nååéãè½»éçº§éãééçº§é\n\njava 1.6 ä»¥åï¼ééçº§éä¸è¬æçæ¯ synchronized ï¼èè½»éçº§éæçæ¯ volatileã\n\njava 1.6 ä»¥åï¼éå¯¹ synchronized åäºå¤§éä¼åï¼å¼å¥ 4 ç§éç¶æï¼ æ éç¶æãååéãè½»éçº§éåééçº§éãéå¯ä»¥ååçä»ååéåçº§å°è½»éçº§éï¼åä»è½»éçº§éåçº§å°ééçº§é ã\n\nåæ®µé\n\nåæ®µéå¶å®æ¯ä¸ç§éçè®¾è®¡ï¼å¹¶ä¸æ¯å·ä½çä¸ç§éãå¸åï¼jdk1.7 ä¹åç concurrenthashmap\n\næ¾ç¤ºéååç½®é\n\n * åç½®éï¼synchronized\n * æ¾ç¤ºéï¼reentrantlockãreentrantreadwritelock ç­ã\n\n# â­â­ aqs\n\n> ä»ä¹æ¯ aqsï¼\n> \n> aqs çä½ç¨æ¯ä»ä¹ï¼\n> \n> aqs çåçï¼\n\nä½ç¨\n\nabstractqueuedsynchronizerï¼ç®ç§° aqsï¼æ¯éååæ­¥å¨ï¼é¡¾åæä¹ï¼å¶ä¸»è¦ä½ç¨æ¯å¤çåæ­¥ãå®æ¯å¹¶åéåå¾å¤åæ­¥å·¥å·ç±»çå®ç°åºç³ï¼å¦ reentrantlockãreentrantreadwritelockãsemaphore ç­ï¼ã\n\naqs æä¾äºå¯¹ç¬äº«éä¸å±äº«éçæ¯æã\n\nåç\n\nï¼1ï¼æ°æ®ç»æ\n\n * state - aqs ä½¿ç¨ä¸ä¸ªæ´åç volatile åéæ¥ ç»´æ¤åæ­¥ç¶æã\n   * è¿ä¸ªæ´æ°ç¶æçæä¹ç±å­ç±»æ¥èµäºï¼å¦reentrantlock ä¸­è¯¥ç¶æå¼è¡¨ç¤ºææèçº¿ç¨å·²ç»éå¤è·åè¯¥éçæ¬¡æ°ï¼semaphore ä¸­è¯¥ç¶æå¼è¡¨ç¤ºå©ä½çè®¸å¯æ°éã\n * head å tail - aqs ç»´æ¤äºä¸ä¸ª node ç±»åï¼aqs çåé¨ç±»ï¼çåé¾è¡¨æ¥å®æåæ­¥ç¶æçç®¡çãè¿ä¸ªåé¾è¡¨æ¯ä¸ä¸ªååç fifo éåï¼éè¿ head å tail æéè¿è¡è®¿é®ãå½ æçº¿ç¨è·åéå¤±è´¥åï¼å°±è¢«æ·»å å°éåæ«å°¾ã\n\nï¼2ï¼è·åç¬å é\n\naqs ä¸­ä½¿ç¨ acquire(int arg) æ¹æ³è·åç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·ååæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶ææåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶æä¸æåï¼aqs ä¼ä¸æ­å°è¯å©ç¨ cas æä½å°å½åçº¿ç¨æå¥ç­å¾åæ­¥éåçéå°¾ï¼ç´å°æåä¸ºæ­¢ã\n 3. æ¥çï¼ä¸æ­å°è¯ä¸ºç­å¾éåä¸­ççº¿ç¨èç¹è·åç¬å éã\n\nï¼3ï¼éæ¾ç¬å é\n\naqs ä¸­ä½¿ç¨ release(int arg) æ¹æ³éæ¾ç¬å éï¼å¶å¤§è´æµç¨å¦ä¸ï¼\n\n 1. åå°è¯è·åè§£éçº¿ç¨çåæ­¥ç¶æï¼å¦æè·ååæ­¥ç¶æä¸æåï¼åç»ææ¹æ³ï¼ç´æ¥è¿åã\n 2. å¦æè·ååæ­¥ç¶ææåï¼aqs ä¼å°è¯å¤éå½åçº¿ç¨èç¹çåç»§èç¹ã\n\nï¼4ï¼è·åå±äº«é\n\naqs ä¸­ä½¿ç¨ acquireshared(int arg) æ¹æ³è·åå±äº«éã\n\nacquireshared æ¹æ³å acquire æ¹æ³çé»è¾å¾ç¸ä¼¼ï¼åºå«ä»å¨äºèªæçæ¡ä»¶ä»¥åèç¹åºéçæä½ææä¸åã\n\næåè·å¾å±äº«éçæ¡ä»¶å¦ä¸ï¼\n\n * tryacquireshared(arg) è¿åå¼å¤§äºç­äº 0 ï¼è¿æå³çå±äº«éç permit è¿æ²¡æç¨å®ï¼ã\n * å½åèç¹çåé©±èç¹æ¯å¤´ç»ç¹ã\n\nï¼5ï¼éæ¾å±äº«é\n\naqs ä¸­ä½¿ç¨ releaseshared(int arg) æ¹æ³éæ¾å±äº«éã\n\nreleaseshared é¦åä¼å°è¯éæ¾åæ­¥ç¶æï¼å¦ææåï¼åè§£éä¸ä¸ªæå¤ä¸ªåç»§çº¿ç¨èç¹ãéæ¾å±äº«éåéæ¾ç¬äº«éæµç¨å¤§ä½ç¸ä¼¼ï¼åºå«å¨äºï¼\n\nå¯¹äºç¬äº«æ¨¡å¼ï¼å¦æéè¦ signalï¼éæ¾ä»ç¸å½äºè°ç¨å¤´èç¹ç unparksuccessorã\n\n# â­â­ reentrantlock\n\n> ä»ä¹æ¯ reentrantlockï¼\n> \n> ä»ä¹æ¯å¯éå¥éï¼\n> \n> reentrantlock æä»ä¹ç¨ï¼\n> \n> reentrantlock åçï¼\n\nä½ç¨\n\nreentrantlock æä¾äºä¸ç»æ æ¡ä»¶çãå¯è½®è¯¢çãå®æ¶çä»¥åå¯ä¸­æ­çéæä½\n\nreentrantlock çç¹æ§å¦ä¸ï¼\n\n * reentrantlock æä¾äºä¸ synchronized ç¸åçäºæ¥æ§ãåå­å¯è§æ§åå¯éå¥æ§ã\n * reentrantlock æ¯æå¬å¹³éåéå¬å¹³éï¼é»è®¤ï¼ä¸¤ç§æ¨¡å¼ã\n * reentrantlock å®ç°äº lock æ¥å£ï¼æ¯æäº synchronized æä¸å·å¤ççµæ´»æ§ã\n   * synchronized æ æ³ä¸­æ­ä¸ä¸ªæ­£å¨ç­å¾è·åéççº¿ç¨\n   * synchronized æ æ³å¨è¯·æ±è·åä¸ä¸ªéæ¶æ ä¼æ­¢å°ç­å¾\n\nåç\n\nreentrantlock åºäºå¶åé¨ç±» reentrantlock.sync å®ç°ï¼sync ç»§æ¿èª aqsãå®æä¸¤ä¸ªå­ç±»ï¼\n\n * reentrantlock.fairsync - å¬å¹³éã\n * reentrantlock.nonfairsync - éå¬å¹³éã\n\næ¬è´¨ä¸ï¼å°±æ¯åºäº aqs å®ç°ã\n\n# â­ reentrantreadwritelock\n\n> reentrantreadwritelock æ¯ä»ä¹ï¼\n> \n> reentrantreadwritelock çä½ç¨ï¼\n> \n> reentrantreadwritelock çåçï¼\n\nä½ç¨\n\nreentrantreadwritelock æ¯ä¸ä¸ªå¯éå¥çè¯»åéãreentrantreadwritelock ç»´æ¤äºä¸å¯¹è¯»åéï¼å°è¯»åéåå¼ï¼æå©äºæé«å¹¶åæçã\n\nåç\n\nreentrantreadwritelock æ¬è´¨ä¸ä¹æ¯åºäº aqs å®ç°ãæä¸ä¸ªæ ¸å¿å­æ®µï¼\n\n * sync - åé¨ç±» reentrantreadwritelock.sync å¯¹è±¡ãä¸ reentrantlock ç±»ä¼¼ï¼å®æä¸¤ä¸ªå­ç±»ï¼reentrantreadwritelock.fairsync å reentrantreadwritelock.nonfairsync ï¼åå«è¡¨ç¤ºå¬å¹³éåéå¬å¹³éçå®ç°ã\n * readerlock - åé¨ç±» reentrantreadwritelock.readlock å¯¹è±¡ï¼è¿æ¯ä¸æè¯»éã\n * writerlock - åé¨ç±» reentrantreadwritelock.writelock å¯¹è±¡ï¼è¿æ¯ä¸æåéã\n\n# â­ condition\n\n> condition æä»ä¹ç¨ï¼\n> \n> ä½¿ç¨ lock ççº¿ç¨ï¼å½¼æ­¤å¦ä½éä¿¡ï¼\n\nä½ç¨\n\nå¯ä»¥çè§£ä¸ºï¼ä»ä¹æ ·çééä»ä¹æ ·çé¥åã\n\nåç½®éï¼synchronizedï¼éååç½®æ¡ä»¶éåï¼waitãnotifyãnotifyall ï¼ï¼æ¾å¼éï¼lockï¼éåæ¾å¼æ¡ä»¶éåï¼condition ï¼ã\n\n# â­â­ æ­»é\n\n> å¦ä½é¿åæ­»éï¼\n\n * é¿åä¸ä¸ªçº¿ç¨åæ¶è·åå¤ä¸ªé\n * é¿åä¸ä¸ªçº¿ç¨å¨éååæ¶å ç¨å¤ä¸ªèµæºï¼å°½éä¿è¯æ¯ä¸ªéåªå ç¨ä¸ä¸ªèµæº\n * å°è¯ä½¿ç¨å®æ¶é lock.trylock(timeout)ï¼é¿åéä¸ç´ä¸è½éæ¾\n * å¯¹äºæ°æ®åºéï¼å éåè§£éå¿é¡»å¨ä¸ä¸ªæ°æ®åºè¿æ¥ä¸­éï¼å¦åä¼åºç°è§£éå¤±è´¥çæåµã\n\n\n# åå­åéç±»\n\n> ð åèéè¯»ï¼java åå­ç±»\n\n# â­ åå­ç±»ç®ä»\n\n> ä¸ºä»ä¹è¦ç¨åå­ç±»ï¼\n> \n> ç¨è¿åªäºåå­ç±»ï¼\n\nä½ç¨\n\nå¸¸è§çéï¼lockãsychronizedï¼ç±äºæ¯é»å¡å¼çï¼å¿å¿å½±åå¹¶åååéã\n\nvolatile å·ç§°è½»éçº§çéï¼ä½ä¸è½ä¿è¯åå­æ§ã\n\nä¸ºäºå¼é¡¾åå­æ§åéçæ§è½é®é¢ï¼æä»¥å¼å¥äºåå­ç±»ã\n\nç±»å\n\nåå­åéç±»å¯ä»¥åä¸º 4 ç»ï¼\n\n * åºæ¬ç±»å\n   * atomicboolean - å¸å°ç±»ååå­ç±»\n   * atomicinteger - æ´ååå­ç±»\n   * atomiclong - é¿æ´ååå­ç±»\n * å¼ç¨ç±»å\n   * atomicreference - å¼ç¨ç±»ååå­ç±»\n   * atomicmarkablereference - å¸¦ææ è®°ä½çå¼ç¨ç±»ååå­ç±»\n   * atomicstampedreference - å¸¦æçæ¬å·çå¼ç¨ç±»ååå­ç±»\n * æ°ç»ç±»å\n   * atomicintegerarray - æ´å½¢æ°ç»åå­ç±»\n   * atomiclongarray - é¿æ´åæ°ç»åå­ç±»\n   * atomicreferencearray - å¼ç¨ç±»åæ°ç»åå­ç±»\n * å±æ§æ´æ°å¨ç±»å\n   * atomicintegerfieldupdater - æ´åå­æ®µçåå­æ´æ°å¨ã\n   * atomiclongfieldupdater - é¿æ´åå­æ®µçåå­æ´æ°å¨ã\n   * atomicreferencefieldupdater - åå­æ´æ°å¼ç¨ç±»åéçå­æ®µã\n\n# â­ åå­ç±»çåç\n\n 1. å¤çå¨å®ç°åå­æä½ï¼ä½¿ç¨æ»çº¿éä¿è¯åå­æ§ï¼ä½¿ç¨ç¼å­éä¿è¯åå­æ§ï¼ä¿®æ¹åå­å°åï¼ç¼å­ä¸è´æ§æºå¶ï¼é»æ­¢åæ¶ä¿®æ¹ç± 2 ä¸ªä»¥ä¸çå¤çå¨ç¼å­çåå­åºåæ°æ®ï¼\n 2. java å®ç°åå­æä½ï¼å¾ªç¯ä½¿ç¨ cas ï¼èªæ casï¼å®ç°åå­æä½\n\n\n# å¹¶åå·¥å·ç±»\n\n> ð åèéè¯»ï¼java å¹¶åå·¥å·ç±»\n\n# â­ countdownlatch\n\n> countdownlatch ä½ç¨ï¼\n> \n> countdownlatch åçï¼\n\nä½ç¨\n\nå­é¢ææä¸º éåè®¡æ°éãç¨äºæ§å¶ä¸ä¸ªæèå¤ä¸ªçº¿ç¨ç­å¾å¤ä¸ªçº¿ç¨ã\n\ncountdownlatch ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countï¼è¡¨ç¤ºéè¦ç­å¾çäºä»¶æ°éãcountdown æ¹æ³éåè®¡æ°å¨ï¼è¡¨ç¤ºæä¸ä¸ªäºä»¶å·²ç»åçãè°ç¨ await æ¹æ³ççº¿ç¨ä¼ä¸ç´é»å¡ç´å°è®¡æ°å¨ä¸ºé¶ï¼æèç­å¾ä¸­ççº¿ç¨ä¸­æ­ï¼æèç­å¾è¶æ¶ã\n\n\n\nåç\n\ncountdownlatch æ¯åºäº aqs(abstractqueuedsynchronizer) å®ç°çã\n\n# â­ cyclicbarrier\n\n> cyclicbarrier æä»ä¹ç¨ï¼\n> \n> cyclicbarrier çåçæ¯ä»ä¹ï¼\n> \n> cyclicbarrier å countdownlatch æä»ä¹åºå«ï¼\n\nä½ç¨\n\nå­é¢æææ¯ å¾ªç¯æ æ ãcyclicbarrier å¯ä»¥è®©ä¸ç»çº¿ç¨ç­å¾è³æä¸ªç¶æï¼éµå¾ªå­é¢ææï¼ä¸å¦¨ç§°è¿ä¸ªç¶æä¸ºæ æ ï¼ä¹ååå¨é¨åæ¶æ§è¡ãä¹æä»¥å«å¾ªç¯æ æ æ¯å ä¸ºï¼å½ææç­å¾çº¿ç¨é½è¢«éæ¾ä»¥åï¼cyclicbarrier å¯ä»¥è¢«éç¨ã\n\ncyclicbarrier ç»´æ¤ä¸ä¸ªè®¡æ°å¨ countãæ¯æ¬¡æ§è¡ await æ¹æ³ä¹åï¼count å  1ï¼ç´å°è®¡æ°å¨çå¼åè®¾ç½®çå¼ç¸ç­ï¼ç­å¾çææçº¿ç¨æä¼ç»§ç»­æ§è¡ã\n\n\n\nåç\n\ncyclicbarrier æ¯åºäº reentrantlock å condition å®ç°çã\n\nåºå«\n\ncyclicbarrier å countdownlatch é½å¯ä»¥ç¨æ¥è®©ä¸ç»çº¿ç¨ç­å¾å¶å®çº¿ç¨ãä¸ cyclicbarrier ä¸åçæ¯ï¼countdownlatch ä¸è½éç¨ã\n\n# â­ semaphore\n\n> semaphore ä½ç¨ï¼\n\nä½ç¨\n\nå­é¢ææä¸º ä¿¡å·éãsemaphore ç¨æ¥æ§å¶åæ¶è®¿é®æä¸ªç¹å®èµæºçæä½æ°éï¼æèåæ¶æ§è¡æä¸ªæå®æä½çæ°éã\n\nsemaphore ç®¡ççä¸ç»èæçè®¸å¯ï¼permitï¼ï¼permit çåå§æ°éå¯éè¿æé æ¹æ³æ¥æå®ãæ¯æ¬¡æ§è¡ acquire æ¹æ³å¯ä»¥è·åä¸ä¸ª permitï¼å¦ææ²¡æå°±ç­å¾ï¼è release æ¹æ³å¯ä»¥éæ¾ä¸ä¸ª permitã\n\n * semaphore å¯ä»¥ç¨äºå®ç°èµæºæ± ï¼å¦æ°æ®åºè¿æ¥æ± ã\n * semaphore å¯ä»¥ç¨äºå°ä»»ä½ä¸ç§å®¹å¨åææçé»å¡å®¹å¨ã\n\n\n\n\n# çº¿ç¨æ± \n\n> ð åèéè¯»ï¼java çº¿ç¨æ± \n\n# â­â­ threadpoolexecutor\n\n> threadpoolexecutor æåªäºåæ°ï¼åèªæä»ä¹ç¨ï¼\n> \n> threadpoolexecutor å·¥ä½åçï¼\n\nåç\n\n\n\nåæ°\n\njava.uitl.concurrent.threadpoolexecutor ç±»æ¯ executor æ¡æ¶ä¸­ææ ¸å¿çä¸ä¸ªç±»ã\n\nthreadpoolexecutor æåä¸ªæé æ¹æ³ï¼åä¸ä¸ªé½æ¯åºäºç¬¬åä¸ªå®ç°ãç¬¬åä¸ªæé æ¹æ³å®ä¹å¦ä¸ï¼\n\n    public threadpoolexecutor(int corepoolsize,\n                              int maximumpoolsize,\n                              long keepalivetime,\n                              timeunit unit,\n                              blockingqueue<runnable> workqueue,\n                              threadfactory threadfactory,\n                              rejectedexecutionhandler handler) {\n\n\nåæ°è¯´æï¼\n\n * corepoolsize - æ ¸å¿çº¿ç¨æ°éãå½ææ°ä»»å¡éè¿ execute æ¹æ³æäº¤æ¶ ï¼çº¿ç¨æ± ä¼æ§è¡ä»¥ä¸å¤æ­ï¼\n   * å¦æè¿è¡ççº¿ç¨æ°å°äº corepoolsizeï¼ååå»ºæ°çº¿ç¨æ¥å¤çä»»å¡ï¼å³ä½¿çº¿ç¨æ± ä¸­çå¶ä»çº¿ç¨æ¯ç©ºé²çã\n   * å¦æçº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äºç­äº corepoolsize ä¸å°äº maximumpoolsizeï¼ååªæå½ workqueue æ»¡æ¶æåå»ºæ°ççº¿ç¨å»å¤çä»»å¡ï¼\n   * å¦æè®¾ç½®ç corepoolsize å maximumpoolsize ç¸åï¼ååå»ºççº¿ç¨æ± çå¤§å°æ¯åºå®çãè¿æ¶å¦æææ°ä»»å¡æäº¤ï¼è¥ workqueue æªæ»¡ï¼åå°è¯·æ±æ¾å¥ workqueue ä¸­ï¼ç­å¾æç©ºé²ççº¿ç¨å»ä» workqueue ä¸­åä»»å¡å¹¶å¤çï¼\n   * å¦æè¿è¡ççº¿ç¨æ°éå¤§äºç­äº maximumpoolsizeï¼è¿æ¶å¦æ workqueue å·²ç»æ»¡äºï¼åä½¿ç¨ handler ææå®çç­ç¥æ¥å¤çä»»å¡ï¼\n   * æä»¥ï¼ä»»å¡æäº¤æ¶ï¼å¤æ­çé¡ºåºä¸º corepoolsize => workqueue => maximumpoolsizeã\n * maximumpoolsize - æå¤§çº¿ç¨æ°éã\n   * å¦æéåæ»¡äºï¼å¹¶ä¸å·²åå»ºççº¿ç¨æ°å°äºæå¤§çº¿ç¨æ°ï¼åçº¿ç¨æ± ä¼ååå»ºæ°ççº¿ç¨æ§è¡ä»»å¡ã\n   * å¼å¾æ³¨æçæ¯ï¼å¦æä½¿ç¨äºæ ççä»»å¡éåè¿ä¸ªåæ°å°±æ²¡ä»ä¹ææã\n * keepalivetimeï¼çº¿ç¨ä¿ææ´»å¨çæ¶é´ã\n   * å½çº¿ç¨æ± ä¸­ççº¿ç¨æ°éå¤§äº corepoolsize çæ¶åï¼å¦æè¿æ¶æ²¡ææ°çä»»å¡æäº¤ï¼æ ¸å¿çº¿ç¨å¤ççº¿ç¨ä¸ä¼ç«å³éæ¯ï¼èæ¯ä¼ç­å¾ï¼ç´å°ç­å¾çæ¶é´è¶è¿äº keepalivetimeã\n   * æä»¥ï¼å¦æä»»å¡å¾å¤ï¼å¹¶ä¸æ¯ä¸ªä»»å¡æ§è¡çæ¶é´æ¯è¾ç­ï¼å¯ä»¥è°å¤§è¿ä¸ªæ¶é´ï¼æé«çº¿ç¨çå©ç¨çã\n * unit - keepalivetime çæ¶é´åä½ãæ 7 ç§åå¼ãå¯éçåä½æå¤©ï¼daysï¼ï¼å°æ¶ï¼hoursï¼ï¼åéï¼minutesï¼ï¼æ¯«ç§(milliseconds)ï¼å¾®ç§(microseconds, ååä¹ä¸æ¯«ç§)åæ¯«å¾®ç§(nanoseconds, ååä¹ä¸å¾®ç§)ã\n * workqueue - ç­å¾æ§è¡çä»»å¡éåãç¨äºä¿å­ç­å¾æ§è¡çä»»å¡çé»å¡éåã å¯ä»¥éæ©ä»¥ä¸å ä¸ªé»å¡éåã\n   * arrayblockingqueue - æçé»å¡éåã\n     * æ­¤éåæ¯åºäºæ°ç»çåè¿ååºéåï¼fifoï¼ã\n     * æ­¤éååå»ºæ¶å¿é¡»æå®å¤§å°ã\n   * linkedblockingqueue - æ çé»å¡éåã\n     * æ­¤éåæ¯åºäºé¾è¡¨çåè¿ååºéåï¼fifoï¼ã\n     * å¦æåå»ºæ¶æ²¡ææå®æ­¤éåå¤§å°ï¼åé»è®¤ä¸º integer.max_valueã\n     * ååééå¸¸è¦é«äº arrayblockingqueueã\n     * ä½¿ç¨ linkedblockingqueue æå³çï¼ maximumpoolsize å°ä¸èµ·ä½ç¨ï¼çº¿ç¨æ± è½åå»ºçæå¤§çº¿ç¨æ°ä¸º corepoolsizeï¼å ä¸ºä»»å¡ç­å¾éåæ¯æ çéåã\n     * executors.newfixedthreadpool ä½¿ç¨äºè¿ä¸ªéåã\n   * synchronousqueue - ä¸ä¼ä¿å­æäº¤çä»»å¡ï¼èæ¯å°ç´æ¥æ°å»ºä¸ä¸ªçº¿ç¨æ¥æ§è¡æ°æ¥çä»»å¡ã\n     * æ¯ä¸ªæå¥æä½å¿é¡»ç­å°å¦ä¸ä¸ªçº¿ç¨è°ç¨ç§»é¤æä½ï¼å¦åæå¥æä½ä¸ç´å¤äºé»å¡ç¶æã\n     * ååééå¸¸è¦é«äº linkedblockingqueueã\n     * executors.newcachedthreadpool ä½¿ç¨äºè¿ä¸ªéåã\n   * priorityblockingqueue - å·æä¼åçº§çæ çé»å¡éåã\n * threadfactory - çº¿ç¨å·¥åãå¯ä»¥éè¿çº¿ç¨å·¥åç»æ¯ä¸ªåå»ºåºæ¥ççº¿ç¨è®¾ç½®æ´ææä¹çåå­ã\n * handler - é¥±åç­ç¥ãå®æ¯ rejectedexecutionhandler ç±»åçåéãå½éååçº¿ç¨æ± é½æ»¡äºï¼è¯´æçº¿ç¨æ± å¤äºé¥±åç¶æï¼é£ä¹å¿é¡»éåä¸ç§ç­ç¥å¤çæäº¤çæ°ä»»å¡ãçº¿ç¨æ± æ¯æä»¥ä¸ç­ç¥ï¼\n   * abortpolicy - ä¸¢å¼ä»»å¡å¹¶æåºå¼å¸¸ãè¿ä¹æ¯é»è®¤ç­ç¥ã\n   * discardpolicy - ä¸¢å¼ä»»å¡ï¼ä½ä¸æåºå¼å¸¸ã\n   * discardoldestpolicy - ä¸¢å¼éåæåé¢çä»»å¡ï¼ç¶åéæ°å°è¯æ§è¡ä»»å¡ï¼éå¤æ­¤è¿ç¨ï¼ã\n   * callerrunspolicy - åªç¨è°ç¨èæå¨ççº¿ç¨æ¥è¿è¡ä»»å¡ã\n   * å¦æä»¥ä¸ç­ç¥é½ä¸è½æ»¡è¶³éè¦ï¼ä¹å¯ä»¥éè¿å®ç° rejectedexecutionhandler æ¥å£æ¥å®å¶å¤çç­ç¥ãå¦è®°å½æ¥å¿ææä¹åä¸è½å¤ççä»»å¡ã\n\n# â­ executors\n\n> executors æä¾äºåªäºåç½®ççº¿ç¨æ± ï¼\n> \n> è¿äºçº¿ç¨æ± åèªæä»ä¹ç¹æ§ï¼éåç¨äºä»ä¹åºæ¯ï¼\n\nexecutors ä¸º executorï¼executorserviceï¼scheduledexecutorserviceï¼threadfactory å callable ç±»æä¾äºä¸äºå·¥å·æ¹æ³ã\n\nï¼1ï¼newsinglethreadexecutor\n\nåå»ºä¸ä¸ªåçº¿ç¨ççº¿ç¨æ± ã\n\nåªä¼åå»ºå¯ä¸çå·¥ä½çº¿ç¨æ¥æ§è¡ä»»å¡ï¼ä¿è¯ææä»»å¡æç§æå®é¡ºåº(fifo, lifo, ä¼åçº§)æ§è¡ã å¦æè¿ä¸ªå¯ä¸ççº¿ç¨å ä¸ºå¼å¸¸ç»æï¼é£ä¹ä¼æä¸ä¸ªæ°ççº¿ç¨æ¥æ¿ä»£å® ã\n\nåå·¥ä½çº¿ç¨æå¤§çç¹ç¹æ¯ï¼å¯ä¿è¯é¡ºåºå°æ§è¡åä¸ªä»»å¡ã\n\nï¼2ï¼newfixedthreadpool\n\nåå»ºä¸ä¸ªåºå®å¤§å°ççº¿ç¨æ± ã\n\næ¯æ¬¡æäº¤ä¸ä¸ªä»»å¡å°±ä¼æ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ï¼å¦æå·¥ä½çº¿ç¨æ°éè¾¾å°çº¿ç¨æ± æå¤§çº¿ç¨æ°ï¼åå°æäº¤çä»»å¡å­å¥å°é»å¡éåä¸­ã\n\nfixedthreadpool æ¯ä¸ä¸ªå¸åä¸ä¼ç§ççº¿ç¨æ± ï¼å®å·æçº¿ç¨æ± æé«ç¨åºæçåèçåå»ºçº¿ç¨æ¶æèçå¼éçä¼ç¹ãä½æ¯ï¼å¨çº¿ç¨æ± ç©ºé²æ¶ï¼å³çº¿ç¨æ± ä¸­æ²¡æå¯è¿è¡ä»»å¡æ¶ï¼å®ä¸ä¼éæ¾å·¥ä½çº¿ç¨ï¼è¿ä¼å ç¨ä¸å®çç³»ç»èµæºã\n\nï¼3ï¼newcachedthreadpool\n\nåå»ºä¸ä¸ªå¯ç¼å­ççº¿ç¨æ± ã\n\n * å¦æçº¿ç¨æ± å¤§å°è¶è¿å¤çä»»å¡æéè¦ççº¿ç¨æ°ï¼å°±ä¼åæ¶é¨åç©ºé²ççº¿ç¨ï¼\n * å¦æé¿æ¶é´æ²¡æå¾çº¿ç¨æ± ä¸­æäº¤ä»»å¡ï¼å³å¦æå·¥ä½çº¿ç¨ç©ºé²äºæå®çæ¶é´ï¼é»è®¤ä¸º 1 åéï¼ï¼åè¯¥å·¥ä½çº¿ç¨å°èªå¨ç»æ­¢ãç»æ­¢åï¼å¦æä½ åæäº¤äºæ°çä»»å¡ï¼åçº¿ç¨æ± éæ°åå»ºä¸ä¸ªå·¥ä½çº¿ç¨ã\n * æ­¤çº¿ç¨æ± ä¸ä¼å¯¹çº¿ç¨æ± å¤§å°åéå¶ï¼çº¿ç¨æ± å¤§å°å®å¨ä¾èµäºæä½ç³»ç»ï¼æèè¯´ jvmï¼è½å¤åå»ºçæå¤§çº¿ç¨å¤§å°ã å æ­¤ï¼ä½¿ç¨ cachedthreadpool æ¶ï¼ä¸å®è¦æ³¨ææ§å¶ä»»å¡çæ°éï¼å¦åï¼ç±äºå¤§éçº¿ç¨åæ¶è¿è¡ï¼å¾æä¼é æç³»ç»ç«çªã\n\nï¼4ï¼newschedulethreadpool\n\nåå»ºä¸ä¸ªå¤§å°æ éççº¿ç¨æ± ãæ­¤çº¿ç¨æ± æ¯æå®æ¶ä»¥åå¨ææ§æ§è¡ä»»å¡çéæ±ã\n\n\n# jvm\n\n\n# åå­ç®¡ç\n\n\n# oom\n\n\n# åèèµæ\n\n * ä¹¦ç±\n   * ãjava å¹¶åç¼ç¨å®æã\n   * ãjava å¹¶åç¼ç¨çèºæ¯ã\n   * ãæ·±å¥çè§£ java èææºã\n * æç« \n   * java çº¿ç¨é¢è¯é¢ top 50\n   * java å¤çº¿ç¨åå¹¶ååºç¡é¢è¯é®ç­\n   * è¿ç¨åçº¿ç¨å³ç³»ååºå«\n   * javathread methods and thread states\n   * java çº¿ç¨ç 5 ç§ç¶æååæ¢(éå½»è®²è§£)\n   * java ä¸­å®æ¤çº¿ç¨çæ»ç»\n   * java åå»ºçº¿ç¨çä¸ç§æ¹å¼åå¶å¯¹æ¯\n   * java çº¿ç¨ç 5 ç§ç¶æååæ¢(éå½»è®²è§£)\n   * java çº¿ç¨æ¹æ³ join çç®åæ»ç»\n   * java å¹¶åç¼ç¨ï¼çº¿ç¨é´åä½çä¸¤ç§æ¹å¼ï¼waitãnotifyãnotifyall å condition\n   * java å¹¶åç¼ç¨ï¼volatile å³é®å­è§£æ\n   * java å¹¶åç¼ç¨ï¼callableãfuture å futuretask\n   * java å¹¶åç¼ç¨ï¼çº¿ç¨æ± çä½¿ç¨\n   * java å¹¶åç¼ç¨',charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"JavaSE",frontmatter:{title:"JavaSE",date:"2022-05-06T09:19:33.000Z",categories:["Java","JavaSE"],tags:["Java","JavaSE"],permalink:"/pages/69d2f8/",hidden:!0},regularPath:"/01.Java/01.JavaSE/",relativePath:"01.Java/01.JavaSE/README.md",key:"v-f5cbbe1c",path:"/pages/69d2f8/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:13},{level:3,title:"Java åºç¡ç¹æ§",slug:"java-åºç¡ç¹æ§",normalizedTitle:"java åºç¡ç¹æ§",charIndex:39},{level:3,title:"Java é«çº§ç¹æ§",slug:"java-é«çº§ç¹æ§",normalizedTitle:"java é«çº§ç¹æ§",charIndex:218},{level:3,title:"Java å®¹å¨",slug:"java-å®¹å¨",normalizedTitle:"java å®¹å¨",charIndex:562},{level:3,title:"Java IO",slug:"java-io",normalizedTitle:"java io",charIndex:942},{level:3,title:"Java å¹¶å",slug:"java-å¹¶å",normalizedTitle:"java å¹¶å",charIndex:1293},{level:3,title:"Java èææº",slug:"java-èææº",normalizedTitle:"java èææº",charIndex:1888},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:2315},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:2948}],headersStr:"ð åå®¹ Java åºç¡ç¹æ§ Java é«çº§ç¹æ§ Java å®¹å¨ Java IO Java å¹¶å Java èææº ð èµæ ðª ä¼ é",content:"# JavaSE\n\n\n# ð åå®¹\n\n> Java é¢è¯æ»ç» ð¯\n\n\n# Java åºç¡ç¹æ§\n\n * Java å¼åç¯å¢\n * Java åºç¡è¯­æ³ç¹æ§\n * Java åºæ¬æ°æ®ç±»å\n * Java é¢åå¯¹è±¡\n * Java æ¹æ³\n * Java æ°ç»\n * Java æä¸¾\n * Java æ§å¶è¯­å¥\n * Java å¼å¸¸\n * Java æ³å\n * Java åå°\n * Java æ³¨è§£\n * Java String ç±»å\n\n\n# Java é«çº§ç¹æ§\n\n * Java æ­£åä»å¥é¨å°ç²¾é - å³é®è¯ï¼PatternãMatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãDFAãNFA\n * Java ç¼ç åå å¯ - å³é®è¯ï¼Base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãMD5ãSHAãHMACãAESãDESãDESedeãRSA\n * Java å½éå - å³é®è¯ï¼LocaleãResourceBundleãNumberFormatãDateFormatãMessageFormat\n * Java JDK8 - å³é®è¯ï¼StreamãlambdaãOptionalã@FunctionalInterface\n * Java SPI - å³é®è¯ï¼SPIãClassLoader\n\n\n# Java å®¹å¨\n\n\n\n * Java å®¹å¨ç®ä» - å³é®è¯ï¼Collectionãæ³åãIterableãIteratorãComparableãComparatorãCloneableãfail-fast\n * Java å®¹å¨ä¹ List - å³é®è¯ï¼ListãArrayListãLinkedList\n * Java å®¹å¨ä¹ Map - å³é®è¯ï¼MapãHashMapãTreeMapãLinkedHashMapãWeakHashMap\n * Java å®¹å¨ä¹ Set - å³é®è¯ï¼SetãHashSetãTreeSetãLinkedHashSetãEmumSet\n * Java å®¹å¨ä¹ Queue - å³é®è¯ï¼QueueãDequeãArrayDequeãLinkedListãPriorityQueue\n * Java å®¹å¨ä¹ Stream\n\n\n# Java IO\n\n\n\n * Java IO æ¨¡å - å³é®è¯ï¼InputStreamãOutputStreamãReaderãWriterãé»å¡\n * Java NIO - å³é®è¯ï¼ChannelãBufferãSelectorãéé»å¡ãå¤è·¯å¤ç¨\n * Java åºåå - å³é®è¯ï¼SerializableãserialVersionUIDãtransientãExternalizableãwriteObjectãreadObject\n * Java ç½ç»ç¼ç¨ - å³é®è¯ï¼SocketãServerSocketãDatagramPacketãDatagramSocket\n * Java IO å·¥å·ç±» - å³é®è¯ï¼FileãRandomAccessFileãSystemãScanner\n\n\n# Java å¹¶å\n\n\n\n * Java å¹¶åç®ä» - å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n * Java çº¿ç¨åºç¡ - å³é®è¯ï¼ThreadãRunnableãCallableãFutureãwaitãnotifyãnotifyAllãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n * Java å¹¶åæ ¸å¿æºå¶ - å³é®è¯ï¼synchronizedãvolatileãCASãThreadLocal\n * Java å¹¶åé - å³é®è¯ï¼AQSãReentrantLockãReentrantReadWriteLockãCondition\n * Java åå­ç±» - å³é®è¯ï¼CASãAtomic\n * Java å¹¶åå®¹å¨ - å³é®è¯ï¼ConcurrentHashMapãCopyOnWriteArrayList\n * Java çº¿ç¨æ±  - å³é®è¯ï¼ExecutorãExecutorServiceãThreadPoolExecutorãExecutors\n * Java å¹¶åå·¥å·ç±» - å³é®è¯ï¼CountDownLatchãCyclicBarrierãSemaphore\n * Java åå­æ¨¡å - å³é®è¯ï¼JMMãvolatileãsynchronizedãfinalãHappens-Beforeãåå­å±é\n * ForkJoin æ¡æ¶\n\n\n# Java èææº\n\n\n\n * JVM ä½ç³»ç»æ\n * JVM åå­åºå - å³é®è¯ï¼ç¨åºè®¡æ°å¨ãèææºæ ãæ¬å°æ¹æ³æ ãå ãæ¹æ³åºãè¿è¡æ¶å¸¸éæ± ãç´æ¥åå­ãOutOfMemoryErrorãStackOverflowError\n * JVM åå¾æ¶é - å³é®è¯ï¼GC RootsãSerialãParallelãCMSãG1ãMinor GCãFull GC\n * JVM ç±»å è½½ - å³é®è¯ï¼ClassLoaderãåäº²å§æ´¾\n * JVM å­èç  - å³é®è¯ï¼bytecodeãasmãjavassist\n * JVM å½ä»¤è¡å·¥å· - å³é®è¯ï¼jpsãjstatãjmap ãjstackãjhatãjinfo\n * JVM GUI å·¥å· - å³é®è¯ï¼jconsoleãjvisualvmãMATãJProfileãArthas\n * JVM å®æ - å³é®è¯ï¼éç½®ãè°ä¼\n * Java æéè¯æ­ - å³é®è¯ï¼CPUãåå­ãç£çãç½ç»ãGC\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * Java åå¤§åè\n     * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n     * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n     * ãJava æ ¸å¿ææ¯ å· II é«çº§ç¹æ§ã\n     * ãEffective Javaã\n   * Java å¹¶å\n     * ãJava å¹¶åç¼ç¨å®æã\n     * ãJava å¹¶åç¼ç¨çèºæ¯ã\n   * Java èææº\n     * ãæ·±å¥çè§£ Java èææºã\n   * Java å¥é¨\n     * ãO'Reillyï¼Head First Javaã\n     * ãç¯ç Java è®²ä¹ã\n   * å¶ä»\n     * ãHead First è®¾è®¡æ¨¡å¼ã\n     * ãJava ç½ç»ç¼ç¨ã\n     * ãJava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ Java å¼åæåã\n * æç¨ãç¤¾åº\n   * Runoob Java æç¨\n   * java-design-patterns\n   * Java\n   * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãJava æ§è½è°ä¼å®æã\n   * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ Java èææº\n   * ãJava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * CS-Notes\n   * JavaGuide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# javase\n\n\n# ð åå®¹\n\n> java é¢è¯æ»ç» ð¯\n\n\n# java åºç¡ç¹æ§\n\n * java å¼åç¯å¢\n * java åºç¡è¯­æ³ç¹æ§\n * java åºæ¬æ°æ®ç±»å\n * java é¢åå¯¹è±¡\n * java æ¹æ³\n * java æ°ç»\n * java æä¸¾\n * java æ§å¶è¯­å¥\n * java å¼å¸¸\n * java æ³å\n * java åå°\n * java æ³¨è§£\n * java string ç±»å\n\n\n# java é«çº§ç¹æ§\n\n * java æ­£åä»å¥é¨å°ç²¾é - å³é®è¯ï¼patternãmatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãdfaãnfa\n * java ç¼ç åå å¯ - å³é®è¯ï¼base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãmd5ãshaãhmacãaesãdesãdesedeãrsa\n * java å½éå - å³é®è¯ï¼localeãresourcebundleãnumberformatãdateformatãmessageformat\n * java jdk8 - å³é®è¯ï¼streamãlambdaãoptionalã@functionalinterface\n * java spi - å³é®è¯ï¼spiãclassloader\n\n\n# java å®¹å¨\n\n\n\n * java å®¹å¨ç®ä» - å³é®è¯ï¼collectionãæ³åãiterableãiteratorãcomparableãcomparatorãcloneableãfail-fast\n * java å®¹å¨ä¹ list - å³é®è¯ï¼listãarraylistãlinkedlist\n * java å®¹å¨ä¹ map - å³é®è¯ï¼mapãhashmapãtreemapãlinkedhashmapãweakhashmap\n * java å®¹å¨ä¹ set - å³é®è¯ï¼setãhashsetãtreesetãlinkedhashsetãemumset\n * java å®¹å¨ä¹ queue - å³é®è¯ï¼queueãdequeãarraydequeãlinkedlistãpriorityqueue\n * java å®¹å¨ä¹ stream\n\n\n# java io\n\n\n\n * java io æ¨¡å - å³é®è¯ï¼inputstreamãoutputstreamãreaderãwriterãé»å¡\n * java nio - å³é®è¯ï¼channelãbufferãselectorãéé»å¡ãå¤è·¯å¤ç¨\n * java åºåå - å³é®è¯ï¼serializableãserialversionuidãtransientãexternalizableãwriteobjectãreadobject\n * java ç½ç»ç¼ç¨ - å³é®è¯ï¼socketãserversocketãdatagrampacketãdatagramsocket\n * java io å·¥å·ç±» - å³é®è¯ï¼fileãrandomaccessfileãsystemãscanner\n\n\n# java å¹¶å\n\n\n\n * java å¹¶åç®ä» - å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n * java çº¿ç¨åºç¡ - å³é®è¯ï¼threadãrunnableãcallableãfutureãwaitãnotifyãnotifyallãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n * java å¹¶åæ ¸å¿æºå¶ - å³é®è¯ï¼synchronizedãvolatileãcasãthreadlocal\n * java å¹¶åé - å³é®è¯ï¼aqsãreentrantlockãreentrantreadwritelockãcondition\n * java åå­ç±» - å³é®è¯ï¼casãatomic\n * java å¹¶åå®¹å¨ - å³é®è¯ï¼concurrenthashmapãcopyonwritearraylist\n * java çº¿ç¨æ±  - å³é®è¯ï¼executorãexecutorserviceãthreadpoolexecutorãexecutors\n * java å¹¶åå·¥å·ç±» - å³é®è¯ï¼countdownlatchãcyclicbarrierãsemaphore\n * java åå­æ¨¡å - å³é®è¯ï¼jmmãvolatileãsynchronizedãfinalãhappens-beforeãåå­å±é\n * forkjoin æ¡æ¶\n\n\n# java èææº\n\n\n\n * jvm ä½ç³»ç»æ\n * jvm åå­åºå - å³é®è¯ï¼ç¨åºè®¡æ°å¨ãèææºæ ãæ¬å°æ¹æ³æ ãå ãæ¹æ³åºãè¿è¡æ¶å¸¸éæ± ãç´æ¥åå­ãoutofmemoryerrorãstackoverflowerror\n * jvm åå¾æ¶é - å³é®è¯ï¼gc rootsãserialãparallelãcmsãg1ãminor gcãfull gc\n * jvm ç±»å è½½ - å³é®è¯ï¼classloaderãåäº²å§æ´¾\n * jvm å­èç  - å³é®è¯ï¼bytecodeãasmãjavassist\n * jvm å½ä»¤è¡å·¥å· - å³é®è¯ï¼jpsãjstatãjmap ãjstackãjhatãjinfo\n * jvm gui å·¥å· - å³é®è¯ï¼jconsoleãjvisualvmãmatãjprofileãarthas\n * jvm å®æ - å³é®è¯ï¼éç½®ãè°ä¼\n * java æéè¯æ­ - å³é®è¯ï¼cpuãåå­ãç£çãç½ç»ãgc\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * java åå¤§åè\n     * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n     * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n     * ãjava æ ¸å¿ææ¯ å· ii é«çº§ç¹æ§ã\n     * ãeffective javaã\n   * java å¹¶å\n     * ãjava å¹¶åç¼ç¨å®æã\n     * ãjava å¹¶åç¼ç¨çèºæ¯ã\n   * java èææº\n     * ãæ·±å¥çè§£ java èææºã\n   * java å¥é¨\n     * ão'reillyï¼head first javaã\n     * ãç¯ç java è®²ä¹ã\n   * å¶ä»\n     * ãhead first è®¾è®¡æ¨¡å¼ã\n     * ãjava ç½ç»ç¼ç¨ã\n     * ãjava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ java å¼åæåã\n * æç¨ãç¤¾åº\n   * runoob java æç¨\n   * java-design-patterns\n   * java\n   * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãjava æ§è½è°ä¼å®æã\n   * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ java èææº\n   * ãjava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * cs-notes\n   * javaguide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"æ ç­¾",frontmatter:{tagsPage:!0,title:"æ ç­¾",permalink:"/tags/",article:!1},regularPath:"/@pages/tagsPage.html",relativePath:"@pages/tagsPage.md",key:"v-73f01fa5",path:"/tags/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"å½æ¡£",frontmatter:{archivesPage:!0,title:"å½æ¡£",permalink:"/archives/",article:!1},regularPath:"/@pages/archivesPage.html",relativePath:"@pages/archivesPage.md",key:"v-3f7bcbb6",path:"/archives/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"åç±»",frontmatter:{categoriesPage:!0,title:"åç±»",permalink:"/categories/",article:!1},regularPath:"/@pages/categoriesPage.html",relativePath:"@pages/categoriesPage.md",key:"v-67a474f6",path:"/categories/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3},{title:"Home",frontmatter:{home:!0,heroImage:"img/bg.gif",heroText:"JAVACORE",tagline:"â javacore æ¯ä¸ä¸ª Java æ ¸å¿ææ¯æç¨ã",bannerBg:"none",postList:"none",footer:"CC-BY-SA-4.0 Licensed | Copyright Â© 2018-Now Dunwu"},regularPath:"/",relativePath:"README.md",key:"v-ceebf0d4",path:"/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:108},{level:3,title:"Java åºç¡ç¹æ§",slug:"java-åºç¡ç¹æ§",normalizedTitle:"java åºç¡ç¹æ§",charIndex:134},{level:3,title:"Java é«çº§ç¹æ§",slug:"java-é«çº§ç¹æ§",normalizedTitle:"java é«çº§ç¹æ§",charIndex:313},{level:3,title:"Java å®¹å¨",slug:"java-å®¹å¨",normalizedTitle:"java å®¹å¨",charIndex:657},{level:3,title:"Java IO",slug:"java-io",normalizedTitle:"java io",charIndex:1037},{level:3,title:"Java å¹¶å",slug:"java-å¹¶å",normalizedTitle:"java å¹¶å",charIndex:1388},{level:3,title:"Java èææº",slug:"java-èææº",normalizedTitle:"java èææº",charIndex:1983},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:2410},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:3043}],headersStr:"ð åå®¹ Java åºç¡ç¹æ§ Java é«çº§ç¹æ§ Java å®¹å¨ Java IO Java å¹¶å Java èææº ð èµæ ðª ä¼ é",content:"> â JavaCore æ¯ä¸ä¸ª Java æ ¸å¿ææ¯æç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼Github | Gitee\n>  * ð çµå­ä¹¦éè¯»ï¼Github Pages | Gitee Pages\n\n\n# ð åå®¹\n\n> Java é¢è¯æ»ç» ð¯\n\n\n# Java åºç¡ç¹æ§\n\n * Java å¼åç¯å¢\n * Java åºç¡è¯­æ³ç¹æ§\n * Java åºæ¬æ°æ®ç±»å\n * Java é¢åå¯¹è±¡\n * Java æ¹æ³\n * Java æ°ç»\n * Java æä¸¾\n * Java æ§å¶è¯­å¥\n * Java å¼å¸¸\n * Java æ³å\n * Java åå°\n * Java æ³¨è§£\n * Java String ç±»å\n\n\n# Java é«çº§ç¹æ§\n\n * Java æ­£åä»å¥é¨å°ç²¾é - å³é®è¯ï¼PatternãMatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãDFAãNFA\n * Java ç¼ç åå å¯ - å³é®è¯ï¼Base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãMD5ãSHAãHMACãAESãDESãDESedeãRSA\n * Java å½éå - å³é®è¯ï¼LocaleãResourceBundleãNumberFormatãDateFormatãMessageFormat\n * Java JDK8 - å³é®è¯ï¼StreamãlambdaãOptionalã@FunctionalInterface\n * Java SPI - å³é®è¯ï¼SPIãClassLoader\n\n\n# Java å®¹å¨\n\n\n\n * Java å®¹å¨ç®ä» - å³é®è¯ï¼Collectionãæ³åãIterableãIteratorãComparableãComparatorãCloneableãfail-fast\n * Java å®¹å¨ä¹ List - å³é®è¯ï¼ListãArrayListãLinkedList\n * Java å®¹å¨ä¹ Map - å³é®è¯ï¼MapãHashMapãTreeMapãLinkedHashMapãWeakHashMap\n * Java å®¹å¨ä¹ Set - å³é®è¯ï¼SetãHashSetãTreeSetãLinkedHashSetãEmumSet\n * Java å®¹å¨ä¹ Queue - å³é®è¯ï¼QueueãDequeãArrayDequeãLinkedListãPriorityQueue\n * Java å®¹å¨ä¹ Stream\n\n\n# Java IO\n\n\n\n * Java IO æ¨¡å - å³é®è¯ï¼InputStreamãOutputStreamãReaderãWriterãé»å¡\n * Java NIO - å³é®è¯ï¼ChannelãBufferãSelectorãéé»å¡ãå¤è·¯å¤ç¨\n * Java åºåå - å³é®è¯ï¼SerializableãserialVersionUIDãtransientãExternalizableãwriteObjectãreadObject\n * Java ç½ç»ç¼ç¨ - å³é®è¯ï¼SocketãServerSocketãDatagramPacketãDatagramSocket\n * Java IO å·¥å·ç±» - å³é®è¯ï¼FileãRandomAccessFileãSystemãScanner\n\n\n# Java å¹¶å\n\n\n\n * Java å¹¶åç®ä» - å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n * Java çº¿ç¨åºç¡ - å³é®è¯ï¼ThreadãRunnableãCallableãFutureãwaitãnotifyãnotifyAllãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n * Java å¹¶åæ ¸å¿æºå¶ - å³é®è¯ï¼synchronizedãvolatileãCASãThreadLocal\n * Java å¹¶åé - å³é®è¯ï¼AQSãReentrantLockãReentrantReadWriteLockãCondition\n * Java åå­ç±» - å³é®è¯ï¼CASãAtomic\n * Java å¹¶åå®¹å¨ - å³é®è¯ï¼ConcurrentHashMapãCopyOnWriteArrayList\n * Java çº¿ç¨æ±  - å³é®è¯ï¼ExecutorãExecutorServiceãThreadPoolExecutorãExecutors\n * Java å¹¶åå·¥å·ç±» - å³é®è¯ï¼CountDownLatchãCyclicBarrierãSemaphore\n * Java åå­æ¨¡å - å³é®è¯ï¼JMMãvolatileãsynchronizedãfinalãHappens-Beforeãåå­å±é\n * ForkJoin æ¡æ¶\n\n\n# Java èææº\n\n\n\n * JVM ä½ç³»ç»æ\n * JVM åå­åºå - å³é®è¯ï¼ç¨åºè®¡æ°å¨ãèææºæ ãæ¬å°æ¹æ³æ ãå ãæ¹æ³åºãè¿è¡æ¶å¸¸éæ± ãç´æ¥åå­ãOutOfMemoryErrorãStackOverflowError\n * JVM åå¾æ¶é - å³é®è¯ï¼GC RootsãSerialãParallelãCMSãG1ãMinor GCãFull GC\n * JVM å­èç  - å³é®è¯ï¼bytecodeãasmãjavassist\n * JVM ç±»å è½½ - å³é®è¯ï¼ClassLoaderãåäº²å§æ´¾\n * JVM å½ä»¤è¡å·¥å· - å³é®è¯ï¼jpsãjstatãjmap ãjstackãjhatãjinfo\n * JVM GUI å·¥å· - å³é®è¯ï¼jconsoleãjvisualvmãMATãJProfileãArthas\n * JVM å®æ - å³é®è¯ï¼éç½®ãè°ä¼\n * Java æéè¯æ­ - å³é®è¯ï¼CPUãåå­ãç£çãç½ç»ãGC\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * Java åå¤§åè\n     * ãJava ç¼ç¨ææ³ï¼Thinking in javaï¼ã\n     * ãJava æ ¸å¿ææ¯ å· I åºç¡ç¥è¯ã\n     * ãJava æ ¸å¿ææ¯ å· II é«çº§ç¹æ§ã\n     * ãEffective Javaã\n   * Java å¹¶å\n     * ãJava å¹¶åç¼ç¨å®æã\n     * ãJava å¹¶åç¼ç¨çèºæ¯ã\n   * Java èææº\n     * ãæ·±å¥çè§£ Java èææºã\n   * Java å¥é¨\n     * ãO'Reillyï¼Head First Javaã\n     * ãç¯ç Java è®²ä¹ã\n   * å¶ä»\n     * ãHead First è®¾è®¡æ¨¡å¼ã\n     * ãJava ç½ç»ç¼ç¨ã\n     * ãJava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ Java å¼åæåã\n * æç¨ãç¤¾åº\n   * Runoob Java æç¨\n   * java-design-patterns\n   * Java\n   * ãJava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãJava æ§è½è°ä¼å®æã\n   * ãJava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ Java èææº\n   * ãJava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * CS-Notes\n   * JavaGuide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"> â javacore æ¯ä¸ä¸ª java æ ¸å¿ææ¯æç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼github | gitee\n>  * ð çµå­ä¹¦éè¯»ï¼github pages | gitee pages\n\n\n# ð åå®¹\n\n> java é¢è¯æ»ç» ð¯\n\n\n# java åºç¡ç¹æ§\n\n * java å¼åç¯å¢\n * java åºç¡è¯­æ³ç¹æ§\n * java åºæ¬æ°æ®ç±»å\n * java é¢åå¯¹è±¡\n * java æ¹æ³\n * java æ°ç»\n * java æä¸¾\n * java æ§å¶è¯­å¥\n * java å¼å¸¸\n * java æ³å\n * java åå°\n * java æ³¨è§£\n * java string ç±»å\n\n\n# java é«çº§ç¹æ§\n\n * java æ­£åä»å¥é¨å°ç²¾é - å³é®è¯ï¼patternãmatcherãæè·ä¸éæè·ãååå¼ç¨ãé¶å®½æ­è¨ãè´ªå©ªä¸ææ°ãåå­ç¬¦ãdfaãnfa\n * java ç¼ç åå å¯ - å³é®è¯ï¼base64ãæ¶æ¯æè¦ãæ°å­ç­¾åãå¯¹ç§°å å¯ãéå¯¹ç§°å å¯ãmd5ãshaãhmacãaesãdesãdesedeãrsa\n * java å½éå - å³é®è¯ï¼localeãresourcebundleãnumberformatãdateformatãmessageformat\n * java jdk8 - å³é®è¯ï¼streamãlambdaãoptionalã@functionalinterface\n * java spi - å³é®è¯ï¼spiãclassloader\n\n\n# java å®¹å¨\n\n\n\n * java å®¹å¨ç®ä» - å³é®è¯ï¼collectionãæ³åãiterableãiteratorãcomparableãcomparatorãcloneableãfail-fast\n * java å®¹å¨ä¹ list - å³é®è¯ï¼listãarraylistãlinkedlist\n * java å®¹å¨ä¹ map - å³é®è¯ï¼mapãhashmapãtreemapãlinkedhashmapãweakhashmap\n * java å®¹å¨ä¹ set - å³é®è¯ï¼setãhashsetãtreesetãlinkedhashsetãemumset\n * java å®¹å¨ä¹ queue - å³é®è¯ï¼queueãdequeãarraydequeãlinkedlistãpriorityqueue\n * java å®¹å¨ä¹ stream\n\n\n# java io\n\n\n\n * java io æ¨¡å - å³é®è¯ï¼inputstreamãoutputstreamãreaderãwriterãé»å¡\n * java nio - å³é®è¯ï¼channelãbufferãselectorãéé»å¡ãå¤è·¯å¤ç¨\n * java åºåå - å³é®è¯ï¼serializableãserialversionuidãtransientãexternalizableãwriteobjectãreadobject\n * java ç½ç»ç¼ç¨ - å³é®è¯ï¼socketãserversocketãdatagrampacketãdatagramsocket\n * java io å·¥å·ç±» - å³é®è¯ï¼fileãrandomaccessfileãsystemãscanner\n\n\n# java å¹¶å\n\n\n\n * java å¹¶åç®ä» - å³é®è¯ï¼è¿ç¨ãçº¿ç¨ãå®å¨æ§ãæ´»è·æ§ãæ§è½ãæ­»éãé¥¥é¥¿ãä¸ä¸æåæ¢\n * java çº¿ç¨åºç¡ - å³é®è¯ï¼threadãrunnableãcallableãfutureãwaitãnotifyãnotifyallãjoinãsleepãyeildãçº¿ç¨ç¶æãçº¿ç¨éä¿¡\n * java å¹¶åæ ¸å¿æºå¶ - å³é®è¯ï¼synchronizedãvolatileãcasãthreadlocal\n * java å¹¶åé - å³é®è¯ï¼aqsãreentrantlockãreentrantreadwritelockãcondition\n * java åå­ç±» - å³é®è¯ï¼casãatomic\n * java å¹¶åå®¹å¨ - å³é®è¯ï¼concurrenthashmapãcopyonwritearraylist\n * java çº¿ç¨æ±  - å³é®è¯ï¼executorãexecutorserviceãthreadpoolexecutorãexecutors\n * java å¹¶åå·¥å·ç±» - å³é®è¯ï¼countdownlatchãcyclicbarrierãsemaphore\n * java åå­æ¨¡å - å³é®è¯ï¼jmmãvolatileãsynchronizedãfinalãhappens-beforeãåå­å±é\n * forkjoin æ¡æ¶\n\n\n# java èææº\n\n\n\n * jvm ä½ç³»ç»æ\n * jvm åå­åºå - å³é®è¯ï¼ç¨åºè®¡æ°å¨ãèææºæ ãæ¬å°æ¹æ³æ ãå ãæ¹æ³åºãè¿è¡æ¶å¸¸éæ± ãç´æ¥åå­ãoutofmemoryerrorãstackoverflowerror\n * jvm åå¾æ¶é - å³é®è¯ï¼gc rootsãserialãparallelãcmsãg1ãminor gcãfull gc\n * jvm å­èç  - å³é®è¯ï¼bytecodeãasmãjavassist\n * jvm ç±»å è½½ - å³é®è¯ï¼classloaderãåäº²å§æ´¾\n * jvm å½ä»¤è¡å·¥å· - å³é®è¯ï¼jpsãjstatãjmap ãjstackãjhatãjinfo\n * jvm gui å·¥å· - å³é®è¯ï¼jconsoleãjvisualvmãmatãjprofileãarthas\n * jvm å®æ - å³é®è¯ï¼éç½®ãè°ä¼\n * java æéè¯æ­ - å³é®è¯ï¼cpuãåå­ãç£çãç½ç»ãgc\n\n\n# ð èµæ\n\n * ä¹¦ç±\n   * java åå¤§åè\n     * ãjava ç¼ç¨ææ³ï¼thinking in javaï¼ã\n     * ãjava æ ¸å¿ææ¯ å· i åºç¡ç¥è¯ã\n     * ãjava æ ¸å¿ææ¯ å· ii é«çº§ç¹æ§ã\n     * ãeffective javaã\n   * java å¹¶å\n     * ãjava å¹¶åç¼ç¨å®æã\n     * ãjava å¹¶åç¼ç¨çèºæ¯ã\n   * java èææº\n     * ãæ·±å¥çè§£ java èææºã\n   * java å¥é¨\n     * ão'reillyï¼head first javaã\n     * ãç¯ç java è®²ä¹ã\n   * å¶ä»\n     * ãhead first è®¾è®¡æ¨¡å¼ã\n     * ãjava ç½ç»ç¼ç¨ã\n     * ãjava å å¯ä¸è§£å¯çèºæ¯ã\n     * ãé¿éå·´å·´ java å¼åæåã\n * æç¨ãç¤¾åº\n   * runoob java æç¨\n   * java-design-patterns\n   * java\n   * ãjava æ ¸å¿ææ¯é¢è¯ç²¾è®²ã\n   * ãjava æ§è½è°ä¼å®æã\n   * ãjava ä¸å¡å¼åå¸¸è§éè¯¯ 100 ä¾ã\n   * æ·±å¥æè§£ java èææº\n   * ãjava å¹¶åç¼ç¨å®æã\n * é¢è¯\n   * cs-notes\n   * javaguide\n   * advanced-java\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/09/13, 06:43:21",lastUpdatedTimestamp:1726181001e3}],themeConfig:{nav:[{text:"åºç¡ç¹æ§",link:"/01.Java/01.JavaSE/01.åºç¡ç¹æ§/"},{text:"é«çº§ç¹æ§",link:"/01.Java/01.JavaSE/02.é«çº§ç¹æ§/"},{text:"å®¹å¨",link:"/01.Java/01.JavaSE/03.å®¹å¨/"},{text:"IO",link:"/01.Java/01.JavaSE/04.IO/"},{text:"å¹¶å",link:"/01.Java/01.JavaSE/05.å¹¶å/"},{text:"JVM",link:"/01.Java/01.JavaSE/06.JVM/"},{text:"â¨ Javaç³»å",ariaLabel:"Java",items:[{text:"Java æç¨ ð",link:"https://dunwu.github.io/java-tutorial/",target:"_blank",rel:""},{text:"JavaCore æç¨ ð",link:"https://dunwu.github.io/javacore/",target:"_blank",rel:""},{text:"Spring æç¨ ð",link:"https://dunwu.github.io/spring-tutorial/",target:"_blank",rel:""},{text:"Spring Boot æç¨ ð",link:"https://dunwu.github.io/spring-boot-tutorial/",target:"_blank",rel:""}]},{text:"ð¯ åå®¢",link:"https://github.com/dunwu/blog",target:"_blank",rel:""}],sidebarDepth:2,logo:"https://raw.githubusercontent.com/dunwu/images/master/common/dunwu-logo.png",repo:"dunwu/javacore",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",docsDir:"docs",editLinks:!0,editLinkText:"ð å¸®å©æ¹åæ­¤é¡µé¢ï¼",sidebar:{"/01.Java/":[{title:"JavaSE",collapsable:!0,children:[{title:"åºç¡ç¹æ§",collapsable:!0,children:[["01.JavaSE/01.åºç¡ç¹æ§/00.Javaå¼åç¯å¢.md","Java å¼åç¯å¢","/pages/7daf0d/"],["01.JavaSE/01.åºç¡ç¹æ§/01.Javaåºç¡è¯­æ³.md","Java åºç¡è¯­æ³ç¹æ§","/pages/2950ba/"],["01.JavaSE/01.åºç¡ç¹æ§/02.Javaåºæ¬æ°æ®ç±»å.md","æ·±å¥çè§£ Java åºæ¬æ°æ®ç±»å","/pages/55d693/"],["01.JavaSE/01.åºç¡ç¹æ§/03.Javaé¢åå¯¹è±¡.md","Java é¢åå¯¹è±¡","/pages/3e1661/"],["01.JavaSE/01.åºç¡ç¹æ§/04.Javaæ¹æ³.md","æ·±å¥çè§£ Java æ¹æ³","/pages/7a3ffc/"],["01.JavaSE/01.åºç¡ç¹æ§/05.Javaæ°ç».md","æ·±å¥çè§£ Java æ°ç»","/pages/155518/"],["01.JavaSE/01.åºç¡ç¹æ§/06.Javaæä¸¾.md","æ·±å¥çè§£ Java æä¸¾","/pages/979887/"],["01.JavaSE/01.åºç¡ç¹æ§/07.Javaæ§å¶è¯­å¥.md","Java æ§å¶è¯­å¥","/pages/fb4f8c/"],["01.JavaSE/01.åºç¡ç¹æ§/08.Javaå¼å¸¸.md","æ·±å¥çè§£ Java å¼å¸¸","/pages/37415c/"],["01.JavaSE/01.åºç¡ç¹æ§/09.Javaæ³å.md","æ·±å¥çè§£ Java æ³å","/pages/33a820/"],["01.JavaSE/01.åºç¡ç¹æ§/10.Javaåå°.md","æ·±å¥çè§£ Java åå°åå¨æä»£ç","/pages/0d066a/"],["01.JavaSE/01.åºç¡ç¹æ§/11.Javaæ³¨è§£.md","æ·±å¥çè§£ Java æ³¨è§£","/pages/ecc011/"],["01.JavaSE/01.åºç¡ç¹æ§/41.Javaå¸¸ç¨å·¥å·ç±».md","Java å¸¸ç¨å·¥å·ç±»","/pages/71bfcd/"],["01.JavaSE/01.åºç¡ç¹æ§/42.JavaStringç±»å.md","æ·±å¥çè§£ Java String ç±»å","/pages/bc583c/"]]},{title:"é«çº§ç¹æ§",collapsable:!0,children:[["01.JavaSE/02.é«çº§ç¹æ§/01.Javaæ­£å.md","Java æ­£åä»å¥é¨å°ç²¾é","/pages/4c1dd4/"],["01.JavaSE/02.é«çº§ç¹æ§/02.Javaç¼ç åå å¯.md","Java ç¼ç åå å¯","/pages/a249ff/"],["01.JavaSE/02.é«çº§ç¹æ§/03.Javaå½éå.md","Java å½éå","/pages/57003e/"],["01.JavaSE/02.é«çº§ç¹æ§/04.JDK8.md","JDK8 å¥é¨æå","/pages/ad1cce/"],["01.JavaSE/02.é«çº§ç¹æ§/05.JavaSPI.md","æºç çº§æ·±åº¦çè§£ Java SPI","/pages/496a7e/"],["01.JavaSE/02.é«çº§ç¹æ§/99.Javaç¼ç¨è§è.md","Java ç¼ç¨è§è","/pages/d71f2c/"]]},{title:"å®¹å¨",collapsable:!0,children:[["01.JavaSE/03.å®¹å¨/01.Javaå®¹å¨ç®ä».md","Java å®¹å¨ç®ä»","/pages/1cadba/"],["01.JavaSE/03.å®¹å¨/02.Javaå®¹å¨ä¹List.md","Java å®¹å¨ä¹ List","/pages/69deb2/"],["01.JavaSE/03.å®¹å¨/03.Javaå®¹å¨ä¹Map.md","Java å®¹å¨ä¹ Map","/pages/385755/"],["01.JavaSE/03.å®¹å¨/04.Javaå®¹å¨ä¹Set.md","Java å®¹å¨ä¹ Set","/pages/794c6b/"],["01.JavaSE/03.å®¹å¨/05.Javaå®¹å¨ä¹Queue.md","Java å®¹å¨ä¹ Queue","/pages/ffa963/"],["01.JavaSE/03.å®¹å¨/06.Javaå®¹å¨ä¹Stream.md","Java å®¹å¨ä¹ Stream","/pages/529fad/"]]},{title:"IO",collapsable:!0,children:[["01.JavaSE/04.IO/01.JavaIOæ¨¡å.md","Java IO æ¨¡å","/pages/b165ad/"],["01.JavaSE/04.IO/02.JavaNIO.md","Java NIO","/pages/6912a8/"],["01.JavaSE/04.IO/03.Javaåºåå.md","æ·±å¥çè§£ Java åºåå","/pages/2b2f0f/"],["01.JavaSE/04.IO/04.Javaç½ç»ç¼ç¨.md","Java ç½ç»ç¼ç¨","/pages/e4c818/"],["01.JavaSE/04.IO/05.JavaIOå·¥å·ç±».md","Java IO å·¥å·ç±»","/pages/e25d81/"]]},{title:"å¹¶å",collapsable:!0,children:[["01.JavaSE/05.å¹¶å/01.Javaå¹¶åç®ä».md","Javaå¹¶åç®ä»","/pages/f6b642/"],["01.JavaSE/05.å¹¶å/02.Javaçº¿ç¨åºç¡.md","Javaçº¿ç¨åºç¡","/pages/fee2cc/"],["01.JavaSE/05.å¹¶å/03.Javaå¹¶åæ ¸å¿æºå¶.md","Javaå¹¶åæ ¸å¿æºå¶","/pages/2c6488/"],["01.JavaSE/05.å¹¶å/04.Javaé.md","Javaé","/pages/e2e047/"],["01.JavaSE/05.å¹¶å/05.Javaåå­ç±».md","Javaåå­ç±»","/pages/25f78a/"],["01.JavaSE/05.å¹¶å/06.Javaå¹¶ååå®¹å¨.md","Javaå¹¶ååå®¹å¨","/pages/b067d6/"],["01.JavaSE/05.å¹¶å/07.Javaçº¿ç¨æ± .md","Javaçº¿ç¨æ± ","/pages/ad9680/"],["01.JavaSE/05.å¹¶å/08.Javaå¹¶åå·¥å·ç±».md","Javaå¹¶åå·¥å·ç±»","/pages/02d274/"],["01.JavaSE/05.å¹¶å/09.Javaåå­æ¨¡å.md","Javaåå­æ¨¡å","/pages/d4e06f/"],["01.JavaSE/05.å¹¶å/10.ForkJoinæ¡æ¶.md","ForkJoinæ¡æ¶","/pages/edd121/"],["01.JavaSE/05.å¹¶å/11.Synchronized.md","Synchronized","/pages/8655a7/"]]},{title:"JVM",collapsable:!0,children:[["01.JavaSE/06.JVM/01.JVMä½ç³»ç»æ.md","JVM ä½ç³»ç»æ","/pages/08f153/"],["01.JavaSE/06.JVM/02.JVMåå­åºå.md","Java åå­ç®¡ç","/pages/db5b69/"],["01.JavaSE/06.JVM/03.JVMåå¾æ¶é.md","JVM åå¾æ¶é","/pages/c5a5b6/"],["01.JavaSE/06.JVM/04.JVMç±»å è½½.md","JVM ç±»å è½½","/pages/17aad9/"],["01.JavaSE/06.JVM/05.JVMå­èç .md","Java å­èç ","/pages/e9eb4b/"],["01.JavaSE/06.JVM/11.JVMå½ä»¤è¡å·¥å·.md","JVM å½ä»¤è¡å·¥å·","/pages/c590ae/"],["01.JavaSE/06.JVM/12.JVM_GUIå·¥å·.md","JVM GUI å·¥å·","/pages/43a8e5/"],["01.JavaSE/06.JVM/21.JVMå®æ.md","JVM å®æ","/pages/9cb60a/"],["01.JavaSE/06.JVM/22.Javaæéè¯æ­.md","Java æéè¯æ­","/pages/84f329/"]]},["01.JavaSE/99.Javaé¢è¯.md","Java é¢è¯æ»ç»","/pages/5f886e/"]]}],catalogue:{}},sidebarOpen:!0,updateBar:{showToArticle:!0},category:!0,tag:!0,archive:!0,author:{name:"dunwu",href:"https://github.com/dunwu"},social:{icons:[{iconClass:"icon-youjian",title:"åé®ä»¶",link:"mailto:forbreak@163.com"},{iconClass:"icon-github",title:"GitHub",link:"https://github.com/dunwu"}]},footer:{createYear:2019,copyrightInfo:"éæï¼dunwuï¼ | CC-BY-SA-4.0"},htmlModules:{windowRB:'\n    <div class="wwads-cn wwads-vertical windowRB" data-id="261" style="max-width:160px;\n    min-width: auto;min-height:auto;"></div>\n    <style>\n      .windowRB{ padding: 0;}\n      .windowRB .wwads-img{margin-top: 10px;}\n      .windowRB .wwads-content{margin: 0 10px 40px 10px;}\n      .custom-html-window-rb .close-but{\n        display: none;\n      }\n    </style>\n  '}}};var js=t(96),ws=t(97),Ss=t(11);var Ts={computed:{$filterPosts(){return this.$site.pages.filter(n=>{const{frontmatter:{pageComponent:e,article:t,home:a}}=n;return!(e||!1===t||!0===a)})},$sortPosts(){return(n=this.$filterPosts).sort((n,e)=>{const t=n.frontmatter.sticky,a=e.frontmatter.sticky;return t&&a?t==a?Object(Ss.a)(n,e):t-a:t&&!a?-1:!t&&a?1:Object(Ss.a)(n,e)}),n;var n},$sortPostsByDate(){return(n=this.$filterPosts).sort((n,e)=>Object(Ss.a)(n,e)),n;var n},$groupPosts(){return function(n){const e={},t={};for(let a=0,r=n.length;a<r;a++){const{frontmatter:{categories:r,tags:i}}=n[a];"array"===Object(Ss.n)(r)&&r.forEach(t=>{t&&(e[t]||(e[t]=[]),e[t].push(n[a]))}),"array"===Object(Ss.n)(i)&&i.forEach(e=>{e&&(t[e]||(t[e]=[]),t[e].push(n[a]))})}return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags(){return function(n){const e=[],t=[];for(let t in n.categories)e.push({key:t,length:n.categories[t].length});for(let e in n.tags)t.push({key:e,length:n.tags[e].length});return{categories:e,tags:t}}(this.$groupPosts)}}};$t.component(js.default),$t.component(ws.default);function Is(n){return n.toString().padStart(2,"0")}t(246);$t.component("Badge",()=>Promise.all([t.e(0),t.e(3)]).then(t.bind(null,408))),$t.component("CodeBlock",()=>Promise.resolve().then(t.bind(null,96))),$t.component("CodeGroup",()=>Promise.resolve().then(t.bind(null,97)));t(247);var Cs=t(95),zs=t.n(Cs),Es=t(25);let Js,As;var Ms;"valine"===(Ms="gitalk")?t.e(71).then(t.t.bind(null,339,7)).then(n=>As=n.default):"gitalk"===Ms&&Promise.all([t.e(0),t.e(70)]).then(t.t.bind(null,340,7)).then(()=>t.e(69).then(t.t.bind(null,341,7))).then(n=>Js=n.default);function Ls(n,e){const t={};return Reflect.ownKeys(n).forEach(a=>{if("string"==typeof n[a])try{t[a]=zs.a.render(n[a],e)}catch(e){console.warn(`Comment config option error at key named "${a}"`),console.warn("More info: "+e.message),t[a]=n[a]}else t[a]=n[a]}),t}console.log(`How to use "gitalk" in ${Es.name}@v${Es.version}:`,Es.homepage);const Os={gitalk:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t);new Js(Ls({clientID:"7dd8c87a20cff437d2ed",clientSecret:"4e28d81a9a0280796b2b45ce2944424c6f2c1531",repo:"javacore",owner:"dunwu",admin:["dunwu"],pagerDirection:"last",id:"<%- (frontmatter.permalink || frontmatter.to.path).slice(-16) %>",title:"ãè¯è®ºã<%- frontmatter.title %>",labels:["Gitalk","Comment"],body:"é¡µé¢ï¼<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>"},{frontmatter:n})).render(e)},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}},valine:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t),new As({...Ls({clientID:"7dd8c87a20cff437d2ed",clientSecret:"4e28d81a9a0280796b2b45ce2944424c6f2c1531",repo:"javacore",owner:"dunwu",admin:["dunwu"],pagerDirection:"last",id:"<%- (frontmatter.permalink || frontmatter.to.path).slice(-16) %>",title:"ãè¯è®ºã<%- frontmatter.title %>",labels:["Gitalk","Comment"],body:"é¡µé¢ï¼<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>"},{frontmatter:n}),el:"#"+e})},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}}},Ps="vuepress-plugin-comment";let _s=null;function Ds(n){return Os.gitalk.clear(Ps)}function Rs(n){return!1!==n.comment&&!1!==n.comments}function Bs(n){clearTimeout(_s);if(document.querySelector("main.page"))return Os.gitalk.render(n,Ps);_s=setTimeout(()=>Bs(n),200)}var Fs={mounted(){_s=setTimeout(()=>{const n={to:{},from:{},...this.$frontmatter};Ds()&&Rs(n)&&Bs(n)},1e3),this.$router.afterEach((n,e)=>{if(n&&e&&n.path===e.path)return;const t={to:n,from:e,...this.$frontmatter};Ds()&&Rs(t)&&Bs(t)})}},Ns=Object(bs.a)(Fs,(function(){return(0,this._self._c)("div")}),[],!1,null,null,null).exports,qs=[({Vue:n,options:e,router:t,siteData:a,isServer:r})=>{r||t.afterEach(()=>{var n;n=function(){setTimeout((function(){void 0===window._AdBlockInit&&function(){const n=document.getElementsByClassName("wwads-cn"),e=document.querySelector(".wwads-content");n[0]&&!e&&(n[0].innerHTML="<style>.wwads-horizontal,.wwads-vertical{background-color:#f4f8fa;padding:5px;min-height:120px;margin-top:20px;box-sizing:border-box;border-radius:3px;font-family:sans-serif;display:flex;min-width:150px;position:relative;overflow:hidden;}.wwads-horizontal{flex-wrap:wrap;justify-content:center}.wwads-vertical{flex-direction:column;align-items:center;padding-bottom:32px}.wwads-horizontal a,.wwads-vertical a{text-decoration:none}.wwads-horizontal .wwads-img,.wwads-vertical .wwads-img{margin:5px}.wwads-horizontal .wwads-content,.wwads-vertical .wwads-content{margin:5px}.wwads-horizontal .wwads-content{flex:130px}.wwads-vertical .wwads-content{margin-top:10px}.wwads-horizontal .wwads-text,.wwads-content .wwads-text{font-size:14px;line-height:1.4;color:#0e1011;-webkit-font-smoothing:antialiased}.wwads-horizontal .wwads-poweredby,.wwads-vertical .wwads-poweredby{display:block;font-size:11px;color:#a6b7bf;margin-top:1em}.wwads-vertical .wwads-poweredby{position:absolute;left:10px;bottom:10px}.wwads-horizontal .wwads-poweredby span,.wwads-vertical .wwads-poweredby span{transition:all 0.2s ease-in-out;margin-left:-1em}.wwads-horizontal .wwads-poweredby span:first-child,.wwads-vertical .wwads-poweredby span:first-child{opacity:0}.wwads-horizontal:hover .wwads-poweredby span,.wwads-vertical:hover .wwads-poweredby span{opacity:1;margin-left:0}.wwads-horizontal .wwads-hide,.wwads-vertical .wwads-hide{position:absolute;right:-23px;bottom:-23px;width:46px;height:46px;border-radius:23px;transition:all 0.3s ease-in-out;cursor:pointer;}.wwads-horizontal .wwads-hide:hover,.wwads-vertical .wwads-hide:hover{background:rgb(0 0 0 /0.05)}.wwads-horizontal .wwads-hide svg,.wwads-vertical .wwads-hide svg{position:absolute;left:10px;top:10px;fill:#a6b7bf}.wwads-horizontal .wwads-hide:hover svg,.wwads-vertical .wwads-hide:hover svg{fill:#3E4546}</style><a href='https://wwads.cn/page/whitelist-wwads' class='wwads-img' target='_blank' rel='nofollow'><img src='https://fastly.jsdelivr.net/gh/xugaoyi/image_store@master/blog/wwads.2a3pidhlh4ys.webp' width='130'></a><div class='wwads-content'><a href='https://wwads.cn/page/whitelist-wwads' class='wwads-text' target='_blank' rel='nofollow'>ä¸ºäºæ¬ç«çé¿æè¿è¥ï¼è¯·å°æä»¬çç½ç«å å¥å¹¿åæ¦æªå¨çç½ååï¼æè°¢æ¨çæ¯æï¼<span style='color: #11a8cd'>å¦ä½æ·»å ç½åå?</span></a><a href='https://wwads.cn/page/end-user-privacy' class='wwads-poweredby' title='ä¸ç»´å¹¿å ï½ è®©å¹¿åæ´ä¼éï¼ä¸æç¨' target='_blank'><span>å¹¿å</span></a></div><a class='wwads-hide' onclick='parentNode.remove()' title='éèå¹¿å'><svg xmlns='http://www.w3.org/2000/svg' width='6' height='7'><path d='M.879.672L3 2.793 5.121.672a.5.5 0 11.707.707L3.708 3.5l2.12 2.121a.5.5 0 11-.707.707l-2.12-2.12-2.122 2.12a.5.5 0 11-.707-.707l2.121-2.12L.172 1.378A.5.5 0 01.879.672z'></path></svg></a>")}()}),3e3)},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(n,1):document.addEventListener("DOMContentLoaded",n),setTimeout(()=>{const n=document.querySelector(".page-wwads");if(!n)return;const e=n.querySelector(".wwads-hide");e&&(e.onclick=()=>{n.style.display="none"}),"none"===n.style.display&&(n.style.display="flex")},900)})},({Vue:n,options:e,router:t,siteData:a})=>{a.pages.map(n=>{const{frontmatter:{date:e,author:t}}=n;"string"==typeof e&&"Z"===e.charAt(e.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return`${n.getUTCFullYear()}-${Is(n.getUTCMonth()+1)}-${Is(n.getUTCDate())} ${Is(n.getUTCHours())}:${Is(n.getUTCMinutes())}:${Is(n.getUTCSeconds())}`}(e)),t?n.author=t:a.themeConfig.author&&(n.author=a.themeConfig.author)}),n.mixin(Ts)},{},({Vue:n})=>{n.mixin({computed:{$dataBlock(){return this.$options.__data__block__}}})},{},{},()=>{"undefined"!=typeof window&&function(n,e,t){function a(n){var t=e.createElement("div");t.className="heart",r.push({el:t,x:n.clientX-5,y:n.clientY-5,scale:1,alpha:1,color:"#11a8cd"}),e.body.appendChild(t)}var r=[];n.requestAnimationFrame=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(n){setTimeout(n,1e3/60)},function(n){var t=e.createElement("style");t.type="text/css";try{t.appendChild(e.createTextNode(n))}catch(e){t.styleSheet.cssText=n}e.getElementsByTagName("head")[0].appendChild(t)}(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),function(){var e="function"==typeof n.onclick&&n.onclick;n.onclick=function(n){let t=!0;n.path&&n.path.forEach(n=>{1===n.nodeType&&"string"==typeof n.className&&n.className.indexOf("theme-vdoing-content")>-1&&(t=!1)}),t&&(e&&e(),a(n))}}(),function n(){for(var t=0;t<r.length;t++)r[t].alpha<=0?(e.body.removeChild(r[t].el),r.splice(t,1)):(r[t].y--,r[t].scale+=.004,r[t].alpha-=.013,r[t].el.style.cssText="left:"+r[t].x+"px;top:"+r[t].y+"px;opacity:"+r[t].alpha+";transform:scale("+r[t].scale+","+r[t].scale+") rotate(45deg);background:"+r[t].color+";z-index:99999");requestAnimationFrame(n)}()}(window,document)},({Vue:n})=>{n.component("Comment",Ns)}],Us=["Comment"];class Vs extends class{constructor(){this.store=new $t({data:{state:{}}})}$get(n){return this.store.state[n]}$set(n,e){$t.set(this.store.state,n,e)}$emit(...n){this.store.$emit(...n)}$on(...n){this.store.$on(...n)}}{}Object.assign(Vs.prototype,{getPageAsyncComponent:ll,getLayoutAsyncComponent:sl,getAsyncComponent:cl,getVueComponent:ul});var Hs={install(n){const e=new Vs;n.$vuepress=e,n.prototype.$vuepress=e}};function Gs(n,e){const t=e.toLowerCase();return n.options.routes.some(n=>n.path.toLowerCase()===t)}var $s={props:{pageKey:String,slotKey:{type:String,default:"default"}},render(n){const e=this.pageKey||this.$parent.$page.key;return pl("pageKey",e),$t.component(e)||$t.component(e,ll(e)),$t.component(e)?n(e):n("")}},Ws={functional:!0,props:{slotKey:String,required:!0},render:(n,{props:e,slots:t})=>n("div",{class:["content__"+e.slotKey]},t()[e.slotKey])},Ks={computed:{openInNewWindowTitle(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},Xs=(t(252),t(253),Object(bs.a)(Ks,(function(){var n=this._self._c;return n("span",[n("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[n("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),n("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),n("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports),Qs={functional:!0,render(n,{parent:e,children:t}){if(e._isMounted)return t;e.$once("hook:mounted",()=>{e.$forceUpdate()})}};$t.config.productionTip=!1,$t.use(Ho),$t.use(Hs),$t.mixin(function(n,e,t=$t){!function(n){n.locales&&Object.keys(n.locales).forEach(e=>{n.locales[e].path=e});Object.freeze(n)}(e),t.$vuepress.$set("siteData",e);const a=new(n(t.$vuepress.$get("siteData"))),r=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(a)),i={};return Object.keys(r).reduce((n,e)=>(e.startsWith("$")&&(n[e]=r[e].get),n),i),{computed:i}}(n=>class{setPage(n){this.__page=n}get $site(){return n}get $themeConfig(){return this.$site.themeConfig}get $frontmatter(){return this.$page.frontmatter}get $localeConfig(){const{locales:n={}}=this.$site;let e,t;for(const a in n)"/"===a?t=n[a]:0===this.$page.path.indexOf(a)&&(e=n[a]);return e||t||{}}get $siteTitle(){return this.$localeConfig.title||this.$site.title||""}get $canonicalUrl(){const{canonicalUrl:n}=this.$page.frontmatter;return"string"==typeof n&&n}get $title(){const n=this.$page,{metaTitle:e}=this.$page.frontmatter;if("string"==typeof e)return e;const t=this.$siteTitle,a=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?a?a+" | "+t:t:a||"VuePress"}get $description(){const n=function(n){if(n){const e=n.filter(n=>"description"===n.name)[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}get $lang(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}get $localePath(){return this.$localeConfig.path||"/"}get $themeLocaleConfig(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}get $page(){return this.__page?this.__page:function(n,e){for(let t=0;t<n.length;t++){const a=n[t];if(a.path.toLowerCase()===e.toLowerCase())return a}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}},ks)),$t.component("Content",$s),$t.component("ContentSlotsDistributor",Ws),$t.component("OutboundLink",Xs),$t.component("ClientOnly",Qs),$t.component("Layout",sl("Layout")),$t.component("NotFound",sl("NotFound")),$t.prototype.$withBase=function(n){const e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.9",hash:"85a8835"},async function(n){const e="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:ks.routerBase||ks.base,t=new Ho({base:e,mode:"history",fallback:!1,routes:xs,scrollBehavior:(n,e,t)=>t||(n.hash?!$t.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})});!function(n){n.beforeEach((e,t,a)=>{if(Gs(n,e.path))a();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){const t=e.path.replace(/\/$/,"")+".html";Gs(n,t)?a(t):a()}else a();else{const t=e.path+"/",r=e.path+".html";Gs(n,r)?a(r):Gs(n,t)?a(t):a()}})}(t);const a={};try{await Promise.all(qs.filter(n=>"function"==typeof n).map(e=>e({Vue:$t,options:a,router:t,siteData:ks,isServer:n})))}catch(n){console.error(n)}return{app:new $t(Object.assign(a,{router:t,render:n=>n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},Us.map(e=>n(e)))])})),router:t}}(!1).then(({app:n,router:e})=>{e.onReady(()=>{n.$mount("#app")})})}]);